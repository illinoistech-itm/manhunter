From java-user-return-45638-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 01:02:02 2010
Return-Path: <java-user-return-45638-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78190 invoked from network); 1 Apr 2010 01:02:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 01:02:02 -0000
Received: (qmail 10324 invoked by uid 500); 1 Apr 2010 01:02:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10289 invoked by uid 500); 1 Apr 2010 01:02:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10281 invoked by uid 99); 1 Apr 2010 01:01:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 01:01:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 01:01:53 +0000
Received: by gwb19 with SMTP id 19so460211gwb.35
        for <java-user@lucene.apache.org>; Wed, 31 Mar 2010 18:01:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=XH0mP/nLTdR+Xgn9qaAK2fWbHiqf0VzvXtqXMWfx8FI=;
        b=Z6qvrMV49o9TERY2+bvisViiSbRRKhnJ7x34Jj61fXuvgyeP+ByFzgw6U9GyQy3v9+
         h30yIJscnpHsqcnV4VuF+by8g2ZwKfLzNZL2S0ZOUU/speZBTTGf4fBEdg9T5HgrHQW3
         75jvsncCOT8bTVmaQnO9dNFIu4EadX4A0Ule0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=G4MMAI4nvZu04CBOhCDmSlTrOBXXkFDiDG1a5eTQVVN6OgWCDTzVsaVaxri1bG/vQK
         BOktIn8zQABlvS2yb4kKMuwXdb9c9L9nytWPhjWzSfXtZDMs3uutvH9ioO+0J+KZqVMy
         yhvSLSIubVI1eqheenj8rxXBmHvRSG5IszRyY=
MIME-Version: 1.0
Received: by 10.151.149.19 with HTTP; Wed, 31 Mar 2010 18:01:32 -0700 (PDT)
In-Reply-To: <9D9D39B8-C2C7-4FA7-B567-D1B06DA46B69@activemath.org>
References: <9D9D39B8-C2C7-4FA7-B567-D1B06DA46B69@activemath.org>
Date: Wed, 31 Mar 2010 18:01:32 -0700
Received: by 10.150.56.16 with SMTP id e16mr674680yba.281.1270083692336; Wed, 
	31 Mar 2010 18:01:32 -0700 (PDT)
Message-ID: <q2h359a92831003311801r7557f69ag391ce206c651cea6@mail.gmail.com>
Subject: Re: best way to interest two queries?
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd649745118060483226707
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd649745118060483226707
Content-Type: text/plain; charset=ISO-8859-1

I'm not quite sure what you mean by "passed this, nothing matches that query
anymore". But one approach to your intersection process would be to fire two
queries. Use the first query to create a filter for the second. See
QueryWrapperFilter in the javadocs...

HTH
Erick

On Wed, Mar 31, 2010 at 2:00 PM, Paul Libbrecht <paul@activemath.org> wrote:

>
> Hello list,
>
> I've been wandering around but I see no solution yet: I would like to
> intersect two query results: going through the list of one query and
> indicating which ones actually match the other query or, even better,
> indicating that "passed this, nothing matches that query anymore".
>
> What should be the strategy?
>
> paul
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd649745118060483226707--

From java-user-return-45639-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 01:18:17 2010
Return-Path: <java-user-return-45639-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96944 invoked from network); 1 Apr 2010 01:18:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 01:18:17 -0000
Received: (qmail 31698 invoked by uid 500); 1 Apr 2010 01:18:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31652 invoked by uid 500); 1 Apr 2010 01:18:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31642 invoked by uid 99); 1 Apr 2010 01:18:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 01:18:15 +0000
X-ASF-Spam-Status: No, hits=-0.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of akaris@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 01:18:08 +0000
Received: by ywh38 with SMTP id 38so497354ywh.29
        for <java-user@lucene.apache.org>; Wed, 31 Mar 2010 18:17:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:from:date:received
         :message-id:subject:to:content-type;
        bh=bsLZ6kkqbytxzEYzBOxFLlTrpU8f7G/Mk0KSdl5qP+g=;
        b=O08UDwGq1jQ94nH+XUdec0Qrets692pVoCHGaf31CwBQrY1Vn4Rul/C7ikdO1tPfQi
         McKujsPhwsKAu7eTI8nlyvqGwC9NVH0D5Yhx3a92XWS666+4twss1qa/a/Pf9QTM5rtv
         WUM6MOR+41LeWeUDrOxef7737+AiPVZHNXDE0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=ZqeAH05438Av3eRVeSqnd8VfYsKd7mV/y51WXfhMOTAjYyCqt8xzKJKMUqQ/RcYQ98
         X/psW+Ls8PDWc7FOYwulVCRavOt6tb7aGETmCuWuXPnoumJPp5D3FOW8Z+vlI7+hd/1V
         rBnwx0RrDGhozyp4sSBqV3DC7soWCa+IPn5Qk=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Wed, 31 Mar 2010 18:17:27 -0700 (PDT)
From: Michel Nadeau <akaris@gmail.com>
Date: Wed, 31 Mar 2010 21:17:27 -0400
Received: by 10.100.56.16 with SMTP id e16mr836727ana.105.1270084667275; Wed, 
	31 Mar 2010 18:17:47 -0700 (PDT)
Message-ID: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
Subject: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f8979c6d9037048322a1fe

--001485f8979c6d9037048322a1fe
Content-Type: text/plain; charset=ISO-8859-1

Hi,

We're currently in the process of switching many of our screens from MySQL
to Lucene because MySQL simply dies because we have too much data and it's
becoming too long to generate the stats we need.

So here's one MySQL query that we use to find out our Top 10 Affiliates :

SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY affialiate_id
ORDER BY total_sales DESC LIMIT 10;

We currently have our "sales" index, containing all sales and all fields -
and it's one big index (over 10M records). We could fetch all documents
within the date range, loop them and add up the total_sales, but it would be
just crazy to do this all the time (we have a high volume of search).

We made several tests with Solr (Facets, and even the beta CollapseFields),
but nothing is really helping us. We could pre-generate the total_sales for
all possible date ranges... but that would be quite crazy too as the date
range possibilities quickly become endless.

So - is there any known way to efficiently do SUM(), COUNT() (and even AVG()
) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't seem
to offer what I need either.

Thanks for any hints!!!

- Mike
akaris@gmail.com

--001485f8979c6d9037048322a1fe--

From java-user-return-45640-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 01:24:20 2010
Return-Path: <java-user-return-45640-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97997 invoked from network); 1 Apr 2010 01:24:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 01:24:20 -0000
Received: (qmail 37298 invoked by uid 500); 1 Apr 2010 01:24:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37255 invoked by uid 500); 1 Apr 2010 01:24:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37247 invoked by uid 99); 1 Apr 2010 01:24:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 01:24:18 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 01:24:10 +0000
Received: by vws14 with SMTP id 14so368225vws.35
        for <java-user@lucene.apache.org>; Wed, 31 Mar 2010 18:23:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=Rfk/7Ic750stZGvXtCVNqOrjcbgYxNqe+D8S4AFRljY=;
        b=A84D3KNhcJV83hrotyQX28sVMX6+piLUbXnf1jpwsbxI5KxQsFfB+ZeZufMHXK1bbe
         pHorv71AtEvLP2vGp4hfUJDXX5rHpJPLDUMVsKDiZf63jdeQfGepEXjSR3HRZfqNSji3
         5vSWPh4KWkVxNJMv6UPemgJYCz1/M+EbSQvJo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=UwDalmQ1qR/opLgQ1mp7Q/ZuJ8ktG1QUpczwcPU2wLkX+Wcm2wAg8XKq7STjH5HuCU
         tGkwl+pYkHEcwBlAmf0fS1MFoCnv+qpAn6PrfIj2TtivHzD0IA/5U05fXfN5b+/sRk+7
         DlxFKH1nwzMjyhKDvi8T7mONjYz9kTweLM7as=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Wed, 31 Mar 2010 18:23:49 -0700 (PDT)
In-Reply-To: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
Date: Thu, 1 Apr 2010 06:53:49 +0530
Received: by 10.220.4.21 with SMTP id 21mr58359vcp.222.1270085029537; Wed, 31 
	Mar 2010 18:23:49 -0700 (PDT)
Message-ID: <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

I too am trying to achieve something.

I am thinking of storing the integer values in  payloads and then
using spanquery classes to compute the respective SUMs

-Prasen

On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> wrote:
> Hi,
>
> We're currently in the process of switching many of our screens from MySQL
> to Lucene because MySQL simply dies because we have too much data and it's
> becoming too long to generate the stats we need.
>
> So here's one MySQL query that we use to find out our Top 10 Affiliates :
>
> SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
> sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY affialiate_id
> ORDER BY total_sales DESC LIMIT 10;
>
> We currently have our "sales" index, containing all sales and all fields -
> and it's one big index (over 10M records). We could fetch all documents
> within the date range, loop them and add up the total_sales, but it would be
> just crazy to do this all the time (we have a high volume of search).
>
> We made several tests with Solr (Facets, and even the beta CollapseFields),
> but nothing is really helping us. We could pre-generate the total_sales for
> all possible date ranges... but that would be quite crazy too as the date
> range possibilities quickly become endless.
>
> So - is there any known way to efficiently do SUM(), COUNT() (and even AVG()
> ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't seem
> to offer what I need either.
>
> Thanks for any hints!!!
>
> - Mike
> akaris@gmail.com
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45641-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 02:23:47 2010
Return-Path: <java-user-return-45641-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7913 invoked from network); 1 Apr 2010 02:23:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 02:23:46 -0000
Received: (qmail 79790 invoked by uid 500); 1 Apr 2010 02:23:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79662 invoked by uid 500); 1 Apr 2010 02:23:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79654 invoked by uid 99); 1 Apr 2010 02:23:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 02:23:44 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.177.145.93] (HELO prxy.net) (209.177.145.93)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 02:23:36 +0000
Received: from [75.26.170.71] (account ken@krugler.org HELO [192.168.1.110])
  by prxy.net (CommuniGate Pro SMTP 4.2.10)
  with ESMTP id 131504390 for java-user@lucene.apache.org; Wed, 31 Mar 2010 19:23:19 -0700
Message-Id: <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>
From: Ken Krugler <kkrugler_lists@transpac.com>
To: java-user@lucene.apache.org
In-Reply-To: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Lucene Challenge - sum, count, avg, etc.
Date: Wed, 31 Mar 2010 19:23:04 -0700
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Mike,

I'm sure there are better options, but one thing you could do is per- 
compute totals for different date resolutions. Depending on the number  
of unique affiliate IDs, this might work.

E.g. pre-calculate sums by day & by week (and maybe by month) for each  
affiliate id, and then turn the query into a set of affiliate_id x  
date range queries. Something like:

affiliate_id:<value> and (day:59 or day:60 or day:61 or week:10 or  
week:11 or week:12 or day:86 or day:87...)

-- Ken


On Mar 31, 2010, at 6:17pm, Michel Nadeau wrote:

> Hi,
>
> We're currently in the process of switching many of our screens from  
> MySQL
> to Lucene because MySQL simply dies because we have too much data  
> and it's
> becoming too long to generate the stats we need.
>
> So here's one MySQL query that we use to find out our Top 10  
> Affiliates :
>
> SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
> sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY  
> affialiate_id
> ORDER BY total_sales DESC LIMIT 10;
>
> We currently have our "sales" index, containing all sales and all  
> fields -
> and it's one big index (over 10M records). We could fetch all  
> documents
> within the date range, loop them and add up the total_sales, but it  
> would be
> just crazy to do this all the time (we have a high volume of search).
>
> We made several tests with Solr (Facets, and even the beta  
> CollapseFields),
> but nothing is really helping us. We could pre-generate the  
> total_sales for
> all possible date ranges... but that would be quite crazy too as the  
> date
> range possibilities quickly become endless.
>
> So - is there any known way to efficiently do SUM(), COUNT() (and  
> even AVG()
> ) using Lucene/Solr/others? I also checked Bobo Browse but it  
> doesn't seem
> to offer what I need either.
>
> Thanks for any hints!!!
>
> - Mike
> akaris@gmail.com

--------------------------------------------
Ken Krugler
+1 530-210-6378
http://bixolabs.com
e l a s t i c   w e b   m i n i n g





---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45642-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 06:23:03 2010
Return-Path: <java-user-return-45642-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46048 invoked from network); 1 Apr 2010 06:23:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 06:23:03 -0000
Received: (qmail 49057 invoked by uid 500); 1 Apr 2010 06:23:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48877 invoked by uid 500); 1 Apr 2010 06:23:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48869 invoked by uid 99); 1 Apr 2010 06:23:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 06:23:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of suman.holani@zapak.co.in designates 220.226.181.11 as permitted sender)
Received: from [220.226.181.11] (HELO mail.zapak.co.in) (220.226.181.11)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 06:22:46 +0000
Received: (qmail 4330 invoked by uid 508); 1 Apr 2010 06:22:10 -0000
Comment: DomainKeys? See http://antispam.yahoo.com/domainkeys
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=default; d=zapak.co.in;
  b=dsI1U8whsVYE3GJkvmpyf6/fdMIV7w9eB1ZgibvNlE1vAFaFO8FmXpozhMIIxnfY  ;
Received: from localhost (HELO www.mail.zapak.co.in) (127.0.0.1)
  by mail.zapak.co.in with SMTP; 1 Apr 2010 06:22:10 -0000
MIME-Version: 1.0
Date: Thu, 01 Apr 2010 11:52:10 +0530
From: <suman.holani@zapak.co.in>
To: <java-user@lucene.apache.org>
Subject: query: order of search
In-Reply-To: <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>
Message-ID: <e13f18ad7b10cc633edd32e51d335f7a@localhost>
X-Sender: suman.holani@zapak.co.in
User-Agent: RoundCube Webmail/0.3.1
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8

Hello


Query I
Does the order of query play role in searching 
example:doc has fields
rollno(pk), name, marks

Query : marks=90&rollno=2&name=abc

Query :rollno=2&name=abc&marks=90

which query processing will be more efficient.
is it work like search doc field by field , it will look for doc having
rollno=2 then from thos will look for name abc and from the selected docs
will again look for marks param .


Query II
 which  is more faster .
a)  adding one more multivalued field into current index(large) 
b)  or creating a separate index for the field and searching it as a
subindex .
My main apprehensions is in regard to large size of index




thanks,
Suman 

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45643-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 08:14:32 2010
Return-Path: <java-user-return-45643-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71348 invoked from network); 1 Apr 2010 08:14:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 08:14:32 -0000
Received: (qmail 41081 invoked by uid 500); 1 Apr 2010 08:14:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40953 invoked by uid 500); 1 Apr 2010 08:14:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40944 invoked by uid 99); 1 Apr 2010 08:14:29 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 08:14:29 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [87.248.114.167] (HELO web24103.mail.ird.yahoo.com) (87.248.114.167)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 08:14:23 +0000
Received: (qmail 78982 invoked by uid 60001); 1 Apr 2010 08:14:01 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270109641; bh=fZ1sndWMMsMeFtcp8CG64EEgnkTA+YkbG5+FLnkxR5g=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=MchlaLTSXeqG7bmkF0i4QjsMHlvtzv6t37xXtl3xMNGEIJymjV0a1T2fTRDjPpXXBiJgkPZdipULNvNYVxb+x9xD/EHzYGB+oJng9gE9oJZhUOdpVltUP//N/n8QxDOF2qaIPBiWZycpNthKVQvFs+qG1zJGIzH11s3m3/J51Qs=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=Rev6D66jRYbfpOMBP/hCIMzlHY5JOp6ghVtXj85R50NG/AzBjKZqvT+u+Q65iLBfxUk3bsY1ureOU0uQeg1IIR1iFwiUe8TqnwBAkIW+U2hAQvkX+JEXApfz7L74vpa0PMCy5I/UiJqptXgzVN4WTTVOnK0GS5IWTNjdfi7gnr0=;
Message-ID: <514479.77487.qm@web24103.mail.ird.yahoo.com>
X-YMail-OSG: VTYuv8gVM1kUWz4RlV1wnFIwH1SGlpP0isLIrpUR8cVDpxj
 VEyej6hnYVO_Pn7BzJBmDN836Sbrpf1hSE7BA1G5Rotwdut4cumBKW1bKIPG
 ihWEtzQqWB0qD7yZ5EFE1ns3qvW773ES_AxWN7u7WZDiuFu2gyMt1Jh9uZOI
 BR5tZddLKMjDwduamYcYvDBvXTK46ssWO0BS6LVBOAK5eWlmWGSXQkRDpaFv
 bRgx8CTrb8rOXsFG62wnu38PVxEWZH64VsfN2LoVu_sTrt6fnH2Oav5JG2zq
 TAQwkswxjqN9tDomxemqHtC.NQoBnMfAeRQ--
Received: from [87.236.200.91] by web24103.mail.ird.yahoo.com via HTTP; Thu, 01 Apr 2010 08:14:01 GMT
X-Mailer: YahooMailRC/324.3 YahooMailWebService/0.8.100.260964
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <B622A555-5EAF-4BB4-A9CF-E9677A1E2965@activemath.org>
Date: Thu, 1 Apr 2010 08:14:01 +0000 (GMT)
From: David Vergnaud <dvergnaud@yahoo.com>
Subject: Re: Designing a multilingual index
To: java-user@lucene.apache.org
In-Reply-To: <B622A555-5EAF-4BB4-A9CF-E9677A1E2965@activemath.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi,=0A=0Athanks Paul for your input. I'm gonna try the "localized field" va=
riant and see how it works for me. =0A=0AI think your idea of automatically=
 boosting the user language is neat, but it should definitely be possible t=
o disable this boosting... Most users have no idea about the language setti=
ngs in their browser, which drive the contents of the "Accept-Language" hea=
der, and e.g. here in Switzerland there's many a foreigner whose prefered l=
anguage is not French or German or Italian, so forcing a boost on the user =
could definitely result in a poor user experience. =0A=0ADoes anyone have a=
ny technical arguments why the one (several indices) or the other (localize=
d fields in a single index) method might be better? =0A=0ACheers,=0A=0ADavi=
d=0A=0A=0A=0A----- Original Message ----=0AFrom: Paul Libbrecht <paul@activ=
emath.org>=0ATo: java-user@lucene.apache.org=0ASent: Wed, March 31, 2010 10=
:00:14 PM=0ASubject: Re: Designing a multilingual index=0A=0ADavid,=0A=0AI'=
m doing exactly that.=0AAnd I think there's one crucial advantage aside: mu=
ltilingual queries: if your user requests "segment" you have no way to know=
 which language he is searching for; erm, well, you have the user-language(=
s) (through the browser Accept-Language header for example) so you'll under=
stand he meant to search in french but would accept that he wants also matc=
hes in others languages, just less boosted.=0A=0ASo I "expand" the query fr=
om "segment" in a french environment to:=0A  title-fr:segment^1.44 wor titl=
e-en:segment^1.2 ... wor text-fr:segment:1.2 wor text-en:segment:1.1 ...=0A=
(wor is my naming of the weighted-or which is the normal thing of a "should=
" boolean query)=0A=0ASurprisingly i haven't seen many people talk about "q=
uery expansion" but I think it is rather systematic and it could become mor=
e part of the culture of search engines...=0A=0Apaul=0A=0A=0ALe 31-mars-10 =
=E0 18:20, David Vergnaud a =E9crit :=0A=0A> The second method I've thought=
 of is to have all languages in the same index and use different analyzers =
on fields that require analysis. In order to do that, I was thinking of ext=
ending the names of the fields with the names of the languages -- like e.g.=
 "content-en" vs "content-fr" vs "content-xx" (for "no language recognized"=
). Then using a customized analyzer, the name of the field would be parsed =
in method tokenStream and the proper language-dependent analyzer would be s=
elected.=0A> The drawback of this method, as I see it, is that the number o=
f fields in the index increases drastically, which in turn means that build=
ing queries becomes rather cumbersome -- but still doable, assuming (which =
also is the case) that I know the exact list of languages I'm dealing with.=
 Also, it means that Lucene would be searching in non-existing fields in mo=
st documents, as I doubt many of them would contain *all* languages. But it=
 keeps the complete information about one document gathered in one place an=
d requires searching only one index.=0A> =0A> As I said, I've already imple=
mented the first method some time ago and it works fine. I've only just tho=
ught about the second one when I read about this PerFieldAnalyzerWrapper, w=
hich allows to do just what I want in the second method. Since my index won=
't be that big at first, I doubt either architecture would prove to be much=
 more efficient than the other, however I want to use a scaleable design ri=
ght from the start, so I was wondering whether some Lucene gurus might give=
 me some insights as to what in their eyes would be the better approach -- =
or whether there might be a different, much better technique I haven't thou=
ght of.=0A=0A=0A-----------------------------------------------------------=
----------=0ATo unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.or=
g=0AFor additional commands, e-mail: java-user-help@lucene.apache.org=0A=0A=
=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45644-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 09:00:46 2010
Return-Path: <java-user-return-45644-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82280 invoked from network); 1 Apr 2010 09:00:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 09:00:46 -0000
Received: (qmail 4623 invoked by uid 500); 1 Apr 2010 09:00:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4480 invoked by uid 500); 1 Apr 2010 09:00:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4467 invoked by uid 99); 1 Apr 2010 09:00:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:00:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of chris.lu@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:00:36 +0000
Received: by ywh38 with SMTP id 38so765129ywh.29
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 02:00:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=vIMyI3h7F8F+Cc+ZJMz1cUzDcg+4WXyQy21zXoe3y4w=;
        b=RAtqWAJWNHshGOl1exYFTsie5FnmrrrVsbFXSIA3J39cjSPFWUEf+fh6eXAyeyYE7y
         4kriF0oukUuJt9ex/MDc6LXd46V4glQYqs/Iyf0D+aJapV128fbJEiqqYOky4gms8eWK
         hdJr3hteQD49o3rAYZLwQKkaJlvHCbn+spUAw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=aBqrcEE7ej78X7Q+c4+csuMcK8iQrVsvoiZ7sqJmSNALobxM+myfj07mV0GMlLX64h
         4pGzVZ4p2AFJDemTkgcjkbACXw3rw9hCXGuPINkcAizTYpAwIbDtZWGPQBXqtsfHTgc/
         ZUA575wZXFAC7qK+TCZE9GtMM05qwAQJFcyb0=
Received: by 10.100.243.36 with SMTP id q36mr1666381anh.68.1270112410134;
        Thu, 01 Apr 2010 02:00:10 -0700 (PDT)
Received: from [192.168.1.102] (c-71-202-137-93.hsd1.ca.comcast.net [71.202.137.93])
        by mx.google.com with ESMTPS id 15sm5079837gxk.10.2010.04.01.02.00.08
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 02:00:08 -0700 (PDT)
Message-ID: <4BB46092.3030508@gmail.com>
Date: Thu, 01 Apr 2010 02:00:02 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.24 (Windows/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene Challenge - sum, count, avg, etc.
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
In-Reply-To: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hi, Michel,

This has already been implemented in DBSight. Check it out!
http://www.dbsight.net

You can get sum, avg for Facet searches. And count is included in Facet 
search directly.

--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!



Michel Nadeau wrote:
> Hi,
>
> We're currently in the process of switching many of our screens from MySQL
> to Lucene because MySQL simply dies because we have too much data and it's
> becoming too long to generate the stats we need.
>
> So here's one MySQL query that we use to find out our Top 10 Affiliates :
>
> SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
> sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY affialiate_id
> ORDER BY total_sales DESC LIMIT 10;
>
> We currently have our "sales" index, containing all sales and all fields -
> and it's one big index (over 10M records). We could fetch all documents
> within the date range, loop them and add up the total_sales, but it would be
> just crazy to do this all the time (we have a high volume of search).
>
> We made several tests with Solr (Facets, and even the beta CollapseFields),
> but nothing is really helping us. We could pre-generate the total_sales for
> all possible date ranges... but that would be quite crazy too as the date
> range possibilities quickly become endless.
>
> So - is there any known way to efficiently do SUM(), COUNT() (and even AVG()
> ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't seem
> to offer what I need either.
>
> Thanks for any hints!!!
>
> - Mike
> akaris@gmail.com
>
>   

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45645-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 09:05:52 2010
Return-Path: <java-user-return-45645-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83898 invoked from network); 1 Apr 2010 09:05:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 09:05:51 -0000
Received: (qmail 9266 invoked by uid 500); 1 Apr 2010 09:05:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9228 invoked by uid 500); 1 Apr 2010 09:05:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9220 invoked by uid 99); 1 Apr 2010 09:05:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:05:49 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:05:41 +0000
Received: by bwz22 with SMTP id 22so729366bwz.5
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 02:05:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=oTo7AtsE/B5Dti5wcF1jgz8Ye4bY8F0TgzgAQMAFooM=;
        b=op3Z/3zUxtTf3oTxsRsRgOGZ4Ano37jJDhfXvkhuDGkIKFRmpzako4GzVZaJW1cZ/o
         R/QDAjue25o+dfZixjwm0aj413fhw4Ocr8zSkCGqC7c6M30xNTHOHtZf3MDvC3tkvZBP
         M2YufjVZMKtVY7kS4gR7jD01VH6o3PMn+YPZk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=AVb/okg5uN6PCjLoQLUeXbo5kD5yRL8zQjCXhuwvvM6MmgnyoNNt3V9Q9NMaAjGU6d
         wGrQoLD56cb4Zi0eOqUKC3PQAN9bpY3caGLmB8D7EB//bhY9n41TT5H6Y/RLM8TO6+UW
         BW6t+Bz82gRmOwhlTjpliRXVtsR5b/PvdvzC8=
MIME-Version: 1.0
Received: by 10.204.46.104 with HTTP; Thu, 1 Apr 2010 02:05:01 -0700 (PDT)
In-Reply-To: <e13f18ad7b10cc633edd32e51d335f7a@localhost>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com> <e13f18ad7b10cc633edd32e51d335f7a@localhost>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 1 Apr 2010 10:05:01 +0100
Received: by 10.204.6.212 with SMTP id a20mr1091505bka.22.1270112721293; Thu, 
	01 Apr 2010 02:05:21 -0700 (PDT)
Message-ID: <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com>
Subject: Re: query: order of search
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

> Query I
> Does the order of query play role in searching
> example:doc has fields
> rollno(pk), name, marks
>
> Query : marks=3D90&rollno=3D2&name=3Dabc
>
> Query :rollno=3D2&name=3Dabc&marks=3D90
>
> which query processing will be more efficient.
> is it work like search doc field by field , it will look for doc having
> rollno=3D2 then from thos will look for name abc and from the selected do=
cs
> will again look for marks param .

I don't think it makes any difference.


> Query II
> =A0which =A0is more faster .
> a) =A0adding one more multivalued field into current index(large)
> b) =A0or creating a separate index for the field and searching it as a
> subindex .
> My main apprehensions is in regard to large size of index

Probably your first option.


--
Ian.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45646-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 09:21:41 2010
Return-Path: <java-user-return-45646-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85801 invoked from network); 1 Apr 2010 09:21:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 09:21:41 -0000
Received: (qmail 20215 invoked by uid 500); 1 Apr 2010 09:21:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20172 invoked by uid 500); 1 Apr 2010 09:21:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20164 invoked by uid 99); 1 Apr 2010 09:21:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:21:38 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of suman.holani@zapak.co.in designates 220.226.181.11 as permitted sender)
Received: from [220.226.181.11] (HELO mail.zapak.co.in) (220.226.181.11)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 09:21:33 +0000
Received: (qmail 9632 invoked by uid 508); 1 Apr 2010 09:21:07 -0000
Comment: DomainKeys? See http://antispam.yahoo.com/domainkeys
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=default; d=zapak.co.in;
  b=YDM/ZTIXJB9OHJMxSxh47LAWnRaq0nbDRODDraV0JqzPQjEoS7egWEqDiM3e5eRn  ;
Received: from localhost (HELO www.mail.zapak.co.in) (127.0.0.1)
  by mail.zapak.co.in with SMTP; 1 Apr 2010 09:21:07 -0000
MIME-Version: 1.0
Date: Thu, 01 Apr 2010 14:51:07 +0530
From: <suman.holani@zapak.co.in>
To: <java-user@lucene.apache.org>
Subject: Re: query: order of search
In-Reply-To: <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com> <e13f18ad7b10cc633edd32e51d335f7a@localhost> <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com>
Message-ID: <22b5f5f44f786a63b4f54df70ddfc4d6@localhost>
X-Sender: suman.holani@zapak.co.in
User-Agent: RoundCube Webmail/0.3.1
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8


Query I

its written "to do a "search within search", so that the second search is
constrained by the results of the first query"
we can use boolean query.
So doesn't it mean the order of query ll be preserved

give me an simple example of how the docs get searched in lucene.
10 docs with 3 fields to b searched
so ll it search for field1 for all 10 docs..and the result set docs ll b
then searched for field2....and so far...
or is it something else..



thanks,
Suman

On Thu, 1 Apr 2010 10:05:01 +0100, Ian Lea <ian.lea@gmail.com> wrote:
>> Query I
>> Does the order of query play role in searching
>> example:doc has fields
>> rollno(pk), name, marks
>>
>> Query : marks=90&rollno=2&name=abc
>>
>> Query :rollno=2&name=abc&marks=90
>>
>> which query processing will be more efficient.
>> is it work like search doc field by field , it will look for doc having
>> rollno=2 then from thos will look for name abc and from the selected
docs
>> will again look for marks param .
> 
> I don't think it makes any difference.
> 
> 
>> Query II
>>  which  is more faster .
>> a)  adding one more multivalued field into current index(large)
>> b)  or creating a separate index for the field and searching it as a
>> subindex .
>> My main apprehensions is in regard to large size of index
> 
> Probably your first option.
> 
> 
> --
> Ian.
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45647-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 09:47:10 2010
Return-Path: <java-user-return-45647-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89296 invoked from network); 1 Apr 2010 09:47:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 09:47:10 -0000
Received: (qmail 42013 invoked by uid 500); 1 Apr 2010 09:47:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41950 invoked by uid 500); 1 Apr 2010 09:47:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41942 invoked by uid 99); 1 Apr 2010 09:47:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:47:07 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of sivaits4u@gmail.com designates 72.14.220.155 as permitted sender)
Received: from [72.14.220.155] (HELO fg-out-1718.google.com) (72.14.220.155)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:47:00 +0000
Received: by fg-out-1718.google.com with SMTP id d23so335538fga.5
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 02:46:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=+oDrox9XoeqwU1HF0HFGFXqlbNdltacjZ3yKgMP4CgY=;
        b=Bca0MlAe//sX/XJjZhIimQjk48DHOA5iyHRPzsH+TzRDVk0RcoTh4+JzBLMEXr3Dgx
         HfN3ca151uEtCR32FvfvYMeQOSnsC3Mtm8MKO2ybYJKm0PjvP521XfBATvQRiCEkcmEo
         MYLYI/AFD4jdom98isbmv+fswS4br6Zu5POCs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=MXC7itaiaNC2UXykO3lTWvZk+3vmxET+Qr/KZQR9UjTqXmJ25Xswb3a5sUvyfJNOWV
         Jf8YMF2/DXuSRyFor5YEsHyklg3XyLs8dzuGrVkNQJZusgYiPYYqaJup+0KLknaucPzI
         bf3l99Sdqm9mZ/SWXU9TqOfqwJHcK6WkYfg3Y=
MIME-Version: 1.0
Received: by 10.86.97.3 with HTTP; Thu, 1 Apr 2010 02:46:39 -0700 (PDT)
Date: Thu, 1 Apr 2010 15:16:39 +0530
Received: by 10.86.126.4 with SMTP id y4mr1713639fgc.47.1270115199936; Thu, 01 
	Apr 2010 02:46:39 -0700 (PDT)
Message-ID: <o2n581ce2791004010246u9521210bvf2477d21908805b9@mail.gmail.com>
Subject: indexing an object
From: Bujji <sivaits4u@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163645747650e943048329bde3
X-Virus-Checked: Checked by ClamAV on apache.org

--00163645747650e943048329bde3
Content-Type: text/plain; charset=ISO-8859-1

hi all,

i want to index an object once instead of indexing it by strings seperately
can i have that facility exisitng or any anlyzer is there ?
please help me

Thanks
Bujji

--00163645747650e943048329bde3--

From java-user-return-45648-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 09:58:37 2010
Return-Path: <java-user-return-45648-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91484 invoked from network); 1 Apr 2010 09:58:37 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 09:58:37 -0000
Received: (qmail 55783 invoked by uid 500); 1 Apr 2010 09:58:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55700 invoked by uid 500); 1 Apr 2010 09:58:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55692 invoked by uid 99); 1 Apr 2010 09:58:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:58:34 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 09:58:27 +0000
Received: by bwz22 with SMTP id 22so764770bwz.5
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 02:58:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=1GOpLJNcf4+J8e7uFUB4XA3U+mK03SGBkD+Bu6yRSWo=;
        b=tJzUt/6pBsAMskt6pMg73dV6J/790n7d4zz5J1q53TxonIOYEHuLCtzA9kI9uP+HF+
         kijk+woj6j+KngQNT2i12KrStYVLJ3QGIHQQc956d0aye42rhvoys8hCzDPpyiCh6SNH
         bMNZJZVbkcgraTCOE+fup/SVs95EQdNbJ1JH0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Y8/kmkKoqcKq982KKEUO8LdwnfN/JGkuEJlEKEEhvNoVIxhBiNnl5xwhJikCtFTPzd
         0JZUrK4yv2SYhZxH8QbO66f6RWx5KFewO3Yz4+Ube/2dv0ma5jLafp61Po0GvQSj7vn8
         +kesVkuqFqty4QLBPOzfIGCX7IJH+Y2c7XoQQ=
MIME-Version: 1.0
Received: by 10.204.46.104 with HTTP; Thu, 1 Apr 2010 02:57:47 -0700 (PDT)
In-Reply-To: <o2n581ce2791004010246u9521210bvf2477d21908805b9@mail.gmail.com>
References: <o2n581ce2791004010246u9521210bvf2477d21908805b9@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 1 Apr 2010 10:57:47 +0100
Received: by 10.204.81.80 with SMTP id w16mr1107010bkk.84.1270115887156; Thu, 
	01 Apr 2010 02:58:07 -0700 (PDT)
Message-ID: <i2p8c4e68611004010257h639b8127g6a66fcbe425a19a2@mail.gmail.com>
Subject: Re: indexing an object
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

There is no way to just index an object as such, but there are ways of
creating Fields out of byte arrays or with Readers so you could use
them with serialization or something.

--
Ian.


On Thu, Apr 1, 2010 at 10:46 AM, Bujji <sivaits4u@gmail.com> wrote:
> hi all,
>
> i want to index an object once instead of indexing it by strings seperately
> can i have that facility exisitng or any anlyzer is there ?
> please help me
>
> Thanks
> Bujji
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45649-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 11:43:18 2010
Return-Path: <java-user-return-45649-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12613 invoked from network); 1 Apr 2010 11:43:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 11:43:18 -0000
Received: (qmail 70241 invoked by uid 500); 1 Apr 2010 11:43:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70177 invoked by uid 500); 1 Apr 2010 11:43:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70169 invoked by uid 99); 1 Apr 2010 11:43:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 11:43:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of akaris@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 11:43:08 +0000
Received: by gwaa12 with SMTP id a12so69290gwa.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 04:42:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=P8fGLj6i5tO93nlLm2wZfOqS/bZ7Ggjzt0B4K7FI+Xc=;
        b=xDybHFHndtOnEvvKwJZvmFMTS4qLEXes3+ROGUqcc9chR6Fi5vrFdARqcLH+mb2BmL
         nE+h08Ec0Qg9YJXqQO4eSRJVJQ248AyeTCCoWXN1qBGPFaDxq0/DjQq0+vH5kaKFhXJv
         39DJ0CPzdJrLRLHndvTbzXJIgBfiC46G0sBzI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=EZjKrpO4fWJeUcoYjWr7JD4u11VT26JxtuYuIKuRwfLt8b0E5RJx69XIUu2qJqRpXd
         k59YWKeFa5mUhNn8wD91qMnEsSLNS6Vh/oVBDMoakByUAscjsw2w6Q9LtlCRxSwz3rkl
         tQLcPF+C2slIYNP4isrzC9vfGQ8dQors+WNUc=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Thu, 1 Apr 2010 04:42:24 -0700 (PDT)
In-Reply-To: <4BB46092.3030508@gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<4BB46092.3030508@gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 1 Apr 2010 07:42:24 -0400
Received: by 10.100.22.17 with SMTP id 17mr2342481anv.241.1270122165388; Thu, 
	01 Apr 2010 04:42:45 -0700 (PDT)
Message-ID: <m2u962c93f61004010442va749dc14g7c8bb2a879b0cbef@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f897cc7db74a04832b5c62
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f897cc7db74a04832b5c62
Content-Type: text/plain; charset=ISO-8859-1

@Ken: yeah we thought about it - but we have a HUGE amount of data (sales,
affiliates, etc.) - so pre-calculating everything isn't really an option.
Plus I don't know how we would sort.. let's say I get the totals for
affiliate X, loop totals from day 1 to X (range), sum up, great: I can do
this for all affiliates and have the totals, but how will I sort by that
total?

@Chris: we don't want to switch to a whole new platform - is it possible to
use that DBSight module only? It doesn't seem to be an opensource project so
I can't really consider it.

- Mike
akaris@gmail.com


On Thu, Apr 1, 2010 at 5:00 AM, Chris Lu <chris.lu@gmail.com> wrote:

> Hi, Michel,
>
> This has already been implemented in DBSight. Check it out!
> http://www.dbsight.net
>
> You can get sum, avg for Facet searches. And count is included in Facet
> search directly.
>
> --
> Chris Lu
> -------------------------
> Instant Scalable Full-Text Search On Any Database/Application
> site: http://www.dbsight.net
> demo: http://search.dbsight.com
> Lucene Database Search in 3 minutes:
> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
> DBSight customer, a shopping comparison site, (anonymous per request) got
> 2.6 Million Euro funding!
>
>
>
>
> Michel Nadeau wrote:
>
>> Hi,
>>
>> We're currently in the process of switching many of our screens from MySQL
>> to Lucene because MySQL simply dies because we have too much data and it's
>> becoming too long to generate the stats we need.
>>
>> So here's one MySQL query that we use to find out our Top 10 Affiliates :
>>
>> SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
>> sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY affialiate_id
>> ORDER BY total_sales DESC LIMIT 10;
>>
>> We currently have our "sales" index, containing all sales and all fields -
>> and it's one big index (over 10M records). We could fetch all documents
>> within the date range, loop them and add up the total_sales, but it would
>> be
>> just crazy to do this all the time (we have a high volume of search).
>>
>> We made several tests with Solr (Facets, and even the beta
>> CollapseFields),
>> but nothing is really helping us. We could pre-generate the total_sales
>> for
>> all possible date ranges... but that would be quite crazy too as the date
>> range possibilities quickly become endless.
>>
>> So - is there any known way to efficiently do SUM(), COUNT() (and even
>> AVG()
>> ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't seem
>> to offer what I need either.
>>
>> Thanks for any hints!!!
>>
>> - Mike
>> akaris@gmail.com
>>
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f897cc7db74a04832b5c62--

From java-user-return-45650-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 11:45:41 2010
Return-Path: <java-user-return-45650-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12957 invoked from network); 1 Apr 2010 11:45:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 11:45:41 -0000
Received: (qmail 74031 invoked by uid 500); 1 Apr 2010 11:45:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73992 invoked by uid 500); 1 Apr 2010 11:45:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73984 invoked by uid 99); 1 Apr 2010 11:45:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 11:45:39 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of akaris@gmail.com designates 209.85.210.184 as permitted sender)
Received: from [209.85.210.184] (HELO mail-yx0-f184.google.com) (209.85.210.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 11:45:31 +0000
Received: by yxe14 with SMTP id 14so437410yxe.5
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 04:45:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=H0oYcJnOYu7Rdn1h3Ut8gCqhTaHDun1kk8Cfni2cEhg=;
        b=kWVmiT1NEMfBvHHImvRfbj9uw4Z9Zbh0gJichsQXA+Dp1LIAV6Mol8xrcDW1nq3n1I
         SxIxuOEl27Ul1XHT6aJfhl5usxU5Egt1Grh3P4fZFSqueUuqneVZohp1Nwsjo/CIsNqk
         ktRkqXSNWhmuw5um/wu9RImaT2NZAiXGbZUrk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=duRkmeHkkPLvPSevJf3yIIuJhyPrMfbotVkF2I3MPy4z3/DiChWKLHtT7qB9jq2gvf
         iDZP3B7o2YN2HSXJhuW9HrJkMK3HK1XXh3l7VIV5YtUx91p7/EeeESUIE1a8dqFbiECO
         plwRh48PodQoLVkq9UbPP29Lg6PN0/w6xIkOo=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Thu, 1 Apr 2010 04:44:48 -0700 (PDT)
In-Reply-To: <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 1 Apr 2010 07:44:48 -0400
Received: by 10.100.245.27 with SMTP id s27mr2462165anh.222.1270122308143; 
	Thu, 01 Apr 2010 04:45:08 -0700 (PDT)
Message-ID: <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e68dec16ffe82f04832b64f3
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e68dec16ffe82f04832b64f3
Content-Type: text/plain; charset=ISO-8859-1

Are you planning to be able to sort by these SUMs? A SpanQuery would work
great to get the integers... then you would loop and sum up... but what
about "joining" with your other data and sorting?

- Mike
akaris@gmail.com


On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
<prasen.bea@gmail.com>wrote:

> I too am trying to achieve something.
>
> I am thinking of storing the integer values in  payloads and then
> using spanquery classes to compute the respective SUMs
>
> -Prasen
>
> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> wrote:
> > Hi,
> >
> > We're currently in the process of switching many of our screens from
> MySQL
> > to Lucene because MySQL simply dies because we have too much data and
> it's
> > becoming too long to generate the stats we need.
> >
> > So here's one MySQL query that we use to find out our Top 10 Affiliates :
> >
> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
> > sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY
> affialiate_id
> > ORDER BY total_sales DESC LIMIT 10;
> >
> > We currently have our "sales" index, containing all sales and all fields
> -
> > and it's one big index (over 10M records). We could fetch all documents
> > within the date range, loop them and add up the total_sales, but it would
> be
> > just crazy to do this all the time (we have a high volume of search).
> >
> > We made several tests with Solr (Facets, and even the beta
> CollapseFields),
> > but nothing is really helping us. We could pre-generate the total_sales
> for
> > all possible date ranges... but that would be quite crazy too as the date
> > range possibilities quickly become endless.
> >
> > So - is there any known way to efficiently do SUM(), COUNT() (and even
> AVG()
> > ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't
> seem
> > to offer what I need either.
> >
> > Thanks for any hints!!!
> >
> > - Mike
> > akaris@gmail.com
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e68dec16ffe82f04832b64f3--

From java-user-return-45651-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 12:11:56 2010
Return-Path: <java-user-return-45651-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23474 invoked from network); 1 Apr 2010 12:11:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 12:11:55 -0000
Received: (qmail 43877 invoked by uid 500); 1 Apr 2010 12:11:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43845 invoked by uid 500); 1 Apr 2010 12:11:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43837 invoked by uid 99); 1 Apr 2010 12:11:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 12:11:53 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 12:11:46 +0000
Received: by vws14 with SMTP id 14so561743vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 05:11:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=SovOJ6FzCnMgrdT+YjRT1nhaBzAYUMGj7zjlLat/OB8=;
        b=M/D1evZX15soHWkXSioou2vFrk+UEenO/uTD9WQUSkXdgSPsFZn5L3lz9lISG+d8Qz
         nfS9AvcIC4oJPYKwaTHDV+o2XwJPDP7lKxW0P/oXUVlN+kzvZIG8RtcLBtqsekfYvVXB
         0d5V5XdnKhVm4su0gvMTyY1X+/ifeH1BOsjWw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=RIn2Cf9kTbtzancT1nEWnurYnBWrrV1sG1m5JJ5UObuB2g31wGPyPsQ5SVvuqBqFsT
         yORndfx1L5MwCN8uqWgtBUcgzSAe9XQtUesBg+bU6sxmd5EN6vUG4KD+F+VvNBGRZHpL
         FKHfMu75xsyoAOARSSpaX0xY0F6wAgrti1BGI=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Thu, 1 Apr 2010 05:11:24 -0700 (PDT)
In-Reply-To: <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
Date: Thu, 1 Apr 2010 08:11:24 -0400
Received: by 10.220.126.201 with SMTP id d9mr297272vcs.226.1270123884906; Thu, 
	01 Apr 2010 05:11:24 -0700 (PDT)
Message-ID: <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Not sure what you mean by "joining" in lucene , since conceptually
there is only 1 table ( with many field aka columns ) in lucene. A
representative query would be good to know the use case.

Again didn't get the "sorting" part.  SUM() will return only 1
aggregated value, so what do you want to sort it on ?

-Prasen

On Thu, Apr 1, 2010 at 7:44 AM, Michel Nadeau <akaris@gmail.com> wrote:
> Are you planning to be able to sort by these SUMs? A SpanQuery would work
> great to get the integers... then you would loop and sum up... but what
> about "joining" with your other data and sorting?
>
> - Mike
> akaris@gmail.com
>
>
> On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
> <prasen.bea@gmail.com>wrote:
>
>> I too am trying to achieve something.
>>
>> I am thinking of storing the integer values in =A0payloads and then
>> using spanquery classes to compute the respective SUMs
>>
>> -Prasen
>>
>> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> wrote:
>> > Hi,
>> >
>> > We're currently in the process of switching many of our screens from
>> MySQL
>> > to Lucene because MySQL simply dies because we have too much data and
>> it's
>> > becoming too long to generate the stats we need.
>> >
>> > So here's one MySQL query that we use to find out our Top 10 Affiliate=
s :
>> >
>> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
>> > sale_date>=3D'2010-03-01' AND sale_date<=3D'2010-03-31' GROUP BY
>> affialiate_id
>> > ORDER BY total_sales DESC LIMIT 10;
>> >
>> > We currently have our "sales" index, containing all sales and all fiel=
ds
>> -
>> > and it's one big index (over 10M records). We could fetch all document=
s
>> > within the date range, loop them and add up the total_sales, but it wo=
uld
>> be
>> > just crazy to do this all the time (we have a high volume of search).
>> >
>> > We made several tests with Solr (Facets, and even the beta
>> CollapseFields),
>> > but nothing is really helping us. We could pre-generate the total_sale=
s
>> for
>> > all possible date ranges... but that would be quite crazy too as the d=
ate
>> > range possibilities quickly become endless.
>> >
>> > So - is there any known way to efficiently do SUM(), COUNT() (and even
>> AVG()
>> > ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't
>> seem
>> > to offer what I need either.
>> >
>> > Thanks for any hints!!!
>> >
>> > - Mike
>> > akaris@gmail.com
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45652-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 12:51:51 2010
Return-Path: <java-user-return-45652-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33839 invoked from network); 1 Apr 2010 12:51:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 12:51:51 -0000
Received: (qmail 98510 invoked by uid 500); 1 Apr 2010 12:51:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98485 invoked by uid 500); 1 Apr 2010 12:51:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98477 invoked by uid 99); 1 Apr 2010 12:51:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 12:51:49 +0000
X-ASF-Spam-Status: No, hits=-1.6 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [64.18.3.88] (HELO exprod8og104.obsmtp.com) (64.18.3.88)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 12:51:39 +0000
Received: from source ([208.78.78.2]) by exprod8ob104.postini.com ([64.18.7.12]) with SMTP
	ID DSNKS7SWxTJDDXLVm/OHhUQrnIAFP9TFwrKd@postini.com; Thu, 01 Apr 2010 05:51:19 PDT
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Lucene Challenge - sum, count, avg, etc.
Date: Thu, 1 Apr 2010 08:51:17 -0400
Message-ID: <214FF1B5E37DC84D9968F0F82FBB112508D1AB06@AUGEXCH.ghsinc.com>
In-Reply-To: <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene Challenge - sum, count, avg, etc.
thread-index: AcrRlIVYaEr2TGe0S2GMTC+9gw3twgABJJeQ
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com> <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com> <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
From: "Darren Hartford" <dhartford@ghsinc.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

If you are going to end up either copying or moving all the data to =
lucene (which, when you hook up lucene even to the existing mysql data, =
it will still create it's own copy of the data), you might really want =
to look at other options:

*column oriented databases (analytical databases).  If open source is a =
concern: LucidDB, MonetDB, mysql/InfoBright (GPL/commercial), and I =
think mysql/InfiniDB may be getting into it.  And, you can still use =
your normal SQL tools with better performance for this particular =
scenario.

Search engine is about searching for data....trying to turn it into a =
(financial) analytical tool may get you more trouble particularly if you =
haven't looked at other options. =20

Lucene is great at searching for data, but just because it is awesome in =
one area doesn't mean it would excel in something it wasn't designed for =
;-)

-D


-----Original Message-----
From: prasenjit mukherjee [mailto:prasen.bea@gmail.com]=20
Sent: Thursday, April 01, 2010 8:11 AM
To: java-user@lucene.apache.org
Subject: Re: Lucene Challenge - sum, count, avg, etc.

Not sure what you mean by "joining" in lucene , since conceptually
there is only 1 table ( with many field aka columns ) in lucene. A
representative query would be good to know the use case.

Again didn't get the "sorting" part.  SUM() will return only 1
aggregated value, so what do you want to sort it on ?

-Prasen

On Thu, Apr 1, 2010 at 7:44 AM, Michel Nadeau <akaris@gmail.com> wrote:
> Are you planning to be able to sort by these SUMs? A SpanQuery would =
work
> great to get the integers... then you would loop and sum up... but =
what
> about "joining" with your other data and sorting?
>
> - Mike
> akaris@gmail.com
>
>
> On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
> <prasen.bea@gmail.com>wrote:
>
>> I too am trying to achieve something.
>>
>> I am thinking of storing the integer values in =A0payloads and then
>> using spanquery classes to compute the respective SUMs
>>
>> -Prasen
>>
>> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> =
wrote:
>> > Hi,
>> >
>> > We're currently in the process of switching many of our screens =
from
>> MySQL
>> > to Lucene because MySQL simply dies because we have too much data =
and
>> it's
>> > becoming too long to generate the stats we need.
>> >
>> > So here's one MySQL query that we use to find out our Top 10 =
Affiliates :
>> >
>> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales =
WHERE
>> > sale_date>=3D'2010-03-01' AND sale_date<=3D'2010-03-31' GROUP BY
>> affialiate_id
>> > ORDER BY total_sales DESC LIMIT 10;
>> >
>> > We currently have our "sales" index, containing all sales and all =
fields
>> -
>> > and it's one big index (over 10M records). We could fetch all =
documents
>> > within the date range, loop them and add up the total_sales, but it =
would
>> be
>> > just crazy to do this all the time (we have a high volume of =
search).
>> >
>> > We made several tests with Solr (Facets, and even the beta
>> CollapseFields),
>> > but nothing is really helping us. We could pre-generate the =
total_sales
>> for
>> > all possible date ranges... but that would be quite crazy too as =
the date
>> > range possibilities quickly become endless.
>> >
>> > So - is there any known way to efficiently do SUM(), COUNT() (and =
even
>> AVG()
>> > ) using Lucene/Solr/others? I also checked Bobo Browse but it =
doesn't
>> seem
>> > to offer what I need either.
>> >
>> > Thanks for any hints!!!
>> >
>> > - Mike
>> > akaris@gmail.com
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45653-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 13:02:27 2010
Return-Path: <java-user-return-45653-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36771 invoked from network); 1 Apr 2010 13:02:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 13:02:26 -0000
Received: (qmail 14459 invoked by uid 500); 1 Apr 2010 13:02:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14435 invoked by uid 500); 1 Apr 2010 13:02:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 54761 invoked by uid 99); 1 Apr 2010 12:19:33 -0000
X-ASF-Spam-Status: No, hits=-0.4 required=10.0
	tests=AWL,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Thu, 1 Apr 2010 04:19:07 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270124347984-690625.post@n3.nabble.com>
In-Reply-To: <817123.44413.qm@web24101.mail.ird.yahoo.com>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Hi,
I worked some time ago on a similar system (using Solr) and used the
multiple indices route (the multicore feature in Solr). In our case, the
"same" document could exist in different languages; different localized
versions of the same information (same Solr unique id for each l10n
version). 

This allowed to have the same index structure across locales but different
settings for each (synonyms, stemmers, etc). Maintenance was easier this
way; when refining/updating the settings (say adding synonyms or stemmers
for instance), you may need to reindex and smaller indices allow faster
deployments. It's also "dead-easy" to add a new language (esp. compared to
the one index solution). It also makes replication or partitioning easier.
Overall, IMO, this is a more scalable architecture than the single-index
one.

Users were able to set in which language they were "fluent" (default being
browser locale) so queries would only be performed in those and results
"clustered" per locale (no need to return results that can not be
understood...). Besides, IMO, scoring / ordering documents in different
languages is a bit like comparing apples and oranges.

Finally, query expansion can also be used in the multiple indices case and
might even use automated/guided translation.

In my experience, multiple indices had many advantages over the single index
solution, be them functional or operational. YMMV.
Hope this helps,
Henrib
 
-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p690625.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45654-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 13:15:08 2010
Return-Path: <java-user-return-45654-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47372 invoked from network); 1 Apr 2010 13:15:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 13:15:08 -0000
Received: (qmail 30846 invoked by uid 500); 1 Apr 2010 13:15:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30818 invoked by uid 500); 1 Apr 2010 13:15:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30810 invoked by uid 99); 1 Apr 2010 13:15:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:15:06 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:14:56 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id 450D831511
	for <java-user@lucene.apache.org>; Thu,  1 Apr 2010 15:14:35 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id 31BF0314CC
	for <java-user@lucene.apache.org>; Thu,  1 Apr 2010 15:14:35 +0200 (CEST)
Received: from [IPv6:::1] (dave.dfki.uni-sb.de [134.96.184.220])
	by mail.dfki.de (Postfix) with ESMTP id 198E6310AC
	for <java-user@lucene.apache.org>; Thu,  1 Apr 2010 15:14:35 +0200 (CEST)
Message-Id: <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <1270124347984-690625.post@n3.nabble.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes
Content-Transfer-Encoding: quoted-printable
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Designing a multilingual index
Date: Thu, 1 Apr 2010 15:14:34 +0200
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

How?

paul


Le 01-avr.-10 =E0 14:19, henrib a =E9crit :

> Finally, query expansion can also be used in the multiple indices =20
> case and
> might even use automated/guided translation.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45655-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 13:26:27 2010
Return-Path: <java-user-return-45655-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50887 invoked from network); 1 Apr 2010 13:26:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 13:26:26 -0000
Received: (qmail 52344 invoked by uid 500); 1 Apr 2010 13:26:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52316 invoked by uid 500); 1 Apr 2010 13:26:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52308 invoked by uid 99); 1 Apr 2010 13:26:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:26:24 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:26:17 +0000
Received: by vws14 with SMTP id 14so589126vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 06:25:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=RQclijHpuIXi/LHxAVRT1vxeuFd+/Jofeq4ADodsle8=;
        b=cHF8K4Jtx1iQ+cg623gNXpZ54hyJpXDFb52GlTNzwJNt0qfHF3Ak4u/obKzRtWp5R3
         wJnXguSzwUClNMNEjcsNe0hGO2USjOiQJvV0aeg6AhYDBf3E9ae+mEjGN/FO29g96Eml
         7L+Ws/Zg2Y89+qdGZ0TViVVyfSwT7Ugp0VfRk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=t6fbCmLJViiKCqoEL8BzECvHfxHqiuj1nMQgMJQDt9HEMg+U9dVqekvWL6Hr2OpHvu
         gDxMD7g1EiBPaCwA+lMxtw9irV95WPU7+G9Ba0lmJQfnQfcd+vbw6uEfdRnVHeDk6HqQ
         c6cWHQIxs10JpaUiVqVa9f/1fFS93ts2+YeTk=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Thu, 1 Apr 2010 06:25:56 -0700 (PDT)
In-Reply-To: <214FF1B5E37DC84D9968F0F82FBB112508D1AB06@AUGEXCH.ghsinc.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
	 <214FF1B5E37DC84D9968F0F82FBB112508D1AB06@AUGEXCH.ghsinc.com>
Date: Thu, 1 Apr 2010 09:25:56 -0400
Received: by 10.220.124.220 with SMTP id v28mr327263vcr.219.1270128356513; 
	Thu, 01 Apr 2010 06:25:56 -0700 (PDT)
Message-ID: <s2v500e4a1e1004010625m20de81bdu8d3c0330afe8a959@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

> Lucene is great at searching for data, but just because it is awesome in =
one area doesn't mean it would excel in something it wasn't designed for ;-=
)

I think lucene is probably one of the better data structures for
computing "conditional aggregated stats". Even for straight search
lucene has to iterate over all the matches and compute the score which
is probably much more computation intensive than doing simple
aggregations ( like SUM,COUNT,AVG,MIN,MAX etc. ). Makes sense for a
contrib project.

I have a feeling that lucene will be faster than MySQL for these kind
of conditional aggregation tasks. But would reserve my comment and
would appreciate expert advice on this.

Having said that I think you are right that lucene shouldn't be used
as a general purpose Analytical tool.

-Prasen


On Thu, Apr 1, 2010 at 8:51 AM, Darren Hartford <dhartford@ghsinc.com> wrot=
e:
> If you are going to end up either copying or moving all the data to lucen=
e (which, when you hook up lucene even to the existing mysql data, it will =
still create it's own copy of the data), you might really want to look at o=
ther options:
>
> *column oriented databases (analytical databases). =A0If open source is a=
 concern: LucidDB, MonetDB, mysql/InfoBright (GPL/commercial), and I think =
mysql/InfiniDB may be getting into it. =A0And, you can still use your norma=
l SQL tools with better performance for this particular scenario.
>
> Search engine is about searching for data....trying to turn it into a (fi=
nancial) analytical tool may get you more trouble particularly if you haven=
't looked at other options.
>
> Lucene is great at searching for data, but just because it is awesome in =
one area doesn't mean it would excel in something it wasn't designed for ;-=
)
>
> -D
>
>
> -----Original Message-----
> From: prasenjit mukherjee [mailto:prasen.bea@gmail.com]
> Sent: Thursday, April 01, 2010 8:11 AM
> To: java-user@lucene.apache.org
> Subject: Re: Lucene Challenge - sum, count, avg, etc.
>
> Not sure what you mean by "joining" in lucene , since conceptually
> there is only 1 table ( with many field aka columns ) in lucene. A
> representative query would be good to know the use case.
>
> Again didn't get the "sorting" part. =A0SUM() will return only 1
> aggregated value, so what do you want to sort it on ?
>
> -Prasen
>
> On Thu, Apr 1, 2010 at 7:44 AM, Michel Nadeau <akaris@gmail.com> wrote:
>> Are you planning to be able to sort by these SUMs? A SpanQuery would wor=
k
>> great to get the integers... then you would loop and sum up... but what
>> about "joining" with your other data and sorting?
>>
>> - Mike
>> akaris@gmail.com
>>
>>
>> On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
>> <prasen.bea@gmail.com>wrote:
>>
>>> I too am trying to achieve something.
>>>
>>> I am thinking of storing the integer values in =A0payloads and then
>>> using spanquery classes to compute the respective SUMs
>>>
>>> -Prasen
>>>
>>> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> wrote:
>>> > Hi,
>>> >
>>> > We're currently in the process of switching many of our screens from
>>> MySQL
>>> > to Lucene because MySQL simply dies because we have too much data and
>>> it's
>>> > becoming too long to generate the stats we need.
>>> >
>>> > So here's one MySQL query that we use to find out our Top 10 Affiliat=
es :
>>> >
>>> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHER=
E
>>> > sale_date>=3D'2010-03-01' AND sale_date<=3D'2010-03-31' GROUP BY
>>> affialiate_id
>>> > ORDER BY total_sales DESC LIMIT 10;
>>> >
>>> > We currently have our "sales" index, containing all sales and all fie=
lds
>>> -
>>> > and it's one big index (over 10M records). We could fetch all documen=
ts
>>> > within the date range, loop them and add up the total_sales, but it w=
ould
>>> be
>>> > just crazy to do this all the time (we have a high volume of search).
>>> >
>>> > We made several tests with Solr (Facets, and even the beta
>>> CollapseFields),
>>> > but nothing is really helping us. We could pre-generate the total_sal=
es
>>> for
>>> > all possible date ranges... but that would be quite crazy too as the =
date
>>> > range possibilities quickly become endless.
>>> >
>>> > So - is there any known way to efficiently do SUM(), COUNT() (and eve=
n
>>> AVG()
>>> > ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't
>>> seem
>>> > to offer what I need either.
>>> >
>>> > Thanks for any hints!!!
>>> >
>>> > - Mike
>>> > akaris@gmail.com
>>> >
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45656-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 13:44:17 2010
Return-Path: <java-user-return-45656-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57212 invoked from network); 1 Apr 2010 13:44:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 13:44:16 -0000
Received: (qmail 84101 invoked by uid 500); 1 Apr 2010 13:44:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83996 invoked by uid 500); 1 Apr 2010 13:44:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83988 invoked by uid 99); 1 Apr 2010 13:44:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:44:14 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of willjohnsonsearch@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:44:09 +0000
Received: by gwaa12 with SMTP id a12so127615gwa.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 06:43:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=70OXj/A+N535b+r8XGQXC2XGnmd6aa8C9/7K9KOmpYg=;
        b=C4H8WRyszdqqK7CAgUr7yC2VKOOUhZ2T81CQb5p+P734o1PgY2hdsgA/9mVs/3Nyzg
         xwFTjVkSdgB7FUi/sqb6zKbvQ5cGHjJu/m4hyH2F+WRyVf0MSdG0RXiH0hsILEfFpc38
         1rfFWaZzAKtaZiFQAbB+SSPYZcsENukMO4/BA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VclV2XaoKJmfC4GAxnxJ7ORsYB/7b3vkfED9f0BlT0wlLB+TvURFCkff0nTFt8tgUA
         aNYK173Ru1aI5r7FeV1n3KUxnlYl2i9+mT8O5KqLhkYF8Koc8w7khkFkDqYCntPUveQ4
         XayVIzlpH9hww69JRnWqEopkDVw/lBv/NIq8g=
MIME-Version: 1.0
Received: by 10.150.155.3 with HTTP; Thu, 1 Apr 2010 06:43:48 -0700 (PDT)
In-Reply-To: <s2v500e4a1e1004010625m20de81bdu8d3c0330afe8a959@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
	 <214FF1B5E37DC84D9968F0F82FBB112508D1AB06@AUGEXCH.ghsinc.com>
	 <s2v500e4a1e1004010625m20de81bdu8d3c0330afe8a959@mail.gmail.com>
Date: Thu, 1 Apr 2010 09:43:48 -0400
Received: by 10.150.237.17 with SMTP id k17mr1442574ybh.118.1270129428409; 
	Thu, 01 Apr 2010 06:43:48 -0700 (PDT)
Message-ID: <x2i3922582e1004010643hd2a4f589za40fa9d2b39f9e29@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: Will Johnson <willjohnsonsearch@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd253e6662fbc04832d0d69

--000e0cd253e6662fbc04832d0d69
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Hi Michel,



You can do all of this with Lucene however not with a standard index/query
operators.  At Attivio we have a custom Lucene index structure + custom
query operators that support relational joins across records in an index.  =
You
can write the queries in our standard query language or run actual SQL.  Al=
l
of this is done without pre-computing or flattening records as that prevent=
s
you from having query flexibility at runtime, ie what happens when you want
to know something that isn=92t pre-computed/pre-flattened?



If you look at the demo at the bottom of this page
http://www.attivio.com/active-intelligence/aie-demo.html  you can see how w=
e
index and query against both news articles and baseball statistics from a
relational database.  For example you can do something like this with the
baseball data:



select sum(RBI), teamID, yearID

from master m join batting b

on m."playerID" =3D b.playerID

where b.yearID > '2004'

group by yearID,teamID

order by yearID,teamID



We support min, max, avg and a number of other aggregate functions along
with true full-text search.  Another article you might check out is here:
http://www.attivio.com/blog/55-industry-insights/507-can-a-search-engine-re=
place-a-relational-database.html
.  So far we're getting some pretty good results competing with databases
and data warehouses on raw performance (at customer sites) even without the
full text search capabilities mixed in.  Once you start adding in 'fuzzy'
joins, relevancy, proximity and all the other boolean query logic, we start
to pull ahead even further.



If you want to learn more drop me a line.  We'll be demonstrating all this
stuff (and more) at Enterprise Search Summit (ESS) in New York this coming
May.



- will@attivio.com

--000e0cd253e6662fbc04832d0d69--

From java-user-return-45657-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 13:46:57 2010
Return-Path: <java-user-return-45657-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58148 invoked from network); 1 Apr 2010 13:46:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 13:46:57 -0000
Received: (qmail 87702 invoked by uid 500); 1 Apr 2010 13:46:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87661 invoked by uid 500); 1 Apr 2010 13:46:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87653 invoked by uid 99); 1 Apr 2010 13:46:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:46:55 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of akaris@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 13:46:46 +0000
Received: by ywh38 with SMTP id 38so892435ywh.29
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 06:46:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=8HGDXdCibRSXkzBNx6q5hc86N964Du13ZrMPxNdh6Io=;
        b=xFAREpM76zfSY/F2vlaW2wzJ/hkRBh/GRhWf/9yDm7mHeqwtY5c8n0FUIEh+n2vLoV
         VucZrl3V/V1PJCX428IdcI09hRwPX1R602JAHJZtIT2SUid1pxOuBdNWz1BOWDas2nO5
         B63WT/u0mFrtMbmyK343eVVLt9zI48pFzlNW4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=wF5SjqrUykTDfzwGOANv2bobAF5LsCobJkPENKJZmPJEp0RbrZ0kjK8VdNsI84ALMX
         XcqQd7a9kLmwk/gNmSa8cOV2OLCc/t28G7mUyLtRJbxUeonM2cE+83PfHh5xPbbEXp3p
         1HY8HUMi7oB9tMJoJ7H/81QGdvwR5a3GjPG/8=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Thu, 1 Apr 2010 06:46:04 -0700 (PDT)
In-Reply-To: <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com> 
	<u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com> 
	<k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 1 Apr 2010 09:46:04 -0400
Received: by 10.101.155.13 with SMTP id h13mr2721450ano.14.1270129585665; Thu, 
	01 Apr 2010 06:46:25 -0700 (PDT)
Message-ID: <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e68fcffbc5b7ae04832d1604
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e68fcffbc5b7ae04832d1604
Content-Type: text/plain; charset=ISO-8859-1

Hi,

Here's an example of raw data that would be in my Sales index:

*Affiliate / SaleDate / SaleAmount*
* mike / 2010-03-01 / 10.00
* john / 2010-03-01 / 10.00
* mike / 2010-03-02 / 15.00
* john / 2010-03-02 /  5.00
* mike / 2010-03-03 / 20.00
* john / 2010-03-03 /  1.00
* mike / 2010-03-04 / 10.00
* john / 2010-03-04 / 10.00
* mike / 2010-03-05 / 15.00
* john / 2010-03-05 /  5.00
* mike / 2010-03-06 / 20.00
* john / 2010-03-06 /  1.00

So our 2 affiliates mike and john made 6 sales each between 2010-03-01 and
2010-03-06. My ultimate query should return this for a query between
2010-03-01 and 2010-03-06 :

*Affiliate / TotalSales*
* mike / 90.00
* john / 32.00

So it's exactly like -

SELECT Affiliate, sum(SaleAmount) as TotalSales FROM Sales
  WHERE SaleDate >= '2010-03-01' AND SaleDate <= '2010-03-06'
  GROUP BY Affiliate
  ORDER BY TotalSales DESC;

- Mike
akaris@gmail.com


On Thu, Apr 1, 2010 at 8:11 AM, prasenjit mukherjee <prasen.bea@gmail.com>wrote:

> Not sure what you mean by "joining" in lucene , since conceptually
> there is only 1 table ( with many field aka columns ) in lucene. A
> representative query would be good to know the use case.
>
> Again didn't get the "sorting" part.  SUM() will return only 1
> aggregated value, so what do you want to sort it on ?
>
> -Prasen
>
> On Thu, Apr 1, 2010 at 7:44 AM, Michel Nadeau <akaris@gmail.com> wrote:
> > Are you planning to be able to sort by these SUMs? A SpanQuery would work
> > great to get the integers... then you would loop and sum up... but what
> > about "joining" with your other data and sorting?
> >
> > - Mike
> > akaris@gmail.com
> >
> >
> > On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
> > <prasen.bea@gmail.com>wrote:
> >
> >> I too am trying to achieve something.
> >>
> >> I am thinking of storing the integer values in  payloads and then
> >> using spanquery classes to compute the respective SUMs
> >>
> >> -Prasen
> >>
> >> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> wrote:
> >> > Hi,
> >> >
> >> > We're currently in the process of switching many of our screens from
> >> MySQL
> >> > to Lucene because MySQL simply dies because we have too much data and
> >> it's
> >> > becoming too long to generate the stats we need.
> >> >
> >> > So here's one MySQL query that we use to find out our Top 10
> Affiliates :
> >> >
> >> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
> >> > sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY
> >> affialiate_id
> >> > ORDER BY total_sales DESC LIMIT 10;
> >> >
> >> > We currently have our "sales" index, containing all sales and all
> fields
> >> -
> >> > and it's one big index (over 10M records). We could fetch all
> documents
> >> > within the date range, loop them and add up the total_sales, but it
> would
> >> be
> >> > just crazy to do this all the time (we have a high volume of search).
> >> >
> >> > We made several tests with Solr (Facets, and even the beta
> >> CollapseFields),
> >> > but nothing is really helping us. We could pre-generate the
> total_sales
> >> for
> >> > all possible date ranges... but that would be quite crazy too as the
> date
> >> > range possibilities quickly become endless.
> >> >
> >> > So - is there any known way to efficiently do SUM(), COUNT() (and even
> >> AVG()
> >> > ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't
> >> seem
> >> > to offer what I need either.
> >> >
> >> > Thanks for any hints!!!
> >> >
> >> > - Mike
> >> > akaris@gmail.com
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e68fcffbc5b7ae04832d1604--

From java-user-return-45658-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 14:42:21 2010
Return-Path: <java-user-return-45658-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76910 invoked from network); 1 Apr 2010 14:42:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 14:42:21 -0000
Received: (qmail 65085 invoked by uid 500); 1 Apr 2010 14:42:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65057 invoked by uid 500); 1 Apr 2010 14:42:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65049 invoked by uid 99); 1 Apr 2010 14:42:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 14:42:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [87.248.114.168] (HELO web24104.mail.ird.yahoo.com) (87.248.114.168)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 14:42:12 +0000
Received: (qmail 71746 invoked by uid 60001); 1 Apr 2010 14:41:50 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270132910; bh=PRErmknIbHCOEVsugaEIr7efftFqAjAxblE5GEyvh3E=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=dosYoOOc2aMXGqLpwd7FkiarIUiqs9ZXf6wqdQeblP9V1trqCG/Ay6So62gFD/c7UzJgee1ZwqqtvvmCOgmCjv/UiO2KbXMPkqpzUakGuL3LM3iu9C7c8uGeItWZXsnXi+cdAB9/e3JivxO8ivr1hukFuucRGf0ilwzK8aLXjiA=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=nY1brcKDgUV/4qHBuMM2g5t+CWJqsLRsxtg7tPn4xvz6yOxMP33hQi0qoFzT0m3kKPHrkRfJlO/wKA7EfYfaoI9TG9tMr8u2LM4lXKvsZOykllUMDCenqal/hQ012Ka5dGoiMrg792jHpaMmm1XVLr9K14acnprzuk942QrKqeE=;
Message-ID: <612777.71114.qm@web24104.mail.ird.yahoo.com>
X-YMail-OSG: NcjMXzQVM1lId8DQnBwkukgzbCN0lh2.foN.acEoXQl1FMx
 EVuWTjqwA.68ERytkTvNVQcOcTD00PftqafkjXBRFlLjrWxEE8eb9Tw0oHFo
 Ahs_N6X4dP63DGgN8a.yWBl2EJaNW14L5S35PSqwg3u.0OWigvW18140gLtG
 P6FAlNZQ.kkz.rVbBg8Uza8.xK3XdfRQfcer.enl_zXx8apCJgGjIYKYRoJB
 rSozuSjEEVCuIKO9Roi9CdO1hASdEjU65RSJ38OBgUOmJXCQL_SRD4IHky3h
 y_njxwfksfjRVYodRZNeE8h2Q7MM8d70M
Received: from [84.74.176.141] by web24104.mail.ird.yahoo.com via HTTP; Thu, 01 Apr 2010 14:41:50 GMT
X-Mailer: YahooMailRC/324.3 YahooMailWebService/0.8.100.260964
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com>
Date: Thu, 1 Apr 2010 14:41:50 +0000 (GMT)
From: David Vergnaud <dvergnaud@yahoo.com>
Subject: Re: Designing a multilingual index
To: java-user@lucene.apache.org
In-Reply-To: <1270124347984-690625.post@n3.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Hi,

thx for sharing your experience with us. I'm happy to see that both methods I've thought of are apparently sensible ;-)

However, it might be due to my lack of experience in that domain, but some of your arguments in favor of a multi-index solution seem to me to be also compatible with a single index, or to apply only in a particular situation:

> Maintenance was easier this
> way; when refining/updating the settings (say 
> adding synonyms or stemmers
> for instance), you may need to reindex and smaller 
> indices allow faster deployments. 
If I understand this correctly, that is true if you're indexing distinct collections of documents that are all in the same language, which you know in advance. In that case, you would of course only need to reindex one of these collections into the corresponding index to update it. In my case though, there is no such separation and only upon processing a document can I decide what language it is in. I therefore cannot decide to update only documents in one language, it's a "all or nothing". 

> It's also "dead-easy" to add a new language (esp. compared to
> the one index solution).
I'm not really sure why adding new languages should be complicated in the one-index solution: the languages I can process (i.e. languages for which I have recognition data and the proper analyzer) are listed in a configuration file. Upon recognizing one of these languages, the module stores it in the internal data structure, which is then eventually passed to the indexing module. The latter retrieves the language from the structure and uses it to create the corresponding fields in the index dynamically (e.g. "content-de", "title-en" etc). It's all really automatic. 

> It also makes replication or partitioning easier.
Not sure what you mean by that... 

> Users were able to set in which language they were "fluent" (default being
> browser locale) so queries would only be performed in those and results
> "clustered" per locale (no need to return results that can not be
> understood...). Besides, IMO, scoring / ordering documents in different
> languages is a bit like comparing apples and oranges.

So if I understand correctly you'd always only search in one of the indices? In that case, I can understand why the multi-index solution works better for you. However, assuming most of my users speak at least English *and* one, two or three of the other languages, all searches have to be conducted in all languages. Besides, the various languages are not localized versions of the same content, they may really be anything in any language, depending on the person who wrote them and their mood at the time of writing. Some documents also contains parts in English and parts in German... I'm definitely thinking about making it possible to enable/disable some languages, but parallel searching will definitely be required. 

> Besides, IMO, scoring / ordering documents in different
> languages is a bit like comparing apples and oranges.
Not too sure about that. If for instance you were to search for "firewall" in a German/English index, the word may appear in documents in both languages. Lucene's ranking algorithm is based on the number of tokens and the number of occurrences in fields, and while of course the ratio may vary (e.g. German tends to collate several words into one single entity, resulting in one single token, while English rather uses phrases, resulting in several tokens), I still think, assuming the user can understand both, that it kind of makes sense to rank a short German document where "firewall" occurs 10 times higher than an English document where the same word occurs only 5 times. 

> Finally, query expansion can also be used in the multiple indices case and
> might even use automated/guided translation.
I do agree about that, and I guess query expansion is much easier when dealing with a single, consistent index structure. I'm thinking writing an algorithm to automatically expand a query to all languages might be ok, but I'm worried about the performance of performing such a query if the number of languages grows larger....

One other problem I'm seeing with the multi-index solution is the ranking of documents that are spanned across several indices (multilingual documents). If say my search term matches a document in the English index and the same document in the French index (which would quite often be the case for e.g. proper names), then how do I get about mixing the two rankings? (as I don't want to display the same result twice) I think using a single index would solve that problem, since the ranking would already take all fields (hence all languages into account). 

Cheers,

David

----- Original Message ----
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Sent: Thu, April 1, 2010 2:19:07 PM
Subject: Re: Designing a multilingual index


Hi,
I worked some time ago on a similar system (using Solr) and used the
multiple indices route (the multicore feature in Solr). In our case, the
"same" document could exist in different languages; different localized
versions of the same information (same Solr unique id for each l10n
version). 

This allowed to have the same index structure across locales but different
settings for each (synonyms, stemmers, etc). Maintenance was easier this
way; when refining/updating the settings (say adding synonyms or stemmers
for instance), you may need to reindex and smaller indices allow faster
deployments. It's also "dead-easy" to add a new language (esp. compared to
the one index solution). It also makes replication or partitioning easier.
Overall, IMO, this is a more scalable architecture than the single-index
one.

Users were able to set in which language they were "fluent" (default being
browser locale) so queries would only be performed in those and results
"clustered" per locale (no need to return results that can not be
understood...). Besides, IMO, scoring / ordering documents in different
languages is a bit like comparing apples and oranges.

Finally, query expansion can also be used in the multiple indices case and
might even use automated/guided translation.

In my experience, multiple indices had many advantages over the single index
solution, be them functional or operational. YMMV.
Hope this helps,
Henrib

-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p690625.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45659-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 15:42:46 2010
Return-Path: <java-user-return-45659-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5971 invoked from network); 1 Apr 2010 15:42:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 15:42:46 -0000
Received: (qmail 52022 invoked by uid 500); 1 Apr 2010 15:42:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51986 invoked by uid 500); 1 Apr 2010 15:42:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51978 invoked by uid 99); 1 Apr 2010 15:42:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 15:42:44 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 15:42:37 +0000
Received: by gyf1 with SMTP id 1so497079gyf.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 08:42:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=STcttvx6uhiSQk44wrOK8TJDjX2TT80fgGVimn2HtvM=;
        b=tsH7lSr0Qvx3PGtaCX0Da0RtshVsLkI3hvAzFRQaUcxjTsHB58bAiXkkpul2WN12AC
         2OcP6N3DEkeEuNR3r8jW0Dst2gz9EXZLF1E9dMBkxzxnI14wAxG3zBoFH7dLTsMMeGmP
         kScSKMwZTuLSkImme60E73ee+lx9NVUQZTJ1s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=iyBsu7lMk8EFyV1bkeXIyMjrhfdL8jZicdrkW+50OMgFmvZqzscflua2Cer6deyXvS
         yo3MRsCK3nTX/RypLl5jgYB2+qMPZYkjhGXe8+mT+6K9YmT3pwMJrXofvBkuW9ltIXMo
         r33OjtZPxlFoBUF2/BrVLmn/8XKGFrsTIuspo=
MIME-Version: 1.0
Received: by 10.151.149.19 with HTTP; Thu, 1 Apr 2010 08:42:16 -0700 (PDT)
In-Reply-To: <22b5f5f44f786a63b4f54df70ddfc4d6@localhost>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>
	 <e13f18ad7b10cc633edd32e51d335f7a@localhost>
	 <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com>
	 <22b5f5f44f786a63b4f54df70ddfc4d6@localhost>
Date: Thu, 1 Apr 2010 08:42:16 -0700
Received: by 10.151.93.17 with SMTP id v17mr1596259ybl.101.1270136536294; Thu, 
	01 Apr 2010 08:42:16 -0700 (PDT)
Message-ID: <g2q359a92831004010842y62b285dfs3e8f0a53741bda3e@mail.gmail.com>
Subject: Re: query: order of search
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd3559a0fe7c404832eb5d8
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd3559a0fe7c404832eb5d8
Content-Type: text/plain; charset=ISO-8859-1

Why do you care? By that I mean "what problem are you trying to solve"
(See "The XY problem at http://people.apache.org/~hossman/). The reason
I'm asking here is that very often, when people ask this kind of question
without providing background, they're trying the wrong approach to solve
a problem.

Unless you're asking for theoretical reasons, I almost guarantee that trying
to solve any problem in Lucene by changing the order of the clauses isn't
going to do you much good in the long run, there'll *always* be variant
n+1...

Best
Erick

On Thu, Apr 1, 2010 at 2:21 AM, <suman.holani@zapak.co.in> wrote:

>
> Query I
>
> its written "to do a "search within search", so that the second search is
> constrained by the results of the first query"
> we can use boolean query.
> So doesn't it mean the order of query ll be preserved
>
> give me an simple example of how the docs get searched in lucene.
> 10 docs with 3 fields to b searched
> so ll it search for field1 for all 10 docs..and the result set docs ll b
> then searched for field2....and so far...
> or is it something else..
>
>
>
> thanks,
> Suman
>
> On Thu, 1 Apr 2010 10:05:01 +0100, Ian Lea <ian.lea@gmail.com> wrote:
> >> Query I
> >> Does the order of query play role in searching
> >> example:doc has fields
> >> rollno(pk), name, marks
> >>
> >> Query : marks=90&rollno=2&name=abc
> >>
> >> Query :rollno=2&name=abc&marks=90
> >>
> >> which query processing will be more efficient.
> >> is it work like search doc field by field , it will look for doc having
> >> rollno=2 then from thos will look for name abc and from the selected
> docs
> >> will again look for marks param .
> >
> > I don't think it makes any difference.
> >
> >
> >> Query II
> >>  which  is more faster .
> >> a)  adding one more multivalued field into current index(large)
> >> b)  or creating a separate index for the field and searching it as a
> >> subindex .
> >> My main apprehensions is in regard to large size of index
> >
> > Probably your first option.
> >
> >
> > --
> > Ian.
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd3559a0fe7c404832eb5d8--

From java-user-return-45660-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 15:46:38 2010
Return-Path: <java-user-return-45660-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6636 invoked from network); 1 Apr 2010 15:46:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 15:46:38 -0000
Received: (qmail 55552 invoked by uid 500); 1 Apr 2010 15:46:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55521 invoked by uid 500); 1 Apr 2010 15:46:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55513 invoked by uid 99); 1 Apr 2010 15:46:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 15:46:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gsiasf@gmail.com designates 74.125.83.176 as permitted sender)
Received: from [74.125.83.176] (HELO mail-pv0-f176.google.com) (74.125.83.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 15:46:27 +0000
Received: by pvg7 with SMTP id 7so477621pvg.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 08:46:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:content-type
         :mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        bh=FhFkYgK+ve6ypCYlyapZ08NYPN59SR4TMJrrk5G8C8Q=;
        b=xOJ/ZUQCZKhEF5Jv+gaKTwCvzf7PIE2B8Obp586jH1ePKjhVNjZKIKZg87NlVqnQJe
         tSJgRFg/c7rn7fkdDRM9TdXgn1tdlccyNm7OFAC09zcyOAzBW2dK1vEs2UTA08ANrlQk
         e5uLA0sjDWoowapTTXoH8+m9mWNKH98m/lHJ8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=mGi2VNQg1BcF/Uk0jyMFsRsLiqCYPSPcrL1J0aYVucCLlxOedOfNihlVDp9pS7tD5p
         AVrMisUmjo7mUlEFmKThfyenjzSjjh/di/5wUo8oaBBUH32/IqV1LMyS2LBDSmZXhQ19
         1XUy7Gvznux/1p/sl088RUw0tAFWBE1+pip0o=
Received: by 10.142.1.40 with SMTP id 40mr317708wfa.229.1270136766188;
        Thu, 01 Apr 2010 08:46:06 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id cm22sm8392154ibb.11.2010.04.01.08.46.04
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 08:46:05 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1078)
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
Date: Thu, 1 Apr 2010 11:46:03 -0400
Content-Transfer-Encoding: quoted-printable
Message-Id: <A1FE7DDC-1643-4E1C-B3AB-B1F01B2304C2@apache.org>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org

Have you looked at Solr's StatsComponent?

On Mar 31, 2010, at 9:17 PM, Michel Nadeau wrote:

> Hi,
>=20
> We're currently in the process of switching many of our screens from =
MySQL
> to Lucene because MySQL simply dies because we have too much data and =
it's
> becoming too long to generate the stats we need.
>=20
> So here's one MySQL query that we use to find out our Top 10 =
Affiliates :
>=20
> SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
> sale_date>=3D'2010-03-01' AND sale_date<=3D'2010-03-31' GROUP BY =
affialiate_id
> ORDER BY total_sales DESC LIMIT 10;
>=20
> We currently have our "sales" index, containing all sales and all =
fields -
> and it's one big index (over 10M records). We could fetch all =
documents
> within the date range, loop them and add up the total_sales, but it =
would be
> just crazy to do this all the time (we have a high volume of search).
>=20
> We made several tests with Solr (Facets, and even the beta =
CollapseFields),
> but nothing is really helping us. We could pre-generate the =
total_sales for
> all possible date ranges... but that would be quite crazy too as the =
date
> range possibilities quickly become endless.
>=20
> So - is there any known way to efficiently do SUM(), COUNT() (and even =
AVG()
> ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't =
seem
> to offer what I need either.
>=20
> Thanks for any hints!!!
>=20
> - Mike
> akaris@gmail.com

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem using Solr/Lucene: =
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45661-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 16:58:49 2010
Return-Path: <java-user-return-45661-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26290 invoked from network); 1 Apr 2010 16:58:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 16:58:49 -0000
Received: (qmail 53996 invoked by uid 500); 1 Apr 2010 16:58:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53855 invoked by uid 500); 1 Apr 2010 16:58:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53847 invoked by uid 99); 1 Apr 2010 16:58:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 16:58:47 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 16:58:41 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 9509571C29E; Thu,  1 Apr 2010 09:58:20 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 92BF871C0F4
	for <java-user@lucene.apache.org>; Thu,  1 Apr 2010 09:58:20 -0700 (PDT)
Date: Thu, 1 Apr 2010 09:58:20 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: query: order of search
In-Reply-To: <e13f18ad7b10cc633edd32e51d335f7a@localhost>
Message-ID: <Pine.LNX.4.64.1004010957330.11663@radix.cryptio.net>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
 <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com> <e13f18ad7b10cc633edd32e51d335f7a@localhost>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: Subject: query: order of search
: In-Reply-To: <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>
: References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
:     <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>

http://people.apache.org/~hossman/#threadhijack
Thread Hijacking on Mailing Lists

When starting a new discussion on a mailing list, please do not reply to 
an existing message, instead start a fresh email.  Even if you change the 
subject line of your email, other mail headers still track which thread 
you replied to and your question is "hidden" in that thread and gets less 
attention.   It makes following discussions in the mailing list archives 
particularly difficult.
See Also:  http://en.wikipedia.org/wiki/User:DonDiego/Thread_hijacking


-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45662-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 17:10:59 2010
Return-Path: <java-user-return-45662-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29874 invoked from network); 1 Apr 2010 17:10:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 17:10:59 -0000
Received: (qmail 76187 invoked by uid 500); 1 Apr 2010 17:10:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76057 invoked by uid 500); 1 Apr 2010 17:10:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76049 invoked by uid 99); 1 Apr 2010 17:10:57 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 17:10:57 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of karl.wettin@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 17:10:50 +0000
Received: by bwz22 with SMTP id 22so1094998bwz.5
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 10:10:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=jyaJ2WLn9oZPa6ASwhkNQETW+kTA2/HmqSGR9bZ5ET0=;
        b=CcG2lKwPIhp78zTCsI5QJSn6v8piXb6LkdWQivdD9tiY0Bu+85gXfbFP4u84xvtmtX
         Avx4viK5yP5pw/mz+AFQPRRd4e/w9TMjmlgGr26akKvxtGOIj3COu6/aXP/rEJH/ndlN
         XbYO+MF/GtVVzGzoi284jWsMRKbbvx71D8ND0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=IvvoIAdlP1f6OVeYCOvI2sibmS/J/iml0HGpGoGqNOsSA1w7GRyUjMr68Q8OHh8H8n
         IsMrtE4z1LElI6ngUTSAQr+NvoQN6giKw+H5tliH0DngPde7C/DiEVX7o0Or+/clbiRg
         /6OPUVAGf+/Zfr6x2dkgInd1cTwKak65CtHD4=
Received: by 10.204.33.194 with SMTP id i2mr1726196bkd.140.1270141829048;
        Thu, 01 Apr 2010 10:10:29 -0700 (PDT)
Received: from [10.0.25.6] (95-36-32-119.dsl.alice.nl [95.36.32.119])
        by mx.google.com with ESMTPS id s17sm68665792bkd.16.2010.04.01.10.10.26
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 10:10:27 -0700 (PDT)
Message-Id: <BEAF1AFD-9B0B-4D09-A065-1CA26D5A0A45@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <22b5f5f44f786a63b4f54df70ddfc4d6@localhost>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: query: order of search
Date: Thu, 1 Apr 2010 19:10:25 +0200
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com> <e13f18ad7b10cc633edd32e51d335f7a@localhost> <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com> <22b5f5f44f786a63b4f54df70ddfc4d6@localhost>
X-Mailer: Apple Mail (2.936)


1 apr 2010 kl. 11.21 skrev <suman.holani@zapak.co.in> <suman.holani@zapak.co.in 
 >:

> its written "to do a "search within search", so that the second  
> search is
> constrained by the results of the first query"

If I understand your needs you could while collecting search results  
populate a new filter with all matching documents and use that filter  
during "search within search(results?)".


	karl

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45663-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 17:31:08 2010
Return-Path: <java-user-return-45663-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34127 invoked from network); 1 Apr 2010 17:31:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 17:31:08 -0000
Received: (qmail 8221 invoked by uid 500); 1 Apr 2010 17:31:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8195 invoked by uid 500); 1 Apr 2010 17:31:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8187 invoked by uid 99); 1 Apr 2010 17:31:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 17:31:05 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of chris.lu@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 17:30:59 +0000
Received: by vws14 with SMTP id 14so741323vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 10:30:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type;
        bh=8o+kpDyVSk9GQEFQ+9koQtfUQukdysNkMzvTiIlA9SI=;
        b=wVkx3n6u/4CyHj1lySQz0JhiathdyPamCuF8AzMvi9MfmxmG9oFW1MhDwZMB5w1WYo
         Gw/VzGtOatw91Tci/EtWv+5aVN9fR9QePLPU4xv0CapIAjy86wwiQ82vc3tRHjX+4RDe
         Lv8HsEsDtgs7Luy3boKy2goxrQnfxJyShUJR0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type;
        b=mU1Hlclr2RLxyEEclHmI1CFecgbsSB3B5bz57iD+ijQU2g/zBgr0jNqx2iwS0W5pj8
         6qKPMPjPEYL/JCyyd2qdTbjDRm4S0+BBT4xLK1nvxqAJVRU9Cgl7uOcTDkOQHB33Lb5Y
         ZAjXyG71Adi25yaRimjsHioL7Wtnb9uYvw+no=
Received: by 10.220.122.133 with SMTP id l5mr581104vcr.239.1270143038952;
        Thu, 01 Apr 2010 10:30:38 -0700 (PDT)
Received: from [10.1.1.129] (hq.compositesw.com [209.237.61.131])
        by mx.google.com with ESMTPS id 33sm171735654vws.10.2010.04.01.10.30.37
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 10:30:38 -0700 (PDT)
Message-ID: <4BB4D836.1040603@gmail.com>
Date: Thu, 01 Apr 2010 10:30:30 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.24 (Windows/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene Challenge - sum, count, avg, etc.
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 	<4BB46092.3030508@gmail.com> <m2u962c93f61004010442va749dc14g7c8bb2a879b0cbef@mail.gmail.com>
In-Reply-To: <m2u962c93f61004010442va749dc14g7c8bb2a879b0cbef@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------010909010606090602060002"

--------------010909010606090602060002
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hi, Michel,

You can use DBSight free version to test it out.
However, it's a whole solution since you will need to configure it 
first. Like specifying which column you want to do the counting before 
the actual search.

BTW: DBSight also support MIN and MAX, in addition to SUM,AVG.

--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!



Michel Nadeau wrote:
> @Ken: yeah we thought about it - but we have a HUGE amount of data (sales,
> affiliates, etc.) - so pre-calculating everything isn't really an option.
> Plus I don't know how we would sort.. let's say I get the totals for
> affiliate X, loop totals from day 1 to X (range), sum up, great: I can do
> this for all affiliates and have the totals, but how will I sort by that
> total?
>
> @Chris: we don't want to switch to a whole new platform - is it possible to
> use that DBSight module only? It doesn't seem to be an opensource project so
> I can't really consider it.
>
> - Mike
> akaris@gmail.com
>
>
> On Thu, Apr 1, 2010 at 5:00 AM, Chris Lu <chris.lu@gmail.com> wrote:
>
>   
>> Hi, Michel,
>>
>> This has already been implemented in DBSight. Check it out!
>> http://www.dbsight.net
>>
>> You can get sum, avg for Facet searches. And count is included in Facet
>> search directly.
>>
>> --
>> Chris Lu
>> -------------------------
>> Instant Scalable Full-Text Search On Any Database/Application
>> site: http://www.dbsight.net
>> demo: http://search.dbsight.com
>> Lucene Database Search in 3 minutes:
>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>> DBSight customer, a shopping comparison site, (anonymous per request) got
>> 2.6 Million Euro funding!
>>
>>
>>
>>
>> Michel Nadeau wrote:
>>
>>     
>>> Hi,
>>>
>>> We're currently in the process of switching many of our screens from MySQL
>>> to Lucene because MySQL simply dies because we have too much data and it's
>>> becoming too long to generate the stats we need.
>>>
>>> So here's one MySQL query that we use to find out our Top 10 Affiliates :
>>>
>>> SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WHERE
>>> sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY affialiate_id
>>> ORDER BY total_sales DESC LIMIT 10;
>>>
>>> We currently have our "sales" index, containing all sales and all fields -
>>> and it's one big index (over 10M records). We could fetch all documents
>>> within the date range, loop them and add up the total_sales, but it would
>>> be
>>> just crazy to do this all the time (we have a high volume of search).
>>>
>>> We made several tests with Solr (Facets, and even the beta
>>> CollapseFields),
>>> but nothing is really helping us. We could pre-generate the total_sales
>>> for
>>> all possible date ranges... but that would be quite crazy too as the date
>>> range possibilities quickly become endless.
>>>
>>> So - is there any known way to efficiently do SUM(), COUNT() (and even
>>> AVG()
>>> ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn't seem
>>> to offer what I need either.
>>>
>>> Thanks for any hints!!!
>>>
>>> - Mike
>>> akaris@gmail.com
>>>
>>>
>>>
>>>       
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>   

--------------010909010606090602060002--

From java-user-return-45664-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 18:11:41 2010
Return-Path: <java-user-return-45664-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44845 invoked from network); 1 Apr 2010 18:11:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 18:11:41 -0000
Received: (qmail 85089 invoked by uid 500); 1 Apr 2010 18:11:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85061 invoked by uid 500); 1 Apr 2010 18:11:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85053 invoked by uid 99); 1 Apr 2010 18:11:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 18:11:38 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 18:11:30 +0000
Received: by vws14 with SMTP id 14so764349vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 11:11:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=Yn+PmhJ1cXnOvvjbcFxlXwoqwDjEk6Vv2ryjCzrJ0lw=;
        b=agq+GNNzKnWnw0faGPauZ0EGtSNxNjl5Je2NxsZ7eNmJGk/CaFTjpCF7ci3SHukvGZ
         7wXPGXGTFelzlsOMt6ySfM3Kou9d7Jh7Ovt6d348qQHj75UPzx2MC97muyd7fG8xFp95
         1WfHo+kbX3RFzlqkNLcRSadClVSGTqCw3PXd0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=gK47oTN8isS/jitkAXh+MPDCqXxeb4QTD8Ty55OJxsklc2lEo5rjJLsimH3gCBuVer
         t9MSyvxMXN8TRLijG7jjodz9XDsvfU+fOwB8PyfYibkoKQZZuZTI5d6vUNfoeWObTKgn
         Q105m2mra+h8cuqA92uck/qauSnSdcULwrsa0=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Thu, 1 Apr 2010 11:11:09 -0700 (PDT)
In-Reply-To: <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
	 <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>
Date: Thu, 1 Apr 2010 23:41:09 +0530
Received: by 10.220.121.145 with SMTP id h17mr644131vcr.54.1270145469525; Thu, 
	01 Apr 2010 11:11:09 -0700 (PDT)
Message-ID: <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

If the number of documents ( in this case "Affiliates" )  aren't huge,
sorting can probably be done as a post-process.

Still dont see any need of joins here.


On Thu, Apr 1, 2010 at 7:16 PM, Michel Nadeau <akaris@gmail.com> wrote:
> Hi,
>
> Here's an example of raw data that would be in my Sales index:
>
> *Affiliate / SaleDate / SaleAmount*
> * mike / 2010-03-01 / 10.00
> * john / 2010-03-01 / 10.00
> * mike / 2010-03-02 / 15.00
> * john / 2010-03-02 / =A05.00
> * mike / 2010-03-03 / 20.00
> * john / 2010-03-03 / =A01.00
> * mike / 2010-03-04 / 10.00
> * john / 2010-03-04 / 10.00
> * mike / 2010-03-05 / 15.00
> * john / 2010-03-05 / =A05.00
> * mike / 2010-03-06 / 20.00
> * john / 2010-03-06 / =A01.00
>
> So our 2 affiliates mike and john made 6 sales each between 2010-03-01 an=
d
> 2010-03-06. My ultimate query should return this for a query between
> 2010-03-01 and 2010-03-06 :
>
> *Affiliate / TotalSales*
> * mike / 90.00
> * john / 32.00
>
> So it's exactly like -
>
> SELECT Affiliate, sum(SaleAmount) as TotalSales FROM Sales
> =A0WHERE SaleDate >=3D '2010-03-01' AND SaleDate <=3D '2010-03-06'
> =A0GROUP BY Affiliate
> =A0ORDER BY TotalSales DESC;
>
> - Mike
> akaris@gmail.com
>
>
> On Thu, Apr 1, 2010 at 8:11 AM, prasenjit mukherjee <prasen.bea@gmail.com=
>wrote:
>
>> Not sure what you mean by "joining" in lucene , since conceptually
>> there is only 1 table ( with many field aka columns ) in lucene. A
>> representative query would be good to know the use case.
>>
>> Again didn't get the "sorting" part. =A0SUM() will return only 1
>> aggregated value, so what do you want to sort it on ?
>>
>> -Prasen
>>
>> On Thu, Apr 1, 2010 at 7:44 AM, Michel Nadeau <akaris@gmail.com> wrote:
>> > Are you planning to be able to sort by these SUMs? A SpanQuery would w=
ork
>> > great to get the integers... then you would loop and sum up... but wha=
t
>> > about "joining" with your other data and sorting?
>> >
>> > - Mike
>> > akaris@gmail.com
>> >
>> >
>> > On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
>> > <prasen.bea@gmail.com>wrote:
>> >
>> >> I too am trying to achieve something.
>> >>
>> >> I am thinking of storing the integer values in =A0payloads and then
>> >> using spanquery classes to compute the respective SUMs
>> >>
>> >> -Prasen
>> >>
>> >> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com> wrot=
e:
>> >> > Hi,
>> >> >
>> >> > We're currently in the process of switching many of our screens fro=
m
>> >> MySQL
>> >> > to Lucene because MySQL simply dies because we have too much data a=
nd
>> >> it's
>> >> > becoming too long to generate the stats we need.
>> >> >
>> >> > So here's one MySQL query that we use to find out our Top 10
>> Affiliates :
>> >> >
>> >> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales WH=
ERE
>> >> > sale_date>=3D'2010-03-01' AND sale_date<=3D'2010-03-31' GROUP BY
>> >> affialiate_id
>> >> > ORDER BY total_sales DESC LIMIT 10;
>> >> >
>> >> > We currently have our "sales" index, containing all sales and all
>> fields
>> >> -
>> >> > and it's one big index (over 10M records). We could fetch all
>> documents
>> >> > within the date range, loop them and add up the total_sales, but it
>> would
>> >> be
>> >> > just crazy to do this all the time (we have a high volume of search=
).
>> >> >
>> >> > We made several tests with Solr (Facets, and even the beta
>> >> CollapseFields),
>> >> > but nothing is really helping us. We could pre-generate the
>> total_sales
>> >> for
>> >> > all possible date ranges... but that would be quite crazy too as th=
e
>> date
>> >> > range possibilities quickly become endless.
>> >> >
>> >> > So - is there any known way to efficiently do SUM(), COUNT() (and e=
ven
>> >> AVG()
>> >> > ) using Lucene/Solr/others? I also checked Bobo Browse but it doesn=
't
>> >> seem
>> >> > to offer what I need either.
>> >> >
>> >> > Thanks for any hints!!!
>> >> >
>> >> > - Mike
>> >> > akaris@gmail.com
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45665-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 18:18:45 2010
Return-Path: <java-user-return-45665-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46255 invoked from network); 1 Apr 2010 18:18:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 18:18:45 -0000
Received: (qmail 95498 invoked by uid 500); 1 Apr 2010 18:18:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95369 invoked by uid 500); 1 Apr 2010 18:18:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95360 invoked by uid 99); 1 Apr 2010 18:18:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 18:18:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of akaris@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 18:18:36 +0000
Received: by gyf1 with SMTP id 1so557878gyf.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 11:18:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=KdChI2kNmvYSQ59go2Ofe7zPSZ/w6FgNsNsCwxbje0I=;
        b=cw3GL016eFEtspipMnTbcFHSdMaTTzoel4Q3oKoa5u81y/nrfxedZ+3UUfzqI7gNbx
         oPqAQmumBpmF04sW+5sd0ZwfEJbAIajv/+8E+I/d4WFS4qTEGiPxfjG2k19YjoTkv06x
         XzpEMC7OoZ158xO0Tw2xdBB5lQLMFC/JYTl+I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=SlXawppANR3WgV0Ai3aOf73Z+cvg0VbwP4xmvMXknqrC3EVV9BU6H0ny5Kml7ioy6G
         3JAOxRI3Vl9BVuJINfREcF11at+t6nQpjtdRrXW87WtU9Qz/Sn+C3nj2pYnF4gZASAxZ
         BT7HSzojooya9Lnmes6AxAaCnQ7OQUIT7ORpA=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Thu, 1 Apr 2010 11:17:52 -0700 (PDT)
In-Reply-To: <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com> 
	<u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com> 
	<k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com> 
	<p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com> 
	<v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 1 Apr 2010 14:17:52 -0400
Received: by 10.100.243.36 with SMTP id q36mr2655215anh.68.1270145894805; Thu, 
	01 Apr 2010 11:18:14 -0700 (PDT)
Message-ID: <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c5c2a4df7aea048330e268

--001636c5c2a4df7aea048330e268
Content-Type: text/plain; charset=ISO-8859-1

Well that's my problem: we have a lot of records of all types (afiiliates,
sales) so looping tons of records each time isn't possible.

- Mike
akaris@gmail.com


On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee <prasen.bea@gmail.com>wrote:

> If the number of documents ( in this case "Affiliates" )  aren't huge,
> sorting can probably be done as a post-process.
>
> Still dont see any need of joins here.
>
>
> On Thu, Apr 1, 2010 at 7:16 PM, Michel Nadeau <akaris@gmail.com> wrote:
> > Hi,
> >
> > Here's an example of raw data that would be in my Sales index:
> >
> > *Affiliate / SaleDate / SaleAmount*
> > * mike / 2010-03-01 / 10.00
> > * john / 2010-03-01 / 10.00
> > * mike / 2010-03-02 / 15.00
> > * john / 2010-03-02 /  5.00
> > * mike / 2010-03-03 / 20.00
> > * john / 2010-03-03 /  1.00
> > * mike / 2010-03-04 / 10.00
> > * john / 2010-03-04 / 10.00
> > * mike / 2010-03-05 / 15.00
> > * john / 2010-03-05 /  5.00
> > * mike / 2010-03-06 / 20.00
> > * john / 2010-03-06 /  1.00
> >
> > So our 2 affiliates mike and john made 6 sales each between 2010-03-01
> and
> > 2010-03-06. My ultimate query should return this for a query between
> > 2010-03-01 and 2010-03-06 :
> >
> > *Affiliate / TotalSales*
> > * mike / 90.00
> > * john / 32.00
> >
> > So it's exactly like -
> >
> > SELECT Affiliate, sum(SaleAmount) as TotalSales FROM Sales
> >  WHERE SaleDate >= '2010-03-01' AND SaleDate <= '2010-03-06'
> >  GROUP BY Affiliate
> >  ORDER BY TotalSales DESC;
> >
> > - Mike
> > akaris@gmail.com
> >
> >
> > On Thu, Apr 1, 2010 at 8:11 AM, prasenjit mukherjee <
> prasen.bea@gmail.com>wrote:
> >
> >> Not sure what you mean by "joining" in lucene , since conceptually
> >> there is only 1 table ( with many field aka columns ) in lucene. A
> >> representative query would be good to know the use case.
> >>
> >> Again didn't get the "sorting" part.  SUM() will return only 1
> >> aggregated value, so what do you want to sort it on ?
> >>
> >> -Prasen
> >>
> >> On Thu, Apr 1, 2010 at 7:44 AM, Michel Nadeau <akaris@gmail.com> wrote:
> >> > Are you planning to be able to sort by these SUMs? A SpanQuery would
> work
> >> > great to get the integers... then you would loop and sum up... but
> what
> >> > about "joining" with your other data and sorting?
> >> >
> >> > - Mike
> >> > akaris@gmail.com
> >> >
> >> >
> >> > On Wed, Mar 31, 2010 at 9:23 PM, prasenjit mukherjee
> >> > <prasen.bea@gmail.com>wrote:
> >> >
> >> >> I too am trying to achieve something.
> >> >>
> >> >> I am thinking of storing the integer values in  payloads and then
> >> >> using spanquery classes to compute the respective SUMs
> >> >>
> >> >> -Prasen
> >> >>
> >> >> On Thu, Apr 1, 2010 at 6:47 AM, Michel Nadeau <akaris@gmail.com>
> wrote:
> >> >> > Hi,
> >> >> >
> >> >> > We're currently in the process of switching many of our screens
> from
> >> >> MySQL
> >> >> > to Lucene because MySQL simply dies because we have too much data
> and
> >> >> it's
> >> >> > becoming too long to generate the stats we need.
> >> >> >
> >> >> > So here's one MySQL query that we use to find out our Top 10
> >> Affiliates :
> >> >> >
> >> >> > SELECT SUM(sale_amount) AS total_sales, affialiate_id FROM sales
> WHERE
> >> >> > sale_date>='2010-03-01' AND sale_date<='2010-03-31' GROUP BY
> >> >> affialiate_id
> >> >> > ORDER BY total_sales DESC LIMIT 10;
> >> >> >
> >> >> > We currently have our "sales" index, containing all sales and all
> >> fields
> >> >> -
> >> >> > and it's one big index (over 10M records). We could fetch all
> >> documents
> >> >> > within the date range, loop them and add up the total_sales, but it
> >> would
> >> >> be
> >> >> > just crazy to do this all the time (we have a high volume of
> search).
> >> >> >
> >> >> > We made several tests with Solr (Facets, and even the beta
> >> >> CollapseFields),
> >> >> > but nothing is really helping us. We could pre-generate the
> >> total_sales
> >> >> for
> >> >> > all possible date ranges... but that would be quite crazy too as
> the
> >> date
> >> >> > range possibilities quickly become endless.
> >> >> >
> >> >> > So - is there any known way to efficiently do SUM(), COUNT() (and
> even
> >> >> AVG()
> >> >> > ) using Lucene/Solr/others? I also checked Bobo Browse but it
> doesn't
> >> >> seem
> >> >> > to offer what I need either.
> >> >> >
> >> >> > Thanks for any hints!!!
> >> >> >
> >> >> > - Mike
> >> >> > akaris@gmail.com
> >> >> >
> >> >>
> >> >> ---------------------------------------------------------------------
> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >>
> >> >>
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636c5c2a4df7aea048330e268--

From java-user-return-45666-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 18:33:47 2010
Return-Path: <java-user-return-45666-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56847 invoked from network); 1 Apr 2010 18:33:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 18:33:47 -0000
Received: (qmail 18847 invoked by uid 500); 1 Apr 2010 18:33:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18818 invoked by uid 500); 1 Apr 2010 18:33:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18809 invoked by uid 99); 1 Apr 2010 18:33:45 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 18:33:44 +0000
X-ASF-Spam-Status: No, hits=0.3 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 18:33:38 +0000
Received: by vws14 with SMTP id 14so776523vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 11:33:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=Ii5hSQabWJGtCrN5rdFyZreBbJu6qblPX0S69/5yEOg=;
        b=t4rhxcyyQBDEKBHxnTSPYvfiWeVO0Rweu3C0UwWBjknbWWJp0/etYWtGRM1TfnKBW+
         sNLpjxTS0JlP68IYEpXMO4n33XKXr1Jh3K0/p3B8JRa6WJ6AKardmQzhluI8swdFlHsi
         gGr+CN5jzYSsnQSpcA8SAqzXos9RVqAfrfMCk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=tCy3OfbJBhXCkIHMCf1nyJlBY+pPbGdUvgIKqShbOltH70QyWX0vl733IQsndWvRYK
         SBh2DDC9OHFVzH4LfaVax0P07FmGUKJOBPCQF8m6XZ+AosENdQ5QBL/ldCwgsuZVUjGS
         zIj/DeRcYX+GFOgU4DDc/4OhYZ75Wl7yi/mJ0=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Thu, 1 Apr 2010 11:33:17 -0700 (PDT)
In-Reply-To: <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
	 <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>
	 <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>
	 <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com>
Date: Fri, 2 Apr 2010 00:03:17 +0530
Received: by 10.220.127.34 with SMTP id e34mr641486vcs.149.1270146797838; Thu, 
	01 Apr 2010 11:33:17 -0700 (PDT)
Message-ID: <u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

This looks like a use case more suited  for Pig ( over Hadoop ).

It could be difficult for lucene to do sort and sum simultaneously as
sorting itself depends upon summed value.

On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com> wrote:
> Well that's my problem: we have a lot of records of all types (afiiliates,
> sales) so looping tons of records each time isn't possible.
>
> - Mike
> akaris@gmail.com
>
>
> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee <prasen.bea@gmail.com>wrote:
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45667-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 19:13:44 2010
Return-Path: <java-user-return-45667-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73494 invoked from network); 1 Apr 2010 19:13:44 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 19:13:44 -0000
Received: (qmail 70981 invoked by uid 500); 1 Apr 2010 19:13:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70951 invoked by uid 500); 1 Apr 2010 19:13:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70939 invoked by uid 99); 1 Apr 2010 19:13:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:13:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rohit.dholakia@gmail.com designates 209.85.210.200 as permitted sender)
Received: from [209.85.210.200] (HELO mail-yx0-f200.google.com) (209.85.210.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:13:34 +0000
Received: by yxe38 with SMTP id 38so622622yxe.22
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 12:13:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=Wsmw4nBIUfnqLPRHdZLin5xB5TE19ov+b6pfAmWXWNU=;
        b=AIm74aLJXnZ2JTL+glpbtrNegE9E7PURXp2unuudtZ84Xmesmo6UDmQUf02vCaUOKG
         04gtYPmAhW8efrqkx0PPQYqvvpVEGIpVfFbwkcJ3MIEE+BEXnFOWFMd/f2kKYLxqr5Do
         tW80a1bgzoN2LXVmnMawLSxCV5+0WRniHZHK0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=jw2SYk9N9w4czM4f+lYnC8CVKfOpfYPTau0QQcg5GDZHg8QsnRfKRPuFdxfP5GyA0i
         Oi1ztAbXpli0k75TZ1hdFRa2iBebejjJF7kPDo1bEosUGdPHKV4A35iv6qBZGLka5w3y
         bP3wRIOYsQjjlsYYPGeZmEg9VAfCsGKjZEu6I=
MIME-Version: 1.0
Received: by 10.100.253.15 with HTTP; Thu, 1 Apr 2010 12:13:13 -0700 (PDT)
Date: Fri, 2 Apr 2010 00:43:13 +0530
Received: by 10.101.176.6 with SMTP id d6mr3460989anp.155.1270149193430; Thu, 
	01 Apr 2010 12:13:13 -0700 (PDT)
Message-ID: <u2hf58d2e8c1004011213q9fb76144idaed74e7d65b9f7f@mail.gmail.com>
Subject: Articles not found
From: rohit dholakia <rohit.dholakia@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c928c07c7911048331a7b5
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c928c07c7911048331a7b5
Content-Type: text/plain; charset=ISO-8859-1

Hi,

   I am trying to access the articles in the resources part of the lucene
wiki but all of them say "Page not found" . Why is that? Are all the
articles hosted at another page now ?

Rohit

--001636c928c07c7911048331a7b5--

From java-user-return-45668-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 19:17:22 2010
Return-Path: <java-user-return-45668-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75601 invoked from network); 1 Apr 2010 19:17:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 19:17:22 -0000
Received: (qmail 75534 invoked by uid 500); 1 Apr 2010 19:17:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75501 invoked by uid 500); 1 Apr 2010 19:17:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75493 invoked by uid 99); 1 Apr 2010 19:17:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:17:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rohit.dholakia@gmail.com designates 209.85.210.200 as permitted sender)
Received: from [209.85.210.200] (HELO mail-yx0-f200.google.com) (209.85.210.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:17:14 +0000
Received: by yxe38 with SMTP id 38so624129yxe.22
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 12:16:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=XNFHf2navU9C8ISQgOAFzeL7Z+mi5OizYCtQtg3obvg=;
        b=KBdorFwv1WgH73OVOctnIX4XpXE5KReBjrEIbXz0jVC66bbf5FACndpATvJOJl8Hf5
         IKulXN8/5pyjayQBgOWc3nrvjRFKRmZFWn2B8DSMVTCErXrvJZ3TbfPtKyXmqSLdz46S
         7p8X+bIf33w5XKIcmUwKpF99yDc5SYswICnEM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=yH2AVzP9izM8slvwN7cIa5qmLxek6SmJvAF3LLB57ovziPLiJNZjDxspP2YSfodBSd
         xe9jCmNTepUHKP+FRl7zVLxbTpPtSuTk0vxmDqO55fFGn6eBr+NirgtaPEgQBvSXl/lP
         5NtWOOdYWqtW9LR9MIn+NI4DlLOY2QsSvawy0=
MIME-Version: 1.0
Received: by 10.100.253.15 with HTTP; Thu, 1 Apr 2010 12:16:52 -0700 (PDT)
In-Reply-To: <u2hf58d2e8c1004011213q9fb76144idaed74e7d65b9f7f@mail.gmail.com>
References: <u2hf58d2e8c1004011213q9fb76144idaed74e7d65b9f7f@mail.gmail.com>
Date: Fri, 2 Apr 2010 00:46:52 +0530
Received: by 10.101.171.15 with SMTP id y15mr3995118ano.4.1270149412728; Thu, 
	01 Apr 2010 12:16:52 -0700 (PDT)
Message-ID: <q2if58d2e8c1004011216v71cd73ecz951e58f4730b7e7f@mail.gmail.com>
Subject: Re: Articles not found
From: rohit dholakia <rohit.dholakia@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c5c1928ebaa9048331b463

--001636c5c1928ebaa9048331b463
Content-Type: text/plain; charset=ISO-8859-1

 Hey,

          I found them by googling and searching within the website but it
will be better to update the links in that wiki .

On Fri, Apr 2, 2010 at 12:43 AM, rohit dholakia <rohit.dholakia@gmail.com>wrote:

> Hi,
>
>    I am trying to access the articles in the resources part of the lucene
> wiki but all of them say "Page not found" . Why is that? Are all the
> articles hosted at another page now ?
>
> Rohit
>

--001636c5c1928ebaa9048331b463--

From java-user-return-45669-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 19:25:18 2010
Return-Path: <java-user-return-45669-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77049 invoked from network); 1 Apr 2010 19:25:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 19:25:18 -0000
Received: (qmail 88832 invoked by uid 500); 1 Apr 2010 19:25:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88773 invoked by uid 500); 1 Apr 2010 19:25:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 88765 invoked by uid 99); 1 Apr 2010 19:25:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:25:16 +0000
X-ASF-Spam-Status: No, hits=2.3 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of chris.lu@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:25:10 +0000
Received: by vws14 with SMTP id 14so807188vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 12:24:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type;
        bh=E8StXXwZLKe+3BofVEXxmUMKkJ0hrGePwBDumu5xDDk=;
        b=Dsu+L1oPpDoCfg5PgBFEdphMeCs/WbS5i04Y1BoGgWIcvVtq7Zk00Tus4romSYh9bG
         IwacZzx/pPoI6OsKTrfgbg4akn2VjqPr8jST3frn8i1mC4oeLHnRmeV0s3g6IkqoES0K
         oQviEkMyY7JPrkRuG2S11nPzO3Y8xuzkSoAo0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type;
        b=pHKALlN01tkHyj9Zhzu7s9m/bJPhU1Rd50neaGofH1Nmtxu5cmXgBFRxTIUvQ4dpNC
         9LDVDbP9VagIlUipl5bkKNPwEZV56T6U+RYzdQsbeA4w0qBoa1ly/5jIVxLk1gk3GeCQ
         0rUZ5vyC8p+b62Uek8I6ALQEUWUwKyZB7f/nQ=
Received: by 10.220.126.197 with SMTP id d5mr700201vcs.121.1270149888630;
        Thu, 01 Apr 2010 12:24:48 -0700 (PDT)
Received: from [10.1.1.129] (hq.compositesw.com [209.237.61.131])
        by mx.google.com with ESMTPS id 29sm173627094vws.5.2010.04.01.12.24.47
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 12:24:47 -0700 (PDT)
Message-ID: <4BB4F2F5.4090404@gmail.com>
Date: Thu, 01 Apr 2010 12:24:37 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.24 (Windows/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene Challenge - sum, count, avg, etc.
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>	 <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>	 <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>	 <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com> <u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com>
In-Reply-To: <u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------010408010604090003040700"

--------------010408010604090003040700
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

No need for Hadoop. It's even more slower. Lucene can do it easily.

This has been implemented in DBSight.
The implementation is very similar to Facet search. Just need a way to 
load the field quickly, like put it in memory or some data structure, 
and count the sum/min/max during searching.

--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!


prasenjit mukherjee wrote:
> This looks like a use case more suited  for Pig ( over Hadoop ).
>
> It could be difficult for lucene to do sort and sum simultaneously as
> sorting itself depends upon summed value.
>
> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com> wrote:
>   
>> Well that's my problem: we have a lot of records of all types (afiiliates,
>> sales) so looping tons of records each time isn't possible.
>>
>> - Mike
>> akaris@gmail.com
>>
>>
>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee <prasen.bea@gmail.com>wrote:
>>
>>     
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   

--------------010408010604090003040700--

From java-user-return-45670-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 19:32:27 2010
Return-Path: <java-user-return-45670-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78089 invoked from network); 1 Apr 2010 19:32:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 19:32:27 -0000
Received: (qmail 5944 invoked by uid 500); 1 Apr 2010 19:32:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5911 invoked by uid 500); 1 Apr 2010 19:32:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5901 invoked by uid 99); 1 Apr 2010 19:32:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 19:32:25 +0000
X-ASF-Spam-Status: No, hits=-0.6 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [72.167.82.86] (HELO p3plsmtpa01-06.prod.phx3.secureserver.net) (72.167.82.86)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 19:32:19 +0000
Received: (qmail 23004 invoked from network); 1 Apr 2010 19:31:57 -0000
Received: from unknown (81.219.54.251)
  by p3plsmtpa01-06.prod.phx3.secureserver.net (72.167.82.86) with ESMTP; 01 Apr 2010 19:31:56 -0000
Message-ID: <4BB4F4A2.2070009@getopt.org>
Date: Thu, 01 Apr 2010 21:31:46 +0200
From: Andrzej Bialecki <ab@getopt.org>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.9) Gecko/20100317 Thunderbird/3.0.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: [ANN] Luke - The Lucene Index Toolbox - 1.0.1 release
X-Enigmail-Version: 1.0.1
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

Hi all,

I'm happy to announce the release of Luke - the Lucene Index Toolbox.
You can get an executable self-contained jar here:

 http://luke.googlecode.com/files/lukeall-1.0.1.jar

The Downloads section contains also the source code and a minimal
Luke-only jar.

This release upgrades to Lucene 3.0.1 jars.

New features and improvements:
------------------------------
*  Issue 5 : Field value decoder for 32 bit numeric fields (float, int)
missing.
* Added support for XmlQueryParser?.
*  Issue 12 : Add option to specify custom XmlQueryParser?.

Bug fixes:
----------
*  Issue 3 : Analyzer plugin (and analyzers) don't work.
*  Issue 4 : Compress flag no longer available.
*  Issue 14 : Error while using custom similarity.

Enjoy!

-- 
Best regards,
Andrzej Bialecki     <><
 ___. ___ ___ ___ _ _   __________________________________
[__ || __|__/|__||\/|  Information Retrieval, Semantic Web
___|||__||  \|  ||  |  Embedded Unix, System Integration
http://www.sigram.com  Contact: info at sigram dot com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45671-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 20:13:42 2010
Return-Path: <java-user-return-45671-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87534 invoked from network); 1 Apr 2010 20:13:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 20:13:42 -0000
Received: (qmail 59908 invoked by uid 500); 1 Apr 2010 20:13:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59804 invoked by uid 500); 1 Apr 2010 20:13:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59796 invoked by uid 99); 1 Apr 2010 20:13:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 20:13:40 +0000
X-ASF-Spam-Status: No, hits=0.4 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 20:13:34 +0000
Received: by vws14 with SMTP id 14so829056vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 13:13:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=Hnya866wNuKiHaT1aicWW+i+ZBIDvVGVG5LpYh23nME=;
        b=jMGCuStalU9zYf5V6F7uEP0hmOc1W2GEEDKSf2pdAEJqpntt8N9wFRtRsW6Z8sn58E
         ZVsulxd3uhli6mDWwQTpu9jN3k41GRbc6+8IoaSXuY680jg7n0jQvzfULoKhNCiaXxzD
         fubwR7IukrTmyzbXaGEch1ZBLwx2TYwW9jPPg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=lnZl2nvrJeV1PwG1XgBEXSptIJNdC23to5QRdRC4D3UvLKKW/2ghtqpWDBk4y1HiqE
         33QJo9ko8dI635MPQepf2dbwXFWfWMJo3KIakDhT8CW2+56oVtPrIRoYUoVst3UWBhJA
         pwU4Q1u6f/lmnnlbUQvW1uwXWMKTKgLgo7utw=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Thu, 1 Apr 2010 13:13:12 -0700 (PDT)
In-Reply-To: <4BB4F2F5.4090404@gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>
	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>
	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>
	 <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>
	 <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>
	 <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com>
	 <u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com>
	 <4BB4F2F5.4090404@gmail.com>
Date: Fri, 2 Apr 2010 01:43:12 +0530
Received: by 10.220.124.220 with SMTP id v28mr708593vcr.219.1270152792347; 
	Thu, 01 Apr 2010 13:13:12 -0700 (PDT)
Message-ID: <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Fri, Apr 2, 2010 at 12:54 AM, Chris Lu <chris.lu@gmail.com> wrote:
> No need for Hadoop. It's even more slower. Lucene can do it easily.
>
> This has been implemented in DBSight.
> The implementation is very similar to Facet search. Just need a way to lo=
ad
> the field quickly, like put it in memory or some data structure, and coun=
t
> the sum/min/max during searching.

This will ONLY compute the aggregated value ( sum,count,min,max etc.
). I guess what Mike wants is use the aggregated value to sort the
entries. Dynamically maintaining a sorted list while searching could
be extremely expensive.


>
> --
> Chris Lu
> -------------------------
> Instant Scalable Full-Text Search On Any Database/Application
> site: http://www.dbsight.net
> demo: http://search.dbsight.com
> Lucene Database Search in 3 minutes:
> http://wiki.dbsight.com/index.php?title=3DCreate_Lucene_Database_Search_i=
n_3_minutes
> DBSight customer, a shopping comparison site, (anonymous per request) got
> 2.6 Million Euro funding!
>
>
> prasenjit mukherjee wrote:
>>
>> This looks like a use case more suited =A0for Pig ( over Hadoop ).
>>
>> It could be difficult for lucene to do sort and sum simultaneously as
>> sorting itself depends upon summed value.
>>
>> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com> wrote:
>>
>>>
>>> Well that's my problem: we have a lot of records of all types
>>> (afiiliates,
>>> sales) so looping tons of records each time isn't possible.
>>>
>>> - Mike
>>> akaris@gmail.com
>>>
>>>
>>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee
>>> <prasen.bea@gmail.com>wrote:
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45672-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 21:03:36 2010
Return-Path: <java-user-return-45672-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98470 invoked from network); 1 Apr 2010 21:03:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 21:03:36 -0000
Received: (qmail 28852 invoked by uid 500); 1 Apr 2010 21:03:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28823 invoked by uid 500); 1 Apr 2010 21:03:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28815 invoked by uid 99); 1 Apr 2010 21:03:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:03:33 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.lu@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:03:25 +0000
Received: by vws14 with SMTP id 14so848594vws.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 14:03:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type;
        bh=vJvzc5uwLZymX5vo4G0kG0Gghx9p8x8IUSYDfe90z/U=;
        b=KG50ZJl9l69Hl8mINvEIQJYqCHQdPY+CfX6D0ZUFrQI1HOLytTCDbyRp6TxYmQSeFY
         iuuLQh2itY0rGPqghc/ZIzX4m8KziVixnzzg1sshrvd1FGI5jfk/xIyddPVoIsjpVgEu
         YU27YplNoL01pURQaMl/oYFAB+OWCQ/JlOa6Q=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type;
        b=iYWjc1kxV9yD1CTIHMDHj0Gj+xD2M/ew7mq7jDmIy0Zb2F8UnLXtfixDZ8k/L/eZE2
         Akn0tklYj1ZkJII2VkibjL7l5jIWOtzEabhAjmWSTPD95Ro+DAqpWbkl0VbScxoSf2NF
         JDvygCRrcsrKyZHcgN+emCYqD1XxVKdDV+uKM=
Received: by 10.220.107.5 with SMTP id z5mr764096vco.103.1270155784609;
        Thu, 01 Apr 2010 14:03:04 -0700 (PDT)
Received: from [10.1.1.129] (hq.compositesw.com [209.237.61.131])
        by mx.google.com with ESMTPS id 31sm175178363vws.11.2010.04.01.14.03.03
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 14:03:03 -0700 (PDT)
Message-ID: <4BB509FA.1050808@gmail.com>
Date: Thu, 01 Apr 2010 14:02:50 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.24 (Windows/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene Challenge - sum, count, avg, etc.
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>	 <h2l500e4a1e1003311823q20e6a91bwe4265bf863a1eff6@mail.gmail.com>	 <u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com>	 <k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com>	 <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>	 <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>	 <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com>	 <u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com>	 <4BB4F2F5.4090404@gmail.com> <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com>
In-Reply-To: <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------060103010209020703050803"
X-Virus-Checked: Checked by ClamAV on apache.org

--------------060103010209020703050803
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

For DBSight, the aggregated values are computed during run time.
And the sorting on the computed aggregated values are done when 
displaying the results.

The idea is, after the aggregation, the number of aggregated values are 
much much smaller.

--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!


prasenjit mukherjee wrote:
> On Fri, Apr 2, 2010 at 12:54 AM, Chris Lu <chris.lu@gmail.com> wrote:
>   
>> No need for Hadoop. It's even more slower. Lucene can do it easily.
>>
>> This has been implemented in DBSight.
>> The implementation is very similar to Facet search. Just need a way to load
>> the field quickly, like put it in memory or some data structure, and count
>> the sum/min/max during searching.
>>     
>
> This will ONLY compute the aggregated value ( sum,count,min,max etc.
> ). I guess what Mike wants is use the aggregated value to sort the
> entries. Dynamically maintaining a sorted list while searching could
> be extremely expensive.
>
>
>   
>> --
>> Chris Lu
>> -------------------------
>> Instant Scalable Full-Text Search On Any Database/Application
>> site: http://www.dbsight.net
>> demo: http://search.dbsight.com
>> Lucene Database Search in 3 minutes:
>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>> DBSight customer, a shopping comparison site, (anonymous per request) got
>> 2.6 Million Euro funding!
>>
>>
>> prasenjit mukherjee wrote:
>>     
>>> This looks like a use case more suited  for Pig ( over Hadoop ).
>>>
>>> It could be difficult for lucene to do sort and sum simultaneously as
>>> sorting itself depends upon summed value.
>>>
>>> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com> wrote:
>>>
>>>       
>>>> Well that's my problem: we have a lot of records of all types
>>>> (afiiliates,
>>>> sales) so looping tons of records each time isn't possible.
>>>>
>>>> - Mike
>>>> akaris@gmail.com
>>>>
>>>>
>>>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee
>>>> <prasen.bea@gmail.com>wrote:
>>>>
>>>>
>>>>         
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>       
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   

--------------060103010209020703050803--

From java-user-return-45673-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 21:25:55 2010
Return-Path: <java-user-return-45673-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3439 invoked from network); 1 Apr 2010 21:25:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 21:25:55 -0000
Received: (qmail 53644 invoked by uid 500); 1 Apr 2010 21:25:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53605 invoked by uid 500); 1 Apr 2010 21:25:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53597 invoked by uid 99); 1 Apr 2010 21:25:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:25:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of akaris@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:25:46 +0000
Received: by gyf1 with SMTP id 1so641856gyf.35
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 14:25:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=6TA3Ujb7S+zXeLHzbOTPqlOMvZEI+Jh6/OY4iwnR1Gg=;
        b=XlN3DiFSoYF1ySDdRzVGpywWf82SWtN7hhe5jTgQASUIKOQHkxLA4eOlDY4Su/uCbN
         13qmdpa8PKPbaFHoYt5CdFR/AoowzGL91WAm1iNS6hw3V8Wu6kXLqUMVpW4LI9c5wNH1
         BavjDELzetV3HM4yd2Hhi4/eZtRoE5ylaq5/Q=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=JEV8jiQeF0IH58ASTE8jJR5g56NVh8T3vL+jyTflSMil/bjQ+vCo/sAYSQdIqoEw5S
         GY/IWB6xkzejv2zezduolQcZlFHZI5xQ7h0SzRG4HwDrS6G+ZgqnCqArnkxl8lhnAMij
         jx5GzTf4mH32g9KmqDS8IYY1hoKv0FypPlaoQ=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Thu, 1 Apr 2010 14:25:05 -0700 (PDT)
In-Reply-To: <4BB509FA.1050808@gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com> 
	<k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com> 
	<p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com> 
	<v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com> 
	<r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com> 
	<u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com> 
	<4BB4F2F5.4090404@gmail.com> <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com> 
	<4BB509FA.1050808@gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 1 Apr 2010 17:25:05 -0400
Received: by 10.100.26.37 with SMTP id 37mr1521922anz.72.1270157125331; Thu, 
	01 Apr 2010 14:25:25 -0700 (PDT)
Message-ID: <s2t962c93f61004011425v991794edk2e6b9c4e40e7d65e@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6469a5a43b18104833380a3
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6469a5a43b18104833380a3
Content-Type: text/plain; charset=ISO-8859-1

I'm sure the DBSight feature is great, but we already have a system in place
and we're not throwing it away -- it's closely integrated with our whole
platform. We're way past the point to switch our solution to DBSight.  We'd
be more than happy to use the DBSight feature if it would be opensource but
unfortunately it's not - so we won't even consider it.

Chris: are you a developer at DBSight? Can you tell us more about how it
works?  Because I don't really see how it can be "fast" when dealing with
millions of records... as it has to loop through them, compute, store
everything (in a temp index? memory?) and then re-sort.

- Mike
akaris@gmail.com


On Thu, Apr 1, 2010 at 5:02 PM, Chris Lu <chris.lu@gmail.com> wrote:

> For DBSight, the aggregated values are computed during run time.
> And the sorting on the computed aggregated values are done when displaying
> the results.
>
> The idea is, after the aggregation, the number of aggregated values are
> much much smaller.
>
>
> --
> Chris Lu
> -------------------------
> Instant Scalable Full-Text Search On Any Database/Application
> site: http://www.dbsight.net
> demo: http://search.dbsight.com
> Lucene Database Search in 3 minutes:
> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
> DBSight customer, a shopping comparison site, (anonymous per request) got
> 2.6 Million Euro funding!
>
>
> prasenjit mukherjee wrote:
>
>> On Fri, Apr 2, 2010 at 12:54 AM, Chris Lu <chris.lu@gmail.com> wrote:
>>
>>
>>> No need for Hadoop. It's even more slower. Lucene can do it easily.
>>>
>>> This has been implemented in DBSight.
>>> The implementation is very similar to Facet search. Just need a way to
>>> load
>>> the field quickly, like put it in memory or some data structure, and
>>> count
>>> the sum/min/max during searching.
>>>
>>>
>>
>> This will ONLY compute the aggregated value ( sum,count,min,max etc.
>> ). I guess what Mike wants is use the aggregated value to sort the
>> entries. Dynamically maintaining a sorted list while searching could
>> be extremely expensive.
>>
>>
>>
>>
>>> --
>>> Chris Lu
>>> -------------------------
>>> Instant Scalable Full-Text Search On Any Database/Application
>>> site: http://www.dbsight.net
>>> demo: http://search.dbsight.com
>>> Lucene Database Search in 3 minutes:
>>>
>>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>>> DBSight customer, a shopping comparison site, (anonymous per request) got
>>> 2.6 Million Euro funding!
>>>
>>>
>>> prasenjit mukherjee wrote:
>>>
>>>
>>>> This looks like a use case more suited  for Pig ( over Hadoop ).
>>>>
>>>> It could be difficult for lucene to do sort and sum simultaneously as
>>>> sorting itself depends upon summed value.
>>>>
>>>> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com>
>>>> wrote:
>>>>
>>>>
>>>>
>>>>> Well that's my problem: we have a lot of records of all types
>>>>> (afiiliates,
>>>>> sales) so looping tons of records each time isn't possible.
>>>>>
>>>>> - Mike
>>>>> akaris@gmail.com
>>>>>
>>>>>
>>>>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee
>>>>> <prasen.bea@gmail.com>wrote:
>>>>>
>>>>>
>>>>>
>>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>>>
>>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>

--0016e6469a5a43b18104833380a3--

From java-user-return-45674-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 21:32:35 2010
Return-Path: <java-user-return-45674-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4600 invoked from network); 1 Apr 2010 21:32:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 21:32:35 -0000
Received: (qmail 64780 invoked by uid 500); 1 Apr 2010 21:32:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64753 invoked by uid 500); 1 Apr 2010 21:32:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64745 invoked by uid 99); 1 Apr 2010 21:32:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:32:32 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.lu@gmail.com designates 209.85.217.220 as permitted sender)
Received: from [209.85.217.220] (HELO mail-gx0-f220.google.com) (209.85.217.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:32:24 +0000
Received: by gxk20 with SMTP id 20so1130944gxk.12
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 14:32:03 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type;
        bh=82dYIcYnw9s2WqMQpkm1YigE1Bryp6rbuo/zSchJglM=;
        b=qqc4QV2TlToTQRlbXV9/ymBUWAExncNbF5E5i9QPYxtYjRgTyWqeLdj3So53GqrnI2
         6v5VXNn7H90uNqEp8Cpb9QsRvcDngJLVABMfKAtJtoZbAY6RTpur8dwux0zXoKc55qo1
         vhkR3HiMZcAm4Ft5yMxkLK6dG/YuTUEWRd0wM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type;
        b=k+RZV4PK0vVo9cgMtk36mlBN97vOl5fplfrkYjAkMJfxfgUxm+zV9QKw8LGcExDIDp
         jJMLEKej7tStIOCHQ8+DHgc+Oj0XdG2u/9ix+rGMueGL9exOs8lz0wAdyiPe+dU1q8G2
         ZTjv4XQ6QBG08AnfBtWRH7QjAgxEiPSqi44gU=
Received: by 10.150.117.17 with SMTP id p17mr1465416ybc.305.1270157523641;
        Thu, 01 Apr 2010 14:32:03 -0700 (PDT)
Received: from [10.1.1.129] (hq.compositesw.com [209.237.61.131])
        by mx.google.com with ESMTPS id 9sm2230989ywe.22.2010.04.01.14.32.01
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Apr 2010 14:32:02 -0700 (PDT)
Message-ID: <4BB510C5.3000401@gmail.com>
Date: Thu, 01 Apr 2010 14:31:49 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.24 (Windows/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene Challenge - sum, count, avg, etc.
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 	<u2y962c93f61004010444t7641c919u3159d610d4be9299@mail.gmail.com> 	<k2r500e4a1e1004010511z74cb4c66ofd4be60f4f73294f@mail.gmail.com> 	<p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com> 	<v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com> 	<r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com> 	<u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com> 	<4BB4F2F5.4090404@gmail.com> <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com> 	<4BB509FA.1050808@gmail.com> <s2t962c93f61004011425v991794edk2e6b9c4e40e7d65e@mail.gmail.com>
In-Reply-To: <s2t962c93f61004011425v991794edk2e6b9c4e40e7d65e@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------000600080709070203090209"
X-Virus-Checked: Checked by ClamAV on apache.org

--------------000600080709070203090209
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Thanks. Not really trying to sell DBSight here since most people here 
are Lucene experts.
Just to confirm that this "challenge" has been done via Lucene for quite 
a while.

The technique for it is very similar to how facet search is done, which 
has several ways also.
Million's of rows are not really "that" big when everything is properly 
warmed up.

--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!



Michel Nadeau wrote:
> I'm sure the DBSight feature is great, but we already have a system in place
> and we're not throwing it away -- it's closely integrated with our whole
> platform. We're way past the point to switch our solution to DBSight.  We'd
> be more than happy to use the DBSight feature if it would be opensource but
> unfortunately it's not - so we won't even consider it.
>
> Chris: are you a developer at DBSight? Can you tell us more about how it
> works?  Because I don't really see how it can be "fast" when dealing with
> millions of records... as it has to loop through them, compute, store
> everything (in a temp index? memory?) and then re-sort.
>
> - Mike
> akaris@gmail.com
>
>
> On Thu, Apr 1, 2010 at 5:02 PM, Chris Lu <chris.lu@gmail.com> wrote:
>
>   
>> For DBSight, the aggregated values are computed during run time.
>> And the sorting on the computed aggregated values are done when displaying
>> the results.
>>
>> The idea is, after the aggregation, the number of aggregated values are
>> much much smaller.
>>
>>
>> --
>> Chris Lu
>> -------------------------
>> Instant Scalable Full-Text Search On Any Database/Application
>> site: http://www.dbsight.net
>> demo: http://search.dbsight.com
>> Lucene Database Search in 3 minutes:
>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>> DBSight customer, a shopping comparison site, (anonymous per request) got
>> 2.6 Million Euro funding!
>>
>>
>> prasenjit mukherjee wrote:
>>
>>     
>>> On Fri, Apr 2, 2010 at 12:54 AM, Chris Lu <chris.lu@gmail.com> wrote:
>>>
>>>
>>>       
>>>> No need for Hadoop. It's even more slower. Lucene can do it easily.
>>>>
>>>> This has been implemented in DBSight.
>>>> The implementation is very similar to Facet search. Just need a way to
>>>> load
>>>> the field quickly, like put it in memory or some data structure, and
>>>> count
>>>> the sum/min/max during searching.
>>>>
>>>>
>>>>         
>>> This will ONLY compute the aggregated value ( sum,count,min,max etc.
>>> ). I guess what Mike wants is use the aggregated value to sort the
>>> entries. Dynamically maintaining a sorted list while searching could
>>> be extremely expensive.
>>>
>>>
>>>
>>>
>>>       
>>>> --
>>>> Chris Lu
>>>> -------------------------
>>>> Instant Scalable Full-Text Search On Any Database/Application
>>>> site: http://www.dbsight.net
>>>> demo: http://search.dbsight.com
>>>> Lucene Database Search in 3 minutes:
>>>>
>>>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>>>> DBSight customer, a shopping comparison site, (anonymous per request) got
>>>> 2.6 Million Euro funding!
>>>>
>>>>
>>>> prasenjit mukherjee wrote:
>>>>
>>>>
>>>>         
>>>>> This looks like a use case more suited  for Pig ( over Hadoop ).
>>>>>
>>>>> It could be difficult for lucene to do sort and sum simultaneously as
>>>>> sorting itself depends upon summed value.
>>>>>
>>>>> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com>
>>>>> wrote:
>>>>>
>>>>>
>>>>>
>>>>>           
>>>>>> Well that's my problem: we have a lot of records of all types
>>>>>> (afiiliates,
>>>>>> sales) so looping tons of records each time isn't possible.
>>>>>>
>>>>>> - Mike
>>>>>> akaris@gmail.com
>>>>>>
>>>>>>
>>>>>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee
>>>>>> <prasen.bea@gmail.com>wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>             
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>           
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>>       
>
>   

--------------000600080709070203090209--

From java-user-return-45675-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 21:50:34 2010
Return-Path: <java-user-return-45675-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9897 invoked from network); 1 Apr 2010 21:50:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 21:50:34 -0000
Received: (qmail 92625 invoked by uid 500); 1 Apr 2010 21:50:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92594 invoked by uid 500); 1 Apr 2010 21:50:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92586 invoked by uid 99); 1 Apr 2010 21:50:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:50:32 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 21:50:25 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <henrib@apache.org>)
	id 1NxSH7-0003l7-AZ
	for java-user@lucene.apache.org; Thu, 01 Apr 2010 14:50:05 -0700
Date: Thu, 1 Apr 2010 13:50:05 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270158605321-691744.post@n3.nabble.com>
In-Reply-To: <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


By issuing multiple queries, one against each localized index, results being
clustered by locale. 
You can further refine by translating the end-user input query terms for
each locale and issue "translated" queries against the respective indices.
I've seen satisfying results with "key" terms dictionaries.
Henri
-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p691744.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45676-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 22:01:03 2010
Return-Path: <java-user-return-45676-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15402 invoked from network); 1 Apr 2010 22:01:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 22:01:03 -0000
Received: (qmail 3370 invoked by uid 500); 1 Apr 2010 22:01:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3277 invoked by uid 500); 1 Apr 2010 22:01:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3269 invoked by uid 99); 1 Apr 2010 22:01:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 22:01:00 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 22:00:54 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <henrib@apache.org>)
	id 1NxSRF-0004R3-0s
	for java-user@lucene.apache.org; Thu, 01 Apr 2010 15:00:33 -0700
Date: Thu, 1 Apr 2010 14:00:33 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270159233020-691764.post@n3.nabble.com>
In-Reply-To: <612777.71114.qm@web24104.mail.ird.yahoo.com>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <612777.71114.qm@web24104.mail.ird.yahoo.com>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Hi David,


pagod wrote:
> 
> ... apply only in a particular situation:
> 
Very true, as often in the IR field :-) ; in our case, the "same" document
existed in different locales; these were localized technical docs which also
meant the dictionary (of important) terms was limited and used to influence
scoring.


pagod wrote:
> 
> 
> henrib wrote:
>> 
>> This allowed to have the same index structure across locales but
>> different settings for each (synonyms, stemmers, etc). Maintenance was
>> easier this way; when refining/updating the settings (say adding synonyms
>> or stemmers for instance), you may need to reindex and smaller indices
>> allow faster deployments.
>> 
> If I understand this correctly, that is true if you're indexing distinct
> collections of documents that are all in the same language, which you know
> in advance. In that case, you would of course only need to reindex one of
> these collections into the corresponding index to update it.
> 
Correct.

pagod wrote:
> 
>  In my case though, there is no such separation and only upon processing a
> document can I decide what language it is in. I therefore cannot decide to
> update only documents in one language, it's a "all or nothing". 
> 
As you write later, you perform language detection on the document before
you index. Thus you know - the virtue of one lang <=> one index - in which
index a given document needs to be put and can maintain the list of
documents that exist for a given language (intrinsically, those in the 'FR'
index are all in French). Pending you still have access to the raw content,
you can then reindex just those.


pagod wrote:
> 
> 
> henrib wrote:
>> 
>> It's also "dead-easy" to add a new language (esp. compared to the one
>> index solution).
>> 
> I'm not really sure why adding new languages should be complicated in the
> one-index solution: the languages I can process (i.e. languages for which
> I have recognition data and the proper analyzer) are listed in a
> configuration file. 
> 
Smart solution! With Solr, if you need to add a new field/language that was
not in the original schema/list, you need to reindex the whole. In the
multi-index solution, you just need to create a new index (Solr core).

pagod wrote:
>  
> Upon recognizing one of these languages, the module stores it in the
> internal data structure, which is then eventually passed to the indexing
> module. The latter retrieves the language from the structure and uses it
> to create the corresponding fields in the index dynamically (e.g.
> "content-de", "title-en" etc). It's all really automatic. 
> 
Ok. I'm biased by Solr which needs a schema defining all fields before hand;
you can't just decide to add a document which "declares" a new field. You
need a new schema / index / core that declares the field, etc...


pagod wrote:
> 
> 
> henrib wrote:
>> It also makes replication or partitioning easier.
> Not sure what you mean by that... 
> 
Our solution was built on top Solr; all the query rewriting/expansion was
occurring before Solr localized searches. Since our server was sending the
queries and formatting the results, it was very easy to put indexes on
different machines. Solr also comes with replication and sharding (if you
need those); having multiple indexes makes things a tad easier to configure
wrt number of speakers of a given language.  


pagod wrote:
> 
> So if I understand correctly you'd always only search in one of the
> indices? In that case, I can understand why the multi-index solution works
> better for you. However, assuming most of my users speak at least English
> *and* one, two or three of the other languages, all searches have to be
> conducted in all languages.
> 
We were issuing one query per language the user selected as able to
comprehend. So if you spoke English, German and French, 3 queries were
performed. So, yes, all searches have to be conducted in all needed
languages.


pagod wrote:
> 
>  Besides, the various languages are not localized versions of the same
> content, they may really be anything in any language, depending on the
> person who wrote them and their mood at the time of writing. Some
> documents also contains parts in English and parts in German... I'm
> definitely thinking about making it possible to enable/disable some
> languages, but parallel searching will definitely be required. 
> 
Mixed language documents is not something I had to cope with... But I
suppose whatever solution you'll use to chunk which part of the doc is in
which language can be used by both indexing solutions.

pagod wrote:
> 
>> Besides, IMO, scoring / ordering documents in different
>> languages is a bit like comparing apples and oranges.
> ...Lucene's ranking algorithm is based on the number of tokens and the
> number of occurrences in fields,...
> 
Scoring is indeed a complex issue; tf/idf is not the sole scoring method
(BM25F comes to mind). The score being a ratio (/ best score), taking a
practical stance over academic, you can still use it as an ordering norm for
the sake of a better user experience even if it comes from different
indexes. You might also want to bias results ordering with other factors
like last-updated, ranking, etc.


pagod wrote:
> 
>> Finally, query expansion can also be used in the multiple indices case
>> and
>> might even use automated/guided translation.
> I do agree about that, and I guess query expansion is much easier when
> dealing with a single, consistent index structure. I'm thinking writing an
> algorithm to automatically expand a query to all languages might be ok,
> but I'm worried about the performance of performing such a query if the
> number of languages grows larger....
> 
This algo would work for single & multiple indexes; at least in the multiple
index case, you can partition easily and would the need arise, put localized
indexes on different machines.


pagod wrote:
> 
> One other problem I'm seeing with the multi-index solution is the ranking
> of documents that are spanned across several indices (multilingual
> documents). If say my search term matches a document in the English index
> and the same document in the French index (which would quite often be the
> case for e.g. proper names), then how do I get about mixing the two
> rankings? (as I don't want to display the same result twice) I think using
> a single index would solve that problem, since the ranking would already
> take all fields (hence all languages into account).
> 
If we consider a unique id for the same doc in different indexes (another
Solr recommended feature), nothing stops you from aggregating the scores
coming from each index (a weighted average for instance).

Anyway, I'm relating an experience in a field that might be too different
from yours to be applicable.
Hope it helps.
Cheers,
Henrib

-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p691764.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45677-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 22:58:53 2010
Return-Path: <java-user-return-45677-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31163 invoked from network); 1 Apr 2010 22:58:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 22:58:53 -0000
Received: (qmail 57366 invoked by uid 500); 1 Apr 2010 22:58:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57337 invoked by uid 500); 1 Apr 2010 22:58:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57329 invoked by uid 99); 1 Apr 2010 22:58:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 22:58:51 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Apr 2010 22:58:44 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id 6B1FC1E68CE; Thu,  1 Apr 2010 15:58:23 -0700 (MST)
Received: from PHX-HTPRD-02.adprod.bmc.com (phx-htprd-02.adprod.bmc.com [172.24.32.8])
	by flicker.bmc.com (Postfix) with ESMTP id 61DAE1E68BB
	for <java-user@lucene.apache.org>; Thu,  1 Apr 2010 15:58:23 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-02.adprod.bmc.com ([172.24.32.8]) with mapi; Thu, 1 Apr 2010
 17:58:23 -0500
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Thu, 1 Apr 2010 17:58:20 -0500
Subject: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrR1Vc91sm8J/yiTTGMj4P2GMG4+QABwZzQAADK3cA=
Message-ID: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/alternative;
	boundary="_000_492379B6AA909E4FAF672AACCA0EADC24A40EE9B10PHXCCRPRD02ad_"
MIME-Version: 1.0

--_000_492379B6AA909E4FAF672AACCA0EADC24A40EE9B10PHXCCRPRD02ad_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

We are seeing a situation where the IndexWriter is using up the Java Heap s=
pace and only releases memory for garbage collection upon a commit.   We ar=
e using the default RAMBufferSize of 16 mb.  We are using Lucene 2.9.1. We =
are set at heap size of 512 mb.

We have a large number of documents that are run through Tika and then adde=
d to the index.  The data from Tika is changed to a string, and then sent t=
o Lucene.  Heap dumps clearly show the data in the Lucene classes and not i=
n Tika.  Our intent is to only perform a commit once the entire indexing ru=
n is complete, but several hours into the process everything comes to a cra=
wl.  In using both JConsole and VisualVM  we can see that the heap space is=
 maxed out and garbage collection is not able to clean up any memory once w=
e get into this state.  It is our understanding that the IndexWriter should=
 be only holding onto 16 mb of data before it flushes it, but what we are s=
eeing is that while it is in fact writing data to disk when it hits the 16 =
mb limit, it is also holding onto some data in memory and not allowing garb=
age collection to take place, and this continues until garbage collection i=
s unable to free up enough space to all things to move faster than a crawl.

As a test we caused a commit to occur after each document is indexed and we=
 see the total amount of memory reduced from nearly 100% of the Java Heap t=
o around 70-75%.  The profiling tools now show that the memory is cleaned u=
p to some extent after each document.  But of course this completely defeat=
s the whole reason why we want to only commit at the end of the run for per=
formance sake.  Most of the data, as seen using Heap analasis, is held in B=
yte, Character, and Integer classes whos GC roots are tied back to the Writ=
er Objects and threads.  The instance counts, after running just 1,100 docu=
ments seems staggering

Is there additional data that the IndexWriter hangs onto regardless of when=
 it hits the RAMBufferSize limit?  Why are we seeing the heap space all bei=
ng used up?

A side question to this is the fact that we always see a large amount of me=
mory used by the IndexWriter even after our indexing has been completed and=
 all commits have taken place (basically in an idle state).  Why would this=
 be?  Is the only way to totally clean up the memory is to close the writer=
?  Our index is also used for real time indexing so the IndexWriter is inte=
nded to remain open for the lifetime of the app.

Any help in understanding why the IndexWriter is maxing out our heap space =
or what is expected from memory usage of the IndexWriter would be appreciat=
ed.

--_000_492379B6AA909E4FAF672AACCA0EADC24A40EE9B10PHXCCRPRD02ad_--


From java-user-return-45678-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 01 23:21:46 2010
Return-Path: <java-user-return-45678-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35877 invoked from network); 1 Apr 2010 23:21:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Apr 2010 23:21:45 -0000
Received: (qmail 75952 invoked by uid 500); 1 Apr 2010 23:21:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75800 invoked by uid 500); 1 Apr 2010 23:21:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75792 invoked by uid 99); 1 Apr 2010 23:21:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 23:21:43 +0000
X-ASF-Spam-Status: No, hits=-1.1 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.200] (HELO mail-yx0-f200.google.com) (209.85.210.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Apr 2010 23:21:38 +0000
Received: by yxe38 with SMTP id 38so745849yxe.22
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 16:21:17 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.114.2 with HTTP; Thu, 1 Apr 2010 16:21:17 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
Date: Thu, 1 Apr 2010 19:21:17 -0400
Received: by 10.150.66.18 with SMTP id o18mr2111505yba.96.1270164077638; Thu, 
	01 Apr 2010 16:21:17 -0700 (PDT)
Message-ID: <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hmm, not good.  Can you post a heap dump?  Also, can you turn on
infoStream, index up to the OOM @ 512 MB, and post the output?

IndexWriter should not hang onto much beyond the RAM buffer.  But, it
does allocate and then recycle this RAM buffer, so even in an idle
state (having indexed enough docs to fill up the RAM buffer at least
once) it'll hold onto those 16 MB.

Are you using getReader (to get your NRT readers)?  If so, are you
really sure you're eventually closing the previous reader after
opening a new one?

Mike

On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> We are seeing a situation where the IndexWriter is using up the Java Heap=
 space and only releases memory for garbage collection upon a commit. =A0 W=
e are using the default RAMBufferSize of 16 mb. =A0We are using Lucene 2.9.=
1. We are set at heap size of 512 mb.
>
> We have a large number of documents that are run through Tika and then ad=
ded to the index. =A0The data from Tika is changed to a string, and then se=
nt to Lucene. =A0Heap dumps clearly show the data in the Lucene classes and=
 not in Tika. =A0Our intent is to only perform a commit once the entire ind=
exing run is complete, but several hours into the process everything comes =
to a crawl. =A0In using both JConsole and VisualVM =A0we can see that the h=
eap space is maxed out and garbage collection is not able to clean up any m=
emory once we get into this state. =A0It is our understanding that the Inde=
xWriter should be only holding onto 16 mb of data before it flushes it, but=
 what we are seeing is that while it is in fact writing data to disk when i=
t hits the 16 mb limit, it is also holding onto some data in memory and not=
 allowing garbage collection to take place, and this continues until garbag=
e collection is unable to free up enough space to all things to move faster=
 than a crawl.
>
> As a test we caused a commit to occur after each document is indexed and =
we see the total amount of memory reduced from nearly 100% of the Java Heap=
 to around 70-75%. =A0The profiling tools now show that the memory is clean=
ed up to some extent after each document. =A0But of course this completely =
defeats the whole reason why we want to only commit at the end of the run f=
or performance sake. =A0Most of the data, as seen using Heap analasis, is h=
eld in Byte, Character, and Integer classes whos GC roots are tied back to =
the Writer Objects and threads. =A0The instance counts, after running just =
1,100 documents seems staggering
>
> Is there additional data that the IndexWriter hangs onto regardless of wh=
en it hits the RAMBufferSize limit? =A0Why are we seeing the heap space all=
 being used up?
>
> A side question to this is the fact that we always see a large amount of =
memory used by the IndexWriter even after our indexing has been completed a=
nd all commits have taken place (basically in an idle state). =A0Why would =
this be? =A0Is the only way to totally clean up the memory is to close the =
writer? =A0Our index is also used for real time indexing so the IndexWriter=
 is intended to remain open for the lifetime of the app.
>
> Any help in understanding why the IndexWriter is maxing out our heap spac=
e or what is expected from memory usage of the IndexWriter would be appreci=
ated.
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45679-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:01:28 2010
Return-Path: <java-user-return-45679-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78130 invoked from network); 2 Apr 2010 03:01:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:01:28 -0000
Received: (qmail 3953 invoked by uid 500); 2 Apr 2010 03:01:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3782 invoked by uid 500); 2 Apr 2010 03:01:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 50325 invoked by uid 99); 1 Apr 2010 14:29:33 -0000
X-ASF-Spam-Status: No, hits=-0.4 required=10.0
	tests=AWL,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Thu, 1 Apr 2010 06:29:07 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270132147122-690881.post@n3.nabble.com>
In-Reply-To: <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


By issuing multiple queries, one against each localized index, results being
clustered by locale.
You can further refine by translating the end-user input query terms for
each locale and issue "translated" queries against the respective indices.
I've seen satisfying results with "key" terms dictionaries.




-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p690881.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45680-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:14:45 2010
Return-Path: <java-user-return-45680-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80110 invoked from network); 2 Apr 2010 03:14:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:14:45 -0000
Received: (qmail 13023 invoked by uid 500); 2 Apr 2010 03:14:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12987 invoked by uid 500); 2 Apr 2010 03:14:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12979 invoked by uid 99); 2 Apr 2010 03:14:42 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 03:14:42 +0000
X-ASF-Spam-Status: No, hits=0.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_LOTS_OF_MONEY,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of akaris@gmail.com designates 209.85.217.220 as permitted sender)
Received: from [209.85.217.220] (HELO mail-gx0-f220.google.com) (209.85.217.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 03:14:37 +0000
Received: by gxk20 with SMTP id 20so1293163gxk.12
        for <java-user@lucene.apache.org>; Thu, 01 Apr 2010 20:14:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=2EX2j1UfrPGdAll6nnnb4NT0W8LC1UvM1+AetnZ2RMM=;
        b=M1+K3HWzP9XtbqeKoEfxchrr1GuVEVKyOeOCxoC6cyNH+dCHxVDfVgBvwSqxmKPVYP
         1BTkySTpCwOQ+TA3DgzMs7gJiisqIaSCNDmgbAgwCRe3E2do5K9+rH5Br7mCvjFPbODg
         oOthTcYqlXl8F2jF2JSMoF6XdFxS0ThXy0Y9k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=jHmI7rEzSVM0qa2OMO0vopZZ8mg7RA+1/4uemdaY+40JCor3pCVeaJFJWm+u7389A/
         mCXGbXJSZ+YRK9md6/LnDmTxqh9zAkoNsDZPmsTWQ3vRd2kDkKcr+iIynhnnb+KRGnuM
         nrjznqmKHo9lVFw09oDRMNoDX0RA5k6NfPOnc=
MIME-Version: 1.0
Received: by 10.100.249.12 with HTTP; Thu, 1 Apr 2010 20:13:55 -0700 (PDT)
In-Reply-To: <4BB510C5.3000401@gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> 
	<p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com> 
	<v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com> 
	<r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com> 
	<u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com> 
	<4BB4F2F5.4090404@gmail.com> <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com> 
	<4BB509FA.1050808@gmail.com> <s2t962c93f61004011425v991794edk2e6b9c4e40e7d65e@mail.gmail.com> 
	<4BB510C5.3000401@gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 1 Apr 2010 23:13:55 -0400
Received: by 10.101.118.15 with SMTP id v15mr4421589anm.58.1270178055393; Thu, 
	01 Apr 2010 20:14:15 -0700 (PDT)
Message-ID: <l2q962c93f61004012013q956e23a0s65318dfefd86013d@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636ed7614cb463f0483385f31

--001636ed7614cb463f0483385f31
Content-Type: text/plain; charset=ISO-8859-1

My big question is how do you loop 1M records, sum up field(s), and then
sort on that field... all in memory (could use too much ram) ?  In a
temporary index (could take a while to re-write a lot of documents in a new
index) ?

- Mike
akaris@gmail.com


On Thu, Apr 1, 2010 at 5:31 PM, Chris Lu <chris.lu@gmail.com> wrote:

> Thanks. Not really trying to sell DBSight here since most people here are
> Lucene experts.
> Just to confirm that this "challenge" has been done via Lucene for quite a
> while.
>
> The technique for it is very similar to how facet search is done, which has
> several ways also.
> Million's of rows are not really "that" big when everything is properly
> warmed up.
>
>
> --
> Chris Lu
> -------------------------
> Instant Scalable Full-Text Search On Any Database/Application
> site: http://www.dbsight.net
> demo: http://search.dbsight.com
> Lucene Database Search in 3 minutes:
> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
> DBSight customer, a shopping comparison site, (anonymous per request) got
> 2.6 Million Euro funding!
>
>
>
> Michel Nadeau wrote:
>
>> I'm sure the DBSight feature is great, but we already have a system in
>> place
>> and we're not throwing it away -- it's closely integrated with our whole
>> platform. We're way past the point to switch our solution to DBSight.
>>  We'd
>> be more than happy to use the DBSight feature if it would be opensource
>> but
>> unfortunately it's not - so we won't even consider it.
>>
>> Chris: are you a developer at DBSight? Can you tell us more about how it
>> works?  Because I don't really see how it can be "fast" when dealing with
>> millions of records... as it has to loop through them, compute, store
>> everything (in a temp index? memory?) and then re-sort.
>>
>> - Mike
>> akaris@gmail.com
>>
>>
>> On Thu, Apr 1, 2010 at 5:02 PM, Chris Lu <chris.lu@gmail.com> wrote:
>>
>>
>>
>>> For DBSight, the aggregated values are computed during run time.
>>> And the sorting on the computed aggregated values are done when
>>> displaying
>>> the results.
>>>
>>> The idea is, after the aggregation, the number of aggregated values are
>>> much much smaller.
>>>
>>>
>>> --
>>> Chris Lu
>>> -------------------------
>>> Instant Scalable Full-Text Search On Any Database/Application
>>> site: http://www.dbsight.net
>>> demo: http://search.dbsight.com
>>> Lucene Database Search in 3 minutes:
>>>
>>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>>> DBSight customer, a shopping comparison site, (anonymous per request) got
>>> 2.6 Million Euro funding!
>>>
>>>
>>> prasenjit mukherjee wrote:
>>>
>>>
>>>
>>>> On Fri, Apr 2, 2010 at 12:54 AM, Chris Lu <chris.lu@gmail.com> wrote:
>>>>
>>>>
>>>>
>>>>
>>>>> No need for Hadoop. It's even more slower. Lucene can do it easily.
>>>>>
>>>>> This has been implemented in DBSight.
>>>>> The implementation is very similar to Facet search. Just need a way to
>>>>> load
>>>>> the field quickly, like put it in memory or some data structure, and
>>>>> count
>>>>> the sum/min/max during searching.
>>>>>
>>>>>
>>>>>
>>>>>
>>>> This will ONLY compute the aggregated value ( sum,count,min,max etc.
>>>> ). I guess what Mike wants is use the aggregated value to sort the
>>>> entries. Dynamically maintaining a sorted list while searching could
>>>> be extremely expensive.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>> --
>>>>> Chris Lu
>>>>> -------------------------
>>>>> Instant Scalable Full-Text Search On Any Database/Application
>>>>> site: http://www.dbsight.net
>>>>> demo: http://search.dbsight.com
>>>>> Lucene Database Search in 3 minutes:
>>>>>
>>>>>
>>>>> http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
>>>>> DBSight customer, a shopping comparison site, (anonymous per request)
>>>>> got
>>>>> 2.6 Million Euro funding!
>>>>>
>>>>>
>>>>> prasenjit mukherjee wrote:
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>> This looks like a use case more suited  for Pig ( over Hadoop ).
>>>>>>
>>>>>> It could be difficult for lucene to do sort and sum simultaneously as
>>>>>> sorting itself depends upon summed value.
>>>>>>
>>>>>> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com>
>>>>>> wrote:
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>> Well that's my problem: we have a lot of records of all types
>>>>>>> (afiiliates,
>>>>>>> sales) so looping tons of records each time isn't possible.
>>>>>>>
>>>>>>> - Mike
>>>>>>> akaris@gmail.com
>>>>>>>
>>>>>>>
>>>>>>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee
>>>>>>> <prasen.bea@gmail.com>wrote:
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>> ---------------------------------------------------------------------
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>>>
>>>>
>>>
>>
>>
>

--001636ed7614cb463f0483385f31--

From java-user-return-45681-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:24:48 2010
Return-Path: <java-user-return-45681-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81054 invoked from network); 2 Apr 2010 03:24:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:24:48 -0000
Received: (qmail 18800 invoked by uid 500); 2 Apr 2010 03:24:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18725 invoked by uid 500); 2 Apr 2010 03:24:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 26110 invoked by uid 99); 1 Apr 2010 16:36:11 -0000
X-ASF-Spam-Status: No, hits=-0.3 required=10.0
	tests=AWL,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Thu, 1 Apr 2010 08:35:45 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270139745879-691166.post@n3.nabble.com>
In-Reply-To: <612777.71114.qm@web24104.mail.ird.yahoo.com>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <612777.71114.qm@web24104.mail.ird.yahoo.com>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit



pagod wrote:
> 
> ... apply only in a particular situation:
> 
Very true, as often in the IR field :-) ; in our case, the "same" document
existed in different locales; these were localized technical docs which also
meant the dictionary (of important) terms was limited and used to influence
scoring.


pagod wrote:
> 
> 
> henrib wrote:
>> 
>> This allowed to have the same index structure across locales but
>> different settings for each (synonyms, stemmers, etc). Maintenance was
>> easier this way; when refining/updating the settings (say adding synonyms
>> or stemmers for instance), you may need to reindex and smaller indices
>> allow faster deployments.
>> 
> If I understand this correctly, that is true if you're indexing distinct
> collections of documents that are all in the same language, which you know
> in advance. In that case, you would of course only need to reindex one of
> these collections into the corresponding index to update it.
> 
Correct.

pagod wrote:
> 
>  In my case though, there is no such separation and only upon processing a
> document can I decide what language it is in. I therefore cannot decide to
> update only documents in one language, it's a "all or nothing". 
> 
As you write later, you perform language detection on the document before
you index. Thus you know - the virtue of one lang <=> one index - in which
index a given document needs to be put and can maintain the list of
documents that exist for a given language (intrinsically, those in the 'FR'
index are all in French). Pending you still have access to the raw content,
you can then reindex just those.


pagod wrote:
> 
> 
> henrib wrote:
>> 
>> It's also "dead-easy" to add a new language (esp. compared to the one
>> index solution).
>> 
> I'm not really sure why adding new languages should be complicated in the
> one-index solution: the languages I can process (i.e. languages for which
> I have recognition data and the proper analyzer) are listed in a
> configuration file. 
> 
Smart solution! With Solr, if you need to add a new field/language that was
not in the original schema/list, you need to reindex the whole. In the
multi-index solution, you just need to create a new index (Solr core).

pagod wrote:
>  
> Upon recognizing one of these languages, the module stores it in the
> internal data structure, which is then eventually passed to the indexing
> module. The latter retrieves the language from the structure and uses it
> to create the corresponding fields in the index dynamically (e.g.
> "content-de", "title-en" etc). It's all really automatic. 
> 
Ok. I'm biased by Solr which needs a schema defining all fields before hand;
you can't just decide to add a document which "declares" a new field. You
need a new schema / index / core that declares the field, etc...


pagod wrote:
> 
> 
> henrib wrote:
>> It also makes replication or partitioning easier.
> Not sure what you mean by that... 
> 
Our solution was built on top Solr; all the query rewriting/expansion was
occurring before Solr localized searches. Since our server was sending the
queries and formatting the results, it was very easy to put indexes on
different machines. Solr also comes with replication and sharding (if you
need those); having multiple indexes makes things a tad easier to configure
wrt number of speakers of a given language.  


pagod wrote:
> 
> So if I understand correctly you'd always only search in one of the
> indices? In that case, I can understand why the multi-index solution works
> better for you. However, assuming most of my users speak at least English
> *and* one, two or three of the other languages, all searches have to be
> conducted in all languages.
> 
We were issuing one query per language the user selected as able to
comprehend. So if you spoke English, German and French, 3 queries were
performed. So, yes, all searches have to be conducted in all needed
languages.


pagod wrote:
> 
>  Besides, the various languages are not localized versions of the same
> content, they may really be anything in any language, depending on the
> person who wrote them and their mood at the time of writing. Some
> documents also contains parts in English and parts in German... I'm
> definitely thinking about making it possible to enable/disable some
> languages, but parallel searching will definitely be required. 
> 
Mixed language documents is not something I had to cope with... But I
suppose whatever solution you'll use to chunk which part of the doc is in
which language can be used by both indexing solutions.

pagod wrote:
> 
>> Besides, IMO, scoring / ordering documents in different
>> languages is a bit like comparing apples and oranges.
> ...Lucene's ranking algorithm is based on the number of tokens and the
> number of occurrences in fields,...
> 
Scoring is indeed a complex issue; tf/idf is not the sole scoring method
(BM25F comes to mind). The score being a ratio (/ best score), taking a
practical stance over academic, you can still use it as an ordering norm for
the sake of a better user experience even if it comes from different
indexes. You might also want to bias results ordering with other factors
like last-updated, ranking, etc.


> Finally, query expansion can also be used in the multiple indices case and
> might even use automated/guided translation.
I do agree about that, and I guess query expansion is much easier when
dealing with a single, consistent index structure. I'm thinking writing an
algorithm to automatically expand a query to all languages might be ok, but
I'm worried about the performance of performing such a query if the number
of languages grows larger....
</query>
This algo would work for single & multiple indexes; at least in the multiple
index case, you can partition easily and would the need arise, put localized
indexes on different machines.


pagod wrote:
> 
> One other problem I'm seeing with the multi-index solution is the ranking
> of documents that are spanned across several indices (multilingual
> documents). If say my search term matches a document in the English index
> and the same document in the French index (which would quite often be the
> case for e.g. proper names), then how do I get about mixing the two
> rankings? (as I don't want to display the same result twice) I think using
> a single index would solve that problem, since the ranking would already
> take all fields (hence all languages into account).
> 
If we consider a unique id for the same doc in different indexes (another
Solr recommended feature), nothing stops you from aggregating the scores
coming from each index (a weighted average for instance).


Anyway, my experience and its field might be too different for it to be
applicable to your case.
Cheers,
Henrib

-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p691166.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45682-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:25:00 2010
Return-Path: <java-user-return-45682-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81097 invoked from network); 2 Apr 2010 03:25:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:25:00 -0000
Received: (qmail 20506 invoked by uid 500); 2 Apr 2010 03:24:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20488 invoked by uid 500); 2 Apr 2010 03:24:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 46982 invoked by uid 99); 1 Apr 2010 21:21:19 -0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Date: Thu, 1 Apr 2010 13:20:51 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270156851858-691683.post@n3.nabble.com>
In-Reply-To: <612777.71114.qm@web24104.mail.ird.yahoo.com>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <612777.71114.qm@web24104.mail.ird.yahoo.com>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org



pagod wrote:
> 
> ... apply only in a particular situation:
> 
Very true, as often in the IR field :-) ; in our case, the "same" document
existed in different locales; these were localized technical docs which also
meant the dictionary (of important) terms was limited and used to influence
scoring.


pagod wrote:
> 
> 
> henrib wrote:
>> 
>> This allowed to have the same index structure across locales but
>> different settings for each (synonyms, stemmers, etc). Maintenance was
>> easier this way; when refining/updating the settings (say adding synonyms
>> or stemmers for instance), you may need to reindex and smaller indices
>> allow faster deployments.
>> 
> If I understand this correctly, that is true if you're indexing distinct
> collections of documents that are all in the same language, which you know
> in advance. In that case, you would of course only need to reindex one of
> these collections into the corresponding index to update it.
> 
Correct.

pagod wrote:
> 
>  In my case though, there is no such separation and only upon processing a
> document can I decide what language it is in. I therefore cannot decide to
> update only documents in one language, it's a "all or nothing". 
> 
As you write later, you perform language detection on the document before
you index. Thus you know - the virtue of one lang <=> one index - in which
index a given document needs to be put and can maintain the list of
documents that exist for a given language (intrinsically, those in the 'FR'
index are all in French). Pending you still have access to the raw content,
you can then reindex just those.


pagod wrote:
> 
> 
> henrib wrote:
>> 
>> It's also "dead-easy" to add a new language (esp. compared to the one
>> index solution).
>> 
> I'm not really sure why adding new languages should be complicated in the
> one-index solution: the languages I can process (i.e. languages for which
> I have recognition data and the proper analyzer) are listed in a
> configuration file. 
> 
Smart solution! With Solr, if you need to add a new field/language that was
not in the original schema/list, you need to reindex the whole. In the
multi-index solution, you just need to create a new index (Solr core).

pagod wrote:
>  
> Upon recognizing one of these languages, the module stores it in the
> internal data structure, which is then eventually passed to the indexing
> module. The latter retrieves the language from the structure and uses it
> to create the corresponding fields in the index dynamically (e.g.
> "content-de", "title-en" etc). It's all really automatic. 
> 
Ok. I'm biased by Solr which needs a schema defining all fields before hand;
you can't just decide to add a document which "declares" a new field. You
need a new schema / index / core that declares the field, etc...


pagod wrote:
> 
> 
> henrib wrote:
>> It also makes replication or partitioning easier.
> Not sure what you mean by that... 
> 
Our solution was built on top Solr; all the query rewriting/expansion was
occurring before Solr localized searches. Since our server was sending the
queries and formatting the results, it was very easy to put indexes on
different machines. Solr also comes with replication and sharding (if you
need those); having multiple indexes makes things a tad easier to configure
wrt number of speakers of a given language.  


pagod wrote:
> 
> So if I understand correctly you'd always only search in one of the
> indices? In that case, I can understand why the multi-index solution works
> better for you. However, assuming most of my users speak at least English
> *and* one, two or three of the other languages, all searches have to be
> conducted in all languages.
> 
We were issuing one query per language the user selected as able to
comprehend. So if you spoke English, German and French, 3 queries were
performed. So, yes, all searches have to be conducted in all needed
languages.


pagod wrote:
> 
>  Besides, the various languages are not localized versions of the same
> content, they may really be anything in any language, depending on the
> person who wrote them and their mood at the time of writing. Some
> documents also contains parts in English and parts in German... I'm
> definitely thinking about making it possible to enable/disable some
> languages, but parallel searching will definitely be required. 
> 
Mixed language documents is not something I had to cope with... But I
suppose whatever solution you'll use to chunk which part of the doc is in
which language can be used by both indexing solutions.

pagod wrote:
> 
>> Besides, IMO, scoring / ordering documents in different
>> languages is a bit like comparing apples and oranges.
> ...Lucene's ranking algorithm is based on the number of tokens and the
> number of occurrences in fields,...
> 
Scoring is indeed a complex issue; tf/idf is not the sole scoring method
(BM25F comes to mind). The score being a ratio (/ best score), taking a
practical stance over academic, you can still use it as an ordering norm for
the sake of a better user experience even if it comes from different
indexes. You might also want to bias results ordering with other factors
like last-updated, ranking, etc.


> Finally, query expansion can also be used in the multiple indices case and
> might even use automated/guided translation.
I do agree about that, and I guess query expansion is much easier when
dealing with a single, consistent index structure. I'm thinking writing an
algorithm to automatically expand a query to all languages might be ok, but
I'm worried about the performance of performing such a query if the number
of languages grows larger....
</query>
This algo would work for single & multiple indexes; at least in the multiple
index case, you can partition easily and would the need arise, put localized
indexes on different machines.


pagod wrote:
> 
> One other problem I'm seeing with the multi-index solution is the ranking
> of documents that are spanned across several indices (multilingual
> documents). If say my search term matches a document in the English index
> and the same document in the French index (which would quite often be the
> case for e.g. proper names), then how do I get about mixing the two
> rankings? (as I don't want to display the same result twice) I think using
> a single index would solve that problem, since the ranking would already
> take all fields (hence all languages into account).
> 
If we consider a unique id for the same doc in different indexes (another
Solr recommended feature), nothing stops you from aggregating the scores
coming from each index (a weighted average for instance).


Anyway, my experience and its field might be too different for it to be
applicable to your case.
Cheers,
Henrib

-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p691683.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45683-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:25:06 2010
Return-Path: <java-user-return-45683-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81157 invoked from network); 2 Apr 2010 03:25:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:25:05 -0000
Received: (qmail 22273 invoked by uid 500); 2 Apr 2010 03:25:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22245 invoked by uid 500); 2 Apr 2010 03:25:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 47634 invoked by uid 99); 1 Apr 2010 21:23:08 -0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Date: Thu, 1 Apr 2010 13:22:41 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270156961381-691687.post@n3.nabble.com>
In-Reply-To: <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <74458027-C184-4D74-9E23-451B07765F4E@activemath.org>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


By issuing multiple queries, one against each localized index, results being
clustered by locale. 
You can further refine by translating the end-user input query terms for
each locale and issue "translated" queries against the respective indices.
I've seen satisfying results with "key" terms dictionaries. 
-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p691687.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45684-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:25:47 2010
Return-Path: <java-user-return-45684-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81246 invoked from network); 2 Apr 2010 03:25:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:25:46 -0000
Received: (qmail 24156 invoked by uid 500); 2 Apr 2010 03:25:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 24090 invoked by uid 500); 2 Apr 2010 03:25:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 90644 invoked by uid 99); 1 Apr 2010 23:45:16 -0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Reply-To: <john@intercorpinc.com>
From: "John Viviano" <john@intercorpinc.com>
To: <java-user@lucene.apache.org>
Subject: Memory use and Lucene
Date: Thu, 1 Apr 2010 18:41:18 -0500
Organization: InterCorp, Inc.
Message-ID: <003701cad1f4$d8876de0$899649a0$@com>
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_0038_01CAD1CA.EFB165E0"
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrR9NM7POHZ4wKCRcOHX5vcIw2HYw==
Content-Language: en-us
X-Virus-Checked: Checked by ClamAV on apache.org

------=_NextPart_000_0038_01CAD1CA.EFB165E0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

All -

 

I have a question is about memory use and Lucene.  I'm not sure if I'm
dealing with a leak, or if I'm seeing expected behavior.  I'll preface this
by acknowledging that the "error" could be in my understanding of things.

 

I've included a lot of information below.  There is a demo program that
follows a pattern pretty close to what one segment of my application does.
There's output from 'top' as well as some info about my os and jvm.

 

My primary concern:  according to 'top' at startup, the application is
taking about 22MB.  After indexing, closing the indexWriter and running
garbage collection, 'top' reports that the program is about 170MB.  So is
this a leak?  Is this expected behavior?  Is it something where an allocator
doesn't return memory to the OS, perhaps for efficiency?  Something else?

 

-----------------  STARTING VALUES IN TOP --------------------

Mem:   1048576k total,   305252k used,   743324k free,        0k buffers

Swap:        0k total,        0k used,        0k free,        0k cached

 

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND

5422 jviviano  17   0  332m  21m 8320 S    0  2.1   0:00.28 java

 

-----------------  ENDING VALUES IN TOP --------------------

Mem:   1048576k total,   443572k used,   605004k free,        0k buffers

Swap:        0k total,        0k used,        0k free,        0k cached

 

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND

5422 jviviano  16   0  463m 166m 8568 S    0 16.2   0:03.97 java

 

I also use the java runtime values to report what java knows about memory
inside my program, as follows:

 

Starting free memory:   84,882,328 bytes

      Released by GC:    3,849,488 bytes

  Ending free memory:   84,562,360 bytes

  Unexplained losses:      319,968 bytes

 

By the way, if anyone has a better approach to understanding what's going on
with memory, I'm all ears.

 

Here's my sample code, followed by my environment:

----------------------------------------------------------------------------
-----------------

 

import java.io.IOException;

import java.util.*;

import java.io.File;

 

// Developed for Lucene-3.0.1

import org.apache.lucene.store.Directory;

import org.apache.lucene.store.FSDirectory;

import org.apache.lucene.index.IndexWriter;

import org.apache.lucene.analysis.Analyzer;

import org.apache.lucene.analysis.standard.StandardAnalyzer;

import org.apache.lucene.document.Document;

import org.apache.lucene.document.Field;

import org.apache.lucene.util.Version;

// No querying going on in this sample code

//import org.apache.lucene.search.Query;

//import org.apache.lucene.queryParser.QueryParser;

//import org.apache.lucene.queryParser.ParseException;

 

class MemoryQuestion

{

     static final int MAX_REPS = 1000; 

     static final String TEST_INDEX = "./testIndex/";

 

     private static void forceGarbageCollection(Runtime r)

     {

           r.gc();

     }

 

    private static long checkAvailableMemory(Runtime r)

     {

           long availableMemory = r.maxMemory() - (r.totalMemory() -
r.freeMemory());

           return availableMemory;

     }

 

     public static void main(String[] args) throws IOException 

     {

        // Get a Runtime object to help manage garbage collection

        Runtime r = Runtime.getRuntime();

           

           String[] testData = new String[] {  

                           "Lorem ipsum dolor sit amet, consectetur
adipiscing elit.",

                           "Praesent blandit lacinia sem vel pulvinar.",

                           "Ut pellentesque tellus sit amet felis mollis
semper.",

                           "Sed eleifend, nisi ac placerat aliquam, elit
ligula fermentum purus, ut placerat mauris tortor vitae nisl.",

                           "Curabitur nec urna sed sem dapibus rutrum.",

                           "Curabitur sodales venenatis tellus.",

                           "Donec lacus metus, euismod eget dictum quis,
feugiat ut magna.",

                           "Ut eget faucibus lorem.",

                           "Pellentesque habitant morbi tristique senectus
et netus et malesuada fames ac turpis egestas.",

                           "Nulla urna nisi, eleifend id consectetur at,
ornare id metus.",

                           "Phasellus dictum sodales augue, vitae auctor
tortor ultricies ut.",

                           "Nam ullamcorper varius est, vel ultrices turpis
laoreet eu. Nunc id leo vitae felis faucibus ornare."

                     };

 

 

           // create a directory called testIndex in the working directory

           // and an IndexWriter

           Directory dir = FSDirectory.open(new File(TEST_INDEX));

           IndexWriter indexWriter  = new IndexWriter(dir,

                                                            new
StandardAnalyzer(Version.LUCENE_CURRENT),

 
IndexWriter.MaxFieldLength.LIMITED);

           // if you want to experiment with different buffer sizes

           // indexWriter.setRAMBufferSizeMB(8.0);

 

           // start as clean as you can

           forceGarbageCollection(r);

           long startingMemory = checkAvailableMemory(r);

                

           // loop through the array of testData strings MAX_REP times

           //     create a new document for each string and add it to the
index

           //     commit the index at the end of each loop

           // close the index

           for (int i=0; i< MAX_REPS ; i++ )

           {

                System.out.print('.');

 

                for (String text : testData) {

                     Document doc = new Document();

                     doc.add(new Field("text",text,

                                     Field.Store.YES,Field.Index.ANALYZED));

                     indexWriter.addDocument(doc);

                     doc = null;

                }

                indexWriter.commit();

           }

           indexWriter.close();

           indexWriter = null;

 

           // get memory stats before and after forcing garbage collection

           long pre_gcMemory = checkAvailableMemory(r);

           forceGarbageCollection(r);

           long endingMemory = checkAvailableMemory(r);

 

           Formatter f = new Formatter();

           System.out.println("");

           System.out.printf("Starting free memory: %,12d bytes %n",
startingMemory);

           System.out.printf("      Released by GC: %,12d bytes %n",
endingMemory - pre_gcMemory);

           System.out.printf("  Ending free memory: %,12d bytes %n",
endingMemory);

           System.out.printf("  Unexplained losses: %,12d bytes %n",
startingMemory - endingMemory);

           System.out.println("Ctrl-C to exit -- you may want to check
memory use as reported by 'top'");

           while (true)

           {

                try {

                     Thread.sleep(100);

                } catch(Exception e)

                {

                     System.out.println(e);

                }    

           }

 

     }

}

 

----------------------------------------------------------------------------
-----------------

My OS and JVM versions are as follows:

 

Linux version 2.6.18-028stab066.10 (root@rhel5-64-build) (gcc version 4.1.2
20070626 (Red Hat 4.1.2-14)) #1 SMP Fri Dec 4 15:49:04 MSK 2009

 

java version "1.6.0_17"

Java(TM) SE Runtime Environment (build 1.6.0_17-b04)

Java HotSpot(TM) 64-Bit Server VM (build 14.3-b01, mixed mode)

 

 

Thanks,

John Viviano

 <mailto:john@intercorpinc.com> john@intercorpinc.com

 

 

InterCorp, Inc.

11469 Olive Blvd, Ste. 225

St. Louis, MO 63141

314.610.5276

 

 <http://www.intercorpinc.com/> www.intercorpinc.com

"The problems that exist in the world today cannot
be solved by the level of thinking that created them."
- Albert Einstein

 


------=_NextPart_000_0038_01CAD1CA.EFB165E0--




From java-user-return-45685-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 03:25:52 2010
Return-Path: <java-user-return-45685-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81281 invoked from network); 2 Apr 2010 03:25:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 03:25:52 -0000
Received: (qmail 25877 invoked by uid 500); 2 Apr 2010 03:25:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25854 invoked by uid 500); 2 Apr 2010 03:25:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 45702 invoked by uid 99); 2 Apr 2010 01:40:58 -0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jeacott1@gmail.com designates 74.125.92.25 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received:date
         :x-google-sender-auth:received:message-id:subject:from:to
         :content-type;
        bh=pmEBuGaijbfYe4rcNkLPkpSpTyxvlEL2oAmx/zGAykI=;
        b=ZWYb00ohkDlqopynpqY/lzRSyMVL9xerWiTVt2Bjc2vZXWnGCFzLe+FF5rtU7+tF/p
         xyOxVcPo12Hvl+2Y6ibPQKc0gPdPOyjzk07FManvgb3bWFexZxg1GfF7J/iq+oBLeJHG
         NwCCjBn6STKnj/QdSrdPxqZ5+19QH2HKbP+Jg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:date:x-google-sender-auth:message-id
         :subject:from:to:content-type;
        b=FzhK4YYOpi5oIH0FFx6Fh/K5okHxsfVQxE0jp3NMmwYDajjpjBl2ur8te7w8cIg2c0
         gGOO878fke9LVyEsPMAlrBgAaD3TLZCLyE8wfxz2lI7+g86Jidel+qtOxH5ybM6p5zm9
         EGesWUwoYZmSC0rGnBULrCJzCMCGdSUB9Bp3o=
MIME-Version: 1.0
Sender: jeacott1@gmail.com
Reply-To: jeacott@hardlight.com.au
Date: Fri, 2 Apr 2010 10:40:31 +0900
X-Google-Sender-Auth: d6176fbec2289ad5
Message-ID: <o2r279092301004011840r48ad87adm9a2598698cfb681f@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: Jason Eacott <jason@hardlight.com.au>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Thanks for the ref - didn't know about Pig before.
the language and approach looks useful, so now I'm wondering if it
couldn't be used
across lucene over hadoop too. If data was indexed in lucene and Pig knew that,
then it could make for an interesting alternate lucene query language.

could this work?


prasenjit mukherjee wrote:
> This looks like a use case more suited  for Pig ( over Hadoop ).
>
> It could be difficult for lucene to do sort and sum simultaneously as
> sorting itself depends upon summed value.
>
> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com> wrote:
>> Well that's my problem: we have a lot of records of all types (afiiliates,
>> sales) so looping tons of records each time isn't possible.
>>
>> - Mike
>> akaris@gmail.com
>>
>>
>> On Thu, Apr 1, 2010 at 2:11 PM, prasenjit mukherjee <prasen.bea@gmail.com>wrote:
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45686-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 04:55:27 2010
Return-Path: <java-user-return-45686-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94188 invoked from network); 2 Apr 2010 04:55:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 04:55:27 -0000
Received: (qmail 73383 invoked by uid 500); 2 Apr 2010 04:55:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73257 invoked by uid 500); 2 Apr 2010 04:55:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73249 invoked by uid 99); 2 Apr 2010 04:55:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 04:55:24 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of suman.holani@zapak.co.in designates 220.226.181.11 as permitted sender)
Received: from [220.226.181.11] (HELO mail.zapak.co.in) (220.226.181.11)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 02 Apr 2010 04:55:18 +0000
Received: (qmail 18702 invoked by uid 508); 2 Apr 2010 04:54:54 -0000
Comment: DomainKeys? See http://antispam.yahoo.com/domainkeys
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=default; d=zapak.co.in;
  b=oOU1bREe5iTtU6nXDX4kai2n8NDKZDs10TWp1WcZ10dvWsjfeKkpB07Eac2k1qHt  ;
Received: from localhost (HELO www.mail.zapak.co.in) (127.0.0.1)
  by mail.zapak.co.in with SMTP; 2 Apr 2010 04:54:54 -0000
MIME-Version: 1.0
Date: Fri, 02 Apr 2010 10:24:54 +0530
From: <suman.holani@zapak.co.in>
To: <java-user@lucene.apache.org>
Subject: Re: query: order of search
In-Reply-To: <g2q359a92831004010842y62b285dfs3e8f0a53741bda3e@mail.gmail.com>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com> <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com> <e13f18ad7b10cc633edd32e51d335f7a@localhost> <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com> <22b5f5f44f786a63b4f54df70ddfc4d6@localhost> <g2q359a92831004010842y62b285dfs3e8f0a53741bda3e@mail.gmail.com>
Message-ID: <860ead00c811e180046c5563a1afe7b9@localhost>
X-Sender: suman.holani@zapak.co.in
User-Agent: RoundCube Webmail/0.3.1
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8

Hello Erick,

I was trying to optimise the searching.
Basically my data is like field1 has less no of docs matching compared to
field2, which has larget sets.

So if search goes by order to order, then i can make field1 to be search
first, (by making  order of boolean query such  )and from thr the docs
result set could be searched for field2. 
So number of docs to be matched will be less.
I am not using filters or any caching since the search is unique everytime
acc to parameter, and its using boolean query


or is the searching takes place like searches each doc for  field1="abc"
and field2="def" then get resultset

I hope I am clear in explaining my query. 

thanks,
Suman



On Thu, 1 Apr 2010 08:42:16 -0700, Erick Erickson
<erickerickson@gmail.com>
wrote:
> Why do you care? By that I mean "what problem are you trying to solve"
> (See "The XY problem at http://people.apache.org/~hossman/). The reason
> I'm asking here is that very often, when people ask this kind of
question
> without providing background, they're trying the wrong approach to solve
> a problem.
> 
> Unless you're asking for theoretical reasons, I almost guarantee that
> trying
> to solve any problem in Lucene by changing the order of the clauses
isn't
> going to do you much good in the long run, there'll *always* be variant
> n+1...
> 
> Best
> Erick
> 
> On Thu, Apr 1, 2010 at 2:21 AM, <suman.holani@zapak.co.in> wrote:
> 
>>
>> Query I
>>
>> its written "to do a "search within search", so that the second search
is
>> constrained by the results of the first query"
>> we can use boolean query.
>> So doesn't it mean the order of query ll be preserved
>>
>> give me an simple example of how the docs get searched in lucene.
>> 10 docs with 3 fields to b searched
>> so ll it search for field1 for all 10 docs..and the result set docs ll
b
>> then searched for field2....and so far...
>> or is it something else..
>>
>>
>>
>> thanks,
>> Suman
>>
>> On Thu, 1 Apr 2010 10:05:01 +0100, Ian Lea <ian.lea@gmail.com> wrote:
>> >> Query I
>> >> Does the order of query play role in searching
>> >> example:doc has fields
>> >> rollno(pk), name, marks
>> >>
>> >> Query : marks=90&rollno=2&name=abc
>> >>
>> >> Query :rollno=2&name=abc&marks=90
>> >>
>> >> which query processing will be more efficient.
>> >> is it work like search doc field by field , it will look for doc
>> >> having
>> >> rollno=2 then from thos will look for name abc and from the selected
>> docs
>> >> will again look for marks param .
>> >
>> > I don't think it makes any difference.
>> >
>> >
>> >> Query II
>> >>  which  is more faster .
>> >> a)  adding one more multivalued field into current index(large)
>> >> b)  or creating a separate index for the field and searching it as a
>> >> subindex .
>> >> My main apprehensions is in regard to large size of index
>> >
>> > Probably your first option.
>> >
>> >
>> > --
>> > Ian.
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45691-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 13:53:18 2010
Return-Path: <java-user-return-45691-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26304 invoked from network); 2 Apr 2010 13:53:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 13:53:18 -0000
Received: (qmail 52556 invoked by uid 500); 2 Apr 2010 12:51:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52515 invoked by uid 500); 2 Apr 2010 12:51:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52507 invoked by uid 99); 2 Apr 2010 12:51:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 12:51:16 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of gsiasf@gmail.com designates 209.85.217.220 as permitted sender)
Received: from [209.85.217.220] (HELO mail-gx0-f220.google.com) (209.85.217.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 12:51:08 +0000
Received: by gxk20 with SMTP id 20so1489222gxk.12
        for <java-user@lucene.apache.org>; Fri, 02 Apr 2010 05:50:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:content-type
         :mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        bh=z5ENvW7UCOscT1VIbV6G8TNPsWNtQswCy9CaZxFeV3s=;
        b=eJt0mPTDLUioDOFlXIhpR/VnrCvG56fttvz1FImlpiYsMTegsOkX01wXasH5EWhHYr
         ryxQvIsY2djYFPSL33XqHrfQxlwNDPfr+1lm/EY7Qz/iUxvp3W/54ss/rkEmYUzTb9kw
         wy03Y38POJr03nGTKzpf7UuQWjEqY3bjFBmNU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=IksTfnRyh3oiVIEAbEH9Zk6qyRn06oXc95iWtyt6cAY1u9Gf2JRyzhnk1+NyFIsScx
         IpGR5KTgaqbsjI2Nqmywg2XKW6tAv+HmoKTcG5uzM9dyoVBkU5/7pxD+3JKnD2kaXAWM
         5ualqi3zyCoK0MoLWb8vKPhT5+7A6PMUV8W3w=
Received: by 10.150.172.1 with SMTP id u1mr2989277ybe.240.1270212647884;
        Fri, 02 Apr 2010 05:50:47 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id 13sm5914948gxk.12.2010.04.02.05.50.46
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 02 Apr 2010 05:50:47 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1078)
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <l2q962c93f61004012013q956e23a0s65318dfefd86013d@mail.gmail.com>
Date: Fri, 2 Apr 2010 08:50:46 -0400
Content-Transfer-Encoding: quoted-printable
Message-Id: <98BA165B-729D-4F83-85AC-69D9EFDF439B@apache.org>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>  <p2r962c93f61004010646r79652890uaa39fadc8be21bb4@mail.gmail.com>  <v2k500e4a1e1004011111m20fbafe5vef7febe692598ce4@mail.gmail.com>  <r2i962c93f61004011117j372aa6b6i29a1fa3517e2a554@mail.gmail.com>  <u2t500e4a1e1004011133ha4a36b54yb86870a74da2eb15@mail.gmail.com>  <4BB4F2F5.4090404@gmail.com> <n2z500e4a1e1004011313l34b50a8dx54441b02a03138d4@mail.gmail.com>  <4BB509FA.1050808@gmail.com> <s2t962c93f61004011425v991794edk2e6b9c4e40e7d65e@mail.gmail.com>  <4BB510C5.3000401@gmail.com> <l2q962c93f61004012013q956e23a0s65318dfefd86013d@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1078)


On Apr 1, 2010, at 11:13 PM, Michel Nadeau wrote:

> My big question is how do you loop 1M records, sum up field(s), and =
then
> sort on that field... all in memory (could use too much ram) ?  In a
> temporary index (could take a while to re-write a lot of documents in =
a new
> index) ?
>=20

You're going to need to do some combination of Collector, FieldCache and =
the existing Sort code.  Doesn't Solr's StatsComponent work for this?


-Grant=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45688-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 14:04:20 2010
Return-Path: <java-user-return-45688-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 38370 invoked from network); 2 Apr 2010 14:04:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 14:04:19 -0000
Received: (qmail 13427 invoked by uid 500); 2 Apr 2010 08:32:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13212 invoked by uid 500); 2 Apr 2010 08:32:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13204 invoked by uid 99); 2 Apr 2010 08:32:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 08:32:56 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 08:32:49 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <henrib@apache.org>)
	id 1NxcIm-0007fZ-Mx
	for java-user@lucene.apache.org; Fri, 02 Apr 2010 01:32:28 -0700
Date: Fri, 2 Apr 2010 00:32:28 -0800 (PST)
From: henrib <henrib@apache.org>
To: java-user@lucene.apache.org
Message-ID: <1270197148704-692481.post@n3.nabble.com>
In-Reply-To: <A98F216E-554B-402D-9879-3AC03E1928CF@activemath.org>
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <74458027-C184-4D74-9E23-451B07765F4E@activemath.org> <1270132147122-690881.post@n3.nabble.com> <A98F216E-554B-402D-9879-3AC03E1928CF@activemath.org>
Subject: Re: Designing a multilingual index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


I agree that if you dont know the "source" language - or can't determine it -
there is a lot of uncertainty in trying to transmogriphy the query from one
language to another!  TIKA and Nutch do have language determination tools
though (ngram profiles if I'm not mistaken). And you also can interact with
the end-user before issuing the query to confirm the language if
necessary("did you mean" kind of feature).
Assuming you can determine the query language and you do have "dictionaries"
of important terms per field, I tend to think you increase precision.

The simple route is to ignore the language, use ngrams, forget stemmers & al
and just fire; recall will likely be good, precision not that much.

Cheers

Henrib
-- 
View this message in context: http://n3.nabble.com/Designing-a-multilingual-index-tp688766p692481.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45692-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 14:20:35 2010
Return-Path: <java-user-return-45692-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52847 invoked from network); 2 Apr 2010 14:20:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 14:20:35 -0000
Received: (qmail 59846 invoked by uid 500); 2 Apr 2010 14:20:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59787 invoked by uid 500); 2 Apr 2010 14:20:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59778 invoked by uid 99); 2 Apr 2010 14:20:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 14:20:33 +0000
X-ASF-Spam-Status: No, hits=-0.2 required=10.0
	tests=AWL,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ctignor@thinkmap.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 14:20:26 +0000
Received: by ywh38 with SMTP id 38so1425015ywh.29
        for <java-user@lucene.apache.org>; Fri, 02 Apr 2010 07:20:05 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.100.46.3 with HTTP; Fri, 2 Apr 2010 07:20:05 -0700 (PDT)
Date: Fri, 2 Apr 2010 10:20:05 -0400
Received: by 10.100.233.7 with SMTP id f7mr5557720anh.91.1270218005263; Fri, 
	02 Apr 2010 07:20:05 -0700 (PDT)
Message-ID: <z2g6f287d1b1004020720w6c1d5de4icd5a30a1716af5c4@mail.gmail.com>
Subject: custom scoring help
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=001636b2b159fdb7db048341acd7

--001636b2b159fdb7db048341acd7
Content-Type: text/plain; charset=ISO-8859-1

Hello,

I'm having a hard time implementing / understanding a very simple custom
scoring situation.

I have created my Similarity class for testing which overrides all the
relevant (I think) methods below, returning 1 for all but coord(int, int)
which returns q / maxOverlap so scores are scaled between 0. and 1..

I call writer.setSimilarity(new HashHitSimilarity()) when indexing
and searcher.setSimilarity(new HashHitSimilarity()) when searching.

The similarity is definitely affecting the scoring but not how I expect.  I
am looking for a straight average of the hits calculated, i.e.
totalHits for a doc / totalHits in search.

The above score with my test search and index of 6 docs should return the
scores below for all 6 documents in my index:

0.8387096774193549
0.3548387096774194
0.3548387096774194
0.25806451612903225
0.1935483870967742
0.12903225806451613

but the scores appear "stretched" and return these instead though I'm unsure
as to where this "stretching" happens:

0.9078212
0.75977653
0.57541895
0.5670391
0.5223464
0.37150836

public class HashHitSimilarity extends Similarity {

    /**
     *
     */
    private static final long serialVersionUID = 811419737205284733L;

    public float tf(float freq) {
        return 1f;
    }

    public float lengthNorm(String fieldName, int numTokens) {
        return 1f;
    }

    public float queryNorm(float sumOfSquaredWeights) {
        return 1f;
    }

    @Override
    public float coord(int overlap, int maxOverlap) {
        return 1f / (float) maxOverlap;
    }

    @Override
    public float idf(int docFreq, int numDocs) {
        return 1f;
    }

    @Override
    public float sloppyFreq(int distance) {
        return 0f;
    }

}




-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--001636b2b159fdb7db048341acd7--

From java-user-return-45690-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 14:25:56 2010
Return-Path: <java-user-return-45690-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56205 invoked from network); 2 Apr 2010 14:25:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 14:25:56 -0000
Received: (qmail 80742 invoked by uid 500); 2 Apr 2010 11:35:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80674 invoked by uid 500); 2 Apr 2010 11:35:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80666 invoked by uid 99); 2 Apr 2010 11:35:54 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 11:35:54 +0000
X-ASF-Spam-Status: No, hits=0.6 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of prasen.bea@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 11:35:48 +0000
Received: by vws14 with SMTP id 14so1081320vws.35
        for <java-user@lucene.apache.org>; Fri, 02 Apr 2010 04:35:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=FopIHIVE4Oudsth0iQwMLoiWvtCDtV1lO0ZcLTsrlhA=;
        b=G78RWT6SWMQRNtH1lZNtkYGcpu83pKljtTfNmBSfPXKbNWBkBKSrswVaBeNYb9KItK
         d7akDpgd+zLS5r7kp+Ju38LwStDlnrljwAzFu0jURuxKTPZNUuLn+5uXBoiDzt9w4Chw
         YGGqqtmI4yEoKJx3NHAHEtlU62yKekFYAKRfg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=WXSKD8yRX4Vp3Si2YdMn9nalSjVzNA7xjVBon/s5WqVU/QdyYZhXbFR/hqNjG6yIV1
         FVipZdYmAHbCMwFIfkybF3TPjcL39sm3q6D7UNSdZSXi+cmLxElwkGTaT1OkwQgyaWY8
         klnBeDNRO0zTW0G6X63mRflAPmAE0bz7vZi7Y=
MIME-Version: 1.0
Received: by 10.220.10.195 with HTTP; Fri, 2 Apr 2010 04:35:27 -0700 (PDT)
In-Reply-To: <o2r279092301004011840r48ad87adm9a2598698cfb681f@mail.gmail.com>
References: <o2r279092301004011840r48ad87adm9a2598698cfb681f@mail.gmail.com>
Date: Fri, 2 Apr 2010 07:35:27 -0400
Received: by 10.220.107.94 with SMTP id a30mr1106378vcp.15.1270208128036; Fri, 
	02 Apr 2010 04:35:28 -0700 (PDT)
Message-ID: <t2y500e4a1e1004020435l5f7d921dx196f73c10fd46959@mail.gmail.com>
Subject: Re: Lucene Challenge - sum, count, avg, etc.
From: prasenjit mukherjee <prasen.bea@gmail.com>
To: java-user@lucene.apache.org, jeacott@hardlight.com.au
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Pig generally takes csv-type flat files as input. And then you do
join/group-by/sum/count etc on the variables ( aka relations )

For Michael's example with following data:

*Affiliate / SaleDate / SaleAmount*
* mike / 2010-03-01 / 10.00
* john / 2010-03-01 / 10.00

One can write following pig-script :

r1 =3D load 'data.csv' as ( affiliate:string, saledate:string, amount:int )
r1 =3D filter r1 by saledate > my_udf_convert_in_secs(2010-03-01) AND
saledate < my_udf_convert_in_secs(2010-03-06)
r2 =3D group r1 by affiliate;
r3 =3D foreach r2 generate affiliate, SUM(amount) as totalrevenue;
r3 =3D order r3 by totalrevenue;
DUMP r3 into 'output.csv'

Remember that its only because of the additional sorting requirement
that we are forced to use pig, otherwise lucene can do the job (
except the sorting ) much faster.

-Prasen

On Thu, Apr 1, 2010 at 9:40 PM, Jason Eacott <jason@hardlight.com.au> wrote=
:
> Thanks for the ref - didn't know about Pig before.
> the language and approach looks useful, so now I'm wondering if it
> couldn't be used
> across lucene over hadoop too. If data was indexed in lucene and Pig knew=
 that,
> then it could make for an interesting alternate lucene query language.
>
> could this work?
>
>
> prasenjit mukherjee wrote:
>> This looks like a use case more suited =A0for Pig ( over Hadoop ).
>>
>> It could be difficult for lucene to do sort and sum simultaneously as
>> sorting itself depends upon summed value.
>>
>> On Thu, Apr 1, 2010 at 11:47 PM, Michel Nadeau <akaris@gmail.com> wrote:
>>> Well that's my problem: we have a lot of records of all types (afiiliat=
es,
>>> sales) so looping tons of records each time isn't possible.
>>>
>>> - Mike
>>> akaris@gmail.com
>>>
>>>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45689-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 14:44:56 2010
Return-Path: <java-user-return-45689-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69824 invoked from network); 2 Apr 2010 14:44:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 14:44:56 -0000
Received: (qmail 39228 invoked by uid 500); 2 Apr 2010 09:13:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39052 invoked by uid 500); 2 Apr 2010 09:13:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39036 invoked by uid 99); 2 Apr 2010 09:13:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 09:13:34 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.184] (HELO mail-yx0-f184.google.com) (209.85.210.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 09:13:27 +0000
Received: by yxe14 with SMTP id 14so949778yxe.5
        for <java-user@lucene.apache.org>; Fri, 02 Apr 2010 02:13:06 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.114.2 with HTTP; Fri, 2 Apr 2010 02:13:05 -0700 (PDT)
In-Reply-To: <003701cad1f4$d8876de0$899649a0$@com>
References: <AcrR9NM7POHZ4wKCRcOHX5vcIw2HYw==>
	 <003701cad1f4$d8876de0$899649a0$@com>
Date: Fri, 2 Apr 2010 05:13:05 -0400
Received: by 10.150.128.30 with SMTP id a30mr2526546ybd.128.1270199585901; 
	Fri, 02 Apr 2010 02:13:05 -0700 (PDT)
Message-ID: <z2g9ac0c6aa1004020213q666741d4t7181dc7edd3edea9@mail.gmail.com>
Subject: Re: Memory use and Lucene
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org, john@intercorpinc.com
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

OS level tools (top, ps, activity monitor, task manager) aren't great
ways to measure Java's memory usage, since they only see how much heap
java has allocated from the OS.  Within that heap, java can have lots
of free space that it knows about but the OS does not (this is
Runtime.freeMemory()).

You can try restricting the heap size java is allowed to use (java
-Xmx) -- keep reducing it until you hit OOME to see how much "real"
memory is required.  But: don't run, in general, with such a tight
heap.  First off it's a real performance hit (GC runs "hot").  Second
off, there's always the risk that something needs to temporarily
allocate something big and then free it and that thing will hit OOME.
It'd be like an airplane flying over a mountain range just a wee bit
over what it thinks is the highest peak...

Note that Runtime.gc() does not guarantee it actually runs.

If you want to dig, use a memory profiler or heap dump to see what's
still reachable...

Mike

On Thu, Apr 1, 2010 at 7:41 PM, John Viviano <john@intercorpinc.com> wrote:
> All -
>
>
>
> I have a question is about memory use and Lucene. =A0I'm not sure if I'm
> dealing with a leak, or if I'm seeing expected behavior. =A0I'll preface =
this
> by acknowledging that the "error" could be in my understanding of things.
>
>
>
> I've included a lot of information below. =A0There is a demo program that
> follows a pattern pretty close to what one segment of my application does=
.
> There's output from 'top' as well as some info about my os and jvm.
>
>
>
> My primary concern: =A0according to 'top' at startup, the application is
> taking about 22MB. =A0After indexing, closing the indexWriter and running
> garbage collection, 'top' reports that the program is about 170MB. =A0So =
is
> this a leak? =A0Is this expected behavior? =A0Is it something where an al=
locator
> doesn't return memory to the OS, perhaps for efficiency? =A0Something els=
e?
>
>
>
> ----------------- =A0STARTING VALUES IN TOP --------------------
>
> Mem: =A0 1048576k total, =A0 305252k used, =A0 743324k free, =A0 =A0 =A0 =
=A00k buffers
>
> Swap: =A0 =A0 =A0 =A00k total, =A0 =A0 =A0 =A00k used, =A0 =A0 =A0 =A00k =
free, =A0 =A0 =A0 =A00k cached
>
>
>
> =A0PID USER =A0 =A0 =A0PR =A0NI =A0VIRT =A0RES =A0SHR S %CPU %MEM =A0 =A0=
TIME+ =A0COMMAND
>
> 5422 jviviano =A017 =A0 0 =A0332m =A021m 8320 S =A0 =A00 =A02.1 =A0 0:00.=
28 java
>
>
>
> ----------------- =A0ENDING VALUES IN TOP --------------------
>
> Mem: =A0 1048576k total, =A0 443572k used, =A0 605004k free, =A0 =A0 =A0 =
=A00k buffers
>
> Swap: =A0 =A0 =A0 =A00k total, =A0 =A0 =A0 =A00k used, =A0 =A0 =A0 =A00k =
free, =A0 =A0 =A0 =A00k cached
>
>
>
> =A0PID USER =A0 =A0 =A0PR =A0NI =A0VIRT =A0RES =A0SHR S %CPU %MEM =A0 =A0=
TIME+ =A0COMMAND
>
> 5422 jviviano =A016 =A0 0 =A0463m 166m 8568 S =A0 =A00 16.2 =A0 0:03.97 j=
ava
>
>
>
> I also use the java runtime values to report what java knows about memory
> inside my program, as follows:
>
>
>
> Starting free memory: =A0 84,882,328 bytes
>
> =A0 =A0 =A0Released by GC: =A0 =A03,849,488 bytes
>
> =A0Ending free memory: =A0 84,562,360 bytes
>
> =A0Unexplained losses: =A0 =A0 =A0319,968 bytes
>
>
>
> By the way, if anyone has a better approach to understanding what's going=
 on
> with memory, I'm all ears.
>
>
>
> Here's my sample code, followed by my environment:
>
> -------------------------------------------------------------------------=
---
> -----------------
>
>
>
> import java.io.IOException;
>
> import java.util.*;
>
> import java.io.File;
>
>
>
> // Developed for Lucene-3.0.1
>
> import org.apache.lucene.store.Directory;
>
> import org.apache.lucene.store.FSDirectory;
>
> import org.apache.lucene.index.IndexWriter;
>
> import org.apache.lucene.analysis.Analyzer;
>
> import org.apache.lucene.analysis.standard.StandardAnalyzer;
>
> import org.apache.lucene.document.Document;
>
> import org.apache.lucene.document.Field;
>
> import org.apache.lucene.util.Version;
>
> // No querying going on in this sample code
>
> //import org.apache.lucene.search.Query;
>
> //import org.apache.lucene.queryParser.QueryParser;
>
> //import org.apache.lucene.queryParser.ParseException;
>
>
>
> class MemoryQuestion
>
> {
>
> =A0 =A0 static final int MAX_REPS =3D 1000;
>
> =A0 =A0 static final String TEST_INDEX =3D "./testIndex/";
>
>
>
> =A0 =A0 private static void forceGarbageCollection(Runtime r)
>
> =A0 =A0 {
>
> =A0 =A0 =A0 =A0 =A0 r.gc();
>
> =A0 =A0 }
>
>
>
> =A0 =A0private static long checkAvailableMemory(Runtime r)
>
> =A0 =A0 {
>
> =A0 =A0 =A0 =A0 =A0 long availableMemory =3D r.maxMemory() - (r.totalMemo=
ry() -
> r.freeMemory());
>
> =A0 =A0 =A0 =A0 =A0 return availableMemory;
>
> =A0 =A0 }
>
>
>
> =A0 =A0 public static void main(String[] args) throws IOException
>
> =A0 =A0 {
>
> =A0 =A0 =A0 =A0// Get a Runtime object to help manage garbage collection
>
> =A0 =A0 =A0 =A0Runtime r =3D Runtime.getRuntime();
>
>
>
> =A0 =A0 =A0 =A0 =A0 String[] testData =3D new String[] {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Lorem ipsum dolor si=
t amet, consectetur
> adipiscing elit.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Praesent blandit lac=
inia sem vel pulvinar.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Ut pellentesque tell=
us sit amet felis mollis
> semper.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Sed eleifend, nisi a=
c placerat aliquam, elit
> ligula fermentum purus, ut placerat mauris tortor vitae nisl.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Curabitur nec urna s=
ed sem dapibus rutrum.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Curabitur sodales ve=
nenatis tellus.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Donec lacus metus, e=
uismod eget dictum quis,
> feugiat ut magna.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Ut eget faucibus lor=
em.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Pellentesque habitan=
t morbi tristique senectus
> et netus et malesuada fames ac turpis egestas.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Nulla urna nisi, ele=
ifend id consectetur at,
> ornare id metus.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Phasellus dictum sod=
ales augue, vitae auctor
> tortor ultricies ut.",
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 "Nam ullamcorper vari=
us est, vel ultrices turpis
> laoreet eu. Nunc id leo vitae felis faucibus ornare."
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 };
>
>
>
>
>
> =A0 =A0 =A0 =A0 =A0 // create a directory called testIndex in the working=
 directory
>
> =A0 =A0 =A0 =A0 =A0 // and an IndexWriter
>
> =A0 =A0 =A0 =A0 =A0 Directory dir =3D FSDirectory.open(new File(TEST_INDE=
X));
>
> =A0 =A0 =A0 =A0 =A0 IndexWriter indexWriter =A0=3D new IndexWriter(dir,
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0new
> StandardAnalyzer(Version.LUCENE_CURRENT),
>
>
> IndexWriter.MaxFieldLength.LIMITED);
>
> =A0 =A0 =A0 =A0 =A0 // if you want to experiment with different buffer si=
zes
>
> =A0 =A0 =A0 =A0 =A0 // indexWriter.setRAMBufferSizeMB(8.0);
>
>
>
> =A0 =A0 =A0 =A0 =A0 // start as clean as you can
>
> =A0 =A0 =A0 =A0 =A0 forceGarbageCollection(r);
>
> =A0 =A0 =A0 =A0 =A0 long startingMemory =3D checkAvailableMemory(r);
>
>
>
> =A0 =A0 =A0 =A0 =A0 // loop through the array of testData strings MAX_REP=
 times
>
> =A0 =A0 =A0 =A0 =A0 // =A0 =A0 create a new document for each string and =
add it to the
> index
>
> =A0 =A0 =A0 =A0 =A0 // =A0 =A0 commit the index at the end of each loop
>
> =A0 =A0 =A0 =A0 =A0 // close the index
>
> =A0 =A0 =A0 =A0 =A0 for (int i=3D0; i< MAX_REPS ; i++ )
>
> =A0 =A0 =A0 =A0 =A0 {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.print('.');
>
>
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0for (String text : testData) {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Document doc =3D new Document();
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 doc.add(new Field("text",text,
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 F=
ield.Store.YES,Field.Index.ANALYZED));
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexWriter.addDocument(doc);
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 doc =3D null;
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWriter.commit();
>
> =A0 =A0 =A0 =A0 =A0 }
>
> =A0 =A0 =A0 =A0 =A0 indexWriter.close();
>
> =A0 =A0 =A0 =A0 =A0 indexWriter =3D null;
>
>
>
> =A0 =A0 =A0 =A0 =A0 // get memory stats before and after forcing garbage =
collection
>
> =A0 =A0 =A0 =A0 =A0 long pre_gcMemory =3D checkAvailableMemory(r);
>
> =A0 =A0 =A0 =A0 =A0 forceGarbageCollection(r);
>
> =A0 =A0 =A0 =A0 =A0 long endingMemory =3D checkAvailableMemory(r);
>
>
>
> =A0 =A0 =A0 =A0 =A0 Formatter f =3D new Formatter();
>
> =A0 =A0 =A0 =A0 =A0 System.out.println("");
>
> =A0 =A0 =A0 =A0 =A0 System.out.printf("Starting free memory: %,12d bytes =
%n",
> startingMemory);
>
> =A0 =A0 =A0 =A0 =A0 System.out.printf(" =A0 =A0 =A0Released by GC: %,12d =
bytes %n",
> endingMemory - pre_gcMemory);
>
> =A0 =A0 =A0 =A0 =A0 System.out.printf(" =A0Ending free memory: %,12d byte=
s %n",
> endingMemory);
>
> =A0 =A0 =A0 =A0 =A0 System.out.printf(" =A0Unexplained losses: %,12d byte=
s %n",
> startingMemory - endingMemory);
>
> =A0 =A0 =A0 =A0 =A0 System.out.println("Ctrl-C to exit -- you may want to=
 check
> memory use as reported by 'top'");
>
> =A0 =A0 =A0 =A0 =A0 while (true)
>
> =A0 =A0 =A0 =A0 =A0 {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Thread.sleep(100);
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} catch(Exception e)
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0{
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 System.out.println(e);
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0 =A0 }
>
>
>
> =A0 =A0 }
>
> }
>
>
>
> -------------------------------------------------------------------------=
---
> -----------------
>
> My OS and JVM versions are as follows:
>
>
>
> Linux version 2.6.18-028stab066.10 (root@rhel5-64-build) (gcc version 4.1=
.2
> 20070626 (Red Hat 4.1.2-14)) #1 SMP Fri Dec 4 15:49:04 MSK 2009
>
>
>
> java version "1.6.0_17"
>
> Java(TM) SE Runtime Environment (build 1.6.0_17-b04)
>
> Java HotSpot(TM) 64-Bit Server VM (build 14.3-b01, mixed mode)
>
>
>
>
>
> Thanks,
>
> John Viviano
>
> =A0<mailto:john@intercorpinc.com> john@intercorpinc.com
>
>
>
>
>
> InterCorp, Inc.
>
> 11469 Olive Blvd, Ste. 225
>
> St. Louis, MO 63141
>
> 314.610.5276
>
>
>
> =A0<http://www.intercorpinc.com/> www.intercorpinc.com
>
> "The problems that exist in the world today cannot
> be solved by the level of thinking that created them."
> - Albert Einstein
>
>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45687-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 14:54:31 2010
Return-Path: <java-user-return-45687-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74995 invoked from network); 2 Apr 2010 14:54:31 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 14:54:31 -0000
Received: (qmail 77286 invoked by uid 500); 2 Apr 2010 07:42:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77177 invoked by uid 500); 2 Apr 2010 07:42:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77169 invoked by uid 99); 2 Apr 2010 07:42:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 07:42:28 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 07:42:18 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id 4EE9731495
	for <java-user@lucene.apache.org>; Fri,  2 Apr 2010 09:41:57 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id 3DC8531344
	for <java-user@lucene.apache.org>; Fri,  2 Apr 2010 09:41:57 +0200 (CEST)
Received: from [IPv6:::1] (dave.dfki.uni-sb.de [134.96.184.220])
	by mail.dfki.de (Postfix) with ESMTP id 0E8E73117F
	for <java-user@lucene.apache.org>; Fri,  2 Apr 2010 09:41:57 +0200 (CEST)
Message-Id: <A98F216E-554B-402D-9879-3AC03E1928CF@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <1270132147122-690881.post@n3.nabble.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes
Content-Transfer-Encoding: quoted-printable
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Designing a multilingual index
Date: Fri, 2 Apr 2010 09:41:56 +0200
References: <817123.44413.qm@web24101.mail.ird.yahoo.com> <1270124347984-690625.post@n3.nabble.com> <74458027-C184-4D74-9E23-451B07765F4E@activemath.org> <1270132147122-690881.post@n3.nabble.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Le 01-avr.-10 =E0 16:29, henrib a =E9crit :
> By issuing multiple queries, one against each localized index, =20
> results being
> clustered by locale.
> You can further refine by translating the end-user input query terms =20=

> for
> each locale and issue "translated" queries against the respective =20
> indices.
> I've seen satisfying results with "key" terms dictionaries.


What's funny here is how "uncertainty" can be pushed to different level.
I believe automated translation only makes sense if you know the exact =20=

source language, often not the case at me so I'm merging all results =20
matching all languages, add it with the possibility of typos and =20
phonetic matching...

Btw, can a lot of people report on successful language matching on =20
using soundex, metaphone or double-metaphone for phonetic matching?

thanks in advance

paul



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45693-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 20:28:11 2010
Return-Path: <java-user-return-45693-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54068 invoked from network); 2 Apr 2010 20:28:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 20:28:11 -0000
Received: (qmail 61441 invoked by uid 500); 2 Apr 2010 20:28:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61363 invoked by uid 500); 2 Apr 2010 20:28:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61355 invoked by uid 99); 2 Apr 2010 20:28:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 20:28:08 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 20:28:02 +0000
Received: by gwaa12 with SMTP id a12so809185gwa.35
        for <java-user@lucene.apache.org>; Fri, 02 Apr 2010 13:27:40 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.100.46.3 with HTTP; Fri, 2 Apr 2010 13:27:40 -0700 (PDT)
In-Reply-To: <z2g6f287d1b1004020720w6c1d5de4icd5a30a1716af5c4@mail.gmail.com>
References: <z2g6f287d1b1004020720w6c1d5de4icd5a30a1716af5c4@mail.gmail.com>
Date: Fri, 2 Apr 2010 16:27:40 -0400
Received: by 10.100.233.7 with SMTP id f7mr6359713anh.91.1270240060091; Fri, 
	02 Apr 2010 13:27:40 -0700 (PDT)
Message-ID: <p2n6f287d1b1004021327y20aee2d5s45a4107cdfdd8ddd@mail.gmail.com>
Subject: Re: custom scoring help
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=001636b2b1598fac8b048346cfb8
X-Virus-Checked: Checked by ClamAV on apache.org

--001636b2b1598fac8b048346cfb8
Content-Type: text/plain; charset=ISO-8859-1

This code is in fact working.  I had an error in my test case.  Things seem
to work as advertised.

sorry / thanks -

C>T>

On Fri, Apr 2, 2010 at 10:20 AM, Christopher Tignor <ctignor@thinkmap.com>wrote:

> Hello,
>
> I'm having a hard time implementing / understanding a very simple custom
> scoring situation.
>
> I have created my Similarity class for testing which overrides all the
> relevant (I think) methods below, returning 1 for all but coord(int, int)
> which returns q / maxOverlap so scores are scaled between 0. and 1..
>
> I call writer.setSimilarity(new HashHitSimilarity()) when indexing
> and searcher.setSimilarity(new HashHitSimilarity()) when searching.
>
> The similarity is definitely affecting the scoring but not how I expect.  I
> am looking for a straight average of the hits calculated, i.e.
> totalHits for a doc / totalHits in search.
>
> The above score with my test search and index of 6 docs should return the
> scores below for all 6 documents in my index:
>
> 0.8387096774193549
> 0.3548387096774194
> 0.3548387096774194
> 0.25806451612903225
> 0.1935483870967742
> 0.12903225806451613
>
> but the scores appear "stretched" and return these instead though I'm
> unsure as to where this "stretching" happens:
>
> 0.9078212
> 0.75977653
> 0.57541895
> 0.5670391
> 0.5223464
> 0.37150836
>
> public class HashHitSimilarity extends Similarity {
>
>     /**
>      *
>      */
>     private static final long serialVersionUID = 811419737205284733L;
>
>     public float tf(float freq) {
>         return 1f;
>     }
>
>     public float lengthNorm(String fieldName, int numTokens) {
>         return 1f;
>     }
>
>     public float queryNorm(float sumOfSquaredWeights) {
>         return 1f;
>     }
>
>     @Override
>     public float coord(int overlap, int maxOverlap) {
>         return 1f / (float) maxOverlap;
>     }
>
>     @Override
>     public float idf(int docFreq, int numDocs) {
>         return 1f;
>     }
>
>     @Override
>     public float sloppyFreq(int distance) {
>         return 0f;
>     }
>
> }
>
>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>



-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--001636b2b1598fac8b048346cfb8--

From java-user-return-45694-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 02 21:28:59 2010
Return-Path: <java-user-return-45694-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66556 invoked from network); 2 Apr 2010 21:28:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Apr 2010 21:28:58 -0000
Received: (qmail 28003 invoked by uid 500); 2 Apr 2010 21:28:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27971 invoked by uid 500); 2 Apr 2010 21:28:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27963 invoked by uid 99); 2 Apr 2010 21:28:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Apr 2010 21:28:56 +0000
X-ASF-Spam-Status: No, hits=0.5 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 02 Apr 2010 21:28:52 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id 7C90E1E6717; Fri,  2 Apr 2010 14:28:31 -0700 (MST)
Received: from PHX-HTPRD-01.adprod.bmc.com (phx-htprd-01.adprod.bmc.com [172.24.32.7])
	by flicker.bmc.com (Postfix) with ESMTP id 7437D1E64FA
	for <java-user@lucene.apache.org>; Fri,  2 Apr 2010 14:28:31 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-01.adprod.bmc.com ([172.24.32.7]) with mapi; Fri, 2 Apr 2010
 15:28:31 -0600
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 2 Apr 2010 15:28:26 -0600
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrR8h16wks/vek7Rl2IOjZjBygf1QAuKVjA
Message-ID: <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
In-Reply-To: <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0

I have this and the heap dump is 63mb zipped.  The info stream is much smal=
ler (31 kb zipped), but I don't know how to get them to you. =20

We are not using the NRT readers

-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]=20
Sent: Thursday, April 01, 2010 5:21 PM
To: java-user@lucene.apache.org
Subject: Re: IndexWriter and memory usage

Hmm, not good.  Can you post a heap dump?  Also, can you turn on
infoStream, index up to the OOM @ 512 MB, and post the output?

IndexWriter should not hang onto much beyond the RAM buffer.  But, it
does allocate and then recycle this RAM buffer, so even in an idle
state (having indexed enough docs to fill up the RAM buffer at least
once) it'll hold onto those 16 MB.

Are you using getReader (to get your NRT readers)?  If so, are you
really sure you're eventually closing the previous reader after
opening a new one?

Mike

On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> We are seeing a situation where the IndexWriter is using up the Java Heap=
 space and only releases memory for garbage collection upon a commit. =A0 W=
e are using the default RAMBufferSize of 16 mb. =A0We are using Lucene 2.9.=
1. We are set at heap size of 512 mb.
>
> We have a large number of documents that are run through Tika and then ad=
ded to the index. =A0The data from Tika is changed to a string, and then se=
nt to Lucene. =A0Heap dumps clearly show the data in the Lucene classes and=
 not in Tika. =A0Our intent is to only perform a commit once the entire ind=
exing run is complete, but several hours into the process everything comes =
to a crawl. =A0In using both JConsole and VisualVM =A0we can see that the h=
eap space is maxed out and garbage collection is not able to clean up any m=
emory once we get into this state. =A0It is our understanding that the Inde=
xWriter should be only holding onto 16 mb of data before it flushes it, but=
 what we are seeing is that while it is in fact writing data to disk when i=
t hits the 16 mb limit, it is also holding onto some data in memory and not=
 allowing garbage collection to take place, and this continues until garbag=
e collection is unable to free up enough space to all things to move faster=
 than a crawl.
>
> As a test we caused a commit to occur after each document is indexed and =
we see the total amount of memory reduced from nearly 100% of the Java Heap=
 to around 70-75%. =A0The profiling tools now show that the memory is clean=
ed up to some extent after each document. =A0But of course this completely =
defeats the whole reason why we want to only commit at the end of the run f=
or performance sake. =A0Most of the data, as seen using Heap analasis, is h=
eld in Byte, Character, and Integer classes whos GC roots are tied back to =
the Writer Objects and threads. =A0The instance counts, after running just =
1,100 documents seems staggering
>
> Is there additional data that the IndexWriter hangs onto regardless of wh=
en it hits the RAMBufferSize limit? =A0Why are we seeing the heap space all=
 being used up?
>
> A side question to this is the fact that we always see a large amount of =
memory used by the IndexWriter even after our indexing has been completed a=
nd all commits have taken place (basically in an idle state). =A0Why would =
this be? =A0Is the only way to totally clean up the memory is to close the =
writer? =A0Our index is also used for real time indexing so the IndexWriter=
 is intended to remain open for the lifetime of the app.
>
> Any help in understanding why the IndexWriter is maxing out our heap spac=
e or what is expected from memory usage of the IndexWriter would be appreci=
ated.
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45695-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 03 02:25:28 2010
Return-Path: <java-user-return-45695-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20406 invoked from network); 3 Apr 2010 02:25:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Apr 2010 02:25:28 -0000
Received: (qmail 47962 invoked by uid 500); 3 Apr 2010 02:25:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47936 invoked by uid 500); 3 Apr 2010 02:25:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47928 invoked by uid 99); 3 Apr 2010 02:25:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Apr 2010 02:25:25 +0000
X-ASF-Spam-Status: No, hits=0.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Apr 2010 02:25:20 +0000
Received: by gyf1 with SMTP id 1so1230444gyf.35
        for <java-user@lucene.apache.org>; Fri, 02 Apr 2010 19:24:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=jbVZMXMKXuQm88urdQjrxzny+IYuimD6Nm0FdRpJ+Jc=;
        b=Hy8AjQdCnPdFmYo8GlklaxHQEarmXzJsd4XzNMY1X64rYWAoEGNcgx90OOLlYu6faC
         zLefUsHc9y55JQ6qwuo29c+mx4Auk92QYsSeDX/IY5PYgz6sq3rNkRPMaM1BSBLJdHtK
         HUPCxPeHiglASqeN8KVQi/dYjaxtxK9ERrkGE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=XPAYy5mlxwmrks3u9ivTglzMjiQ1oX0L5PKEwcIDd6r7roGJyGjxWrsQEscCd5lyjP
         wDJHjJa9PoBQIDTBLDi4Mt2/+OJ7LJHsCQtGaxmN8zdXIQScUMk2aSxRQ2hQpU5t9Ug3
         Y/8+OpJAdMUqRc6tK0dQeuPiZecwgjKMks7DU=
MIME-Version: 1.0
Received: by 10.151.109.14 with HTTP; Fri, 2 Apr 2010 19:24:59 -0700 (PDT)
In-Reply-To: <860ead00c811e180046c5563a1afe7b9@localhost>
References: <j2n962c93f61003311817mb0916942r662787cab6b3af28@mail.gmail.com>
	 <8D42DCC0-4E03-4F8B-A6CC-C53890910C7E@transpac.com>
	 <e13f18ad7b10cc633edd32e51d335f7a@localhost>
	 <v2r8c4e68611004010205hdee4deebi6e4d64840466a355@mail.gmail.com>
	 <22b5f5f44f786a63b4f54df70ddfc4d6@localhost>
	 <g2q359a92831004010842y62b285dfs3e8f0a53741bda3e@mail.gmail.com>
	 <860ead00c811e180046c5563a1afe7b9@localhost>
Date: Fri, 2 Apr 2010 21:24:59 -0500
Received: by 10.150.81.10 with SMTP id e10mr3781465ybb.155.1270261499534; Fri, 
	02 Apr 2010 19:24:59 -0700 (PDT)
Message-ID: <t2x359a92831004021924qa2876cc6j3f9f34c3bc9ecf12@mail.gmail.com>
Subject: Re: query: order of search
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015176f0b9c739dac04834bcda0

--0015176f0b9c739dac04834bcda0
Content-Type: text/plain; charset=ISO-8859-1

I'm pretty sure that order doesn't matter. Again, though, don't
worry about this level of trick until you can demonstrate
performance issues, your time is usually best spent in other
places....

Best
Erick

On Thu, Apr 1, 2010 at 11:54 PM, <suman.holani@zapak.co.in> wrote:

> Hello Erick,
>
> I was trying to optimise the searching.
> Basically my data is like field1 has less no of docs matching compared to
> field2, which has larget sets.
>
> So if search goes by order to order, then i can make field1 to be search
> first, (by making  order of boolean query such  )and from thr the docs
> result set could be searched for field2.
> So number of docs to be matched will be less.
> I am not using filters or any caching since the search is unique everytime
> acc to parameter, and its using boolean query
>
>
> or is the searching takes place like searches each doc for  field1="abc"
> and field2="def" then get resultset
>
> I hope I am clear in explaining my query.
>
> thanks,
> Suman
>
>
>
> On Thu, 1 Apr 2010 08:42:16 -0700, Erick Erickson
> <erickerickson@gmail.com>
> wrote:
>  > Why do you care? By that I mean "what problem are you trying to solve"
> > (See "The XY problem at http://people.apache.org/~hossman/). The reason
> > I'm asking here is that very often, when people ask this kind of
> question
> > without providing background, they're trying the wrong approach to solve
> > a problem.
> >
> > Unless you're asking for theoretical reasons, I almost guarantee that
> > trying
> > to solve any problem in Lucene by changing the order of the clauses
> isn't
> > going to do you much good in the long run, there'll *always* be variant
> > n+1...
> >
> > Best
> > Erick
> >
> > On Thu, Apr 1, 2010 at 2:21 AM, <suman.holani@zapak.co.in> wrote:
> >
> >>
> >> Query I
> >>
> >> its written "to do a "search within search", so that the second search
> is
> >> constrained by the results of the first query"
> >> we can use boolean query.
> >> So doesn't it mean the order of query ll be preserved
> >>
> >> give me an simple example of how the docs get searched in lucene.
> >> 10 docs with 3 fields to b searched
> >> so ll it search for field1 for all 10 docs..and the result set docs ll
> b
> >> then searched for field2....and so far...
> >> or is it something else..
> >>
> >>
> >>
> >> thanks,
> >> Suman
> >>
> >> On Thu, 1 Apr 2010 10:05:01 +0100, Ian Lea <ian.lea@gmail.com> wrote:
> >> >> Query I
> >> >> Does the order of query play role in searching
> >> >> example:doc has fields
> >> >> rollno(pk), name, marks
> >> >>
> >> >> Query : marks=90&rollno=2&name=abc
> >> >>
> >> >> Query :rollno=2&name=abc&marks=90
> >> >>
> >> >> which query processing will be more efficient.
> >> >> is it work like search doc field by field , it will look for doc
> >> >> having
> >> >> rollno=2 then from thos will look for name abc and from the selected
> >> docs
> >> >> will again look for marks param .
> >> >
> >> > I don't think it makes any difference.
> >> >
> >> >
> >> >> Query II
> >> >>  which  is more faster .
> >> >> a)  adding one more multivalued field into current index(large)
> >> >> b)  or creating a separate index for the field and searching it as a
> >> >> subindex .
> >> >> My main apprehensions is in regard to large size of index
> >> >
> >> > Probably your first option.
> >> >
> >> >
> >> > --
> >> > Ian.
> >> >
> >> > ---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0015176f0b9c739dac04834bcda0--

From java-user-return-45696-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 03 09:39:19 2010
Return-Path: <java-user-return-45696-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89809 invoked from network); 3 Apr 2010 09:39:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Apr 2010 09:39:19 -0000
Received: (qmail 35266 invoked by uid 500); 3 Apr 2010 09:39:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35076 invoked by uid 500); 3 Apr 2010 09:39:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35068 invoked by uid 99); 3 Apr 2010 09:39:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Apr 2010 09:39:16 +0000
X-ASF-Spam-Status: No, hits=-1.1 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.184] (HELO mail-yx0-f184.google.com) (209.85.210.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Apr 2010 09:39:11 +0000
Received: by yxe14 with SMTP id 14so1471424yxe.5
        for <java-user@lucene.apache.org>; Sat, 03 Apr 2010 02:38:49 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.114.2 with HTTP; Sat, 3 Apr 2010 02:38:49 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
Date: Sat, 3 Apr 2010 05:38:49 -0400
Received: by 10.150.66.18 with SMTP id o18mr4211893yba.96.1270287529823; Sat, 
	03 Apr 2010 02:38:49 -0700 (PDT)
Message-ID: <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hmm why is the heap dump so immense?  Normally it contains the top N
(eg 100) object types and their count/aggregate RAM usage.

Can you attach the infoStream output to an email (to java-user)?

Mike

On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> I have this and the heap dump is 63mb zipped. =A0The info stream is much =
smaller (31 kb zipped), but I don't know how to get them to you.
>
> We are not using the NRT readers
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Thursday, April 01, 2010 5:21 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
> infoStream, index up to the OOM @ 512 MB, and post the output?
>
> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, it
> does allocate and then recycle this RAM buffer, so even in an idle
> state (having indexed enough docs to fill up the RAM buffer at least
> once) it'll hold onto those 16 MB.
>
> Are you using getReader (to get your NRT readers)? =A0If so, are you
> really sure you're eventually closing the previous reader after
> opening a new one?
>
> Mike
>
> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> We are seeing a situation where the IndexWriter is using up the Java Hea=
p space and only releases memory for garbage collection upon a commit. =A0 =
We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene 2.9=
.1. We are set at heap size of 512 mb.
>>
>> We have a large number of documents that are run through Tika and then a=
dded to the index. =A0The data from Tika is changed to a string, and then s=
ent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes an=
d not in Tika. =A0Our intent is to only perform a commit once the entire in=
dexing run is complete, but several hours into the process everything comes=
 to a crawl. =A0In using both JConsole and VisualVM =A0we can see that the =
heap space is maxed out and garbage collection is not able to clean up any =
memory once we get into this state. =A0It is our understanding that the Ind=
exWriter should be only holding onto 16 mb of data before it flushes it, bu=
t what we are seeing is that while it is in fact writing data to disk when =
it hits the 16 mb limit, it is also holding onto some data in memory and no=
t allowing garbage collection to take place, and this continues until garba=
ge collection is unable to free up enough space to all things to move faste=
r than a crawl.
>>
>> As a test we caused a commit to occur after each document is indexed and=
 we see the total amount of memory reduced from nearly 100% of the Java Hea=
p to around 70-75%. =A0The profiling tools now show that the memory is clea=
ned up to some extent after each document. =A0But of course this completely=
 defeats the whole reason why we want to only commit at the end of the run =
for performance sake. =A0Most of the data, as seen using Heap analasis, is =
held in Byte, Character, and Integer classes whos GC roots are tied back to=
 the Writer Objects and threads. =A0The instance counts, after running just=
 1,100 documents seems staggering
>>
>> Is there additional data that the IndexWriter hangs onto regardless of w=
hen it hits the RAMBufferSize limit? =A0Why are we seeing the heap space al=
l being used up?
>>
>> A side question to this is the fact that we always see a large amount of=
 memory used by the IndexWriter even after our indexing has been completed =
and all commits have taken place (basically in an idle state). =A0Why would=
 this be? =A0Is the only way to totally clean up the memory is to close the=
 writer? =A0Our index is also used for real time indexing so the IndexWrite=
r is intended to remain open for the lifetime of the app.
>>
>> Any help in understanding why the IndexWriter is maxing out our heap spa=
ce or what is expected from memory usage of the IndexWriter would be apprec=
iated.
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45697-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 03 15:31:53 2010
Return-Path: <java-user-return-45697-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39491 invoked from network); 3 Apr 2010 15:31:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Apr 2010 15:31:53 -0000
Received: (qmail 64723 invoked by uid 500); 3 Apr 2010 15:31:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64682 invoked by uid 500); 3 Apr 2010 15:31:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64664 invoked by uid 99); 3 Apr 2010 15:31:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Apr 2010 15:31:50 +0000
X-ASF-Spam-Status: No, hits=-1.7 required=10.0
	tests=ASF_LIST_OPS,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL,URIBL_RHS_DOB
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of volsky@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Apr 2010 15:31:44 +0000
Received: by bwz22 with SMTP id 22so2244409bwz.5
        for <multiple recipients>; Sat, 03 Apr 2010 08:31:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=zxoIvTIFOkh7TzU/9X3A7uHqKQX4opLHYagJizaRrd8=;
        b=Ll0L8pWcdtdo9HZa6YxDZ05MRszmLIRjj7evQC04OBt+9kv3eUpZFrUjLUaebhRqnB
         oeY32bAKi8JoBxmDmyj88d7IJSY4qE0pCvx+NyKgcYYGQAqJwLQCNu2vWbdM1y/XMtvJ
         ykK/6OukhBSvdhVyr1TcpChxBblVbdzGcCuP0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=t2SsGwGGc+kFtUtvLSkc+DBuml2Ns0CeSeHmdX5GxS8dSOCSkJjK1JViym/QhGvjFt
         Q5DijoEc8MIVfoQa5WJFXNR6w1uw0XuI0uj6V3KjM90BibJ+k8/W/9orx4v+A51SnOTC
         aV6LoxcYkmjTMtguARA7iU7LtYyH3hbDncKDY=
MIME-Version: 1.0
Received: by 10.204.71.77 with HTTP; Sat, 3 Apr 2010 08:31:21 -0700 (PDT)
Date: Sat, 3 Apr 2010 18:31:21 +0300
Received: by 10.204.18.129 with SMTP id w1mr1320446bka.149.1270308681532; Sat, 
	03 Apr 2010 08:31:21 -0700 (PDT)
Message-ID: <n2oae5b9bdf1004030831h625ab3d9l490390f40a4ff7d2@mail.gmail.com>
Subject: Hi!
From: Dima Volsky <volsky@gmail.com>
To: Optionsvolsky@gmail.com, amirweiz@hotmail.com, amirevy@zahav.net.il, 
	chenhe2@gmail.com, dmitriv@nice.com, eyalma@openu.ac.il, ezrad@nice.com, 
	guymizra@gmail.com, hamutalo@nice.com, java-user@lucene.apache.org, 
	java-user-subscribe@lucene.apache.org, yhefez@013.net, myartsev@gmail.com, 
	anni@nisha-hr.co.il, stmjobs@netvision.net.il, rotemmaya@hotmail.com, 
	rotemmaya@yahoo.com, sarik@bgu.ac.il, sergay@sce.ac.il, sergay@post.sce.ac.il, 
	shirab1000@yahoo.com, shoniash@hotmail.com, volsky@gmail.com, 
	volsky@netvision.net.il, volsky@exn.co.il, volsky@elbit.co.il, dima@gmail.com, 
	w_noa@hotmail.com, yaron.shenhav@gmail.com, yhefez@013.net.il, 
	avielisha@gmail.com, akrepel@hp.com, krepel@gmail.com, orlybloch@gmail.com, 
	vvolsky@gmail.com, i_m_ariel@walla.com, mayergab@gmail.com, 
	guy.serero@gmail.com, alvayos@gmail.com, yakovd@tcb.ac.il, 
	cfir.moshe@gmail.com, dor.lera.valeria@gmail.com, Maor.nissan@gmail.com, 
	moran.ploznik@gmail.com, moranroy@gmail.com, mokrepel@017.net.il, 
	mokrepel@admin.ort.org.il, mokrepel@netvision.net.il, tsvika.rabkin@gmail.com, 
	tzachash@gmail.com
Content-Type: text/plain; charset=ISO-8859-1

<DIV>hi!<BR>i am glad to tell you a good news ,and i find a good
website&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A
href="http://www.buusir.net/">http://www.buusir.net/</A><BR>On this
website ,you can find many new and origianl electronic&nbsp; products
.Now they are holding sales promotion activity, all the&nbsp; product
are sold at a discount.<BR>low cost and good quality ,and the delivery
is on time .<BR>It is a good chance that you should not lose.<BR>If
you need some, visit this website .<BR>Hope everything goes
well.<BR>Greetings! </DIV>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45698-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 05 13:59:37 2010
Return-Path: <java-user-return-45698-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96486 invoked from network); 5 Apr 2010 13:59:37 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Apr 2010 13:59:37 -0000
Received: (qmail 52541 invoked by uid 500); 5 Apr 2010 13:59:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50541 invoked by uid 500); 5 Apr 2010 13:59:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49924 invoked by uid 99); 5 Apr 2010 13:59:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 13:59:33 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,MISSING_HEADERS,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FILL_THIS_FORM_SHORT,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gsiasf@gmail.com designates 209.85.222.191 as permitted sender)
Received: from [209.85.222.191] (HELO mail-pz0-f191.google.com) (209.85.222.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 13:59:24 +0000
Received: by pzk29 with SMTP id 29so226260pzk.29
        for <multiple recipients>; Mon, 05 Apr 2010 06:59:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:from:mime-version
         :content-type:subject:date:in-reply-to:cc:references:message-id
         :x-mailer;
        bh=TlhJnXzWZsXlfuSHMQLBLIA6T00E+WP4KgW0Sd9qMk0=;
        b=SBLx1+RIFnUhalzGt/u9nm5HaQ3dgoiEAijOnFtBPjQtQ4khU6OPq79QF/pYMBtEiJ
         Q9I8eW4+3ZxuBF47U7wk/HPzNqUVLH5eXiNU36DIO9kRToDmzPprgz134OV36pTA+J/8
         p8ntwANvup40pE3Oe/SCxIMOnHP71JvvC3tmA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:from:mime-version:content-type:subject:date:in-reply-to:cc
         :references:message-id:x-mailer;
        b=iBGRnjV7ca3BZpnEwSVjdgl8Ta6RO08cG854hyXEdpSM7/XtiPKvz/27C+nVem6xK/
         8B86Iva5SJUfcfhlUXMiHrYrYfCX/75yNxoParBNJYMhsJQCaBSzuacPbyzYmHjlXTIe
         1oAcOVA9nifSUU9imvXQdweRRH/24enw3WepA=
Received: by 10.143.20.7 with SMTP id x7mr1782256wfi.328.1270475941838;
        Mon, 05 Apr 2010 06:59:01 -0700 (PDT)
Received: from [192.168.1.103] (cpe-071-071-234-029.carolina.res.rr.com [71.71.234.29])
        by mx.google.com with ESMTPS id 21sm301140yxe.21.2010.04.05.06.58.59
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 05 Apr 2010 06:58:59 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
From: Grant Ingersoll <gsingers@apache.org>
Mime-Version: 1.0 (Apple Message framework v1078)
Content-Type: multipart/alternative; boundary=Apple-Mail-60-110962502
Subject: Re: Apache Lucene EuroCon Call For Participation: Prague, Czech Republic May 20 & 21, 2010
Date: Mon, 5 Apr 2010 09:58:58 -0400
In-Reply-To: <5D3F4520-E5AB-4CA6-B9BC-F3B7D0D25510@apache.org>
Cc: Lucene mailing list <general@lucene.apache.org>,
 solr-user@lucene.apache.org,
 java-user@lucene.apache.org,
 mahout-user@lucene.apache.org,
 nutch-user@lucene.apache.org,
 openrelevance-user@lucene.apache.org,
 tika-user@lucene.apache.org,
 pylucene-user@lucene.apache.org,
 connectors-dev@incubator.apache.org,
 lucene-net-dev@lucene.apache.org
References: <5D3F4520-E5AB-4CA6-B9BC-F3B7D0D25510@apache.org>
Message-Id: <9B7D46C7-7AA1-4074-BDA0-7911EBDCAC17@apache.org>
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-60-110962502
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=windows-1252

Just a reminder, just over one week left open on the CFP.  Some great =
talks entered already.  Keep it up!

On Mar 24, 2010, at 8:03 PM, Grant Ingersoll wrote:

> Apache Lucene EuroCon Call For Participation - Prague, Czech Republic =
May 20 & 21, 2010
> =20
> All submissions must be received by Tuesday, April 13, 2010, 12 =
Midnight CET/6 PM US EDT
>=20
> The first European conference dedicated to Lucene and Solr is coming =
to Prague from May 18-21, 2010. Apache Lucene EuroCon is running on on =
not-for-profit basis, with net proceeds donated back to the Apache =
Software Foundation. The conference is sponsored by Lucid Imagination =
with additional support from community and other commercial co-sponsors.
>=20
> Key Dates:
> 24 March 2010: Call For Participation Open
> 13 April 2010: Call For Participation Closes
> 16 April 2010: Speaker Acceptance/Rejection Notification
> 18-19 May 2010: Lucene and Solr Pre-conference Training Sessions
> 20-21 May 2010: Apache Lucene EuroCon
>=20
> This conference creates a new opportunity for the Apache Lucene/Solr =
community and marketplace, providing  the chance to gather, learn and =
collaborate on the latest in Apache Lucene and Solr search technologies =
and what's happening in the community and ecosystem. There will be two =
days of Lucene and Solr training offered May 18 & 19, and followed by =
two days packed with leading edge Lucene and Solr Open Source Search =
content and talks by search and open source thought leaders.
>=20
> We are soliciting 45-minute presentations for the conference, 20-21 =
May 2010 in Prague. The conference and all presentations will be in =
English.
>=20
> Topics of interest include:=20
> - Lucene and Solr in the Enterprise (case studies, implementation, =
return on investment, etc.)
> - =93How We Did It=94  Development Case Studies
> - Spatial/Geo search
> - Lucene and Solr in the Cloud
> - Scalability and Performance Tuning
> - Large Scale Search
> - Real Time Search
> - Data Integration/Data Management
> - Tika, Nutch and Mahout
> - Lucene Connectors Framework
> - Faceting and Categorization
> - Relevance in Practice
> - Lucene & Solr for Mobile Applications
> - Multi-language Support
> - Indexing and Analysis Techniques
> - Advanced Topics in Lucene & Solr Development
>=20
> All accepted speakers will qualify for discounted conference =
admission. Financial assistance is available for speakers that qualify.
>=20
> To submit a 45-minute presentation proposal, please send an email to =
cfp@lucene-eurocon.org containing the following information in plain =
text:
>=20
> 1. Your full name, title, and organization
>=20
> 2. Contact information, including your address, email, phone number
>=20
> 3. The name of your proposed session (keep your title simple and =
relevant to the topic)
>=20
> 4. A 75-200 word overview of your presentation (in English); in =
addition to the topic, describe whether your presentation is intended as =
a tutorial, description of an implementation, an theoretical/academic =
discussion, etc.
>=20
> 5. A 100-200-word speaker bio that includes prior conference speaking =
or related experience (in English)
>=20
> To be considered, proposals must be received by 12 Midnight CET =
Tuesday, 13 April 2010 (Tuesday 13 April 6 PM US Eastern time, 3 PM US =
Pacific Time).
>=20
> Please email any questions regarding the conference to =
info@lucene-eurocon.org. To be added to the conference mailing list, =
please email signup@lucene-eurocon.org. If your organization is =
interested in sponsorship opportunities, email
> sponsor@lucene-eurocon.org
>=20
> Key Dates
>=20
> 24 March 2010: Call For Participation Open
> 13 April 2010: Call For Participation Closes
> 16 April 2010: Speaker Acceptance/Rejection Notification
> 18-19 May 2010  Lucene and Solr Pre-conference Training Sessions
> 20-21 May 2010: Apache Lucene EuroCon
>=20
> We look forward to seeing you in Prague!
>=20
> Grant Ingersoll
> Apache Lucene EuroCon Program Chair
> www.lucene-eurocon.org


--Apple-Mail-60-110962502--

From java-user-return-45699-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 05 18:24:48 2010
Return-Path: <java-user-return-45699-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60196 invoked from network); 5 Apr 2010 18:24:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Apr 2010 18:24:48 -0000
Received: (qmail 36305 invoked by uid 500); 5 Apr 2010 18:24:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36252 invoked by uid 500); 5 Apr 2010 18:24:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36244 invoked by uid 99); 5 Apr 2010 18:24:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 18:24:46 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 18:24:40 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id CB85A71C216; Mon,  5 Apr 2010 11:24:19 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id C916771C1A0
	for <java-user@lucene.apache.org>; Mon,  5 Apr 2010 11:24:19 -0700 (PDT)
Date: Mon, 5 Apr 2010 11:24:19 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: fastest way to gather simple terms that match documents?
In-Reply-To: <279092301003302206n67a51f1fkf9d493f725f745d0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.1004051115510.26799@radix.cryptio.net>
References: <279092301003302206n67a51f1fkf9d493f725f745d0@mail.gmail.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


:     After I've run a query I need to know which terms matched each
: result document (ie doc termfrequency>0).
	...
: I don't care how many were found or what position or anything else.
: just which ones matched.

if all you care about is simple "which terms does it have" you can take 
your list of terms, and your list of docids, sort both lists and then use 
termDocs to loop over the terms and over the docs.  (the sorting is key 
for performance, because it allways you to alwasy skip forward, w/o 
needing to restart the termDocs)

something like...

TermDocs iter = indexReader.termDocs();
for (Term t : myTerms) {
  iter.seek(t);
  for (int docid : myDocs) {
    if (iter.skipTo(docid) && (iter.doc() == docid)) {
      doSomethingWith(t, docid);
    }
  }
}



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45700-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 05 18:50:32 2010
Return-Path: <java-user-return-45700-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71434 invoked from network); 5 Apr 2010 18:50:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Apr 2010 18:50:32 -0000
Received: (qmail 77968 invoked by uid 500); 5 Apr 2010 18:50:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77928 invoked by uid 500); 5 Apr 2010 18:50:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77920 invoked by uid 99); 5 Apr 2010 18:50:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 18:50:30 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 18:50:24 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 20353D36004
	for <java-user@lucene.apache.org>; Mon,  5 Apr 2010 20:50:01 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id LclzOlj1zD5F for <java-user@lucene.apache.org>;
	Mon,  5 Apr 2010 20:49:56 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 84ACAD36003
	for <java-user@lucene.apache.org>; Mon,  5 Apr 2010 20:49:55 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <279092301003302206n67a51f1fkf9d493f725f745d0@mail.gmail.com> <Pine.LNX.4.64.1004051115510.26799@radix.cryptio.net>
In-Reply-To: <Pine.LNX.4.64.1004051115510.26799@radix.cryptio.net>
Subject: RE: fastest way to gather simple terms that match documents?
Date: Mon, 5 Apr 2010 20:49:56 +0200
Message-ID: <002601cad4f0$c95ceb70$5c16c250$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrU7Uj3T7F7nQIvTe2AMNI2+O2axQAAu4yg
Content-Language: de

Alternatively index your documents with term vectors for the field =
enabled:

http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/document/Fi=
eld.TermVector.html

And then use IndexReader.getTermFreqVector() with the matching doc ID:

http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/index/Index=
Reader.html#getTermFreqVector(int, java.lang.String)

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Chris Hostetter [mailto:hossman_lucene@fucit.org]
> Sent: Monday, April 05, 2010 8:24 PM
> To: java-user@lucene.apache.org
> Subject: Re: fastest way to gather simple terms that match documents?
>=20
>=20
> :     After I've run a query I need to know which terms matched each
> : result document (ie doc termfrequency>0).
> 	...
> : I don't care how many were found or what position or anything else.
> : just which ones matched.
>=20
> if all you care about is simple "which terms does it have" you can =
take
> your list of terms, and your list of docids, sort both lists and then
> use
> termDocs to loop over the terms and over the docs.  (the sorting is =
key
> for performance, because it allways you to alwasy skip forward, w/o
> needing to restart the termDocs)
>=20
> something like...
>=20
> TermDocs iter =3D indexReader.termDocs();
> for (Term t : myTerms) {
>   iter.seek(t);
>   for (int docid : myDocs) {
>     if (iter.skipTo(docid) && (iter.doc() =3D=3D docid)) {
>       doSomethingWith(t, docid);
>     }
>   }
> }
>=20
>=20
>=20
> -Hoss
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45701-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 05 19:33:39 2010
Return-Path: <java-user-return-45701-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85566 invoked from network); 5 Apr 2010 19:33:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Apr 2010 19:33:39 -0000
Received: (qmail 32650 invoked by uid 500); 5 Apr 2010 19:33:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32509 invoked by uid 500); 5 Apr 2010 19:33:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32501 invoked by uid 99); 5 Apr 2010 19:33:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 19:33:37 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Apr 2010 19:33:31 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id CB32271C210; Mon,  5 Apr 2010 12:33:10 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id C900A71C1BF
	for <java-user@lucene.apache.org>; Mon,  5 Apr 2010 12:33:10 -0700 (PDT)
Date: Mon, 5 Apr 2010 12:33:10 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: RE: fastest way to gather simple terms that match documents?
In-Reply-To: <002601cad4f0$c95ceb70$5c16c250$@de>
Message-ID: <Pine.LNX.4.64.1004051226500.26799@radix.cryptio.net>
References: <279092301003302206n67a51f1fkf9d493f725f745d0@mail.gmail.com>
 <Pine.LNX.4.64.1004051115510.26799@radix.cryptio.net> <002601cad4f0$c95ceb70$5c16c250$@de>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


: Alternatively index your documents with term vectors for the field enabled:
	...
: And then use IndexReader.getTermFreqVector() with the matching doc ID:

Uwe: this is an area i'm not particularly strong on, so i'm curious: do 
you expect that the TermFreqVector approach would be faster then the 
TermDocs approach for the type of usecase where docs tend to be "large"
but the list of specific terms you are interested in in testing for is 
"small" (ie: just the terms used in the original query)

I ask because off the top of my head i'm not seeing how it 
would really give you much of a time savings in return -- instead of 
seeking over the handful of terms you care about, the TermVectorMapper 
will have to scan over every Term in each of hte documents.  writing your 
own TermVectorMapper that ignores the terms you don't care about will 
help, but that still doesn't sound any faster)

: > :     After I've run a query I need to know which terms matched each
: > : result document (ie doc termfrequency>0).
: > 	...
: > : I don't care how many were found or what position or anything else.
: > : just which ones matched.



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45702-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 07 05:38:02 2010
Return-Path: <java-user-return-45702-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19550 invoked from network); 7 Apr 2010 05:38:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Apr 2010 05:38:01 -0000
Received: (qmail 6828 invoked by uid 500); 7 Apr 2010 05:38:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6573 invoked by uid 500); 7 Apr 2010 05:37:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6565 invoked by uid 99); 7 Apr 2010 05:37:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 05:37:55 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of apavan89@gmail.com designates 209.85.221.184 as permitted sender)
Received: from [209.85.221.184] (HELO mail-qy0-f184.google.com) (209.85.221.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 05:37:49 +0000
Received: by qyk14 with SMTP id 14so748698qyk.14
        for <java-user@lucene.apache.org>; Tue, 06 Apr 2010 22:37:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=nweL3Aekg8HWT9PryOjM8GuOsH80lpotJoCDmRXVZA8=;
        b=GKerqYmKzRLyFt+A9Q+t1VCJ8VPIU+5GfjIQZgfTwi7bqUxGUm9KVeibgS6Fd6AAkO
         JDMuWiP7WBdnBtZSPAJF8djMvzouBc1tg1KKhnXF5tisgWYWUrE11UkuqsfEvER3/mMy
         s+T4UWZdafvOs1JAcH03PD/cXqiXzNSngIhMk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=c01AlT1aKLA6Kr3Mqk+y4nfccdJTY0aZXQTqzpdC1BYGHoXa5+pFJZc6ViiD7+2Gxj
         tL0+WE8gV8S7v6H3qkQXAMSAzbG/MB85RiwDG8W96aZ+lcJNULV9H/KA5yuH0swWU9VW
         8Bsp9NmKWLR4OSUQf8ebaqNk7V/H5PS8aM5sk=
MIME-Version: 1.0
Received: by 10.229.75.83 with HTTP; Tue, 6 Apr 2010 22:37:28 -0700 (PDT)
Date: Wed, 7 Apr 2010 11:07:28 +0530
Received: by 10.229.226.1 with SMTP id iu1mr848634qcb.19.1270618648403; Tue, 
	06 Apr 2010 22:37:28 -0700 (PDT)
Message-ID: <g2l4954b2031004062237lf3595995he97341e5588d0239@mail.gmail.com>
Subject: running java-lucene on fedora
From: Pavan Kumar <apavan89@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636284bca2edda604839ef55a

--001636284bca2edda604839ef55a
Content-Type: text/plain; charset=ISO-8859-1

Hi,
This may seem silly but I have not been able to to figure out what to import
and how to compiler a lucene java program
I have installed lucene by 'yum' on my Fedora 11.
Doing a locate lucene gave:
'/usr/share/java/lucene-2.3.1.jar'
'/usr/share/java/lucene.jar'

I did not get any direct reference on the Internet as well
example codes have org.apache.lucene.* I run pylucene on my computer but I
am new to Java, so please help me by giving an example program that can run
on my machine given these specification.
1_What to import
2_How to compiler {-jar ,etc are they required}
Thank you very much in advance

-- 
Regards
Pavan Kumar

--001636284bca2edda604839ef55a--

From java-user-return-45703-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 07 16:01:38 2010
Return-Path: <java-user-return-45703-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57184 invoked from network); 7 Apr 2010 16:01:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Apr 2010 16:01:38 -0000
Received: (qmail 35063 invoked by uid 500); 7 Apr 2010 16:01:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34307 invoked by uid 500); 7 Apr 2010 16:01:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34207 invoked by uid 99); 7 Apr 2010 16:01:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 16:01:36 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FRT_STOCK2,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of castagna.lists@googlemail.com designates 209.85.219.221 as permitted sender)
Received: from [209.85.219.221] (HELO mail-ew0-f221.google.com) (209.85.219.221)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 16:01:28 +0000
Received: by ewy21 with SMTP id 21so588571ewy.5
        for <multiple recipients>; Wed, 07 Apr 2010 09:01:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:content-type
         :content-transfer-encoding;
        bh=YNq+m+TRj9oVOQSR+o3q4LBvzuDvQWBN0JvifZ2ko3E=;
        b=LZnRg1JtLw5id2zP+P8p2RtTulymZ3TzAH1QYePcRI6ItacOnEiWFP2k3PL9Ok7lag
         z7F8jdVE3RgQI1urm1JQ1tQ8Z/XvwTr3ALCI8XoKUGBk1H3cikaad9KdVmHWEPnYB6GJ
         Er0jvHnnVZeIZeaV3Ipc0HQeZ/WCNp/RNzdhY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject
         :content-type:content-transfer-encoding;
        b=dySq1aUjCWugPkYwlFol1vKsNbkEvGhQDKLK6ljiYUxvi09p/uAvkQltRx+nJKL/UO
         0N9XhMrD945UFaJ2drpyX+Asr/lXLsf/jEbbyM10mUySCL7omvn/E/8WDp3wFYTQmz59
         HmKj8lZYUuPHHJDJ1/APATJ0JY5jGq/qvBAmI=
Received: by 10.213.62.142 with SMTP id x14mr2093782ebh.71.1270656066869;
        Wed, 07 Apr 2010 09:01:06 -0700 (PDT)
Received: from [192.168.1.10] (88-105-137-251.dynamic.dsl.as9105.com [88.105.137.251])
        by mx.google.com with ESMTPS id 15sm8125908ewy.8.2010.04.07.09.00.53
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 07 Apr 2010 09:00:58 -0700 (PDT)
Message-ID: <4BBCAC2C.4090904@googlemail.com>
Date: Wed, 07 Apr 2010 17:00:44 +0100
From: Paolo Castagna <castagna.lists@googlemail.com>
User-Agent: Thunderbird 2.0.0.24 (X11/20100317)
MIME-Version: 1.0
To: solr-user@lucene.apache.org, java-user@lucene.apache.org
Subject: Is it possible to have Lucene and Solr (or two Solr instances) pointing
 at the same index directory?
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,
(I know that this is probably not recommended and not a common
scenario, but...)

Is it possible to have an application using Lucene and a separate
(i.e. different JVM) instance of Solr both pointing at the same
index and read/write to the index from both applications?

I am trying (separately) two lockType settings in solrconfig.xml:
"native" and "simple" and the corresponding SimpleFSLockFactory
and NativeFSLockFactory with Lucene.

I have noticed that if I use:

   Directory dir = FSDirectory.open(
                     new File(path),
                     new SimpleFSLockFactory(path));

The lock file is called "writer.lock", while if I use:

   Directory dir = FSDirectory.open(new File(path));
   dir.setLockFactory(new SimpleFSLockFactory(path));

The lock file is called "lucene-{number}-writer.lock".

Solr uses the second method to set a custom lock factory.

Is the {number} supposed to be unique and the always same across
different JVMs?

I have also noticed that when Solr starts it creates a lock file even
if there are no updates or commits to the index. Why? Is this normal?

Finally, I would like to know if what I am doing is possible, what
are the potential problems and if people with more experience with
Lucene and Solr have suggestions on recommended settings or best
practices.

Thanks,
Paolo

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45704-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 07 19:09:52 2010
Return-Path: <java-user-return-45704-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15821 invoked from network); 7 Apr 2010 19:09:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Apr 2010 19:09:51 -0000
Received: (qmail 12943 invoked by uid 500); 7 Apr 2010 19:09:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12756 invoked by uid 500); 7 Apr 2010 19:09:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12748 invoked by uid 99); 7 Apr 2010 19:09:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 19:09:49 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of gbrits@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 19:09:41 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <gbrits@gmail.com>)
	id 1Nzacq-0005kj-OQ
	for java-user@lucene.apache.org; Wed, 07 Apr 2010 12:09:20 -0700
Date: Wed, 7 Apr 2010 11:09:20 -0800 (PST)
From: britske <gbrits@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <h2ha8a24f021004071209n18ae62faocd513c8b6947a82@mail.gmail.com>
In-Reply-To: <9ac0c6aa1003260601k6cbdf772tce7317d02dc62697@mail.gmail.com>
References: <1269560430303-576998.post@n3.nabble.com> <9ac0c6aa1003260601k6cbdf772tce7317d02dc62697@mail.gmail.com>
Subject: Re: custom low-level indexer (to speed things up) when fields,
 terms  and docids are in order
MIME-Version: 1.0
Content-Type: multipart/alternative; 
	boundary="----=_Part_14315_16630540.1270667360751"
X-Virus-Checked: Checked by ClamAV on apache.org

------=_Part_14315_16630540.1270667360751
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Just to update and close this thread (I forgot about it) :

after investigation it turns out that 75% of the time of the custom
async-indexer (see original email) was spend in FieldInfos.add(...) . More
specifically in the part where fieldname is interned using String.intern().
Copy/pasing and using a custom FieldInfos class which doesn't use
String.intern() increased throughput a lot..
In my situation (custom low-level indexer) I don't rely on String.intern()
in the lucene-code. (no merging of segments etc. where I believe the code is
used.)
anyway, throughput increased a lot, and I'm satisfied.

Thanks, I've learned a lot from the Lucene internals.
Geert-Jan

2010/3/26 Geert-Jan Brits <gbrits@gmail.com>

> define fun ;-)
>
> indeed I created a custom indexing chain, plugged it in and all works
> well.
> I'm currently trying to isolate the critical parts to double test that
> indeed most of the time goes in the indexing process.
> It's kind of hard doing accurate measurements bc. the indexer is designed
> to be running asychronously from the process that calculates the maps etc
> ,so to make use of concurrent IO and CPU.
>
> however from a birds-eys view: disabling the async custom indexer and only
> doing the described calculating/ populating of the ordered maps increases
> throughput from 1.8 docs/sec to 5.4 docs/sec, while with or without aysnc
> indexer enabled the total application is never cpu-bound. (not even close)
>
> Investigating more, and reporting back.
>
> Glad you liked the case ;-)
>
> Geert-Jan
>
> 2010/3/26 Michael McCandless-2 [via Lucene] <
> ml-node+676471-1074052327-38570@n3.nabble.com<ml-node%2B676471-1074052327-38570@n3.nabble.com>
> >
>
>  This sounds like fun :)
>>
>> So you've already created a custom indexing chain, and plugged this
>> into DocumentsWriter?  And this chain directly interacts with the low
>> level classes for writing a segment (FormatPostingsTerms/DocsConsumer,
>> etc.)?
>>
>> I'm not sure you're gonna do much better than that... these classes
>> already expect things "in order" and all they do (pretty much) is
>> write the index files.  I think they should be pretty lean...
>>
>> Also, once flex lands, soon (note that it moves these low level
>> interfaces/classes around)... since you're using these classes for
>> writing, it'll mean you can freely swap in different codecs.
>>
>> The only thing you can do further is to conflate your custom code with
>> the codec, ie, so that you make a single chain that directly writes
>> index files.  But I'm not sure you'll gain much performance by doing
>> so... (and then you can't [as easily] swap codecs).
>>
>> Have you profiled to see where the time is being spent?
>>
>> Mike
>>
>> On Thu, Mar 25, 2010 at 7:40 PM, britske <[hidden email]<http://n3.nabble.com/user/SendEmail.jtp?type=node&node=676471&i=0>>
>> wrote:
>>
>> >
>> > Hi,
>> >
>> > perhaps first some background:
>> >
>> > I need to speed-up indexing for an particular application which has a
>> pretty
>> > unsual schema: besides the normal stored and indexed fields we have
>> about
>> > 20.000 fields  per document which are all indexed/ non-stored sInts.
>> >
>> > Obviously indexing was really slow with such a number of fields. With
>> > indexing through Solr we got about 0.3 docs/ sec ( on a ec2 m1.large
>> > instance)
>> >
>> > Since these ~20.000 fields are all build/ calculated analogously, we
>> figured
>> > it would be possible to possibly build a low-level indexer for these
>> fields
>> > (of which we had domain knowledge which we could use to possibly speed
>> > indexing up) and later merge them with the other fields to construct the
>>
>> > entire index. So we did and now achieve around 1.8 docs/ sec (6x
>> speedup).
>> > Not bad, but still not enough.
>> >
>> > As part of calculating these fields, we keep track of all fields, terms
>> per
>> > field, and docids per term ( per field) .
>> > all the stuff is then ordered: the fields, the terms available for each
>> > field, the docids per term and inserted in that order using lowel-level
>> > classes like: FormatPostingsFieldsWriter , FormatPostingsTermsConsumer,
>> > FormatPostingsDocsConsumer (pseudo-code below)
>> >
>> > This constructs the following files: .tis, .tii, .frq.  ( + some default
>>
>> > values for the other required files, which don't need actual data bc.
>> these
>> > fields are not stored..)
>> >
>> > I should also mention that each call to the indexer writes all available
>>
>> > fields, terms, docids to a new fsdirectory. So basically each call
>> results
>> > in a complete index. (containing about 100 docs each, bc. otherwise we
>> run
>> > into mem-problems keeping the  ordered maps)
>> >
>> > Since we already have all fields, terms, docids in order it seems (a lot
>> of
>> > ) overkill to me to be going through the methods that above-mentioned
>> > classes offer, which were meant for more 'non-sequential / non-ordered'
>> > inserts (AFAIK).
>> >
>> > What would be the best way to write .tis, .tii and .frq ni a more
>> sequential
>> > matter?
>> > I'm looking for something that would construct a byte-array for each
>> file
>> > that conforms to the index-file definition of that particular file (or
>> > something) . I could try to do it myself and completely bypass all
>> > indexing-classes altogether and just write the files to disk. (Possible
>> bc.
>> > as mentioned we have all data needed to construct a complete index) .
>> >
>> > However, perhaps there are classes I'm not aware of that help in getting
>> the
>> > format right (it seems like a lot of trial-and-error coding otherwise)
>> >
>> > Thanks for any help, pointers, etc.
>> >
>> > Geert-Jan
>> >
>> >
>> >
>> > PSEUDO-CODE of the current low-level (not-so) sequential indexer:
>> >
>> >        foreach(String sField: fieldsInOrder){
>> >                --> add field to FieldInfos and grab newly created
>> fieldInfo
>> >                --> add fieldInfo to FormatPostingsFieldsWriter and grab
>> > formatPostingsTermsConsumer
>> >                List<String> termsInOrder =
>> termsInOrderForFieldMap(sField);
>> >                foreach(String sTerm: termsInOrder){
>> >                        FormatPostingsDocsConsumer frq =
>> formatPostingsTermsConsumer.add(sTerm);
>> >                        List<Integer> docidsInOrderPerFieldTerm =
>> > docidsInOrderPerFieldTermMap(sField+"-"+sTerm);
>> >                        for(Integer docid:docidsInOrderPerFieldTerm){
>> >                                frq.addDoc(docid);
>> >                        }
>> >                        //close relevant stuff
>> >                }
>> >                //close relevant stuff
>> >        }
>> >        //close relevant stuff
>> >
>> >
>> >
>> > --
>> > View this message in context:
>> http://n3.nabble.com/custom-low-level-indexer-to-speed-things-up-when-fields-terms-and-docids-are-in-order-tp576998p576998.html
>> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: [hidden email]<http://n3.nabble.com/user/SendEmail.jtp?type=node&node=676471&i=1>
>> > For additional commands, e-mail: [hidden email]<http://n3.nabble.com/user/SendEmail.jtp?type=node&node=676471&i=2>
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: [hidden email]<http://n3.nabble.com/user/SendEmail.jtp?type=node&node=676471&i=3>
>> For additional commands, e-mail: [hidden email]<http://n3.nabble.com/user/SendEmail.jtp?type=node&node=676471&i=4>
>>
>>
>>
>> ------------------------------
>>  View message @
>> http://n3.nabble.com/custom-low-level-indexer-to-speed-things-up-when-fields-terms-and-docids-are-in-order-tp576998p676471.html
>> To unsubscribe from custom low-level indexer (to speed things up) when
>> fields, terms and docids are in order, click here< (link removed) ==>.
>>
>>
>>
>

-- 
View this message in context: http://n3.nabble.com/custom-low-level-indexer-to-speed-things-up-when-fields-terms-and-docids-are-in-order-tp576998p703958.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

------=_Part_14315_16630540.1270667360751--

From java-user-return-45705-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 07 20:36:20 2010
Return-Path: <java-user-return-45705-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41527 invoked from network); 7 Apr 2010 20:36:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Apr 2010 20:36:20 -0000
Received: (qmail 52378 invoked by uid 500); 7 Apr 2010 20:36:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52349 invoked by uid 500); 7 Apr 2010 20:36:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52341 invoked by uid 99); 7 Apr 2010 20:36:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 20:36:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 20:36:11 +0000
Received: by bwz22 with SMTP id 22so1235555bwz.5
        for <java-user@lucene.apache.org>; Wed, 07 Apr 2010 13:35:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=V+aZw91iKpz3uPhBfXUGDuJbQCCUK2loWV6rrHhVvpc=;
        b=QlVh+6fcAusjgt3LXMI14n4tLutab9oyUdZTv4hTL3J9LAemxE5dzRqFcT7xpMKR2n
         +N8/jJNmBEsFAMbguuh5An97E39txI1WAP4QpwRu2BuaC3aZCuTRFeWRgEK4RwD33Fqt
         aIaPkfWf5B7+71rP7NUifKnzDBCjm7h7OYaH4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=JnweNLIN72/p/X/OIHKGcWSWtPhtyri+vmHkuyxmommO1x835YFpuwZcc1YzV+PR+Q
         r+5dfsmKjZ5h6bp9HV+S6KURz5RFVXXjQuKoucqz8lPzfpE/uhxvuN8Dw3OYyoElKdVX
         s6TwBpQFbIdDlQBUM1S3dC3mYWVtG6yJiCaNU=
MIME-Version: 1.0
Received: by 10.204.60.133 with HTTP; Wed, 7 Apr 2010 13:35:50 -0700 (PDT)
Date: Wed, 7 Apr 2010 22:35:50 +0200
Received: by 10.204.126.130 with SMTP id c2mr9534902bks.155.1270672550734; 
	Wed, 07 Apr 2010 13:35:50 -0700 (PDT)
Message-ID: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
Subject: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d58b28032c150483ab8239
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d58b28032c150483ab8239
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Hi,

It seems like my IndexWriter after commiting and optimizing has a retained
size of 140Mb. See [1] for a screenshot of the heapdump analysis done with
Eclipse MAT.

Of those 140MB 67MB are retained by
analyzer.tokenStreams.hardRefs.table.HashMap$Entry.value.tokenStream.scanne=
r.zzBuffer


why is this? Is it a memory leak? or did I something wrong during the
indxing? (BTW, I'm indexing document which contains Fields(xxxx,Reader) and
those Reader are wrappers around Tika.parse(xxxx) Readers. I get a lot
IOExceptions from tika readers and the wrapper maps the exceptions to EOF s=
o
Lucene doesn't see the exception).



...and 73MB of the 140MB are retained by docWriter see [2]. It looks like
the Field objects in the
array docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx] are
holding references to the Readers. Those reader instances are actually
closed after IndexWriter.updateDocument. Each one of those Readers retains
1MB. The question is why IndexWriter holds references to those Readers afte=
r
the Documents have been indexed.


[1] http://img.skitch.com/20100407-1183815yiausisg73u9wfgscsj.jpg
[2] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg

--=20
/Rub=C3=A9n

--0016e6d58b28032c150483ab8239--

From java-user-return-45706-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 07 22:24:14 2010
Return-Path: <java-user-return-45706-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70748 invoked from network); 7 Apr 2010 22:24:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Apr 2010 22:24:14 -0000
Received: (qmail 73324 invoked by uid 500); 7 Apr 2010 22:24:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73207 invoked by uid 500); 7 Apr 2010 22:24:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73199 invoked by uid 99); 7 Apr 2010 22:24:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 22:24:12 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Apr 2010 22:24:05 +0000
Received: by bwz22 with SMTP id 22so1313868bwz.5
        for <java-user@lucene.apache.org>; Wed, 07 Apr 2010 15:23:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=sb3AoajXmDq0QXYOPCpR1DPNPUmrA1frDhIoQ321YFs=;
        b=t73k4f+XmDw8RET6msbHxk/5lBBcNgTF3bC2IicaQR4G9owRK5vf9FxYoHx4Xi32cW
         zOXzW/z9MfsZp3ragU0DAJuwxQo9WfssTBmFhZc0RUW9NQyvq4rOc5Atyre1wfNDu0GO
         iOBbg0+EWH2sjUiXhsUOYGtTnOCqkMZtIOb2U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=gXbj/jjscHee7xGhkACoVX0i8lDjAjkLTWlcwctE+RNJat1EOFniKcAthfJSNkLu9j
         k3QqapO20TYMofT9Zws4xNR04QDxrgjLGlWQLZSSpRUL/54KLA7bK/r74Lybon6UTsFj
         BZXCWXTRhDV20HbosmvGJz4WLEL2DrcDeFZTE=
MIME-Version: 1.0
Received: by 10.204.60.133 with HTTP; Wed, 7 Apr 2010 15:23:44 -0700 (PDT)
In-Reply-To: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
Date: Thu, 8 Apr 2010 00:23:44 +0200
Received: by 10.204.22.75 with SMTP id m11mr3642864bkb.51.1270679024360; Wed, 
	07 Apr 2010 15:23:44 -0700 (PDT)
Message-ID: <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00032555404adee9aa0483ad0381
X-Virus-Checked: Checked by ClamAV on apache.org

--00032555404adee9aa0483ad0381
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I want to add that it tried this in both 2.9.0 and 3.0.1 and I got the same
"leaky" behavior.

See [3] for a screenshot of zzBuffer of 67MB on Lucene 3.0.1.

I managed to get rid of the Reader's "memory leak" by actually setting to
null the pointer to the actual Tika's Reader in my wrapper when the wrapper
is closed. But I still think that I would be nicer if IndexWriter wouldn't
maintain references to the Readers after indexing.

[3] http://img.skitch.com/20100407-ntn2kg13fx49wx4q118bp9h1hb.jpg


On Wed, Apr 7, 2010 at 10:35 PM, Ruben Laguna <ruben.laguna@gmail.com>wrote=
:

> Hi,
>
> It seems like my IndexWriter after commiting and optimizing has a retaine=
d
> size of 140Mb. See [1] for a screenshot of the heapdump analysis done wit=
h
> Eclipse MAT.
>
> Of those 140MB 67MB are retained by
> analyzer.tokenStreams.hardRefs.table.HashMap$Entry.value.tokenStream.scan=
ner.zzBuffer
>
>
> why is this? Is it a memory leak? or did I something wrong during the
> indxing? (BTW, I'm indexing document which contains Fields(xxxx,Reader) a=
nd
> those Reader are wrappers around Tika.parse(xxxx) Readers. I get a lot
> IOExceptions from tika readers and the wrapper maps the exceptions to EOF=
 so
> Lucene doesn't see the exception).
>
>
>
> ...and 73MB of the 140MB are retained by docWriter see [2]. It looks like
> the Field objects in the
> array docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx] are
> holding references to the Readers. Those reader instances are actually
> closed after IndexWriter.updateDocument. Each one of those Readers retain=
s
> 1MB. The question is why IndexWriter holds references to those Readers af=
ter
> the Documents have been indexed.
>
>
> [1] http://img.skitch.com/20100407-1183815yiausisg73u9wfgscsj.jpg
> [2] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
>
> --
> /Rub=C3=A9n
>



--=20
/Rub=C3=A9n

--00032555404adee9aa0483ad0381--

From java-user-return-45707-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 03:04:39 2010
Return-Path: <java-user-return-45707-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21968 invoked from network); 8 Apr 2010 03:04:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 03:04:39 -0000
Received: (qmail 86030 invoked by uid 500); 8 Apr 2010 03:04:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85952 invoked by uid 500); 8 Apr 2010 03:04:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85944 invoked by uid 99); 8 Apr 2010 03:04:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 03:04:36 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of sulmansarwar@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 03:04:29 +0000
Received: by bwz22 with SMTP id 22so1427483bwz.5
        for <java-user@lucene.apache.org>; Wed, 07 Apr 2010 20:04:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=qLE+iZ6qeIS9vNqNf7eh5aCTjjL9n2s1T0OxslLElZI=;
        b=KIV6cmrXYefJF0gUHhZi2kmPl2d2YeugNtqPDq/KlpLrjVeLAE/R/xwwOr2/7sANSF
         hEmKRIE7qPctfY/0LVCemgFhjx7bSNZJtKDcyjcWelWST7Uu23VsyoOEmqt6FLU/bOBY
         tGEnagOwxJzvH6tzURE+NxfzDhSXB1zFqFi90=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=jyUJsnKZtmEFQtIbHFKkQt6otvdclt1fBJTh5qYu3NKQwRo8HqYZ2/qp+mJ86f0oai
         vj9KUHLCCw6GZV7RqyRzmRj6y5DABiQORkVEhsDuy+TmN3e4KoHKVwldkFN2oUx1jsds
         nLA251+SBByBCjVQaEOIQNXSQuJ0xnDRHzT7M=
MIME-Version: 1.0
Received: by 10.204.61.2 with HTTP; Wed, 7 Apr 2010 20:04:08 -0700 (PDT)
Date: Thu, 8 Apr 2010 04:04:08 +0100
Received: by 10.204.129.70 with SMTP id n6mr9013619bks.152.1270695848328; Wed, 
	07 Apr 2010 20:04:08 -0700 (PDT)
Message-ID: <m2m63c4d8451004072004s74ce5b74s7d3f623e71d7f122@mail.gmail.com>
Subject: preserving markup of content ?
From: Sulman Sarwar <sulmansarwar@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hi All,

I am working on some language data and i need to index/search it. I
have used lucene for indexing plain text documents before as well (no
fancy tricks, just plain text indexing). The data that i have now is
transcribed text and is heavily marked up. (Its mostly conversations
and interviews). I can easily remove the markup and extract the text
and feed it to a lucene indexer but i need to preserve some important
markups so that at the time of retrieval the text can make some sense.
Now if i leave the required markup intact and index the documents, i
fear the markup will get tokenized too and will become searchable. I
dont want the markup to be searched but i need to keep it somehow
attached with the actual text to make the retrieval process easy. Can
you suggest me what/how to do it? Correct me if i am wrong. :)

Thanks for the help.

Sulman.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45708-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 06:28:21 2010
Return-Path: <java-user-return-45708-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50492 invoked from network); 8 Apr 2010 06:28:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 06:28:21 -0000
Received: (qmail 26882 invoked by uid 500); 8 Apr 2010 06:28:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26716 invoked by uid 500); 8 Apr 2010 06:28:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26705 invoked by uid 99); 8 Apr 2010 06:28:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 06:28:18 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 06:28:11 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id AED71D36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 08:27:45 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id OOkXWxZX-qD6 for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 08:27:39 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 8ABA6D36002
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 08:27:37 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <m2m63c4d8451004072004s74ce5b74s7d3f623e71d7f122@mail.gmail.com>
In-Reply-To: <m2m63c4d8451004072004s74ce5b74s7d3f623e71d7f122@mail.gmail.com>
Subject: RE: preserving markup of content ?
Date: Thu, 8 Apr 2010 08:27:39 +0200
Message-ID: <006a01cad6e4$975de0c0$c619a240$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrWyD0TdQuOIDu7QKy7ElBUWvZNJwAG5iPg
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

The "simple" solution is very easy:
Index the markup-free document by adding with new Field.Index.ANALYZED =
and Field.Store.NO, so it does not get stored. Then again add the same =
data (but with markup) to the index with Field.Store.YES but =
Field.Index.NO. If you like you can do this even with the same field =
name.

This works, as long as you don't need query highlighting, because the =
offsets from the first field addition cannot be used for highlighting =
inside the text with markup. In this case, you have to write your own =
analyzer that removes the markup in the tokenizer, but preserves the =
original offsets. Examples of this are e.g. The Wikipedia contrib in =
Lucene, which has an hand-crafted analyzer that can handle Mediawiki =
Markup syntax.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Sulman Sarwar [mailto:sulmansarwar@gmail.com]
> Sent: Thursday, April 08, 2010 5:04 AM
> To: java-user@lucene.apache.org
> Subject: preserving markup of content ?
>=20
> Hi All,
>=20
> I am working on some language data and i need to index/search it. I
> have used lucene for indexing plain text documents before as well (no
> fancy tricks, just plain text indexing). The data that i have now is
> transcribed text and is heavily marked up. (Its mostly conversations
> and interviews). I can easily remove the markup and extract the text
> and feed it to a lucene indexer but i need to preserve some important
> markups so that at the time of retrieval the text can make some sense.
> Now if i leave the required markup intact and index the documents, i
> fear the markup will get tokenized too and will become searchable. I
> dont want the markup to be searched but i need to keep it somehow
> attached with the actual text to make the retrieval process easy. Can
> you suggest me what/how to do it? Correct me if i am wrong. :)
>=20
> Thanks for the help.
>=20
> Sulman.
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45709-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 06:41:53 2010
Return-Path: <java-user-return-45709-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58757 invoked from network); 8 Apr 2010 06:41:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 06:41:53 -0000
Received: (qmail 37068 invoked by uid 500); 8 Apr 2010 06:41:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36962 invoked by uid 500); 8 Apr 2010 06:41:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36954 invoked by uid 99); 8 Apr 2010 06:41:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 06:41:50 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 06:41:43 +0000
Received: by fxm8 with SMTP id 8so1740974fxm.5
        for <java-user@lucene.apache.org>; Wed, 07 Apr 2010 23:41:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=X2S0LdjAW/lHs7ex7K7JEDW9J9MkfRUJ5jKgmRtEynE=;
        b=Vf1VpD6ADdNXoclkQdc870OEybc86uChmSseAv8Fll1dO2Zi5QtVjk+Zch7Zz7m3YI
         GOzmySV0tH4Ism/+u6hNLERQU9E9FXeqCh91ANxDkaMPXZj7h3W1FDsrV8avffutbXap
         iUrp9aNVlKuOypxxJS6FixQejgOgxy83fQ0Io=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=pl3AWTKrOCX8Sjz8yBP088aYfmNgNklKGdvCzbXado3G+SxwGTkb6nUK55B4Nxuzkx
         6wDPxhr+NvlGTT9tek/o0AU49BPUnWnMgsl3aq4FVl1ulgIlYKrpxGsiZOH27/Nk5JOa
         W0ZMxvFklUoqGtjz20HLTmNQofxtcw2BZMIs4=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Wed, 7 Apr 2010 23:41:23 -0700 (PDT)
In-Reply-To: <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
Date: Thu, 8 Apr 2010 09:41:23 +0300
Received: by 10.103.81.29 with SMTP id i29mr5387557mul.109.1270708883062; Wed, 
	07 Apr 2010 23:41:23 -0700 (PDT)
Message-ID: <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e65c7f60967ea30483b3f7bb
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e65c7f60967ea30483b3f7bb
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

What Analyzer are you using? zzBuffer belongs to the tokenizer's automaton
that is generated by JFlex. I've checked StandardTokenizerImpl and zzBuffer
can grow, beyond the default 16KB, but yours look to be a lot bigger (33 MB
!?). The only explanation I have to this is that you're trying to (or in th=
e
process have tried to) parse a very long file, which its text couldn't be
broken down to small tokens (maybe due to a lack of spaces or something) ..=
.

It'd be good if you tell us the Analyzer you use as well as if you can
identify a problematic document in your collection which can cause the
buffer to grow that much.

Shai

On Thu, Apr 8, 2010 at 1:23 AM, Ruben Laguna <ruben.laguna@gmail.com> wrote=
:

> I want to add that it tried this in both 2.9.0 and 3.0.1 and I got the sa=
me
> "leaky" behavior.
>
> See [3] for a screenshot of zzBuffer of 67MB on Lucene 3.0.1.
>
> I managed to get rid of the Reader's "memory leak" by actually setting to
> null the pointer to the actual Tika's Reader in my wrapper when the wrapp=
er
> is closed. But I still think that I would be nicer if IndexWriter wouldn'=
t
> maintain references to the Readers after indexing.
>
> [3] http://img.skitch.com/20100407-ntn2kg13fx49wx4q118bp9h1hb.jpg
>
>
> On Wed, Apr 7, 2010 at 10:35 PM, Ruben Laguna <ruben.laguna@gmail.com
> >wrote:
>
> > Hi,
> >
> > It seems like my IndexWriter after commiting and optimizing has a
> retained
> > size of 140Mb. See [1] for a screenshot of the heapdump analysis done
> with
> > Eclipse MAT.
> >
> > Of those 140MB 67MB are retained by
> >
> analyzer.tokenStreams.hardRefs.table.HashMap$Entry.value.tokenStream.scan=
ner.zzBuffer
> >
> >
> > why is this? Is it a memory leak? or did I something wrong during the
> > indxing? (BTW, I'm indexing document which contains Fields(xxxx,Reader)
> and
> > those Reader are wrappers around Tika.parse(xxxx) Readers. I get a lot
> > IOExceptions from tika readers and the wrapper maps the exceptions to E=
OF
> so
> > Lucene doesn't see the exception).
> >
> >
> >
> > ...and 73MB of the 140MB are retained by docWriter see [2]. It looks li=
ke
> > the Field objects in the
> > array docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx] are
> > holding references to the Readers. Those reader instances are actually
> > closed after IndexWriter.updateDocument. Each one of those Readers
> retains
> > 1MB. The question is why IndexWriter holds references to those Readers
> after
> > the Documents have been indexed.
> >
> >
> > [1] http://img.skitch.com/20100407-1183815yiausisg73u9wfgscsj.jpg
> > [2] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
> >
> > --
> > /Rub=E9n
> >
>
>
>
> --
> /Rub=E9n
>

--0016e65c7f60967ea30483b3f7bb--

From java-user-return-45710-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 07:24:07 2010
Return-Path: <java-user-return-45710-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65333 invoked from network); 8 Apr 2010 07:24:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 07:24:07 -0000
Received: (qmail 73168 invoked by uid 500); 8 Apr 2010 07:24:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73127 invoked by uid 500); 8 Apr 2010 07:24:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73119 invoked by uid 99); 8 Apr 2010 07:24:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 07:24:04 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=FREEMAIL_FROM,HTML_FONT_FACE_BAD,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 07:23:57 +0000
Received: by wwb39 with SMTP id 39so45765wwb.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 00:23:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=WwmSeFVKOVbPFVdXbwFfzU62oRfiaJpH+pUmHdXSQSI=;
        b=anRIVxsG/ndVwUyiq+HTW6btFWO4NsrQ74ADhBeVswq3QYGf610af8rb1dTI8sCMRs
         aA2FN6t3veyHyEGUChkAZ8r2lPRKgNoOllth310kYpwMAWbyQheiJnOV+spfqqwWvHi5
         YjfEahxm/Qcuh/6kG4BRmBKu8mBRrhvtV4T4k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=vwKs83/lBX7IkBawCaAonqMw8kG556uDmQFPuEvQb7fbY/nkJMQ1j8b+siAVw7fS+g
         cqr6qa2Jlj48VTnx2rxA7J9QDOAjM/V3Hr1tv5SbOeE9w015jNMC8lCXoJpG3YbaClUV
         6mIQAFkq7+4oAwxE+7gQanOOVkKVplQmyITYU=
MIME-Version: 1.0
Received: by 10.216.53.200 with HTTP; Thu, 8 Apr 2010 00:23:36 -0700 (PDT)
In-Reply-To: <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
Date: Thu, 8 Apr 2010 09:23:36 +0200
Received: by 10.216.180.82 with SMTP id i60mr185331wem.107.1270711416845; Thu, 
	08 Apr 2010 00:23:36 -0700 (PDT)
Message-ID: <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363ba3c49cf5140483b48e36
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363ba3c49cf5140483b48e36
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I'm using StandardAnalyzer.

I indeed parse large documents, xml and pdfs, using nekohtml and tika
respectively.

I took a look to the zzBuffer value contents (by exporting it to a file wit=
h
Eclipse MAT from the heapdump) and it seems to contain normal text from
several documents. See below

cat heapdumps/zzBuffer/value|iconv -f UTF-16 -t UTF-8|head

On the NetBeans Platform Build Harness
=C2=AB/on-the-netbeans-platform-build-harness/atform Build Harness

   Abstract
  The NetBeans build harness performs a number of tasks when building a
NetBeans platform application. This article describes some of the issues
that can be encountered when building platform applications in other ways
than the standard use case of creating and building it on a single PC in th=
e
NetBeans IDE. It also provides some tips for customising build behaviour.


but it's difficult to tell if there is also a big token in the file due to
the fact that I have no easy way to visualize it. (iconv is skipping things
). (hexdump -C doesn't really help to see the contents).

Do you know of anyway of actually indentifying the offending token or to
list the tokens in the zzBuffer in an human readable way?

I would like to identify also the problematic document I have 10000 so, wha=
t
would be the best way of identifying the one that it making zzBuffer to gro=
w
without control?

Best regards/Ruben

On Thu, Apr 8, 2010 at 8:41 AM, Shai Erera <serera@gmail.com> wrote:

> What Analyzer are you using? zzBuffer belongs to the tokenizer's automato=
n
> that is generated by JFlex. I've checked StandardTokenizerImpl and zzBuff=
er
> can grow, beyond the default 16KB, but yours look to be a lot bigger (33 =
MB
> !?). The only explanation I have to this is that you're trying to (or in
> the
> process have tried to) parse a very long file, which its text couldn't be
> broken down to small tokens (maybe due to a lack of spaces or something)
> ...
>
> It'd be good if you tell us the Analyzer you use as well as if you can
> identify a problematic document in your collection which can cause the
> buffer to grow that much.
>
> Shai
>
> On Thu, Apr 8, 2010 at 1:23 AM, Ruben Laguna <ruben.laguna@gmail.com>
> wrote:
>
> > I want to add that it tried this in both 2.9.0 and 3.0.1 and I got the
> same
> > "leaky" behavior.
> >
> > See [3] for a screenshot of zzBuffer of 67MB on Lucene 3.0.1.
> >
> > I managed to get rid of the Reader's "memory leak" by actually setting =
to
> > null the pointer to the actual Tika's Reader in my wrapper when the
> wrapper
> > is closed. But I still think that I would be nicer if IndexWriter
> wouldn't
> > maintain references to the Readers after indexing.
> >
> > [3] http://img.skitch.com/20100407-ntn2kg13fx49wx4q118bp9h1hb.jpg
> >
> >
> > On Wed, Apr 7, 2010 at 10:35 PM, Ruben Laguna <ruben.laguna@gmail.com
> > >wrote:
> >
> > > Hi,
> > >
> > > It seems like my IndexWriter after commiting and optimizing has a
> > retained
> > > size of 140Mb. See [1] for a screenshot of the heapdump analysis done
> > with
> > > Eclipse MAT.
> > >
> > > Of those 140MB 67MB are retained by
> > >
> >
> analyzer.tokenStreams.hardRefs.table.HashMap$Entry.value.tokenStream.scan=
ner.zzBuffer
> > >
> > >
> > > why is this? Is it a memory leak? or did I something wrong during the
> > > indxing? (BTW, I'm indexing document which contains Fields(xxxx,Reade=
r)
> > and
> > > those Reader are wrappers around Tika.parse(xxxx) Readers. I get a lo=
t
> > > IOExceptions from tika readers and the wrapper maps the exceptions to
> EOF
> > so
> > > Lucene doesn't see the exception).
> > >
> > >
> > >
> > > ...and 73MB of the 140MB are retained by docWriter see [2]. It looks
> like
> > > the Field objects in the
> > > array docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx] ar=
e
> > > holding references to the Readers. Those reader instances are actuall=
y
> > > closed after IndexWriter.updateDocument. Each one of those Readers
> > retains
> > > 1MB. The question is why IndexWriter holds references to those Reader=
s
> > after
> > > the Documents have been indexed.
> > >
> > >
> > > [1] http://img.skitch.com/20100407-1183815yiausisg73u9wfgscsj.jpg
> > > [2] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
> > >
> > > --
> > > /Rub=C3=A9n
> > >
> >
> >
> >
> > --
> > /Rub=C3=A9n
> >
>



--=20
/Rub=C3=A9n

--0016363ba3c49cf5140483b48e36--

From java-user-return-45711-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 07:34:23 2010
Return-Path: <java-user-return-45711-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67515 invoked from network); 8 Apr 2010 07:34:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 07:34:23 -0000
Received: (qmail 85898 invoked by uid 500); 8 Apr 2010 07:34:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85720 invoked by uid 500); 8 Apr 2010 07:34:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85707 invoked by uid 99); 8 Apr 2010 07:34:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 07:34:20 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 07:34:12 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id AED53D36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 09:33:52 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 51wbv8JMck22 for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 09:33:46 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id A6D69D36002
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 09:33:46 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com> <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
In-Reply-To: <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 09:33:49 +0200
Message-ID: <007d01cad6ed$d4bc64b0$7e352e10$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrW7HxUsrEGlGlSSGmnbtlkNRMjDwAAQptw
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Ruben,

as Shai already pointed out, the buffer with this large size is hold by =
"StandardTokenizer", which is used in the "StandardAnalyzer". This code =
is out of Lucene's control, as it is generated by the jFlex library.

As long as the IndexWriter instance is living, the buffer is hold =
implicitely by the Analyzer. If you want to shrink the buffer, file a =
bug against JFlex. For reuse, StandardAnalyzer holds the Tokenizer =
instance as long as it lives. As you pass the Analyzer to the =
IndexWriter it will only be GCed when IndexWriter is GCed.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> Sent: Thursday, April 08, 2010 9:24 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter memory leak?
>=20
> I'm using StandardAnalyzer.
>=20
> I indeed parse large documents, xml and pdfs, using nekohtml and tika
> respectively.
>=20
> I took a look to the zzBuffer value contents (by exporting it to a =
file
> with
> Eclipse MAT from the heapdump) and it seems to contain normal text =
from
> several documents. See below
>=20
> cat heapdumps/zzBuffer/value|iconv -f UTF-16 -t UTF-8|head
>=20
> On the NetBeans Platform Build Harness
> =C2=AB/on-the-netbeans-platform-build-harness/atform Build Harness
>=20
>    Abstract
>   The NetBeans build harness performs a number of tasks when building =
a
> NetBeans platform application. This article describes some of the
> issues
> that can be encountered when building platform applications in other
> ways
> than the standard use case of creating and building it on a single PC
> in the
> NetBeans IDE. It also provides some tips for customising build
> behaviour.
>=20
>=20
> but it's difficult to tell if there is also a big token in the file =
due
> to
> the fact that I have no easy way to visualize it. (iconv is skipping
> things
> ). (hexdump -C doesn't really help to see the contents).
>=20
> Do you know of anyway of actually indentifying the offending token or
> to
> list the tokens in the zzBuffer in an human readable way?
>=20
> I would like to identify also the problematic document I have 10000 =
so,
> what
> would be the best way of identifying the one that it making zzBuffer =
to
> grow
> without control?
>=20
> Best regards/Ruben
>=20
> On Thu, Apr 8, 2010 at 8:41 AM, Shai Erera <serera@gmail.com> wrote:
>=20
> > What Analyzer are you using? zzBuffer belongs to the tokenizer's
> automaton
> > that is generated by JFlex. I've checked StandardTokenizerImpl and
> zzBuffer
> > can grow, beyond the default 16KB, but yours look to be a lot bigger
> (33 MB
> > !?). The only explanation I have to this is that you're trying to =
(or
> in
> > the
> > process have tried to) parse a very long file, which its text
> couldn't be
> > broken down to small tokens (maybe due to a lack of spaces or
> something)
> > ...
> >
> > It'd be good if you tell us the Analyzer you use as well as if you
> can
> > identify a problematic document in your collection which can cause
> the
> > buffer to grow that much.
> >
> > Shai
> >
> > On Thu, Apr 8, 2010 at 1:23 AM, Ruben Laguna =
<ruben.laguna@gmail.com>
> > wrote:
> >
> > > I want to add that it tried this in both 2.9.0 and 3.0.1 and I got
> the
> > same
> > > "leaky" behavior.
> > >
> > > See [3] for a screenshot of zzBuffer of 67MB on Lucene 3.0.1.
> > >
> > > I managed to get rid of the Reader's "memory leak" by actually
> setting to
> > > null the pointer to the actual Tika's Reader in my wrapper when =
the
> > wrapper
> > > is closed. But I still think that I would be nicer if IndexWriter
> > wouldn't
> > > maintain references to the Readers after indexing.
> > >
> > > [3] http://img.skitch.com/20100407-ntn2kg13fx49wx4q118bp9h1hb.jpg
> > >
> > >
> > > On Wed, Apr 7, 2010 at 10:35 PM, Ruben Laguna
> <ruben.laguna@gmail.com
> > > >wrote:
> > >
> > > > Hi,
> > > >
> > > > It seems like my IndexWriter after commiting and optimizing has =
a
> > > retained
> > > > size of 140Mb. See [1] for a screenshot of the heapdump analysis
> done
> > > with
> > > > Eclipse MAT.
> > > >
> > > > Of those 140MB 67MB are retained by
> > > >
> > >
> >
> =
analyzer.tokenStreams.hardRefs.table.HashMap$Entry.value.tokenStream.sc
> anner.zzBuffer
> > > >
> > > >
> > > > why is this? Is it a memory leak? or did I something wrong =
during
> the
> > > > indxing? (BTW, I'm indexing document which contains
> Fields(xxxx,Reader)
> > > and
> > > > those Reader are wrappers around Tika.parse(xxxx) Readers. I get
> a lot
> > > > IOExceptions from tika readers and the wrapper maps the
> exceptions to
> > EOF
> > > so
> > > > Lucene doesn't see the exception).
> > > >
> > > >
> > > >
> > > > ...and 73MB of the 140MB are retained by docWriter see [2]. It
> looks
> > like
> > > > the Field objects in the
> > > > array
> docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx] are
> > > > holding references to the Readers. Those reader instances are
> actually
> > > > closed after IndexWriter.updateDocument. Each one of those
> Readers
> > > retains
> > > > 1MB. The question is why IndexWriter holds references to those
> Readers
> > > after
> > > > the Documents have been indexed.
> > > >
> > > >
> > > > [1] =
http://img.skitch.com/20100407-1183815yiausisg73u9wfgscsj.jpg
> > > > [2] =
http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
> > > >
> > > > --
> > > > /Rub=C3=A9n
> > > >
> > >
> > >
> > >
> > > --
> > > /Rub=C3=A9n
> > >
> >
>=20
>=20
>=20
> --
> /Rub=C3=A9n


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45712-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 07:36:01 2010
Return-Path: <java-user-return-45712-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67833 invoked from network); 8 Apr 2010 07:36:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 07:36:01 -0000
Received: (qmail 88458 invoked by uid 500); 8 Apr 2010 07:35:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88394 invoked by uid 500); 8 Apr 2010 07:35:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 88385 invoked by uid 99); 8 Apr 2010 07:35:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 07:35:59 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 07:35:50 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id E449AD36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 09:35:29 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Te77kWpBybUJ for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 09:35:27 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 6BA71D36002
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 09:35:27 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com> <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
In-Reply-To: <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 09:35:30 +0200
Message-ID: <007e01cad6ee$10c8dc40$325a94c0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrW7HxUsrEGlGlSSGmnbtlkNRMjDwAAW0KQ
Content-Language: de
x-cr-hashedpuzzle: AKZH AbFc BoL+ Cw8w EDiT E5wX FVt9 F5eH G0U8 G+eX HWvl KhR3 Klch Kwu5 LSi0 Lbez;1;agBhAHYAYQAtAHUAcwBlAHIAQABsAHUAYwBlAG4AZQAuAGEAcABhAGMAaABlAC4AbwByAGcA;Sosha1_v1;7;{AE9608BF-DA08-4069-9FF0-E463310FDD81};dQB3AGUAQAB0AGgAZQB0AGEAcABoAGkALgBkAGUA;Thu, 08 Apr 2010 07:35:28 GMT;UgBFADoAIABJAG4AZABlAHgAVwByAGkAdABlAHIAIABtAGUAbQBvAHIAeQAgAGwAZQBhAGsAPwA=
x-cr-puzzleid: {AE9608BF-DA08-4069-9FF0-E463310FDD81}
X-Virus-Checked: Checked by ClamAV on apache.org

> I would like to identify also the problematic document I have 10000 =
so,
> what
> would be the best way of identifying the one that it making zzBuffer =
to
> grow
> without control?

Dont index your documents, but instead pass them directly to the =
analyzer and consume the tokenstream manually. Then visit =
TermAttribute.termLength() for each Token.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45713-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 09:32:30 2010
Return-Path: <java-user-return-45713-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86708 invoked from network); 8 Apr 2010 09:32:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 09:32:30 -0000
Received: (qmail 10982 invoked by uid 500); 8 Apr 2010 09:32:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10811 invoked by uid 500); 8 Apr 2010 09:32:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10803 invoked by uid 99); 8 Apr 2010 09:32:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 09:32:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 72.14.220.156 as permitted sender)
Received: from [72.14.220.156] (HELO fg-out-1718.google.com) (72.14.220.156)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 09:32:20 +0000
Received: by fg-out-1718.google.com with SMTP id d23so776635fga.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 02:32:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=qiyD1bz+FRRbLWDRlgr5+mg+4n/5cuRNATIWRCJJUn4=;
        b=owC2pUafq8QQqTn2F3vg9WOvqSYqQDS+dzkbtyn2OQxRGPElFWfCZ8NcXjQ+SOUv6d
         qwzX53MASY6gjXD9OPSl92fB3d/ECY4ay/uUY1Vtqd9ene55UZXlHUTUOzmXzGEnj54g
         cW1vR30dT18X2xlMAcRyX3sBY1plyJUiy1AoM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=KDSEdkHUXtISRjpAWPk8Rtvi5neWTDUn9/89llhsmkpp8HqQ3bBoheIBARA+19mnAp
         GdpQiPjujHL9oAVoHKqZrDZf/9kTDxX2vRgV+oaNigANx2kmDQ2IWhy0HlFJGB9o6o2C
         wJVqApqcBNeu60JBSlYvlusmrLxenk9exojHI=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Thu, 8 Apr 2010 02:32:00 -0700 (PDT)
In-Reply-To: <007e01cad6ee$10c8dc40$325a94c0$@de>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
Date: Thu, 8 Apr 2010 12:32:00 +0300
Received: by 10.102.170.9 with SMTP id s9mr5560655mue.77.1270719120585; Thu, 
	08 Apr 2010 02:32:00 -0700 (PDT)
Message-ID: <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364c7749cab6360483b65948
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364c7749cab6360483b65948
Content-Type: text/plain; charset=ISO-8859-1

If we could change the Flex file so that yyreset(Reader) would check the
size of zzBuffer, we could trim it when it gets too big. But I don't think
we have such control when writing the flex syntax ... yyreset is generated
by JFlex and that's the only place I can think of to trim the buffer down
when it exceeds a predefined threshold ....

Maybe what we can do is create our own method which will be called by
StandardTokenizer after yyreset is called, something like
trimBufferIfTooBig(int threshold) which will reallocate zzBuffer if it
exceeded the threshold. We can decide on a reasonable 64K threshold or
something, or simply always cut back to 16 KB. As far as I understand, that
buffer should never grow that much. I.e. in zzRefill, which is the only
place where the buffer gets resized, there is an attempt to first move back
characters that were already consumed and only then allocate a bigger
buffer. Which means only if there is a token whose size is larger than 16KB
(!?), will this buffer get expanded.

A trimBuffer method might not be that bad .. as a protective measure. What
do you think? Of course, JFlex can fix it on their own ... but until that
happens ...

Shai

On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de> wrote:

> > I would like to identify also the problematic document I have 10000 so,
> > what
> > would be the best way of identifying the one that it making zzBuffer to
> > grow
> > without control?
>
> Dont index your documents, but instead pass them directly to the analyzer
> and consume the tokenstream manually. Then visit TermAttribute.termLength()
> for each Token.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364c7749cab6360483b65948--

From java-user-return-45714-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 09:34:24 2010
Return-Path: <java-user-return-45714-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87052 invoked from network); 8 Apr 2010 09:34:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 09:34:24 -0000
Received: (qmail 13964 invoked by uid 500); 8 Apr 2010 09:34:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13878 invoked by uid 500); 8 Apr 2010 09:34:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13870 invoked by uid 99); 8 Apr 2010 09:34:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 09:34:21 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 09:34:14 +0000
Received: by gwaa12 with SMTP id a12so1038725gwa.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 02:33:53 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Thu, 8 Apr 2010 02:33:52 -0700 (PDT)
In-Reply-To: <h2ha8a24f021004071209n18ae62faocd513c8b6947a82@mail.gmail.com>
References: <1269560430303-576998.post@n3.nabble.com>
	 <9ac0c6aa1003260601k6cbdf772tce7317d02dc62697@mail.gmail.com>
	 <h2ha8a24f021004071209n18ae62faocd513c8b6947a82@mail.gmail.com>
Date: Thu, 8 Apr 2010 05:33:52 -0400
Received: by 10.150.8.14 with SMTP id 14mr10444860ybh.334.1270719232779; Thu, 
	08 Apr 2010 02:33:52 -0700 (PDT)
Message-ID: <k2i9ac0c6aa1004080233q1ab4c9aap918f1c5396a5e2f5@mail.gmail.com>
Subject: Re: custom low-level indexer (to speed things up) when fields, terms 
	and docids are in order
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Very interesting!

Newer versions of Lucene have cutover to dedicated utility class
(oal.util.StringHelper) for faster interning w/ threads.  I wonder if
that'd help your case.... which Lucene version are you using?

Thanks for bringing closure,

Mike

On Wed, Apr 7, 2010 at 3:09 PM, britske <gbrits@gmail.com> wrote:
>
> Just to update and close this thread (I forgot about it) :
>
> after investigation it turns out that 75% of the time of the custom
> async-indexer (see original email) was spend in FieldInfos.add(...) . Mor=
e
> specifically in the part where fieldname is interned using String.intern(=
).
> Copy/pasing and using a custom FieldInfos class which doesn't use
> String.intern() increased throughput a lot..
> In my situation (custom low-level indexer) I don't rely on String.intern(=
)
> in the lucene-code. (no merging of segments etc. where I believe the code=
 is
> used.)
> anyway, throughput increased a lot, and I'm satisfied.
>
> Thanks, I've learned a lot from the Lucene internals.
> Geert-Jan
>
> 2010/3/26 Geert-Jan Brits <gbrits@gmail.com>
>
>> define fun ;-)
>>
>> indeed I created a custom indexing chain, plugged it in and all works
>> well.
>> I'm currently trying to isolate the critical parts to double test that
>> indeed most of the time goes in the indexing process.
>> It's kind of hard doing accurate measurements bc. the indexer is designe=
d
>> to be running asychronously from the process that calculates the maps et=
c
>> ,so to make use of concurrent IO and CPU.
>>
>> however from a birds-eys view: disabling the async custom indexer and on=
ly
>> doing the described calculating/ populating of the ordered maps increase=
s
>> throughput from 1.8 docs/sec to 5.4 docs/sec, while with or without aysn=
c
>> indexer enabled the total application is never cpu-bound. (not even clos=
e)
>>
>> Investigating more, and reporting back.
>>
>> Glad you liked the case ;-)
>>
>> Geert-Jan
>>
>> 2010/3/26 Michael McCandless-2 [via Lucene] <
>> ml-node+676471-1074052327-38570@n3.nabble.com<ml-node%2B676471-107405232=
7-38570@n3.nabble.com>
>> >
>>
>> =A0This sounds like fun :)
>>>
>>> So you've already created a custom indexing chain, and plugged this
>>> into DocumentsWriter? =A0And this chain directly interacts with the low
>>> level classes for writing a segment (FormatPostingsTerms/DocsConsumer,
>>> etc.)?
>>>
>>> I'm not sure you're gonna do much better than that... these classes
>>> already expect things "in order" and all they do (pretty much) is
>>> write the index files. =A0I think they should be pretty lean...
>>>
>>> Also, once flex lands, soon (note that it moves these low level
>>> interfaces/classes around)... since you're using these classes for
>>> writing, it'll mean you can freely swap in different codecs.
>>>
>>> The only thing you can do further is to conflate your custom code with
>>> the codec, ie, so that you make a single chain that directly writes
>>> index files. =A0But I'm not sure you'll gain much performance by doing
>>> so... (and then you can't [as easily] swap codecs).
>>>
>>> Have you profiled to see where the time is being spent?
>>>
>>> Mike
>>>
>>> On Thu, Mar 25, 2010 at 7:40 PM, britske <[hidden email]<http://n3.nabb=
le.com/user/SendEmail.jtp?type=3Dnode&node=3D676471&i=3D0>>
>>> wrote:
>>>
>>> >
>>> > Hi,
>>> >
>>> > perhaps first some background:
>>> >
>>> > I need to speed-up indexing for an particular application which has a
>>> pretty
>>> > unsual schema: besides the normal stored and indexed fields we have
>>> about
>>> > 20.000 fields =A0per document which are all indexed/ non-stored sInts=
.
>>> >
>>> > Obviously indexing was really slow with such a number of fields. With
>>> > indexing through Solr we got about 0.3 docs/ sec ( on a ec2 m1.large
>>> > instance)
>>> >
>>> > Since these ~20.000 fields are all build/ calculated analogously, we
>>> figured
>>> > it would be possible to possibly build a low-level indexer for these
>>> fields
>>> > (of which we had domain knowledge which we could use to possibly spee=
d
>>> > indexing up) and later merge them with the other fields to construct =
the
>>>
>>> > entire index. So we did and now achieve around 1.8 docs/ sec (6x
>>> speedup).
>>> > Not bad, but still not enough.
>>> >
>>> > As part of calculating these fields, we keep track of all fields, ter=
ms
>>> per
>>> > field, and docids per term ( per field) .
>>> > all the stuff is then ordered: the fields, the terms available for ea=
ch
>>> > field, the docids per term and inserted in that order using lowel-lev=
el
>>> > classes like: FormatPostingsFieldsWriter , FormatPostingsTermsConsume=
r,
>>> > FormatPostingsDocsConsumer (pseudo-code below)
>>> >
>>> > This constructs the following files: .tis, .tii, .frq. =A0( + some de=
fault
>>>
>>> > values for the other required files, which don't need actual data bc.
>>> these
>>> > fields are not stored..)
>>> >
>>> > I should also mention that each call to the indexer writes all availa=
ble
>>>
>>> > fields, terms, docids to a new fsdirectory. So basically each call
>>> results
>>> > in a complete index. (containing about 100 docs each, bc. otherwise w=
e
>>> run
>>> > into mem-problems keeping the =A0ordered maps)
>>> >
>>> > Since we already have all fields, terms, docids in order it seems (a =
lot
>>> of
>>> > ) overkill to me to be going through the methods that above-mentioned
>>> > classes offer, which were meant for more 'non-sequential / non-ordere=
d'
>>> > inserts (AFAIK).
>>> >
>>> > What would be the best way to write .tis, .tii and .frq ni a more
>>> sequential
>>> > matter?
>>> > I'm looking for something that would construct a byte-array for each
>>> file
>>> > that conforms to the index-file definition of that particular file (o=
r
>>> > something) . I could try to do it myself and completely bypass all
>>> > indexing-classes altogether and just write the files to disk. (Possib=
le
>>> bc.
>>> > as mentioned we have all data needed to construct a complete index) .
>>> >
>>> > However, perhaps there are classes I'm not aware of that help in gett=
ing
>>> the
>>> > format right (it seems like a lot of trial-and-error coding otherwise=
)
>>> >
>>> > Thanks for any help, pointers, etc.
>>> >
>>> > Geert-Jan
>>> >
>>> >
>>> >
>>> > PSEUDO-CODE of the current low-level (not-so) sequential indexer:
>>> >
>>> > =A0 =A0 =A0 =A0foreach(String sField: fieldsInOrder){
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0--> add field to FieldInfos and grab n=
ewly created
>>> fieldInfo
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0--> add fieldInfo to FormatPostingsFie=
ldsWriter and grab
>>> > formatPostingsTermsConsumer
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0List<String> termsInOrder =3D
>>> termsInOrderForFieldMap(sField);
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0foreach(String sTerm: termsInOrder){
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0FormatPostingsDocsCons=
umer frq =3D
>>> formatPostingsTermsConsumer.add(sTerm);
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0List<Integer> docidsIn=
OrderPerFieldTerm =3D
>>> > docidsInOrderPerFieldTermMap(sField+"-"+sTerm);
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0for(Integer docid:doci=
dsInOrderPerFieldTerm){
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0frq.ad=
dDoc(docid);
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0//close relevant stuff
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0//close relevant stuff
>>> > =A0 =A0 =A0 =A0}
>>> > =A0 =A0 =A0 =A0//close relevant stuff
>>> >
>>> >
>>> >
>>> > --
>>> > View this message in context:
>>> http://n3.nabble.com/custom-low-level-indexer-to-speed-things-up-when-f=
ields-terms-and-docids-are-in-order-tp576998p576998.html
>>> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>> >
>>> > ---------------------------------------------------------------------
>>> > To unsubscribe, e-mail: [hidden email]<http://n3.nabble.com/user/Send=
Email.jtp?type=3Dnode&node=3D676471&i=3D1>
>>> > For additional commands, e-mail: [hidden email]<http://n3.nabble.com/=
user/SendEmail.jtp?type=3Dnode&node=3D676471&i=3D2>
>>> >
>>> >
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: [hidden email]<http://n3.nabble.com/user/SendEm=
ail.jtp?type=3Dnode&node=3D676471&i=3D3>
>>> For additional commands, e-mail: [hidden email]<http://n3.nabble.com/us=
er/SendEmail.jtp?type=3Dnode&node=3D676471&i=3D4>
>>>
>>>
>>>
>>> ------------------------------
>>> =A0View message @
>>> http://n3.nabble.com/custom-low-level-indexer-to-speed-things-up-when-f=
ields-terms-and-docids-are-in-order-tp576998p676471.html
>>> To unsubscribe from custom low-level indexer (to speed things up) when
>>> fields, terms and docids are in order, click here< (link removed) =3D=
=3D>.
>>>
>>>
>>>
>>
>
> --
> View this message in context: http://n3.nabble.com/custom-low-level-index=
er-to-speed-things-up-when-fields-terms-and-docids-are-in-order-tp576998p70=
3958.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45715-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 09:51:30 2010
Return-Path: <java-user-return-45715-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89351 invoked from network); 8 Apr 2010 09:51:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 09:51:30 -0000
Received: (qmail 29424 invoked by uid 500); 8 Apr 2010 09:51:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29278 invoked by uid 500); 8 Apr 2010 09:51:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29270 invoked by uid 99); 8 Apr 2010 09:51:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 09:51:27 +0000
X-ASF-Spam-Status: No, hits=1.7 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ruben.laguna@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 09:51:22 +0000
Received: by wwb39 with SMTP id 39so118866wwb.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 02:51:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=pylvTamXmdKcCvvoa3EZKHwPEex2vemvlK6PMCzI4Q8=;
        b=aMX2VAVIzGg4RJqO/vNKD5lu0L0hLpempJpvQvht6iHETtNJbZT6ziyf+b31WBzeib
         LK5ivcWI2pk72WEC+dISsrFAv+9jvgnGQCAnTReTr6otAN0Q22AIG7HRiTlZT5dBaHUT
         M0HpumQeXD5odU3AIvHKzYMMFCI9MARxL/MgU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=E4mSgE5n0w9nMSfYZop1Ss5CKZcPcyLrfUPXH8me+xFvj2JDDtDgXFJRN1wPBSXb4A
         Xgg/Q3SAquyaQ5kcWV5mT8nLhHy5vUqoP3eIAsqVsAhcoCfNCAarQa8/T8HWssk3lp8I
         7eM7FR1t7O3k3WU36ZxhKwLomcXzwq3p+uas4=
MIME-Version: 1.0
Received: by 10.216.53.200 with HTTP; Thu, 8 Apr 2010 02:51:00 -0700 (PDT)
In-Reply-To: <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
Date: Thu, 8 Apr 2010 11:51:00 +0200
Received: by 10.216.172.21 with SMTP id s21mr229647wel.61.1270720260606; Thu, 
	08 Apr 2010 02:51:00 -0700 (PDT)
Message-ID: <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e649846abe0cfb0483b69dad

--0016e649846abe0cfb0483b69dad
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I was investigating this a little further and in the JFlex mailing list I
found [1]

I don't know much about flex / JFlex but it seems that this guy resets the
zzBuffer to 16384 or less when setting the input for the lexer


Quoted from  shef <shef31@ya...>


I set

%buffer 0

in the options section, and then added this method to the lexer:

    /**
     * Set the input for the lexer. The size parameter really speeds things=
 up,
     * because by default, the lexer allocates an internal buffer of 16k. F=
or
     * most strings, this is unnecessarily large. If the size param is
0 or greater
     * than 16k, then the buffer is set to 16k. If the size param is
smaller, then
     * the buf will be set to the exact size.
     * @param r the reader that provides the data
     * @param the size of the data in the reader.
     */
    public void reset(Reader r, int size) {
        if (size =3D=3D 0 || size > 16384)
            size =3D 16384;
        zzBuffer =3D new char[size];
        yyreset(r);
    }


So maybe there is a way to trim the zzBuffer this way (?).

BTW, I will try to find out which is the "big token" in my dataset this
afternoon. Thanks for the help.

I actually workaround this memory problem for the time being by wrapping th=
e
IndexWriter in a class that periodically closes the IndexWriter and creates
a new one, allowing the old to be GCed, but I would be really good if eithe=
r
JFlex or Lucene can take care of this zzBuffer going berserk.


Again thanks for the quick response. /Rub=C3=A9n


[1]
https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@we=
b38901.mail.mud.yahoo.com

On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com> wrote:

> If we could change the Flex file so that yyreset(Reader) would check the
> size of zzBuffer, we could trim it when it gets too big. But I don't thin=
k
> we have such control when writing the flex syntax ... yyreset is generate=
d
> by JFlex and that's the only place I can think of to trim the buffer down
> when it exceeds a predefined threshold ....
>
> Maybe what we can do is create our own method which will be called by
> StandardTokenizer after yyreset is called, something like
> trimBufferIfTooBig(int threshold) which will reallocate zzBuffer if it
> exceeded the threshold. We can decide on a reasonable 64K threshold or
> something, or simply always cut back to 16 KB. As far as I understand, th=
at
> buffer should never grow that much. I.e. in zzRefill, which is the only
> place where the buffer gets resized, there is an attempt to first move ba=
ck
> characters that were already consumed and only then allocate a bigger
> buffer. Which means only if there is a token whose size is larger than 16=
KB
> (!?), will this buffer get expanded.
>
> A trimBuffer method might not be that bad .. as a protective measure. Wha=
t
> do you think? Of course, JFlex can fix it on their own ... but until that
> happens ...
>
> Shai
>
> On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
>
> > > I would like to identify also the problematic document I have 10000 s=
o,
> > > what
> > > would be the best way of identifying the one that it making zzBuffer =
to
> > > grow
> > > without control?
> >
> > Dont index your documents, but instead pass them directly to the analyz=
er
> > and consume the tokenstream manually. Then visit
> TermAttribute.termLength()
> > for each Token.
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>



--=20
/Rub=C3=A9n

--0016e649846abe0cfb0483b69dad--

From java-user-return-45716-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:00:24 2010
Return-Path: <java-user-return-45716-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90583 invoked from network); 8 Apr 2010 10:00:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:00:24 -0000
Received: (qmail 40063 invoked by uid 500); 8 Apr 2010 10:00:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39890 invoked by uid 500); 8 Apr 2010 10:00:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39877 invoked by uid 99); 8 Apr 2010 10:00:21 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:00:21 +0000
X-ASF-Spam-Status: No, hits=1.0 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:00:16 +0000
Received: by fxm8 with SMTP id 8so1874123fxm.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 02:59:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=CXdOwueRG5wA9QmxIqEBlMwHaF+eKaiqMQ1W7x99FWo=;
        b=OCqYILzrlKd6QqWdUgEA1sN3TKDIO2eqrcLaiYoxq+pHn5L4HsBePSfQbtcD1sy60f
         EtfulDhWczYV2cEE9bRghTwjCP4XG+TxjLtNTx1sim6LSi8LeBMx3ZDLqjaIbIrFc1Xj
         bPcHAiFw0TUjFI5ZS2yqSh0t884wUSncPkWPs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=uUoOLUm8rAUvQBU1T9zgGCXXLcckAOPrP0MzeLWhPh7SYKoWagvaX+1eqHsSPdk4Q6
         aOycdOP3QYGO+2QDevi89OQklBWo9WhcZROlNupKkAQcNa589D3xrpYW3GZWjJOX7F3I
         xYA6TBY7roECfqZ9wG96zcAotgnKC9ya+EBpw=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Thu, 8 Apr 2010 02:59:54 -0700 (PDT)
In-Reply-To: <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
Date: Thu, 8 Apr 2010 12:59:54 +0300
Received: by 10.103.4.10 with SMTP id g10mr599640mui.54.1270720794307; Thu, 08 
	Apr 2010 02:59:54 -0700 (PDT)
Message-ID: <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364166df8dad580483b6bd7c

--0016364166df8dad580483b6bd7c
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Yes, that's the trimBuffer version I was thinking about, only this guy
created a reset(Reader, int) and does both ops (resetting + trim) in one
method call. More convenient. Can you please open an issue to track that?
People will have a chance to comment on whether we (Lucene) should handle
that, or it should be a JFlex fix. Based on the number of replies this guy
received (0 !), I doubt JFlex would consider it a problem. But we can do
some small service to our users base by protecting against such problems.

And while you're opening the issue, if you want to take a stab at fixing it
and post a patch, it'd be great :).

Shai

On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna <ruben.laguna@gmail.com>wrote=
:

> I was investigating this a little further and in the JFlex mailing list I
> found [1]
>
> I don't know much about flex / JFlex but it seems that this guy resets th=
e
> zzBuffer to 16384 or less when setting the input for the lexer
>
>
> Quoted from  shef <shef31@ya...>
>
>
> I set
>
> %buffer 0
>
> in the options section, and then added this method to the lexer:
>
>    /**
>     * Set the input for the lexer. The size parameter really speeds thing=
s
> up,
>     * because by default, the lexer allocates an internal buffer of 16k.
> For
>     * most strings, this is unnecessarily large. If the size param is
> 0 or greater
>     * than 16k, then the buffer is set to 16k. If the size param is
> smaller, then
>     * the buf will be set to the exact size.
>     * @param r the reader that provides the data
>     * @param the size of the data in the reader.
>     */
>    public void reset(Reader r, int size) {
>        if (size =3D=3D 0 || size > 16384)
>            size =3D 16384;
>        zzBuffer =3D new char[size];
>        yyreset(r);
>    }
>
>
> So maybe there is a way to trim the zzBuffer this way (?).
>
> BTW, I will try to find out which is the "big token" in my dataset this
> afternoon. Thanks for the help.
>
> I actually workaround this memory problem for the time being by wrapping
> the
> IndexWriter in a class that periodically closes the IndexWriter and creat=
es
> a new one, allowing the old to be GCed, but I would be really good if
> either
> JFlex or Lucene can take care of this zzBuffer going berserk.
>
>
> Again thanks for the quick response. /Rub=E9n
>
>
> [1]
>
> https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@=
web38901.mail.mud.yahoo.com
>
> On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com> wrote:
>
> > If we could change the Flex file so that yyreset(Reader) would check th=
e
> > size of zzBuffer, we could trim it when it gets too big. But I don't
> think
> > we have such control when writing the flex syntax ... yyreset is
> generated
> > by JFlex and that's the only place I can think of to trim the buffer do=
wn
> > when it exceeds a predefined threshold ....
> >
> > Maybe what we can do is create our own method which will be called by
> > StandardTokenizer after yyreset is called, something like
> > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer if it
> > exceeded the threshold. We can decide on a reasonable 64K threshold or
> > something, or simply always cut back to 16 KB. As far as I understand,
> that
> > buffer should never grow that much. I.e. in zzRefill, which is the only
> > place where the buffer gets resized, there is an attempt to first move
> back
> > characters that were already consumed and only then allocate a bigger
> > buffer. Which means only if there is a token whose size is larger than
> 16KB
> > (!?), will this buffer get expanded.
> >
> > A trimBuffer method might not be that bad .. as a protective measure.
> What
> > do you think? Of course, JFlex can fix it on their own ... but until th=
at
> > happens ...
> >
> > Shai
> >
> > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
> >
> > > > I would like to identify also the problematic document I have 10000
> so,
> > > > what
> > > > would be the best way of identifying the one that it making zzBuffe=
r
> to
> > > > grow
> > > > without control?
> > >
> > > Dont index your documents, but instead pass them directly to the
> analyzer
> > > and consume the tokenstream manually. Then visit
> > TermAttribute.termLength()
> > > for each Token.
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
>
>
>
> --
> /Rub=E9n
>

--0016364166df8dad580483b6bd7c--

From java-user-return-45717-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:02:52 2010
Return-Path: <java-user-return-45717-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91043 invoked from network); 8 Apr 2010 10:02:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:02:52 -0000
Received: (qmail 44696 invoked by uid 500); 8 Apr 2010 10:02:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44575 invoked by uid 500); 8 Apr 2010 10:02:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44566 invoked by uid 99); 8 Apr 2010 10:02:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:02:49 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:02:41 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 836F5D36006
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 12:02:21 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id LpdQIJB1C-OI for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 12:02:16 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 4126AD36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 12:02:16 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>	 <007e01cad6ee$10c8dc40$325a94c0$@de>	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com> <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
In-Reply-To: <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 12:02:18 +0200
Message-ID: <00c201cad702$9321c210$b9654630$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrXARKSGy11v7wSRKmTEZbOMI8RowAATNDA
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Shai, hi Ruben,

I will take care of this in =
https://issues.apache.org/jira/browse/LUCENE-2074 where some parts of =
the Tokenizer impl are rewritten.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> Sent: Thursday, April 08, 2010 11:51 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter memory leak?
>=20
> I was investigating this a little further and in the JFlex mailing =
list
> I
> found [1]
>=20
> I don't know much about flex / JFlex but it seems that this guy resets
> the
> zzBuffer to 16384 or less when setting the input for the lexer
>=20
>=20
> Quoted from  shef <shef31@ya...>
>=20
>=20
> I set
>=20
> %buffer 0
>=20
> in the options section, and then added this method to the lexer:
>=20
>     /**
>      * Set the input for the lexer. The size parameter really speeds
> things up,
>      * because by default, the lexer allocates an internal buffer of
> 16k. For
>      * most strings, this is unnecessarily large. If the size param is
> 0 or greater
>      * than 16k, then the buffer is set to 16k. If the size param is
> smaller, then
>      * the buf will be set to the exact size.
>      * @param r the reader that provides the data
>      * @param the size of the data in the reader.
>      */
>     public void reset(Reader r, int size) {
>         if (size =3D=3D 0 || size > 16384)
>             size =3D 16384;
>         zzBuffer =3D new char[size];
>         yyreset(r);
>     }
>=20
>=20
> So maybe there is a way to trim the zzBuffer this way (?).
>=20
> BTW, I will try to find out which is the "big token" in my dataset =
this
> afternoon. Thanks for the help.
>=20
> I actually workaround this memory problem for the time being by
> wrapping the
> IndexWriter in a class that periodically closes the IndexWriter and
> creates
> a new one, allowing the old to be GCed, but I would be really good if
> either
> JFlex or Lucene can take care of this zzBuffer going berserk.
>=20
>=20
> Again thanks for the quick response. /Rub=C3=A9n
>=20
>=20
> [1]
> =
https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@=

> web38901.mail.mud.yahoo.com
>=20
> On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com> wrote:
>=20
> > If we could change the Flex file so that yyreset(Reader) would check
> the
> > size of zzBuffer, we could trim it when it gets too big. But I don't
> think
> > we have such control when writing the flex syntax ... yyreset is
> generated
> > by JFlex and that's the only place I can think of to trim the buffer
> down
> > when it exceeds a predefined threshold ....
> >
> > Maybe what we can do is create our own method which will be called =
by
> > StandardTokenizer after yyreset is called, something like
> > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer if
> it
> > exceeded the threshold. We can decide on a reasonable 64K threshold
> or
> > something, or simply always cut back to 16 KB. As far as I
> understand, that
> > buffer should never grow that much. I.e. in zzRefill, which is the
> only
> > place where the buffer gets resized, there is an attempt to first
> move back
> > characters that were already consumed and only then allocate a =
bigger
> > buffer. Which means only if there is a token whose size is larger
> than 16KB
> > (!?), will this buffer get expanded.
> >
> > A trimBuffer method might not be that bad .. as a protective =
measure.
> What
> > do you think? Of course, JFlex can fix it on their own ... but until
> that
> > happens ...
> >
> > Shai
> >
> > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
> wrote:
> >
> > > > I would like to identify also the problematic document I have
> 10000 so,
> > > > what
> > > > would be the best way of identifying the one that it making
> zzBuffer to
> > > > grow
> > > > without control?
> > >
> > > Dont index your documents, but instead pass them directly to the
> analyzer
> > > and consume the tokenstream manually. Then visit
> > TermAttribute.termLength()
> > > for each Token.
> > >
> > >
> > > =
-------------------------------------------------------------------
> --
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
>=20
>=20
>=20
> --
> /Rub=C3=A9n


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45718-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:04:36 2010
Return-Path: <java-user-return-45718-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91221 invoked from network); 8 Apr 2010 10:04:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:04:36 -0000
Received: (qmail 46950 invoked by uid 500); 8 Apr 2010 10:04:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46838 invoked by uid 500); 8 Apr 2010 10:04:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46830 invoked by uid 99); 8 Apr 2010 10:04:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:04:33 +0000
X-ASF-Spam-Status: No, hits=-0.8 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:04:27 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 8B8A8D36006
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 12:04:05 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id uis5NT4m1dpb for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 12:04:00 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 21E0FD36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 12:04:00 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>	 <007e01cad6ee$10c8dc40$325a94c0$@de>	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com> <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
In-Reply-To: <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 12:04:02 +0200
Message-ID: <00c301cad702$d10a4ca0$731ee5e0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrXAlF0Bum3sfJ0Q/ymD5gZdZj4MwAAHOaA
Content-Language: de

I already answered, that I will take care of this!

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Shai Erera [mailto:serera@gmail.com]
> Sent: Thursday, April 08, 2010 12:00 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter memory leak?
>=20
> Yes, that's the trimBuffer version I was thinking about, only this guy
> created a reset(Reader, int) and does both ops (resetting + trim) in
> one
> method call. More convenient. Can you please open an issue to track
> that?
> People will have a chance to comment on whether we (Lucene) should
> handle
> that, or it should be a JFlex fix. Based on the number of replies this
> guy
> received (0 !), I doubt JFlex would consider it a problem. But we can
> do
> some small service to our users base by protecting against such
> problems.
>=20
> And while you're opening the issue, if you want to take a stab at
> fixing it
> and post a patch, it'd be great :).
>=20
> Shai
>=20
> On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> <ruben.laguna@gmail.com>wrote:
>=20
> > I was investigating this a little further and in the JFlex mailing
> list I
> > found [1]
> >
> > I don't know much about flex / JFlex but it seems that this guy
> resets the
> > zzBuffer to 16384 or less when setting the input for the lexer
> >
> >
> > Quoted from  shef <shef31@ya...>
> >
> >
> > I set
> >
> > %buffer 0
> >
> > in the options section, and then added this method to the lexer:
> >
> >    /**
> >     * Set the input for the lexer. The size parameter really speeds
> things
> > up,
> >     * because by default, the lexer allocates an internal buffer of
> 16k.
> > For
> >     * most strings, this is unnecessarily large. If the size param =
is
> > 0 or greater
> >     * than 16k, then the buffer is set to 16k. If the size param is
> > smaller, then
> >     * the buf will be set to the exact size.
> >     * @param r the reader that provides the data
> >     * @param the size of the data in the reader.
> >     */
> >    public void reset(Reader r, int size) {
> >        if (size =3D=3D 0 || size > 16384)
> >            size =3D 16384;
> >        zzBuffer =3D new char[size];
> >        yyreset(r);
> >    }
> >
> >
> > So maybe there is a way to trim the zzBuffer this way (?).
> >
> > BTW, I will try to find out which is the "big token" in my dataset
> this
> > afternoon. Thanks for the help.
> >
> > I actually workaround this memory problem for the time being by
> wrapping
> > the
> > IndexWriter in a class that periodically closes the IndexWriter and
> creates
> > a new one, allowing the old to be GCed, but I would be really good =
if
> > either
> > JFlex or Lucene can take care of this zzBuffer going berserk.
> >
> >
> > Again thanks for the quick response. /Rub=C3=A9n
> >
> >
> > [1]
> >
> >
> =
https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@=

> web38901.mail.mud.yahoo.com
> >
> > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com> =
wrote:
> >
> > > If we could change the Flex file so that yyreset(Reader) would
> check the
> > > size of zzBuffer, we could trim it when it gets too big. But I
> don't
> > think
> > > we have such control when writing the flex syntax ... yyreset is
> > generated
> > > by JFlex and that's the only place I can think of to trim the
> buffer down
> > > when it exceeds a predefined threshold ....
> > >
> > > Maybe what we can do is create our own method which will be called
> by
> > > StandardTokenizer after yyreset is called, something like
> > > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer =
if
> it
> > > exceeded the threshold. We can decide on a reasonable 64K =
threshold
> or
> > > something, or simply always cut back to 16 KB. As far as I
> understand,
> > that
> > > buffer should never grow that much. I.e. in zzRefill, which is the
> only
> > > place where the buffer gets resized, there is an attempt to first
> move
> > back
> > > characters that were already consumed and only then allocate a
> bigger
> > > buffer. Which means only if there is a token whose size is larger
> than
> > 16KB
> > > (!?), will this buffer get expanded.
> > >
> > > A trimBuffer method might not be that bad .. as a protective
> measure.
> > What
> > > do you think? Of course, JFlex can fix it on their own ... but
> until that
> > > happens ...
> > >
> > > Shai
> > >
> > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
> wrote:
> > >
> > > > > I would like to identify also the problematic document I have
> 10000
> > so,
> > > > > what
> > > > > would be the best way of identifying the one that it making
> zzBuffer
> > to
> > > > > grow
> > > > > without control?
> > > >
> > > > Dont index your documents, but instead pass them directly to the
> > analyzer
> > > > and consume the tokenstream manually. Then visit
> > > TermAttribute.termLength()
> > > > for each Token.
> > > >
> > > >
> > > > =
-----------------------------------------------------------------
> ----
> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: =
java-user-help@lucene.apache.org
> > > >
> > > >
> > >
> >
> >
> >
> > --
> > /Rub=C3=A9n
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45719-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:05:15 2010
Return-Path: <java-user-return-45719-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91800 invoked from network); 8 Apr 2010 10:05:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:05:15 -0000
Received: (qmail 50361 invoked by uid 500); 8 Apr 2010 10:05:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50336 invoked by uid 500); 8 Apr 2010 10:05:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50328 invoked by uid 99); 8 Apr 2010 10:05:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:05:12 +0000
X-ASF-Spam-Status: No, hits=1.9 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ruben.laguna@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:05:07 +0000
Received: by wwb39 with SMTP id 39so126545wwb.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 03:04:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=ZguTUgVw8MGCLuaTzI7u67gt46rIMRBcEnx57Q4JWZA=;
        b=m3IbAG/NMcHsE/TQyVGnllJ2xk7ngYrrSkLc1kcupPIEJ+ALN5fF3xX+aQGw7QH30z
         dVdaGc7HVr3mVNCaq0nNH65SHZuhuig2suvt5N/Hc9A/gTURDYcAylICHzkeHnpIw5Yk
         BS4vtCI3NqnDYbZtvBt5f7U6nSHamoHLijm2Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=p5gW9BCCeg2XRx7nYNuYQl5vhXTSLtrML5SwRJL1b4ofqfoB4Lv9uLoAV0l5W37Vgx
         AhAqD2UJQQ6iXn8Un0PafbId8E1EPoSUU6hETBE2l30wxIAbxQ5LmfgWDlO+u6DR9Yev
         44JChjC6QLACTsapt+0SXYnRVTfOfwkdnINU0=
MIME-Version: 1.0
Received: by 10.216.53.200 with HTTP; Thu, 8 Apr 2010 03:04:44 -0700 (PDT)
In-Reply-To: <00c201cad702$9321c210$b9654630$@de>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <00c201cad702$9321c210$b9654630$@de>
Date: Thu, 8 Apr 2010 12:04:44 +0200
Received: by 10.216.90.21 with SMTP id d21mr233023wef.159.1270721085000; Thu, 
	08 Apr 2010 03:04:45 -0700 (PDT)
Message-ID: <o2xf8d56a4d1004080304y92a88308mde7b472577eb84b4@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d77fa0e14d630483b6cea0

--0016e6d77fa0e14d630483b6cea0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

That was fast! I was already writting a patch... just to see if it works.

On Thu, Apr 8, 2010 at 12:02 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> Hi Shai, hi Ruben,
>
> I will take care of this in
> https://issues.apache.org/jira/browse/LUCENE-2074 where some parts of the
> Tokenizer impl are rewritten.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> > Sent: Thursday, April 08, 2010 11:51 AM
> > To: java-user@lucene.apache.org
> > Subject: Re: IndexWriter memory leak?
> >
> > I was investigating this a little further and in the JFlex mailing list
> > I
> > found [1]
> >
> > I don't know much about flex / JFlex but it seems that this guy resets
> > the
> > zzBuffer to 16384 or less when setting the input for the lexer
> >
> >
> > Quoted from  shef <shef31@ya...>
> >
> >
> > I set
> >
> > %buffer 0
> >
> > in the options section, and then added this method to the lexer:
> >
> >     /**
> >      * Set the input for the lexer. The size parameter really speeds
> > things up,
> >      * because by default, the lexer allocates an internal buffer of
> > 16k. For
> >      * most strings, this is unnecessarily large. If the size param is
> > 0 or greater
> >      * than 16k, then the buffer is set to 16k. If the size param is
> > smaller, then
> >      * the buf will be set to the exact size.
> >      * @param r the reader that provides the data
> >      * @param the size of the data in the reader.
> >      */
> >     public void reset(Reader r, int size) {
> >         if (size =3D=3D 0 || size > 16384)
> >             size =3D 16384;
> >         zzBuffer =3D new char[size];
> >         yyreset(r);
> >     }
> >
> >
> > So maybe there is a way to trim the zzBuffer this way (?).
> >
> > BTW, I will try to find out which is the "big token" in my dataset this
> > afternoon. Thanks for the help.
> >
> > I actually workaround this memory problem for the time being by
> > wrapping the
> > IndexWriter in a class that periodically closes the IndexWriter and
> > creates
> > a new one, allowing the old to be GCed, but I would be really good if
> > either
> > JFlex or Lucene can take care of this zzBuffer going berserk.
> >
> >
> > Again thanks for the quick response. /Rub=C3=A9n
> >
> >
> > [1]
> > https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.q=
m@
> > web38901.mail.mud.yahoo.com
> >
> > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com> wrote:
> >
> > > If we could change the Flex file so that yyreset(Reader) would check
> > the
> > > size of zzBuffer, we could trim it when it gets too big. But I don't
> > think
> > > we have such control when writing the flex syntax ... yyreset is
> > generated
> > > by JFlex and that's the only place I can think of to trim the buffer
> > down
> > > when it exceeds a predefined threshold ....
> > >
> > > Maybe what we can do is create our own method which will be called by
> > > StandardTokenizer after yyreset is called, something like
> > > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer if
> > it
> > > exceeded the threshold. We can decide on a reasonable 64K threshold
> > or
> > > something, or simply always cut back to 16 KB. As far as I
> > understand, that
> > > buffer should never grow that much. I.e. in zzRefill, which is the
> > only
> > > place where the buffer gets resized, there is an attempt to first
> > move back
> > > characters that were already consumed and only then allocate a bigger
> > > buffer. Which means only if there is a token whose size is larger
> > than 16KB
> > > (!?), will this buffer get expanded.
> > >
> > > A trimBuffer method might not be that bad .. as a protective measure.
> > What
> > > do you think? Of course, JFlex can fix it on their own ... but until
> > that
> > > happens ...
> > >
> > > Shai
> > >
> > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
> > wrote:
> > >
> > > > > I would like to identify also the problematic document I have
> > 10000 so,
> > > > > what
> > > > > would be the best way of identifying the one that it making
> > zzBuffer to
> > > > > grow
> > > > > without control?
> > > >
> > > > Dont index your documents, but instead pass them directly to the
> > analyzer
> > > > and consume the tokenstream manually. Then visit
> > > TermAttribute.termLength()
> > > > for each Token.
> > > >
> > > >
> > > > -------------------------------------------------------------------
> > --
> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >
> > > >
> > >
> >
> >
> >
> > --
> > /Rub=C3=A9n
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


--=20
/Rub=C3=A9n

--0016e6d77fa0e14d630483b6cea0--

From java-user-return-45720-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:11:04 2010
Return-Path: <java-user-return-45720-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92543 invoked from network); 8 Apr 2010 10:11:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:11:04 -0000
Received: (qmail 56712 invoked by uid 500); 8 Apr 2010 10:11:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56647 invoked by uid 500); 8 Apr 2010 10:11:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56405 invoked by uid 99); 8 Apr 2010 10:11:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:11:01 +0000
X-ASF-Spam-Status: No, hits=-0.8 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:10:55 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 10B6CD36006
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 12:10:34 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id EBNgV3d2fYiC for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 12:10:29 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 9FCE9D36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 12:10:28 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>	 <007e01cad6ee$10c8dc40$325a94c0$@de>	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>	 <00c201cad702$9321c210$b9654630$@de> <o2xf8d56a4d1004080304y92a88308mde7b472577eb84b4@mail.gmail.com>
In-Reply-To: <o2xf8d56a4d1004080304y92a88308mde7b472577eb84b4@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 12:10:30 +0200
Message-ID: <00cf01cad703$b8b8e840$2a2ab8c0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrXAv5P+h2tT01URmqb4hBqVmkk6gAAICOQ
Content-Language: de

I responded, because the mentioned issue will change the whole class =
structure in the standard package, so any patch would get outdated, =
soon. So it=E2=80=99s the best to add it directly there.

But if you try out, if it works, that=E2=80=99s fine. The fix would be =
in 3.1 so if you need to fix your 3.0.1 version, you have to patch =
manually :-)

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> Sent: Thursday, April 08, 2010 12:05 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter memory leak?
>=20
> That was fast! I was already writting a patch... just to see if it
> works.
>=20
> On Thu, Apr 8, 2010 at 12:02 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>=20
> > Hi Shai, hi Ruben,
> >
> > I will take care of this in
> > https://issues.apache.org/jira/browse/LUCENE-2074 where some parts =
of
> the
> > Tokenizer impl are rewritten.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> > > Sent: Thursday, April 08, 2010 11:51 AM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: IndexWriter memory leak?
> > >
> > > I was investigating this a little further and in the JFlex mailing
> list
> > > I
> > > found [1]
> > >
> > > I don't know much about flex / JFlex but it seems that this guy
> resets
> > > the
> > > zzBuffer to 16384 or less when setting the input for the lexer
> > >
> > >
> > > Quoted from  shef <shef31@ya...>
> > >
> > >
> > > I set
> > >
> > > %buffer 0
> > >
> > > in the options section, and then added this method to the lexer:
> > >
> > >     /**
> > >      * Set the input for the lexer. The size parameter really
> speeds
> > > things up,
> > >      * because by default, the lexer allocates an internal buffer
> of
> > > 16k. For
> > >      * most strings, this is unnecessarily large. If the size =
param
> is
> > > 0 or greater
> > >      * than 16k, then the buffer is set to 16k. If the size param
> is
> > > smaller, then
> > >      * the buf will be set to the exact size.
> > >      * @param r the reader that provides the data
> > >      * @param the size of the data in the reader.
> > >      */
> > >     public void reset(Reader r, int size) {
> > >         if (size =3D=3D 0 || size > 16384)
> > >             size =3D 16384;
> > >         zzBuffer =3D new char[size];
> > >         yyreset(r);
> > >     }
> > >
> > >
> > > So maybe there is a way to trim the zzBuffer this way (?).
> > >
> > > BTW, I will try to find out which is the "big token" in my dataset
> this
> > > afternoon. Thanks for the help.
> > >
> > > I actually workaround this memory problem for the time being by
> > > wrapping the
> > > IndexWriter in a class that periodically closes the IndexWriter =
and
> > > creates
> > > a new one, allowing the old to be GCed, but I would be really good
> if
> > > either
> > > JFlex or Lucene can take care of this zzBuffer going berserk.
> > >
> > >
> > > Again thanks for the quick response. /Rub=C3=A9n
> > >
> > >
> > > [1]
> > >
> =
https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@=

> > > web38901.mail.mud.yahoo.com
> > >
> > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com>
> wrote:
> > >
> > > > If we could change the Flex file so that yyreset(Reader) would
> check
> > > the
> > > > size of zzBuffer, we could trim it when it gets too big. But I
> don't
> > > think
> > > > we have such control when writing the flex syntax ... yyreset is
> > > generated
> > > > by JFlex and that's the only place I can think of to trim the
> buffer
> > > down
> > > > when it exceeds a predefined threshold ....
> > > >
> > > > Maybe what we can do is create our own method which will be
> called by
> > > > StandardTokenizer after yyreset is called, something like
> > > > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer
> if
> > > it
> > > > exceeded the threshold. We can decide on a reasonable 64K
> threshold
> > > or
> > > > something, or simply always cut back to 16 KB. As far as I
> > > understand, that
> > > > buffer should never grow that much. I.e. in zzRefill, which is
> the
> > > only
> > > > place where the buffer gets resized, there is an attempt to =
first
> > > move back
> > > > characters that were already consumed and only then allocate a
> bigger
> > > > buffer. Which means only if there is a token whose size is =
larger
> > > than 16KB
> > > > (!?), will this buffer get expanded.
> > > >
> > > > A trimBuffer method might not be that bad .. as a protective
> measure.
> > > What
> > > > do you think? Of course, JFlex can fix it on their own ... but
> until
> > > that
> > > > happens ...
> > > >
> > > > Shai
> > > >
> > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
> > > wrote:
> > > >
> > > > > > I would like to identify also the problematic document I =
have
> > > 10000 so,
> > > > > > what
> > > > > > would be the best way of identifying the one that it making
> > > zzBuffer to
> > > > > > grow
> > > > > > without control?
> > > > >
> > > > > Dont index your documents, but instead pass them directly to
> the
> > > analyzer
> > > > > and consume the tokenstream manually. Then visit
> > > > TermAttribute.termLength()
> > > > > for each Token.
> > > > >
> > > > >
> > > > > =
---------------------------------------------------------------
> ----
> > > --
> > > > > To unsubscribe, e-mail: =
java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail: java-user-
> help@lucene.apache.org
> > > > >
> > > > >
> > > >
> > >
> > >
> > >
> > > --
> > > /Rub=C3=A9n
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>=20
>=20
> --
> /Rub=C3=A9n


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45721-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:11:30 2010
Return-Path: <java-user-return-45721-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92611 invoked from network); 8 Apr 2010 10:11:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:11:30 -0000
Received: (qmail 58534 invoked by uid 500); 8 Apr 2010 10:11:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58509 invoked by uid 500); 8 Apr 2010 10:11:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58499 invoked by uid 99); 8 Apr 2010 10:11:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:11:27 +0000
X-ASF-Spam-Status: No, hits=-0.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 72.14.220.154 as permitted sender)
Received: from [72.14.220.154] (HELO fg-out-1718.google.com) (72.14.220.154)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:11:22 +0000
Received: by fg-out-1718.google.com with SMTP id d23so870132fga.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 03:11:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=BsWoNPE97/dSQlpxNXXL160jkbofNVECmOzF3A7NtOg=;
        b=SF2bHCiqN3Kvd4YxYCQPexSkkajUYVi6TCMhV5ZLgcZgBu4VCU7+G/LIF2U+l3xXJB
         7kHP1Z1NVtoJ+SAjLrFMES2/sVvszlbu5b8nTvxRYIPTnH39zkh2bZMVDa+Mqyp8uMGa
         76Mn696LUjN0vZ3HZkvXjUeJ3PBH4rKj5nqEU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=g7E5ie2ymFtLS1BLMo8RDLSL/tgzDXSRwN9hA5l4Fvc7bRsaDN57FVdsPzwGC+uLUb
         j0DotKjXaEVFqg/mkjFcPDLjzsVk+KnReOW/jZ27EQhpO3tRCrt0jjD3dYD/ebL0YYsR
         jHw7rMoK+2b+m07IpnQ/DRtCSCuI1GnDVJ9Jg=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Thu, 8 Apr 2010 03:11:00 -0700 (PDT)
In-Reply-To: <00c301cad702$d10a4ca0$731ee5e0$@de>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
	 <00c301cad702$d10a4ca0$731ee5e0$@de>
Date: Thu, 8 Apr 2010 13:11:00 +0300
Received: by 10.102.243.22 with SMTP id q22mr5628750muh.9.1270721460258; Thu, 
	08 Apr 2010 03:11:00 -0700 (PDT)
Message-ID: <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636417c493f485f0483b6e5c6

--001636417c493f485f0483b6e5c6
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Guess we were replying at the same time :).

On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> I already answered, that I will take care of this!
>
> Uwe
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Shai Erera [mailto:serera@gmail.com]
> > Sent: Thursday, April 08, 2010 12:00 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: IndexWriter memory leak?
> >
> > Yes, that's the trimBuffer version I was thinking about, only this guy
> > created a reset(Reader, int) and does both ops (resetting + trim) in
> > one
> > method call. More convenient. Can you please open an issue to track
> > that?
> > People will have a chance to comment on whether we (Lucene) should
> > handle
> > that, or it should be a JFlex fix. Based on the number of replies this
> > guy
> > received (0 !), I doubt JFlex would consider it a problem. But we can
> > do
> > some small service to our users base by protecting against such
> > problems.
> >
> > And while you're opening the issue, if you want to take a stab at
> > fixing it
> > and post a patch, it'd be great :).
> >
> > Shai
> >
> > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> > <ruben.laguna@gmail.com>wrote:
> >
> > > I was investigating this a little further and in the JFlex mailing
> > list I
> > > found [1]
> > >
> > > I don't know much about flex / JFlex but it seems that this guy
> > resets the
> > > zzBuffer to 16384 or less when setting the input for the lexer
> > >
> > >
> > > Quoted from  shef <shef31@ya...>
> > >
> > >
> > > I set
> > >
> > > %buffer 0
> > >
> > > in the options section, and then added this method to the lexer:
> > >
> > >    /**
> > >     * Set the input for the lexer. The size parameter really speeds
> > things
> > > up,
> > >     * because by default, the lexer allocates an internal buffer of
> > 16k.
> > > For
> > >     * most strings, this is unnecessarily large. If the size param is
> > > 0 or greater
> > >     * than 16k, then the buffer is set to 16k. If the size param is
> > > smaller, then
> > >     * the buf will be set to the exact size.
> > >     * @param r the reader that provides the data
> > >     * @param the size of the data in the reader.
> > >     */
> > >    public void reset(Reader r, int size) {
> > >        if (size =3D=3D 0 || size > 16384)
> > >            size =3D 16384;
> > >        zzBuffer =3D new char[size];
> > >        yyreset(r);
> > >    }
> > >
> > >
> > > So maybe there is a way to trim the zzBuffer this way (?).
> > >
> > > BTW, I will try to find out which is the "big token" in my dataset
> > this
> > > afternoon. Thanks for the help.
> > >
> > > I actually workaround this memory problem for the time being by
> > wrapping
> > > the
> > > IndexWriter in a class that periodically closes the IndexWriter and
> > creates
> > > a new one, allowing the old to be GCed, but I would be really good if
> > > either
> > > JFlex or Lucene can take care of this zzBuffer going berserk.
> > >
> > >
> > > Again thanks for the quick response. /Rub=E9n
> > >
> > >
> > > [1]
> > >
> > >
> > https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.q=
m@
> > web38901.mail.mud.yahoo.com
> > >
> > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com> wrote:
> > >
> > > > If we could change the Flex file so that yyreset(Reader) would
> > check the
> > > > size of zzBuffer, we could trim it when it gets too big. But I
> > don't
> > > think
> > > > we have such control when writing the flex syntax ... yyreset is
> > > generated
> > > > by JFlex and that's the only place I can think of to trim the
> > buffer down
> > > > when it exceeds a predefined threshold ....
> > > >
> > > > Maybe what we can do is create our own method which will be called
> > by
> > > > StandardTokenizer after yyreset is called, something like
> > > > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer if
> > it
> > > > exceeded the threshold. We can decide on a reasonable 64K threshold
> > or
> > > > something, or simply always cut back to 16 KB. As far as I
> > understand,
> > > that
> > > > buffer should never grow that much. I.e. in zzRefill, which is the
> > only
> > > > place where the buffer gets resized, there is an attempt to first
> > move
> > > back
> > > > characters that were already consumed and only then allocate a
> > bigger
> > > > buffer. Which means only if there is a token whose size is larger
> > than
> > > 16KB
> > > > (!?), will this buffer get expanded.
> > > >
> > > > A trimBuffer method might not be that bad .. as a protective
> > measure.
> > > What
> > > > do you think? Of course, JFlex can fix it on their own ... but
> > until that
> > > > happens ...
> > > >
> > > > Shai
> > > >
> > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
> > wrote:
> > > >
> > > > > > I would like to identify also the problematic document I have
> > 10000
> > > so,
> > > > > > what
> > > > > > would be the best way of identifying the one that it making
> > zzBuffer
> > > to
> > > > > > grow
> > > > > > without control?
> > > > >
> > > > > Dont index your documents, but instead pass them directly to the
> > > analyzer
> > > > > and consume the tokenstream manually. Then visit
> > > > TermAttribute.termLength()
> > > > > for each Token.
> > > > >
> > > > >
> > > > > -----------------------------------------------------------------
> > ----
> > > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > > >
> > > > >
> > > >
> > >
> > >
> > >
> > > --
> > > /Rub=E9n
> > >
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636417c493f485f0483b6e5c6--

From java-user-return-45722-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 10:22:17 2010
Return-Path: <java-user-return-45722-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94272 invoked from network); 8 Apr 2010 10:22:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 10:22:16 -0000
Received: (qmail 72526 invoked by uid 500); 8 Apr 2010 10:22:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70993 invoked by uid 500); 8 Apr 2010 10:22:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70915 invoked by uid 99); 8 Apr 2010 10:22:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:22:01 +0000
X-ASF-Spam-Status: No, hits=0.5 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.214.115.60] (HELO h1349259.stratoserver.net) (85.214.115.60)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 10:21:55 +0000
Received: from [85.183.32.145] (helo=motokokusanagi.localnet)
	by h1349259.stratoserver.net with esmtpsa (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
	(Exim 4.69)
	(envelope-from <isabel@apache.org>)
	id 1Nzorc-0007Nq-AP; Thu, 08 Apr 2010 10:21:32 +0000
From: Isabel Drost <isabel@apache.org>
Reply-To: isabel@apache.org
To: java-user@lucene.apache.org,
 nosql-discussion@googlegroups.com
Subject: Berlin Buzzwords - early registration extended
Date: Thu, 8 Apr 2010 12:21:24 +0200
User-Agent: KMail/1.12.4 (Linux/2.6.32-3-amd64; KDE/4.3.4; x86_64; ; )
Cc: solr-user@lucene.apache.org,
 mahout-user@lucene.apache.org,
 nutch-user@lucene.apache.org,
 general@lucene.apache.org,
 common-user@hadoop.apache.org,
 hdfs-user@hadoop.apache.org,
 mapreduce-user@hadoop.apache.org,
 hbase-user@hadoop.apache.org,
 uima-user@incubator.apache.org,
 connectors-dev@incubator.apache.org
MIME-Version: 1.0
Content-Type: multipart/signed;
  boundary="nextPart1537196.qHRGR3KzEa";
  protocol="application/pgp-signature";
  micalg=pgp-sha1
Content-Transfer-Encoding: 7bit
Message-Id: <201004081221.26044.isabel@apache.org>

--nextPart1537196.qHRGR3KzEa
Content-Type: Text/Plain;
  charset="us-ascii"
Content-Transfer-Encoding: quoted-printable


Hello,

we would like to invite everyone interested in data storage, analysis and s=
earch=20
to join us for two days on June 7/8th in Berlin for an in-depth, technical,=
=20
developer-focused conference located in the heart of Europe. Presentations =
will=20
range from beginner friendly introductions on the hot data analysis topics =
up to=20
in-depth technical presentations of scalable architectures.

Our intention is to bring together users and developers of data storage,=20
analysis and search projects. Meet members of the development team working =
on=20
projects you use. Get in touch with other developers you may know only from=
=20
mailing list discussions. Exchange ideas with those using your software and=
 get=20
their feedback while having a drink in one of Berlin's many bars.

Early bird registration has been extended until April 17th - so don't wait =
too=20
long. Tickets are available at: http://berlinbuzzwords.de/content/tickets

If you would like to submit a talk yourself: Conference submission is open =
for=20
little more than one week. More details are available online in the call fo=
r=20
presentations:

http://berlinbuzzwords.de/content/call-presentations-open

Looking forward to meeting you in the beautiful, vibrant city of Berlin thi=
s=20
summer for a conference packed with high profile speakers, awesome talks an=
d=20
lots of interesting discussions.

Isabel

--nextPart1537196.qHRGR3KzEa
Content-Type: application/pgp-signature; name=signature.asc 
Content-Description: This is a digitally signed message part.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEABECAAYFAku9riYACgkQPJpCBAwIhbQKFACfVaVPfjkS8boudp7FEfDYjwwZ
T0QAnjZTXGXScQsLW2UrNVUUULpgybyd
=QTm1
-----END PGP SIGNATURE-----

--nextPart1537196.qHRGR3KzEa--

From java-user-return-45723-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 11:28:10 2010
Return-Path: <java-user-return-45723-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4760 invoked from network); 8 Apr 2010 11:28:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 11:28:10 -0000
Received: (qmail 43932 invoked by uid 500); 8 Apr 2010 11:28:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43802 invoked by uid 500); 8 Apr 2010 11:28:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43794 invoked by uid 99); 8 Apr 2010 11:28:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 11:28:05 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 11:27:58 +0000
Received: by bwz22 with SMTP id 22so1701203bwz.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 04:27:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=dngHV0Jz9Dl1pcAYE/fB5phbrPIocrgeobGxZDkXbl4=;
        b=rZMMBSNyUQxvQBSQOJZrPFOdL9P4yKY835n1d0oYxWTQ9jCvbBckGFRxok1ze791/r
         snQInmPvVCDEab/j4gct9KQaLA2VF9BKV6krbWe9WER44/ArXD9NQODcm93w9LKcASjR
         +LLeDrsA521QeNK7sI5FPZWKBhcDoWBcGzXq4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=CHVHsaS7xsIMJq5VttW+hrKIScehYwkk6Zv89MLceoEFIrcw6/HLBMPjmLqriZ//vu
         JqusVBreU6bTStO3VwyddQqtVJ/ByZMfj+eok1u4sSK41vLKAEzN1eMIH0njihhQc3oJ
         jwLNjmJdt3j4Y9x8r4Z0fRkRLnSr9kYJfdGPk=
MIME-Version: 1.0
Received: by 10.204.60.133 with HTTP; Thu, 8 Apr 2010 04:27:38 -0700 (PDT)
In-Reply-To: <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
	 <00c301cad702$d10a4ca0$731ee5e0$@de>
	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
Date: Thu, 8 Apr 2010 13:27:38 +0200
Received: by 10.204.126.130 with SMTP id c2mr10524548bks.155.1270726058088; 
	Thu, 08 Apr 2010 04:27:38 -0700 (PDT)
Message-ID: <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d58b284c99510483b7f778
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d58b284c99510483b7f778
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Now that the zzBuffer issue is solved...

what about the references to the Readers held by docWriter. Tika=C2=B4s
ParsingReaders are quite heavyweight so retaining those in memory
unnecesarily is also a "hidden" memory leak. Should I open a bug report on
that one?

/Rub=C3=A9n

On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com> wrote:

> Guess we were replying at the same time :).
>
> On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>
> > I already answered, that I will take care of this!
> >
> > Uwe
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: Shai Erera [mailto:serera@gmail.com]
> > > Sent: Thursday, April 08, 2010 12:00 PM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: IndexWriter memory leak?
> > >
> > > Yes, that's the trimBuffer version I was thinking about, only this gu=
y
> > > created a reset(Reader, int) and does both ops (resetting + trim) in
> > > one
> > > method call. More convenient. Can you please open an issue to track
> > > that?
> > > People will have a chance to comment on whether we (Lucene) should
> > > handle
> > > that, or it should be a JFlex fix. Based on the number of replies thi=
s
> > > guy
> > > received (0 !), I doubt JFlex would consider it a problem. But we can
> > > do
> > > some small service to our users base by protecting against such
> > > problems.
> > >
> > > And while you're opening the issue, if you want to take a stab at
> > > fixing it
> > > and post a patch, it'd be great :).
> > >
> > > Shai
> > >
> > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> > > <ruben.laguna@gmail.com>wrote:
> > >
> > > > I was investigating this a little further and in the JFlex mailing
> > > list I
> > > > found [1]
> > > >
> > > > I don't know much about flex / JFlex but it seems that this guy
> > > resets the
> > > > zzBuffer to 16384 or less when setting the input for the lexer
> > > >
> > > >
> > > > Quoted from  shef <shef31@ya...>
> > > >
> > > >
> > > > I set
> > > >
> > > > %buffer 0
> > > >
> > > > in the options section, and then added this method to the lexer:
> > > >
> > > >    /**
> > > >     * Set the input for the lexer. The size parameter really speeds
> > > things
> > > > up,
> > > >     * because by default, the lexer allocates an internal buffer of
> > > 16k.
> > > > For
> > > >     * most strings, this is unnecessarily large. If the size param =
is
> > > > 0 or greater
> > > >     * than 16k, then the buffer is set to 16k. If the size param is
> > > > smaller, then
> > > >     * the buf will be set to the exact size.
> > > >     * @param r the reader that provides the data
> > > >     * @param the size of the data in the reader.
> > > >     */
> > > >    public void reset(Reader r, int size) {
> > > >        if (size =3D=3D 0 || size > 16384)
> > > >            size =3D 16384;
> > > >        zzBuffer =3D new char[size];
> > > >        yyreset(r);
> > > >    }
> > > >
> > > >
> > > > So maybe there is a way to trim the zzBuffer this way (?).
> > > >
> > > > BTW, I will try to find out which is the "big token" in my dataset
> > > this
> > > > afternoon. Thanks for the help.
> > > >
> > > > I actually workaround this memory problem for the time being by
> > > wrapping
> > > > the
> > > > IndexWriter in a class that periodically closes the IndexWriter and
> > > creates
> > > > a new one, allowing the old to be GCed, but I would be really good =
if
> > > > either
> > > > JFlex or Lucene can take care of this zzBuffer going berserk.
> > > >
> > > >
> > > > Again thanks for the quick response. /Rub=C3=A9n
> > > >
> > > >
> > > > [1]
> > > >
> > > >
> > >
> https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@
> > > web38901.mail.mud.yahoo.com
> > > >
> > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com>
> wrote:
> > > >
> > > > > If we could change the Flex file so that yyreset(Reader) would
> > > check the
> > > > > size of zzBuffer, we could trim it when it gets too big. But I
> > > don't
> > > > think
> > > > > we have such control when writing the flex syntax ... yyreset is
> > > > generated
> > > > > by JFlex and that's the only place I can think of to trim the
> > > buffer down
> > > > > when it exceeds a predefined threshold ....
> > > > >
> > > > > Maybe what we can do is create our own method which will be calle=
d
> > > by
> > > > > StandardTokenizer after yyreset is called, something like
> > > > > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer =
if
> > > it
> > > > > exceeded the threshold. We can decide on a reasonable 64K thresho=
ld
> > > or
> > > > > something, or simply always cut back to 16 KB. As far as I
> > > understand,
> > > > that
> > > > > buffer should never grow that much. I.e. in zzRefill, which is th=
e
> > > only
> > > > > place where the buffer gets resized, there is an attempt to first
> > > move
> > > > back
> > > > > characters that were already consumed and only then allocate a
> > > bigger
> > > > > buffer. Which means only if there is a token whose size is larger
> > > than
> > > > 16KB
> > > > > (!?), will this buffer get expanded.
> > > > >
> > > > > A trimBuffer method might not be that bad .. as a protective
> > > measure.
> > > > What
> > > > > do you think? Of course, JFlex can fix it on their own ... but
> > > until that
> > > > > happens ...
> > > > >
> > > > > Shai
> > > > >
> > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
> > > wrote:
> > > > >
> > > > > > > I would like to identify also the problematic document I have
> > > 10000
> > > > so,
> > > > > > > what
> > > > > > > would be the best way of identifying the one that it making
> > > zzBuffer
> > > > to
> > > > > > > grow
> > > > > > > without control?
> > > > > >
> > > > > > Dont index your documents, but instead pass them directly to th=
e
> > > > analyzer
> > > > > > and consume the tokenstream manually. Then visit
> > > > > TermAttribute.termLength()
> > > > > > for each Token.
> > > > > >
> > > > > >
> > > > > > ---------------------------------------------------------------=
--
> > > ----
> > > > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > > > For additional commands, e-mail:
> java-user-help@lucene.apache.org
> > > > > >
> > > > > >
> > > > >
> > > >
> > > >
> > > >
> > > > --
> > > > /Rub=C3=A9n
> > > >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>



--=20
/Rub=C3=A9n

--0016e6d58b284c99510483b7f778--

From java-user-return-45724-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 11:55:15 2010
Return-Path: <java-user-return-45724-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9568 invoked from network); 8 Apr 2010 11:55:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 11:55:15 -0000
Received: (qmail 75493 invoked by uid 500); 8 Apr 2010 11:55:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75446 invoked by uid 500); 8 Apr 2010 11:55:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75438 invoked by uid 99); 8 Apr 2010 11:55:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 11:55:12 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ruben.laguna@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 11:55:06 +0000
Received: by mail-bw0-f222.google.com with SMTP id 22so1719723bwz.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 04:54:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=omH58ATY2SP9KlH4OdPTZ+n8XrjELMGm8HOOBLJhzd4=;
        b=VELah1FOEkw5Bnbgudzcw92GkSdlIoesFrW95PC3jjz0z9NqZDJmIY+9p/5pI1pPkZ
         7iHJ5G6kS1qaJqqXqhRKbtkp1hQf2kG70Ghe6vlxNooLMGaO11y3FQvsM2jvm2+GpMh3
         0MK0WvsnUQ4tstPNHIWU9klgej3YRr6A4K2/4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=vg9FmY86xFJ2QIkpkePgNtip6vWA35xf/gLp5nXSOnAd/xpYv3iTFQ7Z6NL4cqDqoF
         c0P+2YRatM2U9904yny39CIPbcpPE/5ucO/fJ7+cVJfcS76AT8OtSi5mTvylf9rJfTWA
         RuSLaPCIE++tMACxWAT/9MQorFsXpy9Im2neE=
MIME-Version: 1.0
Received: by 10.204.60.133 with HTTP; Thu, 8 Apr 2010 04:54:44 -0700 (PDT)
In-Reply-To: <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
	 <00c301cad702$d10a4ca0$731ee5e0$@de>
	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
	 <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
Date: Thu, 8 Apr 2010 13:54:44 +0200
Received: by 10.204.33.206 with SMTP id i14mr46104bkd.52.1270727685019; Thu, 
	08 Apr 2010 04:54:45 -0700 (PDT)
Message-ID: <y2hf8d56a4d1004080454ofd478836tcbbb8d7363fa518c@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0003255579ea4597cd0483b85839

--0003255579ea4597cd0483b85839
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

And by the way, when is Lucene 3.1 coming?

On Thu, Apr 8, 2010 at 1:27 PM, Ruben Laguna <ruben.laguna@gmail.com> wrote=
:

> Now that the zzBuffer issue is solved...
>
> what about the references to the Readers held by docWriter. Tika=C2=B4s
> ParsingReaders are quite heavyweight so retaining those in memory
> unnecesarily is also a "hidden" memory leak. Should I open a bug report o=
n
> that one?
>
> /Rub=C3=A9n
>
> On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com> wrote:
>
>> Guess we were replying at the same time :).
>>
>> On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>>
>> > I already answered, that I will take care of this!
>> >
>> > Uwe
>> >
>> > -----
>> > Uwe Schindler
>> > H.-H.-Meier-Allee 63, D-28213 Bremen
>> > http://www.thetaphi.de
>> > eMail: uwe@thetaphi.de
>> >
>> >
>> > > -----Original Message-----
>> > > From: Shai Erera [mailto:serera@gmail.com]
>> > > Sent: Thursday, April 08, 2010 12:00 PM
>> > > To: java-user@lucene.apache.org
>> > > Subject: Re: IndexWriter memory leak?
>> > >
>> > > Yes, that's the trimBuffer version I was thinking about, only this g=
uy
>> > > created a reset(Reader, int) and does both ops (resetting + trim) in
>> > > one
>> > > method call. More convenient. Can you please open an issue to track
>> > > that?
>> > > People will have a chance to comment on whether we (Lucene) should
>> > > handle
>> > > that, or it should be a JFlex fix. Based on the number of replies th=
is
>> > > guy
>> > > received (0 !), I doubt JFlex would consider it a problem. But we ca=
n
>> > > do
>> > > some small service to our users base by protecting against such
>> > > problems.
>> > >
>> > > And while you're opening the issue, if you want to take a stab at
>> > > fixing it
>> > > and post a patch, it'd be great :).
>> > >
>> > > Shai
>> > >
>> > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
>> > > <ruben.laguna@gmail.com>wrote:
>> > >
>> > > > I was investigating this a little further and in the JFlex mailing
>> > > list I
>> > > > found [1]
>> > > >
>> > > > I don't know much about flex / JFlex but it seems that this guy
>> > > resets the
>> > > > zzBuffer to 16384 or less when setting the input for the lexer
>> > > >
>> > > >
>> > > > Quoted from  shef <shef31@ya...>
>> > > >
>> > > >
>> > > > I set
>> > > >
>> > > > %buffer 0
>> > > >
>> > > > in the options section, and then added this method to the lexer:
>> > > >
>> > > >    /**
>> > > >     * Set the input for the lexer. The size parameter really speed=
s
>> > > things
>> > > > up,
>> > > >     * because by default, the lexer allocates an internal buffer o=
f
>> > > 16k.
>> > > > For
>> > > >     * most strings, this is unnecessarily large. If the size param
>> is
>> > > > 0 or greater
>> > > >     * than 16k, then the buffer is set to 16k. If the size param i=
s
>> > > > smaller, then
>> > > >     * the buf will be set to the exact size.
>> > > >     * @param r the reader that provides the data
>> > > >     * @param the size of the data in the reader.
>> > > >     */
>> > > >    public void reset(Reader r, int size) {
>> > > >        if (size =3D=3D 0 || size > 16384)
>> > > >            size =3D 16384;
>> > > >        zzBuffer =3D new char[size];
>> > > >        yyreset(r);
>> > > >    }
>> > > >
>> > > >
>> > > > So maybe there is a way to trim the zzBuffer this way (?).
>> > > >
>> > > > BTW, I will try to find out which is the "big token" in my dataset
>> > > this
>> > > > afternoon. Thanks for the help.
>> > > >
>> > > > I actually workaround this memory problem for the time being by
>> > > wrapping
>> > > > the
>> > > > IndexWriter in a class that periodically closes the IndexWriter an=
d
>> > > creates
>> > > > a new one, allowing the old to be GCed, but I would be really good
>> if
>> > > > either
>> > > > JFlex or Lucene can take care of this zzBuffer going berserk.
>> > > >
>> > > >
>> > > > Again thanks for the quick response. /Rub=C3=A9n
>> > > >
>> > > >
>> > > > [1]
>> > > >
>> > > >
>> > >
>> https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm=
@
>> > > web38901.mail.mud.yahoo.com
>> > > >
>> > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com>
>> wrote:
>> > > >
>> > > > > If we could change the Flex file so that yyreset(Reader) would
>> > > check the
>> > > > > size of zzBuffer, we could trim it when it gets too big. But I
>> > > don't
>> > > > think
>> > > > > we have such control when writing the flex syntax ... yyreset is
>> > > > generated
>> > > > > by JFlex and that's the only place I can think of to trim the
>> > > buffer down
>> > > > > when it exceeds a predefined threshold ....
>> > > > >
>> > > > > Maybe what we can do is create our own method which will be call=
ed
>> > > by
>> > > > > StandardTokenizer after yyreset is called, something like
>> > > > > trimBufferIfTooBig(int threshold) which will reallocate zzBuffer
>> if
>> > > it
>> > > > > exceeded the threshold. We can decide on a reasonable 64K
>> threshold
>> > > or
>> > > > > something, or simply always cut back to 16 KB. As far as I
>> > > understand,
>> > > > that
>> > > > > buffer should never grow that much. I.e. in zzRefill, which is t=
he
>> > > only
>> > > > > place where the buffer gets resized, there is an attempt to firs=
t
>> > > move
>> > > > back
>> > > > > characters that were already consumed and only then allocate a
>> > > bigger
>> > > > > buffer. Which means only if there is a token whose size is large=
r
>> > > than
>> > > > 16KB
>> > > > > (!?), will this buffer get expanded.
>> > > > >
>> > > > > A trimBuffer method might not be that bad .. as a protective
>> > > measure.
>> > > > What
>> > > > > do you think? Of course, JFlex can fix it on their own ... but
>> > > until that
>> > > > > happens ...
>> > > > >
>> > > > > Shai
>> > > > >
>> > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler <uwe@thetaphi.de>
>> > > wrote:
>> > > > >
>> > > > > > > I would like to identify also the problematic document I hav=
e
>> > > 10000
>> > > > so,
>> > > > > > > what
>> > > > > > > would be the best way of identifying the one that it making
>> > > zzBuffer
>> > > > to
>> > > > > > > grow
>> > > > > > > without control?
>> > > > > >
>> > > > > > Dont index your documents, but instead pass them directly to t=
he
>> > > > analyzer
>> > > > > > and consume the tokenstream manually. Then visit
>> > > > > TermAttribute.termLength()
>> > > > > > for each Token.
>> > > > > >
>> > > > > >
>> > > > > >
>> -----------------------------------------------------------------
>> > > ----
>> > > > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.or=
g
>> > > > > > For additional commands, e-mail:
>> java-user-help@lucene.apache.org
>> > > > > >
>> > > > > >
>> > > > >
>> > > >
>> > > >
>> > > >
>> > > > --
>> > > > /Rub=C3=A9n
>> > > >
>> >
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>
>
>
> --
> /Rub=C3=A9n
>



--=20
/Rub=C3=A9n

--0003255579ea4597cd0483b85839--

From java-user-return-45725-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 12:17:07 2010
Return-Path: <java-user-return-45725-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13713 invoked from network); 8 Apr 2010 12:17:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 12:17:07 -0000
Received: (qmail 96961 invoked by uid 500); 8 Apr 2010 12:17:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96933 invoked by uid 500); 8 Apr 2010 12:17:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96925 invoked by uid 99); 8 Apr 2010 12:17:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 12:17:05 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 12:16:57 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 6D622D36005
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 14:16:37 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id qk2DKDVs3ZU9 for <java-user@lucene.apache.org>;
	Thu,  8 Apr 2010 14:16:32 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 3CA40D36002
	for <java-user@lucene.apache.org>; Thu,  8 Apr 2010 14:16:32 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <i2tf8d56a4d1004071523sb3f4d042j830bf9300b33e867@mail.gmail.com>	 <j2o786fde51004072341zb527be14l1ba0e3678bb3198f@mail.gmail.com>	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>	 <007e01cad6ee$10c8dc40$325a94c0$@de>	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>	 <00c301cad702$d10a4ca0$731ee5e0$@de>	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com> <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
In-Reply-To: <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 14:16:34 +0200
Message-ID: <00fe01cad715$54c5ba90$fe512fb0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrXDpTVlZoCnM6OSBOOJ2ytgKdL3gABpy2A
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Readers are not held. If you indexed the document and gced the document =
instance they readers are gone.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> Sent: Thursday, April 08, 2010 1:28 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter memory leak?
>=20
> Now that the zzBuffer issue is solved...
>=20
> what about the references to the Readers held by docWriter. =
Tika=C2=B4s
> ParsingReaders are quite heavyweight so retaining those in memory
> unnecesarily is also a "hidden" memory leak. Should I open a bug =
report
> on
> that one?
>=20
> /Rub=C3=A9n
>=20
> On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com> wrote:
>=20
> > Guess we were replying at the same time :).
> >
> > On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de>
> wrote:
> >
> > > I already answered, that I will take care of this!
> > >
> > > Uwe
> > >
> > > -----
> > > Uwe Schindler
> > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > http://www.thetaphi.de
> > > eMail: uwe@thetaphi.de
> > >
> > >
> > > > -----Original Message-----
> > > > From: Shai Erera [mailto:serera@gmail.com]
> > > > Sent: Thursday, April 08, 2010 12:00 PM
> > > > To: java-user@lucene.apache.org
> > > > Subject: Re: IndexWriter memory leak?
> > > >
> > > > Yes, that's the trimBuffer version I was thinking about, only
> this guy
> > > > created a reset(Reader, int) and does both ops (resetting + =
trim)
> in
> > > > one
> > > > method call. More convenient. Can you please open an issue to
> track
> > > > that?
> > > > People will have a chance to comment on whether we (Lucene)
> should
> > > > handle
> > > > that, or it should be a JFlex fix. Based on the number of =
replies
> this
> > > > guy
> > > > received (0 !), I doubt JFlex would consider it a problem. But =
we
> can
> > > > do
> > > > some small service to our users base by protecting against such
> > > > problems.
> > > >
> > > > And while you're opening the issue, if you want to take a stab =
at
> > > > fixing it
> > > > and post a patch, it'd be great :).
> > > >
> > > > Shai
> > > >
> > > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> > > > <ruben.laguna@gmail.com>wrote:
> > > >
> > > > > I was investigating this a little further and in the JFlex
> mailing
> > > > list I
> > > > > found [1]
> > > > >
> > > > > I don't know much about flex / JFlex but it seems that this =
guy
> > > > resets the
> > > > > zzBuffer to 16384 or less when setting the input for the lexer
> > > > >
> > > > >
> > > > > Quoted from  shef <shef31@ya...>
> > > > >
> > > > >
> > > > > I set
> > > > >
> > > > > %buffer 0
> > > > >
> > > > > in the options section, and then added this method to the
> lexer:
> > > > >
> > > > >    /**
> > > > >     * Set the input for the lexer. The size parameter really
> speeds
> > > > things
> > > > > up,
> > > > >     * because by default, the lexer allocates an internal
> buffer of
> > > > 16k.
> > > > > For
> > > > >     * most strings, this is unnecessarily large. If the size
> param is
> > > > > 0 or greater
> > > > >     * than 16k, then the buffer is set to 16k. If the size
> param is
> > > > > smaller, then
> > > > >     * the buf will be set to the exact size.
> > > > >     * @param r the reader that provides the data
> > > > >     * @param the size of the data in the reader.
> > > > >     */
> > > > >    public void reset(Reader r, int size) {
> > > > >        if (size =3D=3D 0 || size > 16384)
> > > > >            size =3D 16384;
> > > > >        zzBuffer =3D new char[size];
> > > > >        yyreset(r);
> > > > >    }
> > > > >
> > > > >
> > > > > So maybe there is a way to trim the zzBuffer this way (?).
> > > > >
> > > > > BTW, I will try to find out which is the "big token" in my
> dataset
> > > > this
> > > > > afternoon. Thanks for the help.
> > > > >
> > > > > I actually workaround this memory problem for the time being =
by
> > > > wrapping
> > > > > the
> > > > > IndexWriter in a class that periodically closes the =
IndexWriter
> and
> > > > creates
> > > > > a new one, allowing the old to be GCed, but I would be really
> good if
> > > > > either
> > > > > JFlex or Lucene can take care of this zzBuffer going berserk.
> > > > >
> > > > >
> > > > > Again thanks for the quick response. /Rub=C3=A9n
> > > > >
> > > > >
> > > > > [1]
> > > > >
> > > > >
> > > >
> >
> =
https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@=

> > > > web38901.mail.mud.yahoo.com
> > > > >
> > > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com>
> > wrote:
> > > > >
> > > > > > If we could change the Flex file so that yyreset(Reader)
> would
> > > > check the
> > > > > > size of zzBuffer, we could trim it when it gets too big. But
> I
> > > > don't
> > > > > think
> > > > > > we have such control when writing the flex syntax ... =
yyreset
> is
> > > > > generated
> > > > > > by JFlex and that's the only place I can think of to trim =
the
> > > > buffer down
> > > > > > when it exceeds a predefined threshold ....
> > > > > >
> > > > > > Maybe what we can do is create our own method which will be
> called
> > > > by
> > > > > > StandardTokenizer after yyreset is called, something like
> > > > > > trimBufferIfTooBig(int threshold) which will reallocate
> zzBuffer if
> > > > it
> > > > > > exceeded the threshold. We can decide on a reasonable 64K
> threshold
> > > > or
> > > > > > something, or simply always cut back to 16 KB. As far as I
> > > > understand,
> > > > > that
> > > > > > buffer should never grow that much. I.e. in zzRefill, which
> is the
> > > > only
> > > > > > place where the buffer gets resized, there is an attempt to
> first
> > > > move
> > > > > back
> > > > > > characters that were already consumed and only then allocate
> a
> > > > bigger
> > > > > > buffer. Which means only if there is a token whose size is
> larger
> > > > than
> > > > > 16KB
> > > > > > (!?), will this buffer get expanded.
> > > > > >
> > > > > > A trimBuffer method might not be that bad .. as a protective
> > > > measure.
> > > > > What
> > > > > > do you think? Of course, JFlex can fix it on their own ...
> but
> > > > until that
> > > > > > happens ...
> > > > > >
> > > > > > Shai
> > > > > >
> > > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler
> <uwe@thetaphi.de>
> > > > wrote:
> > > > > >
> > > > > > > > I would like to identify also the problematic document I
> have
> > > > 10000
> > > > > so,
> > > > > > > > what
> > > > > > > > would be the best way of identifying the one that it
> making
> > > > zzBuffer
> > > > > to
> > > > > > > > grow
> > > > > > > > without control?
> > > > > > >
> > > > > > > Dont index your documents, but instead pass them directly
> to the
> > > > > analyzer
> > > > > > > and consume the tokenstream manually. Then visit
> > > > > > TermAttribute.termLength()
> > > > > > > for each Token.
> > > > > > >
> > > > > > >
> > > > > > > =
-----------------------------------------------------------
> ------
> > > > ----
> > > > > > > To unsubscribe, e-mail: java-user-
> unsubscribe@lucene.apache.org
> > > > > > > For additional commands, e-mail:
> > java-user-help@lucene.apache.org
> > > > > > >
> > > > > > >
> > > > > >
> > > > >
> > > > >
> > > > >
> > > > > --
> > > > > /Rub=C3=A9n
> > > > >
> > >
> > >
> > > =
-------------------------------------------------------------------
> --
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
>=20
>=20
>=20
> --
> /Rub=C3=A9n


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45726-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 12:50:57 2010
Return-Path: <java-user-return-45726-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40585 invoked from network); 8 Apr 2010 12:50:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 12:50:57 -0000
Received: (qmail 48526 invoked by uid 500); 8 Apr 2010 12:50:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48385 invoked by uid 500); 8 Apr 2010 12:50:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48377 invoked by uid 99); 8 Apr 2010 12:50:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 12:50:55 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 12:50:48 +0000
Received: by wwb39 with SMTP id 39so237968wwb.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 05:50:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=Ex4hEuHcoiY+X1hkFDHfI4nQwBYAkkBHXNZZABFM6i4=;
        b=xFqI9knaelecykIyHQr5JVpB7wJj3H/LEJqRmDFjPJelrN66iuz22tjZfLOzZxHKRg
         1CC5B7RrEM7kDB9oHL9eq/J6Z+iZEPbAAb2QmA+/rNlIUQQ/ZGcvDmKeM8Cw2yxR9wRq
         FB+Hr3VaXAk58CwfBGuCN+FiRSY6rEh7kdiOA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=pJ8OJ23HkP//pavAEiD+GA8liI+aWx5g3oOW5202QdzTsCNJAyhiNTgBLY3h4g26N4
         oEoAz78SFVd/8KTJppE0BYw9fKw420hGdbaUhh6/n4OWnDdJmnSglaSpiCaz3OD5X5bC
         Lj2+wVr+uK8HsccjyCn3G7gU8e1+hUFbBI8Kw=
MIME-Version: 1.0
Received: by 10.216.53.200 with HTTP; Thu, 8 Apr 2010 05:50:27 -0700 (PDT)
In-Reply-To: <00fe01cad715$54c5ba90$fe512fb0$@de>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
	 <00c301cad702$d10a4ca0$731ee5e0$@de>
	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
	 <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
	 <00fe01cad715$54c5ba90$fe512fb0$@de>
Date: Thu, 8 Apr 2010 14:50:27 +0200
Received: by 10.216.89.130 with SMTP id c2mr43649wef.44.1270731027287; Thu, 08 
	Apr 2010 05:50:27 -0700 (PDT)
Message-ID: <q2uf8d56a4d1004080550s6717849jbd4570de5f2c5817@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d99d7e7c929a0483b91fe9
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d99d7e7c929a0483b91fe9
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I will double check in the afternoon the heapdump.hprof. But I think that
*some* readers are indeed held by
docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx],
as shown in [1] (this heapdump contains only live objects).  The heapdump
was taken after IndexWriter.commit() /IndexWriter.optimize() and all the
Documents were already indexed and GCed (I will double check).

So that would mean that the Reader is retained in memory by the following
chaing of references,

DocumentsWriter -> DocumentsWriterThreadState -> DocFieldProcessorPerThread
-> DocFieldProcessorPerField -> Fieldable -> Field (fieldsData)

I'll double check with Eclipse MAT as I said that this chain is actually
made of hard references only (no SoftReferences,WeakReferences, etc). I wil=
l
also double check also that there is no "live" Document that is referencing
the Reader via the Field.


[1] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg

On Thu, Apr 8, 2010 at 2:16 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> Readers are not held. If you indexed the document and gced the document
> instance they readers are gone.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> > Sent: Thursday, April 08, 2010 1:28 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: IndexWriter memory leak?
> >
> > Now that the zzBuffer issue is solved...
> >
> > what about the references to the Readers held by docWriter. Tika=C2=B4s
> > ParsingReaders are quite heavyweight so retaining those in memory
> > unnecesarily is also a "hidden" memory leak. Should I open a bug report
> > on
> > that one?
> >
> > /Rub=C3=A9n
> >
> > On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com> wrote:
> >
> > > Guess we were replying at the same time :).
> > >
> > > On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de>
> > wrote:
> > >
> > > > I already answered, that I will take care of this!
> > > >
> > > > Uwe
> > > >
> > > > -----
> > > > Uwe Schindler
> > > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > > http://www.thetaphi.de
> > > > eMail: uwe@thetaphi.de
> > > >
> > > >
> > > > > -----Original Message-----
> > > > > From: Shai Erera [mailto:serera@gmail.com]
> > > > > Sent: Thursday, April 08, 2010 12:00 PM
> > > > > To: java-user@lucene.apache.org
> > > > > Subject: Re: IndexWriter memory leak?
> > > > >
> > > > > Yes, that's the trimBuffer version I was thinking about, only
> > this guy
> > > > > created a reset(Reader, int) and does both ops (resetting + trim)
> > in
> > > > > one
> > > > > method call. More convenient. Can you please open an issue to
> > track
> > > > > that?
> > > > > People will have a chance to comment on whether we (Lucene)
> > should
> > > > > handle
> > > > > that, or it should be a JFlex fix. Based on the number of replies
> > this
> > > > > guy
> > > > > received (0 !), I doubt JFlex would consider it a problem. But we
> > can
> > > > > do
> > > > > some small service to our users base by protecting against such
> > > > > problems.
> > > > >
> > > > > And while you're opening the issue, if you want to take a stab at
> > > > > fixing it
> > > > > and post a patch, it'd be great :).
> > > > >
> > > > > Shai
> > > > >
> > > > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> > > > > <ruben.laguna@gmail.com>wrote:
> > > > >
> > > > > > I was investigating this a little further and in the JFlex
> > mailing
> > > > > list I
> > > > > > found [1]
> > > > > >
> > > > > > I don't know much about flex / JFlex but it seems that this guy
> > > > > resets the
> > > > > > zzBuffer to 16384 or less when setting the input for the lexer
> > > > > >
> > > > > >
> > > > > > Quoted from  shef <shef31@ya...>
> > > > > >
> > > > > >
> > > > > > I set
> > > > > >
> > > > > > %buffer 0
> > > > > >
> > > > > > in the options section, and then added this method to the
> > lexer:
> > > > > >
> > > > > >    /**
> > > > > >     * Set the input for the lexer. The size parameter really
> > speeds
> > > > > things
> > > > > > up,
> > > > > >     * because by default, the lexer allocates an internal
> > buffer of
> > > > > 16k.
> > > > > > For
> > > > > >     * most strings, this is unnecessarily large. If the size
> > param is
> > > > > > 0 or greater
> > > > > >     * than 16k, then the buffer is set to 16k. If the size
> > param is
> > > > > > smaller, then
> > > > > >     * the buf will be set to the exact size.
> > > > > >     * @param r the reader that provides the data
> > > > > >     * @param the size of the data in the reader.
> > > > > >     */
> > > > > >    public void reset(Reader r, int size) {
> > > > > >        if (size =3D=3D 0 || size > 16384)
> > > > > >            size =3D 16384;
> > > > > >        zzBuffer =3D new char[size];
> > > > > >        yyreset(r);
> > > > > >    }
> > > > > >
> > > > > >
> > > > > > So maybe there is a way to trim the zzBuffer this way (?).
> > > > > >
> > > > > > BTW, I will try to find out which is the "big token" in my
> > dataset
> > > > > this
> > > > > > afternoon. Thanks for the help.
> > > > > >
> > > > > > I actually workaround this memory problem for the time being by
> > > > > wrapping
> > > > > > the
> > > > > > IndexWriter in a class that periodically closes the IndexWriter
> > and
> > > > > creates
> > > > > > a new one, allowing the old to be GCed, but I would be really
> > good if
> > > > > > either
> > > > > > JFlex or Lucene can take care of this zzBuffer going berserk.
> > > > > >
> > > > > >
> > > > > > Again thanks for the quick response. /Rub=C3=A9n
> > > > > >
> > > > > >
> > > > > > [1]
> > > > > >
> > > > > >
> > > > >
> > >
> > https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.q=
m@
> > > > > web38901.mail.mud.yahoo.com
> > > > > >
> > > > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com>
> > > wrote:
> > > > > >
> > > > > > > If we could change the Flex file so that yyreset(Reader)
> > would
> > > > > check the
> > > > > > > size of zzBuffer, we could trim it when it gets too big. But
> > I
> > > > > don't
> > > > > > think
> > > > > > > we have such control when writing the flex syntax ... yyreset
> > is
> > > > > > generated
> > > > > > > by JFlex and that's the only place I can think of to trim the
> > > > > buffer down
> > > > > > > when it exceeds a predefined threshold ....
> > > > > > >
> > > > > > > Maybe what we can do is create our own method which will be
> > called
> > > > > by
> > > > > > > StandardTokenizer after yyreset is called, something like
> > > > > > > trimBufferIfTooBig(int threshold) which will reallocate
> > zzBuffer if
> > > > > it
> > > > > > > exceeded the threshold. We can decide on a reasonable 64K
> > threshold
> > > > > or
> > > > > > > something, or simply always cut back to 16 KB. As far as I
> > > > > understand,
> > > > > > that
> > > > > > > buffer should never grow that much. I.e. in zzRefill, which
> > is the
> > > > > only
> > > > > > > place where the buffer gets resized, there is an attempt to
> > first
> > > > > move
> > > > > > back
> > > > > > > characters that were already consumed and only then allocate
> > a
> > > > > bigger
> > > > > > > buffer. Which means only if there is a token whose size is
> > larger
> > > > > than
> > > > > > 16KB
> > > > > > > (!?), will this buffer get expanded.
> > > > > > >
> > > > > > > A trimBuffer method might not be that bad .. as a protective
> > > > > measure.
> > > > > > What
> > > > > > > do you think? Of course, JFlex can fix it on their own ...
> > but
> > > > > until that
> > > > > > > happens ...
> > > > > > >
> > > > > > > Shai
> > > > > > >
> > > > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler
> > <uwe@thetaphi.de>
> > > > > wrote:
> > > > > > >
> > > > > > > > > I would like to identify also the problematic document I
> > have
> > > > > 10000
> > > > > > so,
> > > > > > > > > what
> > > > > > > > > would be the best way of identifying the one that it
> > making
> > > > > zzBuffer
> > > > > > to
> > > > > > > > > grow
> > > > > > > > > without control?
> > > > > > > >
> > > > > > > > Dont index your documents, but instead pass them directly
> > to the
> > > > > > analyzer
> > > > > > > > and consume the tokenstream manually. Then visit
> > > > > > > TermAttribute.termLength()
> > > > > > > > for each Token.
> > > > > > > >
> > > > > > > >
> > > > > > > > -----------------------------------------------------------
> > ------
> > > > > ----
> > > > > > > > To unsubscribe, e-mail: java-user-
> > unsubscribe@lucene.apache.org
> > > > > > > > For additional commands, e-mail:
> > > java-user-help@lucene.apache.org
> > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > >
> > > > > >
> > > > > >
> > > > > > --
> > > > > > /Rub=C3=A9n
> > > > > >
> > > >
> > > >
> > > > -------------------------------------------------------------------
> > --
> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >
> > > >
> > >
> >
> >
> >
> > --
> > /Rub=C3=A9n
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


--=20
/Rub=C3=A9n

--0016e6d99d7e7c929a0483b91fe9--

From java-user-return-45727-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 13:06:19 2010
Return-Path: <java-user-return-45727-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43923 invoked from network); 8 Apr 2010 13:06:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 13:06:19 -0000
Received: (qmail 70583 invoked by uid 500); 8 Apr 2010 13:06:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70542 invoked by uid 500); 8 Apr 2010 13:06:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70515 invoked by uid 99); 8 Apr 2010 13:06:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 13:06:16 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of saju.pillai@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 13:06:08 +0000
Received: by pwi7 with SMTP id 7so1755841pwi.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 06:05:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:content-type
         :content-transfer-encoding;
        bh=z2aUjtR2iXiLEI8vJxeZ6HPeExHZFR2EwhZOcswd/ak=;
        b=THKFeniDeFuny7iKVNmppy1vaa1EnusfjMStzsUl1vMJInkCN3lst8GkG+3YKCTtGw
         7g8VBAd12sb5fujMTzt9ZCVZHC+juM5WzuRTBiBe8AKe/8gtDkeu6LZnq0MUvqK4qQvP
         rmlVMg2lcJ72NLEIcS/BmDGaA4tfWml0/e9PU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject
         :content-type:content-transfer-encoding;
        b=BeKlzftWG6UOCyZ5U+jGKx6gjUtht6Zf3dG3m/uf/2N87nPi1X/PlOzUlzsstp1pps
         UhT7ywNDHaWSm8AMiXRPLwQAzop8x5DTq0ITQauwnKPOLGeHhOqqKzpgYy7oXMUoFG8m
         ObjVjPHPbdIbLhGH+1ZslEAYKgQKMX5du7ZgY=
Received: by 10.141.91.4 with SMTP id t4mr135390rvl.78.1270731948143;
        Thu, 08 Apr 2010 06:05:48 -0700 (PDT)
Received: from cairo-2.local ([122.172.12.198])
        by mx.google.com with ESMTPS id k17sm22304rvh.19.2010.04.08.06.05.46
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 08 Apr 2010 06:05:47 -0700 (PDT)
Message-ID: <4BBDD4A7.4040600@gmail.com>
Date: Thu, 08 Apr 2010 18:35:43 +0530
From: Saju Pillai <saju.pillai@gmail.com>
User-Agent: Thunderbird 2.0.0.24 (Macintosh/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Highlighting search results from files
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hello,

  I am new to Lucene. I am trying to highlight results for files on 
disk. The file content is indexed as :

  Reader freader = new FileReader(filepath);
  doc.add(new Field("content", freader));


In the Highlighter.getBestFragments(tokenStream, text, .....) api:

1) is tokenStream == analyzer.tokenStream(FileReader(matched file));
2) is text == the full content of the file from disk ?

Will I have to read the entire file into memory for the Highlighter to 
work ?

-srp


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45728-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 14:10:31 2010
Return-Path: <java-user-return-45728-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59162 invoked from network); 8 Apr 2010 14:10:31 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 14:10:31 -0000
Received: (qmail 98811 invoked by uid 500); 8 Apr 2010 14:10:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98781 invoked by uid 500); 8 Apr 2010 14:10:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98772 invoked by uid 99); 8 Apr 2010 14:10:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 14:10:28 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of hanshenning.gabriel@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 14:10:19 +0000
Received: by bwz22 with SMTP id 22so1824198bwz.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 07:09:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:content-type
         :content-transfer-encoding:date:subject:to:message-id:mime-version
         :x-mailer;
        bh=VNOl1sxQlFHruFzuao96qk5HqEslIUKwampdsu8L9Os=;
        b=LFnEgTxX92imcn0XIvhhN5NlnhDHBzcAEjvwvUsLZuYzfd7qvdHa8foGSObZHcC3vI
         rM59afQd+P5pWEMKuIqKsyXX0KopZke2uvlOnUJ51QB5UAQDgDbv53oxWAD0G9hz7Tz5
         KEdIetzMswEuY7xUL7oiZGl0gBvt+S7Y2BPH4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:content-type:content-transfer-encoding:date:subject:to
         :message-id:mime-version:x-mailer;
        b=Zi0bB9CfPAlB3FHDZYc6on7RVmrtbKfZ5Qgf7VrUXc5jk7dwF9CBc8fp6T5yij3/wO
         EqPKhiWbyuyE5j0BcumOE2V5J9cyirFUKK9BkDL5yIwHKw4wyfsHIB/mkaLBPPy4DJv+
         ZNmrUTzxH/ADsPrfVXkSVu94u9uePD2/AyP3U=
Received: by 10.204.162.199 with SMTP id w7mr160522bkx.211.1270735799391;
        Thu, 08 Apr 2010 07:09:59 -0700 (PDT)
Received: from norwegen.cs.uni-magdeburg.de (norwegen.cs.uni-magdeburg.de [141.44.30.148])
        by mx.google.com with ESMTPS id a11sm866384bkc.9.2010.04.08.07.09.54
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 08 Apr 2010 07:09:56 -0700 (PDT)
From: Hans-Henning Gabriel <hanshenning.gabriel@gmail.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Thu, 8 Apr 2010 16:10:02 +0200
Subject: Similarity based on regexp
To: java-user@lucene.apache.org
Message-Id: <47DAA3A1-BEEE-4BDC-959D-BA3FF5D40A40@googlemail.com>
Mime-Version: 1.0 (Apple Message framework v1077)
X-Mailer: Apple Mail (2.1077)
X-Virus-Checked: Checked by ClamAV on apache.org

Hello everybody,

this is what I would like to do:
I have an index with documents containing a field 'authors'. I would =
like to find all documents that have authors similar to a given =
author-string. One could do this by a special query, relying on lucenes =
scoring/ranking mechanism.=20
But I would like to do it different: I want to use my own similarity =
implementation, one that is based on regular expressions for example. An =
example is that this author string "Arthur Gabriel, Peter Davis and Kate =
Janeway " is equal (highest possible similarity) to this one "A. Gabriel =
& P. Davis & K. Janeway".

Is there a way doing things like this in lucene? To give a similarity =
implementation completely different (e.g. based on regular expressions) =
than lucenes scoring function?=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45729-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 16:09:03 2010
Return-Path: <java-user-return-45729-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83392 invoked from network); 8 Apr 2010 16:09:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 16:09:03 -0000
Received: (qmail 16552 invoked by uid 500); 8 Apr 2010 16:09:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16522 invoked by uid 500); 8 Apr 2010 16:09:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16514 invoked by uid 99); 8 Apr 2010 16:09:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 16:09:01 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 16:08:53 +0000
Received: by gwaa12 with SMTP id a12so1198990gwa.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 09:08:31 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Thu, 8 Apr 2010 09:08:31 -0700 (PDT)
In-Reply-To: <47DAA3A1-BEEE-4BDC-959D-BA3FF5D40A40@googlemail.com>
References: <47DAA3A1-BEEE-4BDC-959D-BA3FF5D40A40@googlemail.com>
Date: Thu, 8 Apr 2010 12:08:31 -0400
Received: by 10.150.63.7 with SMTP id l7mr346307yba.343.1270742911204; Thu, 08 
	Apr 2010 09:08:31 -0700 (PDT)
Message-ID: <z2m9ac0c6aa1004080908geaf1de75q7c8ff390f3437a39@mail.gmail.com>
Subject: Re: Similarity based on regexp
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

You can use RegexQuery (from contrib/regex) for this?

(In 3.1 there's a higher performance, very similar, RegexpQuery, too).

Mike

On Thu, Apr 8, 2010 at 10:10 AM, Hans-Henning Gabriel
<hanshenning.gabriel@gmail.com> wrote:
> Hello everybody,
>
> this is what I would like to do:
> I have an index with documents containing a field 'authors'. I would like=
 to find all documents that have authors similar to a given author-string. =
One could do this by a special query, relying on lucenes scoring/ranking me=
chanism.
> But I would like to do it different: I want to use my own similarity impl=
ementation, one that is based on regular expressions for example. An exampl=
e is that this author string "Arthur Gabriel, Peter Davis and Kate Janeway =
" is equal (highest possible similarity) to this one "A. Gabriel & P. Davis=
 & K. Janeway".
>
> Is there a way doing things like this in lucene? To give a similarity imp=
lementation completely different (e.g. based on regular expressions) than l=
ucenes scoring function?
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45730-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 18:05:39 2010
Return-Path: <java-user-return-45730-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19344 invoked from network); 8 Apr 2010 18:05:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 18:05:39 -0000
Received: (qmail 21057 invoked by uid 500); 8 Apr 2010 18:05:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21033 invoked by uid 500); 8 Apr 2010 18:05:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21025 invoked by uid 99); 8 Apr 2010 18:05:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 18:05:36 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_BL_SPAMCOP_NET,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [98.136.167.9] (HELO web113309.mail.gq1.yahoo.com) (98.136.167.9)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Apr 2010 18:05:29 +0000
Received: (qmail 64830 invoked by uid 60001); 8 Apr 2010 18:05:07 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270749907; bh=e+OVVxMP2tClo9BpKPSjXFfBNA8YE2mBoVwoUvYjdIk=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=AYyXQBFL/wfoiED0p8dakqXzMYBucX6VQKmVE1f6pp1jWxnEYyZPWXT3PpaydkKtIbTW+5vfdwJUEiI3lrX7j7j6zJ4IclF+piCUOD6+AgMGcuPTsCRnF4JlWH+aWuoqhg4K2Hwzy0AzXItCLYIVxCbx2J9wvPf1/lfqGJQvMW4=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=brhpBgrcd2F862kK3NVb8hGQ2tPBvpwdbgIX+f4+83qzN+ZP5H6LW/SPjSNjyoXVv0Q6eur/MrQWOTws6HoQQuzke72YRycgYV9sd7FCBDt4y21f1p91JD50T92+FZwM+1vQhu4u4ixpUNnPWjLdv4tIag3ubF7br816SW2IvNI=;
Message-ID: <868426.64330.qm@web113309.mail.gq1.yahoo.com>
X-YMail-OSG: hqpa.9IVM1kk1upfazHJdMhG5G9d82bP1fdLUz2v6QGXME2
 PVR5AGG9zd_ncEzjAdZYIgmsBkeSC2NZ41nZ0GE.svB55G_v0Mu5ummVLJly
 Ex5fv1OchsDT8LSrqldWwu_BGUu.Yo5pp_PI.0ug5x.fnko7RSmbOCBSAc3I
 5YRMl__asLagY9L9aoSgpafX.teq6t5fEqAAkEMo7SDHSoJnRzdu4qpL1mFY
 eGnLXthKERMk07LWNgKpjUWmZdSzem1iRmy9C4eCWCsxmp2wbqNhoq.xWpOj
 d4ODT.Ysk51qJp2evIud2h133vJP9YVt0CIx6iBMgy_OGNehSL0sKQXo-
Received: from [140.244.128.12] by web113309.mail.gq1.yahoo.com via HTTP; Thu, 08 Apr 2010 11:05:07 PDT
X-Mailer: YahooMailClassic/10.0.8 YahooMailWebService/0.8.100.260964
Date: Thu, 8 Apr 2010 11:05:07 -0700 (PDT)
From: Ivan Provalov <iprovalo@yahoo.com>
Subject: Lucene Partition Size
To: java-user@lucene.apache.org
In-Reply-To: <20100330150543.778c5272@essen.neofonie.priv>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

We are using Lucene for searching of 200+ mln documents (periodical publications).  Is there any limitation on the size of the Lucene index (file size, number of docs, etc...)?  

We are partitioning the indexes at about 10 mln documents per partition (each partition is on a separate box, some mounted volumes are shared among three-four partitions).  We have index size around 10% of the content size.  The total content is around 4Tb and the index around 400Gb.  This content is planned to be split into 20 partitions (10mln docs, 200Gb content size, 20Gb index size).  We are using a memory mapped index directory implementation.  Our testing is done with 600 concurrent users.  

We are seeing consistently high response times from the partitions (4-5 seconds).  Is there a number of documents per partition limitation in Lucene for this particular scenario?

Thanks,

Ivan


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45731-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 18:15:13 2010
Return-Path: <java-user-return-45731-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21552 invoked from network); 8 Apr 2010 18:15:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 18:15:12 -0000
Received: (qmail 37578 invoked by uid 500); 8 Apr 2010 18:15:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37538 invoked by uid 500); 8 Apr 2010 18:15:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37530 invoked by uid 99); 8 Apr 2010 18:15:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 18:15:10 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.191.69.78] (HELO web32901.mail.mud.yahoo.com) (209.191.69.78)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Apr 2010 18:15:02 +0000
Received: (qmail 61102 invoked by uid 60001); 8 Apr 2010 18:14:41 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270750481; bh=iNTQ+9tzPRjXXL4dXDwFcDF9tbqgOdFQBE2kQzrU+bo=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=p2Lh1dRgByjjxivzesCTFveRBi6ZcYzUob4yuKSvjbU+cAfw3EWRVdrQXW3DNYauChEnR2F8D5Lqhv5wkxCHIbMDB1gdmfY/nO1q8HFddDUl0MSjl+5qi4hpfqS06WMyrHAVx+2J9k4FlybAuecIA+QIrNeiz4T98PpHnzf7RQo=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=wbzhtjumqwOjssSumFD3/r4LpkOD//rZRtlKKAw01gR7VfoO6WGo3CUhmcD4xXH3DVyDsSuGfehG8Cvod9wYp92FC7Rd0vHicu197tV9nU7iC2gR7x2pqL6jYhdlrQuvTlW3cR6tq6fsKLhHbObXs8deqrk3mF/uzPCDtBgyc4Y=;
Message-ID: <11118.59029.qm@web32901.mail.mud.yahoo.com>
X-YMail-OSG: Pfcmjc8VM1nOYoEYP2tJyJFuXeUujviunwqu7kbN8xI3WO6
 SD47gAzGpdbllZFW67k2EsBC5hLBIDwhadjGb4.nupf7mAEALc.G2HhUiYH9
 0_NIBrUdECrWjUUy27Vv6FOQDDl3OtNPzHTh6_TGzXjjWYeS39it5ry609Wk
 KSJF0b2ai3j0BAS3Gek9O7K2Nvz.EJqK0KDmn1D8oTOndkwucyvR.zn9X7Ku
 JHZ8GHqpzmBMSuwadsteRXIcmmIzojVsgtMPW17kGLpFrusd9pXQyH_NHzYQ
 TeXEJptyWt15J6Z.6F6Bz8Sxy_jc-
Received: from [72.36.94.20] by web32901.mail.mud.yahoo.com via HTTP; Thu, 08 Apr 2010 11:14:40 PDT
X-Mailer: YahooMailRC/348.3 YahooMailWebService/0.8.100.260964
Date: Thu, 8 Apr 2010 11:14:40 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: ClosedChannelException from IndexWriter.getReader()
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

I'm getting a ClosedChannelException from IndexWriter.getReader().  I don't think the writer has been closed and, if it were, I would expect an AlreadyClosedException as described in the API documentation.  Does anyone have an idea what might be wrong?  The disk is not full and the permissions look correct.

Here the stack trace from revision 926791:

java.nio.channels.ClosedChannelException
        at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.java:88)
        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:613)
        at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.readInternal(NIOFSDirectory.java:150)
        at org.apache.lucene.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:139)
        at org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal(CompoundFileReader.java:257)
        at org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:160)
        at org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:39)
        at org.apache.lucene.store.IndexInput.readInt(IndexInput.java:74)
        at org.apache.lucene.index.FieldsReader.<init>(FieldsReader.java:114)
        at org.apache.lucene.index.SegmentReader$CoreReaders.openDocStores(SegmentReader.java:294)
        at org.apache.lucene.index.SegmentReader.openDocStores(SegmentReader.java:590)
        at org.apache.lucene.index.IndexWriter$ReaderPool.get(IndexWriter.java:640)
        at org.apache.lucene.index.IndexWriter$ReaderPool.getReadOnlyClone(IndexWriter.java:591)
        at org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:138)
        at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryReader.java:36)
        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:423)
        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:387)

Thanks,
Justin



      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45732-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 18:45:32 2010
Return-Path: <java-user-return-45732-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35080 invoked from network); 8 Apr 2010 18:45:31 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 18:45:31 -0000
Received: (qmail 90546 invoked by uid 500); 8 Apr 2010 18:45:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90516 invoked by uid 500); 8 Apr 2010 18:45:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90507 invoked by uid 99); 8 Apr 2010 18:45:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 18:45:29 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 18:45:20 +0000
Received: by pwi7 with SMTP id 7so2112480pwi.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 11:44:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=dNOiB4zfQwQKu0v8DUQOgIpT1vrUnk3s0G1SC9MYsew=;
        b=lK51BcLv4XdsSKq4ypmRAXdbJqM7pK2og1a040q5+ugnNUqVYwz55vnk3fG8pss0S9
         STuTFWD7AVmzlTDoz2oEAhCBmakg0gWcCo5Sfx56aNIddbylCHEKlxGkPDVG5BOzCdYa
         BZoBXNeXQffqXQf7jzRYtaoo63XUXPmtZWYfE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=reQPuv+glxr7M/xiiOS6GcEEdhN69V4PpC9b/zmgYOxlKzbCItEkREXzcTJgmx31EQ
         w9zcyTro5bdJHCxmS4CcXnKPG2SWa9XIP3zOAYHDsw47IifjoDtf0+vMfWCO3GFMUa2q
         I/nJgCtwCZKsiNnhde13GdrEslKsAbFGUpJ/Q=
Received: by 10.114.187.17 with SMTP id k17mr962358waf.31.1270752298384;
        Thu, 08 Apr 2010 11:44:58 -0700 (PDT)
Received: from [10.0.25.6] (95-36-32-119.dsl.alice.nl [95.36.32.119])
        by mx.google.com with ESMTPS id d2sm250640ibr.3.2010.04.08.11.44.53
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 08 Apr 2010 11:44:56 -0700 (PDT)
Message-Id: <913098E0-DBE8-425A-85B0-5FB103F58E13@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <868426.64330.qm@web113309.mail.gq1.yahoo.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Lucene Partition Size
Date: Thu, 8 Apr 2010 20:44:29 +0200
References: <868426.64330.qm@web113309.mail.gq1.yahoo.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org


8 apr 2010 kl. 20.05 skrev Ivan Provalov:

> We are using Lucene for searching of 200+ mln documents (periodical  
> publications).  Is there any limitation on the size of the Lucene  
> index (file size, number of docs, etc...)?

The only such limitation in Lucene I'm aware of is Integer.MAX_VALUE  
documents. This might also be true for number of terms.

> We are partitioning the indexes at about 10 mln documents per  
> partition (each partition is on a separate box, some mounted volumes  
> are shared among three-four partitions).  We have index size around  
> 10% of the content size.  The total content is around 4Tb and the  
> index around 400Gb.  This content is planned to be split into 20  
> partitions (10mln docs, 200Gb content size, 20Gb index size).  We  
> are using a memory mapped index directory implementation.  Our  
> testing is done with 600 concurrent users.
>
> We are seeing consistently high response times from the partitions  
> (4-5 seconds).  Is there a number of documents per partition  
> limitation in Lucene for this particular scenario?

I'm not sure if I got this right but it sounds like your index is  
mounted over network? Can you tell us some more details about that?  
What speeds do you see if you put the index on local disc?



	karl

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45733-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 19:41:38 2010
Return-Path: <java-user-return-45733-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49733 invoked from network); 8 Apr 2010 19:41:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 19:41:38 -0000
Received: (qmail 86427 invoked by uid 500); 8 Apr 2010 19:41:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86365 invoked by uid 500); 8 Apr 2010 19:41:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86357 invoked by uid 99); 8 Apr 2010 19:41:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 19:41:35 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.179] (HELO mail-yx0-f179.google.com) (209.85.210.179)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 19:41:29 +0000
Received: by yxe9 with SMTP id 9so1370550yxe.29
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 12:41:07 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Thu, 8 Apr 2010 12:41:07 -0700 (PDT)
In-Reply-To: <11118.59029.qm@web32901.mail.mud.yahoo.com>
References: <11118.59029.qm@web32901.mail.mud.yahoo.com>
Date: Thu, 8 Apr 2010 15:41:07 -0400
Received: by 10.150.56.40 with SMTP id e40mr759043yba.1.1270755667755; Thu, 08 
	Apr 2010 12:41:07 -0700 (PDT)
Message-ID: <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>
Subject: Re: ClosedChannelException from IndexWriter.getReader()
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Are you using Future.cancel or directly using Thread.interrupt?  If so
it could be this nasty issue:

    https://issues.apache.org/jira/browse/LUCENE-2239

Try temporarily using a Directory impl other than NIOFSDirectory and
see if the problem still happens?

Mike

On Thu, Apr 8, 2010 at 2:14 PM, Justin <crynax@yahoo.com> wrote:
> I'm getting a ClosedChannelException from IndexWriter.getReader(). =A0I d=
on't think the writer has been closed and, if it were, I would expect an Al=
readyClosedException as described in the API documentation. =A0Does anyone =
have an idea what might be wrong? =A0The disk is not full and the permissio=
ns look correct.
>
> Here the stack trace from revision 926791:
>
> java.nio.channels.ClosedChannelException
> =A0 =A0 =A0 =A0at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.j=
ava:88)
> =A0 =A0 =A0 =A0at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:61=
3)
> =A0 =A0 =A0 =A0at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.=
readInternal(NIOFSDirectory.java:150)
> =A0 =A0 =A0 =A0at org.apache.lucene.store.BufferedIndexInput.readBytes(Bu=
fferedIndexInput.java:139)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.CompoundFileReader$CSIndexInput=
.readInternal(CompoundFileReader.java:257)
> =A0 =A0 =A0 =A0at org.apache.lucene.store.BufferedIndexInput.refill(Buffe=
redIndexInput.java:160)
> =A0 =A0 =A0 =A0at org.apache.lucene.store.BufferedIndexInput.readByte(Buf=
feredIndexInput.java:39)
> =A0 =A0 =A0 =A0at org.apache.lucene.store.IndexInput.readInt(IndexInput.j=
ava:74)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.FieldsReader.<init>(FieldsReade=
r.java:114)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.SegmentReader$CoreReaders.openD=
ocStores(SegmentReader.java:294)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.SegmentReader.openDocStores(Seg=
mentReader.java:590)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter$ReaderPool.get(Inde=
xWriter.java:640)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter$ReaderPool.getReadO=
nlyClone(IndexWriter.java:591)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.DirectoryReader.<init>(Director=
yReader.java:138)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(=
ReadOnlyDirectoryReader.java:36)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter.getReader(IndexWrit=
er.java:423)
> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter.getReader(IndexWrit=
er.java:387)
>
> Thanks,
> Justin
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45734-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 20:07:50 2010
Return-Path: <java-user-return-45734-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54101 invoked from network); 8 Apr 2010 20:07:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 20:07:49 -0000
Received: (qmail 27725 invoked by uid 500); 8 Apr 2010 20:07:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27699 invoked by uid 500); 8 Apr 2010 20:07:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27691 invoked by uid 99); 8 Apr 2010 20:07:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 20:07:47 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_BL_SPAMCOP_NET,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [98.136.167.11] (HELO web113311.mail.gq1.yahoo.com) (98.136.167.11)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Apr 2010 20:07:38 +0000
Received: (qmail 47959 invoked by uid 60001); 8 Apr 2010 20:07:16 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270757235; bh=TsOVZKAPZiHaSpQUmn5HSh+AtNf+kpRzM929Z+8s+Ak=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=2h2vtTd1jbNAe2TyIOhQJZ0Knt8FOUuocQ43/AYXqvrZYXfp0WYpshYP++8EGr0h8t6E/XJQHwJVUuPVUgKrc/vaObjKHUHANDFrHDQfySmynxKveer2q63DUlYifddP1VEH5K78bT3+oCy2X93awEsdpBqnliGMk2tjq9/Z3e0=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=ksBWHzxZh7KEeYbWmoZ9os5IGIk6psedHCz+75DZstAB8N7/fETHleKpzBA4UzA0n4+kMpypoTQvrP7l9P6I6k5+yeBqkz93u3suih7jH8QuTcF2Awvn5mafCeYX1/bGbE48StcG/fFmKTxg4tZC6oEQXeIZKcc8diyBmvTcPNA=;
Message-ID: <969295.47343.qm@web113311.mail.gq1.yahoo.com>
X-YMail-OSG: RZJCWpYVM1niyNCpyz0_3pJaTi5v.2zcACDD1l8Gda49SX4
 pjvOVB79Q.41Qo.KFPfxDFICFKlY3QBc6IrL_6.Dv4dfm9Fpw7OnIkqQl68_
 lD7qvRqjEzU1S.rRirySPQqYNDOE0wP5GxAhZtgxXBHTfVotw7gLlElHYXd0
 dZMzU41JDN9sOIdeL4_gql42ftnoqK00QkqLQzIPd5U9aiMbPPEOw1Em8OGM
 fPtddQ9OgZrDf2jTtf6v1Fos8CvHtKC0bGPEiLy3In3QFgs9rJwZFprjst9M
 JhUZwTj9yLc2olXBpVTl_7oNj0eajWRQ8YgYPF.meLe62mRdTnz0zzm98O2W
 QnneHxYwCe0G27z.WGC5N2F_lVkEFJA--
Received: from [140.244.128.12] by web113311.mail.gq1.yahoo.com via HTTP; Thu, 08 Apr 2010 13:07:15 PDT
X-Mailer: YahooMailClassic/10.0.8 YahooMailWebService/0.8.100.260964
Date: Thu, 8 Apr 2010 13:07:15 -0700 (PDT)
From: Ivan Provalov <iprovalo@yahoo.com>
Subject: Re: Lucene Partition Size
To: java-user@lucene.apache.org
In-Reply-To: <913098E0-DBE8-425A-85B0-5FB103F58E13@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Karl,=0A=0AWe have not done the same scale local-disk test.  Our network pa=
rameters are=0A=0A-  Network speed:  1gb=0A-  3 partitions per volume=0A-  =
The volumes are accessed via NFS to EMC Celera devices. (NFS 3)=0A-  The dr=
ives are 300 gb fiber attached with 10,000 rpm.=0A=0AThanks,=0A=0AIvan=0A=
=0A--- On Thu, 4/8/10, Karl Wettin <karl.wettin@gmail.com> wrote:=0A=0A> Fr=
om: Karl Wettin <karl.wettin@gmail.com>=0A> Subject: Re: Lucene Partition S=
ize=0A> To: java-user@lucene.apache.org=0A> Date: Thursday, April 8, 2010, =
2:44 PM=0A> =0A> 8 apr 2010 kl. 20.05 skrev Ivan Provalov:=0A> =0A> > We ar=
e using Lucene for searching of 200+ mln=0A> documents (periodical publicat=
ions).=A0 Is there any=0A> limitation on the size of the Lucene index (file=
 size,=0A> number of docs, etc...)?=0A> =0A> The only such limitation in Lu=
cene I'm aware of is=0A> Integer.MAX_VALUE documents. This might also be tr=
ue for=0A> number of terms.=0A> =0A> > We are partitioning the indexes at a=
bout 10 mln=0A> documents per partition (each partition is on a separate=0A=
> box, some mounted volumes are shared among three-four=0A> partitions).=A0=
 We have index size around 10% of the=0A> content size.=A0 The total conten=
t is around 4Tb and the=0A> index around 400Gb.=A0 This content is planned =
to be=0A> split into 20 partitions (10mln docs, 200Gb content size,=0A> 20G=
b index size).=A0 We are using a memory mapped index=0A> directory implemen=
tation.=A0 Our testing is done with 600=0A> concurrent users.=0A> > =0A> > =
We are seeing consistently high response times from=0A> the partitions (4-5=
 seconds).=A0 Is there a number of=0A> documents per partition limitation i=
n Lucene for this=0A> particular scenario?=0A> =0A> I'm not sure if I got t=
his right but it sounds like your=0A> index is mounted over network? Can yo=
u tell us some more=0A> details about that? What speeds do you see if you p=
ut the=0A> index on local disc?=0A> =0A> =0A> =0A> =A0=A0=A0 karl=0A> =0A> =
---------------------------------------------------------------------=0A> T=
o unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org=0A> For addi=
tional commands, e-mail: java-user-help@lucene.apache.org=0A> =0A> =0A=0A=
=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45735-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 20:33:58 2010
Return-Path: <java-user-return-45735-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60109 invoked from network); 8 Apr 2010 20:33:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 20:33:57 -0000
Received: (qmail 65567 invoked by uid 500); 8 Apr 2010 20:33:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65541 invoked by uid 500); 8 Apr 2010 20:33:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65532 invoked by uid 99); 8 Apr 2010 20:33:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 20:33:55 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ruben.laguna@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 20:33:50 +0000
Received: by wwb29 with SMTP id 29so19281wwb.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 13:33:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=GSP5NP9pp/sUx/ngreBddssSivS0RoPUwSPvXE/CTz8=;
        b=Bnvkho3K6Ft4/92c8mC8sPi/rLTzUqh9/57SK3KrUFCH4o4Abcx7igl2zXIKRZI1/j
         qyD0rRld8vqIBDtCUFIMLm7sqbW2QMIjt5dCq7FWUmlz1ykNmHb61wEYxSx+odY0Kc8c
         M/n7unBhz3Z/lNGL4QCAovLZr9IMpg42CXm4w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=xRxR544724EuJc0NZGeearviaryZ5MwiGGusWPZLUOOt7scjTRadlAPgUY+QmSyGHN
         wLDJXbN+H8v5d/tTKgGGfWNCFp1MkFsKb1JUACzYnyQhvA7k/BVliArmYfMbfDULNVZW
         pY6weghdbYeImBbJqWDGuqTUPMNSLXCZ8qhtA=
MIME-Version: 1.0
Received: by 10.216.53.200 with HTTP; Thu, 8 Apr 2010 13:33:27 -0700 (PDT)
In-Reply-To: <q2uf8d56a4d1004080550s6717849jbd4570de5f2c5817@mail.gmail.com>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <007e01cad6ee$10c8dc40$325a94c0$@de>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
	 <00c301cad702$d10a4ca0$731ee5e0$@de>
	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
	 <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
	 <00fe01cad715$54c5ba90$fe512fb0$@de>
	 <q2uf8d56a4d1004080550s6717849jbd4570de5f2c5817@mail.gmail.com>
Date: Thu, 8 Apr 2010 22:33:27 +0200
Received: by 10.216.169.200 with SMTP id n50mr303441wel.217.1270758807124; 
	Thu, 08 Apr 2010 13:33:27 -0700 (PDT)
Message-ID: <y2yf8d56a4d1004081333j17444edfi69a592dc4267ef36@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364c74f14b3b9c0483bf9762

--0016364c74f14b3b9c0483bf9762
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Yeah, I checked again and IndexWriter is holding references to the Reader,
I'm afraid.

 I opened bug report https://issues.apache.org/jira/browse/LUCENE-2387 to
track this down.

On Thu, Apr 8, 2010 at 2:50 PM, Ruben Laguna <ruben.laguna@gmail.com> wrote=
:

> I will double check in the afternoon the heapdump.hprof. But I think that
> *some* readers are indeed held by docWriter.threadStates[0].consumer.fiel=
dHash[1].fields[xxxx],
> as shown in [1] (this heapdump contains only live objects).  The heapdump
> was taken after IndexWriter.commit() /IndexWriter.optimize() and all the
> Documents were already indexed and GCed (I will double check).
>
> So that would mean that the Reader is retained in memory by the following
> chaing of references,
>
> DocumentsWriter -> DocumentsWriterThreadState -> DocFieldProcessorPerThre=
ad
> -> DocFieldProcessorPerField -> Fieldable -> Field (fieldsData)
>
> I'll double check with Eclipse MAT as I said that this chain is actually
> made of hard references only (no SoftReferences,WeakReferences, etc). I w=
ill
> also double check also that there is no "live" Document that is referenci=
ng
> the Reader via the Field.
>
>
> [1] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
>
> On Thu, Apr 8, 2010 at 2:16 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>
>> Readers are not held. If you indexed the document and gced the document
>> instance they readers are gone.
>>
>> -----
>> Uwe Schindler
>> H.-H.-Meier-Allee 63, D-28213 Bremen
>> http://www.thetaphi.de
>> eMail: uwe@thetaphi.de
>>
>>
>> > -----Original Message-----
>> > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
>> > Sent: Thursday, April 08, 2010 1:28 PM
>> > To: java-user@lucene.apache.org
>> > Subject: Re: IndexWriter memory leak?
>> >
>> > Now that the zzBuffer issue is solved...
>> >
>> > what about the references to the Readers held by docWriter. Tika=C2=B4=
s
>> > ParsingReaders are quite heavyweight so retaining those in memory
>> > unnecesarily is also a "hidden" memory leak. Should I open a bug repor=
t
>> > on
>> > that one?
>> >
>> > /Rub=C3=A9n
>> >
>> > On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com> wrote:
>> >
>> > > Guess we were replying at the same time :).
>> > >
>> > > On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de>
>> > wrote:
>> > >
>> > > > I already answered, that I will take care of this!
>> > > >
>> > > > Uwe
>> > > >
>> > > > -----
>> > > > Uwe Schindler
>> > > > H.-H.-Meier-Allee 63, D-28213 Bremen
>> > > > http://www.thetaphi.de
>> > > > eMail: uwe@thetaphi.de
>> > > >
>> > > >
>> > > > > -----Original Message-----
>> > > > > From: Shai Erera [mailto:serera@gmail.com]
>> > > > > Sent: Thursday, April 08, 2010 12:00 PM
>> > > > > To: java-user@lucene.apache.org
>> > > > > Subject: Re: IndexWriter memory leak?
>> > > > >
>> > > > > Yes, that's the trimBuffer version I was thinking about, only
>> > this guy
>> > > > > created a reset(Reader, int) and does both ops (resetting + trim=
)
>> > in
>> > > > > one
>> > > > > method call. More convenient. Can you please open an issue to
>> > track
>> > > > > that?
>> > > > > People will have a chance to comment on whether we (Lucene)
>> > should
>> > > > > handle
>> > > > > that, or it should be a JFlex fix. Based on the number of replie=
s
>> > this
>> > > > > guy
>> > > > > received (0 !), I doubt JFlex would consider it a problem. But w=
e
>> > can
>> > > > > do
>> > > > > some small service to our users base by protecting against such
>> > > > > problems.
>> > > > >
>> > > > > And while you're opening the issue, if you want to take a stab a=
t
>> > > > > fixing it
>> > > > > and post a patch, it'd be great :).
>> > > > >
>> > > > > Shai
>> > > > >
>> > > > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
>> > > > > <ruben.laguna@gmail.com>wrote:
>> > > > >
>> > > > > > I was investigating this a little further and in the JFlex
>> > mailing
>> > > > > list I
>> > > > > > found [1]
>> > > > > >
>> > > > > > I don't know much about flex / JFlex but it seems that this gu=
y
>> > > > > resets the
>> > > > > > zzBuffer to 16384 or less when setting the input for the lexer
>> > > > > >
>> > > > > >
>> > > > > > Quoted from  shef <shef31@ya...>
>> > > > > >
>> > > > > >
>> > > > > > I set
>> > > > > >
>> > > > > > %buffer 0
>> > > > > >
>> > > > > > in the options section, and then added this method to the
>> > lexer:
>> > > > > >
>> > > > > >    /**
>> > > > > >     * Set the input for the lexer. The size parameter really
>> > speeds
>> > > > > things
>> > > > > > up,
>> > > > > >     * because by default, the lexer allocates an internal
>> > buffer of
>> > > > > 16k.
>> > > > > > For
>> > > > > >     * most strings, this is unnecessarily large. If the size
>> > param is
>> > > > > > 0 or greater
>> > > > > >     * than 16k, then the buffer is set to 16k. If the size
>> > param is
>> > > > > > smaller, then
>> > > > > >     * the buf will be set to the exact size.
>> > > > > >     * @param r the reader that provides the data
>> > > > > >     * @param the size of the data in the reader.
>> > > > > >     */
>> > > > > >    public void reset(Reader r, int size) {
>> > > > > >        if (size =3D=3D 0 || size > 16384)
>> > > > > >            size =3D 16384;
>> > > > > >        zzBuffer =3D new char[size];
>> > > > > >        yyreset(r);
>> > > > > >    }
>> > > > > >
>> > > > > >
>> > > > > > So maybe there is a way to trim the zzBuffer this way (?).
>> > > > > >
>> > > > > > BTW, I will try to find out which is the "big token" in my
>> > dataset
>> > > > > this
>> > > > > > afternoon. Thanks for the help.
>> > > > > >
>> > > > > > I actually workaround this memory problem for the time being b=
y
>> > > > > wrapping
>> > > > > > the
>> > > > > > IndexWriter in a class that periodically closes the IndexWrite=
r
>> > and
>> > > > > creates
>> > > > > > a new one, allowing the old to be GCed, but I would be really
>> > good if
>> > > > > > either
>> > > > > > JFlex or Lucene can take care of this zzBuffer going berserk.
>> > > > > >
>> > > > > >
>> > > > > > Again thanks for the quick response. /Rub=C3=A9n
>> > > > > >
>> > > > > >
>> > > > > > [1]
>> > > > > >
>> > > > > >
>> > > > >
>> > >
>> > https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.=
qm@
>> > > > > web38901.mail.mud.yahoo.com
>> > > > > >
>> > > > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera <serera@gmail.com>
>> > > wrote:
>> > > > > >
>> > > > > > > If we could change the Flex file so that yyreset(Reader)
>> > would
>> > > > > check the
>> > > > > > > size of zzBuffer, we could trim it when it gets too big. But
>> > I
>> > > > > don't
>> > > > > > think
>> > > > > > > we have such control when writing the flex syntax ... yyrese=
t
>> > is
>> > > > > > generated
>> > > > > > > by JFlex and that's the only place I can think of to trim th=
e
>> > > > > buffer down
>> > > > > > > when it exceeds a predefined threshold ....
>> > > > > > >
>> > > > > > > Maybe what we can do is create our own method which will be
>> > called
>> > > > > by
>> > > > > > > StandardTokenizer after yyreset is called, something like
>> > > > > > > trimBufferIfTooBig(int threshold) which will reallocate
>> > zzBuffer if
>> > > > > it
>> > > > > > > exceeded the threshold. We can decide on a reasonable 64K
>> > threshold
>> > > > > or
>> > > > > > > something, or simply always cut back to 16 KB. As far as I
>> > > > > understand,
>> > > > > > that
>> > > > > > > buffer should never grow that much. I.e. in zzRefill, which
>> > is the
>> > > > > only
>> > > > > > > place where the buffer gets resized, there is an attempt to
>> > first
>> > > > > move
>> > > > > > back
>> > > > > > > characters that were already consumed and only then allocate
>> > a
>> > > > > bigger
>> > > > > > > buffer. Which means only if there is a token whose size is
>> > larger
>> > > > > than
>> > > > > > 16KB
>> > > > > > > (!?), will this buffer get expanded.
>> > > > > > >
>> > > > > > > A trimBuffer method might not be that bad .. as a protective
>> > > > > measure.
>> > > > > > What
>> > > > > > > do you think? Of course, JFlex can fix it on their own ...
>> > but
>> > > > > until that
>> > > > > > > happens ...
>> > > > > > >
>> > > > > > > Shai
>> > > > > > >
>> > > > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler
>> > <uwe@thetaphi.de>
>> > > > > wrote:
>> > > > > > >
>> > > > > > > > > I would like to identify also the problematic document I
>> > have
>> > > > > 10000
>> > > > > > so,
>> > > > > > > > > what
>> > > > > > > > > would be the best way of identifying the one that it
>> > making
>> > > > > zzBuffer
>> > > > > > to
>> > > > > > > > > grow
>> > > > > > > > > without control?
>> > > > > > > >
>> > > > > > > > Dont index your documents, but instead pass them directly
>> > to the
>> > > > > > analyzer
>> > > > > > > > and consume the tokenstream manually. Then visit
>> > > > > > > TermAttribute.termLength()
>> > > > > > > > for each Token.
>> > > > > > > >
>> > > > > > > >
>> > > > > > > > ----------------------------------------------------------=
-
>> > ------
>> > > > > ----
>> > > > > > > > To unsubscribe, e-mail: java-user-
>> > unsubscribe@lucene.apache.org
>> > > > > > > > For additional commands, e-mail:
>> > > java-user-help@lucene.apache.org
>> > > > > > > >
>> > > > > > > >
>> > > > > > >
>> > > > > >
>> > > > > >
>> > > > > >
>> > > > > > --
>> > > > > > /Rub=C3=A9n
>> > > > > >
>> > > >
>> > > >
>> > > > ------------------------------------------------------------------=
-
>> > --
>> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
>> > > >
>> > > >
>> > >
>> >
>> >
>> >
>> > --
>> > /Rub=C3=A9n
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> /Rub=C3=A9n
>



--=20
/Rub=C3=A9n

--0016364c74f14b3b9c0483bf9762--

From java-user-return-45736-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 20:39:16 2010
Return-Path: <java-user-return-45736-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61685 invoked from network); 8 Apr 2010 20:39:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 20:39:16 -0000
Received: (qmail 74073 invoked by uid 500); 8 Apr 2010 20:39:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74045 invoked by uid 500); 8 Apr 2010 20:39:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74037 invoked by uid 99); 8 Apr 2010 20:39:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 20:39:14 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.83] (HELO web32906.mail.mud.yahoo.com) (209.191.69.83)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Apr 2010 20:39:06 +0000
Received: (qmail 28794 invoked by uid 60001); 8 Apr 2010 20:38:44 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270759124; bh=9EOYaije6TCC53dYBlQKzEul2u/GIjL4hoRuFBEqfKw=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=MRAzJQM6x+8Jmw5Do3DFKWwRfwd76+dSyNXu1r1XiKrb2ogqn/+stIXJN+DBt23v5B8lFcfvilJnbKKgCIZJ8fJOXPvw4wt5LILniSSSupAhO0ixiWfAlKc2B2P1nvo3brvFo+ND4CMQjLYxaYhYYaaERqYxs4qOsz4iHSVYKnI=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=pmWjeNSksryUCKxcwNehT/BiAw7triW/jrW2eenoHbfPWuDj8JwtMiIE5rblEsS3jiIzteQ5f+tkbsCkTmiE6Vs82uB8OC2oXQu5yIpGmCQiv+fVKMzW1J9V8IV5FfKMt5wWx+Tl+ePm8U4CPEbVz6cdujTtgljVmDjZbI+jLhQ=;
Message-ID: <463439.27658.qm@web32906.mail.mud.yahoo.com>
X-YMail-OSG: D24qzM8VM1nsh8u45x_oFvsdC.TCvK9zljkKhZ4Avp3B9PW
 E1P0BtttUnqvebbPvusjWE1aGcXfXs4usen7xyp_ZIMkFdvow7WPzzYFRoiL
 0Zt4gDt2V5CsmhP.yAZObzlBik236SiwS0ve_DlrVO1nPialoYSMr5u2oYlb
 fF4KnB4Hqu4_kTikF6pH3nhhzD.unqpQcGrhylkU3HVvo9Z.3zlY8JC8BmJl
 vhZUO1gWlKMiK9LNltAGKP9JzukEKyzrXZ38cqU.kmVVJ9dqXGDx_RF8tICQ
 o9BeO3BbyQG.Zg5XBZAjI7WG1GBKGhj.05lTg_bdoe7iPx9PxBFV2taj.fJy
 2eLVxeggOQEKBvFRXX0YhHbtUdQI.53Zz8TrCiA--
Received: from [72.36.94.20] by web32906.mail.mud.yahoo.com via HTTP; Thu, 08 Apr 2010 13:38:44 PDT
X-Mailer: YahooMailRC/348.3 YahooMailWebService/0.8.100.260964
References: <11118.59029.qm@web32901.mail.mud.yahoo.com> <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>
Date: Thu, 8 Apr 2010 13:38:44 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: ClosedChannelException from IndexWriter.getReader()
To: java-user@lucene.apache.org
In-Reply-To: <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

In fact, we are using Thread.interrupt() to warm up a searcher in a separate thread (not really that uncommon, is it?).  We may switch to Object::wait(long) and Object::notify() instead of switching the Directory implementation.  Thanks for recognizing the issue!




----- Original Message ----
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Sent: Thu, April 8, 2010 2:41:07 PM
Subject: Re: ClosedChannelException from IndexWriter.getReader()

Are you using Future.cancel or directly using Thread.interrupt?  If so
it could be this nasty issue:

    https://issues.apache.org/jira/browse/LUCENE-2239

Try temporarily using a Directory impl other than NIOFSDirectory and
see if the problem still happens?

Mike

On Thu, Apr 8, 2010 at 2:14 PM, Justin <crynax@yahoo.com> wrote:
> I'm getting a ClosedChannelException from IndexWriter.getReader().  I don't think the writer has been closed and, if it were, I would expect an AlreadyClosedException as described in the API documentation.  Does anyone have an idea what might be wrong?  The disk is not full and the permissions look correct.
>
> Here the stack trace from revision 926791:
>
> java.nio.channels.ClosedChannelException
>        at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.java:88)
>        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:613)
>        at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.readInternal(NIOFSDirectory.java:150)
>        at org.apache.lucene.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:139)
>        at org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal(CompoundFileReader.java:257)
>        at org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:160)
>        at org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:39)
>        at org.apache.lucene.store.IndexInput.readInt(IndexInput.java:74)
>        at org.apache.lucene.index.FieldsReader.<init>(FieldsReader.java:114)
>        at org.apache.lucene.index.SegmentReader$CoreReaders.openDocStores(SegmentReader.java:294)
>        at org.apache.lucene.index.SegmentReader.openDocStores(SegmentReader.java:590)
>        at org.apache.lucene.index.IndexWriter$ReaderPool.get(IndexWriter.java:640)
>        at org.apache.lucene.index.IndexWriter$ReaderPool.getReadOnlyClone(IndexWriter.java:591)
>        at org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:138)
>        at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryReader.java:36)
>        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:423)
>        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:387)
>
> Thanks,
> Justin
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45737-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 20:51:12 2010
Return-Path: <java-user-return-45737-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65111 invoked from network); 8 Apr 2010 20:51:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 20:51:12 -0000
Received: (qmail 93384 invoked by uid 500); 8 Apr 2010 20:51:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93349 invoked by uid 500); 8 Apr 2010 20:51:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93341 invoked by uid 99); 8 Apr 2010 20:51:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 20:51:09 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 20:51:03 +0000
Received: by gyf1 with SMTP id 1so1314730gyf.35
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 13:50:41 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Thu, 8 Apr 2010 13:50:41 -0700 (PDT)
In-Reply-To: <463439.27658.qm@web32906.mail.mud.yahoo.com>
References: <11118.59029.qm@web32901.mail.mud.yahoo.com>
	 <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>
	 <463439.27658.qm@web32906.mail.mud.yahoo.com>
Date: Thu, 8 Apr 2010 16:50:41 -0400
Received: by 10.150.127.10 with SMTP id z10mr746460ybc.266.1270759841402; Thu, 
	08 Apr 2010 13:50:41 -0700 (PDT)
Message-ID: <o2m9ac0c6aa1004081350z864f9555g90ec393d6c3a3974@mail.gmail.com>
Subject: Re: ClosedChannelException from IndexWriter.getReader()
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

OK, phew :)

Yea warming in a separate thread is common... but why does
Thread.interrupt() come into play in your app for warming?

Mike

On Thu, Apr 8, 2010 at 4:38 PM, Justin <crynax@yahoo.com> wrote:
> In fact, we are using Thread.interrupt() to warm up a searcher in a separ=
ate thread (not really that uncommon, is it?). =A0We may switch to Object::=
wait(long) and Object::notify() instead of switching the Directory implemen=
tation. =A0Thanks for recognizing the issue!
>
>
>
>
> ----- Original Message ----
> From: Michael McCandless <lucene@mikemccandless.com>
> To: java-user@lucene.apache.org
> Sent: Thu, April 8, 2010 2:41:07 PM
> Subject: Re: ClosedChannelException from IndexWriter.getReader()
>
> Are you using Future.cancel or directly using Thread.interrupt? =A0If so
> it could be this nasty issue:
>
> =A0 =A0https://issues.apache.org/jira/browse/LUCENE-2239
>
> Try temporarily using a Directory impl other than NIOFSDirectory and
> see if the problem still happens?
>
> Mike
>
> On Thu, Apr 8, 2010 at 2:14 PM, Justin <crynax@yahoo.com> wrote:
>> I'm getting a ClosedChannelException from IndexWriter.getReader(). =A0I =
don't think the writer has been closed and, if it were, I would expect an A=
lreadyClosedException as described in the API documentation. =A0Does anyone=
 have an idea what might be wrong? =A0The disk is not full and the permissi=
ons look correct.
>>
>> Here the stack trace from revision 926791:
>>
>> java.nio.channels.ClosedChannelException
>> =A0 =A0 =A0 =A0at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.=
java:88)
>> =A0 =A0 =A0 =A0at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:6=
13)
>> =A0 =A0 =A0 =A0at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput=
.readInternal(NIOFSDirectory.java:150)
>> =A0 =A0 =A0 =A0at org.apache.lucene.store.BufferedIndexInput.readBytes(B=
ufferedIndexInput.java:139)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.CompoundFileReader$CSIndexInpu=
t.readInternal(CompoundFileReader.java:257)
>> =A0 =A0 =A0 =A0at org.apache.lucene.store.BufferedIndexInput.refill(Buff=
eredIndexInput.java:160)
>> =A0 =A0 =A0 =A0at org.apache.lucene.store.BufferedIndexInput.readByte(Bu=
fferedIndexInput.java:39)
>> =A0 =A0 =A0 =A0at org.apache.lucene.store.IndexInput.readInt(IndexInput.=
java:74)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.FieldsReader.<init>(FieldsRead=
er.java:114)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.SegmentReader$CoreReaders.open=
DocStores(SegmentReader.java:294)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.SegmentReader.openDocStores(Se=
gmentReader.java:590)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter$ReaderPool.get(Ind=
exWriter.java:640)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter$ReaderPool.getRead=
OnlyClone(IndexWriter.java:591)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.DirectoryReader.<init>(Directo=
ryReader.java:138)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>=
(ReadOnlyDirectoryReader.java:36)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter.getReader(IndexWri=
ter.java:423)
>> =A0 =A0 =A0 =A0at org.apache.lucene.index.IndexWriter.getReader(IndexWri=
ter.java:387)
>>
>> Thanks,
>> Justin
>>
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45738-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 21:20:23 2010
Return-Path: <java-user-return-45738-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71188 invoked from network); 8 Apr 2010 21:20:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 21:20:23 -0000
Received: (qmail 23883 invoked by uid 500); 8 Apr 2010 21:20:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23847 invoked by uid 500); 8 Apr 2010 21:20:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23839 invoked by uid 99); 8 Apr 2010 21:20:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 21:20:20 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.79] (HELO web32902.mail.mud.yahoo.com) (209.191.69.79)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Apr 2010 21:20:13 +0000
Received: (qmail 59425 invoked by uid 60001); 8 Apr 2010 21:19:51 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270761591; bh=kNxL86hmYbebBM7tHWE00gupu5pyHUlJOoBHBKAaIZg=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=sksG810ozO46BwTy/lUDvl20BBtjtHgCP4H2bG6AwC1h1gcqXi15si5fZzmPfv+L+07MKFcjnS7FZGYInxbskix01b3VMjy3co4pO4wdtpzbKZsse+c0SufqOlovxPM9NNXdsfWcWUyrAaOI1NDqnM4GQ4ml3Tyr2zZaUUl98tY=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=aDvYevLbkpLKwBRFv8Z4zhOz2wNIFgjoY26rbKtjtRb8J7f7lpe4tyF/tj7MgF33bKH7FTp6ww9jVD8LiLwrx+3B7DhaS5RXxCyVfSwaug939vN9Y5hV/sxp64ntxuWU08QAvde6hl1tHYTu/BJaosHrJkBm5CrfDrObx0Qq1D4=;
Message-ID: <460972.59186.qm@web32902.mail.mud.yahoo.com>
X-YMail-OSG: tgkhYjgVM1kT4QGt9_6lZVDih7tXXOJf50wVpzgi.fy8fhS
 JblR6WNziwhXevMIWWTOMXoW3skNCAGt89frJYj3UuIg4xWv68ALBgWX1pyO
 Vm37wkQJLtS5SQKFs7HKFoqGoiQRuTNJ.8WPOPw7w985RmWVZw63ZTdnaogA
 nUMYfkpAZx3BjgpRbhkAY7LzcFjZkV19kpGPbYxYug.hhheAbhS0d9O28Zvk
 IMgKS9ihBY6RAscFBP3baM00iQWy6F9KVm3afK62SrnENMPll6WAW7AWVYmC
 bpdj9LK9o8XzXDtCh_XliPfvTRfY1jcpa.IErodLhJq2bjFjkGCpYV3HmXlx
 xWARNUOhYeKA-
Received: from [72.36.94.20] by web32902.mail.mud.yahoo.com via HTTP; Thu, 08 Apr 2010 14:19:51 PDT
X-Mailer: YahooMailRC/348.3 YahooMailWebService/0.8.100.260964
References: <11118.59029.qm@web32901.mail.mud.yahoo.com>  <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>  <463439.27658.qm@web32906.mail.mud.yahoo.com> <o2m9ac0c6aa1004081350z864f9555g90ec393d6c3a3974@mail.gmail.com>
Date: Thu, 8 Apr 2010 14:19:51 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: ClosedChannelException from IndexWriter.getReader()
To: java-user@lucene.apache.org
In-Reply-To: <o2m9ac0c6aa1004081350z864f9555g90ec393d6c3a3974@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

We have a custom IndexSearcher that fetches a near real-time reader and calls FieldCache.DEFAULT.getStrings() after a calculated length of time or when certain changes are made to the index (requiring immediate searchability).  The thread slept for that length of time unless an interrupt was given.  wait/notify should accomplish the same without interrupting NIOFSDirectory.




----- Original Message ----
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Sent: Thu, April 8, 2010 3:50:41 PM
Subject: Re: ClosedChannelException from IndexWriter.getReader()

OK, phew :)

Yea warming in a separate thread is common... but why does
Thread.interrupt() come into play in your app for warming?

Mike

On Thu, Apr 8, 2010 at 4:38 PM, Justin <crynax@yahoo.com> wrote:
> In fact, we are using Thread.interrupt() to warm up a searcher in a separate thread (not really that uncommon, is it?).  We may switch to Object::wait(long) and Object::notify() instead of switching the Directory implementation.  Thanks for recognizing the issue!
>
>
>
>
> ----- Original Message ----
> From: Michael McCandless <lucene@mikemccandless.com>
> To: java-user@lucene.apache.org
> Sent: Thu, April 8, 2010 2:41:07 PM
> Subject: Re: ClosedChannelException from IndexWriter.getReader()
>
> Are you using Future.cancel or directly using Thread.interrupt?  If so
> it could be this nasty issue:
>
>    https://issues.apache.org/jira/browse/LUCENE-2239
>
> Try temporarily using a Directory impl other than NIOFSDirectory and
> see if the problem still happens?
>
> Mike
>
> On Thu, Apr 8, 2010 at 2:14 PM, Justin <crynax@yahoo.com> wrote:
>> I'm getting a ClosedChannelException from IndexWriter.getReader().  I don't think the writer has been closed and, if it were, I would expect an AlreadyClosedException as described in the API documentation.  Does anyone have an idea what might be wrong?  The disk is not full and the permissions look correct.
>>
>> Here the stack trace from revision 926791:
>>
>> java.nio.channels.ClosedChannelException
>>        at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.java:88)
>>        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:613)
>>        at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.readInternal(NIOFSDirectory.java:150)
>>        at org.apache.lucene.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:139)
>>        at org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal(CompoundFileReader.java:257)
>>        at org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:160)
>>        at org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:39)
>>        at org.apache.lucene.store.IndexInput.readInt(IndexInput.java:74)
>>        at org.apache.lucene.index.FieldsReader.<init>(FieldsReader.java:114)
>>        at org.apache.lucene.index.SegmentReader$CoreReaders.openDocStores(SegmentReader.java:294)
>>        at org.apache.lucene.index.SegmentReader.openDocStores(SegmentReader.java:590)
>>        at org.apache.lucene.index.IndexWriter$ReaderPool.get(IndexWriter.java:640)
>>        at org.apache.lucene.index.IndexWriter$ReaderPool.getReadOnlyClone(IndexWriter.java:591)
>>        at org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:138)
>>        at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryReader.java:36)
>>        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:423)
>>        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:387)
>>
>> Thanks,
>> Justin
>>
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45739-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 21:50:08 2010
Return-Path: <java-user-return-45739-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78555 invoked from network); 8 Apr 2010 21:50:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 21:50:08 -0000
Received: (qmail 65227 invoked by uid 500); 8 Apr 2010 21:50:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65152 invoked by uid 500); 8 Apr 2010 21:50:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65137 invoked by uid 99); 8 Apr 2010 21:50:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 21:50:04 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 21:49:56 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id B015ED36006;
	Thu,  8 Apr 2010 23:49:36 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id EiMANK+86ih5; Thu,  8 Apr 2010 23:49:31 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 2E5F6D36005;
	Thu,  8 Apr 2010 23:49:30 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>,
	<java-dev@lucene.apache.org>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>	 <t2wf8d56a4d1004080023sbb0cbdl2f141a7fe950d835@mail.gmail.com>	 <007e01cad6ee$10c8dc40$325a94c0$@de>	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>	 <00c301cad702$d10a4ca0$731ee5e0$@de>	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>	 <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>	 <00fe01cad715$54c5ba90$fe512fb0$@de> <q2uf8d56a4d1004080550s6717849jbd4570de5f2c5817@mail.gmail.com>
In-Reply-To: <q2uf8d56a4d1004080550s6717849jbd4570de5f2c5817@mail.gmail.com>
Subject: RE: IndexWriter memory leak?
Date: Thu, 8 Apr 2010 23:49:32 +0200
Message-ID: <013601cad765$5fa5ca90$1ef15fb0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrXGicvKG9A90PFRJ2m0Nr23wclVQASuMlQ
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

There is one possibility, that could be fixed:

As Tokenizers are reused, the analyzer holds a reference to the last =
used Reader. The easy fix would be to unset the Reader in =
Tokenizer.close(). If this is the case for you, that may be easy to do. =
So Tokenizer.close() looks like this:

  /** By default, closes the input Reader. */
  @Override
  public void close() throws IOException {
    input.close();
    input =3D null; // <-- new!
  }

Any comments from other committers?

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> Sent: Thursday, April 08, 2010 2:50 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter memory leak?
>=20
> I will double check in the afternoon the heapdump.hprof. But I think
> that
> *some* readers are indeed held by
> docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx],
> as shown in [1] (this heapdump contains only live objects).  The
> heapdump
> was taken after IndexWriter.commit() /IndexWriter.optimize() and all
> the
> Documents were already indexed and GCed (I will double check).
>=20
> So that would mean that the Reader is retained in memory by the
> following
> chaing of references,
>=20
> DocumentsWriter -> DocumentsWriterThreadState ->
> DocFieldProcessorPerThread
> -> DocFieldProcessorPerField -> Fieldable -> Field (fieldsData)
>=20
> I'll double check with Eclipse MAT as I said that this chain is
> actually
> made of hard references only (no SoftReferences,WeakReferences, etc). =
I
> will
> also double check also that there is no "live" Document that is
> referencing
> the Reader via the Field.
>=20
>=20
> [1] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
>=20
> On Thu, Apr 8, 2010 at 2:16 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>=20
> > Readers are not held. If you indexed the document and gced the
> document
> > instance they readers are gone.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> > > Sent: Thursday, April 08, 2010 1:28 PM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: IndexWriter memory leak?
> > >
> > > Now that the zzBuffer issue is solved...
> > >
> > > what about the references to the Readers held by docWriter. =
Tika=C2=B4s
> > > ParsingReaders are quite heavyweight so retaining those in memory
> > > unnecesarily is also a "hidden" memory leak. Should I open a bug
> report
> > > on
> > > that one?
> > >
> > > /Rub=C3=A9n
> > >
> > > On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com>
> wrote:
> > >
> > > > Guess we were replying at the same time :).
> > > >
> > > > On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de>
> > > wrote:
> > > >
> > > > > I already answered, that I will take care of this!
> > > > >
> > > > > Uwe
> > > > >
> > > > > -----
> > > > > Uwe Schindler
> > > > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > > > http://www.thetaphi.de
> > > > > eMail: uwe@thetaphi.de
> > > > >
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: Shai Erera [mailto:serera@gmail.com]
> > > > > > Sent: Thursday, April 08, 2010 12:00 PM
> > > > > > To: java-user@lucene.apache.org
> > > > > > Subject: Re: IndexWriter memory leak?
> > > > > >
> > > > > > Yes, that's the trimBuffer version I was thinking about, =
only
> > > this guy
> > > > > > created a reset(Reader, int) and does both ops (resetting +
> trim)
> > > in
> > > > > > one
> > > > > > method call. More convenient. Can you please open an issue =
to
> > > track
> > > > > > that?
> > > > > > People will have a chance to comment on whether we (Lucene)
> > > should
> > > > > > handle
> > > > > > that, or it should be a JFlex fix. Based on the number of
> replies
> > > this
> > > > > > guy
> > > > > > received (0 !), I doubt JFlex would consider it a problem.
> But we
> > > can
> > > > > > do
> > > > > > some small service to our users base by protecting against
> such
> > > > > > problems.
> > > > > >
> > > > > > And while you're opening the issue, if you want to take a
> stab at
> > > > > > fixing it
> > > > > > and post a patch, it'd be great :).
> > > > > >
> > > > > > Shai
> > > > > >
> > > > > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> > > > > > <ruben.laguna@gmail.com>wrote:
> > > > > >
> > > > > > > I was investigating this a little further and in the JFlex
> > > mailing
> > > > > > list I
> > > > > > > found [1]
> > > > > > >
> > > > > > > I don't know much about flex / JFlex but it seems that =
this
> guy
> > > > > > resets the
> > > > > > > zzBuffer to 16384 or less when setting the input for the
> lexer
> > > > > > >
> > > > > > >
> > > > > > > Quoted from  shef <shef31@ya...>
> > > > > > >
> > > > > > >
> > > > > > > I set
> > > > > > >
> > > > > > > %buffer 0
> > > > > > >
> > > > > > > in the options section, and then added this method to the
> > > lexer:
> > > > > > >
> > > > > > >    /**
> > > > > > >     * Set the input for the lexer. The size parameter
> really
> > > speeds
> > > > > > things
> > > > > > > up,
> > > > > > >     * because by default, the lexer allocates an internal
> > > buffer of
> > > > > > 16k.
> > > > > > > For
> > > > > > >     * most strings, this is unnecessarily large. If the
> size
> > > param is
> > > > > > > 0 or greater
> > > > > > >     * than 16k, then the buffer is set to 16k. If the size
> > > param is
> > > > > > > smaller, then
> > > > > > >     * the buf will be set to the exact size.
> > > > > > >     * @param r the reader that provides the data
> > > > > > >     * @param the size of the data in the reader.
> > > > > > >     */
> > > > > > >    public void reset(Reader r, int size) {
> > > > > > >        if (size =3D=3D 0 || size > 16384)
> > > > > > >            size =3D 16384;
> > > > > > >        zzBuffer =3D new char[size];
> > > > > > >        yyreset(r);
> > > > > > >    }
> > > > > > >
> > > > > > >
> > > > > > > So maybe there is a way to trim the zzBuffer this way (?).
> > > > > > >
> > > > > > > BTW, I will try to find out which is the "big token" in my
> > > dataset
> > > > > > this
> > > > > > > afternoon. Thanks for the help.
> > > > > > >
> > > > > > > I actually workaround this memory problem for the time
> being by
> > > > > > wrapping
> > > > > > > the
> > > > > > > IndexWriter in a class that periodically closes the
> IndexWriter
> > > and
> > > > > > creates
> > > > > > > a new one, allowing the old to be GCed, but I would be
> really
> > > good if
> > > > > > > either
> > > > > > > JFlex or Lucene can take care of this zzBuffer going
> berserk.
> > > > > > >
> > > > > > >
> > > > > > > Again thanks for the quick response. /Rub=C3=A9n
> > > > > > >
> > > > > > >
> > > > > > > [1]
> > > > > > >
> > > > > > >
> > > > > >
> > > >
> > >
> =
https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.qm@=

> > > > > > web38901.mail.mud.yahoo.com
> > > > > > >
> > > > > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera
> <serera@gmail.com>
> > > > wrote:
> > > > > > >
> > > > > > > > If we could change the Flex file so that yyreset(Reader)
> > > would
> > > > > > check the
> > > > > > > > size of zzBuffer, we could trim it when it gets too big.
> But
> > > I
> > > > > > don't
> > > > > > > think
> > > > > > > > we have such control when writing the flex syntax ...
> yyreset
> > > is
> > > > > > > generated
> > > > > > > > by JFlex and that's the only place I can think of to =
trim
> the
> > > > > > buffer down
> > > > > > > > when it exceeds a predefined threshold ....
> > > > > > > >
> > > > > > > > Maybe what we can do is create our own method which will
> be
> > > called
> > > > > > by
> > > > > > > > StandardTokenizer after yyreset is called, something =
like
> > > > > > > > trimBufferIfTooBig(int threshold) which will reallocate
> > > zzBuffer if
> > > > > > it
> > > > > > > > exceeded the threshold. We can decide on a reasonable =
64K
> > > threshold
> > > > > > or
> > > > > > > > something, or simply always cut back to 16 KB. As far as
> I
> > > > > > understand,
> > > > > > > that
> > > > > > > > buffer should never grow that much. I.e. in zzRefill,
> which
> > > is the
> > > > > > only
> > > > > > > > place where the buffer gets resized, there is an attempt
> to
> > > first
> > > > > > move
> > > > > > > back
> > > > > > > > characters that were already consumed and only then
> allocate
> > > a
> > > > > > bigger
> > > > > > > > buffer. Which means only if there is a token whose size
> is
> > > larger
> > > > > > than
> > > > > > > 16KB
> > > > > > > > (!?), will this buffer get expanded.
> > > > > > > >
> > > > > > > > A trimBuffer method might not be that bad .. as a
> protective
> > > > > > measure.
> > > > > > > What
> > > > > > > > do you think? Of course, JFlex can fix it on their own
> ...
> > > but
> > > > > > until that
> > > > > > > > happens ...
> > > > > > > >
> > > > > > > > Shai
> > > > > > > >
> > > > > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler
> > > <uwe@thetaphi.de>
> > > > > > wrote:
> > > > > > > >
> > > > > > > > > > I would like to identify also the problematic
> document I
> > > have
> > > > > > 10000
> > > > > > > so,
> > > > > > > > > > what
> > > > > > > > > > would be the best way of identifying the one that it
> > > making
> > > > > > zzBuffer
> > > > > > > to
> > > > > > > > > > grow
> > > > > > > > > > without control?
> > > > > > > > >
> > > > > > > > > Dont index your documents, but instead pass them
> directly
> > > to the
> > > > > > > analyzer
> > > > > > > > > and consume the tokenstream manually. Then visit
> > > > > > > > TermAttribute.termLength()
> > > > > > > > > for each Token.
> > > > > > > > >
> > > > > > > > >
> > > > > > > > > =
-------------------------------------------------------
> ----
> > > ------
> > > > > > ----
> > > > > > > > > To unsubscribe, e-mail: java-user-
> > > unsubscribe@lucene.apache.org
> > > > > > > > > For additional commands, e-mail:
> > > > java-user-help@lucene.apache.org
> > > > > > > > >
> > > > > > > > >
> > > > > > > >
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > --
> > > > > > > /Rub=C3=A9n
> > > > > > >
> > > > >
> > > > >
> > > > > =
---------------------------------------------------------------
> ----
> > > --
> > > > > To unsubscribe, e-mail: =
java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail: java-user-
> help@lucene.apache.org
> > > > >
> > > > >
> > > >
> > >
> > >
> > >
> > > --
> > > /Rub=C3=A9n
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>=20
>=20
> --
> /Rub=C3=A9n


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45740-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 21:53:36 2010
Return-Path: <java-user-return-45740-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79271 invoked from network); 8 Apr 2010 21:53:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 21:53:36 -0000
Received: (qmail 71719 invoked by uid 500); 8 Apr 2010 21:53:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71680 invoked by uid 500); 8 Apr 2010 21:53:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71672 invoked by uid 99); 8 Apr 2010 21:53:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 21:53:34 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 21:53:29 +0000
Received: by fxm8 with SMTP id 8so2387497fxm.5
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 14:53:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=JbK/2PuMeBfTIWwVa3qgpuNNLffyDy0ZJKSfFJ0+m/c=;
        b=Ow7xRWLQKZ02G77mU+iIkHU+zF+FPNjwJNM4bwMs4yg1NBfTab5qK6zA7MgM1FXW4K
         MRVsURKWMYmAic6fis810srOZImlVXgwiKgEziVwos3rxTT4pqbCEYea0EUC8NwKHm0E
         dQ/sCPROwRCMSv14e80Hwl/s9KpbbcNlgI+Pg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        b=D+tfBmfqhY6nalaENc4tyYm1NjumlfjIl3KcpiqTHd+kz3FF72KYDoi3mcyoahh0iW
         puxwTZpWVrSfAP4o19SkTBQT/PxuwYbEHkxqyc61wVMITec4sHrUGz5YHryjDHIr8p+2
         haNZnAX3C3P52QMp1mRT3+zXuqm2nj+ItlLb8=
MIME-Version: 1.0
Received: by 10.239.191.139 with HTTP; Thu, 8 Apr 2010 14:53:08 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <460972.59186.qm@web32902.mail.mud.yahoo.com>
References: <11118.59029.qm@web32901.mail.mud.yahoo.com>
	 <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>
	 <463439.27658.qm@web32906.mail.mud.yahoo.com>
	 <o2m9ac0c6aa1004081350z864f9555g90ec393d6c3a3974@mail.gmail.com>
	 <460972.59186.qm@web32902.mail.mud.yahoo.com>
Date: Thu, 8 Apr 2010 23:53:08 +0200
Received: by 10.239.190.65 with SMTP id w1mr86921hbh.126.1270763588371; Thu, 
	08 Apr 2010 14:53:08 -0700 (PDT)
Message-ID: <n2nf18c9dde1004081453pb3600a7fyd47b18bf89f9e991@mail.gmail.com>
Subject: Re: ClosedChannelException from IndexWriter.getReader()
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Argh! one more running into this issue.

It still bugs me that NIOFSDirectory struggles so badly if interrupt is use=
d.

simon

On Thu, Apr 8, 2010 at 11:19 PM, Justin <crynax@yahoo.com> wrote:
> We have a custom IndexSearcher that fetches a near real-time reader and c=
alls FieldCache.DEFAULT.getStrings() after a calculated length of time or w=
hen certain changes are made to the index (requiring immediate searchabilit=
y). =C2=A0The thread slept for that length of time unless an interrupt was =
given. =C2=A0wait/notify should accomplish the same without interrupting NI=
OFSDirectory.
>
>
>
>
> ----- Original Message ----
> From: Michael McCandless <lucene@mikemccandless.com>
> To: java-user@lucene.apache.org
> Sent: Thu, April 8, 2010 3:50:41 PM
> Subject: Re: ClosedChannelException from IndexWriter.getReader()
>
> OK, phew :)
>
> Yea warming in a separate thread is common... but why does
> Thread.interrupt() come into play in your app for warming?
>
> Mike
>
> On Thu, Apr 8, 2010 at 4:38 PM, Justin <crynax@yahoo.com> wrote:
>> In fact, we are using Thread.interrupt() to warm up a searcher in a sepa=
rate thread (not really that uncommon, is it?). =C2=A0We may switch to Obje=
ct::wait(long) and Object::notify() instead of switching the Directory impl=
ementation. =C2=A0Thanks for recognizing the issue!
>>
>>
>>
>>
>> ----- Original Message ----
>> From: Michael McCandless <lucene@mikemccandless.com>
>> To: java-user@lucene.apache.org
>> Sent: Thu, April 8, 2010 2:41:07 PM
>> Subject: Re: ClosedChannelException from IndexWriter.getReader()
>>
>> Are you using Future.cancel or directly using Thread.interrupt? =C2=A0If=
 so
>> it could be this nasty issue:
>>
>> =C2=A0 =C2=A0https://issues.apache.org/jira/browse/LUCENE-2239
>>
>> Try temporarily using a Directory impl other than NIOFSDirectory and
>> see if the problem still happens?
>>
>> Mike
>>
>> On Thu, Apr 8, 2010 at 2:14 PM, Justin <crynax@yahoo.com> wrote:
>>> I'm getting a ClosedChannelException from IndexWriter.getReader(). =C2=
=A0I don't think the writer has been closed and, if it were, I would expect=
 an AlreadyClosedException as described in the API documentation. =C2=A0Doe=
s anyone have an idea what might be wrong? =C2=A0The disk is not full and t=
he permissions look correct.
>>>
>>> Here the stack trace from revision 926791:
>>>
>>> java.nio.channels.ClosedChannelException
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at sun.nio.ch.FileChannelImpl.ensureOpen(Fil=
eChannelImpl.java:88)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at sun.nio.ch.FileChannelImpl.read(FileChann=
elImpl.java:613)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.store.NIOFSDirectory$NI=
OFSIndexInput.readInternal(NIOFSDirectory.java:150)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.store.BufferedIndexInpu=
t.readBytes(BufferedIndexInput.java:139)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.CompoundFileReade=
r$CSIndexInput.readInternal(CompoundFileReader.java:257)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.store.BufferedIndexInpu=
t.refill(BufferedIndexInput.java:160)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.store.BufferedIndexInpu=
t.readByte(BufferedIndexInput.java:39)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.store.IndexInput.readIn=
t(IndexInput.java:74)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.FieldsReader.<ini=
t>(FieldsReader.java:114)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.SegmentReader$Cor=
eReaders.openDocStores(SegmentReader.java:294)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.SegmentReader.ope=
nDocStores(SegmentReader.java:590)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.IndexWriter$Reade=
rPool.get(IndexWriter.java:640)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.IndexWriter$Reade=
rPool.getReadOnlyClone(IndexWriter.java:591)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.DirectoryReader.<=
init>(DirectoryReader.java:138)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.ReadOnlyDirectory=
Reader.<init>(ReadOnlyDirectoryReader.java:36)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.IndexWriter.getRe=
ader(IndexWriter.java:423)
>>> =C2=A0 =C2=A0 =C2=A0 =C2=A0at org.apache.lucene.index.IndexWriter.getRe=
ader(IndexWriter.java:387)
>>>
>>> Thanks,
>>> Justin
>>>
>>>
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45741-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 22:19:01 2010
Return-Path: <java-user-return-45741-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85434 invoked from network); 8 Apr 2010 22:19:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 22:19:01 -0000
Received: (qmail 8553 invoked by uid 500); 8 Apr 2010 22:18:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8521 invoked by uid 500); 8 Apr 2010 22:18:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8507 invoked by uid 99); 8 Apr 2010 22:18:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 22:18:59 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.82] (HELO web32905.mail.mud.yahoo.com) (209.191.69.82)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Apr 2010 22:18:52 +0000
Received: (qmail 58533 invoked by uid 60001); 8 Apr 2010 22:18:30 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1270765110; bh=SQQLHRwhi/kkP34L1MjEjTj+qNCKzUQlI60h7lWfuBY=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=njtgShtgr1y/qEt3QMGDYreL1j/YljGlVVmA/crDg7W3daBBAWcXjK6mGYdf8wtDsdd3LtXnITGvciiNUxK+BSmBCh5eMO7Adp9XbLvmcqcOeMxz9KO3BiwHg7aLNnMH0OyUlvJQ5g/ydo10XHqLvrU7KQpuIIgLM6MUeFXyB18=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=Yqa3u6rR+prmJG6kc+rlmnPYAvinz3q6H/Y5snFjjrm4q2ZyRh2bUloMteBIpOmJRYRwSRG3WAHwZdGaXIEKRbt1MOQgx0pnSpW2Pj81ipKZZ8uEIM4gi2HCMbPSqRIEdmakGH7WE9u1XGbLiGQAkLWu/ZxN3UzFuVy/+utPi1M=;
Message-ID: <64855.57610.qm@web32905.mail.mud.yahoo.com>
X-YMail-OSG: sbbldF4VM1noNYu6.q1m2GVl98BHShW_D3mR7tfzetB6Qjp
 vvdVhkFKtZELLYmlPAeuXS3aBWkfjEa4AyWZyCQBBCJXve3leDwpc04_IU50
 nOIGtrAT_LXc0nid6jxeYZMfU0EGeUfTbuWS5EaG8DGcIh6tloXWwXlqJv7k
 C0ZsHVmAqF1Z.CfHIN5nrcuceTuhvTthbexAyElCAQk9hWj8IKTkgprmVjH3
 qVggrzt3_tFKNgFy_m5F0yZ5uUov7cvy7.fbdmF0VIrL.L7FVOFg0g6Vo81h
 ybm0EdU02QI60_ni9A0UxMLLMvLNTl4K.dkMSUQdx37SJ88Xpj_M7WiQzF7r
 lrAAIIkzeIM4byDmh42YbzJA2V7uePomNUK_Jmw--
Received: from [72.36.94.20] by web32905.mail.mud.yahoo.com via HTTP; Thu, 08 Apr 2010 15:18:29 PDT
X-Mailer: YahooMailRC/348.3 YahooMailWebService/0.8.100.260964
References: <11118.59029.qm@web32901.mail.mud.yahoo.com>  <v2k9ac0c6aa1004081241h6331cc10j9bc3a2eb910f7963@mail.gmail.com>  <463439.27658.qm@web32906.mail.mud.yahoo.com>  <o2m9ac0c6aa1004081350z864f9555g90ec393d6c3a3974@mail.gmail.com>  <460972.59186.qm@web32902.mail.mud.yahoo.com> <n2nf18c9dde1004081453pb3600a7fyd47b18bf89f9e991@mail.gmail.com>
Date: Thu, 8 Apr 2010 15:18:29 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: ClosedChannelException from IndexWriter.getReader()
To: java-user@lucene.apache.org
In-Reply-To: <n2nf18c9dde1004081453pb3600a7fyd47b18bf89f9e991@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

>From an architecture standpoint, wait/notify does require extra logic to catch any notify calls while a searcher is being replaced.  Using interrupt() was quite convenient at insuring the searcher was up-to-date.




----- Original Message ----
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Sent: Thu, April 8, 2010 4:53:08 PM
Subject: Re: ClosedChannelException from IndexWriter.getReader()

Argh! one more running into this issue.

It still bugs me that NIOFSDirectory struggles so badly if interrupt is used.

simon

On Thu, Apr 8, 2010 at 11:19 PM, Justin <crynax@yahoo.com> wrote:
> We have a custom IndexSearcher that fetches a near real-time reader and calls FieldCache.DEFAULT.getStrings() after a calculated length of time or when certain changes are made to the index (requiring immediate searchability).  The thread slept for that length of time unless an interrupt was given.  wait/notify should accomplish the same without interrupting NIOFSDirectory.
>
>
>
>
> ----- Original Message ----
> From: Michael McCandless <lucene@mikemccandless.com>
> To: java-user@lucene.apache.org
> Sent: Thu, April 8, 2010 3:50:41 PM
> Subject: Re: ClosedChannelException from IndexWriter.getReader()
>
> OK, phew :)
>
> Yea warming in a separate thread is common... but why does
> Thread.interrupt() come into play in your app for warming?
>
> Mike
>
> On Thu, Apr 8, 2010 at 4:38 PM, Justin <crynax@yahoo.com> wrote:
>> In fact, we are using Thread.interrupt() to warm up a searcher in a separate thread (not really that uncommon, is it?).  We may switch to Object::wait(long) and Object::notify() instead of switching the Directory implementation.  Thanks for recognizing the issue!
>>
>>
>>
>>
>> ----- Original Message ----
>> From: Michael McCandless <lucene@mikemccandless.com>
>> To: java-user@lucene.apache.org
>> Sent: Thu, April 8, 2010 2:41:07 PM
>> Subject: Re: ClosedChannelException from IndexWriter.getReader()
>>
>> Are you using Future.cancel or directly using Thread.interrupt?  If so
>> it could be this nasty issue:
>>
>>    https://issues.apache.org/jira/browse/LUCENE-2239
>>
>> Try temporarily using a Directory impl other than NIOFSDirectory and
>> see if the problem still happens?
>>
>> Mike
>>
>> On Thu, Apr 8, 2010 at 2:14 PM, Justin <crynax@yahoo.com> wrote:
>>> I'm getting a ClosedChannelException from IndexWriter.getReader().  I don't think the writer has been closed and, if it were, I would expect an AlreadyClosedException as described in the API documentation.  Does anyone have an idea what might be wrong?  The disk is not full and the permissions look correct.
>>>
>>> Here the stack trace from revision 926791:
>>>
>>> java.nio.channels.ClosedChannelException
>>>        at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.java:88)
>>>        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:613)
>>>        at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.readInternal(NIOFSDirectory.java:150)
>>>        at org.apache.lucene.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:139)
>>>        at org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal(CompoundFileReader.java:257)
>>>        at org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:160)
>>>        at org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:39)
>>>        at org.apache.lucene.store.IndexInput.readInt(IndexInput.java:74)
>>>        at org.apache.lucene.index.FieldsReader.<init>(FieldsReader.java:114)
>>>        at org.apache.lucene.index.SegmentReader$CoreReaders.openDocStores(SegmentReader.java:294)
>>>        at org.apache.lucene.index.SegmentReader.openDocStores(SegmentReader.java:590)
>>>        at org.apache.lucene.index.IndexWriter$ReaderPool.get(IndexWriter.java:640)
>>>        at org.apache.lucene.index.IndexWriter$ReaderPool.getReadOnlyClone(IndexWriter.java:591)
>>>        at org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:138)
>>>        at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryReader.java:36)
>>>        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:423)
>>>        at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:387)
>>>
>>> Thanks,
>>> Justin
>>>
>>>
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45742-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 08 23:55:42 2010
Return-Path: <java-user-return-45742-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98519 invoked from network); 8 Apr 2010 23:55:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Apr 2010 23:55:42 -0000
Received: (qmail 76721 invoked by uid 500); 8 Apr 2010 23:55:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76684 invoked by uid 500); 8 Apr 2010 23:55:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76676 invoked by uid 99); 8 Apr 2010 23:55:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 23:55:39 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.225] (HELO mail-gx0-f225.google.com) (209.85.217.225)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Apr 2010 23:55:32 +0000
Received: by gxk25 with SMTP id 25so351866gxk.11
        for <java-user@lucene.apache.org>; Thu, 08 Apr 2010 16:55:10 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Thu, 8 Apr 2010 16:55:10 -0700 (PDT)
In-Reply-To: <913098E0-DBE8-425A-85B0-5FB103F58E13@gmail.com>
References: <868426.64330.qm@web113309.mail.gq1.yahoo.com>
	 <913098E0-DBE8-425A-85B0-5FB103F58E13@gmail.com>
Date: Thu, 8 Apr 2010 19:55:10 -0400
Received: by 10.150.210.15 with SMTP id i15mr910984ybg.327.1270770910594; Thu, 
	08 Apr 2010 16:55:10 -0700 (PDT)
Message-ID: <o2y9ac0c6aa1004081655wb1d4ebe3q152c42bc11ed977b@mail.gmail.com>
Subject: Re: Lucene Partition Size
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Thu, Apr 8, 2010 at 2:44 PM, Karl Wettin <karl.wettin@gmail.com> wrote:
>
> 8 apr 2010 kl. 20.05 skrev Ivan Provalov:
>
>> We are using Lucene for searching of 200+ mln documents (periodical
>> publications). =A0Is there any limitation on the size of the Lucene inde=
x
>> (file size, number of docs, etc...)?
>
> The only such limitation in Lucene I'm aware of is Integer.MAX_VALUE
> documents. This might also be true for number of terms.

Actually max number of terms is 128 * MAX_INT (ie ~256 B).

That 128 is the terms index interval, so if you eg set the index
divisor to 2 it'll double the max number of terms.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45743-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 09 04:55:03 2010
Return-Path: <java-user-return-45743-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49724 invoked from network); 9 Apr 2010 04:55:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Apr 2010 04:55:03 -0000
Received: (qmail 77422 invoked by uid 500); 9 Apr 2010 04:55:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77095 invoked by uid 500); 9 Apr 2010 04:55:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77068 invoked by uid 99); 9 Apr 2010 04:54:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Apr 2010 04:54:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Apr 2010 04:54:52 +0000
Received: by wwb29 with SMTP id 29so181668wwb.35
        for <multiple recipients>; Thu, 08 Apr 2010 21:54:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:cc:content-type;
        bh=N9QisSP4eY3UikEeI8CkWWO8YunWz5X/GjHtJugrsdw=;
        b=DWDVYw0g8TNVeiYfMGhFwLaFuXYH2/GTVwPjr9zvjACEL9Ab8quTv/uHJ7CwTvUNeH
         SCovlgITggfDZ38izqQkYbjnBHFQqs/pjlIPMxI74w63pfOqhu11TRGiZgS1izvcN/ns
         LPO7X/mDzT/Y1TLpk44CiaKQaRKU+Kr/MJCrQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=uiq3jjh6cPgYlGkamiq4M6rhjAenlriGnfwdphAyibakmpEZjDo276qYlvn4rNLfJC
         h1wr1wU0kBrD70eURtUSb7G8u3mkpIR1I34vtPjCQy4xj7OQMgw1yDlYiJhKgpxT3g4z
         vLHbfPpNu3BZT3NkmxxjVXi4b05x2XiEiqgeM=
MIME-Version: 1.0
Received: by 10.216.53.200 with HTTP; Thu, 8 Apr 2010 21:54:31 -0700 (PDT)
In-Reply-To: <013601cad765$5fa5ca90$1ef15fb0$@de>
References: <t2mf8d56a4d1004071335m90081304iafea6f5ed1cf8ce@mail.gmail.com>
	 <l2s786fde51004080232qf4dc3564ifdcecd9d739f0136@mail.gmail.com>
	 <x2zf8d56a4d1004080251rf223c873gf99f5804b2f02a88@mail.gmail.com>
	 <t2q786fde51004080259qbc5501bbn5c0faf6a3bb5dd7d@mail.gmail.com>
	 <00c301cad702$d10a4ca0$731ee5e0$@de>
	 <q2r786fde51004080311ga61eb3e8u51fcb88a771f713d@mail.gmail.com>
	 <k2mf8d56a4d1004080427yc484e7e1zd4c9ce95923e98e8@mail.gmail.com>
	 <00fe01cad715$54c5ba90$fe512fb0$@de>
	 <q2uf8d56a4d1004080550s6717849jbd4570de5f2c5817@mail.gmail.com>
	 <013601cad765$5fa5ca90$1ef15fb0$@de>
Date: Fri, 9 Apr 2010 06:54:31 +0200
Received: by 10.216.86.209 with SMTP id w59mr539496wee.186.1270788871414; Thu, 
	08 Apr 2010 21:54:31 -0700 (PDT)
Message-ID: <m2if8d56a4d1004082154keb9b1f27n5015e16e08768ad7@mail.gmail.com>
Subject: Re: IndexWriter memory leak?
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Cc: java-dev@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d644c943e3de0483c69756
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d644c943e3de0483c69756
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

But the Readers I'm talking about are not held by the Tokenizer (at least
not *only* by it), these are held by the DocFieldProccessorPerThread....

IndexWriter -> DocumentsWriter -> DocumentsWriterThreadState ->
DocFieldProcessorPerThread -> DocFieldProcessorPerField -> Fieldable ->
Field (fieldsData)

and it's not only one Reader there are several one (one per thread I
suppose, in my heapdump there is 25 Reader that should have been GCed
otherwise).

Best regards/Ruben
On Thu, Apr 8, 2010 at 11:49 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> There is one possibility, that could be fixed:
>
> As Tokenizers are reused, the analyzer holds a reference to the last used
> Reader. The easy fix would be to unset the Reader in Tokenizer.close(). I=
f
> this is the case for you, that may be easy to do. So Tokenizer.close() lo=
oks
> like this:
>
>  /** By default, closes the input Reader. */
>  @Override
>  public void close() throws IOException {
>    input.close();
>    input =3D null; // <-- new!
>  }
>
> Any comments from other committers?
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> > Sent: Thursday, April 08, 2010 2:50 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: IndexWriter memory leak?
> >
> > I will double check in the afternoon the heapdump.hprof. But I think
> > that
> > *some* readers are indeed held by
> > docWriter.threadStates[0].consumer.fieldHash[1].fields[xxxx],
> > as shown in [1] (this heapdump contains only live objects).  The
> > heapdump
> > was taken after IndexWriter.commit() /IndexWriter.optimize() and all
> > the
> > Documents were already indexed and GCed (I will double check).
> >
> > So that would mean that the Reader is retained in memory by the
> > following
> > chaing of references,
> >
> > DocumentsWriter -> DocumentsWriterThreadState ->
> > DocFieldProcessorPerThread
> > -> DocFieldProcessorPerField -> Fieldable -> Field (fieldsData)
> >
> > I'll double check with Eclipse MAT as I said that this chain is
> > actually
> > made of hard references only (no SoftReferences,WeakReferences, etc). I
> > will
> > also double check also that there is no "live" Document that is
> > referencing
> > the Reader via the Field.
> >
> >
> > [1] http://img.skitch.com/20100407-b86irkp7e4uif2wq1dd4t899qb.jpg
> >
> > On Thu, Apr 8, 2010 at 2:16 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> >
> > > Readers are not held. If you indexed the document and gced the
> > document
> > > instance they readers are gone.
> > >
> > > -----
> > > Uwe Schindler
> > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > http://www.thetaphi.de
> > > eMail: uwe@thetaphi.de
> > >
> > >
> > > > -----Original Message-----
> > > > From: Ruben Laguna [mailto:ruben.laguna@gmail.com]
> > > > Sent: Thursday, April 08, 2010 1:28 PM
> > > > To: java-user@lucene.apache.org
> > > > Subject: Re: IndexWriter memory leak?
> > > >
> > > > Now that the zzBuffer issue is solved...
> > > >
> > > > what about the references to the Readers held by docWriter. Tika=C2=
=B4s
> > > > ParsingReaders are quite heavyweight so retaining those in memory
> > > > unnecesarily is also a "hidden" memory leak. Should I open a bug
> > report
> > > > on
> > > > that one?
> > > >
> > > > /Rub=C3=A9n
> > > >
> > > > On Thu, Apr 8, 2010 at 12:11 PM, Shai Erera <serera@gmail.com>
> > wrote:
> > > >
> > > > > Guess we were replying at the same time :).
> > > > >
> > > > > On Thu, Apr 8, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de>
> > > > wrote:
> > > > >
> > > > > > I already answered, that I will take care of this!
> > > > > >
> > > > > > Uwe
> > > > > >
> > > > > > -----
> > > > > > Uwe Schindler
> > > > > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > > > > http://www.thetaphi.de
> > > > > > eMail: uwe@thetaphi.de
> > > > > >
> > > > > >
> > > > > > > -----Original Message-----
> > > > > > > From: Shai Erera [mailto:serera@gmail.com]
> > > > > > > Sent: Thursday, April 08, 2010 12:00 PM
> > > > > > > To: java-user@lucene.apache.org
> > > > > > > Subject: Re: IndexWriter memory leak?
> > > > > > >
> > > > > > > Yes, that's the trimBuffer version I was thinking about, only
> > > > this guy
> > > > > > > created a reset(Reader, int) and does both ops (resetting +
> > trim)
> > > > in
> > > > > > > one
> > > > > > > method call. More convenient. Can you please open an issue to
> > > > track
> > > > > > > that?
> > > > > > > People will have a chance to comment on whether we (Lucene)
> > > > should
> > > > > > > handle
> > > > > > > that, or it should be a JFlex fix. Based on the number of
> > replies
> > > > this
> > > > > > > guy
> > > > > > > received (0 !), I doubt JFlex would consider it a problem.
> > But we
> > > > can
> > > > > > > do
> > > > > > > some small service to our users base by protecting against
> > such
> > > > > > > problems.
> > > > > > >
> > > > > > > And while you're opening the issue, if you want to take a
> > stab at
> > > > > > > fixing it
> > > > > > > and post a patch, it'd be great :).
> > > > > > >
> > > > > > > Shai
> > > > > > >
> > > > > > > On Thu, Apr 8, 2010 at 12:51 PM, Ruben Laguna
> > > > > > > <ruben.laguna@gmail.com>wrote:
> > > > > > >
> > > > > > > > I was investigating this a little further and in the JFlex
> > > > mailing
> > > > > > > list I
> > > > > > > > found [1]
> > > > > > > >
> > > > > > > > I don't know much about flex / JFlex but it seems that this
> > guy
> > > > > > > resets the
> > > > > > > > zzBuffer to 16384 or less when setting the input for the
> > lexer
> > > > > > > >
> > > > > > > >
> > > > > > > > Quoted from  shef <shef31@ya...>
> > > > > > > >
> > > > > > > >
> > > > > > > > I set
> > > > > > > >
> > > > > > > > %buffer 0
> > > > > > > >
> > > > > > > > in the options section, and then added this method to the
> > > > lexer:
> > > > > > > >
> > > > > > > >    /**
> > > > > > > >     * Set the input for the lexer. The size parameter
> > really
> > > > speeds
> > > > > > > things
> > > > > > > > up,
> > > > > > > >     * because by default, the lexer allocates an internal
> > > > buffer of
> > > > > > > 16k.
> > > > > > > > For
> > > > > > > >     * most strings, this is unnecessarily large. If the
> > size
> > > > param is
> > > > > > > > 0 or greater
> > > > > > > >     * than 16k, then the buffer is set to 16k. If the size
> > > > param is
> > > > > > > > smaller, then
> > > > > > > >     * the buf will be set to the exact size.
> > > > > > > >     * @param r the reader that provides the data
> > > > > > > >     * @param the size of the data in the reader.
> > > > > > > >     */
> > > > > > > >    public void reset(Reader r, int size) {
> > > > > > > >        if (size =3D=3D 0 || size > 16384)
> > > > > > > >            size =3D 16384;
> > > > > > > >        zzBuffer =3D new char[size];
> > > > > > > >        yyreset(r);
> > > > > > > >    }
> > > > > > > >
> > > > > > > >
> > > > > > > > So maybe there is a way to trim the zzBuffer this way (?).
> > > > > > > >
> > > > > > > > BTW, I will try to find out which is the "big token" in my
> > > > dataset
> > > > > > > this
> > > > > > > > afternoon. Thanks for the help.
> > > > > > > >
> > > > > > > > I actually workaround this memory problem for the time
> > being by
> > > > > > > wrapping
> > > > > > > > the
> > > > > > > > IndexWriter in a class that periodically closes the
> > IndexWriter
> > > > and
> > > > > > > creates
> > > > > > > > a new one, allowing the old to be GCed, but I would be
> > really
> > > > good if
> > > > > > > > either
> > > > > > > > JFlex or Lucene can take care of this zzBuffer going
> > berserk.
> > > > > > > >
> > > > > > > >
> > > > > > > > Again thanks for the quick response. /Rub=C3=A9n
> > > > > > > >
> > > > > > > >
> > > > > > > > [1]
> > > > > > > >
> > > > > > > >
> > > > > > >
> > > > >
> > > >
> > https://sourceforge.net/mailarchive/message.php?msg_id=3D444070.38422.q=
m@
> > > > > > > web38901.mail.mud.yahoo.com
> > > > > > > >
> > > > > > > > On Thu, Apr 8, 2010 at 11:32 AM, Shai Erera
> > <serera@gmail.com>
> > > > > wrote:
> > > > > > > >
> > > > > > > > > If we could change the Flex file so that yyreset(Reader)
> > > > would
> > > > > > > check the
> > > > > > > > > size of zzBuffer, we could trim it when it gets too big.
> > But
> > > > I
> > > > > > > don't
> > > > > > > > think
> > > > > > > > > we have such control when writing the flex syntax ...
> > yyreset
> > > > is
> > > > > > > > generated
> > > > > > > > > by JFlex and that's the only place I can think of to trim
> > the
> > > > > > > buffer down
> > > > > > > > > when it exceeds a predefined threshold ....
> > > > > > > > >
> > > > > > > > > Maybe what we can do is create our own method which will
> > be
> > > > called
> > > > > > > by
> > > > > > > > > StandardTokenizer after yyreset is called, something like
> > > > > > > > > trimBufferIfTooBig(int threshold) which will reallocate
> > > > zzBuffer if
> > > > > > > it
> > > > > > > > > exceeded the threshold. We can decide on a reasonable 64K
> > > > threshold
> > > > > > > or
> > > > > > > > > something, or simply always cut back to 16 KB. As far as
> > I
> > > > > > > understand,
> > > > > > > > that
> > > > > > > > > buffer should never grow that much. I.e. in zzRefill,
> > which
> > > > is the
> > > > > > > only
> > > > > > > > > place where the buffer gets resized, there is an attempt
> > to
> > > > first
> > > > > > > move
> > > > > > > > back
> > > > > > > > > characters that were already consumed and only then
> > allocate
> > > > a
> > > > > > > bigger
> > > > > > > > > buffer. Which means only if there is a token whose size
> > is
> > > > larger
> > > > > > > than
> > > > > > > > 16KB
> > > > > > > > > (!?), will this buffer get expanded.
> > > > > > > > >
> > > > > > > > > A trimBuffer method might not be that bad .. as a
> > protective
> > > > > > > measure.
> > > > > > > > What
> > > > > > > > > do you think? Of course, JFlex can fix it on their own
> > ...
> > > > but
> > > > > > > until that
> > > > > > > > > happens ...
> > > > > > > > >
> > > > > > > > > Shai
> > > > > > > > >
> > > > > > > > > On Thu, Apr 8, 2010 at 10:35 AM, Uwe Schindler
> > > > <uwe@thetaphi.de>
> > > > > > > wrote:
> > > > > > > > >
> > > > > > > > > > > I would like to identify also the problematic
> > document I
> > > > have
> > > > > > > 10000
> > > > > > > > so,
> > > > > > > > > > > what
> > > > > > > > > > > would be the best way of identifying the one that it
> > > > making
> > > > > > > zzBuffer
> > > > > > > > to
> > > > > > > > > > > grow
> > > > > > > > > > > without control?
> > > > > > > > > >
> > > > > > > > > > Dont index your documents, but instead pass them
> > directly
> > > > to the
> > > > > > > > analyzer
> > > > > > > > > > and consume the tokenstream manually. Then visit
> > > > > > > > > TermAttribute.termLength()
> > > > > > > > > > for each Token.
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > > > -------------------------------------------------------
> > ----
> > > > ------
> > > > > > > ----
> > > > > > > > > > To unsubscribe, e-mail: java-user-
> > > > unsubscribe@lucene.apache.org
> > > > > > > > > > For additional commands, e-mail:
> > > > > java-user-help@lucene.apache.org
> > > > > > > > > >
> > > > > > > > > >
> > > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > --
> > > > > > > > /Rub=C3=A9n
> > > > > > > >
> > > > > >
> > > > > >
> > > > > > ---------------------------------------------------------------
> > ----
> > > > --
> > > > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > > > For additional commands, e-mail: java-user-
> > help@lucene.apache.org
> > > > > >
> > > > > >
> > > > >
> > > >
> > > >
> > > >
> > > > --
> > > > /Rub=C3=A9n
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> >
> > --
> > /Rub=C3=A9n
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


--=20
/Rub=C3=A9n

--0016e6d644c943e3de0483c69756--

From java-user-return-45744-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 09 13:39:38 2010
Return-Path: <java-user-return-45744-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50392 invoked from network); 9 Apr 2010 13:39:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Apr 2010 13:39:38 -0000
Received: (qmail 3452 invoked by uid 500); 9 Apr 2010 13:39:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3393 invoked by uid 500); 9 Apr 2010 13:39:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3385 invoked by uid 99); 9 Apr 2010 13:39:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Apr 2010 13:39:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.221 as permitted sender)
Received: from [209.85.219.221] (HELO mail-ew0-f221.google.com) (209.85.219.221)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Apr 2010 13:39:26 +0000
Received: by ewy21 with SMTP id 21so1266791ewy.5
        for <java-user@lucene.apache.org>; Fri, 09 Apr 2010 06:39:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=aGI5I3m3374+xWLkYMwHgkSLOW0BfNYeDj/x+MFsZhM=;
        b=OPKHN2e7AdeODu4QAXdiTHc9g8dRA9N1LhViMQGwrRSBS3e42eJM3lMnFhMIExnijN
         VVJugdX09b+bfP1NNR+tAL2gVqviDA3noeSFvfkUMFStCM717Mw3dK1v8HVNlhJogj7S
         yXMqWiAraAIWbiA0t4ehFyy3EmXrNgWdgSqr0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=n2hqvKLa5xAqV8vuHmqhDPbKU7VIXVM/B/a7oHRxPXOdwzF3Jp9zE+qeDEm56nxoa9
         JcbyIkC5YwOiHQWeVoLBCRNX4EZ1pgEIFBomPQHEEdbGUAe3TB48ok6SXXFGNzGIndec
         PiOIAd7J8XBFkt4Rqmit2H7sE1BgPHz4T5sCg=
Received: by 10.213.82.141 with SMTP id b13mr402420ebl.96.1270820346243;
        Fri, 09 Apr 2010 06:39:06 -0700 (PDT)
Received: from [10.0.25.6] (95-36-32-119.dsl.alice.nl [95.36.32.119])
        by mx.google.com with ESMTPS id 14sm746351ewy.6.2010.04.09.06.39.04
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 09 Apr 2010 06:39:05 -0700 (PDT)
Message-Id: <0D85DA93-9AC1-4DF1-94E9-B330D5051399@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <969295.47343.qm@web113311.mail.gq1.yahoo.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Lucene Partition Size
Date: Fri, 9 Apr 2010 15:39:02 +0200
References: <969295.47343.qm@web113311.mail.gq1.yahoo.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

It's hard for me to say why this is slow.

Here are a few more questions whose anwers might provide further clues:

What was the reasons that led you to partition the index this way?
What does the searcher implementation look like?
What would a typcial query sent to that searcher look like?

I would start by loading the full 400Gb as a single index on local disc.


	karl

8 apr 2010 kl. 22.07 skrev Ivan Provalov:

> Karl,
>
> We have not done the same scale local-disk test.  Our network  
> parameters are
>
> -  Network speed:  1gb
> -  3 partitions per volume
> -  The volumes are accessed via NFS to EMC Celera devices. (NFS 3)
> -  The drives are 300 gb fiber attached with 10,000 rpm.
>
> Thanks,
>
> Ivan
>
> --- On Thu, 4/8/10, Karl Wettin <karl.wettin@gmail.com> wrote:
>
>> From: Karl Wettin <karl.wettin@gmail.com>
>> Subject: Re: Lucene Partition Size
>> To: java-user@lucene.apache.org
>> Date: Thursday, April 8, 2010, 2:44 PM
>>
>> 8 apr 2010 kl. 20.05 skrev Ivan Provalov:
>>
>>> We are using Lucene for searching of 200+ mln
>> documents (periodical publications).  Is there any
>> limitation on the size of the Lucene index (file size,
>> number of docs, etc...)?
>>
>> The only such limitation in Lucene I'm aware of is
>> Integer.MAX_VALUE documents. This might also be true for
>> number of terms.
>>
>>> We are partitioning the indexes at about 10 mln
>> documents per partition (each partition is on a separate
>> box, some mounted volumes are shared among three-four
>> partitions).  We have index size around 10% of the
>> content size.  The total content is around 4Tb and the
>> index around 400Gb.  This content is planned to be
>> split into 20 partitions (10mln docs, 200Gb content size,
>> 20Gb index size).  We are using a memory mapped index
>> directory implementation.  Our testing is done with 600
>> concurrent users.
>>>
>>> We are seeing consistently high response times from
>> the partitions (4-5 seconds).  Is there a number of
>> documents per partition limitation in Lucene for this
>> particular scenario?
>>
>> I'm not sure if I got this right but it sounds like your
>> index is mounted over network? Can you tell us some more
>> details about that? What speeds do you see if you put the
>> index on local disc?
>>
>>
>>
>>     karl
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45745-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 10 00:25:52 2010
Return-Path: <java-user-return-45745-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22556 invoked from network); 10 Apr 2010 00:25:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Apr 2010 00:25:52 -0000
Received: (qmail 16954 invoked by uid 500); 10 Apr 2010 00:25:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16898 invoked by uid 500); 10 Apr 2010 00:25:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16890 invoked by uid 99); 10 Apr 2010 00:25:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 00:25:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of railan.xisto@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 00:25:43 +0000
Received: by bwz22 with SMTP id 22so2915040bwz.5
        for <java-user@lucene.apache.org>; Fri, 09 Apr 2010 17:25:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=41CjNT093tK/LRkTPPKvxhmc108RsHowoOZzfE/sorg=;
        b=Zs+RgvzHW88JE3R6jf8D6QDGThkl67tNTsoXY975t1iOh7l74vSXKYf59uXfFrmRGI
         jDQEyeYyOCPDsz0DzBCHq1aDLIP0Uo7J3QDB5RnynKj8FXK8HqB2cix6VHVdKD7T60Sp
         xTeihC7sXvgjYAYxtsrUuCXQtr0qc0T82+v60=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=IyRxI/F5Lr6XLJyTrqULeuIYRCVPlFfD4kxsPQrRAf44JWQRqLdz8RUiULW1AvGo9O
         v1FQ2D0pKHWL1Aofhl0LoJe0QFAqtniBDKdQDZlShKPwwJffPcv1MXR9p/Wo5GVnoW2e
         D3AZnsNVR1vX3Dy52TC1H8zptjr/yjqj9f1QE=
MIME-Version: 1.0
Received: by 10.204.15.1 with HTTP; Fri, 9 Apr 2010 17:25:21 -0700 (PDT)
Date: Fri, 9 Apr 2010 21:25:21 -0300
Received: by 10.204.9.152 with SMTP id l24mr811642bkl.193.1270859122019; Fri, 
	09 Apr 2010 17:25:22 -0700 (PDT)
Message-ID: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
Subject: Removing terms in the Index
From: Fotos fotos <railan.xisto@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015175883c8870ef90483d6f29d

--0015175883c8870ef90483d6f29d
Content-Type: text/plain; charset=ISO-8859-1

Hello!
I am a beginner with Lucene. I'm needing to do the following:

I have a text file with the following terms:

"Lucene in action"
"Lucene"

and a file with the following sentences:

1 - "Lucene in action now."
2 - "Lucene for Dummies"
3 - "Managing Gigabytes"

I need to search in phrases of doc2, the terms of doc1.

But in search of the word n-grama: "Lucene in Action", he also finds the 2nd
sentence.

In this case, I want to meet with the term 1 ("Lucene in Action"), only the
first phrase and remove the term of the index, for not to be found when I
pass the term 2 ("Lucene")

Railan Xisto
Web Developer

--0015175883c8870ef90483d6f29d--

From java-user-return-45746-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 10 00:50:39 2010
Return-Path: <java-user-return-45746-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24648 invoked from network); 10 Apr 2010 00:50:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Apr 2010 00:50:39 -0000
Received: (qmail 28238 invoked by uid 500); 10 Apr 2010 00:50:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28187 invoked by uid 500); 10 Apr 2010 00:50:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28178 invoked by uid 99); 10 Apr 2010 00:50:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 00:50:37 +0000
X-ASF-Spam-Status: No, hits=1.4 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ewhauser@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 00:50:31 +0000
Received: by vws9 with SMTP id 9so1943980vws.35
        for <java-user@lucene.apache.org>; Fri, 09 Apr 2010 17:50:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:from:date:received
         :message-id:subject:to:content-type;
        bh=9mc19dgwG5GX5DQL0iuCGQPQn3XVOeHbjbt5jSY0ziU=;
        b=brQrLWbDO2Ck9EoF/pFd7uxyyZw9QE+3lYmSL6QU23OYA865LHcpq2VdYw3qPHw3/8
         y11Bp+nB9pFLLqcf0KWllZBFi5rI1Xt/zHaSl2aCZVWSJYNHkkILPunAzJ2fkkZEexXT
         0pw+L7cjKjeNqJKA3XyxoSbZcIF1WJO9C0EBQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=QgoD8vI4FYyVA0K5JLn6znzrgMEuVDB67ui2sEKZ4csNyrPYRhqEFMj7/oB18RepIS
         xbCNF69qMqEgYqeMn3hc4838BHUC4uQmnDe8aUvtXsX7yf2+QpPT+FxrUoAQ03/iKjGF
         JYmLHr7A8TBC3b85JNR0D0SX3IeCGZjk3bCEk=
MIME-Version: 1.0
Received: by 10.220.19.14 with HTTP; Fri, 9 Apr 2010 17:49:50 -0700 (PDT)
From: Eric Hauser <ewhauser@gmail.com>
Date: Fri, 9 Apr 2010 20:49:50 -0400
Received: by 10.220.4.23 with SMTP id 23mr504233vcp.71.1270860610134; Fri, 09 
	Apr 2010 17:50:10 -0700 (PDT)
Message-ID: <j2h2b4765e71004091749r8c65eeaajaafd8d6360ce4bb9@mail.gmail.com>
Subject: Indexing documents generated from a template
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517576f3639e3040483d74b0b

--001517576f3639e3040483d74b0b
Content-Type: text/plain; charset=ISO-8859-1

Hi,

I'm doing research on indexing some documents that are generated from
templates.  I don't have the exact statistics yet, but I'm estimating that
in the standard case 90% of the document is the same across all instances of
the document and the other 10% is dynamic (although it is certainly possible
for it to be 10/90).  Because these documents can be rather large in size
and there could potentially be millions of instances of a single document, I
don't want to put every instance of the document into the index.

What (I think) I would like to do is index the template and the dynamic
content separately, and then merge the search results afterwards.  This does
not seem too difficult; except for when a query spans both the template and
dynamic content.  Also, things like proximity queries would be difficult.
 In theory, it would seem plausible to split the terms of the original
search, search both indexes in parallel, rebuild the document, build an in
memory index of merged document, and run the original search against it.
 Most of the searches are going to be "online" meaning that a Hadoop job
probably isn't appropriate.

I am working on compiler better statistics on the standard deviation for
static to dynamic content, but in the meantime I was just curious if anyone
else has dealt with a similar scenario or had something to point me at for
additional research.  Thanks.

--001517576f3639e3040483d74b0b--

From java-user-return-45747-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 10 03:23:33 2010
Return-Path: <java-user-return-45747-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37630 invoked from network); 10 Apr 2010 03:23:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Apr 2010 03:23:33 -0000
Received: (qmail 71900 invoked by uid 500); 10 Apr 2010 03:23:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71648 invoked by uid 500); 10 Apr 2010 03:23:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71640 invoked by uid 99); 10 Apr 2010 03:23:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 03:23:30 +0000
X-ASF-Spam-Status: No, hits=1.8 required=10.0
	tests=AWL,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.208.4.194] (HELO mout.perfora.net) (74.208.4.194)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 03:23:23 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus0) with ESMTP (Nemesis)
	id 0LdpHv-1NHRV128ln-00iMym; Fri, 09 Apr 2010 23:23:02 -0400
Message-ID: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Subject: java.lang.OutOfMemoryError: GC overhead limit exceeded
Date: Fri, 9 Apr 2010 20:23:04 -0700
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_431A_01CAD822.753B2AE0"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX18AdR4HZIqBmiI0fzjhcLoPFCi4VGiGzbNi6In
 4wlB/pvi3LdrWqksya9ECjzxJT4J/O6SFLBtCSVp0g2ccsmOEK
 S4xOnZHnyIvzPOdSZNLBA==

------=_NextPart_000_431A_01CAD822.753B2AE0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

Hi, folks.
I am using PyLucene and doing a lot of get tokens.  lucene.py reports =
version 2.4.0.  It is rpath linux with 8GB of memory.  Python is 2.4.
I'm not sure what the maxheap is, I think that it is maxheap=3D'2048m'.  =
I think that it's running in a 64 bit environment.
It indexes a set of 116,000 documents just fine.
Then I need to get the tokens from these documents and near the end, I =
run into:

java.lang.OutOfMemoryError: GC overhead limit exceeded

If I wait a bit and ask again for the same document's tokens, I can get =
them, but it then is somewhat likely to post the same error on a certain =
number of other documents.  I can handle these errors and ask again.

I have read that this error message means that the heap is getting =
filled up and garbage collection removes only a small amount of it.  =
Since all I am doing is retrieving, why should the heap be filling up?  =
I restarted the system before starting the retrieval.

My guess is that there is some small memory leak because memory assigned =
to my python program grows slowly as I request more document tokens.  =
Since I'm not intending to change anything in either my python program =
or in Lucene, any growth is unintentional.  I'm just getting tokens.

 we use lucene.TermQuery as the query object to get the terms.

I cannot share the documents nor the application code, but I might be =
able to provide snippets.

One last piece of information, the time needed to retrieve documents =
slows throughout the process.  In the beginning I was getting about 10 =
documents per second.  Towards the end, it is down to about 5 with about =
5 second pauses from time to time, perhaps due to garbage collection?

Any idea of why the heap is filling up and what I can do about it?

Thanks,
Herb



------=_NextPart_000_431A_01CAD822.753B2AE0--


From java-user-return-45748-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 10 04:26:59 2010
Return-Path: <java-user-return-45748-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42020 invoked from network); 10 Apr 2010 04:26:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Apr 2010 04:26:58 -0000
Received: (qmail 86817 invoked by uid 500); 10 Apr 2010 04:26:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86704 invoked by uid 500); 10 Apr 2010 04:26:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86689 invoked by uid 99); 10 Apr 2010 04:26:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 04:26:54 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ruben.laguna@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 04:26:48 +0000
Received: by bwz22 with SMTP id 22so2954697bwz.5
        for <java-user@lucene.apache.org>; Fri, 09 Apr 2010 21:26:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=XupuR4E5ms5fKRbvKJIXW1x5x1w8y0A3TvlIVwsPzBo=;
        b=uJTiQKFs/qA61kTB11xLPGjyu9WSEiiiqfZ6b2zw8prwOhFKj4rQ0M91ibNHD71fuk
         Axan50ZHoFXNqH+oVZcKD84plPNwk1RdTR2a7HUVStASoc2z9BSGItnbzjufLorJ68Pw
         Lxk9jl8AwUu55ZXEHQR11vGNxmzRX/MRKfNP8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=pvs/6nt3lb5Nls7sB6VmfQLmCyDzJgq/RkbL8hGGIwY/LmWSgkVON9gL/X+FNIQY33
         JhX2SCU6BdKbSF6oq2dZzWYnsL+9NWhO8/BvUbbZDFbX92jJnnCMh1EWT5J5DPdp0JHQ
         UsYx8VuSWQ09j9auqC9Vi4gK7EowQDD8FnZp4=
MIME-Version: 1.0
Received: by 10.204.60.133 with HTTP; Fri, 9 Apr 2010 21:26:28 -0700 (PDT)
In-Reply-To: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
Date: Sat, 10 Apr 2010 06:26:28 +0200
Received: by 10.204.32.201 with SMTP id e9mr1087937bkd.47.1270873588233; Fri, 
	09 Apr 2010 21:26:28 -0700 (PDT)
Message-ID: <s2lf8d56a4d1004092126i9289a2aeidc2378fda39ae054@mail.gmail.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
From: Ruben Laguna <ruben.laguna@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Take a memory snapshot with JConsole -> dumpHeap [1] and the analyze
it with Eclipse MAT [2]. Find the biggest objects and look at their
path to GC roots to see if lucene is actually retaining them. You may
also want to look to two recently closed bug reports about memory
leaks [3] and [4]

[1]=C2=A0http://java.sun.com/developer/technicalArticles/J2SE/monitoring/
[2]=C2=A0http://www.eclipse.org/mat/
[3]=C2=A0https://issues.apache.org/jira/browse/LUCENE-2387
[4]=C2=A0https://issues.apache.org/jira/browse/LUCENE-2384

On Sat, Apr 10, 2010 at 5:23 AM, Herbert Roitblat <herb@orcatec.com> wrote:
>
> Hi, folks.
> I am using PyLucene and doing a lot of get tokens. =C2=A0lucene.py report=
s version 2.4.0. =C2=A0It is rpath linux with 8GB of memory. =C2=A0Python i=
s 2.4.
> I'm not sure what the maxheap is, I think that it is maxheap=3D'2048m'. =
=C2=A0I think that it's running in a 64 bit environment.
> It indexes a set of 116,000 documents just fine.
> Then I need to get the tokens from these documents and near the end, I ru=
n into:
>
> java.lang.OutOfMemoryError: GC overhead limit exceeded
>
> If I wait a bit and ask again for the same document's tokens, I can get t=
hem, but it then is somewhat likely to post the same error on a certain num=
ber of other documents. =C2=A0I can handle these errors and ask again.
>
> I have read that this error message means that the heap is getting filled=
 up and garbage collection removes only a small amount of it. =C2=A0Since a=
ll I am doing is retrieving, why should the heap be filling up? =C2=A0I res=
tarted the system before starting the retrieval.
>
> My guess is that there is some small memory leak because memory assigned =
to my python program grows slowly as I request more document tokens. =C2=A0=
Since I'm not intending to change anything in either my python program or i=
n Lucene, any growth is unintentional. =C2=A0I'm just getting tokens.
>
> =C2=A0we use lucene.TermQuery as the query object to get the terms.
>
> I cannot share the documents nor the application code, but I might be abl=
e to provide snippets.
>
> One last piece of information, the time needed to retrieve documents slow=
s throughout the process. =C2=A0In the beginning I was getting about 10 doc=
uments per second. =C2=A0Towards the end, it is down to about 5 with about =
5 second pauses from time to time, perhaps due to garbage collection?
>
> Any idea of why the heap is filling up and what I can do about it?
>
> Thanks,
> Herb
>
>



--
/Rub=C3=A9n

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45749-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 10 17:56:53 2010
Return-Path: <java-user-return-45749-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69115 invoked from network); 10 Apr 2010 17:56:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Apr 2010 17:56:53 -0000
Received: (qmail 33295 invoked by uid 500); 10 Apr 2010 17:56:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33240 invoked by uid 500); 10 Apr 2010 17:56:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33232 invoked by uid 99); 10 Apr 2010 17:56:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 17:56:50 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 72.14.220.153 as permitted sender)
Received: from [72.14.220.153] (HELO fg-out-1718.google.com) (72.14.220.153)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 17:56:43 +0000
Received: by fg-out-1718.google.com with SMTP id d23so1445743fga.5
        for <java-user@lucene.apache.org>; Sat, 10 Apr 2010 10:56:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=xxLTSeTE/y9YHmzdlAH5WZFb33qScfvB9BHkgkfiY9s=;
        b=WNiygfdR72Ua4d52iEUOkOq7nXUdD5ZWlIeBNGJXgXLnfLqm6prOV8hwIVU09Pm/H8
         4eF92z4tpc1RdeatlEQK0M1tEBINpt2Ln+O+BPqSoocxerjSRzaF6Uqrw09fazUtSVsK
         Q17PiUZ1IL5FnjcwV4Z7wI6fH6m3yNvgAVFkU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=B4Pr1+MwjPS6jfyq3ZFL/ngIMfjzZY80QqRDaz53t0c2D/hKJ6VImy1hAIstd3A9NN
         yQKAReOtqDNwWGJ3hpGQmwAgs0r0uPYymQ6tEWT2h842Q3gliYDS/7mrzkh7IMbZq4dR
         ZSiCYAM0d9ZsNed03YuhBLsTGeL5WSeIWcmoI=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Sat, 10 Apr 2010 10:56:22 -0700 (PDT)
In-Reply-To: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
References: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
Date: Sat, 10 Apr 2010 20:56:22 +0300
Received: by 10.103.84.1 with SMTP id m1mr845432mul.26.1270922182475; Sat, 10 
	Apr 2010 10:56:22 -0700 (PDT)
Message-ID: <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
Subject: Re: Removing terms in the Index
From: Shai Erera <serera@gmail.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1

Hi. I'm not sure I understand what you searched for. When you search
for "Lucene in action", do you search it with the quotes or not? If
with the quotes, then I don't understand how the 2nd dox is found.

Do you perhaps have a test code you can share w/ us? It can be a short
and simple main which creates an index w/ some documents and then
searches them.

Shai

On Saturday, April 10, 2010, Fotos fotos <railan.xisto@gmail.com> wrote:
> Hello!
> I am a beginner with Lucene. I'm needing to do the following:
>
> I have a text file with the following terms:
>
> "Lucene in action"
> "Lucene"
>
> and a file with the following sentences:
>
> 1 - "Lucene in action now."
> 2 - "Lucene for Dummies"
> 3 - "Managing Gigabytes"
>
> I need to search in phrases of doc2, the terms of doc1.
>
> But in search of the word n-grama: "Lucene in Action", he also finds the 2nd
> sentence.
>
> In this case, I want to meet with the term 1 ("Lucene in Action"), only the
> first phrase and remove the term of the index, for not to be found when I
> pass the term 2 ("Lucene")
>
> Railan Xisto
> Web Developer
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45750-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 10 23:02:10 2010
Return-Path: <java-user-return-45750-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13705 invoked from network); 10 Apr 2010 23:02:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Apr 2010 23:02:10 -0000
Received: (qmail 78512 invoked by uid 500); 10 Apr 2010 23:02:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78323 invoked by uid 500); 10 Apr 2010 23:02:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78315 invoked by uid 99); 10 Apr 2010 23:02:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 23:02:07 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.208.4.195] (HELO mout.perfora.net) (74.208.4.195)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Apr 2010 23:01:59 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus0) with ESMTP (Nemesis)
	id 0M3htJ-1N9ryg3ekL-00rgLE; Sat, 10 Apr 2010 19:01:37 -0400
Message-ID: <0B9E6F35EEB54A9585D5DC65538B4961@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Subject: _dumpRefs problem, tracking heap leak
Date: Sat, 10 Apr 2010 16:01:17 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX196pkVOtQJ+yM0ztJp/qX8G/nikb8yPnFgONwO
 kqjRQpQ0MbQUYVnMkb1Qq2fPBbzswP2nib3+4RnxPDOxTXqVrl
 cAzjTzeILue4UKZhFveUg==

I'm trying to get a listing of the Java items that Python is holding.
I tried this:
print lucene.JCCEnv._dumpRefs(classes=True).items()
I get the message:

'_dumpRefs' of 'jcc.JCCEnv' object needs an argument

What argument does it need?

The heap histo gave me this:

num       #instances    #bytes  Class description
--------------------------------------------------------------------------
1:              19996937        812894352       char[]
2:              19995642        799825680       java.lang.String
3:               871    12786192       int[]
4:              10239   1366600 * ConstMethodKlass
5:              10239   1236264 * MethodKlass
6:              897     958096  * ConstantPoolKlass

Overall, the heap seems to be filling up and won't clear, so I am guessing 
that it is shared references that are not getting cleaned up.

I presented some background earlier.  I am repeating it here because this is 
a different question/thread. Ruben gave me some good suggestions, that's how 
I got the heap histogram.

Hi, folks.
I am using PyLucene and doing a lot of get tokens.  lucene.py reports 
version 2.4.0.  It is rpath linux with 8GB of memory.  Python is 2.4.
I'm not sure what the maxheap is, I think that it is maxheap='2048m'.  It's 
running in a 64 bit environment.
It indexes a set of 116,000 documents just fine.
Then I need to get the tokens from these documents and near the end, I run 
into:

java.lang.OutOfMemoryError: GC overhead limit exceeded

Thanks so much.
Herb 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45751-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Apr 11 17:29:19 2010
Return-Path: <java-user-return-45751-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16364 invoked from network); 11 Apr 2010 17:29:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Apr 2010 17:29:18 -0000
Received: (qmail 80104 invoked by uid 500); 11 Apr 2010 17:29:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80044 invoked by uid 500); 11 Apr 2010 17:29:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80036 invoked by uid 99); 11 Apr 2010 17:29:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Apr 2010 17:29:15 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=HTML_MESSAGE,NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.195] (HELO mout.perfora.net) (74.208.4.195)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Apr 2010 17:29:08 +0000
Received: from [192.168.1.155] (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus3) with ESMTP (Nemesis)
	id 0MO6v6-1O6Wk90nDg-005aLD; Sun, 11 Apr 2010 13:28:44 -0400
Message-ID: <4BC206C8.5070103@orcatec.com>
Date: Sun, 11 Apr 2010 10:28:40 -0700
From: Herbert L Roitblat <herb@orcatec.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
In-Reply-To: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
Content-Type: multipart/alternative;
 boundary="------------070209030008010309030402"
X-Provags-ID: V01U2FsdGVkX1+ga94lY9vfnJu35c5yKLrFB/V26xlQBX03crm
 04ij0XyXTBx/hagjJOHG6I/l30u8R50DCjcawHpz5Lyeh9/Luj
 ry4n+BM4h/SUMvzWwUWPA==
X-Virus-Checked: Checked by ClamAV on apache.org

--------------070209030008010309030402
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hi, Folks.  Thanks, Ruben, for your help.  It let me get a ways down the 
road.

The problem is the the heap is filling up when I am doing a 
lucene.TermQuery.  What I am trying to accomplish is to get the terms in 
one field of each document and their frequency in the document.  A code 
snippet is attached below. It yields the results I want.

I managed to get a small enough heap dump into jhat.  Now I could use 
some help understanding what I have found and some help figuring out 
what to do about it.  I am a noobi at understanding the details of 
Lucene, pyLucene,  and Java debugging.

If I understand correctly, the heap is filling up because it is keeping 
instances of objects around after there is no longer any need for them. 
I thought that it might be the case that Python was somehow keeping them 
around, but that does not seem to be the case (true?).

 From jhat, I got a class instance histogram:

290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990> of 
class org.apache.lucene.index.TermInfo 
<http://192.168.1.155:7000/class/0x7fbf693bb990>
289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80> of 
class org.apache.lucene.index.Term 
<http://192.168.1.155:7000/class/0x7fbf69412d80>
1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> of 
class org.apache.lucene.index.FieldInfo 
<http://192.168.1.155:7000/class/0x7fbf693f1300>
1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> of 
class org.apache.lucene.index.SegmentReader$Norm 
<http://192.168.1.155:7000/class/0x7fbf6940a1a8>
1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> of 
class org.apache.lucene.store.FSDirectory$FSIndexInput 
<http://192.168.1.155:7000/class/0x7fbf6928d460>
1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> of 
class org.apache.lucene.index.CompoundFileReader$CSIndexInput 
<http://192.168.1.155:7000/class/0x7fbf693ef958>
540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of 
class org.apache.lucene.index.TermBuffer 
<http://192.168.1.155:7000/class/0x7fbf69400510>
540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of 
class org.apache.lucene.util.UnicodeUtil$UTF16Result 
<http://192.168.1.155:7000/class/0x7fbf694011c8>
540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of 
class org.apache.lucene.util.UnicodeUtil$UTF8Result 
<http://192.168.1.155:7000/class/0x7fbf693bc168>
...

There are way too many instance of index.TermInfo and index.indexTerm.  
So, I tracked down some instances and looked for rootset references.  
There were none.  If I understand correctly, this instance should be 
garbage collected if there are no rootset references.  True?

     Here's an example from jhat:

    Rootset references to 
org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (includes weak refs)

    References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40 bytes)
    Other queries
    Exclude weak refs
---
There is at least one reference to the object, it is an element in an 
array, but the array does not have rootset references either.

Am I misinterpreting these results?  In any case, what can I do about 
getting rid of these?  Is it a bug in this version of Lucene?  Is there 
a known fix?  I think that I should be able to do an unlimited number of 
queries without filling up the heap.
I am using pyLucene version 2.4.

Thanks for your help.

Herb

-------------------------------
Code snippet:
        reader = self.index.getReader()
        lReader = reader.get()
        searcher = self.index.getSearcher()
        lSearcher = searcher.get()
        query = lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD_ID, uid))
        hits = list(lSearcher.search(query))
        if hits:
            hit = lucene.Hit.cast_(hits[0])
            tfvs = lReader.getTermFreqVectors(hit.id)

            if tfvs is not None: # this happens if the vector is not stored
                for tfv in tfvs: # There's one for each field that has a 
TermFreqVector
                    tfvP = lucene.TermFreqVector.cast_(tfv)
                    if returnAllFields or tfvP.field in termFields: # 
add only asked fields
                        tFields[tfvP.field] = dict([(t,f) for (t,f) in 
zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=minFreq])
        else:
            # This shouldn't happen, but we just log the error and march on
            self.log.error("Unable to fetch doc %s from index"%(uid))
##        if self.opCount % 1000 == 0:
##            print lucene.JCCEnv._dumpRefs(classes=True).items() 
#http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/002171.html
##        self.opCount += 1

        lReader.close()
        lSearcher.close()
        retFields = copy.deepcopy(tFields) #return a copy of tFields to 
free up references to it and its contents



Herbert Roitblat wrote:
> Hi, folks.
> I am using PyLucene and doing a lot of get tokens.  lucene.py reports version 2.4.0.  It is rpath linux with 8GB of memory.  Python is 2.4.
> I'm not sure what the maxheap is, I think that it is maxheap='2048m'.  I think that it's running in a 64 bit environment.
> It indexes a set of 116,000 documents just fine.
> Then I need to get the tokens from these documents and near the end, I run into:
>
> java.lang.OutOfMemoryError: GC overhead limit exceeded
>
> If I wait a bit and ask again for the same document's tokens, I can get them, but it then is somewhat likely to post the same error on a certain number of other documents.  I can handle these errors and ask again.
>
> I have read that this error message means that the heap is getting filled up and garbage collection removes only a small amount of it.  Since all I am doing is retrieving, why should the heap be filling up?  I restarted the system before starting the retrieval.
>
> My guess is that there is some small memory leak because memory assigned to my python program grows slowly as I request more document tokens.  Since I'm not intending to change anything in either my python program or in Lucene, any growth is unintentional.  I'm just getting tokens.
>
>  we use lucene.TermQuery as the query object to get the terms.
>
> I cannot share the documents nor the application code, but I might be able to provide snippets.
>
> One last piece of information, the time needed to retrieve documents slows throughout the process.  In the beginning I was getting about 10 documents per second.  Towards the end, it is down to about 5 with about 5 second pauses from time to time, perhaps due to garbage collection?
>
> Any idea of why the heap is filling up and what I can do about it?
>
> Thanks,
> Herb
>
>
>
>   

--------------070209030008010309030402--

From java-user-return-45752-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 05:45:50 2010
Return-Path: <java-user-return-45752-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27559 invoked from network); 12 Apr 2010 05:45:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 05:45:49 -0000
Received: (qmail 82191 invoked by uid 500); 12 Apr 2010 05:45:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81999 invoked by uid 500); 12 Apr 2010 05:45:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81991 invoked by uid 99); 12 Apr 2010 05:45:46 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 05:45:46 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of mike.schultz@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 05:45:39 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <mike.schultz@gmail.com>)
	id 1O1CSU-0006Xj-WC
	for java-user@lucene.apache.org; Sun, 11 Apr 2010 22:45:19 -0700
Date: Sun, 11 Apr 2010 21:45:18 -0800 (PST)
From: Mike Schultz <mike.schultz@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271051118990-712743.post@n3.nabble.com>
Subject: How to calculate payloads in queries too
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


I am interested in using payloads in the following way.  I store
Func(index-term) as a payload at index-term when indexing.  When querying I
want to compute Func(query-term) as well.  Then my similarity returns some
other function, Gunc(Func(index-term1),Func(query-term)).

As an example, maybe I'm stripping plural-s and I want to index the singular
along with the payload true/false as to whether the original term was plural
or not.  Then when I query with a term I have a true/false value for it as
well.  My similarity score can then rank plurals higher when plurals are
queried and visa versa.

As another example, say, I have a part of speech tagger and I'm lucky enough
to get long queries that I can also pos tag.

I would think the normal symmetry of query/index would make this usage just
fall out of the code but I only see the use case of index payloads.  I could
hack something so that, for example, I don't use a filter to strip plural s,
and instead do it later in the query object.  Then I could calculate my
Func(query-term) and pass back a similarity that knows about the query
payload.  Is there a better way?
-- 
View this message in context: http://n3.nabble.com/How-to-calculate-payloads-in-queries-too-tp712743p712743.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45753-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 10:48:38 2010
Return-Path: <java-user-return-45753-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87940 invoked from network); 12 Apr 2010 10:48:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 10:48:38 -0000
Received: (qmail 37475 invoked by uid 500); 12 Apr 2010 10:48:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37009 invoked by uid 500); 12 Apr 2010 10:48:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37001 invoked by uid 99); 12 Apr 2010 10:48:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 10:48:31 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=AWL,NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 10:48:26 +0000
Received: by gwaa12 with SMTP id a12so2698950gwa.35
        for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 03:48:04 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Mon, 12 Apr 2010 03:48:04 -0700 (PDT)
In-Reply-To: <4BC206C8.5070103@orcatec.com>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
	 <4BC206C8.5070103@orcatec.com>
Date: Mon, 12 Apr 2010 06:48:04 -0400
Received: by 10.150.75.8 with SMTP id x8mr3828631yba.121.1271069284412; Mon, 
	12 Apr 2010 03:48:04 -0700 (PDT)
Message-ID: <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

The large count of TermInfo & Term is completely normal -- this is
Lucene's term index, which is entirely RAM resident.

In 3.1, with flexible indexing, the RAM efficiency of the terms index
should be much improved.

While opening a new reader/searcher for every query is horribly
inefficient, it should not leak memory.  (Are you using
IndexReader.reopen?  I see calls to getReader, but this Lucene API
(near-real-time search) wasn't added until 2.9, and you're on 2.4, so
I think that's your own method?).

What do your get/getReader/getSearcher calls do?  Are you using
incRef/decRef at all to manage the lifetime of your readers?  How many
unique field names do you have, across all docs that you index?

If you change your test to open a single reader, but run that
TermQuery over and over and over again, do you still hit OOME?

Mike

On Sun, Apr 11, 2010 at 1:28 PM, Herbert L Roitblat <herb@orcatec.com> wrot=
e:
> Hi, Folks. =A0Thanks, Ruben, for your help. =A0It let me get a ways down =
the
> road.
>
> The problem is the the heap is filling up when I am doing a
> lucene.TermQuery. =A0What I am trying to accomplish is to get the terms i=
n one
> field of each document and their frequency in the document. =A0A code sni=
ppet
> is attached below. It yields the results I want.
>
> I managed to get a small enough heap dump into jhat. =A0Now I could use s=
ome
> help understanding what I have found and some help figuring out what to d=
o
> about it. =A0I am a noobi at understanding the details of Lucene, pyLucen=
e,
> =A0and Java debugging.
>
> If I understand correctly, the heap is filling up because it is keeping
> instances of objects around after there is no longer any need for them. I
> thought that it might be the case that Python was somehow keeping them
> around, but that does not seem to be the case (true?).
>
> From jhat, I got a class instance histogram:
>
> 290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990> of
> class org.apache.lucene.index.TermInfo
> <http://192.168.1.155:7000/class/0x7fbf693bb990>
> 289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80> of
> class org.apache.lucene.index.Term
> <http://192.168.1.155:7000/class/0x7fbf69412d80>
> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> of cl=
ass
> org.apache.lucene.index.FieldInfo
> <http://192.168.1.155:7000/class/0x7fbf693f1300>
> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> of cl=
ass
> org.apache.lucene.index.SegmentReader$Norm
> <http://192.168.1.155:7000/class/0x7fbf6940a1a8>
> 1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> of cl=
ass
> org.apache.lucene.store.FSDirectory$FSIndexInput
> <http://192.168.1.155:7000/class/0x7fbf6928d460>
> 1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> of cl=
ass
> org.apache.lucene.index.CompoundFileReader$CSIndexInput
> <http://192.168.1.155:7000/class/0x7fbf693ef958>
> 540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of cla=
ss
> org.apache.lucene.index.TermBuffer
> <http://192.168.1.155:7000/class/0x7fbf69400510>
> 540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of cla=
ss
> org.apache.lucene.util.UnicodeUtil$UTF16Result
> <http://192.168.1.155:7000/class/0x7fbf694011c8>
> 540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of cla=
ss
> org.apache.lucene.util.UnicodeUtil$UTF8Result
> <http://192.168.1.155:7000/class/0x7fbf693bc168>
> ...
>
> There are way too many instance of index.TermInfo and index.indexTerm. =
=A0So,
> I tracked down some instances and looked for rootset references. =A0There=
 were
> none. =A0If I understand correctly, this instance should be garbage colle=
cted
> if there are no rootset references. =A0True?
>
> =A0 =A0Here's an example from jhat:
>
> =A0 Rootset references to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218
> (includes weak refs)
>
> =A0 References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40 byt=
es)
> =A0 Other queries
> =A0 Exclude weak refs
> ---
> There is at least one reference to the object, it is an element in an arr=
ay,
> but the array does not have rootset references either.
>
> Am I misinterpreting these results? =A0In any case, what can I do about
> getting rid of these? =A0Is it a bug in this version of Lucene? =A0Is the=
re a
> known fix? =A0I think that I should be able to do an unlimited number of
> queries without filling up the heap.
> I am using pyLucene version 2.4.
>
> Thanks for your help.
>
> Herb
>
> -------------------------------
> Code snippet:
> =A0 =A0 =A0 reader =3D self.index.getReader()
> =A0 =A0 =A0 lReader =3D reader.get()
> =A0 =A0 =A0 searcher =3D self.index.getSearcher()
> =A0 =A0 =A0 lSearcher =3D searcher.get()
> =A0 =A0 =A0 query =3D lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD_I=
D, uid))
> =A0 =A0 =A0 hits =3D list(lSearcher.search(query))
> =A0 =A0 =A0 if hits:
> =A0 =A0 =A0 =A0 =A0 hit =3D lucene.Hit.cast_(hits[0])
> =A0 =A0 =A0 =A0 =A0 tfvs =3D lReader.getTermFreqVectors(hit.id)
>
> =A0 =A0 =A0 =A0 =A0 if tfvs is not None: # this happens if the vector is =
not stored
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 for tfv in tfvs: # There's one for each field=
 that has a
> TermFreqVector
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 tfvP =3D lucene.TermFreqVector.cast_(=
tfv)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if returnAllFields or tfvP.field in t=
ermFields: # add only
> asked fields
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 tFields[tfvP.field] =3D dict(=
[(t,f) for (t,f) in
> zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=3DminFreq])
> =A0 =A0 =A0 else:
> =A0 =A0 =A0 =A0 =A0 # This shouldn't happen, but we just log the error an=
d march on
> =A0 =A0 =A0 =A0 =A0 self.log.error("Unable to fetch doc %s from index"%(u=
id))
> ## =A0 =A0 =A0 =A0if self.opCount % 1000 =3D=3D 0:
> ## =A0 =A0 =A0 =A0 =A0 =A0print lucene.JCCEnv._dumpRefs(classes=3DTrue).i=
tems()
> #http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/00217=
1.html
> ## =A0 =A0 =A0 =A0self.opCount +=3D 1
>
> =A0 =A0 =A0 lReader.close()
> =A0 =A0 =A0 lSearcher.close()
> =A0 =A0 =A0 retFields =3D copy.deepcopy(tFields) #return a copy of tField=
s to free
> up references to it and its contents
>
>
>
> Herbert Roitblat wrote:
>>
>> Hi, folks.
>> I am using PyLucene and doing a lot of get tokens. =A0lucene.py reports
>> version 2.4.0. =A0It is rpath linux with 8GB of memory. =A0Python is 2.4=
.
>> I'm not sure what the maxheap is, I think that it is maxheap=3D'2048m'. =
=A0I
>> think that it's running in a 64 bit environment.
>> It indexes a set of 116,000 documents just fine.
>> Then I need to get the tokens from these documents and near the end, I r=
un
>> into:
>>
>> java.lang.OutOfMemoryError: GC overhead limit exceeded
>>
>> If I wait a bit and ask again for the same document's tokens, I can get
>> them, but it then is somewhat likely to post the same error on a certain
>> number of other documents. =A0I can handle these errors and ask again.
>>
>> I have read that this error message means that the heap is getting fille=
d
>> up and garbage collection removes only a small amount of it. =A0Since al=
l I am
>> doing is retrieving, why should the heap be filling up? =A0I restarted t=
he
>> system before starting the retrieval.
>>
>> My guess is that there is some small memory leak because memory assigned
>> to my python program grows slowly as I request more document tokens. =A0=
Since
>> I'm not intending to change anything in either my python program or in
>> Lucene, any growth is unintentional. =A0I'm just getting tokens.
>>
>> =A0we use lucene.TermQuery as the query object to get the terms.
>>
>> I cannot share the documents nor the application code, but I might be ab=
le
>> to provide snippets.
>>
>> One last piece of information, the time needed to retrieve documents slo=
ws
>> throughout the process. =A0In the beginning I was getting about 10 docum=
ents
>> per second. =A0Towards the end, it is down to about 5 with about 5 secon=
d
>> pauses from time to time, perhaps due to garbage collection?
>>
>> Any idea of why the heap is filling up and what I can do about it?
>>
>> Thanks,
>> Herb
>>
>>
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45754-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 10:57:23 2010
Return-Path: <java-user-return-45754-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89564 invoked from network); 12 Apr 2010 10:57:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 10:57:23 -0000
Received: (qmail 47728 invoked by uid 500); 12 Apr 2010 10:57:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47433 invoked by uid 500); 12 Apr 2010 10:57:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47425 invoked by uid 99); 12 Apr 2010 10:57:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 10:57:16 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 10:57:08 +0000
Received: (qmail 24829 invoked by uid 508); 12 Apr 2010 11:04:26 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 12 Apr 2010 11:04:26 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1O1H9W-0003Ye-Ac
	for java-user@lucene.apache.org; Mon, 12 Apr 2010 12:46:02 +0200
Date: Mon, 12 Apr 2010 12:46:02 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: Too many open files
Message-ID: <20100412104602.GE28457@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
User-Agent: Mutt/1.5.20 (2009-06-14)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

I found a bug in my application, there was no commit at all in all the
indexing chain.
I noticed thanks to this bug that lucene keeps a file system reference
to deleted index files. So after many files indexed I hit a Too many
open files.

I use a 32 bits 1.6.16 JVM on a linux 64bits system.
Directory is opened using factory : FSDirectory.open(dir)
So I guess NIOFSDirectory is returned.
We use a merge factor of 4.

NOTE: that we use lucene for a long time and never had this problem.
clues are : - it's the first time we use 3.0.1
	    - it's the first we forgot to commit on a large 
	      collection (10k docs).

Here is a chunk of lsof linux utility (which output open files)
(There is a total of 16225 files in this case)

COMMAND     PID        USER    FD      TYPE            DEVICE   SIZE/OFF       NODE NAME
java       3485      techno  755r      REG               8,23      56264    2785417 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1v.cfs (deleted)
java       3485      techno  756r      REG               8,23      44137    2785418 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1w.cfs (deleted)
java       3485      techno  757r      REG               8,23      87610    2785405 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.tis (deleted)
java       3485      techno  758r      REG               8,23      31791    2785413 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.frq (deleted)
java       3485      techno  759r      REG               8,23     459082    2785414 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.prx (deleted)
java       3485      techno  760r      REG               8,23      20845    2589066 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_68.cfs (deleted)
java       3485      techno  761r      REG               8,23     770136    2589057 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_65.cfs (deleted)
java       3485      techno  762r      REG               8,23      50043    2589064 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_66.cfs (deleted)
java       3485      techno  763r      REG               8,23       9731    2589065 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_67.cfs (deleted)
java       3485      techno  764r      REG               8,23      80442    2589054 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.tis (deleted)
java       3485      techno  765r      REG               8,23      18179    2589061 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.frq (deleted)
java       3485      techno  766r      REG               8,23     282912    2589062 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.prx (deleted)
java       3485      techno  767r      REG               8,23    1094347    2785415 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.cfs (deleted)
java       3485      techno  768r      REG               8,23      19905    2785423 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1y.cfs (deleted)
java       3485      techno  769r      REG               8,23     843370    2589063 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.cfs (deleted)
java       3485      techno  770r      REG               8,23      21271    2589071 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6a.cfs (deleted)
java       3485      techno  771r      REG               8,23      14050    2589072 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6b.cfs (deleted)
java       3485      techno  772r      REG               8,23      13508    2589073 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6c.cfs (deleted)
java       3485      techno  773r      REG               8,23       4362    2589074 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6e.cfs (deleted)
java       3485      techno  774r      REG               8,23       6253    2589075 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6f.cfs (deleted)
java       3485      techno  775r      REG               8,23      81194    2589060 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.tis (deleted)
java       3485      techno  776r      REG               8,23      19199    2589068 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.frq (deleted)
java       3485      techno  777r      REG               8,23     296407    2589069 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.prx (deleted)
java       3485      techno  778r      REG               8,23     116547    2785424 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1z.cfs (deleted)
java       3485      techno  779r      REG               8,23     882807    2589070 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.cfs (deleted)
java       3485      techno  780r      REG               8,23       7850    2589080 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6g.cfs (deleted)
java       3485      techno  781r      REG               8,23      82314    2589067 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.tis (deleted)
java       3485      techno  782r      REG               8,23      19642    2589077 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.frq (deleted)
java       3485      techno  783r      REG               8,23     300953    2589078 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.prx (deleted)
java       3485      techno  784r      REG               8,23      49075    2785425 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_20.cfs (deleted)
java       3485      techno  785r      REG               8,23      96241    2785412 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.tis (deleted)
java       3485      techno  786r      REG               8,23     897209    2589079 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.cfs (deleted)
java       3485      techno  787r      REG               8,23      27077    2589085 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6i.cfs (deleted)
java       3485      techno  788r      REG               8,23      10381    2589086 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6j.cfs (deleted)
java       3485      techno  789r      REG               8,23      36423    2785420 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.frq (deleted)
java       3485      techno  790r      REG               8,23     528730    2785421 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.prx (deleted)
java       3485      techno  791r      REG               8,23    1141276    2629777 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/FR/main/_25.cfs (deleted)
java       3485      techno  792r      REG               8,23      88374    2629785 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/FR/main/_26.cfs (deleted)
java       3485      techno  793r      REG               8,23       7114    2589087 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6k.cfs (deleted)
java       3485      techno  794r      REG               8,23      84488    2589076 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.tis (deleted)
java       3485      techno  795r      REG               8,23      20533    2589082 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.frq (deleted)
java       3485      techno  796r      REG               8,23     314411    2589083 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.prx (deleted)
java       3485      techno  797r      REG               8,23    1254167    2785422 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.cfs (deleted)
java       3485      techno  798r      REG               8,23      39697    2785430 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_22.cfs (deleted)
java       3485      techno  799r      REG               8,23      72896    2785431 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_23.cfs (deleted)
java       3485      techno  800r      REG               8,23     935325    2589084 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.cfs (deleted)
java       3485      techno  801r      REG               8,23      26395    2589092 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6m.cfs (deleted)
java       3485      techno  802r      REG               8,23      15475    2589093 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6n.cfs (deleted)
java       3485      techno  803r      REG               8,23      20575    2589094 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6o.cfs (deleted)
java       3485      techno  804r      REG               8,23       6243    2589095 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6q.cfs (deleted)
java       3485      techno  805r      REG               8,23      88382    2589081 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6p.tis (deleted)
java       3485      techno  806r      REG               8,23      21880    2589089 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6p.frq (deleted)
java       3485      techno  807r      REG               8,23     332073    2589090 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6p.prx (deleted)
java       3485      techno  808r      REG               8,23      37441    2629786 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/FR/main/_27.cfs (deleted)


-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45755-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 11:09:45 2010
Return-Path: <java-user-return-45755-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92313 invoked from network); 12 Apr 2010 11:09:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 11:09:45 -0000
Received: (qmail 63712 invoked by uid 500); 12 Apr 2010 11:09:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63515 invoked by uid 500); 12 Apr 2010 11:09:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63506 invoked by uid 99); 12 Apr 2010 11:09:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 11:09:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of railan.xisto@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 11:09:30 +0000
Received: by bwz22 with SMTP id 22so4282715bwz.5
        for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 04:09:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=AfbgBbdrpUXN5L8KLQ/pjhAvPJNXfJuVM8rg+2XWBuE=;
        b=tL/YnO+GNUktiCDMTJavphiFFcpwba+lt62CycppErZDSIoQz+qte7vWwrgx2dw3E9
         1/d5yJ/lH4UTb/74e4HXx4DNxuvKIII0M0krEzwAEzHI6MtLKHHrZjM2VXDZhLGcAG9W
         bLgX6IEK27d7joii//cSWbrtOx9MO/ZwkAsEA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=PFWhSHwtQkzw5biF5b184gkwLc5Kgp8nLLwVcvOwIa9G8Au9XBizbLaI/n+S6Tzz0C
         8fC3I5TnKYiLieK45Lzf4TinXNXY6FHlLFTHgOg/h1B2OCio/rBgguSHKJSOagdXJrPA
         NhKopwPCxakpo4lGlVorNkiiPgAHPRcfGepJ0=
MIME-Version: 1.0
Received: by 10.204.15.1 with HTTP; Mon, 12 Apr 2010 04:09:09 -0700 (PDT)
In-Reply-To: <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
References: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
	 <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
Date: Mon, 12 Apr 2010 08:09:09 -0300
Received: by 10.204.11.22 with SMTP id r22mr4535590bkr.120.1271070550093; Mon, 
	12 Apr 2010 04:09:10 -0700 (PDT)
Message-ID: <h2mcbcac69f1004120409g5c27063az40456793bb517a0b@mail.gmail.com>
Subject: Re: Removing terms in the Index
From: Railan Xisto <railan.xisto@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/mixed; boundary=0003255585b29f74770484082ceb
X-Virus-Checked: Checked by ClamAV on apache.org

--0003255585b29f74770484082ceb
Content-Type: multipart/alternative; boundary=0003255585b29f746b0484082ce9

--0003255585b29f746b0484082ce9
Content-Type: text/plain; charset=ISO-8859-1

Ok. There is a piece of code attached.. As I already said, I want to pass
that when the term "Lucene in Action" he finds only the 1st sentence.




2010/4/10 Shai Erera <serera@gmail.com>

> Hi. I'm not sure I understand what you searched for. When you search
> for "Lucene in action", do you search it with the quotes or not? If
> with the quotes, then I don't understand how the 2nd dox is found.
>
> Do you perhaps have a test code you can share w/ us? It can be a short
> and simple main which creates an index w/ some documents and then
> searches them.
>
> Shai
>
> On Saturday, April 10, 2010, Fotos fotos <railan.xisto@gmail.com> wrote:
> > Hello!
> > I am a beginner with Lucene. I'm needing to do the following:
> >
> > I have a text file with the following terms:
> >
> > "Lucene in action"
> > "Lucene"
> >
> > and a file with the following sentences:
> >
> > 1 - "Lucene in action now."
> > 2 - "Lucene for Dummies"
> > 3 - "Managing Gigabytes"
> >
> > I need to search in phrases of doc2, the terms of doc1.
> >
> > But in search of the word n-grama: "Lucene in Action", he also finds the
> 2nd
> > sentence.
> >
> > In this case, I want to meet with the term 1 ("Lucene in Action"), only
> the
> > first phrase and remove the term of the index, for not to be found when I
> > pass the term 2 ("Lucene")
> >
> > Railan Xisto
> > Web Developer
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0003255585b29f746b0484082ce9
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Ok. <span id=3D"result_box" class=3D"medium_text"><span title=3D"a=ED est=
=E1 um peda=E7o do c=F3digo.">There is a piece of code</span></span><span i=
d=3D"result_box" class=3D"medium_text"><span style=3D"background-color: rgb=
(235, 239, 249);" title=3D"a=ED est=E1 um peda=E7o do c=F3digo anexado."> a=
ttached.</span></span><span id=3D"result_box" class=3D"medium_text"><span t=
itle=3D"a=ED est=E1 um peda=E7o do c=F3digo.">. </span><span title=3D"Como =
eu j=E1 tinha dito, eu quero que quando passar o termo &quot;Lucene in Acti=
on&quot; ele encontre apenas a 1=AA frase.">As I already said, I want to pa=
ss that when the term &quot;Lucene in Action&quot; he finds only the 1st se=
ntence.</span></span><br>
<br><br><br><br><div class=3D"gmail_quote">2010/4/10 Shai Erera <span dir=
=3D"ltr">&lt;<a href=3D"mailto:serera@gmail.com">serera@gmail.com</a>&gt;</=
span><br><blockquote class=3D"gmail_quote" style=3D"border-left: 1px solid =
rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
Hi. I&#39;m not sure I understand what you searched for. When you search<br=
>
for &quot;Lucene in action&quot;, do you search it with the quotes or not? =
If<br>
with the quotes, then I don&#39;t understand how the 2nd dox is found.<br>
<br>
Do you perhaps have a test code you can share w/ us? It can be a short<br>
and simple main which creates an index w/ some documents and then<br>
searches them.<br>
<font color=3D"#888888"><br>
Shai<br>
</font><div><div></div><div class=3D"h5"><br>
On Saturday, April 10, 2010, Fotos fotos &lt;<a href=3D"mailto:railan.xisto=
@gmail.com">railan.xisto@gmail.com</a>&gt; wrote:<br>
&gt; Hello!<br>
&gt; I am a beginner with Lucene. I&#39;m needing to do the following:<br>
&gt;<br>
&gt; I have a text file with the following terms:<br>
&gt;<br>
&gt; &quot;Lucene in action&quot;<br>
&gt; &quot;Lucene&quot;<br>
&gt;<br>
&gt; and a file with the following sentences:<br>
&gt;<br>
&gt; 1 - &quot;Lucene in action now.&quot;<br>
&gt; 2 - &quot;Lucene for Dummies&quot;<br>
&gt; 3 - &quot;Managing Gigabytes&quot;<br>
&gt;<br>
&gt; I need to search in phrases of doc2, the terms of doc1.<br>
&gt;<br>
&gt; But in search of the word n-grama: &quot;Lucene in Action&quot;, he al=
so finds the 2nd<br>
&gt; sentence.<br>
&gt;<br>
&gt; In this case, I want to meet with the term 1 (&quot;Lucene in Action&q=
uot;), only the<br>
&gt; first phrase and remove the term of the index, for not to be found whe=
n I<br>
&gt; pass the term 2 (&quot;Lucene&quot;)<br>
&gt;<br>
&gt; Railan Xisto<br>
&gt; Web Developer<br>
&gt;<br>
<br>
</div></div><div><div></div><div class=3D"h5">-----------------------------=
----------------------------------------<br>
To unsubscribe, e-mail: <a href=3D"mailto:java-user-unsubscribe@lucene.apac=
he.org">java-user-unsubscribe@lucene.apache.org</a><br>
For additional commands, e-mail: <a href=3D"mailto:java-user-help@lucene.ap=
ache.org">java-user-help@lucene.apache.org</a><br>
<br>
</div></div></blockquote></div><br>

--0003255585b29f746b0484082ce9--
--0003255585b29f74770484082ceb
Content-Type: text/plain; charset=UTF-8; name="Main.txt"
Content-Disposition: attachment; filename="Main.txt"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_g7x6ihzk0

DQpwdWJsaWMgY2xhc3MgTWFpbiB7DQoJDQoJcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5n
W10gYXJncykgdGhyb3dzIENvcnJ1cHRJbmRleEV4Y2VwdGlvbiwgTG9ja09idGFpbkZhaWxlZEV4
Y2VwdGlvbiwgSU9FeGNlcHRpb24sIFBhcnNlRXhjZXB0aW9ueyANCgkvLyBDcmlhIG8gYW5hbHl6
YWRvciAgDQogCSAgIFN0YW5kYXJkQW5hbHl6ZXIgYW5hbHl6ZXIgPSBuZXcgU3RhbmRhcmRBbmFs
eXplcihWZXJzaW9uLkxVQ0VORV9DVVJSRU5UKTsgIA0KIAkgICAgIA0KIAkgICAvLyBEaXJldMOz
cmlvIHZpcnR1YWwgcGFyYSBvIMOtbmRpY2UgIA0KIAkgICBEaXJlY3RvcnkgaW5kZXhEaXJlY3Rv
cnkgPSBuZXcgUkFNRGlyZWN0b3J5KCk7ICANCg0KDQogCSAgICAgIA0KIAkgICAvLyBDcmlhIG8g
YXJxdWl2byBjb20gdGFtYW5obyBpbGltaXRhZG8uICANCiAJICANCiAJICAgSW5kZXhXcml0ZXIg
dyA9IG5ldyBJbmRleFdyaXRlcihpbmRleERpcmVjdG9yeSwgYW5hbHl6ZXIsIHRydWUsIEluZGV4
V3JpdGVyLk1heEZpZWxkTGVuZ3RoLlVOTElNSVRFRCk7DQogCSAgIC8vIEFkaWNpb25hIDQgZG9j
dW1lbnRvcy4gIA0KIAkgICBhZGREb2ModywgIkx1Y2VuZSBpbiBBY3Rpb24gbm93LiBMdWNlbmUg
aXMgYSB0b29sIik7ICAgDQogCSAgIGFkZERvYyh3LCAiTHVjZW5lIGZvciBEdW1taWVzIik7ICAN
CiAJICANCiAJICAgIA0KIAkgIC8vIEZlY2hhIG8gYXJxdWl2by4gIA0KIAkgICB3LmNsb3NlKCk7
ICANCiAJICAgDQogCSAgRmlsZSBhcnF1aXZvOw0KIAkgIGFycXVpdm8gPSBuZXcgRmlsZSgiRG9j
cy9kb2N1bWVudG8udHh0Iik7IC9kb2N1bWVudCB3aGVyZSBhcmUgdGhlIHRlcm1zIGZvciB0aGUg
c2VhcmNoDQogCSAgRmlsZUlucHV0U3RyZWFtIGZpcyA9IG5ldyBGaWxlSW5wdXRTdHJlYW0oYXJx
dWl2byk7ICAvL29wZW4gdGhlIGZpbGUgaW4gbWVtb3J5DQogCSANCiAgICAgIGludCBsbjsgIA0K
ICAgICAgU3RyaW5nIHRlcm1vcyA9ICIiOw0KICAgICAgDQogICAgIA0KICAgICAgDQogICAgIHdo
aWxlICggKGxuID0gZmlzLnJlYWQoKSkgIT0tMSApIHsgIC8vIHJlYWQgdGhlIGZpbGUNCiAgICAJ
ICANCiAgICAgICAgICB0ZXJtb3MgPSB0ZXJtb3MgKyAoIChjaGFyKWxuICk7ICAgICAgDQogICAg
IH0gIA0KICAgICAgDQogIA0KICAgICAgZmlzLmNsb3NlKCk7DQogCSAgICAgIA0KIAkgICAvLyBG
YXogbyBwYXJzZSBkYSBjb25zdWx0YSBlIGNyaWEgdW1hIHF1ZXJ5IGRvIGx1Y2VuZS4gIA0KIAkg
ICBRdWVyeSBxID0gbmV3IFF1ZXJ5UGFyc2VyKFZlcnNpb24uTFVDRU5FX0NVUlJFTlQsICJ0aXRs
ZSIsIGFuYWx5emVyKS5wYXJzZSh0ZXJtb3MpOyANCg0KDQogCSAgIA0KIAkgICBpbnQgbWF4SGl0
cyA9IDEwOyAgDQogCSAgICAgIA0KIAkgICAgLy8gQ3JpYSBvIGFjZXNzbyBhbyDDrW5kaWNlICAN
CiAJICAgIEluZGV4U2VhcmNoZXIgc2VhcmNoZXIgPSBuZXcgSW5kZXhTZWFyY2hlcihpbmRleERp
cmVjdG9yeSk7ICANCiAJICAgICAvLyBQcmVwYXJhIGEgY29sZcOnw6NvIGRlIHJlc3VsdGFkbyAg
DQogCSAgICAgVG9wU2NvcmVEb2NDb2xsZWN0b3IgY29sbGVjdG9yID0gVG9wU2NvcmVEb2NDb2xs
ZWN0b3IuY3JlYXRlKG1heEhpdHMsIHRydWUpOyANCiAJICAgDQogCSAgICAgICANCiAJICAgICAv
LyBGYXogYSBwZXNxdWlzYSAgDQogCSAgICAgc2VhcmNoZXIuc2VhcmNoKHEsIGNvbGxlY3Rvcik7
ICANCiAJICAgICAgDQogCSAgICAgLy8gU2VwYXJhIG9zIDEwIGl0ZW5zIG1haXMgcmVsZXZhbnRl
cyBwYXJhIGEgY29uc3VsdGEuICANCiAJICAgICBTY29yZURvY1tdIGhpdHMgPSBjb2xsZWN0b3Iu
dG9wRG9jcygpLnNjb3JlRG9jczsNCiAJICAgIA0KIAkgICAgICAvLyBJbXByaW1lIG9zIGRvY3Vt
ZW50b3MgcmV0b3JuYWRvcy4gIA0KIAkgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkZvdW5kICIg
KyBoaXRzLmxlbmd0aCArICIgaGl0cy4iKTsgIA0KIAkgICAgICBmb3IgKGludCBpID0gMDsgaSA8
IGhpdHMubGVuZ3RoOyArK2kpIHsgIA0KIAkgICAgICAgICAgaW50IGRvY0lkID0gaGl0c1tpXS5k
b2M7ICANCiAJICAgICAgICAgIERvY3VtZW50IGQgPSBzZWFyY2hlci5kb2MoZG9jSWQpOyAgDQog
CSAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oKGkgKyAxKSArICIuICIgKyBkLmdldCgidGl0
bGUiKSk7ICANCiAJICAgICAgfSANCgkgICAgICANCgkNCn0gIA0KIA0KICAgcHJpdmF0ZSBzdGF0
aWMgdm9pZCBhZGREb2MoSW5kZXhXcml0ZXIgdyxTdHJpbmcgdGV4dCkgdGhyb3dzIElPRXhjZXB0
aW9uIHsgIA0KCSAgICAgICAgRG9jdW1lbnQgZG9jID0gbmV3IERvY3VtZW50KCk7ICANCgkgICAg
ICAgIGRvYy5hZGQobmV3IEZpZWxkKCJ0aXRsZSIsIHRleHQsIEZpZWxkLlN0b3JlLllFUywgRmll
bGQuSW5kZXguQU5BTFlaRUQpKTsgIA0KCSAgICAgICAgdy5hZGREb2N1bWVudChkb2MpOyAgDQog
ICB9IA0KICANCn0NCg==

--0003255585b29f74770484082ceb
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--0003255585b29f74770484082ceb--

From java-user-return-45756-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 12:54:16 2010
Return-Path: <java-user-return-45756-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18512 invoked from network); 12 Apr 2010 12:54:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 12:54:16 -0000
Received: (qmail 95900 invoked by uid 500); 12 Apr 2010 12:54:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95823 invoked by uid 500); 12 Apr 2010 12:54:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95815 invoked by uid 99); 12 Apr 2010 12:54:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 12:54:13 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 12:54:05 +0000
Received: (qmail 9344 invoked by uid 508); 12 Apr 2010 13:01:22 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 12 Apr 2010 13:01:22 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1O1Iyg-00043h-Ga
	for java-user@lucene.apache.org; Mon, 12 Apr 2010 14:42:58 +0200
Date: Mon, 12 Apr 2010 14:42:58 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: Re: Too many open files
Message-ID: <20100412124258.GF28457@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
References: <20100412104602.GE28457@spotter-dclnx>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20100412104602.GE28457@spotter-dclnx>
User-Agent: Mutt/1.5.20 (2009-06-14)
X-Virus-Checked: Checked by ClamAV on apache.org

After a closer look, I forgot to mention a major clue : it's also the
first time we use NRT.

I thought IW.getReader() would return a pooled NRT and in fact it
returns always a new IR. This should explain the Too many opened files
exception. After each addDocument(doc) I prepare a reader with
IW.getReader() overriding the old NRT reader reference with no care...

So I'll take extra care of my NRT reader instances and pool it myself.

Sorry for the noise.

On Mon, Apr 12, 2010 at 12:46:02PM +0200, David Causse wrote:
> Hi,
> 
> I found a bug in my application, there was no commit at all in all the
> indexing chain.
> I noticed thanks to this bug that lucene keeps a file system reference
> to deleted index files. So after many files indexed I hit a Too many
> open files.
> 
> I use a 32 bits 1.6.16 JVM on a linux 64bits system.
> Directory is opened using factory : FSDirectory.open(dir)
> So I guess NIOFSDirectory is returned.
> We use a merge factor of 4.
> 
> NOTE: that we use lucene for a long time and never had this problem.
> clues are : - it's the first time we use 3.0.1
> 	    - it's the first we forgot to commit on a large 
> 	      collection (10k docs).
> 
> Here is a chunk of lsof linux utility (which output open files)
> (There is a total of 16225 files in this case)
> 
> COMMAND     PID        USER    FD      TYPE            DEVICE   SIZE/OFF       NODE NAME
> java       3485      techno  755r      REG               8,23      56264    2785417 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1v.cfs (deleted)
> java       3485      techno  756r      REG               8,23      44137    2785418 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1w.cfs (deleted)
> java       3485      techno  757r      REG               8,23      87610    2785405 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.tis (deleted)
> java       3485      techno  758r      REG               8,23      31791    2785413 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.frq (deleted)
> java       3485      techno  759r      REG               8,23     459082    2785414 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.prx (deleted)
> java       3485      techno  760r      REG               8,23      20845    2589066 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_68.cfs (deleted)
> java       3485      techno  761r      REG               8,23     770136    2589057 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_65.cfs (deleted)
> java       3485      techno  762r      REG               8,23      50043    2589064 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_66.cfs (deleted)
> java       3485      techno  763r      REG               8,23       9731    2589065 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_67.cfs (deleted)
> java       3485      techno  764r      REG               8,23      80442    2589054 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.tis (deleted)
> java       3485      techno  765r      REG               8,23      18179    2589061 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.frq (deleted)
> java       3485      techno  766r      REG               8,23     282912    2589062 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.prx (deleted)
> java       3485      techno  767r      REG               8,23    1094347    2785415 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1x.cfs (deleted)
> java       3485      techno  768r      REG               8,23      19905    2785423 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1y.cfs (deleted)
> java       3485      techno  769r      REG               8,23     843370    2589063 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_69.cfs (deleted)
> java       3485      techno  770r      REG               8,23      21271    2589071 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6a.cfs (deleted)
> java       3485      techno  771r      REG               8,23      14050    2589072 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6b.cfs (deleted)
> java       3485      techno  772r      REG               8,23      13508    2589073 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6c.cfs (deleted)
> java       3485      techno  773r      REG               8,23       4362    2589074 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6e.cfs (deleted)
> java       3485      techno  774r      REG               8,23       6253    2589075 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6f.cfs (deleted)
> java       3485      techno  775r      REG               8,23      81194    2589060 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.tis (deleted)
> java       3485      techno  776r      REG               8,23      19199    2589068 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.frq (deleted)
> java       3485      techno  777r      REG               8,23     296407    2589069 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.prx (deleted)
> java       3485      techno  778r      REG               8,23     116547    2785424 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_1z.cfs (deleted)
> java       3485      techno  779r      REG               8,23     882807    2589070 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6d.cfs (deleted)
> java       3485      techno  780r      REG               8,23       7850    2589080 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6g.cfs (deleted)
> java       3485      techno  781r      REG               8,23      82314    2589067 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.tis (deleted)
> java       3485      techno  782r      REG               8,23      19642    2589077 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.frq (deleted)
> java       3485      techno  783r      REG               8,23     300953    2589078 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.prx (deleted)
> java       3485      techno  784r      REG               8,23      49075    2785425 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_20.cfs (deleted)
> java       3485      techno  785r      REG               8,23      96241    2785412 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.tis (deleted)
> java       3485      techno  786r      REG               8,23     897209    2589079 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6h.cfs (deleted)
> java       3485      techno  787r      REG               8,23      27077    2589085 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6i.cfs (deleted)
> java       3485      techno  788r      REG               8,23      10381    2589086 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6j.cfs (deleted)
> java       3485      techno  789r      REG               8,23      36423    2785420 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.frq (deleted)
> java       3485      techno  790r      REG               8,23     528730    2785421 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.prx (deleted)
> java       3485      techno  791r      REG               8,23    1141276    2629777 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/FR/main/_25.cfs (deleted)
> java       3485      techno  792r      REG               8,23      88374    2629785 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/FR/main/_26.cfs (deleted)
> java       3485      techno  793r      REG               8,23       7114    2589087 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6k.cfs (deleted)
> java       3485      techno  794r      REG               8,23      84488    2589076 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.tis (deleted)
> java       3485      techno  795r      REG               8,23      20533    2589082 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.frq (deleted)
> java       3485      techno  796r      REG               8,23     314411    2589083 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.prx (deleted)
> java       3485      techno  797r      REG               8,23    1254167    2785422 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_21.cfs (deleted)
> java       3485      techno  798r      REG               8,23      39697    2785430 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_22.cfs (deleted)
> java       3485      techno  799r      REG               8,23      72896    2785431 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/EN/main/_23.cfs (deleted)
> java       3485      techno  800r      REG               8,23     935325    2589084 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6l.cfs (deleted)
> java       3485      techno  801r      REG               8,23      26395    2589092 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6m.cfs (deleted)
> java       3485      techno  802r      REG               8,23      15475    2589093 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6n.cfs (deleted)
> java       3485      techno  803r      REG               8,23      20575    2589094 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6o.cfs (deleted)
> java       3485      techno  804r      REG               8,23       6243    2589095 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6q.cfs (deleted)
> java       3485      techno  805r      REG               8,23      88382    2589081 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6p.tis (deleted)
> java       3485      techno  806r      REG               8,23      21880    2589089 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6p.frq (deleted)
> java       3485      techno  807r      REG               8,23     332073    2589090 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/fulltext/main/_6p.prx (deleted)
> java       3485      techno  808r      REG               8,23      37441    2629786 /home/techno/TMCorpora/cdf71916-ff5c-404e-a07f-8c398bde30b9/indexes/FR/main/_27.cfs (deleted)
> 
> 
> -- 
> David Causse
> Spotter
> http://www.spotter.com/
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 

-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45757-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 13:21:33 2010
Return-Path: <java-user-return-45757-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24895 invoked from network); 12 Apr 2010 13:21:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 13:21:33 -0000
Received: (qmail 51544 invoked by uid 500); 12 Apr 2010 13:21:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51502 invoked by uid 500); 12 Apr 2010 13:21:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51494 invoked by uid 99); 12 Apr 2010 13:21:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 13:21:31 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of mike.schultz@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 13:21:24 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <mike.schultz@gmail.com>)
	id 1O1JZX-0003RC-P2
	for java-user@lucene.apache.org; Mon, 12 Apr 2010 06:21:03 -0700
Date: Mon, 12 Apr 2010 05:21:03 -0800 (PST)
From: Mike Schultz <mike.schultz@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271078463768-713413.post@n3.nabble.com>
In-Reply-To: <1271051118990-712743.post@n3.nabble.com>
References: <1271051118990-712743.post@n3.nabble.com>
Subject: Re: How to calculate payloads in queries too
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


I see the payload in the token now.
-- 
View this message in context: http://n3.nabble.com/How-to-calculate-payloads-in-queries-too-tp712743p713413.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45758-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 13:50:39 2010
Return-Path: <java-user-return-45758-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32390 invoked from network); 12 Apr 2010 13:50:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 13:50:38 -0000
Received: (qmail 12848 invoked by uid 500); 12 Apr 2010 13:50:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12722 invoked by uid 500); 12 Apr 2010 13:50:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12714 invoked by uid 99); 12 Apr 2010 13:50:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 13:50:36 +0000
X-ASF-Spam-Status: No, hits=2.1 required=10.0
	tests=AWL,HTML_MESSAGE,NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.208.4.195] (HELO mout.perfora.net) (74.208.4.195)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 13:50:31 +0000
Received: from [192.168.1.155] (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus2) with ESMTP (Nemesis)
	id 0MSudh-1NtNQh0eW5-00S2ia; Mon, 12 Apr 2010 09:50:08 -0400
Message-ID: <4BC3250D.90006@orcatec.com>
Date: Mon, 12 Apr 2010 06:50:05 -0700
From: Herbert L Roitblat <herb@orcatec.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>	 <4BC206C8.5070103@orcatec.com> <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com>
In-Reply-To: <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------030300060009040105020202"
X-Provags-ID: V01U2FsdGVkX19MgrCs1MAEjk/BZcbyNg+jYojBxESC0RVZn/m
 2x1x9sYaPLI8DfOZRdbfv9RGuAzZSd7NeTDLaoHm3o+iFueG0r
 /cxWGi2ZqK9xyalJva1dA==

--------------030300060009040105020202
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Thank you Michael.  Your suggestions are helpful.  I inherited all of 
the code that uses pyLucene and don't consider myself an expert on it, 
so I very much appreciate your suggestions.

It does not seem to be the case that these elements represent the index 
of the collection. TermInfo and Term grow as I retrieve more documents.  
There was no trouble building the index.

The contents of these fields are the tokens (some fields are tokenized, 
others not) of the document fields.  In the tokenized fields, there is 
one object for each word. They seem to be in order of the documents for 
which the term vectors are being sought.  So these objects seem to 
represent a "concatenation" of all of the documents being considered in 
order, and if they are never removed, would always overwhelm the heap 
with a large document set.  They are not the index in the usual sense, I 
think.  Before I start retrieving documents, there is barely anything in 
these objects.

What is holding the document contents in the heap after the fields 
information is returned?

Can you say more about incRef/decRef?  I deleted all variables that 
interacted with Lucene and it seems to have made no difference

There are not a lot of different fields, I would say on the order of 50 
with about 20 of them in virtually every document.

It uses:
lucene.IndexReader.open(self._store)


One suggestion I got is to put the reader code in the class init 
function and then reuse it.  I have not tried that one yet (next on the 
agenda).  You suggested something similar and I will try that.

Thanks,
Herb


Michael McCandless wrote:
> The large count of TermInfo & Term is completely normal -- this is
> Lucene's term index, which is entirely RAM resident.
>
> In 3.1, with flexible indexing, the RAM efficiency of the terms index
> should be much improved.
>
> While opening a new reader/searcher for every query is horribly
> inefficient, it should not leak memory.  (Are you using
> IndexReader.reopen?  I see calls to getReader, but this Lucene API
> (near-real-time search) wasn't added until 2.9, and you're on 2.4, so
> I think that's your own method?).
>
> What do your get/getReader/getSearcher calls do?  Are you using
> incRef/decRef at all to manage the lifetime of your readers?  How many
> unique field names do you have, across all docs that you index?
>
> If you change your test to open a single reader, but run that
> TermQuery over and over and over again, do you still hit OOME?
>
> Mike
>
> On Sun, Apr 11, 2010 at 1:28 PM, Herbert L Roitblat <herb@orcatec.com> wrote:
>   
>> Hi, Folks.  Thanks, Ruben, for your help.  It let me get a ways down the
>> road.
>>
>> The problem is the the heap is filling up when I am doing a
>> lucene.TermQuery.  What I am trying to accomplish is to get the terms in one
>> field of each document and their frequency in the document.  A code snippet
>> is attached below. It yields the results I want.
>>
>> I managed to get a small enough heap dump into jhat.  Now I could use some
>> help understanding what I have found and some help figuring out what to do
>> about it.  I am a noobi at understanding the details of Lucene, pyLucene,
>>  and Java debugging.
>>
>> If I understand correctly, the heap is filling up because it is keeping
>> instances of objects around after there is no longer any need for them. I
>> thought that it might be the case that Python was somehow keeping them
>> around, but that does not seem to be the case (true?).
>>
>> From jhat, I got a class instance histogram:
>>
>> 290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990> of
>> class org.apache.lucene.index.TermInfo
>> <http://192.168.1.155:7000/class/0x7fbf693bb990>
>> 289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80> of
>> class org.apache.lucene.index.Term
>> <http://192.168.1.155:7000/class/0x7fbf69412d80>
>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> of class
>> org.apache.lucene.index.FieldInfo
>> <http://192.168.1.155:7000/class/0x7fbf693f1300>
>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> of class
>> org.apache.lucene.index.SegmentReader$Norm
>> <http://192.168.1.155:7000/class/0x7fbf6940a1a8>
>> 1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> of class
>> org.apache.lucene.store.FSDirectory$FSIndexInput
>> <http://192.168.1.155:7000/class/0x7fbf6928d460>
>> 1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> of class
>> org.apache.lucene.index.CompoundFileReader$CSIndexInput
>> <http://192.168.1.155:7000/class/0x7fbf693ef958>
>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of class
>> org.apache.lucene.index.TermBuffer
>> <http://192.168.1.155:7000/class/0x7fbf69400510>
>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of class
>> org.apache.lucene.util.UnicodeUtil$UTF16Result
>> <http://192.168.1.155:7000/class/0x7fbf694011c8>
>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of class
>> org.apache.lucene.util.UnicodeUtil$UTF8Result
>> <http://192.168.1.155:7000/class/0x7fbf693bc168>
>> ...
>>
>> There are way too many instance of index.TermInfo and index.indexTerm.  So,
>> I tracked down some instances and looked for rootset references.  There were
>> none.  If I understand correctly, this instance should be garbage collected
>> if there are no rootset references.  True?
>>
>>    Here's an example from jhat:
>>
>>   Rootset references to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218
>> (includes weak refs)
>>
>>   References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40 bytes)
>>   Other queries
>>   Exclude weak refs
>> ---
>> There is at least one reference to the object, it is an element in an array,
>> but the array does not have rootset references either.
>>
>> Am I misinterpreting these results?  In any case, what can I do about
>> getting rid of these?  Is it a bug in this version of Lucene?  Is there a
>> known fix?  I think that I should be able to do an unlimited number of
>> queries without filling up the heap.
>> I am using pyLucene version 2.4.
>>
>> Thanks for your help.
>>
>> Herb
>>
>> -------------------------------
>> Code snippet:
>>       reader = self.index.getReader()
>>       lReader = reader.get()
>>       searcher = self.index.getSearcher()
>>       lSearcher = searcher.get()
>>       query = lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD_ID, uid))
>>       hits = list(lSearcher.search(query))
>>       if hits:
>>           hit = lucene.Hit.cast_(hits[0])
>>           tfvs = lReader.getTermFreqVectors(hit.id)
>>
>>           if tfvs is not None: # this happens if the vector is not stored
>>               for tfv in tfvs: # There's one for each field that has a
>> TermFreqVector
>>                   tfvP = lucene.TermFreqVector.cast_(tfv)
>>                   if returnAllFields or tfvP.field in termFields: # add only
>> asked fields
>>                       tFields[tfvP.field] = dict([(t,f) for (t,f) in
>> zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=minFreq])
>>       else:
>>           # This shouldn't happen, but we just log the error and march on
>>           self.log.error("Unable to fetch doc %s from index"%(uid))
>> ##        if self.opCount % 1000 == 0:
>> ##            print lucene.JCCEnv._dumpRefs(classes=True).items()
>> #http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/002171.html
>> ##        self.opCount += 1
>>
>>       lReader.close()
>>       lSearcher.close()
>>       retFields = copy.deepcopy(tFields) #return a copy of tFields to free
>> up references to it and its contents
>>
>>
>>
>> Herbert Roitblat wrote:
>>     
>>> Hi, folks.
>>> I am using PyLucene and doing a lot of get tokens.  lucene.py reports
>>> version 2.4.0.  It is rpath linux with 8GB of memory.  Python is 2.4.
>>> I'm not sure what the maxheap is, I think that it is maxheap='2048m'.  I
>>> think that it's running in a 64 bit environment.
>>> It indexes a set of 116,000 documents just fine.
>>> Then I need to get the tokens from these documents and near the end, I run
>>> into:
>>>
>>> java.lang.OutOfMemoryError: GC overhead limit exceeded
>>>
>>> If I wait a bit and ask again for the same document's tokens, I can get
>>> them, but it then is somewhat likely to post the same error on a certain
>>> number of other documents.  I can handle these errors and ask again.
>>>
>>> I have read that this error message means that the heap is getting filled
>>> up and garbage collection removes only a small amount of it.  Since all I am
>>> doing is retrieving, why should the heap be filling up?  I restarted the
>>> system before starting the retrieval.
>>>
>>> My guess is that there is some small memory leak because memory assigned
>>> to my python program grows slowly as I request more document tokens.  Since
>>> I'm not intending to change anything in either my python program or in
>>> Lucene, any growth is unintentional.  I'm just getting tokens.
>>>
>>>  we use lucene.TermQuery as the query object to get the terms.
>>>
>>> I cannot share the documents nor the application code, but I might be able
>>> to provide snippets.
>>>
>>> One last piece of information, the time needed to retrieve documents slows
>>> throughout the process.  In the beginning I was getting about 10 documents
>>> per second.  Towards the end, it is down to about 5 with about 5 second
>>> pauses from time to time, perhaps due to garbage collection?
>>>
>>> Any idea of why the heap is filling up and what I can do about it?
>>>
>>> Thanks,
>>> Herb
>>>
>>>
>>>
>>>
>>>       
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   

--------------030300060009040105020202--

From java-user-return-45759-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 14:44:15 2010
Return-Path: <java-user-return-45759-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45276 invoked from network); 12 Apr 2010 14:44:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 14:44:15 -0000
Received: (qmail 23613 invoked by uid 500); 12 Apr 2010 14:44:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23589 invoked by uid 500); 12 Apr 2010 14:44:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23581 invoked by uid 99); 12 Apr 2010 14:44:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 14:44:12 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [98.136.167.1] (HELO web113301.mail.gq1.yahoo.com) (98.136.167.1)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 12 Apr 2010 14:44:03 +0000
Received: (qmail 30620 invoked by uid 60001); 12 Apr 2010 14:43:41 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271083421; bh=maX57sBltoC8yPbySaeZbsv81W0r/FnNA/Z3ZeiOijw=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=pabJ0qZfHc8CTkF/zC5HGKs4iaj48hSZPn/0jaidb96UeinuUmCAABpqT9ulXWbAGTXGZZhYJeZmWSuPbFWnkf6L3Q2QK4gKFT1QlFKNToHScivYYJHDacsrluzPR4Fq04yJ+hEiSx4JkfA1gQDsGHO8eB2/I61rOrwVc/apM4o=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=sJ7uWdN29HqDR+mqerzDnbWovwuFgn4XFfkLn1/j8bdXQK7ppFsCypHqu8go2JKGajOmidj7O01rrnJvBcuQq9jJ68/ltZE69Auna1qTD1Jtbmn+tKi6ekZLtrYGwfp2NA//gPZF7O6gmaFL1s/rinGIAkMdmCjnh7Ri8L0aqms=;
Message-ID: <704805.26467.qm@web113301.mail.gq1.yahoo.com>
X-YMail-OSG: m7CNbVcVM1kADDco0r66KPup3QkpCxPkcsZdWUnJVB9E_X8
 BNJ.cL5fg._7MwJwgcmOp5se__OaabKU.qpJFPFauubORQuitj80PD0PNa71
 jKCK3Z5uRl9_Ynq98NG4lpD0f.KKI8JilIP9LF7.sTNlkjGIedy1Qf6hzSZW
 .3TMufkODIBgMTaaz_BvX4JeESLOj2G0_nmzBY4OGMH_J8fD686GFvvBd2EZ
 TGsv2HsPAneLAXX_w38ezFycodwrkweTmQTFnKSLGGqFOaxna1IHqSko5GXZ
 T3uz9YFHRP9ewlT3fY90XXhhEgMCJshlTqDQKbQRGq0hIw_i_Zv4yqxkZCob
 i5vfxcT8PQZpFLJpev09Nq5qtqU8crQ--
Received: from [140.244.128.12] by web113301.mail.gq1.yahoo.com via HTTP; Mon, 12 Apr 2010 07:43:41 PDT
X-Mailer: YahooMailClassic/10.1.8 YahooMailWebService/0.8.100.260964
Date: Mon, 12 Apr 2010 07:43:41 -0700 (PDT)
From: Ivan Provalov <iprovalo@yahoo.com>
Subject: Re: Lucene Partition Size
To: java-user@lucene.apache.org
In-Reply-To: <0D85DA93-9AC1-4DF1-94E9-B330D5051399@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Thank you, Karl!=0A=0A--- On Fri, 4/9/10, Karl Wettin <karl.wettin@gmail.co=
m> wrote:=0A=0A> From: Karl Wettin <karl.wettin@gmail.com>=0A> Subject: Re:=
 Lucene Partition Size=0A> To: java-user@lucene.apache.org=0A> Date: Friday=
, April 9, 2010, 9:39 AM=0A> It's hard for me to say why this is=0A> slow.=
=0A> =0A> Here are a few more questions whose anwers might provide=0A> furt=
her clues:=0A> =0A> What was the reasons that led you to partition the inde=
x=0A> this way?=0A> What does the searcher implementation look like?=0A> Wh=
at would a typcial query sent to that searcher look=0A> like?=0A> =0A> I wo=
uld start by loading the full 400Gb as a single index=0A> on local disc.=0A=
> =0A> =0A> =A0=A0=A0 karl=0A> =0A> 8 apr 2010 kl. 22.07 skrev Ivan Provalo=
v:=0A> =0A> > Karl,=0A> >=0A> > We have not done the same scale local-disk =
test.=A0=0A> Our network=A0 =0A> > parameters are=0A> >=0A> > -=A0 Network =
speed:=A0 1gb=0A> > -=A0 3 partitions per volume=0A> > -=A0 The volumes are=
 accessed via NFS to EMC Celera=0A> devices. (NFS 3)=0A> > -=A0 The drives =
are 300 gb fiber attached with=0A> 10,000 rpm.=0A> >=0A> > Thanks,=0A> >=0A=
> > Ivan=0A> >=0A> > --- On Thu, 4/8/10, Karl Wettin <karl.wettin@gmail.com=
>=0A> wrote:=0A> >=0A> >> From: Karl Wettin <karl.wettin@gmail.com>=0A> >> =
Subject: Re: Lucene Partition Size=0A> >> To: java-user@lucene.apache.org=
=0A> >> Date: Thursday, April 8, 2010, 2:44 PM=0A> >>=0A> >> 8 apr 2010 kl.=
 20.05 skrev Ivan Provalov:=0A> >>=0A> >>> We are using Lucene for searchin=
g of 200+ mln=0A> >> documents (periodical publications).=A0 Is=0A> there a=
ny=0A> >> limitation on the size of the Lucene index (file=0A> size,=0A> >>=
 number of docs, etc...)?=0A> >>=0A> >> The only such limitation in Lucene =
I'm aware of=0A> is=0A> >> Integer.MAX_VALUE documents. This might also be=
=0A> true for=0A> >> number of terms.=0A> >>=0A> >>> We are partitioning th=
e indexes at about 10=0A> mln=0A> >> documents per partition (each partitio=
n is on a=0A> separate=0A> >> box, some mounted volumes are shared among=0A=
> three-four=0A> >> partitions).=A0 We have index size around 10%=0A> of th=
e=0A> >> content size.=A0 The total content is around=0A> 4Tb and the=0A> >=
> index around 400Gb.=A0 This content is planned=0A> to be=0A> >> split int=
o 20 partitions (10mln docs, 200Gb=0A> content size,=0A> >> 20Gb index size=
).=A0 We are using a memory=0A> mapped index=0A> >> directory implementatio=
n.=A0 Our testing is=0A> done with 600=0A> >> concurrent users.=0A> >>>=0A>=
 >>> We are seeing consistently high response times=0A> from=0A> >> the par=
titions (4-5 seconds).=A0 Is there a=0A> number of=0A> >> documents per par=
tition limitation in Lucene for=0A> this=0A> >> particular scenario?=0A> >>=
=0A> >> I'm not sure if I got this right but it sounds=0A> like your=0A> >>=
 index is mounted over network? Can you tell us=0A> some more=0A> >> detail=
s about that? What speeds do you see if you=0A> put the=0A> >> index on loc=
al disc?=0A> >>=0A> >>=0A> >>=0A> >>=A0 =A0=A0=A0karl=0A> >>=0A> >>=0A> ---=
------------------------------------------------------------------=0A> >> T=
o unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org=0A> >> For a=
dditional commands, e-mail: java-user-help@lucene.apache.org=0A> >>=0A> >>=
=0A> >=0A> >=0A> >=0A> >=0A> >=0A> ----------------------------------------=
-----------------------------=0A> > To unsubscribe, e-mail: java-user-unsub=
scribe@lucene.apache.org=0A> > For additional commands, e-mail: java-user-h=
elp@lucene.apache.org=0A> >=0A> =0A> =0A> ---------------------------------=
------------------------------------=0A> To unsubscribe, e-mail: java-user-=
unsubscribe@lucene.apache.org=0A> For additional commands, e-mail: java-use=
r-help@lucene.apache.org=0A> =0A> =0A=0A=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45760-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 14:55:26 2010
Return-Path: <java-user-return-45760-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49582 invoked from network); 12 Apr 2010 14:55:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 14:55:26 -0000
Received: (qmail 46942 invoked by uid 500); 12 Apr 2010 14:55:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46851 invoked by uid 500); 12 Apr 2010 14:55:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46843 invoked by uid 99); 12 Apr 2010 14:55:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 14:55:23 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.194] (HELO mout.perfora.net) (74.208.4.194)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 14:55:16 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus2) with ESMTP (Nemesis)
	id 0MIMlD-1O3owN06nP-004IwL; Mon, 12 Apr 2010 10:54:53 -0400
Message-ID: <237EB97F513A43BDADA0264930A66511@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>	 <4BC206C8.5070103@orcatec.com> <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com> <4BC3250D.90006@orcatec.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
Date: Mon, 12 Apr 2010 07:54:53 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX1+st1Q7TYCt3vkpBTkT6Sr5C2RNXLgXAwyQMYO
 +KoZgfp/3rT1vlqQqiQZ77u3pgvljAXVWF0zc9hdRh0O3+9e4T
 9h3Z4Ithj4PfgSGrOZn4w==
X-Virus-Checked: Checked by ClamAV on apache.org

Update:
reusing the reader and searcher made almost no difference.  It still eats up 
the heap.
----- Original Message ----- 
From: "Herbert L Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Sent: Monday, April 12, 2010 6:50 AM
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded


> Thank you Michael.  Your suggestions are helpful.  I inherited all of
> the code that uses pyLucene and don't consider myself an expert on it,
> so I very much appreciate your suggestions.
>
> It does not seem to be the case that these elements represent the index
> of the collection. TermInfo and Term grow as I retrieve more documents.
> There was no trouble building the index.
>
> The contents of these fields are the tokens (some fields are tokenized,
> others not) of the document fields.  In the tokenized fields, there is
> one object for each word. They seem to be in order of the documents for
> which the term vectors are being sought.  So these objects seem to
> represent a "concatenation" of all of the documents being considered in
> order, and if they are never removed, would always overwhelm the heap
> with a large document set.  They are not the index in the usual sense, I
> think.  Before I start retrieving documents, there is barely anything in
> these objects.
>
> What is holding the document contents in the heap after the fields
> information is returned?
>
> Can you say more about incRef/decRef?  I deleted all variables that
> interacted with Lucene and it seems to have made no difference
>
> There are not a lot of different fields, I would say on the order of 50
> with about 20 of them in virtually every document.
>
> It uses:
> lucene.IndexReader.open(self._store)
>
>
> One suggestion I got is to put the reader code in the class init
> function and then reuse it.  I have not tried that one yet (next on the
> agenda).  You suggested something similar and I will try that.
>
> Thanks,
> Herb
>
>
> Michael McCandless wrote:
>> The large count of TermInfo & Term is completely normal -- this is
>> Lucene's term index, which is entirely RAM resident.
>>
>> In 3.1, with flexible indexing, the RAM efficiency of the terms index
>> should be much improved.
>>
>> While opening a new reader/searcher for every query is horribly
>> inefficient, it should not leak memory.  (Are you using
>> IndexReader.reopen?  I see calls to getReader, but this Lucene API
>> (near-real-time search) wasn't added until 2.9, and you're on 2.4, so
>> I think that's your own method?).
>>
>> What do your get/getReader/getSearcher calls do?  Are you using
>> incRef/decRef at all to manage the lifetime of your readers?  How many
>> unique field names do you have, across all docs that you index?
>>
>> If you change your test to open a single reader, but run that
>> TermQuery over and over and over again, do you still hit OOME?
>>
>> Mike
>>
>> On Sun, Apr 11, 2010 at 1:28 PM, Herbert L Roitblat <herb@orcatec.com> 
>> wrote:
>>
>>> Hi, Folks.  Thanks, Ruben, for your help.  It let me get a ways down the
>>> road.
>>>
>>> The problem is the the heap is filling up when I am doing a
>>> lucene.TermQuery.  What I am trying to accomplish is to get the terms in 
>>> one
>>> field of each document and their frequency in the document.  A code 
>>> snippet
>>> is attached below. It yields the results I want.
>>>
>>> I managed to get a small enough heap dump into jhat.  Now I could use 
>>> some
>>> help understanding what I have found and some help figuring out what to 
>>> do
>>> about it.  I am a noobi at understanding the details of Lucene, 
>>> pyLucene,
>>>  and Java debugging.
>>>
>>> If I understand correctly, the heap is filling up because it is keeping
>>> instances of objects around after there is no longer any need for them. 
>>> I
>>> thought that it might be the case that Python was somehow keeping them
>>> around, but that does not seem to be the case (true?).
>>>
>>> From jhat, I got a class instance histogram:
>>>
>>> 290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990> of
>>> class org.apache.lucene.index.TermInfo
>>> <http://192.168.1.155:7000/class/0x7fbf693bb990>
>>> 289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80> of
>>> class org.apache.lucene.index.Term
>>> <http://192.168.1.155:7000/class/0x7fbf69412d80>
>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> of 
>>> class
>>> org.apache.lucene.index.FieldInfo
>>> <http://192.168.1.155:7000/class/0x7fbf693f1300>
>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> of 
>>> class
>>> org.apache.lucene.index.SegmentReader$Norm
>>> <http://192.168.1.155:7000/class/0x7fbf6940a1a8>
>>> 1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> of 
>>> class
>>> org.apache.lucene.store.FSDirectory$FSIndexInput
>>> <http://192.168.1.155:7000/class/0x7fbf6928d460>
>>> 1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> of 
>>> class
>>> org.apache.lucene.index.CompoundFileReader$CSIndexInput
>>> <http://192.168.1.155:7000/class/0x7fbf693ef958>
>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of 
>>> class
>>> org.apache.lucene.index.TermBuffer
>>> <http://192.168.1.155:7000/class/0x7fbf69400510>
>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of 
>>> class
>>> org.apache.lucene.util.UnicodeUtil$UTF16Result
>>> <http://192.168.1.155:7000/class/0x7fbf694011c8>
>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of 
>>> class
>>> org.apache.lucene.util.UnicodeUtil$UTF8Result
>>> <http://192.168.1.155:7000/class/0x7fbf693bc168>
>>> ...
>>>
>>> There are way too many instance of index.TermInfo and index.indexTerm. 
>>> So,
>>> I tracked down some instances and looked for rootset references.  There 
>>> were
>>> none.  If I understand correctly, this instance should be garbage 
>>> collected
>>> if there are no rootset references.  True?
>>>
>>>    Here's an example from jhat:
>>>
>>>   Rootset references to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218
>>> (includes weak refs)
>>>
>>>   References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40 
>>> bytes)
>>>   Other queries
>>>   Exclude weak refs
>>> ---
>>> There is at least one reference to the object, it is an element in an 
>>> array,
>>> but the array does not have rootset references either.
>>>
>>> Am I misinterpreting these results?  In any case, what can I do about
>>> getting rid of these?  Is it a bug in this version of Lucene?  Is there 
>>> a
>>> known fix?  I think that I should be able to do an unlimited number of
>>> queries without filling up the heap.
>>> I am using pyLucene version 2.4.
>>>
>>> Thanks for your help.
>>>
>>> Herb
>>>
>>> -------------------------------
>>> Code snippet:
>>>       reader = self.index.getReader()
>>>       lReader = reader.get()
>>>       searcher = self.index.getSearcher()
>>>       lSearcher = searcher.get()
>>>       query = lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD_ID, 
>>> uid))
>>>       hits = list(lSearcher.search(query))
>>>       if hits:
>>>           hit = lucene.Hit.cast_(hits[0])
>>>           tfvs = lReader.getTermFreqVectors(hit.id)
>>>
>>>           if tfvs is not None: # this happens if the vector is not 
>>> stored
>>>               for tfv in tfvs: # There's one for each field that has a
>>> TermFreqVector
>>>                   tfvP = lucene.TermFreqVector.cast_(tfv)
>>>                   if returnAllFields or tfvP.field in termFields: # add 
>>> only
>>> asked fields
>>>                       tFields[tfvP.field] = dict([(t,f) for (t,f) in
>>> zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=minFreq])
>>>       else:
>>>           # This shouldn't happen, but we just log the error and march 
>>> on
>>>           self.log.error("Unable to fetch doc %s from index"%(uid))
>>> ##        if self.opCount % 1000 == 0:
>>> ##            print lucene.JCCEnv._dumpRefs(classes=True).items()
>>> #http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/002171.html
>>> ##        self.opCount += 1
>>>
>>>       lReader.close()
>>>       lSearcher.close()
>>>       retFields = copy.deepcopy(tFields) #return a copy of tFields to 
>>> free
>>> up references to it and its contents
>>>
>>>
>>>
>>> Herbert Roitblat wrote:
>>>
>>>> Hi, folks.
>>>> I am using PyLucene and doing a lot of get tokens.  lucene.py reports
>>>> version 2.4.0.  It is rpath linux with 8GB of memory.  Python is 2.4.
>>>> I'm not sure what the maxheap is, I think that it is maxheap='2048m'. 
>>>> I
>>>> think that it's running in a 64 bit environment.
>>>> It indexes a set of 116,000 documents just fine.
>>>> Then I need to get the tokens from these documents and near the end, I 
>>>> run
>>>> into:
>>>>
>>>> java.lang.OutOfMemoryError: GC overhead limit exceeded
>>>>
>>>> If I wait a bit and ask again for the same document's tokens, I can get
>>>> them, but it then is somewhat likely to post the same error on a 
>>>> certain
>>>> number of other documents.  I can handle these errors and ask again.
>>>>
>>>> I have read that this error message means that the heap is getting 
>>>> filled
>>>> up and garbage collection removes only a small amount of it.  Since all 
>>>> I am
>>>> doing is retrieving, why should the heap be filling up?  I restarted 
>>>> the
>>>> system before starting the retrieval.
>>>>
>>>> My guess is that there is some small memory leak because memory 
>>>> assigned
>>>> to my python program grows slowly as I request more document tokens. 
>>>> Since
>>>> I'm not intending to change anything in either my python program or in
>>>> Lucene, any growth is unintentional.  I'm just getting tokens.
>>>>
>>>>  we use lucene.TermQuery as the query object to get the terms.
>>>>
>>>> I cannot share the documents nor the application code, but I might be 
>>>> able
>>>> to provide snippets.
>>>>
>>>> One last piece of information, the time needed to retrieve documents 
>>>> slows
>>>> throughout the process.  In the beginning I was getting about 10 
>>>> documents
>>>> per second.  Towards the end, it is down to about 5 with about 5 second
>>>> pauses from time to time, perhaps due to garbage collection?
>>>>
>>>> Any idea of why the heap is filling up and what I can do about it?
>>>>
>>>> Thanks,
>>>> Herb
>>>>
>>>>
>>>>
>>>>
>>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45761-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 15:55:31 2010
Return-Path: <java-user-return-45761-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85902 invoked from network); 12 Apr 2010 15:55:31 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 15:55:31 -0000
Received: (qmail 55659 invoked by uid 500); 12 Apr 2010 15:55:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55625 invoked by uid 500); 12 Apr 2010 15:55:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55617 invoked by uid 99); 12 Apr 2010 15:55:28 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 15:55:28 +0000
X-ASF-Spam-Status: No, hits=0.4 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 12 Apr 2010 15:55:23 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id ED7E41E670E; Mon, 12 Apr 2010 08:55:02 -0700 (MST)
Received: from PHX-HTPRD-02.adprod.bmc.com (phx-htprd-02.adprod.bmc.com [172.24.32.8])
	by flicker.bmc.com (Postfix) with ESMTP id E25631E66DB
	for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 08:55:02 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-02.adprod.bmc.com ([172.24.32.8]) with mapi; Mon, 12 Apr 2010
 10:55:02 -0500
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 12 Apr 2010 10:54:57 -0500
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrTEYxUMd1jCLutRZeNXwWEGirozAHRP6dw
Message-ID: <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
In-Reply-To: <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/mixed;
	boundary="_002_492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34PHXCCRPRD02ad_"
MIME-Version: 1.0

--_002_492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34PHXCCRPRD02ad_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

I was on vacation last week so just getting back to this...  Here is the in=
fo stream (as an attachment).  I'll see what I can do about reducing the he=
ap dump (It was supplied by a colleague).=20


-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]=20
Sent: Saturday, April 03, 2010 3:39 AM
To: java-user@lucene.apache.org
Subject: Re: IndexWriter and memory usage

Hmm why is the heap dump so immense?  Normally it contains the top N
(eg 100) object types and their count/aggregate RAM usage.

Can you attach the infoStream output to an email (to java-user)?

Mike

On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> I have this and the heap dump is 63mb zipped. =A0The info stream is much =
smaller (31 kb zipped), but I don't know how to get them to you.
>
> We are not using the NRT readers
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Thursday, April 01, 2010 5:21 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
> infoStream, index up to the OOM @ 512 MB, and post the output?
>
> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, it
> does allocate and then recycle this RAM buffer, so even in an idle
> state (having indexed enough docs to fill up the RAM buffer at least
> once) it'll hold onto those 16 MB.
>
> Are you using getReader (to get your NRT readers)? =A0If so, are you
> really sure you're eventually closing the previous reader after
> opening a new one?
>
> Mike
>
> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> We are seeing a situation where the IndexWriter is using up the Java Hea=
p space and only releases memory for garbage collection upon a commit. =A0 =
We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene 2.9=
.1. We are set at heap size of 512 mb.
>>
>> We have a large number of documents that are run through Tika and then a=
dded to the index. =A0The data from Tika is changed to a string, and then s=
ent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes an=
d not in Tika. =A0Our intent is to only perform a commit once the entire in=
dexing run is complete, but several hours into the process everything comes=
 to a crawl. =A0In using both JConsole and VisualVM =A0we can see that the =
heap space is maxed out and garbage collection is not able to clean up any =
memory once we get into this state. =A0It is our understanding that the Ind=
exWriter should be only holding onto 16 mb of data before it flushes it, bu=
t what we are seeing is that while it is in fact writing data to disk when =
it hits the 16 mb limit, it is also holding onto some data in memory and no=
t allowing garbage collection to take place, and this continues until garba=
ge collection is unable to free up enough space to all things to move faste=
r than a crawl.
>>
>> As a test we caused a commit to occur after each document is indexed and=
 we see the total amount of memory reduced from nearly 100% of the Java Hea=
p to around 70-75%. =A0The profiling tools now show that the memory is clea=
ned up to some extent after each document. =A0But of course this completely=
 defeats the whole reason why we want to only commit at the end of the run =
for performance sake. =A0Most of the data, as seen using Heap analasis, is =
held in Byte, Character, and Integer classes whos GC roots are tied back to=
 the Writer Objects and threads. =A0The instance counts, after running just=
 1,100 documents seems staggering
>>
>> Is there additional data that the IndexWriter hangs onto regardless of w=
hen it hits the RAMBufferSize limit? =A0Why are we seeing the heap space al=
l being used up?
>>
>> A side question to this is the fact that we always see a large amount of=
 memory used by the IndexWriter even after our indexing has been completed =
and all commits have taken place (basically in an idle state). =A0Why would=
 this be? =A0Is the only way to totally clean up the memory is to close the=
 writer? =A0Our index is also used for real time indexing so the IndexWrite=
r is intended to remain open for the lifetime of the app.
>>
>> Any help in understanding why the IndexWriter is maxing out our heap spa=
ce or what is expected from memory usage of the IndexWriter would be apprec=
iated.
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


--_002_492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34PHXCCRPRD02ad_
Content-Type: application/x-zip-compressed; name="stdout-2010-04-02.zip"
Content-Description: stdout-2010-04-02.zip
Content-Disposition: attachment; filename="stdout-2010-04-02.zip"; size=32924;
	creation-date="Mon, 12 Apr 2010 10:52:48 GMT";
	modification-date="Mon, 12 Apr 2010 10:52:48 GMT"
Content-Transfer-Encoding: base64

UEsDBBQAAAAIAIhOjDyU7JtUEIAAAKt4BQAVAAAAc3Rkb3V0LTIwMTAtMDQtMDIubG9n7L1bbyQ5
kib6nsD+B53ePcDuQ/vyftGgFjXdvQ0UzhR6MDXAPHQ1CspQKFOZumRKyuuvP6R7KJzuTqMZwz1c
yqwuNBopic6L8WIfjWb2/fTXv5z8/d3t7dUfxR8fXt9tz87/qP9xenK/ffjp5uL2l4fwm+uT8+3V
9uHy9ubfb68uN19+uL171Zy9O9u83jZXHzbbm21zeXO+/dz8f9vtu7/dXH35t7P7hz/fXl9fPvxl
8OGP3GmtjfhvL376rxOGNnt6cn55l2ns/uH2btv8cnn97mr711/+cnm33YTffPnxz6e//vvd7au7
0OG/Xl5t73/9089/Pvnl9uLh09nd9td//Y9fvtw/bK9/vXi439zeXFy++nB3Fvv26+b26ipUEf55
cvbh4bbr+Q8XZ1f325Pr7d2rLTLsf7t99acvD9tfLr9uf+6L/3jm/GYruxp+CR+df7ja5obTVfLn
25vNh7u77c3Dz4MPfuTnSvqL7UkY1p8+XFxs79p2/vQDNw07uT773P1ye/6X2839D3/kya9a4W//
c3t3/fiHv15ur87/bXvz6uH1D4Irq5w0yp60PfgBnpVNK5EwOw9ndw94sZvbTyfv7rbvgtThwrsC
f959c3H14f41XPqkKxAXyKvrIKMfbj5cXZ2c325+iWvhl9wv/3ZxEVbTD6z7spVON6Xdz61s7n94
uPuw3Zdov3ssdvPhuv2IxX8FiYYvOlGyUjdbUZ683F6Emrp6TwqrPcqzk8D//F+7H0/uw/T+dBMX
FNLU/dvLd+Mqbm5PNq/Pbl5t70/ebW/OL29e4dO1K9hVcvLDDydRjP/SVo9/fH57U5jkfy6cfy6c
6oXDaQsnLYYuHF61cPi3sXB43cLhMxYOn71w0umqXjjpx/DCkaHUX/4rdvQ//vXnblG8PLs6u9ls
T86urm43rba/Pz35cL897xSoZP7k4/3Jw93lq1dBN3PTFYx/tI2XqgM+2/vwCzYs2LiTl0Fgfwql
3/71brv9gTdCR0nc9b8CZNl38yT08eF1kMTJw+3JRfjkX9pOh0V08rJV4T/d/zVIBq/m7OJhe9fW
cNr+fzu8RnIxGut+dKYxgsP1Thb/b2yy9JNfZRZ+ssp36z7dCsDCl1wRl76sW/qPsurKvLu9fwhC
vz85u38c4MlvLO0FJvHbq/OwxCIQCwuFM+ZY+Hz76a+x+u15+3utvRLORxnd/+8gcu2aAH5jqf8d
vv5BisZy9f+Ghqb4O7YT10GAgJu3724vQ/f+sOvn/W/8Dyd/54/dvj/5l5PL+8d9dNJK8x+r1tlt
kJM//Maam7vrP1DKPVzek8pd3FDruySVu7h7Tyr37u4zXG6eDIFF9W8//3tYm2E1t9A/nFB9RchH
JydX24/bqxPTCKEs9zqeJKaxylrDBa2iP//8Szeu9qaClNttutOwYU43Yaf88f/8Vtiiu0+CjriO
W7RtYK8nusPubvvw4e4GPvZrDnTZGPhAdw0XvOpA99KNT/Qm7Gqsr/njWITq7Kin+77phjugXlUp
A9P4gggM1xUiYI03nqbU1D8WUWoKkSIfjjPR1mFkcJVTfcYJ+iyqo5kaTRhB1GgK0mjoRnuUWUG5
8bRDmOQHys1xrbUYKzejvOZC7JWbEo3wtlduplHa5ZWbwg5RgR2i69W5VwocVgqjcqByG5UDldGk
PkC5jeuDlOWoHKik58sQWFQT5SYQnbT/CFBujgvDOK0eim7bl8vptrB3Tjdh05S330w9J+rOeNYw
peB7S90ZH8q7sZoTsJrruwqpOdWrua6jqZazDquWJIGgPz3jsAhEUK50EYhGWuLdDR8+E3bUy4GW
lzBYqhm/bZiUsJoXVUgnoBrJaeNf6e4aemTEaLDpCtfAMsrfXQVB12trZuv6UAVN14O316qDh3Cp
FWnnsKkY6n3DDHPTS60Ip4XsL7Vh6xjV6/0AGJU+8FIrMf2yXp17fSnKl8GkHO1yKYiXVUG8/Ari
ZVqUL+fzZEi91EpEX2OX2ke9T6mHoveLd9p0+4V9FP5tzXO662IYQLsKBaCbgPNHCkDNueqqcG0E
MYDHaiUJgLNGOQFIQKhGKlMhAdsoZkYSkEHtADZSTAI+IB0z6ukABuWr1ZUiCD0UBloE8YJcAwRl
EJmioQCNDJ/HvTrq5TFQkG6CliqMn9egQJYBwvUoCP8gj3di28NhJQMR0Dqshc0+IGNoz4Q/+qja
KwTGqU8eAhZYDWzE0HfokTajwSbDcwLYd7HeKWyUBNjotJgLG7mnwsaum3TYiOutR4EWIKRMO4pN
SwIhBeNSeT4xHTlvjFc9hBSi8WKPIFVQOxJ4FhEYUlEYUlmvzj3ykjDyGpUDEeSoHIggx/VBCHJU
DkS4k3YBpDlfhsCamiBIhSC//UcAgvTh+qKVolVEgZD7cjUQMuyp003YTOVtORNOVj4bFOFke3JW
KAaXAVO6YbjlOX+qq4BmzbCjAyxVeMeukADnjdagCMIgWY03QIsdRyLgMKLG8AFvTFC1w54OZLAQ
pg6zpEGzWpRBnVkp94DGHWC7STE1CVRhIJy3+GQ4tERoBrKI1KJw2zAOolDXSH0kFKphgdWAKgzM
syYcoKPBpjdNBey/rPfdb4oAqjhTbi6q0lwSURXofrfIUf4o3QLCUmmnsTkaGumUiPfMsZFOhiPS
qj3C4oyHA9nvMZbwjZV5iKUxVa4xVb5enXtoomBINCoHQp1RORCyjcqBEGtcDoJ2k3EAEGu+DIFF
NYFYGkFG+48wiEWpiAKx9uUOhVhhg51uws4q79GZcKvyIo5Z71SNnp3araQFfCGwCzRiubMAgquF
WrL0ehUGKGqMl6Jx1Nc7AsySftTLgd0KgFmVsx+qcoXZd7Zm9vlhj5ckhIUtF94C/cGokmlUBliF
tQArVlV47OWqZrmweBGhyWs1gMWMGA02GR5zBZw6BViaArB0aGImwBKK6qu7FMCiHeQI2NLpALD5
GoAtYZhWagy2lDQmoK3UzVf73s1X6OgYdSDYMphSX6/OPUjRRNCjiWBLE8GRJoI8TQRvegbYQmVI
BVuGgJFIYItS0epgK2y2UEYVPBcXAF6V0COetYWQj3DWVqiS6N4zBl+qgbAXDj48M8N+DrAHdliR
xh9dkrwtQC9TY+jL6tJo9cH6CsIvZ0c9JYig3sjleQl9Vr4aisnTeSGGqgp+YQauru3hsJKBaGge
MgLrNOaPCQphqedaDBca7oydSNo/wq1M4YmhwBPH9Fx40ho8SPAEjKI76tH3OAcFqGLSwWAzmUIV
Y60TahqRJMNNgek9VHGskUlAUvton0cqHNOIFtOI69W51/AGRhajciCymJQDEMOoHIh8xv2DkNSo
HIho5ssQWFMTpGIRgLH/CEMqlIooSGVfbmmkEvbd6SZsuPLWXRe1cNVwrWHY4lmNo49o39PI7zIY
bhGD94GupwOtTXd2ymihoW62o5BcXAvlL8mWoIWEmB/+w7UjaqFjXJLrljXh8mzTgWGzOtRIXho2
0UjKas94r5GkCjpI9pdn10gJhBGhlzSHHX3r1bk/yi3xEmuJl2dLvIzb8mU3KUe7PNvypX2eDKmX
Z4doEvLlmVIRRSUd7fKc7t2wCUN57Y56qa61Z/OgAuAHcM1rLtWd7yjZcwIzUXderYOOUl40aq/V
pglnHCwCIWsUND2VRHqjPqKFmjdKydFYU63sC1KcKl9HUb7SznesZFTHyjWVL20DI4rYpYPE5nSg
iMOpJ8VEERspDNe9U2bAlDoJ57WN5IcasT123q9X515/OaI+dETjtCPqTUfU646o110ZT8yTIVUP
e4L6JOlhSkXPUg+H/Rj+zRAvoJk6ufbKqBvFwUfmoJFM1SPz5LoIenMuHhshwnIRo2ElyodJ1DZG
E5hptHPwHVuySsu4JwbTFMzCNTocNxbHHg0HmwxPQK5neTOup+hwZWe78QlBdeM7thn38M1PMPX6
dMDY/A5epaWPD9BjfW61Zd71+Tkka5zrbb1KNloACh21KXKGaY4VK92rQk+0zvqyNTUpR7PieqIV
1xOtzL5stZ4pRGBdTfNPMUQXk+29NTWdhL+Grzk7PTk7Pz8JR+E9ZgKO5doi8cOdLn0cxIobP+zg
UF503/794fbh7OqEP/anIHgKnFnF0k0ZGNq9TdCnl+dB83Qz8kTdDFIKa+G3M7S7YemefbjZvI7H
4kn355O//1ubk/mkXUMn/9n98r8zbAprYB3Qwr6m3XJu/zBKgAp+ul9CL3bf//DEwt/3A0p33Y6h
S5T9P/520+XN/pFbcybMi91Cf6oxoNKOI4so7Yn6V17glZYrxCEmwMIK1GubiSuqbATqBQqm0pF8
2M3Bs5IgzVOosDuOhWVtzrd79LMu0ezP3cdPPMfPfCckotqB+qcW2A45FU9KGEBh+KlYdWKW2Vzs
sShY/Kc4s5GnoJPcXdiSN2cvr1okc7e9vv0YLjDhr/v6Tk/enH08ay5vm5/+9n8/b7bv4kYOWuPs
JtwaHxufT4Hwa9fcv5z81+XVVejIHx/uvgRFGTrYYCPaC0AuLAC5rgDkbAHohQWg1xWAni0AsbAA
xLoCELMFoBYWgFpXAGq2AMzCAjDrCsDMFgBbWABsXQGw2QLwCwvArysAP1sAdmEB2HUFYGcLgC8s
AL6uAPihAjg+yNzZFzrBdIiN+CUVnmYbklUN0WBgtiFd1RANbmUbElUN0WBNtiFV1RANPmQbMlUN
0dR0tiFW1RBNHWYb8lUN0dROtiFb1RDteM82xKsaoh2jxz90/vDbWfoqQimePHpQiidvH5TiyVMO
pXjyQkQpvnvYKVtACNQd5W8fH1Bsw5hTTqmo9qIhrf2hqr6sARmmS6pMEcVtowz4QO4b72vipngm
5SjwwrAWtUQaf7cbbOIwwTzwMJvnl3hJeSCPJsmZD+SR04T2QA4TTJxFyxzjqcUvL7rCC/bLtEfY
BKQv2E5yI9w007SyrE3h+pgmUDbc95mmhW+cMd8Rw8RLItPDSyJzxEsiY8VLInPEyzJzxGAcBQaM
eTIEFtV8hgn64YtUNOZhko5JTqyI8hic4apIdm/YhqebsP/KO7n6xXLuAxOc6qY9Viu0hm7UJKWc
gkOX8CemYcj1KN0NFLlU6x7PGu0K0Vt1IuBtip6xf/yhCX+GSq/r6DFEoBsDZ/yx7UsfXQSM7B+/
eMYb1lgrR6NKnBEFFBZVi7VMw0t5GEUN1KrwRVwJao19Efkg1NxKYDHnkdaGgrScmB1OEOpYEmnR
zmoEdW3S3mFzMYgDcF54MUFdRmqtOet5vUyjhUkDAYwAYsRR7Y7ySKxX5x6tbIgoaUNEZxsi/9eG
iKY2RHS2KaPCeTKkoi6Ml2M11BUxl1GahgOXRV1hS4Y/uOPShdUqE9Y4CeKPmPOlQpnkEhsTlAme
7qXr5CA2D7hwVwLQGB9vQRcn33he49j/DGPzUprnbqwJvjaskOVsqkzPCcpUcrZAYLwlKlM4Nu/g
LUgIsDtPe4pNzMCc4bRwU4d845yQSaS7kCnrgQxqlgG8WWggF5pdf7069/ronBg4d04MiD8nBsSd
EwPszokBe+czssShMgTWVDXrwSTA7lC9ikXqOWmtsgbX9DMi9QibOuzO6A5oyxt8po6tjB5DrBym
ijzA5q0cupBoq6QhZJqlNUPHRc8ShuSoibQuhbRqNVla6Wq2ED6Hf5BXqAlrQDeoRFzaLMRgamMz
4IKJKY3p0qrg6S5YRGpQCWYn4cNxJqYeVzJVTQHJlgJIxALpbCUjAhIxB5DgZ9ejZAvgZNBrbH4G
4IS5mIhnAk6EZ9b7Plow5t1Jwv9VY63PoxOU+wdNTL9enXutviVyLW3LnEeDchROpi2Ra2lL5G7a
lrml5skQWFTVhAH7j+aik0lFEDrB8NKeXQlBJ/tyB6OTsFXD7yUr7/aZSKUyMQBCPVCneEyGM1LC
CWDxUP/EIpB5j1kIqZjGGJAF0TXM1CAVNo15qkcqNaoXwy+s9awYjjWZYAE96eQD/S8o+lf5+fqX
U9PJw4H+i+9OQuT+RToCbMIGkfvh6FJTvwfDuJCu93uIuXeESHWx4vLAyH00b/l6de512AUxHv+C
GN9/QYzHvyDG918Q4/YvZsTtozIEFlV1PvlJ1P6huhgL/9/rYgwdzAiCn7Hbw7YN/+ZIeuZnpZfD
sV2hlEzLFzjWyxqiEcb1cvJem7EgFDzjKiTQ5vYB9bJt6lwEyGTWhTdv/IO8AYEZORpUYghhElDA
teLyjVaQCUGIxlaRNYqMW0m9wGpwDCZGEdfraLD74TGQQz3vJPCKAmPs/LTzXFHfNaqdBJY52AhO
Ba/S0WBzN2B8Vl7JqXnBcaOV6N8+WvNWYl7wjVOHOhWgCc7Xq3MPBV4RnQpeEZ0FXhFdPl8RnQVe
EZ0PXpWdHubJEFhU1YnnV3Mq8Jx7j0Os47oUUPZ92MChjCqYGBdwQai0dofjWkAUue1ZXqGpXIZ0
RsdHcKyneTWjh30cOCDA2LBi7DwoMltILMhUzeh54ybAhsMWF8xYwFuDz7CnAxEAUq0Et7zjkwFl
YEWFCFjMBj2GKvHJDOvqLLiCYWQ+8mmc8ufA9U7xymsKXnF6tlOjo0aPyGPDFfzYepyBAnR5nQwM
m0YSY044EgzvkYtuvEuQC2+MUXnkIjENiebBX6/OvcZ/DSOXUTkQaYzLQchlVA5EJKNyIGKalAOQ
y3wZAouqmp9g/9Fc5DKpKI9cMCQlichlX+6oyCXs5dONK3hHJ904FMTUKnLdPk+ASqw2ADKjxbB+
Ei0UuNY3zo2GlegqEEvVa32lC8nlpKl5a6pg2ltJ5Q/597rBpsDOAQ8CeZV/SVH5Xsq5Kp8z/Rx1
PmnDI+r/Mh0kNqdDct9w2PqJ5UJ5KbjryX2FaKQY8BMFvHyg/kfz769X515vXhL18CVRr18S9fVl
WV+n7ZJwx2UZx8yTIVX/Y3QGa+t/Ch55lvo/7OuY8lEfFQtUBhXECLZSSKer8ffUjeBj27ts+KGJ
U8dEwn4UVrGMA6MU7ZtUXgTWVSp36TM+rwEiQSwTK7kxKh2UuhwN+XGQ4UdfsjpNVfwbgopXTM5m
TdDUSMXFfBkX39IEN8g3yXix6U2UvZRO64znhbDWsxj/vL/tN970nhdORHbwA70g8cz8K1a6V5Nv
iP6Nb4j+iG/K/oiDdin+km+I/pJvyv6cM4UIrKt6zgS6J2RFTZWcCfHLImfCevs+bODTje5qJFIm
PI3n5uHjQns3Zkx4kl7uUme/RXtLJ0zg2ATWADWgBSDfFU6Y8OiP1X73Yk+Y8KSyf3EQX8LWnptz
/mLPl/AkQ0BlHQcW8dnTdK+8uitNgCUnrQ4OVmBe4bKpXBhEdYpa9YIKUXLY1RT4G0+aqj1jgmKe
DRgTht2pdFcSjVagLTAGodd4K3HZWjBJxkDMz2hgDO16ObguFeKnK4bPkRujlzVO5zbeDmnDx26L
okkegKe3xd7nHlw0Q76MJ93kz/sgzLFlPElPkzMxQuailoSRMwaci1Un4B1LbhqL03NEv1k3R/Sb
Q3JEDwRwtrAAztYVwNlsAVwsLICLdQVwMVsAlwsL4HJdAVzOFsDrhQXwel0BvJ4tgPOFBXC+rgDO
Zwtgs7AANusKYDNbAK8WFsCrdQXwarYAtgsLYLuuALazBfByYQG8XFcALw8VwPFB5jD3/hss9/4B
8DTb0FlVQzQYmG3ooqohGtzKNnRZ1RAN1mQbel3VEA0+ZBs6r2qIpqazDW2qGqKpw2xDr6oaoqmd
bEPbqoZox3u2oZdVDe2P0QVsNrJRpmCzEaouc+KCNpsYAjHs5cBoozBxHf/Q/cNvb1H2j1FxjM5j
VByjIhkVx7hFxsVvqjqze0ktG4AOJQvZf9u/HEqjZPtu6BrOwz+r6qokCqndNrrxomDq9b7G1Msy
jiGEbUPyk8X2Wdf2cFjJQLQGbMOVpvHocusK0TGyxpNmmcjnGicazMDe9Wg41tRXigGRMflI3iuS
D41nc31ohJwfyfu2pTAuJBghRONepT3CJmDg08qt0Xbi02qlMG26/ccEIzETae/mokRjND8wGhcl
8Fivzv3RfEWMdr0iRuNeEaNsr4hRwFfE6N6rGdG4qAyBRbUEsQpFUSGVjJOLGOUcp9VD8RbJhOIm
GzfswPji8szCaYu5QsKJWqEwXJtAeqgwBJwrBHOZ5I3r81HTc4XUhpbwxsgSQ0ZVtlFJJyPDYkJ4
m3ll2MtjjF81XJXGr2tikQSdIYQw/iS0qOvl4DldYDqMNv5wJsC5YkzruUkfP6NfzVbDTDxZRt1g
0+ktQYEpZrqmYCYp7FzMJC01tIiEmWhHL4KfrtPeYZMxiAn23isxyeSuhZJc9slSrQoXmoQihTVO
yQPxE0rFsV6de9xxTcQn10S8c03EY9dEPHZNpGa5LuO2eTKk4icscfqq+IkC5pbFT2E3nm7CNvxm
sFR70lYoEt2M1YhqguCxjoKqVJfY6VCaTdL4I14UYHoSFwmfKgTA2nwiz0uTxtzow8EmWNloAJDl
NekNRZNaNjsvB5fuWJqUtgkRrXqT9hSbmIFVIh98ow2TTPRWCaEblxKP8UYCgbbo4Y3ycKxX514Z
3RCV4A1Rqd4QleUNUZnfEJXqzQylisqQqlSxfN+rKlWKhj+eUg0b83QTduRRFWzlVTVoLl3ImhEO
4Ar9oqe8IAqOEsUuq13Sy0E/Bxq2wFRRIYA2axB0VxUxm1XNe4hoXcXH2a+gWOFCnCz+QZ5Mxjs1
GlkClwxDbdQ0mZmGl6IFqnKmscM4644KSpjkw7EOjFeFi+oUk9xSMIlTs19ElshtutgZhuCT2wNz
mIZbvzVumgnECM0t64lRhWrBeULg5gRA4IYqQpSKY70694r9lvjKcUsEHrdEIHNLBEa3RIByO4MY
FZUhFaBgSdBXBSgUtLQOQAm7dB+zgraxHlgpWgN4zVO8yQSpSdgegKGVwdNC5mUFsAfUem+Ek02B
PG5xOdagFZ5hR4kXcqyrRLSCOXCINlvqcGSJzARE5sbrZCZE++ACIDzTaF7zICeeG6OMTNHKbqz7
0clGQXnOeBauvKPAlZhmcy5cITtw8KXgCn6iPYq6AF3epSPAJixNvy7DvrIdq+zA4UN5oY3s05r4
SK2cmlaEBmwrqKcgylyyXp17lf+OyBTzjsgU867M7JKUozHZvCMyyrwrM9TMkyGwqJZglKmHLpNK
xtDFKqOEwoHU3rcRwS6JD+QC2CVs2fh7ZNc/HxzTHdkVCsm1TBxjHOPwLKF5deJSxvIpjoE8BGp1
MmuMhTwkhG6YrTEhyGemkBOKt91A90ML57kvMAVPFfJ7gkLWXMzmfBf+KfUxbZciuvl9Mhhs6lLV
zI3VjE1ePcJRaZ3u84tG3tXeqNC+Ph6omFH+jfXq3Cu090TF955IzfaeqJjfExXzeyJweF8GDvNk
SFXMWDbvdRUzBSY8rWIOezd8678ZHd2e4jUKKqZqmbyMGIgyFdPRJvU/y+joZWwNulEWooXhtiUj
oUuAZzjvBJzLHDcdqD6LatdRigRq34Yi5S0ognBTYzV+nNmc8nAiWcJbj7SjnlKQWu1bT2TvAS1O
ts3ASpcByyyD+sce/IO8hU5zPRpWIjACL/JeYB0I+TF5I4p5YRNTpHXDzbETSftHuJUp+rsjoT89
O+28kFSCXzjt/Fq6gJBq/i4dGDargwcmF84OPbHSaM+UlX3yWcVjeFlvpdHR8HpgqnmU0mS9Ovcg
6o6Yav6OmBr+jkhdc0dMIX9HTHF/V05xP0+GwKJagmqmHgxiaeb3YBCDpjMSzS9/AISdHKspMGYu
kFy+EhREnxBQIUo7OfoRUKDoEaEFd5Ea+wUGLKKjiB6NNkG+oEuhyGqwe4oGk/MfFMgumWJFBYav
38fJKCiz+2SM2IwOzBqaeS4mtGnhQHHG6YTEvvWzetRlOvzIAGcJNF83Ss+xXp17HXBPzFN+T8yj
fl/OZ56Uo+VRvyfmeb8v52+fJ0NgUVXTpuw/mqPLJpVE0ismmJexGtsw0/6Aa9Z9QmtElyWJr9fR
ZWFTh2oKTlQHpeIeVlFpkUfsHbwqA+4kZFXGp36snwAFbOONG/YyveZC3gq111weVyd8zWWu5pqr
6Uodv7UmfDG7Xg6u+cArdCWqCVVpUbjmW1sz/gr6vMV9YIcxvt2wkpt50H5YvTSBRXfawoJxokZg
LLpJzxbYkiiw4/EdDjYZnoCeWPIo8IGCAiMN/UwU2OKdZw0DSUc/gggf0vFi0zuI71GcMzsxbxhr
jOYJk64Lk5/4z7rGGXkgJMQpXFasdA+mHojg7IEICh+IIPOBCB4fiKDwYQYoxIVIRYU1lDgrwEIK
SH3usDBs8lBaFLITPS+I2KmECo1nGx7uoGOUCAYLYShRpF6QGfdbQOlXPolx2VgPhuOaxrsaD2SR
8dwBJht7Dxvkddn1coASgTja2vG7hsGPQb41FdHHz+iJXQq+xzWgBxNjFyA9HOx+eK4xkAFGZ0HP
Bwro0Wo26BGME0GPfnrQgx9sj5NUAEAf0rFjU50CIOecNW5iE9PWCq9FbxIzjWa9TUxGeA7YxDSq
ZkkJO1eqdA8cPsAAY1QOBCyjciAQGdcHAapRORBQTcYBALkFhAisqykAwrDL/qs5AGhSCQSAUDyW
1HQSmg1fc06jKIxfFikK1zo7wiEQiuy4eYgMhZoI/Pblnhj4pWNEezpmK3yKTu6oiz6inaWTFQps
LmvgL9DCvqbdqm7/MCIrnILvCtxUjLJvcUUFbNIZHxoV33CwrkJ+RMUwe4SX7vGW2UruxZ6u8SkX
34uD2BqFF2fnmxd7tsZns+FBscdBRhz8JL0b7/RiL7ePpIXc7N4d0c82rS7+ufv4SUf47SyIRGa7
28PTdDRZGxGVFc8NEJyhWXGLVSevphizQSz+E5m35X5d3pb7Q3hbBgJ4v7AA3q8rgPezBfBuYQG8
W1cA72YL4HphAVyvK4Dr2QK4XVgAt+sK4Ha2AD4sLIAP6wrgw2wB3C0sgLt1BXA3WwBXCwvgal0B
XM0WwMPCAnhYVwAPswVws7AAbtYVwM2hAjg+yBzyYd1jfFgHwNNsQ++rGqLBwGxD76oaosGtbEPX
VQ3RYE22oduqhmjwIdvQh6qGaGo629BdVUM0dZht6KqqIZrayTb0UNUQ7XjPNnRT1RDtGD3+ofOH
3z6inGmj4hjf26g4RuA27gzCyDYqjrHJTfqOELjF8gRCnPK3pceZirqyxmSYwK0yMJnrxsGOh66x
qi4F2MSWDDyopkHJJEdNLIpZpJlGdqNKfCkUnsSBJi/TCFny2dA1qUYYnYxlpXQjXY+Gg02G5wzg
+pFPN/KJ4rNglZnrs8AFNV6HmG/k4+kmWpdTQ2lejgW3gk9p97DZGPhVMmEzfpWaOadUkpfUNNLa
vVuB8E34+4E5RFDWi/Xq3J/Tn4g5Oj4Rc4N8IuYa+UTMXfKJmGvk04wcIqgMgUVVzUZCyiGCsYhg
OUQsM4YJg/smLJVDJNnGYT/G54WCq/TzygrSHbYVusRkdEkkeCxkCEACH5wddnTgAlhIO1UhAS4b
40Ha5bDwVI0LJM8xkjQgFxSmC0UaK7TrKUUGtW6QYeZ4AVI4X7MM2BSCPbUX5IDdLA41GVw4Y+Bq
p4DiMwVQODs7f5lkVEBBdIKsOokIPouf065iEzPISWG9NmqSnsxYy3xCyqJsWO6up4oN24gD4AL1
jEPZP9arc6+UPxM9Bz8TPRE/Ez0bP5c9DJNyNI/Fz2XPy3kyBBZVNSsLyV8RAxcZf8VhTgoZ0AWX
tIoo4ALz2wO2dNibp5uwKcvbeybQEJUqRoSLPKhmYz6PCg0jGzF1tG/EDOqzhEW062iqZd0ywQYi
aHMLMbNIFVBCjdccZzG3+7PSs5wNMoV2w30coJCN9kBsb17TfiFoWsPdfPYzJVbRtLRtiWjdL2m3
sWlKs2coFpDpNBMU54YL6/usoGH9u5Sh3YV9BaSCQo93lNNivTr36uoLMVDgC1GdfiGqyS9EtfuF
qO6/lOHDPBlS1S6WIvtYajcgQa/0Y5RA/DduX1hR6YZtGl0QxVEVcGVCCCRHt/Y1Cpjn0l9K+KqP
JYVwafrLo5GN2Aa848ZozxrmUdPyfFYrXzTSM3aRMvJa9MWbSLgNDl7LGiOHbh86SIPHoJeI58Go
lwMDBzD+WiOPallR4Gwgpib7raBnA8ENPGlWiq6Xg/EDOr52/D6yz0C7nzde18x/l8KlevwzkCcu
RmbEaLB7Mfpov4LrnQLPrxTgKeenqPdU3Fn/ZHS4ZiI8K31NRoDNVwpBmWBSTxO4aR9u0L7nuI9v
fn7wqiQPfFNCiUnWq3OP274S33a+Et+UvhLflL4S37K+EolqvpbfnubJEFhSxyGMwfBn5k0phz8x
E9SRX5SgXR626+nGIxt+dShqQLpVX/naoFrStaEyCoAG62hej6jGcjfs5kAboynfSOPnshEKyjoR
tLGqEoDMZJ0IvzvwxckMnFi6jg5sYag3DU0ENkqzEEGqakTA2mwhJEBS8PqpASTY2yUbUAF2g03x
pi+wMk4BCWcURKL4Al4skghJiGnTlz6sCLnSOUuHg03fIJkGYy6c5pOHKeedixRWfTax+A6bZBOT
h+ZKRwla1qtzr9g5IyYtjwVJWctDQVq69FCQln89FKQldG9rPDRjOipJYGVV0+eQMqZjMCWTMT0H
UzCT3VL50g/f+XELx/KyfAzMxCyVFhQkV5j1NbnCTIYiXoEqG7ehFJl6IdBSaTwLWECCqbJE+GON
wjaHZcrKmw7j+82wkwPAgjo+0oavGyWgx7toPmQ14+ct4RFp/AULCv5B/rUzJqobDms/kLAyIQb7
zIbptPCANobxtDLrhkbVnUjaP8KtZAAQpwAgLf1cACSpmcfEsfEP4RR8nJESGOLJ0LB5HTrphLlT
E1uNNTKcL/1roWpEn1dVReIqgNwXjSJB6UnWq7NHD5yYVrUtSMlvGgrSEqaGgsVMqIMaSSldQ8Fi
Ttd5kgQWVjV5zIGxK0gleSiEWY/2sS8IFEpiZI4JheJuDh8UsmclHTkUFtWqRd5mkofdeqoSaIoM
LGgfG7C+gn49CaNc19MBMgI0Xa0tI6g9U3hcc6oGG1ZAg5VsGUPA0A02mWIDPQIAtgxBUuWWzVXl
ThNV+dFNGZW7mGLjEMkwsVkd8sEFDT0N7LGMCRlNbr0TkBWJ7y2PiYwPtHGgXC3r1dnrQkG1SAiq
RUJQLRKCal4RZdPFoMaSHWaeJEuWhhomnTVtHBR7C0Wxr2TjSI+EuLdPN04/J9uHb7wuBQnxGtch
0aZnHAcJHWr7GJCjdP1MNTykmiofrLhsNOi7HClja7xHeBbkKCgVN/ZkJVpf6EFHBxgHVQ/F2/xI
06vK2zwAASQFApgwkpkQgHMqe8rTYQDahsfwgEzHjM348J7vwtKbvnmE0UjTR/pyF5ZZQhBrG+2A
BOKoysF5OlastNeikgoJJFXTS6oCl1SQIanYQc6ABLgoqZgAzdu9JijALA/fCCiImz0U4gXCgfUR
QlhvDvQvjDk8qnJSiOX8S1sGllEvBwABUI+1jyM+3PJL/pV1KUzkNIYY6+YsCwD2xtLCk9FY96Nj
jSqxsWTUv6Kof2tmq39F5YBfLq7nyDubECDEVTJ+bLoH3pmOc2vNxDvTOMsSLrV4LMveOTMc2MIc
GB6E81WsWGmvOxUxQqgtSAnpCQVpMT2hIC2YKBSkRSfFggeHCeGiBBbXkfhEMCBADBTCLBVPFCg0
67iI+z60XSDmXiDiKHNnPNRlotMaFUpRZ8ziPrr9YV2FSHiTW3Mm4AiothYW8daMCns5+pqYI56J
OVKHRz3LRnk96ulABoUX+hoZqMYx0HHCtfE/dBmwZgKNRHyewLpK9J3AZCYanwChbmSJzJQoBDjX
yMy3nhMgnBS6Bk9mZPa0cHLoHNuNNT0YWFWYONcUOOnYbN8QTnYOeYZ4kqYgMGypU2Fgkz8Al1ZJ
biY5X6wXzmrXm5kinBy41gohD0WXpLykK1XaAzJNxYKaigU1FQtqKrDVVGCr56BLVJRkdFkNDI+I
LlGbV1LPSWg0fBy27DJcdSueIfEwCH+QT8JX91QH52DQaNfHBHZP1dEdfRH0RpP0mM5iJ7EZrrll
AC3sa9qt9/YPIxY78NP9Cnux53B7cvm/OIjITZ1fcP/yRZ7I7VntBHAy4qgjlnyyHk62QLGr2z29
G/dqQO82XOyVvnK6cRa0EbewtwLUq+jZPkL14VJ7YNRf+LKPe+z6mV4FXZkzMcpt02rvnzvpPf08
f8ObJZHk7nLydJ1N902EeMXjFkR6aArhYtV7tPkFpSqIxX8iM758WZfx5cshjC8DAXxdWABf1xXA
19kC4GJhCewqXE0EXXvzZMCXlgFfWQZ8tgw+LyyCz+tK4PNsAXC5sAR2Fa4mgq69WTL4tLAIPq0r
gU+zBcDVwhLYVbiaCLr25smALS0DtrIM2HwZ6KVloFeWgT5UBseHnUNurS8Yt9YBgDXb0NeqhmjA
MNtQh0iIn5IRWL4pXtcUDehkm/pc1RINTuTHJKtaIurtbFOfqlqiacf8mFRVS0Q1lG+K1TVFO+3z
Tem6pmiH6vEPoNAVg1LdjctjXHfj8hjZ3aQ8wtQ37T8uyrT87omsbCghMAyVvy29BlXUlbVSw/R4
tf4TkdGNw74ATtQEn4hM5nwen+Oxvs5yCMDcKtSQoCWONwmv0RDLTaw24w9gKf4AXs0OMI3MZyR3
gK6fde4A3ETrnC+81z8KtfReb5POYlMz4H+zVmk/5X9zLgiu9wUN6szy5LleNhyIEkUTDKBMIOvV
2R9ElprVwVJzMNhyDoZBjbQ8EZaaJ8KWc1nMkySwsqp5WvYf1Z3NSCVjEjjjPdMEErh9PgXkvXpf
jvJene7suEVPN9aWd3n1g+r0TbZC4RSzc7ancYW+MRmSEhHpVrCuQv53wzzx4/yc+Voroz0Fa7SD
8jkIGXpf432X07jAXKehnjO0LR4xGiNwh4NNnQshn1qVV7eOoG4tC6poprp11FhONVPd4pvyUcIl
1euSjmPzlHrKcR117CQg0zJlmE0CMmNelET1hk0FkKMp7HBH2UDWq7PXVg5WveOCoP4bFwQ16rRp
QFGOC4LKfNI0BA/mSxJYWdVcLfuP5qjeSSVjijRlvcF97RRR8e7LzVG8cbOeblwh7Cpp5lAlXKmD
gm7ToApqz+gKFWTb8L2xEvaHZhwwKWFJ19GBswiaZ44kgXC34GBSpTBGVgNDiAoYu6cOsk10HaSM
vHLuQ/81TPAed2VNPinWZm8iDX8l/MEawcxosMnwuAGiSQH84Un4w8/GHzJ0en0AQjucMDDi01Fg
szYwBEjF1TQNpJaa2YSyQ/vGmz4RpGSN00BUKKrwUHKI9ersNbinogxfVvVpQSLK8FQk5KlwxJeR
0DxJUuEIlnxxTThCqeZJ4EjcutHdzxwVm1QbCKQsZEIO53eFetIZA4GMbE5YVyEN7fu7bdfRQUwj
GhFPkoBtdIlLz/EaBd1x301iGiFXXkwCLmAUNezoQAJotSQJiCBbBhGqRRsJr+GyFW2WDhJGWSlE
UaSUwLvBJr7avhT9lsEoZxSMopici1HUMSMUFzqwKHGGZ8mIsAkcGE+EF0xOSW6ZdtLphFu+5Yvb
p7f0jWVA3mo0jA0liVivzl7Dn1Ej/c6osYNn1JDAMyKtfShIjG88K0dMzpMksLSqKTxIIYYYzsiE
GAqrjBaPMYai/QF/RjlKoF31/o8bOdRGi5Y7FLzIOsUVbSegYaU92Cv0lp1G1odJgkBG31MoCMfq
YTcpxoVas4pqwhkJp2PwVck8JZ0JFLOtyBYIDns5AC6Atap2/k3jS+MXVVlJWIYGGU2/OAu4YIuI
RRLm0WATcG6gNzKZBy4vScBFzaZC5ZzKhSrXQC74yfU4DyUU8zIdHjadA6uL49awidXFCMmiLti/
Abk2t/ze6qLC5QeAMaivGkrwsF6dveZ/Sc2L+ZKaF/MlNcnnS2qSz5fUJJ8vZ6TkRCUJLK1q+o0D
feOQSiAYgz1J7b3rEBiTeOEdGcbEXR0/F+WTYSamqQwsRrjJTKVKn97FWxMF1lXQ2aDn4Jgm2kL9
QEgCCAchc2CCbt+4Knp7nmFne1prRMcJMhxsgllsnTFiQ9HpWs8mE3XPyhhRuYspVopNMlRsYgc8
o97ImDN+rN4tY1aIlITD2MTFQzdSAjm30XswSvOwXp29RtxQUyFtqMaHDdWmsKEaSDZUc8ambEmZ
J0mqlYKS2nK2eidbKbAnnudnpRgcDHGHhy+Oa76o9A0oOmdGTVCh54Km92PmdA8/PGDP+qG6gVvI
2DcTTVNJEkA4FLmCHh6Cqjeqyi+kcRMLjqKFQ+TjGBLPyl1PBzIA4E6tDGTjS4CPVWWSYc3EhCFg
2lRMBLylYh929AgvcK00wWUQ3YNqdgJrl+4I8cW5xPpKTCuK4rvRsBKBhYFgE0ETmGkK5wavwccs
c24QjH4z8DG26NjALyuONNkNGjrQgPChcwo8jsSCM+ExN2vFDx1bDVIikc7TcWOzPAxFElxO/aG1
lcrq3gNJxj088IeWhh8Yi4QToKxYaY8wz6nRSOfUkKBzatjSOTUa6Zwa33Q+IxoJFyWwuuoJao4W
j5QFzNgj46rxSPNOirjlYyvHDW2qfPxBDGWtbZ2sBnWGyE7BhjLs4SYcWH1S7IyhDHhAqDQVRrY6
D7ouqdaZmy4ClYttiugA6+ssNICZHPUgSXs34BTrQAnzeR4PbCl4wLHZT2DCeCIe4M8GDxB2+eNs
lcDBQAjYpA8saVJJLyeWNCcYk7yns5Wqkd72/j6qsUzmwQFHlQ9KirJipb0+3cLgYFwQBAfTGgEN
PS4IgoNxQRAcTGqEcMkCogRWVz1pzf6rOeBgUgkEDrCnO04EB/tyzwQcxP1/ugkbv3yGzEQK9XY2
GCm0OqRCTfoMd42EiVswQ1sM3So9qaGuBiQJ8IBlSqS3htdYWHKsvwRHGehF0Y16OTCyLWRhMk3U
LKCh0Va9qgp6FNZKb4pdj4aDTbGwqXtUvCCgJMfsbA9nyb6NV8U5xx3l7fEilQi2Aob2FB3g0ZSJ
RVnBeB9frkQjer7f8BOzB9P8oUQfK1bag4wL6qPiBfVR8YL6VnhBffi8oLpnX5TfM2eKElhcRyJi
wRAT+f2R8hpKQUzP4P0RPkLiWRDrem7PlEVDi6nBDrZ9Uhq/UEHE9jh6kr2bdQY9oVRyJAFEgMDA
rG2+EVXvUy4TwP+0Ly6ufTgdDnY/PBY5YeF6M+jhFQU9SDvbxsLZt/fmMmvrU55mXqXiwZbDgNTN
6OioPLG+BIlwbwZZ4mJg2uPTjI+G1kOfZkg5NVeqtFe/r6hPM6+oTzOvqA8pr6hPM6/KLy6DGkuv
QjNFCayuKZbAYMC6TzM1L0UnodnwNZc0Wrf4ZZHWbeWTJB4JoRjrihGp3b7VpymiGNDBjMnenrKz
j6w9r9Fe0wnfFDbvNdgSaGFf024ntH+gEL49Zq1ov3uxJ3x7FnPw4iDSN65fWrU9e0FgfXt+mwSc
oyiICEiftJfI7ljwptMB4Qqcbxs7eU8VzYEXHZ0a+KYXHUuare2eCk/v8v6in21alf9z9/HzmOnv
ahMl8t3dfJ62w+l+ioixeEKDwBHNMFysOgWvWNr+WP4nOhfKq5W5UF4dwoUylMHF0jK4WFkGF/Nl
sF1aBtuVZbCdLwO/tAz8yjLw82WwWVoGm5VlsJkvA7u0DOzKMrDzZXC2tAzOVpbB2XwZuKVl4FaW
gZsvg5dLy+DlyjJ4OV8G50vL4HxlGZwfKoPjQ9AR6dQrjHTqEPSab+qirikaSMw3ta1riobF8k35
uqZokCff1KauKRqyyDdl65qiKfB8U2d1TdH0ZL4pV9cUTR3lm3pZ1xTt1M83dV7X1P5wzZhsap31
WaPAWFfBGiNrvBA1Pckm7mGvjBv1cmBb4pi8jn8Qh6l4jfLmjctjPHjj8hjP3rh88vhHKo/x7E3H
2y898AMCKVP529KDW0VdWWM/zJtX67+pG6kkHCHsTU2G2vn5YPAPsMjgOJxkl4UBYLt3L6ju+f/H
xN2TqVQYxgwjn3aSaP8IN5Jx5LikOHIox2c7ckiqI8cCwTKvw0+6lAyOEuNymfYdm7jUYdM47gWb
JoPzXgvZe1lEIifZp+BXvNEeCIBFYyhQzpn16uxPt8tyUMigIC0e5ZIaj3JJDYW5pEbhXJajcOZJ
Elha1YxApPgWLBVtLr5lmII/HAfa4mR8a8S3JDs9btnwkyw8/y8QllLrVsgD1gKzlwalZlWFUpMZ
x0oWE+hjfYVSf8TXy2FPU1ToBXbs0WRgGyVAxe4braoUeyb7PgEVz3CtxMB1OLhHQ00Cj5gqKP2M
Pn5D0ccxWf9cfWzUk+hj4i7FlPObdCDYtA0CUIXx3E2zUzDJFe8ztUoVEyDtlbOIvAwH6maUgGW9
Ont19oaqct9QFeQbqm5+Q41nfUNV4m9mRJ+ikqTqZix32rq6GYvreErdHLdv/KxAlb2Aoq6MnkTi
R1mVjtIxp/wkftRAeY3wAEpXioCwMl9t7f07jBKMnxSiMn5UPrucrDG1mR8NNplhUxk/+ZaiqK0T
sxU1OdH6AvGTM7YsJQbyLZ5fPR8D6TwXYpqA1QZNbtIErKaRKmG1s413/sAgSJSIZL06e033lhqw
+JYasPiWmlf1LTWy8S01+vJtOZ5zniSBpXUcmhhMbecCIAdqWxvFjcWjH9YIgCSdAXEz7x0S0T4c
qsNVnQZDdLipDGKcMqXImD4J6yqkfVTKczfW4R7Q4ZXmBt12GrQ2uBoQYw6LYQRoeJ0d9pEy+EoI
52PIeyH/RQ1PjG6Te5EGj6O3JKF+10fK4CtnPr4QGCh+lcd41Bq/dt6S0pCGv1L8Kk+5lrqxps8h
pSjgDHi7ooA35+eHrwoqeFsgfHWpg5sSgnqVDhGb0eHjiGKWTewv0gqlmUjtL1L1CcDC9YNzIJ0F
GuKIcrGsV2cPfq6oUaBX1ADUK2oA6hU1iegVNQD1qhxNO0+SwNKqZsohhZ9iSC4XfppFcpSKKEhu
Tvhl/YEQd3b4QSCnw0xYV2uYiI4zhcRWdckpWEsUO1RtGgrZwmwKMWmxHPVzoNzR8HyaBHibHx2U
gJA1wK59MZog24Nz6IuWmnXY04F5CiUioslAtbIGAQ7nNfgutwrEHNIkP0hxFntKkUElwhWy0TAZ
pq60UrIpGSYB4s7AeBhSZu3NYDjW/ehUwxWANAAqxGsCyPOMz6ZN4oqaB3YBKsSjnOkUbsTrdLzY
/KZJR5TRzk/zwVsntI3n1qPtzodjKckHHwC/BBAfyr6H0vOsV2cPkq6pTIbXVCbDayqT4XWZyXBQ
kEbLeF0mepwnSWBpVZMnkbgRMaCW40YcID4vtbS4b84a1IgzD4e4y8MPqpDpcAGuxAWNep1SqFB5
JhOv7yJ+wboKJdXyvVs1/WGuFvlEz0DQh8g2rDKxqaea9TDUwyNoHPVyMH7UM4M2/jBrHsT/rhGm
xoeK5XyosH7Ogj2YGNlAjN1gk+mFUA/gQHRDQT3hBJmLevTT+PMe6Vyj+BzdJGPHZnqQwNVwZrWY
uBxpoYXoc97zuDJtCoCkPdTnCCdcWbHSHjXcUD16bqjuSTdUZ6Ibqh/TDdWP6WaG1xEuSmB11RPi
rON3tANBFCcoCgg6utsR8bCIu/50o4/rUlxpDkNStVbhIZExg7S5S7GeQmYQUfJTyldaawsLfRYO
RgOazbUDqUguiPUVeuWVCZli19OBPRBG1TUikGHDFV46JatZAyzz0M1hcyBmxBED6uuup4NVACyD
WhmYRuqCDETVcy/L8SJh/ZwFCjExdj0aDnY/PNN4yA8BsIXdUlChELO91QSXRFj49LawypOeYiS7
TQWBTfwAI3LN/DQzr1ZORQvlI0ZUrLFigBG9BTLzomYYnHdnxUp7WHVbtiwNC5KsX7dU69ct1fB2
SzWT3ZZtfjNFCayuel6kVQ1lmMfdt2YoS0+OeAScbsLeLx8jzwgwtqqkQlPqDPOygt3iMMQ4YJ+e
QkacXI4kgVCVKWAF5o/zbFawH+EfAJaiBF62g0omUjjgFbtWWqaxsCuZDSqnJosFOyyLxQxohUsx
0mEPB5uiZ8iXDDC4vaNAKyVnG9yUIyKrZ2ZwqzwfKZa4d4lQsDUwQFnaKs8nljjlhWVOp5Y4wfun
SBFjRQCUhVt6UK6eFSvtgck7qiXuHdUS945qN3tHNdm9o5rs3s2xxKGiBFZXPZfSqpY4zBvuW7bE
DU6ReByEDrnyiTITcdXaqMKcQG46nYapUKAq82AXvWMPdtfivS9+19GBhQo1/dEkIBsHQ64AOis9
lcaIi8Ok1TjktHbUzYF9aiEbnW489wWnxUp3tQyIirxYWF+JwBO3Rvk+emU3tGQ2NW4s3Aut0+uD
zEbpe2eAY0Pj5U4q7d/gRjK47D0Jl7nZBJeOym/5jC1elScqxRT2PhEQtjiGAQLW6Km7mNbSK+F7
jKYbKWVvCRONE/JQSxjKgbRipT2seU81cL2nmszeU13Q3lMtYe+plrD3ZSPcTFECq6ueo2pVSxjF
f42C0Z69JSw9UeLR8MhegQ5nJbymg36FHIx0UFBVFjLV+sOTDB4rxc6p1K+6G+t+dDwgHgBFALFz
dxS9qs3s2DnqQ9KTRM4dfRNQgvDueln9txcnJ+8+xLycF5fboA8ti/9Zxn+7DSt1/NdNaOJh+5+X
11v4u5vbXx621/Df46K/H/859Ovuy0/n41+H1TH95fXt+WX413muG/dBF1yfTb/ZN//7G2954ycI
SkvGtJxaubhzXGrL9xCKNdwkb4m6UR7wN0OD+DgpA/BKlfag444aO3lHpQO9o8ZO3lGjMe+ogaB3
5WjMmaIEVtcUQWHg51hhllooFW4GsRobKT/jDwT3t6Smk5O2E1wtxfK5sqKIJ/7ppivyjEg+n1R5
JjJBRzZh/Hy6vj5SsGHBwfE/KuGnxtZADZwGWtjXtNsU7R8ohJ+PCX3a7170hJ/PYApeHMb3GXq3
ZZsX9Xyfz22/gPMVpXLZkn8+XScnG6XY2578kjkzIL8cbolKY7Z0jQB9DbVojKoJQOGN5ePwawe7
nKbm7Bl3RNQqLhvbh7LvRvw4xvCjK3l4ZG6JD7Rbop17S6QaX/U3fkvMbNz8BJcujA+92H5/F6jf
23jLp0ByYVQsoHI+dT7lKrpFxLNtf2FkVqYXRm2BCG00fx9Hc+KvWGl/x3qgpk18oKZNfCgnOUwL
EvMrPlBzQD6UEzHOFCWwuqYXRiwwev/VnAvjpBLwwoj5wiY1VV4Y9/AYuWwlMPqbvWxFZRIqKquj
6lvHsIrKF/dwOhnowb0DMFUgbRolLEwkaMf6CnhdyDQFYtfVgdsF8IBeGSwvG8+h2CjBQjM1nps8
ExsVHSag9wIsWl4PezkY/t7pAsT3m/YE+rlD+U+69B+vJN/szS+zeSli36Hyp+16ch+Maq1obAC1
G5r0v1h1r2FvUZbCWP4nOi/r7cq8rLeH8LIOZXC9tAyuV5bB9XwZvFtaBu9WlsG7+TK4WVoGNyvL
4Ga+DN4vLYP3K8vg/XwZXC4tg8uVZXA5XwZvl5bB25Vl8Ha+DO6WlsHdyjK4my+DN0vL4M3KMngz
XwZXS8vgamUZXB0qg+ND0BHx9S1GfH0Ies03dV3XFA0k5pt6V9cUDYvlm7qpa4oGefJNva9rioYs
8k1d1jVFU+D5pt7WNUXTk/mm7uqaoqmjfFNv6pqinfr5pq7qmqIdrsc/iEJX7lHu83H5xIJOKo9x
vU/rL3PJj8tjXO/j8jvretl+QuAJLH9bsopPTeu0ukyjmFJa2844znX7Q47RF6wv6wcCc8FXhqD7
RjAo46WQDa95bw/Fp2ZMQgR6zoRp0ziorpOD2DE00oU0ei4aKcCEn5HIqCZ+kGVynirYiotZsgdE
RrueDky5QH6nSks27wzmcH4nVWPKzslARJJGrK+UlPddT1MZuIVSnYUVBhIyskbGkPUKEahJ1v+n
DUtgCW9yO9K9CH3joFwWQFDCB5q7yWzaZPVkfD734SfmHkuWH98owQMfkjFh85emc2fcayncJJ27
YFKFbfDoK2Cijkp9BYwBmBhR52WU62+9Onv1/4HqMf6B6gj+gepa/oHq1f6Byt/zoeyDPk+SwMqq
ZmIkOZZjzgYZx/I8FMKSOazvWZ0/AOJODvWJ8mEw8yW+Er2xAIzADJ3t2V6ht0ybrWfM1wOGvmMI
Tg3f4WNHB+gFSH9Qi+CCti0lKWWqxhlBZDJ0iuhFivUVpJNO8o13PT2GDMJMw/BFtn+ky0A+uwyd
Mi7C0WATdKZ0XYbOjxQEYzibi2C4peaRWjxfwaEnGCXdwMd0gNiEDvCMdV6oCZ5xnHmv2R7PhAXL
kpxQ0ocfD0w3gDLerVdnDwE+UnMIfKRG/H+kJhv4SE028JGayPNjOXPCPEkCK6uaj5CUagDDM5lU
A3k8Q0l8QMEzy+UawE+DuK3Dry2SiWRtcFPgo2mP/Qqt5jIudrIx4kBwo9Ok0eQE7LV63TTeg06G
vFGmho5GkrNprqbWh2wscayJ3ckIWaXWP1HUunWzDRNBis9WqxP3MabiPyWDxeZ2kPXRCWkzBHSc
W6UT/hUeNoxPNbyX4kAVj1KcrVdnrxU/URXyJ6qK/0TNUPSJqrk/UbHAp++GgG4xFY/FSDx7FR/3
+OnG6qOqe12n7RC2FSNq0vi5+OQwucgDh1nfUegar6SFlT2Uxbj2DULFdFWwAKypSeTYkYOQ1H3h
EQL/ACOn2Y0qkZfm6K2RJi/TphMH5cVF3buVmlh+nhYedT0aDnY/vJi8sQ4efabAI2fmJ2lk3wg8
op2BGFT6nAwcm+dR8kVv+CQSVDnhvOiNITGHrRVpgmzD3IFQCadCW7HSHl98pmKgz1QM9JlqYflM
xWmfqWDp85zki6goqWgJzdWzLlyiVPTNwKW45083jh0VOtVCBx00Lggdwpnha0wlHdksSRUeATo4
LkfDSrCDwy3ONIH5AA8g4g3BG61rsEMufBNVBkfFDgOyl91gk3dBq+oSPH+hYAevZmMHLqhUt88J
PNBOBAxIfEmlgM364FmFKR8hwwhJGBnGKl3/rMJbBJkQmil36LsKTpi1YqW98v1C1dJfqEjiCxVJ
fKGaXb5QIceXMiyaKUoyksCSOKyLJDDW228WScQDIBQS9qiwolJLsoZp0DG01SIVStJm3ApkA72/
YApOtTQNg34OTDJ0lgTUNbbgXBLaqZAAb12aq2FC9ulk1EPK2Ctf38IAQGtcGHmNYxGn26JWIibj
A+rcONLEcMRKj4IZdPSVgI54TBU1Fx55KjpanJdsvVOOQkr2NZEINv9D6ldvmZ7YXIwVnqkeKcVN
NHRA4QLwqF2A9GrFSntw8bXM45UWJLKXfaVyjX2lspd9pZKSfS0Tp80UJbC6jkRKhiGlDClZHilh
Pr7rs5Id4wyJh8HpxiPnyUzUtOw7VtAuFarTZlKYijmMXInLReYlS+SrrYwoEqwRHgKOQjeyyhyl
Gip4SIOJZoAHLCZJpXFZu7HuR8caLwpSnMIHwUjwgc9P4Cqp8EF9C/AB3/qP81iAEoIl0sFWQ2p0
4cKF68wESlgpmfQ9d5YOiyPJ4xlWjpJ5JKFQTYVSM61Y6V75hvUOaulpQQBJjAuC2GRcEEQS44Ig
Npk0DSGJBUQJLK566qz9V3OQxKQSCElg3rWKiCT25Z49kojnwulGIkfLTFRRaYpwjbIFZ9igdCpU
qs7YYgo8n5g1Qjd9eEbXzxRU2GVARXzFkOCTTQAJVbjqeYOK3VhTWxuUDhUAFZwEKgSbzR3Gqd6w
3xyooJ0CGMDgiaSwlTF81TEB801fdZzxLA2WCQAjxRdCAY60uP5CiYtWrLRXybysktOCRDTAqUCE
U2EDp2IgXoY2M0VJxheY++q6+AJz7f2+8UU8ImLj3wrW6HRRhabVDZNTrKHYgem9Bw8/U7ABQZha
h5rImw5aMERlVDEdbKyUD2QINrqxJiYqDUG2fEqQCD0pYIP7uWDjmaUEeaoTgZB0RIheaL8/QpZ/
jvf7Hm/5zBs8+VnLlJ/Y6bSTTMYL4+0j3440A4Z7dmgKHZzOZcVKe+QpiAlq2oKUbDuhIC03TihI
S8sTCtLS8sSCByfRwUUJrK16up110+igPt9JTScnLVkP1zS6nfhlmZ91PY0YVdvppmvg2VKzPhVc
SISDDnHC0fok3dyxjECxTEl/6fSsBlsHNRcpoAUgLSdOz2r+kazDFz0969NK/8VBzKxaGrGZT8z6
jHYLOGVROpctQ+uT9A/ZJst6KITrX8Xl1rbJmcYeCqJEYlq6moo019PUQ6F3+CpO1Z6e1mg1YKcF
vxqRXj3tLP8ONlSW7epJuprurQgoi8c2iCsPT+5tUmzLP6F5xmP5ChKHTyuTOHw6hMRhKIOPS8vg
48oy+DhfBl+WlsGXlWXwZbYMBF9YBrsKV5NB1948GbClZcBWlgGbLQP+dWEZ7CpcTQZde/Nk8Hlp
GXxeWQaf58vgw9Iy+LCyDD7MloEQC8tgV+FqMujamyUD/rCwDHYVriaDrr1DZHB8CDpiyfmEseQc
gl7zTX2sa4oGEvNNfalriobFsk11EID4KRny5JtidU3RkEVegF+rmiIq8HxTn+uaounJfFMf6pqi
qaP8XImqpoinfn5UD1VNEQ/X4x9EYdQSJYoal8eIrsblMaKraf1loqtx+eTli1R+965VNp0cSnS1
/7b0HlVRV9YCDhNT1fr7msYJKKdNOCcNq4m9lk3MhUHywVnN4ZdrMxpsYoRVCsh0Azj8KpoPjuBz
fXCeRxCRkKcbo1VqasyLv+Qjo/pBYXM48Ckw8QV2ksdeW8E1S7LcNsLJ1Kkg7K8DfXNR5pf16uxP
K0X1zFVU91hFjfxRVF9fRfX1VWVf33mSBFZWNS8PyS8XS5GS8csVQlnuW5cA01httTAqR1E4rYjy
rH4kv9zkBIhb+XRjy4dB9cvvsIrK7BnIE1s8PujKy2byZ4hGKjTRB56eNfPCBuidSg9aaRoNSkCJ
piZzvcqw8jytA61utOSjoT4OTobpMgBhEOBAq4nKe3bueklU3sd1oK3ZuhRfV92P7/fnC/l7G295
uyY4TTrJPWcTNgIuDTdGuMT5U4TNnBAoaqkP9P5EKW3Wq7PHNrrsLpkWJHpqaqqnpqa6nWqq26ku
u53OkySwtKoJh0ienxhQy3h+SqeYNWbn+SnbH549gWL+tI/H9ulGlg/+mZit0i0q6HGlIRo96RtZ
FWHMW4gwAi2RzRjr6yzggrtXiT4BzG7ACXBhJbetDHAxNOAiZ1sdOBG46CcALuhSfpyUEoYx/VB/
fzr99zbe8s4dYBghjJ8yKrUYxnKTYBhm7YAEWgDJfTWmJVHOnvXq7NW+gdX+uCCIOMYFQVQ0Lgii
okmNECqa9hEAO/MlCSytakal/UdzMMykkh2G8QmE8ThloiYimH25lRFMPL9PSzTxSccOBTOVzyes
4SAlcKfoq7CMmRqgVExni/UVQCG8JQUadDW1QTnABlUJ6AJkkxp6QbKNqiIIUhkjHJfxl1hfgVR8
qRmu6+kgaw4qWpIIInEWA6mhTaUZbioBBQtgpXc0N4hl74a7F6SLV3u43gyitUREK+YiWkGFtKs9
pB14tlFe2mwybGya06c2pwLOmYbvGq6sUXyPfmSjXU+SJGUjPBC/iz7m4CQ8K1baQwZLfciy1Dc0
S31Ds9Q0OJb6IGjLD4IzRQksrnqSpGM9t+UQECUlDwUBrfrYlj8l4nY/3QjkxJiJhiqf41whIW1Q
EnWWnSwSaCQHLDvYc5xMHUHcIJtsBAIQxqrM6RPGoT2YQJC3WXXmiQCY7JUYj1R8Dx0NNnlwFbwg
xgwMcDQYoGdTHlFT2hyX8GjZ/U2gOwoC/md+mn+O9zsdb/kAG/iSSe8dm/qSOea9SZ8opeEpwJX+
++LuEo7IAhoK0ki+QkEayVdsmsTd1dZIYQMLBYskXzNFCSyuI3F3YQA3w92VA7hYnpsnZu46VAFG
TVbMuLIAa1el51WRtatFQhVAD8juAKEpzG9KtMkgBx2l2P3qsa40kOEvwH1WSds1TWD5tFiXt+T2
w8Huh2caXwd1PRHq6rlQVz4PZvCjbnUM9vpEGtjkD6mrDONeTHCClJYlhjDdOK9Sjk/ODsYJKDPS
ipX2qtVT1b+nanVPZOQMBYnq31ORh5/D8YmKkowTMAeiNXECpZpvGyfEUyAUZs8MM8Du6lGjVOhL
k9GXIrJUYj0lUFlP3dUhQvDadzLdKAZChrDefc1LGcuwdtVHm+Ef5OUljRkNK5lKJvPVVj6thprC
CGFx2Zr4BpZzlcO6OQthYY+zLM0y3o01kaGDqBwAL7kzGsJysxEWmSD0id3kljgkKU51ZyhRaNbr
ihtvjctkDfZKc5FE+AW1xVzqdRUw2oFeVzh91IqV9gjljOpOdUb1kjqj+l2dlb2k0oJE37CzsoPW
TFECq6ue3mtNzyss5PAb8rwinCTxSChzBi7gqFX5NBn0NQM1aatrKjSpbvk9RyTrWDchHGESiuy2
kynu8qgfB230urGigCPCZqGPni0S5I9/kEcMPnFDakeVzKJUAGKot2xFrzVQXsbWIHXWvpKS5LWS
ZYsNFl032GR4TAMhr4Bp6yUJeEk325nLKiLwevamrbrjkmLyeplICVsVA5OXEMbqqcnLamd5b/Li
siUBSt7GFMTWjttUUI6tFSvtcctLqj3pJdWU9ZJqynpJNbe9pL7fvSzb5WaKElhd9Rxoa9q8sHDC
78vmlZ4q8XgI9RXyuCxgC6s0bWD87brm8chk388c5CuG2SV440rZ0SGn8UoJKN8oCT0hatWIGuOO
jFxvNJCxknFHtW+gw7HuR4eEaGZAxoYEMmKg5UyQwake49+UdafuOKBYfTaJxLAVkgAOzZ20fgo4
wq+Zi3kEemccI1Ojj+TuUKMPSka0YqW9it5QjT4bquVlQ7UObagxdBuqdWhTtjfNFGXJ8lJFFnUs
o4/mwii3SxkgTPsDLfiPgji+PbNPesTEsyJ2qXzczEQfleagEvrolFOF7hXNGHvE65EEnswwi5BU
w6i9MfpYyFNdNN6B+Ms1SteZhOLr4SRqz0MywAwUMjLbDHs6AGAAdKgUgWo0GLQXIaise4yMb1kj
ERTiFTAR8NbGOOjpwDAI2BsrDYOmtf3BXmyuZh+wyT7wjYVSXWCWPpF6X3XdTMcPvXNXjt81QhUM
fZWbYGrnc/GVHuspSNHUL4CunwMBAE9tlQdhmCHjCgtA1pBQ5yRgYDdG7CQU7Tk86OjgFADsXJVL
QJkmws68CJRrnKjZA3yyB+pN4zW3MHwVJdtoN9T94ExjRSEAOnMLO6fdwoydfQsj23qfT+DuUTES
Jf73PBUftl6SO5lyUkmm2OROZpnTmvneCszat4/0VqbEoSHApPzlK1XaX2TOqQG759QQ4HNqwO45
NYPvOTVM+XxGvl1clMDymt7KsAvVsUKA87eymojkk5P263BekCh845dFCt91TpB4FIR/7/5A5O/d
hwsjl9F9uW/+MjoQEzrYMZPvE/TxkUMRnxk6ja/FlkPNnRxoYV/Tbl+0f6DQ+Np/JMvxxZ7G9ylF
/+IgDl+uzjzjFy8WJfF9LlsGnLooqIhrn6JzyF6pNBWU7EUdjK64I+g2l87otcrAmcYxU4GMeQUo
BqPiRO3JfJVgAzLfYWcqXd55Y0F/b9Najehym9oXoo2JGayjJM8rO0wM1dsXQKFtWkD0cye6J13i
v6tDJRH77j75JP1Mz5eIrov6CwTZKKlFseoe6J+hdFKx/E9krr5dhatx9XXt1XL1DWWglpaBWlkG
ar4M7NIysCvLwM6XwculZfByZRm8nC8DvbQM9Moy0PNlcL60DM5XlsH5fBmYpWVgVpaBmS+DzdIy
2Kwsg818GfilZeBXloGfLwO3tAzcyjJwh8rg+BB0xLt6hpGhHoJe802puqZoIDHflK1riobF8k29
rGuKBnnyTem6pmjIIt/UeV1TNAWeb8rUNUXTk/mmNnVN0dRRvilf1xTt1M835eqaoh2uxz+IQle2
KJ/xuDzGZzwtX+YnHpfH+I8n5fv3QlL53Ytl2W5C4MEsf1t6nKuoK/sUAPMZVzrVc9ZwW8jELliN
U5dsJmEFnEdPe6yvgMmRp4m5dl0duLSgtkyaEHhjVCE5GXM10a4sQ0vQ0ipjfYXsrpFmctjTgQwW
SsmvG+8g1y4hQ7M1nk2qMXocXiFi0AnW14XiXu1g4XRDS+zohqNPB3uhdQ4kPybhn4wNomiNGG6R
nVjaP8KtZJyFLkjOQjHD/FxnIWOIzkJrBoZuQ40CyT+EefRcpGPEpniQW8NaL8yE0cgyGf7H9g49
AQ9bqfcOPSpsTnloWCfK+7denb1yvKAGdV5QE5ldUIM6L6hBnRfUeNKLGYnMUEkCS6ualZEU0okl
xMiEdA7os52yigmD02c/q6DO/kSIWzvWaMrHQ7UDxrCKSl9gLktpD4LQZQ1sEJmYTHZ4/n7eauBh
TymwoVIGgjXRYwyEDc7UMDqJDGwApjsd/wx/YEyMoukjW3dj3Y+Oh90JOKvzvIZ/RdLwjs12Bxac
mnOLP4mGJ+znx5kpqftX6YCxCU7UveDKcWUnQZVWMma07hl8whSbhMBQBiBp8uqeYwoFpchbr85e
Q76C1f24IKicxwVBXDAuCGrxSY2QFp8OBkAa8yUJLK1qAsP9R3PU/aSSsbo3UlplcRJmTlT3+3JP
oO7jPo/eKIWEL0n3DtX9lSaDkoNbpxgq1J7NWgw0FPGPWQzCdVda2L8ND3UgSYCryOYKoR/faF3j
4yezvNSgCBY3GKiItEZDS4QmFHCbrBRaQETWQvFjwjW6MonFNK/a04ZPdQxMw8Huh6caBeV5BcKn
XlPwEmdCzcVLXDsiXlozfOrwA5ES/fQ6HT023Sl4Ul4G9TLJQ+rC/cX5nh2Gx2jWFDtpLw+NfULp
9VastAccr6kBSK+pZIWvqbFPr6nRVK+p8Vmvy0FSM0UJLK4j0R9i+CkT+zTAT15IpiTOAP2sYoAo
p0Xc9rE+Vz46ZmKpShtCEUu1SqNCJ7r2uWSUXiLmp8K6mldovhHcwVjKLZRAUzRgWoGIJkWNBHLh
EoT8mRCSHPYxHbwHwFnt4MMUWzCpQgx6qHl54vQk99johxEPXS8H40c51Wjjj2kDCjSgqooGlB02
+zMwISbGYdb6brDJ46qDMD7wSnZJwoR8fvbUsOlokPBpHslmHfKUt7TLRBLYzA/YsZlVRkye0pQP
KtX2GVJV43kPD0Wbd/LAlzScnG7FSntEdUl9+bqkPmhdUtOZXlLf0i6p732XcxKkoqIEFteRyAMx
eIi9pj3CQ0q2Vgo8fMrHNPjkiEdA+IssnyIzoWKlrkSyoLrKPGRskn7HxhcorKvQU5FxJbNbgZ2l
QgKisRa0usU8sBUC4Jk0ZIW4WtRdK00D2/WTIoDKJRCGYcFHV9/UIGWRGb+OiwLrKMH41XWTOv4u
SHMU4g8XizJ6d7d9d3ZXOFF2Bf68+6ZV9VVI6w0JaYmw5EpIK/nNHmi1v3tEF/p5OyMtelrupHxy
H9bctk8O1aMuBK9trm7vt49yjPS10fv4vkXtbb3hH31VScJZYQp3lY7bOi6ud7cfbs53Hs2s2Vx8
Ppa+R9AGay7OHwioJJajACfWPHyklrsgljsnlnuadivld+AV4U2yibEzM70icMNsJn+WZt5ZljBZ
8Ubz/vldyYC8gKTG+JpEiSlXrLSH1W+oQP0NFai/oV4m3lCvJ2+ot443c+4IqCjJdwTs0Xv/1Rp3
BCzDcqzn+7gjxPPgdKOP66IXq2hBUrc+/uf/2v14ch8OkJ9u/vQlQo5C88m3x8sCspgYIza9eRUg
3IcAvmRJh7fmui83m9jNXSQSWvIttWC4/FNLbqklP1ILckMtKSS55CtqyUcUhBbk99QqBXmCxAW5
5JtyyRgvFC8jbfFCuccLxm4/7jbK//ND0PMl8+/jZ5/ubh+2/TneBf7uj3lxgGoQJdUQrxGYku0K
33dNnG83/7G92HV3oIBQ7TYsi8hhsfAs3wg43bCJ3ojpdbdhjCNXXplxNZJwYA7hys9F2tnRlXch
VyPRMFl4IfLMVYpBtFf1cXzSwbmnu0entLej7FjLOFtz1VhfcDj3Qo3kIBA5sMiAPXG7spQM1CS3
K+x5NaZ/7gc3yFetxEKLxzTMgs9rcQ/JaqFN1s7Tel2xNP1/O95BtJtlwAsb4HX1dmr3SWxBO8MP
m/u8xiceV5AL93NzuSJBt/JMli7VbxMRYethEMLmtON84tMuvGHRH/TxUh25v3piwpi03wDvbkW3
H0FiH16x0v4a+pbqG/WW6pb1lppA+i3V2+ot1XXsbdkjbKYogcVVzw69qlsWJbU15U79PN2ywMtg
WAyhUCwj3qADmnPBrtCuvvEgJUycMD7SrRrVrVNevlmsMP2LVOzqEJbZhRx4ZONkgS7ayjEsM6gU
FnNiEgPvm9hTR5JBLcqycXdCLmwBoAxjIYMMLCIDTo8FXAlm8RYspwNOYJZrtCqo6wzMuqLArICS
5uKsqWu7/J6AFvFYxFDX1YHe8NxZLzOhhEY5F10AHmGX0I1OMgdI1WghD8VdKOHwipX2UOWK6rx+
RQVoV1SUdEUFaFdUgHZ1IBUITZRk3IW5GK2Kuyj1fOe4K54Uj18cEYVVmgmLblGtZqpUvjZmdJ+Y
CRXEpYiZCVsLY9JZPfIMQv1LSVKIvtIONBP6RvMRBhkDlgwOy+RkwPo6C4NgcK7Dx/2ABzyHvgmb
Aa43g0GuSRjEziaJjrx4Y2uPLPhDfdsohHJIPE50CZNcp/LD1kuKSbx0XCg3wSRSCO77bEYyLBgl
ekwiGgOwk+FvNCgn8YqV9lr8muq6cE31mrimOmxcU90rrqmeHdcHulfQRAksrnrO6P1XcyDJpBIA
klCyK1Egyb7ctw5J4rERPzHI2bM6QHGghaRVW5WaWTd+EuakD3/HlMOUCZzRDEWVUuCyMb7kvD0G
KOOwsIyRZOrCzg/HabxxWie9tWJoLEKVEEkMgjcCxGnCN8qOrIbSoXB1ajVsWcmx/h4Vq9nU9BYG
LZOcEiKm9azDajcUrKb47Li3eMaOsVopAux7wmrU0xNDbjepNLHVk+ZWEJJbpie5FbxgRgnTW5NE
ExZTkoZSaHkockN5S1estAc7N1ScdUOFTzdUQHZDxYI31ByYNwcmoqSJkozcsHezdZCbUZwpPFHW
7xy5xUMk/M3r4+K4ymceJO3VxBEL1dw840wjGyVRE3xe5ZpmYGdyYgBf9EKpssNxq0AYF5Otjrzy
lEekoBo9gXGEty7gkcr7tKdDjzyFpkmkiUAHsAqa2lxj5QjCacwjT0a4RhPB4l5oskXRydDMINGD
gVZjBvd2oODHpLJw3qWLQzs/kox4FEtboAoS3lIgoVkgnSjzE0gIeWt935CQeixjAPE2lS22uoaJ
yqWXYmLa09JI5XrTnmKNM6lljyl+KEC0GABZsdIeU91SwdctFc7dUo2Ft1RsekuFnLdlEDtTlGSA
WI3tjgkQ0VRgSUUnodXwMbenJ2fn5ydBJ9xjmDGW25Gq3D7ipUdBPMlhEk+F8Dfmu5/+3rFL88e+
FSbynzA5K8LysXr27t3Vl5OYFr2z9MRw7HY/huUTNdzJ2c15+Prxd+Fg/ekv41++/7C9uwxw+/Ym
3TuP/HJr7eMed5w9YEtgAiJiYA8FRcQsXD2KSDFDCUYMAv3Z9xbnv+KKRRMHYMu9JnNAEtftSog0
nzigjUU7IHMAbQ9gmvQNMfS9LUiCBW+IQfxtQUoUf1uQEsb/tE3XyrGsdDbh+nh5Hq5enc59Bpvt
kZH+3cnf2z7tTy1M08b/rs4+3GxeR4C942QDGNwcXhnddAO0sK9pB2faP4xyyYCf7mHDi933Pzzr
qdn38vbuVXP27iycJM1VO7amVRhNO8J/v7263Hz5H3+72bY//nhxdubPNy9OvoWQ7yXkh856lGE0
mzyDvuLbsDiKoMt2QFnJ7n0kv+FqDVyi0XBSTtM4NzJwCTxqcOrTL+IrNtZfWshpTLc/eKoF3j5r
5aAbo8CX+8g0MRKDQsUgJzm32vhFrLsL2fpYa2pNRmcG4xEGMGtl+CHGtj7TPtgnlVkxdjjUBFuf
yMH038T7DEp/P0bps6MyhVJjlC6g8FHxT5yeXSIlu9/7VNLYShtGd3LDp3Y/pbiWrE+6r23jVZ8y
KTK4aoCxSKBgHOXAW7HSHnC+h+1544KgmW5cEDT8TQpCNsdxQdDwNy0IGP4WECWwuqaGP8yNbv/V
yPAnbGL6I0QITOqBbH9Yntekokrbn/gHzWC2L/f7MZjF8yn8pGLvxHtULAtcXLqEKT93OO45SAAE
o7+Xq0N+DVAmcIcynsUgSneKeNIWr8PggYuSxBWr7g/9NvHWH7DyP8UF99fLq51g7wImvzl7edW+
V9xtr28/bncJlh4rPD15c/bxrLm8bX762//9vNm+i1A+7Nazm4CcH5v/8+mv/353++ru7Pok1n3/
659+/vPJL7cXD5/O7ra//ut//PLl/mF7/evFw/3m9ubi8tWHu/ZG8Ovm9upqu2n/uWvvX07+6/Lq
KnTljw93X06uzkIXG2xMvQxulpbBzcoyuJkvg6ulZXC1sgyu5sugNRYvKYOuwvVk0LY3TwbXS6+D
65XXwfX8dXC7tAxuV5bB7aEyOL7K2SGzx/eZx7yPlE/J2irf1E1dUzSlkG/qqq4p2tmbbyp94MI+
JR9x+aau60ZFO0nyTd3WNbXfsDRjWcnIqBsHRi9H/qexUynmU5oxMUb2QdTeQmBSD121UzvrE+/v
MBvvUhMGrXz/vEcqn7xEksonr6u08r1lhVQ+MQKRyie2IFL55J2UWP6irvwleaPuyl/udxv4AYGO
uvxtb9+xTiovOvOOlvHfuWhLWm0jK49RyjunT0+mVh6wvuwTJ5xntfIECjtZliLzRq8cqFs7ayZp
A2BekfQAIr1x4CeWdukbhxKDfJAMenmo9YM3oeZC3ivlRnmvJOYHn8v+RfCDnxHDh7nTsxiLkA54
GLAJudMDKZ/uKG848Qlm5itOG9U/9tcupFN9klecd6FcfLMlGB0pCZzu0tFjk52+rFgRDiY34avT
lknmkgROpg1TTviMOZAsAc8PhNLlrlhpr2PuqPmb7qj5m+6oCTbvqPmb7qj5m+7KqaNmihJYXIvQ
GdMUL1LNSONabbhk9vQE48Z4vimcssdF3Pfx9wI5PKpfLIZVVDpNxKge0Hek1RqVetFkwvwVDCgw
HwjeciT3nfXDbAcK8MWoxVSusQbCVII3yk4jobCL3ZSvjTUc4h4q4KoaiIChLTGIHnOhj0n0mG+k
q/PzuKdghFDpbIwg+RQjAIrzyTw9Dt70FF+M+1QW2NwP0isZG+PxJ+mVtPE+TfnI2oDYBDFIbw/1
xTiAUu1olfZa9p7q53BPddq4p7pY3Jc9JwY10rw77sv+IjNFCayueorbjC/GIZABc8Vw3GrrA2TA
Un8/X4cKwukRj4Hwk+TIWTITQDxGYRBVZzGfY6tSKjWnjdwm0zB7yPm07y7EdCrSMHtvBvgBylVX
a15QjVJFGCWGUjC47ykxmSNmFRgAqNBPzTlJArUIyjfKaRhBST+WAJZenUe0RJPBSuiJD7hLfKN7
LBr0Jy/o5Qx2eqBgp0gpORc7MTvBTqzY1eeJnainH4akHlLJYOsgTXfElORumjzbCmFs9LDfIamw
p7RIkmfHTG+HAimUZ3LFSnvs8UDFRw9Up9YHKjR7oOKjByrieihjuJmiJAMpzNaxFpDSzpuwo0+w
XN7fEZCKZ0Ks234zsKpVNpXa1La6a2yWAZMXYagqgVScDaN5ID1Ym4AynKO2ACwZHwEK7J1LZCTA
aPknSS9dWMJKkfIPxmgePUi2wz3aEZrcTBAFSLwXoKgwdXLLRkFhXZ2FwzBJdj3qx8vNkEMOej7S
eST2gYLEjJj/0iXlNFklsP/0N4PEKMfn44SWcNmHVE7YuhhGG0V+9ilBu9VC+iQNZbgIqp5MTkab
NEDQrlHFj5KVrVhpj2U+wKBnXBAEZuOCIDqaFISA2bSPANQbFwRR5gKiBFZXPZnc/qt5wGxSDQTM
sIzmmgjM9uW+FWAWj4j4N4mcM+vCNC4Dqig4BHo7RikYUBONzcAU8OEIA2q8cTZNky2HtMfMF7xC
auSgG1tg+3Vjcr0xQjmSew3+AU5cEt0oB/hCcTRNcinH4lAyYR8NJeMJYdfZ7Ei/iY8UIGP1bJOS
n2RHgkLinyw90gqHzeNsl0DNx0Rm2JoZYBrjPNcTW5OyljMme1uTD4dFH0Ad1I0DbE14NiOUB2zF
SnsU8JGaMfsjNc/hR2qew4/UFIsfqUkbP84hRUFFCSyuep62/VfzIM2kGgjSUFJ9UyBNkqfoW4Q0
8bg43bSdLR05M/FN7bOOatyYZD61JtihMYEzLHcya6gsZYVHHfyDvAFGhht4PzDPBim3lQCg0AEG
mFIaGuPdSGbYiyjLvIg+tQUm9iixwKiBLctAmWkAC8wnCnBxajZwiaIeIRcPQKxv1QBTfaZQbDOf
UgliK2ZomxE5cjetJBPcpjjG+EEKaOEAh2X87o+yh61Yaa/7P1HtHp+olpRPVNvMJ6pZ6FPZ5JIW
LNqPZoqSbJuh2EIWADJk2wyWUeZ3YpsZHDrx9IgFSw6QC5htKs0VwpSe11zjRynzOMpCm/X3xfo6
S0djVgyRvpLEiJCEyVZEHV1gGMno6M8UHe2Vn6uj9cTVVxV8tL4zFU3ZLZQAo8+JOLHVk/q4WBnE
NqX0MlbrcMLt9bVtrVh7u4NqrASeUvD4FZQyasVKew33mRrk85lK+/6ZGoj0mRo29JkaA/V5Dj88
KkpgcdVTeq0UX7RX15SKKOr6WcYXLXIAxZPkdKNLLncLRCxVmiSitwv01NDptZHqxhwcTMt9OeZn
9Qx1jAVeXHijvex7y+0gCwOzy7gc62hIgd+d9BjAYFIQbfTwmJ5VcJSHjPDupOOmIwmhci1wEea7
xFI7tk9x3D5FpjfDFoJIemmtII2/9vlRN3zMPzx3/IbqdZ0+PZIMdPhbZWSL6ocmpEqFZhXgLFMZ
8hgf4ZQpPFZqORIabqDLuJZhfSUKDQuQZAOn9HCvSXdaONpsIVt1BuZ/ocB8ztjs7M1qgvOhSISu
p98xzieo2cdVUAL9XxLZYmtpSNMmmPMT0K8F4870ju2uESbxa+dhX+QxP0cx5QHMKUertIfJX2Ao
Py4I4ulxQRChT5sGrhuTGqFbxLggeItYQJTA2qpnadt/NQ/zT6qBMD/G5BsromD+fbnvG/PHUyV0
AjuZZl4AavW3apSDMY90dqS+cdudmRD7BhwIBVovrsLFQIWrgECHedsY4G9UKzfbXnRAj3o7Sl5H
EZwyY56QetxTY/TERMnjtCUDNqnrlmu4K3AKZ9DQVxoaClhmLhrSE6tnIWHG7wcNEQ8gDBp9TQSN
LawUGjnFlfYZPywjPfd7aOQbz3poJKLH4KHQCOVJWLHSHk18pUKjr1Qg85UKjb5SEc9XKir7Ogca
oaIkQ6NqTHNkaITmf0pqOgnNhq+5o/FYxC/LHLZPdaTEsyH8oLsfiDy2/wSJRIGWj9qO1dYbthCr
bb8T8qy2C2xu5Gh5+xtvwg9/QJfDhGHyWUzXjopCFiDcrv90UkmP7aGaawPQApBxFSeV9P9I9vCL
nlTyec3Gi4N4JPnLjd1y/mItIslnevSA8x5FetnSSj6L/k72XrHjPZMkcyUmycrnlGIun/b2lF4Q
kcuhbtjkWU02AsDf2GOKHPYxvR73dzpQZgn1z/NBG48z/s8Nis3Z7iL9XLqe7tWICIq6BUQbh6fT
94PrzHuURyGWr2Ajeb8yG8n7Q9hIhjJ4WFoGDyvL4GG+DL4sLYMvK8vgy3wZ3C8tg/uVZXA/XwZf
l5bB15Vl8HW+DO6WlsHdyjK4my+Dz0vL4PPKMvg8XwaflpbBp5Vl8Gm+DD4uLYOPK8vg43wZfFha
Bh9WlsGHQ2VwfAg6ouZ6j1FzHYJe80091DVFA4n5pr7UNUXDYvmm7uuaokGefFNf65qiIYt8U3d1
TdEUeL6pz3VN0fRkvqlPdU3R1FG+qY91TdFO/XxTH+qaoh2uxz+I/hBu5OnzI6k8RuU2Lo9Rs037
g4smLY9RxU363z2Olk0ph1Kt7b+tfYKk1RbTIzFvfKwt1Cziv8lEa7G2rNkfJlqr9LDnquGgi71v
pBq6CTOGp3Yipj7AnOtDxwwfdHPIiuJEvt5KhyHBGw+SponoDzpKJckMahPOeFphfT2qw5BuLPeD
Affu0yJMGMSalncYkpzmMDSfEkVPcjCVe/qUDkOS7b/A3oQLTjwdB8xu8Nhkp0GNwjtjp8mUvOSc
W7d34glrMzaxc+JRrNHsYC8elJRrxUp7bcGJzjltQYq7TyhI8+IJBWnOObFGkrtPKDjDiwcVJdmL
p8Jppk6FItVQdSdazcAZKFTColMPpZ5n7gEzOHTi6XG60Qw5gaodEo722tqpnkrtylkmklHCMXzY
m6ttpFVJb4cgwwIgo1IKPizeEqP2CGJg8Ws6Qz93YPweb4yzSTelHI5fYuCNNP7o7z0eVerO7uWI
UhyNRhPkFFsYzuxykSYd5UMR6IUyZtmYfAv2O/DOV4qAtdGnJBmsljHLJ+S8tg22TYbINLCb8hmz
pCDhTC7n48xJznJVyFP/jHAm4cgnpL6SIpEENvMDz3FhpXDTrORGealE4jnupO2D6lhMrHFo4iuU
1m3FSnucJoiJr0JBWj6rUJCWpioUpKU5b/tIyZAV+1hKzjVTlMDiqqfdO17iq0NAJ5Y/6xF0Yhw4
30D6LPgEikdJ+OHI2csrsRdvJAOzB7RKqVLv6kzWbhl/h3UXpExJkpc3ko8QKMrfRZNCWI9wws4A
guUIgwoMhFYkLy9kOa2BH5gkW6KbdMAmQXIRZRdEmYEfkgY/3OxsYHZCXle6djxX+EHY/I8TWMIi
MhELtgxSLGKZ5NxMsnAqpbXTus/C6Rou+ii2yKsjvyvmOimJrHBtQQohXShI48ILBWlceKEgjeIu
Fvx9M9cdgkUy1WSxCEb7IohYZF/u2WKReK6cbuyR2e8qjSLFQIRWXVVqZJUxCMhoKsK6C5mGklej
jn4vBSalK3KFFGLOIwniszBIpkdiwJJ8sWgMnGQ6YKZgfADACf4BAENUyqxiDU8HJHWBDq1CcII3
TEIZnoRsxiY1gbHRcHpWrJXsSXz0bpkuwfCjMQUWxgygUyRAFx98ZwK6CEOGgK6cK/4bAHSEE5Ri
aVKJjLA1MXjeZNp6pya8xNwb7V1iafKs54qRojHiYEsTSq+2YqU9IFJUc48iplgPBYmWJkW1XSmq
pUmVzWYzRVmy0jwT+rtD0B3V0oQx4Hw/lqbB2RQPmVCzQw6q5wP1OkVWqavbaR7pah1zoWPdzSta
0yRcx8wOH8Bw4ESSAfeNhh2tRJvFaCCEMbjJvAHyTEorKPh2JcwiBsmZwpiTVJWR0xryYAIwiyZh
lnACzcYskzcwUwB/3x5mIZ4LGIDRicCwBZICGKYss1MAY5hm3vf5J3l8HOvfykRcP/5QBIOyqa1Y
aa/0NRVGaCqC0VQEo6nARFPf8/QckhhUlGQEQ9H13x6CoVDffO8IJh454YcjP6lVZuQuwplWx1Vq
ctMYN87LDqfRwFJsp1hmkJGdL5VcO6xRMDmnb6QemayURE0v5ITsK7mM8yZ5lLQBkSbpSGxjStk6
MyjG0FCMn01+ZybcdxowUz4zj/EjnQ0Ul3OTSA9bLIMXN8e05NO8kd5abxP+XtmwhEfHNl4DPDq4
SzNKq7ZipT0IMFS/b0N1OTdUJ3ZD9U03VJdzM8flHBUlsLimiAbT/d+myznGDvRNu5wfcmrF4yf8
UKICexKfdVdwlTHjFylUvevWJjBU7yK+tmDdhUwMiZ8La40gKciRgIWh0mYlwhq2kBgkayRTIzEo
1F5DfmBaiT6wddtKBix5n5Q8/Oh8QZQZmGNJMEfp+R5DE4ehUj+/H5BDOC4IzIHS9oLE1s2AOFAr
Z+wE8IS9baXoiQN5fHp9xDvxOsAAmt8FeOlWrLSHCJZIBxgKFjn5hjVSmAhDQRpvYChIYyKMBUsE
gzNFCaytKd7BkMHxeAMPwTuZarJ4B2NG2RPrIXgnIeD7jvBOPInCN8hhNhP7VL7SxPcTyLTRacRK
pa/amKDxSxXhjQagHbQqgT7haCXZdyoBYJtvFQaATI+RD5YUIWff4TE8CusuZJzxPWyJFHKcJIVa
KxcL0w2RUMZBjl3Gx3xzS1HIoXGL8dVEmaEM0HBQmgxUgNeFbMFy7KSncDqZzKMl1lcIvQru0p5a
TpJBpbU3Ugm6gqNiTJ8xlAHuoSepPOKL8y+ylDE89I3JQZCAYQWhZSC/o0H++T5lckKeIwvm8e8W
9OM683EBlC4ALhErtoyGLIKGOTm9ATDnUjc0GzZmH2QQ78qAF5pEESbKUrdipT1odjBeHxcEYfik
IATDp00Dl49xQfCqMC4I3lIWECWwtqY3AAwr77+adwOYVHPYDSBTTfYGQOkO5QawL/fd3gDisXS6
kSVSmUQIK10HuGy8LnEvj596NQ6Fp4wJBC9zFAYH/MPGr72Ae3ilITRUpV0RB/tKGVTwbxcMofgH
efwTs5P1QzMp0UTYxByNFqEJLaa7KABnrQ4Q2myRLWk7Zk36QK6GHIwMwt6A5diTYGTMoTITRupJ
aAIUjvJd244rD16KUdknMsZW1CiJBhNsEriqlfTcqt6qHC6OjqeegdYC3NS43fIADrCjVdoDMU+1
K3uqudhTzcWeai72ZXNxWrBo+54pSmB1TVElhr++TbsyxnD9T7ty9nCLp1SoueQDvYDFuda81Nhx
0reRJh0BBczKmMu/KhsOvbZjBiMxQJmNNSOTM+oGTpOCatTYdpgCbc5HRraxlX4OyMSAtkh6qUcZ
8qCQk1pDa8zDBzpduDCl4/FjITIV418tP0kKvWN6NJFOsYe8DYD8JGc0zDjf26CL2hyYHoFF/83k
J1n7WKVkPjlLBI4tsCGA5NpLMwkt0czFgKtHAKnDHSWJjY1h94cmPiFlsl+p0h5xnVGzj5xR85mc
lbOPDArS8pmcUXOunJWzuMwUJbC2pvARA1rfZuITNKFxUtHJSdsJ7mks4PHLIgv4+idSPFrCX1T3
A5H++zvN/XI8wZZP7I4GXDm7EA14vy/zNOALnBHICfX2N9GcgzTgybIY04A/8Tw98pq+RDt+Qub/
5gzbRTW3KaiJfVW7s6X9C4UBvP12v49f7CnAn8tMvDiM+9sKa5h9sTr39/M8d+CZj7KNN5qn7imy
8yofGIrZs9rLVHpfRO6KtvWoJ5sMsKcB0bjex4RNubw1bdL2BOiatZ7lBbBSIbj4nDXOoTWQHBtT
/mCWBp6J3qy/aeMfoHGKMc5i8DTH+3zWsKg3rer7uRP4s9kk/zzVyLO2M2U8eafTAy6ip7IyhqEZ
StxSrjy9RGKkde0HP5EpQXc1rkYJ2rVXSwk6kgJfXAp8ZSnwBaQgFpeCWFkKYgEpyMWlIFeWglxA
CmpxKaiVpaAWkIJeXAp6ZSnoBaTgF5eCX1kKfgEpuMWl4FaWgltACnZxKdiVpWAXkIJZXApmZSmY
g6WwBjAdEjF3EI/6LR3U5hvjlY0RsWO+MVHZGBGi5RuTlY0RkVC+MVXZGBFw5BvTlY0R9Xq+MV/Z
GFF95htzlY0RtVS+MVvZGFEZ5BszlY3tz1yaYbB7Rv+xD+NKjT6Rzq+ruTdg7axXbQG4lYyTxYbm
ZOHlXCcLyyf5N78Zx9yXp3/WDItjxtwfNokosIUwjMmyVvCJ+4PmXEibZGVQLW9oEpSl7MF5GVCW
sxUr7TfRhuoWu6HmZdhQPXI3VLfYDdXRdlN23Z0pSmB1TR0gMJeD/7+9K1mSG7eCd32FvoCBhQRB
nXwYH3yYmKOPjlHti0oTipEj/PcGqlRNgFhegmSzq1o6KlrE8gg+ZL0l87XqZ1vjtrhuzLm+VUA0
13/Q+nFUBW1rPttaSbqWIlpCOwU8ku8EvSs+u6cXe8A5xdgDztnDHnC+POwB53sBH7h9N0RYHDnB
xNOlJxke7nqiReOcaNHETjQ4IH6y0wNGM+rrr5fHrxf/bFMdL+mJ1adVy4kLuLgQYWqaUbSZzkHe
DEWvKRY19qZpRkuL4mxNt25KV3czUW6oiic1fSzVwpAjHzBaRAyJWuukKmiKueO2ImfDdeeh95So
T4Jadg0BdKUmE+TXQRV0LXIrfSyAXuIsENLYtWMX6hx4aL0zDrsJGRQMjLdEK3e0rqtOdC5Yb2SC
Bp8mJSVlABcctL/Q1yhz6xrlgl2jFK/rPMWr+x9BYtt1nth2oikThyuEOhQ4fi3SWBzaEAMNIQ2X
ohXYOEix7gPRxqY8knUtZoBcTe3yhLDmhq9zhGBdgGWoHrVYc5Jt8AUIwWbCM9rcZ07dFPNYkObq
6hKskkkKMWEWoXSx4VqUQixjtBI8Q5mSuaY0G679LTKRaeaJ4JkNhGfMj52peEYEgj/iabq6JniP
++vMgRvXSNShcAliueyYDDuxmkYK1rYv4KaupEOIb349jJegJkXwFhy0hwMbVIJ6g3ZibdDerg3a
YLVBe7s2+d6uiaZMnK0Q21AihS9PTcM2kWHGYZtgoCG2qUXH36UGNeScrJf5tBKS8FQTcU5hE7pB
JW3mtrYiMGW3tboWwsOK1FQfunGVtXQW2/mt6DojB1xgBS4rrngK7elKDfOLpCI1jwhzj2zFl568
oFmp7jwbkHSGmAnaissmA3gDrUZB4jY4DpWh/CzBbRSvgx+HMhtWrbvFNkMXEYFtWwy2yckETjwk
AuUiy1n6dMAN8I0IyefWtRl1Rjxho061nIVajVp3ousb6g3Wb2qno15Xsq7H8nySWoALDtpjny3K
oblFWTm3KM/nFqUY3ebpO72pc1ykE02ZOF0hkKO0Gl+L53MskKOYPrXU3C4I2ReC5B6I6bPcW1m3
Y8Z4MBZPZm7zJIGlveoKL/OY+rSsZDuS1V9cg2H9Wgc05orswoSMwK0SQTK31lZ1N4hF1ZQZbvyj
EKZxO0ahAB7VYsqvsgrO1lovIdnksmgFRrOoP0lLJWQlAj0I2mgNyv+6UEKSu7RMdsMOpLbi7G02
zRcgwR2EBPV0RngdqEDpTCru2XEg4lmRxOXOsR91XtzYnmCqE3VA06malpur1FW71LovM7zSdL4z
ucsdmpDcoenDHZoL3aGZyx2aC91NyVySpkycrhAUvpXc5VhQSGUu76AQ2RcCCp8tc5lxXdYHfVrp
XLn08hlOc3OrTOTPqt6VXfMqIvFSV+aAUMuN39HKDXuxKxumCxHnYnqXBgokSUU6O49vBoqzXOCC
RxTgq91Ftj6hSKoQqXT7KtiRX5lVysTKbKi3fPsTsB5lxduKnOIz5m1RpX7CJLpD9hDWswoKE7Ee
52HUjydyk4/YH/LqLhPpMNm75qTOj1e0pkVX1yzAfubutBX6TkCQddKl2FRqNEU7KS254KA9XNqj
DSF7tMVkj1K079EWkz3aYrLP98tMNGXidIXY762kP8diP6rF5I79kH0h2O8Jiu5HOTLrkexiKeGJ
iUiwFAQ05hdrMkzWVTUbYCBFKYCyCB+7sPCQWu9MoTLpbE3X3L3vzWbiY0bypbeb5R/OYF0j3MGa
dhALUw3Qd5rIJx4QZCGYmlwG1gZlYKl413vIJk78HJG048ExLXW4/D5W0bIQZDSNqpkWboCpbdoe
ZMhKqNFZR1K9bsFB+3v5gGb0DmiO8ICmJw9oevKAChse8inUiaZMnK4QZLyVuuBYkIFmHZF9ISDj
HWUdM17NuiczHlVZMRFxFGYnrQhdTl9YtwPEoamwC8NzTG5uEkIbVDLzNrcDppR2NyNT+sIRmBZB
HD69aaOGllEA4kjEMo4Q4rAhsImIg4eJK57CHO88llH8dSJhjqNraeqw+QiEdSpUN6615J0T5qjN
EXeV6HTV8XZsmINUOltw0P7SPqLRiyNKuXFEgxJHNB5yROMhx3zMZqIp4TAHBR2eNcyBLAhBID9H
mMPzcdZZmT+Rgd2JeKQwF8bF9ad8slBIDIufO6r+W+B5ECoRJip7ffYrVa1XA8+6xEVajsnaYXW/
izw65deMccZpTIba4BUwma95rHnrYbJU+hCLAvmDNa0MLENjskQU6ARhMikmR4G4DOjHuMgUTf+c
mAzxV0iI6OTanTp6HkKzAlZt2GAoZCdr3SeirI63U5nOK9kluM7oGMQIoaBXG7QHNSc0UHNCAzUn
tNb9hAaTTmh46pQPeE00JRwjosTenjVGhOwLQWg/YYzI93jWddkxcuQxM8SPItcuUdidKW83x6Dx
8zKcbFvksbId28pIrTepUaO5s1rR+Jgt1WpWmrmz5Ts5CWHtF3FxqoaLRVSR3rp8p3F2a29Ct3hH
Z4NIAbg6Q+Cqnq6fyxsdgKvmV8BrsqtBgmFn9y1Qh86v+ZFKsaDeu5Za2yzdHWpJe185bA7mG1Rj
aWUFxK++0KA9OjmjwbAzWhx0RoNhZzQYdkbjcOd81GyiKXNhJBdqCUqA9lmDYaSyrjPQR/u/zdOC
YdK69tG8tO7bOCfrZazL/aEIBgrs/goLzmDsvEO/ie52ms0juut8tHHR3RkcCOG+/vsfXq2TorvO
UQlEdx/hbd318b6Qy/+IS+9y6vsq+R2SmiJBFAxI796biK4Pfuildx/qfXwYJ8CrxKoRqw9vLsD7
uH4pfSasvQ9XUd5HWG/wZeYX/iJMy9kPzlb6udXV1/1+e/rBdv3rAJcfYOd9/vgp/CBLd8+yvU7z
fjkdV52gV+C3mJ5pIR37wL9wPbHzwnpi51F6Yr4VTrNb4bSwFU4zWGEzuxU2C1thM4MV9rNbYb+w
FfYzWGE7uxW2C1thO4MVVrNbYbWwFVYzWGE9uxXWC1thPYMVjrNb4biwFY4zWGE3uxV2C1thN4MV
DrNb4bCwFQ6jrbAEMB0INp5JwcZRoDY+2alwMhA7xifbFE4GQrT4ZPvCyUAkFJ9sWzgZCDjik60K
JwPv9fhk68LJwOszPtmxcDLwlopPtiucDLwM4pMdCicDfe4S7sms5oubJcQeIHX+ghkoFb7hA6T0
4PABUkkw3MPhJb6ffiKs3kJl716eLk0twsPFU4wh03t6wGi0PS/LV1IoU1eKZaTp2KBgiAmguDls
OLPVM9R6wQJnqi6GV1p07vaERxAkRKL0AStw1gOOnAELvBDjC5wvUA2O4u3kGhwdyLfxVL3Qoxc4
f7F/FLUXqI2/11xlzMW1DXU8/DYxJbQOGtXrpmYt6/o2MVHVndMmZr4rnWBCpItcSY2wBQftnfUF
bVS/oEXIF7Ss+YIWIV/QsuZLvlp5oikTpyu8xqhKlKWLkCmBEqoI2RKENkzSgstPX4XsuiXrX2y6
hnJSxRl6f4jSrqba9l9nKoU7v3eH1VSlcIEcGdWkxM2ZcxfqFwmbFxAf9t4wZtzuv78drhEQa4Y/
P3/tSxPCJ/bm69zcox8fv/+1/tPeEHaQ7/aI5h/84/vff2x/35g39r9/fvv29Zs5h7bY5DbM5reX
Mf4PUEsBAhQLFAAAAAgAiE6MPJTsm1QQgAAAq3gFABUAAAAAAAAAAQAgAAAAAAAAAHN0ZG91dC0y
MDEwLTA0LTAyLmxvZ1BLBQYAAAAAAQABAEMAAABDgAAAAAA=


--_002_492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34PHXCCRPRD02ad_
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--_002_492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34PHXCCRPRD02ad_--


From java-user-return-45762-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 17:31:58 2010
Return-Path: <java-user-return-45762-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42085 invoked from network); 12 Apr 2010 17:31:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 17:31:57 -0000
Received: (qmail 87938 invoked by uid 500); 12 Apr 2010 17:31:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87886 invoked by uid 500); 12 Apr 2010 17:31:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87870 invoked by uid 99); 12 Apr 2010 17:31:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 17:31:55 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ramonpm@gmail.com designates 209.85.221.184 as permitted sender)
Received: from [209.85.221.184] (HELO mail-qy0-f184.google.com) (209.85.221.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 17:31:47 +0000
Received: by qyk14 with SMTP id 14so6050033qyk.14
        for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 10:31:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=+Y/m3j0rVOnhn75+XcVpJ/w89xturGHHwFsifxEkX6o=;
        b=lu5g0h3zxPkKMgqbX9iGLHK4dL/r93O6HZacvOercbf8BQCNG5CUBtZNBwND9odFrN
         G1HCdQIOEkirvKARWm/V6YR/lkMcnaKTmLWjjmRCzrD9tIRbN0vK0TGPdjEhP3VbvI5+
         vBf/RhWmeDUqdZqEnnBGKlPlNdxeq/KOs0SG0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=L5UvgOH2+SS0l2am8Ry6+8RUTJZ2x2PHB4YSrxzYgNcZjcN1B7NGPoKl6AWSBZuh0V
         4PqkYAFhs4MaPGlaVM9W9D/9iCV7ckWzRXVRmXFxUduQ54nzQu5uoasi1aP6yjYpPRhn
         sXPomkBPgnWm5VpQU+IPUL2kSI6HgTmQZTY6M=
MIME-Version: 1.0
Received: by 10.229.84.135 with HTTP; Mon, 12 Apr 2010 10:31:26 -0700 (PDT)
Date: Mon, 12 Apr 2010 14:31:26 -0300
Received: by 10.229.230.84 with SMTP id jl20mr6343201qcb.88.1271093486528; 
	Mon, 12 Apr 2010 10:31:26 -0700 (PDT)
Message-ID: <l2i8e1c86ab1004121031v77c743cex3b49dd95db8640cf@mail.gmail.com>
Subject: Exception, field is not stored
From: Ramon De Paula Marques <ramonpm@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163630ff21bdac3804840d831f
X-Virus-Checked: Checked by ClamAV on apache.org

--00163630ff21bdac3804840d831f
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi guys,

I'm trying to use highlighter to a better search on my website, but when th=
e
search get documents html and pdf that were indexed with a reader causes an
exception that tells the field is not stored.

I don't know where to attack now, i must try to index documents storing
fields? How to do it, for html it is storing automatically
i can't set new Field(..., Field.Store.Yes) it is like this:
    FileInputStream fis =3D new FileInputStream(f);
    HTMLParser parser =3D new HTMLParser(fis);
    doc.add(new Field("contents", parser.getReader()));

and for pdf, it is indexing like this:
InputStream fis =3D new FileInputStream(inputFile);
        Document luceneDocument =3D LucenePDFDocument.getDocument(
fis);
        writer.addDocument(luceneDocument);


can anyone help?

--=20
Ramon de Paula Marques
Estudante de Engenharia de Computa=E7=E3o - UFG

--00163630ff21bdac3804840d831f--

From java-user-return-45763-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 17:50:01 2010
Return-Path: <java-user-return-45763-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46231 invoked from network); 12 Apr 2010 17:50:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 17:50:01 -0000
Received: (qmail 13081 invoked by uid 500); 12 Apr 2010 17:49:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13050 invoked by uid 500); 12 Apr 2010 17:49:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13038 invoked by uid 99); 12 Apr 2010 17:49:59 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 17:49:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_FONT_LOW_CONTRAST,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of railan.xisto@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 17:49:53 +0000
Received: by bwz22 with SMTP id 22so4732927bwz.5
        for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 10:49:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=de3tkW1oH1dZNsLE4IvloNq0oNJDuRn95WLb/2FiXXs=;
        b=a2QxxtgizDRpbuz5UzMjgt8WOhDro8PEwDBFK5mcKxqEIQri5+/UxLfehAEzF62ei7
         iTKZkQtinbYno/afnfwheCo6AHO2KafFJ1hwihYH1ZlkLdVvVlsEnmwnTrC0e9BPXAug
         6eiLt2omDZpTjiysG9p2WlATAX9V7kxem8vYk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=NGxs0El4INWaxlA9HNYUo/CGcN8JkVf98G83ZOhxVJL7q4S5hFNDE9d+hdqJs8MlFr
         4wlE559Dt6+GjK6BCyCNyEBBzYY7S2lfu0PcWYD00zDwodX960d5FOhZs4PApPSZnylm
         MFp3FWsZmUARNkyCIthtK/1AgoIMCY1hiELas=
MIME-Version: 1.0
Received: by 10.204.15.1 with HTTP; Mon, 12 Apr 2010 10:49:30 -0700 (PDT)
In-Reply-To: <h2mcbcac69f1004120409g5c27063az40456793bb517a0b@mail.gmail.com>
References: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
	 <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
	 <h2mcbcac69f1004120409g5c27063az40456793bb517a0b@mail.gmail.com>
Date: Mon, 12 Apr 2010 10:49:30 -0700
Received: by 10.204.34.206 with SMTP id m14mr5079473bkd.14.1271094570539; Mon, 
	12 Apr 2010 10:49:30 -0700 (PDT)
Message-ID: <m2jcbcac69f1004121049z1aba8ac3s9279f351b438cff4@mail.gmail.com>
Subject: Re: Removing terms in the Index
From: Railan Xisto <railan.xisto@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00032555f77a5a5f3d04840dc4c3

--00032555f77a5a5f3d04840dc4c3
Content-Type: text/plain; charset=ISO-8859-1

And the main objective: when I pass the word "Lucene in Action", it find and
remove that term of phrase in the Index, for when I pass the 2nd term
("Lucene"), he does not find that phrase anymore, as has been found the
"Lucene in Action" .


2010/4/12 Railan Xisto <railan.xisto@gmail.com>

> Ok. There is a piece of code attached.. As I already said, I want to pass
> that when the term "Lucene in Action" he finds only the 1st sentence.
>
>
>
>
> 2010/4/10 Shai Erera <serera@gmail.com>
>
> Hi. I'm not sure I understand what you searched for. When you search
>> for "Lucene in action", do you search it with the quotes or not? If
>> with the quotes, then I don't understand how the 2nd dox is found.
>>
>> Do you perhaps have a test code you can share w/ us? It can be a short
>> and simple main which creates an index w/ some documents and then
>> searches them.
>>
>> Shai
>>
>> On Saturday, April 10, 2010, Fotos fotos <railan.xisto@gmail.com> wrote:
>> > Hello!
>> > I am a beginner with Lucene. I'm needing to do the following:
>> >
>> > I have a text file with the following terms:
>> >
>> > "Lucene in action"
>> > "Lucene"
>> >
>> > and a file with the following sentences:
>> >
>> > 1 - "Lucene in action now."
>> > 2 - "Lucene for Dummies"
>> > 3 - "Managing Gigabytes"
>> >
>> > I need to search in phrases of doc2, the terms of doc1.
>> >
>> > But in search of the word n-grama: "Lucene in Action", he also finds the
>> 2nd
>> > sentence.
>> >
>> > In this case, I want to meet with the term 1 ("Lucene in Action"), only
>> the
>> > first phrase and remove the term of the index, for not to be found when
>> I
>> > pass the term 2 ("Lucene")
>> >
>> > Railan Xisto
>> > Web Developer
>> >
>>
>>  ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--00032555f77a5a5f3d04840dc4c3--

From java-user-return-45764-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 18:15:47 2010
Return-Path: <java-user-return-45764-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54247 invoked from network); 12 Apr 2010 18:15:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 18:15:47 -0000
Received: (qmail 72775 invoked by uid 500); 12 Apr 2010 18:15:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72743 invoked by uid 500); 12 Apr 2010 18:15:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72735 invoked by uid 99); 12 Apr 2010 18:15:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 18:15:44 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.194] (HELO mout.perfora.net) (74.208.4.194)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 18:15:35 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus4) with ESMTP (Nemesis)
	id 0MQROe-1Nvnb125E4-00TpOX; Mon, 12 Apr 2010 14:15:12 -0400
Message-ID: <67314EA3672C42C698A1C552371FB2CA@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Subject: How to get the tokens for a given document
Date: Mon, 12 Apr 2010 11:15:13 -0700
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_4527_01CADA31.6BE47F30"
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX1+Y3FxXJrf9prOaL3RNVeMnCX2u3Fy5DImr+QF
 HLZGmpcFctsoI6v3yHuhMv36/pyX+pF0xw0A4+Gy3kzvOA3N2c
 TDCuBSXihYbRBod3vMxQw==
X-Virus-Checked: Checked by ClamAV on apache.org

------=_NextPart_000_4527_01CADA31.6BE47F30
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

Hi, folks.
I appreciate the help people have been offering.
Here is my problem.  My immediate need is to get the tokens for a =
document from the Lucene index.  I have a list of documents that I walk, =
one at a time.  Right now, I am getting the tokens and their frequencies =
and the problem is that these stay in the heap as I move from document =
to document.

Is there another way to get the tokens given a document ID?

Thanks,
I'm looking for alternative ways to skin this cat.

Herb
------=_NextPart_000_4527_01CADA31.6BE47F30--


From java-user-return-45765-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 18:37:26 2010
Return-Path: <java-user-return-45765-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66269 invoked from network); 12 Apr 2010 18:37:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 18:37:26 -0000
Received: (qmail 19631 invoked by uid 500); 12 Apr 2010 18:37:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19601 invoked by uid 500); 12 Apr 2010 18:37:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19593 invoked by uid 99); 12 Apr 2010 18:37:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 18:37:23 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 18:37:16 +0000
Received: (qmail 28734 invoked by uid 508); 12 Apr 2010 18:44:33 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 12 Apr 2010 18:44:33 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1O1OKl-0006aO-Ss
	for java-user@lucene.apache.org; Mon, 12 Apr 2010 20:26:07 +0200
Date: Mon, 12 Apr 2010 20:26:07 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: Re: How to get the tokens for a given document
Message-ID: <20100412182607.GH28457@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
References: <67314EA3672C42C698A1C552371FB2CA@Rissos>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <67314EA3672C42C698A1C552371FB2CA@Rissos>
User-Agent: Mutt/1.5.20 (2009-06-14)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

you are walking from indexReader.terms() then on indexReader.termDocs(Term t) 
for each term and then match your docID on the termsDocs enum? So you walk
the whole index?

You need a forward index and lucene is inverted but you have IMHO 2
solutions with lucene (sadly, they both require re-indexing):
 - Store the text you indexed, when you have to walk terms inside a doc,
   just, load that field and analyze it again.
 - Use a TermVector, when you create your content field use the
   constructor which accept the TermVector enum. You can then walk on it
   at search time : indexReader.getTermFreqVector(ID, fieldName)

Hope it helps.

On Mon, Apr 12, 2010 at 11:15:13AM -0700, Herbert Roitblat wrote:
> Hi, folks.
> I appreciate the help people have been offering.
> Here is my problem.  My immediate need is to get the tokens for a document from the Lucene index.  I have a list of documents that I walk, one at a time.  Right now, I am getting the tokens and their frequencies and the problem is that these stay in the heap as I move from document to document.
> 
> Is there another way to get the tokens given a document ID?
> 
> Thanks,
> I'm looking for alternative ways to skin this cat.
> 
> Herb

-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45766-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 20:28:02 2010
Return-Path: <java-user-return-45766-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98369 invoked from network); 12 Apr 2010 20:28:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 20:28:02 -0000
Received: (qmail 51615 invoked by uid 500); 12 Apr 2010 20:28:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51571 invoked by uid 500); 12 Apr 2010 20:28:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51563 invoked by uid 99); 12 Apr 2010 20:28:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 20:28:00 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.195] (HELO mout.perfora.net) (74.208.4.195)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 20:27:51 +0000
Received: from [192.168.1.155] (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus0) with ESMTP (Nemesis)
	id 0MguO8-1NoJEE2mAq-00MjGk; Mon, 12 Apr 2010 16:27:29 -0400
Message-ID: <4BC3822E.8050902@orcatec.com>
Date: Mon, 12 Apr 2010 13:27:26 -0700
From: Herbert L Roitblat <herb@orcatec.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: David Causse <dcausse@spotter.com>, java-user@lucene.apache.org
Subject: Re: How to get the tokens for a given document
References: <67314EA3672C42C698A1C552371FB2CA@Rissos> <20100412182607.GH28457@spotter-dclnx>
In-Reply-To: <20100412182607.GH28457@spotter-dclnx>
Content-Type: multipart/alternative;
 boundary="------------000708090704070709070607"
X-Provags-ID: V01U2FsdGVkX1/x+s1SKQ13+UeV+w4988atZeWEZDqG8+IiSe6
 dpZtLqBKvD6+Nnna0bi0lwkDDHbtGbgIeTyqH2K1D4bhd7X/4q
 ZaLbf+BrJ+8SO+gNxUxkw==
X-Virus-Checked: Checked by ClamAV on apache.org

--------------000708090704070709070607
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Thanks David.
I think that I neglected to say that I am using pyLucene 2.4.0.

Your suggestion is almost what we're doing:

>indexReader.getTermFreqVector(ID, fieldName)

        self.hits = list(self.lSearcher.search(self.query))
        if self.hits:
            self.hit = lucene.Hit.cast_(self.hits[0])
            self.tfvs = self.lReader.getTermFreqVectors(self.hit.id)

At the very least, I may be able to reduce overhead by just adding the 
fieldName to the indexReader.

The problem I'm facing is that all of the tokens in all of the fields in 
all of the documents get added to the heap, and it runs out of space.  
I'm looking for other ways of getting the information I need that might 
not fill up the heap.

Thanks again.
Herb


Your other suggestion may also be what we end up doing.  Since our 
documents can be in any language, I will have to make sure that I use 
the right analyzer.

>load that field and analyze it again. 





David Causse wrote:
> Hi,
>
> you are walking from indexReader.terms() then on indexReader.termDocs(Term t) 
> for each term and then match your docID on the termsDocs enum? So you walk
> the whole index?
>
> You need a forward index and lucene is inverted but you have IMHO 2
> solutions with lucene (sadly, they both require re-indexing):
>  - Store the text you indexed, when you have to walk terms inside a doc,
>    just, load that field and analyze it again.
>  - Use a TermVector, when you create your content field use the
>    constructor which accept the TermVector enum. You can then walk on it
>    at search time : indexReader.getTermFreqVector(ID, fieldName)
>
> Hope it helps.
>
> On Mon, Apr 12, 2010 at 11:15:13AM -0700, Herbert Roitblat wrote:
>   
>> Hi, folks.
>> I appreciate the help people have been offering.
>> Here is my problem.  My immediate need is to get the tokens for a document from the Lucene index.  I have a list of documents that I walk, one at a time.  Right now, I am getting the tokens and their frequencies and the problem is that these stay in the heap as I move from document to document.
>>
>> Is there another way to get the tokens given a document ID?
>>
>> Thanks,
>> I'm looking for alternative ways to skin this cat.
>>
>> Herb
>>     
>
>   

--------------000708090704070709070607--

From java-user-return-45767-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 21:14:13 2010
Return-Path: <java-user-return-45767-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19764 invoked from network); 12 Apr 2010 21:14:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 21:14:12 -0000
Received: (qmail 36067 invoked by uid 500); 12 Apr 2010 21:14:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36037 invoked by uid 500); 12 Apr 2010 21:14:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36029 invoked by uid 99); 12 Apr 2010 21:14:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 21:14:10 +0000
X-ASF-Spam-Status: No, hits=-2.4 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED
X-Spam-Check-By: apache.org
Received-SPF: unknown (athena.apache.org: error in processing during lookup of siraj@jobdiva.com)
Received: from [64.18.2.159] (HELO exprod7og103.obsmtp.com) (64.18.2.159)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 12 Apr 2010 21:14:02 +0000
Received: from source ([64.147.106.2]) (using TLSv1) by exprod7ob103.postini.com ([64.18.6.12]) with SMTP
	ID DSNKS8ONBLyCQR5TtIpSs0gHK0G5tzgIhRcT@postini.com; Mon, 12 Apr 2010 14:13:42 PDT
Received: from [10.10.1.80] (12.111.23.142) by mail.jobdiva.com (10.10.30.148)
 with Microsoft SMTP Server (TLS) id 8.1.393.1; Mon, 12 Apr 2010 17:15:48
 -0400
Message-ID: <4BC38D03.9020202@jobdiva.com>
Date: Mon, 12 Apr 2010 17:13:39 -0400
From: Siraj Haider <siraj@jobdiva.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.8) Gecko/20100227 Thunderbird/3.0.3
MIME-Version: 1.0
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Subject: WhitespaceAnalyzer and version
Content-Type: text/plain; charset="ISO-8859-1"; format=flowed
Content-Transfer-Encoding: 7bit

We are in the process of removing the deprecated api from our code to 
move to version.  One of the deprecation is, the queryparser now expects 
a version parameter in the constructor.  I also have read somewhere that 
we should pass the same version to analyzer when indexing as wel as when 
searching.  We use WhitespaceAnalyzer and I am unable to find a 
constructor with a version in it.

Another thing is, do we need to re-index if we want to supply 
Version.LUCENE_CURRENT as the version? what are other implications?

thanks
-siraj

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45768-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 12 21:58:01 2010
Return-Path: <java-user-return-45768-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56315 invoked from network); 12 Apr 2010 21:58:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Apr 2010 21:58:00 -0000
Received: (qmail 92900 invoked by uid 500); 12 Apr 2010 21:57:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92870 invoked by uid 500); 12 Apr 2010 21:57:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92862 invoked by uid 99); 12 Apr 2010 21:57:58 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 21:57:58 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [141.211.3.202] (HELO itcs-ehub-02.adsroot.itcs.umich.edu) (141.211.3.202)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Apr 2010 21:57:50 +0000
Received: from ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu ([141.211.3.233]) by
 itcs-ehub-02.adsroot.itcs.umich.edu ([141.211.3.202]) with mapi; Mon, 12 Apr
 2010 17:57:27 -0400
From: "Burton-West, Tom" <tburtonw@umich.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 12 Apr 2010 17:57:30 -0400
Subject: Understanding lucene indexes and disk I/O
Thread-Topic: Understanding lucene indexes and disk I/O
Thread-Index: AcraiyXVF3OE9PhEQvGy1EpgulFZvw==
Message-ID: <A902805D9E8F66428EACF947DDA9840C057C4207DE@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/alternative;
	boundary="_000_A902805D9E8F66428EACF947DDA9840C057C4207DEITCSECLS1VS3a_"
MIME-Version: 1.0

--_000_A902805D9E8F66428EACF947DDA9840C057C4207DEITCSECLS1VS3a_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hi all,

Please let me know if this should be posted instead to the Lucene java-dev =
list.

We have very large tis files (about 36 GB).  I have not been too concerned =
as I assumed that due to the indexing of the tis file by the tii file, only=
 a small portion of the file needed to be read.  However, upon re-reading t=
he Lucene Index File Formats document: http://lucene.apache.org/java/3_0_1/=
fileformats.html#Term%20Dictionary
I am now wondering whether most of the tis file may need to be read if a te=
rm is near the end of the file.

I'm trying to understand whether lucene has enough information stored in th=
e *tii and *tis files to determine what byte offset in the prx file to seek=
 to in order to get the freq or positions list for a particular term and wh=
ether a sequential read of the entire *tis file up to the term being sought=
 is needed in order to decode ProxDeltas and determint the byte offset.

 What has me confused is that the Lucene Index File Formats document says:

"ProxDelta determines the position of this term's TermPositions within the =
.prx file. In particular, it is the difference between the position of this=
 term's data in that file and the position of the previous term's data (or =
zero, for the first term in the file. For fields with omitTf true, this wil=
l be 0 since prox information is not stored."

I assumed that Lucene implements a binary search of the tii file, then read=
s the appropriate 128 (IndexDivisor) entries from the tis file and does a b=
inary search on that.   (So that should be one disk seek when the searcher =
starts up to read in the entire tii file and then a second disk seek to loa=
d in the appropriate data for 128 terms from the tis file.  However, once a=
 term's entry in the tis file is found, if only the difference between this=
 term and the previous term's position in the prx file is stored, it seems =
that in order to get the actual byte offset of a term in the prx file, all =
of the previous term's ProxDelta's  starting at the first term in the file,=
 would have to be read and added together.  If that is true then we are tal=
king a sequential read of the entire tis file up to the current term.

Is this correct?   Can someone point me to the area of the code base where =
this is implemented ?   Am I missing something here?


Tom Burton-West


--_000_A902805D9E8F66428EACF947DDA9840C057C4207DEITCSECLS1VS3a_--

From java-user-return-45769-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 04:20:21 2010
Return-Path: <java-user-return-45769-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23737 invoked from network); 13 Apr 2010 04:20:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 04:20:21 -0000
Received: (qmail 71123 invoked by uid 500); 13 Apr 2010 04:20:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70882 invoked by uid 500); 13 Apr 2010 04:20:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70874 invoked by uid 99); 13 Apr 2010 04:20:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 04:20:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of goksron@gmail.com designates 74.125.92.26 as permitted sender)
Received: from [74.125.92.26] (HELO qw-out-2122.google.com) (74.125.92.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 04:20:11 +0000
Received: by qw-out-2122.google.com with SMTP id 8so2014962qwh.53
        for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 21:19:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=zabYWLuYJNN4ZeFE9jcHxZJNIm0+DbVQVhJRx4P6nj0=;
        b=TTBIx0eriiWL4+vc5hR/k+uPdgSoOkw4MaqebbcO/se/MK38URLd80+ja3WLkcVK8v
         DhwbvIYjapRDq7x693csgRml8oslzeMipEpGYUKXFP1IPvcnhaY4N8gucyJYOKg4z5LP
         xvRqQiCuAyIarDT7d7NZo1Z+TUqh9lQskiUcU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=fiQDedx5Xdzt6Ouubb9trI2Ru3v6JdLKZ3miCxmjuh8AHXGxbgOB90T54+hTShnLuv
         CVWfNNE7u8ZesyGi4xePLSiUF6I3r8qnDLXlgfMZ41K256oyzw3KZ9vGkEsycElThCx+
         uxFQZsEOb3eSb1cfnVq5DJuEiJrTxZf2xxBd0=
MIME-Version: 1.0
Received: by 10.229.234.6 with HTTP; Mon, 12 Apr 2010 21:19:45 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
Date: Mon, 12 Apr 2010 21:19:45 -0700
Received: by 10.229.97.207 with SMTP id m15mr7534717qcn.6.1271132385532; Mon, 
	12 Apr 2010 21:19:45 -0700 (PDT)
Message-ID: <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Lance Norskog <goksron@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

There is some bugs where the writer data structures retain data after
it is flushed. They are committed as of maybe the past week. If you
can pull the trunk and try it with your use case, that would be great.

On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> I was on vacation last week so just getting back to this... =C2=A0Here is=
 the info stream (as an attachment). =C2=A0I'll see what I can do about red=
ucing the heap dump (It was supplied by a colleague).
>
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Saturday, April 03, 2010 3:39 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Hmm why is the heap dump so immense? =C2=A0Normally it contains the top N
> (eg 100) object types and their count/aggregate RAM usage.
>
> Can you attach the infoStream output to an email (to java-user)?
>
> Mike
>
> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> I have this and the heap dump is 63mb zipped. =C2=A0The info stream is m=
uch smaller (31 kb zipped), but I don't know how to get them to you.
>>
>> We are not using the NRT readers
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Thursday, April 01, 2010 5:21 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> Hmm, not good. =C2=A0Can you post a heap dump? =C2=A0Also, can you turn =
on
>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>
>> IndexWriter should not hang onto much beyond the RAM buffer. =C2=A0But, =
it
>> does allocate and then recycle this RAM buffer, so even in an idle
>> state (having indexed enough docs to fill up the RAM buffer at least
>> once) it'll hold onto those 16 MB.
>>
>> Are you using getReader (to get your NRT readers)? =C2=A0If so, are you
>> really sure you're eventually closing the previous reader after
>> opening a new one?
>>
>> Mike
>>
>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> We are seeing a situation where the IndexWriter is using up the Java He=
ap space and only releases memory for garbage collection upon a commit. =C2=
=A0 We are using the default RAMBufferSize of 16 mb. =C2=A0We are using Luc=
ene 2.9.1. We are set at heap size of 512 mb.
>>>
>>> We have a large number of documents that are run through Tika and then =
added to the index. =C2=A0The data from Tika is changed to a string, and th=
en sent to Lucene. =C2=A0Heap dumps clearly show the data in the Lucene cla=
sses and not in Tika. =C2=A0Our intent is to only perform a commit once the=
 entire indexing run is complete, but several hours into the process everyt=
hing comes to a crawl. =C2=A0In using both JConsole and VisualVM =C2=A0we c=
an see that the heap space is maxed out and garbage collection is not able =
to clean up any memory once we get into this state. =C2=A0It is our underst=
anding that the IndexWriter should be only holding onto 16 mb of data befor=
e it flushes it, but what we are seeing is that while it is in fact writing=
 data to disk when it hits the 16 mb limit, it is also holding onto some da=
ta in memory and not allowing garbage collection to take place, and this co=
ntinues until garbage collection is unable to free up enough space to all t=
hings to move faster than a crawl.
>>>
>>> As a test we caused a commit to occur after each document is indexed an=
d we see the total amount of memory reduced from nearly 100% of the Java He=
ap to around 70-75%. =C2=A0The profiling tools now show that the memory is =
cleaned up to some extent after each document. =C2=A0But of course this com=
pletely defeats the whole reason why we want to only commit at the end of t=
he run for performance sake. =C2=A0Most of the data, as seen using Heap ana=
lasis, is held in Byte, Character, and Integer classes whos GC roots are ti=
ed back to the Writer Objects and threads. =C2=A0The instance counts, after=
 running just 1,100 documents seems staggering
>>>
>>> Is there additional data that the IndexWriter hangs onto regardless of =
when it hits the RAMBufferSize limit? =C2=A0Why are we seeing the heap spac=
e all being used up?
>>>
>>> A side question to this is the fact that we always see a large amount o=
f memory used by the IndexWriter even after our indexing has been completed=
 and all commits have taken place (basically in an idle state). =C2=A0Why w=
ould this be? =C2=A0Is the only way to totally clean up the memory is to cl=
ose the writer? =C2=A0Our index is also used for real time indexing so the =
IndexWriter is intended to remain open for the lifetime of the app.
>>>
>>> Any help in understanding why the IndexWriter is maxing out our heap sp=
ace or what is expected from memory usage of the IndexWriter would be appre=
ciated.
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>



--=20
Lance Norskog
goksron@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45770-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 05:41:52 2010
Return-Path: <java-user-return-45770-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32929 invoked from network); 13 Apr 2010 05:41:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 05:41:52 -0000
Received: (qmail 4729 invoked by uid 500); 13 Apr 2010 05:41:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4537 invoked by uid 500); 13 Apr 2010 05:41:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4529 invoked by uid 99); 13 Apr 2010 05:41:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 05:41:49 +0000
X-ASF-Spam-Status: No, hits=0.2 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 72.14.220.154 as permitted sender)
Received: from [72.14.220.154] (HELO fg-out-1718.google.com) (72.14.220.154)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 05:41:43 +0000
Received: by fg-out-1718.google.com with SMTP id d23so2810201fga.5
        for <java-user@lucene.apache.org>; Mon, 12 Apr 2010 22:41:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=FE2PWKwQM+F+Ny9qPvWweUL7xvPTdshUu1RDVZD/T+0=;
        b=DUr0whDrQpllpw+s09Nehrh9zuv8UMDpKlf57lQywh9fvrjfht5YqRIJvrAdv9iRZX
         JQFjAnXQwTDgl0owpWYVE7JjLVbzFLPa82ACuk7Y8M02pS/LIhNtagIGIvq48ZjJtBi8
         /EQYLtWEs6A3gqIswU2mbOFuPLNpMxTlyNIuE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=WM3yf5TTc15xwJzRBh8kte0HHG4R+bFPJpKCtmUm+i7Fg+ujjdpQmlfFXiFx6gg20F
         CWijXsWUA6tmipdb4UJNjIPVQyXaWZVo/LQHTqjqv8s8VWz3NbHUQLXgNak9MPdZ5Hyj
         /OAP1foJgyAtvqeu1fQ4vf6jA0V+mcOmC8750=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Mon, 12 Apr 2010 22:41:22 -0700 (PDT)
In-Reply-To: <4BC38D03.9020202@jobdiva.com>
References: <4BC38D03.9020202@jobdiva.com>
Date: Tue, 13 Apr 2010 08:41:22 +0300
Received: by 10.102.170.16 with SMTP id s16mr2732621mue.16.1271137282566; Mon, 
	12 Apr 2010 22:41:22 -0700 (PDT)
Message-ID: <t2v786fde51004122241s77a61e28s9772243f2214b146@mail.gmail.com>
Subject: Re: WhitespaceAnalyzer and version
From: Shai Erera <serera@gmail.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi

WhitespaceAnalyzer definitely has a Version dependent ctor. What
Lucene version do you use?

You van use LUCENE_CURRENT but be aware that of a certain Analyzer's
behavior has changed in a way that affects your app, you'll need to
reindex your data. Usually an Analyzer (or any other Version-aware
object) documents the differences between the versions. Some classes
take Version as a placeholder for future changes, while not doing
anything special w/ them st the moment.

It is best, I think, if you stick w/ a specific version (like
LUCENE_30) and change that before you plan to reindex your data.
Otherwise, if you always reindex your stuff when upgrading Lucene,
then LUCENE_CURRENT is probably good.

Note also that some changes between versions may result on you
updating your users (manual) about what to expext from searches.

Hope this helps,
Shai

On Tuesday, April 13, 2010, Siraj Haider <siraj@jobdiva.com> wrote:
> We are in the process of removing the deprecated api from our code to mov=
e to version. =A0One of the deprecation is, the queryparser now expects a v=
ersion parameter in the constructor. =A0I also have read somewhere that we =
should pass the same version to analyzer when indexing as wel as when searc=
hing. =A0We use WhitespaceAnalyzer and I am unable to find a constructor wi=
th a version in it.
>
> Another thing is, do we need to re-index if we want to supply Version.LUC=
ENE_CURRENT as the version? what are other implications?
>
> thanks
> -siraj
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45771-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 06:23:50 2010
Return-Path: <java-user-return-45771-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52487 invoked from network); 13 Apr 2010 06:23:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 06:23:50 -0000
Received: (qmail 30821 invoked by uid 500); 13 Apr 2010 06:23:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30647 invoked by uid 500); 13 Apr 2010 06:23:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30639 invoked by uid 99); 13 Apr 2010 06:23:47 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 06:23:47 +0000
X-ASF-Spam-Status: No, hits=-0.6 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 06:23:41 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 0DDA0D36004
	for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 08:23:18 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id OalbgC0i2AgP for <java-user@lucene.apache.org>;
	Tue, 13 Apr 2010 08:23:12 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 54DA8D36003
	for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 08:23:12 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4BC38D03.9020202@jobdiva.com>
In-Reply-To: <4BC38D03.9020202@jobdiva.com>
Subject: RE: WhitespaceAnalyzer and version
Date: Tue, 13 Apr 2010 08:23:17 +0200
Message-ID: <012101cadad1$ce9d0f20$6bd72d60$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrahRrhY7UElVeYQ7GYCwDpgnk08QAS0Dbw
Content-Language: de

As of Lucene 3.0, WhitespaceAnalyzer has not yet a Version ctor. It will =
come in 3.1, when Lucene is changed to be Unicode 4.0 conform (3.0 and =
before is Unicode 3.0, which is Java 1.4).

QueryParser need the Version ctor for the handling of stop words. As =
WhiteSpace Analyzer does not use StopFilter, there was no need for a =
version ctor. QueryParser will pass the version not to the analyzer, it =
will use it solely for its own behavior. But you should use the same =
version for QP and your Analyzer. If one of the components has no =
Version, there is no incompatible change (in fact, Whitespace Analyzer =
was not changed). Please also read the document about moving from Java =
1.4 to Java 5/6 in the Lucene ZIP file (if you already used Java 5/6 =
with older Lucene versions before, all is fine - reindexing may only =
required if you move your JVM installation from 1.4 -> 5/6; independent =
from Lucene's version).

> Another thing is, do we need to re-index if we want to supply
> Version.LUCENE_CURRENT as the version? what are other implications?

Yes! And please, please: Don't use Version.LUCENE_CURRENT (which is =
already deprecated as of Lucene 2.9.2 and 3.0.1 as a warning). Use a =
specific version, so you will never need to reindex until you change the =
version.

To have backwards compatibility with existing indexes from pre-2.9 =
without reindexing use LUCENE_24.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Siraj Haider [mailto:siraj@jobdiva.com]
> Sent: Monday, April 12, 2010 11:14 PM
> To: java-user@lucene.apache.org
> Subject: WhitespaceAnalyzer and version
>=20
> We are in the process of removing the deprecated api from our code to
> move to version.  One of the deprecation is, the queryparser now
> expects
> a version parameter in the constructor.  I also have read somewhere
> that
> we should pass the same version to analyzer when indexing as wel as
> when
> searching.  We use WhitespaceAnalyzer and I am unable to find a
> constructor with a version in it.
>=20
> Another thing is, do we need to re-index if we want to supply
> Version.LUCENE_CURRENT as the version? what are other implications?
>=20
> thanks
> -siraj
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45772-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 09:27:17 2010
Return-Path: <java-user-return-45772-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52728 invoked from network); 13 Apr 2010 09:27:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 09:27:17 -0000
Received: (qmail 97443 invoked by uid 500); 13 Apr 2010 09:27:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97227 invoked by uid 500); 13 Apr 2010 09:27:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97213 invoked by uid 99); 13 Apr 2010 09:27:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:27:14 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.210.179] (HELO mail-yx0-f179.google.com) (209.85.210.179)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:27:07 +0000
Received: by yxe9 with SMTP id 9so3414349yxe.29
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 02:26:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Tue, 13 Apr 2010 02:26:46 -0700 (PDT)
In-Reply-To: <A902805D9E8F66428EACF947DDA9840C057C4207DE@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <A902805D9E8F66428EACF947DDA9840C057C4207DE@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Date: Tue, 13 Apr 2010 05:26:46 -0400
Received: by 10.151.92.15 with SMTP id u15mr5338541ybl.11.1271150806498; Tue, 
	13 Apr 2010 02:26:46 -0700 (PDT)
Message-ID: <x2q9ac0c6aa1004130226sa48b787cg17b0236d09b98223@mail.gmail.com>
Subject: Re: Understanding lucene indexes and disk I/O
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Tom,

Fear not: we only scan up to 128 terms, to find the specific term.

First, the terms dict index (tii) is fully loaded into RAM, and then a
binary search is done on this (in-RAM) to find the nearest index term
just before the term you want.  Then, we seek to that spot in the
main terms dict (tis) file, and scan (at most 128 entries) to find the
term.

On the frq/prx deltas: the tii holds absolute pointers.  So, on
seeking to that first spot in the tis, we know the absolute frq/prx
(long) offsets, and then during scanning we just add the deltas we
see to those base absolutes.

BTW, this approach sucks up alot of extra RAM (holding 2 longs =3D 16
bytes, per indexed term)... in flex (now committed to trunk) we've
improved this so that the tii entry does not hold these longs, and,
instead, every indexed term inside the tis file holds the absolute
pointer not the delta.  We also switched to parallel arrays, to avoid
the GC/object RAM overhead of one object per indexed term, and used
packed ints for some of these arrays.

Hmm though we also hold the terms characters as utf8 bytes, which may
net/net take more RAM for your case...

I would love to get ahold of your terms dict :)  I'd have a field day
testing Lucene against it... I'm very curious how the flex
improvements affect your usage.

Mike

On Mon, Apr 12, 2010 at 5:57 PM, Burton-West, Tom <tburtonw@umich.edu> wrot=
e:
> Hi all,
>
> Please let me know if this should be posted instead to the Lucene java-de=
v list.
>
> We have very large tis files (about 36 GB). =A0I have not been too concer=
ned as I assumed that due to the indexing of the tis file by the tii file, =
only a small portion of the file needed to be read. =A0However, upon re-rea=
ding the Lucene Index File Formats document: http://lucene.apache.org/java/=
3_0_1/fileformats.html#Term%20Dictionary
> I am now wondering whether most of the tis file may need to be read if a =
term is near the end of the file.
>
> I'm trying to understand whether lucene has enough information stored in =
the *tii and *tis files to determine what byte offset in the prx file to se=
ek to in order to get the freq or positions list for a particular term and =
whether a sequential read of the entire *tis file up to the term being soug=
ht is needed in order to decode ProxDeltas and determint the byte offset.
>
> =A0What has me confused is that the Lucene Index File Formats document sa=
ys:
>
> "ProxDelta determines the position of this term's TermPositions within th=
e .prx file. In particular, it is the difference between the position of th=
is term's data in that file and the position of the previous term's data (o=
r zero, for the first term in the file. For fields with omitTf true, this w=
ill be 0 since prox information is not stored."
>
> I assumed that Lucene implements a binary search of the tii file, then re=
ads the appropriate 128 (IndexDivisor) entries from the tis file and does a=
 binary search on that. =A0 (So that should be one disk seek when the searc=
her starts up to read in the entire tii file and then a second disk seek to=
 load in the appropriate data for 128 terms from the tis file. =A0However, =
once a term's entry in the tis file is found, if only the difference betwee=
n this term and the previous term's position in the prx file is stored, it =
seems that in order to get the actual byte offset of a term in the prx file=
, all of the previous term's ProxDelta's =A0starting at the first term in t=
he file, would have to be read and added together. =A0If that is true then =
we are talking a sequential read of the entire tis file up to the current t=
erm.
>
> Is this correct? =A0 Can someone point me to the area of the code base wh=
ere this is implemented ? =A0 Am I missing something here?
>
>
> Tom Burton-West
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45773-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 09:36:40 2010
Return-Path: <java-user-return-45773-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57683 invoked from network); 13 Apr 2010 09:36:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 09:36:40 -0000
Received: (qmail 9640 invoked by uid 500); 13 Apr 2010 09:36:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9560 invoked by uid 500); 13 Apr 2010 09:36:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9552 invoked by uid 99); 13 Apr 2010 09:36:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:36:37 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:36:32 +0000
Received: by ywh38 with SMTP id 38so3358954ywh.29
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 02:36:11 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Tue, 13 Apr 2010 02:36:10 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
Date: Tue, 13 Apr 2010 05:36:10 -0400
Received: by 10.150.165.7 with SMTP id n7mr4610182ybe.38.1271151370636; Tue, 
	13 Apr 2010 02:36:10 -0700 (PDT)
Message-ID: <q2r9ac0c6aa1004130236u3906af96yf937ea48d68ca205@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

The infoStream generally looks healthy.  You seem to have a contained
set of unique field names.

The one thing that's interesting is... your docs are quite large.  If
you grep for "flush: segment=3D" in your infoStream you see how many
docs "fit" in 16 MB before flushing, and it's lowish (as high as ~300
and as low as only 1).

The "only 1" case looks like it could be the cause of your OOME, ie,
there are some docs that are so large that indexing that 1 doc causes
IndexWriter to use too much RAM and then immediately flush... Lucene
cannot flush mid-document.  So this means IndexWriter will allocate
however much RAM is needed for a single document, and flush right
after that, very easily needing to exceed the 16 MB temporarily.

Can you test whether you are hitting OOME on certain specific [very
large] documents?  The worst case poison-pill document is one that has
many many unique terms.

Mike

On Mon, Apr 12, 2010 at 11:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> I was on vacation last week so just getting back to this... =A0Here is th=
e info stream (as an attachment). =A0I'll see what I can do about reducing =
the heap dump (It was supplied by a colleague).
>
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Saturday, April 03, 2010 3:39 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Hmm why is the heap dump so immense? =A0Normally it contains the top N
> (eg 100) object types and their count/aggregate RAM usage.
>
> Can you attach the infoStream output to an email (to java-user)?
>
> Mike
>
> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> I have this and the heap dump is 63mb zipped. =A0The info stream is much=
 smaller (31 kb zipped), but I don't know how to get them to you.
>>
>> We are not using the NRT readers
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Thursday, April 01, 2010 5:21 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>
>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, it
>> does allocate and then recycle this RAM buffer, so even in an idle
>> state (having indexed enough docs to fill up the RAM buffer at least
>> once) it'll hold onto those 16 MB.
>>
>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>> really sure you're eventually closing the previous reader after
>> opening a new one?
>>
>> Mike
>>
>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> We are seeing a situation where the IndexWriter is using up the Java He=
ap space and only releases memory for garbage collection upon a commit. =A0=
 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene 2.=
9.1. We are set at heap size of 512 mb.
>>>
>>> We have a large number of documents that are run through Tika and then =
added to the index. =A0The data from Tika is changed to a string, and then =
sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes a=
nd not in Tika. =A0Our intent is to only perform a commit once the entire i=
ndexing run is complete, but several hours into the process everything come=
s to a crawl. =A0In using both JConsole and VisualVM =A0we can see that the=
 heap space is maxed out and garbage collection is not able to clean up any=
 memory once we get into this state. =A0It is our understanding that the In=
dexWriter should be only holding onto 16 mb of data before it flushes it, b=
ut what we are seeing is that while it is in fact writing data to disk when=
 it hits the 16 mb limit, it is also holding onto some data in memory and n=
ot allowing garbage collection to take place, and this continues until garb=
age collection is unable to free up enough space to all things to move fast=
er than a crawl.
>>>
>>> As a test we caused a commit to occur after each document is indexed an=
d we see the total amount of memory reduced from nearly 100% of the Java He=
ap to around 70-75%. =A0The profiling tools now show that the memory is cle=
aned up to some extent after each document. =A0But of course this completel=
y defeats the whole reason why we want to only commit at the end of the run=
 for performance sake. =A0Most of the data, as seen using Heap analasis, is=
 held in Byte, Character, and Integer classes whos GC roots are tied back t=
o the Writer Objects and threads. =A0The instance counts, after running jus=
t 1,100 documents seems staggering
>>>
>>> Is there additional data that the IndexWriter hangs onto regardless of =
when it hits the RAMBufferSize limit? =A0Why are we seeing the heap space a=
ll being used up?
>>>
>>> A side question to this is the fact that we always see a large amount o=
f memory used by the IndexWriter even after our indexing has been completed=
 and all commits have taken place (basically in an idle state). =A0Why woul=
d this be? =A0Is the only way to totally clean up the memory is to close th=
e writer? =A0Our index is also used for real time indexing so the IndexWrit=
er is intended to remain open for the lifetime of the app.
>>>
>>> Any help in understanding why the IndexWriter is maxing out our heap sp=
ace or what is expected from memory usage of the IndexWriter would be appre=
ciated.
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45774-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 09:37:29 2010
Return-Path: <java-user-return-45774-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58080 invoked from network); 13 Apr 2010 09:37:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 09:37:29 -0000
Received: (qmail 12362 invoked by uid 500); 13 Apr 2010 09:37:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12263 invoked by uid 500); 13 Apr 2010 09:37:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12255 invoked by uid 99); 13 Apr 2010 09:37:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:37:26 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:37:20 +0000
Received: by gyf1 with SMTP id 1so3272706gyf.35
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 02:36:58 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Tue, 13 Apr 2010 02:36:58 -0700 (PDT)
In-Reply-To: <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
Date: Tue, 13 Apr 2010 05:36:58 -0400
Received: by 10.150.77.25 with SMTP id z25mr4756890yba.111.1271151418179; Tue, 
	13 Apr 2010 02:36:58 -0700 (PDT)
Message-ID: <t2g9ac0c6aa1004130236vcc28a3fesead5409f7557ca55@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

This would be a very good thing to try, given that you have some huge
documents that, indexed alone, use far more than your RAM buffer.

Mike

On Tue, Apr 13, 2010 at 12:19 AM, Lance Norskog <goksron@gmail.com> wrote:
> There is some bugs where the writer data structures retain data after
> it is flushed. They are committed as of maybe the past week. If you
> can pull the trunk and try it with your use case, that would be great.
>
> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> I was on vacation last week so just getting back to this... =A0Here is t=
he info stream (as an attachment). =A0I'll see what I can do about reducing=
 the heap dump (It was supplied by a colleague).
>>
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Saturday, April 03, 2010 3:39 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> Hmm why is the heap dump so immense? =A0Normally it contains the top N
>> (eg 100) object types and their count/aggregate RAM usage.
>>
>> Can you attach the infoStream output to an email (to java-user)?
>>
>> Mike
>>
>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> I have this and the heap dump is 63mb zipped. =A0The info stream is muc=
h smaller (31 kb zipped), but I don't know how to get them to you.
>>>
>>> We are not using the NRT readers
>>>
>>> -----Original Message-----
>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>> Sent: Thursday, April 01, 2010 5:21 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>
>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, it
>>> does allocate and then recycle this RAM buffer, so even in an idle
>>> state (having indexed enough docs to fill up the RAM buffer at least
>>> once) it'll hold onto those 16 MB.
>>>
>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>> really sure you're eventually closing the previous reader after
>>> opening a new one?
>>>
>>> Mike
>>>
>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>>> We are seeing a situation where the IndexWriter is using up the Java H=
eap space and only releases memory for garbage collection upon a commit. =
=A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene=
 2.9.1. We are set at heap size of 512 mb.
>>>>
>>>> We have a large number of documents that are run through Tika and then=
 added to the index. =A0The data from Tika is changed to a string, and then=
 sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes =
and not in Tika. =A0Our intent is to only perform a commit once the entire =
indexing run is complete, but several hours into the process everything com=
es to a crawl. =A0In using both JConsole and VisualVM =A0we can see that th=
e heap space is maxed out and garbage collection is not able to clean up an=
y memory once we get into this state. =A0It is our understanding that the I=
ndexWriter should be only holding onto 16 mb of data before it flushes it, =
but what we are seeing is that while it is in fact writing data to disk whe=
n it hits the 16 mb limit, it is also holding onto some data in memory and =
not allowing garbage collection to take place, and this continues until gar=
bage collection is unable to free up enough space to all things to move fas=
ter than a crawl.
>>>>
>>>> As a test we caused a commit to occur after each document is indexed a=
nd we see the total amount of memory reduced from nearly 100% of the Java H=
eap to around 70-75%. =A0The profiling tools now show that the memory is cl=
eaned up to some extent after each document. =A0But of course this complete=
ly defeats the whole reason why we want to only commit at the end of the ru=
n for performance sake. =A0Most of the data, as seen using Heap analasis, i=
s held in Byte, Character, and Integer classes whos GC roots are tied back =
to the Writer Objects and threads. =A0The instance counts, after running ju=
st 1,100 documents seems staggering
>>>>
>>>> Is there additional data that the IndexWriter hangs onto regardless of=
 when it hits the RAMBufferSize limit? =A0Why are we seeing the heap space =
all being used up?
>>>>
>>>> A side question to this is the fact that we always see a large amount =
of memory used by the IndexWriter even after our indexing has been complete=
d and all commits have taken place (basically in an idle state). =A0Why wou=
ld this be? =A0Is the only way to totally clean up the memory is to close t=
he writer? =A0Our index is also used for real time indexing so the IndexWri=
ter is intended to remain open for the lifetime of the app.
>>>>
>>>> Any help in understanding why the IndexWriter is maxing out our heap s=
pace or what is expected from memory usage of the IndexWriter would be appr=
eciated.
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>
>
> --
> Lance Norskog
> goksron@gmail.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45775-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 09:42:56 2010
Return-Path: <java-user-return-45775-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61072 invoked from network); 13 Apr 2010 09:42:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 09:42:56 -0000
Received: (qmail 19829 invoked by uid 500); 13 Apr 2010 09:42:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19728 invoked by uid 500); 13 Apr 2010 09:42:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19720 invoked by uid 99); 13 Apr 2010 09:42:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:42:53 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:42:46 +0000
Received: by gwaa12 with SMTP id a12so3283764gwa.35
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 02:42:25 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Tue, 13 Apr 2010 02:42:25 -0700 (PDT)
In-Reply-To: <4BC3250D.90006@orcatec.com>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
	 <4BC206C8.5070103@orcatec.com>
	 <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com>
	 <4BC3250D.90006@orcatec.com>
Date: Tue, 13 Apr 2010 05:42:25 -0400
Received: by 10.150.244.4 with SMTP id r4mr5062963ybh.214.1271151745190; Tue, 
	13 Apr 2010 02:42:25 -0700 (PDT)
Message-ID: <m2y9ac0c6aa1004130242zcd75dce7o7f160c507852673@mail.gmail.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On Mon, Apr 12, 2010 at 9:50 AM, Herbert L Roitblat <herb@orcatec.com> wrote:
> Thank you Michael.  Your suggestions are helpful.  I inherited all of the
> code that uses pyLucene and don't consider myself an expert on it, so I very
> much appreciate your suggestions.
>
> It does not seem to be the case that these elements represent the index of
> the collection. TermInfo and Term grow as I retrieve more documents.  There
> was no trouble building the index.

Sorry I meant the "terms dict index".  Lucene internally loads certain
data structures (like the terms dict index, seen as many
TermInfo/Term/String objects) from the index into RAM, so a heap dump
of even a single open IndexReader is expected to show a great many
TermInfo/Term/String objects (though in 3.1 this is greatly improved).

> The contents of these fields are the tokens (some fields are tokenized,
> others not) of the document fields.  In the tokenized fields, there is one
> object for each word. They seem to be in order of the documents for which
> the term vectors are being sought.  So these objects seem to represent a
> "concatenation" of all of the documents being considered in order, and if
> they are never removed, would always overwhelm the heap with a large
> document set.  They are not the index in the usual sense, I think.  Before I
> start retrieving documents, there is barely anything in these objects.
>
> What is holding the document contents in the heap after the fields
> information is returned?
>
> Can you say more about incRef/decRef?  I deleted all variables that
> interacted with Lucene and it seems to have made no difference
>
> There are not a lot of different fields, I would say on the order of 50 with
> about 20 of them in virtually every document.

Can you run CheckIndex (java -ea -cp /path/to/lucene-core-XXX.jar
org.apache.lucene.index.CheckIndex /path/to/your/index) and post the
output?

> It uses:
> lucene.IndexReader.open(self._store)

This is perfectly correct.  If you're not using incRef/decRef on this
reader then, then calling close on it will close it.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45776-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 09:46:35 2010
Return-Path: <java-user-return-45776-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62696 invoked from network); 13 Apr 2010 09:46:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 09:46:35 -0000
Received: (qmail 22931 invoked by uid 500); 13 Apr 2010 09:46:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22838 invoked by uid 500); 13 Apr 2010 09:46:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22827 invoked by uid 99); 13 Apr 2010 09:46:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:46:32 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 09:46:26 +0000
Received: by gwaa12 with SMTP id a12so3284962gwa.35
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 02:46:04 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Tue, 13 Apr 2010 02:46:04 -0700 (PDT)
In-Reply-To: <237EB97F513A43BDADA0264930A66511@Rissos>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
	 <4BC206C8.5070103@orcatec.com>
	 <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com>
	 <4BC3250D.90006@orcatec.com> <237EB97F513A43BDADA0264930A66511@Rissos>
Date: Tue, 13 Apr 2010 05:46:04 -0400
Received: by 10.150.174.18 with SMTP id w18mr5067044ybe.87.1271151964342; Tue, 
	13 Apr 2010 02:46:04 -0700 (PDT)
Message-ID: <y2p9ac0c6aa1004130246rfa3ea942h8b4515671e927d6c@mail.gmail.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Can you whittle down your example even more?

EG don't read the term vectors for the first hit.  Just open a single
reader and do the TermQuery search over and over?

BTW what does this line in PyLucene do?:

   tfvP =3D lucene.TermFreqVector.cast_(tfv)

You never hit exceptions in this code right?  (Because this'd cause
your close to not be called -- really you should move the .close()
calls into a finally clause).

Mike

On Mon, Apr 12, 2010 at 10:54 AM, Herbert Roitblat <herb@orcatec.com> wrote=
:
> Update:
> reusing the reader and searcher made almost no difference. =A0It still ea=
ts up
> the heap.
> ----- Original Message ----- From: "Herbert L Roitblat" <herb@orcatec.com=
>
> To: <java-user@lucene.apache.org>
> Sent: Monday, April 12, 2010 6:50 AM
> Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
>
>
>> Thank you Michael. =A0Your suggestions are helpful. =A0I inherited all o=
f
>> the code that uses pyLucene and don't consider myself an expert on it,
>> so I very much appreciate your suggestions.
>>
>> It does not seem to be the case that these elements represent the index
>> of the collection. TermInfo and Term grow as I retrieve more documents.
>> There was no trouble building the index.
>>
>> The contents of these fields are the tokens (some fields are tokenized,
>> others not) of the document fields. =A0In the tokenized fields, there is
>> one object for each word. They seem to be in order of the documents for
>> which the term vectors are being sought. =A0So these objects seem to
>> represent a "concatenation" of all of the documents being considered in
>> order, and if they are never removed, would always overwhelm the heap
>> with a large document set. =A0They are not the index in the usual sense,=
 I
>> think. =A0Before I start retrieving documents, there is barely anything =
in
>> these objects.
>>
>> What is holding the document contents in the heap after the fields
>> information is returned?
>>
>> Can you say more about incRef/decRef? =A0I deleted all variables that
>> interacted with Lucene and it seems to have made no difference
>>
>> There are not a lot of different fields, I would say on the order of 50
>> with about 20 of them in virtually every document.
>>
>> It uses:
>> lucene.IndexReader.open(self._store)
>>
>>
>> One suggestion I got is to put the reader code in the class init
>> function and then reuse it. =A0I have not tried that one yet (next on th=
e
>> agenda). =A0You suggested something similar and I will try that.
>>
>> Thanks,
>> Herb
>>
>>
>> Michael McCandless wrote:
>>>
>>> The large count of TermInfo & Term is completely normal -- this is
>>> Lucene's term index, which is entirely RAM resident.
>>>
>>> In 3.1, with flexible indexing, the RAM efficiency of the terms index
>>> should be much improved.
>>>
>>> While opening a new reader/searcher for every query is horribly
>>> inefficient, it should not leak memory. =A0(Are you using
>>> IndexReader.reopen? =A0I see calls to getReader, but this Lucene API
>>> (near-real-time search) wasn't added until 2.9, and you're on 2.4, so
>>> I think that's your own method?).
>>>
>>> What do your get/getReader/getSearcher calls do? =A0Are you using
>>> incRef/decRef at all to manage the lifetime of your readers? =A0How man=
y
>>> unique field names do you have, across all docs that you index?
>>>
>>> If you change your test to open a single reader, but run that
>>> TermQuery over and over and over again, do you still hit OOME?
>>>
>>> Mike
>>>
>>> On Sun, Apr 11, 2010 at 1:28 PM, Herbert L Roitblat <herb@orcatec.com>
>>> wrote:
>>>
>>>> Hi, Folks. =A0Thanks, Ruben, for your help. =A0It let me get a ways do=
wn the
>>>> road.
>>>>
>>>> The problem is the the heap is filling up when I am doing a
>>>> lucene.TermQuery. =A0What I am trying to accomplish is to get the term=
s in
>>>> one
>>>> field of each document and their frequency in the document. =A0A code
>>>> snippet
>>>> is attached below. It yields the results I want.
>>>>
>>>> I managed to get a small enough heap dump into jhat. =A0Now I could us=
e
>>>> some
>>>> help understanding what I have found and some help figuring out what t=
o
>>>> do
>>>> about it. =A0I am a noobi at understanding the details of Lucene,
>>>> pyLucene,
>>>> =A0and Java debugging.
>>>>
>>>> If I understand correctly, the heap is filling up because it is keepin=
g
>>>> instances of objects around after there is no longer any need for them=
.
>>>> I
>>>> thought that it might be the case that Python was somehow keeping them
>>>> around, but that does not seem to be the case (true?).
>>>>
>>>> From jhat, I got a class instance histogram:
>>>>
>>>> 290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990> =
of
>>>> class org.apache.lucene.index.TermInfo
>>>> <http://192.168.1.155:7000/class/0x7fbf693bb990>
>>>> 289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80> =
of
>>>> class org.apache.lucene.index.Term
>>>> <http://192.168.1.155:7000/class/0x7fbf69412d80>
>>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> of
>>>> class
>>>> org.apache.lucene.index.FieldInfo
>>>> <http://192.168.1.155:7000/class/0x7fbf693f1300>
>>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> of
>>>> class
>>>> org.apache.lucene.index.SegmentReader$Norm
>>>> <http://192.168.1.155:7000/class/0x7fbf6940a1a8>
>>>> 1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> of
>>>> class
>>>> org.apache.lucene.store.FSDirectory$FSIndexInput
>>>> <http://192.168.1.155:7000/class/0x7fbf6928d460>
>>>> 1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> of
>>>> class
>>>> org.apache.lucene.index.CompoundFileReader$CSIndexInput
>>>> <http://192.168.1.155:7000/class/0x7fbf693ef958>
>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of
>>>> class
>>>> org.apache.lucene.index.TermBuffer
>>>> <http://192.168.1.155:7000/class/0x7fbf69400510>
>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of
>>>> class
>>>> org.apache.lucene.util.UnicodeUtil$UTF16Result
>>>> <http://192.168.1.155:7000/class/0x7fbf694011c8>
>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of
>>>> class
>>>> org.apache.lucene.util.UnicodeUtil$UTF8Result
>>>> <http://192.168.1.155:7000/class/0x7fbf693bc168>
>>>> ...
>>>>
>>>> There are way too many instance of index.TermInfo and index.indexTerm.
>>>> So,
>>>> I tracked down some instances and looked for rootset references. =A0Th=
ere
>>>> were
>>>> none. =A0If I understand correctly, this instance should be garbage
>>>> collected
>>>> if there are no rootset references. =A0True?
>>>>
>>>> =A0 Here's an example from jhat:
>>>>
>>>> =A0Rootset references to org.apache.lucene.index.TermInfo@0x7fbf6e3f82=
18
>>>> (includes weak refs)
>>>>
>>>> =A0References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40
>>>> bytes)
>>>> =A0Other queries
>>>> =A0Exclude weak refs
>>>> ---
>>>> There is at least one reference to the object, it is an element in an
>>>> array,
>>>> but the array does not have rootset references either.
>>>>
>>>> Am I misinterpreting these results? =A0In any case, what can I do abou=
t
>>>> getting rid of these? =A0Is it a bug in this version of Lucene? =A0Is =
there
>>>> a
>>>> known fix? =A0I think that I should be able to do an unlimited number =
of
>>>> queries without filling up the heap.
>>>> I am using pyLucene version 2.4.
>>>>
>>>> Thanks for your help.
>>>>
>>>> Herb
>>>>
>>>> -------------------------------
>>>> Code snippet:
>>>> =A0 =A0 =A0reader =3D self.index.getReader()
>>>> =A0 =A0 =A0lReader =3D reader.get()
>>>> =A0 =A0 =A0searcher =3D self.index.getSearcher()
>>>> =A0 =A0 =A0lSearcher =3D searcher.get()
>>>> =A0 =A0 =A0query =3D lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD=
_ID, uid))
>>>> =A0 =A0 =A0hits =3D list(lSearcher.search(query))
>>>> =A0 =A0 =A0if hits:
>>>> =A0 =A0 =A0 =A0 =A0hit =3D lucene.Hit.cast_(hits[0])
>>>> =A0 =A0 =A0 =A0 =A0tfvs =3D lReader.getTermFreqVectors(hit.id)
>>>>
>>>> =A0 =A0 =A0 =A0 =A0if tfvs is not None: # this happens if the vector i=
s not stored
>>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0for tfv in tfvs: # There's one for each fie=
ld that has a
>>>> TermFreqVector
>>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0tfvP =3D lucene.TermFreqVector.cast=
_(tfv)
>>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if returnAllFields or tfvP.field in=
 termFields: # add
>>>> only
>>>> asked fields
>>>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0tFields[tfvP.field] =3D dic=
t([(t,f) for (t,f) in
>>>> zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=3DminFreq])
>>>> =A0 =A0 =A0else:
>>>> =A0 =A0 =A0 =A0 =A0# This shouldn't happen, but we just log the error =
and march on
>>>> =A0 =A0 =A0 =A0 =A0self.log.error("Unable to fetch doc %s from index"%=
(uid))
>>>> ## =A0 =A0 =A0 =A0if self.opCount % 1000 =3D=3D 0:
>>>> ## =A0 =A0 =A0 =A0 =A0 =A0print lucene.JCCEnv._dumpRefs(classes=3DTrue=
).items()
>>>>
>>>> #http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/00=
2171.html
>>>> ## =A0 =A0 =A0 =A0self.opCount +=3D 1
>>>>
>>>> =A0 =A0 =A0lReader.close()
>>>> =A0 =A0 =A0lSearcher.close()
>>>> =A0 =A0 =A0retFields =3D copy.deepcopy(tFields) #return a copy of tFie=
lds to
>>>> free
>>>> up references to it and its contents
>>>>
>>>>
>>>>
>>>> Herbert Roitblat wrote:
>>>>
>>>>> Hi, folks.
>>>>> I am using PyLucene and doing a lot of get tokens. =A0lucene.py repor=
ts
>>>>> version 2.4.0. =A0It is rpath linux with 8GB of memory. =A0Python is =
2.4.
>>>>> I'm not sure what the maxheap is, I think that it is maxheap=3D'2048m=
'. I
>>>>> think that it's running in a 64 bit environment.
>>>>> It indexes a set of 116,000 documents just fine.
>>>>> Then I need to get the tokens from these documents and near the end, =
I
>>>>> run
>>>>> into:
>>>>>
>>>>> java.lang.OutOfMemoryError: GC overhead limit exceeded
>>>>>
>>>>> If I wait a bit and ask again for the same document's tokens, I can g=
et
>>>>> them, but it then is somewhat likely to post the same error on a
>>>>> certain
>>>>> number of other documents. =A0I can handle these errors and ask again=
.
>>>>>
>>>>> I have read that this error message means that the heap is getting
>>>>> filled
>>>>> up and garbage collection removes only a small amount of it. =A0Since=
 all
>>>>> I am
>>>>> doing is retrieving, why should the heap be filling up? =A0I restarte=
d
>>>>> the
>>>>> system before starting the retrieval.
>>>>>
>>>>> My guess is that there is some small memory leak because memory
>>>>> assigned
>>>>> to my python program grows slowly as I request more document tokens.
>>>>> Since
>>>>> I'm not intending to change anything in either my python program or i=
n
>>>>> Lucene, any growth is unintentional. =A0I'm just getting tokens.
>>>>>
>>>>> =A0we use lucene.TermQuery as the query object to get the terms.
>>>>>
>>>>> I cannot share the documents nor the application code, but I might be
>>>>> able
>>>>> to provide snippets.
>>>>>
>>>>> One last piece of information, the time needed to retrieve documents
>>>>> slows
>>>>> throughout the process. =A0In the beginning I was getting about 10
>>>>> documents
>>>>> per second. =A0Towards the end, it is down to about 5 with about 5 se=
cond
>>>>> pauses from time to time, perhaps due to garbage collection?
>>>>>
>>>>> Any idea of why the heap is filling up and what I can do about it?
>>>>>
>>>>> Thanks,
>>>>> Herb
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45777-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 14:17:10 2010
Return-Path: <java-user-return-45777-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49847 invoked from network); 13 Apr 2010 14:17:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 14:17:10 -0000
Received: (qmail 17967 invoked by uid 500); 13 Apr 2010 14:17:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17861 invoked by uid 500); 13 Apr 2010 14:17:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17853 invoked by uid 99); 13 Apr 2010 14:17:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 14:17:07 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of gsiasf@gmail.com designates 74.125.92.24 as permitted sender)
Received: from [74.125.92.24] (HELO qw-out-2122.google.com) (74.125.92.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 14:17:00 +0000
Received: by qw-out-2122.google.com with SMTP id 8so2137652qwh.53
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 07:16:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:content-type
         :mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        bh=NseGPwvmcxYAD0Br8/CA93kkqok/D9StDS48+FrlKFU=;
        b=Z8UZjIuzTeTrIP+g+vX9uGLVgYqVDLwDixAjFdZjtIg6+yyydsx0gfNJbTc8QTxGXh
         Q5B4B48LBofIqdHrGT5ecOojfEwhmnHHSUE72SgrXaf78GBGxjlFiqt47wruaK6VSEkr
         ojGNOHJI0h1gI9Cf2K2TCfk9KjDgsD2k2EsNA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=rOOvxUZdkoFL4jcERu3uXEkBh1O4afwfsNmPDu+RMUeasldWNScED5SGxpOIcqg68/
         pjMvopzcoUTo44MyOSR4UWfdHYEGjjE3/GEH82drk7nBjkrS55Vaumr6R8hPxqSxapNd
         rNfnG4y+ZDbxROvHnEPve/0nTefimctEPrhwk=
Received: by 10.229.218.204 with SMTP id hr12mr2344507qcb.101.1271168196707;
        Tue, 13 Apr 2010 07:16:36 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id v26sm7603772qce.7.2010.04.13.07.16.35
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 13 Apr 2010 07:16:35 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1078)
Subject: Re: Exception, field is not stored
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <l2i8e1c86ab1004121031v77c743cex3b49dd95db8640cf@mail.gmail.com>
Date: Tue, 13 Apr 2010 10:16:34 -0400
Content-Transfer-Encoding: quoted-printable
Message-Id: <859A4C22-A888-4485-8DA4-66AA94F2914E@apache.org>
References: <l2i8e1c86ab1004121031v77c743cex3b49dd95db8640cf@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1078)


On Apr 12, 2010, at 1:31 PM, Ramon De Paula Marques wrote:

> Hi guys,
>=20
> I'm trying to use highlighter to a better search on my website, but =
when the
> search get documents html and pdf that were indexed with a reader =
causes an
> exception that tells the field is not stored.
>=20
> I don't know where to attack now, i must try to index documents =
storing
> fields? How to do it, for html it is storing automatically
> i can't set new Field(..., Field.Store.Yes) it is like this:
>    FileInputStream fis =3D new FileInputStream(f);
>    HTMLParser parser =3D new HTMLParser(fis);
>    doc.add(new Field("contents", parser.getReader()));
>=20
> and for pdf, it is indexing like this:
> InputStream fis =3D new FileInputStream(inputFile);
>        Document luceneDocument =3D LucenePDFDocument.getDocument(
> fis);
>        writer.addDocument(luceneDocument);
>=20
>=20


You need to use the Field constructor that takes in a String and not a =
Reader in order to use storage.

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem using Solr/Lucene: =
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45778-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 14:34:17 2010
Return-Path: <java-user-return-45778-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54297 invoked from network); 13 Apr 2010 14:34:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 14:34:17 -0000
Received: (qmail 45732 invoked by uid 500); 13 Apr 2010 14:34:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45685 invoked by uid 500); 13 Apr 2010 14:34:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45677 invoked by uid 99); 13 Apr 2010 14:34:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 14:34:15 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED
X-Spam-Check-By: apache.org
Received-SPF: unknown (nike.apache.org: error in processing during lookup of siraj@jobdiva.com)
Received: from [64.18.2.6] (HELO exprod7og117.obsmtp.com) (64.18.2.6)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 13 Apr 2010 14:34:06 +0000
Received: from source ([64.147.106.2]) (using TLSv1) by exprod7ob117.postini.com ([64.18.6.12]) with SMTP
	ID DSNKS8SAxmwrYUMyuGlNEeZbS5OT4TtDLmN1@postini.com; Tue, 13 Apr 2010 07:33:45 PDT
Received: from [10.10.1.80] (12.111.23.142) by mail.jobdiva.com (10.10.30.148)
 with Microsoft SMTP Server (TLS) id 8.1.393.1; Tue, 13 Apr 2010 10:35:48
 -0400
Message-ID: <4BC480C4.9090801@jobdiva.com>
Date: Tue, 13 Apr 2010 10:33:40 -0400
From: Siraj Haider <siraj@jobdiva.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.8) Gecko/20100227 Thunderbird/3.0.3
MIME-Version: 1.0
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Subject: Re: WhitespaceAnalyzer and version
References: <4BC38D03.9020202@jobdiva.com> <012101cadad1$ce9d0f20$6bd72d60$@de>
In-Reply-To: <012101cadad1$ce9d0f20$6bd72d60$@de>
Content-Type: multipart/alternative;
	boundary="------------090309000404060005010205"
X-Virus-Checked: Checked by ClamAV on apache.org

--------------090309000404060005010205
Content-Type: text/plain; charset="UTF-8"; format=flowed
Content-Transfer-Encoding: 7bit

Hi Uwe,

On 4/13/2010 2:23 AM, Uwe Schindler wrote:
> As of Lucene 3.0, WhitespaceAnalyzer has not yet a Version ctor. It will come in 3.1, when Lucene is changed to be Unicode 4.0 conform (3.0 and before is Unicode 3.0, which is Java 1.4).
>
> QueryParser need the Version ctor for the handling of stop words. As WhiteSpace Analyzer does not use StopFilter, there was no need for a version ctor. QueryParser will pass the version not to the analyzer, it will use it solely for its own behavior. But you should use the same version for QP and your Analyzer. If one of the components has no Version, there is no incompatible change (in fact, Whitespace Analyzer was not changed). Please also read the document about moving from Java 1.4 to Java 5/6 in the Lucene ZIP file (if you already used Java 5/6 with older Lucene versions before, all is fine - reindexing may only required if you move your JVM installation from 1.4 ->  5/6; independent from Lucene's version).
>
>    
We are using java 1.6, so that part is covered.
>> Another thing is, do we need to re-index if we want to supply
>> Version.LUCENE_CURRENT as the version? what are other implications?
>>      
> Yes! And please, please: Don't use Version.LUCENE_CURRENT (which is already deprecated as of Lucene 2.9.2 and 3.0.1 as a warning). Use a specific version, so you will never need to reindex until you change the version.
>
> To have backwards compatibility with existing indexes from pre-2.9 without reindexing use LUCENE_24.
>    
We are using Lucene 2.9.2 now but planning to move to version 3 in near 
future.  I am a little confused about this version stuff and how you 
have to re-index if you want to use a newer version.  In past, all you 
had to do, is to add one document to index using new version and the 
index used to get converted to that format automatically, is it not the 
case now? If that is not the case, then this might be very difficult for 
us to handle because we have over 500+ indexes and re-indexing all of 
them is a huge task for us.

One more question, we use LUCENE_29 for now and in near future want to 
move to LUCENE_30.  Will the queryparsers/analyzers opened with 
LUCENE_30 be able to read indexes created by using LUCENE_29?
> Uwe
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
>    
>> -----Original Message-----
>> From: Siraj Haider [mailto:siraj@jobdiva.com]
>> Sent: Monday, April 12, 2010 11:14 PM
>> To: java-user@lucene.apache.org
>> Subject: WhitespaceAnalyzer and version
>>
>> We are in the process of removing the deprecated api from our code to
>> move to version.  One of the deprecation is, the queryparser now
>> expects
>> a version parameter in the constructor.  I also have read somewhere
>> that
>> we should pass the same version to analyzer when indexing as wel as
>> when
>> searching.  We use WhitespaceAnalyzer and I am unable to find a
>> constructor with a version in it.
>>
>> Another thing is, do we need to re-index if we want to supply
>> Version.LUCENE_CURRENT as the version? what are other implications?
>>
>> thanks
>> -siraj
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>      
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    


--------------090309000404060005010205--

From java-user-return-45779-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 14:39:43 2010
Return-Path: <java-user-return-45779-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55483 invoked from network); 13 Apr 2010 14:39:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 14:39:43 -0000
Received: (qmail 55561 invoked by uid 500); 13 Apr 2010 14:39:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55521 invoked by uid 500); 13 Apr 2010 14:39:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55513 invoked by uid 99); 13 Apr 2010 14:39:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 14:39:41 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED
X-Spam-Check-By: apache.org
Received-SPF: unknown (nike.apache.org: error in processing during lookup of siraj@jobdiva.com)
Received: from [64.18.2.26] (HELO exprod7og124.obsmtp.com) (64.18.2.26)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 13 Apr 2010 14:39:32 +0000
Received: from source ([64.147.106.2]) (using TLSv1) by exprod7ob124.postini.com ([64.18.6.12]) with SMTP
	ID DSNKS8SCDl2x5vCRW9SvZxnBO6+P1E7Huuto@postini.com; Tue, 13 Apr 2010 07:39:12 PDT
Received: from [10.10.1.80] (12.111.23.142) by mail.jobdiva.com (10.10.30.148)
 with Microsoft SMTP Server (TLS) id 8.1.393.1; Tue, 13 Apr 2010 10:40:37
 -0400
Message-ID: <4BC481E5.80800@jobdiva.com>
Date: Tue, 13 Apr 2010 10:38:29 -0400
From: Siraj Haider <siraj@jobdiva.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.8) Gecko/20100227 Thunderbird/3.0.3
MIME-Version: 1.0
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
CC: Shai Erera <serera@gmail.com>
Subject: Re: WhitespaceAnalyzer and version
References: <4BC38D03.9020202@jobdiva.com> <t2v786fde51004122241s77a61e28s9772243f2214b146@mail.gmail.com>
In-Reply-To: <t2v786fde51004122241s77a61e28s9772243f2214b146@mail.gmail.com>
Content-Type: multipart/alternative;
	boundary="------------060206080104070907000206"
X-Virus-Checked: Checked by ClamAV on apache.org

--------------060206080104070907000206
Content-Type: text/plain; charset="ISO-8859-1"; format=flowed
Content-Transfer-Encoding: 7bit

Hi Shai,

On 4/13/2010 1:41 AM, Shai Erera wrote:
> Hi
>
> WhitespaceAnalyzer definitely has a Version dependent ctor. What
> Lucene version do you use?
>
> You van use LUCENE_CURRENT but be aware that of a certain Analyzer's
> behavior has changed in a way that affects your app, you'll need to
> reindex your data. Usually an Analyzer (or any other Version-aware
> object) documents the differences between the versions. Some classes
> take Version as a placeholder for future changes, while not doing
> anything special w/ them st the moment.
>
> It is best, I think, if you stick w/ a specific version (like
> LUCENE_30) and change that before you plan to reindex your data.
> Otherwise, if you always reindex your stuff when upgrading Lucene,
> then LUCENE_CURRENT is probably good.
>
> Note also that some changes between versions may result on you
> updating your users (manual) about what to expext from searches.
>    
Thanks for your comments.  Can you please explain more about why the 
user might get something from searches that they are not expecting?
> Hope this helps,
> Shai
>
> On Tuesday, April 13, 2010, Siraj Haider<siraj@jobdiva.com>  wrote:
>    
>> We are in the process of removing the deprecated api from our code to move to version.  One of the deprecation is, the queryparser now expects a version parameter in the constructor.  I also have read somewhere that we should pass the same version to analyzer when indexing as wel as when searching.  We use WhitespaceAnalyzer and I am unable to find a constructor with a version in it.
>>
>> Another thing is, do we need to re-index if we want to supply Version.LUCENE_CURRENT as the version? what are other implications?
>>
>> thanks
>> -siraj
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>      
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    


--------------060206080104070907000206--

From java-user-return-45780-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 15:56:14 2010
Return-Path: <java-user-return-45780-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77359 invoked from network); 13 Apr 2010 15:56:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 15:56:14 -0000
Received: (qmail 95712 invoked by uid 500); 13 Apr 2010 15:56:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95683 invoked by uid 500); 13 Apr 2010 15:56:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95675 invoked by uid 99); 13 Apr 2010 15:56:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 15:56:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [141.211.3.201] (HELO itcs-ehub-01.adsroot.itcs.umich.edu) (141.211.3.201)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 15:56:02 +0000
Received: from ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu ([141.211.3.233]) by
 itcs-ehub-01.adsroot.itcs.umich.edu ([141.211.3.201]) with mapi; Tue, 13 Apr
 2010 11:55:41 -0400
From: "Burton-West, Tom" <tburtonw@umich.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 13 Apr 2010 11:55:42 -0400
Subject: RE: Understanding lucene indexes and disk I/O
Thread-Topic: Understanding lucene indexes and disk I/O
Thread-Index: Acra64OtYg8USf+7QHOeDyx6PCiY1QAMiXOg
Message-ID: <A902805D9E8F66428EACF947DDA9840C057C4208B1@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <A902805D9E8F66428EACF947DDA9840C057C4207DE@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
 <x2q9ac0c6aa1004130226sa48b787cg17b0236d09b98223@mail.gmail.com>
In-Reply-To: <x2q9ac0c6aa1004130226sa48b787cg17b0236d09b98223@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks Mike,

At some point maybe the File Formats Document could be updated to make it c=
lear that the tii has an entry similar to the IntexInterval'th tis entry bu=
t instead of holding frq/prx deltas it holds absolute pointers.  Is it wort=
h entering a JIRA issue?  I would be happy to update the doc myself, but I'=
m don't think  I have enough of an in depth understanding.

As you probably have guessed, I'm trying to understand the impact of the ov=
er 2.4 billion unique terms in our indexes on performance (https://issues.a=
pache.org/jira/browse/LUCENE-2257).  We suspect that a very large percentag=
e of these terms are due to dirty OCR, but have not yet found a good way to=
 eliminate a significant amount of dirty OCR.  =20

I assume that these cause a few extra steps in the binary search of the tii=
 file in memory but we probably won't notice that performance impact since =
our bottleneck is disk I/O for reading long postings lists for frequently o=
ccurring terms.

Am I correct in assuming that even if we have a very large number of garbag=
e terms in our prx file, the overall size of the file does not significantl=
y affect the number of disk seeks or amount of data to be read since Lucene=
 can seek to the beginning of the postings for any particular term?

>> I would love to get ahold of your terms dict :)  I'd have a field day
>>testing Lucene against it... I'm very curious how the flex improvements a=
ffect your usage.

Sometime in the next month or so we will get our new test server and after =
I get the backup of testing jobs under control, I'd love to do some testing=
 with flex and our data. =20

Tom

-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]=20
Sent: Tuesday, April 13, 2010 5:27 AM
To: java-user@lucene.apache.org
Subject: Re: Understanding lucene indexes and disk I/O

Hi Tom,

Fear not: we only scan up to 128 terms, to find the specific term.

First, the terms dict index (tii) is fully loaded into RAM, and then a
binary search is done on this (in-RAM) to find the nearest index term
just before the term you want.  Then, we seek to that spot in the
main terms dict (tis) file, and scan (at most 128 entries) to find the
term.

On the frq/prx deltas: the tii holds absolute pointers.  So, on
seeking to that first spot in the tis, we know the absolute frq/prx
(long) offsets, and then during scanning we just add the deltas we
see to those base absolutes.



Mike


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45781-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 16:53:15 2010
Return-Path: <java-user-return-45781-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2061 invoked from network); 13 Apr 2010 16:32:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 16:32:41 -0000
Received: (qmail 60515 invoked by uid 500); 13 Apr 2010 16:32:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60465 invoked by uid 500); 13 Apr 2010 16:32:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60451 invoked by uid 99); 13 Apr 2010 16:32:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 16:32:39 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 16:32:33 +0000
Received: by gyf1 with SMTP id 1so3444633gyf.35
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 09:32:12 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Tue, 13 Apr 2010 09:32:11 -0700 (PDT)
In-Reply-To: <A902805D9E8F66428EACF947DDA9840C057C4208B1@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <A902805D9E8F66428EACF947DDA9840C057C4207DE@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
	 <x2q9ac0c6aa1004130226sa48b787cg17b0236d09b98223@mail.gmail.com>
	 <A902805D9E8F66428EACF947DDA9840C057C4208B1@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Date: Tue, 13 Apr 2010 12:32:11 -0400
Received: by 10.150.244.4 with SMTP id r4mr5493733ybh.214.1271176331535; Tue, 
	13 Apr 2010 09:32:11 -0700 (PDT)
Message-ID: <y2k9ac0c6aa1004130932gf8b91554r44ee78241298d3be@mail.gmail.com>
Subject: Re: Understanding lucene indexes and disk I/O
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Tue, Apr 13, 2010 at 11:55 AM, Burton-West, Tom <tburtonw@umich.edu> wro=
te:

> At some point maybe the File Formats Document could be updated to make it=
 clear that the tii has an entry similar to the IntexInterval'th tis entry =
but instead of holding frq/prx deltas it holds absolute pointers.  Is it wo=
rth entering a JIRA issue?  I would be happy to update the doc myself, but =
I'm don't think  I have enough of an in depth understanding.

Well I need to redo this part of file format docs, due to the flex
changes (LUCENE-2371)... I'll add a comment to remember to
state that this means we scan at most 128 terms.

> As you probably have guessed, I'm trying to understand the impact of the =
over 2.4 billion unique terms in our indexes on performance (https://issues=
.apache.org/jira/browse/LUCENE-2257).  We suspect that a very large percent=
age of these terms are due to dirty OCR, but have not yet found a good way =
to eliminate a significant amount of dirty OCR.

Fun problem ;)

> I assume that these cause a few extra steps in the binary search of the t=
ii file in memory but we probably won't notice that performance impact sinc=
e our bottleneck is disk I/O for reading long postings lists for frequently=
 occurring terms.

Yeah, and added RAM usage holding the tii in memory.

In theory, one could make a flex codec that instead of indexing every
Nth (128 by default) term, indexes in a non-regular manner, eg at any
term > X in frequency (though nobody has built such a codec!).  In
theory this'd be good for cases like yours... because you don't need
every 128 when many of them are very low count.  Ie the added time to
scan to a rare term is usually a non-issue since iterating that rare
term's docs will be so fast.  But added cost when scanning to a common
term "hurts" because it'll take so long to walk that common term's
docs.

> Am I correct in assuming that even if we have a very large number of garb=
age terms in our prx file, the overall size of the file does not significan=
tly affect the number of disk seeks or amount of data to be read since Luce=
ne can seek to the beginning of the postings for any particular term?

Right, frq and prx.

>>> I would love to get ahold of your terms dict :)  I'd have a field day
>>>testing Lucene against it... I'm very curious how the flex improvements =
affect your usage.
>
> Sometime in the next month or so we will get our new test server and afte=
r I get the backup of testing jobs under control, I'd love to do some testi=
ng with flex and our data.

I'd love to see the results of this :) EG basic stats like
before/after size of the tis/tii files, RAM used on opening the
reader, startup up time, search performance...

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45782-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 19:42:57 2010
Return-Path: <java-user-return-45782-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64407 invoked from network); 13 Apr 2010 19:29:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 19:29:41 -0000
Received: (qmail 57927 invoked by uid 500); 13 Apr 2010 19:29:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57886 invoked by uid 500); 13 Apr 2010 19:29:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57878 invoked by uid 99); 13 Apr 2010 19:29:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 19:29:39 +0000
X-ASF-Spam-Status: No, hits=0.3 required=10.0
	tests=AWL,MIME_BASE64_BLANKS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 13 Apr 2010 19:29:34 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id A5A771E685E; Tue, 13 Apr 2010 12:29:13 -0700 (MST)
Received: from PHX-HTPRD-01.adprod.bmc.com (phx-htprd-01.adprod.bmc.com [172.24.32.7])
	by flicker.bmc.com (Postfix) with ESMTP id 9E9311E682B
	for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 12:29:13 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-01.adprod.bmc.com ([172.24.32.7]) with mapi; Tue, 13 Apr 2010
 13:29:13 -0600
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 13 Apr 2010 13:29:07 -0600
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrawKViZg0lVA9pTuOcXsESjGcqRgAfjQ9w
Message-ID: <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
In-Reply-To: <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0

QXJlIHRoZXNlIGZpeGVzIGluIDIuOXggYnJhbmNoPyAgV2UgYXJlIHVzaW5nIDIuOXggYW5kIGNh
bid0IG1vdmUgdG8gM3gganVzdCB5ZXQuICBJZiBzbywgd2hlcmUgZG8gSSBzcGVjaWZpY2FsbHkg
cGljayB0aGlzIHVwIGZyb20/DQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQpGcm9tOiBM
YW5jZSBOb3Jza29nIFttYWlsdG86Z29rc3JvbkBnbWFpbC5jb21dIA0KU2VudDogTW9uZGF5LCBB
cHJpbCAxMiwgMjAxMCAxMDoyMCBQTQ0KVG86IGphdmEtdXNlckBsdWNlbmUuYXBhY2hlLm9yZw0K
U3ViamVjdDogUmU6IEluZGV4V3JpdGVyIGFuZCBtZW1vcnkgdXNhZ2UNCg0KVGhlcmUgaXMgc29t
ZSBidWdzIHdoZXJlIHRoZSB3cml0ZXIgZGF0YSBzdHJ1Y3R1cmVzIHJldGFpbiBkYXRhIGFmdGVy
DQppdCBpcyBmbHVzaGVkLiBUaGV5IGFyZSBjb21taXR0ZWQgYXMgb2YgbWF5YmUgdGhlIHBhc3Qg
d2Vlay4gSWYgeW91DQpjYW4gcHVsbCB0aGUgdHJ1bmsgYW5kIHRyeSBpdCB3aXRoIHlvdXIgdXNl
IGNhc2UsIHRoYXQgd291bGQgYmUgZ3JlYXQuDQoNCk9uIE1vbiwgQXByIDEyLCAyMDEwIGF0IDg6
NTQgQU0sIFdvb2xmLCBSb3NzIDxSb3NzX1dvb2xmQGJtYy5jb20+IHdyb3RlOg0KPiBJIHdhcyBv
biB2YWNhdGlvbiBsYXN0IHdlZWsgc28ganVzdCBnZXR0aW5nIGJhY2sgdG8gdGhpcy4uLiDCoEhl
cmUgaXMgdGhlIGluZm8gc3RyZWFtIChhcyBhbiBhdHRhY2htZW50KS4gwqBJJ2xsIHNlZSB3aGF0
IEkgY2FuIGRvIGFib3V0IHJlZHVjaW5nIHRoZSBoZWFwIGR1bXAgKEl0IHdhcyBzdXBwbGllZCBi
eSBhIGNvbGxlYWd1ZSkuDQo+DQo+DQo+IC0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQo+IEZy
b206IE1pY2hhZWwgTWNDYW5kbGVzcyBbbWFpbHRvOmx1Y2VuZUBtaWtlbWNjYW5kbGVzcy5jb21d
DQo+IFNlbnQ6IFNhdHVyZGF5LCBBcHJpbCAwMywgMjAxMCAzOjM5IEFNDQo+IFRvOiBqYXZhLXVz
ZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4gU3ViamVjdDogUmU6IEluZGV4V3JpdGVyIGFuZCBtZW1v
cnkgdXNhZ2UNCj4NCj4gSG1tIHdoeSBpcyB0aGUgaGVhcCBkdW1wIHNvIGltbWVuc2U/IMKgTm9y
bWFsbHkgaXQgY29udGFpbnMgdGhlIHRvcCBODQo+IChlZyAxMDApIG9iamVjdCB0eXBlcyBhbmQg
dGhlaXIgY291bnQvYWdncmVnYXRlIFJBTSB1c2FnZS4NCj4NCj4gQ2FuIHlvdSBhdHRhY2ggdGhl
IGluZm9TdHJlYW0gb3V0cHV0IHRvIGFuIGVtYWlsICh0byBqYXZhLXVzZXIpPw0KPg0KPiBNaWtl
DQo+DQo+IE9uIEZyaSwgQXByIDIsIDIwMTAgYXQgNToyOCBQTSwgV29vbGYsIFJvc3MgPFJvc3Nf
V29vbGZAYm1jLmNvbT4gd3JvdGU6DQo+PiBJIGhhdmUgdGhpcyBhbmQgdGhlIGhlYXAgZHVtcCBp
cyA2M21iIHppcHBlZC4gwqBUaGUgaW5mbyBzdHJlYW0gaXMgbXVjaCBzbWFsbGVyICgzMSBrYiB6
aXBwZWQpLCBidXQgSSBkb24ndCBrbm93IGhvdyB0byBnZXQgdGhlbSB0byB5b3UuDQo+Pg0KPj4g
V2UgYXJlIG5vdCB1c2luZyB0aGUgTlJUIHJlYWRlcnMNCj4+DQo+PiAtLS0tLU9yaWdpbmFsIE1l
c3NhZ2UtLS0tLQ0KPj4gRnJvbTogTWljaGFlbCBNY0NhbmRsZXNzIFttYWlsdG86bHVjZW5lQG1p
a2VtY2NhbmRsZXNzLmNvbV0NCj4+IFNlbnQ6IFRodXJzZGF5LCBBcHJpbCAwMSwgMjAxMCA1OjIx
IFBNDQo+PiBUbzogamF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3JnDQo+PiBTdWJqZWN0OiBSZTog
SW5kZXhXcml0ZXIgYW5kIG1lbW9yeSB1c2FnZQ0KPj4NCj4+IEhtbSwgbm90IGdvb2QuIMKgQ2Fu
IHlvdSBwb3N0IGEgaGVhcCBkdW1wPyDCoEFsc28sIGNhbiB5b3UgdHVybiBvbg0KPj4gaW5mb1N0
cmVhbSwgaW5kZXggdXAgdG8gdGhlIE9PTSBAIDUxMiBNQiwgYW5kIHBvc3QgdGhlIG91dHB1dD8N
Cj4+DQo+PiBJbmRleFdyaXRlciBzaG91bGQgbm90IGhhbmcgb250byBtdWNoIGJleW9uZCB0aGUg
UkFNIGJ1ZmZlci4gwqBCdXQsIGl0DQo+PiBkb2VzIGFsbG9jYXRlIGFuZCB0aGVuIHJlY3ljbGUg
dGhpcyBSQU0gYnVmZmVyLCBzbyBldmVuIGluIGFuIGlkbGUNCj4+IHN0YXRlIChoYXZpbmcgaW5k
ZXhlZCBlbm91Z2ggZG9jcyB0byBmaWxsIHVwIHRoZSBSQU0gYnVmZmVyIGF0IGxlYXN0DQo+PiBv
bmNlKSBpdCdsbCBob2xkIG9udG8gdGhvc2UgMTYgTUIuDQo+Pg0KPj4gQXJlIHlvdSB1c2luZyBn
ZXRSZWFkZXIgKHRvIGdldCB5b3VyIE5SVCByZWFkZXJzKT8gwqBJZiBzbywgYXJlIHlvdQ0KPj4g
cmVhbGx5IHN1cmUgeW91J3JlIGV2ZW50dWFsbHkgY2xvc2luZyB0aGUgcHJldmlvdXMgcmVhZGVy
IGFmdGVyDQo+PiBvcGVuaW5nIGEgbmV3IG9uZT8NCj4+DQo+PiBNaWtlDQo+Pg0KPj4gT24gVGh1
LCBBcHIgMSwgMjAxMCBhdCA2OjU4IFBNLCBXb29sZiwgUm9zcyA8Um9zc19Xb29sZkBibWMuY29t
PiB3cm90ZToNCj4+PiBXZSBhcmUgc2VlaW5nIGEgc2l0dWF0aW9uIHdoZXJlIHRoZSBJbmRleFdy
aXRlciBpcyB1c2luZyB1cCB0aGUgSmF2YSBIZWFwIHNwYWNlIGFuZCBvbmx5IHJlbGVhc2VzIG1l
bW9yeSBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uIHVwb24gYSBjb21taXQuIMKgIFdlIGFyZSB1c2lu
ZyB0aGUgZGVmYXVsdCBSQU1CdWZmZXJTaXplIG9mIDE2IG1iLiDCoFdlIGFyZSB1c2luZyBMdWNl
bmUgMi45LjEuIFdlIGFyZSBzZXQgYXQgaGVhcCBzaXplIG9mIDUxMiBtYi4NCj4+Pg0KPj4+IFdl
IGhhdmUgYSBsYXJnZSBudW1iZXIgb2YgZG9jdW1lbnRzIHRoYXQgYXJlIHJ1biB0aHJvdWdoIFRp
a2EgYW5kIHRoZW4gYWRkZWQgdG8gdGhlIGluZGV4LiDCoFRoZSBkYXRhIGZyb20gVGlrYSBpcyBj
aGFuZ2VkIHRvIGEgc3RyaW5nLCBhbmQgdGhlbiBzZW50IHRvIEx1Y2VuZS4gwqBIZWFwIGR1bXBz
IGNsZWFybHkgc2hvdyB0aGUgZGF0YSBpbiB0aGUgTHVjZW5lIGNsYXNzZXMgYW5kIG5vdCBpbiBU
aWthLiDCoE91ciBpbnRlbnQgaXMgdG8gb25seSBwZXJmb3JtIGEgY29tbWl0IG9uY2UgdGhlIGVu
dGlyZSBpbmRleGluZyBydW4gaXMgY29tcGxldGUsIGJ1dCBzZXZlcmFsIGhvdXJzIGludG8gdGhl
IHByb2Nlc3MgZXZlcnl0aGluZyBjb21lcyB0byBhIGNyYXdsLiDCoEluIHVzaW5nIGJvdGggSkNv
bnNvbGUgYW5kIFZpc3VhbFZNIMKgd2UgY2FuIHNlZSB0aGF0IHRoZSBoZWFwIHNwYWNlIGlzIG1h
eGVkIG91dCBhbmQgZ2FyYmFnZSBjb2xsZWN0aW9uIGlzIG5vdCBhYmxlIHRvIGNsZWFuIHVwIGFu
eSBtZW1vcnkgb25jZSB3ZSBnZXQgaW50byB0aGlzIHN0YXRlLiDCoEl0IGlzIG91ciB1bmRlcnN0
YW5kaW5nIHRoYXQgdGhlIEluZGV4V3JpdGVyIHNob3VsZCBiZSBvbmx5IGhvbGRpbmcgb250byAx
NiBtYiBvZiBkYXRhIGJlZm9yZSBpdCBmbHVzaGVzIGl0LCBidXQgd2hhdCB3ZSBhcmUgc2VlaW5n
IGlzIHRoYXQgd2hpbGUgaXQgaXMgaW4gZmFjdCB3cml0aW5nIGRhdGEgdG8gZGlzayB3aGVuIGl0
IGhpdHMgdGhlIDE2IG1iIGxpbWl0LCBpdCBpcyBhbHNvIGhvbGRpbmcgb250byBzb21lIGRhdGEg
aW4gbWVtb3J5IGFuZCBub3QgYWxsb3dpbmcgZ2FyYmFnZSBjb2xsZWN0aW9uIHRvIHRha2UgcGxh
Y2UsIGFuZCB0aGlzIGNvbnRpbnVlcyB1bnRpbCBnYXJiYWdlIGNvbGxlY3Rpb24gaXMgdW5hYmxl
IHRvIGZyZWUgdXAgZW5vdWdoIHNwYWNlIHRvIGFsbCB0aGluZ3MgdG8gbW92ZSBmYXN0ZXIgdGhh
biBhIGNyYXdsLg0KPj4+DQo+Pj4gQXMgYSB0ZXN0IHdlIGNhdXNlZCBhIGNvbW1pdCB0byBvY2N1
ciBhZnRlciBlYWNoIGRvY3VtZW50IGlzIGluZGV4ZWQgYW5kIHdlIHNlZSB0aGUgdG90YWwgYW1v
dW50IG9mIG1lbW9yeSByZWR1Y2VkIGZyb20gbmVhcmx5IDEwMCUgb2YgdGhlIEphdmEgSGVhcCB0
byBhcm91bmQgNzAtNzUlLiDCoFRoZSBwcm9maWxpbmcgdG9vbHMgbm93IHNob3cgdGhhdCB0aGUg
bWVtb3J5IGlzIGNsZWFuZWQgdXAgdG8gc29tZSBleHRlbnQgYWZ0ZXIgZWFjaCBkb2N1bWVudC4g
wqBCdXQgb2YgY291cnNlIHRoaXMgY29tcGxldGVseSBkZWZlYXRzIHRoZSB3aG9sZSByZWFzb24g
d2h5IHdlIHdhbnQgdG8gb25seSBjb21taXQgYXQgdGhlIGVuZCBvZiB0aGUgcnVuIGZvciBwZXJm
b3JtYW5jZSBzYWtlLiDCoE1vc3Qgb2YgdGhlIGRhdGEsIGFzIHNlZW4gdXNpbmcgSGVhcCBhbmFs
YXNpcywgaXMgaGVsZCBpbiBCeXRlLCBDaGFyYWN0ZXIsIGFuZCBJbnRlZ2VyIGNsYXNzZXMgd2hv
cyBHQyByb290cyBhcmUgdGllZCBiYWNrIHRvIHRoZSBXcml0ZXIgT2JqZWN0cyBhbmQgdGhyZWFk
cy4gwqBUaGUgaW5zdGFuY2UgY291bnRzLCBhZnRlciBydW5uaW5nIGp1c3QgMSwxMDAgZG9jdW1l
bnRzIHNlZW1zIHN0YWdnZXJpbmcNCj4+Pg0KPj4+IElzIHRoZXJlIGFkZGl0aW9uYWwgZGF0YSB0
aGF0IHRoZSBJbmRleFdyaXRlciBoYW5ncyBvbnRvIHJlZ2FyZGxlc3Mgb2Ygd2hlbiBpdCBoaXRz
IHRoZSBSQU1CdWZmZXJTaXplIGxpbWl0PyDCoFdoeSBhcmUgd2Ugc2VlaW5nIHRoZSBoZWFwIHNw
YWNlIGFsbCBiZWluZyB1c2VkIHVwPw0KPj4+DQo+Pj4gQSBzaWRlIHF1ZXN0aW9uIHRvIHRoaXMg
aXMgdGhlIGZhY3QgdGhhdCB3ZSBhbHdheXMgc2VlIGEgbGFyZ2UgYW1vdW50IG9mIG1lbW9yeSB1
c2VkIGJ5IHRoZSBJbmRleFdyaXRlciBldmVuIGFmdGVyIG91ciBpbmRleGluZyBoYXMgYmVlbiBj
b21wbGV0ZWQgYW5kIGFsbCBjb21taXRzIGhhdmUgdGFrZW4gcGxhY2UgKGJhc2ljYWxseSBpbiBh
biBpZGxlIHN0YXRlKS4gwqBXaHkgd291bGQgdGhpcyBiZT8gwqBJcyB0aGUgb25seSB3YXkgdG8g
dG90YWxseSBjbGVhbiB1cCB0aGUgbWVtb3J5IGlzIHRvIGNsb3NlIHRoZSB3cml0ZXI/IMKgT3Vy
IGluZGV4IGlzIGFsc28gdXNlZCBmb3IgcmVhbCB0aW1lIGluZGV4aW5nIHNvIHRoZSBJbmRleFdy
aXRlciBpcyBpbnRlbmRlZCB0byByZW1haW4gb3BlbiBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBh
cHAuDQo+Pj4NCj4+PiBBbnkgaGVscCBpbiB1bmRlcnN0YW5kaW5nIHdoeSB0aGUgSW5kZXhXcml0
ZXIgaXMgbWF4aW5nIG91dCBvdXIgaGVhcCBzcGFjZSBvciB3aGF0IGlzIGV4cGVjdGVkIGZyb20g
bWVtb3J5IHVzYWdlIG9mIHRoZSBJbmRleFdyaXRlciB3b3VsZCBiZSBhcHByZWNpYXRlZC4NCj4+
Pg0KPj4NCj4+IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KPj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11
c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+PiBGb3IgYWRkaXRpb25hbCBjb21t
YW5kcywgZS1tYWlsOiBqYXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KPj4NCj4+DQo+
PiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0NCj4+IFRvIHVuc3Vic2NyaWJlLCBlLW1haWw6IGphdmEtdXNlci11bnN1
YnNjcmliZUBsdWNlbmUuYXBhY2hlLm9yZw0KPj4gRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUt
bWFpbDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4+DQo+Pg0KPg0KPiAtLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0NCj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2NyaWJl
QGx1Y2VuZS5hcGFjaGUub3JnDQo+IEZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1haWw6IGph
dmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQo+DQo+DQo+DQo+IC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0K
PiBUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJzY3JpYmVAbHVjZW5lLmFw
YWNoZS5vcmcNCj4gRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUtbWFpbDogamF2YS11c2VyLWhl
bHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4NCg0KDQoNCi0tIA0KTGFuY2UgTm9yc2tvZw0KZ29rc3Jv
bkBnbWFpbC5jb20NCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZh
LXVzZXItdW5zdWJzY3JpYmVAbHVjZW5lLmFwYWNoZS5vcmcNCkZvciBhZGRpdGlvbmFsIGNvbW1h
bmRzLCBlLW1haWw6IGphdmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQoNCg==



From java-user-return-45783-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 19:44:35 2010
Return-Path: <java-user-return-45783-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76488 invoked from network); 13 Apr 2010 19:35:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 19:35:02 -0000
Received: (qmail 70436 invoked by uid 500); 13 Apr 2010 19:35:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70408 invoked by uid 500); 13 Apr 2010 19:35:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70400 invoked by uid 99); 13 Apr 2010 19:35:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 19:35:00 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 209.85.219.221 as permitted sender)
Received: from [209.85.219.221] (HELO mail-ew0-f221.google.com) (209.85.219.221)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 19:34:52 +0000
Received: by ewy21 with SMTP id 21so2640015ewy.5
        for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 12:34:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=65BzH/BFmrvqY6cu0LVPNDo9CLmg547lTUayDgpSU0g=;
        b=enbW3YK4h6Fu+G4sjfyi4+OFVK+PtmcKCEnMXnqt5/J/wopFtE9IUDPMM9y/UifJjP
         EQDrFzYG4gNCw0DKFJ24zaSBMxktj4dj1PzQRaTERR+gq1pe24vNpRXEfPV1RpYjXm0T
         jx6dw9vw4UjJyJgVsMGHI0+0sFDGZp2+CvxFU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VMsPNtC5WeLHNG9jZVF/F+eddj0mbjHb0DGmeRTZf4XwvHhT1NiXR3smUVVAQlFPlG
         E/LbCcflEOT/tHExlzK2KVoqDYQYKfhXcCM+6S8g2xPba+cECn4tRfRo+tnTiUVdd4qz
         hoO04fOp1rzcrpA3zGgiGIbmNH24P4719sUMY=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Tue, 13 Apr 2010 12:34:32 -0700 (PDT)
In-Reply-To: <m2jcbcac69f1004121049z1aba8ac3s9279f351b438cff4@mail.gmail.com>
References: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
	 <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
	 <h2mcbcac69f1004120409g5c27063az40456793bb517a0b@mail.gmail.com>
	 <m2jcbcac69f1004121049z1aba8ac3s9279f351b438cff4@mail.gmail.com>
Date: Tue, 13 Apr 2010 22:34:32 +0300
Received: by 10.103.4.28 with SMTP id g28mr3471370mui.29.1271187272091; Tue, 
	13 Apr 2010 12:34:32 -0700 (PDT)
Message-ID: <n2x786fde51004131234wdbf70b9cibe2f0f43a115e6c2@mail.gmail.com>
Subject: Re: Removing terms in the Index
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163641692dcbc91d048423595e
X-Virus-Checked: Checked by ClamAV on apache.org

--00163641692dcbc91d048423595e
Content-Type: text/plain; charset=ISO-8859-1

I ran your code. Since I don't have the queries file (Docs/documento.txt), I
set this line instead:

String termos = "\"Lucene in Action\"";

When I set it to \"Lucene\", both documents are found. When I set it to
\"Lucene in Action\" only the first document is found. Seems correct to me.

Can you please explain this:
"I pass the word "Lucene in Action", it find and
remove that term of phrase in the Index"

--> what do you mean "find and remove"?

Shai

On Mon, Apr 12, 2010 at 8:49 PM, Railan Xisto <railan.xisto@gmail.com>wrote:

> And the main objective: when I pass the word "Lucene in Action", it find
> and
> remove that term of phrase in the Index, for when I pass the 2nd term
> ("Lucene"), he does not find that phrase anymore, as has been found the
> "Lucene in Action" .
>
>
> 2010/4/12 Railan Xisto <railan.xisto@gmail.com>
>
> > Ok. There is a piece of code attached.. As I already said, I want to pass
> > that when the term "Lucene in Action" he finds only the 1st sentence.
> >
> >
> >
> >
> > 2010/4/10 Shai Erera <serera@gmail.com>
> >
> > Hi. I'm not sure I understand what you searched for. When you search
> >> for "Lucene in action", do you search it with the quotes or not? If
> >> with the quotes, then I don't understand how the 2nd dox is found.
> >>
> >> Do you perhaps have a test code you can share w/ us? It can be a short
> >> and simple main which creates an index w/ some documents and then
> >> searches them.
> >>
> >> Shai
> >>
> >> On Saturday, April 10, 2010, Fotos fotos <railan.xisto@gmail.com>
> wrote:
> >> > Hello!
> >> > I am a beginner with Lucene. I'm needing to do the following:
> >> >
> >> > I have a text file with the following terms:
> >> >
> >> > "Lucene in action"
> >> > "Lucene"
> >> >
> >> > and a file with the following sentences:
> >> >
> >> > 1 - "Lucene in action now."
> >> > 2 - "Lucene for Dummies"
> >> > 3 - "Managing Gigabytes"
> >> >
> >> > I need to search in phrases of doc2, the terms of doc1.
> >> >
> >> > But in search of the word n-grama: "Lucene in Action", he also finds
> the
> >> 2nd
> >> > sentence.
> >> >
> >> > In this case, I want to meet with the term 1 ("Lucene in Action"),
> only
> >> the
> >> > first phrase and remove the term of the index, for not to be found
> when
> >> I
> >> > pass the term 2 ("Lucene")
> >> >
> >> > Railan Xisto
> >> > Web Developer
> >> >
> >>
> >>  ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>

--00163641692dcbc91d048423595e--

From java-user-return-45784-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 20:59:43 2010
Return-Path: <java-user-return-45784-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69276 invoked from network); 13 Apr 2010 20:59:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 20:59:42 -0000
Received: (qmail 92212 invoked by uid 500); 13 Apr 2010 20:59:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92158 invoked by uid 500); 13 Apr 2010 20:59:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92150 invoked by uid 99); 13 Apr 2010 20:59:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 20:59:40 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of sirishreddy@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 20:59:33 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <sirishreddy@gmail.com>)
	id 1O1nCT-0008TG-30
	for java-user@lucene.apache.org; Tue, 13 Apr 2010 13:59:13 -0700
Date: Tue, 13 Apr 2010 12:59:13 -0800 (PST)
From: Sirish Vadala <sirishreddy@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271192353086-717137.post@n3.nabble.com>
Subject: Problem with search
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Hello All,

I am kind of new to Lucene, and having problem filtering search results.

Background:

My Indexed documents have multiple bills and each bill has multiple
versions. 

Each version of the same bill has a different bill Version Id, but the same
bill Id. In most likely case, the text in different versions varies only
slightly. The text for all these versions indexed.

Problem:

Lets say, for a particular search term, if it is present in one version of
the bill, in most cases it is present in all other versions too. So the
users have come up with a requirement stating that they would like to see
only the latest bill version for the same bill having this search term.

So when I perform a search for a particular word, I might get different
versions of the same bill, but have to display only the latest record for
that bill. I did some research and understood that filters could be used to
implement this kind of requirement, however I am not sure how to proceed.

Any hints on how to implement this would be highly appreciated.

Thanks.
-- 
View this message in context: http://n3.nabble.com/Problem-with-search-tp717137p717137.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45785-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 13 22:42:38 2010
Return-Path: <java-user-return-45785-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70582 invoked from network); 13 Apr 2010 22:42:37 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Apr 2010 22:42:37 -0000
Received: (qmail 29348 invoked by uid 500); 13 Apr 2010 22:42:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29305 invoked by uid 500); 13 Apr 2010 22:42:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29297 invoked by uid 99); 13 Apr 2010 22:42:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Apr 2010 22:42:35 +0000
X-ASF-Spam-Status: No, hits=0.2 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 13 Apr 2010 22:42:30 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id C12AA1E69DB; Tue, 13 Apr 2010 15:42:09 -0700 (MST)
Received: from PHX-HTPRD-01.adprod.bmc.com (phx-htprd-01.adprod.bmc.com [172.24.32.7])
	by flicker.bmc.com (Postfix) with ESMTP id B0B1A1E69C4
	for <java-user@lucene.apache.org>; Tue, 13 Apr 2010 15:42:09 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-01.adprod.bmc.com ([172.24.32.7]) with mapi; Tue, 13 Apr 2010
 16:42:09 -0600
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 13 Apr 2010 16:42:01 -0600
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrawKViZg0lVA9pTuOcXsESjGcqRgAfjQ9wAAZUrzA=
Message-ID: <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/mixed;
	boundary="_002_492379B6AA909E4FAF672AACCA0EADC25CBAA42E77PHXCCRPRD02ad_"
MIME-Version: 1.0

--_002_492379B6AA909E4FAF672AACCA0EADC25CBAA42E77PHXCCRPRD02ad_
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

U2luY2UgdGhlIGhlYXAgZHVtcCB3YXMgc28gYmlnIGFuZCBjYW4ndCBiZSBhdHRhY2hlZCwgSSBo
YXZlIHRha2VuIGEgZmV3IHNjcmVlbiBzaG90cyBmcm9tIEphdmEgVmlzdWFsVk0gb2YgdGhlIGhl
YXAgZHVtcC4gIEluIHRoZSBmaXJzdCBpbWFnZSB5b3UgY2FuIHNlZSB0aGF0IGF0IHRoZSB0aW1l
IG91ciBtZW1vcnkgaGFzIGJlY29tZSB2ZXJ5IHRpZ2h0IG1vc3Qgb2YgaXQgaXMgaGVsZCB1cCBp
biBieXRlcy4gIEluIHRoZSBzZWNvbmQgaW1hZ2UgSSBleGFtaW5lIG9uZSBvZiB0aG9zZSBpbnN0
YW5jZXMgYW5kIG5hdmlnYXRlIHRvIHRoZSBuZWFyZXN0IGdhcmJhZ2UgY29sbGVjdGlvbiByb290
LiAgSW4gbG9va2luZyBhdCB2ZXJ5IG1hbnkgb2YgdGhlc2Ugb2JqZWN0cywgdGhleSBhbGwgZW5k
IHVwIGJlaW5nIGluc3RhbnRpYXRlZCB0aHJvdWdoIHRoZSBJbmRleFdyaXRlciBwcm9jZXNzLg0K
DQpUaGlzIGhlYXAgZHVtcCBpcyB0aGUgc2FtZSBvbmUgY29ycmVsYXRpbmcgdG8gdGhlIGluZm9T
dHJlYW0gdGhhdCB3YXMgYXR0YWNoZWQgaW4gYSBwcmlvciBtZXNzYWdlLiAgU28gd2hpbGUgdGhl
IGluZm9TdHJlYW0gc2hvd3MgdGhlIGJ1ZmZlciBiZWluZyBmbHVzaGVkLCB3aGF0IHdlIGV4cGVy
aWVuY2UgaXMgdGhhdCBvdXIgbWVtb3J5IGdldHMgY29uc3VtZWQgb3ZlciB0aW1lIGJ5IHRoZXNl
IGJ5dGVzIGluIHRoZSBJbmRleFdyaXRlci4gIA0KDQpJIHdhbnRlZCB0byBwcm92aWRlIHRoZXNl
IGltYWdlcyB0byBzZWUgaWYgdGhleSBtaWdodCBjb3JyZWxhdGUgdG8gdGhlIGZpeGVzIG1lbnRp
b25lZCBiZWxvdy4gIEhvcGVmdWxseSB0aG9zZSBmaXhlcyBtZW50aW9uZWQgYmVsb3cgaGF2ZSBy
ZWN0aWZpZWQgdGhpcyBwcm9ibGVtLiAgQW5kIGFzIEkgc3RhdGUgaW4gdGhlIHByaW9yIG1lc3Nh
Z2UsIEknbSBob3BpbmcgdGhlc2UgZml4ZXMgYXJlIGluIGEgMi45eCBicmFuY2ggYW5kIGhvcGlu
ZyBmb3Igc29tZW9uZSB0byBwb2ludCBtZSB0byB3aGVyZSBJIGNhbiBnZXQgdGhvc2UgZml4ZXMg
dG8gdHJ5IG91dC4NCg0KVGhhbmtzDQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQpGcm9t
OiBXb29sZiwgUm9zcyBbbWFpbHRvOlJvc3NfV29vbGZAQk1DLmNvbV0gDQpTZW50OiBUdWVzZGF5
LCBBcHJpbCAxMywgMjAxMCAxOjI5IFBNDQpUbzogamF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3Jn
DQpTdWJqZWN0OiBSRTogSW5kZXhXcml0ZXIgYW5kIG1lbW9yeSB1c2FnZQ0KDQpBcmUgdGhlc2Ug
Zml4ZXMgaW4gMi45eCBicmFuY2g/ICBXZSBhcmUgdXNpbmcgMi45eCBhbmQgY2FuJ3QgbW92ZSB0
byAzeCBqdXN0IHlldC4gIElmIHNvLCB3aGVyZSBkbyBJIHNwZWNpZmljYWxseSBwaWNrIHRoaXMg
dXAgZnJvbT8NCg0KLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCkZyb206IExhbmNlIE5vcnNr
b2cgW21haWx0bzpnb2tzcm9uQGdtYWlsLmNvbV0gDQpTZW50OiBNb25kYXksIEFwcmlsIDEyLCAy
MDEwIDEwOjIwIFBNDQpUbzogamF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3JnDQpTdWJqZWN0OiBS
ZTogSW5kZXhXcml0ZXIgYW5kIG1lbW9yeSB1c2FnZQ0KDQpUaGVyZSBpcyBzb21lIGJ1Z3Mgd2hl
cmUgdGhlIHdyaXRlciBkYXRhIHN0cnVjdHVyZXMgcmV0YWluIGRhdGEgYWZ0ZXINCml0IGlzIGZs
dXNoZWQuIFRoZXkgYXJlIGNvbW1pdHRlZCBhcyBvZiBtYXliZSB0aGUgcGFzdCB3ZWVrLiBJZiB5
b3UNCmNhbiBwdWxsIHRoZSB0cnVuayBhbmQgdHJ5IGl0IHdpdGggeW91ciB1c2UgY2FzZSwgdGhh
dCB3b3VsZCBiZSBncmVhdC4NCg0KT24gTW9uLCBBcHIgMTIsIDIwMTAgYXQgODo1NCBBTSwgV29v
bGYsIFJvc3MgPFJvc3NfV29vbGZAYm1jLmNvbT4gd3JvdGU6DQo+IEkgd2FzIG9uIHZhY2F0aW9u
IGxhc3Qgd2VlayBzbyBqdXN0IGdldHRpbmcgYmFjayB0byB0aGlzLi4uIMKgSGVyZSBpcyB0aGUg
aW5mbyBzdHJlYW0gKGFzIGFuIGF0dGFjaG1lbnQpLiDCoEknbGwgc2VlIHdoYXQgSSBjYW4gZG8g
YWJvdXQgcmVkdWNpbmcgdGhlIGhlYXAgZHVtcCAoSXQgd2FzIHN1cHBsaWVkIGJ5IGEgY29sbGVh
Z3VlKS4NCj4NCj4NCj4gLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCj4gRnJvbTogTWljaGFl
bCBNY0NhbmRsZXNzIFttYWlsdG86bHVjZW5lQG1pa2VtY2NhbmRsZXNzLmNvbV0NCj4gU2VudDog
U2F0dXJkYXksIEFwcmlsIDAzLCAyMDEwIDM6MzkgQU0NCj4gVG86IGphdmEtdXNlckBsdWNlbmUu
YXBhY2hlLm9yZw0KPiBTdWJqZWN0OiBSZTogSW5kZXhXcml0ZXIgYW5kIG1lbW9yeSB1c2FnZQ0K
Pg0KPiBIbW0gd2h5IGlzIHRoZSBoZWFwIGR1bXAgc28gaW1tZW5zZT8gwqBOb3JtYWxseSBpdCBj
b250YWlucyB0aGUgdG9wIE4NCj4gKGVnIDEwMCkgb2JqZWN0IHR5cGVzIGFuZCB0aGVpciBjb3Vu
dC9hZ2dyZWdhdGUgUkFNIHVzYWdlLg0KPg0KPiBDYW4geW91IGF0dGFjaCB0aGUgaW5mb1N0cmVh
bSBvdXRwdXQgdG8gYW4gZW1haWwgKHRvIGphdmEtdXNlcik/DQo+DQo+IE1pa2UNCj4NCj4gT24g
RnJpLCBBcHIgMiwgMjAxMCBhdCA1OjI4IFBNLCBXb29sZiwgUm9zcyA8Um9zc19Xb29sZkBibWMu
Y29tPiB3cm90ZToNCj4+IEkgaGF2ZSB0aGlzIGFuZCB0aGUgaGVhcCBkdW1wIGlzIDYzbWIgemlw
cGVkLiDCoFRoZSBpbmZvIHN0cmVhbSBpcyBtdWNoIHNtYWxsZXIgKDMxIGtiIHppcHBlZCksIGJ1
dCBJIGRvbid0IGtub3cgaG93IHRvIGdldCB0aGVtIHRvIHlvdS4NCj4+DQo+PiBXZSBhcmUgbm90
IHVzaW5nIHRoZSBOUlQgcmVhZGVycw0KPj4NCj4+IC0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0t
DQo+PiBGcm9tOiBNaWNoYWVsIE1jQ2FuZGxlc3MgW21haWx0bzpsdWNlbmVAbWlrZW1jY2FuZGxl
c3MuY29tXQ0KPj4gU2VudDogVGh1cnNkYXksIEFwcmlsIDAxLCAyMDEwIDU6MjEgUE0NCj4+IFRv
OiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4+IFN1YmplY3Q6IFJlOiBJbmRleFdyaXRl
ciBhbmQgbWVtb3J5IHVzYWdlDQo+Pg0KPj4gSG1tLCBub3QgZ29vZC4gwqBDYW4geW91IHBvc3Qg
YSBoZWFwIGR1bXA/IMKgQWxzbywgY2FuIHlvdSB0dXJuIG9uDQo+PiBpbmZvU3RyZWFtLCBpbmRl
eCB1cCB0byB0aGUgT09NIEAgNTEyIE1CLCBhbmQgcG9zdCB0aGUgb3V0cHV0Pw0KPj4NCj4+IElu
ZGV4V3JpdGVyIHNob3VsZCBub3QgaGFuZyBvbnRvIG11Y2ggYmV5b25kIHRoZSBSQU0gYnVmZmVy
LiDCoEJ1dCwgaXQNCj4+IGRvZXMgYWxsb2NhdGUgYW5kIHRoZW4gcmVjeWNsZSB0aGlzIFJBTSBi
dWZmZXIsIHNvIGV2ZW4gaW4gYW4gaWRsZQ0KPj4gc3RhdGUgKGhhdmluZyBpbmRleGVkIGVub3Vn
aCBkb2NzIHRvIGZpbGwgdXAgdGhlIFJBTSBidWZmZXIgYXQgbGVhc3QNCj4+IG9uY2UpIGl0J2xs
IGhvbGQgb250byB0aG9zZSAxNiBNQi4NCj4+DQo+PiBBcmUgeW91IHVzaW5nIGdldFJlYWRlciAo
dG8gZ2V0IHlvdXIgTlJUIHJlYWRlcnMpPyDCoElmIHNvLCBhcmUgeW91DQo+PiByZWFsbHkgc3Vy
ZSB5b3UncmUgZXZlbnR1YWxseSBjbG9zaW5nIHRoZSBwcmV2aW91cyByZWFkZXIgYWZ0ZXINCj4+
IG9wZW5pbmcgYSBuZXcgb25lPw0KPj4NCj4+IE1pa2UNCj4+DQo+PiBPbiBUaHUsIEFwciAxLCAy
MDEwIGF0IDY6NTggUE0sIFdvb2xmLCBSb3NzIDxSb3NzX1dvb2xmQGJtYy5jb20+IHdyb3RlOg0K
Pj4+IFdlIGFyZSBzZWVpbmcgYSBzaXR1YXRpb24gd2hlcmUgdGhlIEluZGV4V3JpdGVyIGlzIHVz
aW5nIHVwIHRoZSBKYXZhIEhlYXAgc3BhY2UgYW5kIG9ubHkgcmVsZWFzZXMgbWVtb3J5IGZvciBn
YXJiYWdlIGNvbGxlY3Rpb24gdXBvbiBhIGNvbW1pdC4gwqAgV2UgYXJlIHVzaW5nIHRoZSBkZWZh
dWx0IFJBTUJ1ZmZlclNpemUgb2YgMTYgbWIuIMKgV2UgYXJlIHVzaW5nIEx1Y2VuZSAyLjkuMS4g
V2UgYXJlIHNldCBhdCBoZWFwIHNpemUgb2YgNTEyIG1iLg0KPj4+DQo+Pj4gV2UgaGF2ZSBhIGxh
cmdlIG51bWJlciBvZiBkb2N1bWVudHMgdGhhdCBhcmUgcnVuIHRocm91Z2ggVGlrYSBhbmQgdGhl
biBhZGRlZCB0byB0aGUgaW5kZXguIMKgVGhlIGRhdGEgZnJvbSBUaWthIGlzIGNoYW5nZWQgdG8g
YSBzdHJpbmcsIGFuZCB0aGVuIHNlbnQgdG8gTHVjZW5lLiDCoEhlYXAgZHVtcHMgY2xlYXJseSBz
aG93IHRoZSBkYXRhIGluIHRoZSBMdWNlbmUgY2xhc3NlcyBhbmQgbm90IGluIFRpa2EuIMKgT3Vy
IGludGVudCBpcyB0byBvbmx5IHBlcmZvcm0gYSBjb21taXQgb25jZSB0aGUgZW50aXJlIGluZGV4
aW5nIHJ1biBpcyBjb21wbGV0ZSwgYnV0IHNldmVyYWwgaG91cnMgaW50byB0aGUgcHJvY2VzcyBl
dmVyeXRoaW5nIGNvbWVzIHRvIGEgY3Jhd2wuIMKgSW4gdXNpbmcgYm90aCBKQ29uc29sZSBhbmQg
VmlzdWFsVk0gwqB3ZSBjYW4gc2VlIHRoYXQgdGhlIGhlYXAgc3BhY2UgaXMgbWF4ZWQgb3V0IGFu
ZCBnYXJiYWdlIGNvbGxlY3Rpb24gaXMgbm90IGFibGUgdG8gY2xlYW4gdXAgYW55IG1lbW9yeSBv
bmNlIHdlIGdldCBpbnRvIHRoaXMgc3RhdGUuIMKgSXQgaXMgb3VyIHVuZGVyc3RhbmRpbmcgdGhh
dCB0aGUgSW5kZXhXcml0ZXIgc2hvdWxkIGJlIG9ubHkgaG9sZGluZyBvbnRvIDE2IG1iIG9mIGRh
dGEgYmVmb3JlIGl0IGZsdXNoZXMgaXQsIGJ1dCB3aGF0IHdlIGFyZSBzZWVpbmcgaXMgdGhhdCB3
aGlsZSBpdCBpcyBpbiBmYWN0IHdyaXRpbmcgZGF0YSB0byBkaXNrIHdoZW4gaXQgaGl0cyB0aGUg
MTYgbWIgbGltaXQsIGl0IGlzIGFsc28gaG9sZGluZyBvbnRvIHNvbWUgZGF0YSBpbiBtZW1vcnkg
YW5kIG5vdCBhbGxvd2luZyBnYXJiYWdlIGNvbGxlY3Rpb24gdG8gdGFrZSBwbGFjZSwgYW5kIHRo
aXMgY29udGludWVzIHVudGlsIGdhcmJhZ2UgY29sbGVjdGlvbiBpcyB1bmFibGUgdG8gZnJlZSB1
cCBlbm91Z2ggc3BhY2UgdG8gYWxsIHRoaW5ncyB0byBtb3ZlIGZhc3RlciB0aGFuIGEgY3Jhd2wu
DQo+Pj4NCj4+PiBBcyBhIHRlc3Qgd2UgY2F1c2VkIGEgY29tbWl0IHRvIG9jY3VyIGFmdGVyIGVh
Y2ggZG9jdW1lbnQgaXMgaW5kZXhlZCBhbmQgd2Ugc2VlIHRoZSB0b3RhbCBhbW91bnQgb2YgbWVt
b3J5IHJlZHVjZWQgZnJvbSBuZWFybHkgMTAwJSBvZiB0aGUgSmF2YSBIZWFwIHRvIGFyb3VuZCA3
MC03NSUuIMKgVGhlIHByb2ZpbGluZyB0b29scyBub3cgc2hvdyB0aGF0IHRoZSBtZW1vcnkgaXMg
Y2xlYW5lZCB1cCB0byBzb21lIGV4dGVudCBhZnRlciBlYWNoIGRvY3VtZW50LiDCoEJ1dCBvZiBj
b3Vyc2UgdGhpcyBjb21wbGV0ZWx5IGRlZmVhdHMgdGhlIHdob2xlIHJlYXNvbiB3aHkgd2Ugd2Fu
dCB0byBvbmx5IGNvbW1pdCBhdCB0aGUgZW5kIG9mIHRoZSBydW4gZm9yIHBlcmZvcm1hbmNlIHNh
a2UuIMKgTW9zdCBvZiB0aGUgZGF0YSwgYXMgc2VlbiB1c2luZyBIZWFwIGFuYWxhc2lzLCBpcyBo
ZWxkIGluIEJ5dGUsIENoYXJhY3RlciwgYW5kIEludGVnZXIgY2xhc3NlcyB3aG9zIEdDIHJvb3Rz
IGFyZSB0aWVkIGJhY2sgdG8gdGhlIFdyaXRlciBPYmplY3RzIGFuZCB0aHJlYWRzLiDCoFRoZSBp
bnN0YW5jZSBjb3VudHMsIGFmdGVyIHJ1bm5pbmcganVzdCAxLDEwMCBkb2N1bWVudHMgc2VlbXMg
c3RhZ2dlcmluZw0KPj4+DQo+Pj4gSXMgdGhlcmUgYWRkaXRpb25hbCBkYXRhIHRoYXQgdGhlIElu
ZGV4V3JpdGVyIGhhbmdzIG9udG8gcmVnYXJkbGVzcyBvZiB3aGVuIGl0IGhpdHMgdGhlIFJBTUJ1
ZmZlclNpemUgbGltaXQ/IMKgV2h5IGFyZSB3ZSBzZWVpbmcgdGhlIGhlYXAgc3BhY2UgYWxsIGJl
aW5nIHVzZWQgdXA/DQo+Pj4NCj4+PiBBIHNpZGUgcXVlc3Rpb24gdG8gdGhpcyBpcyB0aGUgZmFj
dCB0aGF0IHdlIGFsd2F5cyBzZWUgYSBsYXJnZSBhbW91bnQgb2YgbWVtb3J5IHVzZWQgYnkgdGhl
IEluZGV4V3JpdGVyIGV2ZW4gYWZ0ZXIgb3VyIGluZGV4aW5nIGhhcyBiZWVuIGNvbXBsZXRlZCBh
bmQgYWxsIGNvbW1pdHMgaGF2ZSB0YWtlbiBwbGFjZSAoYmFzaWNhbGx5IGluIGFuIGlkbGUgc3Rh
dGUpLiDCoFdoeSB3b3VsZCB0aGlzIGJlPyDCoElzIHRoZSBvbmx5IHdheSB0byB0b3RhbGx5IGNs
ZWFuIHVwIHRoZSBtZW1vcnkgaXMgdG8gY2xvc2UgdGhlIHdyaXRlcj8gwqBPdXIgaW5kZXggaXMg
YWxzbyB1c2VkIGZvciByZWFsIHRpbWUgaW5kZXhpbmcgc28gdGhlIEluZGV4V3JpdGVyIGlzIGlu
dGVuZGVkIHRvIHJlbWFpbiBvcGVuIGZvciB0aGUgbGlmZXRpbWUgb2YgdGhlIGFwcC4NCj4+Pg0K
Pj4+IEFueSBoZWxwIGluIHVuZGVyc3RhbmRpbmcgd2h5IHRoZSBJbmRleFdyaXRlciBpcyBtYXhp
bmcgb3V0IG91ciBoZWFwIHNwYWNlIG9yIHdoYXQgaXMgZXhwZWN0ZWQgZnJvbSBtZW1vcnkgdXNh
Z2Ugb2YgdGhlIEluZGV4V3JpdGVyIHdvdWxkIGJlIGFwcHJlY2lhdGVkLg0KPj4+DQo+Pg0KPj4g
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tDQo+PiBUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJz
Y3JpYmVAbHVjZW5lLmFwYWNoZS5vcmcNCj4+IEZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1h
aWw6IGphdmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQo+Pg0KPj4NCj4+IC0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQ0KPj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2NyaWJlQGx1
Y2VuZS5hcGFjaGUub3JnDQo+PiBGb3IgYWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBqYXZh
LXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KPj4NCj4+DQo+DQo+IC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0K
PiBUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJzY3JpYmVAbHVjZW5lLmFw
YWNoZS5vcmcNCj4gRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUtbWFpbDogamF2YS11c2VyLWhl
bHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4NCj4NCj4NCj4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQo+IFRvIHVuc3Vi
c2NyaWJlLCBlLW1haWw6IGphdmEtdXNlci11bnN1YnNjcmliZUBsdWNlbmUuYXBhY2hlLm9yZw0K
PiBGb3IgYWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBqYXZhLXVzZXItaGVscEBsdWNlbmUu
YXBhY2hlLm9yZw0KPg0KDQoNCg0KLS0gDQpMYW5jZSBOb3Jza29nDQpnb2tzcm9uQGdtYWlsLmNv
bQ0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0NClRvIHVuc3Vic2NyaWJlLCBlLW1haWw6IGphdmEtdXNlci11bnN1
YnNjcmliZUBsdWNlbmUuYXBhY2hlLm9yZw0KRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUtbWFp
bDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCg0K


--_002_492379B6AA909E4FAF672AACCA0EADC25CBAA42E77PHXCCRPRD02ad_
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--_002_492379B6AA909E4FAF672AACCA0EADC25CBAA42E77PHXCCRPRD02ad_--


From java-user-return-45786-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 08:55:40 2010
Return-Path: <java-user-return-45786-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64838 invoked from network); 14 Apr 2010 08:55:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 08:55:40 -0000
Received: (qmail 92906 invoked by uid 500); 14 Apr 2010 08:55:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92674 invoked by uid 500); 14 Apr 2010 08:55:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92195 invoked by uid 99); 14 Apr 2010 08:55:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 08:55:36 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 209.85.218.220 as permitted sender)
Received: from [209.85.218.220] (HELO mail-bw0-f220.google.com) (209.85.218.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 08:55:31 +0000
Received: by bwz20 with SMTP id 20so6148053bwz.12
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 01:55:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=WkjGwZcA5iWc7aWj2gSQKlS2RQlvXzsyaomT+pyhU78=;
        b=ctjd8nZmh7K6ML4A8hUyoQnpXzsc/LXHEdDZnEi8569fR+JuwIeyFAQeOHokdWiJOV
         EQi+L5ljXe1lgs7r6lGFjZVQT7w6tOF0Staioc5MOtKFWUvaeBCuX1GI1Lzs86E2+bNM
         lRQ5mu/l8JZBE0EI+LpHppI8Ip/HZqyxgr6pg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=unMttvMOEUFLqXtbtNIti7k6eoQyCT5SAebj7H3kjNVjEuX+dGum0IezZz8TQ9EZOi
         m6qC+CX1lqUJi82RGqj/RSkHF22yCIJhpfY2+bU9OyFXQCprrht4sXiXIXyhQgU2veKF
         RrNqF4YO4sbq79ErCusbmmMWWXcR4xXOD56GI=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Wed, 14 Apr 2010 01:55:09 -0700 (PDT)
In-Reply-To: <1271192353086-717137.post@n3.nabble.com>
References: <1271192353086-717137.post@n3.nabble.com>
Date: Wed, 14 Apr 2010 11:55:09 +0300
Received: by 10.103.80.5 with SMTP id h5mr3900781mul.82.1271235309340; Wed, 14 
	Apr 2010 01:55:09 -0700 (PDT)
Message-ID: <r2w786fde51004140155nbd8480c3z747bb514f135b007@mail.gmail.com>
Subject: Re: Problem with search
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e65c88e80a06a404842e89ed

--0016e65c88e80a06a404842e89ed
Content-Type: text/plain; charset=ISO-8859-1

I don't know if that proposal is the most efficient one, but you can try it.
In general, what you're looking for is a GROUP BY Bill-Id feature and then
select the most recent one, right? Only you don't need all the Versions of
the same Bill, and therefore you can hold the most recent Version-Id only.
What you can do is write a Collector which for each received document checks
its Bill-Id and Version-Id. It keeps a Map Bill-Id -> Version-Id and for
every incoming doc checks the map:
1) If the Bill-Id hasn't been seen yet, stores it in the map.
2) If it has been seen, compares the Version-Id of the incoming doc to the
one in the map and replaces them if needed.

By storing the Bill-Id and Version-Id in the FieldCache you can make that
Collector work very fast. Also, you can apply some optimization to the
process by e.g. not checking the map if the document has no chance in being
selected for the top-K requested docs (for e.g. a low score) etc.

I've outlined a general approach .. other, perhaps more efficient ones, may
exist.

Another alternative is to run your search, collecting top-NK, where N is a
factor/multiplier you activate on K. After the search is done, you filter
out the unneeded docs w/ "old" Version-Id. If you choose your N smartly,
you'll do it just once, not re-running the query in case it filtered out too
many docs.

Hope this helps,
Shai

On Tue, Apr 13, 2010 at 11:59 PM, Sirish Vadala <sirishreddy@gmail.com>wrote:

>
> Hello All,
>
> I am kind of new to Lucene, and having problem filtering search results.
>
> Background:
>
> My Indexed documents have multiple bills and each bill has multiple
> versions.
>
> Each version of the same bill has a different bill Version Id, but the same
> bill Id. In most likely case, the text in different versions varies only
> slightly. The text for all these versions indexed.
>
> Problem:
>
> Lets say, for a particular search term, if it is present in one version of
> the bill, in most cases it is present in all other versions too. So the
> users have come up with a requirement stating that they would like to see
> only the latest bill version for the same bill having this search term.
>
> So when I perform a search for a particular word, I might get different
> versions of the same bill, but have to display only the latest record for
> that bill. I did some research and understood that filters could be used to
> implement this kind of requirement, however I am not sure how to proceed.
>
> Any hints on how to implement this would be highly appreciated.
>
> Thanks.
> --
> View this message in context:
> http://n3.nabble.com/Problem-with-search-tp717137p717137.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e65c88e80a06a404842e89ed--

From java-user-return-45787-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 10:12:53 2010
Return-Path: <java-user-return-45787-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18300 invoked from network); 14 Apr 2010 10:12:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 10:12:53 -0000
Received: (qmail 87164 invoked by uid 500); 14 Apr 2010 10:12:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87010 invoked by uid 500); 14 Apr 2010 10:12:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86995 invoked by uid 99); 14 Apr 2010 10:12:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 10:12:50 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.210.184] (HELO mail-yx0-f184.google.com) (209.85.210.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 10:12:43 +0000
Received: by yxe14 with SMTP id 14so3803389yxe.5
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 03:12:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Wed, 14 Apr 2010 03:12:22 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
Date: Wed, 14 Apr 2010 06:12:22 -0400
Received: by 10.150.184.3 with SMTP id h3mr6345308ybf.265.1271239942151; Wed, 
	14 Apr 2010 03:12:22 -0700 (PDT)
Message-ID: <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

It looks like the mailing list software stripped your image attachments...

Alas these fixes are only committed on 3.1.

But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
fix.  I think the other issue was part of LUCENE-2074 (though this
issue included many other changes) -- Uwe can you peel out just a
2.9.x patch for resetting JFlex's zzBuffer?

You could also try switching analyzers (eg to WhitespaceAnalyzer) to
see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
uses JFlex) is [part of] your problem.

Mike

On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> Since the heap dump was so big and can't be attached, I have taken a few =
screen shots from Java VisualVM of the heap dump. =A0In the first image you=
 can see that at the time our memory has become very tight most of it is he=
ld up in bytes. =A0In the second image I examine one of those instances and=
 navigate to the nearest garbage collection root. =A0In looking at very man=
y of these objects, they all end up being instantiated through the IndexWri=
ter process.
>
> This heap dump is the same one correlating to the infoStream that was att=
ached in a prior message. =A0So while the infoStream shows the buffer being=
 flushed, what we experience is that our memory gets consumed over time by =
these bytes in the IndexWriter.
>
> I wanted to provide these images to see if they might correlate to the fi=
xes mentioned below. =A0Hopefully those fixes mentioned below have rectifie=
d this problem. =A0And as I state in the prior message, I'm hoping these fi=
xes are in a 2.9x branch and hoping for someone to point me to where I can =
get those fixes to try out.
>
> Thanks
>
> -----Original Message-----
> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
> Sent: Tuesday, April 13, 2010 1:29 PM
> To: java-user@lucene.apache.org
> Subject: RE: IndexWriter and memory usage
>
> Are these fixes in 2.9x branch? =A0We are using 2.9x and can't move to 3x=
 just yet. =A0If so, where do I specifically pick this up from?
>
> -----Original Message-----
> From: Lance Norskog [mailto:goksron@gmail.com]
> Sent: Monday, April 12, 2010 10:20 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> There is some bugs where the writer data structures retain data after
> it is flushed. They are committed as of maybe the past week. If you
> can pull the trunk and try it with your use case, that would be great.
>
> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> I was on vacation last week so just getting back to this... =A0Here is t=
he info stream (as an attachment). =A0I'll see what I can do about reducing=
 the heap dump (It was supplied by a colleague).
>>
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Saturday, April 03, 2010 3:39 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> Hmm why is the heap dump so immense? =A0Normally it contains the top N
>> (eg 100) object types and their count/aggregate RAM usage.
>>
>> Can you attach the infoStream output to an email (to java-user)?
>>
>> Mike
>>
>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> I have this and the heap dump is 63mb zipped. =A0The info stream is muc=
h smaller (31 kb zipped), but I don't know how to get them to you.
>>>
>>> We are not using the NRT readers
>>>
>>> -----Original Message-----
>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>> Sent: Thursday, April 01, 2010 5:21 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>
>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, it
>>> does allocate and then recycle this RAM buffer, so even in an idle
>>> state (having indexed enough docs to fill up the RAM buffer at least
>>> once) it'll hold onto those 16 MB.
>>>
>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>> really sure you're eventually closing the previous reader after
>>> opening a new one?
>>>
>>> Mike
>>>
>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>>> We are seeing a situation where the IndexWriter is using up the Java H=
eap space and only releases memory for garbage collection upon a commit. =
=A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene=
 2.9.1. We are set at heap size of 512 mb.
>>>>
>>>> We have a large number of documents that are run through Tika and then=
 added to the index. =A0The data from Tika is changed to a string, and then=
 sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes =
and not in Tika. =A0Our intent is to only perform a commit once the entire =
indexing run is complete, but several hours into the process everything com=
es to a crawl. =A0In using both JConsole and VisualVM =A0we can see that th=
e heap space is maxed out and garbage collection is not able to clean up an=
y memory once we get into this state. =A0It is our understanding that the I=
ndexWriter should be only holding onto 16 mb of data before it flushes it, =
but what we are seeing is that while it is in fact writing data to disk whe=
n it hits the 16 mb limit, it is also holding onto some data in memory and =
not allowing garbage collection to take place, and this continues until gar=
bage collection is unable to free up enough space to all things to move fas=
ter than a crawl.
>>>>
>>>> As a test we caused a commit to occur after each document is indexed a=
nd we see the total amount of memory reduced from nearly 100% of the Java H=
eap to around 70-75%. =A0The profiling tools now show that the memory is cl=
eaned up to some extent after each document. =A0But of course this complete=
ly defeats the whole reason why we want to only commit at the end of the ru=
n for performance sake. =A0Most of the data, as seen using Heap analasis, i=
s held in Byte, Character, and Integer classes whos GC roots are tied back =
to the Writer Objects and threads. =A0The instance counts, after running ju=
st 1,100 documents seems staggering
>>>>
>>>> Is there additional data that the IndexWriter hangs onto regardless of=
 when it hits the RAMBufferSize limit? =A0Why are we seeing the heap space =
all being used up?
>>>>
>>>> A side question to this is the fact that we always see a large amount =
of memory used by the IndexWriter even after our indexing has been complete=
d and all commits have taken place (basically in an idle state). =A0Why wou=
ld this be? =A0Is the only way to totally clean up the memory is to close t=
he writer? =A0Our index is also used for real time indexing so the IndexWri=
ter is intended to remain open for the lifetime of the app.
>>>>
>>>> Any help in understanding why the IndexWriter is maxing out our heap s=
pace or what is expected from memory usage of the IndexWriter would be appr=
eciated.
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>
>
> --
> Lance Norskog
> goksron@gmail.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45788-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 11:41:35 2010
Return-Path: <java-user-return-45788-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70487 invoked from network); 14 Apr 2010 11:41:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 11:41:35 -0000
Received: (qmail 81996 invoked by uid 500); 14 Apr 2010 11:41:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81903 invoked by uid 500); 14 Apr 2010 11:41:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81895 invoked by uid 99); 14 Apr 2010 11:41:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 11:41:28 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 11:41:21 +0000
Received: by bwz3 with SMTP id 3so3475bwz.11
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 04:41:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=ghRbZLUhXDZ2EAvNv9BSkckR5Joes4jZPAO0/uI7s3k=;
        b=Mu8rnKnUjE9FAUDQMj43Z1xjzIp5IiRH5L684+DFZpv/b1P2UwrMevQt8mb9xkbzKu
         aF8c0JG/9c08ptZmcNHxZRt8h8+WcOVO04U1r3vhxwVQelWCQu7TZhZhLIWNgI3G+Q8p
         rb4lDu/4NbX5kv+VkBlIOdwLZ60Da0StBNfuw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=O2mi/rvedWBh/qehMHkgCLS/1HamsbN6UNTETYMtQJdyuPHDRFop1YozLi5UNqkBRy
         zQKUQzwltPWw0MJb8MIexoFnCG/4RxOPEG/vfVlPtofyv6GcyXEbo0mz+zecTHk1g/k9
         bA5GdPFtZxU7rB9jb0EZb3go/950kj6peTfJw=
MIME-Version: 1.0
Received: by 10.204.67.136 with HTTP; Wed, 14 Apr 2010 04:41:00 -0700 (PDT)
Date: Wed, 14 Apr 2010 13:41:00 +0200
Received: by 10.204.133.129 with SMTP id f1mr8102082bkt.45.1271245260303; Wed, 
	14 Apr 2010 04:41:00 -0700 (PDT)
Message-ID: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
Subject: trying to resolve error: after flush: fdx size mismatch
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

I am trying to chase an issue in our code and it is being quite
difficult. We have seen two instances (see below) where we get the
same error. I have been trying to reproduce but it has been impossible
so far.I have several threads, some might be creating indices and
adding documents, others closing indices etc.  In the list this
message appear several times, in some cases it was a lucene bug (not
my case, I dont have millions of docs here) and in other it seems bad
multithreading. I have verified my multithreaded code for the 5th time
and all seems well synchronized.

So I am asking if somebody can give me any hint, maybe the fact that
the first number is always a 1 means something??  I suspect the issue
is when a new index is just created maybe.

java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
103 length in bytes of _2.fdx file exists?=true
org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsWriter.java:97)
org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProcessor.java:50)
org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.java:380)
org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:581)
org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:4294)
org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:4192)
org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:4183)
org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:2190)
org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2153)
org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2117)


java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
8457 length in bytes of _0.fdx file exists?=true ...

My env is vista, jdk1.6, lucene 2.9.1
thanks in advance.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45789-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 11:42:43 2010
Return-Path: <java-user-return-45789-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73210 invoked from network); 14 Apr 2010 11:42:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 11:42:42 -0000
Received: (qmail 85485 invoked by uid 500); 14 Apr 2010 11:42:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85398 invoked by uid 500); 14 Apr 2010 11:42:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85389 invoked by uid 99); 14 Apr 2010 11:42:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 11:42:40 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of franzroth@gmx.de designates 213.165.64.20 as permitted sender)
Received: from [213.165.64.20] (HELO mail.gmx.net) (213.165.64.20)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 14 Apr 2010 11:42:31 +0000
Received: (qmail 31273 invoked by uid 0); 14 Apr 2010 11:42:10 -0000
Received: from 87.139.98.145 by www131.gmx.net with HTTP;
 Wed, 14 Apr 2010 13:42:09 +0200 (CEST)
Content-Type: text/plain; charset="iso-8859-1"
Date: Wed, 14 Apr 2010 13:42:09 +0200
From: "Franz Roth" <franzroth@gmx.de>
Message-ID: <20100414114209.294260@gmx.net>
MIME-Version: 1.0
Subject: PrefixQuery and special characters
To: java-user@lucene.apache.org
X-Authenticated: #6704461
X-Flags: 0001
X-Mailer: WWW-Mail 6100 (Global Message Exchange)
X-Priority: 3
X-Provags-ID: V01U2FsdGVkX1/2/ANy5OH27Hci8BQzJhy+tH6RLsi52S649r02eI
 e0d6WPqqBnitbtKP8A2G/CF8k6h+4yUu4dQg== 
Content-Transfer-Encoding: 8bit
X-GMX-UID: dcOgCpwGfW47YXcXEWVoAiBudmllcoVN
X-FuHaFi: 0.51000000000000001
X-Virus-Checked: Checked by ClamAV on apache.org

Hi all,

say I have an Index with one field named "category". There are two documents one with value "(testvalue)" and one with value "test value".
Now somone search with "test". My Searchenine uses the org.apache.lucene.search.PrefixQuery and finds 2 documents. Maybe he  estimated only one hit; owever: if he searches for "(test" and the Searchengine uses the QueryParser.escape to clean the request and takes that PrefixQuery to search nothing results.

How can I search for the document "(testvalue)" and only this one?

Thx!





package foo.bar;

import java.io.IOException;

import junit.framework.TestCase;

import org.apache.log4j.Logger;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.Field;
import org.apache.lucene.index.CorruptIndexException;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.Term;
import org.apache.lucene.queryParser.QueryParser;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.PrefixQuery;
import org.apache.lucene.search.ScoreDoc;
import org.apache.lucene.store.LockObtainFailedException;
import org.apache.lucene.store.RAMDirectory;



public class TestPrefixQuery extends TestCase {
	public void testEscapeAndPrefix() throws CorruptIndexException,
	LockObtainFailedException, IOException {
		
	    RAMDirectory directory = new RAMDirectory();
	    IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(), 
		    true, IndexWriter.MaxFieldLength.LIMITED);
	    Document doc = new Document();
	    doc.add(new Field("category", "(testvalue)", Field.Store.YES, 
	            Field.Index.ANALYZED));
	    writer.addDocument(doc);
	    doc = new Document();
	    doc.add(new Field("category", "test value", Field.Store.YES, 
	    	Field.Index.ANALYZED));
	    writer.addDocument(doc);
	    writer.close();
	    
	    String value= "test";
	    PrefixQuery query = new PrefixQuery(new Term("category", value));
	    //log.debug(query.toString());
	    IndexSearcher searcher = new IndexSearcher(directory);
	    ScoreDoc[] hits = searcher.search(query, null, 1000).scoreDocs;
	    assertEquals("One for " + value , 2, hits.length); //I want one for this?!
	    
	    value= "(test";
	    String escaped = QueryParser.escape(value);
	    query = new PrefixQuery(new Term("category", escaped));
	    //log.debug(query.toString());
	    hits = searcher.search(query, null, 1000).scoreDocs;
	    assertEquals("One for " + value + "/" + escaped, 1, hits.length); //FAILS!
	}
}

-- 
GRATIS fr alle GMX-Mitglieder: Die maxdome Movie-FLAT!
Jetzt freischalten unter http://portal.gmx.net/de/go/maxdome01

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45790-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 12:29:50 2010
Return-Path: <java-user-return-45790-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9704 invoked from network); 14 Apr 2010 12:29:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 12:29:50 -0000
Received: (qmail 66313 invoked by uid 500); 14 Apr 2010 12:29:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66258 invoked by uid 500); 14 Apr 2010 12:29:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66250 invoked by uid 99); 14 Apr 2010 12:29:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 12:29:47 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [128.230.18.82] (HELO smtp1.syr.edu) (128.230.18.82)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 12:29:38 +0000
Received: from suex07-hub-02.ad.syr.edu (suex07-hub-02.ad.syr.edu [128.230.108.196])
	by smtp1.syr.edu (8.14.3/8.14.3) with ESMTP id o3ECTHDp029586
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 08:29:17 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-02.ad.syr.edu ([fe80::813b:49a2:a4d5:6367%10]) with mapi; Wed, 14
 Apr 2010 08:29:17 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Wed, 14 Apr 2010 08:24:38 -0400
Subject: RE: PrefixQuery and special characters
Thread-Topic: PrefixQuery and special characters
Thread-Index: Acrbx5tohv/4HUJLQYaJtNmXzTCnLQABdg57
Message-ID: <2D127F11DC79714E9B6A43AC9458147F3B81E23E@suex07-mbx-03.ad.syr.edu>
References: <20100414114209.294260@gmx.net>
In-Reply-To: <20100414114209.294260@gmx.net>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2010-04-14_09:2010-02-06,2010-04-14,2010-04-14 signatures=0
X-Proofpoint-Spam-Reason: safe
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Franz,

The likely problem is that you're using an index-time analyzer that strips =
out the parentheses.  StandardAnalyzer, for example, does this; WhitespaceA=
nalyzer does not.

Remember that hits are the result of matches between index-analyzed terms a=
nd query-analyzed terms.  Except in the case of synonyms, most people will =
want their index and query analyzers to be the same.

Steve

________________________________________
From: Franz Roth [franzroth@gmx.de]
Sent: Wednesday, April 14, 2010 7:42 AM
To: java-user@lucene.apache.org
Subject: PrefixQuery and special characters

Hi all,

say I have an Index with one field named "category". There are two document=
s one with value "(testvalue)" and one with value "test value".
Now somone search with "test". My Searchenine uses the org.apache.lucene.se=
arch.PrefixQuery and finds 2 documents. Maybe he  estimated only one hit; o=
wever: if he searches for "(test" and the Searchengine uses the QueryParser=
.escape to clean the request and takes that PrefixQuery to search nothing r=
esults.

How can I search for the document "(testvalue)" and only this one?

Thx!





package foo.bar;

import java.io.IOException;

import junit.framework.TestCase;

import org.apache.log4j.Logger;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.Field;
import org.apache.lucene.index.CorruptIndexException;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.Term;
import org.apache.lucene.queryParser.QueryParser;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.PrefixQuery;
import org.apache.lucene.search.ScoreDoc;
import org.apache.lucene.store.LockObtainFailedException;
import org.apache.lucene.store.RAMDirectory;



public class TestPrefixQuery extends TestCase {
        public void testEscapeAndPrefix() throws CorruptIndexException,
        LockObtainFailedException, IOException {

            RAMDirectory directory =3D new RAMDirectory();
            IndexWriter writer =3D new IndexWriter(directory, new StandardA=
nalyzer(),
                    true, IndexWriter.MaxFieldLength.LIMITED);
            Document doc =3D new Document();
            doc.add(new Field("category", "(testvalue)", Field.Store.YES,
                    Field.Index.ANALYZED));
            writer.addDocument(doc);
            doc =3D new Document();
            doc.add(new Field("category", "test value", Field.Store.YES,
                Field.Index.ANALYZED));
            writer.addDocument(doc);
            writer.close();

            String value=3D "test";
            PrefixQuery query =3D new PrefixQuery(new Term("category", valu=
e));
            //log.debug(query.toString());
            IndexSearcher searcher =3D new IndexSearcher(directory);
            ScoreDoc[] hits =3D searcher.search(query, null, 1000).scoreDoc=
s;
            assertEquals("One for " + value , 2, hits.length); //I want one=
 for this?!

            value=3D "(test";
            String escaped =3D QueryParser.escape(value);
            query =3D new PrefixQuery(new Term("category", escaped));
            //log.debug(query.toString());
            hits =3D searcher.search(query, null, 1000).scoreDocs;
            assertEquals("One for " + value + "/" + escaped, 1, hits.length=
); //FAILS!
        }
}

--
GRATIS f=FCr alle GMX-Mitglieder: Die maxdome Movie-FLAT!
Jetzt freischalten unter http://portal.gmx.net/de/go/maxdome01

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45791-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 15:14:00 2010
Return-Path: <java-user-return-45791-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16839 invoked from network); 14 Apr 2010 15:14:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 15:14:00 -0000
Received: (qmail 77028 invoked by uid 500); 14 Apr 2010 15:13:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76946 invoked by uid 500); 14 Apr 2010 15:13:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76938 invoked by uid 99); 14 Apr 2010 15:13:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 15:13:58 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.195] (HELO mout.perfora.net) (74.208.4.195)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 15:13:50 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus1) with ESMTP (Nemesis)
	id 0LcilD-1Nak5K04u7-00jTnv; Wed, 14 Apr 2010 11:13:26 -0400
Message-ID: <F4D3213BF1544FA6B140B8C98FD5D1E2@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos> <4BC206C8.5070103@orcatec.com> <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com> <4BC3250D.90006@orcatec.com> <237EB97F513A43BDADA0264930A66511@Rissos> <y2p9ac0c6aa1004130246rfa3ea942h8b4515671e927d6c@mail.gmail.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
Date: Wed, 14 Apr 2010 08:13:27 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX18H767JHasyMM5a+g1r+VxPrwpcEQP4M+XUvLN
 wx4bgMCxgwVt7NzzUgalNYbnJmzDmOPEGsFEffeTKs+0EsfwJX
 aEkZ60dul/tD+BeQtou7A==
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks, Michael.

I have not had a chance to try your whittled example yet. Another problem 
captured my attention.

What I have done, is use a single reader over and over.  It does not seem to 
make any difference. I don't close it at all, now.  It sped up my process a 
bit (12 docs/second rather than 11, but most of that is network wait time, I 
think), but otherwise seems to have made no difference.  If I keep that, I 
will have to provide a method to close it eventually, but closing it does 
not make the heap give up its bloated representation of all the docs it's 
seen before.

I also took a look in more detail at the data that are stored.  They are the 
data from the documents whose vectors have been requested.  What I would 
like is to have just one document in the heap at a time and have it deleted 
when I am done with it.  Having them stick around is the problem. 
Everything else works fine.  I get no errors.  Is this a Lucene bug?

http://lucene.apache.org/pylucene/documentation/readme.html says that 
.cast_:

Downcasting is a common operation in Java but not a concept in Python. 
Because the wrapper objects implementing exactly the APIs of the declared 
type of the wrapped object, all classes implement two class methods called 
instance_ and cast_ that verify and cast an instance respectively.

I am not a Lucene or pyLucene expert.

I appreciate your help.  This is really an important barrier for me right 
now.

Thanks,
Herb

----- Original Message ----- 
From: "Michael McCandless" <lucene@mikemccandless.com>
To: <java-user@lucene.apache.org>
Sent: Tuesday, April 13, 2010 2:46 AM
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded


Can you whittle down your example even more?

EG don't read the term vectors for the first hit.  Just open a single
reader and do the TermQuery search over and over?

BTW what does this line in PyLucene do?:

   tfvP = lucene.TermFreqVector.cast_(tfv)

You never hit exceptions in this code right?  (Because this'd cause
your close to not be called -- really you should move the .close()
calls into a finally clause).

Mike

On Mon, Apr 12, 2010 at 10:54 AM, Herbert Roitblat <herb@orcatec.com> wrote:
> Update:
> reusing the reader and searcher made almost no difference. It still eats 
> up
> the heap.
> ----- Original Message ----- From: "Herbert L Roitblat" <herb@orcatec.com>
> To: <java-user@lucene.apache.org>
> Sent: Monday, April 12, 2010 6:50 AM
> Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
>
>
>> Thank you Michael. Your suggestions are helpful. I inherited all of
>> the code that uses pyLucene and don't consider myself an expert on it,
>> so I very much appreciate your suggestions.
>>
>> It does not seem to be the case that these elements represent the index
>> of the collection. TermInfo and Term grow as I retrieve more documents.
>> There was no trouble building the index.
>>
>> The contents of these fields are the tokens (some fields are tokenized,
>> others not) of the document fields. In the tokenized fields, there is
>> one object for each word. They seem to be in order of the documents for
>> which the term vectors are being sought. So these objects seem to
>> represent a "concatenation" of all of the documents being considered in
>> order, and if they are never removed, would always overwhelm the heap
>> with a large document set. They are not the index in the usual sense, I
>> think. Before I start retrieving documents, there is barely anything in
>> these objects.
>>
>> What is holding the document contents in the heap after the fields
>> information is returned?
>>
>> Can you say more about incRef/decRef? I deleted all variables that
>> interacted with Lucene and it seems to have made no difference
>>
>> There are not a lot of different fields, I would say on the order of 50
>> with about 20 of them in virtually every document.
>>
>> It uses:
>> lucene.IndexReader.open(self._store)
>>
>>
>> One suggestion I got is to put the reader code in the class init
>> function and then reuse it. I have not tried that one yet (next on the
>> agenda). You suggested something similar and I will try that.
>>
>> Thanks,
>> Herb
>>
>>
>> Michael McCandless wrote:
>>>
>>> The large count of TermInfo & Term is completely normal -- this is
>>> Lucene's term index, which is entirely RAM resident.
>>>
>>> In 3.1, with flexible indexing, the RAM efficiency of the terms index
>>> should be much improved.
>>>
>>> While opening a new reader/searcher for every query is horribly
>>> inefficient, it should not leak memory. (Are you using
>>> IndexReader.reopen? I see calls to getReader, but this Lucene API
>>> (near-real-time search) wasn't added until 2.9, and you're on 2.4, so
>>> I think that's your own method?).
>>>
>>> What do your get/getReader/getSearcher calls do? Are you using
>>> incRef/decRef at all to manage the lifetime of your readers? How many
>>> unique field names do you have, across all docs that you index?
>>>
>>> If you change your test to open a single reader, but run that
>>> TermQuery over and over and over again, do you still hit OOME?
>>>
>>> Mike
>>>
>>> On Sun, Apr 11, 2010 at 1:28 PM, Herbert L Roitblat <herb@orcatec.com>
>>> wrote:
>>>
>>>> Hi, Folks. Thanks, Ruben, for your help. It let me get a ways down the
>>>> road.
>>>>
>>>> The problem is the the heap is filling up when I am doing a
>>>> lucene.TermQuery. What I am trying to accomplish is to get the terms in
>>>> one
>>>> field of each document and their frequency in the document. A code
>>>> snippet
>>>> is attached below. It yields the results I want.
>>>>
>>>> I managed to get a small enough heap dump into jhat. Now I could use
>>>> some
>>>> help understanding what I have found and some help figuring out what to
>>>> do
>>>> about it. I am a noobi at understanding the details of Lucene,
>>>> pyLucene,
>>>> and Java debugging.
>>>>
>>>> If I understand correctly, the heap is filling up because it is keeping
>>>> instances of objects around after there is no longer any need for them.
>>>> I
>>>> thought that it might be the case that Python was somehow keeping them
>>>> around, but that does not seem to be the case (true?).
>>>>
>>>> From jhat, I got a class instance histogram:
>>>>
>>>> 290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990> 
>>>> of
>>>> class org.apache.lucene.index.TermInfo
>>>> <http://192.168.1.155:7000/class/0x7fbf693bb990>
>>>> 289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80> 
>>>> of
>>>> class org.apache.lucene.index.Term
>>>> <http://192.168.1.155:7000/class/0x7fbf69412d80>
>>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> of
>>>> class
>>>> org.apache.lucene.index.FieldInfo
>>>> <http://192.168.1.155:7000/class/0x7fbf693f1300>
>>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> of
>>>> class
>>>> org.apache.lucene.index.SegmentReader$Norm
>>>> <http://192.168.1.155:7000/class/0x7fbf6940a1a8>
>>>> 1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> of
>>>> class
>>>> org.apache.lucene.store.FSDirectory$FSIndexInput
>>>> <http://192.168.1.155:7000/class/0x7fbf6928d460>
>>>> 1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> of
>>>> class
>>>> org.apache.lucene.index.CompoundFileReader$CSIndexInput
>>>> <http://192.168.1.155:7000/class/0x7fbf693ef958>
>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of
>>>> class
>>>> org.apache.lucene.index.TermBuffer
>>>> <http://192.168.1.155:7000/class/0x7fbf69400510>
>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of
>>>> class
>>>> org.apache.lucene.util.UnicodeUtil$UTF16Result
>>>> <http://192.168.1.155:7000/class/0x7fbf694011c8>
>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of
>>>> class
>>>> org.apache.lucene.util.UnicodeUtil$UTF8Result
>>>> <http://192.168.1.155:7000/class/0x7fbf693bc168>
>>>> ...
>>>>
>>>> There are way too many instance of index.TermInfo and index.indexTerm.
>>>> So,
>>>> I tracked down some instances and looked for rootset references. There
>>>> were
>>>> none. If I understand correctly, this instance should be garbage
>>>> collected
>>>> if there are no rootset references. True?
>>>>
>>>> Here's an example from jhat:
>>>>
>>>> Rootset references to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218
>>>> (includes weak refs)
>>>>
>>>> References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40
>>>> bytes)
>>>> Other queries
>>>> Exclude weak refs
>>>> ---
>>>> There is at least one reference to the object, it is an element in an
>>>> array,
>>>> but the array does not have rootset references either.
>>>>
>>>> Am I misinterpreting these results? In any case, what can I do about
>>>> getting rid of these? Is it a bug in this version of Lucene? Is there
>>>> a
>>>> known fix? I think that I should be able to do an unlimited number of
>>>> queries without filling up the heap.
>>>> I am using pyLucene version 2.4.
>>>>
>>>> Thanks for your help.
>>>>
>>>> Herb
>>>>
>>>> -------------------------------
>>>> Code snippet:
>>>> reader = self.index.getReader()
>>>> lReader = reader.get()
>>>> searcher = self.index.getSearcher()
>>>> lSearcher = searcher.get()
>>>> query = lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD_ID, uid))
>>>> hits = list(lSearcher.search(query))
>>>> if hits:
>>>> hit = lucene.Hit.cast_(hits[0])
>>>> tfvs = lReader.getTermFreqVectors(hit.id)
>>>>
>>>> if tfvs is not None: # this happens if the vector is not stored
>>>> for tfv in tfvs: # There's one for each field that has a
>>>> TermFreqVector
>>>> tfvP = lucene.TermFreqVector.cast_(tfv)
>>>> if returnAllFields or tfvP.field in termFields: # add
>>>> only
>>>> asked fields
>>>> tFields[tfvP.field] = dict([(t,f) for (t,f) in
>>>> zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=minFreq])
>>>> else:
>>>> # This shouldn't happen, but we just log the error and march on
>>>> self.log.error("Unable to fetch doc %s from index"%(uid))
>>>> ## if self.opCount % 1000 == 0:
>>>> ## print lucene.JCCEnv._dumpRefs(classes=True).items()
>>>>
>>>> #http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/002171.html
>>>> ## self.opCount += 1
>>>>
>>>> lReader.close()
>>>> lSearcher.close()
>>>> retFields = copy.deepcopy(tFields) #return a copy of tFields to
>>>> free
>>>> up references to it and its contents
>>>>
>>>>
>>>>
>>>> Herbert Roitblat wrote:
>>>>
>>>>> Hi, folks.
>>>>> I am using PyLucene and doing a lot of get tokens. lucene.py reports
>>>>> version 2.4.0. It is rpath linux with 8GB of memory. Python is 2.4.
>>>>> I'm not sure what the maxheap is, I think that it is maxheap='2048m'. 
>>>>> I
>>>>> think that it's running in a 64 bit environment.
>>>>> It indexes a set of 116,000 documents just fine.
>>>>> Then I need to get the tokens from these documents and near the end, I
>>>>> run
>>>>> into:
>>>>>
>>>>> java.lang.OutOfMemoryError: GC overhead limit exceeded
>>>>>
>>>>> If I wait a bit and ask again for the same document's tokens, I can 
>>>>> get
>>>>> them, but it then is somewhat likely to post the same error on a
>>>>> certain
>>>>> number of other documents. I can handle these errors and ask again.
>>>>>
>>>>> I have read that this error message means that the heap is getting
>>>>> filled
>>>>> up and garbage collection removes only a small amount of it. Since all
>>>>> I am
>>>>> doing is retrieving, why should the heap be filling up? I restarted
>>>>> the
>>>>> system before starting the retrieval.
>>>>>
>>>>> My guess is that there is some small memory leak because memory
>>>>> assigned
>>>>> to my python program grows slowly as I request more document tokens.
>>>>> Since
>>>>> I'm not intending to change anything in either my python program or in
>>>>> Lucene, any growth is unintentional. I'm just getting tokens.
>>>>>
>>>>> we use lucene.TermQuery as the query object to get the terms.
>>>>>
>>>>> I cannot share the documents nor the application code, but I might be
>>>>> able
>>>>> to provide snippets.
>>>>>
>>>>> One last piece of information, the time needed to retrieve documents
>>>>> slows
>>>>> throughout the process. In the beginning I was getting about 10
>>>>> documents
>>>>> per second. Towards the end, it is down to about 5 with about 5 second
>>>>> pauses from time to time, perhaps due to garbage collection?
>>>>>
>>>>> Any idea of why the heap is filling up and what I can do about it?
>>>>>
>>>>> Thanks,
>>>>> Herb
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45792-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 16:10:55 2010
Return-Path: <java-user-return-45792-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59341 invoked from network); 14 Apr 2010 16:10:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 16:10:55 -0000
Received: (qmail 6959 invoked by uid 500); 14 Apr 2010 16:10:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6849 invoked by uid 500); 14 Apr 2010 16:10:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6832 invoked by uid 99); 14 Apr 2010 16:10:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 16:10:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of railan.xisto@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 16:10:44 +0000
Received: by bwz3 with SMTP id 3so309713bwz.11
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 09:10:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=9fHoxSzHmodRgLlWXTxVctbEO45zr2y0K/KLt+yu8t0=;
        b=noOFgSOvyEK3OHAWWgm4zvF6/RBUtAAAf2Pv82QjwJ7ijWoUWJP2lyOZeNQsZpKV6t
         0W/H1+hfWED1Li+xFzQd23NYMU9b+CT0IptbeUBAUBXsxVRjlgMl83RrnAHHTEAc/xtO
         XCfKqPdsUMeG141C/6OneTosI2hQeX6obfN/c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=XluFAmrmtRe91Oa78IxSp6dfDoqGfmxspyoZJspb2Fl2MJDL0oc0XIxUQpWyDesgiK
         bIaRMEWRkDWVMeOXDnO+kaCJaHiogErUYNlynHoUWAgVZqLae7xHbXL75I9LP6cAfU97
         XPVXZP9FABvM2ogVH3Xby+uBe/BEV/iFe5ZLs=
MIME-Version: 1.0
Received: by 10.204.15.1 with HTTP; Wed, 14 Apr 2010 09:10:22 -0700 (PDT)
In-Reply-To: <n2x786fde51004131234wdbf70b9cibe2f0f43a115e6c2@mail.gmail.com>
References: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
	 <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
	 <h2mcbcac69f1004120409g5c27063az40456793bb517a0b@mail.gmail.com>
	 <m2jcbcac69f1004121049z1aba8ac3s9279f351b438cff4@mail.gmail.com>
	 <n2x786fde51004131234wdbf70b9cibe2f0f43a115e6c2@mail.gmail.com>
Date: Wed, 14 Apr 2010 13:10:22 -0300
Received: by 10.204.74.98 with SMTP id t34mr8401945bkj.154.1271261422384; Wed, 
	14 Apr 2010 09:10:22 -0700 (PDT)
Message-ID: <y2icbcac69f1004140910x26c3339bl834db761bb257f62@mail.gmail.com>
Subject: Re: Removing terms in the Index
From: Railan Xisto <railan.xisto@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d77dac807ebd0484349d61
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d77dac807ebd0484349d61
Content-Type: text/plain; charset=ISO-8859-1

Actually the doc1 with the terms to be searched, has two words "Lucene in
Action" and "Lucene". I want when I pass "Lucene in Action", it shows the
result and remove the word not to be found when I pass only the term
"Lucene". In short, the term "Lucene" not find the phrase "Lucene in
Action", since the entire phrase was searched before. It is the idea of
N-Gram (complete sentences) and U-Gram (isolated words). Gave to understand?


2010/4/13 Shai Erera <serera@gmail.com>

> I ran your code. Since I don't have the queries file (Docs/documento.txt),
> I
> set this line instead:
>
> String termos = "\"Lucene in Action\"";
>
> When I set it to \"Lucene\", both documents are found. When I set it to
> \"Lucene in Action\" only the first document is found. Seems correct to me.
>
> Can you please explain this:
> "I pass the word "Lucene in Action", it find and
> remove that term of phrase in the Index"
>
> --> what do you mean "find and remove"?
>
> Shai
>
> On Mon, Apr 12, 2010 at 8:49 PM, Railan Xisto <railan.xisto@gmail.com
> >wrote:
>
> > And the main objective: when I pass the word "Lucene in Action", it find
> > and
> > remove that term of phrase in the Index, for when I pass the 2nd term
> > ("Lucene"), he does not find that phrase anymore, as has been found the
> > "Lucene in Action" .
> >
> >
> > 2010/4/12 Railan Xisto <railan.xisto@gmail.com>
> >
> > > Ok. There is a piece of code attached.. As I already said, I want to
> pass
> > > that when the term "Lucene in Action" he finds only the 1st sentence.
> > >
> > >
> > >
> > >
> > > 2010/4/10 Shai Erera <serera@gmail.com>
> > >
> > > Hi. I'm not sure I understand what you searched for. When you search
> > >> for "Lucene in action", do you search it with the quotes or not? If
> > >> with the quotes, then I don't understand how the 2nd dox is found.
> > >>
> > >> Do you perhaps have a test code you can share w/ us? It can be a short
> > >> and simple main which creates an index w/ some documents and then
> > >> searches them.
> > >>
> > >> Shai
> > >>
> > >> On Saturday, April 10, 2010, Fotos fotos <railan.xisto@gmail.com>
> > wrote:
> > >> > Hello!
> > >> > I am a beginner with Lucene. I'm needing to do the following:
> > >> >
> > >> > I have a text file with the following terms:
> > >> >
> > >> > "Lucene in action"
> > >> > "Lucene"
> > >> >
> > >> > and a file with the following sentences:
> > >> >
> > >> > 1 - "Lucene in action now."
> > >> > 2 - "Lucene for Dummies"
> > >> > 3 - "Managing Gigabytes"
> > >> >
> > >> > I need to search in phrases of doc2, the terms of doc1.
> > >> >
> > >> > But in search of the word n-grama: "Lucene in Action", he also finds
> > the
> > >> 2nd
> > >> > sentence.
> > >> >
> > >> > In this case, I want to meet with the term 1 ("Lucene in Action"),
> > only
> > >> the
> > >> > first phrase and remove the term of the index, for not to be found
> > when
> > >> I
> > >> > pass the term 2 ("Lucene")
> > >> >
> > >> > Railan Xisto
> > >> > Web Developer
> > >> >
> > >>
> > >>  ---------------------------------------------------------------------
> > >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > >> For additional commands, e-mail: java-user-help@lucene.apache.org
> > >>
> > >>
> > >
> >
>

--0016e6d77dac807ebd0484349d61--

From java-user-return-45793-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 17:28:54 2010
Return-Path: <java-user-return-45793-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 99887 invoked from network); 14 Apr 2010 17:28:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 17:28:54 -0000
Received: (qmail 26716 invoked by uid 500); 14 Apr 2010 17:28:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26653 invoked by uid 500); 14 Apr 2010 17:28:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26645 invoked by uid 99); 14 Apr 2010 17:28:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 17:28:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 14 Apr 2010 17:28:45 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id CBBEE1E679A; Wed, 14 Apr 2010 10:28:23 -0700 (MST)
Received: from PHX-HTPRD-01.adprod.bmc.com (phx-htprd-01.adprod.bmc.com [172.24.32.7])
	by flicker.bmc.com (Postfix) with ESMTP id C297B1E676B
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 10:28:23 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-01.adprod.bmc.com ([172.24.32.7]) with mapi; Wed, 14 Apr 2010
 11:28:23 -0600
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Wed, 14 Apr 2010 11:28:22 -0600
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrbuxEnhGkjOK+yTZCfxxipi/UOEAAO2Kyw
Message-ID: <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
 <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
In-Reply-To: <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

How do I get to the 2.9.x branch?  Every link I take from the Lucene site t=
akes me to the trunk which I assume is the 3.x version.  I've tried to look=
 around svn but can't find anything labeled 2.9.x.  Is there a daily build =
of 2.9.x or do I need to build it myself.  I would like to try out the fix =
you put into it, but I'm not sure where I get it from.

-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]=20
Sent: Wednesday, April 14, 2010 4:12 AM
To: java-user@lucene.apache.org
Subject: Re: IndexWriter and memory usage

It looks like the mailing list software stripped your image attachments...

Alas these fixes are only committed on 3.1.

But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
fix.  I think the other issue was part of LUCENE-2074 (though this
issue included many other changes) -- Uwe can you peel out just a
2.9.x patch for resetting JFlex's zzBuffer?

You could also try switching analyzers (eg to WhitespaceAnalyzer) to
see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
uses JFlex) is [part of] your problem.

Mike

On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> Since the heap dump was so big and can't be attached, I have taken a few =
screen shots from Java VisualVM of the heap dump. =A0In the first image you=
 can see that at the time our memory has become very tight most of it is he=
ld up in bytes. =A0In the second image I examine one of those instances and=
 navigate to the nearest garbage collection root. =A0In looking at very man=
y of these objects, they all end up being instantiated through the IndexWri=
ter process.
>
> This heap dump is the same one correlating to the infoStream that was att=
ached in a prior message. =A0So while the infoStream shows the buffer being=
 flushed, what we experience is that our memory gets consumed over time by =
these bytes in the IndexWriter.
>
> I wanted to provide these images to see if they might correlate to the fi=
xes mentioned below. =A0Hopefully those fixes mentioned below have rectifie=
d this problem. =A0And as I state in the prior message, I'm hoping these fi=
xes are in a 2.9x branch and hoping for someone to point me to where I can =
get those fixes to try out.
>
> Thanks
>
> -----Original Message-----
> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
> Sent: Tuesday, April 13, 2010 1:29 PM
> To: java-user@lucene.apache.org
> Subject: RE: IndexWriter and memory usage
>
> Are these fixes in 2.9x branch? =A0We are using 2.9x and can't move to 3x=
 just yet. =A0If so, where do I specifically pick this up from?
>
> -----Original Message-----
> From: Lance Norskog [mailto:goksron@gmail.com]
> Sent: Monday, April 12, 2010 10:20 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> There is some bugs where the writer data structures retain data after
> it is flushed. They are committed as of maybe the past week. If you
> can pull the trunk and try it with your use case, that would be great.
>
> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> I was on vacation last week so just getting back to this... =A0Here is t=
he info stream (as an attachment). =A0I'll see what I can do about reducing=
 the heap dump (It was supplied by a colleague).
>>
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Saturday, April 03, 2010 3:39 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> Hmm why is the heap dump so immense? =A0Normally it contains the top N
>> (eg 100) object types and their count/aggregate RAM usage.
>>
>> Can you attach the infoStream output to an email (to java-user)?
>>
>> Mike
>>
>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> I have this and the heap dump is 63mb zipped. =A0The info stream is muc=
h smaller (31 kb zipped), but I don't know how to get them to you.
>>>
>>> We are not using the NRT readers
>>>
>>> -----Original Message-----
>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>> Sent: Thursday, April 01, 2010 5:21 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>
>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, it
>>> does allocate and then recycle this RAM buffer, so even in an idle
>>> state (having indexed enough docs to fill up the RAM buffer at least
>>> once) it'll hold onto those 16 MB.
>>>
>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>> really sure you're eventually closing the previous reader after
>>> opening a new one?
>>>
>>> Mike
>>>
>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>>> We are seeing a situation where the IndexWriter is using up the Java H=
eap space and only releases memory for garbage collection upon a commit. =
=A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene=
 2.9.1. We are set at heap size of 512 mb.
>>>>
>>>> We have a large number of documents that are run through Tika and then=
 added to the index. =A0The data from Tika is changed to a string, and then=
 sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes =
and not in Tika. =A0Our intent is to only perform a commit once the entire =
indexing run is complete, but several hours into the process everything com=
es to a crawl. =A0In using both JConsole and VisualVM =A0we can see that th=
e heap space is maxed out and garbage collection is not able to clean up an=
y memory once we get into this state. =A0It is our understanding that the I=
ndexWriter should be only holding onto 16 mb of data before it flushes it, =
but what we are seeing is that while it is in fact writing data to disk whe=
n it hits the 16 mb limit, it is also holding onto some data in memory and =
not allowing garbage collection to take place, and this continues until gar=
bage collection is unable to free up enough space to all things to move fas=
ter than a crawl.
>>>>
>>>> As a test we caused a commit to occur after each document is indexed a=
nd we see the total amount of memory reduced from nearly 100% of the Java H=
eap to around 70-75%. =A0The profiling tools now show that the memory is cl=
eaned up to some extent after each document. =A0But of course this complete=
ly defeats the whole reason why we want to only commit at the end of the ru=
n for performance sake. =A0Most of the data, as seen using Heap analasis, i=
s held in Byte, Character, and Integer classes whos GC roots are tied back =
to the Writer Objects and threads. =A0The instance counts, after running ju=
st 1,100 documents seems staggering
>>>>
>>>> Is there additional data that the IndexWriter hangs onto regardless of=
 when it hits the RAMBufferSize limit? =A0Why are we seeing the heap space =
all being used up?
>>>>
>>>> A side question to this is the fact that we always see a large amount =
of memory used by the IndexWriter even after our indexing has been complete=
d and all commits have taken place (basically in an idle state). =A0Why wou=
ld this be? =A0Is the only way to totally clean up the memory is to close t=
he writer? =A0Our index is also used for real time indexing so the IndexWri=
ter is intended to remain open for the lifetime of the app.
>>>>
>>>> Any help in understanding why the IndexWriter is maxing out our heap s=
pace or what is expected from memory usage of the IndexWriter would be appr=
eciated.
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>
>
> --
> Lance Norskog
> goksron@gmail.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45794-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 18:13:23 2010
Return-Path: <java-user-return-45794-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33229 invoked from network); 14 Apr 2010 18:13:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 18:13:22 -0000
Received: (qmail 9535 invoked by uid 500); 14 Apr 2010 18:13:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9387 invoked by uid 500); 14 Apr 2010 18:13:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9379 invoked by uid 99); 14 Apr 2010 18:13:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 18:13:20 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of tpoljak@gmail.com designates 72.14.220.153 as permitted sender)
Received: from [72.14.220.153] (HELO fg-out-1718.google.com) (72.14.220.153)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 18:13:13 +0000
Received: by fg-out-1718.google.com with SMTP id 22so145958fge.5
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 11:12:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:subject:from:to:content-type
         :date:message-id:mime-version:x-mailer:content-transfer-encoding;
        bh=NGNCjyjLuGwVFqH5SXVSZ9CV0weTRXpRmmGsVEVV22U=;
        b=iyeMucLg8rbRLcRpZIpZ6q+dMK+/Bf27vQw0a45pbdZAqHk5IxEHUenOIkAUsgT+Wl
         aMe9lzOOYKiQCxsaQ2cOrm9BBuCtFEqVQ3xDoLO+WgRW/m/Gt1I2ctRjsm98zH7cnW70
         IzKLaddQT6GIiRx2NzMOojJkLkmjW7PpRS1vo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=subject:from:to:content-type:date:message-id:mime-version:x-mailer
         :content-transfer-encoding;
        b=kZtxrNTwhez/EZYsVRSEKBRAimYl2nA/UWDVjhrnuF9j3/3nGAsn7ReXfcmI26zcrO
         dtycJvUpkxi/a2SLhbeOYpOq7m6ukjSRAD3KCtYrt/YgCxsu8FW3r/pBIJxmklTL4V/d
         G10/Wc8KlZfxuGh898WFgKebkMhQ4QPYhz6hM=
Received: by 10.87.62.17 with SMTP id p17mr6131343fgk.30.1271268771881;
        Wed, 14 Apr 2010 11:12:51 -0700 (PDT)
Received: from [192.168.1.223] (89-172-46-104.adsl.net.t-com.hr [89.172.46.104])
        by mx.google.com with ESMTPS id 18sm1171117fkq.4.2010.04.14.11.12.49
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 14 Apr 2010 11:12:50 -0700 (PDT)
Subject: NumericField indexing performance
From: Tomislav Poljak <tpoljak@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain
Date: Wed, 14 Apr 2010 20:12:47 +0200
Message-Id: <1271268767.3543.64.camel@tpoljak-laptop>
Mime-Version: 1.0
X-Mailer: Evolution 2.26.1 
Content-Transfer-Encoding: 7bit

Hi,
is it normal for indexing time to increase up to 10 times after
introducing NumericField instead of Field (for two fields)? 

I've changed two date fields from String representation (Field) to
NumericField, now it is:

doc.add(new NumericField("time").setIntValue(date.getTime()/24/3600))

and after this change indexing took 10x more time (before it was few
minutes and after more than an hour and half). I've tested with a simple
counter like this:

doc.add(new NumericField("endTime").setIntValue(count++))

but nothing changed, it still takes around 10x longer. If I comment
adding one numeric field to index time drops significantly and if I
comment both fields indexing takes only few minutes again.

Tomislav


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45795-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 19:16:03 2010
Return-Path: <java-user-return-45795-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85552 invoked from network); 14 Apr 2010 19:16:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 19:16:02 -0000
Received: (qmail 99390 invoked by uid 500); 14 Apr 2010 19:16:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99344 invoked by uid 500); 14 Apr 2010 19:16:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99336 invoked by uid 99); 14 Apr 2010 19:16:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 19:16:00 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of kristjan.siimson@gmail.com designates 74.125.83.176 as permitted sender)
Received: from [74.125.83.176] (HELO mail-pv0-f176.google.com) (74.125.83.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 19:15:54 +0000
Received: by pvg7 with SMTP id 7so319846pvg.35
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 12:15:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=0YKcik0UWS/qAuMHvs/xQP0I0k8k0w2GHhK0Y+PPKWI=;
        b=sFEXOTHm0rgdw8Is20lArPTE/UHnuY/xr2VVFlC2KvjYWTHaaCKnAuJrsgLr22kKOr
         4l001O6tT9XxSCs/HWYxnRCDusnWRmoyhwIrbgszjG08slltTvX3TGSvzXmuOgvK7Lph
         mBH7kKKmZH1+MABiTgVZmIBPqnyv6WhmnQ504=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=XtjnqECam0JEFChproRv92ka3hFdD/slj3mEf1QHJ1bx0W+/sYqQ7tNR2KB0tkpTHZ
         c07kZQQAMUl++/u+2clHwEnKPEgaJ2KYhDgtQXLB+7lg3POdZw7UkQ/pGWWLNf5/Rqn5
         s70W1466kLVuwFpT4wEo7kWG56PFj8zgdboYs=
MIME-Version: 1.0
Received: by 10.141.15.15 with HTTP; Wed, 14 Apr 2010 12:15:33 -0700 (PDT)
Date: Wed, 14 Apr 2010 12:15:33 -0700
Received: by 10.141.88.12 with SMTP id q12mr7624242rvl.188.1271272534043; Wed, 
	14 Apr 2010 12:15:34 -0700 (PDT)
Message-ID: <l2hebded34f1004141215qe3fd1dc8o7689989ee70c05e2@mail.gmail.com>
Subject: Indexing lists of IDs
From: Kristjan Siimson <kristjan.siimson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd13be0cdebd00484373354

--000e0cd13be0cdebd00484373354
Content-Type: text/plain; charset=ISO-8859-1

Hello,

I have document for which I'd like to index an array of indexes. For
example, there is a product that belongs to categories with IDs 12, 15, 16,
145, 148. I'd like to index these categories, and then be able to use them
in queries, so that I can search for product which's name is "Bottle" and
which belongs to category 12.

I came up with creating a field in which I store the ID numbers and separate
them with spaces. However, when I tried to create a term query, the query
never gave any results. Can anybody help me with this?

Sincerely,
Kristjan Siimson

--000e0cd13be0cdebd00484373354--

From java-user-return-45796-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 19:21:42 2010
Return-Path: <java-user-return-45796-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88439 invoked from network); 14 Apr 2010 19:21:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 19:21:42 -0000
Received: (qmail 8519 invoked by uid 500); 14 Apr 2010 19:21:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8496 invoked by uid 500); 14 Apr 2010 19:21:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8488 invoked by uid 99); 14 Apr 2010 19:21:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 19:21:40 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rene.a.hackl@gmx.de designates 213.165.64.20 as permitted sender)
Received: from [213.165.64.20] (HELO mail.gmx.net) (213.165.64.20)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 14 Apr 2010 19:21:33 +0000
Received: (qmail invoked by alias); 14 Apr 2010 19:21:09 -0000
Received: from p5DCD3FA4.dip.t-dialin.net (EHLO [192.168.178.45]) [93.205.63.164]
  by mail.gmx.net (mp071) with SMTP; 14 Apr 2010 21:21:09 +0200
X-Authenticated: #24166002
X-Provags-ID: V01U2FsdGVkX1+HK9YIiKGHw2MNs6l5p6DIwcAHj4jjEecf6lxCs6
	INw5Eeq31Dq1a/
Message-ID: <4BC61598.4070302@gmx.de>
Date: Wed, 14 Apr 2010 21:20:56 +0200
From: Rene Hackl-Sommer <rene.a.hackl@gmx.de>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1.9) Gecko/20100317 Thunderbird/3.0.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Indexing lists of IDs
References: <l2hebded34f1004141215qe3fd1dc8o7689989ee70c05e2@mail.gmail.com>
In-Reply-To: <l2hebded34f1004141215qe3fd1dc8o7689989ee70c05e2@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Y-GMX-Trusted: 0
X-FuHaFi: 0.59999999999999998

Hi Kristjan,

which Tokenizer and Filters are you using for the ID field?

Rene

Am 14.04.2010 21:15, schrieb Kristjan Siimson:
> Hello,
>
> I have document for which I'd like to index an array of indexes. For
> example, there is a product that belongs to categories with IDs 12, 15, 16,
> 145, 148. I'd like to index these categories, and then be able to use them
> in queries, so that I can search for product which's name is "Bottle" and
> which belongs to category 12.
>
> I came up with creating a field in which I store the ID numbers and separate
> them with spaces. However, when I tried to create a term query, the query
> never gave any results. Can anybody help me with this?
>
> Sincerely,
> Kristjan Siimson
>
>    


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45797-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 20:50:38 2010
Return-Path: <java-user-return-45797-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93838 invoked from network); 14 Apr 2010 20:50:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 20:50:38 -0000
Received: (qmail 39500 invoked by uid 500); 14 Apr 2010 20:50:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39469 invoked by uid 500); 14 Apr 2010 20:50:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39461 invoked by uid 99); 14 Apr 2010 20:50:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 20:50:36 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=AWL,NORMAL_HTTP_TO_IP,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,WEIRD_PORT
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 20:50:32 +0000
Received: by gwaa12 with SMTP id a12so251382gwa.35
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 13:50:10 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Wed, 14 Apr 2010 13:50:09 -0700 (PDT)
In-Reply-To: <F4D3213BF1544FA6B140B8C98FD5D1E2@Rissos>
References: <4BCE762DA7EC4176BE95C71F9DB8DF55@Rissos>
	 <4BC206C8.5070103@orcatec.com>
	 <r2j9ac0c6aa1004120348y70eb8b0tfda2be1f05725f0d@mail.gmail.com>
	 <4BC3250D.90006@orcatec.com> <237EB97F513A43BDADA0264930A66511@Rissos>
	 <y2p9ac0c6aa1004130246rfa3ea942h8b4515671e927d6c@mail.gmail.com>
	 <F4D3213BF1544FA6B140B8C98FD5D1E2@Rissos>
Date: Wed, 14 Apr 2010 16:50:09 -0400
Received: by 10.150.175.12 with SMTP id x12mr7613506ybe.195.1271278210091; 
	Wed, 14 Apr 2010 13:50:10 -0700 (PDT)
Message-ID: <o2v9ac0c6aa1004141350lfedeeabfi2267c151bc29af47@mail.gmail.com>
Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

>From your PyLucene thread it looks like this may be a known mem leak
in PyLucene 2.4 (fixed in 2.9)?

Mike

On Wed, Apr 14, 2010 at 11:13 AM, Herbert Roitblat <herb@orcatec.com> wrote=
:
> Thanks, Michael.
>
> I have not had a chance to try your whittled example yet. Another problem
> captured my attention.
>
> What I have done, is use a single reader over and over. =A0It does not se=
em to
> make any difference. I don't close it at all, now. =A0It sped up my proce=
ss a
> bit (12 docs/second rather than 11, but most of that is network wait time=
, I
> think), but otherwise seems to have made no difference. =A0If I keep that=
, I
> will have to provide a method to close it eventually, but closing it does
> not make the heap give up its bloated representation of all the docs it's
> seen before.
>
> I also took a look in more detail at the data that are stored. =A0They ar=
e the
> data from the documents whose vectors have been requested. =A0What I woul=
d
> like is to have just one document in the heap at a time and have it delet=
ed
> when I am done with it. =A0Having them stick around is the problem. Every=
thing
> else works fine. =A0I get no errors. =A0Is this a Lucene bug?
>
> http://lucene.apache.org/pylucene/documentation/readme.html says that
> .cast_:
>
> Downcasting is a common operation in Java but not a concept in Python.
> Because the wrapper objects implementing exactly the APIs of the declared
> type of the wrapped object, all classes implement two class methods calle=
d
> instance_ and cast_ that verify and cast an instance respectively.
>
> I am not a Lucene or pyLucene expert.
>
> I appreciate your help. =A0This is really an important barrier for me rig=
ht
> now.
>
> Thanks,
> Herb
>
> ----- Original Message ----- From: "Michael McCandless"
> <lucene@mikemccandless.com>
> To: <java-user@lucene.apache.org>
> Sent: Tuesday, April 13, 2010 2:46 AM
> Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
>
>
> Can you whittle down your example even more?
>
> EG don't read the term vectors for the first hit. =A0Just open a single
> reader and do the TermQuery search over and over?
>
> BTW what does this line in PyLucene do?:
>
> =A0tfvP =3D lucene.TermFreqVector.cast_(tfv)
>
> You never hit exceptions in this code right? =A0(Because this'd cause
> your close to not be called -- really you should move the .close()
> calls into a finally clause).
>
> Mike
>
> On Mon, Apr 12, 2010 at 10:54 AM, Herbert Roitblat <herb@orcatec.com> wro=
te:
>>
>> Update:
>> reusing the reader and searcher made almost no difference. It still eats
>> up
>> the heap.
>> ----- Original Message ----- From: "Herbert L Roitblat" <herb@orcatec.co=
m>
>> To: <java-user@lucene.apache.org>
>> Sent: Monday, April 12, 2010 6:50 AM
>> Subject: Re: java.lang.OutOfMemoryError: GC overhead limit exceeded
>>
>>
>>> Thank you Michael. Your suggestions are helpful. I inherited all of
>>> the code that uses pyLucene and don't consider myself an expert on it,
>>> so I very much appreciate your suggestions.
>>>
>>> It does not seem to be the case that these elements represent the index
>>> of the collection. TermInfo and Term grow as I retrieve more documents.
>>> There was no trouble building the index.
>>>
>>> The contents of these fields are the tokens (some fields are tokenized,
>>> others not) of the document fields. In the tokenized fields, there is
>>> one object for each word. They seem to be in order of the documents for
>>> which the term vectors are being sought. So these objects seem to
>>> represent a "concatenation" of all of the documents being considered in
>>> order, and if they are never removed, would always overwhelm the heap
>>> with a large document set. They are not the index in the usual sense, I
>>> think. Before I start retrieving documents, there is barely anything in
>>> these objects.
>>>
>>> What is holding the document contents in the heap after the fields
>>> information is returned?
>>>
>>> Can you say more about incRef/decRef? I deleted all variables that
>>> interacted with Lucene and it seems to have made no difference
>>>
>>> There are not a lot of different fields, I would say on the order of 50
>>> with about 20 of them in virtually every document.
>>>
>>> It uses:
>>> lucene.IndexReader.open(self._store)
>>>
>>>
>>> One suggestion I got is to put the reader code in the class init
>>> function and then reuse it. I have not tried that one yet (next on the
>>> agenda). You suggested something similar and I will try that.
>>>
>>> Thanks,
>>> Herb
>>>
>>>
>>> Michael McCandless wrote:
>>>>
>>>> The large count of TermInfo & Term is completely normal -- this is
>>>> Lucene's term index, which is entirely RAM resident.
>>>>
>>>> In 3.1, with flexible indexing, the RAM efficiency of the terms index
>>>> should be much improved.
>>>>
>>>> While opening a new reader/searcher for every query is horribly
>>>> inefficient, it should not leak memory. (Are you using
>>>> IndexReader.reopen? I see calls to getReader, but this Lucene API
>>>> (near-real-time search) wasn't added until 2.9, and you're on 2.4, so
>>>> I think that's your own method?).
>>>>
>>>> What do your get/getReader/getSearcher calls do? Are you using
>>>> incRef/decRef at all to manage the lifetime of your readers? How many
>>>> unique field names do you have, across all docs that you index?
>>>>
>>>> If you change your test to open a single reader, but run that
>>>> TermQuery over and over and over again, do you still hit OOME?
>>>>
>>>> Mike
>>>>
>>>> On Sun, Apr 11, 2010 at 1:28 PM, Herbert L Roitblat <herb@orcatec.com>
>>>> wrote:
>>>>
>>>>> Hi, Folks. Thanks, Ruben, for your help. It let me get a ways down th=
e
>>>>> road.
>>>>>
>>>>> The problem is the the heap is filling up when I am doing a
>>>>> lucene.TermQuery. What I am trying to accomplish is to get the terms =
in
>>>>> one
>>>>> field of each document and their frequency in the document. A code
>>>>> snippet
>>>>> is attached below. It yields the results I want.
>>>>>
>>>>> I managed to get a small enough heap dump into jhat. Now I could use
>>>>> some
>>>>> help understanding what I have found and some help figuring out what =
to
>>>>> do
>>>>> about it. I am a noobi at understanding the details of Lucene,
>>>>> pyLucene,
>>>>> and Java debugging.
>>>>>
>>>>> If I understand correctly, the heap is filling up because it is keepi=
ng
>>>>> instances of objects around after there is no longer any need for the=
m.
>>>>> I
>>>>> thought that it might be the case that Python was somehow keeping the=
m
>>>>> around, but that does not seem to be the case (true?).
>>>>>
>>>>> From jhat, I got a class instance histogram:
>>>>>
>>>>> 290163 instances <http://192.168.1.155:7000/instances/0x7fbf693bb990>
>>>>> of
>>>>> class org.apache.lucene.index.TermInfo
>>>>> <http://192.168.1.155:7000/class/0x7fbf693bb990>
>>>>> 289988 instances <http://192.168.1.155:7000/instances/0x7fbf69412d80>
>>>>> of
>>>>> class org.apache.lucene.index.Term
>>>>> <http://192.168.1.155:7000/class/0x7fbf69412d80>
>>>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf693f1300> o=
f
>>>>> class
>>>>> org.apache.lucene.index.FieldInfo
>>>>> <http://192.168.1.155:7000/class/0x7fbf693f1300>
>>>>> 1976 instances <http://192.168.1.155:7000/instances/0x7fbf6940a1a8> o=
f
>>>>> class
>>>>> org.apache.lucene.index.SegmentReader$Norm
>>>>> <http://192.168.1.155:7000/class/0x7fbf6940a1a8>
>>>>> 1081 instances <http://192.168.1.155:7000/instances/0x7fbf6928d460> o=
f
>>>>> class
>>>>> org.apache.lucene.store.FSDirectory$FSIndexInput
>>>>> <http://192.168.1.155:7000/class/0x7fbf6928d460>
>>>>> 1048 instances <http://192.168.1.155:7000/instances/0x7fbf693ef958> o=
f
>>>>> class
>>>>> org.apache.lucene.index.CompoundFileReader$CSIndexInput
>>>>> <http://192.168.1.155:7000/class/0x7fbf693ef958>
>>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf69400510> of
>>>>> class
>>>>> org.apache.lucene.index.TermBuffer
>>>>> <http://192.168.1.155:7000/class/0x7fbf69400510>
>>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf694011c8> of
>>>>> class
>>>>> org.apache.lucene.util.UnicodeUtil$UTF16Result
>>>>> <http://192.168.1.155:7000/class/0x7fbf694011c8>
>>>>> 540 instances <http://192.168.1.155:7000/instances/0x7fbf693bc168> of
>>>>> class
>>>>> org.apache.lucene.util.UnicodeUtil$UTF8Result
>>>>> <http://192.168.1.155:7000/class/0x7fbf693bc168>
>>>>> ...
>>>>>
>>>>> There are way too many instance of index.TermInfo and index.indexTerm=
.
>>>>> So,
>>>>> I tracked down some instances and looked for rootset references. Ther=
e
>>>>> were
>>>>> none. If I understand correctly, this instance should be garbage
>>>>> collected
>>>>> if there are no rootset references. True?
>>>>>
>>>>> Here's an example from jhat:
>>>>>
>>>>> Rootset references to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218
>>>>> (includes weak refs)
>>>>>
>>>>> References to org.apache.lucene.index.TermInfo@0x7fbf6e3f8218 (40
>>>>> bytes)
>>>>> Other queries
>>>>> Exclude weak refs
>>>>> ---
>>>>> There is at least one reference to the object, it is an element in an
>>>>> array,
>>>>> but the array does not have rootset references either.
>>>>>
>>>>> Am I misinterpreting these results? In any case, what can I do about
>>>>> getting rid of these? Is it a bug in this version of Lucene? Is there
>>>>> a
>>>>> known fix? I think that I should be able to do an unlimited number of
>>>>> queries without filling up the heap.
>>>>> I am using pyLucene version 2.4.
>>>>>
>>>>> Thanks for your help.
>>>>>
>>>>> Herb
>>>>>
>>>>> -------------------------------
>>>>> Code snippet:
>>>>> reader =3D self.index.getReader()
>>>>> lReader =3D reader.get()
>>>>> searcher =3D self.index.getSearcher()
>>>>> lSearcher =3D searcher.get()
>>>>> query =3D lucene.TermQuery(lucene.Term(OTDocument.UID_FIELD_ID, uid))
>>>>> hits =3D list(lSearcher.search(query))
>>>>> if hits:
>>>>> hit =3D lucene.Hit.cast_(hits[0])
>>>>> tfvs =3D lReader.getTermFreqVectors(hit.id)
>>>>>
>>>>> if tfvs is not None: # this happens if the vector is not stored
>>>>> for tfv in tfvs: # There's one for each field that has a
>>>>> TermFreqVector
>>>>> tfvP =3D lucene.TermFreqVector.cast_(tfv)
>>>>> if returnAllFields or tfvP.field in termFields: # add
>>>>> only
>>>>> asked fields
>>>>> tFields[tfvP.field] =3D dict([(t,f) for (t,f) in
>>>>> zip(tfvP.getTerms(),tfvP.getTermFrequencies()) if f >=3DminFreq])
>>>>> else:
>>>>> # This shouldn't happen, but we just log the error and march on
>>>>> self.log.error("Unable to fetch doc %s from index"%(uid))
>>>>> ## if self.opCount % 1000 =3D=3D 0:
>>>>> ## print lucene.JCCEnv._dumpRefs(classes=3DTrue).items()
>>>>>
>>>>>
>>>>> #http://lists.osafoundation.org/pipermail/pylucene-dev/2008-January/0=
02171.html
>>>>> ## self.opCount +=3D 1
>>>>>
>>>>> lReader.close()
>>>>> lSearcher.close()
>>>>> retFields =3D copy.deepcopy(tFields) #return a copy of tFields to
>>>>> free
>>>>> up references to it and its contents
>>>>>
>>>>>
>>>>>
>>>>> Herbert Roitblat wrote:
>>>>>
>>>>>> Hi, folks.
>>>>>> I am using PyLucene and doing a lot of get tokens. lucene.py reports
>>>>>> version 2.4.0. It is rpath linux with 8GB of memory. Python is 2.4.
>>>>>> I'm not sure what the maxheap is, I think that it is maxheap=3D'2048=
m'.
>>>>>> I
>>>>>> think that it's running in a 64 bit environment.
>>>>>> It indexes a set of 116,000 documents just fine.
>>>>>> Then I need to get the tokens from these documents and near the end,=
 I
>>>>>> run
>>>>>> into:
>>>>>>
>>>>>> java.lang.OutOfMemoryError: GC overhead limit exceeded
>>>>>>
>>>>>> If I wait a bit and ask again for the same document's tokens, I can
>>>>>> get
>>>>>> them, but it then is somewhat likely to post the same error on a
>>>>>> certain
>>>>>> number of other documents. I can handle these errors and ask again.
>>>>>>
>>>>>> I have read that this error message means that the heap is getting
>>>>>> filled
>>>>>> up and garbage collection removes only a small amount of it. Since a=
ll
>>>>>> I am
>>>>>> doing is retrieving, why should the heap be filling up? I restarted
>>>>>> the
>>>>>> system before starting the retrieval.
>>>>>>
>>>>>> My guess is that there is some small memory leak because memory
>>>>>> assigned
>>>>>> to my python program grows slowly as I request more document tokens.
>>>>>> Since
>>>>>> I'm not intending to change anything in either my python program or =
in
>>>>>> Lucene, any growth is unintentional. I'm just getting tokens.
>>>>>>
>>>>>> we use lucene.TermQuery as the query object to get the terms.
>>>>>>
>>>>>> I cannot share the documents nor the application code, but I might b=
e
>>>>>> able
>>>>>> to provide snippets.
>>>>>>
>>>>>> One last piece of information, the time needed to retrieve documents
>>>>>> slows
>>>>>> throughout the process. In the beginning I was getting about 10
>>>>>> documents
>>>>>> per second. Towards the end, it is down to about 5 with about 5 seco=
nd
>>>>>> pauses from time to time, perhaps due to garbage collection?
>>>>>>
>>>>>> Any idea of why the heap is filling up and what I can do about it?
>>>>>>
>>>>>> Thanks,
>>>>>> Herb
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45798-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 20:52:49 2010
Return-Path: <java-user-return-45798-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95280 invoked from network); 14 Apr 2010 20:52:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 20:52:49 -0000
Received: (qmail 43691 invoked by uid 500); 14 Apr 2010 20:52:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43655 invoked by uid 500); 14 Apr 2010 20:52:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43647 invoked by uid 99); 14 Apr 2010 20:52:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 20:52:47 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.221] (HELO mail-gx0-f221.google.com) (209.85.217.221)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 20:52:40 +0000
Received: by gxk21 with SMTP id 21so73413gxk.5
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 13:52:19 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Wed, 14 Apr 2010 13:52:19 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
	 <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
Date: Wed, 14 Apr 2010 16:52:19 -0400
Received: by 10.150.184.3 with SMTP id h3mr6987041ybf.265.1271278339598; Wed, 
	14 Apr 2010 13:52:19 -0700 (PDT)
Message-ID: <n2w9ac0c6aa1004141352s5edb3082o2f1952626c551450@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Run this:

    svn co https://svn.apache.org/repos/asf/lucene/java/branches/lucene_2_9
lucene.29x

Then apply the patch, then, run "ant jar-core", and in that should
create the lucene-core-2.9.2-dev.jar.

Mike

On Wed, Apr 14, 2010 at 1:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> How do I get to the 2.9.x branch? =A0Every link I take from the Lucene si=
te takes me to the trunk which I assume is the 3.x version. =A0I've tried t=
o look around svn but can't find anything labeled 2.9.x. =A0Is there a dail=
y build of 2.9.x or do I need to build it myself. =A0I would like to try ou=
t the fix you put into it, but I'm not sure where I get it from.
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Wednesday, April 14, 2010 4:12 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> It looks like the mailing list software stripped your image attachments..=
.
>
> Alas these fixes are only committed on 3.1.
>
> But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
> fix. =A0I think the other issue was part of LUCENE-2074 (though this
> issue included many other changes) -- Uwe can you peel out just a
> 2.9.x patch for resetting JFlex's zzBuffer?
>
> You could also try switching analyzers (eg to WhitespaceAnalyzer) to
> see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
> uses JFlex) is [part of] your problem.
>
> Mike
>
> On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> Since the heap dump was so big and can't be attached, I have taken a few=
 screen shots from Java VisualVM of the heap dump. =A0In the first image yo=
u can see that at the time our memory has become very tight most of it is h=
eld up in bytes. =A0In the second image I examine one of those instances an=
d navigate to the nearest garbage collection root. =A0In looking at very ma=
ny of these objects, they all end up being instantiated through the IndexWr=
iter process.
>>
>> This heap dump is the same one correlating to the infoStream that was at=
tached in a prior message. =A0So while the infoStream shows the buffer bein=
g flushed, what we experience is that our memory gets consumed over time by=
 these bytes in the IndexWriter.
>>
>> I wanted to provide these images to see if they might correlate to the f=
ixes mentioned below. =A0Hopefully those fixes mentioned below have rectifi=
ed this problem. =A0And as I state in the prior message, I'm hoping these f=
ixes are in a 2.9x branch and hoping for someone to point me to where I can=
 get those fixes to try out.
>>
>> Thanks
>>
>> -----Original Message-----
>> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
>> Sent: Tuesday, April 13, 2010 1:29 PM
>> To: java-user@lucene.apache.org
>> Subject: RE: IndexWriter and memory usage
>>
>> Are these fixes in 2.9x branch? =A0We are using 2.9x and can't move to 3=
x just yet. =A0If so, where do I specifically pick this up from?
>>
>> -----Original Message-----
>> From: Lance Norskog [mailto:goksron@gmail.com]
>> Sent: Monday, April 12, 2010 10:20 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> There is some bugs where the writer data structures retain data after
>> it is flushed. They are committed as of maybe the past week. If you
>> can pull the trunk and try it with your use case, that would be great.
>>
>> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> I was on vacation last week so just getting back to this... =A0Here is =
the info stream (as an attachment). =A0I'll see what I can do about reducin=
g the heap dump (It was supplied by a colleague).
>>>
>>>
>>> -----Original Message-----
>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>> Sent: Saturday, April 03, 2010 3:39 AM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> Hmm why is the heap dump so immense? =A0Normally it contains the top N
>>> (eg 100) object types and their count/aggregate RAM usage.
>>>
>>> Can you attach the infoStream output to an email (to java-user)?
>>>
>>> Mike
>>>
>>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>>> I have this and the heap dump is 63mb zipped. =A0The info stream is mu=
ch smaller (31 kb zipped), but I don't know how to get them to you.
>>>>
>>>> We are not using the NRT readers
>>>>
>>>> -----Original Message-----
>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>> Sent: Thursday, April 01, 2010 5:21 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Re: IndexWriter and memory usage
>>>>
>>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>>
>>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, i=
t
>>>> does allocate and then recycle this RAM buffer, so even in an idle
>>>> state (having indexed enough docs to fill up the RAM buffer at least
>>>> once) it'll hold onto those 16 MB.
>>>>
>>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>>> really sure you're eventually closing the previous reader after
>>>> opening a new one?
>>>>
>>>> Mike
>>>>
>>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>>> We are seeing a situation where the IndexWriter is using up the Java =
Heap space and only releases memory for garbage collection upon a commit. =
=A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene=
 2.9.1. We are set at heap size of 512 mb.
>>>>>
>>>>> We have a large number of documents that are run through Tika and the=
n added to the index. =A0The data from Tika is changed to a string, and the=
n sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes=
 and not in Tika. =A0Our intent is to only perform a commit once the entire=
 indexing run is complete, but several hours into the process everything co=
mes to a crawl. =A0In using both JConsole and VisualVM =A0we can see that t=
he heap space is maxed out and garbage collection is not able to clean up a=
ny memory once we get into this state. =A0It is our understanding that the =
IndexWriter should be only holding onto 16 mb of data before it flushes it,=
 but what we are seeing is that while it is in fact writing data to disk wh=
en it hits the 16 mb limit, it is also holding onto some data in memory and=
 not allowing garbage collection to take place, and this continues until ga=
rbage collection is unable to free up enough space to all things to move fa=
ster than a crawl.
>>>>>
>>>>> As a test we caused a commit to occur after each document is indexed =
and we see the total amount of memory reduced from nearly 100% of the Java =
Heap to around 70-75%. =A0The profiling tools now show that the memory is c=
leaned up to some extent after each document. =A0But of course this complet=
ely defeats the whole reason why we want to only commit at the end of the r=
un for performance sake. =A0Most of the data, as seen using Heap analasis, =
is held in Byte, Character, and Integer classes whos GC roots are tied back=
 to the Writer Objects and threads. =A0The instance counts, after running j=
ust 1,100 documents seems staggering
>>>>>
>>>>> Is there additional data that the IndexWriter hangs onto regardless o=
f when it hits the RAMBufferSize limit? =A0Why are we seeing the heap space=
 all being used up?
>>>>>
>>>>> A side question to this is the fact that we always see a large amount=
 of memory used by the IndexWriter even after our indexing has been complet=
ed and all commits have taken place (basically in an idle state). =A0Why wo=
uld this be? =A0Is the only way to totally clean up the memory is to close =
the writer? =A0Our index is also used for real time indexing so the IndexWr=
iter is intended to remain open for the lifetime of the app.
>>>>>
>>>>> Any help in understanding why the IndexWriter is maxing out our heap =
space or what is expected from memory usage of the IndexWriter would be app=
reciated.
>>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>>
>>
>> --
>> Lance Norskog
>> goksron@gmail.com
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45799-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 21:07:34 2010
Return-Path: <java-user-return-45799-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4476 invoked from network); 14 Apr 2010 21:07:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 21:07:34 -0000
Received: (qmail 70226 invoked by uid 500); 14 Apr 2010 21:07:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70199 invoked by uid 500); 14 Apr 2010 21:07:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70191 invoked by uid 99); 14 Apr 2010 21:07:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:07:32 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 216.139.236.158 is neither permitted nor denied by domain of sirishreddy@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:07:27 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <sirishreddy@gmail.com>)
	id 1O29ne-0005iG-FG
	for java-user@lucene.apache.org; Wed, 14 Apr 2010 14:07:06 -0700
Date: Wed, 14 Apr 2010 13:07:06 -0800 (PST)
From: Sirish Vadala <sirishreddy@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271279226466-719604.post@n3.nabble.com>
In-Reply-To: <r2w786fde51004140155nbd8480c3z747bb514f135b007@mail.gmail.com>
References: <1271192353086-717137.post@n3.nabble.com> <r2w786fde51004140155nbd8480c3z747bb514f135b007@mail.gmail.com>
Subject: Re: Problem with search
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Hmmm... Seems like a lot of work to be done. I will try these options and
update.

Thanks a lot.

Best.
-- 
View this message in context: http://n3.nabble.com/Problem-with-search-tp717137p719604.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45800-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 21:13:02 2010
Return-Path: <java-user-return-45800-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7459 invoked from network); 14 Apr 2010 21:13:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 21:13:02 -0000
Received: (qmail 75719 invoked by uid 500); 14 Apr 2010 21:13:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75671 invoked by uid 500); 14 Apr 2010 21:13:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75663 invoked by uid 99); 14 Apr 2010 21:13:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:13:00 +0000
X-ASF-Spam-Status: No, hits=-0.5 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:12:53 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id AE5FFD36006
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:12:32 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id nKfdrm1eUAgm for <java-user@lucene.apache.org>;
	Wed, 14 Apr 2010 23:12:23 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 143C4D36005
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:12:23 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <l2hebded34f1004141215qe3fd1dc8o7689989ee70c05e2@mail.gmail.com>
In-Reply-To: <l2hebded34f1004141215qe3fd1dc8o7689989ee70c05e2@mail.gmail.com>
Subject: RE: Indexing lists of IDs
Date: Wed, 14 Apr 2010 23:12:29 +0200
Message-ID: <004701cadc17$312f9180$938eb480$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrcBu5VvohZeh81RLexAfNP3dbXTQAD/l0Q
Content-Language: de

You can add the terms with Field.Index.NOT_ANALYZED multiple times to =
the same field. If you use an analyzer like WhitespaceAnalyzer and you =
analyze your tersm, you must also pass the analyzed term through =
analyzer when building a TermQuery. This may explain, why you =
don=E2=80=99t get those IDs.

But for IDs in general, you should not use analyzers and add as =
NOT_ANYLYZED and query with TermQuery. As explained before, just add =
more than one term to the same field.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Kristjan Siimson [mailto:kristjan.siimson@gmail.com]
> Sent: Wednesday, April 14, 2010 9:16 PM
> To: java-user@lucene.apache.org
> Subject: Indexing lists of IDs
>=20
> Hello,
>=20
> I have document for which I'd like to index an array of indexes. For
> example, there is a product that belongs to categories with IDs 12, =
15,
> 16,
> 145, 148. I'd like to index these categories, and then be able to use
> them
> in queries, so that I can search for product which's name is "Bottle"
> and
> which belongs to category 12.
>=20
> I came up with creating a field in which I store the ID numbers and
> separate
> them with spaces. However, when I tried to create a term query, the
> query
> never gave any results. Can anybody help me with this?
>=20
> Sincerely,
> Kristjan Siimson


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45801-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 21:28:46 2010
Return-Path: <java-user-return-45801-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24749 invoked from network); 14 Apr 2010 21:28:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 21:28:46 -0000
Received: (qmail 1115 invoked by uid 500); 14 Apr 2010 21:28:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1082 invoked by uid 500); 14 Apr 2010 21:28:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1074 invoked by uid 99); 14 Apr 2010 21:28:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:28:44 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:28:36 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 3D6C5D36006
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:28:16 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id FfwnjNF1szH5 for <java-user@lucene.apache.org>;
	Wed, 14 Apr 2010 23:28:11 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id C7765D36005
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:28:10 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <1271268767.3543.64.camel@tpoljak-laptop>
In-Reply-To: <1271268767.3543.64.camel@tpoljak-laptop>
Subject: RE: NumericField indexing performance
Date: Wed, 14 Apr 2010 23:28:17 +0200
Message-ID: <004b01cadc19$660a88e0$321f9aa0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: Acrb/i5ku5CAglPwRBubXUqdr66KRgAGdFMg
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Tomislav,

indexing with NumericField takes longer (at least for the default =
precision step of 4, which means out of 32 bit integers make 8 subterms =
with each 4 bits of the value). So you produce 8 times more terms during =
indexing that must be handled by the indexer. If you have lots of =
documents, with distinct values the term index gets larger and larger, =
but search performance increases dramatically (for NumericRangeQueries). =
So if you index *only* numeric fields and nothing else, a 8 times slower =
indexing can be true.=20

If you are not using NumericRangeQuery or you want tune indexing =
performance, try larger precision Steps like 6 or 8. If you =
don=E2=80=99t use NumericRangeQuery and only want to index the numeric =
terms as *one* term, use precStep=3DInteger.MAX_VALUE. Also check your =
memory requirements, as the indexer may need more memory and GC costs =
too much. Also the index size will increase, so lots of more I/O is =
done. Without more details I cannot say anything about your =
configuration. So please tell us, how many documents, how many fields =
and how many numeric fields in which configuration do you use?

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Tomislav Poljak [mailto:tpoljak@gmail.com]
> Sent: Wednesday, April 14, 2010 8:13 PM
> To: java-user@lucene.apache.org
> Subject: NumericField indexing performance
>=20
> Hi,
> is it normal for indexing time to increase up to 10 times after
> introducing NumericField instead of Field (for two fields)?
>=20
> I've changed two date fields from String representation (Field) to
> NumericField, now it is:
>=20
> doc.add(new NumericField("time").setIntValue(date.getTime()/24/3600))
>=20
> and after this change indexing took 10x more time (before it was few
> minutes and after more than an hour and half). I've tested with a
> simple
> counter like this:
>=20
> doc.add(new NumericField("endTime").setIntValue(count++))
>=20
> but nothing changed, it still takes around 10x longer. If I comment
> adding one numeric field to index time drops significantly and if I
> comment both fields indexing takes only few minutes again.
>=20
> Tomislav
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45802-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 21:38:34 2010
Return-Path: <java-user-return-45802-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34254 invoked from network); 14 Apr 2010 21:38:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 21:38:34 -0000
Received: (qmail 27881 invoked by uid 500); 14 Apr 2010 21:38:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27836 invoked by uid 500); 14 Apr 2010 21:38:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27785 invoked by uid 99); 14 Apr 2010 21:38:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:38:31 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 21:38:23 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id B3D73D36006
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:38:02 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id NJ131QpL0W3W for <java-user@lucene.apache.org>;
	Wed, 14 Apr 2010 23:37:57 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 48453D36005
	for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:37:57 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <1271268767.3543.64.camel@tpoljak-laptop> <004b01cadc19$660a88e0$321f9aa0$@de>
In-Reply-To: <004b01cadc19$660a88e0$321f9aa0$@de>
Subject: RE: NumericField indexing performance
Date: Wed, 14 Apr 2010 23:38:03 +0200
Message-ID: <004c01cadc1a$c395df40$4ac19dc0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: Acrb/i5ku5CAglPwRBubXUqdr66KRgAGdFMgAACiE2A=
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

One addition:
If you are indexing millions of numeric fields, you should also try to =
reuse NumericField and Document instances (as described in JavaDocs). =
NumericField creates internally a NumericTokenStream and lots of small =
objects (attributes), so GC cost may be high. This is just another idea.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Wednesday, April 14, 2010 11:28 PM
> To: java-user@lucene.apache.org
> Subject: RE: NumericField indexing performance
>=20
> Hi Tomislav,
>=20
> indexing with NumericField takes longer (at least for the default
> precision step of 4, which means out of 32 bit integers make 8 =
subterms
> with each 4 bits of the value). So you produce 8 times more terms
> during indexing that must be handled by the indexer. If you have lots
> of documents, with distinct values the term index gets larger and
> larger, but search performance increases dramatically (for
> NumericRangeQueries). So if you index *only* numeric fields and =
nothing
> else, a 8 times slower indexing can be true.
>=20
> If you are not using NumericRangeQuery or you want tune indexing
> performance, try larger precision Steps like 6 or 8. If you =
don=E2=80=99t use
> NumericRangeQuery and only want to index the numeric terms as *one*
> term, use precStep=3DInteger.MAX_VALUE. Also check your memory
> requirements, as the indexer may need more memory and GC costs too
> much. Also the index size will increase, so lots of more I/O is done.
> Without more details I cannot say anything about your configuration. =
So
> please tell us, how many documents, how many fields and how many
> numeric fields in which configuration do you use?
>=20
> Uwe
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
> > -----Original Message-----
> > From: Tomislav Poljak [mailto:tpoljak@gmail.com]
> > Sent: Wednesday, April 14, 2010 8:13 PM
> > To: java-user@lucene.apache.org
> > Subject: NumericField indexing performance
> >
> > Hi,
> > is it normal for indexing time to increase up to 10 times after
> > introducing NumericField instead of Field (for two fields)?
> >
> > I've changed two date fields from String representation (Field) to
> > NumericField, now it is:
> >
> > doc.add(new =
NumericField("time").setIntValue(date.getTime()/24/3600))
> >
> > and after this change indexing took 10x more time (before it was few
> > minutes and after more than an hour and half). I've tested with a
> > simple
> > counter like this:
> >
> > doc.add(new NumericField("endTime").setIntValue(count++))
> >
> > but nothing changed, it still takes around 10x longer. If I comment
> > adding one numeric field to index time drops significantly and if I
> > comment both fields indexing takes only few minutes again.
> >
> > Tomislav
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45803-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 22:19:59 2010
Return-Path: <java-user-return-45803-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68399 invoked from network); 14 Apr 2010 22:19:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 22:19:59 -0000
Received: (qmail 7629 invoked by uid 500); 14 Apr 2010 22:19:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7593 invoked by uid 500); 14 Apr 2010 22:19:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7581 invoked by uid 99); 14 Apr 2010 22:19:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 22:19:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of kristjan.siimson@gmail.com designates 209.85.222.196 as permitted sender)
Received: from [209.85.222.196] (HELO mail-pz0-f196.google.com) (209.85.222.196)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 22:19:50 +0000
Received: by pzk34 with SMTP id 34so625552pzk.20
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 15:19:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=ydiOZNAl3nT5TnAyRTJmmvqjzUFnwGtbYnZ45UfpgNc=;
        b=ro2bvLBMY/zZAcI8AIho2ttxF8RlXeCsUoOjBHqJ3JarebHpefLdUMGul8LcbnvJh2
         AiLyWW54b7+XlekJ8dwxixeRKdxM9zhsRsTupGv6JzPNsU0bpqCfsKaEtbw4DgS2LZYW
         SiU9fITIPq2WL4lSZ89QrcuJ/pINhLDI6yc3E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=WWRMZvQUGaj8NFIng2KcUQi1WP0Ny8qrDtjqeb36i5ZwkLwm7FLDrsx/tsxx/I4WDX
         wSyqBVXKtwYgWJQ7oN40+9Qbvikp9x5LVbitIT2mZWUIevV0/jylmxg5TGRTWY1LO5Y7
         qJahvZMPQlwZbS8uXksiAQGIM05YuMdKCMdvU=
MIME-Version: 1.0
Received: by 10.141.15.15 with HTTP; Wed, 14 Apr 2010 15:19:29 -0700 (PDT)
In-Reply-To: <004701cadc17$312f9180$938eb480$@de>
References: <l2hebded34f1004141215qe3fd1dc8o7689989ee70c05e2@mail.gmail.com>
	 <004701cadc17$312f9180$938eb480$@de>
Date: Wed, 14 Apr 2010 15:19:29 -0700
Received: by 10.141.1.1 with SMTP id d1mr2034971rvi.89.1271283569204; Wed, 14 
	Apr 2010 15:19:29 -0700 (PDT)
Message-ID: <z2kebded34f1004141519h58c08feex7b2df432db043bcc@mail.gmail.com>
Subject: Re: Indexing lists of IDs
From: Kristjan Siimson <kristjan.siimson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd0ebc88d294f048439c53c
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd0ebc88d294f048439c53c
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Thanks, the problem was with tokenizer, which didn't index any numbers, so =
I
tried writing my own, and it works perfectly! :)

Sincerely,
Kristjan Siimson

On Wed, Apr 14, 2010 at 2:12 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> You can add the terms with Field.Index.NOT_ANALYZED multiple times to the
> same field. If you use an analyzer like WhitespaceAnalyzer and you analyz=
e
> your tersm, you must also pass the analyzed term through analyzer when
> building a TermQuery. This may explain, why you don=92t get those IDs.
>
> But for IDs in general, you should not use analyzers and add as
> NOT_ANYLYZED and query with TermQuery. As explained before, just add more
> than one term to the same field.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Kristjan Siimson [mailto:kristjan.siimson@gmail.com]
> > Sent: Wednesday, April 14, 2010 9:16 PM
> > To: java-user@lucene.apache.org
> > Subject: Indexing lists of IDs
> >
> > Hello,
> >
> > I have document for which I'd like to index an array of indexes. For
> > example, there is a product that belongs to categories with IDs 12, 15,
> > 16,
> > 145, 148. I'd like to index these categories, and then be able to use
> > them
> > in queries, so that I can search for product which's name is "Bottle"
> > and
> > which belongs to category 12.
> >
> > I came up with creating a field in which I store the ID numbers and
> > separate
> > them with spaces. However, when I tried to create a term query, the
> > query
> > never gave any results. Can anybody help me with this?
> >
> > Sincerely,
> > Kristjan Siimson
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd0ebc88d294f048439c53c--

From java-user-return-45804-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 22:52:34 2010
Return-Path: <java-user-return-45804-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96089 invoked from network); 14 Apr 2010 22:52:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 22:52:34 -0000
Received: (qmail 61720 invoked by uid 500); 14 Apr 2010 22:52:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61573 invoked by uid 500); 14 Apr 2010 22:52:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61565 invoked by uid 99); 14 Apr 2010 22:52:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 22:52:32 +0000
X-ASF-Spam-Status: No, hits=-0.8 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of goksron@gmail.com designates 209.85.221.192 as permitted sender)
Received: from [209.85.221.192] (HELO mail-qy0-f192.google.com) (209.85.221.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 22:52:26 +0000
Received: by qyk30 with SMTP id 30so786237qyk.16
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 15:52:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=g8JKtqEp4huD5fetmO00xNxkhSrIX+eNiFG2+x2UFRA=;
        b=s5IEAfyAg8kS3RUGroVUziBNFlcX6b6J6zANrntcCHFlViWGIEGjEojG0tjpRUjuQZ
         rbc4Q7LaQNjflx6psqGiCgLt0pQpsd2lnuqJ7mxz6YqqXeBiwZiIls/IhuBUECzJ6IBu
         scLkQ/IimCpA0eo837QRUw+cq62qTC3q80laE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=En5QuixmfJJuL9QQEGZ7Ws41MTZI79A5XOKVuphJB77KPf8NmCZD7NdP1oz+Vs2Ve2
         unMSxdC8Cx+eu/7cvVXarDxOgQNN8i2oapJGDUHHII8nWOe6j1AIWzqNeaUwNZeH9zvI
         3mty5EKLsDFPqgGUOv011pQv8Umr7G3889k9M=
MIME-Version: 1.0
Received: by 10.229.234.6 with HTTP; Wed, 14 Apr 2010 15:52:04 -0700 (PDT)
Date: Wed, 14 Apr 2010 15:52:04 -0700
Received: by 10.229.10.132 with SMTP id p4mr4408359qcp.86.1271285524736; Wed, 
	14 Apr 2010 15:52:04 -0700 (PDT)
Message-ID: <h2h87c998321004141552z48bd8fdz7175924971731569@mail.gmail.com>
Subject: Utility program to extract a segment
From: Lance Norskog <goksron@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

Is there a program available that makes a new index with one or more
segments from an existing index? (The immediate use case for this is
doing forensics on corrupted indexes.)

The user interface would be:
extract -segments _ab,_g9 oldindex newindex

This would copy the files for segments _ab and _g9 into a new
directory and generate a segments.gen for just those two segments. Is
this all that's needed?

-- 
Lance Norskog
goksron@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45805-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 23:35:07 2010
Return-Path: <java-user-return-45805-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36056 invoked from network); 14 Apr 2010 23:35:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 23:35:03 -0000
Received: (qmail 14339 invoked by uid 500); 14 Apr 2010 23:35:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14275 invoked by uid 500); 14 Apr 2010 23:35:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14267 invoked by uid 99); 14 Apr 2010 23:35:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 23:35:00 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 23:34:54 +0000
Received: by gwaa12 with SMTP id a12so346783gwa.35
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 16:34:33 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Wed, 14 Apr 2010 16:34:33 -0700 (PDT)
In-Reply-To: <h2h87c998321004141552z48bd8fdz7175924971731569@mail.gmail.com>
References: <h2h87c998321004141552z48bd8fdz7175924971731569@mail.gmail.com>
Date: Wed, 14 Apr 2010 19:34:33 -0400
Received: by 10.150.251.10 with SMTP id y10mr7934785ybh.123.1271288073258; 
	Wed, 14 Apr 2010 16:34:33 -0700 (PDT)
Message-ID: <q2i9ac0c6aa1004141634qa2cc947o56d0a15a3522033a@mail.gmail.com>
Subject: Re: Utility program to extract a segment
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

I don't think there's an existing tool, but it shouldn't be too hard to create.

Create a new SegmentInfos(), then call its .read(oldDir) to read all
segments.  Look up the SegmentInfo(s) you want to copy and call their
.files() methods to see which files to copy.  Copy them.  Remove all
other segments from the SegmentInfos, then .write(newDir).

Mike

On Wed, Apr 14, 2010 at 6:52 PM, Lance Norskog <goksron@gmail.com> wrote:
> Is there a program available that makes a new index with one or more
> segments from an existing index? (The immediate use case for this is
> doing forensics on corrupted indexes.)
>
> The user interface would be:
> extract -segments _ab,_g9 oldindex newindex
>
> This would copy the files for segments _ab and _g9 into a new
> directory and generate a segments.gen for just those two segments. Is
> this all that's needed?
>
> --
> Lance Norskog
> goksron@gmail.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45806-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 14 23:47:35 2010
Return-Path: <java-user-return-45806-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44309 invoked from network); 14 Apr 2010 23:47:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Apr 2010 23:47:35 -0000
Received: (qmail 25726 invoked by uid 500); 14 Apr 2010 23:47:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25693 invoked by uid 500); 14 Apr 2010 23:47:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25685 invoked by uid 99); 14 Apr 2010 23:47:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 23:47:33 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Apr 2010 23:47:23 +0000
Received: by gyf1 with SMTP id 1so352846gyf.35
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 16:47:01 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Wed, 14 Apr 2010 16:47:00 -0700 (PDT)
In-Reply-To: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
References: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
Date: Wed, 14 Apr 2010 19:47:00 -0400
Received: by 10.150.103.12 with SMTP id a12mr6880946ybc.112.1271288820411; 
	Wed, 14 Apr 2010 16:47:00 -0700 (PDT)
Message-ID: <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
Subject: Re: trying to resolve error: after flush: fdx size mismatch
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Not good!

Can you describe how your threads work with Lucene?

Is this just a local filesystem (disk) under vista?

Mike

On Wed, Apr 14, 2010 at 7:41 AM, jm <jmuguruza@gmail.com> wrote:
> Hi,
>
> I am trying to chase an issue in our code and it is being quite
> difficult. We have seen two instances (see below) where we get the
> same error. I have been trying to reproduce but it has been impossible
> so far.I have several threads, some might be creating indices and
> adding documents, others closing indices etc. =A0In the list this
> message appear several times, in some cases it was a lucene bug (not
> my case, I dont have millions of docs here) and in other it seems bad
> multithreading. I have verified my multithreaded code for the 5th time
> and all seems well synchronized.
>
> So I am asking if somebody can give me any hint, maybe the fact that
> the first number is always a 1 means something?? =A0I suspect the issue
> is when a new index is just created maybe.
>
> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
> 103 length in bytes of _2.fdx file exists?=3Dtrue
> org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsWrit=
er.java:97)
> org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProcessor=
.java:50)
> org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.jav=
a:380)
> org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:581)
> org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:4294=
)
> org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:4192)
> org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:4183)
> org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:2190)
> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2153)
> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2117)
>
>
> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
> 8457 length in bytes of _0.fdx file exists?=3Dtrue ...
>
> My env is vista, jdk1.6, lucene 2.9.1
> thanks in advance.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45807-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 06:37:12 2010
Return-Path: <java-user-return-45807-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8926 invoked from network); 15 Apr 2010 06:37:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 06:37:12 -0000
Received: (qmail 2497 invoked by uid 500); 15 Apr 2010 06:37:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2236 invoked by uid 500); 15 Apr 2010 06:37:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2228 invoked by uid 99); 15 Apr 2010 06:37:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 06:37:07 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 06:37:00 +0000
Received: by bwz3 with SMTP id 3so858998bwz.11
        for <java-user@lucene.apache.org>; Wed, 14 Apr 2010 23:36:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=536U/ScprSg/n6Znk1JQLgPqz4ScUES3QlKpLVt9TX0=;
        b=NZMYH9ZyKm0JoXbR761De1cOxvKROGtdA/n9ozNIPQA2bsD98mMrkGw2GWpsQxDqUO
         fXU1XrnBtXFM07JDqEHDs2W3KSUCcxwIhcFygLAtDan0f0g141Ho33dz+vPFgYIC2fNh
         Csv2LUPTUeMupJ4hX6pgl8mpeR1stDAb9XWuE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=FuizpYfYCo22w3ATg3Tbdcp7xHsXRc+9BVogpx8ukmT+Y97CDYjEmhu7woPvAx0dKU
         Fd7hc/QyL1gt9W/MgUI3oclNcdELOb1mMZWXTSOppCPD866c6Z59DQZcs9JhfhVLOEm9
         TngWD5Y5xq3rPy7TVl805AGthjBTHY8s1Keck=
MIME-Version: 1.0
Received: by 10.103.121.2 with HTTP; Wed, 14 Apr 2010 23:36:39 -0700 (PDT)
In-Reply-To: <y2icbcac69f1004140910x26c3339bl834db761bb257f62@mail.gmail.com>
References: <l2gcbcac69f1004091725oecea199bv7a1fa45a7f34ab13@mail.gmail.com>
	 <q2g786fde51004101056s8ee089f3g610e31bdec77bf4e@mail.gmail.com>
	 <h2mcbcac69f1004120409g5c27063az40456793bb517a0b@mail.gmail.com>
	 <m2jcbcac69f1004121049z1aba8ac3s9279f351b438cff4@mail.gmail.com>
	 <n2x786fde51004131234wdbf70b9cibe2f0f43a115e6c2@mail.gmail.com>
	 <y2icbcac69f1004140910x26c3339bl834db761bb257f62@mail.gmail.com>
Date: Thu, 15 Apr 2010 09:36:39 +0300
Received: by 10.103.80.25 with SMTP id h25mr4811635mul.60.1271313399179; Wed, 
	14 Apr 2010 23:36:39 -0700 (PDT)
Message-ID: <r2i786fde51004142336q2589ddf0xfa0a2fdce5c1697c@mail.gmail.com>
Subject: Re: Removing terms in the Index
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e65b635a8e6b8d048440b768

--0016e65b635a8e6b8d048440b768
Content-Type: text/plain; charset=ISO-8859-1

I'm still not sure I understand ...

If the first document includes "Lucene in Action. Lucene" (two sentences,
the 2nd one with Lucene only) and the second "Lucene for Dummies", then what
exactly do you want to get for the queries "\"Lucene in Action\"" and
"\"Lucene\""?

If I understand correctly, then you want just the first doc as a match for
these two queries? Which means the second query "\"Lucene\"" should not
match the second document, because Lucene appears as one of the words in a
sentence?

If that's what you want, then you need to create a Tokenizer which
recognizes end-of-sentence boundaries, and indexes each sentence as a single
token. So the tokens in the index will be:
Lucene in Action -> doc1
Lucene -> doc1
Lucene for Dummies -> doc2

Is that what you want? If not then I apologize, but I still don't understand
...

Shai

On Wed, Apr 14, 2010 at 7:10 PM, Railan Xisto <railan.xisto@gmail.com>wrote:

> Actually the doc1 with the terms to be searched, has two words "Lucene in
> Action" and "Lucene". I want when I pass "Lucene in Action", it shows the
> result and remove the word not to be found when I pass only the term
> "Lucene". In short, the term "Lucene" not find the phrase "Lucene in
> Action", since the entire phrase was searched before. It is the idea of
> N-Gram (complete sentences) and U-Gram (isolated words). Gave to
> understand?
>
>
> 2010/4/13 Shai Erera <serera@gmail.com>
>
> > I ran your code. Since I don't have the queries file
> (Docs/documento.txt),
> > I
> > set this line instead:
> >
> > String termos = "\"Lucene in Action\"";
> >
> > When I set it to \"Lucene\", both documents are found. When I set it to
> > \"Lucene in Action\" only the first document is found. Seems correct to
> me.
> >
> > Can you please explain this:
> > "I pass the word "Lucene in Action", it find and
> > remove that term of phrase in the Index"
> >
> > --> what do you mean "find and remove"?
> >
> > Shai
> >
> > On Mon, Apr 12, 2010 at 8:49 PM, Railan Xisto <railan.xisto@gmail.com
> > >wrote:
> >
> > > And the main objective: when I pass the word "Lucene in Action", it
> find
> > > and
> > > remove that term of phrase in the Index, for when I pass the 2nd term
> > > ("Lucene"), he does not find that phrase anymore, as has been found the
> > > "Lucene in Action" .
> > >
> > >
> > > 2010/4/12 Railan Xisto <railan.xisto@gmail.com>
> > >
> > > > Ok. There is a piece of code attached.. As I already said, I want to
> > pass
> > > > that when the term "Lucene in Action" he finds only the 1st sentence.
> > > >
> > > >
> > > >
> > > >
> > > > 2010/4/10 Shai Erera <serera@gmail.com>
> > > >
> > > > Hi. I'm not sure I understand what you searched for. When you search
> > > >> for "Lucene in action", do you search it with the quotes or not? If
> > > >> with the quotes, then I don't understand how the 2nd dox is found.
> > > >>
> > > >> Do you perhaps have a test code you can share w/ us? It can be a
> short
> > > >> and simple main which creates an index w/ some documents and then
> > > >> searches them.
> > > >>
> > > >> Shai
> > > >>
> > > >> On Saturday, April 10, 2010, Fotos fotos <railan.xisto@gmail.com>
> > > wrote:
> > > >> > Hello!
> > > >> > I am a beginner with Lucene. I'm needing to do the following:
> > > >> >
> > > >> > I have a text file with the following terms:
> > > >> >
> > > >> > "Lucene in action"
> > > >> > "Lucene"
> > > >> >
> > > >> > and a file with the following sentences:
> > > >> >
> > > >> > 1 - "Lucene in action now."
> > > >> > 2 - "Lucene for Dummies"
> > > >> > 3 - "Managing Gigabytes"
> > > >> >
> > > >> > I need to search in phrases of doc2, the terms of doc1.
> > > >> >
> > > >> > But in search of the word n-grama: "Lucene in Action", he also
> finds
> > > the
> > > >> 2nd
> > > >> > sentence.
> > > >> >
> > > >> > In this case, I want to meet with the term 1 ("Lucene in Action"),
> > > only
> > > >> the
> > > >> > first phrase and remove the term of the index, for not to be found
> > > when
> > > >> I
> > > >> > pass the term 2 ("Lucene")
> > > >> >
> > > >> > Railan Xisto
> > > >> > Web Developer
> > > >> >
> > > >>
> > > >>
>  ---------------------------------------------------------------------
> > > >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > >> For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >>
> > > >>
> > > >
> > >
> >
>

--0016e65b635a8e6b8d048440b768--

From java-user-return-45808-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 07:36:23 2010
Return-Path: <java-user-return-45808-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26133 invoked from network); 15 Apr 2010 07:36:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 07:36:23 -0000
Received: (qmail 68035 invoked by uid 500); 15 Apr 2010 07:36:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67841 invoked by uid 500); 15 Apr 2010 07:36:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67833 invoked by uid 99); 15 Apr 2010 07:36:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 07:36:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of oren.liat@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 07:36:12 +0000
Received: by bwz3 with SMTP id 3so898731bwz.11
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 00:35:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=1ykrJ7SEEnia/wXHiB1hyGu3FJWNYnMzKam6sKsamwg=;
        b=GMRnYURejZGEQ2VJAi5qX8iGh9R+w0MvEgpS/rYe/v8Dn3frWEkzF6KyMGLrkGr5xC
         ryqXY+yCbJUw/sC7oxZ49/Ak8kZCjxUvqTy51Kq/O/YLYQc0ec8cvtM/GntrIOrjTjPv
         e8pOkcL7byOpk3Vcwy6PYcB8Wna4aWDRqnhPw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=Mmi3ksGuoODNpVZ4cSm5GosyD6HtOZ5rmkdbT9UBhdhhLwe+dj9TkSImdY0D0suAlq
         6HN8URUU/CMbAWEJXqJZkeYeOfaDKQqy1S2bynpvN6BKIkS4RBxWbMbajRK6QcAT7O1K
         hoiZpGQjjeFylDDrXxL9P73GHbENFUHUf3w3E=
MIME-Version: 1.0
Received: by 10.103.218.12 with HTTP; Thu, 15 Apr 2010 00:31:54 -0700 (PDT)
Date: Thu, 15 Apr 2010 10:31:54 +0300
Received: by 10.102.237.8 with SMTP id k8mr4876798muh.41.1271316714842; Thu, 
	15 Apr 2010 00:31:54 -0700 (PDT)
Message-ID: <w2id36c28c31004150031ladf5f2basa0c6d9cf04a6d83d@mail.gmail.com>
Subject: Exception in thread "Lucene Merge Thread #3" MergePolicy$MergeException: 
	java.io.IOException: Data error (cyclic redundancy check)
From: liat oren <oren.liat@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636416db72f6fcf0484417d79
X-Virus-Checked: Checked by ClamAV on apache.org

--001636416db72f6fcf0484417d79
Content-Type: text/plain; charset=ISO-8859-1

Hi All,
I got the following error while trying to optimize index sized 31 GB:
Exception in thread "Lucene Merge Thread #3"
P.Lucene.Expert.index.MergePolicy$MergeException: java.io.IOException: Data
error (cyclic redundancy check)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:369)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:338)
Caused by: java.io.IOException: Data error (cyclic redundancy check)
        at java.io.RandomAccessFile.readBytes(Native Method)
        at java.io.RandomAccessFile.read(RandomAccessFile.java:315)
        at P.Lucene.Expert.store.FSDirectory$FSIndexInput

When could be the problem here?
Since it threw the application, the index stayed open. Is there a
possibility to close it properly? to save the data?

Many thanks,
Liat

--001636416db72f6fcf0484417d79--

From java-user-return-45809-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 08:11:36 2010
Return-Path: <java-user-return-45809-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36119 invoked from network); 15 Apr 2010 08:11:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 08:11:36 -0000
Received: (qmail 2583 invoked by uid 500); 15 Apr 2010 08:11:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2510 invoked by uid 500); 15 Apr 2010 08:11:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2502 invoked by uid 99); 15 Apr 2010 08:11:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 08:11:33 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 08:11:27 +0000
Received: by bwz3 with SMTP id 3so931041bwz.11
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 01:11:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=OtTriLyAewuEfUR1L2XLj+bxC5tHONS14e3bC8T/6jQ=;
        b=waoq2Hxz4p3RQFiZw8MOiTYIYGCR6tpgn6MvDExe6BJKS1pcLZQrtlxuQLeq2cT1eT
         T/h0If/Kg+jTt+dcP0YgSAmd3GHGlc6IgPFMFQ0P2Ertq52yD192ON1kdPgqJ5rGiiiN
         3A5RmlMVor6qOH+fbJXpZKiGnRc4yVlaqCOIU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=XNsvZnVWkIBEPsJRaB4i5crepv0xjDvhdnlJHmtjxhZ0CnhmifXHhIDzADC08QUwqF
         DCbHQLub0TLW6PiwTIpkzQDNfidTYy2FANA2v3liCzMhxEAWkn3FxLCQr2Q6HhUvT8gb
         Co4+GVTgeAj4RkMxvqZJW58l2NIj3kM4OH5Xo=
MIME-Version: 1.0
Received: by 10.204.67.136 with HTTP; Thu, 15 Apr 2010 01:11:04 -0700 (PDT)
In-Reply-To: <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
References: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
	 <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
Date: Thu, 15 Apr 2010 10:11:04 +0200
Received: by 10.204.141.69 with SMTP id l5mr1633872bku.64.1271319064867; Thu, 
	15 Apr 2010 01:11:04 -0700 (PDT)
Message-ID: <o2rf071061b1004150111w757f696ct49bb7c36a073e735@mail.gmail.com>
Subject: Re: trying to resolve error: after flush: fdx size mismatch
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Mike

I have a server side, exposes a webservice with operations (this is
simplified ignoring things non lucene related):
- addToIndex(doc, date)
- flushAllIndexes()

addToIndex() adds the doc to the index, the index is chosen based on
the date (simplified it's one index per day). To speed this up the
webservice keeps a cache of IndexWriters.  If the index is already
open it uses it, otherwise adds it to the cache (the index is created
if it does not exist). I have a listener on the cache expiration so
the index is closed when it is removed from the cache (the cache has
only 10 items).

flushAllIndexes() just gets all indexes open on the cache and closes them a=
ll.

The webservice can serve many requests at the same time, but all
operations dealing with lucene are synchonized. I guess this is most
likely a bug in my synching code etc so I have verified it many times.
Even trying to reproduce the issue by stopping threads in a debugger
worked fine, synchronized methods were working as expected (I
understand am probably  missing the case that triggers the issue).

The last time this happened there was a single thread (in the client)
calling addToIndex(doc, date) many times and then it called
flushAllIndexes() The next second I got the error. The client
developer assures me the call to flushAllIndexes() as in the same
thread as addToIndex(doc, date) (anyway, it should work even if it was
different threads of course).

yes, local filesystem under Vista Business sp1 32b.

Hope this helps. I am just now developing a client that pounds the
server with some threads calling the methods all the time to try to
reproduce the issue.

javier

On Thu, Apr 15, 2010 at 1:47 AM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> Not good!
>
> Can you describe how your threads work with Lucene?
>
> Is this just a local filesystem (disk) under vista?
>
> Mike
>
> On Wed, Apr 14, 2010 at 7:41 AM, jm <jmuguruza@gmail.com> wrote:
>> Hi,
>>
>> I am trying to chase an issue in our code and it is being quite
>> difficult. We have seen two instances (see below) where we get the
>> same error. I have been trying to reproduce but it has been impossible
>> so far.I have several threads, some might be creating indices and
>> adding documents, others closing indices etc. =A0In the list this
>> message appear several times, in some cases it was a lucene bug (not
>> my case, I dont have millions of docs here) and in other it seems bad
>> multithreading. I have verified my multithreaded code for the 5th time
>> and all seems well synchronized.
>>
>> So I am asking if somebody can give me any hint, maybe the fact that
>> the first number is always a 1 means something?? =A0I suspect the issue
>> is when a new index is just created maybe.
>>
>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>> 103 length in bytes of _2.fdx file exists?=3Dtrue
>> org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsWri=
ter.java:97)
>> org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProcesso=
r.java:50)
>> org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.ja=
va:380)
>> org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:581)
>> org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:429=
4)
>> org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:4192)
>> org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:4183)
>> org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:2190)
>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2153)
>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2117)
>>
>>
>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>> 8457 length in bytes of _0.fdx file exists?=3Dtrue ...
>>
>> My env is vista, jdk1.6, lucene 2.9.1
>> thanks in advance.
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45810-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 09:23:58 2010
Return-Path: <java-user-return-45810-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55977 invoked from network); 15 Apr 2010 09:23:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 09:23:58 -0000
Received: (qmail 85846 invoked by uid 500); 15 Apr 2010 09:23:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85625 invoked by uid 500); 15 Apr 2010 09:23:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85611 invoked by uid 99); 15 Apr 2010 09:23:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 09:23:55 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 09:23:48 +0000
Received: by mail-pw0-f48.google.com with SMTP id 7so870930pwi.35
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 02:23:28 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.115.49.5 with HTTP; Thu, 15 Apr 2010 02:23:27 -0700 (PDT)
In-Reply-To: <w2id36c28c31004150031ladf5f2basa0c6d9cf04a6d83d@mail.gmail.com>
References: <w2id36c28c31004150031ladf5f2basa0c6d9cf04a6d83d@mail.gmail.com>
Date: Thu, 15 Apr 2010 05:23:27 -0400
Received: by 10.114.186.17 with SMTP id j17mr5242804waf.108.1271323408033; 
	Thu, 15 Apr 2010 02:23:28 -0700 (PDT)
Message-ID: <v2t9ac0c6aa1004150223z7e274704l488111882d2e43dc@mail.gmail.com>
Subject: Re: Exception in thread "Lucene Merge Thread #3" MergePolicy$MergeException: 
	java.io.IOException: Data error (cyclic redundancy check)
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

The traceback is truncated?

Still, this looks like your filesystem (and, specifically at least one
of the files it's holding for Lucene) is corrupted -- Lucene was
trying to read bytes from a file, in order to merge segments, and the
OS/IO system threw that exception.

You should run CheckIndex (which should detect & describe the
corruption), and then try to recover the index by re-running
CheckIndex with -fix.  But, more importantly, you need to figure out
why your filesystem has developed corruption because it will likely
happen again!

Mike

On Thu, Apr 15, 2010 at 3:31 AM, liat oren <oren.liat@gmail.com> wrote:
> Hi All,
> I got the following error while trying to optimize index sized 31 GB:
> Exception in thread "Lucene Merge Thread #3"
> P.Lucene.Expert.index.MergePolicy$MergeException: java.io.IOException: Da=
ta
> error (cyclic redundancy check)
> =A0 =A0 =A0 =A0at
> P.Lucene.Expert.index.ConcurrentMergeScheduler.handleMergeException(Concu=
rrentMergeScheduler.java:369)
> =A0 =A0 =A0 =A0at
> P.Lucene.Expert.index.ConcurrentMergeScheduler$MergeThread.run(Concurrent=
MergeScheduler.java:338)
> Caused by: java.io.IOException: Data error (cyclic redundancy check)
> =A0 =A0 =A0 =A0at java.io.RandomAccessFile.readBytes(Native Method)
> =A0 =A0 =A0 =A0at java.io.RandomAccessFile.read(RandomAccessFile.java:315=
)
> =A0 =A0 =A0 =A0at P.Lucene.Expert.store.FSDirectory$FSIndexInput
>
> When could be the problem here?
> Since it threw the application, the index stayed open. Is there a
> possibility to close it properly? to save the data?
>
> Many thanks,
> Liat
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45811-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 09:32:47 2010
Return-Path: <java-user-return-45811-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57683 invoked from network); 15 Apr 2010 09:32:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 09:32:47 -0000
Received: (qmail 99987 invoked by uid 500); 15 Apr 2010 09:32:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99813 invoked by uid 500); 15 Apr 2010 09:32:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99805 invoked by uid 99); 15 Apr 2010 09:32:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 09:32:44 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of oren.liat@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 09:32:39 +0000
Received: by bwz3 with SMTP id 3so1017068bwz.11
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 02:32:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=X9+6LHD1vg4sHd63ysBBvoX1KMEzIbm2IL7VA/Yvy5I=;
        b=tMHyT4C82DjDeWUpCGNDVFRzZkH4dPaQ1EGgz4KxqUcyfSwJj+ULYsD3wMF2w7YDfR
         4Aha+QwOjCIKy5QWtsxqcehyW7jrQNMI0IkYO24ISgPWKlKtZtMIRZ0i+3hdeDCpDg7Q
         WGY6veZm5nqNWuOrgb6pnp2uusxglAvcuoNtQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=glPe749CxM4kpVrDRPcDXaswO+4WFeaKFG2YCD6KlFyGOH2ibG0I+kOQjnDEe3FrPc
         pf5YGOod9jPEu+u51Gxpty6HkS6Tz3KsrQ4IZ/PI4c/o5e3R84xJnHRv5atuWez7iNRj
         xv4RuR0hRHOYn9B8No68LcrttlapFxHPARnBM=
MIME-Version: 1.0
Received: by 10.103.218.12 with HTTP; Thu, 15 Apr 2010 02:32:17 -0700 (PDT)
In-Reply-To: <v2t9ac0c6aa1004150223z7e274704l488111882d2e43dc@mail.gmail.com>
References: <w2id36c28c31004150031ladf5f2basa0c6d9cf04a6d83d@mail.gmail.com>
	 <v2t9ac0c6aa1004150223z7e274704l488111882d2e43dc@mail.gmail.com>
Date: Thu, 15 Apr 2010 12:32:17 +0300
Received: by 10.103.78.10 with SMTP id f10mr5000786mul.126.1271323937122; Thu, 
	15 Apr 2010 02:32:17 -0700 (PDT)
Message-ID: <v2xd36c28c31004150232z69219b74t26a7f58b600e963@mail.gmail.com>
Subject: Re: Exception in thread "Lucene Merge Thread #3" MergePolicy$MergeException: 
	java.io.IOException: Data error (cyclic redundancy check)
From: liat oren <oren.liat@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64ea5c0aaa93a0484432bf5

--0016e64ea5c0aaa93a0484432bf5
Content-Type: text/plain; charset=ISO-8859-1

Ok, thank you!
No, the full traceback is:
Exception in thread "Lucene Merge Thread #3"
P.Lucene.Expert.index.MergePolicy$MergeException: java.io.IOException: Data
error (cyclic redundancy check)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:369)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:338)
Caused by: java.io.IOException: Data error (cyclic redundancy check)
        at java.io.RandomAccessFile.readBytes(Native Method)
        at java.io.RandomAccessFile.read(RandomAccessFile.java:315)
        at
P.Lucene.Expert.store.FSDirectory$FSIndexInput.readInternal(FSDirectory.java:727)
        at
P.Lucene.Expert.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:168)
        at
P.Lucene.Expert.index.CompoundFileReader$CSIndexInput.readInternal(CompoundFileReader.java:271)
        at
P.Lucene.Expert.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:168)
        at
P.Lucene.Expert.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:109)
        at
P.Lucene.Expert.index.SegmentReader.norms(SegmentReader.java:1118)
        at
P.Lucene.Expert.index.SegmentMerger.mergeNorms(SegmentMerger.java:936)
        at P.Lucene.Expert.index.SegmentMerger.merge(SegmentMerger.java:145)
        at
P.Lucene.Expert.index.IndexWriter.mergeMiddle(IndexWriter.java:4894)
        at P.Lucene.Expert.index.IndexWriter.merge(IndexWriter.java:4469)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:238)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:305)
Exception in thread "main" java.io.IOException: background merge hit
exception:
_u:c83887 _15:c52319->_v _16:c5884->_v _17:c5856->_v _18:c5593->_v
_19:c6474->_v _1a:c5788->_v _1b:c6265->_v _1c:c8108->_v into _1d [optimize]
        at P.Lucene.Expert.index.IndexWriter.optimize(IndexWriter.java:2539)
        at P.Lucene.Expert.index.IndexWriter.optimize(IndexWriter.java:2468)
        at P.Lucene.Expert.index.IndexWriter.optimize(IndexWriter.java:2446)
        at P.index.SynonymIndex.generateSynonyms(SynonymIndex.java:140)
        at
P.indexGenerator.SynonymsIndexGenerator.generateIndex(SynonymsIndexGenerator.java:61)
        at
P.indexGenerator.SynonymsIndexGenerator.main(SynonymsIndexGenerator.java:32)
Caused by: java.io.IOException: Data error (cyclic redundancy check)
        at java.io.RandomAccessFile.readBytes(Native Method)
        at java.io.RandomAccessFile.read(RandomAccessFile.java:315)
        at
P.Lucene.Expert.store.FSDirectory$FSIndexInput.readInternal(FSDirectory.java:727)
        at
P.Lucene.Expert.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:168)
        at
P.Lucene.Expert.index.CompoundFileReader$CSIndexInput.readInternal(CompoundFileReader.java:271)
        at
P.Lucene.Expert.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:168)
        at
P.Lucene.Expert.store.BufferedIndexInput.readBytes(BufferedIndexInput.java:109)
        at
P.Lucene.Expert.index.SegmentReader.norms(SegmentReader.java:1118)
        at
P.Lucene.Expert.index.SegmentMerger.mergeNorms(SegmentMerger.java:936)
        at P.Lucene.Expert.index.SegmentMerger.merge(SegmentMerger.java:145)
        at
P.Lucene.Expert.index.IndexWriter.mergeMiddle(IndexWriter.java:4894)
        at P.Lucene.Expert.index.IndexWriter.merge(IndexWriter.java:4469)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:238)
        at
P.Lucene.Expert.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:305)


I will check it out.
Thanks!

On 15 April 2010 12:23, Michael McCandless <lucene@mikemccandless.com>wrote:

> The traceback is truncated?
>
> Still, this looks like your filesystem (and, specifically at least one
> of the files it's holding for Lucene) is corrupted -- Lucene was
> trying to read bytes from a file, in order to merge segments, and the
> OS/IO system threw that exception.
>
> You should run CheckIndex (which should detect & describe the
> corruption), and then try to recover the index by re-running
> CheckIndex with -fix.  But, more importantly, you need to figure out
> why your filesystem has developed corruption because it will likely
> happen again!
>
> Mike
>
> On Thu, Apr 15, 2010 at 3:31 AM, liat oren <oren.liat@gmail.com> wrote:
> > Hi All,
> > I got the following error while trying to optimize index sized 31 GB:
> > Exception in thread "Lucene Merge Thread #3"
> > P.Lucene.Expert.index.MergePolicy$MergeException: java.io.IOException:
> Data
> > error (cyclic redundancy check)
> >        at
> >
> P.Lucene.Expert.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:369)
> >        at
> >
> P.Lucene.Expert.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:338)
> > Caused by: java.io.IOException: Data error (cyclic redundancy check)
> >        at java.io.RandomAccessFile.readBytes(Native Method)
> >        at java.io.RandomAccessFile.read(RandomAccessFile.java:315)
> >        at P.Lucene.Expert.store.FSDirectory$FSIndexInput
> >
> > When could be the problem here?
> > Since it threw the application, the index stayed open. Is there a
> > possibility to close it properly? to save the data?
> >
> > Many thanks,
> > Liat
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64ea5c0aaa93a0484432bf5--

From java-user-return-45812-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 10:30:56 2010
Return-Path: <java-user-return-45812-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68779 invoked from network); 15 Apr 2010 10:30:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 10:30:56 -0000
Received: (qmail 55265 invoked by uid 500); 15 Apr 2010 10:30:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55027 invoked by uid 500); 15 Apr 2010 10:30:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55019 invoked by uid 99); 15 Apr 2010 10:30:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 10:30:53 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yiwong2001@hotmail.com designates 65.54.190.89 as permitted sender)
Received: from [65.54.190.89] (HELO bay0-omc2-s14.bay0.hotmail.com) (65.54.190.89)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 10:30:44 +0000
Received: from BAY136-DS12 ([65.54.190.125]) by bay0-omc2-s14.bay0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 15 Apr 2010 03:30:24 -0700
X-Originating-IP: [111.193.147.180]
X-Originating-Email: [yiwong2001@hotmail.com]
Message-ID: <BAY136-DS12609DD05921DA4162A410CD0F0@phx.gbl>
From: "Ian.huang" <yiwong2001@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: about analyzer for searching location
Date: Thu, 15 Apr 2010 18:30:17 +0800
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_0638_01CADCC9.B251E850"
X-Priority: 3
X-MSMail-Priority: Normal
Importance: Normal
X-Mailer: Microsoft Windows Live Mail 14.0.8089.726
X-MimeOLE: Produced By Microsoft MimeOLE V14.0.8089.726
X-OriginalArrivalTime: 15 Apr 2010 10:30:24.0275 (UTC) FILETIME=[A86A5630:01CADC86]

------=_NextPart_000_0638_01CADCC9.B251E850
Content-Type: text/plain;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

Hi All,

I am implementing a search function for address by hibernate search =
which is based on lucene. The class definition as following:

@Indexed
public class Address implements Cloneable
{
@DocumentId
private int id;
@Field
private String addrCountry;
private String addrDesc;
@Field
private String addrLineOne;
private String addrLineTwo;
@Field
private String addrCity;
......

As you see, addrCountry, addrLineone and addrCity are fields for search. =
I am using default analyzer in index & search. So I think country name =
like United States would be indexed as two terms United, and states.

In addition, during search, a search keyword like United states, or Salt =
lake city would be tokenized as two or three single words.=20

As result, any address fields contain united, city would be returned. =
like United Kingdom, but actually I want to get a result of united =
states.

My expected result as following:

if someone searches for "united" it should return "united states" and =
"united kingdom".

if someone searches for "united states" it should return "united =
states", and not "united kingdom".

I hope the analyzer can generate term with multiple words. say, united =
states to united states. I think standardanalyzer would analyze united =
states to united and states?

A different example: if search keyword is parking lot in Salt Lake City, =
the generated terms to search need to be: parking lot and Salt Lake =
City, not parking,lot,salt,lake and city.=20

I wonder if any analyzer can help me to implement my requirement. It =
would be better to use dictionary based solution, then I can manage some =
search terms that could have multiple words.

thanks

Ian
------=_NextPart_000_0638_01CADCC9.B251E850--


From java-user-return-45813-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 11:41:40 2010
Return-Path: <java-user-return-45813-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86565 invoked from network); 15 Apr 2010 11:41:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 11:41:40 -0000
Received: (qmail 37337 invoked by uid 500); 15 Apr 2010 11:41:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37054 invoked by uid 500); 15 Apr 2010 11:41:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37046 invoked by uid 99); 15 Apr 2010 11:41:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 11:41:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of tpoljak@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 11:41:28 +0000
Received: by bwz3 with SMTP id 3so1163274bwz.11
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 04:41:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:subject:from:to:in-reply-to
         :references:content-type:date:message-id:mime-version:x-mailer
         :content-transfer-encoding;
        bh=wYBT6dWjHqbLwbopd8ufkiEhtpvMc2IeEdLLiFn4vcI=;
        b=aAqfxDGjeUrSi3eFK8qM9/g1+WoXKyh0mLuk48tdx+o0AZO7eW0mU7h/8reFi1o2KK
         uEuNWro0OY+2QukB81ltzLN5liHqBZAtcl7kc0NyFIrv2C2pRYnoUXxocXi/llK3QGnI
         RvvFmvOowEI+SWlxYm9qilipqF0gSuadAzvgw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=subject:from:to:in-reply-to:references:content-type:date:message-id
         :mime-version:x-mailer:content-transfer-encoding;
        b=bVHqIIwa1G/gHXmwvwqSaVYYmt91X/A8YJj0tajnHQ0ebwUyTTCs31+zFNSuJOWR/z
         8NKpsLvnuIF2hLELTr/gbDWptkkNBHFSOMwUbEzY4hv1xuoN6e1NTMxHXHKQUIX2hF/c
         H6FcgtD9xbNoKd4iLavai/GHvPBIAuXEwinPc=
Received: by 10.103.78.31 with SMTP id f31mr14740mul.79.1271331667019;
        Thu, 15 Apr 2010 04:41:07 -0700 (PDT)
Received: from [192.168.1.223] (83-131-50-60.adsl.net.t-com.hr [83.131.50.60])
        by mx.google.com with ESMTPS id n7sm7527075mue.15.2010.04.15.04.41.04
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 15 Apr 2010 04:41:04 -0700 (PDT)
Subject: RE: NumericField indexing performance
From: Tomislav Poljak <tpoljak@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <004c01cadc1a$c395df40$4ac19dc0$@de>
References: <1271268767.3543.64.camel@tpoljak-laptop>
	 <004b01cadc19$660a88e0$321f9aa0$@de>  <004c01cadc1a$c395df40$4ac19dc0$@de>
Content-Type: text/plain; charset="UTF-8"
Date: Thu, 15 Apr 2010 13:41:02 +0200
Message-Id: <1271331662.4434.120.camel@tpoljak-laptop>
Mime-Version: 1.0
X-Mailer: Evolution 2.26.1 
Content-Transfer-Encoding: 8bit

Hi Uwe,
thank you very much for your answers. I've done Document and
NumericField reuse like this:

Document doc = getDocument();
NumericField dateField = new NumericField("date");

for each doc:

doc.add(dateField.setLongValue(Long.parseLong(DateTools.dateToString(date), DateTools.Resolution.MINUTE))));

,but changing it to:

Document doc = getDocument();
NumericField dateField = new NumericField("date");
doc.add(dateField);

for each doc:

dateField.setLongValue(Long.parseLong(DateTools.dateToString(date),
DateTools.Resolution.MINUTE)));

did the trick. Now indexing with NumericField takes minutes, not hours.

Thanks again,

Tomislav





On Wed, 2010-04-14 at 23:38 +0200, Uwe Schindler wrote:
> One addition:
> If you are indexing millions of numeric fields, you should also try to reuse NumericField and Document instances (as described in JavaDocs). NumericField creates internally a NumericTokenStream and lots of small objects (attributes), so GC cost may be high. This is just another idea.
> 
> Uwe
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
> 
> > -----Original Message-----
> > From: Uwe Schindler [mailto:uwe@thetaphi.de]
> > Sent: Wednesday, April 14, 2010 11:28 PM
> > To: java-user@lucene.apache.org
> > Subject: RE: NumericField indexing performance
> > 
> > Hi Tomislav,
> > 
> > indexing with NumericField takes longer (at least for the default
> > precision step of 4, which means out of 32 bit integers make 8 subterms
> > with each 4 bits of the value). So you produce 8 times more terms
> > during indexing that must be handled by the indexer. If you have lots
> > of documents, with distinct values the term index gets larger and
> > larger, but search performance increases dramatically (for
> > NumericRangeQueries). So if you index *only* numeric fields and nothing
> > else, a 8 times slower indexing can be true.
> > 
> > If you are not using NumericRangeQuery or you want tune indexing
> > performance, try larger precision Steps like 6 or 8. If you don’t use
> > NumericRangeQuery and only want to index the numeric terms as *one*
> > term, use precStep=Integer.MAX_VALUE. Also check your memory
> > requirements, as the indexer may need more memory and GC costs too
> > much. Also the index size will increase, so lots of more I/O is done.
> > Without more details I cannot say anything about your configuration. So
> > please tell us, how many documents, how many fields and how many
> > numeric fields in which configuration do you use?
> > 
> > Uwe
> > 
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> > 
> > 
> > > -----Original Message-----
> > > From: Tomislav Poljak [mailto:tpoljak@gmail.com]
> > > Sent: Wednesday, April 14, 2010 8:13 PM
> > > To: java-user@lucene.apache.org
> > > Subject: NumericField indexing performance
> > >
> > > Hi,
> > > is it normal for indexing time to increase up to 10 times after
> > > introducing NumericField instead of Field (for two fields)?
> > >
> > > I've changed two date fields from String representation (Field) to
> > > NumericField, now it is:
> > >
> > > doc.add(new NumericField("time").setIntValue(date.getTime()/24/3600))
> > >
> > > and after this change indexing took 10x more time (before it was few
> > > minutes and after more than an hour and half). I've tested with a
> > > simple
> > > counter like this:
> > >
> > > doc.add(new NumericField("endTime").setIntValue(count++))
> > >
> > > but nothing changed, it still takes around 10x longer. If I comment
> > > adding one numeric field to index time drops significantly and if I
> > > comment both fields indexing takes only few minutes again.
> > >
> > > Tomislav
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > 
> > 
> > 
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45814-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 12:00:41 2010
Return-Path: <java-user-return-45814-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91493 invoked from network); 15 Apr 2010 12:00:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 12:00:40 -0000
Received: (qmail 54536 invoked by uid 500); 15 Apr 2010 12:00:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54419 invoked by uid 500); 15 Apr 2010 12:00:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54411 invoked by uid 99); 15 Apr 2010 12:00:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 12:00:38 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.38.62] (HELO web50308.mail.re2.yahoo.com) (206.190.38.62)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 15 Apr 2010 12:00:31 +0000
Received: (qmail 65983 invoked by uid 60001); 15 Apr 2010 12:00:10 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271332810; bh=6hSq9tidy7++roLbgqYLmKbEoAAipHaZ73KxLUtzn8w=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=eOwX9eTVM3Hvu3GlrrsUNeGaPSKj7ozcoR4Ch9oosk5P1TnWkHjdMEl9amB1sYUKcyEmHQvS+es2vCrQJXkFji2kzI1yVfq3edjXTGQkMEJQrl5QWdIuCbEk4KksXqA+4/JGx5ZZuyjvWF+cE7Kxwvv60KBL1rAwzGI3ia4vDlc=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=5+Cju0L5BQ6n0hOot2F+YqusI+jJTqo+6Zdi3WCu8tTrqS8QEcqyjEYkVmGuIBo/zK/FKilUJ0uMPIAHBKnwONgu1jQ5vovrERgv75rW11gkFjHAi4ffoQDZ8A9CceZyJKEv7BG6DsAcpzaGY40AfDHbYSU5LOAT2qHSrbIsYHU=;
Message-ID: <33787.61536.qm@web50308.mail.re2.yahoo.com>
X-YMail-OSG: oA2ZzaMVM1kdob5mznbTBl4zQxcFd.hyBDxWOduy13rAKLE
 Nvbkc2DjPidpsfVE_LBNIc.0mk0T4NdjdQngziaRGXcyYsRMDk0ljsAYF7py
 VcVUzeQtNEmLjnmUqnmis5vrWVgPMF1cZ.xwUqJNv.7di7fC4T2VRUL6JsFe
 LlW5PNaXC73pTEAQV_JL8XJZ1h8MON034blT.WGzX5mls9aY6FSM_3F1SL.b
 gcqtLYeGRS1jbmeI3hnJ3fpueAvoHaZ_ZXhILzn08a5HSZfc.M1ILPfnOe4y
 n.jrYb791sTJuDrxXV.RZu_r9FA4r9qy2EVgwwUqujxDUaOtMAafXei0s6XO
 Izg--
Received: from [74.73.1.126] by web50308.mail.re2.yahoo.com via HTTP; Thu, 15 Apr 2010 05:00:09 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.102.267879
References: <1271268767.3543.64.camel@tpoljak-laptop>  <004b01cadc19$660a88e0$321f9aa0$@de>  <004c01cadc1a$c395df40$4ac19dc0$@de> <1271331662.4434.120.camel@tpoljak-laptop>
Date: Thu, 15 Apr 2010 05:00:09 -0700 (PDT)
From: Otis Gospodnetic <otis_gospodnetic@yahoo.com>
Subject: Re: NumericField indexing performance
To: java-user@lucene.apache.org
In-Reply-To: <1271331662.4434.120.camel@tpoljak-laptop>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,=0A=0AI actually don't follow your change, because after "but changing i=
t to" line the only different thing I see is the doc.add(dateField) call, w=
hich you didn't list before "but changing it to".=0A=0AAlso, if I understoo=
d Uwe correctly, he was suggesting reusing NumericField instances, which me=
ans "new NumericField("date")" should exist and be called for only *once* i=
n your code.  The same for Document instances.  GC threads will thank you a=
nd Uwe for this change.=0A Otis=0A----=0ASematext :: http://sematext.com/ :=
: Solr - Lucene - Nutch=0AHadoop ecosystem search :: http://search-hadoop.c=
om/=0A=0A=0A=0A----- Original Message ----=0A> From: Tomislav Poljak <tpolj=
ak@gmail.com>=0A> To: java-user@lucene.apache.org=0A> Sent: Thu, April 15, =
2010 7:41:02 AM=0A> Subject: RE: NumericField indexing performance=0A> =0A>=
 Hi Uwe,=0Athank you very much for your answers. I've done Document =0A> an=
d=0ANumericField reuse like this:=0A=0ADocument doc =3D =0A> getDocument();=
=0ANumericField dateField =3D new NumericField("date");=0A=0Afor =0A> each =
=0A> doc:=0A=0Adoc.add(dateField.setLongValue(Long.parseLong(DateTools.date=
ToString(date), =0A> DateTools.Resolution.MINUTE))));=0A=0A,but changing it=
 to:=0A=0ADocument doc =0A> =3D getDocument();=0ANumericField dateField =3D=
 new =0A> NumericField("date");=0Adoc.add(dateField);=0A=0Afor each =0A> do=
c:=0A=0AdateField.setLongValue(Long.parseLong(DateTools.dateToString(date),=
=0ADateTools.Resolution.MINUTE)));=0A=0Adid =0A> the trick. Now indexing wi=
th NumericField takes minutes, not =0A> hours.=0A=0AThanks again,=0A=0ATomi=
slav=0A=0A=0A=0A=0A=0AOn Wed, =0A> 2010-04-14 at 23:38 +0200, Uwe Schindler=
 wrote:=0A> One addition:=0A> If =0A> you are indexing millions of numeric =
fields, you should also try to reuse =0A> NumericField and Document instanc=
es (as described in JavaDocs). NumericField =0A> creates internally a Numer=
icTokenStream and lots of small objects (attributes), =0A> so GC cost may b=
e high. This is just another idea.=0A> =0A> Uwe=0A> =0A> =0A> -----=0A> Uwe=
 Schindler=0A> H.-H.-Meier-Allee 63, D-28213 =0A> Bremen=0A> =0A> >http://w=
ww.thetaphi.de=0A> eMail: =0A> href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi=
.de=0A> =0A> =0A> > =0A> -----Original Message-----=0A> > From: Uwe Schindl=
er [mailto:=0A> ymailto=3D"mailto:uwe@thetaphi.de" =0A> href=3D"mailto:uwe@=
thetaphi.de">uwe@thetaphi.de]=0A> > Sent: Wednesday, =0A> April 14, 2010 11=
:28 PM=0A> > To: =0A> ymailto=3D"mailto:java-user@lucene.apache.org" =0A> h=
ref=3D"mailto:java-user@lucene.apache.org">java-user@lucene.apache.org=0A> =
=0A> > Subject: RE: NumericField indexing performance=0A> > =0A> > =0A> Hi =
Tomislav,=0A> > =0A> > indexing with NumericField takes longer =0A> (at lea=
st for the default=0A> > precision step of 4, which means out of =0A> 32 bi=
t integers make 8 subterms=0A> > with each 4 bits of the value). So =0A> yo=
u produce 8 times more terms=0A> > during indexing that must be handled =0A=
> by the indexer. If you have lots=0A> > of documents, with distinct values=
 =0A> the term index gets larger and=0A> > larger, but search performance =
=0A> increases dramatically (for=0A> > NumericRangeQueries). So if you inde=
x =0A> *only* numeric fields and nothing=0A> > else, a 8 times slower index=
ing =0A> can be true.=0A> > =0A> > If you are not using NumericRangeQuery =
=0A> or you want tune indexing=0A> > performance, try larger precision Step=
s =0A> like 6 or 8. If you don=E2=80=99t use=0A> > NumericRangeQuery and on=
ly want to =0A> index the numeric terms as *one*=0A> > term, use =0A> precS=
tep=3DInteger.MAX_VALUE. Also check your memory=0A> > requirements, as =0A>=
 the indexer may need more memory and GC costs too=0A> > much. Also the =0A=
> index size will increase, so lots of more I/O is done.=0A> > Without more=
 =0A> details I cannot say anything about your configuration. So=0A> > plea=
se =0A> tell us, how many documents, how many fields and how many=0A> > num=
eric =0A> fields in which configuration do you use?=0A> > =0A> > Uwe=0A> =
=0A> > =0A> > -----=0A> > Uwe Schindler=0A> > =0A> H.-H.-Meier-Allee 63, D-=
28213 Bremen=0A> > =0A> href=3D"http://www.thetaphi.de" target=3D_blank >ht=
tp://www.thetaphi.de=0A> =0A> > eMail: =0A> href=3D"mailto:uwe@thetaphi.de"=
>uwe@thetaphi.de=0A> > =0A> > =0A> =0A> > > -----Original Message-----=0A> =
> > From: Tomislav =0A> Poljak [mailto:=0A> href=3D"mailto:tpoljak@gmail.co=
m">tpoljak@gmail.com]=0A> > > Sent: =0A> Wednesday, April 14, 2010 8:13 PM=
=0A> > > To: =0A> ymailto=3D"mailto:java-user@lucene.apache.org" =0A> href=
=3D"mailto:java-user@lucene.apache.org">java-user@lucene.apache.org=0A> =0A=
> > > Subject: NumericField indexing performance=0A> > >=0A> =0A> > > Hi,=
=0A> > > is it normal for indexing time to increase up to =0A> 10 times aft=
er=0A> > > introducing NumericField instead of Field (for =0A> two fields)?=
=0A> > >=0A> > > I've changed two date fields =0A> from String representati=
on (Field) to=0A> > > NumericField, now it =0A> is:=0A> > >=0A> > > doc.add=
(new =0A> NumericField("time").setIntValue(date.getTime()/24/3600))=0A> > =
=0A> >=0A> > > and after this change indexing took 10x more time (before =
=0A> it was few=0A> > > minutes and after more than an hour and half). I've=
 =0A> tested with a=0A> > > simple=0A> > > counter like =0A> this:=0A> > >=
=0A> > > doc.add(new =0A> NumericField("endTime").setIntValue(count++))=0A>=
 > >=0A> > =0A> > but nothing changed, it still takes around 10x longer. If=
 I comment=0A> =0A> > > adding one numeric field to index time drops signif=
icantly and if =0A> I=0A> > > comment both fields indexing takes only few m=
inutes =0A> again.=0A> > >=0A> > > Tomislav=0A> > >=0A> =0A> > >=0A> > > =
=0A> ---------------------------------------------------------------------=
=0A> =0A> > > To unsubscribe, e-mail: =0A> ymailto=3D"mailto:java-user-unsu=
bscribe@lucene.apache.org" =0A> href=3D"mailto:java-user-unsubscribe@lucene=
.apache.org">java-user-unsubscribe@lucene.apache.org=0A> =0A> > > For addit=
ional commands, e-mail: =0A> ymailto=3D"mailto:java-user-help@lucene.apache=
.org" =0A> href=3D"mailto:java-user-help@lucene.apache.org">java-user-help@=
lucene.apache.org=0A> =0A> > =0A> > =0A> > =0A> > =0A> --------------------=
-------------------------------------------------=0A> =0A> > To unsubscribe=
, e-mail: =0A> ymailto=3D"mailto:java-user-unsubscribe@lucene.apache.org" =
=0A> href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-unsu=
bscribe@lucene.apache.org=0A> =0A> > For additional commands, e-mail: =0A> =
ymailto=3D"mailto:java-user-help@lucene.apache.org" =0A> href=3D"mailto:jav=
a-user-help@lucene.apache.org">java-user-help@lucene.apache.org=0A> =0A> =
=0A> =0A> =0A> =0A> -------------------------------------------------------=
--------------=0A> To =0A> unsubscribe, e-mail: =0A> href=3D"mailto:java-us=
er-unsubscribe@lucene.apache.org">java-user-unsubscribe@lucene.apache.org=
=0A> =0A> For additional commands, e-mail: =0A> ymailto=3D"mailto:java-user=
-help@lucene.apache.org" =0A> href=3D"mailto:java-user-help@lucene.apache.o=
rg">java-user-help@lucene.apache.org=0A> =0A> =0A=0A=0A--------------------=
-------------------------------------------------=0ATo =0A> unsubscribe, e-=
mail: =0A> href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-use=
r-unsubscribe@lucene.apache.org=0AFor =0A> additional commands, e-mail: =0A=
> ymailto=3D"mailto:java-user-help@lucene.apache.org" =0A> href=3D"mailto:j=
ava-user-help@lucene.apache.org">java-user-help@lucene.apache.org

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45815-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 12:13:18 2010
Return-Path: <java-user-return-45815-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95436 invoked from network); 15 Apr 2010 12:13:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 12:13:17 -0000
Received: (qmail 66190 invoked by uid 500); 15 Apr 2010 12:13:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66135 invoked by uid 500); 15 Apr 2010 12:13:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66127 invoked by uid 99); 15 Apr 2010 12:13:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 12:13:15 +0000
X-ASF-Spam-Status: No, hits=-0.5 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 12:13:10 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 95D66D36007
	for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 14:12:47 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id kbMQxWBwyzCW for <java-user@lucene.apache.org>;
	Thu, 15 Apr 2010 14:12:42 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id A13A2D36005
	for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 14:12:41 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <1271268767.3543.64.camel@tpoljak-laptop>  <004b01cadc19$660a88e0$321f9aa0$@de>  <004c01cadc1a$c395df40$4ac19dc0$@de> <1271331662.4434.120.camel@tpoljak-laptop> <33787.61536.qm@web50308.mail.re2.yahoo.com>
In-Reply-To: <33787.61536.qm@web50308.mail.re2.yahoo.com>
Subject: RE: NumericField indexing performance
Date: Thu, 15 Apr 2010 14:12:48 +0200
Message-ID: <00b701cadc94$f6d44f20$e47ced60$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
thread-index: Acrck0pm4BiHeqENRPanfsX7TCm4VwAAJiig
Content-Language: de

Hi Tomislav,

when reading your mail its not 100% clear what you did wrong, but I =
think the following occurred (so its no GC problem):

You reused the Document and NumericField instance in your original =
approach. But on each document you called again doc.add(nf). By that for =
each document you added the field one more time to the document and =
after say thousand docs you have 1000 times the numeric field there and =
indexer indexes it therefore 1000 times. After 2000 docs it's there 2000 =
times so the indexing time raises exponentially.

So when you reuse doc instances you have to do do either:
- Don=E2=80=99t modify the fields at all (and also add no more fields) =
and just set field values and add doc to writer
- Clear the document and read fields

But don=E2=80=99t read fields without clearing! :-) That was your fault.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Otis Gospodnetic [mailto:otis_gospodnetic@yahoo.com]
> Sent: Thursday, April 15, 2010 2:00 PM
> To: java-user@lucene.apache.org
> Subject: Re: NumericField indexing performance
>=20
> Hi,
>=20
> I actually don't follow your change, because after "but changing it =
to"
> line the only different thing I see is the doc.add(dateField) call,
> which you didn't list before "but changing it to".
>=20
> Also, if I understood Uwe correctly, he was suggesting reusing
> NumericField instances, which means "new NumericField("date")" should
> exist and be called for only *once* in your code.  The same for
> Document instances.  GC threads will thank you and Uwe for this =
change.
>  Otis
> ----
> Sematext :: http://sematext.com/ :: Solr - Lucene - Nutch
> Hadoop ecosystem search :: http://search-hadoop.com/
>=20
>=20
>=20
> ----- Original Message ----
> > From: Tomislav Poljak <tpoljak@gmail.com>
> > To: java-user@lucene.apache.org
> > Sent: Thu, April 15, 2010 7:41:02 AM
> > Subject: RE: NumericField indexing performance
> >
> > Hi Uwe,
> thank you very much for your answers. I've done Document
> > and
> NumericField reuse like this:
>=20
> Document doc =3D
> > getDocument();
> NumericField dateField =3D new NumericField("date");
>=20
> for
> > each
> > doc:
>=20
> =
doc.add(dateField.setLongValue(Long.parseLong(DateTools.dateToString(da
> te),
> > DateTools.Resolution.MINUTE))));
>=20
> ,but changing it to:
>=20
> Document doc
> > =3D getDocument();
> NumericField dateField =3D new
> > NumericField("date");
> doc.add(dateField);
>=20
> for each
> > doc:
>=20
> dateField.setLongValue(Long.parseLong(DateTools.dateToString(date),
> DateTools.Resolution.MINUTE)));
>=20
> did
> > the trick. Now indexing with NumericField takes minutes, not
> > hours.
>=20
> Thanks again,
>=20
> Tomislav
>=20
>=20
>=20
>=20
>=20
> On Wed,
> > 2010-04-14 at 23:38 +0200, Uwe Schindler wrote:
> > One addition:
> > If
> > you are indexing millions of numeric fields, you should also try to
> reuse
> > NumericField and Document instances (as described in JavaDocs).
> NumericField
> > creates internally a NumericTokenStream and lots of small objects
> (attributes),
> > so GC cost may be high. This is just another idea.
> >
> > Uwe
> >
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213
> > Bremen
> >
> > >http://www.thetaphi.de
> > eMail:
> > href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi.de
> >
> >
> > >
> > -----Original Message-----
> > > From: Uwe Schindler [mailto:
> > ymailto=3D"mailto:uwe@thetaphi.de"
> > href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi.de]
> > > Sent: Wednesday,
> > April 14, 2010 11:28 PM
> > > To:
> > ymailto=3D"mailto:java-user@lucene.apache.org"
> > =
href=3D"mailto:java-user@lucene.apache.org">java-user@lucene.apache.org
> >
> > > Subject: RE: NumericField indexing performance
> > >
> > >
> > Hi Tomislav,
> > >
> > > indexing with NumericField takes longer
> > (at least for the default
> > > precision step of 4, which means out of
> > 32 bit integers make 8 subterms
> > > with each 4 bits of the value). So
> > you produce 8 times more terms
> > > during indexing that must be handled
> > by the indexer. If you have lots
> > > of documents, with distinct values
> > the term index gets larger and
> > > larger, but search performance
> > increases dramatically (for
> > > NumericRangeQueries). So if you index
> > *only* numeric fields and nothing
> > > else, a 8 times slower indexing
> > can be true.
> > >
> > > If you are not using NumericRangeQuery
> > or you want tune indexing
> > > performance, try larger precision Steps
> > like 6 or 8. If you don=E2=80=99t use
> > > NumericRangeQuery and only want to
> > index the numeric terms as *one*
> > > term, use
> > precStep=3DInteger.MAX_VALUE. Also check your memory
> > > requirements, as
> > the indexer may need more memory and GC costs too
> > > much. Also the
> > index size will increase, so lots of more I/O is done.
> > > Without more
> > details I cannot say anything about your configuration. So
> > > please
> > tell us, how many documents, how many fields and how many
> > > numeric
> > fields in which configuration do you use?
> > >
> > > Uwe
> >
> > >
> > > -----
> > > Uwe Schindler
> > >
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > >
> > href=3D"http://www.thetaphi.de" target=3D_blank =
>http://www.thetaphi.de
> >
> > > eMail:
> > href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi.de
> > >
> > >
> >
> > > > -----Original Message-----
> > > > From: Tomislav
> > Poljak [mailto:
> > href=3D"mailto:tpoljak@gmail.com">tpoljak@gmail.com]
> > > > Sent:
> > Wednesday, April 14, 2010 8:13 PM
> > > > To:
> > ymailto=3D"mailto:java-user@lucene.apache.org"
> > =
href=3D"mailto:java-user@lucene.apache.org">java-user@lucene.apache.org
> >
> > > > Subject: NumericField indexing performance
> > > >
> >
> > > > Hi,
> > > > is it normal for indexing time to increase up to
> > 10 times after
> > > > introducing NumericField instead of Field (for
> > two fields)?
> > > >
> > > > I've changed two date fields
> > from String representation (Field) to
> > > > NumericField, now it
> > is:
> > > >
> > > > doc.add(new
> > NumericField("time").setIntValue(date.getTime()/24/3600))
> > >
> > >
> > > > and after this change indexing took 10x more time (before
> > it was few
> > > > minutes and after more than an hour and half). I've
> > tested with a
> > > > simple
> > > > counter like
> > this:
> > > >
> > > > doc.add(new
> > NumericField("endTime").setIntValue(count++))
> > > >
> > >
> > > but nothing changed, it still takes around 10x longer. If I =
comment
> >
> > > > adding one numeric field to index time drops significantly and =
if
> > I
> > > > comment both fields indexing takes only few minutes
> > again.
> > > >
> > > > Tomislav
> > > >
> >
> > > >
> > > >
> > =
---------------------------------------------------------------------
> >
> > > > To unsubscribe, e-mail:
> > ymailto=3D"mailto:java-user-unsubscribe@lucene.apache.org"
> > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> unsubscribe@lucene.apache.org
> >
> > > > For additional commands, e-mail:
> > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> help@lucene.apache.org
> >
> > >
> > >
> > >
> > >
> > =
---------------------------------------------------------------------
> >
> > > To unsubscribe, e-mail:
> > ymailto=3D"mailto:java-user-unsubscribe@lucene.apache.org"
> > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> unsubscribe@lucene.apache.org
> >
> > > For additional commands, e-mail:
> > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> help@lucene.apache.org
> >
> >
> >
> >
> >
> > =
---------------------------------------------------------------------
> > To
> > unsubscribe, e-mail:
> > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> unsubscribe@lucene.apache.org
> >
> > For additional commands, e-mail:
> > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> help@lucene.apache.org
> >
> >
>=20
>=20
> ---------------------------------------------------------------------
> To
> > unsubscribe, e-mail:
> > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> unsubscribe@lucene.apache.org
> For
> > additional commands, e-mail:
> > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> help@lucene.apache.org
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45816-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 12:15:42 2010
Return-Path: <java-user-return-45816-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96307 invoked from network); 15 Apr 2010 12:15:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 12:15:42 -0000
Received: (qmail 68351 invoked by uid 500); 15 Apr 2010 12:15:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68323 invoked by uid 500); 15 Apr 2010 12:15:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68315 invoked by uid 99); 15 Apr 2010 12:15:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 12:15:40 +0000
X-ASF-Spam-Status: No, hits=-0.5 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 12:15:35 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 2EA02D36007
	for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 14:15:14 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id BaCiOQROdw4Y for <java-user@lucene.apache.org>;
	Thu, 15 Apr 2010 14:15:08 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 294B8D36005
	for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 14:15:08 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <1271268767.3543.64.camel@tpoljak-laptop>  <004b01cadc19$660a88e0$321f9aa0$@de>  <004c01cadc1a$c395df40$4ac19dc0$@de> <1271331662.4434.120.camel@tpoljak-laptop> <33787.61536.qm@web50308.mail.re2.yahoo.com> <00b701cadc94$f6d44f20$e47ced60$@de>
In-Reply-To: <00b701cadc94$f6d44f20$e47ced60$@de>
Subject: RE: NumericField indexing performance
Date: Thu, 15 Apr 2010 14:15:14 +0200
Message-ID: <00b801cadc95$4e266f60$ea734e20$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
thread-index: Acrck0pm4BiHeqENRPanfsX7TCm4VwAAJiigAABWuHA=
Content-Language: de

"Read" means "re-add", the spell checker in my mail program :-)

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Thursday, April 15, 2010 2:13 PM
> To: java-user@lucene.apache.org
> Subject: RE: NumericField indexing performance
>=20
> Hi Tomislav,
>=20
> when reading your mail its not 100% clear what you did wrong, but I
> think the following occurred (so its no GC problem):
>=20
> You reused the Document and NumericField instance in your original
> approach. But on each document you called again doc.add(nf). By that
> for each document you added the field one more time to the document =
and
> after say thousand docs you have 1000 times the numeric field there =
and
> indexer indexes it therefore 1000 times. After 2000 docs it's there
> 2000 times so the indexing time raises exponentially.
>=20
> So when you reuse doc instances you have to do do either:
> - Don=E2=80=99t modify the fields at all (and also add no more fields) =
and just
> set field values and add doc to writer
> - Clear the document and read fields
>=20
> But don=E2=80=99t read fields without clearing! :-) That was your =
fault.
>=20
> Uwe
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
> > -----Original Message-----
> > From: Otis Gospodnetic [mailto:otis_gospodnetic@yahoo.com]
> > Sent: Thursday, April 15, 2010 2:00 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: NumericField indexing performance
> >
> > Hi,
> >
> > I actually don't follow your change, because after "but changing it
> to"
> > line the only different thing I see is the doc.add(dateField) call,
> > which you didn't list before "but changing it to".
> >
> > Also, if I understood Uwe correctly, he was suggesting reusing
> > NumericField instances, which means "new NumericField("date")" =
should
> > exist and be called for only *once* in your code.  The same for
> > Document instances.  GC threads will thank you and Uwe for this
> change.
> >  Otis
> > ----
> > Sematext :: http://sematext.com/ :: Solr - Lucene - Nutch
> > Hadoop ecosystem search :: http://search-hadoop.com/
> >
> >
> >
> > ----- Original Message ----
> > > From: Tomislav Poljak <tpoljak@gmail.com>
> > > To: java-user@lucene.apache.org
> > > Sent: Thu, April 15, 2010 7:41:02 AM
> > > Subject: RE: NumericField indexing performance
> > >
> > > Hi Uwe,
> > thank you very much for your answers. I've done Document
> > > and
> > NumericField reuse like this:
> >
> > Document doc =3D
> > > getDocument();
> > NumericField dateField =3D new NumericField("date");
> >
> > for
> > > each
> > > doc:
> >
> >
> =
doc.add(dateField.setLongValue(Long.parseLong(DateTools.dateToString(da
> > te),
> > > DateTools.Resolution.MINUTE))));
> >
> > ,but changing it to:
> >
> > Document doc
> > > =3D getDocument();
> > NumericField dateField =3D new
> > > NumericField("date");
> > doc.add(dateField);
> >
> > for each
> > > doc:
> >
> > dateField.setLongValue(Long.parseLong(DateTools.dateToString(date),
> > DateTools.Resolution.MINUTE)));
> >
> > did
> > > the trick. Now indexing with NumericField takes minutes, not
> > > hours.
> >
> > Thanks again,
> >
> > Tomislav
> >
> >
> >
> >
> >
> > On Wed,
> > > 2010-04-14 at 23:38 +0200, Uwe Schindler wrote:
> > > One addition:
> > > If
> > > you are indexing millions of numeric fields, you should also try =
to
> > reuse
> > > NumericField and Document instances (as described in JavaDocs).
> > NumericField
> > > creates internally a NumericTokenStream and lots of small objects
> > (attributes),
> > > so GC cost may be high. This is just another idea.
> > >
> > > Uwe
> > >
> > >
> > > -----
> > > Uwe Schindler
> > > H.-H.-Meier-Allee 63, D-28213
> > > Bremen
> > >
> > > >http://www.thetaphi.de
> > > eMail:
> > > href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi.de
> > >
> > >
> > > >
> > > -----Original Message-----
> > > > From: Uwe Schindler [mailto:
> > > ymailto=3D"mailto:uwe@thetaphi.de"
> > > href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi.de]
> > > > Sent: Wednesday,
> > > April 14, 2010 11:28 PM
> > > > To:
> > > ymailto=3D"mailto:java-user@lucene.apache.org"
> > > href=3D"mailto:java-user@lucene.apache.org">java-
> user@lucene.apache.org
> > >
> > > > Subject: RE: NumericField indexing performance
> > > >
> > > >
> > > Hi Tomislav,
> > > >
> > > > indexing with NumericField takes longer
> > > (at least for the default
> > > > precision step of 4, which means out of
> > > 32 bit integers make 8 subterms
> > > > with each 4 bits of the value). So
> > > you produce 8 times more terms
> > > > during indexing that must be handled
> > > by the indexer. If you have lots
> > > > of documents, with distinct values
> > > the term index gets larger and
> > > > larger, but search performance
> > > increases dramatically (for
> > > > NumericRangeQueries). So if you index
> > > *only* numeric fields and nothing
> > > > else, a 8 times slower indexing
> > > can be true.
> > > >
> > > > If you are not using NumericRangeQuery
> > > or you want tune indexing
> > > > performance, try larger precision Steps
> > > like 6 or 8. If you don=E2=80=99t use
> > > > NumericRangeQuery and only want to
> > > index the numeric terms as *one*
> > > > term, use
> > > precStep=3DInteger.MAX_VALUE. Also check your memory
> > > > requirements, as
> > > the indexer may need more memory and GC costs too
> > > > much. Also the
> > > index size will increase, so lots of more I/O is done.
> > > > Without more
> > > details I cannot say anything about your configuration. So
> > > > please
> > > tell us, how many documents, how many fields and how many
> > > > numeric
> > > fields in which configuration do you use?
> > > >
> > > > Uwe
> > >
> > > >
> > > > -----
> > > > Uwe Schindler
> > > >
> > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > >
> > > href=3D"http://www.thetaphi.de" target=3D_blank =
>http://www.thetaphi.de
> > >
> > > > eMail:
> > > href=3D"mailto:uwe@thetaphi.de">uwe@thetaphi.de
> > > >
> > > >
> > >
> > > > > -----Original Message-----
> > > > > From: Tomislav
> > > Poljak [mailto:
> > > href=3D"mailto:tpoljak@gmail.com">tpoljak@gmail.com]
> > > > > Sent:
> > > Wednesday, April 14, 2010 8:13 PM
> > > > > To:
> > > ymailto=3D"mailto:java-user@lucene.apache.org"
> > > href=3D"mailto:java-user@lucene.apache.org">java-
> user@lucene.apache.org
> > >
> > > > > Subject: NumericField indexing performance
> > > > >
> > >
> > > > > Hi,
> > > > > is it normal for indexing time to increase up to
> > > 10 times after
> > > > > introducing NumericField instead of Field (for
> > > two fields)?
> > > > >
> > > > > I've changed two date fields
> > > from String representation (Field) to
> > > > > NumericField, now it
> > > is:
> > > > >
> > > > > doc.add(new
> > > NumericField("time").setIntValue(date.getTime()/24/3600))
> > > >
> > > >
> > > > > and after this change indexing took 10x more time (before
> > > it was few
> > > > > minutes and after more than an hour and half). I've
> > > tested with a
> > > > > simple
> > > > > counter like
> > > this:
> > > > >
> > > > > doc.add(new
> > > NumericField("endTime").setIntValue(count++))
> > > > >
> > > >
> > > > but nothing changed, it still takes around 10x longer. If I
> comment
> > >
> > > > > adding one numeric field to index time drops significantly and
> if
> > > I
> > > > > comment both fields indexing takes only few minutes
> > > again.
> > > > >
> > > > > Tomislav
> > > > >
> > >
> > > > >
> > > > >
> > > =
-------------------------------------------------------------------
> --
> > >
> > > > > To unsubscribe, e-mail:
> > > ymailto=3D"mailto:java-user-unsubscribe@lucene.apache.org"
> > > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> > unsubscribe@lucene.apache.org
> > >
> > > > > For additional commands, e-mail:
> > > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> > help@lucene.apache.org
> > >
> > > >
> > > >
> > > >
> > > >
> > > =
-------------------------------------------------------------------
> --
> > >
> > > > To unsubscribe, e-mail:
> > > ymailto=3D"mailto:java-user-unsubscribe@lucene.apache.org"
> > > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> > unsubscribe@lucene.apache.org
> > >
> > > > For additional commands, e-mail:
> > > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> > help@lucene.apache.org
> > >
> > >
> > >
> > >
> > >
> > > =
-------------------------------------------------------------------
> --
> > > To
> > > unsubscribe, e-mail:
> > > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> > unsubscribe@lucene.apache.org
> > >
> > > For additional commands, e-mail:
> > > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> > help@lucene.apache.org
> > >
> > >
> >
> >
> > =
---------------------------------------------------------------------
> > To
> > > unsubscribe, e-mail:
> > > href=3D"mailto:java-user-unsubscribe@lucene.apache.org">java-user-
> > unsubscribe@lucene.apache.org
> > For
> > > additional commands, e-mail:
> > > ymailto=3D"mailto:java-user-help@lucene.apache.org"
> > > href=3D"mailto:java-user-help@lucene.apache.org">java-user-
> > help@lucene.apache.org
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45817-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 13:04:19 2010
Return-Path: <java-user-return-45817-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16379 invoked from network); 15 Apr 2010 13:04:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 13:04:19 -0000
Received: (qmail 25192 invoked by uid 500); 15 Apr 2010 13:04:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25164 invoked by uid 500); 15 Apr 2010 13:04:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25156 invoked by uid 99); 15 Apr 2010 13:04:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 13:04:17 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of franzroth@gmx.de designates 213.165.64.20 as permitted sender)
Received: from [213.165.64.20] (HELO mail.gmx.net) (213.165.64.20)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 15 Apr 2010 13:04:11 +0000
Received: (qmail 28904 invoked by uid 0); 15 Apr 2010 13:03:44 -0000
Received: from 217.228.175.107 by www051.gmx.net with HTTP;
 Thu, 15 Apr 2010 15:03:37 +0200 (CEST)
Content-Type: text/plain; charset="iso-8859-1"
Date: Thu, 15 Apr 2010 15:03:37 +0200
From: "Franz Roth" <franzroth@gmx.de>
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F3B81E23E@suex07-mbx-03.ad.syr.edu>
Message-ID: <20100415130337.182200@gmx.net>
MIME-Version: 1.0
References: <20100414114209.294260@gmx.net>
 <2D127F11DC79714E9B6A43AC9458147F3B81E23E@suex07-mbx-03.ad.syr.edu>
Subject: Re: RE: PrefixQuery and special characters
To: java-user@lucene.apache.org
X-Authenticated: #6704461
X-Flags: 0001
X-Mailer: WWW-Mail 6100 (Global Message Exchange)
X-Priority: 3
X-Provags-ID: V01U2FsdGVkX18KEuEeXKEKErbCVbspXCJ0e1W2ZAXrtX4i4r8++6
 14cofOcVSzaeNzGQaiib/RwlA5+EaAt0Z85g== 
Content-Transfer-Encoding: 8bit
X-GMX-UID: nTn1ehhvIydmaGgoEmdrvENSa2FkZpWB
X-FuHaFi: 0.46999999999999997

Tnx Steve, 
this solved the minor problem (finding two documents). 
The maior problem (and customers bugreport) was not to find "(test". Now solved: Indeed I should not use QueryParser.escape(...) by building a PrefixQuery.
kind regards


-------- Original-Nachricht --------
> Datum: Wed, 14 Apr 2010 08:24:38 -0400
> Von: Steven A Rowe <sarowe@syr.edu>
> An: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
> Betreff: RE: PrefixQuery and special characters

> Hi Franz,
> 
> The likely problem is that you're using an index-time analyzer that strips
> out the parentheses.  StandardAnalyzer, for example, does this;
> WhitespaceAnalyzer does not.
> 
> Remember that hits are the result of matches between index-analyzed terms
> and query-analyzed terms.  Except in the case of synonyms, most people will
> want their index and query analyzers to be the same.
> 
> Steve
> 
> ________________________________________
> From: Franz Roth [franzroth@gmx.de]
> Sent: Wednesday, April 14, 2010 7:42 AM
> To: java-user@lucene.apache.org
> Subject: PrefixQuery and special characters
> 
> Hi all,
> 
> say I have an Index with one field named "category". There are two
> documents one with value "(testvalue)" and one with value "test value".
> Now somone search with "test". My Searchenine uses the
> org.apache.lucene.search.PrefixQuery and finds 2 documents. Maybe he  estimated only one hit;
> owever: if he searches for "(test" and the Searchengine uses the
> QueryParser.escape to clean the request and takes that PrefixQuery to search nothing
> results.
> 
> How can I search for the document "(testvalue)" and only this one?
> 
> Thx!
> 
> 
> 
> 
> 
> package foo.bar;
> 
> import java.io.IOException;
> 
> import junit.framework.TestCase;
> 
> import org.apache.log4j.Logger;
> import org.apache.lucene.analysis.standard.StandardAnalyzer;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.document.Field;
> import org.apache.lucene.index.CorruptIndexException;
> import org.apache.lucene.index.IndexWriter;
> import org.apache.lucene.index.Term;
> import org.apache.lucene.queryParser.QueryParser;
> import org.apache.lucene.search.IndexSearcher;
> import org.apache.lucene.search.PrefixQuery;
> import org.apache.lucene.search.ScoreDoc;
> import org.apache.lucene.store.LockObtainFailedException;
> import org.apache.lucene.store.RAMDirectory;
> 
> 
> 
> public class TestPrefixQuery extends TestCase {
>         public void testEscapeAndPrefix() throws CorruptIndexException,
>         LockObtainFailedException, IOException {
> 
>             RAMDirectory directory = new RAMDirectory();
>             IndexWriter writer = new IndexWriter(directory, new
> StandardAnalyzer(),
>                     true, IndexWriter.MaxFieldLength.LIMITED);
>             Document doc = new Document();
>             doc.add(new Field("category", "(testvalue)", Field.Store.YES,
>                     Field.Index.ANALYZED));
>             writer.addDocument(doc);
>             doc = new Document();
>             doc.add(new Field("category", "test value", Field.Store.YES,
>                 Field.Index.ANALYZED));
>             writer.addDocument(doc);
>             writer.close();
> 
>             String value= "test";
>             PrefixQuery query = new PrefixQuery(new Term("category",
> value));
>             //log.debug(query.toString());
>             IndexSearcher searcher = new IndexSearcher(directory);
>             ScoreDoc[] hits = searcher.search(query, null,
> 1000).scoreDocs;
>             assertEquals("One for " + value , 2, hits.length); //I want
> one for this?!
> 
>             value= "(test";
>             String escaped = QueryParser.escape(value);
>             query = new PrefixQuery(new Term("category", escaped));
>             //log.debug(query.toString());
>             hits = searcher.search(query, null, 1000).scoreDocs;
>             assertEquals("One for " + value + "/" + escaped, 1,
> hits.length); //FAILS!
>         }
> }
> 
> --
> GRATIS fr alle GMX-Mitglieder: Die maxdome Movie-FLAT!
> Jetzt freischalten unter http://portal.gmx.net/de/go/maxdome01
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org

-- 
GRATIS fr alle GMX-Mitglieder: Die maxdome Movie-FLAT!
Jetzt freischalten unter http://portal.gmx.net/de/go/maxdome01

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45818-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 15:25:00 2010
Return-Path: <java-user-return-45818-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59766 invoked from network); 15 Apr 2010 15:25:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 15:25:00 -0000
Received: (qmail 83861 invoked by uid 500); 15 Apr 2010 15:24:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83828 invoked by uid 500); 15 Apr 2010 15:24:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83820 invoked by uid 99); 15 Apr 2010 15:24:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 15:24:56 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.156 as permitted sender)
Received: from [72.14.220.156] (HELO fg-out-1718.google.com) (72.14.220.156)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 15:24:50 +0000
Received: by fg-out-1718.google.com with SMTP id 22so2231410fge.5
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 08:24:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=NzuF7R2ThNAkYEecW3wLA0FK0YpFGJxynRlFQdUW5VE=;
        b=ne4qTSACW7Xk0nnsH+yKpCsJAL/rPGFF+LpJBlAaIcpC3oxgOfd+1iziR6zqq30NqY
         p2TQ4PHeVuGScteGH/PUL9HNITvXNIPHP7kWTpAnMFQdIwr6vepMVHxL49Fu8YszujC6
         5AWQ719taIVgmzf3y84YsKx5fhQfmKvi8P1X8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=VM2kW0IeFqDQA0JUjYJNOVjB4XrE1jh4i0HmTpnE1lrHopFVV0gT3sHOLfPlFNZ474
         fTYQuMVhpu4CQpubO+GPmULLxzB/EwAPv68vaqjNpxZNog0NG0QAIupp1j0t0YB39A7i
         k850w6/+u9c5qdwSxKWf57RzyWpCyZg9LWKEs=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Thu, 15 Apr 2010 08:24:30 -0700 (PDT)
In-Reply-To: <o2rf071061b1004150111w757f696ct49bb7c36a073e735@mail.gmail.com>
References: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
	 <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
	 <o2rf071061b1004150111w757f696ct49bb7c36a073e735@mail.gmail.com>
Date: Thu, 15 Apr 2010 17:24:30 +0200
Received: by 10.223.50.193 with SMTP id a1mr95672fag.34.1271345070041; Thu, 15 
	Apr 2010 08:24:30 -0700 (PDT)
Message-ID: <r2pf071061b1004150824y7c4ad80fm97b085a28e05f212@mail.gmail.com>
Subject: Re: trying to resolve error: after flush: fdx size mismatch
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

not sure if it matters, but I have to correct my statment, where this
has happened was both times win2008 R1 64bits, local filesystem.

I am trying to reproduce in my dev workstation but unable so far.

On Thu, Apr 15, 2010 at 10:11 AM, jm <jmuguruza@gmail.com> wrote:
> Hi Mike
>
> I have a server side, exposes a webservice with operations (this is
> simplified ignoring things non lucene related):
> - addToIndex(doc, date)
> - flushAllIndexes()
>
> addToIndex() adds the doc to the index, the index is chosen based on
> the date (simplified it's one index per day). To speed this up the
> webservice keeps a cache of IndexWriters. =A0If the index is already
> open it uses it, otherwise adds it to the cache (the index is created
> if it does not exist). I have a listener on the cache expiration so
> the index is closed when it is removed from the cache (the cache has
> only 10 items).
>
> flushAllIndexes() just gets all indexes open on the cache and closes them=
 all.
>
> The webservice can serve many requests at the same time, but all
> operations dealing with lucene are synchonized. I guess this is most
> likely a bug in my synching code etc so I have verified it many times.
> Even trying to reproduce the issue by stopping threads in a debugger
> worked fine, synchronized methods were working as expected (I
> understand am probably =A0missing the case that triggers the issue).
>
> The last time this happened there was a single thread (in the client)
> calling addToIndex(doc, date) many times and then it called
> flushAllIndexes() The next second I got the error. The client
> developer assures me the call to flushAllIndexes() as in the same
> thread as addToIndex(doc, date) (anyway, it should work even if it was
> different threads of course).
>
> yes, local filesystem under Vista Business sp1 32b.
>
> Hope this helps. I am just now developing a client that pounds the
> server with some threads calling the methods all the time to try to
> reproduce the issue.
>
> javier
>
> On Thu, Apr 15, 2010 at 1:47 AM, Michael McCandless
> <lucene@mikemccandless.com> wrote:
>> Not good!
>>
>> Can you describe how your threads work with Lucene?
>>
>> Is this just a local filesystem (disk) under vista?
>>
>> Mike
>>
>> On Wed, Apr 14, 2010 at 7:41 AM, jm <jmuguruza@gmail.com> wrote:
>>> Hi,
>>>
>>> I am trying to chase an issue in our code and it is being quite
>>> difficult. We have seen two instances (see below) where we get the
>>> same error. I have been trying to reproduce but it has been impossible
>>> so far.I have several threads, some might be creating indices and
>>> adding documents, others closing indices etc. =A0In the list this
>>> message appear several times, in some cases it was a lucene bug (not
>>> my case, I dont have millions of docs here) and in other it seems bad
>>> multithreading. I have verified my multithreaded code for the 5th time
>>> and all seems well synchronized.
>>>
>>> So I am asking if somebody can give me any hint, maybe the fact that
>>> the first number is always a 1 means something?? =A0I suspect the issue
>>> is when a new index is just created maybe.
>>>
>>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>>> 103 length in bytes of _2.fdx file exists?=3Dtrue
>>> org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsWr=
iter.java:97)
>>> org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProcess=
or.java:50)
>>> org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.j=
ava:380)
>>> org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:581)
>>> org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:42=
94)
>>> org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:4192)
>>> org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:4183)
>>> org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:2190=
)
>>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2153)
>>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2117)
>>>
>>>
>>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>>> 8457 length in bytes of _0.fdx file exists?=3Dtrue ...
>>>
>>> My env is vista, jdk1.6, lucene 2.9.1
>>> thanks in advance.
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45819-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 22:35:18 2010
Return-Path: <java-user-return-45819-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19957 invoked from network); 15 Apr 2010 22:35:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 22:35:18 -0000
Received: (qmail 97916 invoked by uid 500); 15 Apr 2010 22:35:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97884 invoked by uid 500); 15 Apr 2010 22:35:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97876 invoked by uid 99); 15 Apr 2010 22:35:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 22:35:16 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of andrhahn@hotmail.com designates 65.55.90.111 as permitted sender)
Received: from [65.55.90.111] (HELO snt0-omc2-s36.snt0.hotmail.com) (65.55.90.111)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 22:35:08 +0000
Received: from SNT135-W14 ([65.55.90.72]) by snt0-omc2-s36.snt0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 15 Apr 2010 15:34:47 -0700
Message-ID: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_56192f65-f824-4e9a-a915-35f4a965cf62_"
X-Originating-IP: [151.151.109.13]
From: Andy <andrhahn@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: How to search multiple fields using multiple search terms
Date: Thu, 15 Apr 2010 17:34:46 -0500
Importance: Normal
MIME-Version: 1.0
X-OriginalArrivalTime: 15 Apr 2010 22:34:47.0145 (UTC) FILETIME=[DA4DFD90:01CADCEB]
X-Virus-Checked: Checked by ClamAV on apache.org

--_56192f65-f824-4e9a-a915-35f4a965cf62_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


Hi=2C I am trying to use the MultiFieldQueryParser to search "title" and "d=
esc" fields.  However the Lucene API appears to only let me provide a singl=
e search term.  Is it possible to use multiple search terms (one for each f=
ield)?

=20

For example=2C the SQL equivalent would be:


select *
from lucene
where title =3D 'abc'
and desc =3D '123'


Thanks!
 		 	   		 =20
_________________________________________________________________
Hotmail has tools for the New Busy. Search=2C chat and e-mail from your inb=
ox.
http://www.windowslive.com/campaign/thenewbusy?ocid=3DPID28326::T:WLMTAGL:O=
N:WL:en-US:WM_HMP:042010_1=

--_56192f65-f824-4e9a-a915-35f4a965cf62_--

From java-user-return-45820-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 15 23:33:18 2010
Return-Path: <java-user-return-45820-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84403 invoked from network); 15 Apr 2010 23:33:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Apr 2010 23:33:18 -0000
Received: (qmail 50831 invoked by uid 500); 15 Apr 2010 23:33:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50777 invoked by uid 500); 15 Apr 2010 23:33:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50769 invoked by uid 99); 15 Apr 2010 23:33:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 23:33:16 +0000
X-ASF-Spam-Status: No, hits=0.4 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Apr 2010 23:33:11 +0000
Received: by gyf1 with SMTP id 1so977123gyf.35
        for <java-user@lucene.apache.org>; Thu, 15 Apr 2010 16:32:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=+jrefG+Xs34KQmepVzMA2KZe0BzmyHy7KKJxvxoQivE=;
        b=RSXvNp/m1VDEjPbApGRub+qnVQ/6MlCo01f0LxDH2EyJYVTcyKt/h91kjEaRREMGRo
         5Ddn0NhxK1/5EDUwltptCtA6/W0Vld2le1XXoFHRSE2TdYy7xABt2jNZPs41ofsHnpxc
         q9BQ2cgdAjIuEa0Wtyacjs1m2gZyzIcEWdNqc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=otdgIcIIzA7WUdGyFxPFTjIp5ayBtdMooYDNZ6lUKLLQH/x14xxC1ndOfBWvYXYBbx
         KVA+mWaL/1pXkC1PAGR1cUVPKQd1TgicZUcX8CbhNNRHlPe6cGTQl803iLrhIl23V0nJ
         DWoPHaDkKb6Iy7H2SHTCC1pPhIVxqWm0Eri3s=
MIME-Version: 1.0
Received: by 10.150.199.5 with HTTP; Thu, 15 Apr 2010 16:32:50 -0700 (PDT)
In-Reply-To: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>
References: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>
Date: Thu, 15 Apr 2010 19:32:50 -0400
Received: by 10.150.210.16 with SMTP id i16mr922218ybg.70.1271374370274; Thu, 
	15 Apr 2010 16:32:50 -0700 (PDT)
Message-ID: <h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com>
Subject: Re: How to search multiple fields using multiple search terms
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd379aab7805f04844ee965

--000e0cd379aab7805f04844ee965
Content-Type: text/plain; charset=ISO-8859-1

Why are you locked into using MultiFieldQueryParser? The simpler approach is
just send something like +title:abc +desc:123 through the regular query
parser....

HTH
Erick

On Thu, Apr 15, 2010 at 6:34 PM, Andy <andrhahn@hotmail.com> wrote:

>
> Hi, I am trying to use the MultiFieldQueryParser to search "title" and
> "desc" fields.  However the Lucene API appears to only let me provide a
> single search term.  Is it possible to use multiple search terms (one for
> each field)?
>
>
>
> For example, the SQL equivalent would be:
>
>
> select *
> from lucene
> where title = 'abc'
> and desc = '123'
>
>
> Thanks!
>
> _________________________________________________________________
> Hotmail has tools for the New Busy. Search, chat and e-mail from your
> inbox.
>
> http://www.windowslive.com/campaign/thenewbusy?ocid=PID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_1
>

--000e0cd379aab7805f04844ee965--

From java-user-return-45821-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 04:31:53 2010
Return-Path: <java-user-return-45821-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94418 invoked from network); 16 Apr 2010 04:31:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 04:31:53 -0000
Received: (qmail 50929 invoked by uid 500); 16 Apr 2010 04:31:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50784 invoked by uid 500); 16 Apr 2010 04:31:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50775 invoked by uid 99); 16 Apr 2010 04:31:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 04:31:50 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of andrhahn@hotmail.com designates 65.55.90.97 as permitted sender)
Received: from [65.55.90.97] (HELO snt0-omc2-s22.snt0.hotmail.com) (65.55.90.97)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 04:31:42 +0000
Received: from SNT135-W14 ([65.55.90.73]) by snt0-omc2-s22.snt0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 15 Apr 2010 21:31:21 -0700
Message-ID: <SNT135-w14B814472665EEC6226E66D90E0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_27e860b2-0ac8-4d73-bee9-fa0bafe888ba_"
X-Originating-IP: [151.151.109.11]
From: Andy <andrhahn@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: RE: How to search multiple fields using multiple search terms
Date: Thu, 15 Apr 2010 23:31:21 -0500
Importance: Normal
In-Reply-To: <h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com>
References:
 <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>,<h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com>
MIME-Version: 1.0
X-OriginalArrivalTime: 16 Apr 2010 04:31:21.0229 (UTC) FILETIME=[AA2C23D0:01CADD1D]
X-Virus-Checked: Checked by ClamAV on apache.org

--_27e860b2-0ac8-4d73-bee9-fa0bafe888ba_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


I am just getting started with Lucene so I didnt know you could just use a =
regular query parser.  That seems to work.

Thanks


=20
> Date: Thu=2C 15 Apr 2010 19:32:50 -0400
> Subject: Re: How to search multiple fields using multiple search terms
> From: erickerickson@gmail.com
> To: java-user@lucene.apache.org
>=20
> Why are you locked into using MultiFieldQueryParser? The simpler approach=
 is
> just send something like +title:abc +desc:123 through the regular query
> parser....
>=20
> HTH
> Erick
>=20
> On Thu=2C Apr 15=2C 2010 at 6:34 PM=2C Andy <andrhahn@hotmail.com> wrote:
>=20
> >
> > Hi=2C I am trying to use the MultiFieldQueryParser to search "title" an=
d
> > "desc" fields. However the Lucene API appears to only let me provide a
> > single search term. Is it possible to use multiple search terms (one fo=
r
> > each field)?
> >
> >
> >
> > For example=2C the SQL equivalent would be:
> >
> >
> > select *
> > from lucene
> > where title =3D 'abc'
> > and desc =3D '123'
> >
> >
> > Thanks!
> >
> > _________________________________________________________________
> > Hotmail has tools for the New Busy. Search=2C chat and e-mail from your
> > inbox.
> >
> > http://www.windowslive.com/campaign/thenewbusy?ocid=3DPID28326::T:WLMTA=
GL:ON:WL:en-US:WM_HMP:042010_1
> >
 		 	   		 =20
_________________________________________________________________
The New Busy think 9 to 5 is a cute idea. Combine multiple calendars with H=
otmail.=20
http://www.windowslive.com/campaign/thenewbusy?tile=3Dmulticalendar&ocid=3D=
PID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_5=

--_27e860b2-0ac8-4d73-bee9-fa0bafe888ba_--

From java-user-return-45822-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 06:17:30 2010
Return-Path: <java-user-return-45822-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10836 invoked from network); 16 Apr 2010 06:17:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 06:17:30 -0000
Received: (qmail 1943 invoked by uid 500); 16 Apr 2010 06:17:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1771 invoked by uid 500); 16 Apr 2010 06:17:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1763 invoked by uid 99); 16 Apr 2010 06:17:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 06:17:27 +0000
X-ASF-Spam-Status: No, hits=2.1 required=10.0
	tests=FREEMAIL_FROM,SPF_PASS,STOX_REPLY_TYPE,STOX_REPLY_TYPE_WITHOUT_QUOTES,UNPARSEABLE_RELAY
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris_b@inbox.com designates 64.135.83.55 as permitted sender)
Received: from [64.135.83.55] (HELO WM55.inbox.com) (64.135.83.55)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 16 Apr 2010 06:17:21 +0000
Received: from inbox.com (127.0.0.1:25)
	by inbox.com with [InBox.Com SMTP Server]
	id <1004152215003.WM55> for <java-user@lucene.apache.org> from <chris_b@inbox.com>;
	Thu, 15 Apr 2010 22:15:35 -0800
Received: from chris_b@inbox.com by (64.135.83.157:25) via WM55.inbox.com
  (94.170.221.62:2339) with [InBox.Com SMTP Server] id 1004152215006.WM57;
  Thu, 15 Apr 2010 22:15:40 -0800
Message-ID: <005d01cadd2c$6b81f920$6400a8c0@dev>
From: "Chris B" <chris_b@inbox.com>
To: <java-user@lucene.apache.org>
References: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>,<h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com> <SNT135-w14B814472665EEC6226E66D90E0@phx.gbl>
Subject: Doc Caching
Date: Fri, 16 Apr 2010 07:16:13 +0100
MIME-Version: 1.0
Content-Type: text/plain; format=flowed; charset=iso-8859-1;
  reply-type=original
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.2180
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.2180
X-IWM-ACU: 9jJkEnoTs2kuMA4GpHyCExJi-bg2Dl7iaBZ6CYNuwkA7VeRG_QLtzVhm3ayr
  zN6kFYr486CCDOBGLJt1bLb9JgZWGP7Y_-Q3uVWrV-igxv9CmarYig5Hk9_L
  DEcc8TO2Ll68@
X-Virus-Checked: Checked by ClamAV on apache.org

Hi

Does Lucene cache the documents it retrieves? If so in which object?

Chris

____________________________________________________________
GET FREE 5GB EMAIL - Check out spam free email with many cool features=21
Visit http://www.inbox.com/email to find out more=21

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45823-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 11:58:13 2010
Return-Path: <java-user-return-45823-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5897 invoked from network); 16 Apr 2010 11:58:13 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 11:58:13 -0000
Received: (qmail 49929 invoked by uid 500); 16 Apr 2010 11:58:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49772 invoked by uid 500); 16 Apr 2010 11:58:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49763 invoked by uid 99); 16 Apr 2010 11:58:10 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 11:58:10 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of ajay978@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 11:58:03 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <ajay978@gmail.com>)
	id 1O2kB5-0005VV-1q
	for java-user@lucene.apache.org; Fri, 16 Apr 2010 04:57:43 -0700
Date: Fri, 16 Apr 2010 03:57:43 -0800 (PST)
From: Ajay_978 <ajay978@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271419063051-723757.post@n3.nabble.com>
Subject: Payload Example for Lucene 3.0.0
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,
I would like to have example of adding payload for lucene 3.0. I found an
example on internet which uses BoostingTermQuery but I couldn't find this
class in Lucene 3.0.0 jar and I was wondering if someone knows the
workaround or where can I find. If someone can post an example that will be
very helpful.

Thanks
Ajay
-- 
View this message in context: http://n3.nabble.com/Payload-Example-for-Lucene-3-0-0-tp723757p723757.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From apmail-lucene-java-user-archive@www.apache.org Fri Apr 16 12:16:54 2010
Return-Path: <apmail-lucene-java-user-archive@www.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12687 invoked from network); 16 Apr 2010 12:16:53 -0000
Received: from unknown (HELO bd65c779.virtua.com.br) (189.101.199.121)
  by 140.211.11.9 with SMTP; 16 Apr 2010 12:16:53 -0000
From:  Pfizer Inc  1822-2010 <apmail-lucene-java-user-archive@www.apache.org>
To: apmail-lucene-java-user-archive@www.apache.org
Subject: RE: apmail-lucene-java-user-archive@www.apache.org April 72% off
Mime-Version: 1.0
Content-type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 7bit

Dear apmail-lucene-java-user-archive@www.apache.org
Get ready to make her happy.
Discount price store: ID7946794
http://dgn.nationfab.ru?aua
We do guarantee high-quality medications, instant worldwide delivery and friendly support. 
 2001-2010 Pfizer Inc. All rights reserved.



From java-user-return-45824-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 13:03:43 2010
Return-Path: <java-user-return-45824-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34392 invoked from network); 16 Apr 2010 13:03:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 13:03:42 -0000
Received: (qmail 39019 invoked by uid 500); 16 Apr 2010 13:03:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38979 invoked by uid 500); 16 Apr 2010 13:03:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38971 invoked by uid 99); 16 Apr 2010 13:03:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 13:03:40 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of samarzone@gmail.com designates 209.85.222.196 as permitted sender)
Received: from [209.85.222.196] (HELO mail-pz0-f196.google.com) (209.85.222.196)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 13:03:32 +0000
Received: by pzk34 with SMTP id 34so1837355pzk.20
        for <java-user@lucene.apache.org>; Fri, 16 Apr 2010 06:03:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=YiTfGuQpoSgDnmGsrV6V5QUQ9unyOVxS64xV87j94oU=;
        b=Z7PN9svgwhLuM2QVgCAlIgRPQn6ETD2QWEk4/qU/I8BNLLD/5DnXwgE/SyRvtO4TKa
         ZW4t2nusNLPbkZmL5jl0K/Agq8fh2wg+7mC4DQsd2s8qp3TbSBktiO6WiRg+FzwNgw7B
         6QsIr8v8sp3RGPnJNa6ya1Zs+TZxOlz2TBC30=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=WlL3730/szMhc7L9qThINsCzlNEQHTH0kjV9GcMHqcbqvAehLADFJyg4z9r9yLOIDI
         JrB5tnXk35AYQp6ge6rxJxAI2klsHE+3BvNEsXlJBCV8jUd2IfhPCxLAkB0sIA1Zu/Bw
         RFm5MmERCeMtpHI9Y1+1z9sp8bcx0D1KlwNDQ=
MIME-Version: 1.0
Received: by 10.231.208.68 with HTTP; Fri, 16 Apr 2010 06:02:56 -0700 (PDT)
In-Reply-To: <BAY136-DS12609DD05921DA4162A410CD0F0@phx.gbl>
References: <BAY136-DS12609DD05921DA4162A410CD0F0@phx.gbl>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Fri, 16 Apr 2010 18:32:56 +0530
Received: by 10.141.188.4 with SMTP id q4mr1719280rvp.147.1271422991493; Fri, 
	16 Apr 2010 06:03:11 -0700 (PDT)
Message-ID: <h2j8766aaed1004160602yeda6f867v99b9e3a0943b3596@mail.gmail.com>
Subject: Re: about analyzer for searching location
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd1aa3ec46ad804845a3b0e
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd1aa3ec46ad804845a3b0e
Content-Type: text/plain; charset=ISO-8859-1

Hi. I don't think you need a different analyzer. Read about
PhraseQuery<http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/PhraseQuery.html>.
If you are using parse() method of QueryParser. Enclose the searched string
in extra double quotes, which must obviously be escaped.

Query q = qp.parse("\"united states\"");


2010/4/15 Ian.huang <yiwong2001@hotmail.com>

> Hi All,
>
> I am implementing a search function for address by hibernate search which
> is based on lucene. The class definition as following:
>
> @Indexed
> public class Address implements Cloneable
> {
> @DocumentId
> private int id;
> @Field
> private String addrCountry;
> private String addrDesc;
> @Field
> private String addrLineOne;
> private String addrLineTwo;
> @Field
> private String addrCity;
> ......
>
> As you see, addrCountry, addrLineone and addrCity are fields for search. I
> am using default analyzer in index & search. So I think country name like
> United States would be indexed as two terms United, and states.
>
> In addition, during search, a search keyword like United states, or Salt
> lake city would be tokenized as two or three single words.
>
> As result, any address fields contain united, city would be returned. like
> United Kingdom, but actually I want to get a result of united states.
>
> My expected result as following:
>
> if someone searches for "united" it should return "united states" and
> "united kingdom".
>
> if someone searches for "united states" it should return "united states",
> and not "united kingdom".
>
> I hope the analyzer can generate term with multiple words. say, united
> states to united states. I think standardanalyzer would analyze united
> states to united and states?
>
> A different example: if search keyword is parking lot in Salt Lake City,
> the generated terms to search need to be: parking lot and Salt Lake City,
> not parking,lot,salt,lake and city.
>
> I wonder if any analyzer can help me to implement my requirement. It would
> be better to use dictionary based solution, then I can manage some search
> terms that could have multiple words.
>
> thanks
>
> Ian




-- 
Regards,
Samar

--000e0cd1aa3ec46ad804845a3b0e--

From java-user-return-45825-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 13:24:01 2010
Return-Path: <java-user-return-45825-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41769 invoked from network); 16 Apr 2010 13:24:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 13:24:01 -0000
Received: (qmail 76475 invoked by uid 500); 16 Apr 2010 13:23:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76422 invoked by uid 500); 16 Apr 2010 13:23:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76414 invoked by uid 99); 16 Apr 2010 13:23:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 13:23:59 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.97.230.55] (HELO kwan.lunarpages.com) (216.97.230.55)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 13:23:51 +0000
Received: from localhost ([127.0.0.1] helo=kwan.lunarpages.com)
	by kwan.lunarpages.com with esmtpsa (TLSv1:AES256-SHA:256)
	(Exim 4.69)
	(envelope-from <info@josephcrawford.com>)
	id 1O2lW6-0006CA-Ci
	for java-user@lucene.apache.org; Fri, 16 Apr 2010 06:23:30 -0700
MIME-Version: 1.0
Date: Fri, 16 Apr 2010 06:23:30 -0700
From: <info@josephcrawford.com>
To: <java-user@lucene.apache.org>
Subject: Range Query Assistance
Message-ID: <19f8d6393bfd35c39eb149629c577a87@codebowl.com>
X-Sender: info@josephcrawford.com
User-Agent: RoundCube Webmail/0.3.1
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8
X-AntiAbuse: This header was added to track abuse, please include it with any abuse report
X-AntiAbuse: Primary Hostname - kwan.lunarpages.com
X-AntiAbuse: Original Domain - lucene.apache.org
X-AntiAbuse: Originator/Caller UID/GID - [47 12] / [47 12]
X-AntiAbuse: Sender Address Domain - josephcrawford.com
X-Virus-Checked: Checked by ClamAV on apache.org

Hello,

I would like to query based on a start and end date.  I was thinking
something like this

start_date: [20000101 TO <todays date>] end_date: [<todays date> TO
20900101]

Would this work for me?  Our dates are stored in the index as strings so I
am not sure the syntax above would be correct.

Any assistance would be appreciated.

Thanks,
Joseph Crawford

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45826-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 13:31:01 2010
Return-Path: <java-user-return-45826-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43769 invoked from network); 16 Apr 2010 13:31:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 13:31:01 -0000
Received: (qmail 89424 invoked by uid 500); 16 Apr 2010 13:30:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89385 invoked by uid 500); 16 Apr 2010 13:30:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89366 invoked by uid 99); 16 Apr 2010 13:30:59 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 13:30:59 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of suman.holani@zapak.co.in designates 220.226.181.11 as permitted sender)
Received: from [220.226.181.11] (HELO mail.zapak.co.in) (220.226.181.11)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 16 Apr 2010 13:30:54 +0000
Received: (qmail 29668 invoked by uid 508); 16 Apr 2010 13:30:29 -0000
Comment: DomainKeys? See http://antispam.yahoo.com/domainkeys
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=default; d=zapak.co.in;
  b=OAXbRx2X8wFlo5Dn/upwOSLN/0QN0aMALdcdFNDgOD85KKt5cgA4KoyIMviXc4r+  ;
Received: from localhost (HELO www.mail.zapak.co.in) (127.0.0.1)
  by mail.zapak.co.in with SMTP; 16 Apr 2010 13:30:29 -0000
MIME-Version: 1.0
Date: Fri, 16 Apr 2010 19:00:29 +0530
From: <suman.holani@zapak.co.in>
To: <java-user@lucene.apache.org>
Subject: Re: Range Query Assistance
In-Reply-To: <19f8d6393bfd35c39eb149629c577a87@codebowl.com>
References: <19f8d6393bfd35c39eb149629c577a87@codebowl.com>
Message-ID: <4cf1423c0bdc43086c479c0ec85be7e2@localhost>
X-Sender: suman.holani@zapak.co.in
User-Agent: RoundCube Webmail/0.3.1
Content-Transfer-Encoding: 8bit
Content-Type: text/plain; charset=UTF-8


Hello Joseph,

Yes this would work .Range queries could be used for range searches. 
But this is very expensive in terms of performance.

Regards,
Suman

On Fri, 16 Apr 2010 06:23:30 -0700, <info@josephcrawford.com> wrote:
> Hello,
> 
> I would like to query based on a start and end date.  I was thinking
> something like this
> 
> start_date: [20000101 TO <todays date>] end_date: [<todays date> TO
> 20900101]
> 
> Would this work for me?  Our dates are stored in the index as strings so
I
> am not sure the syntax above would be correct.
> 
> Any assistance would be appreciated.
> 
> Thanks,
> Joseph Crawford
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45827-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 14:47:08 2010
Return-Path: <java-user-return-45827-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78135 invoked from network); 16 Apr 2010 14:47:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 14:47:08 -0000
Received: (qmail 25421 invoked by uid 500); 16 Apr 2010 14:47:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25391 invoked by uid 500); 16 Apr 2010 14:47:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25383 invoked by uid 99); 16 Apr 2010 14:47:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 14:47:05 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 14:46:59 +0000
Received: by gwaa12 with SMTP id a12so1336967gwa.35
        for <java-user@lucene.apache.org>; Fri, 16 Apr 2010 07:46:38 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.137.5 with HTTP; Fri, 16 Apr 2010 07:46:37 -0700 (PDT)
In-Reply-To: <r2pf071061b1004150824y7c4ad80fm97b085a28e05f212@mail.gmail.com>
References: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
	 <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
	 <o2rf071061b1004150111w757f696ct49bb7c36a073e735@mail.gmail.com>
	 <r2pf071061b1004150824y7c4ad80fm97b085a28e05f212@mail.gmail.com>
Date: Fri, 16 Apr 2010 10:46:37 -0400
Received: by 10.150.251.8 with SMTP id y8mr1730663ybh.222.1271429198176; Fri, 
	16 Apr 2010 07:46:38 -0700 (PDT)
Message-ID: <k2t9ac0c6aa1004160746p8d2038c6q987a116cec844dfe@mail.gmail.com>
Subject: Re: trying to resolve error: after flush: fdx size mismatch
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

It's also exceptionally strange that the size of your fdx files, when
you hit the exception, is not even, and so out of whack (103, 8457
bytes) given that you have 1 doc.

Are there virus checkers or any other filesystem spying type apps
running on this one machine?

Or... is it possible two IWs were accidentally opened on the same
directory?  Are you changing the lock factory for your FSDirectory?

Mike

On Thu, Apr 15, 2010 at 11:24 AM, jm <jmuguruza@gmail.com> wrote:
> not sure if it matters, but I have to correct my statment, where this
> has happened was both times win2008 R1 64bits, local filesystem.
>
> I am trying to reproduce in my dev workstation but unable so far.
>
> On Thu, Apr 15, 2010 at 10:11 AM, jm <jmuguruza@gmail.com> wrote:
>> Hi Mike
>>
>> I have a server side, exposes a webservice with operations (this is
>> simplified ignoring things non lucene related):
>> - addToIndex(doc, date)
>> - flushAllIndexes()
>>
>> addToIndex() adds the doc to the index, the index is chosen based on
>> the date (simplified it's one index per day). To speed this up the
>> webservice keeps a cache of IndexWriters. =A0If the index is already
>> open it uses it, otherwise adds it to the cache (the index is created
>> if it does not exist). I have a listener on the cache expiration so
>> the index is closed when it is removed from the cache (the cache has
>> only 10 items).
>>
>> flushAllIndexes() just gets all indexes open on the cache and closes the=
m all.
>>
>> The webservice can serve many requests at the same time, but all
>> operations dealing with lucene are synchonized. I guess this is most
>> likely a bug in my synching code etc so I have verified it many times.
>> Even trying to reproduce the issue by stopping threads in a debugger
>> worked fine, synchronized methods were working as expected (I
>> understand am probably =A0missing the case that triggers the issue).
>>
>> The last time this happened there was a single thread (in the client)
>> calling addToIndex(doc, date) many times and then it called
>> flushAllIndexes() The next second I got the error. The client
>> developer assures me the call to flushAllIndexes() as in the same
>> thread as addToIndex(doc, date) (anyway, it should work even if it was
>> different threads of course).
>>
>> yes, local filesystem under Vista Business sp1 32b.
>>
>> Hope this helps. I am just now developing a client that pounds the
>> server with some threads calling the methods all the time to try to
>> reproduce the issue.
>>
>> javier
>>
>> On Thu, Apr 15, 2010 at 1:47 AM, Michael McCandless
>> <lucene@mikemccandless.com> wrote:
>>> Not good!
>>>
>>> Can you describe how your threads work with Lucene?
>>>
>>> Is this just a local filesystem (disk) under vista?
>>>
>>> Mike
>>>
>>> On Wed, Apr 14, 2010 at 7:41 AM, jm <jmuguruza@gmail.com> wrote:
>>>> Hi,
>>>>
>>>> I am trying to chase an issue in our code and it is being quite
>>>> difficult. We have seen two instances (see below) where we get the
>>>> same error. I have been trying to reproduce but it has been impossible
>>>> so far.I have several threads, some might be creating indices and
>>>> adding documents, others closing indices etc. =A0In the list this
>>>> message appear several times, in some cases it was a lucene bug (not
>>>> my case, I dont have millions of docs here) and in other it seems bad
>>>> multithreading. I have verified my multithreaded code for the 5th time
>>>> and all seems well synchronized.
>>>>
>>>> So I am asking if somebody can give me any hint, maybe the fact that
>>>> the first number is always a 1 means something?? =A0I suspect the issu=
e
>>>> is when a new index is just created maybe.
>>>>
>>>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>>>> 103 length in bytes of _2.fdx file exists?=3Dtrue
>>>> org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFieldsW=
riter.java:97)
>>>> org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProces=
sor.java:50)
>>>> org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter.=
java:380)
>>>> org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:581=
)
>>>> org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:4=
294)
>>>> org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:4192)
>>>> org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:4183)
>>>> org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:219=
0)
>>>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2153)
>>>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2117)
>>>>
>>>>
>>>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>>>> 8457 length in bytes of _0.fdx file exists?=3Dtrue ...
>>>>
>>>> My env is vista, jdk1.6, lucene 2.9.1
>>>> thanks in advance.
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45828-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 15:02:09 2010
Return-Path: <java-user-return-45828-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83928 invoked from network); 16 Apr 2010 15:02:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 15:02:08 -0000
Received: (qmail 58760 invoked by uid 500); 16 Apr 2010 15:02:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58728 invoked by uid 500); 16 Apr 2010 15:02:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58720 invoked by uid 99); 16 Apr 2010 15:02:06 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 15:02:06 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FRT_STOCK2,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.155 as permitted sender)
Received: from [72.14.220.155] (HELO fg-out-1718.google.com) (72.14.220.155)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 15:02:01 +0000
Received: by fg-out-1718.google.com with SMTP id e12so337713fga.5
        for <java-user@lucene.apache.org>; Fri, 16 Apr 2010 08:01:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=abTseW14Kzd306ESD8oIJd9Aqy31Jg+MCttmwWXs0Eg=;
        b=lLIQffjX+Twof0Hxc9aDZcE6Y4OxYy6bCDgnhNi1UQ6nWpjYDxiIWBcuuCi36gc9L4
         3Lnb1verW28njxAg+66RVxX4DB6s9MKxhTcPOloCTAsxMoYJaeCX0zpm+XuHA6NFVnHk
         ++6aOaYm9SGe68woqVRJV3gY9r7/yq4m02v7k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=RMZuqypbvLou0serk9mcobTNdWKAsr8rEfzKtnN06R7XsS0CiAcypc1cEYipF1wTgE
         W6RF9hegGVbckSJolKGox8Xw9UHm0o6WQMQhn+oeyOZuQ6mtqAUnQNZXgk2xWpWq5kS1
         +CHF+vyEphWQGCcIkYI1VKesIR15LfgueQgxI=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Fri, 16 Apr 2010 08:01:40 -0700 (PDT)
In-Reply-To: <k2t9ac0c6aa1004160746p8d2038c6q987a116cec844dfe@mail.gmail.com>
References: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
	 <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
	 <o2rf071061b1004150111w757f696ct49bb7c36a073e735@mail.gmail.com>
	 <r2pf071061b1004150824y7c4ad80fm97b085a28e05f212@mail.gmail.com>
	 <k2t9ac0c6aa1004160746p8d2038c6q987a116cec844dfe@mail.gmail.com>
Date: Fri, 16 Apr 2010 17:01:40 +0200
Received: by 10.223.29.135 with SMTP id q7mr753873fac.30.1271430100280; Fri, 
	16 Apr 2010 08:01:40 -0700 (PDT)
Message-ID: <y2yf071061b1004160801pfdeec6e0s5162fb261ef696bc@mail.gmail.com>
Subject: Re: trying to resolve error: after flush: fdx size mismatch
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

oh, just FYI, the documents I add are the same, they have all the same
5 o 6 fields, but the contents of a couple of those fields can vary
wildly among documents.

Virus checkers and similar stuff: no.

Lock factory: I am using this:
FSDirectory directory =3D FSDirectory.getDirectory(index);
directory.setLockFactory(new NativeFSLockFactory(index));

Opening two IW on the same dir? If that explains it it might be, I'll
check my code again looking specifically for that.

My stress test has no luck so far reproducing the issue sadly.

thanks for your time.
javier

On Fri, Apr 16, 2010 at 4:46 PM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> It's also exceptionally strange that the size of your fdx files, when
> you hit the exception, is not even, and so out of whack (103, 8457
> bytes) given that you have 1 doc.
>
> Are there virus checkers or any other filesystem spying type apps
> running on this one machine?
>
> Or... is it possible two IWs were accidentally opened on the same
> directory? =A0Are you changing the lock factory for your FSDirectory?
>
> Mike
>
> On Thu, Apr 15, 2010 at 11:24 AM, jm <jmuguruza@gmail.com> wrote:
>> not sure if it matters, but I have to correct my statment, where this
>> has happened was both times win2008 R1 64bits, local filesystem.
>>
>> I am trying to reproduce in my dev workstation but unable so far.
>>
>> On Thu, Apr 15, 2010 at 10:11 AM, jm <jmuguruza@gmail.com> wrote:
>>> Hi Mike
>>>
>>> I have a server side, exposes a webservice with operations (this is
>>> simplified ignoring things non lucene related):
>>> - addToIndex(doc, date)
>>> - flushAllIndexes()
>>>
>>> addToIndex() adds the doc to the index, the index is chosen based on
>>> the date (simplified it's one index per day). To speed this up the
>>> webservice keeps a cache of IndexWriters. =A0If the index is already
>>> open it uses it, otherwise adds it to the cache (the index is created
>>> if it does not exist). I have a listener on the cache expiration so
>>> the index is closed when it is removed from the cache (the cache has
>>> only 10 items).
>>>
>>> flushAllIndexes() just gets all indexes open on the cache and closes th=
em all.
>>>
>>> The webservice can serve many requests at the same time, but all
>>> operations dealing with lucene are synchonized. I guess this is most
>>> likely a bug in my synching code etc so I have verified it many times.
>>> Even trying to reproduce the issue by stopping threads in a debugger
>>> worked fine, synchronized methods were working as expected (I
>>> understand am probably =A0missing the case that triggers the issue).
>>>
>>> The last time this happened there was a single thread (in the client)
>>> calling addToIndex(doc, date) many times and then it called
>>> flushAllIndexes() The next second I got the error. The client
>>> developer assures me the call to flushAllIndexes() as in the same
>>> thread as addToIndex(doc, date) (anyway, it should work even if it was
>>> different threads of course).
>>>
>>> yes, local filesystem under Vista Business sp1 32b.
>>>
>>> Hope this helps. I am just now developing a client that pounds the
>>> server with some threads calling the methods all the time to try to
>>> reproduce the issue.
>>>
>>> javier
>>>
>>> On Thu, Apr 15, 2010 at 1:47 AM, Michael McCandless
>>> <lucene@mikemccandless.com> wrote:
>>>> Not good!
>>>>
>>>> Can you describe how your threads work with Lucene?
>>>>
>>>> Is this just a local filesystem (disk) under vista?
>>>>
>>>> Mike
>>>>
>>>> On Wed, Apr 14, 2010 at 7:41 AM, jm <jmuguruza@gmail.com> wrote:
>>>>> Hi,
>>>>>
>>>>> I am trying to chase an issue in our code and it is being quite
>>>>> difficult. We have seen two instances (see below) where we get the
>>>>> same error. I have been trying to reproduce but it has been impossibl=
e
>>>>> so far.I have several threads, some might be creating indices and
>>>>> adding documents, others closing indices etc. =A0In the list this
>>>>> message appear several times, in some cases it was a lucene bug (not
>>>>> my case, I dont have millions of docs here) and in other it seems bad
>>>>> multithreading. I have verified my multithreaded code for the 5th tim=
e
>>>>> and all seems well synchronized.
>>>>>
>>>>> So I am asking if somebody can give me any hint, maybe the fact that
>>>>> the first number is always a 1 means something?? =A0I suspect the iss=
ue
>>>>> is when a new index is just created maybe.
>>>>>
>>>>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>>>>> 103 length in bytes of _2.fdx file exists?=3Dtrue
>>>>> org.apache.lucene.index.StoredFieldsWriter.closeDocStore(StoredFields=
Writer.java:97)
>>>>> org.apache.lucene.index.DocFieldProcessor.closeDocStore(DocFieldProce=
ssor.java:50)
>>>>> org.apache.lucene.index.DocumentsWriter.closeDocStore(DocumentsWriter=
.java:380)
>>>>> org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:58=
1)
>>>>> org.apache.lucene.index.IndexWriter.doFlushInternal(IndexWriter.java:=
4294)
>>>>> org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:4192)
>>>>> org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:4183)
>>>>> org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:21=
90)
>>>>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2153)
>>>>> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:2117)
>>>>>
>>>>>
>>>>> java.lang.RuntimeException: after flush: fdx size mismatch: 1 docs vs
>>>>> 8457 length in bytes of _0.fdx file exists?=3Dtrue ...
>>>>>
>>>>> My env is vista, jdk1.6, lucene 2.9.1
>>>>> thanks in advance.
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45829-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 15:22:19 2010
Return-Path: <java-user-return-45829-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91479 invoked from network); 16 Apr 2010 15:22:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 15:22:19 -0000
Received: (qmail 90379 invoked by uid 500); 16 Apr 2010 15:22:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90318 invoked by uid 500); 16 Apr 2010 15:22:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90310 invoked by uid 99); 16 Apr 2010 15:22:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 15:22:17 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.155 as permitted sender)
Received: from [72.14.220.155] (HELO fg-out-1718.google.com) (72.14.220.155)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 15:22:11 +0000
Received: by fg-out-1718.google.com with SMTP id e12so346421fga.5
        for <java-user@lucene.apache.org>; Fri, 16 Apr 2010 08:21:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=q3w9hsQ2APcR0blySHpC8QaoXpauAcCuy4DijcT1CVQ=;
        b=OkFgD0ONUSeHAGDH+BZsO+eA7NKXURV4bWvcxWNqYh3vwU4WuYuuXp91/PB53076Hp
         3Mq869R2PXqf31BnvgKlwXeS/4ehvSzUHNwkQhEVuALEdhI86JJsDl11RdILl5PL8z+k
         7pLX2JruRQJcVRspX1TlLu6vZq0ZOD7QLOFl4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=SyX4RrJ/Eg4dSv6kXYqDsrG9aivgYCwMC/Rc9xBObwZ4YFbxdf8F2FamVZDnRINdG+
         o9ZHQzQV0Skk+I3UMsa0yg7MK9ngfabmVdj+B70pJaHJd0H9eLGBmLwgcR+j4o3QWacT
         6yK9ITzfD+AC9xD6GtJqtjLOeBWNNma2xsooY=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Fri, 16 Apr 2010 08:21:49 -0700 (PDT)
In-Reply-To: <y2yf071061b1004160801pfdeec6e0s5162fb261ef696bc@mail.gmail.com>
References: <y2if071061b1004140441sa87bf4d2ya211636db69c2486@mail.gmail.com>
	 <z2n9ac0c6aa1004141647q5f5c28d3xc83d311c19a70603@mail.gmail.com>
	 <o2rf071061b1004150111w757f696ct49bb7c36a073e735@mail.gmail.com>
	 <r2pf071061b1004150824y7c4ad80fm97b085a28e05f212@mail.gmail.com>
	 <k2t9ac0c6aa1004160746p8d2038c6q987a116cec844dfe@mail.gmail.com>
	 <y2yf071061b1004160801pfdeec6e0s5162fb261ef696bc@mail.gmail.com>
Date: Fri, 16 Apr 2010 17:21:49 +0200
Received: by 10.223.15.65 with SMTP id j1mr782889faa.0.1271431309811; Fri, 16 
	Apr 2010 08:21:49 -0700 (PDT)
Message-ID: <r2xf071061b1004160821l94092be2ja1581229e3520624@mail.gmail.com>
Subject: Re: trying to resolve error: after flush: fdx size mismatch
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Fri, Apr 16, 2010 at 5:01 PM, jm <jmuguruza@gmail.com> wrote:
> oh, just FYI, the documents I add are the same, they have all the same

I meant 'are NOT the same size'...

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45830-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 15:50:26 2010
Return-Path: <java-user-return-45830-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6568 invoked from network); 16 Apr 2010 15:50:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 15:50:26 -0000
Received: (qmail 41768 invoked by uid 500); 16 Apr 2010 15:50:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41740 invoked by uid 500); 16 Apr 2010 15:50:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41732 invoked by uid 99); 16 Apr 2010 15:50:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 15:50:24 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 15:50:17 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01CADD7C.75D7F9F0"
Subject: Term offsets for highlighting
Date: Fri, 16 Apr 2010 12:49:41 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: AcrdfG2EYaUaearRQRuHy2aZNTv4jA==
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <Java-user@lucene.apache.org>

------_=_NextPart_001_01CADD7C.75D7F9F0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hello,

=20

I am trying to determine begin and end offsets for terms and phrases
matching a query.

Is there a way using either the highlighter or fast vector highlighter
in contrib?=20

I have already attempted extending the highlighter which would match
terms but would not match phrases.

=20

The reason I am attempting this is the document content is stored in a
separate database.

I need to get a list of the begin and end offsets for all matches so
that I can highlight the text coming from the other database.

=20

Thank you in advance for your assistance.

=20

Best regards,

=20

Steve=20


------_=_NextPart_001_01CADD7C.75D7F9F0--

From java-user-return-45831-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 17:02:29 2010
Return-Path: <java-user-return-45831-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27640 invoked from network); 16 Apr 2010 17:02:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 17:02:29 -0000
Received: (qmail 29632 invoked by uid 500); 16 Apr 2010 17:02:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29595 invoked by uid 500); 16 Apr 2010 17:02:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29587 invoked by uid 99); 16 Apr 2010 17:02:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 17:02:27 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.49.17] (HELO web52907.mail.re2.yahoo.com) (206.190.49.17)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 16 Apr 2010 17:02:18 +0000
Received: (qmail 93603 invoked by uid 60001); 16 Apr 2010 17:01:56 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271437316; bh=r0VrSzjF+kT3bIAg1u+2fp/9c1uhG5vLJV6UmPe6Akw=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=1/tpuet2m16EdRWecBl6PG6FUltSEL/YyjL6u7p7nQ5TsW51YqlpbDwt+RouQbm5AhimRIRmvEdGUgiRkcOIGAOxPKfZoGv/5by8Wg3ViN/fIxR9Uij1Di2eHHTbfd19smMn2NO8pxT5fFkW84gNbF6LN0wBQhIIjRhQrSlW2bE=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=U36NgMMh40kTvnuO8QlfM4fyhq7KbGepZXDmFDKx2Yn4dgl5UV77Xi2OZURKsKRtx/5fePhfcEEuIrYc+Dx+uRykiC/bWNYKAlhq3pt3nHGEKc2HgxZz8KbOh++NEYBLiVxf6f5Up6RBJNoHAaPJhy8GVHpYwgOGBYc1IZtv+dE=;
Message-ID: <744869.93592.qm@web52907.mail.re2.yahoo.com>
X-YMail-OSG: UrjRMKYVM1mIjIJNw.8TOKpnITLrus24782HlYk4kpJrGAJ
 QHxbivzFn2hVwUraSO.Zewjkqtcj8XzTbGdxHsRCsr15e3VFtLqbZkXUpw.6
 6WUCeghvtqEmYjEaurOhPBFVJnoywbRzXDCjRZMwjbYRgYgzJTKS_5Ops0RG
 oX_QJly.rTfVJkOz9DWZa3bErvZic6HbJ.4SbPwmfQ50BiDJngYH.whUER.k
 tW2.qj8Qn1EEgjwvUmO4JH10hz4WuiUoLTlWs8KA16vqR0ikqskxe6GL4Sm4
 HWFtnP.qMrvhSy57fdcfLMyQ9EkbfR07b55d5FPklsFh.1d8BSP1EuSitCjd
 OXsHfIOI6ykkmVKbZi5zRTG6pDV0a
Received: from [78.168.45.66] by web52907.mail.re2.yahoo.com via HTTP; Fri, 16 Apr 2010 10:01:56 PDT
X-Mailer: YahooMailClassic/10.1.9 YahooMailWebService/0.8.100.260964
Date: Fri, 16 Apr 2010 10:01:56 -0700 (PDT)
From: Ahmet Arslan <iorixxx@yahoo.com>
Subject: Re: Payload Example for Lucene 3.0.0
To: java-user@lucene.apache.org
In-Reply-To: <1271419063051-723757.post@n3.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org


> Hi,
> I would like to have example of adding payload for lucene
> 3.0. I found an
> example on internet which uses BoostingTermQuery but I
> couldn't find this
> class in Lucene 3.0.0 jar and I was wondering if someone
> knows the
> workaround or where can I find. If someone can post an
> example that will be
> very helpful.

BoostingTermQuery is deprecated/removed in favor of PayloadTermQuery [1]. 

[1]http://lucene.apache.org/java/3_0_0/api/all/org/apache/lucene/search/payloads/PayloadTermQuery.html


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45832-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 18:11:12 2010
Return-Path: <java-user-return-45832-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43181 invoked from network); 16 Apr 2010 18:11:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 18:11:11 -0000
Received: (qmail 98740 invoked by uid 500); 16 Apr 2010 18:11:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98711 invoked by uid 500); 16 Apr 2010 18:11:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98703 invoked by uid 99); 16 Apr 2010 18:11:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 18:11:09 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [149.8.64.32] (HELO mclmx2.mail.saic.com) (149.8.64.32)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 18:11:02 +0000
Received: from 0015-its-sbg02.saic.com ([149.8.64.21] [149.8.64.21]) by mclmx2.mail.saic.com with ESMTP id BT-MMP-11431193 for java-user@lucene.apache.org; Fri, 16 Apr 2010 14:10:36 -0400
X-AuditID: 9508407d-b7ca9ae0000009aa-4f-4bc8a81c0d3b
Received: from 0015-its-exbh03.us.saic.com (mcl-sixl-nat.saic.com [149.8.64.21])
	by 0015-its-sbg02.saic.com (Symantec Brightmail Gateway) with SMTP id 8B.6E.02474.C18A8CB4; Fri, 16 Apr 2010 14:10:36 -0400 (EDT)
Received: from 0015-its-exmb01.us.saic.com ([10.43.229.16]) by 0015-its-exbh03.us.saic.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 16 Apr 2010 14:10:36 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01CADD90.1CC3824A"
Subject: NumericRangeQuery in BooleanQuery
Date: Fri, 16 Apr 2010 14:10:30 -0400
Message-Id: <002052E02A48964A8035D9B6E8A1647D010C8875@0015-its-exmb01.us.saic.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: NumericRangeQuery in BooleanQuery
Thread-Index: AcrdkBa+5dRvdK7CQPSyuq8Jh50ngQ==
From: "Murdoch, Paul" <PAUL.B.MURDOCH@saic.com>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 16 Apr 2010 18:10:36.0165 (UTC) FILETIME=[1CCC2350:01CADD90]
X-Brightmail-Tracker: AAAAAA==

------_=_NextPart_001_01CADD90.1CC3824A
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hi,

=20

Can a NumericRangeQuery be one of several Queries inside a complex
BooleanQuery?  When I do this my NumericRangeQuery seems to
automagically be converted to a TermRangeQuery.

=20

Thanks,

=20

Paul

=20

=20


------_=_NextPart_001_01CADD90.1CC3824A--

From java-user-return-45833-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 16 22:10:03 2010
Return-Path: <java-user-return-45833-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87664 invoked from network); 16 Apr 2010 22:10:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Apr 2010 22:10:03 -0000
Received: (qmail 75180 invoked by uid 500); 16 Apr 2010 22:10:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75132 invoked by uid 500); 16 Apr 2010 22:10:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75124 invoked by uid 99); 16 Apr 2010 22:10:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 22:10:01 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Apr 2010 22:09:53 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 20605D36009
	for <java-user@lucene.apache.org>; Sat, 17 Apr 2010 00:09:32 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id nUb9M1M6VLVp for <java-user@lucene.apache.org>;
	Sat, 17 Apr 2010 00:09:22 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id E1249D36005
	for <java-user@lucene.apache.org>; Sat, 17 Apr 2010 00:09:21 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <002052E02A48964A8035D9B6E8A1647D010C8875@0015-its-exmb01.us.saic.com>
In-Reply-To: <002052E02A48964A8035D9B6E8A1647D010C8875@0015-its-exmb01.us.saic.com>
Subject: RE: NumericRangeQuery in BooleanQuery
Date: Sat, 17 Apr 2010 00:09:28 +0200
Message-ID: <01b101caddb1$7bff9de0$73fed9a0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
thread-index: AcrdkBa+5dRvdK7CQPSyuq8Jh50ngQAISjgQ
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Thats not true, do you build the NumericRangeQuery in code, or do you =
use QueryParser. The latter is not able to produce NRQ without =
customizing!

Else numeric RangeQueries are no magically converted they stay and are =
rewritten to CustomSCoreQueries.
-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Murdoch, Paul [mailto:PAUL.B.MURDOCH@saic.com]
> Sent: Friday, April 16, 2010 8:11 PM
> To: java-user@lucene.apache.org
> Subject: NumericRangeQuery in BooleanQuery
>=20
> Hi,
>=20
>=20
>=20
> Can a NumericRangeQuery be one of several Queries inside a complex
> BooleanQuery?  When I do this my NumericRangeQuery seems to
> automagically be converted to a TermRangeQuery.
>=20
>=20
>=20
> Thanks,
>=20
>=20
>=20
> Paul
>=20
>=20
>=20
>=20



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45834-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 17 00:49:08 2010
Return-Path: <java-user-return-45834-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59219 invoked from network); 17 Apr 2010 00:49:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Apr 2010 00:49:07 -0000
Received: (qmail 59601 invoked by uid 500); 17 Apr 2010 00:49:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59552 invoked by uid 500); 17 Apr 2010 00:49:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59544 invoked by uid 99); 17 Apr 2010 00:49:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Apr 2010 00:49:05 +0000
X-ASF-Spam-Status: No, hits=-1.1 required=10.0
	tests=AWL,SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of koji@r.email.ne.jp designates 202.224.39.197 as permitted sender)
Received: from [202.224.39.197] (HELO mail1.asahi-net.or.jp) (202.224.39.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Apr 2010 00:48:59 +0000
Received: from koji-sekiguchi-no-macbook.local (w244069.ppp.asahi-net.or.jp [121.1.244.69])
	by mail1.asahi-net.or.jp (Postfix) with ESMTP id C4E9E9CEA4
	for <java-user@lucene.apache.org>; Sat, 17 Apr 2010 09:48:37 +0900 (JST)
Message-ID: <4BC90565.2080407@r.email.ne.jp>
Date: Sat, 17 Apr 2010 09:48:37 +0900
From: Koji Sekiguchi <koji@r.email.ne.jp>
User-Agent: Thunderbird 2.0.0.24 (Macintosh/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local>
In-Reply-To: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Stephen Greene wrote:
> Hello,
>
>  
>
> I am trying to determine begin and end offsets for terms and phrases
> matching a query.
>
> Is there a way using either the highlighter or fast vector highlighter
> in contrib? 
>
> I have already attempted extending the highlighter which would match
> terms but would not match phrases.
>
>   
Did you try QueryScorer? If I remember it correctly, QueryScorer
can recognize phrase matches. Note that QueryScorer can recognize phrases,
though, tagging works per term in phrase query, not phrase. i.e. if your 
query is
phrase "foo bar", highlighter will return <b>foo</b> <b>bar</b>, not
<b>foo bar</b>.

Koji

-- 
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45835-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Apr 18 13:09:53 2010
Return-Path: <java-user-return-45835-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80023 invoked from network); 18 Apr 2010 13:09:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Apr 2010 13:09:53 -0000
Received: (qmail 11972 invoked by uid 500); 18 Apr 2010 13:09:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11916 invoked by uid 500); 18 Apr 2010 13:09:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11908 invoked by uid 99); 18 Apr 2010 13:09:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 13:09:50 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 13:09:44 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Term offsets for highlighting
Date: Sun, 18 Apr 2010 10:09:05 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local>
In-reply-to: <4BC90565.2080407@r.email.ne.jp>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: Acrdx8k0w8BFW2xgRcWmEdZKMgvfNABMB3MQ
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp>
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <java-user@lucene.apache.org>

Hi Koji,

Thank you for your reply. I did try the QueryScorer without success, but
I was using Lucene 2.4.x=20
I noticed in the upgrade documentation that some changes had been made
relative to QueryScorer and QueryTermScorer in 3.1. I thought I would
check if someone else had come up with a solution for returning term
offsets before I set out to refactor the existing code. Do you have any
insight as to whether the fast vector highlighter would offer any
benefits in this area over the highlighter package?

Thank you,

Steve

-----Original Message-----
From: Koji Sekiguchi [mailto:koji@r.email.ne.jp]=20
Sent: Friday, April 16, 2010 9:49 PM
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting

Stephen Greene wrote:
> Hello,
>
> =20
>
> I am trying to determine begin and end offsets for terms and phrases
> matching a query.
>
> Is there a way using either the highlighter or fast vector highlighter
> in contrib?=20
>
> I have already attempted extending the highlighter which would match
> terms but would not match phrases.
>
>  =20
Did you try QueryScorer? If I remember it correctly, QueryScorer
can recognize phrase matches. Note that QueryScorer can recognize
phrases,
though, tagging works per term in phrase query, not phrase. i.e. if your

query is
phrase "foo bar", highlighter will return <b>foo</b> <b>bar</b>, not
<b>foo bar</b>.

Koji

--=20
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45836-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Apr 18 13:42:22 2010
Return-Path: <java-user-return-45836-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86859 invoked from network); 18 Apr 2010 13:42:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Apr 2010 13:42:22 -0000
Received: (qmail 32224 invoked by uid 500); 18 Apr 2010 13:42:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32036 invoked by uid 500); 18 Apr 2010 13:42:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32028 invoked by uid 99); 18 Apr 2010 13:42:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 13:42:20 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of koji@r.email.ne.jp designates 202.224.39.197 as permitted sender)
Received: from [202.224.39.197] (HELO mail1.asahi-net.or.jp) (202.224.39.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 13:42:12 +0000
Received: from koji-sekiguchi-no-macbook.local (w244069.ppp.asahi-net.or.jp [121.1.244.69])
	by mail1.asahi-net.or.jp (Postfix) with ESMTP id 585B7A33BD
	for <java-user@lucene.apache.org>; Sun, 18 Apr 2010 22:41:50 +0900 (JST)
Message-ID: <4BCB0C1D.8060603@r.email.ne.jp>
Date: Sun, 18 Apr 2010 22:41:49 +0900
From: Koji Sekiguchi <koji@r.email.ne.jp>
User-Agent: Thunderbird 2.0.0.24 (Macintosh/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local>
In-Reply-To: <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Stephen Greene wrote:
> Hi Koji,
>
> Thank you for your reply. I did try the QueryScorer without success, but
> I was using Lucene 2.4.x 
>   
Hi Steve,

I thought you were using 2.9 or later because you mentioned
FastVectorHighlighter in your previous mail (FVH was first
introduced in 2.9). If I remember it correctly, 2.4's QueryScorer
doesn't recognize phrase, but SpanScorer does.

> I noticed in the upgrade documentation that some changes had been made
> relative to QueryScorer and QueryTermScorer in 3.1. I thought I would
> check if someone else had come up with a solution for returning term
> offsets before I set out to refactor the existing code. Do you have any
> insight as to whether the fast vector highlighter would offer any
> benefits in this area over the highlighter package?
>
>   
I'm not sure FVH offers benefit for you, but yes, FVH can
recognize phrase and highlight terms per phrase.

Koji

-- 
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45837-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Apr 18 18:21:21 2010
Return-Path: <java-user-return-45837-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42424 invoked from network); 18 Apr 2010 18:21:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Apr 2010 18:21:20 -0000
Received: (qmail 28332 invoked by uid 500); 18 Apr 2010 18:21:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28266 invoked by uid 500); 18 Apr 2010 18:21:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28258 invoked by uid 99); 18 Apr 2010 18:21:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 18:21:18 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 216.139.236.158 is neither permitted nor denied by domain of ajay978@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 18:21:13 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <ajay978@gmail.com>)
	id 1O3Z6y-00020N-KT
	for java-user@lucene.apache.org; Sun, 18 Apr 2010 11:20:52 -0700
Date: Sun, 18 Apr 2010 10:20:52 -0800 (PST)
From: Ajay_978 <ajay978@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271614852626-728106.post@n3.nabble.com>
In-Reply-To: <744869.93592.qm@web52907.mail.re2.yahoo.com>
References: <1271419063051-723757.post@n3.nabble.com> <744869.93592.qm@web52907.mail.re2.yahoo.com>
Subject: Re: Payload Example for Lucene 3.0.0
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


I am struggling to use PayTermQuery because of PayloadFunction. I didnt find
any example of PayTermQuery.
I am already using BoostTermQuery but I am not able to extract payload
value.
I am using example mention in
http://www.lucidimagination.com/blog/2009/08/05/getting-started-with-payloads/comment-page-1/#comment-4557
Could you please help me to get payload value ?
-- 
View this message in context: http://n3.nabble.com/Payload-Example-for-Lucene-3-0-0-tp723757p728106.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45838-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Apr 18 21:37:50 2010
Return-Path: <java-user-return-45838-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84169 invoked from network); 18 Apr 2010 21:37:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Apr 2010 21:37:50 -0000
Received: (qmail 43778 invoked by uid 500); 18 Apr 2010 21:37:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43242 invoked by uid 500); 18 Apr 2010 21:37:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43029 invoked by uid 99); 18 Apr 2010 21:37:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 21:37:46 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erdincyilmazel@gmail.com designates 72.14.220.156 as permitted sender)
Received: from [72.14.220.156] (HELO fg-out-1718.google.com) (72.14.220.156)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Apr 2010 21:37:40 +0000
Received: by fg-out-1718.google.com with SMTP id e21so489745fga.5
        for <java-user@lucene.apache.org>; Sun, 18 Apr 2010 14:37:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:received:date
         :x-google-sender-auth:received:message-id:subject:from:to
         :content-type;
        bh=OAME9mv3Ak8uESlUvP3VStYRK+Gc675KSeKlNGh4PfY=;
        b=eXgKlSEcH+H1qHuz79dTKcXe1PUHxZ9FbNzDV50do7hKYLZRLhkjbFJZr4p8y6UHae
         UI6Gn5XyavKOjkkycFPXtJxYXs8qwBe1glHViiZDQLcmRracvrejk7in93bp7Q17cEUx
         VT+kh61DGtax47sridoz+LNji5hlzN0y0XU3o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        b=ILglhil8fq/TDms/hrL7uT+cMc3urXgmWAX/GK+qcE1772CbUZPZo6G1mBrfNOWFjx
         XSBSojnfs1Ll7cd8KHlZdA4Cp962Gs5bZj9i7K9uQ66D34VUImPhadlQFVoW2HlANsTT
         yW/PPpXmPaICYKNlD3CM5CHRf+TxsLoYCWEtU=
MIME-Version: 1.0
Sender: erdincyilmazel@gmail.com
Received: by 10.239.133.212 with HTTP; Sun, 18 Apr 2010 14:37:18 -0700 (PDT)
Date: Sun, 18 Apr 2010 22:37:18 +0100
X-Google-Sender-Auth: 9b12ef5cdbb4090b
Received: by 10.239.167.203 with SMTP id h11mr370168hbe.53.1271626638583; Sun, 
	18 Apr 2010 14:37:18 -0700 (PDT)
Message-ID: <r2n7af3bac91004181437pa1979500t15b5fa447755f607@mail.gmail.com>
Subject: Different index per user
From: Erdinc Yilmazel <erdinc@yilmazel.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f2c186146604048489a64a

--001485f2c186146604048489a64a
Content-Type: text/plain; charset=ISO-8859-1

I am building an online application where I want to provide search
functionality to users and each user is to search only within his own data.
Can you give me some ideas about the structure of the index that I should
have in this scenario? I know I could use a different index per user account
but that is simply not practical. I could also create a single index and use
a separate field to identify the documents that are related to a user
account and create my queries accordingly. However I am guessing that there
might be better ways to partition my index based on the user identifiers.

Thanks,

Erdinc

--001485f2c186146604048489a64a--

From java-user-return-45839-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 00:22:36 2010
Return-Path: <java-user-return-45839-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47659 invoked from network); 19 Apr 2010 00:22:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 00:22:36 -0000
Received: (qmail 30584 invoked by uid 500); 19 Apr 2010 00:22:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30526 invoked by uid 500); 19 Apr 2010 00:22:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30518 invoked by uid 99); 19 Apr 2010 00:22:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 00:22:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 00:22:27 +0000
Received: by gwj17 with SMTP id 17so783106gwj.35
        for <java-user@lucene.apache.org>; Sun, 18 Apr 2010 17:22:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=yzEufl41TrV4+aqaeLej2jpNY6I6rR1XFUzjmF1lrM4=;
        b=Lex8+/iFxQh7auwFfcbMXSsMbB6NZDf3Da9F9qMp9N7NpC7ZSjIFw5pkzKuokvHtcf
         NTzJ57pGUjcO0iKYMS42Cda8ZbkIZDCSL87KX4P3Bw5/Qno4MaBEo/ftiGYvHp4sauDM
         F850m+En768AWVkCnBd1CgtM70pO88Vm8Z9io=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=JWzis25ZVvj510wZkrdDPKHYWTng13C++EvTeK3umVwAHYIhRumGQHBvVw1k3cg/YS
         brA3psCS+lItK4O6j3wx9R2+EIhumZCMsYmkxhg0Lhfh5nja21S9jocVpxzzAt9Ima/F
         OYL9mtVvvmG/UBaqNwGjpAuJT79678YKeHf+w=
MIME-Version: 1.0
Received: by 10.150.199.5 with HTTP; Sun, 18 Apr 2010 17:22:06 -0700 (PDT)
In-Reply-To: <r2n7af3bac91004181437pa1979500t15b5fa447755f607@mail.gmail.com>
References: <r2n7af3bac91004181437pa1979500t15b5fa447755f607@mail.gmail.com>
Date: Sun, 18 Apr 2010 20:22:06 -0400
Received: by 10.150.7.3 with SMTP id 3mr5047328ybg.32.1271636526685; Sun, 18 
	Apr 2010 17:22:06 -0700 (PDT)
Message-ID: <x2w359a92831004181722zf7bd2e20n80890f67727232b9@mail.gmail.com>
Subject: Re: Different index per user
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151747935674dd5304848bf30f
X-Virus-Checked: Checked by ClamAV on apache.org

--00151747935674dd5304848bf30f
Content-Type: text/plain; charset=ISO-8859-1

No really better ways that spring to mind. At root you have to somehow
know what document is added by each user, and adding a field to
the document with this info is quite reasonable, then just tack
on an +user:<current user> to each query.

You can get creative with Lucene Filters. That is, create a Filter for
a user when s/he logs on pass that to queries, see some of the
Searcher.search methods that take a Filter. But there's no
real reason to go there unless you have performance problems.

This is the fairly simple case, you're not indicating that you're after
some generic Access Control List functionality so I'd stick with
the simple approach until proven inadequate...

HTH
Erick

On Sun, Apr 18, 2010 at 5:37 PM, Erdinc Yilmazel <erdinc@yilmazel.com>wrote:

> I am building an online application where I want to provide search
> functionality to users and each user is to search only within his own data.
> Can you give me some ideas about the structure of the index that I should
> have in this scenario? I know I could use a different index per user
> account
> but that is simply not practical. I could also create a single index and
> use
> a separate field to identify the documents that are related to a user
> account and create my queries accordingly. However I am guessing that there
> might be better ways to partition my index based on the user identifiers.
>
> Thanks,
>
> Erdinc
>

--00151747935674dd5304848bf30f--

From java-user-return-45840-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 10:03:57 2010
Return-Path: <java-user-return-45840-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66174 invoked from network); 19 Apr 2010 10:03:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 10:03:57 -0000
Received: (qmail 25732 invoked by uid 500); 19 Apr 2010 10:03:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25356 invoked by uid 500); 19 Apr 2010 10:03:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25348 invoked by uid 99); 19 Apr 2010 10:03:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 10:03:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yiwong2001@hotmail.com designates 65.54.190.86 as permitted sender)
Received: from [65.54.190.86] (HELO bay0-omc2-s11.bay0.hotmail.com) (65.54.190.86)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 10:03:41 +0000
Received: from BAY136-DS6 ([65.54.190.125]) by bay0-omc2-s11.bay0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 19 Apr 2010 03:03:20 -0700
X-Originating-IP: [111.193.149.244]
X-Originating-Email: [yiwong2001@hotmail.com]
Message-ID: <BAY136-DS6C0B86A0BA25A26F01D70CD0B0@phx.gbl>
From: "Ian.huang" <yiwong2001@hotmail.com>
To: <java-user@lucene.apache.org>
References: <BAY136-DS12609DD05921DA4162A410CD0F0@phx.gbl> <h2j8766aaed1004160602yeda6f867v99b9e3a0943b3596@mail.gmail.com>
In-Reply-To: <h2j8766aaed1004160602yeda6f867v99b9e3a0943b3596@mail.gmail.com>
Subject: Re: about analyzer for searching location
Date: Mon, 19 Apr 2010 18:03:07 +0800
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="ISO-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
Importance: Normal
X-Mailer: Microsoft Windows Live Mail 14.0.8089.726
X-MimeOLE: Produced By Microsoft MimeOLE V14.0.8089.726
X-OriginalArrivalTime: 19 Apr 2010 10:03:20.0794 (UTC) FILETIME=[8A65CBA0:01CADFA7]
X-Virus-Checked: Checked by ClamAV on apache.org

Does a token of "united states" exist in index if using standard analyzer. 
My understanding is, united and states are separately stored in index, but 
not as "united states". So, if I build a query like Query q = 
qp.parse("\"united states\""); It would not return any result. Am I right?

Ian

--------------------------------------------------
From: "Samarendra Pratap" <samarzone@gmail.com>
Sent: Friday, April 16, 2010 9:02 PM
To: <java-user@lucene.apache.org>
Subject: Re: about analyzer for searching location

> Hi. I don't think you need a different analyzer. Read about
> PhraseQuery<http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/PhraseQuery.html>.
> If you are using parse() method of QueryParser. Enclose the searched 
> string
> in extra double quotes, which must obviously be escaped.
>
> Query q = qp.parse("\"united states\"");
>
>
> 2010/4/15 Ian.huang <yiwong2001@hotmail.com>
>
>> Hi All,
>>
>> I am implementing a search function for address by hibernate search which
>> is based on lucene. The class definition as following:
>>
>> @Indexed
>> public class Address implements Cloneable
>> {
>> @DocumentId
>> private int id;
>> @Field
>> private String addrCountry;
>> private String addrDesc;
>> @Field
>> private String addrLineOne;
>> private String addrLineTwo;
>> @Field
>> private String addrCity;
>> ......
>>
>> As you see, addrCountry, addrLineone and addrCity are fields for search. 
>> I
>> am using default analyzer in index & search. So I think country name like
>> United States would be indexed as two terms United, and states.
>>
>> In addition, during search, a search keyword like United states, or Salt
>> lake city would be tokenized as two or three single words.
>>
>> As result, any address fields contain united, city would be returned. 
>> like
>> United Kingdom, but actually I want to get a result of united states.
>>
>> My expected result as following:
>>
>> if someone searches for "united" it should return "united states" and
>> "united kingdom".
>>
>> if someone searches for "united states" it should return "united states",
>> and not "united kingdom".
>>
>> I hope the analyzer can generate term with multiple words. say, united
>> states to united states. I think standardanalyzer would analyze united
>> states to united and states?
>>
>> A different example: if search keyword is parking lot in Salt Lake City,
>> the generated terms to search need to be: parking lot and Salt Lake City,
>> not parking,lot,salt,lake and city.
>>
>> I wonder if any analyzer can help me to implement my requirement. It 
>> would
>> be better to use dictionary based solution, then I can manage some search
>> terms that could have multiple words.
>>
>> thanks
>>
>> Ian
>
>
>
>
> -- 
> Regards,
> Samar
> 

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45841-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 10:32:28 2010
Return-Path: <java-user-return-45841-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79474 invoked from network); 19 Apr 2010 10:32:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 10:32:28 -0000
Received: (qmail 53058 invoked by uid 500); 19 Apr 2010 10:32:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52742 invoked by uid 500); 19 Apr 2010 10:32:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52732 invoked by uid 99); 19 Apr 2010 10:32:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 10:32:21 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of samarzone@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 10:32:13 +0000
Received: by gwj17 with SMTP id 17so993548gwj.35
        for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 03:31:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=/+WrmvZ3SC/TecXKys2W8GSzFTsBq+vEPloMW9BI0Ww=;
        b=KaYkSdQkcusNPKNWln/8sJL5qxhoACUu3fPzc/OzQIisOUKBPfJq/1/3TqJRijvb19
         WBU9RSjsz18gMUO8DTDkvmB9Y3geofIspDGI1jExJVFzsIXPoOJO4mE4BB2Mg6/14vCa
         raehPh8Zhi4YN4agZiJvb44z0gohp7bEgW1pk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=xtzFfpClWfPgEebIWrFlHX0K8u8FeO6cQ5LHPKS8w8M1qh6X6NapxJszuGuP3rR3ai
         T98tvnDgKg+3Uc9wf7XIUNL60kCs7TWvrpd9Csefsa54lf6J2THFVrI2OOBWo87NT3bA
         z2l+E41wzX7R+Ogjw1Aw+0a+NBT4Tqgn9/TnE=
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Mon, 19 Apr 2010 03:31:34 -0700 (PDT)
In-Reply-To: <BAY136-DS6C0B86A0BA25A26F01D70CD0B0@phx.gbl>
References: <BAY136-DS12609DD05921DA4162A410CD0F0@phx.gbl> 
	<h2j8766aaed1004160602yeda6f867v99b9e3a0943b3596@mail.gmail.com> 
	<BAY136-DS6C0B86A0BA25A26F01D70CD0B0@phx.gbl>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Mon, 19 Apr 2010 16:01:34 +0530
Received: by 10.101.163.19 with SMTP id q19mr11995536ano.224.1271673109216; 
	Mon, 19 Apr 2010 03:31:49 -0700 (PDT)
Message-ID: <q2r8766aaed1004190331l96846eafn11d5906f7381c507@mail.gmail.com>
Subject: Re: about analyzer for searching location
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e68cc510f29e6e048494777b
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e68cc510f29e6e048494777b
Content-Type: text/plain; charset=ISO-8859-1

Well... you are 50% right.

when you write
*
*
* Query q = qp.parse("\"united states\"");*

It does search for two separate tokens "united" and "states" but checks if
those are written sequentially. So above search will search for documents
where token "states" is written after "united".

*Note* that since it checks tokens sequentially it may also find documents
where some non-tokenizable characters or stop words exist between "united"
and "states", e.g. - *united and states *(here "and" is a stop word).

TermQuery will work it the way you said in your reply, i.e. will search for
a token "united states" which is not what you want.



On Mon, Apr 19, 2010 at 3:33 PM, Ian.huang <yiwong2001@hotmail.com> wrote:

> Does a token of "united states" exist in index if using standard analyzer.
> My understanding is, united and states are separately stored in index, but
> not as "united states". So, if I build a query like Query q =
> qp.parse("\"united states\""); It would not return any result. Am I right?
>
> Ian
>
> --------------------------------------------------
> From: "Samarendra Pratap" <samarzone@gmail.com>
> Sent: Friday, April 16, 2010 9:02 PM
> To: <java-user@lucene.apache.org>
> Subject: Re: about analyzer for searching location
>
>  Hi. I don't think you need a different analyzer. Read about
>> PhraseQuery<
>> http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/PhraseQuery.html
>> >.
>>
>> If you are using parse() method of QueryParser. Enclose the searched
>> string
>> in extra double quotes, which must obviously be escaped.
>>
>> Query q = qp.parse("\"united states\"");
>>
>>
>> 2010/4/15 Ian.huang <yiwong2001@hotmail.com>
>>
>>  Hi All,
>>>
>>> I am implementing a search function for address by hibernate search which
>>> is based on lucene. The class definition as following:
>>>
>>> @Indexed
>>> public class Address implements Cloneable
>>> {
>>> @DocumentId
>>> private int id;
>>> @Field
>>> private String addrCountry;
>>> private String addrDesc;
>>> @Field
>>> private String addrLineOne;
>>> private String addrLineTwo;
>>> @Field
>>> private String addrCity;
>>> ......
>>>
>>> As you see, addrCountry, addrLineone and addrCity are fields for search.
>>> I
>>> am using default analyzer in index & search. So I think country name like
>>> United States would be indexed as two terms United, and states.
>>>
>>> In addition, during search, a search keyword like United states, or Salt
>>> lake city would be tokenized as two or three single words.
>>>
>>> As result, any address fields contain united, city would be returned.
>>> like
>>> United Kingdom, but actually I want to get a result of united states.
>>>
>>> My expected result as following:
>>>
>>> if someone searches for "united" it should return "united states" and
>>> "united kingdom".
>>>
>>> if someone searches for "united states" it should return "united states",
>>> and not "united kingdom".
>>>
>>> I hope the analyzer can generate term with multiple words. say, united
>>> states to united states. I think standardanalyzer would analyze united
>>> states to united and states?
>>>
>>> A different example: if search keyword is parking lot in Salt Lake City,
>>> the generated terms to search need to be: parking lot and Salt Lake City,
>>> not parking,lot,salt,lake and city.
>>>
>>> I wonder if any analyzer can help me to implement my requirement. It
>>> would
>>> be better to use dictionary based solution, then I can manage some search
>>> terms that could have multiple words.
>>>
>>> thanks
>>>
>>> Ian
>>>
>>
>>
>>
>>
>> --
>> Regards,
>> Samar
>>
>>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Regards,
Samar

--0016e68cc510f29e6e048494777b--

From java-user-return-45842-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 10:51:26 2010
Return-Path: <java-user-return-45842-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88869 invoked from network); 19 Apr 2010 10:51:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 10:51:25 -0000
Received: (qmail 75281 invoked by uid 500); 19 Apr 2010 10:51:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74610 invoked by uid 500); 19 Apr 2010 10:51:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74602 invoked by uid 99); 19 Apr 2010 10:51:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 10:51:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 10:51:11 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Term offsets for highlighting
Date: Mon, 19 Apr 2010 07:50:32 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C43EE1@copper.meg.local>
In-reply-to: <4BCB0C1D.8060603@r.email.ne.jp>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: Acre/Pjc8k9ZE2gtS+2D979eDhtU0gAsQ3zw
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp>
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Koji,

SpanScorer was not highlighting correctly for me in 2.4.x. I have
upgraded to 3.1 in the hopes of having better luck!

Thank you,

Steve


-----Original Message-----
From: Koji Sekiguchi [mailto:koji@r.email.ne.jp]=20
Sent: Sunday, April 18, 2010 10:42 AM
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting

Stephen Greene wrote:
> Hi Koji,
>
> Thank you for your reply. I did try the QueryScorer without success,
but
> I was using Lucene 2.4.x=20
>  =20
Hi Steve,

I thought you were using 2.9 or later because you mentioned
FastVectorHighlighter in your previous mail (FVH was first
introduced in 2.9). If I remember it correctly, 2.4's QueryScorer
doesn't recognize phrase, but SpanScorer does.

> I noticed in the upgrade documentation that some changes had been made
> relative to QueryScorer and QueryTermScorer in 3.1. I thought I would
> check if someone else had come up with a solution for returning term
> offsets before I set out to refactor the existing code. Do you have
any
> insight as to whether the fast vector highlighter would offer any
> benefits in this area over the highlighter package?
>
>  =20
I'm not sure FVH offers benefit for you, but yes, FVH can
recognize phrase and highlight terms per phrase.

Koji

--=20
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45843-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 12:28:32 2010
Return-Path: <java-user-return-45843-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43419 invoked from network); 19 Apr 2010 12:28:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 12:28:32 -0000
Received: (qmail 4751 invoked by uid 500); 19 Apr 2010 12:28:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4702 invoked by uid 500); 19 Apr 2010 12:28:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4677 invoked by uid 99); 19 Apr 2010 12:28:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 12:28:29 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 12:28:22 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Term offsets for highlighting
Date: Mon, 19 Apr 2010 09:27:42 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local>
In-reply-to: <4BCB0C1D.8060603@r.email.ne.jp>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: Acre/Pjc8k9ZE2gtS+2D979eDhtU0gAvgU5w
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp>
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Koji,

An additional question. Is it possible to access the FieldTermStack from
the FastVectorHighlighter after the it has been populated with matching
terms from the field?

I think this would provide an ideal solution for this problem, as
ultimately I am only concerned with returning positional offsets to have
highlighting tags applied to them in a separate process.=20

Thank you for your insight,

Steve


-----Original Message-----
From: Koji Sekiguchi [mailto:koji@r.email.ne.jp]=20
Sent: Sunday, April 18, 2010 10:42 AM
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting

Stephen Greene wrote:
> Hi Koji,
>
> Thank you for your reply. I did try the QueryScorer without success,
but
> I was using Lucene 2.4.x=20
>  =20
Hi Steve,

I thought you were using 2.9 or later because you mentioned
FastVectorHighlighter in your previous mail (FVH was first
introduced in 2.9). If I remember it correctly, 2.4's QueryScorer
doesn't recognize phrase, but SpanScorer does.

> I noticed in the upgrade documentation that some changes had been made
> relative to QueryScorer and QueryTermScorer in 3.1. I thought I would
> check if someone else had come up with a solution for returning term
> offsets before I set out to refactor the existing code. Do you have
any
> insight as to whether the fast vector highlighter would offer any
> benefits in this area over the highlighter package?
>
>  =20
I'm not sure FVH offers benefit for you, but yes, FVH can
recognize phrase and highlight terms per phrase.

Koji

--=20
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45844-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 13:24:35 2010
Return-Path: <java-user-return-45844-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76843 invoked from network); 19 Apr 2010 13:24:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 13:24:35 -0000
Received: (qmail 94192 invoked by uid 500); 19 Apr 2010 13:24:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94141 invoked by uid 500); 19 Apr 2010 13:24:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94133 invoked by uid 99); 19 Apr 2010 13:24:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 13:24:33 +0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of ajay978@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 13:24:26 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <ajay978@gmail.com>)
	id 1O3qxJ-0002mc-NR
	for java-user@lucene.apache.org; Mon, 19 Apr 2010 06:24:05 -0700
Date: Mon, 19 Apr 2010 05:24:05 -0800 (PST)
From: Ajay_978 <ajay978@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271683445720-729590.post@n3.nabble.com>
In-Reply-To: <744869.93592.qm@web52907.mail.re2.yahoo.com>
References: <1271419063051-723757.post@n3.nabble.com> <744869.93592.qm@web52907.mail.re2.yahoo.com>
Subject: Re: Payload Example for Lucene 3.0.0
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Hi
I am able to manage getpayload value using TermPosition class but now I am
having one issue. I have document with doc_id and Title and I want to get
payload for a given term in a given document but current API's takes input
as term only. There is no parameter for document id.
API example:
Term t = new Term("Title", "Java");
TermPositions positions = ir.termPositions(t)

I want to iterate for all documents and wants to get payload for each
document separately. Is there any API available ? 
-- 
View this message in context: http://n3.nabble.com/Payload-Example-for-Lucene-3-0-0-tp723757p729590.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45845-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 13:32:19 2010
Return-Path: <java-user-return-45845-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80940 invoked from network); 19 Apr 2010 13:32:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 13:32:19 -0000
Received: (qmail 2434 invoked by uid 500); 19 Apr 2010 13:32:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2307 invoked by uid 500); 19 Apr 2010 13:32:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2290 invoked by uid 99); 19 Apr 2010 13:32:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 13:32:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of stachoo@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 13:32:08 +0000
Received: by wwb29 with SMTP id 29so2778001wwb.35
        for <multiple recipients>; Mon, 19 Apr 2010 06:31:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:received:date
         :x-google-sender-auth:received:message-id:subject:from:to
         :content-type;
        bh=BqgD5kFsg1EfiXQQ5rj4bQb68y+X2ETi3pfS2ttmzQc=;
        b=xmJA2Bqr3W8oqdd081UVR5uDZwrja6f7+ON6sCCZZqxvLAnltgY+HxGZYrYOkzpQ15
         pNUIqa5WVh74bZ6UUw7NR5SMFoBe2PFovywL1awgjfxatIp60FjchET66pSF6Fs+IXYp
         OU8qdsngypEcOCqKvTbx343gSvP8ZRU9FXg/Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        b=Koys8D1Koq8cbCHuJ5hYFyJyhH7GICW7TvJ0qATJdHjDUaMoBPq8DzBk/hVm+8BCj7
         ZEnCnzZ4RRm/CqmFV9YX64fevguVYmEehQQHDIszTfIqDWToi3SWIeJ42C6KzB7CJntN
         Sa7ud7WCwc2Z6gehZDJcHgTDc/7MFUYpQG7sg=
MIME-Version: 1.0
Sender: stachoo@gmail.com
Received: by 10.216.5.4 with HTTP; Mon, 19 Apr 2010 06:31:46 -0700 (PDT)
Date: Mon, 19 Apr 2010 15:31:46 +0200
X-Google-Sender-Auth: 1d716b6025a746f2
Received: by 10.216.88.11 with SMTP id z11mr4616770wee.116.1271683906418; Mon, 
	19 Apr 2010 06:31:46 -0700 (PDT)
Message-ID: <u2x5af106d61004190631rc0ac4a1ds4f3ae582b65e5a96@mail.gmail.com>
Subject: [ANN] Carrot2 3.3.0 released
From: Stanislaw Osinski <stanislaw@osinski.name>
To: lucene-user <java-user@lucene.apache.org>, solr-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d9a388823986048496fba4

--0016e6d9a388823986048496fba4
Content-Type: text/plain; charset=ISO-8859-1

Dear All,

We're pleased to announce the 3.3.0 release of Carrot2 which significantly
improves the scalability of the clustering algorithms (up to 7x times faster
clustering in case of the STC algorithm) and fixes a number of minor issues.

Release notes:
http://project.carrot2.org/release-3.3.0-notes.html

Download:
http://download.carrot2.org

JIRA issues:
http://issues.carrot2.org/secure/IssueNavigator.jspa?jqlQuery=project+%3D+CARROT+AND+fixVersion+%3D+%223.3.0%22+ORDER+BY+priority+DESC%2C+key+DESC


Similar improvements are available in Lingo3G, the real-time document
clustering engine from Carrot Search.


Thanks!

Dawid Weiss, Stanislaw Osinski
Carrot Search, info@carrot-search.com

--0016e6d9a388823986048496fba4--

From java-user-return-45846-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 14:44:03 2010
Return-Path: <java-user-return-45846-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31418 invoked from network); 19 Apr 2010 14:44:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 14:44:03 -0000
Received: (qmail 46036 invoked by uid 500); 19 Apr 2010 14:44:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45932 invoked by uid 500); 19 Apr 2010 14:44:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45924 invoked by uid 99); 19 Apr 2010 14:44:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 14:44:00 +0000
X-ASF-Spam-Status: No, hits=1.9 required=10.0
	tests=AWL,HTML_MESSAGE,MIME_QP_LONG_LINE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [80.240.225.48] (HELO SAMRE007.hmc.telekom.at) (80.240.225.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 14:43:53 +0000
User-Agent: Microsoft-Entourage/12.24.0.100205
Date: Mon, 19 Apr 2010 16:43:26 +0200
Subject: Combining PrefixQuery and FuzzyQuery
From: Lukas =?ISO-8859-1?B?1nN0ZXJyZWljaGVy?=
	<lukas.oesterreicher@austria.real.com>
To: <java-user@lucene.apache.org>
Message-ID: <C7F238AE.2D89%lukas.oesterreicher@austria.real.com>
Thread-Topic: Combining PrefixQuery and FuzzyQuery
Thread-Index: AcrfzqsUXudgxM6dy06hZn0dRHE04A==
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="B_3354540208_9650242"
X-OriginalArrivalTime: 19 Apr 2010 14:43:29.0815 (UTC) FILETIME=[AD5ADA70:01CADFCE]

--B_3354540208_9650242
Content-Type: text/plain; charset="ISO-8859-1"
Content-Transfer-Encoding: quoted-printable

Hello.

Is it possible to combine PrefixQuery and FuzzyQuery?
The search on a term should both be fuzzy but also match with results that
jut begin with that token (or an approximation of that token).

If it is possible, can you give me an example on how to achieve this?

Currently I only use the PrefixQuery and performance is ok.
Would performance with such a combination be much worse?

I would not even need a complete fuzzy search, it would suffice
To have the matching be done without caring for cases (this I already have
present by using a modified WhitespaceTokenizer which filters
To lower cases) and with also matching characters where accents
Also match, so e would match =E9 and =E8.

Finally, I would like to know how much sorting a string field
Which is not too long (containing track or album title) affects performance
Copared to not providing any sorting parameters.

Thanx in advance,
Lukas

--B_3354540208_9650242--

From java-user-return-45847-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 14:49:26 2010
Return-Path: <java-user-return-45847-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35632 invoked from network); 19 Apr 2010 14:49:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 14:49:26 -0000
Received: (qmail 67398 invoked by uid 500); 19 Apr 2010 14:49:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67347 invoked by uid 500); 19 Apr 2010 14:49:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67339 invoked by uid 99); 19 Apr 2010 14:49:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 14:49:23 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 14:49:16 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 70FF2D36004
	for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 16:48:55 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Q54isRo0RhgJ for <java-user@lucene.apache.org>;
	Mon, 19 Apr 2010 16:48:49 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id BEFFFD36003
	for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 16:48:49 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <C7F238AE.2D89%lukas.oesterreicher@austria.real.com>
In-Reply-To: <C7F238AE.2D89%lukas.oesterreicher@austria.real.com>
Subject: RE: Combining PrefixQuery and FuzzyQuery
Date: Mon, 19 Apr 2010 16:48:58 +0200
Message-ID: <027301cadfcf$71975d50$54c617f0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
thread-index: AcrfzqsUXudgxM6dy06hZn0dRHE04AAALRfg
Content-Language: de

How about a fuzzy query with a prefix term? Its configureable.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Lukas =C3=96sterreicher =
[mailto:lukas.oesterreicher@austria.real.com]
> Sent: Monday, April 19, 2010 4:43 PM
> To: java-user@lucene.apache.org
> Subject: Combining PrefixQuery and FuzzyQuery
>=20
> Hello.
>=20
> Is it possible to combine PrefixQuery and FuzzyQuery?
> The search on a term should both be fuzzy but also match with results
> that
> jut begin with that token (or an approximation of that token).
>=20
> If it is possible, can you give me an example on how to achieve this?
>=20
> Currently I only use the PrefixQuery and performance is ok.
> Would performance with such a combination be much worse?
>=20
> I would not even need a complete fuzzy search, it would suffice
> To have the matching be done without caring for cases (this I already
> have
> present by using a modified WhitespaceTokenizer which filters
> To lower cases) and with also matching characters where accents
> Also match, so e would match =C3=A9 and =C3=A8.
>=20
> Finally, I would like to know how much sorting a string field
> Which is not too long (containing track or album title) affects
> performance
> Copared to not providing any sorting parameters.
>=20
> Thanx in advance,
> Lukas


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45848-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 15:00:46 2010
Return-Path: <java-user-return-45848-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42520 invoked from network); 19 Apr 2010 15:00:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 15:00:45 -0000
Received: (qmail 93852 invoked by uid 500); 19 Apr 2010 15:00:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93608 invoked by uid 500); 19 Apr 2010 15:00:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93600 invoked by uid 99); 19 Apr 2010 15:00:42 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 15:00:42 +0000
X-ASF-Spam-Status: No, hits=0.9 required=10.0
	tests=AWL,MIME_QP_LONG_LINE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [80.240.225.48] (HELO SAMRE007.hmc.telekom.at) (80.240.225.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 15:00:37 +0000
User-Agent: Microsoft-Entourage/12.24.0.100205
Date: Mon, 19 Apr 2010 17:00:12 +0200
Subject: Re: Combining PrefixQuery and FuzzyQuery
From: Lukas =?ISO-8859-1?B?1nN0ZXJyZWljaGVy?=
	<lukas.oesterreicher@austria.real.com>
To: <java-user@lucene.apache.org>
Message-ID: <C7F23C9C.2D8E%lukas.oesterreicher@austria.real.com>
Thread-Topic: Combining PrefixQuery and FuzzyQuery
Thread-Index: AcrfzqsUXudgxM6dy06hZn0dRHE04AAALRfgAABo0dg=
In-Reply-To: <027301cadfcf$71975d50$54c617f0$@de>
MIME-Version: 1.0
Content-Type: text/plain; charset="ISO-8859-1"
Content-Transfer-Encoding: quoted-printable
X-OriginalArrivalTime: 19 Apr 2010 15:00:15.0287 (UTC) FILETIME=[04A9B470:01CADFD1]

Well, how would this look like in code?
Currently I have the prefix query like this:

BooleanQuery bQuery =3D new BooleanQuery();
PrefixQuery prefixQuery =3D new PrefixQuery(new Term("item.name", termText));
bQuery.add( prefixQuery, Occur.MUST);

I dont see any class named PrefixTerm.
I'd appreciate it if you could show me how it is done in java code.

Lukas

Am 19.04.10 16:48 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:

> How about a fuzzy query with a prefix term? Its configureable.
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
>> -----Original Message-----
>> From: Lukas =D6sterreicher [mailto:lukas.oesterreicher@austria.real.com]
>> Sent: Monday, April 19, 2010 4:43 PM
>> To: java-user@lucene.apache.org
>> Subject: Combining PrefixQuery and FuzzyQuery
>>=20
>> Hello.
>>=20
>> Is it possible to combine PrefixQuery and FuzzyQuery?
>> The search on a term should both be fuzzy but also match with results
>> that
>> jut begin with that token (or an approximation of that token).
>>=20
>> If it is possible, can you give me an example on how to achieve this?
>>=20
>> Currently I only use the PrefixQuery and performance is ok.
>> Would performance with such a combination be much worse?
>>=20
>> I would not even need a complete fuzzy search, it would suffice
>> To have the matching be done without caring for cases (this I already
>> have
>> present by using a modified WhitespaceTokenizer which filters
>> To lower cases) and with also matching characters where accents
>> Also match, so e would match =E9 and =E8.
>>=20
>> Finally, I would like to know how much sorting a string field
>> Which is not too long (containing track or album title) affects
>> performance
>> Copared to not providing any sorting parameters.
>>=20
>> Thanx in advance,
>> Lukas
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45849-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 15:13:29 2010
Return-Path: <java-user-return-45849-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49754 invoked from network); 19 Apr 2010 15:13:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 15:13:29 -0000
Received: (qmail 15775 invoked by uid 500); 19 Apr 2010 15:13:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 15725 invoked by uid 500); 19 Apr 2010 15:13:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 15717 invoked by uid 99); 19 Apr 2010 15:13:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 15:13:26 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 15:13:19 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9A793D36005
	for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 17:12:59 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id OXxv6KMo2wHl for <java-user@lucene.apache.org>;
	Mon, 19 Apr 2010 17:12:54 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.74])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 061D4D36003
	for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 17:12:53 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <027301cadfcf$71975d50$54c617f0$@de> <C7F23C9C.2D8E%lukas.oesterreicher@austria.real.com>
In-Reply-To: <C7F23C9C.2D8E%lukas.oesterreicher@austria.real.com>
Subject: RE: Combining PrefixQuery and FuzzyQuery
Date: Mon, 19 Apr 2010 17:13:03 +0200
Message-ID: <027401cadfd2$ce98ff60$6bcafe20$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
thread-index: AcrfzqsUXudgxM6dy06hZn0dRHE04AAALRfgAABo0dgAAG0rAA==
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Dont use PrefixQuery, only FuzzyQuery. There you pass in the whole term =
(with prefix) and define how many characters are the prefix.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Lukas =C3=96sterreicher =
[mailto:lukas.oesterreicher@austria.real.com]
> Sent: Monday, April 19, 2010 5:00 PM
> To: java-user@lucene.apache.org
> Subject: Re: Combining PrefixQuery and FuzzyQuery
>=20
> Well, how would this look like in code?
> Currently I have the prefix query like this:
>=20
> BooleanQuery bQuery =3D new BooleanQuery();
> PrefixQuery prefixQuery =3D new PrefixQuery(new Term("item.name",
> termText));
> bQuery.add( prefixQuery, Occur.MUST);
>=20
> I dont see any class named PrefixTerm.
> I'd appreciate it if you could show me how it is done in java code.
>=20
> Lukas
>=20
> Am 19.04.10 16:48 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:
>=20
> > How about a fuzzy query with a prefix term? Its configureable.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> >> -----Original Message-----
> >> From: Lukas =C3=96sterreicher
> [mailto:lukas.oesterreicher@austria.real.com]
> >> Sent: Monday, April 19, 2010 4:43 PM
> >> To: java-user@lucene.apache.org
> >> Subject: Combining PrefixQuery and FuzzyQuery
> >>
> >> Hello.
> >>
> >> Is it possible to combine PrefixQuery and FuzzyQuery?
> >> The search on a term should both be fuzzy but also match with
> results
> >> that
> >> jut begin with that token (or an approximation of that token).
> >>
> >> If it is possible, can you give me an example on how to achieve
> this?
> >>
> >> Currently I only use the PrefixQuery and performance is ok.
> >> Would performance with such a combination be much worse?
> >>
> >> I would not even need a complete fuzzy search, it would suffice
> >> To have the matching be done without caring for cases (this I
> already
> >> have
> >> present by using a modified WhitespaceTokenizer which filters
> >> To lower cases) and with also matching characters where accents
> >> Also match, so e would match =C3=A9 and =C3=A8.
> >>
> >> Finally, I would like to know how much sorting a string field
> >> Which is not too long (containing track or album title) affects
> >> performance
> >> Copared to not providing any sorting parameters.
> >>
> >> Thanx in advance,
> >> Lukas
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45850-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 15:55:03 2010
Return-Path: <java-user-return-45850-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74531 invoked from network); 19 Apr 2010 15:55:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 15:55:03 -0000
Received: (qmail 79892 invoked by uid 500); 19 Apr 2010 15:55:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79832 invoked by uid 500); 19 Apr 2010 15:55:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79824 invoked by uid 99); 19 Apr 2010 15:55:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 15:55:00 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of isaacrc82@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 15:54:54 +0000
Received: by gwj17 with SMTP id 17so1124539gwj.35
        for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 08:54:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=pWzz9DY1oBC1zhLzL+hCjtWDEvneQq0LYcEWSlKVADo=;
        b=qQzY9RzPCtgTG7XzLutx5jAzunYn3VujDcMxV2ijppjzlMIQ/75nDP4KghnKh0QRyN
         AEB0xukwlz+krOswvxvdp704qUO0semqvoLTCza+akGY8Qf0NmQVzt/iXoWnZPFYz7fc
         RSPx9JACwhqbnXHVxhfw+3IwfJvecv6T9MksY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=okh+8jfLJNTVlzUowMmWRIVSNfIm5x/dFx1SI7DyVXKtYi5FZcklBr1JBWJlga3rgL
         kspFA9Ok5jnrDt0Rtgbols2x0c9Ck7pfFWrVxKB+fWe/4RMFOjFXg/H7YqfOG9fAYb08
         JOai2OlFtnSDejjiSYWSgik0LPPp/Wy44sqhw=
MIME-Version: 1.0
Received: by 10.100.174.13 with HTTP; Mon, 19 Apr 2010 08:54:25 -0700 (PDT)
Date: Mon, 19 Apr 2010 11:54:25 -0400
Received: by 10.101.211.15 with SMTP id n15mr14991955anq.64.1271692466067; 
	Mon, 19 Apr 2010 08:54:26 -0700 (PDT)
Message-ID: <z2lbf1404351004190854u2cdebaddp8bf1b548ffcef733@mail.gmail.com>
Subject: Big problem with solr in an official server.
From: Ariel <isaacrc82@gmail.com>
To: lucene user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=001636c5c210b476a8048498f95e

--001636c5c210b476a8048498f95e
Content-Type: text/plain; charset=ISO-8859-1

Hi everybody:

I have a big problem with solr in a server with the memory size it is using,
I would want to know how to configure it to use a limited memory size, I am
setting up Solr with "java -jar start.jar" command in an ubuntu server, the
process start.jar is using 7Gb of  memory in the server and it is affecting
considerably the performance of the server.
Could you help me please ???
Thanks in advance.
Regards
Ariel

--001636c5c210b476a8048498f95e--

From java-user-return-45851-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 16:03:49 2010
Return-Path: <java-user-return-45851-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82987 invoked from network); 19 Apr 2010 16:03:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 16:03:48 -0000
Received: (qmail 98809 invoked by uid 500); 19 Apr 2010 16:03:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98780 invoked by uid 500); 19 Apr 2010 16:03:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98772 invoked by uid 99); 19 Apr 2010 16:03:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 16:03:46 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=AWL,MIME_QP_LONG_LINE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [80.240.225.48] (HELO SAMRE007.hmc.telekom.at) (80.240.225.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 16:03:37 +0000
User-Agent: Microsoft-Entourage/12.24.0.100205
Date: Mon, 19 Apr 2010 18:03:10 +0200
Subject: Re: Combining PrefixQuery and FuzzyQuery
From: Lukas =?ISO-8859-1?B?1nN0ZXJyZWljaGVy?=
	<lukas.oesterreicher@austria.real.com>
To: <java-user@lucene.apache.org>,
	Uwe Schindler <uwe@thetaphi.de>
Message-ID: <C7F24B5E.2D93%lukas.oesterreicher@austria.real.com>
Thread-Topic: Combining PrefixQuery and FuzzyQuery
Thread-Index: AcrfzqsUXudgxM6dy06hZn0dRHE04AAALRfgAABo0dgAAG0rAAABxcxr
In-Reply-To: <027401cadfd2$ce98ff60$6bcafe20$@de>
MIME-Version: 1.0
Content-Type: text/plain; charset="ISO-8859-1"
Content-Transfer-Encoding: quoted-printable
X-OriginalArrivalTime: 19 Apr 2010 16:03:14.0429 (UTC) FILETIME=[D13502D0:01CADFD9]

Thanx.
However I do not fully understand, specifically with "how many characters
are the prefix".

As far as I understand you tell the prefix query
How fuzzy the search shall be. In my example below
0.79 means 4 out of 5 characters must match.

Do you mean I should change code to this:

BooleanQuery bQuery =3D new BooleanQuery();
FuzzyQuery fuzzyPrefixQuery =3D new FuzzyQuery(new Term("item.name", termText
+ "*"), 0.79f);
bQuery.add(fuzzyPrefixQuery , Occur.MUST);

Lukas

Am 19.04.10 17:13 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:

> Dont use PrefixQuery, only FuzzyQuery. There you pass in the whole term (=
with
> prefix) and define how many characters are the prefix.
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
>> -----Original Message-----
>> From: Lukas =D6sterreicher [mailto:lukas.oesterreicher@austria.real.com]
>> Sent: Monday, April 19, 2010 5:00 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: Combining PrefixQuery and FuzzyQuery
>>=20
>> Well, how would this look like in code?
>> Currently I have the prefix query like this:
>>=20
>> BooleanQuery bQuery =3D new BooleanQuery();
>> PrefixQuery prefixQuery =3D new PrefixQuery(new Term("item.name",
>> termText));
>> bQuery.add( prefixQuery, Occur.MUST);
>>=20
>> I dont see any class named PrefixTerm.
>> I'd appreciate it if you could show me how it is done in java code.
>>=20
>> Lukas
>>=20
>> Am 19.04.10 16:48 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:
>>=20
>>> How about a fuzzy query with a prefix term? Its configureable.
>>>=20
>>> -----
>>> Uwe Schindler
>>> H.-H.-Meier-Allee 63, D-28213 Bremen
>>> http://www.thetaphi.de
>>> eMail: uwe@thetaphi.de
>>>=20
>>>=20
>>>> -----Original Message-----
>>>> From: Lukas =D6sterreicher
>> [mailto:lukas.oesterreicher@austria.real.com]
>>>> Sent: Monday, April 19, 2010 4:43 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Combining PrefixQuery and FuzzyQuery
>>>>=20
>>>> Hello.
>>>>=20
>>>> Is it possible to combine PrefixQuery and FuzzyQuery?
>>>> The search on a term should both be fuzzy but also match with
>> results
>>>> that
>>>> jut begin with that token (or an approximation of that token).
>>>>=20
>>>> If it is possible, can you give me an example on how to achieve
>> this?
>>>>=20
>>>> Currently I only use the PrefixQuery and performance is ok.
>>>> Would performance with such a combination be much worse?
>>>>=20
>>>> I would not even need a complete fuzzy search, it would suffice
>>>> To have the matching be done without caring for cases (this I
>> already
>>>> have
>>>> present by using a modified WhitespaceTokenizer which filters
>>>> To lower cases) and with also matching characters where accents
>>>> Also match, so e would match =E9 and =E8.
>>>>=20
>>>> Finally, I would like to know how much sorting a string field
>>>> Which is not too long (containing track or album title) affects
>>>> performance
>>>> Copared to not providing any sorting parameters.
>>>>=20
>>>> Thanx in advance,
>>>> Lukas
>>>=20
>>>=20
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>=20
>>=20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45852-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 16:18:35 2010
Return-Path: <java-user-return-45852-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96314 invoked from network); 19 Apr 2010 16:18:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 16:18:35 -0000
Received: (qmail 37253 invoked by uid 500); 19 Apr 2010 16:18:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37196 invoked by uid 500); 19 Apr 2010 16:18:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37188 invoked by uid 99); 19 Apr 2010 16:18:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 16:18:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [80.240.225.48] (HELO SAMRE007.hmc.telekom.at) (80.240.225.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 16:18:26 +0000
User-Agent: Microsoft-Entourage/12.24.0.100205
Date: Mon, 19 Apr 2010 18:18:02 +0200
Subject: Re: Combining PrefixQuery and FuzzyQuery
From: Lukas =?ISO-8859-1?B?1nN0ZXJyZWljaGVy?=
	<lukas.oesterreicher@austria.real.com>
To: <java-user@lucene.apache.org>
Message-ID: <C7F24EDA.2D96%lukas.oesterreicher@austria.real.com>
Thread-Topic: Combining PrefixQuery and FuzzyQuery
Thread-Index: AcrfzqsUXudgxM6dy06hZn0dRHE04AAALRfgAABo0dgAAG0rAAACSreZ
In-Reply-To: <027401cadfd2$ce98ff60$6bcafe20$@de>
MIME-Version: 1.0
Content-Type: text/plain; charset="ISO-8859-1"
Content-Transfer-Encoding: quoted-printable
X-OriginalArrivalTime: 19 Apr 2010 16:18:05.0144 (UTC) FILETIME=[E41D5580:01CADFDB]
X-Virus-Checked: Checked by ClamAV on apache.org

Update to my last response with a sample of what I thought you might mean:

This does not work.
Original query up till now:
+(item.name:the* item.name:the)

New query would look like this (which states
Match item.name where a term exists that is either
Exactly the or starts with the):
+(item.name:the*~0.79 item.name:the~0.79)

Until now these matched (I apply ignoring of cases as mentioned):
On The Run
The Final Cut
Us And Them

With the change "Us And Them" will not match anymore.

What I want is a change so it would even match
"Us and Th=E9m"

Lukas

Am 19.04.10 17:13 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:

> Dont use PrefixQuery, only FuzzyQuery. There you pass in the whole term (=
with
> prefix) and define how many characters are the prefix.
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
>> -----Original Message-----
>> From: Lukas =D6sterreicher [mailto:lukas.oesterreicher@austria.real.com]
>> Sent: Monday, April 19, 2010 5:00 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: Combining PrefixQuery and FuzzyQuery
>>=20
>> Well, how would this look like in code?
>> Currently I have the prefix query like this:
>>=20
>> BooleanQuery bQuery =3D new BooleanQuery();
>> PrefixQuery prefixQuery =3D new PrefixQuery(new Term("item.name",
>> termText));
>> bQuery.add( prefixQuery, Occur.MUST);
>>=20
>> I dont see any class named PrefixTerm.
>> I'd appreciate it if you could show me how it is done in java code.
>>=20
>> Lukas
>>=20
>> Am 19.04.10 16:48 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:
>>=20
>>> How about a fuzzy query with a prefix term? Its configureable.
>>>=20
>>> -----
>>> Uwe Schindler
>>> H.-H.-Meier-Allee 63, D-28213 Bremen
>>> http://www.thetaphi.de
>>> eMail: uwe@thetaphi.de
>>>=20
>>>=20
>>>> -----Original Message-----
>>>> From: Lukas =D6sterreicher
>> [mailto:lukas.oesterreicher@austria.real.com]
>>>> Sent: Monday, April 19, 2010 4:43 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Combining PrefixQuery and FuzzyQuery
>>>>=20
>>>> Hello.
>>>>=20
>>>> Is it possible to combine PrefixQuery and FuzzyQuery?
>>>> The search on a term should both be fuzzy but also match with
>> results
>>>> that
>>>> jut begin with that token (or an approximation of that token).
>>>>=20
>>>> If it is possible, can you give me an example on how to achieve
>> this?
>>>>=20
>>>> Currently I only use the PrefixQuery and performance is ok.
>>>> Would performance with such a combination be much worse?
>>>>=20
>>>> I would not even need a complete fuzzy search, it would suffice
>>>> To have the matching be done without caring for cases (this I
>> already
>>>> have
>>>> present by using a modified WhitespaceTokenizer which filters
>>>> To lower cases) and with also matching characters where accents
>>>> Also match, so e would match =E9 and =E8.
>>>>=20
>>>> Finally, I would like to know how much sorting a string field
>>>> Which is not too long (containing track or album title) affects
>>>> performance
>>>> Copared to not providing any sorting parameters.
>>>>=20
>>>> Thanx in advance,
>>>> Lukas
>>>=20
>>>=20
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>=20
>>=20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45853-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 16:54:52 2010
Return-Path: <java-user-return-45853-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7745 invoked from network); 19 Apr 2010 16:54:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 16:54:51 -0000
Received: (qmail 3040 invoked by uid 500); 19 Apr 2010 16:54:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2998 invoked by uid 500); 19 Apr 2010 16:54:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2990 invoked by uid 99); 19 Apr 2010 16:54:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 16:54:48 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 16:54:41 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 59464D36004
	for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 18:54:21 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id oza4l0HuvIjS for <java-user@lucene.apache.org>;
	Mon, 19 Apr 2010 18:54:15 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 7DCB6D36003
	for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 18:54:14 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <027401cadfd2$ce98ff60$6bcafe20$@de> <C7F24EDA.2D96%lukas.oesterreicher@austria.real.com>
In-Reply-To: <C7F24EDA.2D96%lukas.oesterreicher@austria.real.com>
Subject: RE: Combining PrefixQuery and FuzzyQuery
Date: Mon, 19 Apr 2010 18:54:23 +0200
Message-ID: <028101cadfe0$f6cdc7f0$e46957d0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
thread-index: AcrfzqsUXudgxM6dy06hZn0dRHE04AAALRfgAABo0dgAAG0rAAACSreZAAEWspA=
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

I am sorry, I dont understand what you are trying to say. Its confusing =
to me.

If you want a Fuzzy query, where the first 3 chars ("the") always match =
(a PrefixQuery) and the rest of the term is fuzzy, use this Constructor =
and pass 3 as prefixlen:

http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/search/Fuzz=
yQuery.html#FuzzyQuery(org.apache.lucene.index.Term, float, int)

e.g. new FuzzyQuery(new Term("item.name","thesuffix"), 0.79, 3)

This will match all terms starting with "the" (prefix length 3) and will =
apply a fuzzy to the rest ("suffix"). Is this what you want to have?

By the way neither prefix queries nor fuzzy queries have a "*" after the =
term, this is only notation of QueryParser but not the term.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Lukas =C3=96sterreicher =
[mailto:lukas.oesterreicher@austria.real.com]
> Sent: Monday, April 19, 2010 6:18 PM
> To: java-user@lucene.apache.org
> Subject: Re: Combining PrefixQuery and FuzzyQuery
>=20
> Update to my last response with a sample of what I thought you might
> mean:
>=20
> This does not work.
> Original query up till now:
> +(item.name:the* item.name:the)
>=20
> New query would look like this (which states
> Match item.name where a term exists that is either
> Exactly the or starts with the):
> +(item.name:the*~0.79 item.name:the~0.79)
>=20
> Until now these matched (I apply ignoring of cases as mentioned):
> On The Run
> The Final Cut
> Us And Them
>=20
> With the change "Us And Them" will not match anymore.
>=20
> What I want is a change so it would even match
> "Us and Th=C3=A9m"
>=20
> Lukas
>=20
> Am 19.04.10 17:13 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:
>=20
> > Dont use PrefixQuery, only FuzzyQuery. There you pass in the whole
> term (with
> > prefix) and define how many characters are the prefix.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> >> -----Original Message-----
> >> From: Lukas =C3=96sterreicher
> [mailto:lukas.oesterreicher@austria.real.com]
> >> Sent: Monday, April 19, 2010 5:00 PM
> >> To: java-user@lucene.apache.org
> >> Subject: Re: Combining PrefixQuery and FuzzyQuery
> >>
> >> Well, how would this look like in code?
> >> Currently I have the prefix query like this:
> >>
> >> BooleanQuery bQuery =3D new BooleanQuery();
> >> PrefixQuery prefixQuery =3D new PrefixQuery(new Term("item.name",
> >> termText));
> >> bQuery.add( prefixQuery, Occur.MUST);
> >>
> >> I dont see any class named PrefixTerm.
> >> I'd appreciate it if you could show me how it is done in java code.
> >>
> >> Lukas
> >>
> >> Am 19.04.10 16:48 schrieb "Uwe Schindler" unter <uwe@thetaphi.de>:
> >>
> >>> How about a fuzzy query with a prefix term? Its configureable.
> >>>
> >>> -----
> >>> Uwe Schindler
> >>> H.-H.-Meier-Allee 63, D-28213 Bremen
> >>> http://www.thetaphi.de
> >>> eMail: uwe@thetaphi.de
> >>>
> >>>
> >>>> -----Original Message-----
> >>>> From: Lukas =C3=96sterreicher
> >> [mailto:lukas.oesterreicher@austria.real.com]
> >>>> Sent: Monday, April 19, 2010 4:43 PM
> >>>> To: java-user@lucene.apache.org
> >>>> Subject: Combining PrefixQuery and FuzzyQuery
> >>>>
> >>>> Hello.
> >>>>
> >>>> Is it possible to combine PrefixQuery and FuzzyQuery?
> >>>> The search on a term should both be fuzzy but also match with
> >> results
> >>>> that
> >>>> jut begin with that token (or an approximation of that token).
> >>>>
> >>>> If it is possible, can you give me an example on how to achieve
> >> this?
> >>>>
> >>>> Currently I only use the PrefixQuery and performance is ok.
> >>>> Would performance with such a combination be much worse?
> >>>>
> >>>> I would not even need a complete fuzzy search, it would suffice
> >>>> To have the matching be done without caring for cases (this I
> >> already
> >>>> have
> >>>> present by using a modified WhitespaceTokenizer which filters
> >>>> To lower cases) and with also matching characters where accents
> >>>> Also match, so e would match =C3=A9 and =C3=A8.
> >>>>
> >>>> Finally, I would like to know how much sorting a string field
> >>>> Which is not too long (containing track or album title) affects
> >>>> performance
> >>>> Copared to not providing any sorting parameters.
> >>>>
> >>>> Thanx in advance,
> >>>> Lukas
> >>>
> >>>
> >>> =
-------------------------------------------------------------------
> --
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>
> >>
> >> =
--------------------------------------------------------------------
> -
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45854-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 17:35:26 2010
Return-Path: <java-user-return-45854-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21483 invoked from network); 19 Apr 2010 17:35:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 17:35:26 -0000
Received: (qmail 79897 invoked by uid 500); 19 Apr 2010 17:35:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79834 invoked by uid 500); 19 Apr 2010 17:35:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79825 invoked by uid 99); 19 Apr 2010 17:35:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 17:35:23 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erdincyilmazel@gmail.com designates 74.125.78.24 as permitted sender)
Received: from [74.125.78.24] (HELO ey-out-2122.google.com) (74.125.78.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 17:35:18 +0000
Received: by ey-out-2122.google.com with SMTP id 22so315917eye.3
        for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 10:34:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=AgE4U8y3K5lJHPyWljGKB2Yhbfrf6iLvmFJdbACvgZ4=;
        b=ER/IfXJweg3UO4EcwJWa1R/5BvVwt4T/0yj/jS1WwgW3LNJjBQTp379eIGgErxoktd
         gv9bnpp7G/i6D418YgQ5s7WGmKmVAH6T4If3CVG87YRsjEkbFy78J3SrnGmxB055Z9+X
         2Tc7eI4Es+PLaDsGfdUoDKAguWe7zCTwzSAPk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=xltfsmsDXAnzZAXRCO1sS1hzpxpo1gvrb0U+hLAwnvY0uQCc1ocQA7giD/ViBn5Y3E
         I9tfQW+40TmMa+1ZDuNpodAHu4YCwwP9VP1WEQTUrD665zN/5Mrct3jARQGSZwYS9WQF
         R3Uy+usmOJXXlQsZSexpmV7OE9pXDXmNMxk7E=
MIME-Version: 1.0
Received: by 10.239.133.212 with HTTP; Mon, 19 Apr 2010 10:34:56 -0700 (PDT)
In-Reply-To: <x2w359a92831004181722zf7bd2e20n80890f67727232b9@mail.gmail.com>
References: <r2n7af3bac91004181437pa1979500t15b5fa447755f607@mail.gmail.com>
	 <x2w359a92831004181722zf7bd2e20n80890f67727232b9@mail.gmail.com>
Date: Mon, 19 Apr 2010 18:34:56 +0100
Received: by 10.239.188.135 with SMTP id p7mr480002hbh.90.1271698496609; Mon, 
	19 Apr 2010 10:34:56 -0700 (PDT)
Message-ID: <p2s7af3bac91004191034od51e9313p84d15a3c3f6d1b8c@mail.gmail.com>
Subject: Re: Different index per user
From: Erdinc Yilmazel <erdincyilmazel@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f6cece26dfee04849a617c

--001485f6cece26dfee04849a617c
Content-Type: text/plain; charset=ISO-8859-1

Thanks Erick,
I don't have any access control constraints. The index won't be exposed to
the users. I am just concerned about scalability issues. I'll probably use
adding a user identifier field approach first and I'll try sharding based on
that value when my index grows.

Erdinc

On Mon, Apr 19, 2010 at 1:22 AM, Erick Erickson <erickerickson@gmail.com>wrote:

> No really better ways that spring to mind. At root you have to somehow
> know what document is added by each user, and adding a field to
> the document with this info is quite reasonable, then just tack
> on an +user:<current user> to each query.
>
> You can get creative with Lucene Filters. That is, create a Filter for
> a user when s/he logs on pass that to queries, see some of the
> Searcher.search methods that take a Filter. But there's no
> real reason to go there unless you have performance problems.
>
> This is the fairly simple case, you're not indicating that you're after
> some generic Access Control List functionality so I'd stick with
> the simple approach until proven inadequate...
>
> HTH
> Erick
>
> On Sun, Apr 18, 2010 at 5:37 PM, Erdinc Yilmazel <erdinc@yilmazel.com
> >wrote:
>
> > I am building an online application where I want to provide search
> > functionality to users and each user is to search only within his own
> data.
> > Can you give me some ideas about the structure of the index that I should
> > have in this scenario? I know I could use a different index per user
> > account
> > but that is simply not practical. I could also create a single index and
> > use
> > a separate field to identify the documents that are related to a user
> > account and create my queries accordingly. However I am guessing that
> there
> > might be better ways to partition my index based on the user identifiers.
> >
> > Thanks,
> >
> > Erdinc
> >
>

--001485f6cece26dfee04849a617c--

From java-user-return-45855-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 17:41:00 2010
Return-Path: <java-user-return-45855-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24283 invoked from network); 19 Apr 2010 17:41:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 17:41:00 -0000
Received: (qmail 93095 invoked by uid 500); 19 Apr 2010 17:40:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93062 invoked by uid 500); 19 Apr 2010 17:40:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93054 invoked by uid 99); 19 Apr 2010 17:40:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 17:40:58 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of andrhahn@hotmail.com designates 65.55.90.102 as permitted sender)
Received: from [65.55.90.102] (HELO snt0-omc2-s27.snt0.hotmail.com) (65.55.90.102)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 17:40:49 +0000
Received: from SNT135-W42 ([65.55.90.72]) by snt0-omc2-s27.snt0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 19 Apr 2010 10:40:28 -0700
Message-ID: <SNT135-w42332D5E846A46B1505527D90B0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_d800c898-012b-404e-9f8d-485018818b09_"
X-Originating-IP: [75.73.86.173]
From: Andy <andrhahn@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: How to search by numbers
Date: Mon, 19 Apr 2010 12:40:28 -0500
Importance: Normal
MIME-Version: 1.0
X-OriginalArrivalTime: 19 Apr 2010 17:40:28.0464 (UTC) FILETIME=[66901B00:01CADFE7]
X-Virus-Checked: Checked by ClamAV on apache.org

--_d800c898-012b-404e-9f8d-485018818b09_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


Hi=2C I have indexed the following two fields:
org_id - NOT_ANALYZEDorg_name - ANALYZED
However when I try to search by org_id=2C for example=2C 12345=2C I get no =
hits. =20
I am using the StandardAnalyzer to index and search. =20
And I am using:  Query query =3D queryParser.parse("org_id:12345")=3B
Any ideas?  Thx 		 	   		 =20
_________________________________________________________________
Hotmail is redefining busy with tools for the New Busy. Get more from your =
inbox.
http://www.windowslive.com/campaign/thenewbusy?ocid=3DPID28326::T:WLMTAGL:O=
N:WL:en-US:WM_HMP:042010_2=

--_d800c898-012b-404e-9f8d-485018818b09_--

From java-user-return-45856-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 17:53:18 2010
Return-Path: <java-user-return-45856-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27431 invoked from network); 19 Apr 2010 17:53:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 17:53:18 -0000
Received: (qmail 6880 invoked by uid 500); 19 Apr 2010 17:53:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6823 invoked by uid 500); 19 Apr 2010 17:53:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6813 invoked by uid 99); 19 Apr 2010 17:53:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 17:53:15 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.49.13] (HELO web52903.mail.re2.yahoo.com) (206.190.49.13)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 19 Apr 2010 17:53:06 +0000
Received: (qmail 43639 invoked by uid 60001); 19 Apr 2010 17:52:45 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271699565; bh=R4zXyW+HNmPT4nWmd3Dui889sFdB8mO8QPxXlarQaco=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=YpCCzmcTX6DV325c+WzbmULwbR/kaSy5d06u7M+BoBEa3B4q5OnQ/PfMJXHd9Mnc/M5PvF8jGCxkBSWNmh4WkCSDuktit7jCwToSeLoKZBMLxb7Z3Yx/k/hFTve+6CxX7HCqtSq5v9mwVYXIKFTDlirzK5eU07qR8m3i303C+/g=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=QelbqVtChClUpGs9QdUEb0IqTcoK4xZ6FB3EU8V8BJvQ6C3RCBXgv4jLUJcNXF6OcG4CmJ6JTn4bFL+Y52bU5xm3hBWpvWXwIGsTaXnKu8mIOlEIVc6GMjWbM026RRfH0DTXhW7ywcD9nk2yY9xI/ocLgQGq042Lnmj0h4PXGnc=;
Message-ID: <238175.41538.qm@web52903.mail.re2.yahoo.com>
X-YMail-OSG: S0OoUVoVM1mNR5RCPT6RJS5O2qMPvmEGudd3YCfbqBO8u9i
 GYCDgmc0C4wc28zpoLy3DPdLIILPDnCzLPbWXjQF4fI0pjDZpOfkgCRywivT
 5nRpbqHKpl9YeOjyo7p7MnF3hGr20hkku7r7mWxITdpCg1FsLa3gAY56K5Tw
 14nU4HegmmmHfKuFicXlQIvdGroBRPAx9ghZ4kZ9YCpRBVmZRZA5ES.Gww7T
 bpqdqgibukNJK3bCe.P98gJaVdrW8is2ZCYORNj212fT37ncdLCJJszdjQRY
 QFHXHmqVSRF_JqsT4jfr6mkPl5JCbZr7qgb7wUVgZtd8QaceMmkE2Qg--
Received: from [95.15.156.67] by web52903.mail.re2.yahoo.com via HTTP; Mon, 19 Apr 2010 10:52:45 PDT
X-Mailer: YahooMailClassic/10.1.9 YahooMailWebService/0.8.100.260964
Date: Mon, 19 Apr 2010 10:52:45 -0700 (PDT)
From: Ahmet Arslan <iorixxx@yahoo.com>
Subject: Re: How to search by numbers
To: java-user@lucene.apache.org
In-Reply-To: <SNT135-w42332D5E846A46B1505527D90B0@phx.gbl>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

=0A> Hi, I have indexed the following two fields:=0A> org_id - NOT_ANALYZED=
org_name - ANALYZED=0A> However when I try to search by org_id, for example=
, 12345,=0A> I get no hits.=A0 =0A> I am using the StandardAnalyzer to inde=
x and search.=A0=0A> =0A> And I am using:=A0 Query query =3D=0A> queryParse=
r.parse("org_id:12345");=0A=0AWhat happens when you search with this query?=
 =0AQuery query  =3D new TermQuery(new Term("org_id","12345"));=0A=0A=0A   =
   

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45857-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 18:25:07 2010
Return-Path: <java-user-return-45857-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42748 invoked from network); 19 Apr 2010 18:25:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 18:25:07 -0000
Received: (qmail 49484 invoked by uid 500); 19 Apr 2010 18:25:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49435 invoked by uid 500); 19 Apr 2010 18:25:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49427 invoked by uid 99); 19 Apr 2010 18:25:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 18:25:04 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 18:24:58 +0000
Received: by ywh38 with SMTP id 38so2693218ywh.29
        for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 11:24:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=WjUiudXdB6/LwRlQFH0bKMHV7JK0zf0GaUWcbSidwHM=;
        b=rHRyOwDUrpr2kxkKZ+wnQnhEAhwHIZaSQQbx0op/ZwrpDc22Dbv/lO69+zSfhn7WQ0
         6cOFMzBASnedCZE1PfYQIrA9yu2A9plKA2NXaVDEcEhu0U4wulo9C76QdCZ54fChpvwi
         LXR0v17/EWOiIXYQezKo6Hz1QougpLmHL7f+k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=JJJGag4lmgofY+S+MB/2fsMwhsmFPanFatw/t2oGA66NW/MHyFWoQX2aWwAzhHrGWV
         hRyJzie7Wa1NMzl+bGrZVVXm13MH4o8pIh0xbr6Hzb13+yldjdYQndwmMDw5w811Zct3
         zFAsviEFdRiZ7zdT/+iYXUDlZlwVTalNo+AtE=
MIME-Version: 1.0
Received: by 10.150.199.5 with HTTP; Mon, 19 Apr 2010 11:24:36 -0700 (PDT)
In-Reply-To: <p2s7af3bac91004191034od51e9313p84d15a3c3f6d1b8c@mail.gmail.com>
References: <r2n7af3bac91004181437pa1979500t15b5fa447755f607@mail.gmail.com>
	 <x2w359a92831004181722zf7bd2e20n80890f67727232b9@mail.gmail.com>
	 <p2s7af3bac91004191034od51e9313p84d15a3c3f6d1b8c@mail.gmail.com>
Date: Mon, 19 Apr 2010 14:24:36 -0400
Received: by 10.150.127.15 with SMTP id z15mr6254795ybc.89.1271701476784; Mon, 
	19 Apr 2010 11:24:36 -0700 (PDT)
Message-ID: <o2p359a92831004191124p44538facx13894f72e231f6e4@mail.gmail.com>
Subject: Re: Different index per user
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd7054ec8bb3204849b125e
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd7054ec8bb3204849b125e
Content-Type: text/plain; charset=ISO-8859-1

If you're thinking about sharding etc, have you looked at SOLR which
manages a lot of the hard stuff for you?

Best
Erick

On Mon, Apr 19, 2010 at 1:34 PM, Erdinc Yilmazel
<erdincyilmazel@gmail.com>wrote:

> Thanks Erick,
> I don't have any access control constraints. The index won't be exposed to
> the users. I am just concerned about scalability issues. I'll probably use
> adding a user identifier field approach first and I'll try sharding based
> on
> that value when my index grows.
>
> Erdinc
>
> On Mon, Apr 19, 2010 at 1:22 AM, Erick Erickson <erickerickson@gmail.com
> >wrote:
>
> > No really better ways that spring to mind. At root you have to somehow
> > know what document is added by each user, and adding a field to
> > the document with this info is quite reasonable, then just tack
> > on an +user:<current user> to each query.
> >
> > You can get creative with Lucene Filters. That is, create a Filter for
> > a user when s/he logs on pass that to queries, see some of the
> > Searcher.search methods that take a Filter. But there's no
> > real reason to go there unless you have performance problems.
> >
> > This is the fairly simple case, you're not indicating that you're after
> > some generic Access Control List functionality so I'd stick with
> > the simple approach until proven inadequate...
> >
> > HTH
> > Erick
> >
> > On Sun, Apr 18, 2010 at 5:37 PM, Erdinc Yilmazel <erdinc@yilmazel.com
> > >wrote:
> >
> > > I am building an online application where I want to provide search
> > > functionality to users and each user is to search only within his own
> > data.
> > > Can you give me some ideas about the structure of the index that I
> should
> > > have in this scenario? I know I could use a different index per user
> > > account
> > > but that is simply not practical. I could also create a single index
> and
> > > use
> > > a separate field to identify the documents that are related to a user
> > > account and create my queries accordingly. However I am guessing that
> > there
> > > might be better ways to partition my index based on the user
> identifiers.
> > >
> > > Thanks,
> > >
> > > Erdinc
> > >
> >
>

--000e0cd7054ec8bb3204849b125e--

From java-user-return-45858-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 18:39:39 2010
Return-Path: <java-user-return-45858-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46922 invoked from network); 19 Apr 2010 18:39:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 18:39:39 -0000
Received: (qmail 65201 invoked by uid 500); 19 Apr 2010 18:39:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65069 invoked by uid 500); 19 Apr 2010 18:39:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65061 invoked by uid 99); 19 Apr 2010 18:39:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 18:39:36 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of andrhahn@hotmail.com designates 65.55.90.97 as permitted sender)
Received: from [65.55.90.97] (HELO snt0-omc2-s22.snt0.hotmail.com) (65.55.90.97)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 18:39:30 +0000
Received: from SNT135-W57 ([65.55.90.71]) by snt0-omc2-s22.snt0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 19 Apr 2010 11:39:09 -0700
Message-ID: <SNT135-w57CD0A5BD09F2B2483D499D90B0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_26b28801-7725-4d59-ac3d-e70853cf4d29_"
X-Originating-IP: [75.73.86.173]
From: Andy <andrhahn@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: RE: How to search by numbers
Date: Mon, 19 Apr 2010 13:39:09 -0500
Importance: Normal
In-Reply-To: <238175.41538.qm@web52903.mail.re2.yahoo.com>
References:
 <SNT135-w42332D5E846A46B1505527D90B0@phx.gbl>,<238175.41538.qm@web52903.mail.re2.yahoo.com>
MIME-Version: 1.0
X-OriginalArrivalTime: 19 Apr 2010 18:39:09.0743 (UTC) FILETIME=[9968A3F0:01CADFEF]

--_26b28801-7725-4d59-ac3d-e70853cf4d29_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


That works=2C and now that I re-test my original code=2C it also works.

> Date: Mon=2C 19 Apr 2010 10:52:45 -0700
> From: iorixxx@yahoo.com
> Subject: Re: How to search by numbers
> To: java-user@lucene.apache.org
>=20
>=20
> > Hi=2C I have indexed the following two fields:
> > org_id - NOT_ANALYZEDorg_name - ANALYZED
> > However when I try to search by org_id=2C for example=2C 12345=2C
> > I get no hits. =20
> > I am using the StandardAnalyzer to index and search.=20
> >=20
> > And I am using:  Query query =3D
> > queryParser.parse("org_id:12345")=3B
>=20
> What happens when you search with this query?=20
> Query query  =3D new TermQuery(new Term("org_id"=2C"12345"))=3B
>=20
>=20
>      =20
>=20
> ---------------------------------------------------------------------
> To unsubscribe=2C e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands=2C e-mail: java-user-help@lucene.apache.org
>=20
 		 	   		 =20
_________________________________________________________________
Hotmail has tools for the New Busy. Search=2C chat and e-mail from your inb=
ox.
http://www.windowslive.com/campaign/thenewbusy?ocid=3DPID28326::T:WLMTAGL:O=
N:WL:en-US:WM_HMP:042010_1=

--_26b28801-7725-4d59-ac3d-e70853cf4d29_--

From java-user-return-45859-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 19 18:48:16 2010
Return-Path: <java-user-return-45859-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50609 invoked from network); 19 Apr 2010 18:48:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Apr 2010 18:48:16 -0000
Received: (qmail 79608 invoked by uid 500); 19 Apr 2010 18:48:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79568 invoked by uid 500); 19 Apr 2010 18:48:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79559 invoked by uid 99); 19 Apr 2010 18:48:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 18:48:13 +0000
X-ASF-Spam-Status: No, hits=1.7 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Apr 2010 18:48:08 +0000
Received: by gyf1 with SMTP id 1so2710224gyf.35
        for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 11:47:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=nqqgBQtGlMgSWox1YripQelXTw4axpKv5aQxfa6t8WI=;
        b=vrmxQebzdKFvyAyjvuyxXsxNJFI3uXK1sensM5QbA0nQgub77Mk8mnc9I+Ahf4kbx1
         9sis+dzS+l0ZQ7JddfIgA/nkTHsKOwyXG0HX2mPrQQfl2BOjNYf8jps8RNzUuduUPdZD
         C5ynJaBuGY523iKR46IkHhZQqHAy6kEdYz5wI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=gAxbEewp8AjLwB8Uk9IfRz45xOnJ9dXa7QfiI5nvk3Bf5y+Gcpt4wagRBdDyS9vcFC
         rAc5oE+ZE+0NRVn7l24esPnKuLeNH70wATglCcvRQ2rESFY5GQSTFjKj8OcJL6xVghCb
         ewJqFR8umPy+rN1Ib4XaGMSfEy8tya0EsCiW0=
MIME-Version: 1.0
Received: by 10.150.199.5 with HTTP; Mon, 19 Apr 2010 11:47:48 -0700 (PDT)
In-Reply-To: <SNT135-w57CD0A5BD09F2B2483D499D90B0@phx.gbl>
References: <SNT135-w42332D5E846A46B1505527D90B0@phx.gbl>
	 <238175.41538.qm@web52903.mail.re2.yahoo.com>
	 <SNT135-w57CD0A5BD09F2B2483D499D90B0@phx.gbl>
Date: Mon, 19 Apr 2010 14:47:48 -0400
Received: by 10.150.141.14 with SMTP id o14mr6194732ybd.131.1271702868149; 
	Mon, 19 Apr 2010 11:47:48 -0700 (PDT)
Message-ID: <n2r359a92831004191147nc2b04e5fr461ca0042bea9f22@mail.gmail.com>
Subject: Re: How to search by numbers
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd7629eb7467604849b659e

--000e0cd7629eb7467604849b659e
Content-Type: text/plain; charset=ISO-8859-1

You might also want to think about which analyzer you're using
for this field then. KeywordAnalyzer may suit your purpose if
you're using some other one, or possibly even WhitespaceAnalyzer.

PerFieldAnalyzeWrapper may be your friend too....

Bestr
Erick

On Mon, Apr 19, 2010 at 2:39 PM, Andy <andrhahn@hotmail.com> wrote:

>
> That works, and now that I re-test my original code, it also works.
>
> > Date: Mon, 19 Apr 2010 10:52:45 -0700
> > From: iorixxx@yahoo.com
> > Subject: Re: How to search by numbers
> > To: java-user@lucene.apache.org
> >
> >
> > > Hi, I have indexed the following two fields:
> > > org_id - NOT_ANALYZEDorg_name - ANALYZED
> > > However when I try to search by org_id, for example, 12345,
> > > I get no hits.
> > > I am using the StandardAnalyzer to index and search.
> > >
> > > And I am using:  Query query =
> > > queryParser.parse("org_id:12345");
> >
> > What happens when you search with this query?
> > Query query  = new TermQuery(new Term("org_id","12345"));
> >
> >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>
> _________________________________________________________________
> Hotmail has tools for the New Busy. Search, chat and e-mail from your
> inbox.
>
> http://www.windowslive.com/campaign/thenewbusy?ocid=PID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_1
>

--000e0cd7629eb7467604849b659e--

From java-user-return-45860-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 00:02:49 2010
Return-Path: <java-user-return-45860-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32886 invoked from network); 20 Apr 2010 00:02:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 00:02:48 -0000
Received: (qmail 72989 invoked by uid 500); 20 Apr 2010 00:02:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72920 invoked by uid 500); 20 Apr 2010 00:02:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72911 invoked by uid 99); 20 Apr 2010 00:02:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 00:02:46 +0000
X-ASF-Spam-Status: No, hits=-1.1 required=10.0
	tests=AWL,SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of koji@r.email.ne.jp designates 202.224.39.197 as permitted sender)
Received: from [202.224.39.197] (HELO mail1.asahi-net.or.jp) (202.224.39.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 00:02:39 +0000
Received: from koji-sekiguchi-no-macbook.local (w244069.ppp.asahi-net.or.jp [121.1.244.69])
	by mail1.asahi-net.or.jp (Postfix) with ESMTP id 0E3C89B9F0
	for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 09:02:19 +0900 (JST)
Message-ID: <4BCCEF0A.5090501@r.email.ne.jp>
Date: Tue, 20 Apr 2010 09:02:18 +0900
From: Koji Sekiguchi <koji@r.email.ne.jp>
User-Agent: Thunderbird 2.0.0.24 (Macintosh/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local>
In-Reply-To: <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Stephen Greene wrote:
> Hi Koji,
>
> An additional question. Is it possible to access the FieldTermStack from
> the FastVectorHighlighter after the it has been populated with matching
> terms from the field?
>
> I think this would provide an ideal solution for this problem, as
> ultimately I am only concerned with returning positional offsets to have
> highlighting tags applied to them in a separate process. 
>
> Thank you for your insight,
>
> Steve
>   
Hi Steve,

You cannot access FieldTermStack from FVH, but I think you
can create it by your own. To know how to do it, please refer to
FieldTermStackTest.java. To instantiate FieldTermStack, FieldQuery
object is needed. And FieldQuery object can be obtained from FVH.

But I don't understand why you need FieldTermStack. Just using
Lucene's TermVector with offsets (and positions, if necessary) doesn't
solve your problem?

Koji

-- 
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45861-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 01:17:35 2010
Return-Path: <java-user-return-45861-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85759 invoked from network); 20 Apr 2010 01:17:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 01:17:35 -0000
Received: (qmail 32389 invoked by uid 500); 20 Apr 2010 01:17:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32354 invoked by uid 500); 20 Apr 2010 01:17:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32345 invoked by uid 99); 20 Apr 2010 01:17:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 01:17:33 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.210.179] (HELO mail-yx0-f179.google.com) (209.85.210.179)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 01:17:27 +0000
Received: by yxe9 with SMTP id 9so3251147yxe.29
        for <java-user@lucene.apache.org>; Mon, 19 Apr 2010 18:17:06 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.190.12 with HTTP; Mon, 19 Apr 2010 18:17:05 -0700 (PDT)
In-Reply-To: <005d01cadd2c$6b81f920$6400a8c0@dev>
References: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>
	 <h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com>
	 <SNT135-w14B814472665EEC6226E66D90E0@phx.gbl>
	 <005d01cadd2c$6b81f920$6400a8c0@dev>
Date: Mon, 19 Apr 2010 21:17:05 -0400
Received: by 10.150.128.4 with SMTP id a4mr6659457ybd.301.1271726225287; Mon, 
	19 Apr 2010 18:17:05 -0700 (PDT)
Message-ID: <w2t9ac0c6aa1004191817zf690b77em68e70ad5de78630b@mail.gmail.com>
Subject: Re: Doc Caching
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

No, Lucene doesn't.  But the OS usually does (in is IO cache),
assuming there is spare RAM.

The "only" things that are explicitly held in memory by Lucene are the
norms ("boost bytes"), terms dict index, deletions bit vector and
field cache (used eg when you sort by a field), I think.

Mike

On Fri, Apr 16, 2010 at 2:16 AM, Chris B <chris_b@inbox.com> wrote:
> Hi
>
> Does Lucene cache the documents it retrieves? If so in which object?
>
> Chris
>
> ____________________________________________________________
> GET FREE 5GB EMAIL - Check out spam free email with many cool features!
> Visit http://www.inbox.com/email to find out more!
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45862-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 01:26:56 2010
Return-Path: <java-user-return-45862-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89979 invoked from network); 20 Apr 2010 01:26:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 01:26:56 -0000
Received: (qmail 36559 invoked by uid 500); 20 Apr 2010 01:26:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36524 invoked by uid 500); 20 Apr 2010 01:26:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36516 invoked by uid 99); 20 Apr 2010 01:26:54 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 01:26:54 +0000
X-ASF-Spam-Status: No, hits=0.4 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [149.8.64.32] (HELO mclmx2.mail.saic.com) (149.8.64.32)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 01:26:47 +0000
Received: from 0015-its-sbg03.saic.com ([149.8.64.21] [149.8.64.21]) by mclmx2.mail.saic.com with ESMTP id BT-MMP-11809270 for java-user@lucene.apache.org; Mon, 19 Apr 2010 21:26:26 -0400
X-AuditID: 95084018-b7cceae000000ea8-4c-4bcd02c21788
Received: from 0015-its-exbh03.us.saic.com (mcl-sixl-nat.saic.com [149.8.64.21])
	by 0015-its-sbg03.saic.com (Symantec Brightmail Gateway) with SMTP id 52.AE.03752.2C20DCB4; Mon, 19 Apr 2010 21:26:26 -0400 (EDT)
Received: from 0015-its-exmb01.us.saic.com ([10.43.229.16]) by 0015-its-exbh03.us.saic.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Mon, 19 Apr 2010 21:26:25 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
Subject: RE: NumericRangeQuery in BooleanQuery
Date: Mon, 19 Apr 2010 21:26:23 -0400
Message-Id: <002052E02A48964A8035D9B6E8A1647D010C9227@0015-its-exmb01.us.saic.com>
In-Reply-To: <01b101caddb1$7bff9de0$73fed9a0$@de>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: NumericRangeQuery in BooleanQuery
Thread-Index: AcrdkBa+5dRvdK7CQPSyuq8Jh50ngQAISjgQAJ2iCTA=
References: <002052E02A48964A8035D9B6E8A1647D010C8875@0015-its-exmb01.us.saic.com> <01b101caddb1$7bff9de0$73fed9a0$@de>
From: "Murdoch, Paul" <PAUL.B.MURDOCH@saic.com>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 20 Apr 2010 01:26:25.0820 (UTC) FILETIME=[7E7215C0:01CAE028]
X-Brightmail-Tracker: AAAAAA==

WWVzIGFuZCBuby4gIEkgZXh0ZW5kZWQgdGhlIFF1ZXJ5UGFyc2VyIGFuZCBvdmVycm9kZSB0aGUg
Z2V0UmFuZ2VRdWVyeSBtZXRob2QgdG8gbGV0IGl0IGJ1aWxkIE5SUS4gIFdoZW4gcGFyc2luZyBh
IEJvb2xlYW5RdWVyeSBjb250YWluaW5nIE5SUSB1c2luZyB0aGUgZXh0ZW5kZWQgUXVlcnlQYXJz
ZXIgdGhlIG92ZXJyaWRkZW4gZ2V0UmFuZ2VRdWVyeSB3YXMgbmV2ZXIgYmVpbmcgY2FsbGVkLiAg
SSB0aGluayBpdCB3YXMgc3RpbGwgdXNpbmcgdGhlIFF1ZXJ5UGFyc2VyJ3MuICBJbiB0aGUgZW5k
IEknbSBidWlsZGluZyBteSBxdWVyaWVzIGluIGNvZGUgZGlyZWN0bHkuICBUaGF0J3Mgd29ya2lu
ZyBmb3IgbWUgc28gZmFyLg0KDQpUaGFua3MsDQoNClBhdWwgDQoNCi0tLS0tT3JpZ2luYWwgTWVz
c2FnZS0tLS0tDQpGcm9tOiBqYXZhLXVzZXItcmV0dXJuLTQ1ODMzLVBBVUwuQi5NVVJET0NIPXNh
aWMuY29tQGx1Y2VuZS5hcGFjaGUub3JnIFttYWlsdG86amF2YS11c2VyLXJldHVybi00NTgzMy1Q
QVVMLkIuTVVSRE9DSD1zYWljLmNvbUBsdWNlbmUuYXBhY2hlLm9yZ10gT24gQmVoYWxmIE9mIFV3
ZSBTY2hpbmRsZXINClNlbnQ6IEZyaWRheSwgQXByaWwgMTYsIDIwMTAgNjowOSBQTQ0KVG86IGph
dmEtdXNlckBsdWNlbmUuYXBhY2hlLm9yZw0KU3ViamVjdDogUkU6IE51bWVyaWNSYW5nZVF1ZXJ5
IGluIEJvb2xlYW5RdWVyeQ0KDQpUaGF0cyBub3QgdHJ1ZSwgZG8geW91IGJ1aWxkIHRoZSBOdW1l
cmljUmFuZ2VRdWVyeSBpbiBjb2RlLCBvciBkbyB5b3UgdXNlIFF1ZXJ5UGFyc2VyLiBUaGUgbGF0
dGVyIGlzIG5vdCBhYmxlIHRvIHByb2R1Y2UgTlJRIHdpdGhvdXQgY3VzdG9taXppbmchDQoNCkVs
c2UgbnVtZXJpYyBSYW5nZVF1ZXJpZXMgYXJlIG5vIG1hZ2ljYWxseSBjb252ZXJ0ZWQgdGhleSBz
dGF5IGFuZCBhcmUgcmV3cml0dGVuIHRvIEN1c3RvbVNDb3JlUXVlcmllcy4NCi0tLS0tDQpVd2Ug
U2NoaW5kbGVyDQpILi1ILi1NZWllci1BbGxlZSA2MywgRC0yODIxMyBCcmVtZW4NCmh0dHA6Ly93
d3cudGhldGFwaGkuZGUNCmVNYWlsOiB1d2VAdGhldGFwaGkuZGUNCg0KDQo+IC0tLS0tT3JpZ2lu
YWwgTWVzc2FnZS0tLS0tDQo+IEZyb206IE11cmRvY2gsIFBhdWwgW21haWx0bzpQQVVMLkIuTVVS
RE9DSEBzYWljLmNvbV0NCj4gU2VudDogRnJpZGF5LCBBcHJpbCAxNiwgMjAxMCA4OjExIFBNDQo+
IFRvOiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4gU3ViamVjdDogTnVtZXJpY1Jhbmdl
UXVlcnkgaW4gQm9vbGVhblF1ZXJ5DQo+IA0KPiBIaSwNCj4gDQo+IA0KPiANCj4gQ2FuIGEgTnVt
ZXJpY1JhbmdlUXVlcnkgYmUgb25lIG9mIHNldmVyYWwgUXVlcmllcyBpbnNpZGUgYSBjb21wbGV4
DQo+IEJvb2xlYW5RdWVyeT8gIFdoZW4gSSBkbyB0aGlzIG15IE51bWVyaWNSYW5nZVF1ZXJ5IHNl
ZW1zIHRvDQo+IGF1dG9tYWdpY2FsbHkgYmUgY29udmVydGVkIHRvIGEgVGVybVJhbmdlUXVlcnku
DQo+IA0KPiANCj4gDQo+IFRoYW5rcywNCj4gDQo+IA0KPiANCj4gUGF1bA0KPiANCj4gDQo+IA0K
PiANCg0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2Vy
LXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQpGb3IgYWRkaXRpb25hbCBjb21tYW5kcywg
ZS1tYWlsOiBqYXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KDQo=


From java-user-return-45863-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 05:16:46 2010
Return-Path: <java-user-return-45863-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50514 invoked from network); 20 Apr 2010 05:16:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 05:16:46 -0000
Received: (qmail 40587 invoked by uid 500); 20 Apr 2010 05:16:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40445 invoked by uid 500); 20 Apr 2010 05:16:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40437 invoked by uid 99); 20 Apr 2010 05:16:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 05:16:40 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,UNPARSEABLE_RELAY
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris_b@inbox.com designates 64.135.83.51 as permitted sender)
Received: from [64.135.83.51] (HELO WM51.inbox.com) (64.135.83.51)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 20 Apr 2010 05:16:34 +0000
Received: from inbox.com (127.0.0.1:25)
	by inbox.com with [InBox.Com SMTP Server]
	id <1004192114003.WM51> for <java-user@lucene.apache.org> from <chris_b@inbox.com>;
	Mon, 19 Apr 2010 21:14:25 -0800
Received: from chris_b@inbox.com by (64.135.83.150:25) via WM51.inbox.com
  (94.170.221.62:4314) with [InBox.Com SMTP Server] id 1004192114004.WM50;
  Mon, 19 Apr 2010 21:14:28 -0800
Message-ID: <001801cae048$97825a50$6400a8c0@dev>
From: "Chris B" <chris_b@inbox.com>
To: <java-user@lucene.apache.org>
References: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl> <h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com> <SNT135-w14B814472665EEC6226E66D90E0@phx.gbl> <005d01cadd2c$6b81f920$6400a8c0@dev> <w2t9ac0c6aa1004191817zf690b77em68e70ad5de78630b@mail.gmail.com>
Subject: Re: Doc Caching
Date: Tue, 20 Apr 2010 06:16:10 +0100
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.2180
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.2180
X-IWM-ACU: UeCbup84IKHs1cpLuqKiPnL0cj8_f20OLMuayZynDi6G-Zg3ekLbCBK7aPeC
  zmgzQeRX5ULx3ABmpIi3ZGv9JIY9ht3-mKAneb4w7aI9Ym7TNc_gb8k7uT2r
  PkBgj5tmlarc@
X-Virus-Checked: Checked by ClamAV on apache.org

Mike cheers for the reply.

Is it worth setting up your own caching or letting the OS do it? I've setup 
a caching system, but if the OS is doing it it seems pointless.

Chris

----- Original Message ----- 
From: "Michael McCandless" <lucene@mikemccandless.com>
To: <java-user@lucene.apache.org>
Sent: Tuesday, April 20, 2010 2:17 AM
Subject: Re: Doc Caching


No, Lucene doesn't.  But the OS usually does (in is IO cache),
assuming there is spare RAM.

The "only" things that are explicitly held in memory by Lucene are the
norms ("boost bytes"), terms dict index, deletions bit vector and
field cache (used eg when you sort by a field), I think.

Mike

On Fri, Apr 16, 2010 at 2:16 AM, Chris B <chris_b@inbox.com> wrote:
> Hi
>
> Does Lucene cache the documents it retrieves? If so in which object?
>
> Chris
>
> ____________________________________________________________
> GET FREE 5GB EMAIL - Check out spam free email with many cool features!
> Visit http://www.inbox.com/email to find out more!
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45864-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 07:40:06 2010
Return-Path: <java-user-return-45864-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10222 invoked from network); 20 Apr 2010 07:40:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 07:40:05 -0000
Received: (qmail 27376 invoked by uid 500); 20 Apr 2010 07:40:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26955 invoked by uid 500); 20 Apr 2010 07:40:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26945 invoked by uid 99); 20 Apr 2010 07:39:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 07:39:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of xerxes862@gmail.com designates 72.14.220.157 as permitted sender)
Received: from [72.14.220.157] (HELO fg-out-1718.google.com) (72.14.220.157)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 07:39:52 +0000
Received: by fg-out-1718.google.com with SMTP id e12so2366874fga.5
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 00:39:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=vJs6mCW3nkiaKiKqnNqp3DALjEsqYzcsJnDZb+7D1CI=;
        b=QyiWQ3X3tTSR+wxEN5D+t7L4pZGaU/tkoD+OerLaJx4a73QE2QPEpNQSSJNjx6Q6RV
         HF7KctlI4GJiCKK+5Iaoa/A/o4wLBnbxXN7/WfCiUH/MrKT1EiQqWqKsev+xlgxmOfM8
         GeheWSHK9iLFVRYhrAY9zpPoyP7TWddf39OKY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=I1GPkbXfiJzkFczABXfJOnu25Hvte/GglYe/2Z9YFR/gAZ5mGVeoS20c48XlOaOM38
         G4FXGF+m6ys3Tkp3arewA9TN47+MKbT9pz72TbW2ukOt6eCbjKMpIWunI/eqKka6KT7h
         Ks+RL7+QbHfullNQuKPAxyXNxGRzNb24PXiXk=
MIME-Version: 1.0
Received: by 10.223.124.201 with HTTP; Tue, 20 Apr 2010 00:39:24 -0700 (PDT)
Date: Tue, 20 Apr 2010 09:39:24 +0200
Received: by 10.223.17.216 with SMTP id t24mr783117faa.90.1271749164894; Tue, 
	20 Apr 2010 00:39:24 -0700 (PDT)
Message-ID: <t2x21a749a41004200039v64251e7fs9ccce08225160554@mail.gmail.com>
Subject: Reaching the posting lists
From: =?ISO-8859-9?B?WWHw/XogS2FyZ/1u?= <xerxes862@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi all,

I have a question about usage of lucene, I want to figure out how I
can get one or all posting lists, after adding a document to the
index, but without materializing it in files. So after I add a
document (let's say "to be or not to be"), I am asking if I can get
something like this:

to -> (docID, tf(to));
be -> (docID, tf(be));
...
...

Or this code can help better understanding:

indexWriter.addDocument(doc);
someObject.someMethod(); -> and this will return all posting lists
created for "doc" in some data structure that i can use.

As far as I know "addDocument(doc)" writes the results gotten from the
"doc" in files, but it will be better if I can get the posting lists
before they are wrote in files. Maybe something like this:

someObject.giveMeAllPostingListsOfThisDocument(doc); -> and this will
return all posting lists created for "doc" in some data structure that
i can use.

how can I write methods like those above (if we don't have same kind
of things), or where can I get the desired data from?

I will be glad if you can help me.

Best,
Yagiz Kargin

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45865-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 09:45:25 2010
Return-Path: <java-user-return-45865-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39719 invoked from network); 20 Apr 2010 09:45:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 09:45:24 -0000
Received: (qmail 66555 invoked by uid 500); 20 Apr 2010 09:45:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66241 invoked by uid 500); 20 Apr 2010 09:45:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66232 invoked by uid 99); 20 Apr 2010 09:45:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 09:45:18 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 09:45:14 +0000
Received: by bwz22 with SMTP id 22so5583655bwz.5
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 02:44:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=C23rX9fwKz6SvCNYuahbF9usv9oJh2ZM5sy07sQdMlo=;
        b=RogRVY7VB2IEF654uLxtovIkhZjZEpjpnuJjW+cW1mmhJO5MQ3s/cXTzeywX1sPYJE
         +AbCMMqA8AFupD3tbJMhzMTgW+UkRFLvDJ73uFpITu4PX79r9ZjfgiMQrCmd5zBxmRPV
         RHJgA6tn0bxSLktNgpOctDfFLwahWCeAX5O9g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=dcDlyMzTtPoKOrTtl/oRRgbJlNBTi29WYvcUcLOfDbz+c6l/NhHKI1v77bnU2LKU+e
         aYi5l+XOdrca9qGI4FxkoKJ+NB4zvZFXXqFLT9hp+0thq49svTohWNcPwRwQrSrseZK7
         FMQGI0nUxWUkJnqIAj5ztlpFbTXc/pMSOOM/w=
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Tue, 20 Apr 2010 02:44:32 -0700 (PDT)
In-Reply-To: <001801cae048$97825a50$6400a8c0@dev>
References: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl> <h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com> 
	<SNT135-w14B814472665EEC6226E66D90E0@phx.gbl> <005d01cadd2c$6b81f920$6400a8c0@dev> 
	<w2t9ac0c6aa1004191817zf690b77em68e70ad5de78630b@mail.gmail.com> 
	<001801cae048$97825a50$6400a8c0@dev>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 20 Apr 2010 10:44:32 +0100
Received: by 10.204.81.145 with SMTP id x17mr869742bkk.31.1271756692322; Tue, 
	20 Apr 2010 02:44:52 -0700 (PDT)
Message-ID: <n2j8c4e68611004200244pfd3bfb15g1916b82008b5aa71@mail.gmail.com>
Subject: Re: Doc Caching
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Generally best to let the OS do it.  Having plenty of spare RAM is good.


--
Ian.


On Tue, Apr 20, 2010 at 6:16 AM, Chris B <chris_b@inbox.com> wrote:
> Mike cheers for the reply.
>
> Is it worth setting up your own caching or letting the OS do it? I've set=
up
> a caching system, but if the OS is doing it it seems pointless.
>
> Chris
>
> ----- Original Message ----- From: "Michael McCandless"
> <lucene@mikemccandless.com>
> To: <java-user@lucene.apache.org>
> Sent: Tuesday, April 20, 2010 2:17 AM
> Subject: Re: Doc Caching
>
>
> No, Lucene doesn't. =A0But the OS usually does (in is IO cache),
> assuming there is spare RAM.
>
> The "only" things that are explicitly held in memory by Lucene are the
> norms ("boost bytes"), terms dict index, deletions bit vector and
> field cache (used eg when you sort by a field), I think.
>
> Mike
>
> On Fri, Apr 16, 2010 at 2:16 AM, Chris B <chris_b@inbox.com> wrote:
>>
>> Hi
>>
>> Does Lucene cache the documents it retrieves? If so in which object?
>>
>> Chris
>>
>> ____________________________________________________________
>> GET FREE 5GB EMAIL - Check out spam free email with many cool features!
>> Visit http://www.inbox.com/email to find out more!
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45866-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 11:37:02 2010
Return-Path: <java-user-return-45866-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67107 invoked from network); 20 Apr 2010 11:37:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 11:37:02 -0000
Received: (qmail 59477 invoked by uid 500); 20 Apr 2010 11:37:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59410 invoked by uid 500); 20 Apr 2010 11:36:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59402 invoked by uid 99); 20 Apr 2010 11:36:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 11:36:59 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 11:36:51 +0000
Received: by ywh38 with SMTP id 38so3109521ywh.29
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 04:36:30 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.190.12 with HTTP; Tue, 20 Apr 2010 04:36:29 -0700 (PDT)
In-Reply-To: <t2x21a749a41004200039v64251e7fs9ccce08225160554@mail.gmail.com>
References: <t2x21a749a41004200039v64251e7fs9ccce08225160554@mail.gmail.com>
Date: Tue, 20 Apr 2010 07:36:29 -0400
Received: by 10.150.14.2 with SMTP id 2mr7301076ybn.12.1271763389815; Tue, 20 
	Apr 2010 04:36:29 -0700 (PDT)
Message-ID: <z2k9ac0c6aa1004200436u684ca07cy3f5b398be7e62545@mail.gmail.com>
Subject: Re: Reaching the posting lists
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

You have to open an IndexReader in order to walk the postings of newly
indexed docs.

EG after indexing the doc, ask for a new near-real-time reader
(IndexWriter.getReader()), then use the postings API
(TermDocs/TermPositions in 3.0.x, but in trunk, with the flex API,
DocsEnum/DocsAndPositionsEnum) via IndexReader.

Mike

On Tue, Apr 20, 2010 at 3:39 AM, Ya=C4=9F=C4=B1z Karg=C4=B1n <xerxes862@gma=
il.com> wrote:
> Hi all,
>
> I have a question about usage of lucene, I want to figure out how I
> can get one or all posting lists, after adding a document to the
> index, but without materializing it in files. So after I add a
> document (let's say "to be or not to be"), I am asking if I can get
> something like this:
>
> to -> (docID, tf(to));
> be -> (docID, tf(be));
> ...
> ...
>
> Or this code can help better understanding:
>
> indexWriter.addDocument(doc);
> someObject.someMethod(); -> and this will return all posting lists
> created for "doc" in some data structure that i can use.
>
> As far as I know "addDocument(doc)" writes the results gotten from the
> "doc" in files, but it will be better if I can get the posting lists
> before they are wrote in files. Maybe something like this:
>
> someObject.giveMeAllPostingListsOfThisDocument(doc); -> and this will
> return all posting lists created for "doc" in some data structure that
> i can use.
>
> how can I write methods like those above (if we don't have same kind
> of things), or where can I get the desired data from?
>
> I will be glad if you can help me.
>
> Best,
> Yagiz Kargin
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45867-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 13:19:20 2010
Return-Path: <java-user-return-45867-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98541 invoked from network); 20 Apr 2010 13:19:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 13:19:20 -0000
Received: (qmail 74238 invoked by uid 500); 20 Apr 2010 13:19:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74182 invoked by uid 500); 20 Apr 2010 13:19:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74174 invoked by uid 99); 20 Apr 2010 13:19:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 13:19:17 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gsiasf@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 13:19:09 +0000
Received: by vws13 with SMTP id 13so762088vws.35
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 06:18:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:content-type
         :mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        bh=3nWaJPRVR874ChquVnLuXKxdcvQ+mGp4wAUBFja5/X4=;
        b=Uy13bvp//hNnEC7mzjVCzoFzs5NOlwMLcW6U0OOPN4BMKMVWGIoRbueonQne/lhaJP
         3Ov9mLg1GYrdWtuU32Br2JPLVlz1FV07RfpumSUD967LODy4h5CzMnAQx/H22CgrFzyM
         hItE26/O3FdXCoatTLOoVSrmdOsPEbmwhViiQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=Lug03WQd6+F5cdVJBX1C0pkKZWg62yDNMDCRq/AhM+t98CGeToBezzivZiR6cT57lV
         EhINeiY0rHuEQC3MRV5mSyP3B90EhfdeJGZwWS2xpWdn+duA8JkL5Kxp/koz8tcs7rir
         X7WxZVUFKQTyGLou1q2jyUmoYG5oDMIPVW2qc=
Received: by 10.220.121.216 with SMTP id i24mr4568550vcr.235.1271769528535;
        Tue, 20 Apr 2010 06:18:48 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id b15sm23704307vcx.14.2010.04.20.06.18.47
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 20 Apr 2010 06:18:47 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1078)
Subject: Re: Big problem with solr in an official server.
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <z2lbf1404351004190854u2cdebaddp8bf1b548ffcef733@mail.gmail.com>
Date: Tue, 20 Apr 2010 09:18:46 -0400
Content-Transfer-Encoding: quoted-printable
Message-Id: <7933DD72-5F75-41BE-9C33-645EE0BC49C6@apache.org>
References: <z2lbf1404351004190854u2cdebaddp8bf1b548ffcef733@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Ariel,

Please ask on solr-user@lucene.apache.org.  Also, please provide more =
info about your index, etc. when sending that mail.

-Grant

On Apr 19, 2010, at 11:54 AM, Ariel wrote:

> Hi everybody:
>=20
> I have a big problem with solr in a server with the memory size it is =
using,
> I would want to know how to configure it to use a limited memory size, =
I am
> setting up Solr with "java -jar start.jar" command in an ubuntu =
server, the
> process start.jar is using 7Gb of  memory in the server and it is =
affecting
> considerably the performance of the server.
> Could you help me please ???
> Thanks in advance.
> Regards
> Ariel

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem using Solr/Lucene: =
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45868-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 14:23:05 2010
Return-Path: <java-user-return-45868-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23937 invoked from network); 20 Apr 2010 14:23:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 14:23:05 -0000
Received: (qmail 77371 invoked by uid 500); 20 Apr 2010 14:23:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77319 invoked by uid 500); 20 Apr 2010 14:23:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77311 invoked by uid 99); 20 Apr 2010 14:23:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 14:23:02 +0000
X-ASF-Spam-Status: No, hits=0.5 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 14:22:57 +0000
Received: by vws13 with SMTP id 13so817982vws.35
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 07:22:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=HV3JtW51Y/4hF0hl0n4Zwv/73kY7t6yiojVsR7QzdN0=;
        b=TdpCMlnSms/2/QSjTXDq2Yu4H6MI9BaDhxK1p5c3cEPQ5PNDpf1YoAHnluxbWz89P+
         9S/TR+c6F32IyDyKsPwqtgrvQixeNRgZbd6PW6+vBoh+HG8XZ7Wp7FvpKonWqOqHmXZQ
         tIMIyt/pSthjyWpshM2IZmEoVe4Acf+dijWLM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=E4ntilI/z1eZS/rKgqk0rkKU9l5OhVdnfMtUoWX2cj0ym/J//hxI65/4o0AIV/E2ua
         Jhu1gbEGbcJmZ+GNMVkRPBpQXFQbi9GLpaasPXWcI4mvtPfrJw+0vsrD0hbYeHb8fYqd
         jedItCCk6L76L1qrgmJcMB0ZAn9ZxMmH/brxw=
MIME-Version: 1.0
Received: by 10.150.199.5 with HTTP; Tue, 20 Apr 2010 07:22:36 -0700 (PDT)
In-Reply-To: <001801cae048$97825a50$6400a8c0@dev>
References: <SNT135-w14D648CEA0A365B7A0C8A8D90F0@phx.gbl>
	 <h2n359a92831004151632ve8d1e6f2zca207854b424b286@mail.gmail.com>
	 <SNT135-w14B814472665EEC6226E66D90E0@phx.gbl>
	 <005d01cadd2c$6b81f920$6400a8c0@dev>
	 <w2t9ac0c6aa1004191817zf690b77em68e70ad5de78630b@mail.gmail.com>
	 <001801cae048$97825a50$6400a8c0@dev>
Date: Tue, 20 Apr 2010 10:22:36 -0400
Received: by 10.220.128.30 with SMTP id i30mr4708711vcs.148.1271773356847; 
	Tue, 20 Apr 2010 07:22:36 -0700 (PDT)
Message-ID: <r2x359a92831004200722qd56708d4m8f49d19f8beb5682@mail.gmail.com>
Subject: Re: Doc Caching
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636e1ece32b72cb0484abcf10

--001636e1ece32b72cb0484abcf10
Content-Type: text/plain; charset=ISO-8859-1

<<<Is it worth setting up your own caching...>>>

You've hit one of my personal hot buttons <G>.  Never, never, never
until
1> you're reasonably sure you actually *have* a performance issue.
2> your performance issues can't be fixed more cheaply. Memory is
  waaaaaaaay cheap compared to all the time you'll spend programming
  your caching solution then fixing the bugs in it.

Best
Erick

On Tue, Apr 20, 2010 at 1:16 AM, Chris B <chris_b@inbox.com> wrote:

> Mike cheers for the reply.
>
> Is it worth setting up your own caching or letting the OS do it? I've setup
> a caching system, but if the OS is doing it it seems pointless.
>
> Chris
>
> ----- Original Message ----- From: "Michael McCandless" <
> lucene@mikemccandless.com>
> To: <java-user@lucene.apache.org>
> Sent: Tuesday, April 20, 2010 2:17 AM
> Subject: Re: Doc Caching
>
>
>
> No, Lucene doesn't.  But the OS usually does (in is IO cache),
> assuming there is spare RAM.
>
> The "only" things that are explicitly held in memory by Lucene are the
> norms ("boost bytes"), terms dict index, deletions bit vector and
> field cache (used eg when you sort by a field), I think.
>
> Mike
>
> On Fri, Apr 16, 2010 at 2:16 AM, Chris B <chris_b@inbox.com> wrote:
>
>> Hi
>>
>> Does Lucene cache the documents it retrieves? If so in which object?
>>
>> Chris
>>
>> ____________________________________________________________
>> GET FREE 5GB EMAIL - Check out spam free email with many cool features!
>> Visit http://www.inbox.com/email to find out more!
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636e1ece32b72cb0484abcf10--

From java-user-return-45869-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 16:00:24 2010
Return-Path: <java-user-return-45869-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78437 invoked from network); 20 Apr 2010 16:00:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 16:00:24 -0000
Received: (qmail 52579 invoked by uid 500); 20 Apr 2010 16:00:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52190 invoked by uid 500); 20 Apr 2010 16:00:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52182 invoked by uid 99); 20 Apr 2010 16:00:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 16:00:21 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.159 as permitted sender)
Received: from [72.14.220.159] (HELO fg-out-1718.google.com) (72.14.220.159)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 16:00:13 +0000
Received: by fg-out-1718.google.com with SMTP id e21so1517712fga.5
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 08:59:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=haajv8xGZMMRd7NDA9UPPDySVh8LISKyqdf4SmNY0Ic=;
        b=UHFHa5DmWYD1FzYvNVjlDKEpIaR7AkuOenAAXliMFy//vVCnZLAXNRZtEXkYvhgoCn
         xYH3F6ZZJEUTajFFYSi78GbiHALBRw28KBDpcZC5PRH+goatbaZesBe0izQaSdmKWL+U
         nb30mgdnd51D3IVR7RNnZW41wuxMzM6IU50kM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=qDSuG+aNT1fZClAN5u4P3X1yoaNUNzG6MQXl4sVRhtf+JNk1r+mZQ8fA1O6dz0BzoP
         KvW0A4o5VooDdfIqeG2BmaEqTHyMRU7CFxwFqkyadd6uPTFj3XucrUgJfM8Lohfmv77c
         YMmTQxAGjptDthjI4IcZ8WpIUJ749EWvvbLVw=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Tue, 20 Apr 2010 08:58:34 -0700 (PDT)
Date: Tue, 20 Apr 2010 17:58:34 +0200
Received: by 10.223.63.16 with SMTP id z16mr1262989fah.44.1271779114349; Tue, 
	20 Apr 2010 08:58:34 -0700 (PDT)
Message-ID: <m2hf071061b1004200858s14b9fccct6ff3252616aac9aa@mail.gmail.com>
Subject: analyzer not working properly when indexing
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

I am encountering a strange issue. I have a CustomStopAnalyzer. If I
do this (supporting code taken from AnalyzerUtils in LIA3 source code
Mike uploaded):
        Analyzer customStopAnalyzer = new CustomStopAnalyzer();
        AnalyzerUtils.displayTokensWithFullDetails(customStopAnalyzer,
"mail77");

I get what I expect:		
1: [mail77:0->6:word]

But when I am actually indexing docs, the word containing numbers
loose the numbers.
	directory = new RAMDirectory();
        writer = new IndexWriter(directory, customStopAnalyzer,
IndexWriter.MaxFieldLength.UNLIMITED);
        doc = new Document();
        doc.add((Fieldable) new Field("contents", "mail77",
Field.Store.NO, Field.Index.ANALYZED));
        writer.addDocument(doc);
        writer.close();
        hitCount = getHitCount(directory, "contents", "mail77");
        System.out.println("mail77 " + hitCount);

This writes
mail77 0
If I look for "mail", I get one hit...I am using Lucene 3.0.1. Where
should I start looking (I assume in CustomStopAnalyzer but the fact
that displayTokensWithFullDetails() shows the right output puzzles
me)??

thanks
javier

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45870-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 17:10:47 2010
Return-Path: <java-user-return-45870-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11871 invoked from network); 20 Apr 2010 17:10:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 17:10:47 -0000
Received: (qmail 62896 invoked by uid 500); 20 Apr 2010 17:10:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62522 invoked by uid 500); 20 Apr 2010 17:10:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62416 invoked by uid 99); 20 Apr 2010 17:10:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 17:10:43 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 17:10:36 +0000
Received: by bwz3 with SMTP id 3so5759775bwz.11
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 10:10:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=Zn/kCjZJcJgzbp/MzqsF3RrldYK5GZBu8xQz4AMAjDM=;
        b=dIew/qXmjLoC0VRNkUsZyw76hjHXpYZH0Ellv76cwdfn2+U49b9m1MY8WZFlN+B8SZ
         GntIqjumoigYfqXPPzpzLAZMBZzAx/W1lhg6IGTbYlh+IPWtOfe0zQoqRCXNM4Li1rc8
         XMQ3nQTZfKqauiPJozT+gedjyIVp5KrrqtQTw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=sYGaBaabKykRvLu4ua1lLxFRFoM/WcNMlcUZTTgZc7xiUAhQUkEYCj3R6A5nAPVvqR
         Efs9ojAJpUOApEwqFL6d/y7HsI89aDlyMt+m3aLRTS54czQ8Ku5ur9d/KzErPEoaqX+j
         08Fr5o9KLMcpH4uWgdR9UlE+2oWE0fGkk50mI=
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Tue, 20 Apr 2010 10:09:55 -0700 (PDT)
In-Reply-To: <m2hf071061b1004200858s14b9fccct6ff3252616aac9aa@mail.gmail.com>
References: <m2hf071061b1004200858s14b9fccct6ff3252616aac9aa@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 20 Apr 2010 18:09:55 +0100
Received: by 10.204.126.130 with SMTP id c2mr6009611bks.155.1271783415662; 
	Tue, 20 Apr 2010 10:10:15 -0700 (PDT)
Message-ID: <g2s8c4e68611004201009m60731659tbfff1c948eff38f2@mail.gmail.com>
Subject: Re: analyzer not working properly when indexing
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Are you using the same analyzer for searching, in your unshown
getHitCount() method?

There is lots of good advice in the FAQ under "Why am I getting no
hits / incorrect hits?".  And/or write the index to disk and use Luke
to check that the correct content is being indexed.


--
Ian.


On Tue, Apr 20, 2010 at 4:58 PM, jm <jmuguruza@gmail.com> wrote:
> I am encountering a strange issue. I have a CustomStopAnalyzer. If I
> do this (supporting code taken from AnalyzerUtils in LIA3 source code
> Mike uploaded):
> =A0 =A0 =A0 =A0Analyzer customStopAnalyzer =3D new CustomStopAnalyzer();
> =A0 =A0 =A0 =A0AnalyzerUtils.displayTokensWithFullDetails(customStopAnaly=
zer,
> "mail77");
>
> I get what I expect:
> 1: [mail77:0->6:word]
>
> But when I am actually indexing docs, the word containing numbers
> loose the numbers.
> =A0 =A0 =A0 =A0directory =3D new RAMDirectory();
> =A0 =A0 =A0 =A0writer =3D new IndexWriter(directory, customStopAnalyzer,
> IndexWriter.MaxFieldLength.UNLIMITED);
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add((Fieldable) new Field("contents", "mail77",
> Field.Store.NO, Field.Index.ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
> =A0 =A0 =A0 =A0writer.close();
> =A0 =A0 =A0 =A0hitCount =3D getHitCount(directory, "contents", "mail77");
> =A0 =A0 =A0 =A0System.out.println("mail77 " + hitCount);
>
> This writes
> mail77 0
> If I look for "mail", I get one hit...I am using Lucene 3.0.1. Where
> should I start looking (I assume in CustomStopAnalyzer but the fact
> that displayTokensWithFullDetails() shows the right output puzzles
> me)??
>
> thanks
> javier
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45871-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 19:09:16 2010
Return-Path: <java-user-return-45871-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79465 invoked from network); 20 Apr 2010 19:09:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 19:09:16 -0000
Received: (qmail 80040 invoked by uid 500); 20 Apr 2010 19:09:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79986 invoked by uid 500); 20 Apr 2010 19:09:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79970 invoked by uid 99); 20 Apr 2010 19:09:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 19:09:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [149.8.64.10] (HELO mclmx.mail.saic.com) (149.8.64.10)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 19:09:04 +0000
Received: from 0015-its-sbg01.saic.com ([149.8.64.21] [149.8.64.21]) by mclmx.mail.saic.com with ESMTP id BT-MMP-12147046 for java-user@lucene.apache.org; Tue, 20 Apr 2010 15:08:38 -0400
X-AuditID: 9508401a-b7cf0ae000000cda-e6-4bcdfbb6b6c7
Received: from 0015-its-exbh03.us.saic.com (mcl-sixl-nat.saic.com [149.8.64.21])
	by 0015-its-sbg01.saic.com (Symantec Brightmail Gateway) with SMTP id 5D.DA.03290.6BBFDCB4; Tue, 20 Apr 2010 15:08:38 -0400 (EDT)
Received: from 0015-its-exmb01.us.saic.com ([10.43.229.16]) by 0015-its-exbh03.us.saic.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 20 Apr 2010 15:08:37 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01CAE0BC.E1CB3D2E"
Subject: Set Analyzer without QueryParser
Date: Tue, 20 Apr 2010 15:08:35 -0400
Message-Id: <002052E02A48964A8035D9B6E8A1647D0111866D@0015-its-exmb01.us.saic.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Set Analyzer without QueryParser
Thread-Index: AcrgvNxh1EviuvfORY2fL3ndTk1zBA==
From: "Murdoch, Paul" <PAUL.B.MURDOCH@saic.com>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 20 Apr 2010 19:08:37.0973 (UTC) FILETIME=[E1C4E050:01CAE0BC]
X-Brightmail-Tracker: AAAAAA==
X-Virus-Checked: Checked by ClamAV on apache.org

------_=_NextPart_001_01CAE0BC.E1CB3D2E
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hi,

=20

I'm building a BooleanQuery that may contain a  NumericRangeQuery.  The
NRQ may be one of several sub-queries in the parent BooleanQuery.  I
wasn't able to make the NRQ function properly by extending the
QueryParser and overriding the getRangeQuery method.  So I'm building
the entire BooleanQuery in code.  I'm passing the BooleanQuery to an
IndexSearcher to get hits, but I'm not getting the expected results.  I
believe this is due to not setting the Analyzer.  I'm used to using the
QueryParser constructor to set the Analyzer to be the same as the
IndexWriter's that built the index.  So how do I set the Analyzer for an
IndexSearcher without instantiating a QueryParser?  I'm using 2.9.2.

=20

Thanks,

=20

Paul=20

=20


------_=_NextPart_001_01CAE0BC.E1CB3D2E--

From java-user-return-45872-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 20:43:49 2010
Return-Path: <java-user-return-45872-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34277 invoked from network); 20 Apr 2010 20:43:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 20:43:48 -0000
Received: (qmail 99470 invoked by uid 500); 20 Apr 2010 20:43:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99386 invoked by uid 500); 20 Apr 2010 20:43:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99378 invoked by uid 99); 20 Apr 2010 20:43:46 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 20:43:46 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of fred.rahmanian@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 20:43:38 +0000
Received: by wwb29 with SMTP id 29so3838479wwb.35
        for <java-user@lucene.apache.org>; Tue, 20 Apr 2010 13:43:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received:date
         :x-google-sender-auth:received:message-id:subject:from:to
         :content-type;
        bh=4UFVIF3pdZ1krse+AAlQUMuIBRuAPE2p3LEz9raAc7M=;
        b=bAFoYqS/LJOfrT9CwqXIC45be07XxOHLlp0zbo59qH3myKBzM69htflQKV+yX4p+zU
         Lrqko8xCbq8cicE9fgRPm5tEXjT0zzozlKGLD0Xpf/F9GO9TgUcE8gqQwBMVwKsLdxg9
         r0NyCFicIHv72UqtK2GtC76UswNGdmZlzKI1c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:date:x-google-sender-auth:message-id
         :subject:from:to:content-type;
        b=sJrD+2cLESifm2mJcrfNr0b+5ZcmAWaSAdR8l/NhBtTZ/V15mfltrKbEzwG6MAh5NU
         Kt7tuH9bI7fhUY6ayp7s1sR/u57unK1jq2tzgB8f0QriZ7RpiB0yXIJ9qQKV1Z2a9uyb
         UWbnw0mWkii86Bd8vE9x75l5K+1U8a2Vh8iKI=
MIME-Version: 1.0
Sender: fred.rahmanian@gmail.com
Reply-To: fredr@acm.org
Received: by 10.216.157.143 with HTTP; Tue, 20 Apr 2010 13:43:17 -0700 (PDT)
Date: Tue, 20 Apr 2010 16:43:17 -0400
X-Google-Sender-Auth: 9afb125677cfd71e
Received: by 10.216.169.200 with SMTP id n50mr699490wel.217.1271796197626; 
	Tue, 20 Apr 2010 13:43:17 -0700 (PDT)
Message-ID: <i2r7c88cbc31004201343n4c4357f5ke9239b6fa725ed9b@mail.gmail.com>
Subject: Indexing and search questions
From: Fred Rahmanian <fredr@acm.org>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364c74f1961a890484b120b2
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364c74f1961a890484b120b2
Content-Type: text/plain; charset=ISO-8859-1

I'd like to use lucene to search text documents for the existence of a large
list of search terms. I have a file that contains thousands of entries, one
word per line. I was thinking about to writing a specialized analyzer
that tokenizes the document by  looking up each token in the source document
in my list of words and return terms for words that exist in my file. I'm
hoping that using this approach the index file will contain only items that
exist in my document. So once the index is created I should be able to ask
the index for all of its terms and whatever is returned is the list of items
I'm interested in.

I'm new to Lucene so I'm not sure if I'm going about this the right way.
lastly, I want to be able run this process for thousands of documents and
store the matches ( and their offset ) in a db. So it should be fairly
efficient.

I appreciate any comments.

TIA,

FR

--0016364c74f1961a890484b120b2--

From java-user-return-45873-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 20 21:27:55 2010
Return-Path: <java-user-return-45873-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57103 invoked from network); 20 Apr 2010 21:27:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Apr 2010 21:27:54 -0000
Received: (qmail 45522 invoked by uid 500); 20 Apr 2010 21:27:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45467 invoked by uid 500); 20 Apr 2010 21:27:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45459 invoked by uid 99); 20 Apr 2010 21:27:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Apr 2010 21:27:52 +0000
X-ASF-Spam-Status: No, hits=-0.9 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [206.190.49.18] (HELO web52908.mail.re2.yahoo.com) (206.190.49.18)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 20 Apr 2010 21:27:44 +0000
Received: (qmail 1705 invoked by uid 60001); 20 Apr 2010 21:27:23 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271798843; bh=yELEHr1d3uJ9ZfULG1ha5HqaRkx9UvTVEgMlIeHp3JM=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=xU6aNTNbSsdLfh5LgpPYi/U9a7L7Ld7oWWH3QgF3B5djQQvrNv8+fcDkMRvc+jo8DY0BSWqEfb0AZdEU8rN3CgXt0lrw68jrwNQ4MW5EiaigEL5daXH9+zb7znekooeqp1Za1M96IJZ+FE+yj44tpXHD6KEsXF3+zINT1QqVZ2c=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=c7n7ANwotA9XgT7nKuY1Mzuqeqbo1xXYBwBLnAGZNHXEnhlLWFWe94xkjqK1kXoVFWaOIY/JRn7xHU/bpyV6gMEazkcSc/jR8Tz7GeNy/K2H4uvgJNtI2BcDEO4y5/ZforBaMDPFQCHtY9ACgaA3HEGGQ4cnWjNyBLqbgyZ2FWE=;
Message-ID: <312417.97225.qm@web52908.mail.re2.yahoo.com>
X-YMail-OSG: xYTvuSUVM1nDr_xc6RxhedrtKkps3ejeAB2zJu9RFqc.UX2
 84j0PsGfaV7ibPXTl4vIiSdeNpRY_1BiltWhVyWImOCEYd5ykPfuqAPnzDoJ
 eQRlkVOyEzFuiPESYfUvPLywGIKcpG0cPkAc.sjPkY2WFxV7rKjEIjDC6ZB_
 5Q18c8rk6mYvuoBi.rkixnpRW0zzqH0SkEOkvFKgS_MTwunQDBAXv_mhlBnA
 D0x6EA0uEo6505pSjmMfJU3OxYVL3fa9b5RKQf43xfuOT8VHjHVZ9qfEyRye
 nHfZnSBB6P_rZ.VUoBinouoqtLGS2ewcnbP00J6OgI31vPclhzmabolQ4nGw
 3MkCS8R1qNQb7toVHtVhYo66I83no
Received: from [95.15.156.67] by web52908.mail.re2.yahoo.com via HTTP; Tue, 20 Apr 2010 14:27:23 PDT
X-Mailer: YahooMailClassic/10.1.9 YahooMailWebService/0.8.102.267879
Date: Tue, 20 Apr 2010 14:27:23 -0700 (PDT)
From: Ahmet Arslan <iorixxx@yahoo.com>
Subject: Re: Indexing and search questions
To: java-user@lucene.apache.org, fredr@acm.org
In-Reply-To: <i2r7c88cbc31004201343n4c4357f5ke9239b6fa725ed9b@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

=0A> I'd like to use lucene to search text=0A> documents for the existence =
of a large=0A> list of search terms. I have a file that contains thousands=
=0A> of entries, one=0A> word per line. I was thinking about to writing a=
=0A> specialized analyzer=0A> that tokenizes the document by=A0 looking up =
each token=0A> in the source document=0A> in my list of words and return te=
rms for words that exist=0A> in my file. I'm=0A> hoping that using this app=
roach the index file will contain=0A> only items that=0A> exist in my docum=
ent. =0A=0ASounds like KeepWordFilter[1][2] is what you are looking for. ke=
epwords.txt will be the file that contains thousands of entries, one word p=
er line. =0AAnd just as you guessed using this approach, the index will con=
tain=0Aonly items that exist in your document (keepwords.txt). =0A=0AI can =
share the code to use this TokenFilter in Lucene if you want. Or alternativ=
ely you can easily copy and paste KeepWordFilter.java=0A=0A[1]http://lucene=
.apache.org/solr/api/org/apache/solr/analysis/KeepWordFilter.html=0A=0A[2]h=
ttp://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters#solr.KeepWordFil=
terFactory=0A=0A=0A=0A=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45874-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 07:22:19 2010
Return-Path: <java-user-return-45874-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26770 invoked from network); 21 Apr 2010 07:22:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 07:22:19 -0000
Received: (qmail 22437 invoked by uid 500); 21 Apr 2010 07:22:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21999 invoked by uid 500); 21 Apr 2010 07:22:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21985 invoked by uid 99); 21 Apr 2010 07:22:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 07:22:13 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.154 as permitted sender)
Received: from [72.14.220.154] (HELO fg-out-1718.google.com) (72.14.220.154)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 07:22:05 +0000
Received: by fg-out-1718.google.com with SMTP id e21so1864268fga.5
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 00:21:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=PLlZqbra5Bj8pr3dZOiL2Sit7QkehWMgUjsqGIJ2GRk=;
        b=PIOR09+tl8h7JvqbbnE/ZN46jGetsZHKwlkgp+tFHl8FJ0c/i3VL1yvAQKkbxK6WJ7
         fW6bi1pCvPCjqnHPTWROfRA8iEy2PtF+RVzcIyOvIfnHt7PVaxY8rvhkH3Kdoo2wu/DX
         6iW8tH2O1rb8X/tB80ArZIpirzKvye5AUV8n4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=eYa9ne4ivXef0uMK2I9ZbRr3SKI9ScOR+xReze9fXRfmx7p5UP00jNp6JefsAC96UM
         3y1zsuWCzkkkboeeEleWBYK+z6I4S26Py7j+zSgc4lsMhFr/w3VsdVwzSXHw+icdEv3w
         Fq/10Ag1W+N31AUF+rPhwH4be9K9Tx8up06Fw=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Wed, 21 Apr 2010 00:20:30 -0700 (PDT)
In-Reply-To: <g2s8c4e68611004201009m60731659tbfff1c948eff38f2@mail.gmail.com>
References: <m2hf071061b1004200858s14b9fccct6ff3252616aac9aa@mail.gmail.com>
	 <g2s8c4e68611004201009m60731659tbfff1c948eff38f2@mail.gmail.com>
Date: Wed, 21 Apr 2010 09:20:30 +0200
Received: by 10.223.5.81 with SMTP id 17mr325724fau.42.1271834430831; Wed, 21 
	Apr 2010 00:20:30 -0700 (PDT)
Message-ID: <g2rf071061b1004210020y8a347c9fh4d74ca0b5a2e487@mail.gmail.com>
Subject: Re: analyzer not working properly when indexing
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

I am using a TermQuery so no analyzer used...
protected static int getHitCount(Directory directory, String
fieldName, String searchString) throws IOException {
        IndexSearcher searcher =3D new IndexSearcher(directory, true); //5
        Term t =3D new Term(fieldName, searchString);
        Query query =3D new TermQuery(t); //6
        int hitCount =3D searcher.search(query, 1).totalHits;
        searcher.close();
        return hitCount;
}

Yes, I have written the index to disk, and luke shows the words
without the numbers...


On Tue, Apr 20, 2010 at 7:09 PM, Ian Lea <ian.lea@gmail.com> wrote:
> Are you using the same analyzer for searching, in your unshown
> getHitCount() method?
>
> There is lots of good advice in the FAQ under "Why am I getting no
> hits / incorrect hits?". =A0And/or write the index to disk and use Luke
> to check that the correct content is being indexed.
>
>
> --
> Ian.
>
>
> On Tue, Apr 20, 2010 at 4:58 PM, jm <jmuguruza@gmail.com> wrote:
>> I am encountering a strange issue. I have a CustomStopAnalyzer. If I
>> do this (supporting code taken from AnalyzerUtils in LIA3 source code
>> Mike uploaded):
>> =A0 =A0 =A0 =A0Analyzer customStopAnalyzer =3D new CustomStopAnalyzer();
>> =A0 =A0 =A0 =A0AnalyzerUtils.displayTokensWithFullDetails(customStopAnal=
yzer,
>> "mail77");
>>
>> I get what I expect:
>> 1: [mail77:0->6:word]
>>
>> But when I am actually indexing docs, the word containing numbers
>> loose the numbers.
>> =A0 =A0 =A0 =A0directory =3D new RAMDirectory();
>> =A0 =A0 =A0 =A0writer =3D new IndexWriter(directory, customStopAnalyzer,
>> IndexWriter.MaxFieldLength.UNLIMITED);
>> =A0 =A0 =A0 =A0doc =3D new Document();
>> =A0 =A0 =A0 =A0doc.add((Fieldable) new Field("contents", "mail77",
>> Field.Store.NO, Field.Index.ANALYZED));
>> =A0 =A0 =A0 =A0writer.addDocument(doc);
>> =A0 =A0 =A0 =A0writer.close();
>> =A0 =A0 =A0 =A0hitCount =3D getHitCount(directory, "contents", "mail77")=
;
>> =A0 =A0 =A0 =A0System.out.println("mail77 " + hitCount);
>>
>> This writes
>> mail77 0
>> If I look for "mail", I get one hit...I am using Lucene 3.0.1. Where
>> should I start looking (I assume in CustomStopAnalyzer but the fact
>> that displayTokensWithFullDetails() shows the right output puzzles
>> me)??
>>
>> thanks
>> javier
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45875-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 09:46:26 2010
Return-Path: <java-user-return-45875-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61223 invoked from network); 21 Apr 2010 09:46:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 09:46:25 -0000
Received: (qmail 26522 invoked by uid 500); 21 Apr 2010 09:46:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26120 invoked by uid 500); 21 Apr 2010 09:46:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26106 invoked by uid 99); 21 Apr 2010 09:46:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 09:46:19 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 09:46:12 +0000
Received: by bwz3 with SMTP id 3so6466902bwz.11
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 02:45:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=jgqe7cWgvNvFWGkZRLThIZB+zcmfywjKnOBZVGc/7Bc=;
        b=jkByUr+sp/8aeSjY7TUsy+3hxe5nIsZsnFqbS9EvwvmIXtQ9fh8+ucjoj7FXcdfv+Z
         G+6jc4nFz8LWQnxQ+mmNPGwGrUMPIWlYhdLyIPlMSPyPrzyZiXATbSdo3mlRiFwwiunr
         aor3TNHtcq0/wzHMDbW7wDqUtZc8gi/lHd+sg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=LLquogZNzURXvF0fQL+o8he2/DikkID6Id/Uz7QVDyGxpTNyCehNaBg5IkyGABhXJS
         c89HEK/FFVAP4PVey2E5vQmFDnfTSG5VokV2+RQeBlhju+pz+60LssLYirvTL4Uyyd2h
         +e/8mHD1R5y/yJwiTp/pj4ISh6AVnqAdJw01w=
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Wed, 21 Apr 2010 02:45:30 -0700 (PDT)
In-Reply-To: <g2rf071061b1004210020y8a347c9fh4d74ca0b5a2e487@mail.gmail.com>
References: <m2hf071061b1004200858s14b9fccct6ff3252616aac9aa@mail.gmail.com> 
	<g2s8c4e68611004201009m60731659tbfff1c948eff38f2@mail.gmail.com> 
	<g2rf071061b1004210020y8a347c9fh4d74ca0b5a2e487@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Wed, 21 Apr 2010 10:45:30 +0100
Received: by 10.204.4.153 with SMTP id 25mr2258554bkr.77.1271843150144; Wed, 
	21 Apr 2010 02:45:50 -0700 (PDT)
Message-ID: <q2m8c4e68611004210245j1462efb2w1193d39e1ac10d76@mail.gmail.com>
Subject: Re: analyzer not working properly when indexing
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

OK, so it does indeed look like a problem with your analyzer, as you suspec=
ted.

You could confirm that by using e.g. WhitespaceAnalyzer instead.  Then
maybe post the code for your custom analyzer, or step through in a
debugger or however you prefer to debug code.


--
Ian.


On Wed, Apr 21, 2010 at 8:20 AM, jm <jmuguruza@gmail.com> wrote:
> I am using a TermQuery so no analyzer used...
> protected static int getHitCount(Directory directory, String
> fieldName, String searchString) throws IOException {
> =A0 =A0 =A0 =A0IndexSearcher searcher =3D new IndexSearcher(directory, tr=
ue); //5
> =A0 =A0 =A0 =A0Term t =3D new Term(fieldName, searchString);
> =A0 =A0 =A0 =A0Query query =3D new TermQuery(t); //6
> =A0 =A0 =A0 =A0int hitCount =3D searcher.search(query, 1).totalHits;
> =A0 =A0 =A0 =A0searcher.close();
> =A0 =A0 =A0 =A0return hitCount;
> }
>
> Yes, I have written the index to disk, and luke shows the words
> without the numbers...
>
>
> On Tue, Apr 20, 2010 at 7:09 PM, Ian Lea <ian.lea@gmail.com> wrote:
>> Are you using the same analyzer for searching, in your unshown
>> getHitCount() method?
>>
>> There is lots of good advice in the FAQ under "Why am I getting no
>> hits / incorrect hits?". =A0And/or write the index to disk and use Luke
>> to check that the correct content is being indexed.
>>
>>
>> --
>> Ian.
>>
>>
>> On Tue, Apr 20, 2010 at 4:58 PM, jm <jmuguruza@gmail.com> wrote:
>>> I am encountering a strange issue. I have a CustomStopAnalyzer. If I
>>> do this (supporting code taken from AnalyzerUtils in LIA3 source code
>>> Mike uploaded):
>>> =A0 =A0 =A0 =A0Analyzer customStopAnalyzer =3D new CustomStopAnalyzer()=
;
>>> =A0 =A0 =A0 =A0AnalyzerUtils.displayTokensWithFullDetails(customStopAna=
lyzer,
>>> "mail77");
>>>
>>> I get what I expect:
>>> 1: [mail77:0->6:word]
>>>
>>> But when I am actually indexing docs, the word containing numbers
>>> loose the numbers.
>>> =A0 =A0 =A0 =A0directory =3D new RAMDirectory();
>>> =A0 =A0 =A0 =A0writer =3D new IndexWriter(directory, customStopAnalyzer=
,
>>> IndexWriter.MaxFieldLength.UNLIMITED);
>>> =A0 =A0 =A0 =A0doc =3D new Document();
>>> =A0 =A0 =A0 =A0doc.add((Fieldable) new Field("contents", "mail77",
>>> Field.Store.NO, Field.Index.ANALYZED));
>>> =A0 =A0 =A0 =A0writer.addDocument(doc);
>>> =A0 =A0 =A0 =A0writer.close();
>>> =A0 =A0 =A0 =A0hitCount =3D getHitCount(directory, "contents", "mail77"=
);
>>> =A0 =A0 =A0 =A0System.out.println("mail77 " + hitCount);
>>>
>>> This writes
>>> mail77 0
>>> If I look for "mail", I get one hit...I am using Lucene 3.0.1. Where
>>> should I start looking (I assume in CustomStopAnalyzer but the fact
>>> that displayTokensWithFullDetails() shows the right output puzzles
>>> me)??
>>>
>>> thanks
>>> javier
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45876-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 09:54:03 2010
Return-Path: <java-user-return-45876-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62756 invoked from network); 21 Apr 2010 09:54:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 09:54:03 -0000
Received: (qmail 36554 invoked by uid 500); 21 Apr 2010 09:54:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36115 invoked by uid 500); 21 Apr 2010 09:53:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36100 invoked by uid 99); 21 Apr 2010 09:53:57 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 09:53:57 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 09:53:51 +0000
Received: by bwz3 with SMTP id 3so6475372bwz.11
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 02:53:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=eMuxBn6xsNvAIzES8cBuHG1iEAaE9wekYoi5FvrhOa8=;
        b=nCT8EU8fvf3a6ZKDr7GgZ9fBzWvbVwMluyREsyEWFFyVnBzEq7l7qcktZTh5RgWC6/
         qyKAyzxvjcUzhaK4Y24H9uFO5iQpQUrCpfSUTnCJW1GRSfbPWHFntmpZg2uURZ8ZF652
         JITX7GUW7RjBQtU5Owob5B+GqiqNoK2u/DP+I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=LpgyA0rbGvNddLiQsgYQsYcBU6E2C0OAm1X2ld5tqbPECpgLVw4Ru0s6Z5V4OZwIJ6
         aXCbPHq3aTJbVbKPEKH3jU23xUwccAlzCmgLLhjk1/G5eHJa7/IgUNHC+Y/+Gk6lfYw2
         4ezLOH6hn7jUL8dYOEksKh+cT1sbCFxnHbMLQ=
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Wed, 21 Apr 2010 02:53:09 -0700 (PDT)
In-Reply-To: <002052E02A48964A8035D9B6E8A1647D0111866D@0015-its-exmb01.us.saic.com>
References: <002052E02A48964A8035D9B6E8A1647D0111866D@0015-its-exmb01.us.saic.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Wed, 21 Apr 2010 10:53:09 +0100
Received: by 10.204.126.130 with SMTP id c2mr6674141bks.155.1271843609544; 
	Wed, 21 Apr 2010 02:53:29 -0700 (PDT)
Message-ID: <k2o8c4e68611004210253la08f6743r53091649b96a4daa@mail.gmail.com>
Subject: Re: Set Analyzer without QueryParser
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

If parts of your BooleanQuery need an analyzer, specify that when you
create that bit of the overall query.

BooleanQuery bq =3D new BooleanQuery();
NumericRangeQuery nrq =3D ...;
QueryParser qp =3D new QueryParser(..., analyzer);
Query q =3D qp.parse("whatever");
...
bq.add(nrq, ...);
bq.add(q, ...);
...


--
Ian.


On Tue, Apr 20, 2010 at 8:08 PM, Murdoch, Paul <PAUL.B.MURDOCH@saic.com> wr=
ote:
> Hi,
>
>
>
> I'm building a BooleanQuery that may contain a =A0NumericRangeQuery. =A0T=
he
> NRQ may be one of several sub-queries in the parent BooleanQuery. =A0I
> wasn't able to make the NRQ function properly by extending the
> QueryParser and overriding the getRangeQuery method. =A0So I'm building
> the entire BooleanQuery in code. =A0I'm passing the BooleanQuery to an
> IndexSearcher to get hits, but I'm not getting the expected results. =A0I
> believe this is due to not setting the Analyzer. =A0I'm used to using the
> QueryParser constructor to set the Analyzer to be the same as the
> IndexWriter's that built the index. =A0So how do I set the Analyzer for a=
n
> IndexSearcher without instantiating a QueryParser? =A0I'm using 2.9.2.
>
>
>
> Thanks,
>
>
>
> Paul

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45877-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 10:21:40 2010
Return-Path: <java-user-return-45877-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69338 invoked from network); 21 Apr 2010 10:21:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 10:21:39 -0000
Received: (qmail 68539 invoked by uid 500); 21 Apr 2010 10:21:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67930 invoked by uid 500); 21 Apr 2010 10:21:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 42308 invoked by uid 99); 20 Apr 2010 22:13:13 -0000
X-ASF-Spam-Status: No, hits=2.9 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 216.139.236.158 is neither permitted nor denied by domain of john4982@gmail.com)
Date: Tue, 20 Apr 2010 14:12:47 -0800 (PST)
From: John4982 <john4982@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1271801567396-738551.post@n3.nabble.com>
Subject: Short circuit in query ...
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Hi

does Lucene search uses short-circuit when i execute query like:

A:10 AND b:20 AND c:30

In general, does position of field names can impact search performance e.g.
if field A with value 10 is more frequent is this mean that this will be
slower than if value 10 is less frequent?

best
John
-- 
View this message in context: http://n3.nabble.com/Short-circuit-in-query-tp738551p738551.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45878-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 10:39:23 2010
Return-Path: <java-user-return-45878-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75688 invoked from network); 21 Apr 2010 10:39:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 10:39:22 -0000
Received: (qmail 8372 invoked by uid 500); 21 Apr 2010 10:39:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7918 invoked by uid 500); 21 Apr 2010 10:39:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7901 invoked by uid 99); 21 Apr 2010 10:39:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 10:39:14 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.211 as permitted sender)
Received: from [209.85.218.211] (HELO mail-bw0-f211.google.com) (209.85.218.211)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 10:39:08 +0000
Received: by bwz3 with SMTP id 3so6525321bwz.11
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 03:38:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=t0TBm85ABHxddH2ScMACbxavJs0f3Wxy8VA/5qgFV9k=;
        b=pNadJjTLjQXV/snf6cpOrrqDSSyTjwYx+BjOzmvUdF9YbWpJYHCVeY2lBolQHYol4R
         +tvuBODBhk5vpDFhsGplYPEkKCG7uCtuq0IbiU243AlPL9Qoklg/20kqQN9w3J8FUGDF
         d9ORrTQReL6QBk3ytyJxloTvWBUgZ5elbhOkY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=cwoHdbzCtIdVuTqYVlqF/RY4PcErWzhiL12+/JocHCzBd1jX+XJFEmxVyuCSu15+kp
         c/Ifibgf+8IbauMj0N0EtbrqRKU4QC0EusQsGo295DF1sGs7+nnJwBca9pxshEMDEsQi
         ANexyLdfrtJ5ACGi1YEhZQLRD/gQMyQMMn48A=
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Wed, 21 Apr 2010 03:38:24 -0700 (PDT)
In-Reply-To: <1271801567396-738551.post@n3.nabble.com>
References: <1271801567396-738551.post@n3.nabble.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Wed, 21 Apr 2010 11:38:24 +0100
Received: by 10.204.161.207 with SMTP id s15mr6841526bkx.188.1271846324434; 
	Wed, 21 Apr 2010 03:38:44 -0700 (PDT)
Message-ID: <l2z8c4e68611004210338y624354e3h43b9fb5cbdae05be@mail.gmail.com>
Subject: Re: Short circuit in query ...
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

The order does not matter but searches on terms with few matches are
likely to be quicker than searches on terms with many matches,


--
Ian.


On Tue, Apr 20, 2010 at 11:12 PM, John4982 <john4982@gmail.com> wrote:
>
> Hi
>
> does Lucene search uses short-circuit when i execute query like:
>
> A:10 AND b:20 AND c:30
>
> In general, does position of field names can impact search performance e.g.
> if field A with value 10 is more frequent is this mean that this will be
> slower than if value 10 is less frequent?
>
> best
> John
> --
> View this message in context: http://n3.nabble.com/Short-circuit-in-query-tp738551p738551.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45879-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 10:47:05 2010
Return-Path: <java-user-return-45879-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77971 invoked from network); 21 Apr 2010 10:47:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 10:47:05 -0000
Received: (qmail 18823 invoked by uid 500); 21 Apr 2010 10:47:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18547 invoked by uid 500); 21 Apr 2010 10:46:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18539 invoked by uid 99); 21 Apr 2010 10:46:58 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 10:46:58 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of xerxes862@gmail.com designates 74.125.78.27 as permitted sender)
Received: from [74.125.78.27] (HELO ey-out-2122.google.com) (74.125.78.27)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 10:46:52 +0000
Received: by ey-out-2122.google.com with SMTP id 22so447355eye.3
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 03:46:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=npJ/Rvc/6INw9hYvziEkfXCJ8uT+4zOOrLo3fSSTAWY=;
        b=KybirSd+1dTrPI9UeiZUBvQ4W+PBGbqd3ijs80HQyPls2Yt1YswPu3iv8Jw7GjdF45
         E/ONoDurYY2zbQrQOqYTwqF7GkNNizRRgWFpctSKE2VxLZ52TPCXxUurUEnaBF123LtM
         CVQ5zmGadoNY0CZGEE57pG3rmCQsTyVnCdIWA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=kCgdY4eKRz6hes1Tc97/N4t797sRxB2ekOPkG4r6gmMbvAZx14HrVHsJX5SxUdkSmU
         gmL6z3mnk4+PXdCouYJHiG32ChWIaLjbG8v4uRIaRi+g/URmjHAlQk/3SfaUYm0Fx39V
         YnyxLaGRF+6M1bqQdabiRhyFdqd/snKFHZtoM=
MIME-Version: 1.0
Received: by 10.102.83.20 with HTTP; Wed, 21 Apr 2010 03:46:31 -0700 (PDT)
In-Reply-To: <z2k9ac0c6aa1004200436u684ca07cy3f5b398be7e62545@mail.gmail.com>
References: <t2x21a749a41004200039v64251e7fs9ccce08225160554@mail.gmail.com>
	 <z2k9ac0c6aa1004200436u684ca07cy3f5b398be7e62545@mail.gmail.com>
Date: Wed, 21 Apr 2010 12:46:31 +0200
Received: by 10.103.7.31 with SMTP id k31mr1207465mui.132.1271846791335; Wed, 
	21 Apr 2010 03:46:31 -0700 (PDT)
Message-ID: <k2j21a749a41004210346u9564099bj1c2ba03318bf8cfa@mail.gmail.com>
Subject: Re: Reaching the posting lists
From: =?ISO-8859-9?B?WWHw/XogS2FyZ/1u?= <xerxes862@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-9
Content-Transfer-Encoding: quoted-printable

Thanks for the answer. However those classes and methods are abstract.
Should I write my own implementation? Since Lucene is able to do
indexing and searching, I think there should be already implementation
of these things.

Sorry, if Mike's answer also includes this obviously. But I couldn't
get it, I need some further explanation.

Thanks,
Yagiz

2010/4/20 Michael McCandless <lucene@mikemccandless.com>:
> You have to open an IndexReader in order to walk the postings of newly
> indexed docs.
>
> EG after indexing the doc, ask for a new near-real-time reader
> (IndexWriter.getReader()), then use the postings API
> (TermDocs/TermPositions in 3.0.x, but in trunk, with the flex API,
> DocsEnum/DocsAndPositionsEnum) via IndexReader.
>
> Mike
>
> On Tue, Apr 20, 2010 at 3:39 AM, Ya=F0=FDz Karg=FDn <xerxes862@gmail.com>=
 wrote:
>> Hi all,
>>
>> I have a question about usage of lucene, I want to figure out how I
>> can get one or all posting lists, after adding a document to the
>> index, but without materializing it in files. So after I add a
>> document (let's say "to be or not to be"), I am asking if I can get
>> something like this:
>>
>> to -> (docID, tf(to));
>> be -> (docID, tf(be));
>> ...
>> ...
>>
>> Or this code can help better understanding:
>>
>> indexWriter.addDocument(doc);
>> someObject.someMethod(); -> and this will return all posting lists
>> created for "doc" in some data structure that i can use.
>>
>> As far as I know "addDocument(doc)" writes the results gotten from the
>> "doc" in files, but it will be better if I can get the posting lists
>> before they are wrote in files. Maybe something like this:
>>
>> someObject.giveMeAllPostingListsOfThisDocument(doc); -> and this will
>> return all posting lists created for "doc" in some data structure that
>> i can use.
>>
>> how can I write methods like those above (if we don't have same kind
>> of things), or where can I get the desired data from?
>>
>> I will be glad if you can help me.
>>
>> Best,
>> Yagiz Kargin
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20
Ya=F0=FDz Karg=FDn (Yagiz Kargin)

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45880-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 11:02:29 2010
Return-Path: <java-user-return-45880-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81859 invoked from network); 21 Apr 2010 11:02:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 11:02:28 -0000
Received: (qmail 50756 invoked by uid 500); 21 Apr 2010 11:02:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48633 invoked by uid 500); 21 Apr 2010 11:02:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48625 invoked by uid 99); 21 Apr 2010 11:02:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 11:02:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.154 as permitted sender)
Received: from [72.14.220.154] (HELO fg-out-1718.google.com) (72.14.220.154)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 11:02:11 +0000
Received: by fg-out-1718.google.com with SMTP id e21so1953073fga.5
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 04:01:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=hbt7qqSUKrqWgjrYki6vZiTD6VpZUFX/AkBy2FoBabI=;
        b=krUs8sn4+XWIqwwe3nrUOaLmdOO3VXJ0dc7LNjhyjzDU7+BpxmrBVyHy4/A1g/nPLi
         +vBXFWXvRKYEqdXbug6nS6q7TWm3WSRAv7ZTELov+fwGFtlrwEGvz2wDgaYirUtflOqK
         jenlajED5/esYFip0sHOX6N5exjUUmMynclSY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=ejKruOza81nUcWdonWl5JMYixcsnobQt2dftbm2sqr84Vp/oXoEg37/yYNqzkwTXJc
         5LxfXzPH9GMBC62Td+lf5XWmfHJ4YzqaPPJIDrZzxl2WxIGjGe0sy+jGemQHgOeuI8D8
         cB6K6dRmrih3D3jyNfmtV4CirRK/yOYgDnFEY=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Wed, 21 Apr 2010 03:59:48 -0700 (PDT)
In-Reply-To: <q2m8c4e68611004210245j1462efb2w1193d39e1ac10d76@mail.gmail.com>
References: <m2hf071061b1004200858s14b9fccct6ff3252616aac9aa@mail.gmail.com>
	 <g2s8c4e68611004201009m60731659tbfff1c948eff38f2@mail.gmail.com>
	 <g2rf071061b1004210020y8a347c9fh4d74ca0b5a2e487@mail.gmail.com>
	 <q2m8c4e68611004210245j1462efb2w1193d39e1ac10d76@mail.gmail.com>
Date: Wed, 21 Apr 2010 12:59:48 +0200
Received: by 10.223.144.84 with SMTP id y20mr79380fau.78.1271847589031; Wed, 
	21 Apr 2010 03:59:49 -0700 (PDT)
Message-ID: <y2wf071061b1004210359nfbab0abgcb9fac4c0f0ea0a2@mail.gmail.com>
Subject: Re: analyzer not working properly when indexing
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

ok, got this. I upgraded my analyzer to new api but it was not correct...

thanks

On Wed, Apr 21, 2010 at 11:45 AM, Ian Lea <ian.lea@gmail.com> wrote:
> OK, so it does indeed look like a problem with your analyzer, as you susp=
ected.
>
> You could confirm that by using e.g. WhitespaceAnalyzer instead. =A0Then
> maybe post the code for your custom analyzer, or step through in a
> debugger or however you prefer to debug code.
>
>
> --
> Ian.
>
>
> On Wed, Apr 21, 2010 at 8:20 AM, jm <jmuguruza@gmail.com> wrote:
>> I am using a TermQuery so no analyzer used...
>> protected static int getHitCount(Directory directory, String
>> fieldName, String searchString) throws IOException {
>> =A0 =A0 =A0 =A0IndexSearcher searcher =3D new IndexSearcher(directory, t=
rue); //5
>> =A0 =A0 =A0 =A0Term t =3D new Term(fieldName, searchString);
>> =A0 =A0 =A0 =A0Query query =3D new TermQuery(t); //6
>> =A0 =A0 =A0 =A0int hitCount =3D searcher.search(query, 1).totalHits;
>> =A0 =A0 =A0 =A0searcher.close();
>> =A0 =A0 =A0 =A0return hitCount;
>> }
>>
>> Yes, I have written the index to disk, and luke shows the words
>> without the numbers...
>>
>>
>> On Tue, Apr 20, 2010 at 7:09 PM, Ian Lea <ian.lea@gmail.com> wrote:
>>> Are you using the same analyzer for searching, in your unshown
>>> getHitCount() method?
>>>
>>> There is lots of good advice in the FAQ under "Why am I getting no
>>> hits / incorrect hits?". =A0And/or write the index to disk and use Luke
>>> to check that the correct content is being indexed.
>>>
>>>
>>> --
>>> Ian.
>>>
>>>
>>> On Tue, Apr 20, 2010 at 4:58 PM, jm <jmuguruza@gmail.com> wrote:
>>>> I am encountering a strange issue. I have a CustomStopAnalyzer. If I
>>>> do this (supporting code taken from AnalyzerUtils in LIA3 source code
>>>> Mike uploaded):
>>>> =A0 =A0 =A0 =A0Analyzer customStopAnalyzer =3D new CustomStopAnalyzer(=
);
>>>> =A0 =A0 =A0 =A0AnalyzerUtils.displayTokensWithFullDetails(customStopAn=
alyzer,
>>>> "mail77");
>>>>
>>>> I get what I expect:
>>>> 1: [mail77:0->6:word]
>>>>
>>>> But when I am actually indexing docs, the word containing numbers
>>>> loose the numbers.
>>>> =A0 =A0 =A0 =A0directory =3D new RAMDirectory();
>>>> =A0 =A0 =A0 =A0writer =3D new IndexWriter(directory, customStopAnalyze=
r,
>>>> IndexWriter.MaxFieldLength.UNLIMITED);
>>>> =A0 =A0 =A0 =A0doc =3D new Document();
>>>> =A0 =A0 =A0 =A0doc.add((Fieldable) new Field("contents", "mail77",
>>>> Field.Store.NO, Field.Index.ANALYZED));
>>>> =A0 =A0 =A0 =A0writer.addDocument(doc);
>>>> =A0 =A0 =A0 =A0writer.close();
>>>> =A0 =A0 =A0 =A0hitCount =3D getHitCount(directory, "contents", "mail77=
");
>>>> =A0 =A0 =A0 =A0System.out.println("mail77 " + hitCount);
>>>>
>>>> This writes
>>>> mail77 0
>>>> If I look for "mail", I get one hit...I am using Lucene 3.0.1. Where
>>>> should I start looking (I assume in CustomStopAnalyzer but the fact
>>>> that displayTokensWithFullDetails() shows the right output puzzles
>>>> me)??
>>>>
>>>> thanks
>>>> javier
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45881-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 13:11:54 2010
Return-Path: <java-user-return-45881-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21951 invoked from network); 21 Apr 2010 13:11:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 13:11:54 -0000
Received: (qmail 55403 invoked by uid 500); 21 Apr 2010 13:11:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55344 invoked by uid 500); 21 Apr 2010 13:11:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55336 invoked by uid 99); 21 Apr 2010 13:11:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:11:51 +0000
X-ASF-Spam-Status: No, hits=-1.1 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [206.190.38.57] (HELO web50303.mail.re2.yahoo.com) (206.190.38.57)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 21 Apr 2010 13:11:46 +0000
Received: (qmail 44387 invoked by uid 60001); 21 Apr 2010 13:11:24 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271855484; bh=Q9+SpHw8U1LAFUOuckTM9TjX/hvWQUGeMoi1vMtm8PU=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=XQZafNiEmvRPT4X+PYWt7xuZIMzeuEYZYAes/zlzf5Dabk3QV6aPETOcHau1l7KBLumki169/5MQ/gFH16RDHUp0jN4D7SF0ZtCu6YqSJzeFhVPpWHhU1Es0U/xK2CMLziA7Dp4zoHcQ2rGEhoKGseiUz+9qCYHoL97ChnTm3Mw=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=CqYHwWtoeDYMt9VqErLKyzRljaqdJXumMANbXekI1t389SBm3AmiroQfiZYXo09Ohpn461Did/i4RATrswCGdTapKtViAc+CGD799GrbqytLmzDApANUfRsNCgQxwHJSip1oPrOcG6x+kSmFcSxHFAsA5Z23yHJZRcC8GguNj88=;
Message-ID: <802315.40180.qm@web50303.mail.re2.yahoo.com>
X-YMail-OSG: h7RzjEMVM1mVMY5msmahx_xHnc7OpJYxij.F_jAvAczXtSY
 qIbJKQK.A4I3Q9J9UHpF4ESVA7yosguzUY4CL2Vf.FjLATyGUIt8Drkm1rfz
 PaBSJJeCe3X3sDfsEEvW5HFehDMxpX8CrpApF9IwPoIMfQXzv1SvuJ1AGwyC
 fETberxllWNArefYJZEIGPTYPsPsWYvbZY5DtM_75VEQnRtfwLlJycNc6m8K
 deOAoOt5b2s1hK2q5mRS36RL5jQ_x0B1nKzk7jY.J4CiCCu1g2zQk22r2bpQ
 AvDT.xO0h71muBCilz.3a_h7VS2iDES1Zc.wHN5SmQGMfeEvELvR_bUi.fn.
 OHe9iRTQiRcgpXP1X1xuzPPh_jNsalQ--
Received: from [74.73.1.126] by web50303.mail.re2.yahoo.com via HTTP; Wed, 21 Apr 2010 06:11:24 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
References: <19f8d6393bfd35c39eb149629c577a87@codebowl.com>
Date: Wed, 21 Apr 2010 06:11:24 -0700 (PDT)
From: Otis Gospodnetic <otis_gospodnetic@yahoo.com>
Subject: Re: Range Query Assistance
To: java-user@lucene.apache.org
In-Reply-To: <19f8d6393bfd35c39eb149629c577a87@codebowl.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Joseph,

If you can, get the latest Lucene and use NumericField to index your dates with appropriate precision and then use NumericRangeQueries when searching.  This will be faster than searching for string dates in a given range.
 Otis
----
Sematext :: http://sematext.com/ :: Solr - Lucene - Nutch
Lucene ecosystem search :: http://search-lucene.com/



----- Original Message ----
> From: "info@josephcrawford.com" <info@josephcrawford.com>
> To: java-user@lucene.apache.org
> Sent: Fri, April 16, 2010 9:23:30 AM
> Subject: Range Query Assistance
> 
> Hello,

I would like to query based on a start and end date.  I was 
> thinking
something like this

start_date: [20000101 TO <todays 
> date>] end_date: [<todays date> TO
20900101]

Would this work 
> for me?  Our dates are stored in the index as strings so I
am not sure 
> the syntax above would be correct.

Any assistance would be 
> appreciated.

Thanks,
Joseph 
> Crawford

---------------------------------------------------------------------
To 
> unsubscribe, e-mail: 
> href="mailto:java-user-unsubscribe@lucene.apache.org">java-user-unsubscribe@lucene.apache.org
For 
> additional commands, e-mail: 
> ymailto="mailto:java-user-help@lucene.apache.org" 
> href="mailto:java-user-help@lucene.apache.org">java-user-help@lucene.apache.org

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45882-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 13:20:38 2010
Return-Path: <java-user-return-45882-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25167 invoked from network); 21 Apr 2010 13:20:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 13:20:38 -0000
Received: (qmail 75587 invoked by uid 500); 21 Apr 2010 13:20:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75524 invoked by uid 500); 21 Apr 2010 13:20:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75516 invoked by uid 99); 21 Apr 2010 13:20:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:20:36 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:20:29 +0000
Received: by gyf1 with SMTP id 1so3844728gyf.35
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 06:20:08 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.190.12 with HTTP; Wed, 21 Apr 2010 06:20:08 -0700 (PDT)
In-Reply-To: <k2j21a749a41004210346u9564099bj1c2ba03318bf8cfa@mail.gmail.com>
References: <t2x21a749a41004200039v64251e7fs9ccce08225160554@mail.gmail.com>
	 <z2k9ac0c6aa1004200436u684ca07cy3f5b398be7e62545@mail.gmail.com>
	 <k2j21a749a41004210346u9564099bj1c2ba03318bf8cfa@mail.gmail.com>
Date: Wed, 21 Apr 2010 09:20:08 -0400
Received: by 10.151.28.13 with SMTP id f13mr8843204ybj.143.1271856008268; Wed, 
	21 Apr 2010 06:20:08 -0700 (PDT)
Message-ID: <r2v9ac0c6aa1004210620xf1094e21yacc7ad8c492a627e@mail.gmail.com>
Subject: Re: Reaching the posting lists
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-9
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

They are indeed abstract in the IndexReader base class, but, the
concrete implementation you get from IndexReader.open or
IndexWriter.getReader implements the methods to return
TermDocs/Positions, and, they return concrete implementations of these
abstract classes.

Mike

2010/4/21 Ya=F0=FDz Karg=FDn <xerxes862@gmail.com>:
> Thanks for the answer. However those classes and methods are abstract.
> Should I write my own implementation? Since Lucene is able to do
> indexing and searching, I think there should be already implementation
> of these things.
>
> Sorry, if Mike's answer also includes this obviously. But I couldn't
> get it, I need some further explanation.
>
> Thanks,
> Yagiz
>
> 2010/4/20 Michael McCandless <lucene@mikemccandless.com>:
>> You have to open an IndexReader in order to walk the postings of newly
>> indexed docs.
>>
>> EG after indexing the doc, ask for a new near-real-time reader
>> (IndexWriter.getReader()), then use the postings API
>> (TermDocs/TermPositions in 3.0.x, but in trunk, with the flex API,
>> DocsEnum/DocsAndPositionsEnum) via IndexReader.
>>
>> Mike
>>
>> On Tue, Apr 20, 2010 at 3:39 AM, Ya=F0=FDz Karg=FDn <xerxes862@gmail.com=
> wrote:
>>> Hi all,
>>>
>>> I have a question about usage of lucene, I want to figure out how I
>>> can get one or all posting lists, after adding a document to the
>>> index, but without materializing it in files. So after I add a
>>> document (let's say "to be or not to be"), I am asking if I can get
>>> something like this:
>>>
>>> to -> (docID, tf(to));
>>> be -> (docID, tf(be));
>>> ...
>>> ...
>>>
>>> Or this code can help better understanding:
>>>
>>> indexWriter.addDocument(doc);
>>> someObject.someMethod(); -> and this will return all posting lists
>>> created for "doc" in some data structure that i can use.
>>>
>>> As far as I know "addDocument(doc)" writes the results gotten from the
>>> "doc" in files, but it will be better if I can get the posting lists
>>> before they are wrote in files. Maybe something like this:
>>>
>>> someObject.giveMeAllPostingListsOfThisDocument(doc); -> and this will
>>> return all posting lists created for "doc" in some data structure that
>>> i can use.
>>>
>>> how can I write methods like those above (if we don't have same kind
>>> of things), or where can I get the desired data from?
>>>
>>> I will be glad if you can help me.
>>>
>>> Best,
>>> Yagiz Kargin
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
> --
> Ya=F0=FDz Karg=FDn (Yagiz Kargin)
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45883-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 13:22:16 2010
Return-Path: <java-user-return-45883-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25487 invoked from network); 21 Apr 2010 13:22:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 13:22:16 -0000
Received: (qmail 81721 invoked by uid 500); 21 Apr 2010 13:22:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81695 invoked by uid 500); 21 Apr 2010 13:22:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81687 invoked by uid 99); 21 Apr 2010 13:22:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:22:14 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.156 as permitted sender)
Received: from [72.14.220.156] (HELO fg-out-1718.google.com) (72.14.220.156)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:22:05 +0000
Received: by fg-out-1718.google.com with SMTP id e12so3071014fga.5
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 06:21:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        bh=Kp6tLfdPgMa3Ay6UBkBR+34Jo39ibGnfaMrNAzHoGtM=;
        b=e3E/vh8nTOgygFgmJ9xBGwOZ96ZDlaETbISxidg7rd/LT8K2fF/KoZHHMRfiFwJjHL
         t7tSMdVKdRvqlaksPY5f0msCQUH7antKB1DFjJUFObI/lrSfK4YKHTrWC2ap20KJAqn3
         xsUv8kFpCmzc5UfyWRNbFKMA2+SK/gW8Tfasc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=Pif1QFKbiNPH+nBpEvpij5tQfvcdJwMufHFr8KWpOKkNCLKTuT8Y9gvzlcO4IH3Gnm
         htc/9KbcX5GGPJ4pTTwJotBJu48P6ngH1EmFtxqhenx2EwNVV566tiuOAEw4VkAEpIJ/
         Y6lW3t9xMMPRuM2vcAA8rbOtsLY7+4s1TWoRg=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Wed, 21 Apr 2010 06:20:39 -0700 (PDT)
Date: Wed, 21 Apr 2010 15:20:39 +0200
Received: by 10.223.20.216 with SMTP id g24mr959594fab.63.1271856039402; Wed, 
	21 Apr 2010 06:20:39 -0700 (PDT)
Message-ID: <j2vf071061b1004210620k7bbf23cbi21ea63a89670735b@mail.gmail.com>
Subject: are long words split into up to 256 long tokens?
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

I am analizying this wiht my custom analyzer:
String s =3D "mail77 mail88888 tc ro45mine durante
jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj=
jjjdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd=
ddddddddddddddddddddddddddddddddddddddddddddkkkkkkkkkkkkkkkkkkkkkkkkdssssss=
ss230iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii
juju";

my custom analizer is basically:
        TokenStream result =3D new LowerCaseLetterNumberTokenizer(reader);
        result =3D new LengthFilter(result, 3, 256);
        result =3D new StopFilter(enablePositionIncrements, result,
stopWords, true);

and depending on the value I pass as max word lenght to LengthFilter I
have different results...

max 30
1: [mail77:0->6:word]
2: [mail88888:7->16:word]
3: [tc:17->19:word]
4: [ro45mine:20->28:word]
5: [juju:334->338:word]

(this is what I expected)

max 70, 100 or 253
1: [mail77:0->6:word]
2: [mail88888:7->16:word]
3: [tc:17->19:word]
4: [ro45mine:20->28:word]
5: [iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii:292->333:word]
6: [juju:334->338:word]


max 256 or 270
1: [mail77:0->6:word]
2: [mail88888:7->16:word]
3: [tc:17->19:word]
4: [ro45mine:20->28:word]
5: [jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj=
jjjjjjjdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd=
ddddddddddddddddddddddddddddddddddddddddddddddddkkkkkkkkkkkkkkkkkkkkkkkkdss=
ssssss230iiiiiiiiiiiiiiiiiiiiiiiii:37->292:word]
6: [iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii:292->333:word]
7: [juju:334->338:word]

token 5 has a lenght of 256. Is 256 some inner maximum too in some
lucene internal that causes this? What is happening is that the long
word is split into smaller words up to 256 and then the min and max
limit applied. Is that correct? I have removed LengthFilter and still
see the splitting at 256 happen. I would like not to have this, and
removed altogheter any word longer than max, wihtout decomposing into
smaller ones. Is there a way to achieve this?

Using lucene 3.0.1

thanks
javier

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45884-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 13:24:54 2010
Return-Path: <java-user-return-45884-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25989 invoked from network); 21 Apr 2010 13:24:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 13:24:53 -0000
Received: (qmail 88926 invoked by uid 500); 21 Apr 2010 13:24:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88893 invoked by uid 500); 21 Apr 2010 13:24:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 88885 invoked by uid 99); 21 Apr 2010 13:24:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:24:51 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:24:45 +0000
Received: by gyf1 with SMTP id 1so3846651gyf.35
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 06:24:23 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.190.12 with HTTP; Wed, 21 Apr 2010 06:24:23 -0700 (PDT)
In-Reply-To: <1271801567396-738551.post@n3.nabble.com>
References: <1271801567396-738551.post@n3.nabble.com>
Date: Wed, 21 Apr 2010 09:24:23 -0400
Received: by 10.150.187.19 with SMTP id k19mr8730213ybf.96.1271856263458; Wed, 
	21 Apr 2010 06:24:23 -0700 (PDT)
Message-ID: <m2j9ac0c6aa1004210624z7429041h57530ad825ff0286@mail.gmail.com>
Subject: Re: Short circuit in query ...
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Lucene attempts to drive the query by the clause that's least
frequent, so order or your clauses will not matter.

But, it uses a simplistic heuristic to do so: it looks at the first
docID for each sub-clause and then reorders them in decreasing docID
order.  This isn't a perfect optimization since conceivably a
low-count sub-clause could just happen to have eg docID 0 matching.

Mike

On Tue, Apr 20, 2010 at 6:12 PM, John4982 <john4982@gmail.com> wrote:
>
> Hi
>
> does Lucene search uses short-circuit when i execute query like:
>
> A:10 AND b:20 AND c:30
>
> In general, does position of field names can impact search performance e.g.
> if field A with value 10 is more frequent is this mean that this will be
> slower than if value 10 is less frequent?
>
> best
> John
> --
> View this message in context: http://n3.nabble.com/Short-circuit-in-query-tp738551p738551.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45885-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 13:50:50 2010
Return-Path: <java-user-return-45885-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33153 invoked from network); 21 Apr 2010 13:50:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 13:50:50 -0000
Received: (qmail 44752 invoked by uid 500); 21 Apr 2010 13:50:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44700 invoked by uid 500); 21 Apr 2010 13:50:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44692 invoked by uid 99); 21 Apr 2010 13:50:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 13:50:47 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.49.18] (HELO web52908.mail.re2.yahoo.com) (206.190.49.18)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 21 Apr 2010 13:50:37 +0000
Received: (qmail 36981 invoked by uid 60001); 21 Apr 2010 13:50:15 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271857815; bh=+XFbLZkv1yxQWnx7SneA2Xg1XlOdcj4Adxed6ZG35nw=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=aIrDTRqVnHj2OnWixvzT5ChrHvGf8hhLr5mHD400SapV0949fhqHJ/jkd2sTAUEPpnsT3I7Yr/tUqQAIDkvoosfuY5wbzFyp6AWiWrAvVvAuuZi29pr4epjSAlDsYK/ivTD4uZtb61MAEnXs7Ppk6BU1kFxje4VnDxr69bIF1wk=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=aL9dby+PPfYCIYMAxF4CiYX+g3H2ByYyHJkI5+z2L+kZ38fjmPGmXiWbpnqaX2bQNATHDYyLkaGrwevWZcTQIlbtV+ghOr4mfcvDzw+svKKN1Z6CDWZybasX1ob1cj+Ph56akA8xeSuqXQDRRwBaxFxz4SS5d43zrqIbqQJNypE=;
Message-ID: <470047.33619.qm@web52908.mail.re2.yahoo.com>
X-YMail-OSG: p.zRBMwVM1mb9D6Cf05C1ba1kRrW5YusY0aprQUjZZ_3Cbt
 WUm2w48.4_C_ywwGJOAS4AJVwUS_iKVbJLbmN1clSmOinUfq9Y8JyslbLKCt
 3K2DZpOE6d0kdP58Uvs1DGLBbtlxm4HJ8BYXS0NQ6U4Zh_slClQXJpgV3zK8
 32j0xlroU4y7zKYc_wRHrzXAeb6LtpnkHA30AD6woGsmHy0U3mzmZh5WsCm4
 0rI3fYsNx0AVpzr1LeH9_YPcjN0M9mVA44hNSGPV.hG_3mLyYOpztLbGhzlB
 Gyud7a9U5FKfCdxV2qe.MRVMyNLVoGDAPY6SGJ3TuZXKdIpwqfQif2w--
Received: from [193.140.184.100] by web52908.mail.re2.yahoo.com via HTTP; Wed, 21 Apr 2010 06:50:15 PDT
X-Mailer: YahooMailClassic/10.1.9 YahooMailWebService/0.8.102.267879
Date: Wed, 21 Apr 2010 06:50:15 -0700 (PDT)
From: Ahmet Arslan <iorixxx@yahoo.com>
Subject: Re: are long words split into up to 256 long tokens?
To: java-user@lucene.apache.org
In-Reply-To: <j2vf071061b1004210620k7bbf23cbi21ea63a89670735b@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

> Is 256 some inner maximum too
> in some
> lucene internal that causes this? What is happening is that
> the long
> word is split into smaller words up to 256 and then the min
> and max
> limit applied. Is that correct? I have removed LengthFilter
> and still
> see the splitting at 256 happen. I would like not to have
> this, and
> removed altogheter any word longer than max, wihtout
> decomposing into
> smaller ones. Is there a way to achieve this?
> 
> Using lucene 3.0.1


Assuming your Tokenizer extends CharTokenizer:

CharTokenizer.java has this field: 
private static final int MAX_WORD_LEN = 255;

you can modify CharTokenizer.java according to your needs.


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45886-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 14:07:37 2010
Return-Path: <java-user-return-45886-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36246 invoked from network); 21 Apr 2010 14:07:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 14:07:36 -0000
Received: (qmail 70211 invoked by uid 500); 21 Apr 2010 14:07:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70166 invoked by uid 500); 21 Apr 2010 14:07:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70156 invoked by uid 99); 21 Apr 2010 14:07:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 14:07:34 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.153 as permitted sender)
Received: from [72.14.220.153] (HELO fg-out-1718.google.com) (72.14.220.153)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 14:07:26 +0000
Received: by fg-out-1718.google.com with SMTP id e21so2028472fga.5
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 07:07:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=KZnnWaLrc4UOEuhSexdZBzvHT37B8Wt4Yr6764Unmx4=;
        b=JL+BS0W8ocsmqA38OLyLzmcpQPPdSPBNJYeoJcbr3oHYTVM8WjSLCr69s5l9yv39ZH
         7iNq5jbftFmm/xycXH7SoBNuCXU0ckQ+Q6gLE7Bzk1mVw8jzZvrK4u16IRPWQyo2HasM
         r8Hj3b2OuNfbOk9o3BXGMkQi/zq8NjLiPcsDU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=b3LBBb7I3pToFXVy/ja00O+qnccMyPLaVwDLvTNM6DzvfYwVmYAY9aP1ijExNFcMbn
         aJmy7NFZBcFwdtUaeZHK8/IX+7ecsoRyNQgnDqWu0r+2b9rpkMn4ILdaR45VtwsmDPN6
         CoNFncwlna4aqvmX9SELfOxp+3+BNiF21l674=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Wed, 21 Apr 2010 06:58:33 -0700 (PDT)
In-Reply-To: <470047.33619.qm@web52908.mail.re2.yahoo.com>
References: <j2vf071061b1004210620k7bbf23cbi21ea63a89670735b@mail.gmail.com>
	 <470047.33619.qm@web52908.mail.re2.yahoo.com>
Date: Wed, 21 Apr 2010 15:58:33 +0200
Received: by 10.223.6.27 with SMTP id 27mr199373fax.31.1271858313519; Wed, 21 
	Apr 2010 06:58:33 -0700 (PDT)
Message-ID: <y2gf071061b1004210658sa9583ce3uca62d4b349399bcb@mail.gmail.com>
Subject: Re: are long words split into up to 256 long tokens?
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

oh, yes it does extend CharTokenizer..thanks Ahmet. I had searched
lucene source code for 256 and found nothing suspicious, and that was
itself suspicious cause it looked clearly like an inner limit. Of
course I should have searched for 255...

I'll see how I proceed cause I don't want to use a custom build.

On Wed, Apr 21, 2010 at 3:50 PM, Ahmet Arslan <iorixxx@yahoo.com> wrote:
>> Is 256 some inner maximum too
>> in some
>> lucene internal that causes this? What is happening is that
>> the long
>> word is split into smaller words up to 256 and then the min
>> and max
>> limit applied. Is that correct? I have removed LengthFilter
>> and still
>> see the splitting at 256 happen. I would like not to have
>> this, and
>> removed altogheter any word longer than max, wihtout
>> decomposing into
>> smaller ones. Is there a way to achieve this?
>>
>> Using lucene 3.0.1
>
>
> Assuming your Tokenizer extends CharTokenizer:
>
> CharTokenizer.java has this field:
> private static final int MAX_WORD_LEN = 255;
>
> you can modify CharTokenizer.java according to your needs.
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45887-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 14:19:07 2010
Return-Path: <java-user-return-45887-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 38890 invoked from network); 21 Apr 2010 14:19:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 14:19:07 -0000
Received: (qmail 88004 invoked by uid 500); 21 Apr 2010 14:19:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87976 invoked by uid 500); 21 Apr 2010 14:19:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87968 invoked by uid 99); 21 Apr 2010 14:19:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 14:19:04 +0000
X-ASF-Spam-Status: No, hits=-0.5 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 14:18:57 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 726D8D36009
	for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 16:18:34 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id SQil3xhpGH6B for <java-user@lucene.apache.org>;
	Wed, 21 Apr 2010 16:18:27 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 31AC9D36005
	for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 16:18:27 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <j2vf071061b1004210620k7bbf23cbi21ea63a89670735b@mail.gmail.com>	 <470047.33619.qm@web52908.mail.re2.yahoo.com> <y2gf071061b1004210658sa9583ce3uca62d4b349399bcb@mail.gmail.com>
In-Reply-To: <y2gf071061b1004210658sa9583ce3uca62d4b349399bcb@mail.gmail.com>
Subject: RE: are long words split into up to 256 long tokens?
Date: Wed, 21 Apr 2010 16:18:36 +0200
Message-ID: <005e01cae15d$88164750$9842d5f0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrhXAPFPbZfa3FIRsSiT361lj9+jgAAWkgw
Content-Language: de

Can you open a bug report to make this configureable, so we don't forget =
this? E.g. StandardTokenizer is able to change this.

Thanks,
Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: jm [mailto:jmuguruza@gmail.com]
> Sent: Wednesday, April 21, 2010 3:59 PM
> To: java-user@lucene.apache.org
> Subject: Re: are long words split into up to 256 long tokens?
>=20
> oh, yes it does extend CharTokenizer..thanks Ahmet. I had searched
> lucene source code for 256 and found nothing suspicious, and that was
> itself suspicious cause it looked clearly like an inner limit. Of
> course I should have searched for 255...
>=20
> I'll see how I proceed cause I don't want to use a custom build.
>=20
> On Wed, Apr 21, 2010 at 3:50 PM, Ahmet Arslan <iorixxx@yahoo.com>
> wrote:
> >> Is 256 some inner maximum too
> >> in some
> >> lucene internal that causes this? What is happening is that
> >> the long
> >> word is split into smaller words up to 256 and then the min
> >> and max
> >> limit applied. Is that correct? I have removed LengthFilter
> >> and still
> >> see the splitting at 256 happen. I would like not to have
> >> this, and
> >> removed altogheter any word longer than max, wihtout
> >> decomposing into
> >> smaller ones. Is there a way to achieve this?
> >>
> >> Using lucene 3.0.1
> >
> >
> > Assuming your Tokenizer extends CharTokenizer:
> >
> > CharTokenizer.java has this field:
> > private static final int MAX_WORD_LEN =3D 255;
> >
> > you can modify CharTokenizer.java according to your needs.
> >
> >
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45888-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 14:32:11 2010
Return-Path: <java-user-return-45888-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43613 invoked from network); 21 Apr 2010 14:32:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 14:32:11 -0000
Received: (qmail 13047 invoked by uid 500); 21 Apr 2010 14:32:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13011 invoked by uid 500); 21 Apr 2010 14:32:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13003 invoked by uid 99); 21 Apr 2010 14:32:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 14:32:08 +0000
X-ASF-Spam-Status: No, hits=-0.4 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jmuguruza@gmail.com designates 72.14.220.155 as permitted sender)
Received: from [72.14.220.155] (HELO fg-out-1718.google.com) (72.14.220.155)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 14:32:03 +0000
Received: by fg-out-1718.google.com with SMTP id e21so2039052fga.5
        for <java-user@lucene.apache.org>; Wed, 21 Apr 2010 07:31:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=pGPCNRRMfxO/TjeWQ+Rmgpi5N9t9R3FGh7hIBY2tPmQ=;
        b=L3YXIn5hDh+n1oglieszT84bg9TsZmTIqtxjMAHfTypB/NgvUXRToxSZFbTuZEeGJM
         n/FOlK/ZbsBb/OIMA30p0D3GZ7s/6kd6oJKtAw8aEzxn6NLK9Dnsg3E96GF53UTx78d4
         FbtSXfWn214M9k1GmVgwp5QhX5ZSjBL5fDMUU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Ra3hXdKrDm1Y75gUhhkCoIlMHuqyOzO+rytr/ogxBWUTD/moc2kizZx1r4fjykocny
         wIBYXYtILYRit5eNdpvlPGUhdQROj6VCyQ9ztxBhqcFcsH9fYOgVNmvwU10Gc0jMzRMt
         AFQviFB63sWu3JDeVYXrCZfDiXNqyqsOdy6OI=
MIME-Version: 1.0
Received: by 10.223.124.81 with HTTP; Wed, 21 Apr 2010 07:31:03 -0700 (PDT)
In-Reply-To: <005e01cae15d$88164750$9842d5f0$@de>
References: <j2vf071061b1004210620k7bbf23cbi21ea63a89670735b@mail.gmail.com>
	 <470047.33619.qm@web52908.mail.re2.yahoo.com>
	 <y2gf071061b1004210658sa9583ce3uca62d4b349399bcb@mail.gmail.com>
	 <005e01cae15d$88164750$9842d5f0$@de>
Date: Wed, 21 Apr 2010 16:31:03 +0200
Received: by 10.223.17.197 with SMTP id t5mr1957186faa.84.1271860263688; Wed, 
	21 Apr 2010 07:31:03 -0700 (PDT)
Message-ID: <w2wf071061b1004210731p49ff73c2q26cbd73a58c77c5d@mail.gmail.com>
Subject: Re: are long words split into up to 256 long tokens?
From: jm <jmuguruza@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

ok https://issues.apache.org/jira/browse/LUCENE-2407

On Wed, Apr 21, 2010 at 4:18 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> Can you open a bug report to make this configureable, so we don't forget this? E.g. StandardTokenizer is able to change this.
>
> Thanks,
> Uwe
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
>> -----Original Message-----
>> From: jm [mailto:jmuguruza@gmail.com]
>> Sent: Wednesday, April 21, 2010 3:59 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: are long words split into up to 256 long tokens?
>>
>> oh, yes it does extend CharTokenizer..thanks Ahmet. I had searched
>> lucene source code for 256 and found nothing suspicious, and that was
>> itself suspicious cause it looked clearly like an inner limit. Of
>> course I should have searched for 255...
>>
>> I'll see how I proceed cause I don't want to use a custom build.
>>
>> On Wed, Apr 21, 2010 at 3:50 PM, Ahmet Arslan <iorixxx@yahoo.com>
>> wrote:
>> >> Is 256 some inner maximum too
>> >> in some
>> >> lucene internal that causes this? What is happening is that
>> >> the long
>> >> word is split into smaller words up to 256 and then the min
>> >> and max
>> >> limit applied. Is that correct? I have removed LengthFilter
>> >> and still
>> >> see the splitting at 256 happen. I would like not to have
>> >> this, and
>> >> removed altogheter any word longer than max, wihtout
>> >> decomposing into
>> >> smaller ones. Is there a way to achieve this?
>> >>
>> >> Using lucene 3.0.1
>> >
>> >
>> > Assuming your Tokenizer extends CharTokenizer:
>> >
>> > CharTokenizer.java has this field:
>> > private static final int MAX_WORD_LEN = 255;
>> >
>> > you can modify CharTokenizer.java according to your needs.
>> >
>> >
>> >
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45889-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 18:02:40 2010
Return-Path: <java-user-return-45889-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57527 invoked from network); 21 Apr 2010 18:02:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 18:02:40 -0000
Received: (qmail 9009 invoked by uid 500); 21 Apr 2010 18:02:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8898 invoked by uid 500); 21 Apr 2010 18:02:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8890 invoked by uid 99); 21 Apr 2010 18:02:37 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 18:02:37 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mario-fa@infonet.com.br designates 200.241.52.11 as permitted sender)
Received: from [200.241.52.11] (HELO estancia.infonet.com.br) (200.241.52.11)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 18:02:29 +0000
Received: (qmail 27635 invoked from network); 21 Apr 2010 17:45:39 -0000
Received: by simscan 1.4.0 ppid: 27591, pid: 27605, t: 1.6128s
         scanners: clamav: 0.96/m:52/d:10745 spam: 3.2.5
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on
	estancia.infonet.com.br
X-Spam-Level: 
Received: from 18971191051.user.veloxzone.com.br (HELO marioandrenote) (Usuario-Autenticado:mario-fa@[189.71.191.51])
          (envelope-sender <mario-fa@infonet.com.br>)
          by 200.241.52.11 (qmail-ldap-1.03) with SMTP
          for <java-user@lucene.apache.org>; 21 Apr 2010 17:45:37 -0000
From: =?iso-8859-1?B?TeFyaW8gYW5kcuk=?= <mario-fa@infonet.com.br>
To: <java-user@lucene.apache.org>
Cc: "'M Jr'" <mjrse@hotmail.com>
References: <j2vf071061b1004210620k7bbf23cbi21ea63a89670735b@mail.gmail.com>	 <470047.33619.qm@web52908.mail.re2.yahoo.com>	 <y2gf071061b1004210658sa9583ce3uca62d4b349399bcb@mail.gmail.com>	 <005e01cae15d$88164750$9842d5f0$@de> <w2wf071061b1004210731p49ff73c2q26cbd73a58c77c5d@mail.gmail.com>
In-Reply-To: <w2wf071061b1004210731p49ff73c2q26cbd73a58c77c5d@mail.gmail.com>
Subject: Can you help us - Filling out our Survey
Date: Wed, 21 Apr 2010 15:01:52 -0300
Message-ID: <004001cae17c$b9035c80$2b0a1580$@com.br>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrhXSVz33JWWdEITW+QKvZgJGersAAH2ngg
Content-Language: pt-br
x-cr-hashedpuzzle: 6io= CLpp EuQJ FHhv Gl5E HcFa KxWj LEEo Nh42 OXTx O08I O6n5 Poku RCaO UDyX VRx0;2;agBhAHYAYQAtAHUAcwBlAHIAQABsAHUAYwBlAG4AZQAuAGEAcABhAGMAaABlAC4AbwByAGcAOwBtAGoAcgBzAGUAQABoAG8AdABtAGEAaQBsAC4AYwBvAG0A;Sosha1_v1;7;{4535D2CF-6061-4E96-9110-56116D997912};bQBhAHIAaQBvAC0AZgBhAEAAaQBuAGYAbwBuAGUAdAAuAGMAbwBtAC4AYgByAA==;Wed, 21 Apr 2010 18:01:40 GMT;QwBhAG4AIAB5AG8AdQAgAGgAZQBsAHAAIAB1AHMAIAAtACAARgBpAGwAbABpAG4AZwAgAG8AdQB0ACAAbwB1AHIAIABTAHUAcgB2AGUAeQA=
x-cr-puzzleid: {4535D2CF-6061-4E96-9110-56116D997912}
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, score=-2.6 required=8.0 tests=BAYES_00 autolearn=ham
	version=3.2.5

Dear Developers,
Can you help us and answer this survey: What approach do you use to
comprehend software? It is fast and easy.
Fill out our Survey in:  www.neurominer.com/survey

Thank you very much.

-------------------------------------
M=E1rio Andr=E9
Federal Institute of Sergipe, Professor
Student Masters - MCC-UFAL-Brazil
Skype: mario-fa
www.marioandre.com.br
-------------------------------------


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45890-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 18:16:10 2010
Return-Path: <java-user-return-45890-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66669 invoked from network); 21 Apr 2010 18:16:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 18:16:09 -0000
Received: (qmail 39167 invoked by uid 500); 21 Apr 2010 18:16:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38513 invoked by uid 500); 21 Apr 2010 18:16:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38484 invoked by uid 99); 21 Apr 2010 18:16:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 18:16:01 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erik.hatcher@gmail.com designates 209.85.221.184 as permitted sender)
Received: from [209.85.221.184] (HELO mail-qy0-f184.google.com) (209.85.221.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 18:15:53 +0000
Received: by qyk14 with SMTP id 14so4495554qyk.14
        for <multiple recipients>; Wed, 21 Apr 2010 11:15:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :content-type:content-transfer-encoding:mime-version:subject:date
         :x-mailer;
        bh=4e6F41fFnP+JCpmiyp/9R1hgiT7yxGtNRN45RPdk9q4=;
        b=P+S8IuzLzqS/e7Sa2uefuoQW6ezl7M3hSZ+50vYB4LyNDa682VdW3tSZxmbeKXlk4u
         oOvy2A2b8LAWwQwAWP49CnV2pjSo1Hu6s202w/eNvidflt1MDPbhzsnuw+zVfRwo51A5
         lzcOdjfDkDg69Jro61zt5J+c8yt993KRHLz4U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:content-type:content-transfer-encoding
         :mime-version:subject:date:x-mailer;
        b=NSX4AH8OJHtEER3C9LY+onCL/66Lj0PXbS56covBRs6x2GTsvbODfqTqHWVSPnUDCB
         aj/HDBY/kXSBA8L8wCnCJ6wLazrtjBH0ycZl8NM9AcnkxGMhb2p+2f0CmFzyYtz69BtY
         uSfvmC79OhEtn7oZfkKyj5f9aqFKO649538kc=
Received: by 10.224.85.148 with SMTP id o20mr2869964qal.65.1271873732727;
        Wed, 21 Apr 2010 11:15:32 -0700 (PDT)
Received: from [10.0.1.69] (va-71-51-2-156.dhcp.embarqhsd.net [71.51.2.156])
        by mx.google.com with ESMTPS id 4sm4218751qwe.47.2010.04.21.11.15.31
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 21 Apr 2010 11:15:31 -0700 (PDT)
Message-Id: <E874F41B-E660-43B8-84A7-DDA12C9FB185@gmail.com>
From: Erik Hatcher <erik.hatcher@gmail.com>
To: solr-user@lucene.apache.org,
 java-user@lucene.apache.org,
 general@lucene.apache.org,
 dev@lucene.apache.org
Content-Type: text/plain; charset=WINDOWS-1252; format=flowed; delsp=yes
Content-Transfer-Encoding: quoted-printable
Mime-Version: 1.0 (Apple Message framework v936)
Subject: [WEBINAR] Practical Search with Solr: Beyond just looking it up  
Date: Wed, 21 Apr 2010 14:15:23 -0400
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Below is the official announcement for our exciting upcoming webinar.  =20=

This one is near and dear to my heart, so I'll be eagerly listening =20
too, and participating with my experiences as it fits with the flow of =20=

the webinar.

I'm a card-carrying library geek, and I've had the pleasure of working =20=

alongside Bess Sadler at the University of Virginia as we began the =20
Blacklight[1] project.  Now at Stanford, she and Naomi Dushay continue =20=

to shine Solr on collections of various types.  And Tom Burton-West =20
and the Hathi Trust project have put Lucene and Solr through some very =20=

heavy challenges, breaking Lucene's limits even! (and ultimately =20
working to alleviate them).  The scale of Tom's project is massive in =20=

scale and importance, with OCR challenges in various languages.   I've =20=

been blessed to know all three of these folks personally thanks to the =20=

code4lib community in which I continue to participate.

   [1] http://projectblacklight.org/ - a vibrant open source project =20
using Ruby on Rails as an elegant and flexible discovery front-end for =20=

Solr.

-------

Forget the dust jackets and Aunt Shirley in 'Reference': libraries =20
today are on the screaming edge of Lucene/Solr implementations. Solr =20
applications for library data offer practical, general purpose =20
solutions to some of the knottiest search problems: daunting indexes, =20=

metadata whipped into shape, deep field faceting, data types a mile =20
wide, phrase queries that will make your head spin, unforgiving =20
relevancy for the masses, even OCR. Join Stanford's Bess Sadler and =20
Naomi Dushay, plus Tom Burton-West of the Hathi Trust Project, for a =20
walking tour of how Solr can tame the wildest of search challenges, =20
including:

	=95 Strategies for dealing with non-normalized data
	=95 Leveraging field data and user experience for improved =
relevancy
	=95 Tackling big and unexpected phrase queries

Join us for a free webinar
Thursday, April 29, 2010
11:00 AM PDT / 2:00 PM EDT
Go here to sign up: =
http://www.eventsvc.com/lucidimagination/042910?trk=3DWR-APR2010B-AP

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45891-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 21 22:38:25 2010
Return-Path: <java-user-return-45891-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39759 invoked from network); 21 Apr 2010 22:38:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Apr 2010 22:38:24 -0000
Received: (qmail 31079 invoked by uid 500); 21 Apr 2010 22:38:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30406 invoked by uid 500); 21 Apr 2010 22:38:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30013 invoked by uid 99); 21 Apr 2010 22:38:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 22:38:17 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of bradfordstephens@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Apr 2010 22:38:13 +0000
Received: by gwb1 with SMTP id 1so967911gwb.35
        for <multiple recipients>; Wed, 21 Apr 2010 15:37:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:received:date
         :x-google-sender-auth:received:message-id:subject:from:to
         :content-type;
        bh=Qeg3cS/26Gqs9orM22zT7fSwu2O7tw5R8UH/ARREme8=;
        b=pmk7U4l1xzOO8dFt/UOppefJSFDKzNTGZPWei9CW890PG+VKqqZ1sMI+lo/CXscE5E
         4WK+G1uWNc93iF2T3QO0hlVEsOfZd9Bv4rSZ8BApHjw/CSYASVJQSc1qW4Aj/T2PaZ75
         sjz5x5+djE8eBsY5XvXZJfALW+1+y65gBtilM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        b=pkrJX+6RHduW4VZlXXfg0MllTKCtJxkQosPP+20nWONRPf/fMfuGmWdB9H4Qm5XjYS
         4JgDeJ33s54tAjqElXfWmOSoxqIofqwXoEJ/S0nE7aSz3BM+BNdWJMQeo3dsc5DDvGmF
         KhNHzWQBGmoJA3TqSG0IMYRF/WQLuWqm3KV5M=
MIME-Version: 1.0
Sender: bradfordstephens@gmail.com
Received: by 10.90.35.13 with HTTP; Wed, 21 Apr 2010 15:37:50 -0700 (PDT)
Date: Wed, 21 Apr 2010 15:37:50 -0700
X-Google-Sender-Auth: cf0d919436bdbc7c
Received: by 10.90.62.22 with SMTP id k22mr4810058aga.72.1271889470704; Wed, 
	21 Apr 2010 15:37:50 -0700 (PDT)
Message-ID: <g2g860544ed1004211537ofd3ab18ej145abafb881be3af@mail.gmail.com>
Subject: April Seattle Hadoop/Scalability/NoSQL Meetup: Cassandra, Science, 
	More!
From: Bradford Stephens <bradford@drawntoscalehq.com>
To: nutch-user@lucene.apache.org, java-user@lucene.apache.org, 
	core-user@hadoop.apache.org, hbase-user@hadoop.apache.org, 
	user@cassandra.apache.org, pig-user@hadoop.apache.org, 
	organize <organize@seattletechstartups.com>, solr-user@lucene.apache.org, 
	nosql-discussion@googlegroups.com
Content-Type: text/plain; charset=ISO-8859-1

Hey there! Wanted to let you all know about our next meetup, April
28th. We've got a killer new venue thanks to Amazon.

Check out the details at the link:
http://www.meetup.com/Seattle-Hadoop-HBase-NoSQL-Meetup/calendar/13072272/

Our Speakers this month:
1. Nick Dimiduk, Drawn to Scale: Intro to Hadoop, HBase, and NoSQL
2. Benjamin Black: Intro to Cassandra
3. Adam Jacob, CTO, OpsCode: Chef and Cluster Management
4. Sarah Killcoyne, Systems Biology: Big Data in Science

We've had great success in the past, and are growing quickly!
Including guests from LinkedIn, Amazon, Cloudant, 10gen/MongoDB, and
more.

Our format is flexible: We usually have speakers who talk for ~20
minutes each and then do Q+A, plus lightning talks, dicussion, and
then social time.

There'll be beer afterwards, of course! Fierabend, 422 Yale Ave N

Meetup Location:
Amazon HQ, Von Vorst Building, 426 Terry Ave N., Seattle, WA 98109-5210

Hope to see you there! And we're always open to suggestions.

-- 
Bradford Stephens,
Founder, Drawn to Scale
drawntoscalehq.com
727.697.7528

http://www.drawntoscalehq.com --  The intuitive, cloud-scale data
solution. Process, store, query, search, and serve all your data.

http://www.roadtofailure.com -- The Fringes of Scalability, Social
Media, and Computer Science

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45892-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 10:39:34 2010
Return-Path: <java-user-return-45892-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22069 invoked from network); 22 Apr 2010 10:39:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 10:39:34 -0000
Received: (qmail 5913 invoked by uid 500); 22 Apr 2010 10:39:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5545 invoked by uid 500); 22 Apr 2010 10:39:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5537 invoked by uid 99); 22 Apr 2010 10:39:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 10:39:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.223.184 as permitted sender)
Received: from [209.85.223.184] (HELO mail-iw0-f184.google.com) (209.85.223.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 10:39:21 +0000
Received: by iwn14 with SMTP id 14so1757233iwn.22
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 03:39:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:from:date:received
         :message-id:subject:to:content-type;
        bh=+/+qvwZFk2HPRe7RagSH7fyH5uP9hsU57wiSZZMqu4I=;
        b=GlS8ud6+ENSQAmUAl24wICfzrIHTNfe6dmq0v+ORh4R72XuEZ9MVOi0cyP8OsFczTU
         ihK42zLxGSV5/gtlvsGmlwjFFQt3ovSfkqhSUpxHrUfSHvHmW9+ltq3xBze48e5htxjZ
         J2E0wpPlFAXntFnzQYkZ0hI3kl77cTvYR8rxE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=HI+QL/UXCVLjgN1/fg38ipDC/j+022n/1EzD5xY2bOdxQ9mWU7HJ/nZIc6B9Fhff1C
         QJzNlXSAWzrIncq+Mar2k5SipNs1USFOr/YDTFeizT31c5wOB4LCGk05a26dK1hWHgFD
         Ry2nAl/o+1HhsiK6MotHrC3zUL0A1XelwfD8w=
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Thu, 22 Apr 2010 03:38:44 -0700 (PDT)
From: Samarendra Pratap <samarzone@gmail.com>
Date: Thu, 22 Apr 2010 16:08:44 +0530
Received: by 10.231.170.143 with SMTP id d15mr662444ibz.13.1271932740207; Thu, 
	22 Apr 2010 03:39:00 -0700 (PDT)
Message-ID: <g2v8766aaed1004220338u4fca33a7ya4c16fc86a018ab3@mail.gmail.com>
Subject: Reopening a Searcher for each request
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=005045029be92886300484d0eb8b

--005045029be92886300484d0eb8b
Content-Type: text/plain; charset=ISO-8859-1

Greetings to all.
 I have read at so many places that we should not open a Searcher for each
request for the sake of performance, but I have always been wondering
whether it is actually Searcher or Reader?

 I have a group of index amounting to 23G which actually contains of
different index directories. The structure is something like following

Main directory
|
|_________ country1
|                     |___ country1-time1 (actual index)
|                     |___ country1-time2 (actual index)
|                     |___ country1-time3 (actual index)
|
|_________ country2
                     |___ country2-time1 (actual index)
                     |___ country2-time2 (actual index)
                     |___ country2-time3 (actual index)

 When application starts I open IndexReaders on all of actual index
directories (country1-time1, country1-tim2, .... country2-time3) and keep
them in a pool.

 At the time of search, IndexSearchers are created by selecting the
appropriate IndexReaders from the pool. These IndexSearchers in turn are
used to create a ParallelMultiSearcher. Constructors of IndexSearcher and
ParallelMultiSearcher are run for every request.

 Now I believe that creating a pool of ParallelMultiSearcher itself is a
good idea but* I wanted to know if reopening **IndexSearchers** will really
degrade performance irrespective of **IndexReaders** being opened once*.

In my performance tests (which may not be very comprehensive) I didn't find
any noticeable difference.

Please throw some light.


-- 
Regards,
Samar

--005045029be92886300484d0eb8b--

From java-user-return-45893-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 11:12:27 2010
Return-Path: <java-user-return-45893-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29628 invoked from network); 22 Apr 2010 11:12:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 11:12:26 -0000
Received: (qmail 47073 invoked by uid 500); 22 Apr 2010 11:12:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46941 invoked by uid 500); 22 Apr 2010 11:12:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46932 invoked by uid 99); 22 Apr 2010 11:12:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 11:12:23 +0000
X-ASF-Spam-Status: No, hits=1.0 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 11:12:16 +0000
Received: by gwb1 with SMTP id 1so1358139gwb.35
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 04:11:55 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.190.12 with HTTP; Thu, 22 Apr 2010 04:11:55 -0700 (PDT)
In-Reply-To: <g2v8766aaed1004220338u4fca33a7ya4c16fc86a018ab3@mail.gmail.com>
References: <g2v8766aaed1004220338u4fca33a7ya4c16fc86a018ab3@mail.gmail.com>
Date: Thu, 22 Apr 2010 07:11:55 -0400
Received: by 10.151.28.20 with SMTP id f20mr2043486ybj.178.1271934715487; Thu, 
	22 Apr 2010 04:11:55 -0700 (PDT)
Message-ID: <k2o9ac0c6aa1004220411z4ae12992nf78d2943d4ec7fea@mail.gmail.com>
Subject: Re: Reopening a Searcher for each request
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

It's the IndexReader that's costly to open/warm, so ideally it should
be opened once and shared.

The Searchers do very little on construction so re-creating per query
should be OK.

Mike

On Thu, Apr 22, 2010 at 6:38 AM, Samarendra Pratap <samarzone@gmail.com> wr=
ote:
> Greetings to all.
> =A0I have read at so many places that we should not open a Searcher for e=
ach
> request for the sake of performance, but I have always been wondering
> whether it is actually Searcher or Reader?
>
> =A0I have a group of index amounting to 23G which actually contains of
> different index directories. The structure is something like following
>
> Main directory
> |
> |_________ country1
> | =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 |___ country1-time1 (actual ind=
ex)
> | =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 |___ country1-time2 (actual ind=
ex)
> | =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 |___ country1-time3 (actual ind=
ex)
> |
> |_________ country2
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 |___ country2-time1 (actual index=
)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 |___ country2-time2 (actual index=
)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 |___ country2-time3 (actual index=
)
>
> =A0When application starts I open IndexReaders on all of actual index
> directories (country1-time1, country1-tim2, .... country2-time3) and keep
> them in a pool.
>
> =A0At the time of search, IndexSearchers are created by selecting the
> appropriate IndexReaders from the pool. These IndexSearchers in turn are
> used to create a ParallelMultiSearcher. Constructors of IndexSearcher and
> ParallelMultiSearcher are run for every request.
>
> =A0Now I believe that creating a pool of ParallelMultiSearcher itself is =
a
> good idea but* I wanted to know if reopening **IndexSearchers** will real=
ly
> degrade performance irrespective of **IndexReaders** being opened once*.
>
> In my performance tests (which may not be very comprehensive) I didn't fi=
nd
> any noticeable difference.
>
> Please throw some light.
>
>
> --
> Regards,
> Samar
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45894-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 11:30:21 2010
Return-Path: <java-user-return-45894-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33654 invoked from network); 22 Apr 2010 11:30:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 11:30:21 -0000
Received: (qmail 66505 invoked by uid 500); 22 Apr 2010 11:30:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66432 invoked by uid 500); 22 Apr 2010 11:30:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66424 invoked by uid 99); 22 Apr 2010 11:30:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 11:30:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of samarzone@gmail.com designates 209.85.223.184 as permitted sender)
Received: from [209.85.223.184] (HELO mail-iw0-f184.google.com) (209.85.223.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 11:30:11 +0000
Received: by iwn14 with SMTP id 14so1786655iwn.22
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 04:29:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=fCXuUTFWbNmdKZAbgzFwKvpQP7qBNxXEuVEGmW5qkpw=;
        b=DF32njR4mZ5b9/81prszIrhdHQb+1NRgvA4tt7yFTnk9DEEi/Bsav3IGDHJffTy/n0
         UIewhw5Q695KrpAcSG8MWiGm/pRNNaEcEWbBAPSAtbYqc1k6na84sPsFQrjSLC6mIlpG
         qz3Ji1jCPv+GFHJm8g/Qb5z/udqOaQYOLnGHY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=pwyUGIqGhhvawQnIB6Rdu4r23QprjJWN4Xwh/+CferkbGNfOCG3Tc6Lujb5OXefvUL
         6TNgCYxNkKzXAnKU3Mw9ts4n1/JocX2gyz+sqXqwOTMBf9hCq/gvq+GQjMWUmOzZXCW5
         wxmZQO6EqortmawrlnFQ5wT+u+3m7AgAkt2cs=
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Thu, 22 Apr 2010 04:29:35 -0700 (PDT)
In-Reply-To: <k2o9ac0c6aa1004220411z4ae12992nf78d2943d4ec7fea@mail.gmail.com>
References: <g2v8766aaed1004220338u4fca33a7ya4c16fc86a018ab3@mail.gmail.com> 
	<k2o9ac0c6aa1004220411z4ae12992nf78d2943d4ec7fea@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Thu, 22 Apr 2010 16:59:35 +0530
Received: by 10.231.176.74 with SMTP id bd10mr3273490ibb.97.1271935790113; 
	Thu, 22 Apr 2010 04:29:50 -0700 (PDT)
Message-ID: <k2p8766aaed1004220429uc244fc84ma5c5934a2651ea84@mail.gmail.com>
Subject: Re: Reopening a Searcher for each request
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b8c10f262a00484d1a014
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b8c10f262a00484d1a014
Content-Type: text/plain; charset=ISO-8859-1

Thanks Mike.
That solved a query which was itching my mind for a long time.

On Thu, Apr 22, 2010 at 4:41 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> It's the IndexReader that's costly to open/warm, so ideally it should
> be opened once and shared.
>
> The Searchers do very little on construction so re-creating per query
> should be OK.
>
> Mike
>
> On Thu, Apr 22, 2010 at 6:38 AM, Samarendra Pratap <samarzone@gmail.com>
> wrote:
> > Greetings to all.
> >  I have read at so many places that we should not open a Searcher for
> each
> > request for the sake of performance, but I have always been wondering
> > whether it is actually Searcher or Reader?
> >
> >  I have a group of index amounting to 23G which actually contains of
> > different index directories. The structure is something like following
> >
> > Main directory
> > |
> > |_________ country1
> > |                     |___ country1-time1 (actual index)
> > |                     |___ country1-time2 (actual index)
> > |                     |___ country1-time3 (actual index)
> > |
> > |_________ country2
> >                     |___ country2-time1 (actual index)
> >                     |___ country2-time2 (actual index)
> >                     |___ country2-time3 (actual index)
> >
> >  When application starts I open IndexReaders on all of actual index
> > directories (country1-time1, country1-tim2, .... country2-time3) and keep
> > them in a pool.
> >
> >  At the time of search, IndexSearchers are created by selecting the
> > appropriate IndexReaders from the pool. These IndexSearchers in turn are
> > used to create a ParallelMultiSearcher. Constructors of IndexSearcher and
> > ParallelMultiSearcher are run for every request.
> >
> >  Now I believe that creating a pool of ParallelMultiSearcher itself is a
> > good idea but* I wanted to know if reopening **IndexSearchers** will
> really
> > degrade performance irrespective of **IndexReaders** being opened once*.
> >
> > In my performance tests (which may not be very comprehensive) I didn't
> find
> > any noticeable difference.
> >
> > Please throw some light.
> >
> >
> > --
> > Regards,
> > Samar
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Regards,
Samar

--0016363b8c10f262a00484d1a014--

From java-user-return-45895-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 14:53:16 2010
Return-Path: <java-user-return-45895-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7801 invoked from network); 22 Apr 2010 14:53:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 14:53:16 -0000
Received: (qmail 86427 invoked by uid 500); 22 Apr 2010 14:53:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86303 invoked by uid 500); 22 Apr 2010 14:53:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86140 invoked by uid 99); 22 Apr 2010 14:53:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 14:53:13 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 14:53:06 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Term offsets for highlighting
Date: Thu, 22 Apr 2010 11:52:21 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C9FA0B@copper.meg.local>
In-reply-to: <4BCCEF0A.5090501@r.email.ne.jp>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: AcrgHNBCDI+tpQNOQK2oCrKpqR65CgCDhX8w
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local> <4BCCEF0A.5090501@r.email.ne.jp>
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Koji,

Thank you again for your continued assistance.
The code below details the code I used in Lucene 2.4 to highlight terms
(which did not correctly highlight terms).
>From your previous email, is there a way to access a TermVector
containing only matched terms, or is my previous approach still the
correct way to proceed.

Best,

Steve


public HitTermTagger(Scorer pScorer) {
        _mScorer =3D pScorer;
    }

    public ArrayList<KeyValuePair<Integer,Integer>> tagText(TokenStream
ptsTokenStream)
    {
        StringBuilder sbTaggedText =3D new StringBuilder();

        final Token reusableToken =3D new Token();
 =20
        int startOffset =3D -1;
        int endOffset =3D -1;
        float score;
        ArrayList<KeyValuePair<Integer,Integer>> results =3D
                new ArrayList<KeyValuePair<Integer,Integer>>();

        TokenGroup tokenGroup =3D new TokenGroup();

        //initialize scorer
        _mScorer.startFragment(null);

        try {
            for(Token nextToken =3D ptsTokenStream.next(reusableToken);
                (nextToken !=3D null);
                nextToken =3D ptsTokenStream.next(reusableToken))
            {
                //if((tokenGroup.getNumTokens() >
0)&&(tokenGroup.isDistinct(nextToken))) {
                if(nextToken.startOffset() > endOffset) {
                    score =3D _mScorer.getTokenScore(nextToken);
                    if(score > 0.0) {
                        startOffset =3D nextToken.startOffset();
                        endOffset =3D nextToken.endOffset();
                        results.add(new
KeyValuePair<Integer,Integer>(startOffset,endOffset));
                    }
                    //tokenGroup.clear();
                }
=20
//tokenGroup.addToken(nextToken,_mScorer.getTokenScore(nextToken));
            }
        }
-----Original Message-----
From: Koji Sekiguchi [mailto:koji@r.email.ne.jp]=20
Sent: Monday, April 19, 2010 9:02 PM
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting

Stephen Greene wrote:
> Hi Koji,
>
> An additional question. Is it possible to access the FieldTermStack
from
> the FastVectorHighlighter after the it has been populated with
matching
> terms from the field?
>
> I think this would provide an ideal solution for this problem, as
> ultimately I am only concerned with returning positional offsets to
have
> highlighting tags applied to them in a separate process.=20
>
> Thank you for your insight,
>
> Steve
>  =20
Hi Steve,

You cannot access FieldTermStack from FVH, but I think you
can create it by your own. To know how to do it, please refer to
FieldTermStackTest.java. To instantiate FieldTermStack, FieldQuery
object is needed. And FieldQuery object can be obtained from FVH.

But I don't understand why you need FieldTermStack. Just using
Lucene's TermVector with offsets (and positions, if necessary) doesn't
solve your problem?

Koji

--=20
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45896-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 16:52:01 2010
Return-Path: <java-user-return-45896-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50442 invoked from network); 22 Apr 2010 16:52:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 16:52:01 -0000
Received: (qmail 17155 invoked by uid 500); 22 Apr 2010 16:51:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16962 invoked by uid 500); 22 Apr 2010 16:51:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16776 invoked by uid 99); 22 Apr 2010 16:51:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 16:51:51 +0000
X-ASF-Spam-Status: No, hits=-2.0 required=10.0
	tests=ASF_LIST_OPS,FREEMAIL_FROM,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.38.56] (HELO web50302.mail.re2.yahoo.com) (206.190.38.56)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 22 Apr 2010 16:51:45 +0000
Received: (qmail 57011 invoked by uid 60001); 22 Apr 2010 16:51:23 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1271955083; bh=IA4CX3umB10KqFAk+DXrXJnNO5pv4/AZNKfL/mfpiqE=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=rDvG0AshvIVMg82Ap9n0etGmvl6eMjw/qmnOxXCu15eb0gKRu4v4nPj69/7nrjNwjH9Gb/flSEWJ5GHVxaBx0X0kB54PRshy8rJgKDdN1uJnpfH1JJ0f8G5vCjsOq8oKmO+zVcx1FR1RdS7cG5TLFqUZ1MiXimTclJhHT8oTpk4=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=wHsyAK1r08ylGr5aqctkCHOb7/K2xXIs7x6KoCKjJODtkaKNT+uDcYhf2OyRPeP7r/sj1XPTMGTNdVlCVCoIs/xh7liQ0jnL/3Cd+mfi4uPXxxXPSFVKNJoyCyOnqBHCL3JHfT6IzfzvG60Su+v5JPe6HBTm8z57Ugoxjtfr8ys=;
Message-ID: <696192.56973.qm@web50302.mail.re2.yahoo.com>
X-YMail-OSG: BbgzrJ4VM1kxz4wg8yAK71z1zdG6aYhbMq2G4ydj_QrQi30
 vPdQLEJfB1edURkr6d3Tlfn1yKDEmLFn3eV1rF7d_OB6fdTa9pNzqX.j.0O4
 slNsPEfiizfj2Vy7iw1F73uv_JtsdAXMTsxF6PPaaZ7GYH1qWBPLs94H_sn7
 6OzcZG4cib1HHYMrEZcfu8RhaQqdqxpp9eEDNh3XqtPtxCMshoDaa_PMc_H1
 UHcH2k.ctmH6Jae40rQyDnqpPU62.JfLFZ9s9aJZGCtuj4wpEtgdNNu9ZGJV
 NSBX1Y16eGiWb1S.ZHKECoZMr1qaT0NsO7Bn01UfocOMa8EE6lQNDKuEjoCM
 -
Received: from [184.75.0.186] by web50302.mail.re2.yahoo.com via HTTP; Thu, 22 Apr 2010 09:51:23 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
Date: Thu, 22 Apr 2010 09:51:23 -0700 (PDT)
From: Otis Gospodnetic <otis_gospodnetic@yahoo.com>
Subject: Lucandra - Lucene/Solr on Cassandra: April 26, NYC
To: nutch-user@lucene.apache.org, java-user@lucene.apache.org,
  core-user@hadoop.apache.org, hbase-user@hadoop.apache.org,
  user@cassandra.apache.org, pig-user@hadoop.apache.org,
  solr-user@lucene.apache.org, nosql-discussion@googlegroups.com,
  NYC-Apache-Lucene-Solr-Meetup-list@meetup.com
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Hello folks,

Those of you in or near NYC and using Lucene or Solr should come to "Lucandra - a Cassandra-based backend for Lucene and Solr" on April 26th:

http://www.meetup.com/NYC-Search-and-Discovery/calendar/12979971/

The presenter will be Lucandra's author, Jake Luciani.

Please spread the word.

Otis
----
Sematext :: http://sematext.com/ :: Solr - Lucene - Nutch
Lucene ecosystem search :: http://search-lucene.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45897-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 19:59:24 2010
Return-Path: <java-user-return-45897-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61630 invoked from network); 22 Apr 2010 19:59:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 19:59:23 -0000
Received: (qmail 56458 invoked by uid 500); 22 Apr 2010 19:59:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56429 invoked by uid 500); 22 Apr 2010 19:59:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56421 invoked by uid 99); 22 Apr 2010 19:59:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 19:59:21 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rpatel4@live.com designates 65.55.90.93 as permitted sender)
Received: from [65.55.90.93] (HELO snt0-omc2-s18.snt0.hotmail.com) (65.55.90.93)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 19:59:14 +0000
Received: from SNT128-W3 ([65.55.90.73]) by snt0-omc2-s18.snt0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 22 Apr 2010 12:58:53 -0700
Message-ID: <SNT128-W3892D8F32F4D67F4D898889080@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_2ec61f1d-9c3c-468c-a3c5-7b0f067e074f_"
X-Originating-IP: [131.107.0.96]
From: Ravi Patel <rpatel4@live.com>
To: <java-user@lucene.apache.org>
Subject: Indexing and Searching fields that have unique values
Date: Thu, 22 Apr 2010 15:58:53 -0400
Importance: Normal
MIME-Version: 1.0
X-OriginalArrivalTime: 22 Apr 2010 19:58:53.0561 (UTC) FILETIME=[3C069690:01CAE256]
X-Virus-Checked: Checked by ClamAV on apache.org

--_2ec61f1d-9c3c-468c-a3c5-7b0f067e074f_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


=20

Using Lucene.Net

=20

I've built an index of documents.

=20

The documents also have a unique identifier (my identifier=2C not the lucen=
e index's id).

The unique identifers are also a sort order of new-ness (higher id values a=
re newer)

=20

string my_id =3D"1234"

doc.Add(new Field("id"=2C my_id=2C Field.Store.YES=2C Field.Index.UN_TOKENI=
ZED))=3B

=20

Searching for a particular id=2C or range searches are incredibly slow

=20

=20

TermQuery query =3D new TermQuery(new Term("id"=2C "1234"))=3B

searcher.Search(query)

=20

=20

Any tips on how to speed up such an search?

=20

I'm also doing RangeSearches on lower / upper ids=2C and those are slow too
 		 	   		 =20
_________________________________________________________________
The New Busy is not the too busy. Combine all your e-mail accounts with Hot=
mail.
http://www.windowslive.com/campaign/thenewbusy?tile=3Dmultiaccount&ocid=3DP=
ID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_4=

--_2ec61f1d-9c3c-468c-a3c5-7b0f067e074f_--

From java-user-return-45898-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 20:14:18 2010
Return-Path: <java-user-return-45898-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71213 invoked from network); 22 Apr 2010 20:14:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 20:14:18 -0000
Received: (qmail 80579 invoked by uid 500); 22 Apr 2010 20:14:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80555 invoked by uid 500); 22 Apr 2010 20:14:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80547 invoked by uid 99); 22 Apr 2010 20:14:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 20:14:16 +0000
X-ASF-Spam-Status: No, hits=0.5 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 20:14:12 +0000
Received: by ywh38 with SMTP id 38so4691296ywh.29
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 13:13:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=PNgfHDc1Bb7aCIv9xeu6qCns+xQJP5njziB0l2XbrM0=;
        b=PuiDkkb+5gZzVqsrPmWf8+4ms/y0Bal3cSqAU7d59vTa1HiH8YFb6ZtPPJQmzVQwgz
         HAGxMRNfLZDD7ZmNrvfLZlDOoRBh46RDzzvkHvhh+WpU9TtdZuv8M8VTvo5JKfI0LBMf
         7Z3zQPTSnKNRFbisGMzSCv+3qQXqCwvynKw1Q=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=v/U52ERibYzYk9w9DJs8crqC/ajYfOheB9L8oOo/ChkyjWK3bxGyrR/3JxuU/ICCgP
         Ft4lAih8KAUCZTrqVuIoskzqFPWubxqlzJc07P1pnoimUyzwjHldTszIRQ9awdi6qdJu
         K0rxTYkB6NbTuMDKSIkktkb18msmefExyyTaI=
MIME-Version: 1.0
Received: by 10.150.199.5 with HTTP; Thu, 22 Apr 2010 13:13:51 -0700 (PDT)
In-Reply-To: <SNT128-W3892D8F32F4D67F4D898889080@phx.gbl>
References: <SNT128-W3892D8F32F4D67F4D898889080@phx.gbl>
Date: Thu, 22 Apr 2010 16:13:51 -0400
Received: by 10.151.89.36 with SMTP id r36mr10633808ybl.156.1271967231234; 
	Thu, 22 Apr 2010 13:13:51 -0700 (PDT)
Message-ID: <p2p359a92831004221313o95e190c4zce55bfe26441e7dd@mail.gmail.com>
Subject: Re: Indexing and Searching fields that have unique values
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd72a32fbd24a0484d8f237

--000e0cd72a32fbd24a0484d8f237
Content-Type: text/plain; charset=ISO-8859-1

You have to provide more info, especially the search code you're
using. How many documents in your index? What are you measuring?

Anything else you can think of that might help people diagnose
your issue.

Also, consider asking on the .Net user's list.

Known things to look for (in Java).
1> Are you re-opening an index reader each time? Don't
2> Are you sorting? If so, the first querie(s) will fill internal
   caches, this takes time. Time subsequent searches.

HTH
Erick

On Thu, Apr 22, 2010 at 3:58 PM, Ravi Patel <rpatel4@live.com> wrote:

>
>
>
> Using Lucene.Net
>
>
>
> I've built an index of documents.
>
>
>
> The documents also have a unique identifier (my identifier, not the lucene
> index's id).
>
> The unique identifers are also a sort order of new-ness (higher id values
> are newer)
>
>
>
> string my_id ="1234"
>
> doc.Add(new Field("id", my_id, Field.Store.YES, Field.Index.UN_TOKENIZED));
>
>
>
> Searching for a particular id, or range searches are incredibly slow
>
>
>
>
>
> TermQuery query = new TermQuery(new Term("id", "1234"));
>
> searcher.Search(query)
>
>
>
>
>
> Any tips on how to speed up such an search?
>
>
>
> I'm also doing RangeSearches on lower / upper ids, and those are slow too
>
> _________________________________________________________________
> The New Busy is not the too busy. Combine all your e-mail accounts with
> Hotmail.
>
> http://www.windowslive.com/campaign/thenewbusy?tile=multiaccount&ocid=PID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_4

--000e0cd72a32fbd24a0484d8f237--

From java-user-return-45899-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 22 21:09:48 2010
Return-Path: <java-user-return-45899-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2955 invoked from network); 22 Apr 2010 21:09:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Apr 2010 21:09:48 -0000
Received: (qmail 70974 invoked by uid 500); 22 Apr 2010 21:09:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70946 invoked by uid 500); 22 Apr 2010 21:09:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70938 invoked by uid 99); 22 Apr 2010 21:09:46 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 21:09:45 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jasonweiyi@gmail.com designates 209.85.219.221 as permitted sender)
Received: from [209.85.219.221] (HELO mail-ew0-f221.google.com) (209.85.219.221)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Apr 2010 21:09:38 +0000
Received: by ewy21 with SMTP id 21so2108818ewy.5
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 14:09:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:received:message-id
         :subject:from:to:content-type;
        bh=pg4tb9d0iPCt6Taz4bBpWZ3L7SgfAP+Fd6xQP91sZt4=;
        b=wnBoEm2caYS6gsD7VUW+SkYDd2OkX4izB9dwxGtgX9U0Zpknys+f6sHztKxSY/K83L
         UulcPyb/wVtSfOBaxALAnlHKrXyBi2uIr8dw+05XQuNAj9a6c8gAiQuesiidR17wa6x9
         DB7QyhpmqYN0POjxEMkfKKIi43ITscLXyCRSw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=uYwMqjv6HV3CCe5vMSU1UaSYGhPaRrP99nmum88hpRIuJfQhYCS+Qm8DDfR0yKy14N
         hCIXkU1LM1pdIcczxuXw977uZlrYNVVhn6/MtmTGOZaZugOl29iJLnkPHzHC30dDCZlb
         gT5tHkVp+jaQaquH62vzqeM9NRbqwYDnSh9Mk=
MIME-Version: 1.0
Received: by 10.103.198.20 with HTTP; Thu, 22 Apr 2010 14:09:17 -0700 (PDT)
Date: Thu, 22 Apr 2010 23:09:17 +0200
Received: by 10.102.213.23 with SMTP id l23mr2564817mug.131.1271970557934; 
	Thu, 22 Apr 2010 14:09:17 -0700 (PDT)
Message-ID: <u2q2da6bd811004221409jae770cd9p2abcf61662d042d8@mail.gmail.com>
Subject: It is possible to change the meaning of a match in lucene
From: Wei Yi <jasonweiyi@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636426851453b250484d9b962
X-Virus-Checked: Checked by ClamAV on apache.org

--001636426851453b250484d9b962
Content-Type: text/plain; charset=ISO-8859-1

Dear all,

I want to provide hierarchical matching in Lucene. For example,
in a document, there is a field and its value:

 transportation: vehicle

and suppose there is a class/subclass relationship saying that
car is a subclass of vehicle, and bus is a subclass of vehicle.

I want the query:
transportation: car
to match the document because car is a subclass of vehicle.

Is it possible to change the part where Lucene decide if a term is matched?
So I can take the subclass relationship into account?


Many thanks.
-- 
Jason Wei
Chair of Software Engineering, ETH Zurich

--001636426851453b250484d9b962--

From java-user-return-45900-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 23 04:17:24 2010
Return-Path: <java-user-return-45900-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33715 invoked from network); 23 Apr 2010 04:17:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Apr 2010 04:17:24 -0000
Received: (qmail 23966 invoked by uid 500); 23 Apr 2010 04:17:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23747 invoked by uid 500); 23 Apr 2010 04:17:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23739 invoked by uid 99); 23 Apr 2010 04:17:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Apr 2010 04:17:21 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Apr 2010 04:17:15 +0000
Received: by vws13 with SMTP id 13so3254108vws.35
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 21:16:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=bTMCXRIiMyfsJ7fJcU7Tj3TZDblR+EAr4UhU9tBl7p0=;
        b=YzC5H5mXyWMMl0D77F75ekzDFEuJVargrVPAgAMKZ/zHj7XDvnbHWe9RMtn0VGd7b4
         NYxwkjy1chP4xcm8gSSCWHYnBjzV6Ut0kM/gPi7nVmzzUNZ365U6ZlwQrdGnBQoJDKRw
         GMiCBPNNTKup6KWwgWSg73KhZ+OZf/e269+gc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=NvzHa0L/VpNZJoqxKM8K+35L1LaQiQ83dUmgrUNCEemEskIUuZwbtppt9zz5O5g7Wv
         H4Y6Lf4U24AjC/5ReH+nZ6RpOBDxQe/z6MJ3LMfNMan+FAxV/N802ut0yfxJt3Gqpuyz
         7hKI0gjMc8ox3thb6M3UuAZdyb3gIW3S4GoKI=
MIME-Version: 1.0
Received: by 10.220.73.135 with HTTP; Thu, 22 Apr 2010 21:16:34 -0700 (PDT)
In-Reply-To: <p2p359a92831004221313o95e190c4zce55bfe26441e7dd@mail.gmail.com>
References: <SNT128-W3892D8F32F4D67F4D898889080@phx.gbl> <p2p359a92831004221313o95e190c4zce55bfe26441e7dd@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Fri, 23 Apr 2010 09:46:34 +0530
Received: by 10.220.63.132 with SMTP id b4mr989285vci.173.1271996214169; Thu, 
	22 Apr 2010 21:16:54 -0700 (PDT)
Message-ID: <i2z867513fe1004222116rbe713d43y8ea108a9ced312fb@mail.gmail.com>
Subject: Re: Indexing and Searching fields that have unique values
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=e0cb4e88744780514f0484dfb276
X-Virus-Checked: Checked by ClamAV on apache.org

--e0cb4e88744780514f0484dfb276
Content-Type: text/plain; charset=ISO-8859-1

Hi Ravi,

Adding to what Erick said, you could do index the numbers as numeric fields
instead of strings. This should improve things for you by a considerable
amount.
P.S: I'm talking with my knowledge on Java Lucene.
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Apr 23, 2010 at 1:43 AM, Erick Erickson <erickerickson@gmail.com>wrote:

> You have to provide more info, especially the search code you're
> using. How many documents in your index? What are you measuring?
>
> Anything else you can think of that might help people diagnose
> your issue.
>
> Also, consider asking on the .Net user's list.
>
> Known things to look for (in Java).
> 1> Are you re-opening an index reader each time? Don't
> 2> Are you sorting? If so, the first querie(s) will fill internal
>   caches, this takes time. Time subsequent searches.
>
> HTH
> Erick
>
> On Thu, Apr 22, 2010 at 3:58 PM, Ravi Patel <rpatel4@live.com> wrote:
>
> >
> >
> >
> > Using Lucene.Net
> >
> >
> >
> > I've built an index of documents.
> >
> >
> >
> > The documents also have a unique identifier (my identifier, not the
> lucene
> > index's id).
> >
> > The unique identifers are also a sort order of new-ness (higher id values
> > are newer)
> >
> >
> >
> > string my_id ="1234"
> >
> > doc.Add(new Field("id", my_id, Field.Store.YES,
> Field.Index.UN_TOKENIZED));
> >
> >
> >
> > Searching for a particular id, or range searches are incredibly slow
> >
> >
> >
> >
> >
> > TermQuery query = new TermQuery(new Term("id", "1234"));
> >
> > searcher.Search(query)
> >
> >
> >
> >
> >
> > Any tips on how to speed up such an search?
> >
> >
> >
> > I'm also doing RangeSearches on lower / upper ids, and those are slow too
> >
> > _________________________________________________________________
> > The New Busy is not the too busy. Combine all your e-mail accounts with
> > Hotmail.
> >
> >
> http://www.windowslive.com/campaign/thenewbusy?tile=multiaccount&ocid=PID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_4
>

--e0cb4e88744780514f0484dfb276--

From java-user-return-45901-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 23 04:20:05 2010
Return-Path: <java-user-return-45901-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35039 invoked from network); 23 Apr 2010 04:20:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Apr 2010 04:20:05 -0000
Received: (qmail 30252 invoked by uid 500); 23 Apr 2010 04:20:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30133 invoked by uid 500); 23 Apr 2010 04:20:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30125 invoked by uid 99); 23 Apr 2010 04:20:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Apr 2010 04:20:02 +0000
X-ASF-Spam-Status: No, hits=0.1 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Apr 2010 04:19:56 +0000
Received: by vws13 with SMTP id 13so3255305vws.35
        for <java-user@lucene.apache.org>; Thu, 22 Apr 2010 21:19:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:received:message-id:subject:to:content-type;
        bh=r9o7ylAU/6pQ7u9hNOb6YpjaqWjewF/8a2Bj07zet98=;
        b=FHBFtR6sTKCd1usbCF/Av5hXH8OxVAodT59GaF+Vjla7pACxrz6ncVdNCrNnmRTqvb
         N9Q6ahfBJ4H7e5RUD8NgJ3obLaZ5v+0eRdJizrHd/LnPe+PhwJUB0NMDnmkNZQ8kt9+4
         HDf1B3LUEqQWFHSHqoiTWErvVKgZAUqKVTbyE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=CNctTPDxbMqRBdOnaVoA1TNyRYFfq14o71SnJ3y1g6S1C92Do8rb+mZxYUJN3iad/o
         /yTiIxzjhccQp2yx5s8V8D6hiAYFDmGTGwpESfaqdxUqg5nFL+btUXrbSNP01pCgiiv1
         6VBC9kp7dyPW1I7edZvaUj2ePMyu4fY/Ehchk=
MIME-Version: 1.0
Received: by 10.220.73.135 with HTTP; Thu, 22 Apr 2010 21:19:16 -0700 (PDT)
In-Reply-To: <u2q2da6bd811004221409jae770cd9p2abcf61662d042d8@mail.gmail.com>
References: <u2q2da6bd811004221409jae770cd9p2abcf61662d042d8@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Fri, 23 Apr 2010 09:49:16 +0530
Received: by 10.220.47.219 with SMTP id o27mr7534838vcf.69.1271996376153; Thu, 
	22 Apr 2010 21:19:36 -0700 (PDT)
Message-ID: <u2n867513fe1004222119yb0bcc59br66b57971118bd8e3@mail.gmail.com>
Subject: Re: It is possible to change the meaning of a match in lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e647615427fec40484dfbc45

--0016e647615427fec40484dfbc45
Content-Type: text/plain; charset=ISO-8859-1

Hi,

You'd need to either expand the query or index the documents in a manner
that they store the extra ontology related information. You may try going
for the later option in case your mappings change often, though it'd be slow
as you'd be adding more terms to the query.
You could try using something like a synonym analyzer while conducting
search in this case.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Apr 23, 2010 at 2:39 AM, Wei Yi <jasonweiyi@gmail.com> wrote:

> Dear all,
>
> I want to provide hierarchical matching in Lucene. For example,
> in a document, there is a field and its value:
>
>  transportation: vehicle
>
> and suppose there is a class/subclass relationship saying that
> car is a subclass of vehicle, and bus is a subclass of vehicle.
>
> I want the query:
> transportation: car
> to match the document because car is a subclass of vehicle.
>
> Is it possible to change the part where Lucene decide if a term is matched?
> So I can take the subclass relationship into account?
>
>
> Many thanks.
> --
> Jason Wei
> Chair of Software Engineering, ETH Zurich
>

--0016e647615427fec40484dfbc45--

From java-user-return-45902-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 23 20:48:38 2010
Return-Path: <java-user-return-45902-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94789 invoked from network); 23 Apr 2010 20:48:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Apr 2010 20:48:38 -0000
Received: (qmail 49908 invoked by uid 500); 23 Apr 2010 20:48:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49853 invoked by uid 500); 23 Apr 2010 20:48:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49845 invoked by uid 99); 23 Apr 2010 20:48:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Apr 2010 20:48:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.84] (HELO web32907.mail.mud.yahoo.com) (209.191.69.84)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 23 Apr 2010 20:48:26 +0000
Received: (qmail 50795 invoked by uid 60001); 23 Apr 2010 20:48:04 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272055684; bh=oKtbCN7sxG/vJdQwuE0zxGkc9SmjoffRJS4FWtpcgq8=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=16oP5d5tsNDOjSL1e3vCv3rUlgRxN5IfikIl9YnSgsJvhn88c4SOTn754w73hZw5P6FQq4m5Eua+f/dFOZDVvyMMApRhqiUw/KzTS8aPEPynPcsIogz2N3AB7J0R5wRZk7/8vFRrLlCgk4wN99xSKaHr6dF9E8DkitWrt9rYhsc=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=t6opFaNUBoDE+/4Nxwr5RdX9JKWO74CyUd3z/zAQAQ9gdwiRGMLaJJ7RbVu4WQXCuNmiDbZD6h7wRby+k6br8DH0/q/dfiMy01MzWZ2NhB24YN20YdD7iCEUuXxOWjPtOdU+aI/EzAOLK/Cfg3k94GsaXDH6nb+EJ1/WF9C1CJA=;
Message-ID: <43985.50280.qm@web32907.mail.mud.yahoo.com>
X-YMail-OSG: MC.UzWQVM1kpKVPxuDJoQWHcrNlr220syEKxIb12Y1IURc8
 0Y.u1g6ty.2tyTWgczOcg2oqIoJ9aMlog1rw2Y5Ifl9Ikk5aC39EgB5l8nb7
 _JkdpnjglEpE78glto85CMPFyIX_yVYxC6BrYqrqjhZGz9x9uVLStGX8U70b
 4.LbfY_k_koHCUoSWiylkjXQ9PkrL5OWEwOv87e2naSadfPa3QoBL9tWaC80
 eURcYFSHgeqNm4xXJBJHi55Tt4xwa5mxXlgnMPJ7cmEmgoblYhxR9PTYnHWT
 _r_reKhDN8kyNFqTvHMAiLhk75gUFzX2SQI4BKU6grM28ZQYJfXnmNZV_hn.
 8ZCDUZnNJ1i3kW4Y_KesP8fdZKS6F
Received: from [99.4.164.92] by web32907.mail.mud.yahoo.com via HTTP; Fri, 23 Apr 2010 13:48:03 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.102.267879
Date: Fri, 23 Apr 2010 13:48:03 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: HTMLStripReader, HTMLStripCharFilter
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Just out of curiousity, why does LUCENE-1377 have a minor priorty?

https://issues.apache.org/jira/browse/LUCENE-1377

Don't people index, filter, search HTML, perhaps more than any other format?

Looks like Solr has moved from a Reader to CharFilter:

http://lucene.apache.org/solr/api/org/apache/solr/analysis/HTMLStripCharFilter.html
https://svn.apache.org/repos/asf/lucene/dev/trunk/solr/src/java/org/apache/solr/analysis/HTMLStripCharFilter.java

If the Lucene developers prefer a contrib package or to keep such an extension in Solr, the issue should probably be closed.  I'm not sure I follow the discussion in JIRA as Solr developers can choose whether or not to use any class added to Lucene at any time after its addition.

Thanks for any feedback,
Justin


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45903-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 24 03:41:12 2010
Return-Path: <java-user-return-45903-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94891 invoked from network); 24 Apr 2010 03:41:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Apr 2010 03:41:12 -0000
Received: (qmail 95257 invoked by uid 500); 24 Apr 2010 03:41:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94996 invoked by uid 500); 24 Apr 2010 03:41:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94986 invoked by uid 99); 24 Apr 2010 03:41:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 03:41:09 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jvolkman@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 03:41:03 +0000
Received: by pwi7 with SMTP id 7so7520642pwi.35
        for <java-user@lucene.apache.org>; Fri, 23 Apr 2010 20:40:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=dFTpc7BipI5XGO68gWyGp9GuZYpT7mk6u6mHduzgcqM=;
        b=ThZWrvNilDcjgqw1jM5jmMz0S7vKJmz+sK3OwxKNeoyENIIUHUMad/qImaHNgyUMRv
         7iA9PHfyECEj2DwVwgkz/CHLIU550tX2zj2YB15sgWMOclZfdJhzzLxH6lDMn2yctcDb
         vasl1InHJczBOr2nWfVJKRi2PM98ZQy+JSl/4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=HLiho817qvgT8CXicrX0TbeiKGNy0QOx5spXSzE3JW0b/5FL3EHzVhIvCGpdbKornY
         5g8xAWRzIzrpXTpa4s9jGSlXn38Ed8VJMS36iePvbJTEWcaF+pcqQbicTH9aMwNL5R1W
         fbsl696I09zCbZ/ijcbTxA4qAl0wVEDFpRwXk=
MIME-Version: 1.0
Received: by 10.142.66.12 with SMTP id o12mr591259wfa.197.1272080442940; Fri, 
	23 Apr 2010 20:40:42 -0700 (PDT)
Received: by 10.142.201.4 with HTTP; Fri, 23 Apr 2010 20:40:42 -0700 (PDT)
Date: Fri, 23 Apr 2010 23:40:42 -0400
Message-ID: <m2ndccc2ca91004232040x20147396v9ffa4aec51f7a3f0@mail.gmail.com>
Subject: Base score to use for custom query?
From: Jeremy Volkman <jvolkman@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636e0a7d7ed5f7b0484f34e01

--001636e0a7d7ed5f7b0484f34e01
Content-Type: text/plain; charset=ISO-8859-1

I have a situation similar to the following that I'm trying to solve:

I have a field in my document that contains a range of numbers. Say, for
example, the universe of numbers is the range of integers from 0-100. My
field represents a subrange of those numbers in a token stream. So, for
example, if one document contains 20-30, it's token stream contains the
terms [20, 21, 22, ..., 29]. Now I can quickly find all documents that
contain some number.

The next part of the problem is searching for all documents that intersect
with some subrange of numbers. Somewhat like a range query, but not exactly.
Say I want to search for all documents that touch the range [10, 30]. My
original implementation was to simply create a BooleanQuery full of
TermQuerys for each term in the range i was searching for. While this
returned the proper results, it did so with skewed scores. I'd prefer
documents containing numbers towards the beginning of my search range to be
scored higher than docs towards the end. So, if I had two documents, one
with 10-20, and one with 20-30, and I searched for [19,30], both documents
would be returned, but the second would be much more highly scored due to
its higher number of matched terms.

So, my plan is to write a custom query which matches documents documents in
my range in a way such as:

for (term : queryRange) {
TermDocs td = searcher.termDocs(term);
while (td.next()) {
...
}
}

And for each document, set the score to some vale proportional to the
matching term's distance from the beginning of the queried range.

My question is: what score should I start at, and what score should I end
at? If i assume that all documents matching the first term in my queried
range have score scoreMax, and all documents matching the last term have
scoreMin, and all documents matching in-between terms have a score between
scoreMax and scoreMin proportional to where they fall within the range, what
should scoreMax and scoreMin be?

My current thought is to start with the value passed to my Weight's
normalize() method, and work down to 0.0.

Thanks,
Jeremy

--001636e0a7d7ed5f7b0484f34e01--

From java-user-return-45904-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 24 08:18:44 2010
Return-Path: <java-user-return-45904-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32145 invoked from network); 24 Apr 2010 08:18:44 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Apr 2010 08:18:44 -0000
Received: (qmail 82500 invoked by uid 500); 24 Apr 2010 08:18:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82203 invoked by uid 500); 24 Apr 2010 08:18:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82195 invoked by uid 99); 24 Apr 2010 08:18:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 08:18:41 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of koji@r.email.ne.jp designates 202.224.39.198 as permitted sender)
Received: from [202.224.39.198] (HELO mail2.asahi-net.or.jp) (202.224.39.198)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 08:18:33 +0000
Received: from koji-sekiguchi-no-macbook.local (w244069.ppp.asahi-net.or.jp [121.1.244.69])
	by mail2.asahi-net.or.jp (Postfix) with ESMTP id A2AE6A167F
	for <java-user@lucene.apache.org>; Sat, 24 Apr 2010 17:18:10 +0900 (JST)
Message-ID: <4BD2A942.7080706@r.email.ne.jp>
Date: Sat, 24 Apr 2010 17:18:10 +0900
From: Koji Sekiguchi <koji@r.email.ne.jp>
User-Agent: Thunderbird 2.0.0.24 (Macintosh/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local> <4BCCEF0A.5090501@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C9FA0B@copper.meg.local>
In-Reply-To: <A098673D2A673A43849164E87EB3B36101C9FA0B@copper.meg.local>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Steve,

 > is there a way to access a TermVector containing only matched terms,
 > or is my previous approach still the

So you want to access FieldTermStack, I understand.
The way to access it, I wrote it at previous mail:

> You cannot access FieldTermStack from FVH, but I think you
> can create it by your own. To know how to do it, please refer to
> FieldTermStackTest.java. To instantiate FieldTermStack, FieldQuery
> object is needed. And FieldQuery object can be obtained from FVH.
>
>   

Koji

-- 
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45905-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 24 14:03:30 2010
Return-Path: <java-user-return-45905-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57163 invoked from network); 24 Apr 2010 14:03:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Apr 2010 14:03:30 -0000
Received: (qmail 89500 invoked by uid 500); 24 Apr 2010 14:03:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89449 invoked by uid 500); 24 Apr 2010 14:03:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89441 invoked by uid 99); 24 Apr 2010 14:03:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 14:03:27 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of javacache@gmail.com designates 209.85.221.177 as permitted sender)
Received: from [209.85.221.177] (HELO mail-qy0-f177.google.com) (209.85.221.177)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 14:03:22 +0000
Received: by qyk7 with SMTP id 7so949611qyk.14
        for <java-user@lucene.apache.org>; Sat, 24 Apr 2010 07:03:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=8J0B5O2hnETlBhn8zSBYpgRjW9y5p15AFt5/MHYAYsY=;
        b=oSS9MkHsmCVPKIlvPQV3ilI/Q8Fgu10yNCDj/AjveNkDE8efznIFzCxH2USuiltZyc
         7kdDl8nGJzaatIWMLutT3OYbBQEoQKbYWbc12+Ah5M8gsq6B5WS2xpwv+MmKy8dIFg60
         nYlaRgtvFCie4rlc1Wd7BPEbQvCTVFtyQgan8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=nQNgUE2DcYexCl7X41//JbTJm5PLrJSalC2S3bXFFEkaDacFHaq/R/iGM3UlmZ2iTM
         HfFQqYSzk7yaCfrGol7EEE16p9wd1jmLQ6e9cA1wHuMK1X7pjks4pk5w/GqvEN3vjsyJ
         hw/9g1XQWsW+b9mTbIcHVqD6Iai+nynANRveM=
MIME-Version: 1.0
Received: by 10.229.192.68 with SMTP id dp4mr1721816qcb.36.1272117781629; Sat, 
	24 Apr 2010 07:03:01 -0700 (PDT)
Received: by 10.229.99.199 with HTTP; Sat, 24 Apr 2010 07:03:01 -0700 (PDT)
In-Reply-To: <k2p8766aaed1004220429uc244fc84ma5c5934a2651ea84@mail.gmail.com>
References: <g2v8766aaed1004220338u4fca33a7ya4c16fc86a018ab3@mail.gmail.com>
	 <k2o9ac0c6aa1004220411z4ae12992nf78d2943d4ec7fea@mail.gmail.com>
	 <k2p8766aaed1004220429uc244fc84ma5c5934a2651ea84@mail.gmail.com>
Date: Sat, 24 Apr 2010 22:03:01 +0800
Message-ID: <n2u738ff0911004240703m7c121f7dz385b837cc2e100d0@mail.gmail.com>
Subject: Re: Reopening a Searcher for each request
From: Ivan Liu <javacache@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e7efe7c8e550484fc005c

--0016361e7efe7c8e550484fc005c
Content-Type: text/plain; charset=GB2312
Content-Transfer-Encoding: quoted-printable

like this?
 public synchronized IndexSearcher newIndexSearcher() {
  try {
//   semaphore.acquire();
   if (null =3D=3D indexSearcher) {
    Directory directory =3D FSDirectory.open(new
File(Config.DB_DIR+"/rssindex"));
    indexSearcher =3D new IndexSearcher(IndexReader.open(directory, true));
   } else {
    IndexReader indexReader =3D indexSearcher.getIndexReader();
    IndexReader newIndexReader =3D indexReader.reopen();
    if (newIndexReader!=3DindexReader) {

     indexReader.close();
     indexSearcher.close();


     indexSearcher =3D new IndexSearcher(newIndexReader);
    }
   }
   return indexSearcher;
  } catch (CorruptIndexException e) {
   log.error(e.getMessage(),e);
   return null;
  } catch (IOException e) {
   log.error(e.getMessage(),e);
   return null;
  }finally{
//   semaphore.release();
  }
 }

2010/4/22 Samarendra Pratap <samarzone@gmail.com>

> Thanks Mike.
> That solved a query which was itching my mind for a long time.
>
> On Thu, Apr 22, 2010 at 4:41 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
> > It's the IndexReader that's costly to open/warm, so ideally it should
> > be opened once and shared.
> >
> > The Searchers do very little on construction so re-creating per query
> > should be OK.
> >
> > Mike
> >
> > On Thu, Apr 22, 2010 at 6:38 AM, Samarendra Pratap <samarzone@gmail.com=
>
> > wrote:
> > > Greetings to all.
> > >  I have read at so many places that we should not open a Searcher for
> > each
> > > request for the sake of performance, but I have always been wondering
> > > whether it is actually Searcher or Reader?
> > >
> > >  I have a group of index amounting to 23G which actually contains of
> > > different index directories. The structure is something like followin=
g
> > >
> > > Main directory
> > > |
> > > |_________ country1
> > > |                     |___ country1-time1 (actual index)
> > > |                     |___ country1-time2 (actual index)
> > > |                     |___ country1-time3 (actual index)
> > > |
> > > |_________ country2
> > >                     |___ country2-time1 (actual index)
> > >                     |___ country2-time2 (actual index)
> > >                     |___ country2-time3 (actual index)
> > >
> > >  When application starts I open IndexReaders on all of actual index
> > > directories (country1-time1, country1-tim2, .... country2-time3) and
> keep
> > > them in a pool.
> > >
> > >  At the time of search, IndexSearchers are created by selecting the
> > > appropriate IndexReaders from the pool. These IndexSearchers in turn
> are
> > > used to create a ParallelMultiSearcher. Constructors of IndexSearcher
> and
> > > ParallelMultiSearcher are run for every request.
> > >
> > >  Now I believe that creating a pool of ParallelMultiSearcher itself i=
s
> a
> > > good idea but* I wanted to know if reopening **IndexSearchers** will
> > really
> > > degrade performance irrespective of **IndexReaders** being opened
> once*.
> > >
> > > In my performance tests (which may not be very comprehensive) I didn'=
t
> > find
> > > any noticeable difference.
> > >
> > > Please throw some light.
> > >
> > >
> > > --
> > > Regards,
> > > Samar
> > >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
>
> --
> Regards,
> Samar
>



--=20
=B3=E5=C0=CB=B0=E5

my blog:=B3=E5=C0=CB=B0=E5 <http://chonglangban.appspot.com/>
my site:Keji Technology <http://kejiblog.appspot.com/>

--0016361e7efe7c8e550484fc005c--

From java-user-return-45906-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 24 14:03:53 2010
Return-Path: <java-user-return-45906-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57202 invoked from network); 24 Apr 2010 14:03:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Apr 2010 14:03:53 -0000
Received: (qmail 91279 invoked by uid 500); 24 Apr 2010 14:03:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91249 invoked by uid 500); 24 Apr 2010 14:03:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91241 invoked by uid 99); 24 Apr 2010 14:03:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 14:03:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.223.189 as permitted sender)
Received: from [209.85.223.189] (HELO mail-iw0-f189.google.com) (209.85.223.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 14:03:43 +0000
Received: by iwn27 with SMTP id 27so4365193iwn.5
        for <java-user@lucene.apache.org>; Sat, 24 Apr 2010 07:03:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=X4EYcvX7SmjooMZDOgyLW9KpeFewMuTeOOyNM2rtCEo=;
        b=pJ31DGHg9RxmH9pVYj5gmgR5JVX7fRqo1MxbjFkKMOTLN6nN37PMb2CmuXqmOqr1QV
         Z0ni3yKdnpqLO2XprCAaRW/6O2PF2xcU/gdtAu6iWzr86FTOy33UuZM6TKqDpazwCJ9K
         Dq/fiqarrrKLDgcJobJmUmSDbnmQCMRFx06YU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=TR3jY/1f6/0IKo419Fc/FpRdXJw7QrsNfi0YtOmubc8dQCiTRXdVlPxExQVs3UkgYB
         RPN61wFtEfLWxm4bTv7QKjNfe8RnY8fl7glkoH9NrTwlRLQaKh5Kbescx90fOklAFuQT
         JFk9SkOzZCaQZ4PgYfF8nEt7gATmeguszEu0U=
Received: by 10.231.79.196 with SMTP id q4mr473653ibk.50.1272117802118; Sat, 
	24 Apr 2010 07:03:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.154.79 with HTTP; Sat, 24 Apr 2010 07:03:02 -0700 (PDT)
In-Reply-To: <43985.50280.qm@web32907.mail.mud.yahoo.com>
References: <43985.50280.qm@web32907.mail.mud.yahoo.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Sat, 24 Apr 2010 10:03:02 -0400
Message-ID: <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com>
Subject: Re: HTMLStripReader, HTMLStripCharFilter
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485eaffd8b530690484fc01e2
X-Virus-Checked: Checked by ClamAV on apache.org

--001485eaffd8b530690484fc01e2
Content-Type: text/plain; charset=UTF-8

On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:

> Just out of curiousity, why does LUCENE-1377 have a minor priorty?
>
> https://issues.apache.org/jira/browse/LUCENE-1377
>
> Don't people index, filter, search HTML, perhaps more than any other
> format?
>
>
Rest assured we are working on this... but it unfortunately won't happen
overnight. First of all, the development of Lucene and Solr was merged such
that there is now one team working on this stuff. This way, both Solr and
Lucene developers can maintain this stuff.

There is now the practical issue to combine all Lucene and Solr analyzers
(not just the two components listed on that issue) into one package that can
then be used by both Lucene and Solr users:
https://issues.apache.org/jira/browse/LUCENE-2413

-- 
Robert Muir
rcmuir@gmail.com

--001485eaffd8b530690484fc01e2--

From java-user-return-45907-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 24 14:11:47 2010
Return-Path: <java-user-return-45907-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57940 invoked from network); 24 Apr 2010 14:11:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Apr 2010 14:11:47 -0000
Received: (qmail 96256 invoked by uid 500); 24 Apr 2010 14:11:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96206 invoked by uid 500); 24 Apr 2010 14:11:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96198 invoked by uid 99); 24 Apr 2010 14:11:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 14:11:45 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of javacache@gmail.com designates 209.85.221.177 as permitted sender)
Received: from [209.85.221.177] (HELO mail-qy0-f177.google.com) (209.85.221.177)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 14:11:39 +0000
Received: by qyk7 with SMTP id 7so957986qyk.14
        for <java-user@lucene.apache.org>; Sat, 24 Apr 2010 07:11:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=4zwrHp0q1hDY2P944HeQ7oUnIWMuITBuNsME5TBh8eY=;
        b=B+iUJJ1+gWsgShy8WaNn79v8O4EZUUtUhMIrb/KZjKJCEQ1FTF7D2SBGgL9+th1w+N
         PR2UarWe2Fd3syBtD+nNBXPOsevgEbSJ5q3eQfOwNLpTt3GR5VJpCi2xpWzVqP49l7m7
         +YtlwElq5P9aF/vmupOpSuUNmLOsCqS5gvcXA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=JvjjdcWEKXvs5zYFbU+e3nJidT0Ubmq8wCCIQEpThOBEKvh5F2CR5kdfQh08YOlyVD
         ln4E6nWfGdam2EJIE2JquGPllLr4MAjhb605tXSznZmcy1ZkBYlz8xLmxNCB/18QvT+m
         o1Cvh70SRPnGd2d/CWYU382wbtkHnpU7E+hFU=
MIME-Version: 1.0
Received: by 10.229.251.69 with SMTP id mr5mr1663484qcb.91.1272118276452; Sat, 
	24 Apr 2010 07:11:16 -0700 (PDT)
Received: by 10.229.99.199 with HTTP; Sat, 24 Apr 2010 07:11:16 -0700 (PDT)
In-Reply-To: <i2z867513fe1004222116rbe713d43y8ea108a9ced312fb@mail.gmail.com>
References: <SNT128-W3892D8F32F4D67F4D898889080@phx.gbl>
	 <p2p359a92831004221313o95e190c4zce55bfe26441e7dd@mail.gmail.com>
	 <i2z867513fe1004222116rbe713d43y8ea108a9ced312fb@mail.gmail.com>
Date: Sat, 24 Apr 2010 22:11:16 +0800
Message-ID: <r2s738ff0911004240711jf84a74efsd3e7bfeb7035b18d@mail.gmail.com>
Subject: Re: Indexing and Searching fields that have unique values
From: Ivan Liu <javacache@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b9120faf34e0484fc1dc3
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b9120faf34e0484fc1dc3
Content-Type: text/plain; charset=GB2312
Content-Transfer-Encoding: quoted-printable

I think Anshum is right=A1=A3
And may your range is too big and is sorting


2010/4/23 Anshum <anshumg@gmail.com>

> Hi Ravi,
>
> Adding to what Erick said, you could do index the numbers as numeric fiel=
ds
> instead of strings. This should improve things for you by a considerable
> amount.
> P.S: I'm talking with my knowledge on Java Lucene.
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Fri, Apr 23, 2010 at 1:43 AM, Erick Erickson <erickerickson@gmail.com
> >wrote:
>
> > You have to provide more info, especially the search code you're
> > using. How many documents in your index? What are you measuring?
> >
> > Anything else you can think of that might help people diagnose
> > your issue.
> >
> > Also, consider asking on the .Net user's list.
> >
> > Known things to look for (in Java).
> > 1> Are you re-opening an index reader each time? Don't
> > 2> Are you sorting? If so, the first querie(s) will fill internal
> >   caches, this takes time. Time subsequent searches.
> >
> > HTH
> > Erick
> >
> > On Thu, Apr 22, 2010 at 3:58 PM, Ravi Patel <rpatel4@live.com> wrote:
> >
> > >
> > >
> > >
> > > Using Lucene.Net
> > >
> > >
> > >
> > > I've built an index of documents.
> > >
> > >
> > >
> > > The documents also have a unique identifier (my identifier, not the
> > lucene
> > > index's id).
> > >
> > > The unique identifers are also a sort order of new-ness (higher id
> values
> > > are newer)
> > >
> > >
> > >
> > > string my_id =3D"1234"
> > >
> > > doc.Add(new Field("id", my_id, Field.Store.YES,
> > Field.Index.UN_TOKENIZED));
> > >
> > >
> > >
> > > Searching for a particular id, or range searches are incredibly slow
> > >
> > >
> > >
> > >
> > >
> > > TermQuery query =3D new TermQuery(new Term("id", "1234"));
> > >
> > > searcher.Search(query)
> > >
> > >
> > >
> > >
> > >
> > > Any tips on how to speed up such an search?
> > >
> > >
> > >
> > > I'm also doing RangeSearches on lower / upper ids, and those are slow
> too
> > >
> > > _________________________________________________________________
> > > The New Busy is not the too busy. Combine all your e-mail accounts wi=
th
> > > Hotmail.
> > >
> > >
> >
> http://www.windowslive.com/campaign/thenewbusy?tile=3Dmultiaccount&ocid=
=3DPID28326::T:WLMTAGL:ON:WL:en-US:WM_HMP:042010_4
> >
>



--=20
=B3=E5=C0=CB=B0=E5
my blog:=B3=E5=C0=CB=B0=E5 <http://chonglangban.appspot.com/>
my site:Keji Technology <http://kejiblog.appspot.com/>

--0016363b9120faf34e0484fc1dc3--

From java-user-return-45908-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Apr 24 16:25:55 2010
Return-Path: <java-user-return-45908-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68236 invoked from network); 24 Apr 2010 16:25:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Apr 2010 16:25:55 -0000
Received: (qmail 51951 invoked by uid 500); 24 Apr 2010 16:25:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51918 invoked by uid 500); 24 Apr 2010 16:25:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51907 invoked by uid 99); 24 Apr 2010 16:25:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 16:25:53 +0000
X-ASF-Spam-Status: No, hits=2.4 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_FONT_FACE_BAD,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.223.189 as permitted sender)
Received: from [209.85.223.189] (HELO mail-iw0-f189.google.com) (209.85.223.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Apr 2010 16:25:48 +0000
Received: by iwn27 with SMTP id 27so4438615iwn.5
        for <java-user@lucene.apache.org>; Sat, 24 Apr 2010 09:25:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=k9ME/B3/He0pj40hSPihD+uHW6t86gDCNYmGybR/AeM=;
        b=jdifdzbb2j3HMAIlL5imRn2DTHyFpjqY9hJdJxqoWWVVSSeXcMf2QehxBl6mjc6SSn
         LDxDshLWx6hIL+HMZssOYYvSgVN/spwnMPkocE5fTVMs9w++rN25MoaAzCj1Z8VIpe/F
         7ubifl6lqE87Jh14HOVOZnetAsVZn58LudAfo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=CyHsIy/uy1bLJg6oFIs9dCUo9i7jxtzMZw8qovOB6JACjpGGXgi5qEjTde86sbkqB4
         u2v2yx1kD8cDJzvuhUHeDXg4qU3ThZ8Is/HUC/TE0I3P/joeywmSjrCZwSXHYj5kh5Ji
         Cp0LQpq12rVn/Js16o21fSABFC/v85LgqZU7w=
Received: by 10.231.148.1 with SMTP id n1mr511208ibv.96.1272126327368; Sat, 24 
	Apr 2010 09:25:27 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Sat, 24 Apr 2010 09:25:12 -0700 (PDT)
In-Reply-To: <n2u738ff0911004240703m7c121f7dz385b837cc2e100d0@mail.gmail.com>
References: <g2v8766aaed1004220338u4fca33a7ya4c16fc86a018ab3@mail.gmail.com> 
	<k2o9ac0c6aa1004220411z4ae12992nf78d2943d4ec7fea@mail.gmail.com> 
	<k2p8766aaed1004220429uc244fc84ma5c5934a2651ea84@mail.gmail.com> 
	<n2u738ff0911004240703m7c121f7dz385b837cc2e100d0@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Sat, 24 Apr 2010 21:55:12 +0530
Message-ID: <h2j8766aaed1004240925xd88a98bfzb3baa0a59adb7add@mail.gmail.com>
Subject: Re: Reopening a Searcher for each request
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f64744da2d4b0484fdfd0d

--001485f64744da2d4b0484fdfd0d
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

No! It's not like this in my code. This code opens an IndexReader every tim=
e
I call newIndexSearcher().

In my code it is sometime like -


IndexReader[] irs;
// irs is a global array containing IndexReaders which are opened when the
application starts
.....
.....
IndexSearcher[] getIndexSearchers(IndexReader[] irs)
{
        IndexSearcher[] iss =3D new IndexSearcher[irs.length];
        for(int i=3D0;i<irs.length;i++)
        {
                iss[i] =3D new IndexSearcher(irs[i]);
                iss[i].setSimilarity(new MySimilarity(new
String[]{"contents"}));
        }
        return iss;
}

ParallelMultiSearcher getParallelMultiSearcher(<country and time related
parameters>) throws IOException
{
        // by checking country and time related parameters, correct element=
s
are chosen from complete array of IndexReaders (irs) to pass in the functio=
n
        for(int i=3D0;i<irs.length;i++)
        {
                if(<country and time related parameters match for current
value of "i">)
                {
                        return (new
ParallelMultiSearcher(getIndexSearchers((IndexReader[])irs[i])));
                }
        }

        // ideally this code should never be executed
        return (new
ParallelMultiSearcher(getIndexSearchers(prepareReaders(<country
and time related parameters>))));
}



2010/4/24 Ivan Liu <javacache@gmail.com>

> like this?
>  public synchronized IndexSearcher newIndexSearcher() {
>  try {
> //   semaphore.acquire();
>   if (null =3D=3D indexSearcher) {
>    Directory directory =3D FSDirectory.open(new
> File(Config.DB_DIR+"/rssindex"));
>    indexSearcher =3D new IndexSearcher(IndexReader.open(directory, true))=
;
>   } else {
>    IndexReader indexReader =3D indexSearcher.getIndexReader();
>    IndexReader newIndexReader =3D indexReader.reopen();
>    if (newIndexReader!=3DindexReader) {
>
>     indexReader.close();
>     indexSearcher.close();
>
>
>     indexSearcher =3D new IndexSearcher(newIndexReader);
>    }
>   }
>   return indexSearcher;
>  } catch (CorruptIndexException e) {
>   log.error(e.getMessage(),e);
>   return null;
>  } catch (IOException e) {
>   log.error(e.getMessage(),e);
>   return null;
>  }finally{
> //   semaphore.release();
>  }
>  }
>
> 2010/4/22 Samarendra Pratap <samarzone@gmail.com>
>
> > Thanks Mike.
> > That solved a query which was itching my mind for a long time.
> >
> > On Thu, Apr 22, 2010 at 4:41 PM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> > > It's the IndexReader that's costly to open/warm, so ideally it should
> > > be opened once and shared.
> > >
> > > The Searchers do very little on construction so re-creating per query
> > > should be OK.
> > >
> > > Mike
> > >
> > > On Thu, Apr 22, 2010 at 6:38 AM, Samarendra Pratap <
> samarzone@gmail.com>
> > > wrote:
> > > > Greetings to all.
> > > >  I have read at so many places that we should not open a Searcher f=
or
> > > each
> > > > request for the sake of performance, but I have always been wonderi=
ng
> > > > whether it is actually Searcher or Reader?
> > > >
> > > >  I have a group of index amounting to 23G which actually contains o=
f
> > > > different index directories. The structure is something like
> following
> > > >
> > > > Main directory
> > > > |
> > > > |_________ country1
> > > > |                     |___ country1-time1 (actual index)
> > > > |                     |___ country1-time2 (actual index)
> > > > |                     |___ country1-time3 (actual index)
> > > > |
> > > > |_________ country2
> > > >                     |___ country2-time1 (actual index)
> > > >                     |___ country2-time2 (actual index)
> > > >                     |___ country2-time3 (actual index)
> > > >
> > > >  When application starts I open IndexReaders on all of actual index
> > > > directories (country1-time1, country1-tim2, .... country2-time3) an=
d
> > keep
> > > > them in a pool.
> > > >
> > > >  At the time of search, IndexSearchers are created by selecting the
> > > > appropriate IndexReaders from the pool. These IndexSearchers in tur=
n
> > are
> > > > used to create a ParallelMultiSearcher. Constructors of IndexSearch=
er
> > and
> > > > ParallelMultiSearcher are run for every request.
> > > >
> > > >  Now I believe that creating a pool of ParallelMultiSearcher itself
> is
> > a
> > > > good idea but* I wanted to know if reopening **IndexSearchers** wil=
l
> > > really
> > > > degrade performance irrespective of **IndexReaders** being opened
> > once*.
> > > >
> > > > In my performance tests (which may not be very comprehensive) I
> didn't
> > > find
> > > > any noticeable difference.
> > > >
> > > > Please throw some light.
> > > >
> > > >
> > > > --
> > > > Regards,
> > > > Samar
> > > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> >
> > --
> > Regards,
> > Samar
> >
>
>
>
> --
> =E5=86=B2=E6=B5=AA=E6=9D=BF
>
> my blog:=E5=86=B2=E6=B5=AA=E6=9D=BF <http://chonglangban.appspot.com/>
> my site:Keji Technology <http://kejiblog.appspot.com/>
>



--=20
Regards,
Samar

--001485f64744da2d4b0484fdfd0d--

From java-user-return-45909-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Apr 25 10:03:26 2010
Return-Path: <java-user-return-45909-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46755 invoked from network); 25 Apr 2010 10:03:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Apr 2010 10:03:26 -0000
Received: (qmail 35769 invoked by uid 500); 25 Apr 2010 10:03:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35574 invoked by uid 500); 25 Apr 2010 10:03:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35566 invoked by uid 99); 25 Apr 2010 10:03:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 25 Apr 2010 10:03:23 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ssenecal.work@gmail.com designates 209.85.221.177 as permitted sender)
Received: from [209.85.221.177] (HELO mail-qy0-f177.google.com) (209.85.221.177)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 25 Apr 2010 10:03:15 +0000
Received: by qyk7 with SMTP id 7so239969qyk.14
        for <java-user@lucene.apache.org>; Sun, 25 Apr 2010 03:02:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=1jVRzaTC2INwBBPMvlDLFgwzXJ2ZN6x1E2Tu4stBEjA=;
        b=GjWy0g/EoB2jgvHOytZgWy+iX0b9vGBrdH1ttE2dwKkpm/Zgoxcya6RLiI2d9unpcN
         Tc1mnvqr+cHKNO12SxRMNTu49PgwWpleWkjMe+ZdH9uzVgtCsXfbotgCXwXOwyanvsau
         9vqZL4TZNbwcLw4JUyZM6A8TRRf+KcMXxRosY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=YS1A9f1w20E7TvAlTXVcRwHx6QksuDogLA9kShwRji8GIKjO+qpOvt0ZyNYUs+0/hV
         IEylrIA/8+04I5U9I7miTpA2XTHZ7LmrwbA4AnD47rVzQLWXFrCUg6eVY6gwOkBUvYCj
         x2DmtjWF83SB1bYqqe16ijWdhgXvagVZ7IhYI=
MIME-Version: 1.0
Received: by 10.229.97.147 with SMTP id l19mr2890018qcn.24.1272189773483; Sun, 
	25 Apr 2010 03:02:53 -0700 (PDT)
Received: by 10.229.74.81 with HTTP; Sun, 25 Apr 2010 03:02:53 -0700 (PDT)
Date: Sun, 25 Apr 2010 19:02:53 +0900
Message-ID: <l2s15060d5e1004250302wdb368630q1e1e8b0f924b298f@mail.gmail.com>
Subject: merge results from physically separate hosts
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Is there currently a way to take a query, run it on multiple hosts
containing different indexes, then merge the results from each host to
present to the user?  It looks like Solr can handle multiple hosts
supporting the same index, but my case requires each index to be
different.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45910-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 06:56:38 2010
Return-Path: <java-user-return-45910-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65503 invoked from network); 26 Apr 2010 06:56:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 06:56:38 -0000
Received: (qmail 86334 invoked by uid 500); 26 Apr 2010 06:56:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86058 invoked by uid 500); 26 Apr 2010 06:56:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86050 invoked by uid 99); 26 Apr 2010 06:56:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 06:56:32 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of harsh5f@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 06:56:24 +0000
Received: by gyf1 with SMTP id 1so6829335gyf.35
        for <java-user@lucene.apache.org>; Sun, 25 Apr 2010 23:56:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=SNnDmrGufA5NekwyFeWzFX0E2sxaAV/g3ORRbJXBVkY=;
        b=qKKIVwUX5iaFCisnuA/lCB6n4wJjwOoxIJGRjWObKvdAGIftMQC5U64UeL3AVtlzdg
         a7XVaDyDsBstUSDNXXPJiT1WCjN5Ba5n8OZ9kvnMAorrtfqFTIZbY8HcTN5BLipM9qB8
         C62OL4NYTZnt0jMErc6IRoqMh7omwRfn8+rfg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=jIn4L2YYy/KfK5NElHCYz/aCla0mMrkSGakYtxWrXnUdrykpeg9i8dzK4+2r0WU1Uw
         u+ds1znicGZx2+fZgVlrQWUB7j9IWwemq/aYNxi6IaOJZTTJFKEgPc/euZr0QAvVBnKQ
         CIjRTIm5AfBlVISy39MBnnQcW/G/oWL6n/50c=
MIME-Version: 1.0
Received: by 10.100.97.15 with SMTP id u15mr4753661anb.6.1272264963962; Sun, 
	25 Apr 2010 23:56:03 -0700 (PDT)
Received: by 10.100.12.19 with HTTP; Sun, 25 Apr 2010 23:56:03 -0700 (PDT)
Date: Mon, 26 Apr 2010 12:26:03 +0530
Message-ID: <k2n40f5ed301004252356k65aec997ocd0c9a73d87268c6@mail.gmail.com>
Subject: VM options for faster lucene search
From: Harsh Srivastava <harsh5f@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi all,

Please suggest VM options for faster lucene search for 23G index.
I am using lucene version 2.9.2 and java version 1.6 .

-- 
Er. Harsh Srivastava

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45911-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 07:11:47 2010
Return-Path: <java-user-return-45911-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72939 invoked from network); 26 Apr 2010 07:11:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 07:11:47 -0000
Received: (qmail 99318 invoked by uid 500); 26 Apr 2010 07:11:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98991 invoked by uid 500); 26 Apr 2010 07:11:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98983 invoked by uid 99); 26 Apr 2010 07:11:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 07:11:44 +0000
X-ASF-Spam-Status: No, hits=0.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 07:11:38 +0000
Received: by vws10 with SMTP id 10so1119375vws.35
        for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 00:11:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=v4LgVsKRmHba7wGsXK810Mln9hXxArfH7vE6+4I/VvQ=;
        b=JlpO2G9f4CfBjpTvNqNQEZ9NNqZNUjteltV0F021rjNYkK7PrWrcfxxMUgWo6Tipeu
         IO4hhimcppuCAbPpxqAod8dEx6x9dMqRrOpXF70GJBW/+zptZ0O56hJseSG0E6R58dK7
         rcxj7u5Qg8ab4zkdELKw043XBZW1P9iYRyzk0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=EUd3ETZ+DqPjN4ckZgEiB51aIr8r+CeThrt6pdmWicpGntyv0/riUl2fhMw38CoALE
         KdtnejAkaE+VVqiGNMBMRe7GUs876kInpxWBiNgKRj06Lq4iNZwKMy76gQo4SH/G+xzG
         d24ltcKEiyS1kJ4hH/BcjvtbZ8Uf3u31CI+2Q=
Received: by 10.220.108.73 with SMTP id e9mr2399231vcp.62.1272265877184; Mon, 
	26 Apr 2010 00:11:17 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.220.80.149 with HTTP; Mon, 26 Apr 2010 00:10:57 -0700 (PDT)
In-Reply-To: <k2n40f5ed301004252356k65aec997ocd0c9a73d87268c6@mail.gmail.com>
References: <k2n40f5ed301004252356k65aec997ocd0c9a73d87268c6@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Mon, 26 Apr 2010 12:40:57 +0530
Message-ID: <s2m867513fe1004260010g85d377dbo1ecb7bcc2cd7170f@mail.gmail.com>
Subject: Re: VM options for faster lucene search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485ece470ab731f04851e7ba0

--001485ece470ab731f04851e7ba0
Content-Type: text/plain; charset=ISO-8859-1

There are a few things you could do,
1. Run the JVM in server mode [-server]
2. Assign more RAM (in case you're running  a 64 bit architecture) (both
initial and max limit)



--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Mon, Apr 26, 2010 at 12:26 PM, Harsh Srivastava <harsh5f@gmail.com>wrote:

> Hi all,
>
> Please suggest VM options for faster lucene search for 23G index.
> I am using lucene version 2.9.2 and java version 1.6 .
>
> --
> Er. Harsh Srivastava
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485ece470ab731f04851e7ba0--

From java-user-return-45912-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 08:20:58 2010
Return-Path: <java-user-return-45912-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7505 invoked from network); 26 Apr 2010 08:20:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 08:20:57 -0000
Received: (qmail 53400 invoked by uid 500); 26 Apr 2010 08:20:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53196 invoked by uid 500); 26 Apr 2010 08:20:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53188 invoked by uid 99); 26 Apr 2010 08:20:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 08:20:54 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of harsh5f@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 08:20:47 +0000
Received: by ywh38 with SMTP id 38so6177448ywh.29
        for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 01:20:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=nvds1qmQinjZ3om9r0ZFXeSu/9tTieU/tJszeDUEW6M=;
        b=GC5Ucw6y8xObz1hNa/5bpdwcqSHKPknDnBo8slVTDWqmCKEhWJZszQCcGWz3uIr6tE
         AV2bylktLAAye8dHmYdcP9aNfEZf7xeeqIfTAlYluPPq34AF2UrCQJccQ+3fGG1ib/p+
         oIKedn2mYUglDz6Tn9D+azc3Qc4rBT5YU40n4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=iX2B60w8e8AfmFsiotKD2jyoQ/FV4rIkeI8cuhQ6l1wJ2oZ8x4PIiTqa6popUq5Cyt
         AcFRoFwbBUoKuercey5pJAEQ2e0S2TXiXTAYEMFZdEfE/LV4L89hB5opSU3GUufEJhrr
         oNcFhZk/iOQ2Pnb8a2x9+zK1G+KqXBXvFgkHw=
MIME-Version: 1.0
Received: by 10.101.136.33 with SMTP id o33mr4469373ann.63.1272270026162; Mon, 
	26 Apr 2010 01:20:26 -0700 (PDT)
Received: by 10.100.12.19 with HTTP; Mon, 26 Apr 2010 01:20:26 -0700 (PDT)
In-Reply-To: <s2m867513fe1004260010g85d377dbo1ecb7bcc2cd7170f@mail.gmail.com>
References: <k2n40f5ed301004252356k65aec997ocd0c9a73d87268c6@mail.gmail.com>
	 <s2m867513fe1004260010g85d377dbo1ecb7bcc2cd7170f@mail.gmail.com>
Date: Mon, 26 Apr 2010 13:50:26 +0530
Message-ID: <i2r40f5ed301004260120z540626ajab29a0559ac03d9@mail.gmail.com>
Subject: Re: VM options for faster lucene search
From: Harsh Srivastava <harsh5f@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

I am asking in terms of
http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp#PerformanceTu=
ning
VM oprions.

--=20
Er. Harsh Srivastava


On Mon, Apr 26, 2010 at 12:40 PM, Anshum <anshumg@gmail.com> wrote:
> There are a few things you could do,
> 1. Run the JVM in server mode [-server]
> 2. Assign more RAM (in case you're running =A0a 64 bit architecture) (bot=
h
> initial and max limit)
>
>
>
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Mon, Apr 26, 2010 at 12:26 PM, Harsh Srivastava <harsh5f@gmail.com>wro=
te:
>
>> Hi all,
>>
>> Please suggest VM options for faster lucene search for 23G index.
>> I am using lucene version 2.9.2 and java version 1.6 .
>>
>> --
>> Er. Harsh Srivastava
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45913-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 10:00:07 2010
Return-Path: <java-user-return-45913-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58229 invoked from network); 26 Apr 2010 10:00:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 10:00:07 -0000
Received: (qmail 49575 invoked by uid 500); 26 Apr 2010 10:00:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49295 invoked by uid 500); 26 Apr 2010 10:00:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49287 invoked by uid 99); 26 Apr 2010 10:00:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 10:00:04 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erik.hatcher@gmail.com designates 209.85.221.177 as permitted sender)
Received: from [209.85.221.177] (HELO mail-qy0-f177.google.com) (209.85.221.177)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 09:59:55 +0000
Received: by qyk7 with SMTP id 7so1505058qyk.14
        for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 02:59:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=zrZFhTuWHVdQnnxbBc8/Dxtc9aUTLHlK0wDx/6JtPk0=;
        b=BdNq7FJrYfaxVcNaLV2FRg8teqC37YOKlOfl+JiJNZIRuxfMaN5azMq9BZtXTApKxw
         dCLsab4VNmo6X9ApSDrmGi3dS2MFacBgVst9HM8IRrmVJ15XPAOBCcEvA74k4P4S6ieR
         x1pTijMYQ/bIfWt1XWLxJy/Qb54mo5dp6E+Sg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=ajruoZJshO0VXfc5T6WTcT2e5qX3HQiiL/ATZfdz6fwMWIAzsJl+hbTuFZBttfBsxh
         NaE5FC2prM2j7mkIWkYGDSXBzr+B+U5DZaCV9FiRMWdyeXevMcmP+ClsTjpUEqi48sf3
         ScFvTKc9XY9zZHf2JHp8G3aTFz1S7JQd02ahI=
Received: by 10.229.242.3 with SMTP id lg3mr4601262qcb.102.1272275974087;
        Mon, 26 Apr 2010 02:59:34 -0700 (PDT)
Received: from [10.0.1.69] (c-71-63-2-238.hsd1.va.comcast.net [71.63.2.238])
        by mx.google.com with ESMTPS id 21sm2216399qyk.9.2010.04.26.02.59.33
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 26 Apr 2010 02:59:33 -0700 (PDT)
Message-Id: <FD2CBD25-C482-4C8C-A6E6-DBEC891A5459@gmail.com>
From: Erik Hatcher <erik.hatcher@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <l2s15060d5e1004250302wdb368630q1e1e8b0f924b298f@mail.gmail.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: merge results from physically separate hosts
Date: Mon, 26 Apr 2010 05:59:32 -0400
References: <l2s15060d5e1004250302wdb368630q1e1e8b0f924b298f@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Solr's distributed search feature is about querying multiple indexes  
and merging the results. Different indexes, but same schema.

	Erik

On Apr 25, 2010, at 6:02 AM, Shaun Senecal wrote:

> Is there currently a way to take a query, run it on multiple hosts
> containing different indexes, then merge the results from each host to
> present to the user?  It looks like Solr can handle multiple hosts
> supporting the same index, but my case requires each index to be
> different.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45914-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 13:10:33 2010
Return-Path: <java-user-return-45914-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65961 invoked from network); 26 Apr 2010 13:10:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 13:10:33 -0000
Received: (qmail 73613 invoked by uid 500); 26 Apr 2010 13:10:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73437 invoked by uid 500); 26 Apr 2010 13:10:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73429 invoked by uid 99); 26 Apr 2010 13:10:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 13:10:30 +0000
X-ASF-Spam-Status: No, hits=0.6 required=10.0
	tests=AWL,SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 13:10:24 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Term offsets for highlighting
Date: Mon, 26 Apr 2010 10:09:33 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C9FBCD@copper.meg.local>
In-reply-to: <4BD2A942.7080706@r.email.ne.jp>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: AcrjhsFYu5miVCFuQImIHdZB0ODuLQBuiWtg
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local> <4BCCEF0A.5090501@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C9FA0B@copper.meg.local> <4BD2A942.7080706@r.email.ne.jp>
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <java-user@lucene.apache.org>

Hi Koji,

Thank you. I implemented a solution based on the FieldTermStackTest.java
and if I do a search like "iron ore" it matches iron or ore. The same is
true if I specify iron AND ore.

The termSetMap[0].value[0] =3D ore and termSetMap[0].value[1] =3D iron.

What am I missing in having a prhase match correctly?

Thanks,

Steve

------------------------------------------------------------------------
-------------------------------------------
FVH-based solution
------------------------------------------------------------------------
-------------------------------------------

public class FastVectorHitTermLocator {

    private FastVectorHighlighter fvh =3D null;
    private FieldQuery fq =3D null;

    public FastVectorHitTermLocator(Query query) {
        this.fvh =3D new FastVectorHighlighter(true,true);
        this.fq =3D fvh.getFieldQuery(query);
    }

    public ArrayList<KeyValuePair<Integer,Integer>> getHitOffsets(
            IndexReader reader, int docId, String fieldName) throws
IOException {

        ArrayList<KeyValuePair<Integer,Integer>> hitOffsets  =3D
                new ArrayList<KeyValuePair<Integer,Integer>>();

        FieldTermStack fts =3D new
FieldTermStack(reader,docId,fieldName,this.fq);

        TermInfo ti =3D null;
        while(!fts.isEmpty()) {
            ti =3D fts.pop();
            hitOffsets.add(
                    new KeyValuePair<Integer,Integer>(
                        ti.getStartOffset(),ti.getEndOffset()));
        }

        return hitOffsets;
    }
}

------------------------------------------------------------------------
---------------------------------------
Calling code
------------------------------------------------------------------------
---------------------------------------
String queryString =3D "\"iron ore\"";

QueryParser parser =3D new QueryParser(Version.LUCENE_30,"content",new
StandardAnalyzer(Version.LUCENE_30)));
Query query =3D parser.parse("queryStr");
StringBuilder sbHitPos =3D new StringBuilder();

        FastVectorHitTermLocator tagger =3D new
FastVectorHitTermLocator(query);
     =20
        ArrayList<KeyValuePair<Integer,Integer>> tags =3D=20
=20
tagger.getHitOffsets(this._midxSearcher.getIndexReader(), pintDocId,
fieldName);










-----Original Message-----
From: Koji Sekiguchi [mailto:koji@r.email.ne.jp]=20
Sent: Saturday, April 24, 2010 5:18 AM
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting

Hi Steve,

 > is there a way to access a TermVector containing only matched terms,
 > or is my previous approach still the

So you want to access FieldTermStack, I understand.
The way to access it, I wrote it at previous mail:

> You cannot access FieldTermStack from FVH, but I think you
> can create it by your own. To know how to do it, please refer to
> FieldTermStackTest.java. To instantiate FieldTermStack, FieldQuery
> object is needed. And FieldQuery object can be obtained from FVH.
>
>  =20

Koji

--=20
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45915-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 14:23:46 2010
Return-Path: <java-user-return-45915-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9144 invoked from network); 26 Apr 2010 14:23:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 14:23:46 -0000
Received: (qmail 36996 invoked by uid 500); 26 Apr 2010 13:55:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36931 invoked by uid 500); 26 Apr 2010 13:55:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36923 invoked by uid 99); 26 Apr 2010 13:55:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 13:55:44 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of koji@r.email.ne.jp designates 202.224.39.197 as permitted sender)
Received: from [202.224.39.197] (HELO mail1.asahi-net.or.jp) (202.224.39.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 13:55:36 +0000
Received: from koji-sekiguchi-no-macbook.local (w244069.ppp.asahi-net.or.jp [121.1.244.69])
	by mail1.asahi-net.or.jp (Postfix) with ESMTP id DCF95A4166
	for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 22:55:14 +0900 (JST)
Message-ID: <4BD59B43.9060409@r.email.ne.jp>
Date: Mon, 26 Apr 2010 22:55:15 +0900
From: Koji Sekiguchi <koji@r.email.ne.jp>
User-Agent: Thunderbird 2.0.0.24 (Macintosh/20100228)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local> <4BCCEF0A.5090501@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C9FA0B@copper.meg.local> <4BD2A942.7080706@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C9FBCD@copper.meg.local>
In-Reply-To: <A098673D2A673A43849164E87EB3B36101C9FBCD@copper.meg.local>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Stephen Greene wrote:
> Hi Koji,
>
> Thank you. I implemented a solution based on the FieldTermStackTest.java
> and if I do a search like "iron ore" it matches iron or ore. The same is
> true if I specify iron AND ore.
>
> The termSetMap[0].value[0] = ore and termSetMap[0].value[1] = iron.
>
> What am I missing in having a prhase match correctly?
>
> Thanks,
>
> Steve
>
>   
Hi Steve,

Ah, I was wrong. I should say FieldPhraseList, not FieldTermStack.
Please refer to Step 3 in Algorithm section of the following Javadoc:

http://hudson.zones.apache.org/hudson/job/Lucene-trunk/javadoc/contrib-highlighter/org/apache/lucene/search/vectorhighlight/package-summary.html

Koji

-- 
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45916-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 15:05:09 2010
Return-Path: <java-user-return-45916-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24459 invoked from network); 26 Apr 2010 15:05:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 15:05:09 -0000
Received: (qmail 39773 invoked by uid 500); 26 Apr 2010 15:05:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39723 invoked by uid 500); 26 Apr 2010 15:05:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39715 invoked by uid 99); 26 Apr 2010 15:05:06 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 15:05:06 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 15:04:58 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id A923D312E0
	for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 17:04:33 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id 96B7931251
	for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 17:04:33 +0200 (CEST)
Received: from [IPv6:::1] (dave.dfki.uni-sb.de [134.96.184.220])
	by mail.dfki.de (Postfix) with ESMTP id 7912031117
	for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 17:04:33 +0200 (CEST)
Message-Id: <627714B4-977C-42F5-99DC-A0BA24CEB8F1@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: an analyzer map at hand?
Date: Mon, 26 Apr 2010 17:04:33 +0200
X-Mailer: Apple Mail (2.936)


Hello Luceners,

I am sure I'm not the only one having such a snippet in my dedicated  
analyzer:

         m.put("en", new SnowballAnalyzer("English"));
         m.put("es", new SnowballAnalyzer("Spanish"));
         m.put("de", new SnowballAnalyzer("German"));
         m.put("dk", new SnowballAnalyzer("Danish"));
         m.put("fi", new SnowballAnalyzer("Finnish"));
         m.put("fr", new SnowballAnalyzer("French"));
         m.put("hu", new SnowballAnalyzer("Hungarian"));
         m.put("it", new SnowballAnalyzer("Italian"));
         m.put("no", new SnowballAnalyzer("Norwegian"));
         m.put("nl", new SnowballAnalyzer("Dutch"));
         m.put("pt", new SnowballAnalyzer("Portuguese"));
         m.put("ro", new SnowballAnalyzer("Romanian"));
         m.put("ru", new SnowballAnalyzer("Russian"));
         m.put("sv", new SnowballAnalyzer("Swedish"));
         m.put("tr", new SnowballAnalyzer("Turkish"));
         m.put("default", new StandardAnalyzer());

is this something that is shared somewhere?
(I know everyone has its own favorites).
thanks in advance
paul

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45917-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 16:06:26 2010
Return-Path: <java-user-return-45917-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51377 invoked from network); 26 Apr 2010 16:06:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 16:06:26 -0000
Received: (qmail 61708 invoked by uid 500); 26 Apr 2010 16:06:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61557 invoked by uid 500); 26 Apr 2010 16:06:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61549 invoked by uid 99); 26 Apr 2010 16:06:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 16:06:23 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.212.176 as permitted sender)
Received: from [209.85.212.176] (HELO mail-px0-f176.google.com) (209.85.212.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 16:06:18 +0000
Received: by pxi10 with SMTP id 10so1956744pxi.35
        for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 09:05:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=QnCCPJJY6RiqufT56lmqBIGhMr2x96V1dOHq/DLDFAo=;
        b=Kye3mDd7d4Uq8lNV9+J/jd66J02iVisokmVyiyVU9Kd+QFL19FZVcpUUbP0FZULcAh
         DCqXrn6J7JSpv038hr+cx7KKJh4eo8Hi4LOnV5XFchjcKaVnJ1w+vK1MpULL4lVpCQTe
         b7y9JVVssmnjP8T8/FPiqJaN5G19Z4rE6Hr1U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Pjaepa1wt9U8ozb+R6igwItL+eDnxG7A1k5u/P0ZKq7PxAUgx2uRyPSTc4EJUOAsSL
         y9efDM/VM1JJORHKAUwlBfUgHEY5R/m0QXWarF+ZaTYyh4WKJEZuDzoNYzva/xXfUp3e
         4ZAvzwF5TVSzDSiM5H5waC/SW63RDyJPStZYw=
Received: by 10.141.188.4 with SMTP id q4mr3986478rvp.147.1272297957605; Mon, 
	26 Apr 2010 09:05:57 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.154.79 with HTTP; Mon, 26 Apr 2010 09:05:37 -0700 (PDT)
In-Reply-To: <627714B4-977C-42F5-99DC-A0BA24CEB8F1@activemath.org>
References: <627714B4-977C-42F5-99DC-A0BA24CEB8F1@activemath.org>
From: Robert Muir <rcmuir@gmail.com>
Date: Mon, 26 Apr 2010 12:05:37 -0400
Message-ID: <h2r8f0ad1f31004260905r5696d60dt4cb5f07b0fa4d8e3@mail.gmail.com>
Subject: Re: an analyzer map at hand?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd1aa3ecfc269048525f3b5

--000e0cd1aa3ecfc269048525f3b5
Content-Type: text/plain; charset=UTF-8

On Mon, Apr 26, 2010 at 11:04 AM, Paul Libbrecht <paul@activemath.org>wrote:

>
> is this something that is shared somewhere?
> (I know everyone has its own favorites).
> thanks in advance
>

Not really, in general its a little bit more organized in lucene trunk
though. Analyzers and snowball were merged, and analyzers are just organized
by language... (if they use snowball its an implementation detail).

You can see this here:
https://svn.apache.org/repos/asf/lucene/dev/trunk/lucene/contrib/analyzers/common/src/java/org/apache/lucene/analysis/

Shai Erera mentioned a while ago the idea of having a method to get the most
suitable analyzer for a given Locale... this is similar to your idea of a
map, but would give some more flexibility...

-- 
Robert Muir
rcmuir@gmail.com

--000e0cd1aa3ecfc269048525f3b5--

From java-user-return-45918-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 20:15:42 2010
Return-Path: <java-user-return-45918-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98846 invoked from network); 26 Apr 2010 20:15:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 20:15:42 -0000
Received: (qmail 54854 invoked by uid 500); 26 Apr 2010 20:15:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54821 invoked by uid 500); 26 Apr 2010 20:15:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54813 invoked by uid 99); 26 Apr 2010 20:15:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 20:15:39 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,URIBL_RED
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 26 Apr 2010 20:15:32 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id 872D81E6330; Mon, 26 Apr 2010 13:15:11 -0700 (MST)
Received: from PHX-HTPRD-01.adprod.bmc.com (phx-htprd-01.adprod.bmc.com [172.24.32.7])
	by flicker.bmc.com (Postfix) with ESMTP id 7E8071E6326
	for <java-user@lucene.apache.org>; Mon, 26 Apr 2010 13:15:11 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-01.adprod.bmc.com ([172.24.32.7]) with mapi; Mon, 26 Apr 2010
 14:15:11 -0600
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 26 Apr 2010 14:14:48 -0600
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: AcrcFHIZ+iyV4XwzQQKCEP0nIO63wwJY06Ug
Message-ID: <492379B6AA909E4FAF672AACCA0EADC25CC066FD36@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <j2o9ac0c6aa1004011621mb74b995by3aec6e3178dd3c4b@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC24A40EE9E3D@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
	 <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
 <n2w9ac0c6aa1004141352s5edb3082o2f1952626c551450@mail.gmail.com>
In-Reply-To: <n2w9ac0c6aa1004141352s5edb3082o2f1952626c551450@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
x-cr-hashedpuzzle: AuBg A6W4 EtKV FMTI FtWP GEgx GkrQ G2WN HQF/ IBVM IrtW
 JjnJ KIKl K1u9 LPqw
 Lk9T;1;agBhAHYAYQAtAHUAcwBlAHIAQABsAHUAYwBlAG4AZQAuAGEAcABhAGMAaABlAC4AbwByAGcA;Sosha1_v1;7;{A297BE16-14AD-401D-90C4-000859962D1F};cgBvAHMAcwBfAHcAbwBvAGwAZgBAAGIAbQBjAC4AYwBvAG0A;Mon,
 26 Apr 2010 20:14:48
 GMT;UgBFADoAIABJAG4AZABlAHgAVwByAGkAdABlAHIAIABhAG4AZAAgAG0AZQBtAG8AcgB5ACAAdQBzAGEAZwBlAA==
x-cr-puzzleid: {A297BE16-14AD-401D-90C4-000859962D1F}
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

We are still plagued by this issue.  I tried applying the patch mentioned b=
ut this did not resolve the issue. =20

I once tried to attach images from the heap dump to send out to the group b=
ut the server removed them so I have posted the images on a public service =
with links this time.  I would appreciate someone looking at them to see if=
 they provide any insight into what is occurring with this issue.

When you follow the link click on the image and then once you see the image=
 click on a link in the lower left hand corner that says "View Raw Image." =
 This will let you view the images at 100% resolution.

This first image shows what we are seeing within VisualVM in regards to the=
 memory.  As you can see, over time the memory gets consumed.  Finally we a=
re at a point where there is no more memory available. =20
Graph
http://tinypic.com/view.php?pic=3D2ltk0h3&s=3D5

This second image in VisualVM shows the classes sorted by size.  As you can=
 see, about 70% of all memory is consumed in the bytes array. =20
Bytes
http://tinypic.com/view.php?pic=3Ds10mqs&s=3D5

This third image is where the real info is.  This is where one of the bytes=
 is being examined and the option to go to nearest GC is chosen.  What you =
see here is what the majority of the bytes show if selected, so this one is=
 representative of most all.  As you can see this one byte is associated wi=
th the index writer as you look at the chain of objects (and thus so too ar=
e all the other bytes that have not been released for GC). =20
Garbage Collection
http://tinypic.com/view.php?pic=3D5obalj&s=3D5

I'm hoping that as you look at this that it might mean something to you or =
give you a clue as to what is holding on to all the memory.

Now the mysterious thing in all of this is that our use of Lucene has been =
developed into a "plug-in" that we use within an application that we have. =
 If I just run JUnit tests around this plugin, indexing some of the same fi=
les that the actual application is indexing, I cannot ever get the memory l=
oss in my dev environment.  Everything seems to work as expected.  However,=
 once we are in our real situation, then we see this behavior.  Because of =
this I would expect that the problem lays with the application, but once we=
 examine the heap dumps it then goes back to showing that the consumed byte=
s are "owned" by the index writer process.  It makes no sense to me that we=
 see this as we do, but none the less we do.  We see that the Index Writer =
process is hanging onto a lot of data in byte arrays and it doesn't ever se=
am to release it.

In addition, we would love to show this to someone via a webex if that woul=
d help in seeing what is going on. =20

Please, any help appreciated and any suggestions on how to resolve or even =
troubleshoot.  I can provide an actual heap dump but it is 63mb in size (co=
mpressed) so we would need to work out some FTP where we can provide it if =
someone is willing to look at it in VisualVM (or any other profiling tool).

BTW - If we open and close the index writer on a regular basis then we don'=
t run into this problem.  It is only when we run continuously with an open =
index writer that we do see this problem (we altered the code to open/close=
 the writer a lot, but this slows things down, so we don't want to run like=
 this, but we wanted to test the behavior if we did so).=20

Thanks,
Ross=20

-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]=20
Sent: Wednesday, April 14, 2010 2:52 PM
To: java-user@lucene.apache.org
Subject: Re: IndexWriter and memory usage

Run this:

    svn co https://svn.apache.org/repos/asf/lucene/java/branches/lucene_2_9
lucene.29x

Then apply the patch, then, run "ant jar-core", and in that should
create the lucene-core-2.9.2-dev.jar.

Mike

On Wed, Apr 14, 2010 at 1:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> How do I get to the 2.9.x branch? =A0Every link I take from the Lucene si=
te takes me to the trunk which I assume is the 3.x version. =A0I've tried t=
o look around svn but can't find anything labeled 2.9.x. =A0Is there a dail=
y build of 2.9.x or do I need to build it myself. =A0I would like to try ou=
t the fix you put into it, but I'm not sure where I get it from.
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Wednesday, April 14, 2010 4:12 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> It looks like the mailing list software stripped your image attachments..=
.
>
> Alas these fixes are only committed on 3.1.
>
> But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
> fix. =A0I think the other issue was part of LUCENE-2074 (though this
> issue included many other changes) -- Uwe can you peel out just a
> 2.9.x patch for resetting JFlex's zzBuffer?
>
> You could also try switching analyzers (eg to WhitespaceAnalyzer) to
> see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
> uses JFlex) is [part of] your problem.
>
> Mike
>
> On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> Since the heap dump was so big and can't be attached, I have taken a few=
 screen shots from Java VisualVM of the heap dump. =A0In the first image yo=
u can see that at the time our memory has become very tight most of it is h=
eld up in bytes. =A0In the second image I examine one of those instances an=
d navigate to the nearest garbage collection root. =A0In looking at very ma=
ny of these objects, they all end up being instantiated through the IndexWr=
iter process.
>>
>> This heap dump is the same one correlating to the infoStream that was at=
tached in a prior message. =A0So while the infoStream shows the buffer bein=
g flushed, what we experience is that our memory gets consumed over time by=
 these bytes in the IndexWriter.

>>
>> I wanted to provide these images to see if they might correlate to the f=
ixes mentioned below. =A0Hopefully those fixes mentioned below have rectifi=
ed this problem. =A0And as I state in the prior message, I'm hoping these f=
ixes are in a 2.9x branch and hoping for someone to point me to where I can=
 get those fixes to try out.
>>
>> Thanks
>>
>> -----Original Message-----
>> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
>> Sent: Tuesday, April 13, 2010 1:29 PM
>> To: java-user@lucene.apache.org
>> Subject: RE: IndexWriter and memory usage
>>
>> Are these fixes in 2.9x branch? =A0We are using 2.9x and can't move to 3=
x just yet. =A0If so, where do I specifically pick this up from?
>>
>> -----Original Message-----
>> From: Lance Norskog [mailto:goksron@gmail.com]
>> Sent: Monday, April 12, 2010 10:20 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> There is some bugs where the writer data structures retain data after
>> it is flushed. They are committed as of maybe the past week. If you
>> can pull the trunk and try it with your use case, that would be great.
>>
>> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> I was on vacation last week so just getting back to this... =A0Here is =
the info stream (as an attachment). =A0I'll see what I can do about reducin=
g the heap dump (It was supplied by a colleague).
>>>
>>>
>>> -----Original Message-----
>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>> Sent: Saturday, April 03, 2010 3:39 AM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> Hmm why is the heap dump so immense? =A0Normally it contains the top N
>>> (eg 100) object types and their count/aggregate RAM usage.
>>>
>>> Can you attach the infoStream output to an email (to java-user)?
>>>
>>> Mike
>>>
>>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>>> I have this and the heap dump is 63mb zipped. =A0The info stream is mu=
ch smaller (31 kb zipped), but I don't know how to get them to you.
>>>>
>>>> We are not using the NRT readers
>>>>
>>>> -----Original Message-----
>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>> Sent: Thursday, April 01, 2010 5:21 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Re: IndexWriter and memory usage
>>>>
>>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>>
>>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, i=
t
>>>> does allocate and then recycle this RAM buffer, so even in an idle
>>>> state (having indexed enough docs to fill up the RAM buffer at least
>>>> once) it'll hold onto those 16 MB.
>>>>
>>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>>> really sure you're eventually closing the previous reader after
>>>> opening a new one?
>>>>
>>>> Mike
>>>>
>>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>>> We are seeing a situation where the IndexWriter is using up the Java =
Heap space and only releases memory for garbage collection upon a commit. =
=A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene=
 2.9.1. We are set at heap size of 512 mb.
>>>>>
>>>>> We have a large number of documents that are run through Tika and the=
n added to the index. =A0The data from Tika is changed to a string, and the=
n sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classes=
 and not in Tika. =A0Our intent is to only perform a commit once the entire=
 indexing run is complete, but several hours into the process everything co=
mes to a crawl. =A0In using both JConsole and VisualVM =A0we can see that t=
he heap space is maxed out and garbage collection is not able to clean up a=
ny memory once we get into this state. =A0It is our understanding that the =
IndexWriter should be only holding onto 16 mb of data before it flushes it,=
 but what we are seeing is that while it is in fact writing data to disk wh=
en it hits the 16 mb limit, it is also holding onto some data in memory and=
 not allowing garbage collection to take place, and this continues until ga=
rbage collection is unable to free up enough space to all things to move fa=
ster than a crawl.
>>>>>
>>>>> As a test we caused a commit to occur after each document is indexed =
and we see the total amount of memory reduced from nearly 100% of the Java =
Heap to around 70-75%. =A0The profiling tools now show that the memory is c=
leaned up to some extent after each document. =A0But of course this complet=
ely defeats the whole reason why we want to only commit at the end of the r=
un for performance sake. =A0Most of the data, as seen using Heap analasis, =
is held in Byte, Character, and Integer classes whos GC roots are tied back=
 to the Writer Objects and threads. =A0The instance counts, after running j=
ust 1,100 documents seems staggering
>>>>>
>>>>> Is there additional data that the IndexWriter hangs onto regardless o=
f when it hits the RAMBufferSize limit? =A0Why are we seeing the heap space=
 all being used up?
>>>>>
>>>>> A side question to this is the fact that we always see a large amount=
 of memory used by the IndexWriter even after our indexing has been complet=
ed and all commits have taken place (basically in an idle state). =A0Why wo=
uld this be? =A0Is the only way to totally clean up the memory is to close =
the writer? =A0Our index is also used for real time indexing so the IndexWr=
iter is intended to remain open for the lifetime of the app.
>>>>>
>>>>> Any help in understanding why the IndexWriter is maxing out our heap =
space or what is expected from memory usage of the IndexWriter would be app=
reciated.
>>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>>
>>
>> --
>> Lance Norskog
>> goksron@gmail.com
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45919-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Apr 26 23:16:29 2010
Return-Path: <java-user-return-45919-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5592 invoked from network); 26 Apr 2010 23:16:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Apr 2010 23:16:29 -0000
Received: (qmail 44386 invoked by uid 500); 26 Apr 2010 23:16:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44350 invoked by uid 500); 26 Apr 2010 23:16:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44342 invoked by uid 99); 26 Apr 2010 23:16:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Apr 2010 23:16:27 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.80] (HELO web32903.mail.mud.yahoo.com) (209.191.69.80)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 26 Apr 2010 23:16:18 +0000
Received: (qmail 54013 invoked by uid 60001); 26 Apr 2010 23:15:56 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272323756; bh=pObg8iMsON94Sz9eANkfFmZft0pxgFFxpWaIwFyrH+w=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=pJV+RiRjOT42tIkYD7wPsZK34eD/lTaRAtc+p9e4O62XLJF+wV0XNS/PWcYSzEUZiAFzcjw3cOx99qXS/09CF522lceqbTCLFRWUjLKoNNexseLBApzfI/083G76Eejxb2eldGtuuZSb5198PyoR3SsuqTbvDCCkSi5RFUPKSzA=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=QO664fF9jZQc0u9YwaM/6WJQ1A5gK9exRYk/3WO/zm1vgoU2qQlqtihGU7A18R63tm91yJ1r000o5pDWr0AxIi9lbZcF67pYtpjqScsEIB0IdGS+a5bp0/9nDybLIk9ue/7XyXkFgxO3ppHnwJK9kpgqvhMK9R94KFjoTV+LLss=;
Message-ID: <111835.48056.qm@web32903.mail.mud.yahoo.com>
X-YMail-OSG: lG37qRoVM1mNIzVW1Si8rxKVQ3QQjccidxsEUvFAJt_BXO_
 vsu2LP8TwDtAhCrUQnqKpim8vuV82hE7r6vBVSSs2S8VcZq61GCMRtpIaABm
 _yASWkk13Hro6bDQRvp6bXvK.5u9LY.Y7ln2bsWpor8CXFHy8i5hNf_ho_xz
 d4zO8K7XfI_j1iL32V4.QVZ5DhW3l3Xr.1W0IteMdxkS.l6kR32ptxrQgnPk
 CZL8oAIEoldGmOZdW5XvkY7hnElHcs9vx30yclC62lAYfqZSi3JEPWXjZQ9X
 XgMJclcO0NUKh5EZEx0oQcLmQI06yQcWuO6I4R.ndqV3P0PhG07tJlcO3L.W
 C2i6fYfea6uyo3UNaB1WLu.H6Jg--
Received: from [72.36.94.20] by web32903.mail.mud.yahoo.com via HTTP; Mon, 26 Apr 2010 16:15:56 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.102.267879
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com>
Date: Mon, 26 Apr 2010 16:15:56 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: HTMLStripReader, HTMLStripCharFilter
To: java-user@lucene.apache.org
In-Reply-To: <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks for the update!  I appreciate the hard work.

Perhaps someone can help me with the use of HTMLStripCharFilter...


I get an exception (3.1-dev) similar to the one reported here (2.9):

https://issues.apache.org/jira/browse/LUCENE-1695


With the following code:

    Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
        @Override
        protected TokenStreamComponents createComponents(
                final String fieldName, final Reader reader) {
            return new TokenStreamComponents(new StandardTokenizer(Version.LUCENE_30,
                    new HTMLStripCharFilter(CharReader.get(reader))));
        }
    };
    String content = reader.document(id, fieldSelector).get(field);
    TokenStream ts = htmlStripAnalyzer.tokenStream(field, new StringReader(content));
    String best = highlighter.getBestFragments(ts, content,
      DEFAULT_EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);
    OffsetAttribute off = ts.addAttribute(OffsetAttribute.class);
    ts.reset();
    ts.incrementToken();


java.io.IOException: Stream closed
        at java.io.StringReader.ensureOpen(StringReader.java:39)
        at java.io.StringReader.read(StringReader.java:73)
        at org.apache.lucene.analysis.CharReader.read(CharReader.java:54)
        at java.io.Reader.read(Reader.java:104)
        at org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.java:92)
        at org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.java:690)
        at org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.java:748)
        at org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(StandardTokenizerImpl.java:453)
        at org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(StandardTokenizerImpl.java:639)
        at org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(StandardTokenizer.java:167)


Looking at the source, I wonder if Tokenizer should override reset():

  public void reset() throws IOException {
    if (input != null) input.reset(); // would reset CharReader, StringReader
  }





----- Original Message ----
From: Robert Muir <rcmuir@gmail.com>
To: java-user@lucene.apache.org
Sent: Sat, April 24, 2010 9:03:02 AM
Subject: Re: HTMLStripReader, HTMLStripCharFilter

On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:

> Just out of curiousity, why does LUCENE-1377 have a minor priorty?
>
> https://issues.apache.org/jira/browse/LUCENE-1377
>
> Don't people index, filter, search HTML, perhaps more than any other
> format?
>
>
Rest assured we are working on this... but it unfortunately won't happen
overnight. First of all, the development of Lucene and Solr was merged such
that there is now one team working on this stuff. This way, both Solr and
Lucene developers can maintain this stuff.

There is now the practical issue to combine all Lucene and Solr analyzers
(not just the two components listed on that issue) into one package that can
then be used by both Lucene and Solr users:
https://issues.apache.org/jira/browse/LUCENE-2413

-- 
Robert Muir
rcmuir@gmail.com



      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45920-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 05:01:05 2010
Return-Path: <java-user-return-45920-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60914 invoked from network); 27 Apr 2010 05:01:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 05:01:05 -0000
Received: (qmail 22572 invoked by uid 500); 27 Apr 2010 05:01:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22260 invoked by uid 500); 27 Apr 2010 05:01:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22247 invoked by uid 99); 27 Apr 2010 05:01:02 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 05:01:02 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 05:00:54 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 6E2EAD36004
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 07:00:33 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id WOQ1q7EV2LTh for <java-user@lucene.apache.org>;
	Tue, 27 Apr 2010 07:00:18 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 6E524D36003
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 07:00:17 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com> <111835.48056.qm@web32903.mail.mud.yahoo.com>
In-Reply-To: <111835.48056.qm@web32903.mail.mud.yahoo.com>
Subject: RE: HTMLStripReader, HTMLStripCharFilter
Date: Tue, 27 Apr 2010 07:00:31 +0200
Message-ID: <027101cae5c6$8ff9f990$afedecb0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 12.0
Thread-index: Acrllo5g3ksClpzbTMKT8l127ruDgQAL+hVA
Content-language: de
X-Virus-Checked: Checked by ClamAV on apache.org

To reset this token stream you have to wrap it with a CachingTokenFilter.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Justin [mailto:crynax@yahoo.com]
> Sent: Tuesday, April 27, 2010 1:16 AM
> To: java-user@lucene.apache.org
> Subject: Re: HTMLStripReader, HTMLStripCharFilter
> 
> Thanks for the update!  I appreciate the hard work.
> 
> Perhaps someone can help me with the use of HTMLStripCharFilter...
> 
> 
> I get an exception (3.1-dev) similar to the one reported here (2.9):
> 
> https://issues.apache.org/jira/browse/LUCENE-1695
> 
> 
> With the following code:
> 
>     Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
>         @Override
>         protected TokenStreamComponents createComponents(
>                 final String fieldName, final Reader reader) {
>             return new TokenStreamComponents(new
> StandardTokenizer(Version.LUCENE_30,
>                     new HTMLStripCharFilter(CharReader.get(reader))));
>         }
>     };
>     String content = reader.document(id, fieldSelector).get(field);
>     TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
> StringReader(content));
>     String best = highlighter.getBestFragments(ts, content,
>       DEFAULT_EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);
>     OffsetAttribute off = ts.addAttribute(OffsetAttribute.class);
>     ts.reset();
>     ts.incrementToken();
> 
> 
> java.io.IOException: Stream closed
>         at java.io.StringReader.ensureOpen(StringReader.java:39)
>         at java.io.StringReader.read(StringReader.java:73)
>         at
> org.apache.lucene.analysis.CharReader.read(CharReader.java:54)
>         at java.io.Reader.read(Reader.java:104)
>         at
> org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.j
> ava:92)
>         at
> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
> ava:690)
>         at
> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
> ava:748)
>         at
> org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(Stan
> dardTokenizerImpl.java:453)
>         at
> org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(
> StandardTokenizerImpl.java:639)
>         at
> org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(St
> andardTokenizer.java:167)
> 
> 
> Looking at the source, I wonder if Tokenizer should override reset():
> 
>   public void reset() throws IOException {
>     if (input != null) input.reset(); // would reset CharReader,
> StringReader
>   }
> 
> 
> 
> 
> 
> ----- Original Message ----
> From: Robert Muir <rcmuir@gmail.com>
> To: java-user@lucene.apache.org
> Sent: Sat, April 24, 2010 9:03:02 AM
> Subject: Re: HTMLStripReader, HTMLStripCharFilter
> 
> On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:
> 
> > Just out of curiousity, why does LUCENE-1377 have a minor priorty?
> >
> > https://issues.apache.org/jira/browse/LUCENE-1377
> >
> > Don't people index, filter, search HTML, perhaps more than any other
> > format?
> >
> >
> Rest assured we are working on this... but it unfortunately won't
> happen
> overnight. First of all, the development of Lucene and Solr was merged
> such
> that there is now one team working on this stuff. This way, both Solr
> and
> Lucene developers can maintain this stuff.
> 
> There is now the practical issue to combine all Lucene and Solr
> analyzers
> (not just the two components listed on that issue) into one package
> that can
> then be used by both Lucene and Solr users:
> https://issues.apache.org/jira/browse/LUCENE-2413
> 
> --
> Robert Muir
> rcmuir@gmail.com
> 
> 
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45921-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 10:03:09 2010
Return-Path: <java-user-return-45921-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79805 invoked from network); 27 Apr 2010 10:03:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 10:03:09 -0000
Received: (qmail 39294 invoked by uid 500); 27 Apr 2010 10:03:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39082 invoked by uid 500); 27 Apr 2010 10:03:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39074 invoked by uid 99); 27 Apr 2010 10:03:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 10:03:06 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [67.195.8.181] (HELO web110205.mail.gq1.yahoo.com) (67.195.8.181)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 27 Apr 2010 10:02:57 +0000
Received: (qmail 64157 invoked by uid 60001); 27 Apr 2010 10:02:35 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272362555; bh=p+KjEWxGXT0B69BHZ318yoIDdV6Ixp8pFPQIG2GkEYE=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=gAAjBXsaSbTzzSxlwVDEMLsjCmC0TdgN/vDSZBcrkYq0UPZwHJc/f/mqWSKJ80Cn8ds9ihh8pO9JbtEXSdmWHzAd9myCevaJGHZYo/uVh/jcUeBgYeicYka7R1HNUEqCtbEZSIUbWW1XWXc+4E5Edgjx/NJ7aoaQMCM6C5UtowM=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=g6tIZW26OY3MV5vXpd9N9odjdPgg+DtLIpHV6iv2Z+EUN57naSIxBcltJ5ua87FW50qkzh09X2rnti3oCQB1v5xqh7JT3QJYFoYrhzK9VGRVickWZmj3MLN2bCqEKQycKHCom4grfrwixY2lAzeKV4hBtHRofoxr4iG2xw83BnU=;
Message-ID: <195795.51783.qm@web110205.mail.gq1.yahoo.com>
X-YMail-OSG: .P23K8gVM1k1L6Uc9jQ6drbuaJCCmuxhqdwbW.wU4.A32UD
 3TzIBUA2.PXTbaBCmRi8JYIEvB.OJd2RlE7uZ1exyTUzcRhWRlqrG1FkqdCU
 cv.QW00PxpHXQ.iqhe5d4Ob1obwbS5GhzO5eDNzl._mKR7wyYckpPXiwSSVZ
 41_F0t.HJVg8iKJRRCelUZHwAZz1doytvm78gw3EoaQ4cVxw41l.v5wAu22c
 Bd.vVV8x7meVXFzaXfTksXh639bFWckL6jrv0AcfRUn5g1QJdfuV2bu0Y4V1
 65a7ofmSI2O1xJKZX6A0KZw8gBWUF7VgXwAI-
Received: from [152.118.148.226] by web110205.mail.gq1.yahoo.com via HTTP; Tue, 27 Apr 2010 03:02:35 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
Date: Tue, 27 Apr 2010 03:02:35 -0700 (PDT)
From: Clara Vania <chubz_fun@yahoo.com>
Subject: Range Score in Lucene
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-120422717-1272362555=:51783"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-120422717-1272362555=:51783
Content-Type: text/plain; charset=us-ascii

Hi all,

I am new to Lucene and I want to ask about range score that Lucene used, because I got score greater than 1.
I'm using lucene-3.0.1 and using 
MoreLikeThis to do document similarity and ScoreDoc class to get hits of my search.

 Thanks,


-Clara Vania-


      
--0-120422717-1272362555=:51783--

From java-user-return-45922-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 10:40:38 2010
Return-Path: <java-user-return-45922-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87720 invoked from network); 27 Apr 2010 10:40:37 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 10:40:37 -0000
Received: (qmail 84342 invoked by uid 500); 27 Apr 2010 10:40:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83987 invoked by uid 500); 27 Apr 2010 10:40:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83966 invoked by uid 99); 27 Apr 2010 10:40:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 10:40:29 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,URIBL_RED
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 10:40:22 +0000
Received: by ywh38 with SMTP id 38so6654872ywh.29
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 03:40:00 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.188.9 with SMTP id l9mr5588564ybf.109.1272364800690; Tue, 
	27 Apr 2010 03:40:00 -0700 (PDT)
Received: by 10.150.190.12 with HTTP; Tue, 27 Apr 2010 03:40:00 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CC066FD36@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
	 <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
	 <n2w9ac0c6aa1004141352s5edb3082o2f1952626c551450@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CC066FD36@PHXCCRPRD02.adprod.bmc.com>
Date: Tue, 27 Apr 2010 06:40:00 -0400
Message-ID: <i2i9ac0c6aa1004270340heec28687zc734ebfbbae10bd3@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Oooh -- I suspect you are hitting this issue:

    https://issues.apache.org/jira/browse/LUCENE-2283

Your 3rd image ("fdt") jogged my memory on this one.  Can you try
testing the trunk JAR from after that issue landed?  (Or, apply that
patch against 3.0.x -- let me know if it does not apply cleanly and
I'll try to back port it).

But: it's spooky that you cannot repro this issue in your dev
environment.  Are you matching the # thread and exact sequence of
docs?

Mike

On Mon, Apr 26, 2010 at 4:14 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> We are still plagued by this issue. =A0I tried applying the patch mention=
ed but this did not resolve the issue.
>
> I once tried to attach images from the heap dump to send out to the group=
 but the server removed them so I have posted the images on a public servic=
e with links this time. =A0I would appreciate someone looking at them to se=
e if they provide any insight into what is occurring with this issue.
>
> When you follow the link click on the image and then once you see the ima=
ge click on a link in the lower left hand corner that says "View Raw Image.=
" =A0This will let you view the images at 100% resolution.
>
> This first image shows what we are seeing within VisualVM in regards to t=
he memory. =A0As you can see, over time the memory gets consumed. =A0Finall=
y we are at a point where there is no more memory available.
> Graph
> http://tinypic.com/view.php?pic=3D2ltk0h3&s=3D5
>
> This second image in VisualVM shows the classes sorted by size. =A0As you=
 can see, about 70% of all memory is consumed in the bytes array.
> Bytes
> http://tinypic.com/view.php?pic=3Ds10mqs&s=3D5
>
> This third image is where the real info is. =A0This is where one of the b=
ytes is being examined and the option to go to nearest GC is chosen. =A0Wha=
t you see here is what the majority of the bytes show if selected, so this =
one is representative of most all. =A0As you can see this one byte is assoc=
iated with the index writer as you look at the chain of objects (and thus s=
o too are all the other bytes that have not been released for GC).
> Garbage Collection
> http://tinypic.com/view.php?pic=3D5obalj&s=3D5
>
> I'm hoping that as you look at this that it might mean something to you o=
r give you a clue as to what is holding on to all the memory.
>
> Now the mysterious thing in all of this is that our use of Lucene has bee=
n developed into a "plug-in" that we use within an application that we have=
. =A0If I just run JUnit tests around this plugin, indexing some of the sam=
e files that the actual application is indexing, I cannot ever get the memo=
ry loss in my dev environment. =A0Everything seems to work as expected. =A0=
However, once we are in our real situation, then we see this behavior. =A0B=
ecause of this I would expect that the problem lays with the application, b=
ut once we examine the heap dumps it then goes back to showing that the con=
sumed bytes are "owned" by the index writer process. =A0It makes no sense t=
o me that we see this as we do, but none the less we do. =A0We see that the=
 Index Writer process is hanging onto a lot of data in byte arrays and it d=
oesn't ever seam to release it.
>
> In addition, we would love to show this to someone via a webex if that wo=
uld help in seeing what is going on.
>
> Please, any help appreciated and any suggestions on how to resolve or eve=
n troubleshoot. =A0I can provide an actual heap dump but it is 63mb in size=
 (compressed) so we would need to work out some FTP where we can provide it=
 if someone is willing to look at it in VisualVM (or any other profiling to=
ol).
>
> BTW - If we open and close the index writer on a regular basis then we do=
n't run into this problem. =A0It is only when we run continuously with an o=
pen index writer that we do see this problem (we altered the code to open/c=
lose the writer a lot, but this slows things down, so we don't want to run =
like this, but we wanted to test the behavior if we did so).
>
> Thanks,
> Ross
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Wednesday, April 14, 2010 2:52 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Run this:
>
> =A0 =A0svn co https://svn.apache.org/repos/asf/lucene/java/branches/lucen=
e_2_9
> lucene.29x
>
> Then apply the patch, then, run "ant jar-core", and in that should
> create the lucene-core-2.9.2-dev.jar.
>
> Mike
>
> On Wed, Apr 14, 2010 at 1:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> How do I get to the 2.9.x branch? =A0Every link I take from the Lucene s=
ite takes me to the trunk which I assume is the 3.x version. =A0I've tried =
to look around svn but can't find anything labeled 2.9.x. =A0Is there a dai=
ly build of 2.9.x or do I need to build it myself. =A0I would like to try o=
ut the fix you put into it, but I'm not sure where I get it from.
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Wednesday, April 14, 2010 4:12 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> It looks like the mailing list software stripped your image attachments.=
..
>>
>> Alas these fixes are only committed on 3.1.
>>
>> But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
>> fix. =A0I think the other issue was part of LUCENE-2074 (though this
>> issue included many other changes) -- Uwe can you peel out just a
>> 2.9.x patch for resetting JFlex's zzBuffer?
>>
>> You could also try switching analyzers (eg to WhitespaceAnalyzer) to
>> see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
>> uses JFlex) is [part of] your problem.
>>
>> Mike
>>
>> On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> Since the heap dump was so big and can't be attached, I have taken a fe=
w screen shots from Java VisualVM of the heap dump. =A0In the first image y=
ou can see that at the time our memory has become very tight most of it is =
held up in bytes. =A0In the second image I examine one of those instances a=
nd navigate to the nearest garbage collection root. =A0In looking at very m=
any of these objects, they all end up being instantiated through the IndexW=
riter process.
>>>
>>> This heap dump is the same one correlating to the infoStream that was a=
ttached in a prior message. =A0So while the infoStream shows the buffer bei=
ng flushed, what we experience is that our memory gets consumed over time b=
y these bytes in the IndexWriter.
>
>>>
>>> I wanted to provide these images to see if they might correlate to the =
fixes mentioned below. =A0Hopefully those fixes mentioned below have rectif=
ied this problem. =A0And as I state in the prior message, I'm hoping these =
fixes are in a 2.9x branch and hoping for someone to point me to where I ca=
n get those fixes to try out.
>>>
>>> Thanks
>>>
>>> -----Original Message-----
>>> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
>>> Sent: Tuesday, April 13, 2010 1:29 PM
>>> To: java-user@lucene.apache.org
>>> Subject: RE: IndexWriter and memory usage
>>>
>>> Are these fixes in 2.9x branch? =A0We are using 2.9x and can't move to =
3x just yet. =A0If so, where do I specifically pick this up from?
>>>
>>> -----Original Message-----
>>> From: Lance Norskog [mailto:goksron@gmail.com]
>>> Sent: Monday, April 12, 2010 10:20 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> There is some bugs where the writer data structures retain data after
>>> it is flushed. They are committed as of maybe the past week. If you
>>> can pull the trunk and try it with your use case, that would be great.
>>>
>>> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>> I was on vacation last week so just getting back to this... =A0Here is=
 the info stream (as an attachment). =A0I'll see what I can do about reduci=
ng the heap dump (It was supplied by a colleague).
>>>>
>>>>
>>>> -----Original Message-----
>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>> Sent: Saturday, April 03, 2010 3:39 AM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Re: IndexWriter and memory usage
>>>>
>>>> Hmm why is the heap dump so immense? =A0Normally it contains the top N
>>>> (eg 100) object types and their count/aggregate RAM usage.
>>>>
>>>> Can you attach the infoStream output to an email (to java-user)?
>>>>
>>>> Mike
>>>>
>>>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>>> I have this and the heap dump is 63mb zipped. =A0The info stream is m=
uch smaller (31 kb zipped), but I don't know how to get them to you.
>>>>>
>>>>> We are not using the NRT readers
>>>>>
>>>>> -----Original Message-----
>>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>>> Sent: Thursday, April 01, 2010 5:21 PM
>>>>> To: java-user@lucene.apache.org
>>>>> Subject: Re: IndexWriter and memory usage
>>>>>
>>>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>>>
>>>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But, =
it
>>>>> does allocate and then recycle this RAM buffer, so even in an idle
>>>>> state (having indexed enough docs to fill up the RAM buffer at least
>>>>> once) it'll hold onto those 16 MB.
>>>>>
>>>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>>>> really sure you're eventually closing the previous reader after
>>>>> opening a new one?
>>>>>
>>>>> Mike
>>>>>
>>>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrot=
e:
>>>>>> We are seeing a situation where the IndexWriter is using up the Java=
 Heap space and only releases memory for garbage collection upon a commit. =
=A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucene=
 2.9.1. We are set at heap size of 512 mb.
>>>>>>
>>>>>> We have a large number of documents that are run through Tika and th=
en added to the index. =A0The data from Tika is changed to a string, and th=
en sent to Lucene. =A0Heap dumps clearly show the data in the Lucene classe=
s and not in Tika. =A0Our intent is to only perform a commit once the entir=
e indexing run is complete, but several hours into the process everything c=
omes to a crawl. =A0In using both JConsole and VisualVM =A0we can see that =
the heap space is maxed out and garbage collection is not able to clean up =
any memory once we get into this state. =A0It is our understanding that the=
 IndexWriter should be only holding onto 16 mb of data before it flushes it=
, but what we are seeing is that while it is in fact writing data to disk w=
hen it hits the 16 mb limit, it is also holding onto some data in memory an=
d not allowing garbage collection to take place, and this continues until g=
arbage collection is unable to free up enough space to all things to move f=
aster than a crawl.
>>>>>>
>>>>>> As a test we caused a commit to occur after each document is indexed=
 and we see the total amount of memory reduced from nearly 100% of the Java=
 Heap to around 70-75%. =A0The profiling tools now show that the memory is =
cleaned up to some extent after each document. =A0But of course this comple=
tely defeats the whole reason why we want to only commit at the end of the =
run for performance sake. =A0Most of the data, as seen using Heap analasis,=
 is held in Byte, Character, and Integer classes whos GC roots are tied bac=
k to the Writer Objects and threads. =A0The instance counts, after running =
just 1,100 documents seems staggering
>>>>>>
>>>>>> Is there additional data that the IndexWriter hangs onto regardless =
of when it hits the RAMBufferSize limit? =A0Why are we seeing the heap spac=
e all being used up?
>>>>>>
>>>>>> A side question to this is the fact that we always see a large amoun=
t of memory used by the IndexWriter even after our indexing has been comple=
ted and all commits have taken place (basically in an idle state). =A0Why w=
ould this be? =A0Is the only way to totally clean up the memory is to close=
 the writer? =A0Our index is also used for real time indexing so the IndexW=
riter is intended to remain open for the lifetime of the app.
>>>>>>
>>>>>> Any help in understanding why the IndexWriter is maxing out our heap=
 space or what is expected from memory usage of the IndexWriter would be ap=
preciated.
>>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>
>>>
>>>
>>> --
>>> Lance Norskog
>>> goksron@gmail.com
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45924-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 11:18:32 2010
Return-Path: <java-user-return-45924-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95379 invoked from network); 27 Apr 2010 11:18:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 11:18:32 -0000
Received: (qmail 23510 invoked by uid 500); 27 Apr 2010 11:18:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23290 invoked by uid 500); 27 Apr 2010 11:18:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23272 invoked by uid 99); 27 Apr 2010 11:18:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 11:18:25 +0000
X-ASF-Spam-Status: No, hits=-0.6 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 11:18:18 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 13CFBD36004
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 13:17:57 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 2ABsQ0MB-l+N for <java-user@lucene.apache.org>;
	Tue, 27 Apr 2010 13:17:41 +0200 (CEST)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.85])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id AE6A3D36003
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 13:17:41 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <195795.51783.qm@web110205.mail.gq1.yahoo.com>
In-Reply-To: <195795.51783.qm@web110205.mail.gq1.yahoo.com>
Subject: RE: Range Score in Lucene
Date: Tue, 27 Apr 2010 13:17:55 +0200
Message-ID: <029001cae5fb$492cb860$db862920$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-index: Acrl8N8ElYP5//S8TzWTiufIiGozUgACiQrA
Content-language: de

The score is an arbitrary number > 0. It's not normalized to anything, =
it should only be used to e.g. sort the results. You cannot even compare =
scores between two searches. They should only be used to compare hits =
*within* one result set (e.g. sort as done in top docs).

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Clara Vania [mailto:chubz_fun@yahoo.com]
> Sent: Tuesday, April 27, 2010 12:03 PM
> To: java-user@lucene.apache.org
> Subject: Range Score in Lucene
>=20
> Hi all,
>=20
> I am new to Lucene and I want to ask about range score that Lucene
> used, because I got score greater than 1.
> I'm using lucene-3.0.1 and using
> MoreLikeThis to do document similarity and ScoreDoc class to get hits
> of my search.
>=20
>  Thanks,
>=20
>=20
> -Clara Vania-
>=20
>=20
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45923-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 11:18:32 2010
Return-Path: <java-user-return-45923-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95395 invoked from network); 27 Apr 2010 11:18:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 11:18:32 -0000
Received: (qmail 23508 invoked by uid 500); 27 Apr 2010 11:18:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23288 invoked by uid 500); 27 Apr 2010 11:18:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23275 invoked by uid 99); 27 Apr 2010 11:18:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 11:18:25 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 11:18:17 +0000
Received: by vws7 with SMTP id 7so338928vws.35
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 04:17:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=49Ta2tG1V8BAUcmDy9cRU8Dq/OfFYOPUC1uQ/52Z3EY=;
        b=ffbHR/7wmItIaYH08yKEC6jHNei8iFrCo/LMJJLliUVvujMQlBv+u/+fRdfXVf+KqF
         dSuuq3gR4ftX2BzaKhvVfORseu3G0cyuy3dl/CFonzEibpXtRucbYB3Oz6foTmbQBPbd
         A2iRV5Rcme+M8cHJu6nxQIKq5tfwaWfvyoGOA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=PB24qgL4+uK7kfCBb3e7VpDunVelGR2gdtIFA68pw8LWKjMPrUHRANOwg4+rW9Jkrg
         3UlOB2nSCQ1NPYpb1ONH6qzCrNRmnMT2EqjzcJ4hf7IQm07bKxQpzEYTpLkdrW9z1HOh
         Ip4l27mPVTyMhc9EJIMAR1t/T5HAY71uM6SVc=
Received: by 10.220.107.219 with SMTP id c27mr3903066vcp.87.1272367076136; 
	Tue, 27 Apr 2010 04:17:56 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.220.80.149 with HTTP; Tue, 27 Apr 2010 04:17:36 -0700 (PDT)
In-Reply-To: <195795.51783.qm@web110205.mail.gq1.yahoo.com>
References: <195795.51783.qm@web110205.mail.gq1.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Tue, 27 Apr 2010 16:47:36 +0530
Message-ID: <s2m867513fe1004270417p63905321jd9c0b4a7da5e924e@mail.gmail.com>
Subject: Re: Range Score in Lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00c09f8a4e3398dbd00485360bb1
X-Virus-Checked: Checked by ClamAV on apache.org

--00c09f8a4e3398dbd00485360bb1
Content-Type: text/plain; charset=ISO-8859-1

Hi Clara,
Any particular reason why you'd need the score?  Perhaps this would be of
help
http://lucene.apache.org/java/2_9_1/scoring.html
http://lucene.apache.org/java/2_3_2/scoring.pdf

Hope this explains whatever you were looking for.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Tue, Apr 27, 2010 at 3:32 PM, Clara Vania <chubz_fun@yahoo.com> wrote:

> Hi all,
>
> I am new to Lucene and I want to ask about range score that Lucene used,
> because I got score greater than 1.
> I'm using lucene-3.0.1 and using
> MoreLikeThis to do document similarity and ScoreDoc class to get hits of my
> search.
>
>  Thanks,
>
>
> -Clara Vania-
>
>
>

--00c09f8a4e3398dbd00485360bb1--

From java-user-return-45925-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 12:52:21 2010
Return-Path: <java-user-return-45925-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23626 invoked from network); 27 Apr 2010 12:52:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 12:52:21 -0000
Received: (qmail 54199 invoked by uid 500); 27 Apr 2010 12:52:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54153 invoked by uid 500); 27 Apr 2010 12:52:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54145 invoked by uid 99); 27 Apr 2010 12:52:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 12:52:18 +0000
X-ASF-Spam-Status: No, hits=2.3 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.222.180 as permitted sender)
Received: from [209.85.222.180] (HELO mail-pz0-f180.google.com) (209.85.222.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 12:52:12 +0000
Received: by pzk10 with SMTP id 10so5796695pzk.20
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 05:51:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=/eN1cAwOwl9AwkKF9jn0Ck1LHyZTUMFcUmGX+l9bqr4=;
        b=II9i14Vf4vBp9O8sVHJdGvvA5nT7OQtcsF6TT1S9IfObGjPooBaDZ+l+4Yztp2iRPf
         12lqh5b/h1fAH3SZgPdLv/o6iG+W0t/iQJ2Emv5vyCiN4UHJJE1ASCL9x0jdu0kDRX7L
         yQvC5gFUXhsBKJpcgkFZ1R8mVd1RwETAaD/xM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=BScy3NlkBK+kp4VYU+o4BLMt9jVEAfC5G6V3oQvZgUeDrgrlHKHnzHA3HmfYCcs/qz
         Njowb866K3x+OsXlTt9Titg7lJUNkJ2yLkblm91uRGngyZth5o7JhpH+5mIJizKPLYgF
         UwpuPY/Lg0nrA9qFcjtLNbWJnsid4m4od9v/Y=
Received: by 10.141.109.10 with SMTP id l10mr5716513rvm.30.1272372712314; Tue, 
	27 Apr 2010 05:51:52 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Tue, 27 Apr 2010 05:51:37 -0700 (PDT)
From: Samarendra Pratap <samarzone@gmail.com>
Date: Tue, 27 Apr 2010 18:21:37 +0530
Message-ID: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
Subject: Right memory for search application
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00032556396a8a18940485375bf8

--00032556396a8a18940485375bf8
Content-Type: text/plain; charset=ISO-8859-1

Hi.
 I am searching for some guidance on right memory options for my Search
Server application. How much memory a lucene based application should be
given?

 Till a few days back I was running my search server on java 1.4 with memory
options "-Xmx3600m" which was running quite fine. After upgrading the JVM to
*java 6* we noticed a few times that our application fell idle (perhaps
hung). It was not serving the requests although the port was open. I changed
the "-Xmx" from 3600m to 5000m.
 Currently it is running OK but this created a curiosity in my mind that how
to find the right memory size for a lucene based application (or any java
application). I believe it heavily depends on index size but how do I
calculate it (at least approximately) without hit & trial?

The details about my application and server are following

*[ system configuration ]*
# uname -a
Linux xxx 2.6.17-13.2.xxx.finalsmp #1 SMP Wed May 9 17:27:56 IST 2007 x86_64
x86_64 x86_64 GNU/Linux

*[ java version ]*
# /usr/lib/jre1.6.0_20/bin/java -version
java version "1.6.0_20"
Java(TM) SE Runtime Environment (build 1.6.0_20-b02)
Java HotSpot(TM) 64-Bit Server VM (build 16.3-b01, mixed mode)

*[ application command line ]*
# java -Xmx5000m -server -classpath
lib/lucene-core-2.9.2.jar:lib/mysql-connector-j
ava-3.1.11-bin.jar:lib/search.jar com.xxx.xxx.SearchServer conf/search.conf

*[ memory information ]*
*
# cat /proc/meminfo
MemTotal:      8156660 kB
MemFree:         46924 kB
Buffers:         53768 kB
Cached:        3194224 kB
SwapCached:         60 kB
Active:        6086272 kB
Inactive:       919276 kB
SwapTotal:     2096472 kB
SwapFree:      2095432 kB
Dirty:            1148 kB
Writeback:           0 kB
AnonPages:     3756496 kB
Mapped:          24800 kB
Slab:          1058124 kB
SReclaimable:    15144 kB
SUnreclaim:    1042980 kB
PageTables:      12232 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:   6174800 kB
Committed_AS:  4588900 kB
VmallocTotal: 34359738367 kB
VmallocUsed:    264904 kB
VmallocChunk: 34359473387 kB

More info*
Search Server application is running on a few servers each of which contains
same of copy of index.
Total size of index: 23 GB
Total Documents in index: 18,000,000
Maximum fields per index: 56 (all analyzed, 4 small fields stored, field
"contents" is the largest one, created from a text of as large as 5 - 8 KB)
Query frequency: 1 query per second per server (in peak hours)
Queries are taking around 800 - 1000 ms per query

*Other memory related things in Search application*
There is really nothing else which will consume noticeable memory. No
database connection is made. The application simply returns the IDs from the
index based on the query.

Any help on choosing right memory option is much appreciated.

-- 
Regards,
Samar

--00032556396a8a18940485375bf8--

From java-user-return-45926-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 13:24:15 2010
Return-Path: <java-user-return-45926-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31019 invoked from network); 27 Apr 2010 13:24:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 13:24:15 -0000
Received: (qmail 3133 invoked by uid 500); 27 Apr 2010 13:24:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3104 invoked by uid 500); 27 Apr 2010 13:24:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3096 invoked by uid 99); 27 Apr 2010 13:24:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 13:24:13 +0000
X-ASF-Spam-Status: No, hits=-0.9 required=10.0
	tests=AWL,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 13:24:06 +0000
Received: by bwz22 with SMTP id 22so12475063bwz.5
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 06:23:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=EFKnBh9r338gp5J65nblrz4baVSd5Z14CcSBHCXIFCQ=;
        b=sWFVC/manPMtumDJAOwfqQsddTw3utvQ/na85CL3SghlXDZC2SIOXHhMf787JZdznB
         BWO12Y7owNWZiDZGfKqOBLNdy5I2I37gQpmWWGwB/YNevGKMuJZ3dmopLk+p/8oLRGtl
         53PopfNnCExWr5jv3pFMSdChpmz8xkDIeZuCg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=iOEbD/tMhGsDunraDBlUs4B5uVFYZyQJiz4GBPId4+3shN2teulx5FFn6C/fEYCzAX
         n3hCM6Fzxtnj18NIoN/n3LikKMX9U80NCbfF522+aJ9wvki8IOzyKgrlv5EPmgAc1Vjv
         Wmv9dphc4AfbYVdlyoJd6jwkFXte0F/9SL/40=
Received: by 10.204.151.218 with SMTP id d26mr3645082bkw.10.1272374625549; 
	Tue, 27 Apr 2010 06:23:45 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Tue, 27 Apr 2010 06:23:25 -0700 (PDT)
In-Reply-To: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 27 Apr 2010 14:23:25 +0100
Message-ID: <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
Subject: Re: Right memory for search application
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

There is no simple answer.  However your app does sound to be using
rather a lot of memory for what you describe as simple searches.

Are you using lucene sorting?  That can use lots of memory.  How are
you using/reusing searchers/readers?  Having multiple ones open, or
failing to close old ones, will use more memory.  Does memory usage
grow then stabilize or keep on growing?

A memory profiler/heap dump could tell you what is really using all the spa=
ce.


--
Ian.

On Tue, Apr 27, 2010 at 1:51 PM, Samarendra Pratap <samarzone@gmail.com> wr=
ote:
> Hi.
> =A0I am searching for some guidance on right memory options for my Search
> Server application. How much memory a lucene based application should be
> given?
>
> =A0Till a few days back I was running my search server on java 1.4 with m=
emory
> options "-Xmx3600m" which was running quite fine. After upgrading the JVM=
 to
> *java 6* we noticed a few times that our application fell idle (perhaps
> hung). It was not serving the requests although the port was open. I chan=
ged
> the "-Xmx" from 3600m to 5000m.
> =A0Currently it is running OK but this created a curiosity in my mind tha=
t how
> to find the right memory size for a lucene based application (or any java
> application). I believe it heavily depends on index size but how do I
> calculate it (at least approximately) without hit & trial?
>
> The details about my application and server are following
>
> *[ system configuration ]*
> # uname -a
> Linux xxx 2.6.17-13.2.xxx.finalsmp #1 SMP Wed May 9 17:27:56 IST 2007 x86=
_64
> x86_64 x86_64 GNU/Linux
>
> *[ java version ]*
> # /usr/lib/jre1.6.0_20/bin/java -version
> java version "1.6.0_20"
> Java(TM) SE Runtime Environment (build 1.6.0_20-b02)
> Java HotSpot(TM) 64-Bit Server VM (build 16.3-b01, mixed mode)
>
> *[ application command line ]*
> # java -Xmx5000m -server -classpath
> lib/lucene-core-2.9.2.jar:lib/mysql-connector-j
> ava-3.1.11-bin.jar:lib/search.jar com.xxx.xxx.SearchServer conf/search.co=
nf
>
> *[ memory information ]*
> *
> # cat /proc/meminfo
> MemTotal: =A0 =A0 =A08156660 kB
> MemFree: =A0 =A0 =A0 =A0 46924 kB
> Buffers: =A0 =A0 =A0 =A0 53768 kB
> Cached: =A0 =A0 =A0 =A03194224 kB
> SwapCached: =A0 =A0 =A0 =A0 60 kB
> Active: =A0 =A0 =A0 =A06086272 kB
> Inactive: =A0 =A0 =A0 919276 kB
> SwapTotal: =A0 =A0 2096472 kB
> SwapFree: =A0 =A0 =A02095432 kB
> Dirty: =A0 =A0 =A0 =A0 =A0 =A01148 kB
> Writeback: =A0 =A0 =A0 =A0 =A0 0 kB
> AnonPages: =A0 =A0 3756496 kB
> Mapped: =A0 =A0 =A0 =A0 =A024800 kB
> Slab: =A0 =A0 =A0 =A0 =A01058124 kB
> SReclaimable: =A0 =A015144 kB
> SUnreclaim: =A0 =A01042980 kB
> PageTables: =A0 =A0 =A012232 kB
> NFS_Unstable: =A0 =A0 =A0 =A00 kB
> Bounce: =A0 =A0 =A0 =A0 =A0 =A0 =A00 kB
> CommitLimit: =A0 6174800 kB
> Committed_AS: =A04588900 kB
> VmallocTotal: 34359738367 kB
> VmallocUsed: =A0 =A0264904 kB
> VmallocChunk: 34359473387 kB
>
> More info*
> Search Server application is running on a few servers each of which conta=
ins
> same of copy of index.
> Total size of index: 23 GB
> Total Documents in index: 18,000,000
> Maximum fields per index: 56 (all analyzed, 4 small fields stored, field
> "contents" is the largest one, created from a text of as large as 5 - 8 K=
B)
> Query frequency: 1 query per second per server (in peak hours)
> Queries are taking around 800 - 1000 ms per query
>
> *Other memory related things in Search application*
> There is really nothing else which will consume noticeable memory. No
> database connection is made. The application simply returns the IDs from =
the
> index based on the query.
>
> Any help on choosing right memory option is much appreciated.
>
> --
> Regards,
> Samar
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45927-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 13:50:46 2010
Return-Path: <java-user-return-45927-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39423 invoked from network); 27 Apr 2010 13:50:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 13:50:46 -0000
Received: (qmail 53694 invoked by uid 500); 27 Apr 2010 13:50:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53662 invoked by uid 500); 27 Apr 2010 13:50:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53654 invoked by uid 99); 27 Apr 2010 13:50:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 13:50:44 +0000
X-ASF-Spam-Status: No, hits=2.3 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 13:50:37 +0000
Received: by pwi7 with SMTP id 7so9689811pwi.35
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 06:50:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=C0lNx/kSaW04cEdQy/uC8h9XLb/ehbTf9Ke33l/Yf4k=;
        b=s4fMJOsB103t0heJYHtJH7v0fkpC4J0OvNq3D8xRlX64BGWbl4K4sjulUsIf1a7P+l
         bmmKncUfJoIQsY8RD5meDPpIRcC+9RIEq8EA8KVxhceYv3UbOrAXmF+WFTWO5cnRQn+e
         T+CcMUdFcpuK2O9UHWa3bNJBgZVidPthzFqFo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=wkQcP4Vq3Soq6g9VBj14LuyqgPRLSUNgJKPB0iFt3xTPdZIGod/iH9/OniNtQyyAJO
         F2VVt5tRJxGIuW42EyZykQrSvprrd0xcnuPEVdKH/WRvyJs8fllnt00B75MVKocPbGEI
         WAfkj3crOKkvqVh6OrgfEJzBXCX0lNaKa7IX0=
Received: by 10.141.109.21 with SMTP id l21mr5548229rvm.114.1272376208526; 
	Tue, 27 Apr 2010 06:50:08 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Tue, 27 Apr 2010 06:49:53 -0700 (PDT)
In-Reply-To: <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> 
	<i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Tue, 27 Apr 2010 19:19:53 +0530
Message-ID: <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
Subject: Re: Right memory for search application
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0003255628daef7e460485382b29

--0003255628daef7e460485382b29
Content-Type: text/plain; charset=ISO-8859-1

Hi Ian. Thanks for the points

Here are my answers -

1. Our default option is sort by score, however almost 8% of searches use
sorting on a field (yyyymmddHHMMSS). This field is indexed as string (not as
NumericField or DateField).

2. We are opening readers at the time of starting the application, but
Searchers are opened for every request choosing the right readers. A few
days back I got an answer on this very forum that reopening a searcher is
not as big issue as reopening a reader. However we are *not closing Searcher
*s after request is served. Should that cause memory problem? Shouldn't GC
handle that all as the reference of Searcher becomes inaccessible?

3. I can't do a profiling on production servers but running "top" shows that
immediately starting search server resident memory (RES) starts from 500m
and Virtual memory (VIRT) is around 5400m. It grows to RES => 1g in 5
minutes and 4g within half an hour while VIRT remains same.

4. Right! I'll be doing a memory profiling. I hope I'll get some hints from
there too.

Do above points (specially # 2) indicate towards anything which I can do
besides profiling?



On Tue, Apr 27, 2010 at 6:53 PM, Ian Lea <ian.lea@gmail.com> wrote:

> There is no simple answer.  However your app does sound to be using
> rather a lot of memory for what you describe as simple searches.
>
> Are you using lucene sorting?  That can use lots of memory.  How are
> you using/reusing searchers/readers?  Having multiple ones open, or
> failing to close old ones, will use more memory.  Does memory usage
> grow then stabilize or keep on growing?
>
> A memory profiler/heap dump could tell you what is really using all the
> space.
>
>
> --
> Ian.
>
> On Tue, Apr 27, 2010 at 1:51 PM, Samarendra Pratap <samarzone@gmail.com>
> wrote:
> > Hi.
> >  I am searching for some guidance on right memory options for my Search
> > Server application. How much memory a lucene based application should be
> > given?
> >
> >  Till a few days back I was running my search server on java 1.4 with
> memory
> > options "-Xmx3600m" which was running quite fine. After upgrading the JVM
> to
> > *java 6* we noticed a few times that our application fell idle (perhaps
> > hung). It was not serving the requests although the port was open. I
> changed
> > the "-Xmx" from 3600m to 5000m.
> >  Currently it is running OK but this created a curiosity in my mind that
> how
> > to find the right memory size for a lucene based application (or any java
> > application). I believe it heavily depends on index size but how do I
> > calculate it (at least approximately) without hit & trial?
> >
> > The details about my application and server are following
> >
> > *[ system configuration ]*
> > # uname -a
> > Linux xxx 2.6.17-13.2.xxx.finalsmp #1 SMP Wed May 9 17:27:56 IST 2007
> x86_64
> > x86_64 x86_64 GNU/Linux
> >
> > *[ java version ]*
> > # /usr/lib/jre1.6.0_20/bin/java -version
> > java version "1.6.0_20"
> > Java(TM) SE Runtime Environment (build 1.6.0_20-b02)
> > Java HotSpot(TM) 64-Bit Server VM (build 16.3-b01, mixed mode)
> >
> > *[ application command line ]*
> > # java -Xmx5000m -server -classpath
> > lib/lucene-core-2.9.2.jar:lib/mysql-connector-j
> > ava-3.1.11-bin.jar:lib/search.jar com.xxx.xxx.SearchServer
> conf/search.conf
> >
> > *[ memory information ]*
> > *
> > # cat /proc/meminfo
> > MemTotal:      8156660 kB
> > MemFree:         46924 kB
> > Buffers:         53768 kB
> > Cached:        3194224 kB
> > SwapCached:         60 kB
> > Active:        6086272 kB
> > Inactive:       919276 kB
> > SwapTotal:     2096472 kB
> > SwapFree:      2095432 kB
> > Dirty:            1148 kB
> > Writeback:           0 kB
> > AnonPages:     3756496 kB
> > Mapped:          24800 kB
> > Slab:          1058124 kB
> > SReclaimable:    15144 kB
> > SUnreclaim:    1042980 kB
> > PageTables:      12232 kB
> > NFS_Unstable:        0 kB
> > Bounce:              0 kB
> > CommitLimit:   6174800 kB
> > Committed_AS:  4588900 kB
> > VmallocTotal: 34359738367 kB
> > VmallocUsed:    264904 kB
> > VmallocChunk: 34359473387 kB
> >
> > More info*
> > Search Server application is running on a few servers each of which
> contains
> > same of copy of index.
> > Total size of index: 23 GB
> > Total Documents in index: 18,000,000
> > Maximum fields per index: 56 (all analyzed, 4 small fields stored, field
> > "contents" is the largest one, created from a text of as large as 5 - 8
> KB)
> > Query frequency: 1 query per second per server (in peak hours)
> > Queries are taking around 800 - 1000 ms per query
> >
> > *Other memory related things in Search application*
> > There is really nothing else which will consume noticeable memory. No
> > database connection is made. The application simply returns the IDs from
> the
> > index based on the query.
> >
> > Any help on choosing right memory option is much appreciated.
> >
> > --
> > Regards,
> > Samar
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Regards,
Samar

--0003255628daef7e460485382b29--

From java-user-return-45928-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 13:59:35 2010
Return-Path: <java-user-return-45928-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41901 invoked from network); 27 Apr 2010 13:59:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 13:59:35 -0000
Received: (qmail 75234 invoked by uid 500); 27 Apr 2010 13:59:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75186 invoked by uid 500); 27 Apr 2010 13:59:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75178 invoked by uid 99); 27 Apr 2010 13:59:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 13:59:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [213.86.41.124] (HELO mail.truvo.com) (213.86.41.124)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 13:59:25 +0000
X-ASG-Debug-ID: 1272376834-7f8802aa0000-H1Y1KX
X-Barracuda-URL: http://10.255.0.214:8000/cgi-bin/mark.cgi
Received: from exchq-001.wdnet.org (localhost [127.0.0.1])
	by mail.truvo.com (Spam Firewall) with ESMTP id 97868107C4A
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 16:00:34 +0200 (CEST)
Received: from exchq-001.wdnet.org (exchq-001.wdnet.org [10.100.10.5]) by mail.truvo.com with ESMTP id hciT3SQqMYLy1IZJ for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 16:00:34 +0200 (CEST)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Right memory for search application
Subject: RE: Right memory for search application
Date: Tue, 27 Apr 2010 16:00:33 +0200
Message-ID: <F2925F55E61C7E4CB848AC82515E726A08DBDADD@exchq-001.wdnet.org>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Right memory for search application
Thread-Index: AcrmENp3iEduy5nsTP2oo7gH6V2JlAAALdew
From: "Fornoville, Tom" <Tom.Fornoville@truvo.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: exchq-001.wdnet.org[10.100.10.5]
X-Barracuda-Start-Time: 1272376834
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at truvo.com
X-Virus-Checked: Checked by ClamAV on apache.org

Samarendra,

In regard to point #2, the GC should indeed handle the clean-up and that
might explain the "idle" time with your original configuration during
major collections.=20

Have you checked that your machine is correctly identified as a server
and has optimized GC settings?

More info in the excellent article here:
http://www.lucidimagination.com/blog/2009/09/19/java-garbage-collection-
boot-camp-draft/

Regards,
Tom

-----Original Message-----
From: Samarendra Pratap [mailto:samarzone@gmail.com]=20
Sent: dinsdag 27 april 2010 15:50
To: java-user@lucene.apache.org
Subject: Re: Right memory for search application

Hi Ian. Thanks for the points

Here are my answers -

1. Our default option is sort by score, however almost 8% of searches
use
sorting on a field (yyyymmddHHMMSS). This field is indexed as string
(not as
NumericField or DateField).

2. We are opening readers at the time of starting the application, but
Searchers are opened for every request choosing the right readers. A few
days back I got an answer on this very forum that reopening a searcher
is
not as big issue as reopening a reader. However we are *not closing
Searcher
*s after request is served. Should that cause memory problem? Shouldn't
GC
handle that all as the reference of Searcher becomes inaccessible?

3. I can't do a profiling on production servers but running "top" shows
that
immediately starting search server resident memory (RES) starts from
500m
and Virtual memory (VIRT) is around 5400m. It grows to RES =3D> 1g in 5
minutes and 4g within half an hour while VIRT remains same.

4. Right! I'll be doing a memory profiling. I hope I'll get some hints
from
there too.

Do above points (specially # 2) indicate towards anything which I can do
besides profiling?



On Tue, Apr 27, 2010 at 6:53 PM, Ian Lea <ian.lea@gmail.com> wrote:

> There is no simple answer.  However your app does sound to be using
> rather a lot of memory for what you describe as simple searches.
>
> Are you using lucene sorting?  That can use lots of memory.  How are
> you using/reusing searchers/readers?  Having multiple ones open, or
> failing to close old ones, will use more memory.  Does memory usage
> grow then stabilize or keep on growing?
>
> A memory profiler/heap dump could tell you what is really using all
the
> space.
>
>
> --
> Ian.
>
> On Tue, Apr 27, 2010 at 1:51 PM, Samarendra Pratap
<samarzone@gmail.com>
> wrote:
> > Hi.
> >  I am searching for some guidance on right memory options for my
Search
> > Server application. How much memory a lucene based application
should be
> > given?
> >
> >  Till a few days back I was running my search server on java 1.4
with
> memory
> > options "-Xmx3600m" which was running quite fine. After upgrading
the JVM
> to
> > *java 6* we noticed a few times that our application fell idle
(perhaps
> > hung). It was not serving the requests although the port was open. I
> changed
> > the "-Xmx" from 3600m to 5000m.
> >  Currently it is running OK but this created a curiosity in my mind
that
> how
> > to find the right memory size for a lucene based application (or any
java
> > application). I believe it heavily depends on index size but how do
I
> > calculate it (at least approximately) without hit & trial?
> >
> > The details about my application and server are following
> >
> > *[ system configuration ]*
> > # uname -a
> > Linux xxx 2.6.17-13.2.xxx.finalsmp #1 SMP Wed May 9 17:27:56 IST
2007
> x86_64
> > x86_64 x86_64 GNU/Linux
> >
> > *[ java version ]*
> > # /usr/lib/jre1.6.0_20/bin/java -version
> > java version "1.6.0_20"
> > Java(TM) SE Runtime Environment (build 1.6.0_20-b02)
> > Java HotSpot(TM) 64-Bit Server VM (build 16.3-b01, mixed mode)
> >
> > *[ application command line ]*
> > # java -Xmx5000m -server -classpath
> > lib/lucene-core-2.9.2.jar:lib/mysql-connector-j
> > ava-3.1.11-bin.jar:lib/search.jar com.xxx.xxx.SearchServer
> conf/search.conf
> >
> > *[ memory information ]*
> > *
> > # cat /proc/meminfo
> > MemTotal:      8156660 kB
> > MemFree:         46924 kB
> > Buffers:         53768 kB
> > Cached:        3194224 kB
> > SwapCached:         60 kB
> > Active:        6086272 kB
> > Inactive:       919276 kB
> > SwapTotal:     2096472 kB
> > SwapFree:      2095432 kB
> > Dirty:            1148 kB
> > Writeback:           0 kB
> > AnonPages:     3756496 kB
> > Mapped:          24800 kB
> > Slab:          1058124 kB
> > SReclaimable:    15144 kB
> > SUnreclaim:    1042980 kB
> > PageTables:      12232 kB
> > NFS_Unstable:        0 kB
> > Bounce:              0 kB
> > CommitLimit:   6174800 kB
> > Committed_AS:  4588900 kB
> > VmallocTotal: 34359738367 kB
> > VmallocUsed:    264904 kB
> > VmallocChunk: 34359473387 kB
> >
> > More info*
> > Search Server application is running on a few servers each of which
> contains
> > same of copy of index.
> > Total size of index: 23 GB
> > Total Documents in index: 18,000,000
> > Maximum fields per index: 56 (all analyzed, 4 small fields stored,
field
> > "contents" is the largest one, created from a text of as large as 5
- 8
> KB)
> > Query frequency: 1 query per second per server (in peak hours)
> > Queries are taking around 800 - 1000 ms per query
> >
> > *Other memory related things in Search application*
> > There is really nothing else which will consume noticeable memory.
No
> > database connection is made. The application simply returns the IDs
from
> the
> > index based on the query.
> >
> > Any help on choosing right memory option is much appreciated.
> >
> > --
> > Regards,
> > Samar
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


--=20
Regards,
Samar

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45929-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 14:13:17 2010
Return-Path: <java-user-return-45929-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46468 invoked from network); 27 Apr 2010 14:13:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 14:13:17 -0000
Received: (qmail 3294 invoked by uid 500); 27 Apr 2010 14:13:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3266 invoked by uid 500); 27 Apr 2010 14:13:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3258 invoked by uid 99); 27 Apr 2010 14:13:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 14:13:14 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 14:13:06 +0000
Received: by bwz22 with SMTP id 22so12524339bwz.5
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 07:12:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=OlWUrh6PHGE3N/mC2uVHVl2t+VTHWtmgHxa/JW98oyY=;
        b=ZsBIJSMWvKlc5QkHoO8v0EDebTEptIVvTAczymrJ+B0W4GjM4IZeaftNj1eHf8fbms
         WcFQXADOo7yk9CBJL6KXLmChnAqIHh2ltVTakpQcB9jeDGY3Jlsoo7P0OjTOV29RIj81
         U1JdwCHt6Ipuno+6ch5R3c/avQK/6egFBHxyU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=d4zoQ7kL00nvk9eqXlGAe9g/Optd46GsFCxoId5LmBvnwRaE7UmUpqL778klHtbDpY
         CPxKXqQ0dBp/sKWnYoOaZo3S0xfgdu9VDvLkaMtrJ/jGTsC/RJTszvIPD6WvraN8TW1V
         kTRROTnUUHoeNLJfcV1oLBTBLmBQh4i/SsUog=
Received: by 10.204.128.68 with SMTP id j4mr1025017bks.49.1272377566290; Tue, 
	27 Apr 2010 07:12:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Tue, 27 Apr 2010 07:12:26 -0700 (PDT)
In-Reply-To: <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> 
	<i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com> 
	<x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 27 Apr 2010 15:12:26 +0100
Message-ID: <r2u8c4e68611004270712j6ed05a21rfa233efb1188de7e@mail.gmail.com>
Subject: Re: Right memory for search application
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Sorting by score down to the second will use a lot of memory.  Can you
make it less granular?  And I think that switching that field to a
NumericField will give you some savings - this has come up before but
I can't remember the details.  I'm sure someone else will.


--
Ian.


On Tue, Apr 27, 2010 at 2:49 PM, Samarendra Pratap <samarzone@gmail.com> wr=
ote:
> Hi Ian. Thanks for the points
>
> Here are my answers -
>
> 1. Our default option is sort by score, however almost 8% of searches use
> sorting on a field (yyyymmddHHMMSS). This field is indexed as string (not=
 as
> NumericField or DateField).
>
> 2. We are opening readers at the time of starting the application, but
> Searchers are opened for every request choosing the right readers. A few
> days back I got an answer on this very forum that reopening a searcher is
> not as big issue as reopening a reader. However we are *not closing Searc=
her
> *s after request is served. Should that cause memory problem? Shouldn't G=
C
> handle that all as the reference of Searcher becomes inaccessible?
>
> 3. I can't do a profiling on production servers but running "top" shows t=
hat
> immediately starting search server resident memory (RES) starts from 500m
> and Virtual memory (VIRT) is around 5400m. It grows to RES =3D> 1g in 5
> minutes and 4g within half an hour while VIRT remains same.
>
> 4. Right! I'll be doing a memory profiling. I hope I'll get some hints fr=
om
> there too.
>
> Do above points (specially # 2) indicate towards anything which I can do
> besides profiling?
>
>
>
> On Tue, Apr 27, 2010 at 6:53 PM, Ian Lea <ian.lea@gmail.com> wrote:
>
>> There is no simple answer. =A0However your app does sound to be using
>> rather a lot of memory for what you describe as simple searches.
>>
>> Are you using lucene sorting? =A0That can use lots of memory. =A0How are
>> you using/reusing searchers/readers? =A0Having multiple ones open, or
>> failing to close old ones, will use more memory. =A0Does memory usage
>> grow then stabilize or keep on growing?
>>
>> A memory profiler/heap dump could tell you what is really using all the
>> space.
>>
>>
>> --
>> Ian.
>>
>> On Tue, Apr 27, 2010 at 1:51 PM, Samarendra Pratap <samarzone@gmail.com>
>> wrote:
>> > Hi.
>> > =A0I am searching for some guidance on right memory options for my Sea=
rch
>> > Server application. How much memory a lucene based application should =
be
>> > given?
>> >
>> > =A0Till a few days back I was running my search server on java 1.4 wit=
h
>> memory
>> > options "-Xmx3600m" which was running quite fine. After upgrading the =
JVM
>> to
>> > *java 6* we noticed a few times that our application fell idle (perhap=
s
>> > hung). It was not serving the requests although the port was open. I
>> changed
>> > the "-Xmx" from 3600m to 5000m.
>> > =A0Currently it is running OK but this created a curiosity in my mind =
that
>> how
>> > to find the right memory size for a lucene based application (or any j=
ava
>> > application). I believe it heavily depends on index size but how do I
>> > calculate it (at least approximately) without hit & trial?
>> >
>> > The details about my application and server are following
>> >
>> > *[ system configuration ]*
>> > # uname -a
>> > Linux xxx 2.6.17-13.2.xxx.finalsmp #1 SMP Wed May 9 17:27:56 IST 2007
>> x86_64
>> > x86_64 x86_64 GNU/Linux
>> >
>> > *[ java version ]*
>> > # /usr/lib/jre1.6.0_20/bin/java -version
>> > java version "1.6.0_20"
>> > Java(TM) SE Runtime Environment (build 1.6.0_20-b02)
>> > Java HotSpot(TM) 64-Bit Server VM (build 16.3-b01, mixed mode)
>> >
>> > *[ application command line ]*
>> > # java -Xmx5000m -server -classpath
>> > lib/lucene-core-2.9.2.jar:lib/mysql-connector-j
>> > ava-3.1.11-bin.jar:lib/search.jar com.xxx.xxx.SearchServer
>> conf/search.conf
>> >
>> > *[ memory information ]*
>> > *
>> > # cat /proc/meminfo
>> > MemTotal: =A0 =A0 =A08156660 kB
>> > MemFree: =A0 =A0 =A0 =A0 46924 kB
>> > Buffers: =A0 =A0 =A0 =A0 53768 kB
>> > Cached: =A0 =A0 =A0 =A03194224 kB
>> > SwapCached: =A0 =A0 =A0 =A0 60 kB
>> > Active: =A0 =A0 =A0 =A06086272 kB
>> > Inactive: =A0 =A0 =A0 919276 kB
>> > SwapTotal: =A0 =A0 2096472 kB
>> > SwapFree: =A0 =A0 =A02095432 kB
>> > Dirty: =A0 =A0 =A0 =A0 =A0 =A01148 kB
>> > Writeback: =A0 =A0 =A0 =A0 =A0 0 kB
>> > AnonPages: =A0 =A0 3756496 kB
>> > Mapped: =A0 =A0 =A0 =A0 =A024800 kB
>> > Slab: =A0 =A0 =A0 =A0 =A01058124 kB
>> > SReclaimable: =A0 =A015144 kB
>> > SUnreclaim: =A0 =A01042980 kB
>> > PageTables: =A0 =A0 =A012232 kB
>> > NFS_Unstable: =A0 =A0 =A0 =A00 kB
>> > Bounce: =A0 =A0 =A0 =A0 =A0 =A0 =A00 kB
>> > CommitLimit: =A0 6174800 kB
>> > Committed_AS: =A04588900 kB
>> > VmallocTotal: 34359738367 kB
>> > VmallocUsed: =A0 =A0264904 kB
>> > VmallocChunk: 34359473387 kB
>> >
>> > More info*
>> > Search Server application is running on a few servers each of which
>> contains
>> > same of copy of index.
>> > Total size of index: 23 GB
>> > Total Documents in index: 18,000,000
>> > Maximum fields per index: 56 (all analyzed, 4 small fields stored, fie=
ld
>> > "contents" is the largest one, created from a text of as large as 5 - =
8
>> KB)
>> > Query frequency: 1 query per second per server (in peak hours)
>> > Queries are taking around 800 - 1000 ms per query
>> >
>> > *Other memory related things in Search application*
>> > There is really nothing else which will consume noticeable memory. No
>> > database connection is made. The application simply returns the IDs fr=
om
>> the
>> > index based on the query.
>> >
>> > Any help on choosing right memory option is much appreciated.
>> >
>> > --
>> > Regards,
>> > Samar
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> Regards,
> Samar
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45930-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 16:30:22 2010
Return-Path: <java-user-return-45930-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92932 invoked from network); 27 Apr 2010 16:30:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 16:30:21 -0000
Received: (qmail 95187 invoked by uid 500); 27 Apr 2010 16:30:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95161 invoked by uid 500); 27 Apr 2010 16:30:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95153 invoked by uid 99); 27 Apr 2010 16:30:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 16:30:19 +0000
X-ASF-Spam-Status: No, hits=0.4 required=10.0
	tests=AWL,SPF_PASS,T_FRT_ADULT2
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of SGreene@metalseconomics.com designates 142.176.9.241 as permitted sender)
Received: from [142.176.9.241] (HELO mail.metalseconomics.com) (142.176.9.241)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 16:30:13 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Term offsets for highlighting
Date: Tue, 27 Apr 2010 13:29:21 -0300
Message-ID: <A098673D2A673A43849164E87EB3B36101C9FD69@copper.meg.local>
In-reply-to: <4BD59B43.9060409@r.email.ne.jp>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Term offsets for highlighting
Thread-Index: AcrlSCvbCLjBn16jSne7r6HYzF4iZgA3nYJQ
References: <A098673D2A673A43849164E87EB3B36101C43E56@copper.meg.local> <4BC90565.2080407@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43EC9@copper.meg.local> <4BCB0C1D.8060603@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C43F1C@copper.meg.local> <4BCCEF0A.5090501@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C9FA0B@copper.meg.local> <4BD2A942.7080706@r.email.ne.jp> <A098673D2A673A43849164E87EB3B36101C9FBCD@copper.meg.local> <4BD59B43.9060409@r.email.ne.jp>
From: "Stephen Greene" <SGreene@metalseconomics.com>
To: <java-user@lucene.apache.org>

Thank you Koji.

Everything is now working as desired. You have been an invaluable
resource for helping to resolve this issue and I really appreciate the
time you spent reviewing this issue.

Best regards,

Steve


-----Original Message-----
From: Koji Sekiguchi [mailto:koji@r.email.ne.jp]=20
Sent: Monday, April 26, 2010 10:55 AM
To: java-user@lucene.apache.org
Subject: Re: Term offsets for highlighting

Stephen Greene wrote:
> Hi Koji,
>
> Thank you. I implemented a solution based on the
FieldTermStackTest.java
> and if I do a search like "iron ore" it matches iron or ore. The same
is
> true if I specify iron AND ore.
>
> The termSetMap[0].value[0] =3D ore and termSetMap[0].value[1] =3D =
iron.
>
> What am I missing in having a prhase match correctly?
>
> Thanks,
>
> Steve
>
>  =20
Hi Steve,

Ah, I was wrong. I should say FieldPhraseList, not FieldTermStack.
Please refer to Step 3 in Algorithm section of the following Javadoc:

http://hudson.zones.apache.org/hudson/job/Lucene-trunk/javadoc/contrib-h
ighlighter/org/apache/lucene/search/vectorhighlight/package-summary.html

Koji

--=20
http://www.rondhuit.com/en/


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45931-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 17:32:51 2010
Return-Path: <java-user-return-45931-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6515 invoked from network); 27 Apr 2010 17:32:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 17:32:50 -0000
Received: (qmail 80677 invoked by uid 500); 27 Apr 2010 17:32:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80622 invoked by uid 500); 27 Apr 2010 17:32:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80614 invoked by uid 99); 27 Apr 2010 17:32:48 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 17:32:48 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [67.195.8.185] (HELO web110209.mail.gq1.yahoo.com) (67.195.8.185)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 27 Apr 2010 17:32:40 +0000
Received: (qmail 74516 invoked by uid 60001); 27 Apr 2010 17:32:18 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272389538; bh=wRzfbBM68hG0cjTRTnJQVVTMeVwR9IDNbqWflpscyjA=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=aya8v6nk76YGGxecL0+xZLFpXJqUMKJ/RW5ku6pqEBrNkk6sn/+BYg4Vx+CCS99YFYjJXYHpepWELN3K+ThqrZZ/fy85zXgihr3yNZHKkQc+wu86L4kEncwjfZ8SbDpYQMuZodtryN/dmSxjsi0YvjskGUTkoIRm1l8OyvaqCP8=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=W2vxfBhglwAmvpetxUbU6TljzKasCFhlpyN3PzwxwN3vHrq9lzUy67r0kspwLdbcUD10R7OHvf6h675pgb//HJ7f4krYS0QHYampvfWNuFt9LGkJJpy3ZkO4I3nl0sX3djaA9yvBaBsfI51/+1bgIAFBI8a2EaT651MqsFl8jC0=;
Message-ID: <853701.73021.qm@web110209.mail.gq1.yahoo.com>
X-YMail-OSG: GXBlte8VM1kUlnBZQqCEl_QCH3ryGuO8VrVbM_cDxvu.LUc
 yj84LHM4zDKAMy6_zh05ND4ezDPqTJmzBGOMgVJYEG2IiiUaqEsc1hHpIU7Q
 FQLeTysymltk.x8UcnrzQPKIqFTwMhFmVvyXnRYV4IecRvnJXMAHnh7eoCm9
 hMj4uwy3p1p_89dnoBxmQOXZlyKTRNPqIM9fZul3mg8uvsKmlU10DYa1ZKIr
 WnCk1hu8V1xcn7dSxeCq4.hvezHqpQGtZzWbwl9ET9dvgvSKsNw918srrxVy
 pIfv6WZe3okznybp8EuKcNfKvUvOPa8czU4lf
Received: from [125.166.211.168] by web110209.mail.gq1.yahoo.com via HTTP; Tue, 27 Apr 2010 10:32:18 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
References: <195795.51783.qm@web110205.mail.gq1.yahoo.com> <029001cae5fb$492cb860$db862920$@de>
Date: Tue, 27 Apr 2010 10:32:18 -0700 (PDT)
From: Clara Vania <chubz_fun@yahoo.com>
Subject: Re: Range Score in Lucene
To: java-user@lucene.apache.org
In-Reply-To: <029001cae5fb$492cb860$db862920$@de>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-246216264-1272389538=:73021"

--0-246216264-1272389538=:73021
Content-Type: text/plain; charset=us-ascii

Really thanks for the quick reply,

I want to find documents similar to one document (let's call it document A) in my index. To do this I use the MoreLikeThis class to help create query from document A. I also included document A in my index, so I assumed that I will have document A at the first rank. When I do the searching, I print out the top 10 documents along with their 
score. As I assumed before, I have document A in the first rank, but the score is above 1 (score=1.841656). 

I think lucene score have range [0..1] because it uses cosine similarity, where score 1 means that two documents are perfectly similar and 0 means that there are no similarity between two document, but why I get document score above 1?


 
Thanks,

-Clara


      
--0-246216264-1272389538=:73021--

From java-user-return-45932-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 17:38:33 2010
Return-Path: <java-user-return-45932-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7574 invoked from network); 27 Apr 2010 17:38:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 17:38:33 -0000
Received: (qmail 90953 invoked by uid 500); 27 Apr 2010 17:38:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90909 invoked by uid 500); 27 Apr 2010 17:38:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90901 invoked by uid 99); 27 Apr 2010 17:38:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 17:38:30 +0000
X-ASF-Spam-Status: No, hits=-0.4 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 17:38:24 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 579A3D36004
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 19:38:03 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id poSFtofT60o1 for <java-user@lucene.apache.org>;
	Tue, 27 Apr 2010 19:37:52 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 9E2C3D36003
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 19:37:51 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <195795.51783.qm@web110205.mail.gq1.yahoo.com> <029001cae5fb$492cb860$db862920$@de> <853701.73021.qm@web110209.mail.gq1.yahoo.com>
In-Reply-To: <853701.73021.qm@web110209.mail.gq1.yahoo.com>
Subject: RE: Range Score in Lucene
Date: Tue, 27 Apr 2010 19:38:04 +0200
Message-ID: <000901cae630$647db8a0$2d7929e0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrmL7GK8iRT/ni0QqGf8dNcEDRq8AAAI4og
Content-language: de

This hast o do with combining multiple terms in a Boolean query. If you =
have only one term and no boost factors involved, you will get 1. I just =
repeat, the score numbers are arbitrary scale, only compareable within =
one query.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Clara Vania [mailto:chubz_fun@yahoo.com]
> Sent: Tuesday, April 27, 2010 7:32 PM
> To: java-user@lucene.apache.org
> Subject: Re: Range Score in Lucene
>=20
> Really thanks for the quick reply,
>=20
> I want to find documents similar to one document (let's call it
> document A) in my index. To do this I use the MoreLikeThis class to
> help create query from document A. I also included document A in my
> index, so I assumed that I will have document A at the first rank. =
When
> I do the searching, I print out the top 10 documents along with their
> score. As I assumed before, I have document A in the first rank, but
> the score is above 1 (score=3D1.841656).
>=20
> I think lucene score have range [0..1] because it uses cosine
> similarity, where score 1 means that two documents are perfectly
> similar and 0 means that there are no similarity between two document,
> but why I get document score above 1?
>=20
>=20
>=20
> Thanks,
>=20
> -Clara
>=20
>=20
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45933-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 18:14:29 2010
Return-Path: <java-user-return-45933-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23157 invoked from network); 27 Apr 2010 18:14:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 18:14:29 -0000
Received: (qmail 48609 invoked by uid 500); 27 Apr 2010 18:14:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48577 invoked by uid 500); 27 Apr 2010 18:14:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48569 invoked by uid 99); 27 Apr 2010 18:14:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 18:14:26 +0000
X-ASF-Spam-Status: No, hits=-0.8 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 18:14:20 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 5749F71C32A; Tue, 27 Apr 2010 11:14:00 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 5558771C22A
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 11:14:00 -0700 (PDT)
Date: Tue, 27 Apr 2010 11:14:00 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: Base score to use for custom query?
In-Reply-To: <m2ndccc2ca91004232040x20147396v9ffa4aec51f7a3f0@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.1004271109330.5091@radix.cryptio.net>
References: <m2ndccc2ca91004232040x20147396v9ffa4aec51f7a3f0@mail.gmail.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


First off: if you haven't already make sure you OMIT_NORMS when indexing 
this field, that way you don't have to worry about docs with "lots" of 
numbers scoring low purely because of hte fieldNorm.

Second: i wouldn't bother with a custom query, i would stick with your 
BooleanQuery appraoch, but make sure you do two things:

1) add boosts to all of your TermQueries a boost based on how far they are 
from the end of hte range. so if you have a rangle like [10 19] give the 
19 clauses a boost of 1, the 18 clause a boost of 2, the 17 clause a boost 
of 3, etc...

2) disable the coord.  there is an option on BooleanQuery to do this, and 
it will make sure docs that only match one clause in your BooleanQuery 
dont' get a penalty compared to clauses that match many clauses in your 
BooleanQuery -- which is going to be important in ensuring that your 
boosts are useful.

That should get you what you want, and if not then take a look at the 
score explaiantions and see if anything obvious jumps out -- post a 
followup with your code and the score explanations if you can't solve it 
to your liking.

: I have a field in my document that contains a range of numbers. Say, for
: example, the universe of numbers is the range of integers from 0-100. My
: field represents a subrange of those numbers in a token stream. So, for
: example, if one document contains 20-30, it's token stream contains the
: terms [20, 21, 22, ..., 29]. Now I can quickly find all documents that
: contain some number.
: 
: The next part of the problem is searching for all documents that intersect
: with some subrange of numbers. Somewhat like a range query, but not exactly.
: Say I want to search for all documents that touch the range [10, 30]. My
: original implementation was to simply create a BooleanQuery full of
: TermQuerys for each term in the range i was searching for. While this
: returned the proper results, it did so with skewed scores. I'd prefer
: documents containing numbers towards the beginning of my search range to be
: scored higher than docs towards the end. So, if I had two documents, one
: with 10-20, and one with 20-30, and I searched for [19,30], both documents
: would be returned, but the second would be much more highly scored due to
: its higher number of matched terms.
: 
: So, my plan is to write a custom query which matches documents documents in
: my range in a way such as:


-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45934-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 18:48:07 2010
Return-Path: <java-user-return-45934-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48282 invoked from network); 27 Apr 2010 18:48:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 18:48:07 -0000
Received: (qmail 4269 invoked by uid 500); 27 Apr 2010 18:48:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4226 invoked by uid 500); 27 Apr 2010 18:48:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4218 invoked by uid 99); 27 Apr 2010 18:48:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 18:48:04 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.78] (HELO web32901.mail.mud.yahoo.com) (209.191.69.78)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 27 Apr 2010 18:47:56 +0000
Received: (qmail 35524 invoked by uid 60001); 27 Apr 2010 18:47:35 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272394055; bh=GQ7/La023lvPbolLGqcwXgflrv4YRI6MXA+y/Eow/0c=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=QY3Xwk3qKbPK5tR3GKhKzcvQMes3OLTujoDnLxjIXc9YYT7N+ott7RurTx0+VTe0z4tnvSs7ZuNsXR9dVEyaDZ7g2G2+Qu6bMO6cDgLp+Uz/cbbkA/zKBQahv9cBOBEshnoBp87U6NnW7wpkfH1lteGtv74SX8kwnYcHwBIZ7Ew=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=0KDwxAMyx1EAh90UASU7So0vtjLqz+mS+XdcqyNaeScrb/fk++oP2SYf5W7p7QEm8NEmG48bxMrSs1lSjxgrdBbtBg8o+oqoV5GrF7DgIJXmDUMb/82+WOIR5TnQG5lhxp27atp0Ns4spMmnTDO8FoT5j8cuVdFqEEB6cPSasgw=;
Message-ID: <149841.35092.qm@web32901.mail.mud.yahoo.com>
X-YMail-OSG: km__vI4VM1mCCz1Be1ajhBcYHqaHPDiLQTd0QHdqF62RA5i
 fOuQci7Zb9ExZ_e00bVHZ9d4pHghzDCyOaoC4WvCIFWFOPC9vBREVNzbltpx
 YmGtpfucWDYdjNDh59z6odVnTbxGw7qz8RroLPzkor0roY8pJEE_e0ZC.p4X
 dKcF_47FAekm2YC_qRydae9LEeqMpWIKPSxRqc44nycHSlCn7mMmeClmUSWG
 w9UQLK4XOYGFj5f9AWRekfxRcgznPqfhPa8g_GcdNo9gSZCVFFamjLV.3fxI
 mSbe6nMlKQI8lkkLCMu50RSLMc3ckWua5t8mirFJkwQEIBR95rlxGfhOOVp8
 -
Received: from [72.36.94.20] by web32901.mail.mud.yahoo.com via HTTP; Tue, 27 Apr 2010 11:47:35 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.102.267879
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com> <111835.48056.qm@web32903.mail.mud.yahoo.com> <027101cae5c6$8ff9f990$afedecb0$@de>
Date: Tue, 27 Apr 2010 11:47:35 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: HTMLStripReader, HTMLStripCharFilter
To: java-user@lucene.apache.org
In-Reply-To: <027101cae5c6$8ff9f990$afedecb0$@de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks for the help.  No more exception.  Seems odd that I need to add a filter to make reset apply to the stream's underlying reader.




----- Original Message ----
From: Uwe Schindler <uwe@thetaphi.de>
To: java-user@lucene.apache.org
Sent: Tue, April 27, 2010 12:00:31 AM
Subject: RE: HTMLStripReader, HTMLStripCharFilter

To reset this token stream you have to wrap it with a CachingTokenFilter.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Justin [mailto:crynax@yahoo.com]
> Sent: Tuesday, April 27, 2010 1:16 AM
> To: java-user@lucene.apache.org
> Subject: Re: HTMLStripReader, HTMLStripCharFilter
> 
> Thanks for the update!  I appreciate the hard work.
> 
> Perhaps someone can help me with the use of HTMLStripCharFilter...
> 
> 
> I get an exception (3.1-dev) similar to the one reported here (2.9):
> 
> https://issues.apache.org/jira/browse/LUCENE-1695
> 
> 
> With the following code:
> 
>     Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
>         @Override
>         protected TokenStreamComponents createComponents(
>                 final String fieldName, final Reader reader) {
>             return new TokenStreamComponents(new
> StandardTokenizer(Version.LUCENE_30,
>                     new HTMLStripCharFilter(CharReader.get(reader))));
>         }
>     };
>     String content = reader.document(id, fieldSelector).get(field);
>     TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
> StringReader(content));
>     String best = highlighter.getBestFragments(ts, content,
>       DEFAULT_EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);
>     OffsetAttribute off = ts.addAttribute(OffsetAttribute.class);
>     ts.reset();
>     ts.incrementToken();
> 
> 
> java.io.IOException: Stream closed
>         at java.io.StringReader.ensureOpen(StringReader.java:39)
>         at java.io.StringReader.read(StringReader.java:73)
>         at
> org.apache.lucene.analysis.CharReader.read(CharReader.java:54)
>         at java.io.Reader.read(Reader.java:104)
>         at
> org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.j
> ava:92)
>         at
> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
> ava:690)
>         at
> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
> ava:748)
>         at
> org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(Stan
> dardTokenizerImpl.java:453)
>         at
> org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(
> StandardTokenizerImpl.java:639)
>         at
> org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(St
> andardTokenizer.java:167)
> 
> 
> Looking at the source, I wonder if Tokenizer should override reset():
> 
>   public void reset() throws IOException {
>     if (input != null) input.reset(); // would reset CharReader,
> StringReader
>   }
> 
> 
> 
> 
> 
> ----- Original Message ----
> From: Robert Muir <rcmuir@gmail.com>
> To: java-user@lucene.apache.org
> Sent: Sat, April 24, 2010 9:03:02 AM
> Subject: Re: HTMLStripReader, HTMLStripCharFilter
> 
> On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:
> 
> > Just out of curiousity, why does LUCENE-1377 have a minor priorty?
> >
> > https://issues.apache.org/jira/browse/LUCENE-1377
> >
> > Don't people index, filter, search HTML, perhaps more than any other
> > format?
> >
> >
> Rest assured we are working on this... but it unfortunately won't
> happen
> overnight. First of all, the development of Lucene and Solr was merged
> such
> that there is now one team working on this stuff. This way, both Solr
> and
> Lucene developers can maintain this stuff.
> 
> There is now the practical issue to combine all Lucene and Solr
> analyzers
> (not just the two components listed on that issue) into one package
> that can
> then be used by both Lucene and Solr users:
> https://issues.apache.org/jira/browse/LUCENE-2413
> 
> --
> Robert Muir
> rcmuir@gmail.com
> 
> 
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45935-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 19:02:28 2010
Return-Path: <java-user-return-45935-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55862 invoked from network); 27 Apr 2010 19:02:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 19:02:28 -0000
Received: (qmail 25781 invoked by uid 500); 27 Apr 2010 19:02:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25755 invoked by uid 500); 27 Apr 2010 19:02:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25742 invoked by uid 99); 27 Apr 2010 19:02:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:02:25 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.194] (HELO mout.perfora.net) (74.208.4.194)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:02:17 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus2) with ESMTP (Nemesis)
	id 0MfmnM-1Njmsw3ZzQ-00NBzu; Tue, 27 Apr 2010 15:01:56 -0400
Message-ID: <34A4FC7202104E0691BBEF1250E28904@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com> <111835.48056.qm@web32903.mail.mud.yahoo.com> <027101cae5c6$8ff9f990$afedecb0$@de> <149841.35092.qm@web32901.mail.mud.yahoo.com>
Subject: Re: HTMLStripReader, HTMLStripCharFilter
Date: Tue, 27 Apr 2010 12:01:57 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX1/yEcG41UO9lfhqhiuronM5NBLSQjlqBmtme6w
 9NiD9Nbz2Urza6tRPxtWQVCR/KV7Pr6EsJot6c7z8s2MusmEcj
 votgGtOdwqfdmPG5ZVctw==
X-Virus-Checked: Checked by ClamAV on apache.org

Great, I will look forward to it.
Thanks,
Herb
----- Original Message ----- 
From: "Justin" <crynax@yahoo.com>
To: <java-user@lucene.apache.org>
Sent: Tuesday, April 27, 2010 11:47 AM
Subject: Re: HTMLStripReader, HTMLStripCharFilter


> Thanks for the help.  No more exception.  Seems odd that I need to add a 
> filter to make reset apply to the stream's underlying reader.
>
>
>
>
> ----- Original Message ----
> From: Uwe Schindler <uwe@thetaphi.de>
> To: java-user@lucene.apache.org
> Sent: Tue, April 27, 2010 12:00:31 AM
> Subject: RE: HTMLStripReader, HTMLStripCharFilter
>
> To reset this token stream you have to wrap it with a CachingTokenFilter.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
>> -----Original Message-----
>> From: Justin [mailto:crynax@yahoo.com]
>> Sent: Tuesday, April 27, 2010 1:16 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: HTMLStripReader, HTMLStripCharFilter
>>
>> Thanks for the update!  I appreciate the hard work.
>>
>> Perhaps someone can help me with the use of HTMLStripCharFilter...
>>
>>
>> I get an exception (3.1-dev) similar to the one reported here (2.9):
>>
>> https://issues.apache.org/jira/browse/LUCENE-1695
>>
>>
>> With the following code:
>>
>>     Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
>>         @Override
>>         protected TokenStreamComponents createComponents(
>>                 final String fieldName, final Reader reader) {
>>             return new TokenStreamComponents(new
>> StandardTokenizer(Version.LUCENE_30,
>>                     new HTMLStripCharFilter(CharReader.get(reader))));
>>         }
>>     };
>>     String content = reader.document(id, fieldSelector).get(field);
>>     TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
>> StringReader(content));
>>     String best = highlighter.getBestFragments(ts, content,
>>       DEFAULT_EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);
>>     OffsetAttribute off = ts.addAttribute(OffsetAttribute.class);
>>     ts.reset();
>>     ts.incrementToken();
>>
>>
>> java.io.IOException: Stream closed
>>         at java.io.StringReader.ensureOpen(StringReader.java:39)
>>         at java.io.StringReader.read(StringReader.java:73)
>>         at
>> org.apache.lucene.analysis.CharReader.read(CharReader.java:54)
>>         at java.io.Reader.read(Reader.java:104)
>>         at
>> org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.j
>> ava:92)
>>         at
>> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
>> ava:690)
>>         at
>> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
>> ava:748)
>>         at
>> org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(Stan
>> dardTokenizerImpl.java:453)
>>         at
>> org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(
>> StandardTokenizerImpl.java:639)
>>         at
>> org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(St
>> andardTokenizer.java:167)
>>
>>
>> Looking at the source, I wonder if Tokenizer should override reset():
>>
>>   public void reset() throws IOException {
>>     if (input != null) input.reset(); // would reset CharReader,
>> StringReader
>>   }
>>
>>
>>
>>
>>
>> ----- Original Message ----
>> From: Robert Muir <rcmuir@gmail.com>
>> To: java-user@lucene.apache.org
>> Sent: Sat, April 24, 2010 9:03:02 AM
>> Subject: Re: HTMLStripReader, HTMLStripCharFilter
>>
>> On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:
>>
>> > Just out of curiousity, why does LUCENE-1377 have a minor priorty?
>> >
>> > https://issues.apache.org/jira/browse/LUCENE-1377
>> >
>> > Don't people index, filter, search HTML, perhaps more than any other
>> > format?
>> >
>> >
>> Rest assured we are working on this... but it unfortunately won't
>> happen
>> overnight. First of all, the development of Lucene and Solr was merged
>> such
>> that there is now one team working on this stuff. This way, both Solr
>> and
>> Lucene developers can maintain this stuff.
>>
>> There is now the practical issue to combine all Lucene and Solr
>> analyzers
>> (not just the two components listed on that issue) into one package
>> that can
>> then be used by both Lucene and Solr users:
>> https://issues.apache.org/jira/browse/LUCENE-2413
>>
>> --
>> Robert Muir
>> rcmuir@gmail.com
>>
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45936-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 19:03:50 2010
Return-Path: <java-user-return-45936-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57340 invoked from network); 27 Apr 2010 19:03:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 19:03:49 -0000
Received: (qmail 28564 invoked by uid 500); 27 Apr 2010 19:03:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28526 invoked by uid 500); 27 Apr 2010 19:03:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28518 invoked by uid 99); 27 Apr 2010 19:03:47 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:03:47 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.208.4.195] (HELO mout.perfora.net) (74.208.4.195)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:03:41 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus0) with ESMTP (Nemesis)
	id 0MGCRL-1O9GE52i6Z-00FNPf; Tue, 27 Apr 2010 15:03:20 -0400
Message-ID: <5477909FCD03494CB959904BF7F7A0CA@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com> <111835.48056.qm@web32903.mail.mud.yahoo.com> <027101cae5c6$8ff9f990$afedecb0$@de> <149841.35092.qm@web32901.mail.mud.yahoo.com> <34A4FC7202104E0691BBEF1250E28904@Rissos>
Subject: Re: HTMLStripReader, HTMLStripCharFilter
Date: Tue, 27 Apr 2010 12:03:21 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=response
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX1+uNQ0yJhqXCusqFVuWVFUsaJkw2ccVB3poqyH
 rrguNO0PJA11cviameYcpQfCkleNfYkxAzd7w682DT0RSWvtZe
 Exf8j3fj3riNDnf4WGN3A==

Oops. Sorry.  replied to wrong message.
----- Original Message ----- 
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Sent: Tuesday, April 27, 2010 12:01 PM
Subject: Re: HTMLStripReader, HTMLStripCharFilter


> Great, I will look forward to it.
> Thanks,
> Herb
> ----- Original Message ----- 
> From: "Justin" <crynax@yahoo.com>
> To: <java-user@lucene.apache.org>
> Sent: Tuesday, April 27, 2010 11:47 AM
> Subject: Re: HTMLStripReader, HTMLStripCharFilter
>
>
>> Thanks for the help.  No more exception.  Seems odd that I need to add a 
>> filter to make reset apply to the stream's underlying reader.
>>
>>
>>
>>
>> ----- Original Message ----
>> From: Uwe Schindler <uwe@thetaphi.de>
>> To: java-user@lucene.apache.org
>> Sent: Tue, April 27, 2010 12:00:31 AM
>> Subject: RE: HTMLStripReader, HTMLStripCharFilter
>>
>> To reset this token stream you have to wrap it with a CachingTokenFilter.
>>
>> -----
>> Uwe Schindler
>> H.-H.-Meier-Allee 63, D-28213 Bremen
>> http://www.thetaphi.de
>> eMail: uwe@thetaphi.de
>>
>>
>>> -----Original Message-----
>>> From: Justin [mailto:crynax@yahoo.com]
>>> Sent: Tuesday, April 27, 2010 1:16 AM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: HTMLStripReader, HTMLStripCharFilter
>>>
>>> Thanks for the update!  I appreciate the hard work.
>>>
>>> Perhaps someone can help me with the use of HTMLStripCharFilter...
>>>
>>>
>>> I get an exception (3.1-dev) similar to the one reported here (2.9):
>>>
>>> https://issues.apache.org/jira/browse/LUCENE-1695
>>>
>>>
>>> With the following code:
>>>
>>>     Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
>>>         @Override
>>>         protected TokenStreamComponents createComponents(
>>>                 final String fieldName, final Reader reader) {
>>>             return new TokenStreamComponents(new
>>> StandardTokenizer(Version.LUCENE_30,
>>>                     new HTMLStripCharFilter(CharReader.get(reader))));
>>>         }
>>>     };
>>>     String content = reader.document(id, fieldSelector).get(field);
>>>     TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
>>> StringReader(content));
>>>     String best = highlighter.getBestFragments(ts, content,
>>>       DEFAULT_EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);
>>>     OffsetAttribute off = ts.addAttribute(OffsetAttribute.class);
>>>     ts.reset();
>>>     ts.incrementToken();
>>>
>>>
>>> java.io.IOException: Stream closed
>>>         at java.io.StringReader.ensureOpen(StringReader.java:39)
>>>         at java.io.StringReader.read(StringReader.java:73)
>>>         at
>>> org.apache.lucene.analysis.CharReader.read(CharReader.java:54)
>>>         at java.io.Reader.read(Reader.java:104)
>>>         at
>>> org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.j
>>> ava:92)
>>>         at
>>> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
>>> ava:690)
>>>         at
>>> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
>>> ava:748)
>>>         at
>>> org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(Stan
>>> dardTokenizerImpl.java:453)
>>>         at
>>> org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(
>>> StandardTokenizerImpl.java:639)
>>>         at
>>> org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(St
>>> andardTokenizer.java:167)
>>>
>>>
>>> Looking at the source, I wonder if Tokenizer should override reset():
>>>
>>>   public void reset() throws IOException {
>>>     if (input != null) input.reset(); // would reset CharReader,
>>> StringReader
>>>   }
>>>
>>>
>>>
>>>
>>>
>>> ----- Original Message ----
>>> From: Robert Muir <rcmuir@gmail.com>
>>> To: java-user@lucene.apache.org
>>> Sent: Sat, April 24, 2010 9:03:02 AM
>>> Subject: Re: HTMLStripReader, HTMLStripCharFilter
>>>
>>> On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:
>>>
>>> > Just out of curiousity, why does LUCENE-1377 have a minor priorty?
>>> >
>>> > https://issues.apache.org/jira/browse/LUCENE-1377
>>> >
>>> > Don't people index, filter, search HTML, perhaps more than any other
>>> > format?
>>> >
>>> >
>>> Rest assured we are working on this... but it unfortunately won't
>>> happen
>>> overnight. First of all, the development of Lucene and Solr was merged
>>> such
>>> that there is now one team working on this stuff. This way, both Solr
>>> and
>>> Lucene developers can maintain this stuff.
>>>
>>> There is now the practical issue to combine all Lucene and Solr
>>> analyzers
>>> (not just the two components listed on that issue) into one package
>>> that can
>>> then be used by both Lucene and Solr users:
>>> https://issues.apache.org/jira/browse/LUCENE-2413
>>>
>>> --
>>> Robert Muir
>>> rcmuir@gmail.com
>>>
>>>
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45937-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 19:11:34 2010
Return-Path: <java-user-return-45937-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61333 invoked from network); 27 Apr 2010 19:11:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 19:11:33 -0000
Received: (qmail 40164 invoked by uid 500); 27 Apr 2010 19:11:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40135 invoked by uid 500); 27 Apr 2010 19:11:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40125 invoked by uid 99); 27 Apr 2010 19:11:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:11:31 +0000
X-ASF-Spam-Status: No, hits=-0.4 required=10.0
	tests=AWL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:11:24 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 3091AD36004
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 21:11:03 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id rk7820JC8sK5 for <java-user@lucene.apache.org>;
	Tue, 27 Apr 2010 21:10:53 +0200 (CEST)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id C57E9D36003
	for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 21:10:52 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com> <111835.48056.qm@web32903.mail.mud.yahoo.com> <027101cae5c6$8ff9f990$afedecb0$@de> <149841.35092.qm@web32901.mail.mud.yahoo.com>
In-Reply-To: <149841.35092.qm@web32901.mail.mud.yahoo.com>
Subject: RE: HTMLStripReader, HTMLStripCharFilter
Date: Tue, 27 Apr 2010 21:11:06 +0200
Message-ID: <001501cae63d$63401ca0$29c055e0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrmOjLnEpYLIhU5QJmSXXFVhU+CQQAAoWOA
Content-language: de

A Reader can only be read one time, that=E2=80=99s the problem. =
Resetting a TokenStream is not able to reset the Reader (see =
java.io.Reader API). To reply the same tokens again, you must wrap with =
a Caching filter. This is also done in Highlighters code.

The general contract of reset() is not to reset the TokenStream to the =
beginning, it is just for reuse in reuseableTokenStream. =
CachingTokenFilter implements reset() in an incorrect way here, this is =
just left like so for backwards compatibility. The method in =
CachingTokenFilter should be named "rewind()".

You should *not* add the CachingTokenFilter to your Analyzer, as this is =
only needed for highlighting and similar use cases where a TokenStream =
needs to be read *multiple* times. So leave the Analyzer unchanged and =
wrap the return value of Analyzer.tokenStream() with the filter. Look =
into Highlighters source, how this is done there.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Justin [mailto:crynax@yahoo.com]
> Sent: Tuesday, April 27, 2010 8:48 PM
> To: java-user@lucene.apache.org
> Subject: Re: HTMLStripReader, HTMLStripCharFilter
>=20
> Thanks for the help.  No more exception.  Seems odd that I need to add
> a filter to make reset apply to the stream's underlying reader.
>=20
>=20
>=20
>=20
> ----- Original Message ----
> From: Uwe Schindler <uwe@thetaphi.de>
> To: java-user@lucene.apache.org
> Sent: Tue, April 27, 2010 12:00:31 AM
> Subject: RE: HTMLStripReader, HTMLStripCharFilter
>=20
> To reset this token stream you have to wrap it with a
> CachingTokenFilter.
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
> > -----Original Message-----
> > From: Justin [mailto:crynax@yahoo.com]
> > Sent: Tuesday, April 27, 2010 1:16 AM
> > To: java-user@lucene.apache.org
> > Subject: Re: HTMLStripReader, HTMLStripCharFilter
> >
> > Thanks for the update!  I appreciate the hard work.
> >
> > Perhaps someone can help me with the use of HTMLStripCharFilter...
> >
> >
> > I get an exception (3.1-dev) similar to the one reported here (2.9):
> >
> > https://issues.apache.org/jira/browse/LUCENE-1695
> >
> >
> > With the following code:
> >
> >     Analyzer htmlStripAnalyzer =3D new ReusableAnalyzerBase() {
> >         @Override
> >         protected TokenStreamComponents createComponents(
> >                 final String fieldName, final Reader reader) {
> >             return new TokenStreamComponents(new
> > StandardTokenizer(Version.LUCENE_30,
> >                     new
> HTMLStripCharFilter(CharReader.get(reader))));
> >         }
> >     };
> >     String content =3D reader.document(id, =
fieldSelector).get(field);
> >     TokenStream ts =3D htmlStripAnalyzer.tokenStream(field, new
> > StringReader(content));
> >     String best =3D highlighter.getBestFragments(ts, content,
> >       DEFAULT_EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);
> >     OffsetAttribute off =3D ts.addAttribute(OffsetAttribute.class);
> >     ts.reset();
> >     ts.incrementToken();
> >
> >
> > java.io.IOException: Stream closed
> >         at java.io.StringReader.ensureOpen(StringReader.java:39)
> >         at java.io.StringReader.read(StringReader.java:73)
> >         at
> > org.apache.lucene.analysis.CharReader.read(CharReader.java:54)
> >         at java.io.Reader.read(Reader.java:104)
> >         at
> >
> =
org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.j
> > ava:92)
> >         at
> >
> =
org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
> > ava:690)
> >         at
> >
> =
org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilter.j
> > ava:748)
> >         at
> >
> =
org.apache.lucene.analysis.standard.StandardTokenizerImpl.zzRefill(Stan
> > dardTokenizerImpl.java:453)
> >         at
> >
> =
org.apache.lucene.analysis.standard.StandardTokenizerImpl.getNextToken(
> > StandardTokenizerImpl.java:639)
> >         at
> >
> =
org.apache.lucene.analysis.standard.StandardTokenizer.incrementToken(St
> > andardTokenizer.java:167)
> >
> >
> > Looking at the source, I wonder if Tokenizer should override =
reset():
> >
> >   public void reset() throws IOException {
> >     if (input !=3D null) input.reset(); // would reset CharReader,
> > StringReader
> >   }
> >
> >
> >
> >
> >
> > ----- Original Message ----
> > From: Robert Muir <rcmuir@gmail.com>
> > To: java-user@lucene.apache.org
> > Sent: Sat, April 24, 2010 9:03:02 AM
> > Subject: Re: HTMLStripReader, HTMLStripCharFilter
> >
> > On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.com> wrote:
> >
> > > Just out of curiousity, why does LUCENE-1377 have a minor priorty?
> > >
> > > https://issues.apache.org/jira/browse/LUCENE-1377
> > >
> > > Don't people index, filter, search HTML, perhaps more than any
> other
> > > format?
> > >
> > >
> > Rest assured we are working on this... but it unfortunately won't
> > happen
> > overnight. First of all, the development of Lucene and Solr was
> merged
> > such
> > that there is now one team working on this stuff. This way, both =
Solr
> > and
> > Lucene developers can maintain this stuff.
> >
> > There is now the practical issue to combine all Lucene and Solr
> > analyzers
> > (not just the two components listed on that issue) into one package
> > that can
> > then be used by both Lucene and Solr users:
> > https://issues.apache.org/jira/browse/LUCENE-2413
> >
> > --
> > Robert Muir
> > rcmuir@gmail.com
> >
> >
> >
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45938-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 19:33:58 2010
Return-Path: <java-user-return-45938-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73394 invoked from network); 27 Apr 2010 19:33:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 19:33:58 -0000
Received: (qmail 61483 invoked by uid 500); 27 Apr 2010 19:33:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61328 invoked by uid 500); 27 Apr 2010 19:33:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61317 invoked by uid 99); 27 Apr 2010 19:33:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 19:33:55 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.191.69.82] (HELO web32905.mail.mud.yahoo.com) (209.191.69.82)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 27 Apr 2010 19:33:49 +0000
Received: (qmail 16342 invoked by uid 60001); 27 Apr 2010 19:33:27 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272396807; bh=yIeGYQJ7uwbPKYS6JnPcVAivBlHPgDdANnY0E1mGjG8=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=sQATq+3dZMferGNmSBpFutGGJMsFQ4Cxosp28O8yiMnlZPCOAwZ5BGaX2VuyHADATZMtOVmRhVMEug1jqDDdrNuV9k6cwJJ7ZfHG7mGWKuqmluwuaX4SY4gY8v1twnvWVeWHhYnj92HMW7c5W+uW5lCMPJpZtsTw7ZDq3k6NbEo=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=rb+oTuc9AC4goWO7P8b2Pah8RnbxqAY9c0gWWXT9ZEYJxvdItoQlTtIqxsSJfXSJ70xEuYYCXUJOVhDXZBQiAKFN9kANF0Mg6rbZWgl6qVhD4JPADIJeUXhwwh8JUtUF8HiliCNZLfDjk66OeDwsUJ+QDDeZFvt6u4Gh4AIDm3E=;
Message-ID: <734217.13718.qm@web32905.mail.mud.yahoo.com>
X-YMail-OSG: AjH8lMYVM1m_9iuPGRXwykhYlq1SVVqHFHydbAGf4NYki1k
 2TnV4RNtgyocFFEfx8bea_XtFpX13KqM4TY39VNJBMA2ARiNN2D7U1q.A4Is
 9zcImKaSfJmyY5Rv924_g4cggZs_QVlkiz48JMsAMuvRFgRAyyER17zHGfSI
 QARAbn_9ejDEqECDfP9IsU5mLO95oClxmqLMwAAU6C8.cz9A8_FMbv5PDGLe
 3XWr8e.ewegac0_QTfDgXjZ3FDYDuKFOcYgK9nXCx__BDnzojXSt2uX5..tf
 .W5tynIiShs1djZiaVz4HSkjVWqLLrSEHNCrqXlnwMurEh.6d6OG3w6vfn8S
 L0Yc2.gHl9gH4X6VEAyNSrstjs6g-
Received: from [72.36.94.20] by web32905.mail.mud.yahoo.com via HTTP; Tue, 27 Apr 2010 12:33:27 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.102.267879
References: <43985.50280.qm@web32907.mail.mud.yahoo.com> <h2w8f0ad1f31004240703t8f0b12a9j98eaf1f48e3434c7@mail.gmail.com> <111835.48056.qm@web32903.mail.mud.yahoo.com> <027101cae5c6$8ff9f990$afedecb0$@de> <149841.35092.qm@web32901.mail.mud.yahoo.com> <001501cae63d$63401ca0$29c055e0$@de>
Date: Tue, 27 Apr 2010 12:33:27 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: HTMLStripReader, HTMLStripCharFilter
To: java-user@lucene.apache.org
In-Reply-To: <001501cae63d$63401ca0$29c055e0$@de>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Thanks for the explanation.  The situation makes much more sense now.=0A=0A=
Fortunately, I did wrap the result of Analyzer.tokenStream().  I had contem=
plated adding it to the Analyzer as you described and warned not to.=0A=0A=
=0A=0A=0A----- Original Message ----=0AFrom: Uwe Schindler <uwe@thetaphi.de=
>=0ATo: java-user@lucene.apache.org=0ASent: Tue, April 27, 2010 2:11:06 PM=
=0ASubject: RE: HTMLStripReader, HTMLStripCharFilter=0A=0AA Reader can only=
 be read one time, that=E2=80=99s the problem. Resetting a TokenStream is n=
ot able to reset the Reader (see java.io.Reader API). To reply the same tok=
ens again, you must wrap with a Caching filter. This is also done in Highli=
ghters code.=0A=0AThe general contract of reset() is not to reset the Token=
Stream to the beginning, it is just for reuse in reuseableTokenStream. Cach=
ingTokenFilter implements reset() in an incorrect way here, this is just le=
ft like so for backwards compatibility. The method in CachingTokenFilter sh=
ould be named "rewind()".=0A=0AYou should *not* add the CachingTokenFilter =
to your Analyzer, as this is only needed for highlighting and similar use c=
ases where a TokenStream needs to be read *multiple* times. So leave the An=
alyzer unchanged and wrap the return value of Analyzer.tokenStream() with t=
he filter. Look into Highlighters source, how this is done there.=0A=0A----=
-=0AUwe Schindler=0AH.-H.-Meier-Allee 63, D-28213 Bremen=0Ahttp://www.theta=
phi.de=0AeMail: uwe@thetaphi.de=0A=0A=0A> -----Original Message-----=0A> Fr=
om: Justin [mailto:crynax@yahoo.com]=0A> Sent: Tuesday, April 27, 2010 8:48=
 PM=0A> To: java-user@lucene.apache.org=0A> Subject: Re: HTMLStripReader, H=
TMLStripCharFilter=0A> =0A> Thanks for the help.  No more exception.  Seems=
 odd that I need to add=0A> a filter to make reset apply to the stream's un=
derlying reader.=0A> =0A> =0A> =0A> =0A> ----- Original Message ----=0A> Fr=
om: Uwe Schindler <uwe@thetaphi.de>=0A> To: java-user@lucene.apache.org=0A>=
 Sent: Tue, April 27, 2010 12:00:31 AM=0A> Subject: RE: HTMLStripReader, HT=
MLStripCharFilter=0A> =0A> To reset this token stream you have to wrap it w=
ith a=0A> CachingTokenFilter.=0A> =0A> -----=0A> Uwe Schindler=0A> H.-H.-Me=
ier-Allee 63, D-28213 Bremen=0A> http://www.thetaphi.de=0A> eMail: uwe@thet=
aphi.de=0A> =0A> =0A> > -----Original Message-----=0A> > From: Justin [mail=
to:crynax@yahoo.com]=0A> > Sent: Tuesday, April 27, 2010 1:16 AM=0A> > To: =
java-user@lucene.apache.org=0A> > Subject: Re: HTMLStripReader, HTMLStripCh=
arFilter=0A> >=0A> > Thanks for the update!  I appreciate the hard work.=0A=
> >=0A> > Perhaps someone can help me with the use of HTMLStripCharFilter..=
.=0A> >=0A> >=0A> > I get an exception (3.1-dev) similar to the one reporte=
d here (2.9):=0A> >=0A> > https://issues.apache.org/jira/browse/LUCENE-1695=
=0A> >=0A> >=0A> > With the following code:=0A> >=0A> >     Analyzer htmlSt=
ripAnalyzer =3D new ReusableAnalyzerBase() {=0A> >         @Override=0A> > =
        protected TokenStreamComponents createComponents(=0A> >            =
     final String fieldName, final Reader reader) {=0A> >             retur=
n new TokenStreamComponents(new=0A> > StandardTokenizer(Version.LUCENE_30,=
=0A> >                     new=0A> HTMLStripCharFilter(CharReader.get(reade=
r))));=0A> >         }=0A> >     };=0A> >     String content =3D reader.doc=
ument(id, fieldSelector).get(field);=0A> >     TokenStream ts =3D htmlStrip=
Analyzer.tokenStream(field, new=0A> > StringReader(content));=0A> >     Str=
ing best =3D highlighter.getBestFragments(ts, content,=0A> >       DEFAULT_=
EXCERPT_FRAGS, DEFAULT_EXCERPT_SEPARATOR);=0A> >     OffsetAttribute off =
=3D ts.addAttribute(OffsetAttribute.class);=0A> >     ts.reset();=0A> >    =
 ts.incrementToken();=0A> >=0A> >=0A> > java.io.IOException: Stream closed=
=0A> >         at java.io.StringReader.ensureOpen(StringReader.java:39)=0A>=
 >         at java.io.StringReader.read(StringReader.java:73)=0A> >        =
 at=0A> > org.apache.lucene.analysis.CharReader.read(CharReader.java:54)=0A=
> >         at java.io.Reader.read(Reader.java:104)=0A> >         at=0A> >=
=0A> org.apache.solr.analysis.HTMLStripCharFilter.next(HTMLStripCharFilter.=
j=0A> > ava:92)=0A> >         at=0A> >=0A> org.apache.solr.analysis.HTMLStr=
ipCharFilter.read(HTMLStripCharFilter.j=0A> > ava:690)=0A> >         at=0A>=
 >=0A> org.apache.solr.analysis.HTMLStripCharFilter.read(HTMLStripCharFilte=
r.j=0A> > ava:748)=0A> >         at=0A> >=0A> org.apache.lucene.analysis.st=
andard.StandardTokenizerImpl.zzRefill(Stan=0A> > dardTokenizerImpl.java:453=
)=0A> >         at=0A> >=0A> org.apache.lucene.analysis.standard.StandardTo=
kenizerImpl.getNextToken(=0A> > StandardTokenizerImpl.java:639)=0A> >      =
   at=0A> >=0A> org.apache.lucene.analysis.standard.StandardTokenizer.incre=
mentToken(St=0A> > andardTokenizer.java:167)=0A> >=0A> >=0A> > Looking at t=
he source, I wonder if Tokenizer should override reset():=0A> >=0A> >   pub=
lic void reset() throws IOException {=0A> >     if (input !=3D null) input.=
reset(); // would reset CharReader,=0A> > StringReader=0A> >   }=0A> >=0A> =
>=0A> >=0A> >=0A> >=0A> > ----- Original Message ----=0A> > From: Robert Mu=
ir <rcmuir@gmail.com>=0A> > To: java-user@lucene.apache.org=0A> > Sent: Sat=
, April 24, 2010 9:03:02 AM=0A> > Subject: Re: HTMLStripReader, HTMLStripCh=
arFilter=0A> >=0A> > On Fri, Apr 23, 2010 at 4:48 PM, Justin <crynax@yahoo.=
com> wrote:=0A> >=0A> > > Just out of curiousity, why does LUCENE-1377 have=
 a minor priorty?=0A> > >=0A> > > https://issues.apache.org/jira/browse/LUC=
ENE-1377=0A> > >=0A> > > Don't people index, filter, search HTML, perhaps m=
ore than any=0A> other=0A> > > format?=0A> > >=0A> > >=0A> > Rest assured w=
e are working on this... but it unfortunately won't=0A> > happen=0A> > over=
night. First of all, the development of Lucene and Solr was=0A> merged=0A> =
> such=0A> > that there is now one team working on this stuff. This way, bo=
th Solr=0A> > and=0A> > Lucene developers can maintain this stuff.=0A> >=0A=
> > There is now the practical issue to combine all Lucene and Solr=0A> > a=
nalyzers=0A> > (not just the two components listed on that issue) into one =
package=0A> > that can=0A> > then be used by both Lucene and Solr users:=0A=
> > https://issues.apache.org/jira/browse/LUCENE-2413=0A> >=0A> > --=0A> > =
Robert Muir=0A> > rcmuir@gmail.com=0A> >=0A> >=0A> >=0A> >=0A> >=0A> > ----=
-----------------------------------------------------------------=0A> > To =
unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org=0A> > For addi=
tional commands, e-mail: java-user-help@lucene.apache.org=0A> =0A> =0A> =0A=
> ---------------------------------------------------------------------=0A>=
 To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org=0A> For ad=
ditional commands, e-mail: java-user-help@lucene.apache.org=0A> =0A> =0A> =
=0A> =0A> -----------------------------------------------------------------=
----=0A> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org=0A=
> For additional commands, e-mail: java-user-help@lucene.apache.org=0A=0A=
=0A=0A---------------------------------------------------------------------=
=0ATo unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org=0AFor ad=
ditional commands, e-mail: java-user-help@lucene.apache.org=0A=0A=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45939-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 20:03:17 2010
Return-Path: <java-user-return-45939-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89202 invoked from network); 27 Apr 2010 20:03:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 20:03:17 -0000
Received: (qmail 94988 invoked by uid 500); 27 Apr 2010 20:03:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94954 invoked by uid 500); 27 Apr 2010 20:03:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94946 invoked by uid 99); 27 Apr 2010 20:03:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 20:03:15 +0000
X-ASF-Spam-Status: No, hits=-0.9 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [130.225.24.68] (HELO sbexch03.sb.statsbiblioteket.dk) (130.225.24.68)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 20:03:09 +0000
Received: from SBMAILBOX1.sb.statsbiblioteket.dk ([10.150.5.1]) by
 sbexch03.sb.statsbiblioteket.dk ([10.150.5.3]) with mapi; Tue, 27 Apr 2010
 22:02:47 +0200
From: Toke Eskildsen <te@statsbiblioteket.dk>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 27 Apr 2010 22:02:46 +0200
Subject: RE: Right memory for search application
Thread-Topic: Right memory for search application
Thread-Index: AcrmEKxIZHcxUa1CTjuogbSJAuLGYgAMTrMK
Message-ID: <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
 	<i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>,<x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
In-Reply-To: <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
Accept-Language: en-US, da-DK
Content-Language: en-GB
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US, da-DK
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0

Samarendra Pratap [samarzone@gmail.com] wrote:
> 1. Our default option is sort by score, however almost 8% of searches use
> sorting on a field (yyyymmddHHMMSS). This field is indexed as string (not=
 as
> NumericField or DateField).

Guessing that the timestamp is practically unique for each document, sortin=
g by String takes up a bit more than
18M * (40 bytes + 2 * "yyyymmddHHMMSS".length() bytes) ~=3D 1.2 GB of RAM a=
s the Strings are cached. Coupled with the normal overhead of just opening =
an index of your size (500MB by your measurements?), I would have guessed t=
hat 3600MB would definitely be enough to open the index and do sorted searc=
hes.

I realize that fiddling with production servers is dangerous, but connectin=
g with JConsole and forcing a garbage collection might be acceptable? That =
should enable you to determine whether you're leaking memory or if it's jus=
t the JVM being greedy. I'd guess you leaking though, as HotSpot does not n=
ormally allocate up to the limit if it does not need to.

Anyway, changing to one of the optimized fields for sorting dates should sh=
ave 1 GB off the memory requirement, so I'll recommend doing that no matter=
 what the main cause of your memory problems is.

Regards,
Toke Eskildsen

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45940-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 21:38:13 2010
Return-Path: <java-user-return-45940-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5371 invoked from network); 27 Apr 2010 21:38:13 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 21:38:13 -0000
Received: (qmail 27785 invoked by uid 500); 27 Apr 2010 21:38:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27753 invoked by uid 500); 27 Apr 2010 21:38:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27745 invoked by uid 99); 27 Apr 2010 21:38:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 21:38:10 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=AWL,RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.208.4.194] (HELO mout.perfora.net) (74.208.4.194)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 21:38:05 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus4) with ESMTP (Nemesis)
	id 0MfFEA-1NmR9I3iRu-00OE8X; Tue, 27 Apr 2010 17:37:44 -0400
Message-ID: <D84DCF05ADF64E76B857C92D7410BBDA@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Subject: Trouble compiling JCC
Date: Tue, 27 Apr 2010 14:37:45 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 8bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX19JYOuDLu+4IxxtQ3X1seGMnNyOewqIN2UqNT8
 LGjy2wbC1/Fy+6MZdyGJbYsbHqC6C+VvaiCknLwLGBI2z1hLr2
 2KZkAXy6n9js0slXNF5nQ==

I'm trying to compile JCC, using  python setup.py build

This is what I get:

~/pylucene-2.9.2-1/jcc$ python setup.py build                   running 
build
running build_py
copying jcc/config.py -> build/lib.linux-x86_64-2.5/jcc
running build_ext
building 'jcc._jcc' extension
gcc -pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes 
 -fPIC -I/usr/lib/jdk/java-6-sun-1.6.0.17/include -I/usr/lib/jdk/java-6-sun-1.6.0.17/include/linux 
 -I_jcc -Ijcc/sources -I/usr/include/python2.5 -c jcc/sources/JArray.cpp -o 
build/temp.linux-x86_64-2.5/jcc/sources/JArray.o -DPYTHON -fno-strict-aliasing 
 -Wno-write-strings
cc1plus: warning: command line option "-Wstrict-prototypes" is valid for 
Ada/C/ObjC but not for C++
In file included from jcc/sources/JArray.cpp:21:
jcc/sources/JArray.h:483: error: redefinition of class JArray<signed char>
jcc/sources/JArray.h:337: error: previous definition of class JArray<signed 
char>
jcc/sources/JArray.cpp:961: error: redefinition of PyObject* JArray<signed 
char>::wrap()
jcc/sources/JArray.cpp:945: error: PyObject* JArray<signed char>::wrap() 
previously defined here
error: command 'gcc' failed with exit status 1

I saw a message posted (http://markmail.org/message/mi3uuwiuz5qb23rl ) 
saying that it is using the wrong header files., but I don't know how to 
change the header files that it is using.

I'm trying to build pylucene-2.9.2-1 on Ubuntu 8.04.

What other information would be useful?

Thanks,
Herb


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45941-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 22:43:09 2010
Return-Path: <java-user-return-45941-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36984 invoked from network); 27 Apr 2010 22:43:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 22:43:09 -0000
Received: (qmail 92989 invoked by uid 500); 27 Apr 2010 22:43:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92959 invoked by uid 500); 27 Apr 2010 22:43:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92951 invoked by uid 99); 27 Apr 2010 22:43:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 22:43:07 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jvolkman@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 22:43:00 +0000
Received: by vws7 with SMTP id 7so985626vws.35
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 15:42:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=tQsVOWcNSqTDRnjo4WdW3OkN3nX728YK9MpH2zQpSA4=;
        b=GLqtSQcn1On1ikGW6HIoW0VP5zHboOyoDhbH8+njfjjtOZQTBzCbF8cseJN+8bHWvy
         ORiG0UbLIZrRc+JO52afmG8SWmtnCdmqQreQPO4pZmh2vi121Y/rh3TFk9IOktvHgpb3
         NLPW5DjfVU/7w3kYZvZuHqgdw1CnIqtl4IkJo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=EaJsWKKmnUf0xtZEEfamgET8q/Z42xRBFEysmmBadF5DoQpXYk/3TMkzcNOZWa2DBR
         gUYPieH3rgHZokZoPZjWpnHSPldeAuPZGVf3kxe7XQC06E9Xlkv2eSgmf1u/ZneMjTYl
         w76iIrnF4mVp/7Xny1vvXGRXiSh+DbVrT8Nkg=
MIME-Version: 1.0
Received: by 10.220.124.101 with SMTP id t37mr4447876vcr.172.1272408159211; 
	Tue, 27 Apr 2010 15:42:39 -0700 (PDT)
Received: by 10.220.45.202 with HTTP; Tue, 27 Apr 2010 15:42:39 -0700 (PDT)
In-Reply-To: <Pine.LNX.4.64.1004271109330.5091@radix.cryptio.net>
References: <m2ndccc2ca91004232040x20147396v9ffa4aec51f7a3f0@mail.gmail.com>
	 <Pine.LNX.4.64.1004271109330.5091@radix.cryptio.net>
Date: Tue, 27 Apr 2010 18:42:39 -0400
Message-ID: <l2xdccc2ca91004271542y56a66dc8z2e805aa6b45537cb@mail.gmail.com>
Subject: Re: Base score to use for custom query?
From: Jeremy Volkman <jvolkman@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636d34fc256d19604853f9cc7
X-Virus-Checked: Checked by ClamAV on apache.org

--001636d34fc256d19604853f9cc7
Content-Type: text/plain; charset=ISO-8859-1

Hi Hoss,

I didn't end up writing my own query (well I did, but all it does is rewrite
into another query). I found DisjunctionMaxQuery, which seemed a good fit
for what I was trying to do. Instead of TermQuery, I used ConstantScoreQuery
combined with TermsFilter to create queries that weren't dependent upon the
Term's scores. For each ConstantScoreQuery, I set the boost much as you
suggested.

What's the difference in this case between using a DisjunctionMaxQuery,
which is what I've done, and using a BooleanQuery with disabled coord? And,
if I set omit norms, will TermQuery essential return constant scores for
terms? Does the use of DMQ + CSQ + TermsFilter throw up any red flags in
your experience?

Thanks again,
Jeremy

On Tue, Apr 27, 2010 at 2:14 PM, Chris Hostetter
<hossman_lucene@fucit.org>wrote:

>
> First off: if you haven't already make sure you OMIT_NORMS when indexing
> this field, that way you don't have to worry about docs with "lots" of
> numbers scoring low purely because of hte fieldNorm.
>
> Second: i wouldn't bother with a custom query, i would stick with your
> BooleanQuery appraoch, but make sure you do two things:
>
> 1) add boosts to all of your TermQueries a boost based on how far they are
> from the end of hte range. so if you have a rangle like [10 19] give the
> 19 clauses a boost of 1, the 18 clause a boost of 2, the 17 clause a boost
> of 3, etc...
>
> 2) disable the coord.  there is an option on BooleanQuery to do this, and
> it will make sure docs that only match one clause in your BooleanQuery
> dont' get a penalty compared to clauses that match many clauses in your
> BooleanQuery -- which is going to be important in ensuring that your
> boosts are useful.
>
> That should get you what you want, and if not then take a look at the
> score explaiantions and see if anything obvious jumps out -- post a
> followup with your code and the score explanations if you can't solve it
> to your liking.
>
> : I have a field in my document that contains a range of numbers. Say, for
> : example, the universe of numbers is the range of integers from 0-100. My
> : field represents a subrange of those numbers in a token stream. So, for
> : example, if one document contains 20-30, it's token stream contains the
> : terms [20, 21, 22, ..., 29]. Now I can quickly find all documents that
> : contain some number.
> :
> : The next part of the problem is searching for all documents that
> intersect
> : with some subrange of numbers. Somewhat like a range query, but not
> exactly.
> : Say I want to search for all documents that touch the range [10, 30]. My
> : original implementation was to simply create a BooleanQuery full of
> : TermQuerys for each term in the range i was searching for. While this
> : returned the proper results, it did so with skewed scores. I'd prefer
> : documents containing numbers towards the beginning of my search range to
> be
> : scored higher than docs towards the end. So, if I had two documents, one
> : with 10-20, and one with 20-30, and I searched for [19,30], both
> documents
> : would be returned, but the second would be much more highly scored due to
> : its higher number of matched terms.
> :
> : So, my plan is to write a custom query which matches documents documents
> in
> : my range in a way such as:
>
>
> -Hoss
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636d34fc256d19604853f9cc7--

From java-user-return-45942-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Apr 27 23:43:25 2010
Return-Path: <java-user-return-45942-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62824 invoked from network); 27 Apr 2010 23:43:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Apr 2010 23:43:25 -0000
Received: (qmail 35283 invoked by uid 500); 27 Apr 2010 23:43:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35253 invoked by uid 500); 27 Apr 2010 23:43:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35245 invoked by uid 99); 27 Apr 2010 23:43:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 23:43:23 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_HELO_PASS,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.208.4.194] (HELO mout.perfora.net) (74.208.4.194)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Apr 2010 23:43:17 +0000
Received: from Rissos (cpe-75-84-68-253.socal.res.rr.com [75.84.68.253])
	by mrelay.perfora.net (node=mrus3) with ESMTP (Nemesis)
	id 0MIMh5-1O7Bfm2J7X-0047vu; Tue, 27 Apr 2010 19:42:55 -0400
Message-ID: <896285C3653D4CE6BCDE73F8CB0B3906@Rissos>
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
References: <D84DCF05ADF64E76B857C92D7410BBDA@Rissos>
Subject: Re: Trouble compiling JCC
Date: Tue, 27 Apr 2010 16:42:56 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=response
Content-Transfer-Encoding: 8bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Provags-ID: V01U2FsdGVkX19YaOx3KLrSwnJNGZTaaJX34/jzu2Gt51xbiCN
 yj/HHOKeLTMqlnmXnh8ri8+9GIGhWAvRnz3HGFJwDOz06BSJUe
 YZSuGv5w82nSc/hVeqEmg==
X-Virus-Checked: Checked by ClamAV on apache.org

I found the error of my ways.  It was a typo.  For linux2 I directed 
setup.py to use
'linux2': '/usr/lib/jdk/java-6-sun-1.6.0.17',                 <--WRONG
rather than
'linux2': '/usr/lib/jvm/java-6-sun-1.6.0.17',

There was not a /usr/lib/jdk folder on my Ubuntu 8.04 box.


----- Original Message ----- 
From: "Herbert Roitblat" <herb@orcatec.com>
To: <java-user@lucene.apache.org>
Sent: Tuesday, April 27, 2010 2:37 PM
Subject: Trouble compiling JCC


> I'm trying to compile JCC, using  python setup.py build
>
> This is what I get:
>
> ~/pylucene-2.9.2-1/jcc$ python setup.py build                   running 
> build
> running build_py
> copying jcc/config.py -> build/lib.linux-x86_64-2.5/jcc
> running build_ext
> building 'jcc._jcc' extension
> gcc -pthread -fno-strict-aliasing -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes 
>  -fPIC -I/usr/lib/jdk/java-6-sun-1.6.0.17/include -I/usr/lib/jdk/java-6-sun-1.6.0.17/include/linux 
>  -I_jcc -Ijcc/sources -I/usr/include/python2.5 -c 
> jcc/sources/JArray.cpp -o 
> build/temp.linux-x86_64-2.5/jcc/sources/JArray.o -DPYTHON -fno-strict-aliasing 
>  -Wno-write-strings
> cc1plus: warning: command line option "-Wstrict-prototypes" is valid for 
> Ada/C/ObjC but not for C++
> In file included from jcc/sources/JArray.cpp:21:
> jcc/sources/JArray.h:483: error: redefinition of class JArray<signed 
> char>
> jcc/sources/JArray.h:337: error: previous definition of class 
> JArray<signed char>
> jcc/sources/JArray.cpp:961: error: redefinition of PyObject* 
> JArray<signed char>::wrap()
> jcc/sources/JArray.cpp:945: error: PyObject* JArray<signed char>::wrap() 
> previously defined here
> error: command 'gcc' failed with exit status 1
>
> I saw a message posted (http://markmail.org/message/mi3uuwiuz5qb23rl ) 
> saying that it is using the wrong header files., but I don't know how to 
> change the header files that it is using.
>
> I'm trying to build pylucene-2.9.2-1 on Ubuntu 8.04.
>
> What other information would be useful?
>
> Thanks,
> Herb
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45943-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 03:18:39 2010
Return-Path: <java-user-return-45943-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63144 invoked from network); 28 Apr 2010 03:18:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 03:18:39 -0000
Received: (qmail 76919 invoked by uid 500); 28 Apr 2010 03:18:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76646 invoked by uid 500); 28 Apr 2010 03:18:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76638 invoked by uid 99); 28 Apr 2010 03:18:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 03:18:36 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [67.195.8.186] (HELO web110210.mail.gq1.yahoo.com) (67.195.8.186)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Apr 2010 03:18:30 +0000
Received: (qmail 90487 invoked by uid 60001); 28 Apr 2010 03:18:08 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272424688; bh=suudKqBZI/YyZHEXiPYM4kvbFg7EgQeCvq9/R++OEFI=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=JcGQ3cGdVhnEgk7I2VTEnLOL1Agl3MjN0POvZfxvqzqpCFJ4yJ2SjObd1rzsroVPaXdtkiZFXvsjVlBkRw+mckpDBoA1ihztDe5VL9exyIhaaAoWcP5cwnfD63908NCgsArI0h+rhRtBlUwiuBwoUKpU3xfCbS4eapdaTusjd5s=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=pviTsWvK1gd+Gy+sFNLJ8BUnt9qzA0xRqLhGbEKXWpqtTUyQyLjLltm296N8iT0jvpAK2FUvyWIUC73QAcPrxe+plXiDX9Nw5ZVIPIaPd6MrqWSyK3hnZRQFu5Y2arV/d17yly169WFglHW8BQDuVV1o4Q6/7qLJq00yfakGV90=;
Message-ID: <863694.88845.qm@web110210.mail.gq1.yahoo.com>
X-YMail-OSG: g1wAknEVM1nWumm2e2DQTT3GD0eCTuF_P7yWzeSCtuPH.WY
 RmgEmwVhrUXP7salldK.sc4ouDfTIkjdqlpL6Jzra89HTGIyG6nH1sgIPuQ4
 9EBMXHSpCrNh.mvgsmmaxVeFeNCza1dso8OCqzu7yYetyLYIfvsBEMvVrmE5
 Ah0.RzzTim4uK4UbU8ch5OSc1ZlHT8SIuiXQhyIOkVeGZNrtoO_K9uVGcbhM
 KmhPQDBFJQSENJ_G3RrUl2niKT3juPn7YZ0R.lJSG.oc7.QEaI8klsmigGcl
 7R_tbhVsq8hRmrzbGDX0jWL63EVFaOGHwGVE.APyk9PCGYgaSAyL0GngyEYK
 s7K_oTGMc
Received: from [152.118.24.10] by web110210.mail.gq1.yahoo.com via HTTP; Tue, 27 Apr 2010 20:18:08 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
References: <195795.51783.qm@web110205.mail.gq1.yahoo.com> <029001cae5fb$492cb860$db862920$@de> <853701.73021.qm@web110209.mail.gq1.yahoo.com> <000901cae630$647db8a0$2d7929e0$@de>
Date: Tue, 27 Apr 2010 20:18:08 -0700 (PDT)
From: Clara Vania <chubz_fun@yahoo.com>
Subject: Re: Range Score in Lucene
To: java-user@lucene.apache.org
In-Reply-To: <000901cae630$647db8a0$2d7929e0$@de>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-469099874-1272424688=:88845"

--0-469099874-1272424688=:88845
Content-Type: text/plain; charset=us-ascii

Thanks again for your help!! :)

 
Regards,

-Clara Vania-





________________________________
From: Uwe Schindler <uwe@thetaphi.de>
To: java-user@lucene.apache.org
Sent: Wed, April 28, 2010 12:38:04 AM
Subject: RE: Range Score in Lucene

This hast o do with combining multiple terms in a Boolean query. If you have only one term and no boost factors involved, you will get 1. I just repeat, the score numbers are arbitrary scale, only compareable within one query.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Clara Vania [mailto:chubz_fun@yahoo.com]
> Sent: Tuesday, April 27, 2010 7:32 PM
> To: java-user@lucene.apache.org
> Subject: Re: Range Score in Lucene
> 
> Really thanks for the quick reply,
> 
> I want to find documents similar to one document (let's call it
> document A) in my index. To do this I use the MoreLikeThis class to
> help create query from document A. I also included document A in my
> index, so I assumed that I will have document A at the first rank. When
> I do the searching, I print out the top 10 documents along with their
> score. As I assumed before, I have document A in the first rank, but
> the score is above 1 (score=1.841656).
> 
> I think lucene score have range [0..1] because it uses cosine
> similarity, where score 1 means that two documents are perfectly
> similar and 0 means that there are no similarity between two document,
> but why I get document score above 1?
> 
> 
> 
> Thanks,
> 
> -Clara
> 
> 
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


      
--0-469099874-1272424688=:88845--

From java-user-return-45944-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 03:43:19 2010
Return-Path: <java-user-return-45944-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65788 invoked from network); 28 Apr 2010 03:43:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 03:43:19 -0000
Received: (qmail 86238 invoked by uid 500); 28 Apr 2010 03:43:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86074 invoked by uid 500); 28 Apr 2010 03:43:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86066 invoked by uid 99); 28 Apr 2010 03:43:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 03:43:16 +0000
X-ASF-Spam-Status: No, hits=0.6 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of goksron@gmail.com designates 209.85.221.191 as permitted sender)
Received: from [209.85.221.191] (HELO mail-qy0-f191.google.com) (209.85.221.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 03:43:10 +0000
Received: by qyk29 with SMTP id 29so1111660qyk.14
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 20:42:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=RCXnMNaQr6u0VUTK36Gvs3IHqteX56bl3o2/FMFmD9A=;
        b=igFxPD85pPNeVy0mMVKwgCFLlLATCN5nC/nLLQvXv7zSGpjVM/2GZXjZYBR89/N7ON
         WDEyord0fetPsvHpkuLbcXtliVFaHb4bltEb0V7jUec3vFcRValyIDkbNElnanWwAXVO
         Orxraad2pVY7mWSDukwXhYHidtuZb6HPugX04=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=ZmGvvQd+etan3TCgBvknfUzPqmP0kykreEh/vl8vJLXJk7WirBNd5y+GbYKp1nhMgf
         9yAWCmvRUZUFxdq/bvnMnCwMspJrtafbazwKWTDZokZetp1K7fss0HkR6sGjCu6bKRRS
         lFzGAP3twaa5wxRRzfsRZQFR8Uyu6zSupwXd8=
MIME-Version: 1.0
Received: by 10.229.250.206 with SMTP id mp14mr7925754qcb.62.1272426161782; 
	Tue, 27 Apr 2010 20:42:41 -0700 (PDT)
Received: by 10.229.192.11 with HTTP; Tue, 27 Apr 2010 20:42:41 -0700 (PDT)
In-Reply-To: <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
	 <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
	 <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
	 <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
Date: Tue, 27 Apr 2010 20:42:41 -0700
Message-ID: <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
Subject: Re: Right memory for search application
From: Lance Norskog <goksron@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Solr's timestamp representation (TrieDateField) is tuned for space and
speed. It has a compressed representation, and sorts with far less
space than Strings.

Also you get something called a date facet, which lets you bucketize
facet searches by time block.

On Tue, Apr 27, 2010 at 1:02 PM, Toke Eskildsen <te@statsbiblioteket.dk> wr=
ote:
> Samarendra Pratap [samarzone@gmail.com] wrote:
>> 1. Our default option is sort by score, however almost 8% of searches us=
e
>> sorting on a field (yyyymmddHHMMSS). This field is indexed as string (no=
t as
>> NumericField or DateField).
>
> Guessing that the timestamp is practically unique for each document, sort=
ing by String takes up a bit more than
> 18M * (40 bytes + 2 * "yyyymmddHHMMSS".length() bytes) ~=3D 1.2 GB of RAM=
 as the Strings are cached. Coupled with the normal overhead of just openin=
g an index of your size (500MB by your measurements?), I would have guessed=
 that 3600MB would definitely be enough to open the index and do sorted sea=
rches.
>
> I realize that fiddling with production servers is dangerous, but connect=
ing with JConsole and forcing a garbage collection might be acceptable? Tha=
t should enable you to determine whether you're leaking memory or if it's j=
ust the JVM being greedy. I'd guess you leaking though, as HotSpot does not=
 normally allocate up to the limit if it does not need to.
>
> Anyway, changing to one of the optimized fields for sorting dates should =
shave 1 GB off the memory requirement, so I'll recommend doing that no matt=
er what the main cause of your memory problems is.
>
> Regards,
> Toke Eskildsen
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20
Lance Norskog
goksron@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45945-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 06:25:21 2010
Return-Path: <java-user-return-45945-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26862 invoked from network); 28 Apr 2010 06:25:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 06:25:21 -0000
Received: (qmail 68166 invoked by uid 500); 28 Apr 2010 06:25:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67980 invoked by uid 500); 28 Apr 2010 06:25:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67971 invoked by uid 99); 28 Apr 2010 06:25:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 06:25:15 +0000
X-ASF-Spam-Status: No, hits=3.5 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.223.189 as permitted sender)
Received: from [209.85.223.189] (HELO mail-iw0-f189.google.com) (209.85.223.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 06:25:09 +0000
Received: by iwn27 with SMTP id 27so7098750iwn.5
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 23:24:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=bzIDRMxFT+qcJR61bGQX7k5daxweYCPJ9cIKZtbshTk=;
        b=V8x1gY0LoSKkjrqK05kZpQlX+W3QcqyGvmLHBlNzVMJCnSJMoEeR6+q2fz5sWTUH7z
         udoSg/f1U4/MaCxTVX8zqoqKcSMZY2BQjbCpXoyu1oadgMvP1a+duzXamzzIArBwrbzl
         9O/N7lJlpwpejI/accFLArGHnsDU/4BDrPNgo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=oWBD4a41aLRqswK7XWg5zjtOll0J6j7UQvuMZcbeFsf6QjSL8LJLkMDbEUOebvXAo8
         gyWm4JiBjd1tVfxKoQ+jMnvsKmxW3PVjp7jy0Lzy3u3uJJMGhqPx4k+QemcZI+Kzx5QF
         DMIkpnwBkC2P/DfaRpSkwH3O0LKaMvw/MQH5g=
Received: by 10.231.152.78 with SMTP id f14mr2241055ibw.51.1272435889155; Tue, 
	27 Apr 2010 23:24:49 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Tue, 27 Apr 2010 23:24:34 -0700 (PDT)
In-Reply-To: <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> 
	<i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com> 
	<x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com> 
	<2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk> 
	<s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Wed, 28 Apr 2010 11:54:34 +0530
Message-ID: <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
Subject: Re: Right memory for search application
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0050450146442c307d0485461133

--0050450146442c307d0485461133
Content-Type: text/plain; charset=ISO-8859-1

I have got a lot of valuable information in this thread so far.
Thanks to all.

In my last mail I mentioned only two fields because others' usage was
negligible and I thought they are not important. But now after *Toke *explained
the formulae, I think sorting on those fields would also be consuming a huge
part of memory.There are 2 other sorting fields; one of which is used in
both ascending/descending sorting.

Within next couple of days (or may be a week) I'll be

1. profiling my application,
2. analyzing and tuning GC options



However, I have a few more curiosities -

1. Tom wrote:

*Have you checked that your machine is correctly identified as a server*
*and has optimized GC settings?*

*I did not understand the meaning of "correctly identified as a server" Can
you please help me understand?*
*
*
2. *Should I change the type of fields?*
** As I said in my first mail that I have 56 fields in my index, most of
them contain a numeric value or one of system defined values (e.g. gender
field can contain only "male", "female", or "unknown"). There are only 7
fields which are indexed with user defined values.
All the fields are created with *Field*
(String name, String value, Field.Store store, Field.Index index)
It would be creating all the fields as normal string fields. Is it
*always*a good idea to use specific classes (NumericField, DateTime
etc.). We do not
have space problem if that matters.

3. *Is there any advice on number of fields?*
*Somewhere on the net I read that instead of keeping different type of
values in different fields, (e.g. field1:value1, field2:value2,...) one
should practice keeping different values in single field (e.g.
field:field1_value1,
field:field2_value2,...). But I could not confirm it from anywhere else. Any
comments?*

4. Ian wrote:

*Sorting by score down to the second will use a lot of memory.  Can you*
*make it less granular?*

Is it less painful sorting on two fields; first on yymmdd and then on
yymmddHHMMSS than sorting just on latter? (Naturally it should use second
field, only where required but technically ...?)


Thanks again for the invaluable support I am getting from here.

- Samar

On Wed, Apr 28, 2010 at 9:12 AM, Lance Norskog <goksron@gmail.com> wrote:

> Solr's timestamp representation (TrieDateField) is tuned for space and
> speed. It has a compressed representation, and sorts with far less
> space than Strings.
>
> Also you get something called a date facet, which lets you bucketize
> facet searches by time block.
>
> On Tue, Apr 27, 2010 at 1:02 PM, Toke Eskildsen <te@statsbiblioteket.dk>
> wrote:
> > Samarendra Pratap [samarzone@gmail.com] wrote:
> >> 1. Our default option is sort by score, however almost 8% of searches
> use
> >> sorting on a field (yyyymmddHHMMSS). This field is indexed as string
> (not as
> >> NumericField or DateField).
> >
> > Guessing that the timestamp is practically unique for each document,
> sorting by String takes up a bit more than
> > 18M * (40 bytes + 2 * "yyyymmddHHMMSS".length() bytes) ~= 1.2 GB of RAM
> as the Strings are cached. Coupled with the normal overhead of just opening
> an index of your size (500MB by your measurements?), I would have guessed
> that 3600MB would definitely be enough to open the index and do sorted
> searches.
> >
> > I realize that fiddling with production servers is dangerous, but
> connecting with JConsole and forcing a garbage collection might be
> acceptable? That should enable you to determine whether you're leaking
> memory or if it's just the JVM being greedy. I'd guess you leaking though,
> as HotSpot does not normally allocate up to the limit if it does not need
> to.
> >
> > Anyway, changing to one of the optimized fields for sorting dates should
> shave 1 GB off the memory requirement, so I'll recommend doing that no
> matter what the main cause of your memory problems is.
> >
> > Regards,
> > Toke Eskildsen
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
>
>
> --
> Lance Norskog
> goksron@gmail.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Regards,
Samar

--0050450146442c307d0485461133--

From java-user-return-45946-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 06:36:17 2010
Return-Path: <java-user-return-45946-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31425 invoked from network); 28 Apr 2010 06:36:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 06:36:17 -0000
Received: (qmail 78244 invoked by uid 500); 28 Apr 2010 06:36:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78070 invoked by uid 500); 28 Apr 2010 06:36:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78062 invoked by uid 99); 28 Apr 2010 06:36:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 06:36:11 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,MIME_BASE64_BLANKS,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of liuqingzhi2@gmail.com designates 209.85.222.119 as permitted sender)
Received: from [209.85.222.119] (HELO mail-pz0-f119.google.com) (209.85.222.119)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 06:36:02 +0000
Received: by pzk17 with SMTP id 17so534311pzk.20
        for <java-user@lucene.apache.org>; Tue, 27 Apr 2010 23:35:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to:references
         :subject:date:mime-version:content-type:content-transfer-encoding
         :x-priority:x-msmail-priority:x-mailer:x-mimeole;
        bh=6da8OTVQdt1Pq8/O9/RKZnz6eWnDWqLq48i/7EGT8uM=;
        b=uGWEKm7t9UG+81zAJLiTNHMvt8lZ1QBhQvoGUgSAWTCn6UlXWKDKgHrtX9VWqHs/dR
         BlWY27fwJDg2jPRrw3aUAsGH8KtbEgZFSmtVVTjRZdbW/QJeZqdIOepyMYETQ2J36ipJ
         hG1WxS4ewzz35BrgQxW8wKp4k8Gy8l3cXd/8A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:references:subject:date:mime-version
         :content-type:content-transfer-encoding:x-priority:x-msmail-priority
         :x-mailer:x-mimeole;
        b=nUDPPThLr/jhol5JJDUk45lkgSFY0WAtWolANysII/YbcIXW4+TMc5bB8XdJvXZRRT
         LrasHxuhhFtU6q12h/FvEJ4eqsW8r5BuWAm4lgRzPF/cGZ3MsKIm1ZUJXhaMTnc6CNj4
         a6xPFRdRBeVTcEa/AxaMu+6yN+hjyPo/5Q3eU=
Received: by 10.141.214.41 with SMTP id r41mr7483489rvq.77.1272436541169;
        Tue, 27 Apr 2010 23:35:41 -0700 (PDT)
Received: from HTSBM2X ([116.236.224.130])
        by mx.google.com with ESMTPS id g14sm1881372rvb.13.2010.04.27.23.35.38
        (version=SSLv3 cipher=RC4-MD5);
        Tue, 27 Apr 2010 23:35:40 -0700 (PDT)
Message-ID: <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X>
From: =?utf-8?B?5YiY5bqG5b+X?= <liuqingzhi2@gmail.com>
To: <java-user@lucene.apache.org>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com> <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com> <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk> <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com> <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
Subject: how to design Lucene Document and Field to indexing and searching email message and attachments
Date: Wed, 28 Apr 2010 14:35:34 +0800
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: base64
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

aGkgYWxsOg0Kb3VyIGJ1c3NpbmVzcyBzeXN0ZW0gZ2VuZXJhdGUgc29tZSBkYXRhLHRoYXQgaW5m
b3JtYXRpb24gc3RydWN0cnVlIGxpa2UgZW1haWwgbWVzc2FnZSxvbmUgbWVzc2FnZSBoYXZlIHNv
bWUgYXR0YWNobWVudHMsc28gd2UgY2FuIHVzZSBlbWFpbCBtZXNzYWdlIHRvIHRoaW5rIG9mIG91
ciBkYXRhLEkgbmVlZCBpbmRleCBhbmQgc2VhcmNoIHRoZSBtZXNzYWdlIGFuZCBpdHMgYXR0YWNo
bWVudHMsYW5kIHdoZW4gZGlzcGxheSBoaXRzLG11c3QgZGlzcGxheSB0d28ga2luZHMgb2YgbGlu
a3MgZm9yIGV2ZXJ5IGhpdDogb25lIGtpbmQgZm9yIG1lc3NhZ2UsYW5kIHRoZSBvdGhlciBmb3Ig
YXR0YWNobWVudHMgd2hpY2ggbWF0Y2ggdGhlIHF1ZXJ5IGNyaXRlcmlhLHNvIHRoZSBmb3JtZXIg
a2luZCB0aGVyZSBpcyBvbmx5IG9uZSBsaW5rLGJ1dCBsYXR0ZXIgbWF5IGJlIHplcm8gdG8gbiBs
aW5rcy4NCm9uZSBkZXNpZ24gbWF5IGJlIGFzOmZvciBldmVyeSBtZXNzYWdlIGRlc2lnbiBvbmUg
THVjZW5lIERvY3VtZW50LGl0IGhhcyBhIGZpZWxkIHRvIHJlY29yZCBpdHMgaWQsbGV0J3MgbmFt
ZSB0aGUgZmllbGQgaWQsYW4gb3RoZXIgZmllbGQgdG8gY29ycmVzcG9uZCBhbGwgaXRzIGF0dGFj
aG1lbnRzLGxldCdzIG5hbWUgdGhlIGZpZWxkIGF0dGFjaG1lbnRzLGFmZXJ0IHRoYXQgd2UgYWxz
byBkZXNpZ24gYSBMdWNlbmUgRG9jdW1lbnQgdG8gY29ycmVzcG9uZCBldmVyeSBtZXNzYWdlJ3Mg
ZXZlcnkgYXR0YWNobWVudCx0aGlzIERvY3VtZW50IGhhcyBhIGZpZWxkIHJlY29yZCBpdHMgbWVz
c2FnZSdzIGlkLGxldCdzIG5hbWUgdGhlIGZpZWxkIG1lc3NhZ2VpZCwgc28gd2hlbiBxdWVyeSx3
ZSBjYW4gcmV0cmlldmFsIG1lc3NhZ2VzIG1heSBiZSBpdHNlbGYncyBjb3RlbnQgb3IgaXRzIGF0
dGFjaG1lbnRzIGNvbnRlbnQgbWF0Y2ggdGhlIHF1ZXJ5IGNyaXRlcmlhLGZvciBnZW5lcmF0aW5n
IGxpbmtzIGZvciBhdHRhY2htZW50cyB3aGljaCBtYXRjaCB0aGUgcXVlcnkgY3JpdGVyaWEsd2Ug
Y2FuIHJlcXVleSBhZ2Fpbix0aGlzIHRpbWUgd2UgY2FuIHF1ZXJ5IG9ubHkgdGhlIG1lc3NhZ2Un
cyBhdHRhY2htZW50cyBieSBhZGRpbmcgYSBxdWVyeSBjb25kaXRpb24gdGhhdCBtZXNzYWdlaWQ9
ZmF0aGVyIHF1ZXJ5J3MgbWVzc2dlIGlkLml0J3Mgb2J2aW91c2x5LHRoZXJlIGFyZSB0d28gZGlz
YWR2YW50YWdlczogMSxpdCBpbmRleGVzIGF0dGFjaG1lbnRzIHR3aWNlLG9uZSBpbiBtZXNzYWdl
LGFuZCB0aGUgb3RoZXIgaW4gTHVjZW5lIERvY3VtZW50IGZvciBhdHRhY2htZW50LjIsdXNlcidz
IG9uZSBxdWVyeSBiZWNvbWVzIDErbiBxdWVyeSwxIGZvciBxdWVyeSBtZXNzYWdlIGFuZCBpdHMg
YWxsIGF0dGFjaG1lbnRzLG4gZm9yIHJlcXVlcnkgdGhlIG1lc3NhZ2UncyBldmVyeSBhdHRhY2ht
ZW50cy5pcyB0aGVyZSBhbnkgYmV0dGVyIHNvbHV0aW9uPyANCg0KDQpkYXpoaQ0KDQpUaGFua3Mg
Zm9yIGFueSBoaW50cyEhIQ0K



From java-user-return-45947-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 14:57:49 2010
Return-Path: <java-user-return-45947-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2109 invoked from network); 28 Apr 2010 14:57:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 14:57:49 -0000
Received: (qmail 44018 invoked by uid 500); 28 Apr 2010 14:57:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43952 invoked by uid 500); 28 Apr 2010 14:57:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43944 invoked by uid 99); 28 Apr 2010 14:57:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 14:57:46 +0000
X-ASF-Spam-Status: No, hits=1.8 required=10.0
	tests=AWL,FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 14:57:41 +0000
Received: by pwi7 with SMTP id 7so10819175pwi.35
        for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 07:57:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=QZs9OoRe38FH+/iBux1QJEmh65aBGHMDNFqHzpaVmlE=;
        b=akH1B7ZHijR/ZFiQbINNoS05pEaInMt6YUBtr2H2qMuLOqlaBY+Yv1CJ6E3W4HGi36
         1HlTAltnnrxbDsTwAiwYpicHGi3nHJqz3ayRZ/WQFXHQK30TRwtp8ktFcSjosBqpvl7B
         GmXl9YGEQXws7GDP7T3fmXLa92hgiamo/Rsq4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=czpY5FggzSiXTgQGR3SR21vU1QokPLO6b/quSn6c0Loq5Gh5c5MGJEzlMg2yS32G0e
         9pkeoigcBaq/FzvT0JN3rCUCafx5x+FVGR1/+nCJcmPcCn/GEexL50pnYUOisiPSJO3H
         /uaBFEgZOUWmMjxlrkpUPF4OnHboI25EUUGCE=
MIME-Version: 1.0
Received: by 10.141.15.21 with SMTP id s21mr8056014rvi.192.1272466638101; Wed, 
	28 Apr 2010 07:57:18 -0700 (PDT)
Received: by 10.151.43.7 with HTTP; Wed, 28 Apr 2010 07:57:17 -0700 (PDT)
In-Reply-To: <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
	 <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
	 <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
	 <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
	 <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
	 <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
Date: Wed, 28 Apr 2010 10:57:17 -0400
Message-ID: <q2y359a92831004280757ra7c51e83q8537a22f9611cd57@mail.gmail.com>
Subject: Re: Right memory for search application
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd1188af3fb1b04854d3945

--000e0cd1188af3fb1b04854d3945
Content-Type: text/plain; charset=ISO-8859-1

Quick reply to question (4). Not quite right, you're not gaining anything,
you still have a yymmddHHMMSS field that will consume all the memory
when you sort by it.

Remember that the controlling part here is the number of unique values. So
think about two fields, yymmdd and HHMMSS. Use the HHMMSS as the
secondary sort and yymmdd as the primary. This will sort correctly since
any time HHMMSS is used, the yymmdd is guaranteed be equal.

And you can extend this ad nauseum. For instance, you could use 6
fields, yy, mm, dd, HH, MM, SS and have a very small number of
unique values in each using really tiny amounts of memory to sort down
to the second in this case.

Best
Erick

On Wed, Apr 28, 2010 at 2:24 AM, Samarendra Pratap <samarzone@gmail.com>wrote:

> I have got a lot of valuable information in this thread so far.
> Thanks to all.
>
> In my last mail I mentioned only two fields because others' usage was
> negligible and I thought they are not important. But now after *Toke
> *explained
> the formulae, I think sorting on those fields would also be consuming a
> huge
> part of memory.There are 2 other sorting fields; one of which is used in
> both ascending/descending sorting.
>
> Within next couple of days (or may be a week) I'll be
>
> 1. profiling my application,
> 2. analyzing and tuning GC options
>
>
>
> However, I have a few more curiosities -
>
> 1. Tom wrote:
>
> *Have you checked that your machine is correctly identified as a server*
> *and has optimized GC settings?*
>
> *I did not understand the meaning of "correctly identified as a server" Can
> you please help me understand?*
> *
> *
> 2. *Should I change the type of fields?*
> ** As I said in my first mail that I have 56 fields in my index, most of
> them contain a numeric value or one of system defined values (e.g. gender
> field can contain only "male", "female", or "unknown"). There are only 7
> fields which are indexed with user defined values.
> All the fields are created with *Field*
> (String name, String value, Field.Store store, Field.Index index)
> It would be creating all the fields as normal string fields. Is it
> *always*a good idea to use specific classes (NumericField, DateTime
> etc.). We do not
> have space problem if that matters.
>
> 3. *Is there any advice on number of fields?*
> *Somewhere on the net I read that instead of keeping different type of
> values in different fields, (e.g. field1:value1, field2:value2,...) one
> should practice keeping different values in single field (e.g.
> field:field1_value1,
> field:field2_value2,...). But I could not confirm it from anywhere else.
> Any
> comments?*
>
> 4. Ian wrote:
>
> *Sorting by score down to the second will use a lot of memory.  Can you*
> *make it less granular?*
>
> Is it less painful sorting on two fields; first on yymmdd and then on
> yymmddHHMMSS than sorting just on latter? (Naturally it should use second
> field, only where required but technically ...?)
>
>
> Thanks again for the invaluable support I am getting from here.
>
> - Samar
>
> On Wed, Apr 28, 2010 at 9:12 AM, Lance Norskog <goksron@gmail.com> wrote:
>
> > Solr's timestamp representation (TrieDateField) is tuned for space and
> > speed. It has a compressed representation, and sorts with far less
> > space than Strings.
> >
> > Also you get something called a date facet, which lets you bucketize
> > facet searches by time block.
> >
> > On Tue, Apr 27, 2010 at 1:02 PM, Toke Eskildsen <te@statsbiblioteket.dk>
> > wrote:
> > > Samarendra Pratap [samarzone@gmail.com] wrote:
> > >> 1. Our default option is sort by score, however almost 8% of searches
> > use
> > >> sorting on a field (yyyymmddHHMMSS). This field is indexed as string
> > (not as
> > >> NumericField or DateField).
> > >
> > > Guessing that the timestamp is practically unique for each document,
> > sorting by String takes up a bit more than
> > > 18M * (40 bytes + 2 * "yyyymmddHHMMSS".length() bytes) ~= 1.2 GB of RAM
> > as the Strings are cached. Coupled with the normal overhead of just
> opening
> > an index of your size (500MB by your measurements?), I would have guessed
> > that 3600MB would definitely be enough to open the index and do sorted
> > searches.
> > >
> > > I realize that fiddling with production servers is dangerous, but
> > connecting with JConsole and forcing a garbage collection might be
> > acceptable? That should enable you to determine whether you're leaking
> > memory or if it's just the JVM being greedy. I'd guess you leaking
> though,
> > as HotSpot does not normally allocate up to the limit if it does not need
> > to.
> > >
> > > Anyway, changing to one of the optimized fields for sorting dates
> should
> > shave 1 GB off the memory requirement, so I'll recommend doing that no
> > matter what the main cause of your memory problems is.
> > >
> > > Regards,
> > > Toke Eskildsen
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> >
> >
> > --
> > Lance Norskog
> > goksron@gmail.com
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
>
> --
> Regards,
> Samar
>

--000e0cd1188af3fb1b04854d3945--

From java-user-return-45948-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 15:01:22 2010
Return-Path: <java-user-return-45948-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5178 invoked from network); 28 Apr 2010 15:01:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 15:01:22 -0000
Received: (qmail 52672 invoked by uid 500); 28 Apr 2010 15:01:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52644 invoked by uid 500); 28 Apr 2010 15:01:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52636 invoked by uid 99); 28 Apr 2010 15:01:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 15:01:19 +0000
X-ASF-Spam-Status: No, hits=0.6 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 15:01:14 +0000
Received: by pwi7 with SMTP id 7so10823598pwi.35
        for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 08:00:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=vyaP6unNqEAoxSu+2KOZ5Bc8Iy/KfvBPbJ+fNp7ijSs=;
        b=pJ8vdJTRntBCtAW+PpSPwpVuLYOXpmS3An7YXpLQ9XRxRZm6jicZSxAVYK866TZ4SF
         m4r4xinZN1MVHkXJrPV7UITjsAPj8udS9HjTEcwIT7AjBqwCfGL/9KII3vFHxu7NJIfo
         tHSeN1TW1CD7uOdzgjU6f2rQBTyZ3ZUjrVBrQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=GmwvYOa755XZiEovFkOAUBVd1GqNA3xsnG9bqJRCGVEUfkbPxuzBxMz/1AtHjItnzF
         PE1VM0gEcIFjctyZOV3cbyfHiSEcad3hBxWE+cSqbVpThdDsYoz3Esay/axBHoohoZA1
         Qo9Wq7b/dL+3yiBamPp32hOopEPtSmMqOThSM=
MIME-Version: 1.0
Received: by 10.141.90.5 with SMTP id s5mr4636264rvl.262.1272466848743; Wed, 
	28 Apr 2010 08:00:48 -0700 (PDT)
Received: by 10.151.43.7 with HTTP; Wed, 28 Apr 2010 08:00:48 -0700 (PDT)
In-Reply-To: <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
	 <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
	 <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
	 <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
	 <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
	 <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
	 <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X>
Date: Wed, 28 Apr 2010 11:00:48 -0400
Message-ID: <r2o359a92831004280800y15ec7774u8a884e8a611c67ca@mail.gmail.com>
Subject: Re: how to design Lucene Document and Field to indexing and searching 
	email message and attachments
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd50a5a83c00104854d4654

--000e0cd50a5a83c00104854d4654
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

This problem has been discussed several times, although I can't
remember the answer. So I'd recommend searching the mail archive
first.

Lucid maintains a searchable archive, see:
http://www.lucidimagination.com/About-Search

HTH
Erick

On Wed, Apr 28, 2010 at 2:35 AM, =E5=88=98=E5=BA=86=E5=BF=97 <liuqingzhi2@g=
mail.com> wrote:

> hi all:
> our bussiness system generate some data,that information structrue like
> email message,one message have some attachments,so we can use email messa=
ge
> to think of our data,I need index and search the message and its
> attachments,and when display hits,must display two kinds of links for eve=
ry
> hit: one kind for message,and the other for attachments which match the
> query criteria,so the former kind there is only one link,but latter may b=
e
> zero to n links.
> one design may be as:for every message design one Lucene Document,it has =
a
> field to record its id,let's name the field id,an other field to correspo=
nd
> all its attachments,let's name the field attachments,afert that we also
> design a Lucene Document to correspond every message's every attachment,t=
his
> Document has a field record its message's id,let's name the field message=
id,
> so when query,we can retrieval messages may be itself's cotent or its
> attachments content match the query criteria,for generating links for
> attachments which match the query criteria,we can requey again,this time =
we
> can query only the message's attachments by adding a query condition that
> messageid=3Dfather query's messge id.it's obviously,there are two
> disadvantages: 1,it indexes attachments twice,one in message,and the othe=
r
> in Lucene Document for attachment.2,user's one query becomes 1+n query,1 =
for
> query message and its all attachments,n for requery the message's every
> attachments.is there any better solution?
>
>
> dazhi
>
> Thanks for any hints!!!
>

--000e0cd50a5a83c00104854d4654--

From java-user-return-45949-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 17:54:29 2010
Return-Path: <java-user-return-45949-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11848 invoked from network); 28 Apr 2010 17:54:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 17:54:27 -0000
Received: (qmail 30984 invoked by uid 500); 28 Apr 2010 17:54:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30826 invoked by uid 500); 28 Apr 2010 17:54:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30718 invoked by uid 99); 28 Apr 2010 17:54:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 17:54:19 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of grant.ingersoll@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 17:54:11 +0000
Received: by vws13 with SMTP id 13so134580vws.35
        for <multiple recipients>; Wed, 28 Apr 2010 10:53:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:content-type:subject
         :date:references:to:message-id:mime-version:x-mailer;
        bh=LDRGIKNTGJ0dPBilnDc7oT2gpEI7e2hI2KPJOnipKMo=;
        b=MlSCeojsLyvWAKeYIirvVWfyu8ZOK9n+OT8PF+oHwGzoe91C8HiDGYrI6qjJaNr1zp
         zCdSOv4feWIDVw9QvZvlJkSogxcxQbP/nu91lwE3Bug8r+oXIcW82L8vvv6SPIQJs3o6
         V1wOr4DTmXULhR6f3PmNaJrHN0HoL1+0+Vlbk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:content-type:subject:date:references:to:message-id
         :mime-version:x-mailer;
        b=xGwSqAfhTGEDJkf5ZoeRoL2GAMjZp6L1YKE76LJjUPuqMjVTkMTJ5YSAtiRiED9jCO
         I4fWDBs09GTC6v0fxdC3ADUbJddc04Az7hMiq04zNxjZUMw8wT/z9q8EhlXB3b6T778o
         5H4i2oPNlLJ7UxU2YIUwkAwBceFXu/d3g2sys=
Received: by 10.220.123.137 with SMTP id p9mr5334642vcr.216.1272477229381;
        Wed, 28 Apr 2010 10:53:49 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id w29sm184842vcr.14.2010.04.28.10.53.46
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 28 Apr 2010 10:53:47 -0700 (PDT)
From: Grant Ingersoll <grant.ingersoll@gmail.com>
Content-Type: multipart/alternative; boundary=Apple-Mail-605--35235635
Subject: Fwd: Call for Participation: Technical Talks -- ApacheCon North America 2010
Date: Wed, 28 Apr 2010 13:53:44 -0400
References: <187333.31458.qm@web30803.mail.mud.yahoo.com>
To: Lucene mailing list <general@lucene.apache.org>,
 mahout-user@lucene.apache.org,
 dev@lucene.apache.org,
 java-user@lucene.apache.org,
 solr-user@lucene.apache.org,
 nutch-user@lucene.apache.org,
 tika-user@lucene.apache.org,
 lucene-net-dev@lucene.apache.org,
 lucy-dev@lucene.apache.org
Message-Id: <1862F17B-3A2D-497A-8BA7-5255AC9063F3@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1078)
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-605--35235635
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=windows-1252



Begin forwarded message:

> From: Sally Khudairi <sk@apache.org>
> Date: April 28, 2010 1:48:57 PM EDT
> To: announce@apachecon.com
> Subject: Call for Participation: Technical Talks -- ApacheCon North =
America 2010
> Reply-To: sk@apache.org
>=20
> ApacheCon North America 2010
> 1-5 November 2010 -- Westin Peachtree in Atlanta
>=20
> Technical Tracks: Call For Participation
> All submissions must be received by Friday, 28 May 2010 at midnight =
Pacific Time.
> The official conference, trainings, and expo of The Apache Software =
Foundation (ASF) returns to Atlanta this November, with dozens of =
technical, business, and community-focused sessions at the beginner, =
intermediate, and advanced levels.
>=20
> Over the past decade, the ASF has gone from strength to strength, =
developing and shepherding nearly 150 Top-Level Projects and new =
initiatives in the Apache Incubator and Labs. This year's ApacheCon =
celebrates how Apache technologies have sparked creativity, challenged =
processes, streamlined development, improved collaboration, launched =
businesses, bolstered economies, and improved lives.
>=20
> We are proud of our achievements and recognize that the global Apache =
community --both developers and users-- are responsible for the success =
and popularity of our products.
>=20
> The ApacheCon Planning Team are soliciting 50-minute technical =
presentations for the next conference, which will focus on the theme =
=93Servers, the Cloud, and Innovation=94.
>=20
> We are particularly interested in highly-relevant, =
professionally-directed presentations that demonstrate specific =
probrlems and real-world solutions. Part of the technical program has =
already been planned; we welcome proposals based on the following Apache =
Projects and related technical areas:
>=20
> - Cassandra/NoSQL
> - Content Technologies
> - (Java) Enterprise Development
> - Felix/OSGi
> - Geronimo
> - Hadoop + friends/Cloud Computing
> - Lucene, Mahout + friends/Search
> - Tomcat
> - Tuscany
> Submissions are open to anyone with relevant expertise: ASF =
affiliation is not required to present at, attend, or otherwise =
participate in ApacheCon.
>=20
> Please keep in mind that whilst we encourage submissions that the =
highlight the use of specific Apache solutions, we are unable to accept =
marketing/commercially-oriented presentations.
>=20
> Other proposals, such as panels, or those longer than 50 minutes in =
duration have been considered in the past. You are welcome to submit an =
alternate presentation, however, such sessions are accepted under =
exceptional circumstances. Please be as descriptive as possible, =
including names/bios of proposed panelists and any related details.
>=20
> All accepted speakers (not co-presenters) qualify for general =
conference admission and a minimum of two nights lodging at the =
conference hotel. Additional hotel nights and travel assistance are =
possible, depending on the number of presentations given and type of =
assistance needed.
>=20
> To submit a presentation proposal, please send an email to submissions =
AT apachecon DOT com containing the following information in plaintext =
(no attachments, please):
>=20
> 1. Your full name, title, and organization
>=20
> 2. Contact information, including your address
>=20
> 3. The name of your proposed session (keep your title simple and =
relevant to the topic)
>=20
> 4. The technical category of the intended presentation =
(Cassandra/NoSQL; Content Technologies; (Java) Enterprise Development; =
Felix/OSGi; Geronimo; Hadoop + friends/Cloud Computing; Lucene, Mahout + =
friends/Search; Tomcat; or Tuscany)
>=20
> 5. The classification for each presentation (Servers, Cloud, or =
Innovation) =96 some presentations may have more than one theme (e.g., a =
next-generation server can be classified both as "Servers" and =
"Innovation"
>=20
> 6. The intended audience level (beginner, intermediate, advanced)
>=20
> 7. A 75-200 word overview of your presentation
>=20
> 8. A 100-200-word speaker bio that includes prior conference speaking =
or related experience
>=20
> 9. Feedback or references (with contact information) on presentations =
given within the last three years
>=20
> To be considered, proposals must be received by Friday, 28 May 2010 at =
midnight Pacific Time. Please email any questions regarding proposal =
submissions to cfp AT apachecon DOT com.
>=20
> Technical Tracks Key Dates
>=20
> 23 April 2010: Call For Participation Open
> 28 May 2010: Call For Participation Closes
> 11 June 2010: Speaker Acceptance/Rejection Notification
> 1-5 November 2010: ApacheCon NA 2010
> We look forward to seeing you in Atlanta!
>=20
> For the ApacheCon Planning team,
> Sally Khudairi, Program Lead
>=20
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: announce-unsubscribe@apachecon.com
> For additional commands, e-mail: announce-help@apachecon.com
>=20


--Apple-Mail-605--35235635--

From java-user-return-45950-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 17:54:54 2010
Return-Path: <java-user-return-45950-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12249 invoked from network); 28 Apr 2010 17:54:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 17:54:53 -0000
Received: (qmail 36117 invoked by uid 500); 28 Apr 2010 17:54:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35979 invoked by uid 500); 28 Apr 2010 17:54:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35921 invoked by uid 99); 28 Apr 2010 17:54:42 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 17:54:41 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,MISSING_HEADERS,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of gsiasf@gmail.com designates 209.85.211.200 as permitted sender)
Received: from [209.85.211.200] (HELO mail-yw0-f200.google.com) (209.85.211.200)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 17:54:36 +0000
Received: by ywh38 with SMTP id 38so7362747ywh.29
        for <multiple recipients>; Wed, 28 Apr 2010 10:54:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:from:mime-version
         :content-type:subject:date:in-reply-to:cc:references:message-id
         :x-mailer;
        bh=NZkH5srTY858NvJDyy21KIZzrh92vDNgbMCI1WekDHg=;
        b=qo4QoR2x+pEy7nNQfwInrHbUx1eolTzTFtB9ijSzNKKn1Ib8M/Y0gOneAgh5PFqfpv
         gAFbG/a1Je57FA2wm1vTxkM1l1jUUa94UvfjwwXBbMF/dNv16G9k4M9BjAH2F+k4a3yQ
         5o8G+5x30E1ybL1qDgpJTuK0nqutJ34/93EVM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:from:mime-version:content-type:subject:date:in-reply-to:cc
         :references:message-id:x-mailer;
        b=nINXqjQrAzqBnCoeHSeI41g6zsbpgidxu6+YOJ85Qpk5qffHWNuC8tU+6SAtvw5jLf
         4rrPdejSqZfd2Qt8vy/mOWocGv7/YedOEPgXF3eEYAdAsYTb6O8zFvtXFUiBow/zbKeD
         mzmOmnptL5+eeSmM+4A6zJT/DDTbNf0ZaCUiE=
Received: by 10.101.179.4 with SMTP id g4mr3399699anp.24.1272477254141;
        Wed, 28 Apr 2010 10:54:14 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id i8sm377817ana.9.2010.04.28.10.54.12
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 28 Apr 2010 10:54:13 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
From: Grant Ingersoll <gsingers@apache.org>
Mime-Version: 1.0 (Apple Message framework v1078)
Content-Type: multipart/alternative; boundary=Apple-Mail-606--35209370
Subject: Re: Call for Participation: Technical Talks -- ApacheCon North America 2010
Date: Wed, 28 Apr 2010 13:54:10 -0400
In-Reply-To: <1862F17B-3A2D-497A-8BA7-5255AC9063F3@gmail.com>
Cc: Lucene mailing list <general@lucene.apache.org>,
 mahout-user@lucene.apache.org,
 dev@lucene.apache.org,
 java-user@lucene.apache.org,
 solr-user@lucene.apache.org,
 nutch-user@lucene.apache.org,
 tika-user@lucene.apache.org,
 lucene-net-dev@lucene.apache.org,
 lucy-dev@lucene.apache.org
References: <187333.31458.qm@web30803.mail.mud.yahoo.com> <1862F17B-3A2D-497A-8BA7-5255AC9063F3@gmail.com>
Message-Id: <36A79546-705F-4122-874D-B905D5A26D56@apache.org>
X-Mailer: Apple Mail (2.1078)

--Apple-Mail-606--35209370
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=windows-1252


On Apr 28, 2010, at 1:53 PM, Grant Ingersoll wrote:

>=20
>=20
> Begin forwarded message:
>=20
>> From: Sally Khudairi <sk@apache.org>
>> Date: April 28, 2010 1:48:57 PM EDT
>> To: announce@apachecon.com
>> Subject: Call for Participation: Technical Talks -- ApacheCon North =
America 2010
>> Reply-To: sk@apache.org
>>=20
>> ApacheCon North America 2010
>> 1-5 November 2010 -- Westin Peachtree in Atlanta
>>=20
>> Technical Tracks: Call For Participation
>> All submissions must be received by Friday, 28 May 2010 at midnight =
Pacific Time.
>> The official conference, trainings, and expo of The Apache Software =
Foundation (ASF) returns to Atlanta this November, with dozens of =
technical, business, and community-focused sessions at the beginner, =
intermediate, and advanced levels.
>>=20
>> Over the past decade, the ASF has gone from strength to strength, =
developing and shepherding nearly 150 Top-Level Projects and new =
initiatives in the Apache Incubator and Labs. This year's ApacheCon =
celebrates how Apache technologies have sparked creativity, challenged =
processes, streamlined development, improved collaboration, launched =
businesses, bolstered economies, and improved lives.
>>=20
>> We are proud of our achievements and recognize that the global Apache =
community --both developers and users-- are responsible for the success =
and popularity of our products.
>>=20
>> The ApacheCon Planning Team are soliciting 50-minute technical =
presentations for the next conference, which will focus on the theme =
=93Servers, the Cloud, and Innovation=94.
>>=20
>> We are particularly interested in highly-relevant, =
professionally-directed presentations that demonstrate specific =
probrlems and real-world solutions. Part of the technical program has =
already been planned; we welcome proposals based on the following Apache =
Projects and related technical areas:
>>=20
>> - Cassandra/NoSQL
>> - Content Technologies
>> - (Java) Enterprise Development
>> - Felix/OSGi
>> - Geronimo
>> - Hadoop + friends/Cloud Computing
>> - Lucene, Mahout + friends/Search
>> - Tomcat
>> - Tuscany
>> Submissions are open to anyone with relevant expertise: ASF =
affiliation is not required to present at, attend, or otherwise =
participate in ApacheCon.
>>=20
>> Please keep in mind that whilst we encourage submissions that the =
highlight the use of specific Apache solutions, we are unable to accept =
marketing/commercially-oriented presentations.
>>=20
>> Other proposals, such as panels, or those longer than 50 minutes in =
duration have been considered in the past. You are welcome to submit an =
alternate presentation, however, such sessions are accepted under =
exceptional circumstances. Please be as descriptive as possible, =
including names/bios of proposed panelists and any related details.
>>=20
>> All accepted speakers (not co-presenters) qualify for general =
conference admission and a minimum of two nights lodging at the =
conference hotel. Additional hotel nights and travel assistance are =
possible, depending on the number of presentations given and type of =
assistance needed.
>>=20
>> To submit a presentation proposal, please send an email to =
submissions AT apachecon DOT com containing the following information in =
plaintext (no attachments, please):
>>=20
>> 1. Your full name, title, and organization
>>=20
>> 2. Contact information, including your address
>>=20
>> 3. The name of your proposed session (keep your title simple and =
relevant to the topic)
>>=20
>> 4. The technical category of the intended presentation =
(Cassandra/NoSQL; Content Technologies; (Java) Enterprise Development; =
Felix/OSGi; Geronimo; Hadoop + friends/Cloud Computing; Lucene, Mahout + =
friends/Search; Tomcat; or Tuscany)
>>=20
>> 5. The classification for each presentation (Servers, Cloud, or =
Innovation) =96 some presentations may have more than one theme (e.g., a =
next-generation server can be classified both as "Servers" and =
"Innovation"
>>=20
>> 6. The intended audience level (beginner, intermediate, advanced)
>>=20
>> 7. A 75-200 word overview of your presentation
>>=20
>> 8. A 100-200-word speaker bio that includes prior conference speaking =
or related experience
>>=20
>> 9. Feedback or references (with contact information) on presentations =
given within the last three years
>>=20
>> To be considered, proposals must be received by Friday, 28 May 2010 =
at midnight Pacific Time. Please email any questions regarding proposal =
submissions to cfp AT apachecon DOT com.
>>=20
>> Technical Tracks Key Dates
>>=20
>> 23 April 2010: Call For Participation Open
>> 28 May 2010: Call For Participation Closes
>> 11 June 2010: Speaker Acceptance/Rejection Notification
>> 1-5 November 2010: ApacheCon NA 2010
>> We look forward to seeing you in Atlanta!
>>=20
>> For the ApacheCon Planning team,
>> Sally Khudairi, Program Lead
>>=20
>>=20
>>=20
>>=20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: announce-unsubscribe@apachecon.com
>> For additional commands, e-mail: announce-help@apachecon.com
>>=20
>=20

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem using Solr/Lucene: =
http://www.lucidimagination.com/search


--Apple-Mail-606--35209370--

From java-user-return-45951-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Apr 28 19:05:03 2010
Return-Path: <java-user-return-45951-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55858 invoked from network); 28 Apr 2010 19:05:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Apr 2010 19:05:02 -0000
Received: (qmail 17818 invoked by uid 500); 28 Apr 2010 19:05:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17788 invoked by uid 500); 28 Apr 2010 19:05:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17780 invoked by uid 99); 28 Apr 2010 19:05:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 19:05:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Apr 2010 19:04:54 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 4A3D071C23E; Wed, 28 Apr 2010 12:04:33 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 3EB2671C23A
	for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 12:04:33 -0700 (PDT)
Date: Wed, 28 Apr 2010 12:04:33 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: how to design Lucene Document and Field to indexing and searching
 email message and attachments
In-Reply-To: <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X>
Message-ID: <Pine.LNX.4.64.1004281203440.17358@radix.cryptio.net>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
 <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
 <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
 <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
 <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
 <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
 <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
:     <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
:     <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
:     <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbibliotek
:     et.dk> <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
:     <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
: Subject: how to design Lucene Document and Field to indexing and searching
:     email message and attachments

http://people.apache.org/~hossman/#threadhijack
Thread Hijacking on Mailing Lists

When starting a new discussion on a mailing list, please do not reply to 
an existing message, instead start a fresh email.  Even if you change the 
subject line of your email, other mail headers still track which thread 
you replied to and your question is "hidden" in that thread and gets less 
attention.   It makes following discussions in the mailing list archives 
particularly difficult.
See Also:  http://en.wikipedia.org/wiki/User:DonDiego/Thread_hijacking



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45952-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 00:44:53 2010
Return-Path: <java-user-return-45952-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 38744 invoked from network); 29 Apr 2010 00:44:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 00:44:53 -0000
Received: (qmail 63881 invoked by uid 500); 29 Apr 2010 00:44:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63845 invoked by uid 500); 29 Apr 2010 00:44:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63836 invoked by uid 99); 29 Apr 2010 00:44:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 00:44:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [206.190.58.172] (HELO web55208.mail.re4.yahoo.com) (206.190.58.172)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 00:44:43 +0000
Received: (qmail 68711 invoked by uid 60001); 29 Apr 2010 00:44:22 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272501862; bh=qqVd7qIbzm2Z0sNEutfUDXiCJ4kK3s3uqVysE87eExA=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=mppFOJJolrMQFChxm1rOgVizLrqQnQ1dweXBoalkCwVrJMwF9qLBkH9pW+sR+q3wxvwP+wXN9dGOpPCLIqfnFmmaXdtcqSUjDzVqzrfc4SXTxlLvZh/kgiQK3gZgzEK99Zt1mJLWPlzdtUvJEfcr3M9h3CYRxWzZ+AyE5r3qRU0=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=RlKeNnabt5V/yG5CH9lyv3SFdLcEptOfsfjZXp6N6ax4kmqsR5oyiwdwwCeUVJYugHaC6ZBVkIb3h7BKtMEibpXqvW/eg+itJIeEBsW7NwTiWCHRyZYeGMWAuXLC6RQrrM099WXaeZ/w/gk257GvZaEBkEXj3rjTnUrMZhLm3cw=;
Message-ID: <466526.65747.qm@web55208.mail.re4.yahoo.com>
X-YMail-OSG: BlXo1TkVM1mW_WXknSfU7S2fEt6k_7MyCGcAjht_ikuy8KU
 EM7NQqM9h.erDRUo7JDJ.4XS5vT8W4mhQo2t8VTuCLdjHCfXDQTxXv.O_rnV
 cKcf0ZuOoIdy6IIdwOQ9nEfkwlJ8TnZe60q1OAfFGlMA1yYR0Wn5GPQcrieX
 0NAqzz7tEpCOCdumRsk8j49eaU3EtCrzoRhL.m7IXPYT4il2tOIciutNc5lG
 dVYkEynHbPS56A18m853GXP7S0pyQ0opaVrWXLK.ai5OZm.NVaU1.dOsxxkD
 sf1NMkuqetqz3umTHQOebpgD_exQKyljR1IKiQUlBD5Xrnmm9rTTd.KcALs1
 6mqQjbV3M9whnk98ocK9t2Z2vztfbTA--
Received: from [38.99.14.58] by web55208.mail.re4.yahoo.com via HTTP; Wed, 28 Apr 2010 17:44:22 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
Date: Wed, 28 Apr 2010 17:44:22 -0700 (PDT)
From: kannan chandrasekaran <ckannanck@yahoo.com>
Subject: Is the new  Lucene Query parser framework compatibility with older lucene versions ?
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1003215689-1272501862=:65747"

--0-1003215689-1272501862=:65747
Content-Type: text/plain; charset=us-ascii

Hi All,

I have a question regarding the new Lucene query parser framework in the contribs project.  

 My company's project is running on top of 2.4.0 release of Lucene. I am  trying to evaluate the new query parser framework that was added to the contribs project in the Lucene 2.9.0 release and looks like it might fit our needs.  Due to some custom additions done to the core Lucene code base,  we are currently unable to upgrade to the latest stable release.  

My questions:
1) Is it possible to use the contrib query parser framework with lucene 2.4.0 release ?  I know the documentation hints such compatibility (http://lucene.apache.org/java/3_0_1/api/contrib-queryparser/index.html)  but wanted to confirm the same.
2) Has anybody tried doing this before ? If yes, can you please let me know if there is anything I should be aware of while attempting this ?
3) Since its lot more flexible than the default query parser, is there a chance it would replace the query parser in the Lucene core ? If yes , any known timelines ? 

Kindly help me with these questions.

Thanks
Kannan



      
--0-1003215689-1272501862=:65747--

From java-user-return-45953-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 01:59:23 2010
Return-Path: <java-user-return-45953-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54333 invoked from network); 29 Apr 2010 01:59:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 01:59:22 -0000
Received: (qmail 20613 invoked by uid 500); 29 Apr 2010 01:59:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20578 invoked by uid 500); 29 Apr 2010 01:59:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20570 invoked by uid 99); 29 Apr 2010 01:59:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 01:59:20 +0000
X-ASF-Spam-Status: No, hits=4.1 required=10.0
	tests=AWL,FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,MIME_BASE64_BLANKS,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of liuqingzhi2@gmail.com designates 209.85.160.66 as permitted sender)
Received: from [209.85.160.66] (HELO mail-pw0-f66.google.com) (209.85.160.66)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 01:59:15 +0000
Received: by pwi10 with SMTP id 10so2470514pwi.5
        for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 18:58:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to:references
         :subject:date:mime-version:content-type:content-transfer-encoding
         :x-priority:x-msmail-priority:x-mailer:x-mimeole;
        bh=XpirYAJYum4goVqslLUlXrSThrIQMl7EqJcd2wtzO4A=;
        b=SL/L+wk7IJAgertz15NXLNR0SecTEarjjig1JInLfbjK42wxHNMIrDNNZYuhYU4VIu
         KOfKdPRiONAjcmehMyEy8Vx1gbY2jThXPXfThJM7Oj662sWlUcefafx5jhaRnGoaAbVi
         ZUqxm4zVXPBS5rFKjBzq2AhqeSSn053iNN+g8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:references:subject:date:mime-version
         :content-type:content-transfer-encoding:x-priority:x-msmail-priority
         :x-mailer:x-mimeole;
        b=pY0i8c87k8u0oUPQ2MqMK/vYbPA2sqRrewIXTf7FWi1oVXxvi8LG2L6jOQxWlenHvE
         OcZKB2j5Yp5+gUEsUyzZ2sSKTvXyitu9+PPwpz9bZPHOnb+PB/ws8DEna0IhRYkbMWDN
         uZKJkC2pX8uSjoDAJbandapzleoqeY6KymBX0=
Received: by 10.141.107.10 with SMTP id j10mr4473742rvm.282.1272506334425;
        Wed, 28 Apr 2010 18:58:54 -0700 (PDT)
Received: from HTSBM2X ([116.236.224.130])
        by mx.google.com with ESMTPS id h11sm199144rvm.21.2010.04.28.18.58.51
        (version=SSLv3 cipher=RC4-MD5);
        Wed, 28 Apr 2010 18:58:53 -0700 (PDT)
Message-ID: <3F4E931E55264E81B0847584C622BB89@HTSBM2X>
From: =?utf-8?B?5YiY5bqG5b+X?= <liuqingzhi2@gmail.com>
To: <java-user@lucene.apache.org>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com> <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com> <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk> <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com> <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com> <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X> <Pine.LNX.4.64.1004281203440.17358@radix.cryptio.net>
Subject: Re: how to design Lucene Document and Field to indexing and searching email message and attachments
Date: Thu, 29 Apr 2010 09:58:50 +0800
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: base64
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

SG9zczoNCiAgICBUaGFua3MgZm9yIHlvdXIgYW5zd2VyLGJ1dCB3aGF0IG1lYW5zIGZvciBSZWZl
cmVuY2VzOiA8dDJzODc2NmFhZWQxMDA0MjcwNTUxeGM0YzY2YzQ4bzEzNmYwZjA1NDhlMTQ1NzJA
bWFpbC5nbWFpbC5jb20+Pw0KDQogICAgSSBtYWtlIGEgbWlzdGFrZSB0byByZXBseSBvdGhlciB0
aHJlYWQncyBtZXNzYWdlLEkgcmVhbGl6ZSBpdCB3aGVuIEkgdmlzaXQgbWFpbGluZyBsaXN0IGFy
Y2hpdmVzIHRocm91Z2ggd2ViLCB0aGlzIGlzIG15IGZpcnN0IHRpbWUgdG8gdXNlIG1haWwgbGlz
dCxhbmQgSSdsbCB0YWtlIGNhcmUgb2YgdGhpcyBpbiBmdXR1cmUuDQogICAgICAgIA0KDQpkYXpo
aSANCiAgDQoNCi0tLS0tIE9yaWdpbmFsIE1lc3NhZ2UgLS0tLS0gDQpGcm9tOiAiQ2hyaXMgSG9z
dGV0dGVyIiA8aG9zc21hbl9sdWNlbmVAZnVjaXQub3JnPg0KVG86IDxqYXZhLXVzZXJAbHVjZW5l
LmFwYWNoZS5vcmc+DQpTZW50OiBUaHVyc2RheSwgQXByaWwgMjksIDIwMTAgMzowNCBBTQ0KU3Vi
amVjdDogUmU6IGhvdyB0byBkZXNpZ24gTHVjZW5lIERvY3VtZW50IGFuZCBGaWVsZCB0byBpbmRl
eGluZyBhbmQgc2VhcmNoaW5nIGVtYWlsIG1lc3NhZ2UgYW5kIGF0dGFjaG1lbnRzDQoNCg0KPiAN
Cj4gOiBSZWZlcmVuY2VzOiA8dDJzODc2NmFhZWQxMDA0MjcwNTUxeGM0YzY2YzQ4bzEzNmYwZjA1
NDhlMTQ1NzJAbWFpbC5nbWFpbC5jb20+DQo+IDogICAgIDxpMnI4YzRlNjg2MTEwMDQyNzA2MjN2
MzFjMjA5MDVyZmNkNmI1MTZjNDBmNmUzM0BtYWlsLmdtYWlsLmNvbT4NCj4gOiAgICAgPHgycTg3
NjZhYWVkMTAwNDI3MDY0OWljMDEzNjY3Zng5YjYzNGZiOWIzZWIyNGIxQG1haWwuZ21haWwuY29t
Pg0KPiA6ICAgICA8MkU2QTg5QTY0ODQ2M0E0RUJGMDkzQTkwNjJDMTY2ODMwMTgyOTNEREZFQ0VA
U0JNQUlMQk9YMS5zYi5zdGF0c2JpYmxpb3Rlaw0KPiA6ICAgICBldC5kaz4gPHMybzg3Yzk5ODMy
MTAwNDI3MjA0MnI0NjczOGQ4Nm43NTljNWE0YjE0N2RjZjJhQG1haWwuZ21haWwuY29tPg0KPiA6
ICAgICA8cDJ0ODc2NmFhZWQxMDA0MjcyMzI0bzE1ZWMwNDFlazZkMDI3MmJhMzQ3NGFlM0BtYWls
LmdtYWlsLmNvbT4NCj4gOiBTdWJqZWN0OiBob3cgdG8gZGVzaWduIEx1Y2VuZSBEb2N1bWVudCBh
bmQgRmllbGQgdG8gaW5kZXhpbmcgYW5kIHNlYXJjaGluZw0KPiA6ICAgICBlbWFpbCBtZXNzYWdl
IGFuZCBhdHRhY2htZW50cw0KPiANCj4gaHR0cDovL3Blb3BsZS5hcGFjaGUub3JnL35ob3NzbWFu
LyN0aHJlYWRoaWphY2sNCj4gVGhyZWFkIEhpamFja2luZyBvbiBNYWlsaW5nIExpc3RzDQo+IA0K
PiBXaGVuIHN0YXJ0aW5nIGEgbmV3IGRpc2N1c3Npb24gb24gYSBtYWlsaW5nIGxpc3QsIHBsZWFz
ZSBkbyBub3QgcmVwbHkgdG8gDQo+IGFuIGV4aXN0aW5nIG1lc3NhZ2UsIGluc3RlYWQgc3RhcnQg
YSBmcmVzaCBlbWFpbC4gIEV2ZW4gaWYgeW91IGNoYW5nZSB0aGUgDQo+IHN1YmplY3QgbGluZSBv
ZiB5b3VyIGVtYWlsLCBvdGhlciBtYWlsIGhlYWRlcnMgc3RpbGwgdHJhY2sgd2hpY2ggdGhyZWFk
IA0KPiB5b3UgcmVwbGllZCB0byBhbmQgeW91ciBxdWVzdGlvbiBpcyAiaGlkZGVuIiBpbiB0aGF0
IHRocmVhZCBhbmQgZ2V0cyBsZXNzIA0KPiBhdHRlbnRpb24uICAgSXQgbWFrZXMgZm9sbG93aW5n
IGRpc2N1c3Npb25zIGluIHRoZSBtYWlsaW5nIGxpc3QgYXJjaGl2ZXMgDQo+IHBhcnRpY3VsYXJs
eSBkaWZmaWN1bHQuDQo+IFNlZSBBbHNvOiAgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9V
c2VyOkRvbkRpZWdvL1RocmVhZF9oaWphY2tpbmcNCj4gDQo+IA0KPiANCj4gLUhvc3MNCj4gDQo+
IA0KPiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0NCj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVu
c3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+IEZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBl
LW1haWw6IGphdmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQo+



From java-user-return-45954-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 02:32:10 2010
Return-Path: <java-user-return-45954-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60179 invoked from network); 29 Apr 2010 02:32:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 02:32:10 -0000
Received: (qmail 40364 invoked by uid 500); 29 Apr 2010 02:32:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40239 invoked by uid 500); 29 Apr 2010 02:32:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40231 invoked by uid 99); 29 Apr 2010 02:32:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 02:32:07 +0000
X-ASF-Spam-Status: No, hits=0.9 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of adrianocrestani@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 02:32:01 +0000
Received: by gyf1 with SMTP id 1so8496182gyf.35
        for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 19:31:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=rS1oJRN+pCZ1qJNwD7yuHOCB/mjedr8zZ+5vBiDXgqU=;
        b=av9e6FmBc0qg3DLR+jx5sm7xPb2G2YpkfKjZ4uGvI+19J6ZgYm46nCLlO7PxotlhIW
         H3pKakOZYRuesn/c2wuueXv4QTLW30NfOwvp41tik21zBJetrpRyB+VWGlqePhT65fSi
         h3MsOfvsvJZFnbJiqA3TWriOrt8I2q2CJx8wA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=nM9enm1by16/pAQyJSoUiZ3RaAZXlTgh6EdL1f436LlxUQ+ldJfqwroikC14KAXUZ1
         tevwRkvMyfPENnJE02sdYZtFIMH4RIXWtNttQzMLSNKGwI08epcBQLK4a4bUUQ/2G8JT
         usX0+1Eqn8v2MAztEzQ53cI9VrfVsb9TSlYxw=
Received: by 10.231.190.149 with SMTP id di21mr788407ibb.41.1272508300115; 
	Wed, 28 Apr 2010 19:31:40 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.158.67 with HTTP; Wed, 28 Apr 2010 19:31:20 -0700 (PDT)
In-Reply-To: <466526.65747.qm@web55208.mail.re4.yahoo.com>
References: <466526.65747.qm@web55208.mail.re4.yahoo.com>
From: Adriano Crestani <adrianocrestani@gmail.com>
Date: Wed, 28 Apr 2010 22:31:20 -0400
Message-ID: <l2k55e2bf7e1004281931s2c69a515w96d1088ac2907d41@mail.gmail.com>
Subject: Re: Is the new Lucene Query parser framework compatibility with older 
	lucene versions ?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485e7733633c247048556ed23

--001485e7733633c247048556ed23
Content-Type: text/plain; charset=ISO-8859-1

Hi Kannan,

contrib-queryparser code is not compatible with 2.4 release because it uses
the Attribute API, which was only introduced in 2.9.

Regards,
Adriano Crestani

On Wed, Apr 28, 2010 at 8:44 PM, kannan chandrasekaran
<ckannanck@yahoo.com>wrote:

> Hi All,
>
> I have a question regarding the new Lucene query parser framework in the
> contribs project.
>
>  My company's project is running on top of 2.4.0 release of Lucene. I am
>  trying to evaluate the new query parser framework that was added to the
> contribs project in the Lucene 2.9.0 release and looks like it might fit our
> needs.  Due to some custom additions done to the core Lucene code base,  we
> are currently unable to upgrade to the latest stable release.
>
> My questions:
> 1) Is it possible to use the contrib query parser framework with lucene
> 2.4.0 release ?  I know the documentation hints such compatibility (
> http://lucene.apache.org/java/3_0_1/api/contrib-queryparser/index.html)
>  but wanted to confirm the same.
> 2) Has anybody tried doing this before ? If yes, can you please let me know
> if there is anything I should be aware of while attempting this ?
> 3) Since its lot more flexible than the default query parser, is there a
> chance it would replace the query parser in the Lucene core ? If yes , any
> known timelines ?
>
> Kindly help me with these questions.
>
> Thanks
> Kannan
>
>
>
>

--001485e7733633c247048556ed23--

From java-user-return-45955-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 03:28:11 2010
Return-Path: <java-user-return-45955-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64875 invoked from network); 29 Apr 2010 03:28:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 03:28:11 -0000
Received: (qmail 63330 invoked by uid 500); 29 Apr 2010 03:28:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63135 invoked by uid 500); 29 Apr 2010 03:28:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63126 invoked by uid 99); 29 Apr 2010 03:28:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 03:28:07 +0000
X-ASF-Spam-Status: No, hits=3.6 required=10.0
	tests=AWL,FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,MIME_BASE64_BLANKS,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of liuqingzhi2@gmail.com designates 209.85.222.119 as permitted sender)
Received: from [209.85.222.119] (HELO mail-pz0-f119.google.com) (209.85.222.119)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 03:28:01 +0000
Received: by pzk17 with SMTP id 17so607864pzk.20
        for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 20:27:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to:references
         :subject:date:mime-version:content-type:content-transfer-encoding
         :x-priority:x-msmail-priority:x-mailer:x-mimeole;
        bh=Dc6xTrxE57g+E5aHkksMEU++u5gv4yoMdUDUfdoTnKU=;
        b=CHSpCsJWZrNXM8phC88/y+ZfQxTgac4Ga0/mbb/WbwRS1GP4XPb4dsDFaAAwp4fJUp
         P69pZgD62JlXae3iLPTlKUlu3bFqoa5+ZHiMwS2K88l0Ty203kfAqM2mUsUUgdoxiGTE
         6DrSwg14WmFcT+/P4QlcDvnVSEjpEZ+maIG3s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:references:subject:date:mime-version
         :content-type:content-transfer-encoding:x-priority:x-msmail-priority
         :x-mailer:x-mimeole;
        b=UmCC1Imh7XSYUSTGob1TyH7Ea2SZ2la0bEkMwDcRVO61qJA15wQGDYxFXLTgYAtElt
         U3BtW6Mcpzue4aX6x3H4I2L1aX1s0MNsl81FjFv7JPO1AwLEEOO/7xto4y+IATHxP7ZR
         b2Y+EJNMltjcUYIUyLnjgDcN70XArPM7gmvkA=
Received: by 10.141.107.11 with SMTP id j11mr3037960rvm.199.1272511661254;
        Wed, 28 Apr 2010 20:27:41 -0700 (PDT)
Received: from HTSBM2X ([116.236.224.130])
        by mx.google.com with ESMTPS id g14sm234258rvb.1.2010.04.28.20.27.24
        (version=SSLv3 cipher=RC4-MD5);
        Wed, 28 Apr 2010 20:27:40 -0700 (PDT)
Message-ID: <2C4CA2ACB7F243ADBBFC8417B08AB2F7@HTSBM2X>
From: =?utf-8?B?5YiY5bqG5b+X?= <liuqingzhi2@gmail.com>
To: <java-user@lucene.apache.org>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com> <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com> <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk> <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com> <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com> <52CF5A4D5B2C4447A417CFE9CBA40F8E@HTSBM2X> <r2o359a92831004280800y15ec7774u8a884e8a611c67ca@mail.gmail.com>
Subject: Re: how to design Lucene Document and Field to indexing and searching email message and attachments
Date: Thu, 29 Apr 2010 11:27:14 +0800
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: base64
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5843
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

RXJpY2s6DQogICAgVGhhbmtzIGZvciB5b3VyIGluZm9ybWF0aW9uLiAgICANCiAgICBJIHNlYXJj
aCBmb3IgdGhlIHNpbWlsYXIgcXVlc3Rpb24gYW5kIGdldCBhIHZlcnkgbGlrZSBpc3N1ZTpCZXN0
IFByYWN0aWNlOiBlbWFpbHMgYW5kIGZpbGUtYXR0YWNobWVudHMgb24gMTUgQXVndXN0IDIwMDYs
aW4gbWFpbGluZyBsaXN0IGFyY2hpdmVzKGh0dHA6Ly9tYWlsLWFyY2hpdmVzLmFwYWNoZS5vcmcv
bW9kX21ib3gvbHVjZW5lLWphdmEtdXNlci8yMDA2MDgubWJveC9icm93c2VyKSxidXQgdGhlcmUg
aXMgbm8gZmluYWwgYW5zd2VyIGluIHRoYXQgdGhyZWFkLg0KICAgIA0KICAgICAgICANCg0KDQpk
YXpoaQ0KDQoNCg0KLS0tLS0gT3JpZ2luYWwgTWVzc2FnZSAtLS0tLSANCkZyb206ICJFcmljayBF
cmlja3NvbiIgPGVyaWNrZXJpY2tzb25AZ21haWwuY29tPg0KVG86IDxqYXZhLXVzZXJAbHVjZW5l
LmFwYWNoZS5vcmc+DQpTZW50OiBXZWRuZXNkYXksIEFwcmlsIDI4LCAyMDEwIDExOjAwIFBNDQpT
dWJqZWN0OiBSZTogaG93IHRvIGRlc2lnbiBMdWNlbmUgRG9jdW1lbnQgYW5kIEZpZWxkIHRvIGlu
ZGV4aW5nIGFuZCBzZWFyY2hpbmcgZW1haWwgbWVzc2FnZSBhbmQgYXR0YWNobWVudHMNCg0KDQpU
aGlzIHByb2JsZW0gaGFzIGJlZW4gZGlzY3Vzc2VkIHNldmVyYWwgdGltZXMsIGFsdGhvdWdoIEkg
Y2FuJ3QNCnJlbWVtYmVyIHRoZSBhbnN3ZXIuIFNvIEknZCByZWNvbW1lbmQgc2VhcmNoaW5nIHRo
ZSBtYWlsIGFyY2hpdmUNCmZpcnN0Lg0KDQpMdWNpZCBtYWludGFpbnMgYSBzZWFyY2hhYmxlIGFy
Y2hpdmUsIHNlZToNCmh0dHA6Ly93d3cubHVjaWRpbWFnaW5hdGlvbi5jb20vQWJvdXQtU2VhcmNo
DQoNCkhUSA0KRXJpY2sNCg0KT24gV2VkLCBBcHIgMjgsIDIwMTAgYXQgMjozNSBBTSwg5YiY5bqG
5b+XIDxsaXVxaW5nemhpMkBnbWFpbC5jb20+IHdyb3RlOg0KDQo+IGhpIGFsbDoNCj4gb3VyIGJ1
c3NpbmVzcyBzeXN0ZW0gZ2VuZXJhdGUgc29tZSBkYXRhLHRoYXQgaW5mb3JtYXRpb24gc3RydWN0
cnVlIGxpa2UNCj4gZW1haWwgbWVzc2FnZSxvbmUgbWVzc2FnZSBoYXZlIHNvbWUgYXR0YWNobWVu
dHMsc28gd2UgY2FuIHVzZSBlbWFpbCBtZXNzYWdlDQo+IHRvIHRoaW5rIG9mIG91ciBkYXRhLEkg
bmVlZCBpbmRleCBhbmQgc2VhcmNoIHRoZSBtZXNzYWdlIGFuZCBpdHMNCj4gYXR0YWNobWVudHMs
YW5kIHdoZW4gZGlzcGxheSBoaXRzLG11c3QgZGlzcGxheSB0d28ga2luZHMgb2YgbGlua3MgZm9y
IGV2ZXJ5DQo+IGhpdDogb25lIGtpbmQgZm9yIG1lc3NhZ2UsYW5kIHRoZSBvdGhlciBmb3IgYXR0
YWNobWVudHMgd2hpY2ggbWF0Y2ggdGhlDQo+IHF1ZXJ5IGNyaXRlcmlhLHNvIHRoZSBmb3JtZXIg
a2luZCB0aGVyZSBpcyBvbmx5IG9uZSBsaW5rLGJ1dCBsYXR0ZXIgbWF5IGJlDQo+IHplcm8gdG8g
biBsaW5rcy4NCj4gb25lIGRlc2lnbiBtYXkgYmUgYXM6Zm9yIGV2ZXJ5IG1lc3NhZ2UgZGVzaWdu
IG9uZSBMdWNlbmUgRG9jdW1lbnQsaXQgaGFzIGENCj4gZmllbGQgdG8gcmVjb3JkIGl0cyBpZCxs
ZXQncyBuYW1lIHRoZSBmaWVsZCBpZCxhbiBvdGhlciBmaWVsZCB0byBjb3JyZXNwb25kDQo+IGFs
bCBpdHMgYXR0YWNobWVudHMsbGV0J3MgbmFtZSB0aGUgZmllbGQgYXR0YWNobWVudHMsYWZlcnQg
dGhhdCB3ZSBhbHNvDQo+IGRlc2lnbiBhIEx1Y2VuZSBEb2N1bWVudCB0byBjb3JyZXNwb25kIGV2
ZXJ5IG1lc3NhZ2UncyBldmVyeSBhdHRhY2htZW50LHRoaXMNCj4gRG9jdW1lbnQgaGFzIGEgZmll
bGQgcmVjb3JkIGl0cyBtZXNzYWdlJ3MgaWQsbGV0J3MgbmFtZSB0aGUgZmllbGQgbWVzc2FnZWlk
LA0KPiBzbyB3aGVuIHF1ZXJ5LHdlIGNhbiByZXRyaWV2YWwgbWVzc2FnZXMgbWF5IGJlIGl0c2Vs
ZidzIGNvdGVudCBvciBpdHMNCj4gYXR0YWNobWVudHMgY29udGVudCBtYXRjaCB0aGUgcXVlcnkg
Y3JpdGVyaWEsZm9yIGdlbmVyYXRpbmcgbGlua3MgZm9yDQo+IGF0dGFjaG1lbnRzIHdoaWNoIG1h
dGNoIHRoZSBxdWVyeSBjcml0ZXJpYSx3ZSBjYW4gcmVxdWV5IGFnYWluLHRoaXMgdGltZSB3ZQ0K
PiBjYW4gcXVlcnkgb25seSB0aGUgbWVzc2FnZSdzIGF0dGFjaG1lbnRzIGJ5IGFkZGluZyBhIHF1
ZXJ5IGNvbmRpdGlvbiB0aGF0DQo+IG1lc3NhZ2VpZD1mYXRoZXIgcXVlcnkncyBtZXNzZ2UgaWQu
aXQncyBvYnZpb3VzbHksdGhlcmUgYXJlIHR3bw0KPiBkaXNhZHZhbnRhZ2VzOiAxLGl0IGluZGV4
ZXMgYXR0YWNobWVudHMgdHdpY2Usb25lIGluIG1lc3NhZ2UsYW5kIHRoZSBvdGhlcg0KPiBpbiBM
dWNlbmUgRG9jdW1lbnQgZm9yIGF0dGFjaG1lbnQuMix1c2VyJ3Mgb25lIHF1ZXJ5IGJlY29tZXMg
MStuIHF1ZXJ5LDEgZm9yDQo+IHF1ZXJ5IG1lc3NhZ2UgYW5kIGl0cyBhbGwgYXR0YWNobWVudHMs
biBmb3IgcmVxdWVyeSB0aGUgbWVzc2FnZSdzIGV2ZXJ5DQo+IGF0dGFjaG1lbnRzLmlzIHRoZXJl
IGFueSBiZXR0ZXIgc29sdXRpb24/DQo+DQo+DQo+IGRhemhpDQo+DQo+IFRoYW5rcyBmb3IgYW55
IGhpbnRzISEhDQo+DQo=



From java-user-return-45956-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 05:22:23 2010
Return-Path: <java-user-return-45956-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76661 invoked from network); 29 Apr 2010 05:22:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 05:22:23 -0000
Received: (qmail 17136 invoked by uid 500); 29 Apr 2010 05:22:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16927 invoked by uid 500); 29 Apr 2010 05:22:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16918 invoked by uid 99); 29 Apr 2010 05:22:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 05:22:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.58.167] (HELO web55203.mail.re4.yahoo.com) (206.190.58.167)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 05:22:11 +0000
Received: (qmail 44261 invoked by uid 60001); 29 Apr 2010 05:21:49 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272518509; bh=xwmeHLJM0yHWjD8Nl/7nk5uwn4pNRacc7OYQ/q3/1m0=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=GCu9B3g6hVpF+2HtcR099evmndwFOAbm0eZ25eyP9KCehhvUUkDT9SHbxmDYNZnv9WmAWC2J7MEXJW9GWab9Lm+cwibGEH415IyPREhW9ivi+Lo2QRvUE0pHk1s07W5mZa+hSSSYZtFVcsyE2d2SUG7Cyuq/KxHEVnXuB6w40nU=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=ZnZDAs0wXa+JyvE7gqLKw5Hy8+nnYO2M4/Tr1TqSmABNvw6y35u/4pFQ9XgxFG1xXyUHgBaT9Lha3FsYx+NvNEfeGDgVtGldMHVJcCu3BnQcA6+4c91kz3wyCqlSy74aDwm9+8vuPQ3+L9kTFTnqbnCR4v1l7+SN1Aou6ogj2/8=;
Message-ID: <672589.42640.qm@web55203.mail.re4.yahoo.com>
X-YMail-OSG: 8guXp98VM1mPY2_jMAyjRvONBYVJYr5eYJvZF7iUOilryJe
 df2myVewfuvw.5iNy63VstwqtmIsqUvFei5oYamRiHfj2wbV8zaMVF51kszN
 Ol4KOaNtDB0Krwl90_XV6Fj58r.F6GgJME2sp9ur4ZOh2CR0ntu2xhcVmaE8
 nGe3RWV9MtAzOFNtnqdIx4XfGbBkX3mruY9LDspXxd8AUcJzOWBDGLrMIztN
 40nksgYKoYSi95oVGpK196v1vDuf1WTTTqjrXgPqDdad.R9lQ.ntDvQV_9Hb
 KEuKSlrKXyF02k8wZDGKk_jpMq9K1pLUOiO1YgO5zjck9hbptibPNlWqSJPs
 -
Received: from [67.161.10.126] by web55203.mail.re4.yahoo.com via HTTP; Wed, 28 Apr 2010 22:21:49 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
References: <466526.65747.qm@web55208.mail.re4.yahoo.com> <l2k55e2bf7e1004281931s2c69a515w96d1088ac2907d41@mail.gmail.com>
Date: Wed, 28 Apr 2010 22:21:49 -0700 (PDT)
From: kannan chandrasekaran <ckannanck@yahoo.com>
Subject: Re: Is the new Lucene Query parser framework compatibility with older  lucene versions ?
To: java-user@lucene.apache.org
In-Reply-To: <l2k55e2bf7e1004281931s2c69a515w96d1088ac2907d41@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-976642837-1272518509=:42640"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-976642837-1272518509=:42640
Content-Type: text/plain; charset=us-ascii

Hi Adriano,

Ahhh !!! Good point...Thanks a ton for the quick response. 

Kannan




________________________________
From: Adriano Crestani <adrianocrestani@gmail.com>
To: java-user@lucene.apache.org
Sent: Wed, April 28, 2010 7:31:20 PM
Subject: Re: Is the new Lucene Query parser framework compatibility with older  lucene versions ?

Hi Kannan,

contrib-queryparser code is not compatible with 2.4 release because it uses
the Attribute API, which was only introduced in 2.9.

Regards,
Adriano Crestani

On Wed, Apr 28, 2010 at 8:44 PM, kannan chandrasekaran
<ckannanck@yahoo.com>wrote:

> Hi All,
>
> I have a question regarding the new Lucene query parser framework in the
> contribs project.
>
>  My company's project is running on top of 2.4.0 release of Lucene. I am
>  trying to evaluate the new query parser framework that was added to the
> contribs project in the Lucene 2.9.0 release and looks like it might fit our
> needs.  Due to some custom additions done to the core Lucene code base,  we
> are currently unable to upgrade to the latest stable release.
>
> My questions:
> 1) Is it possible to use the contrib query parser framework with lucene
> 2.4.0 release ?  I know the documentation hints such compatibility (
> http://lucene.apache.org/java/3_0_1/api/contrib-queryparser/index.html)
>  but wanted to confirm the same.
> 2) Has anybody tried doing this before ? If yes, can you please let me know
> if there is anything I should be aware of while attempting this ?
> 3) Since its lot more flexible than the default query parser, is there a
> chance it would replace the query parser in the Lucene core ? If yes , any
> known timelines ?
>
> Kindly help me with these questions.
>
> Thanks
> Kannan
>
>
>
>



      
--0-976642837-1272518509=:42640--

From java-user-return-45957-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 05:36:25 2010
Return-Path: <java-user-return-45957-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77607 invoked from network); 29 Apr 2010 05:36:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 05:36:25 -0000
Received: (qmail 25595 invoked by uid 500); 29 Apr 2010 05:36:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25409 invoked by uid 500); 29 Apr 2010 05:36:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25401 invoked by uid 99); 29 Apr 2010 05:36:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 05:36:22 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of samarzone@gmail.com designates 209.85.223.197 as permitted sender)
Received: from [209.85.223.197] (HELO mail-iw0-f197.google.com) (209.85.223.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 05:36:14 +0000
Received: by iwn35 with SMTP id 35so10500923iwn.21
        for <java-user@lucene.apache.org>; Wed, 28 Apr 2010 22:35:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=Dn65TEdrupPcDCfI6rZ9GR/b57UkFxRl9tD97STnmPc=;
        b=mq6dLOdeiF+/Xb7jiDTkRc2PteZgDXLJBL1uX/gFVfIWsoU3ZXKovqOlglP8TCYHBl
         sEBEfZAVrsgKPmRYDg1nFE+PMsQ8v6gUsvdmizoua5odBXCjdlaqrA3JQMbXwN/56gxZ
         El+giUiiaouVMkJaBIAmL9rNODGlUfjEkAHgU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=ZUHkjeHyFk84ohvfMVyTk0uAKE15+2IkDzBispqlGMdhc3gpFSE9Cev0m99SfGuZ/t
         dYJH7Hz1p6lFjF+003vkIIbQz/11RZgQNEpjArsyH6xkkDjGwW+TCmWL+KB8lSZFRJ2J
         S8nET7pyO51cxoui0eZc7E3vsFAdTgp0gtvDs=
Received: by 10.231.168.9 with SMTP id s9mr1210397iby.7.1272519353470; Wed, 28 
	Apr 2010 22:35:53 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.207.17 with HTTP; Wed, 28 Apr 2010 22:35:38 -0700 (PDT)
In-Reply-To: <q2y359a92831004280757ra7c51e83q8537a22f9611cd57@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com> 
	<i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com> 
	<x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com> 
	<2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk> 
	<s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com> 
	<p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com> 
	<q2y359a92831004280757ra7c51e83q8537a22f9611cd57@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Thu, 29 Apr 2010 11:05:38 +0530
Message-ID: <y2n8766aaed1004282235q2cd233acq63ed96f2fda33141@mail.gmail.com>
Subject: Re: Right memory for search application
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c92dcb08906d04855980cf
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c92dcb08906d04855980cf
Content-Type: text/plain; charset=ISO-8859-1

Great explanation Erick.
Thanks. I'll try that.

On Wed, Apr 28, 2010 at 8:27 PM, Erick Erickson <erickerickson@gmail.com>wrote:

> Quick reply to question (4). Not quite right, you're not gaining anything,
> you still have a yymmddHHMMSS field that will consume all the memory
> when you sort by it.
>
> Remember that the controlling part here is the number of unique values. So
> think about two fields, yymmdd and HHMMSS. Use the HHMMSS as the
> secondary sort and yymmdd as the primary. This will sort correctly since
> any time HHMMSS is used, the yymmdd is guaranteed be equal.
>
> And you can extend this ad nauseum. For instance, you could use 6
> fields, yy, mm, dd, HH, MM, SS and have a very small number of
> unique values in each using really tiny amounts of memory to sort down
> to the second in this case.
>
> Best
> Erick
>
> On Wed, Apr 28, 2010 at 2:24 AM, Samarendra Pratap <samarzone@gmail.com
> >wrote:
>
> > I have got a lot of valuable information in this thread so far.
> > Thanks to all.
> >
> > In my last mail I mentioned only two fields because others' usage was
> > negligible and I thought they are not important. But now after *Toke
> > *explained
> > the formulae, I think sorting on those fields would also be consuming a
> > huge
> > part of memory.There are 2 other sorting fields; one of which is used in
> > both ascending/descending sorting.
> >
> > Within next couple of days (or may be a week) I'll be
> >
> > 1. profiling my application,
> > 2. analyzing and tuning GC options
> >
> >
> >
> > However, I have a few more curiosities -
> >
> > 1. Tom wrote:
> >
> > *Have you checked that your machine is correctly identified as a server*
> > *and has optimized GC settings?*
> >
> > *I did not understand the meaning of "correctly identified as a server"
> Can
> > you please help me understand?*
> > *
> > *
> > 2. *Should I change the type of fields?*
> > ** As I said in my first mail that I have 56 fields in my index, most of
> > them contain a numeric value or one of system defined values (e.g. gender
> > field can contain only "male", "female", or "unknown"). There are only 7
> > fields which are indexed with user defined values.
> > All the fields are created with *Field*
> > (String name, String value, Field.Store store, Field.Index index)
> > It would be creating all the fields as normal string fields. Is it
> > *always*a good idea to use specific classes (NumericField, DateTime
> > etc.). We do not
> > have space problem if that matters.
> >
> > 3. *Is there any advice on number of fields?*
> > *Somewhere on the net I read that instead of keeping different type of
> > values in different fields, (e.g. field1:value1, field2:value2,...) one
> > should practice keeping different values in single field (e.g.
> > field:field1_value1,
> > field:field2_value2,...). But I could not confirm it from anywhere else.
> > Any
> > comments?*
> >
> > 4. Ian wrote:
> >
> > *Sorting by score down to the second will use a lot of memory.  Can you*
> > *make it less granular?*
> >
> > Is it less painful sorting on two fields; first on yymmdd and then on
> > yymmddHHMMSS than sorting just on latter? (Naturally it should use second
> > field, only where required but technically ...?)
> >
> >
> > Thanks again for the invaluable support I am getting from here.
> >
> > - Samar
> >
> > On Wed, Apr 28, 2010 at 9:12 AM, Lance Norskog <goksron@gmail.com>
> wrote:
> >
> > > Solr's timestamp representation (TrieDateField) is tuned for space and
> > > speed. It has a compressed representation, and sorts with far less
> > > space than Strings.
> > >
> > > Also you get something called a date facet, which lets you bucketize
> > > facet searches by time block.
> > >
> > > On Tue, Apr 27, 2010 at 1:02 PM, Toke Eskildsen <
> te@statsbiblioteket.dk>
> > > wrote:
> > > > Samarendra Pratap [samarzone@gmail.com] wrote:
> > > >> 1. Our default option is sort by score, however almost 8% of
> searches
> > > use
> > > >> sorting on a field (yyyymmddHHMMSS). This field is indexed as string
> > > (not as
> > > >> NumericField or DateField).
> > > >
> > > > Guessing that the timestamp is practically unique for each document,
> > > sorting by String takes up a bit more than
> > > > 18M * (40 bytes + 2 * "yyyymmddHHMMSS".length() bytes) ~= 1.2 GB of
> RAM
> > > as the Strings are cached. Coupled with the normal overhead of just
> > opening
> > > an index of your size (500MB by your measurements?), I would have
> guessed
> > > that 3600MB would definitely be enough to open the index and do sorted
> > > searches.
> > > >
> > > > I realize that fiddling with production servers is dangerous, but
> > > connecting with JConsole and forcing a garbage collection might be
> > > acceptable? That should enable you to determine whether you're leaking
> > > memory or if it's just the JVM being greedy. I'd guess you leaking
> > though,
> > > as HotSpot does not normally allocate up to the limit if it does not
> need
> > > to.
> > > >
> > > > Anyway, changing to one of the optimized fields for sorting dates
> > should
> > > shave 1 GB off the memory requirement, so I'll recommend doing that no
> > > matter what the main cause of your memory problems is.
> > > >
> > > > Regards,
> > > > Toke Eskildsen
> > > >
> > > > ---------------------------------------------------------------------
> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >
> > > >
> > >
> > >
> > >
> > > --
> > > Lance Norskog
> > > goksron@gmail.com
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> >
> > --
> > Regards,
> > Samar
> >
>



-- 
Regards,
Samar

--001636c92dcb08906d04855980cf--

From java-user-return-45958-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 07:47:57 2010
Return-Path: <java-user-return-45958-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8584 invoked from network); 29 Apr 2010 07:47:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 07:47:57 -0000
Received: (qmail 62753 invoked by uid 500); 29 Apr 2010 07:47:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61892 invoked by uid 500); 29 Apr 2010 07:47:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61881 invoked by uid 99); 29 Apr 2010 07:47:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 07:47:50 +0000
X-ASF-Spam-Status: No, hits=-0.8 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [130.225.24.68] (HELO sbexch03.sb.statsbiblioteket.dk) (130.225.24.68)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 07:47:44 +0000
Received: from [172.18.239.216] (172.18.239.216) by
 sbexch03.sb.statsbiblioteket.dk (130.225.24.68) with Microsoft SMTP Server id
 8.1.436.0; Thu, 29 Apr 2010 09:47:22 +0200
Subject: Re: Right memory for search application
From: Toke Eskildsen <te@statsbiblioteket.dk>
Reply-To: te@statsbiblioteket.dk
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
In-Reply-To: <q2y359a92831004280757ra7c51e83q8537a22f9611cd57@mail.gmail.com>
References: <t2s8766aaed1004270551xc4c66c48o136f0f0548e14572@mail.gmail.com>
	 <i2r8c4e68611004270623v31c20905rfcd6b516c40f6e33@mail.gmail.com>
	 <x2q8766aaed1004270649ic013667fx9b634fb9b3eb24b1@mail.gmail.com>
	 <2E6A89A648463A4EBF093A9062C16683018293DDFECE@SBMAILBOX1.sb.statsbiblioteket.dk>
	 <s2o87c998321004272042r46738d86n759c5a4b147dcf2a@mail.gmail.com>
	 <p2t8766aaed1004272324o15ec041ek6d0272ba3474ae3@mail.gmail.com>
	 <q2y359a92831004280757ra7c51e83q8537a22f9611cd57@mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"
Organization: State and University Library, Denmark
Date: Thu, 29 Apr 2010 09:47:21 +0200
Message-ID: <1272527241.9301.39.camel@te-laptop>
MIME-Version: 1.0
X-Mailer: Evolution 2.28.1 
Content-Transfer-Encoding: 7bit

On Wed, 2010-04-28 at 16:57 +0200, Erick Erickson wrote:
> And you can extend this ad nauseum. For instance, you could use 6
> fields, yy, mm, dd, HH, MM, SS and have a very small number of
> unique values in each using really tiny amounts of memory to sort down
> to the second in this case.

A reference to a String takes up 4 or 8 bytes, depending on JVM and
setup. When doing String-based sorting in Lucene, there will be a
reference for each document for each sort-field. With 18M documents,
this will be at least 18M * 4 bytes * 6 = 432 MB. Plus the negligible
amount of String objects. It is less than the previously estimated
1.2GB, but still worth noting.

- Toke


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45959-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 10:51:04 2010
Return-Path: <java-user-return-45959-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46037 invoked from network); 29 Apr 2010 10:51:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 10:51:03 -0000
Received: (qmail 94605 invoked by uid 500); 29 Apr 2010 10:51:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94349 invoked by uid 500); 29 Apr 2010 10:50:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94341 invoked by uid 99); 29 Apr 2010 10:50:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 10:50:56 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [217.12.10.238] (HELO web26201.mail.ukl.yahoo.com) (217.12.10.238)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 10:50:50 +0000
Received: (qmail 96836 invoked by uid 60001); 29 Apr 2010 10:50:29 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.de; s=s1024; t=1272538229; bh=/TVn1pPFpoq9em8LgjTtOrtbdES2QgAdNU8x+W4LCNs=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=ktC2I0B/r2b591Fyw4B+CQkcUhqCtNYDiiUMAsOOho8eLXs1/foJp9x2BfELXU1G2Norm5fk0FF1DZHb1bOnjLWhdJvznfpqVMBMWL9KGvHqBRY/R5nPkLFfrklnNxPjhVw+EGQCrxV4R9kVZ0/djZ1fyH21x1QQ2nLaJIKY5ME=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.de;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=v/uNIIaBmhof3xECXgYg2lRI+tbd7cZtqPV7wdJahM9EZWPJiZb37W4FAf46rSjDVQwDsXz6fqVUGParIIRGx9yFAGmrZduZ46ITxkTzWCQfF0PWbFD23I2FiNmkVn9NV+W/aHgJaClR9DbyLrab7/jlm7/qCK5CSNLGX9Y3VUo=;
Message-ID: <655195.95411.qm@web26201.mail.ukl.yahoo.com>
X-YMail-OSG: Bv3Y5doVM1mFu5YEiHQErdeZx792sqz81xj36l.B2hMiqyd
 Pc1HmQEAhGXDaviXzmpxQfRmF3FzwubvolkbcZchlGtadg9EvZ_A2nloT5xk
 akC6_oVKu3yv8qABybm3idZLHnocGr236WVtnR5ndFB4Eu1EKUXEYWxS2Htx
 jvjYpjIi2Akhk5AcTNrJhrOzdTD2y6REopQIcQAHV6wCPqYNBOsdvq904IMu
 WlV0UoIDNN7gGiXjPBSS78WgLXCAU9sB9mGW.xyF7axFAHENUHdn6eza.uOM
 -
Received: from [10.2.3.51] by web26201.mail.ukl.yahoo.com via HTTP; Thu, 29 Apr 2010 10:50:29 GMT
X-Mailer: YahooMailClassic/10.1.11 YahooMailWebService/0.8.103.269680
Date: Thu, 29 Apr 2010 10:50:29 +0000 (GMT)
From: Anna Hunecke <annahunecke@yahoo.de>
Subject: IOExceptions when optimising the index
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi!

we are using Lucene 2.4.1 in our app. It works great so far, but now a cust=
omer ran into a strange problem.
During the day, the search index is updated regularly with the newest chang=
es in the application. At night, when nothing much is happening in the appl=
ication, the index is optimised.
The updating during the day works fine, but during the optimizing, all kind=
s of strange exceptions occur:

java.io.IOException: Access is denied
at java.io.WinNTFileSystem.createFileExclusively(Native Method)
at java.io.File.createNewFile(Unknown Source)
at org.apache.lucene.store.SimpleFSLock.obtain(SimpleFSLockFactory.java:144=
)
at org.apache.lucene.store.Lock.obtain(Lock.java:73)
at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1070)
at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:566)

or=20

org.apache.lucene.store.LockReleaseFailedException: failed to delete search=
index\write.lock
at org.apache.lucene.store.SimpleFSLock.release(SimpleFSLockFactory.java:14=
9)
at org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:1668)
at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1602)
at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1578)

or=20

java.io.IOException: background merge hit exception: _dhi:c1195 _dlt:c33 in=
to _dlu [optimize]
Exception in thread "Lucene Merge Thread #0" =09at org.apache.lucene.index.=
IndexWriter.optimize(IndexWriter.java:2273)
at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2218)
at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2198)
...
Caused by: java.io.FileNotFoundException: searchindex\_dlu.fnm (The system =
cannot find the file specified)
at java.io.RandomAccessFile.open(Native Method)
at java.io.RandomAccessFile.<init>(Unknown Source)
at org.apache.lucene.store.FSDirectory$FSIndexInput$Descriptor.<init>(FSDir=
ectory.java:552)
at org.apache.lucene.store.FSDirectory$FSIndexInput.<init>(FSDirectory.java=
:582)
at org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:488)
at org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:482)
at org.apache.lucene.index.CompoundFileWriter.copyFile(CompoundFileWriter.j=
ava:221)
at org.apache.lucene.index.CompoundFileWriter.close(CompoundFileWriter.java=
:184)
at org.apache.lucene.index.SegmentMerger.createCompoundFile(SegmentMerger.j=
ava:204)
at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4263)
at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3884)
at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMerge=
Scheduler.java:205)
at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(Concurr=
entMergeScheduler.java:260)

The indexes look fine when I open them with Luke, and since the normal upda=
ting works, I don't think it has something to do with write-rights of the d=
isks.=20
So, what could be the cause of this?
And: How necessary is it really to run an optimisation every night? A lot o=
f changes take place when the program runs, so the search index is changed =
quite frequently. Maybe it is enough to let the automatic merging take care=
 of things?

Greets,
Anna=0A=0A

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45960-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 11:33:46 2010
Return-Path: <java-user-return-45960-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57414 invoked from network); 29 Apr 2010 11:33:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 11:33:45 -0000
Received: (qmail 55175 invoked by uid 500); 29 Apr 2010 11:33:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55031 invoked by uid 500); 29 Apr 2010 11:33:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55023 invoked by uid 99); 29 Apr 2010 11:33:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 11:33:42 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 11:33:36 +0000
Received: by bwz22 with SMTP id 22so14212254bwz.5
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 04:33:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=1kIMc8Hg5Q4QcmUjIktgNjJdpbsvdTis/Xv9owBTO5E=;
        b=fTzy0UGh8Y4PB655crqTasuLUmMoTpRLb2UU1ivWX1CikeeCevAaV6OQErPjmruk+C
         lt86jDjlVDxEIO6S8/gpJymjS67E1xvfINymTPAcerQY7niPBjPRCtWwKaeys47D7SAt
         K7zjU6pHuy5v62hv+gtWvqrJY6+5lMuW4pIJk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=eeMrsfDVCoOz6P+wg+lGgnTNu1U6imr6m5etj6AkCPhGWqXIwy1ZUTxudI6zUjtDJ7
         Wnmxd9/jBBCPgAGW8kLybrkq51payE5LwhSpxpgyc8vPJXKr5sCY92xdglZ/Kp3ldlIU
         0kiLLkYXyEyj43ORlBfHlUCd602iCRDSUSAbY=
Received: by 10.204.81.145 with SMTP id x17mr5888071bkk.31.1272540796253; Thu, 
	29 Apr 2010 04:33:16 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Thu, 29 Apr 2010 04:32:56 -0700 (PDT)
In-Reply-To: <655195.95411.qm@web26201.mail.ukl.yahoo.com>
References: <655195.95411.qm@web26201.mail.ukl.yahoo.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 29 Apr 2010 12:32:56 +0100
Message-ID: <r2m8c4e68611004290432kdece0129x2a4c0556578d439f@mail.gmail.com>
Subject: Re: IOExceptions when optimising the index
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi


It is not necessary to run optimize.  At a guess there is some job
such as a backup or virus check that is running overnight and locking
files and parts of the file system.  If that is the case, and you do
want to run optimize, perhaps you could schedule around it.  Or switch
to a unix based system that doesn't have these locking issues.


--
Ian.


On Thu, Apr 29, 2010 at 11:50 AM, Anna Hunecke <annahunecke@yahoo.de> wrote=
:
> Hi!
>
> we are using Lucene 2.4.1 in our app. It works great so far, but now a cu=
stomer ran into a strange problem.
> During the day, the search index is updated regularly with the newest cha=
nges in the application. At night, when nothing much is happening in the ap=
plication, the index is optimised.
> The updating during the day works fine, but during the optimizing, all ki=
nds of strange exceptions occur:
>
> java.io.IOException: Access is denied
> at java.io.WinNTFileSystem.createFileExclusively(Native Method)
> at java.io.File.createNewFile(Unknown Source)
> at org.apache.lucene.store.SimpleFSLock.obtain(SimpleFSLockFactory.java:1=
44)
> at org.apache.lucene.store.Lock.obtain(Lock.java:73)
> at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1070)
> at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:566)
>
> or
>
> org.apache.lucene.store.LockReleaseFailedException: failed to delete sear=
chindex\write.lock
> at org.apache.lucene.store.SimpleFSLock.release(SimpleFSLockFactory.java:=
149)
> at org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:166=
8)
> at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1602)
> at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1578)
>
> or
>
> java.io.IOException: background merge hit exception: _dhi:c1195 _dlt:c33 =
into _dlu [optimize]
> Exception in thread "Lucene Merge Thread #0" =A0 =A0at org.apache.lucene.=
index.IndexWriter.optimize(IndexWriter.java:2273)
> at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2218)
> at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2198)
> ...
> Caused by: java.io.FileNotFoundException: searchindex\_dlu.fnm (The syste=
m cannot find the file specified)
> at java.io.RandomAccessFile.open(Native Method)
> at java.io.RandomAccessFile.<init>(Unknown Source)
> at org.apache.lucene.store.FSDirectory$FSIndexInput$Descriptor.<init>(FSD=
irectory.java:552)
> at org.apache.lucene.store.FSDirectory$FSIndexInput.<init>(FSDirectory.ja=
va:582)
> at org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:488)
> at org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:482)
> at org.apache.lucene.index.CompoundFileWriter.copyFile(CompoundFileWriter=
.java:221)
> at org.apache.lucene.index.CompoundFileWriter.close(CompoundFileWriter.ja=
va:184)
> at org.apache.lucene.index.SegmentMerger.createCompoundFile(SegmentMerger=
.java:204)
> at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4263)
> at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3884)
> at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMer=
geScheduler.java:205)
> at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(Concu=
rrentMergeScheduler.java:260)
>
> The indexes look fine when I open them with Luke, and since the normal up=
dating works, I don't think it has something to do with write-rights of the=
 disks.
> So, what could be the cause of this?
> And: How necessary is it really to run an optimisation every night? A lot=
 of changes take place when the program runs, so the search index is change=
d quite frequently. Maybe it is enough to let the automatic merging take ca=
re of things?
>
> Greets,
> Anna
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45961-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 14:15:06 2010
Return-Path: <java-user-return-45961-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18831 invoked from network); 29 Apr 2010 14:15:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 14:15:05 -0000
Received: (qmail 36896 invoked by uid 500); 29 Apr 2010 14:15:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36771 invoked by uid 500); 29 Apr 2010 14:15:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36763 invoked by uid 99); 29 Apr 2010 14:15:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 14:15:03 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gsiasf@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 14:14:55 +0000
Received: by vws13 with SMTP id 13so902692vws.35
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 07:14:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:from:content-type
         :subject:date:message-id:to:mime-version:x-mailer;
        bh=LX9SslYMD9HWmpLxn1Y3bpv0Ui7fbNEdHpIvvy7/aFo=;
        b=nzLH1QlnpA2CBUBM3/ifce5Wm6K6kpitxbxg9s1t4H3K4zTffoMyempYDUPvCUxqY5
         AHzZhEU//fMDb/wLw+RFHVzdVkK0UlJImaX/hn27UI3IPkiDNH25BoZHcsa3qs4oMvYZ
         wiba2MJa74dFk6+GDyiP/otrWoLxn48ZdPcFw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:from:content-type:subject:date:message-id:to:mime-version
         :x-mailer;
        b=oHDPB7an9IU2Kt+VgE87RTQkqLxdDB6Umx84Y5NfshZRsT/lunDZ4AGDzJo3vrLRek
         sGZeMsU/Brq2B0xZtyskkJJ/T5RASCEH1ur6jZErjJOxjJ6BP3gEvKGXmnTw5lVUU/4c
         3qNINvTj58LMciSFBnbddqhu7oj1NcILTSod4=
Received: by 10.220.158.72 with SMTP id e8mr6598302vcx.47.1272550473054;
        Thu, 29 Apr 2010 07:14:33 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id p36sm4104385vcr.7.2010.04.29.07.14.31
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 29 Apr 2010 07:14:32 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
From: Grant Ingersoll <gsingers@apache.org>
Content-Type: multipart/alternative; boundary=Apple-Mail-816-38010630
Subject: Relevancy Practices
Date: Thu, 29 Apr 2010 10:14:30 -0400
Message-Id: <E6C119F7-C966-4280-94DD-3575BB3CE3F4@apache.org>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1078)
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-816-38010630
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

I'm putting on a talk at Lucene Eurocon =
(http://lucene-eurocon.org/sessions-track1-day2.html#1) on "Practical =
Relevance" and I'm curious as to what people put in practice for testing =
and improving relevance.  I have my own inclinations, but I don't want =
to muddy the water just yet.  So, if you have a few moments, I'd love to =
hear responses to the following questions.

What worked? =20
What didn't work? =20
What didn't you understand about it? =20
What tools did you use? =20
What tools did you wish you had either for debugging relevance or =
"fixing" it?
How much time did you spend on it?
How did you avoid over/under tuning?
What stage of development/testing/production did you decide to do =
relevance tuning?  Was that timing planned or not?


Thanks,
Grant

--Apple-Mail-816-38010630--

From java-user-return-45962-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 14:37:49 2010
Return-Path: <java-user-return-45962-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30646 invoked from network); 29 Apr 2010 14:37:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 14:37:49 -0000
Received: (qmail 83406 invoked by uid 500); 29 Apr 2010 14:37:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83289 invoked by uid 500); 29 Apr 2010 14:37:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83281 invoked by uid 99); 29 Apr 2010 14:37:47 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 14:37:47 +0000
X-ASF-Spam-Status: No, hits=0.1 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [213.86.41.124] (HELO mail.truvo.com) (213.86.41.124)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 14:37:40 +0000
X-ASG-Debug-ID: 1272551929-04ba03090000-H1Y1KX
X-Barracuda-URL: http://10.255.0.214:8000/cgi-bin/mark.cgi
Received: from exchq-001.wdnet.org (localhost [127.0.0.1])
	by mail.truvo.com (Spam Firewall) with ESMTP id C85F110F132
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 16:38:49 +0200 (CEST)
Received: from exchq-001.wdnet.org (exchq-001.wdnet.org [10.100.10.5]) by mail.truvo.com with ESMTP id ovdHArNBbR4grTsw for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 16:38:49 +0200 (CEST)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Relevancy Practices
Subject: RE: Relevancy Practices
Date: Thu, 29 Apr 2010 16:38:49 +0200
Message-ID: <F2925F55E61C7E4CB848AC82515E726A08DBE44F@exchq-001.wdnet.org>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Relevancy Practices
Thread-Index: Acrnppcgu+TpU2RjQiuzFovEsLuLjwAAmpXg
From: "Fornoville, Tom" <Tom.Fornoville@truvo.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: exchq-001.wdnet.org[10.100.10.5]
X-Barracuda-Start-Time: 1272551929
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at truvo.com

We've only been using Lucene for a couple of weeks and we're still in
the evaluation and R&D phase but there's one single thing that has
helped us out enormously with the relevance testing: a set of reference
documents and queries. We basically sat together with the business
people a created a list of about 50 (fictional) documents, some queries
and the order in which results should be returned. Once everyone agreed
on this reference data we converted it to a set of unit tests.

Until now this approach has helped us out big time both in refining the
business requirements and the scoring and relevancy in the search engine
itself.

Cheers,
Tom

-----Original Message-----
From: Grant Ingersoll [mailto:gsiasf@gmail.com] On Behalf Of Grant
Ingersoll
Sent: donderdag 29 april 2010 16:15
To: java-user@lucene.apache.org
Subject: Relevancy Practices

I'm putting on a talk at Lucene Eurocon
(http://lucene-eurocon.org/sessions-track1-day2.html#1) on "Practical
Relevance" and I'm curious as to what people put in practice for testing
and improving relevance.  I have my own inclinations, but I don't want
to muddy the water just yet.  So, if you have a few moments, I'd love to
hear responses to the following questions.

What worked? =20
What didn't work? =20
What didn't you understand about it? =20
What tools did you use? =20
What tools did you wish you had either for debugging relevance or
"fixing" it?
How much time did you spend on it?
How did you avoid over/under tuning?
What stage of development/testing/production did you decide to do
relevance tuning?  Was that timing planned or not?


Thanks,
Grant

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45963-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 15:00:18 2010
Return-Path: <java-user-return-45963-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39697 invoked from network); 29 Apr 2010 15:00:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 15:00:18 -0000
Received: (qmail 20130 invoked by uid 500); 29 Apr 2010 15:00:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20059 invoked by uid 500); 29 Apr 2010 15:00:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20051 invoked by uid 99); 29 Apr 2010 15:00:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 15:00:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mbennett.ideaeng@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 15:00:09 +0000
Received: by gwj23 with SMTP id 23so1404005gwj.35
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 07:59:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:received
         :in-reply-to:references:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        bh=EGjNxBrn0C6nuhfGKZjgMkBsgx2LLrMceL8U/oYM58U=;
        b=v9isWwbnwHBQHhTfO4PGcTAMxYkzYZyMiJX0SAZExP4SNUTb7ZLJPYpzAR1hGHEEIj
         K/oWEp+eRQ9R9uKwqQ0zKX/t8pPlwhSnp9CZdNN8ww6EUS3ZqmX379xgNaiegWl5rxSq
         gnGPRO6yiPj+Dk/j3LDJDAuN+kAAgq+BJ5ywA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        b=quUugM5X0tJck050+ZYOv4sCsvc7hjfIRhho0O4tSiEjyruS6tRNcb+xJVTJmXwvRR
         XYFev+2xoXgG99xontPT1Rb/iWKb2iMJvU5yY8+jzmwok3kkrTdsAH0vHTSb+qed2RWe
         QmkuoK+EZxzcQnsFGRVcyhOKuCMpWd5QjxxDc=
Received: by 10.224.69.203 with SMTP id a11mr370158qaj.271.1272553183950; Thu, 
	29 Apr 2010 07:59:43 -0700 (PDT)
MIME-Version: 1.0
Sender: mbennett.ideaeng@gmail.com
Received: by 10.231.37.2 with HTTP; Thu, 29 Apr 2010 07:59:22 -0700 (PDT)
In-Reply-To: <E6C119F7-C966-4280-94DD-3575BB3CE3F4@apache.org>
References: <E6C119F7-C966-4280-94DD-3575BB3CE3F4@apache.org>
From: Mark Bennett <mbennett@ideaeng.com>
Date: Thu, 29 Apr 2010 07:59:22 -0700
X-Google-Sender-Auth: 6dde5b84f5c01826
Message-ID: <x2i3504767f1004290759u6de20a3ehfa4d46fb11a97954@mail.gmail.com>
Subject: Re: Relevancy Practices
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64afb5e7d08f904856160da
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64afb5e7d08f904856160da
Content-Type: text/plain; charset=ISO-8859-1

Hi Grant,

You're welcome to use any of my slides (Dave's got them), with attribution
of course.

BUT....

Have you considered a section something like "why the hell do you think
Relevancy tweaking is gonna save you!?!?"

Basically that, as a corpus grows exponentially, so do results list sizes,
so ALL relevancy tweaks will eventually fail.  And FACETS (or other
navigators) are the answer.  I've got slides on that as well.

Of course relevancy matters.... but it's only ONE of perhaps a three pronged
approach:
1: Organic Relevancy and top query suggetions
2: Results list Navigators, the best the system can support, and
3: Data quality (spidering, METADATA quality, source weighting, etc)

Mark

--
Mark Bennett / New Idea Engineering, Inc. / mbennett@ideaeng.com
Direct: 408-733-0387 / Main: 866-IDEA-ENG / Cell: 408-829-6513


On Thu, Apr 29, 2010 at 7:14 AM, Grant Ingersoll <gsingers@apache.org>wrote:

> I'm putting on a talk at Lucene Eurocon (
> http://lucene-eurocon.org/sessions-track1-day2.html#1) on "Practical
> Relevance" and I'm curious as to what people put in practice for testing and
> improving relevance.  I have my own inclinations, but I don't want to muddy
> the water just yet.  So, if you have a few moments, I'd love to hear
> responses to the following questions.
>
> What worked?
> What didn't work?
> What didn't you understand about it?
> What tools did you use?
> What tools did you wish you had either for debugging relevance or "fixing"
> it?
> How much time did you spend on it?
> How did you avoid over/under tuning?
> What stage of development/testing/production did you decide to do relevance
> tuning?  Was that timing planned or not?
>
>
> Thanks,
> Grant
>

--0016e64afb5e7d08f904856160da--

From java-user-return-45964-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 15:59:03 2010
Return-Path: <java-user-return-45964-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57356 invoked from network); 29 Apr 2010 15:59:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 15:59:03 -0000
Received: (qmail 18202 invoked by uid 500); 29 Apr 2010 15:59:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18174 invoked by uid 500); 29 Apr 2010 15:59:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18166 invoked by uid 99); 29 Apr 2010 15:59:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 15:59:00 +0000
X-ASF-Spam-Status: No, hits=0.2 required=10.0
	tests=AWL,SPF_PASS,URIBL_RED
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [198.147.195.5] (HELO flicker.bmc.com) (198.147.195.5)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 15:58:55 +0000
Received: by flicker.bmc.com (Postfix, from userid 13749)
	id CB7391E6F9E; Thu, 29 Apr 2010 08:58:34 -0700 (MST)
Received: from PHX-HTPRD-01.adprod.bmc.com (phx-htprd-01.adprod.bmc.com [172.24.32.7])
	by flicker.bmc.com (Postfix) with ESMTP id BFE371E6F70
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 08:58:34 -0700 (MST)
Received: from PHXCCRPRD02.adprod.bmc.com ([172.24.32.181]) by
 PHX-HTPRD-01.adprod.bmc.com ([172.24.32.7]) with mapi; Thu, 29 Apr 2010
 09:58:34 -0600
From: "Woolf, Ross" <Ross_Woolf@BMC.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Thu, 29 Apr 2010 09:58:12 -0600
Subject: RE: IndexWriter and memory usage
Thread-Topic: IndexWriter and memory usage
Thread-Index: Acrl9hOedVPiEuzcTayB9f0+r9rcaQBvcWVQ
Message-ID: <492379B6AA909E4FAF672AACCA0EADC25CC09D6A1A@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <i2k9ac0c6aa1004030238iae6adffbzc73518e8874bc70f@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBA2EDD34@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
	 <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
	 <n2w9ac0c6aa1004141352s5edb3082o2f1952626c551450@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CC066FD36@PHXCCRPRD02.adprod.bmc.com>
 <i2i9ac0c6aa1004270340heec28687zc734ebfbbae10bd3@mail.gmail.com>
In-Reply-To: <i2i9ac0c6aa1004270340heec28687zc734ebfbbae10bd3@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator:
x-cr-hashedpuzzle: CASZ CQMz CvBd C7bK Dn8S FMqU GoPj GroD INJZ JVsQ Jlsf
 J4io J7Ls Lgvk L9G3
 Mq9n;1;agBhAHYAYQAtAHUAcwBlAHIAQABsAHUAYwBlAG4AZQAuAGEAcABhAGMAaABlAC4AbwByAGcA;Sosha1_v1;7;{A2F81192-F488-4FA6-B3A8-72A46C80FCCE};cgBvAHMAcwBfAHcAbwBvAGwAZgBAAGIAbQBjAC4AYwBvAG0A;Thu,
 29 Apr 2010 15:58:12
 GMT;UgBFADoAIABJAG4AZABlAHgAVwByAGkAdABlAHIAIABhAG4AZAAgAG0AZQBtAG8AcgB5ACAAdQBzAGEAZwBlAA==
x-cr-puzzleid: {A2F81192-F488-4FA6-B3A8-72A46C80FCCE}
acceptlanguage: en-US
Content-Type: multipart/mixed;
	boundary="_002_492379B6AA909E4FAF672AACCA0EADC25CC09D6A1APHXCCRPRD02ad_"
MIME-Version: 1.0

--_002_492379B6AA909E4FAF672AACCA0EADC25CC09D6A1APHXCCRPRD02ad_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

I ported the patch to 2.9.2 dev but it did not seem to help.  Attached is m=
y port of the patch.  This patch contains both 2283 and 2387, both of which=
 I have applied in trying to resolving this issue.

-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]
Sent: Tuesday, April 27, 2010 4:40 AM
To: java-user@lucene.apache.org
Subject: Re: IndexWriter and memory usage

Oooh -- I suspect you are hitting this issue:

    https://issues.apache.org/jira/browse/LUCENE-2283

Your 3rd image ("fdt") jogged my memory on this one.  Can you try
testing the trunk JAR from after that issue landed?  (Or, apply that
patch against 3.0.x -- let me know if it does not apply cleanly and
I'll try to back port it).

But: it's spooky that you cannot repro this issue in your dev
environment.  Are you matching the # thread and exact sequence of
docs?

Mike

On Mon, Apr 26, 2010 at 4:14 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> We are still plagued by this issue.  I tried applying the patch mentioned=
 but this did not resolve the issue.
>
> I once tried to attach images from the heap dump to send out to the group=
 but the server removed them so I have posted the images on a public servic=
e with links this time.  I would appreciate someone looking at them to see =
if they provide any insight into what is occurring with this issue.
>
> When you follow the link click on the image and then once you see the ima=
ge click on a link in the lower left hand corner that says "View Raw Image.=
"  This will let you view the images at 100% resolution.
>
> This first image shows what we are seeing within VisualVM in regards to t=
he memory.  As you can see, over time the memory gets consumed.  Finally we=
 are at a point where there is no more memory available.
> Graph
> http://tinypic.com/view.php?pic=3D2ltk0h3&s=3D5
>
> This second image in VisualVM shows the classes sorted by size.  As you c=
an see, about 70% of all memory is consumed in the bytes array.
> Bytes
> http://tinypic.com/view.php?pic=3Ds10mqs&s=3D5
>
> This third image is where the real info is.  This is where one of the byt=
es is being examined and the option to go to nearest GC is chosen.  What yo=
u see here is what the majority of the bytes show if selected, so this one =
is representative of most all.  As you can see this one byte is associated =
with the index writer as you look at the chain of objects (and thus so too =
are all the other bytes that have not been released for GC).
> Garbage Collection
> http://tinypic.com/view.php?pic=3D5obalj&s=3D5
>
> I'm hoping that as you look at this that it might mean something to you o=
r give you a clue as to what is holding on to all the memory.
>
> Now the mysterious thing in all of this is that our use of Lucene has bee=
n developed into a "plug-in" that we use within an application that we have=
.  If I just run JUnit tests around this plugin, indexing some of the same =
files that the actual application is indexing, I cannot ever get the memory=
 loss in my dev environment.  Everything seems to work as expected.  Howeve=
r, once we are in our real situation, then we see this behavior.  Because o=
f this I would expect that the problem lays with the application, but once =
we examine the heap dumps it then goes back to showing that the consumed by=
tes are "owned" by the index writer process.  It makes no sense to me that =
we see this as we do, but none the less we do.  We see that the Index Write=
r process is hanging onto a lot of data in byte arrays and it doesn't ever =
seam to release it.
>
> In addition, we would love to show this to someone via a webex if that wo=
uld help in seeing what is going on.
>
> Please, any help appreciated and any suggestions on how to resolve or eve=
n troubleshoot.  I can provide an actual heap dump but it is 63mb in size (=
compressed) so we would need to work out some FTP where we can provide it i=
f someone is willing to look at it in VisualVM (or any other profiling tool=
).
>
> BTW - If we open and close the index writer on a regular basis then we do=
n't run into this problem.  It is only when we run continuously with an ope=
n index writer that we do see this problem (we altered the code to open/clo=
se the writer a lot, but this slows things down, so we don't want to run li=
ke this, but we wanted to test the behavior if we did so).
>
> Thanks,
> Ross
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Wednesday, April 14, 2010 2:52 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Run this:
>
>    svn co https://svn.apache.org/repos/asf/lucene/java/branches/lucene_2_=
9
> lucene.29x
>
> Then apply the patch, then, run "ant jar-core", and in that should
> create the lucene-core-2.9.2-dev.jar.
>
> Mike
>
> On Wed, Apr 14, 2010 at 1:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> How do I get to the 2.9.x branch?  Every link I take from the Lucene sit=
e takes me to the trunk which I assume is the 3.x version.  I've tried to l=
ook around svn but can't find anything labeled 2.9.x.  Is there a daily bui=
ld of 2.9.x or do I need to build it myself.  I would like to try out the f=
ix you put into it, but I'm not sure where I get it from.
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Wednesday, April 14, 2010 4:12 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> It looks like the mailing list software stripped your image attachments.=
..
>>
>> Alas these fixes are only committed on 3.1.
>>
>> But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
>> fix.  I think the other issue was part of LUCENE-2074 (though this
>> issue included many other changes) -- Uwe can you peel out just a
>> 2.9.x patch for resetting JFlex's zzBuffer?
>>
>> You could also try switching analyzers (eg to WhitespaceAnalyzer) to
>> see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
>> uses JFlex) is [part of] your problem.
>>
>> Mike
>>
>> On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> Since the heap dump was so big and can't be attached, I have taken a fe=
w screen shots from Java VisualVM of the heap dump.  In the first image you=
 can see that at the time our memory has become very tight most of it is he=
ld up in bytes.  In the second image I examine one of those instances and n=
avigate to the nearest garbage collection root.  In looking at very many of=
 these objects, they all end up being instantiated through the IndexWriter =
process.
>>>
>>> This heap dump is the same one correlating to the infoStream that was a=
ttached in a prior message.  So while the infoStream shows the buffer being=
 flushed, what we experience is that our memory gets consumed over time by =
these bytes in the IndexWriter.
>
>>>
>>> I wanted to provide these images to see if they might correlate to the =
fixes mentioned below.  Hopefully those fixes mentioned below have rectifie=
d this problem.  And as I state in the prior message, I'm hoping these fixe=
s are in a 2.9x branch and hoping for someone to point me to where I can ge=
t those fixes to try out.
>>>
>>> Thanks
>>>
>>> -----Original Message-----
>>> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
>>> Sent: Tuesday, April 13, 2010 1:29 PM
>>> To: java-user@lucene.apache.org
>>> Subject: RE: IndexWriter and memory usage
>>>
>>> Are these fixes in 2.9x branch?  We are using 2.9x and can't move to 3x=
 just yet.  If so, where do I specifically pick this up from?
>>>
>>> -----Original Message-----
>>> From: Lance Norskog [mailto:goksron@gmail.com]
>>> Sent: Monday, April 12, 2010 10:20 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> There is some bugs where the writer data structures retain data after
>>> it is flushed. They are committed as of maybe the past week. If you
>>> can pull the trunk and try it with your use case, that would be great.
>>>
>>> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>> I was on vacation last week so just getting back to this...  Here is t=
he info stream (as an attachment).  I'll see what I can do about reducing t=
he heap dump (It was supplied by a colleague).
>>>>
>>>>
>>>> -----Original Message-----
>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>> Sent: Saturday, April 03, 2010 3:39 AM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Re: IndexWriter and memory usage
>>>>
>>>> Hmm why is the heap dump so immense?  Normally it contains the top N
>>>> (eg 100) object types and their count/aggregate RAM usage.
>>>>
>>>> Can you attach the infoStream output to an email (to java-user)?
>>>>
>>>> Mike
>>>>
>>>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>>> I have this and the heap dump is 63mb zipped.  The info stream is muc=
h smaller (31 kb zipped), but I don't know how to get them to you.
>>>>>
>>>>> We are not using the NRT readers
>>>>>
>>>>> -----Original Message-----
>>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>>> Sent: Thursday, April 01, 2010 5:21 PM
>>>>> To: java-user@lucene.apache.org
>>>>> Subject: Re: IndexWriter and memory usage
>>>>>
>>>>> Hmm, not good.  Can you post a heap dump?  Also, can you turn on
>>>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>>>
>>>>> IndexWriter should not hang onto much beyond the RAM buffer.  But, it
>>>>> does allocate and then recycle this RAM buffer, so even in an idle
>>>>> state (having indexed enough docs to fill up the RAM buffer at least
>>>>> once) it'll hold onto those 16 MB.
>>>>>
>>>>> Are you using getReader (to get your NRT readers)?  If so, are you
>>>>> really sure you're eventually closing the previous reader after
>>>>> opening a new one?
>>>>>
>>>>> Mike
>>>>>
>>>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrot=
e:
>>>>>> We are seeing a situation where the IndexWriter is using up the Java=
 Heap space and only releases memory for garbage collection upon a commit. =
  We are using the default RAMBufferSize of 16 mb.  We are using Lucene 2.9=
.1. We are set at heap size of 512 mb.
>>>>>>
>>>>>> We have a large number of documents that are run through Tika and th=
en added to the index.  The data from Tika is changed to a string, and then=
 sent to Lucene.  Heap dumps clearly show the data in the Lucene classes an=
d not in Tika.  Our intent is to only perform a commit once the entire inde=
xing run is complete, but several hours into the process everything comes t=
o a crawl.  In using both JConsole and VisualVM  we can see that the heap s=
pace is maxed out and garbage collection is not able to clean up any memory=
 once we get into this state.  It is our understanding that the IndexWriter=
 should be only holding onto 16 mb of data before it flushes it, but what w=
e are seeing is that while it is in fact writing data to disk when it hits =
the 16 mb limit, it is also holding onto some data in memory and not allowi=
ng garbage collection to take place, and this continues until garbage colle=
ction is unable to free up enough space to all things to move faster than a=
 crawl.
>>>>>>
>>>>>> As a test we caused a commit to occur after each document is indexed=
 and we see the total amount of memory reduced from nearly 100% of the Java=
 Heap to around 70-75%.  The profiling tools now show that the memory is cl=
eaned up to some extent after each document.  But of course this completely=
 defeats the whole reason why we want to only commit at the end of the run =
for performance sake.  Most of the data, as seen using Heap analasis, is he=
ld in Byte, Character, and Integer classes whos GC roots are tied back to t=
he Writer Objects and threads.  The instance counts, after running just 1,1=
00 documents seems staggering
>>>>>>
>>>>>> Is there additional data that the IndexWriter hangs onto regardless =
of when it hits the RAMBufferSize limit?  Why are we seeing the heap space =
all being used up?
>>>>>>
>>>>>> A side question to this is the fact that we always see a large amoun=
t of memory used by the IndexWriter even after our indexing has been comple=
ted and all commits have taken place (basically in an idle state).  Why wou=
ld this be?  Is the only way to totally clean up the memory is to close the=
 writer?  Our index is also used for real time indexing so the IndexWriter =
is intended to remain open for the lifetime of the app.
>>>>>>
>>>>>> Any help in understanding why the IndexWriter is maxing out our heap=
 space or what is expected from memory usage of the IndexWriter would be ap=
preciated.
>>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>
>>>
>>>
>>> --
>>> Lance Norskog
>>> goksron@gmail.com
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


--_002_492379B6AA909E4FAF672AACCA0EADC25CC09D6A1APHXCCRPRD02ad_
Content-Type: application/x-zip-compressed; name="LuceneFix.zip"
Content-Description: LuceneFix.zip
Content-Disposition: attachment; filename="LuceneFix.zip"; size=4445;
	creation-date="Thu, 29 Apr 2010 09:50:03 GMT";
	modification-date="Thu, 29 Apr 2010 09:50:42 GMT"
Content-Transfer-Encoding: base64

UEsDBBQAAAAIADROnTz/dyFB3RAAAF0+AAAPAAAATHVjZW5lRml4LnBhdGNozTtrc9s4kp/tqvkP
mNm6Pdl6WbL8SBxNJXaSHdc6j4qdmd2dSqVoCbJ4oUgNQcrRTPm/Xz8AECApS/bcZZeVimSi0ehu
9BNoncdj+fWp+J9gEXST9KYbzIPRVHajfCRj2Q3iIFqqUHWvki8yDn+XaQchv9se/vnnu+12u/3A
hbcaqVyEKkxi8WR/cHA02Pluu9lsPhjLbZJ+CeMbMUrmS0Dx/LloHx60en3RxI8j8fz5d9sCH5XP
ZdpQSZ6O5M4Jv8umoeqE8TzPxFCcTYP0gwzGgPpGZg16zYB3220htpv4tbu7K06XYiwnQR5lLTGK
EiUVIJKC8WgMYreL4PP8OgpHYpGEYwZt7ABsmtwqcf7u1deRnGcogT9wAcEYOhruZLtJ7yaCSRHf
D0WcR9EOQNNIPTyQ2BUXH89evX3V7u8fHz0V4yT+70xMk2gskjhLNIUimGTwP01uCZU4s/92JkZB
LFI5ioJw5i0mmAa91l2NcD7ILE9jEsgoSQFHJmHdyUTJrCPOJ+KP51EYfxF/IXR3IlQiMO9wAy6z
VAazO9ita1hdKdqnXdooMZPZNAE5BlGkqnP+opd7R2vdtYSMlAQmkBwlno2SsfxxlANIjCDPuvSi
o/E/nwdpMBPFuCZZBEooKWPgnlhK8gzI3j6/19RCHO2+TEbn8UKmIOX3Mn0dymj8jSzu/vUfaHjr
kNXYX3+v3zoUTfzo7RUGyM8E515mQSY7WsTNIajoiF+Rmf/OFsgb+bdg3qA5xmZLSK6TRGVid8jv
cN4pvmkU4Hfbza2tFUYRAOVkFLi5hAFtQVuAnmftYGuLINSv4afCDrb1GoK/jJJY5TNgYBLGoZoi
GRsqC8yKM/VLGmbfzDWvXvuxSlKDqEZB9o9RP+B/7Z7D2TxJMwF4O4y3w3g7SgbpaNr5RYY30+zk
PsAsSWXnRQSOYLw8Q582tt51/byXITqOJF3Cfq4B/fDizeswkvfhzLMw6rxI02D5Eb6thTwDjckC
kBpAknR6RxC4QD69o+PWwbFrPxSuYvmV3DB8nFjlK7th8s+74gzkkUkRxGPtCMHZxvJWwE7xHp3m
kwnsFIN38QPMG0b5PcK6fzds7NHYEJcPQJEBLA4/Cjq01MQ1o50kaUGCclcnn+/TAHzKeKwsjj8Y
eYEeF3gRRckIWb1eZhCOc9h/MUmTmVAQH+D7PEmijoHu8pd5mmQcnnDSr5+QG81GGGdCQZLhxFqg
C9wfvRXDoXj/6sPnl+/OPp9evDv7++fL83+9svFXy2ZOTGjCEvJop7DOKfz9pTEJIDiZkH1Xx9EH
OVqOgF10TAVTZR7UMh5BOoEJ0ZizjJTnNdw0AVIIlrzqIP0w9qPYcwAAj8wuZHyTTRt7SFUxAP7P
owSpV8UweLkgEiguGjlL8hiV01/NQ8gzWOIgc0YIUxrm1Y6ZnCVkRA3SMhot1sCpOydIXrGLBH0R
quwZo/rRkEHWclsdtzkTMAnP5VJlctaBEN+Zp8BSFDd++L72MVQje0/FD03+sxORBItETFR0QG+O
1QPV4KktsddyJOiiMNKAaUHacEdw9fP4lHRjKPY8KWttjfMZa7SCPR8yEAPcWdXT+mcMFt/uiivY
a4pb4LkhxYLsZ5ZDmIW0N4xZE0weB2pNAI2S99+50/maxng7DUdTm44hBphwpqMl/B1k5qWLRSd7
EKBhn0dS0UxKlncxaWDQjtBupnjDi1IKHlyrLA1GYLqQL0Auzi7GZ+4PdqQW1CVtFYPFaprhcqmg
12OF99d7yeWD/5K11HtHVqwzi0fRBNMppGAudgwhpT84avX2OaZQfZKGC3SbLBSrl1Zjrfe1Q+/R
kxbjSB5pUskTXIJyWo2s4m14gI4rohBnB9CVONhYYwnOGjO4eekYVNnW0WKotjKZWtcJFkGcgDql
xv9TwEAldIKGViJhYDwvDrknWCVUBqA0hjdIONSOUSjfQZd3q4PMFlvUO6Sytdc/pC+lvBl8FIDH
N4pthfNXWlgExcqiAXhnpXkLSm5gJcwDfCSiAeL7DZ3o19KkOSTRCLnTYfnxgw4FHQ4xi5n76T+v
XnlB0AG+1ptBoisBfnIcWQ3a8q7XILQgn5zC4I6qPpeV6yK27JR0BdzxLFnIBjrSds+tLzBiVja1
Tg4fMdGoE0MNcwbW4c3COP7agj4b+nJxwHWKce3UOKxDxz0y8/39Xqs3cFUIOT+PM814MB7ryAO1
jHFcAhmscQHX1Ve8DTVmzfHpTyIpCRPpQ6zsYbRXRf9RzcEAZ2+vP9COhyfUEFMKy6spqa7AyYzJ
s8Fbh1kIi4ymOQRDSg6TietDRvBRpDmUl2aJ3hSqKAQaLPwHST27mgqbZz+9+GAo+On89RUyCSzS
hu/3e1hjw44fHXlOwyTokw4k27Mgayy6KJkO/+9tObDxi4RSeIGBHdSE/J5CPiDlfirea0fQoj00
GSCH4AaeKilhfYjxGmIcZAH7GxSAYZ/B9VwcgFiL+Zk+XEFJ7HQg0oWYsoCfxHCmgJXfcijQ9LRF
kC5xhWBGuSZQiWIMbqR138rwQUFNcn3hMDlJ8nQjHpsb8NiqY7B5H4MkFdDANjBnM9QG6cKYjyBU
l3TCuG1dH60QyxqB6LksFuLclYow+d5rCvXBbB7JFqO/DbOpmAXxUuRx+FsOCg2LRLKdjPiQbCT1
VDXF4hYpxklRhEou8jkxbOSKUia+QSTjaAlfl3q2thaOw9ltAtv/C3yVgXLIWMh0KaIgvWERKq37
AzpG6A32DltH5XDJzw+QsUYSHOib0+EPogmm9+a0oV8BSehmd0Szbt4CQmQa3tzItJiIPvSKX66Y
Zb3cawAtJladX6cUibhQ2i17PuGk9MUq7L78JcqVRj3+Gn9Wzwjqbg0jiPXMDFmsroMClPz3249v
PiM7O+S+NWL2bVEC6goOLs2coD8sJwHC3yfj8A61wxv090ohzmRjqLND2L1cOitD+QFFsbdE018A
amJk70IuJJ2x62i/7cjHS+ZM8uZkBZg27GGdtemGi7/+VdCEWsF6o0XwLga/B1ZLJFDu9jahLI9P
wKF2wvmi3eYabhLlairi5Lbj6pYlfSNFKmulIXRTvlfNrxXDfcBlqdTAGiH5Iw+QkjePHfa5ep2D
pxt6CVuNPiES7TFOfDx8rTNJ+O7CvdsR/oOAXlroo93RZnF02Orvo1nsP2ntD6re8BqW+eLRoKO/
uw5rQIiF5H+JAanYpjtqT5S2tmpwHTwKl8/A2sk6m18PyKv4GT8+vgNq12T1DnCd+HoV8dXbdfn0
rWb6wfrpwn1KkFoWtfM3YLzk0fEk2fXpawXRrxVExYWtkEO/Vg6rZgv38QEdKZRnbyCE87dXvgzw
xQoRtIuvjjSIm/2KLNAhVZjerzC9kSeukaE+tEXWIQ+7hYyLEt39vs1SZTCa8h94/9r7e8lt4vE8
HdCEdK4IH89g9oloNsOqI11Hpt6DzZhpi557wslPZWPuOXs3D4p0syXxVLSGK+sxS+/v/Bfen3jR
qD+L17S5g8rmkg44iGDLXqgv9vrQxiNMZvSp8ZiKQu9wg1Od4s4RZkD0obvPja4dL6nqoOvcf8fN
44rlH3X5uBJXzf1j7/BJq9eDaImfzmkobcPVu5fvnlIRoxI8wca5MyzUZ6DJUIfIySQchVCGnZCh
qFkQRXYy1SxY0GCZba67zLEAbM076h/QQf82UHh2H0RJxj6jDDAZZ/psojRiTzXRSsE+XOaNynKu
XT5y9K7WNH10/67HKzd+Bt3mtDFWO7GWRC1ufWOlZNZwXDmg7uiX1v4Yacfebln/W0LNNyE0cmfu
U4/3oT5s9o4P3DLR3tjrFh0uSkJ7pdJwEmt9mIJ0eRCWOnMex0TeyOzSB6tdkZg3bQL1XUGb2PAV
VMQ/81EBfv132PE9JDzKlu/FV2fPT/jY80mv0nCSLcadW5z+8wVscGOeqHYEZvc+UW78169AeQDA
OVTl7cXTcLKJTraYMLarpAHfrQL4EFZ3NZ6Vk9uVcUftt+oHfJyg/SyoldrfHwxQ+/uDw9bxf66n
AxZXezqS8f+tO9t8fevNiHHtzFyZW2cGY3iJhC/f5rPr4uIZB3qf+ACjf8C9UQcH/nbUe8KSSoDc
rVZclYbwuc9JrlOTIzKh/pFVEzNKXzZ3kkhyyUm2GRWUhuv8ZHPrEU5S88hARkH4eGZd8xWdunZ1
Z8k3cpnVNR/oI+sQ1HbhtQYD7MJrDQ69Niuc4TQp4S3piT8YJp1LmYZBFP4eXFOz03abb4hNE06I
J8VkiMKFxDwam0Cf6wYn0HyZot1iv4re0U0ReffT3l06ayFB/wxWBnL7eP4Sb0WiE66+zKziknhF
J4i2nZoekjUznL6TrUf1nQBvxAb3jNDfIBLbiCbGRUtaW1TsrkR1dZiEhy4e+2bhH8s+WoJ/H4eT
kES8CANhF+xkST6a4pY0dqgFkgkQwYi6LuIkwwZqVBE5djeGmQD3/oYQAzFD00ijm2mvwpl8E0ZR
yJmQJow2n67DAqXl1cJrkjjx5IDMa1VBX6O7K1zevdGmliO9qZen9a7UaWBfY9QoRF64PiQVYl+c
xG3FoUJLRN82YcMhX6bPsEdRXGPbc6xZ59sLjPlgm0i6165ForuxjVe6CNVWsg7SdbmODunjh2pb
WNHg5aidWdIK8wHzChnyOxBgiY5vJD1H9zaSYRnek6QzuF6eLqaKHWwo27U4HDn7VraKVrfBTgTj
cX1LY0HXBvBEg4awSVbRLUlgOp+ovSIR/JhWNuo+MGkVhqqjfqsPycfRAD/KV9gMWeXQk6cmDrtz
CvKpmFjB7wNmu8TYThLDC/9SBCHXUKgzx6Idbz1ZNVOqgimaLB2z293Vt+WvvkK2mD01LUJS9//q
BExoqEv9YwtI0fGHHxZ4bG6co6XtsbsfowbaBCHxYn95QZWDKR8M/Nii1bCmibl+vIvs6L1c2cu7
YdevK2jbcoSDn1b6BeNhvJx2vUMqg9PKnhlVY5clzQ/6Quj+ONuFeLdpAuzWPN86Ea6s/diEuAZR
TWI86GNBTP9bX4OeqqHLP04nPHsuF4Ume534+3svGK0zwT+HYnLilOGz4Auofo6tQBgJb+EPiHyj
qeCfpbCH3KPeQPzoFWUj/94KwogiBnACWJuczbOlNfHq79CKKpMKswySH1vEKSm/UAs412xgvUhI
wy240DxE3QOsqGmSR2MwmAWEiGkwn8vYYKbSjSvsPM4gJ7QYGxKST5AYbBOJXZeLba5qdTJwasNO
8fMzb4j0HMbbPT3KAnifqJDILpqfeeAS+w8qby9MLmPqY9ywjt8dL1gttGGB5WUrdfIKBn/Kb+SH
YPb/UWE+eO1VhvUIRHUVJ8TvHh414YdWUlRRRCCmgMFWfdxclLDKx+IcysQbUNY3L/7x+ecXFx9f
8S8eWHm9srFEi21PviCCcfQsUJL1mauB1RVksdpQUO61I/rY78VfKzSdbOtuuV3xGi02YJYweJFV
Xy+hnkGJUPdfMJO6l4wVFw/QIGxRFP1zKHQsNDVmDmqYgg/5CtHLWrvPM4vupYyVNBtQ/VENabtX
1Y1QGcJs6ViDGf8pUNM3wVz3hJ165a4eswc/6wLyw0KyKMhqDmnoxAzgTZsdfDYs9teZTF7qWkbg
ilhk6G5TiWegWqAFpJH9r/hrP5v4eSxT+sdd+6QtnAq7J8v6tzfDoWnvaNshxC2G5exCmMO8lRAF
cuSm7lcrJj/C36a4yTk/PgcQraoctGBhd9Ld9v8CUEsBAhQLFAAAAAgANE6dPP93IUHdEAAAXT4A
AA8AAAAAAAAAAQAgAAAAAAAAAEx1Y2VuZUZpeC5wYXRjaFBLBQYAAAAAAQABAD0AAAAKEQAAAAA=


--_002_492379B6AA909E4FAF672AACCA0EADC25CC09D6A1APHXCCRPRD02ad_
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--_002_492379B6AA909E4FAF672AACCA0EADC25CC09D6A1APHXCCRPRD02ad_--


From java-user-return-45965-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 17:09:04 2010
Return-Path: <java-user-return-45965-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96079 invoked from network); 29 Apr 2010 17:09:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 17:09:04 -0000
Received: (qmail 26466 invoked by uid 500); 29 Apr 2010 17:09:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26436 invoked by uid 500); 29 Apr 2010 17:09:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26428 invoked by uid 99); 29 Apr 2010 17:09:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 17:09:02 +0000
X-ASF-Spam-Status: No, hits=1.3 required=10.0
	tests=AWL,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 216.139.236.158 is neither permitted nor denied by domain of sirishreddy@gmail.com)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 17:08:56 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <sirishreddy@gmail.com>)
	id 1O7XE4-0002OT-0v
	for java-user@lucene.apache.org; Thu, 29 Apr 2010 10:08:36 -0700
Date: Thu, 29 Apr 2010 10:08:36 -0700 (PDT)
From: Sirish Vadala <sirishreddy@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1272560916022-765845.post@n3.nabble.com>
Subject: Using Sort
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


I have a requirement where in the results have to be sorted in ascending
order for few fields, and descending order for one field.

Currently I am using:

String[] sortOrder = { IFIELD_YEAR, IFIELD_TYPE, IFIELD_NUM, IFIELD_SESSION
};
Sort sort = new Sort(sortOrder);
hits = indexSearcher.search(booleanQuery, sort);

Using the above code, everything gets sorted in ascending order starting
with year, type, number and session in that precedence.

Now I have a requirement to first sort in ascending order for year, type and
number, and then sort in descending order only for session.

Is there a way to get this to work.

Thanks.
-- 
View this message in context: http://lucene.472066.n3.nabble.com/Using-Sort-tp765845p765845.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45966-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 17:20:51 2010
Return-Path: <java-user-return-45966-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3545 invoked from network); 29 Apr 2010 17:20:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 17:20:51 -0000
Received: (qmail 46557 invoked by uid 500); 29 Apr 2010 17:20:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46516 invoked by uid 500); 29 Apr 2010 17:20:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46508 invoked by uid 99); 29 Apr 2010 17:20:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 17:20:49 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 17:20:41 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9DE10D36009
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 19:20:21 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id RWp+yrLEXGBP for <java-user@lucene.apache.org>;
	Thu, 29 Apr 2010 19:20:06 +0200 (CEST)
Received: from VEGA (athedsl-353848.home.otenet.gr [85.72.237.214])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id B9927D36001
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 19:20:05 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <1272560916022-765845.post@n3.nabble.com>
In-Reply-To: <1272560916022-765845.post@n3.nabble.com>
Subject: RE: Using Sort
Date: Thu, 29 Apr 2010 20:20:19 +0300
Message-ID: <00ef01cae7c0$3f785bf0$be6913d0$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcrnvrIF2zOknFVTT7yGW3asiCilSAAAWsyQ
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Look at the other constructors of Sort taking SortFields. These ones are =
deprecated and were removed in 3.0. They are no longer supported. When =
constructing SortFields you can specify the type of sort and also the =
order.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Sirish Vadala [mailto:sirishreddy@gmail.com]
> Sent: Thursday, April 29, 2010 8:09 PM
> To: java-user@lucene.apache.org
> Subject: Using Sort
>=20
>=20
> I have a requirement where in the results have to be sorted in
> ascending
> order for few fields, and descending order for one field.
>=20
> Currently I am using:
>=20
> String[] sortOrder =3D { IFIELD_YEAR, IFIELD_TYPE, IFIELD_NUM,
> IFIELD_SESSION
> };
> Sort sort =3D new Sort(sortOrder);
> hits =3D indexSearcher.search(booleanQuery, sort);
>=20
> Using the above code, everything gets sorted in ascending order
> starting
> with year, type, number and session in that precedence.
>=20
> Now I have a requirement to first sort in ascending order for year,
> type and
> number, and then sort in descending order only for session.
>=20
> Is there a way to get this to work.
>=20
> Thanks.
> --
> View this message in context: =
http://lucene.472066.n3.nabble.com/Using-
> Sort-tp765845p765845.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45967-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 19:50:58 2010
Return-Path: <java-user-return-45967-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96168 invoked from network); 29 Apr 2010 19:50:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 19:50:58 -0000
Received: (qmail 55165 invoked by uid 500); 29 Apr 2010 19:50:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55141 invoked by uid 500); 29 Apr 2010 19:50:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55133 invoked by uid 99); 29 Apr 2010 19:50:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 19:50:55 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of weiho@princeton.edu designates 128.112.128.216 as permitted sender)
Received: from [128.112.128.216] (HELO ppa02.Princeton.EDU) (128.112.128.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 19:50:47 +0000
Received: from smtpserver2.Princeton.EDU (smtpserver2.Princeton.EDU [128.112.129.148])
	by ppa02.Princeton.EDU (8.14.3/8.14.3) with ESMTP id o3TJoQsc011797
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 15:50:26 -0400
Received: from [140.180.52.65] (dynamic-oit-vapornet-c-2416.Princeton.EDU [140.180.52.65])
	(authenticated bits=0)
	by smtpserver2.Princeton.EDU (8.12.9/8.12.9) with ESMTP id o3TJoO49004953
	(version=TLSv1/SSLv3 cipher=RC4-MD5 bits=128 verify=NOT)
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 15:50:26 -0400 (EDT)
Message-ID: <4BD9E329.5030306@princeton.edu>
Date: Thu, 29 Apr 2010 15:51:05 -0400
From: Wei Ho <weiho@princeton.edu>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.9) Gecko/20100317 Lightning/1.0b1 Thunderbird/3.0.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Lucene QueryParser and Analyzer
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hello,

I'm using Lucene to index and search through a collection of Chinese 
documents. However, I'm noticing an odd behavior in query parsing/searching.

Given the two queries below:

(Ci refers to Chinese character i)
Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

Input1 returns absolutely nothing, while Input2 (replacing the commas 
with spaces) works as expected. I'm a bit confused why this would be 
happening - it seems that QueryParser uses the Analyzer passed to it to 
tokenize the input query string, so if the Analyzer ignores the 
punctuations, it seems that Input1 and Input2 should return identical 
results. Is there some pre-Analyzer filtering or whatever that 
QueryParser does? I've tried this with the StandardAnalyzer, 
SmartChineseAnalyzer, and an analyzer that I implemented which 
explicitly skips over punctuations and whitespaces in tokenizing the 
query string, but to no avail.

-------sample code-------------
Analyzer analyzer = new LingPipeAnalyzer();
Searcher searcher = new IndexSearcher(directory);
QueryParser qParser = new MultiFieldQueryParser(Version.LUCENE_30, 
SEARCH_FIELDS, analyzer);
Query query = qParser.parse(queryLine[1]);
ScoreDoc[] results = searcher.search(query, TOP_N).scoreDocs;
-----------------------------------

I'm probably just doing something dumb, but any help would be greatly 
appreciated!

Thanks,
Wei Ho

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45968-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 19:55:22 2010
Return-Path: <java-user-return-45968-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 99917 invoked from network); 29 Apr 2010 19:55:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 19:55:22 -0000
Received: (qmail 61240 invoked by uid 500); 29 Apr 2010 19:55:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61184 invoked by uid 500); 29 Apr 2010 19:55:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61176 invoked by uid 99); 29 Apr 2010 19:55:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 19:55:20 +0000
X-ASF-Spam-Status: No, hits=-1.6 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [150.148.0.65] (HELO ironport5.fda.gov) (150.148.0.65)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 19:55:12 +0000
X-SBRS: None
X-MID: 165827097
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: Aj0FAC6B2UsKoApM/2dsb2JhbACQdY0QvVuFEAQ
Received: from fmd3tj001.fda.gov ([10.160.10.76])
  by ironport5.fda.gov with ESMTP; 29 Apr 2010 15:54:49 -0400
Received: from FMD3VS012.fda.gov ([10.160.10.62]) by FMD3TJ001.fda.gov with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 29 Apr 2010 15:54:22 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Lucene QueryParser and Analyzer
Date: Thu, 29 Apr 2010 15:54:21 -0400
Message-ID: <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov>
In-Reply-To: <4BD9E329.5030306@princeton.edu>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene QueryParser and Analyzer
thread-index: Acrn1UqhBBfx6AtrREu304yY+ziplQAAGlzQ
References: <4BD9E329.5030306@princeton.edu>
From: "Sudarsan, Sithu D." <Sithu.Sudarsan@fda.hhs.gov>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 29 Apr 2010 19:54:22.0693 (UTC) FILETIME=[C377A950:01CAE7D5]
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

Is there a whitespace after the comma?=20


Sincerely,
Sithu D Sudarsan


-----Original Message-----
From: Wei Ho [mailto:weiho@princeton.edu]=20
Sent: Thursday, April 29, 2010 3:51 PM
To: java-user@lucene.apache.org
Subject: Lucene QueryParser and Analyzer

Hello,

I'm using Lucene to index and search through a collection of Chinese=20
documents. However, I'm noticing an odd behavior in query
parsing/searching.

Given the two queries below:

(Ci refers to Chinese character i)
Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

Input1 returns absolutely nothing, while Input2 (replacing the commas=20
with spaces) works as expected. I'm a bit confused why this would be=20
happening - it seems that QueryParser uses the Analyzer passed to it to=20
tokenize the input query string, so if the Analyzer ignores the=20
punctuations, it seems that Input1 and Input2 should return identical=20
results. Is there some pre-Analyzer filtering or whatever that=20
QueryParser does? I've tried this with the StandardAnalyzer,=20
SmartChineseAnalyzer, and an analyzer that I implemented which=20
explicitly skips over punctuations and whitespaces in tokenizing the=20
query string, but to no avail.

-------sample code-------------
Analyzer analyzer =3D new LingPipeAnalyzer();
Searcher searcher =3D new IndexSearcher(directory);
QueryParser qParser =3D new MultiFieldQueryParser(Version.LUCENE_30,=20
SEARCH_FIELDS, analyzer);
Query query =3D qParser.parse(queryLine[1]);
ScoreDoc[] results =3D searcher.search(query, TOP_N).scoreDocs;
-----------------------------------

I'm probably just doing something dumb, but any help would be greatly=20
appreciated!

Thanks,
Wei Ho

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45969-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:03:24 2010
Return-Path: <java-user-return-45969-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5388 invoked from network); 29 Apr 2010 20:03:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:03:24 -0000
Received: (qmail 73212 invoked by uid 500); 29 Apr 2010 20:03:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73062 invoked by uid 500); 29 Apr 2010 20:03:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73054 invoked by uid 99); 29 Apr 2010 20:03:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:03:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of weiho@princeton.edu designates 128.112.128.213 as permitted sender)
Received: from [128.112.128.213] (HELO ppa01.Princeton.EDU) (128.112.128.213)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:03:13 +0000
Received: from smtpserver1.Princeton.EDU (smtpserver1.Princeton.EDU [128.112.129.65])
	by ppa01.Princeton.EDU (8.14.3/8.14.3) with ESMTP id o3TK2rQN018058
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 16:02:53 -0400
Received: from [140.180.52.65] (dynamic-oit-vapornet-c-2416.Princeton.EDU [140.180.52.65])
	(authenticated bits=0)
	by smtpserver1.Princeton.EDU (8.12.9/8.12.9) with ESMTP id o3TK2qKR006876
	(version=TLSv1/SSLv3 cipher=RC4-MD5 bits=128 verify=NOT)
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 16:02:52 -0400 (EDT)
Message-ID: <4BD9E616.7030103@princeton.edu>
Date: Thu, 29 Apr 2010 16:03:34 -0400
From: Wei Ho <weiho@princeton.edu>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.9) Gecko/20100317 Lightning/1.0b1 Thunderbird/3.0.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene QueryParser and Analyzer
References: <4BD9E329.5030306@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov>
In-Reply-To: <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

No, there is no whitespace after the comma in Input1

Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

Input1 is basically one big long word with commas and Chinese characters 
one after the other. Input2 is where I manually separated the string 
into the component terms by replacing the comma with whitespace. My 
confusion stems from the fact that I thought it should not matter since 
the analyzer should be discarding the punctuation anyway? So the 
tokenization process should be the same for both Input1 and Input2? If 
that is not the case, what do I need to change?

Thanks,
Wei Ho

-------- Original Message  --------
Subject: Re: Lucene QueryParser and Analyzer
From: Sudarsan, Sithu D. <Sithu.Sudarsan@fda.hhs.gov>
To: java-user@lucene.apache.org
Date: 4/29/2010 3:54 PM
> Hi,
>
> Is there a whitespace after the comma?
>
>
> Sincerely,
> Sithu D Sudarsan
>
>
> -----Original Message-----
> From: Wei Ho [mailto:weiho@princeton.edu]
> Sent: Thursday, April 29, 2010 3:51 PM
> To: java-user@lucene.apache.org
> Subject: Lucene QueryParser and Analyzer
>
> Hello,
>
> I'm using Lucene to index and search through a collection of Chinese
> documents. However, I'm noticing an odd behavior in query
> parsing/searching.
>
> Given the two queries below:
>
> (Ci refers to Chinese character i)
> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>
> Input1 returns absolutely nothing, while Input2 (replacing the commas
> with spaces) works as expected. I'm a bit confused why this would be
> happening - it seems that QueryParser uses the Analyzer passed to it to
> tokenize the input query string, so if the Analyzer ignores the
> punctuations, it seems that Input1 and Input2 should return identical
> results. Is there some pre-Analyzer filtering or whatever that
> QueryParser does? I've tried this with the StandardAnalyzer,
> SmartChineseAnalyzer, and an analyzer that I implemented which
> explicitly skips over punctuations and whitespaces in tokenizing the
> query string, but to no avail.
>
> -------sample code-------------
> Analyzer analyzer = new LingPipeAnalyzer();
> Searcher searcher = new IndexSearcher(directory);
> QueryParser qParser = new MultiFieldQueryParser(Version.LUCENE_30,
> SEARCH_FIELDS, analyzer);
> Query query = qParser.parse(queryLine[1]);
> ScoreDoc[] results = searcher.search(query, TOP_N).scoreDocs;
> -----------------------------------
>
> I'm probably just doing something dumb, but any help would be greatly
> appreciated!
>
> Thanks,
> Wei Ho
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45970-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:07:58 2010
Return-Path: <java-user-return-45970-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9169 invoked from network); 29 Apr 2010 20:07:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:07:58 -0000
Received: (qmail 82318 invoked by uid 500); 29 Apr 2010 20:07:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82283 invoked by uid 500); 29 Apr 2010 20:07:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82275 invoked by uid 99); 29 Apr 2010 20:07:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:07:55 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,URIBL_RED
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:07:48 +0000
Received: by gwj20 with SMTP id 20so174849gwj.35
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 13:07:27 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.55.38 with SMTP id d38mr2138673yba.151.1272571647313; Thu, 
	29 Apr 2010 13:07:27 -0700 (PDT)
Received: by 10.150.190.12 with HTTP; Thu, 29 Apr 2010 13:07:27 -0700 (PDT)
In-Reply-To: <492379B6AA909E4FAF672AACCA0EADC25CC09D6A1A@PHXCCRPRD02.adprod.bmc.com>
References: <492379B6AA909E4FAF672AACCA0EADC24A40EE9B10@PHXCCRPRD02.adprod.bmc.com>
	 <g2k87c998321004122119q6d68fedbv58be2327ae042eae@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42B46@PHXCCRPRD02.adprod.bmc.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBAA42E77@PHXCCRPRD02.adprod.bmc.com>
	 <o2y9ac0c6aa1004140312wc3c74ffdp57158f871761cdda@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CBABBED4D@PHXCCRPRD02.adprod.bmc.com>
	 <n2w9ac0c6aa1004141352s5edb3082o2f1952626c551450@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CC066FD36@PHXCCRPRD02.adprod.bmc.com>
	 <i2i9ac0c6aa1004270340heec28687zc734ebfbbae10bd3@mail.gmail.com>
	 <492379B6AA909E4FAF672AACCA0EADC25CC09D6A1A@PHXCCRPRD02.adprod.bmc.com>
Date: Thu, 29 Apr 2010 16:07:27 -0400
Message-ID: <v2k9ac0c6aa1004291307z9aa93222y7512e27808eeb9db@mail.gmail.com>
Subject: Re: IndexWriter and memory usage
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

OK I think you may be hitting this:

    https://issues.apache.org/jira/browse/LUCENE-2422

Since you have very large docs, the reuse that's done by
IndexInput/Output is tying up alot of memory.

Ross can you try the patch I just attached on that issue (merge it w/
the other issues) and see if that fixes it?  Thanks.

Mike

On Thu, Apr 29, 2010 at 11:58 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
> I ported the patch to 2.9.2 dev but it did not seem to help. =A0Attached =
is my port of the patch. =A0This patch contains both 2283 and 2387, both of=
 which I have applied in trying to resolving this issue.
>
> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Tuesday, April 27, 2010 4:40 AM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriter and memory usage
>
> Oooh -- I suspect you are hitting this issue:
>
> =A0 =A0https://issues.apache.org/jira/browse/LUCENE-2283
>
> Your 3rd image ("fdt") jogged my memory on this one. =A0Can you try
> testing the trunk JAR from after that issue landed? =A0(Or, apply that
> patch against 3.0.x -- let me know if it does not apply cleanly and
> I'll try to back port it).
>
> But: it's spooky that you cannot repro this issue in your dev
> environment. =A0Are you matching the # thread and exact sequence of
> docs?
>
> Mike
>
> On Mon, Apr 26, 2010 at 4:14 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>> We are still plagued by this issue. =A0I tried applying the patch mentio=
ned but this did not resolve the issue.
>>
>> I once tried to attach images from the heap dump to send out to the grou=
p but the server removed them so I have posted the images on a public servi=
ce with links this time. =A0I would appreciate someone looking at them to s=
ee if they provide any insight into what is occurring with this issue.
>>
>> When you follow the link click on the image and then once you see the im=
age click on a link in the lower left hand corner that says "View Raw Image=
." =A0This will let you view the images at 100% resolution.
>>
>> This first image shows what we are seeing within VisualVM in regards to =
the memory. =A0As you can see, over time the memory gets consumed. =A0Final=
ly we are at a point where there is no more memory available.
>> Graph
>> http://tinypic.com/view.php?pic=3D2ltk0h3&s=3D5
>>
>> This second image in VisualVM shows the classes sorted by size. =A0As yo=
u can see, about 70% of all memory is consumed in the bytes array.
>> Bytes
>> http://tinypic.com/view.php?pic=3Ds10mqs&s=3D5
>>
>> This third image is where the real info is. =A0This is where one of the =
bytes is being examined and the option to go to nearest GC is chosen. =A0Wh=
at you see here is what the majority of the bytes show if selected, so this=
 one is representative of most all. =A0As you can see this one byte is asso=
ciated with the index writer as you look at the chain of objects (and thus =
so too are all the other bytes that have not been released for GC).
>> Garbage Collection
>> http://tinypic.com/view.php?pic=3D5obalj&s=3D5
>>
>> I'm hoping that as you look at this that it might mean something to you =
or give you a clue as to what is holding on to all the memory.
>>
>> Now the mysterious thing in all of this is that our use of Lucene has be=
en developed into a "plug-in" that we use within an application that we hav=
e. =A0If I just run JUnit tests around this plugin, indexing some of the sa=
me files that the actual application is indexing, I cannot ever get the mem=
ory loss in my dev environment. =A0Everything seems to work as expected. =
=A0However, once we are in our real situation, then we see this behavior. =
=A0Because of this I would expect that the problem lays with the applicatio=
n, but once we examine the heap dumps it then goes back to showing that the=
 consumed bytes are "owned" by the index writer process. =A0It makes no sen=
se to me that we see this as we do, but none the less we do. =A0We see that=
 the Index Writer process is hanging onto a lot of data in byte arrays and =
it doesn't ever seam to release it.
>>
>> In addition, we would love to show this to someone via a webex if that w=
ould help in seeing what is going on.
>>
>> Please, any help appreciated and any suggestions on how to resolve or ev=
en troubleshoot. =A0I can provide an actual heap dump but it is 63mb in siz=
e (compressed) so we would need to work out some FTP where we can provide i=
t if someone is willing to look at it in VisualVM (or any other profiling t=
ool).
>>
>> BTW - If we open and close the index writer on a regular basis then we d=
on't run into this problem. =A0It is only when we run continuously with an =
open index writer that we do see this problem (we altered the code to open/=
close the writer a lot, but this slows things down, so we don't want to run=
 like this, but we wanted to test the behavior if we did so).
>>
>> Thanks,
>> Ross
>>
>> -----Original Message-----
>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>> Sent: Wednesday, April 14, 2010 2:52 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: IndexWriter and memory usage
>>
>> Run this:
>>
>> =A0 =A0svn co https://svn.apache.org/repos/asf/lucene/java/branches/luce=
ne_2_9
>> lucene.29x
>>
>> Then apply the patch, then, run "ant jar-core", and in that should
>> create the lucene-core-2.9.2-dev.jar.
>>
>> Mike
>>
>> On Wed, Apr 14, 2010 at 1:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote:
>>> How do I get to the 2.9.x branch? =A0Every link I take from the Lucene =
site takes me to the trunk which I assume is the 3.x version. =A0I've tried=
 to look around svn but can't find anything labeled 2.9.x. =A0Is there a da=
ily build of 2.9.x or do I need to build it myself. =A0I would like to try =
out the fix you put into it, but I'm not sure where I get it from.
>>>
>>> -----Original Message-----
>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>> Sent: Wednesday, April 14, 2010 4:12 AM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: IndexWriter and memory usage
>>>
>>> It looks like the mailing list software stripped your image attachments=
...
>>>
>>> Alas these fixes are only committed on 3.1.
>>>
>>> But I just posted the patch on LUCENE-2387 for 2.9.x -- it's a tiny
>>> fix. =A0I think the other issue was part of LUCENE-2074 (though this
>>> issue included many other changes) -- Uwe can you peel out just a
>>> 2.9.x patch for resetting JFlex's zzBuffer?
>>>
>>> You could also try switching analyzers (eg to WhitespaceAnalyzer) to
>>> see if in fact LUCENE-2074 (which affects StandandAnalyzer, since it
>>> uses JFlex) is [part of] your problem.
>>>
>>> Mike
>>>
>>> On Tue, Apr 13, 2010 at 6:42 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrote=
:
>>>> Since the heap dump was so big and can't be attached, I have taken a f=
ew screen shots from Java VisualVM of the heap dump. =A0In the first image =
you can see that at the time our memory has become very tight most of it is=
 held up in bytes. =A0In the second image I examine one of those instances =
and navigate to the nearest garbage collection root. =A0In looking at very =
many of these objects, they all end up being instantiated through the Index=
Writer process.
>>>>
>>>> This heap dump is the same one correlating to the infoStream that was =
attached in a prior message. =A0So while the infoStream shows the buffer be=
ing flushed, what we experience is that our memory gets consumed over time =
by these bytes in the IndexWriter.
>>
>>>>
>>>> I wanted to provide these images to see if they might correlate to the=
 fixes mentioned below. =A0Hopefully those fixes mentioned below have recti=
fied this problem. =A0And as I state in the prior message, I'm hoping these=
 fixes are in a 2.9x branch and hoping for someone to point me to where I c=
an get those fixes to try out.
>>>>
>>>> Thanks
>>>>
>>>> -----Original Message-----
>>>> From: Woolf, Ross [mailto:Ross_Woolf@BMC.com]
>>>> Sent: Tuesday, April 13, 2010 1:29 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: RE: IndexWriter and memory usage
>>>>
>>>> Are these fixes in 2.9x branch? =A0We are using 2.9x and can't move to=
 3x just yet. =A0If so, where do I specifically pick this up from?
>>>>
>>>> -----Original Message-----
>>>> From: Lance Norskog [mailto:goksron@gmail.com]
>>>> Sent: Monday, April 12, 2010 10:20 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Re: IndexWriter and memory usage
>>>>
>>>> There is some bugs where the writer data structures retain data after
>>>> it is flushed. They are committed as of maybe the past week. If you
>>>> can pull the trunk and try it with your use case, that would be great.
>>>>
>>>> On Mon, Apr 12, 2010 at 8:54 AM, Woolf, Ross <Ross_Woolf@bmc.com> wrot=
e:
>>>>> I was on vacation last week so just getting back to this... =A0Here i=
s the info stream (as an attachment). =A0I'll see what I can do about reduc=
ing the heap dump (It was supplied by a colleague).
>>>>>
>>>>>
>>>>> -----Original Message-----
>>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>>> Sent: Saturday, April 03, 2010 3:39 AM
>>>>> To: java-user@lucene.apache.org
>>>>> Subject: Re: IndexWriter and memory usage
>>>>>
>>>>> Hmm why is the heap dump so immense? =A0Normally it contains the top =
N
>>>>> (eg 100) object types and their count/aggregate RAM usage.
>>>>>
>>>>> Can you attach the infoStream output to an email (to java-user)?
>>>>>
>>>>> Mike
>>>>>
>>>>> On Fri, Apr 2, 2010 at 5:28 PM, Woolf, Ross <Ross_Woolf@bmc.com> wrot=
e:
>>>>>> I have this and the heap dump is 63mb zipped. =A0The info stream is =
much smaller (31 kb zipped), but I don't know how to get them to you.
>>>>>>
>>>>>> We are not using the NRT readers
>>>>>>
>>>>>> -----Original Message-----
>>>>>> From: Michael McCandless [mailto:lucene@mikemccandless.com]
>>>>>> Sent: Thursday, April 01, 2010 5:21 PM
>>>>>> To: java-user@lucene.apache.org
>>>>>> Subject: Re: IndexWriter and memory usage
>>>>>>
>>>>>> Hmm, not good. =A0Can you post a heap dump? =A0Also, can you turn on
>>>>>> infoStream, index up to the OOM @ 512 MB, and post the output?
>>>>>>
>>>>>> IndexWriter should not hang onto much beyond the RAM buffer. =A0But,=
 it
>>>>>> does allocate and then recycle this RAM buffer, so even in an idle
>>>>>> state (having indexed enough docs to fill up the RAM buffer at least
>>>>>> once) it'll hold onto those 16 MB.
>>>>>>
>>>>>> Are you using getReader (to get your NRT readers)? =A0If so, are you
>>>>>> really sure you're eventually closing the previous reader after
>>>>>> opening a new one?
>>>>>>
>>>>>> Mike
>>>>>>
>>>>>> On Thu, Apr 1, 2010 at 6:58 PM, Woolf, Ross <Ross_Woolf@bmc.com> wro=
te:
>>>>>>> We are seeing a situation where the IndexWriter is using up the Jav=
a Heap space and only releases memory for garbage collection upon a commit.=
 =A0 We are using the default RAMBufferSize of 16 mb. =A0We are using Lucen=
e 2.9.1. We are set at heap size of 512 mb.
>>>>>>>
>>>>>>> We have a large number of documents that are run through Tika and t=
hen added to the index. =A0The data from Tika is changed to a string, and t=
hen sent to Lucene. =A0Heap dumps clearly show the data in the Lucene class=
es and not in Tika. =A0Our intent is to only perform a commit once the enti=
re indexing run is complete, but several hours into the process everything =
comes to a crawl. =A0In using both JConsole and VisualVM =A0we can see that=
 the heap space is maxed out and garbage collection is not able to clean up=
 any memory once we get into this state. =A0It is our understanding that th=
e IndexWriter should be only holding onto 16 mb of data before it flushes i=
t, but what we are seeing is that while it is in fact writing data to disk =
when it hits the 16 mb limit, it is also holding onto some data in memory a=
nd not allowing garbage collection to take place, and this continues until =
garbage collection is unable to free up enough space to all things to move =
faster than a crawl.
>>>>>>>
>>>>>>> As a test we caused a commit to occur after each document is indexe=
d and we see the total amount of memory reduced from nearly 100% of the Jav=
a Heap to around 70-75%. =A0The profiling tools now show that the memory is=
 cleaned up to some extent after each document. =A0But of course this compl=
etely defeats the whole reason why we want to only commit at the end of the=
 run for performance sake. =A0Most of the data, as seen using Heap analasis=
, is held in Byte, Character, and Integer classes whos GC roots are tied ba=
ck to the Writer Objects and threads. =A0The instance counts, after running=
 just 1,100 documents seems staggering
>>>>>>>
>>>>>>> Is there additional data that the IndexWriter hangs onto regardless=
 of when it hits the RAMBufferSize limit? =A0Why are we seeing the heap spa=
ce all being used up?
>>>>>>>
>>>>>>> A side question to this is the fact that we always see a large amou=
nt of memory used by the IndexWriter even after our indexing has been compl=
eted and all commits have taken place (basically in an idle state). =A0Why =
would this be? =A0Is the only way to totally clean up the memory is to clos=
e the writer? =A0Our index is also used for real time indexing so the Index=
Writer is intended to remain open for the lifetime of the app.
>>>>>>>
>>>>>>> Any help in understanding why the IndexWriter is maxing out our hea=
p space or what is expected from memory usage of the IndexWriter would be a=
ppreciated.
>>>>>>>
>>>>>>
>>>>>> --------------------------------------------------------------------=
-
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>
>>>>>>
>>>>>> --------------------------------------------------------------------=
-
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>
>>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Lance Norskog
>>>> goksron@gmail.com
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45971-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:15:18 2010
Return-Path: <java-user-return-45971-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13023 invoked from network); 29 Apr 2010 20:15:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:15:18 -0000
Received: (qmail 93426 invoked by uid 500); 29 Apr 2010 20:15:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93395 invoked by uid 500); 29 Apr 2010 20:15:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93387 invoked by uid 99); 29 Apr 2010 20:15:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:15:16 +0000
X-ASF-Spam-Status: No, hits=-1.6 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [150.148.0.65] (HELO ironport4.fda.gov) (150.148.0.65)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:15:09 +0000
X-SBRS: None
X-MID: 178625642
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApsEAN6F2UsKoApM/2dsb2JhbACeBb5+hRAE
Received: from fmd3tj001.fda.gov ([10.160.10.76])
  by ironport4.fda.gov with ESMTP; 29 Apr 2010 16:14:48 -0400
Received: from FMD3VS012.fda.gov ([10.160.10.62]) by FMD3TJ001.fda.gov with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 29 Apr 2010 16:14:29 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Lucene QueryParser and Analyzer
Date: Thu, 29 Apr 2010 16:08:24 -0400
Message-ID: <F8A04958BB57B64096F9BE6B95725643081E3D75@FMD3VS012.fda.gov>
In-Reply-To: <4BD9E616.7030103@princeton.edu>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene QueryParser and Analyzer
thread-index: Acrn1xDs10T4bwbpSU6bmd71GLZguAAAHHmA
References: <4BD9E329.5030306@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov> <4BD9E616.7030103@princeton.edu>
From: "Sudarsan, Sithu D." <Sithu.Sudarsan@fda.hhs.gov>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 29 Apr 2010 20:14:29.0435 (UTC) FILETIME=[92BDE0B0:01CAE7D8]
X-Virus-Checked: Checked by ClamAV on apache.org

=20
If so,

Input1:  c1c2c3c4c5c6c7....
Input2: c1c2 c3c4 ...

I guess, they are different! Add a whitespace after commas and see if
that works...

Sincerely,
Sithu D Sudarsan


-----Original Message-----
From: Wei Ho [mailto:weiho@princeton.edu]=20
Sent: Thursday, April 29, 2010 4:04 PM
To: java-user@lucene.apache.org
Subject: Re: Lucene QueryParser and Analyzer

No, there is no whitespace after the comma in Input1

Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

Input1 is basically one big long word with commas and Chinese characters

one after the other. Input2 is where I manually separated the string=20
into the component terms by replacing the comma with whitespace. My=20
confusion stems from the fact that I thought it should not matter since=20
the analyzer should be discarding the punctuation anyway? So the=20
tokenization process should be the same for both Input1 and Input2? If=20
that is not the case, what do I need to change?

Thanks,
Wei Ho

-------- Original Message  --------
Subject: Re: Lucene QueryParser and Analyzer
From: Sudarsan, Sithu D. <Sithu.Sudarsan@fda.hhs.gov>
To: java-user@lucene.apache.org
Date: 4/29/2010 3:54 PM
> Hi,
>
> Is there a whitespace after the comma?
>
>
> Sincerely,
> Sithu D Sudarsan
>
>
> -----Original Message-----
> From: Wei Ho [mailto:weiho@princeton.edu]
> Sent: Thursday, April 29, 2010 3:51 PM
> To: java-user@lucene.apache.org
> Subject: Lucene QueryParser and Analyzer
>
> Hello,
>
> I'm using Lucene to index and search through a collection of Chinese
> documents. However, I'm noticing an odd behavior in query
> parsing/searching.
>
> Given the two queries below:
>
> (Ci refers to Chinese character i)
> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>
> Input1 returns absolutely nothing, while Input2 (replacing the commas
> with spaces) works as expected. I'm a bit confused why this would be
> happening - it seems that QueryParser uses the Analyzer passed to it
to
> tokenize the input query string, so if the Analyzer ignores the
> punctuations, it seems that Input1 and Input2 should return identical
> results. Is there some pre-Analyzer filtering or whatever that
> QueryParser does? I've tried this with the StandardAnalyzer,
> SmartChineseAnalyzer, and an analyzer that I implemented which
> explicitly skips over punctuations and whitespaces in tokenizing the
> query string, but to no avail.
>
> -------sample code-------------
> Analyzer analyzer =3D new LingPipeAnalyzer();
> Searcher searcher =3D new IndexSearcher(directory);
> QueryParser qParser =3D new MultiFieldQueryParser(Version.LUCENE_30,
> SEARCH_FIELDS, analyzer);
> Query query =3D qParser.parse(queryLine[1]);
> ScoreDoc[] results =3D searcher.search(query, TOP_N).scoreDocs;
> -----------------------------------
>
> I'm probably just doing something dumb, but any help would be greatly
> appreciated!
>
> Thanks,
> Wei Ho
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   =20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45972-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:22:21 2010
Return-Path: <java-user-return-45972-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16211 invoked from network); 29 Apr 2010 20:22:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:22:20 -0000
Received: (qmail 99548 invoked by uid 500); 29 Apr 2010 20:22:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99507 invoked by uid 500); 29 Apr 2010 20:22:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99499 invoked by uid 99); 29 Apr 2010 20:22:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:22:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.83] (HELO web32906.mail.mud.yahoo.com) (209.191.69.83)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 20:22:09 +0000
Received: (qmail 20683 invoked by uid 60001); 29 Apr 2010 20:21:47 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272572507; bh=79dMJ+0klPCIvYMRFUwn0Kqt1gD39SMBRhNASgQ7nyI=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=ruP8qvU68r06oWvdiEUavbuk6Sk2BX+MKjKrod3+nkydCB6qZjE/xM4ls5IS+AnLviZH7AcD3GJkwBbx35o8JfaNaE83TP9zT8/2IzKZToj4UjSQFFQe6J6XHXeIGR4LAZiDzgAYtLCzQpcOCxs1S1FAwHbNs14vSDepCbWB6RI=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=s5EmqQsFMfyWaR5jQYWwmtCgRjcIyb707tDxy1wFp+xDcjuvf4Cb8fS4zHLu2pXzQjVZYfsTS8EzQvimN8AqO0e9XewP0e8GW6vouJnxVDp+OzO22XJ+zWwkM9coL/q+osz0d5yB5S+KgthJdaAZqHeQLELO99AI/bxsVhr4Igg=;
Message-ID: <509584.20264.qm@web32906.mail.mud.yahoo.com>
X-YMail-OSG: QN1O5TwVM1k5xWQaTKTjsP8LfG4G2xxj0e0L5vB7Hq7Nyxo
 jeXfU9ffY.CaKfSed.Ry9_v8yF4Qq6x36e3KTRDetr5yVUoD6w4T6XuOkAPg
 SI_HOqiUO3DIEeslf2tO.ThDw6Bh9OjeW6FI1oeKM7TgacJWbQQOChRCF8v3
 INeGqb8BCPZh86LPSqEwbdJolH1GOB6rMufVcARac6h_gJXQXtEbqUKsc6IO
 tCWU6xsfgZeMemBJnwLXiekcicAgMyGRr0hW3BCdQk6BT5ZUX_31xWSueREv
 aWvPgEfLq0sufLNz5Ad5uB.LdxJtg535ysJwUdm8zsPS7xfUeMmHBRNy31nH
 HNAZodhS8VmC9D_aocaEchIUw05_rFBvUvcmKBpqHt7G5ae6UffzV1R5rYeb
 ._m4FeK7eb2s79ZLMP3Dl
Received: from [72.36.94.20] by web32906.mail.mud.yahoo.com via HTTP; Thu, 29 Apr 2010 13:21:46 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
Date: Thu, 29 Apr 2010 13:21:46 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Highlighter usage
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

I'm trying to use Highlighter with QueryScorer after reading:

https://issues.apache.org/jira/browse/LUCENE-1685

The problem is: I'm not getting a result unless my the query term is an exact match.  Am I missing filters?  Is there a more complete example of how this should work?


    String content = "Global Climate Change affects us all";

    String field = "content";
    BooleanQuery query = new BooleanQuery();

    // Unstemmed, matched case works
    //query.add(new TermQuery(new Term(field, "Climate")), BooleanClause.Occur.MUST);

    // Stemmed, lowercase doesn't work
    query.add(new TermQuery(new Term(field, "climat")), BooleanClause.Occur.MUST);
    query.add(new TermQuery(new Term(field, "affect")), BooleanClause.Occur.MUST);

    Highlighter highlighter = new Highlighter(new QueryScorer(query, field));
    highlighter.setMaxDocCharsToAnalyze(500000);

    TokenStream ts = htmlStripAnalyzer.tokenStream(field, new StringReader(content));
    ts = new CachingTokenFilter(ts);

    System.out.println(highlighter.getBestFragment(ts, content));


Thanks for any feedback,
Justin



      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45973-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:30:41 2010
Return-Path: <java-user-return-45973-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20148 invoked from network); 29 Apr 2010 20:30:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:30:40 -0000
Received: (qmail 5902 invoked by uid 500); 29 Apr 2010 20:30:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5872 invoked by uid 500); 29 Apr 2010 20:30:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5864 invoked by uid 99); 29 Apr 2010 20:30:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:30:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:30:30 +0000
Received: by gwj20 with SMTP id 20so191827gwj.35
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 13:30:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=7SSGpFkmg6phsTAajcsp2VgVwm3UsFqffOfcKpSNnOY=;
        b=exoGKDBtN8kq2sIxdb3lUqI7C0OXOimRQh7WJ2KUVa9b2qyHd6kHtkbhLnEs0R0Zy0
         GLr3ANHQdTAzLLtjVIFJXZ6O1wo0yRp7BPff8wrQ0T81V4/CCTmhzv/uoRAPkXlOv/ku
         C4U7p9T5+yDWJHfan5Ozs4ZrAgdsy+EC+GnsQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=QvltTmYtT+MizNYtSMLEfNRwcgjuXtTbp//PmWCApSSRzk0FkqUPomMkh1aDBzdhLM
         BmOuMdJUyhfVg9qchCWz4FYKkaB8/aVQM7quHUi5DNzf2pEtmphmtgmG0pZaHePDr7z/
         8TLVKJsfgIDj1Pz/93axPwfTt8hrhSxaVgMZk=
MIME-Version: 1.0
Received: by 10.150.13.20 with SMTP id 20mr2227377ybm.170.1272573009600; Thu, 
	29 Apr 2010 13:30:09 -0700 (PDT)
Received: by 10.151.43.7 with HTTP; Thu, 29 Apr 2010 13:30:09 -0700 (PDT)
In-Reply-To: <509584.20264.qm@web32906.mail.mud.yahoo.com>
References: <509584.20264.qm@web32906.mail.mud.yahoo.com>
Date: Thu, 29 Apr 2010 16:30:09 -0400
Message-ID: <n2g359a92831004291330w23fc24beu4984623748dccf66@mail.gmail.com>
Subject: Re: Highlighter usage
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd76164302262048565fe46
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd76164302262048565fe46
Content-Type: text/plain; charset=ISO-8859-1

What analyzer are you using at index time? My guess is something
like WhitespaceAnalyzer that doesn't stem or change case..... Try
a different analyzer, SimpleAnalyzer comes to mind....

HTH
Erick

On Thu, Apr 29, 2010 at 4:21 PM, Justin <crynax@yahoo.com> wrote:

> I'm trying to use Highlighter with QueryScorer after reading:
>
> https://issues.apache.org/jira/browse/LUCENE-1685
>
> The problem is: I'm not getting a result unless my the query term is an
> exact match.  Am I missing filters?  Is there a more complete example of how
> this should work?
>
>
>    String content = "Global Climate Change affects us all";
>
>    String field = "content";
>    BooleanQuery query = new BooleanQuery();
>
>    // Unstemmed, matched case works
>    //query.add(new TermQuery(new Term(field, "Climate")),
> BooleanClause.Occur.MUST);
>
>    // Stemmed, lowercase doesn't work
>    query.add(new TermQuery(new Term(field, "climat")),
> BooleanClause.Occur.MUST);
>    query.add(new TermQuery(new Term(field, "affect")),
> BooleanClause.Occur.MUST);
>
>    Highlighter highlighter = new Highlighter(new QueryScorer(query,
> field));
>    highlighter.setMaxDocCharsToAnalyze(500000);
>
>    TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
> StringReader(content));
>    ts = new CachingTokenFilter(ts);
>
>    System.out.println(highlighter.getBestFragment(ts, content));
>
>
> Thanks for any feedback,
> Justin
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd76164302262048565fe46--

From java-user-return-45974-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:43:55 2010
Return-Path: <java-user-return-45974-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28127 invoked from network); 29 Apr 2010 20:43:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:43:55 -0000
Received: (qmail 25048 invoked by uid 500); 29 Apr 2010 20:43:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25011 invoked by uid 500); 29 Apr 2010 20:43:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25003 invoked by uid 99); 29 Apr 2010 20:43:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:43:53 +0000
X-ASF-Spam-Status: No, hits=-1.7 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of weiho@princeton.edu designates 128.112.128.215 as permitted sender)
Received: from [128.112.128.215] (HELO ppa04.Princeton.EDU) (128.112.128.215)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:43:46 +0000
Received: from smtpserver1.Princeton.EDU (smtpserver1.Princeton.EDU [128.112.129.65])
	by ppa04.Princeton.EDU (8.14.3/8.14.3) with ESMTP id o3TKhPcc018684
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 16:43:25 -0400
Received: from [140.180.52.65] (dynamic-oit-vapornet-c-2416.Princeton.EDU [140.180.52.65])
	(authenticated bits=0)
	by smtpserver1.Princeton.EDU (8.12.9/8.12.9) with ESMTP id o3TKhPKR028061
	(version=TLSv1/SSLv3 cipher=RC4-MD5 bits=128 verify=NOT)
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 16:43:25 -0400 (EDT)
Message-ID: <4BD9EF96.5030206@princeton.edu>
Date: Thu, 29 Apr 2010 16:44:06 -0400
From: Wei Ho <weiho@princeton.edu>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.9) Gecko/20100317 Lightning/1.0b1 Thunderbird/3.0.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene QueryParser and Analyzer
References: <4BD9E329.5030306@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov> <4BD9E616.7030103@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D75@FMD3VS012.fda.gov>
In-Reply-To: <F8A04958BB57B64096F9BE6B95725643081E3D75@FMD3VS012.fda.gov>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Sorry, I guess "discarding the punctuation" was a bit misleading.
I meant that given the two input strings,

Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

The analyzer I implemented tokenizes both Input1 and Input2 as "C1C2", 
"C3C4", "C5C6", "C7", "C8C9C10" - that is, it doesn't include the 
punctuation in the tokenization. I'm assuming that QueryParser is simply 
passing the entire input string to the analyzer and taking the tokens, 
in which case Input1 and Input2 should be considered identifcal. Does 
QueryParser doing any sort of pre-processing or filtering beforehand? If 
so, how can I turn it off?

Aside from stopping tokens at punctuations, my analyzer is also doing 
Chinese word segmentation, so I'd like to be sure that QueryParser is 
using the analyzer the way I expect it to.

Thanks,
Wei



-------- Original Message  --------
Subject: Re: Lucene QueryParser and Analyzer
From: Sudarsan, Sithu D. <Sithu.Sudarsan@fda.hhs.gov>
To: java-user@lucene.apache.org
Date: 4/29/2010 4:08 PM
>
> If so,
>
> Input1:  c1c2c3c4c5c6c7....
> Input2: c1c2 c3c4 ...
>
> I guess, they are different! Add a whitespace after commas and see if
> that works...
>
> Sincerely,
> Sithu D Sudarsan
>
>
> -----Original Message-----
> From: Wei Ho [mailto:weiho@princeton.edu]
> Sent: Thursday, April 29, 2010 4:04 PM
> To: java-user@lucene.apache.org
> Subject: Re: Lucene QueryParser and Analyzer
>
> No, there is no whitespace after the comma in Input1
>
> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>
> Input1 is basically one big long word with commas and Chinese characters
>
> one after the other. Input2 is where I manually separated the string
> into the component terms by replacing the comma with whitespace. My
> confusion stems from the fact that I thought it should not matter since
> the analyzer should be discarding the punctuation anyway? So the
> tokenization process should be the same for both Input1 and Input2? If
> that is not the case, what do I need to change?
>
> Thanks,
> Wei Ho
>
> -------- Original Message  --------
> Subject: Re: Lucene QueryParser and Analyzer
> From: Sudarsan, Sithu D.<Sithu.Sudarsan@fda.hhs.gov>
> To: java-user@lucene.apache.org
> Date: 4/29/2010 3:54 PM
>    
>> Hi,
>>
>> Is there a whitespace after the comma?
>>
>>
>> Sincerely,
>> Sithu D Sudarsan
>>
>>
>> -----Original Message-----
>> From: Wei Ho [mailto:weiho@princeton.edu]
>> Sent: Thursday, April 29, 2010 3:51 PM
>> To: java-user@lucene.apache.org
>> Subject: Lucene QueryParser and Analyzer
>>
>> Hello,
>>
>> I'm using Lucene to index and search through a collection of Chinese
>> documents. However, I'm noticing an odd behavior in query
>> parsing/searching.
>>
>> Given the two queries below:
>>
>> (Ci refers to Chinese character i)
>> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
>> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>>
>> Input1 returns absolutely nothing, while Input2 (replacing the commas
>> with spaces) works as expected. I'm a bit confused why this would be
>> happening - it seems that QueryParser uses the Analyzer passed to it
>>      
> to
>    
>> tokenize the input query string, so if the Analyzer ignores the
>> punctuations, it seems that Input1 and Input2 should return identical
>> results. Is there some pre-Analyzer filtering or whatever that
>> QueryParser does? I've tried this with the StandardAnalyzer,
>> SmartChineseAnalyzer, and an analyzer that I implemented which
>> explicitly skips over punctuations and whitespaces in tokenizing the
>> query string, but to no avail.
>>
>> -------sample code-------------
>> Analyzer analyzer = new LingPipeAnalyzer();
>> Searcher searcher = new IndexSearcher(directory);
>> QueryParser qParser = new MultiFieldQueryParser(Version.LUCENE_30,
>> SEARCH_FIELDS, analyzer);
>> Query query = qParser.parse(queryLine[1]);
>> ScoreDoc[] results = searcher.search(query, TOP_N).scoreDocs;
>> -----------------------------------
>>
>> I'm probably just doing something dumb, but any help would be greatly
>> appreciated!
>>
>> Thanks,
>> Wei Ho
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>      
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45975-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 20:55:22 2010
Return-Path: <java-user-return-45975-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36420 invoked from network); 29 Apr 2010 20:55:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 20:55:22 -0000
Received: (qmail 39947 invoked by uid 500); 29 Apr 2010 20:55:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39914 invoked by uid 500); 29 Apr 2010 20:55:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39906 invoked by uid 99); 29 Apr 2010 20:55:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:55:20 +0000
X-ASF-Spam-Status: No, hits=-2.9 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [150.148.0.65] (HELO ironport4.fda.gov) (150.148.0.65)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 20:55:15 +0000
X-SBRS: None
X-MID: 178633749
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApsEAD+P2UsKoApN/2dsb2JhbACeBr8ihRAE
Received: from fmd3tj002.fda.gov ([10.160.10.77])
  by ironport4.fda.gov with ESMTP; 29 Apr 2010 16:54:53 -0400
Received: from FMD3VS012.fda.gov ([10.160.10.62]) by FMD3TJ002.fda.gov with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 29 Apr 2010 16:54:38 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Lucene QueryParser and Analyzer
Date: Thu, 29 Apr 2010 16:54:37 -0400
Message-ID: <F8A04958BB57B64096F9BE6B95725643081E3D76@FMD3VS012.fda.gov>
In-Reply-To: <4BD9EF96.5030206@princeton.edu>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene QueryParser and Analyzer
thread-index: Acrn3LBIAPRRwWziSLqq8rnkqKo2jgAANiEg
References: <4BD9E329.5030306@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov> <4BD9E616.7030103@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D75@FMD3VS012.fda.gov> <4BD9EF96.5030206@princeton.edu>
From: "Sudarsan, Sithu D." <Sithu.Sudarsan@fda.hhs.gov>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 29 Apr 2010 20:54:38.0348 (UTC) FILETIME=[2E90D4C0:01CAE7DE]

=20
-------sample code-------------
>> Analyzer analyzer =3D new LingPipeAnalyzer();
>> Searcher searcher =3D new IndexSearcher(directory);
>> QueryParser qParser =3D new MultiFieldQueryParser(Version.LUCENE_30,
>> SEARCH_FIELDS, analyzer);
>> Query query =3D qParser.parse(queryLine[1]);
>> ScoreDoc[] results =3D searcher.search(query, TOP_N).scoreDocs;

qParser will use the analyzer LingPipeAnalyzer() before forming the
query.


Sincerely,
Sithu D Sudarsan


-----Original Message-----
From: Wei Ho [mailto:weiho@princeton.edu]=20
Sent: Thursday, April 29, 2010 4:44 PM
To: java-user@lucene.apache.org
Subject: Re: Lucene QueryParser and Analyzer

Sorry, I guess "discarding the punctuation" was a bit misleading.
I meant that given the two input strings,

Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

The analyzer I implemented tokenizes both Input1 and Input2 as "C1C2",=20
"C3C4", "C5C6", "C7", "C8C9C10" - that is, it doesn't include the=20
punctuation in the tokenization. I'm assuming that QueryParser is simply

passing the entire input string to the analyzer and taking the tokens,=20
in which case Input1 and Input2 should be considered identifcal. Does=20
QueryParser doing any sort of pre-processing or filtering beforehand? If

so, how can I turn it off?

Aside from stopping tokens at punctuations, my analyzer is also doing=20
Chinese word segmentation, so I'd like to be sure that QueryParser is=20
using the analyzer the way I expect it to.

Thanks,
Wei



-------- Original Message  --------
Subject: Re: Lucene QueryParser and Analyzer
From: Sudarsan, Sithu D. <Sithu.Sudarsan@fda.hhs.gov>
To: java-user@lucene.apache.org
Date: 4/29/2010 4:08 PM
>
> If so,
>
> Input1:  c1c2c3c4c5c6c7....
> Input2: c1c2 c3c4 ...
>
> I guess, they are different! Add a whitespace after commas and see if
> that works...
>
> Sincerely,
> Sithu D Sudarsan
>
>
> -----Original Message-----
> From: Wei Ho [mailto:weiho@princeton.edu]
> Sent: Thursday, April 29, 2010 4:04 PM
> To: java-user@lucene.apache.org
> Subject: Re: Lucene QueryParser and Analyzer
>
> No, there is no whitespace after the comma in Input1
>
> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>
> Input1 is basically one big long word with commas and Chinese
characters
>
> one after the other. Input2 is where I manually separated the string
> into the component terms by replacing the comma with whitespace. My
> confusion stems from the fact that I thought it should not matter
since
> the analyzer should be discarding the punctuation anyway? So the
> tokenization process should be the same for both Input1 and Input2? If
> that is not the case, what do I need to change?
>
> Thanks,
> Wei Ho
>
> -------- Original Message  --------
> Subject: Re: Lucene QueryParser and Analyzer
> From: Sudarsan, Sithu D.<Sithu.Sudarsan@fda.hhs.gov>
> To: java-user@lucene.apache.org
> Date: 4/29/2010 3:54 PM
>   =20
>> Hi,
>>
>> Is there a whitespace after the comma?
>>
>>
>> Sincerely,
>> Sithu D Sudarsan
>>
>>
>> -----Original Message-----
>> From: Wei Ho [mailto:weiho@princeton.edu]
>> Sent: Thursday, April 29, 2010 3:51 PM
>> To: java-user@lucene.apache.org
>> Subject: Lucene QueryParser and Analyzer
>>
>> Hello,
>>
>> I'm using Lucene to index and search through a collection of Chinese
>> documents. However, I'm noticing an odd behavior in query
>> parsing/searching.
>>
>> Given the two queries below:
>>
>> (Ci refers to Chinese character i)
>> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
>> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>>
>> Input1 returns absolutely nothing, while Input2 (replacing the commas
>> with spaces) works as expected. I'm a bit confused why this would be
>> happening - it seems that QueryParser uses the Analyzer passed to it
>>     =20
> to
>   =20
>> tokenize the input query string, so if the Analyzer ignores the
>> punctuations, it seems that Input1 and Input2 should return identical
>> results. Is there some pre-Analyzer filtering or whatever that
>> QueryParser does? I've tried this with the StandardAnalyzer,
>> SmartChineseAnalyzer, and an analyzer that I implemented which
>> explicitly skips over punctuations and whitespaces in tokenizing the
>> query string, but to no avail.
>>
>>=20
>> -----------------------------------
>>
>> I'm probably just doing something dumb, but any help would be greatly
>> appreciated!
>>
>> Thanks,
>> Wei Ho
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     =20
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   =20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45976-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 21:11:12 2010
Return-Path: <java-user-return-45976-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45120 invoked from network); 29 Apr 2010 21:11:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 21:11:11 -0000
Received: (qmail 50499 invoked by uid 500); 29 Apr 2010 21:11:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50470 invoked by uid 500); 29 Apr 2010 21:11:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50462 invoked by uid 99); 29 Apr 2010 21:11:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 21:11:09 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.191.69.84] (HELO web32907.mail.mud.yahoo.com) (209.191.69.84)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 21:11:02 +0000
Received: (qmail 91496 invoked by uid 60001); 29 Apr 2010 21:10:40 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272575440; bh=y0dp7+deQbuz/cfaaGdkpTq8nX0S2nAl6EBZlhPVerU=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=gFqK65zDJZRTfFCcVNzjqzS/UamqshxEHQcMj1CwogCmVRp24ASj/Z+eISeICbKCFzFpFEwjfbV++wbqGGUcyrPbrWc83qb7rowhu35V1PUNZ6BQSkLeZ/bzezP0oKY+3SWMQl+j478e1oG7o85U76UeUq/pyQcfrgFbHQ3018c=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=3ykyamlA3EKrPNNv0JVueG9SWDIPepafwcvynxUuRr9Zp4iEPaQ+ohH4+FEZR8cXFd8+TwHqA0t4LhuIvjGG3P+WIdyraPGhvpf7uqcPOcBGzZDOfDdxKS89Wjtyog4V8ZRSPQeZYkvKG6fGNqWGO4jjk7GhmGuewF5mWZ52Auc=;
Message-ID: <315755.85702.qm@web32907.mail.mud.yahoo.com>
X-YMail-OSG: vdbQs9oVM1mNogjAx9o9M5CK6kpm5A0UxDVIQgrHZKn7ClH
 FxEEn_XLOpldFawtHBMBDOngIcMGDHpnjP5bPond9BM_JRMRjg4816ZZX16J
 dDJBiUqnIIR0jgnezOXL4mVVwkfygTx7kYAM9D3xEcj39m9TBUVHux1v7X4f
 aA9QV.v7G.QeXCE6T.nGZ8u1H5ajwDv7ngycn77TsKKCAIDAkHP_orh_VBsC
 L3IpQGxrsmlxhQCZEnfVJ89ulw7mtqiqQJv41.fLcyoF29uupsep2jj3EEfM
 tbEHQf0yfla4KyrSWmjxUR1diAEAebqnUtqVpF5wZB3J1R8Tt3wx4b2E8ItB
 omVahWDjjyQ7qmpji9rAwY5qdeY8-
Received: from [72.36.94.20] by web32907.mail.mud.yahoo.com via HTTP; Thu, 29 Apr 2010 14:10:40 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
References: <509584.20264.qm@web32906.mail.mud.yahoo.com> <n2g359a92831004291330w23fc24beu4984623748dccf66@mail.gmail.com>
Date: Thu, 29 Apr 2010 14:10:40 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: Highlighter usage
To: java-user@lucene.apache.org
In-Reply-To: <n2g359a92831004291330w23fc24beu4984623748dccf66@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

I'm using my own analyzer so I can interject HTMLStripCharFilter as described in a previous thread.

  private static Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
      @Override
      protected TokenStreamComponents createComponents(
              final String fieldName, final Reader reader) {
            return new TokenStreamComponents(new StandardTokenizer(Version.LUCENE_30,
                    new HTMLStripCharFilter(CharReader.get(reader))));
      }
  };

So should I replace StandardTokenizer with LowerCaseTokenizer above?  Then would I override nextToken() and stem or is there a better way to use something like SnowballFilter?




----- Original Message ----
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Sent: Thu, April 29, 2010 3:30:09 PM
Subject: Re: Highlighter usage

What analyzer are you using at index time? My guess is something
like WhitespaceAnalyzer that doesn't stem or change case..... Try
a different analyzer, SimpleAnalyzer comes to mind....

HTH
Erick

On Thu, Apr 29, 2010 at 4:21 PM, Justin <crynax@yahoo.com> wrote:

> I'm trying to use Highlighter with QueryScorer after reading:
>
> https://issues.apache.org/jira/browse/LUCENE-1685
>
> The problem is: I'm not getting a result unless my the query term is an
> exact match.  Am I missing filters?  Is there a more complete example of how
> this should work?
>
>
>    String content = "Global Climate Change affects us all";
>
>    String field = "content";
>    BooleanQuery query = new BooleanQuery();
>
>    // Unstemmed, matched case works
>    //query.add(new TermQuery(new Term(field, "Climate")),
> BooleanClause.Occur.MUST);
>
>    // Stemmed, lowercase doesn't work
>    query.add(new TermQuery(new Term(field, "climat")),
> BooleanClause.Occur.MUST);
>    query.add(new TermQuery(new Term(field, "affect")),
> BooleanClause.Occur.MUST);
>
>    Highlighter highlighter = new Highlighter(new QueryScorer(query,
> field));
>    highlighter.setMaxDocCharsToAnalyze(500000);
>
>    TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
> StringReader(content));
>    ts = new CachingTokenFilter(ts);
>
>    System.out.println(highlighter.getBestFragment(ts, content));
>
>
> Thanks for any feedback,
> Justin
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45977-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 21:22:05 2010
Return-Path: <java-user-return-45977-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50688 invoked from network); 29 Apr 2010 21:22:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 21:22:04 -0000
Received: (qmail 69768 invoked by uid 500); 29 Apr 2010 21:22:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69735 invoked by uid 500); 29 Apr 2010 21:22:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69727 invoked by uid 99); 29 Apr 2010 21:22:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 21:22:02 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_FONT_FACE_BAD,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 21:21:56 +0000
Received: by gwj20 with SMTP id 20so223062gwj.35
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 14:21:35 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=/Zppb1WxtIi2wXSh+VsIlqvbEZZ5lIWBCIoDK4J/g3g=;
        b=dEmS1OC742KWSnZrWW58zU+fkR7dWzFdJ5jsTxeLBFixnDZ1baNn9mTVcOv/lbIA/J
         Z9oyoUITLWSCYCDU9DTs8wqxjxy7gQK9ai2HA3BQtlyMSaWQzsiRDIHL3wnKDoOTYbA7
         z0yMt1yG4t/FcVql6h7X/ehxCnoxeAa1CwfcI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n7/dk0OrappUvlZTMXIYL6KO/AlhKoOvTreAVekECb8aBE2JgBVHUO/7s02wt9hVhC
         QCB5tO+R1NFUN/3PjgTZoA5DiaP+NG2dFAittNA3sbxTObY8kqR6Uc6q8EWnhdNcqwzu
         HFZCfsgTm8POWPyUh7FBS5o9womyGCgdtxP3M=
MIME-Version: 1.0
Received: by 10.150.194.12 with SMTP id r12mr22958ybf.272.1272576095129; Thu, 
	29 Apr 2010 14:21:35 -0700 (PDT)
Received: by 10.151.43.7 with HTTP; Thu, 29 Apr 2010 14:21:35 -0700 (PDT)
In-Reply-To: <315755.85702.qm@web32907.mail.mud.yahoo.com>
References: <509584.20264.qm@web32906.mail.mud.yahoo.com>
	 <n2g359a92831004291330w23fc24beu4984623748dccf66@mail.gmail.com>
	 <315755.85702.qm@web32907.mail.mud.yahoo.com>
Date: Thu, 29 Apr 2010 17:21:35 -0400
Message-ID: <o2w359a92831004291421z462b290ap268400683a49be82@mail.gmail.com>
Subject: Re: Highlighter usage
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cdf19b41994b0048566b6be

--000e0cdf19b41994b0048566b6be
Content-Type: text/plain; charset=ISO-8859-1

That's the *StandartTokenizer*, which is not at all identical to
StandardAnalyzer. From
the Javadoc for StandardAnalyzer:
Filters StandardTokenizer<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/standard/StandardTokenizer.html>
 with StandardFilter<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/standard/StandardFilter.html>
, LowerCaseFilter<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/LowerCaseFilter.html>
 and StopFilter<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/StopFilter.html>,
using a list of English stop words.

So your case issue is entirely explained. You have no reason at all to
expect
stemming to work unless you put a stemmer in the chain....

HTH
Erick

On Thu, Apr 29, 2010 at 5:10 PM, Justin <crynax@yahoo.com> wrote:

> I'm using my own analyzer so I can interject HTMLStripCharFilter as
> described in a previous thread.
>
>  private static Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
>      @Override
>      protected TokenStreamComponents createComponents(
>              final String fieldName, final Reader reader) {
>            return new TokenStreamComponents(new
> StandardTokenizer(Version.LUCENE_30,
>                    new HTMLStripCharFilter(CharReader.get(reader))));
>      }
>  };
>
> So should I replace StandardTokenizer with LowerCaseTokenizer above?  Then
> would I override nextToken() and stem or is there a better way to use
> something like SnowballFilter?
>
>
>
>
> ----- Original Message ----
> From: Erick Erickson <erickerickson@gmail.com>
> To: java-user@lucene.apache.org
> Sent: Thu, April 29, 2010 3:30:09 PM
> Subject: Re: Highlighter usage
>
> What analyzer are you using at index time? My guess is something
> like WhitespaceAnalyzer that doesn't stem or change case..... Try
> a different analyzer, SimpleAnalyzer comes to mind....
>
> HTH
> Erick
>
> On Thu, Apr 29, 2010 at 4:21 PM, Justin <crynax@yahoo.com> wrote:
>
> > I'm trying to use Highlighter with QueryScorer after reading:
> >
> > https://issues.apache.org/jira/browse/LUCENE-1685
> >
> > The problem is: I'm not getting a result unless my the query term is an
> > exact match.  Am I missing filters?  Is there a more complete example of
> how
> > this should work?
> >
> >
> >    String content = "Global Climate Change affects us all";
> >
> >    String field = "content";
> >    BooleanQuery query = new BooleanQuery();
> >
> >    // Unstemmed, matched case works
> >    //query.add(new TermQuery(new Term(field, "Climate")),
> > BooleanClause.Occur.MUST);
> >
> >    // Stemmed, lowercase doesn't work
> >    query.add(new TermQuery(new Term(field, "climat")),
> > BooleanClause.Occur.MUST);
> >    query.add(new TermQuery(new Term(field, "affect")),
> > BooleanClause.Occur.MUST);
> >
> >    Highlighter highlighter = new Highlighter(new QueryScorer(query,
> > field));
> >    highlighter.setMaxDocCharsToAnalyze(500000);
> >
> >    TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
> > StringReader(content));
> >    ts = new CachingTokenFilter(ts);
> >
> >    System.out.println(highlighter.getBestFragment(ts, content));
> >
> >
> > Thanks for any feedback,
> > Justin
> >
> >
> >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cdf19b41994b0048566b6be--

From java-user-return-45978-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 22:10:16 2010
Return-Path: <java-user-return-45978-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76519 invoked from network); 29 Apr 2010 22:10:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 22:10:16 -0000
Received: (qmail 36970 invoked by uid 500); 29 Apr 2010 22:10:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36903 invoked by uid 500); 29 Apr 2010 22:10:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36842 invoked by uid 99); 29 Apr 2010 22:10:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 22:10:13 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.191.69.78] (HELO web32901.mail.mud.yahoo.com) (209.191.69.78)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 29 Apr 2010 22:10:03 +0000
Received: (qmail 90701 invoked by uid 60001); 29 Apr 2010 22:09:42 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1272578981; bh=XNQ3SR9fshzEyDAXD7Sr5ZgB6ngf4JJ2EytMIuY8VtY=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=gMo0Z6Dr6kDNSwoXaFJ16B+WUiJk+JJBkYMiqlE5W6Q/QQZbP6Gg4gq0KtRlwDBw0pVUjCEquUxpcXb/SRqoqS15JCFUcXFbHPRosS7OjIwwgMLLPgAawF9SWuvKmRwPiydv9qn9ofekPkL5F/l9kcBP2PQK9UUgX575dSoJqGM=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=NW4ZVfVan5HBw9sglPz2TkdjqXh7d7cuUrxGgq4k8RguXfPI2p1WGcAP/yvzsHdm3sdL3Hzj4oC+eM1WoxIjYkQJpJ9k6UskWXCfyiMjkSgBHR/yYNmF6uU4IQxzj3Ph7JUPDeN0EPw9quynzSFSB/oO7GxJ9JBUll/5Qj3alv4=;
Message-ID: <931650.88912.qm@web32901.mail.mud.yahoo.com>
X-YMail-OSG: G5soujsVM1n9sxawBGenOOgJHK6iS_lDb2.4DMQmFYJyRsb
 Tqu9Dtn2CjdnwnycGaeQLm2sr_gSU0klb1b46JheoQAvnRchBeoSdEMT3G4X
 WcjeTbqBK9xvvIEK_lHJqFFT713k84niiMQh5ervGU0zEvUgbpiy3iD6UlGG
 x_C0RyWDO57X4xJd9CWjcVwYo1ohIjj2HLMrIPPxP.OcR_wUwPW.cQG2CcsB
 r2lkYbSjPsqiFcq3q7iEwAM2B6RfslR4FCVUAAmnS4osszxhry_X.xo4F7BD
 wFvLXK09qyEg4kDnwZ3L5H1S6CNzreWO74QHQJfqMb44yb5hy_oRsPigFQrt
 RY58aNcSazk_hnbAWbhRPA9UGow--
Received: from [72.36.94.20] by web32901.mail.mud.yahoo.com via HTTP; Thu, 29 Apr 2010 15:09:41 PDT
X-Mailer: YahooMailRC/348.5 YahooMailWebService/0.8.103.269680
References: <509584.20264.qm@web32906.mail.mud.yahoo.com>  <n2g359a92831004291330w23fc24beu4984623748dccf66@mail.gmail.com>  <315755.85702.qm@web32907.mail.mud.yahoo.com> <o2w359a92831004291421z462b290ap268400683a49be82@mail.gmail.com>
Date: Thu, 29 Apr 2010 15:09:41 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Re: Highlighter usage
To: java-user@lucene.apache.org
In-Reply-To: <o2w359a92831004291421z462b290ap268400683a49be82@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Yeah, I understood the difference between StandardAnalyzer and StandardTokenizer.  I wasn't sure that I want to use the StopFilter for highlighting, particularly in conjunction with phrase queries (e.g. "Alexander The Great").  StandardAnalyzer and StandardTokenizer are final, but I found my solution looking at the source for StandardAnalyzer: an alternate constructor for TokenStreamComponents that accepts the filters I choose.


  private static Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
      @Override
      protected TokenStreamComponents createComponents(
              final String fieldName, final Reader reader) {
          final Tokenizer tokenizer = new StandardTokenizer(Version.LUCENE_30,
              new HTMLStripCharFilter(CharReader.get(reader)));
          TokenStream stream = new StandardFilter(tokenizer);
          stream = new LowerCaseFilter(Version.LUCENE_30, stream);
          stream = new SnowballFilter(stream, "English");
          return new TokenStreamComponents(tokenizer, stream);
      }
  };




----- Original Message ----
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Sent: Thu, April 29, 2010 4:21:35 PM
Subject: Re: Highlighter usage

That's the *StandartTokenizer*, which is not at all identical to
StandardAnalyzer. From
the Javadoc for StandardAnalyzer:
Filters StandardTokenizer<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/standard/StandardTokenizer.html>
with StandardFilter<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/standard/StandardFilter.html>
, LowerCaseFilter<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/LowerCaseFilter.html>
and StopFilter<http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/StopFilter.html>,
using a list of English stop words.

So your case issue is entirely explained. You have no reason at all to
expect
stemming to work unless you put a stemmer in the chain....

HTH
Erick

On Thu, Apr 29, 2010 at 5:10 PM, Justin <crynax@yahoo.com> wrote:

> I'm using my own analyzer so I can interject HTMLStripCharFilter as
> described in a previous thread.
>
>  private static Analyzer htmlStripAnalyzer = new ReusableAnalyzerBase() {
>      @Override
>      protected TokenStreamComponents createComponents(
>              final String fieldName, final Reader reader) {
>            return new TokenStreamComponents(new
> StandardTokenizer(Version.LUCENE_30,
>                    new HTMLStripCharFilter(CharReader.get(reader))));
>      }
>  };
>
> So should I replace StandardTokenizer with LowerCaseTokenizer above?  Then
> would I override nextToken() and stem or is there a better way to use
> something like SnowballFilter?
>
>
>
>
> ----- Original Message ----
> From: Erick Erickson <erickerickson@gmail.com>
> To: java-user@lucene.apache.org
> Sent: Thu, April 29, 2010 3:30:09 PM
> Subject: Re: Highlighter usage
>
> What analyzer are you using at index time? My guess is something
> like WhitespaceAnalyzer that doesn't stem or change case..... Try
> a different analyzer, SimpleAnalyzer comes to mind....
>
> HTH
> Erick
>
> On Thu, Apr 29, 2010 at 4:21 PM, Justin <crynax@yahoo.com> wrote:
>
> > I'm trying to use Highlighter with QueryScorer after reading:
> >
> > https://issues.apache.org/jira/browse/LUCENE-1685
> >
> > The problem is: I'm not getting a result unless my the query term is an
> > exact match.  Am I missing filters?  Is there a more complete example of
> how
> > this should work?
> >
> >
> >    String content = "Global Climate Change affects us all";
> >
> >    String field = "content";
> >    BooleanQuery query = new BooleanQuery();
> >
> >    // Unstemmed, matched case works
> >    //query.add(new TermQuery(new Term(field, "Climate")),
> > BooleanClause.Occur.MUST);
> >
> >    // Stemmed, lowercase doesn't work
> >    query.add(new TermQuery(new Term(field, "climat")),
> > BooleanClause.Occur.MUST);
> >    query.add(new TermQuery(new Term(field, "affect")),
> > BooleanClause.Occur.MUST);
> >
> >    Highlighter highlighter = new Highlighter(new QueryScorer(query,
> > field));
> >    highlighter.setMaxDocCharsToAnalyze(500000);
> >
> >    TokenStream ts = htmlStripAnalyzer.tokenStream(field, new
> > StringReader(content));
> >    ts = new CachingTokenFilter(ts);
> >
> >    System.out.println(highlighter.getBestFragment(ts, content));
> >
> >
> > Thanks for any feedback,
> > Justin
> >
> >
> >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45979-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Apr 29 23:00:54 2010
Return-Path: <java-user-return-45979-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6399 invoked from network); 29 Apr 2010 23:00:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Apr 2010 23:00:54 -0000
Received: (qmail 86197 invoked by uid 500); 29 Apr 2010 23:00:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86063 invoked by uid 500); 29 Apr 2010 23:00:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86055 invoked by uid 99); 29 Apr 2010 23:00:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 23:00:52 +0000
X-ASF-Spam-Status: No, hits=-1.9 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of weiho@princeton.edu designates 128.112.128.215 as permitted sender)
Received: from [128.112.128.215] (HELO ppa04.Princeton.EDU) (128.112.128.215)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Apr 2010 23:00:45 +0000
Received: from smtpserver2.Princeton.EDU (smtpserver2.Princeton.EDU [128.112.129.148])
	by ppa04.Princeton.EDU (8.14.3/8.14.3) with ESMTP id o3TN0Ouq005963
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 19:00:24 -0400
Received: from [140.180.52.65] (dynamic-oit-vapornet-c-2416.Princeton.EDU [140.180.52.65])
	(authenticated bits=0)
	by smtpserver2.Princeton.EDU (8.12.9/8.12.9) with ESMTP id o3TN0N49023433
	(version=TLSv1/SSLv3 cipher=RC4-MD5 bits=128 verify=NOT)
	for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 19:00:24 -0400 (EDT)
Message-ID: <4BDA0FB2.8020501@princeton.edu>
Date: Thu, 29 Apr 2010 19:01:06 -0400
From: Wei Ho <weiho@princeton.edu>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.9) Gecko/20100317 Lightning/1.0b1 Thunderbird/3.0.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Lucene QueryParser and Analyzer
References: <4BD9E329.5030306@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov> <4BD9E616.7030103@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D75@FMD3VS012.fda.gov> <4BD9EF96.5030206@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D76@FMD3VS012.fda.gov>
In-Reply-To: <F8A04958BB57B64096F9BE6B95725643081E3D76@FMD3VS012.fda.gov>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

I think I've figured out what the problem is. Given the inputs,

Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

Input1 gets parsed as
Query1: (text: "C1C2  C3C4  C5C6  C7  C8C9C10")
whereas Input2 gets parsed as
Query2: (text: "C1C2") (text: "C3C4") (text: "C5C6") (text: "C7") (text: 
"C8C9C10")

That is, Lucene constructs the query and then pass the query text 
through the analyzer. Is there any way to
force QueryParser to pass the input string through the analyzer before 
creating the query? That is, force Lucene
to create Query2 for both Input1 and Input2.

Thanks,
Wei


-------- Original Message  --------
Subject: Re: Lucene QueryParser and Analyzer
From: Sudarsan, Sithu D. <Sithu.Sudarsan@fda.hhs.gov>
To: java-user@lucene.apache.org
Date: 4/29/2010 4:54 PM
>
> -------sample code-------------
>    
>>> Analyzer analyzer = new LingPipeAnalyzer();
>>> Searcher searcher = new IndexSearcher(directory);
>>> QueryParser qParser = new MultiFieldQueryParser(Version.LUCENE_30,
>>> SEARCH_FIELDS, analyzer);
>>> Query query = qParser.parse(queryLine[1]);
>>> ScoreDoc[] results = searcher.search(query, TOP_N).scoreDocs;
>>>        
> qParser will use the analyzer LingPipeAnalyzer() before forming the
> query.
>
>
> Sincerely,
> Sithu D Sudarsan
>
>
> -----Original Message-----
> From: Wei Ho [mailto:weiho@princeton.edu]
> Sent: Thursday, April 29, 2010 4:44 PM
> To: java-user@lucene.apache.org
> Subject: Re: Lucene QueryParser and Analyzer
>
> Sorry, I guess "discarding the punctuation" was a bit misleading.
> I meant that given the two input strings,
>
> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>
> The analyzer I implemented tokenizes both Input1 and Input2 as "C1C2",
> "C3C4", "C5C6", "C7", "C8C9C10" - that is, it doesn't include the
> punctuation in the tokenization. I'm assuming that QueryParser is simply
>
> passing the entire input string to the analyzer and taking the tokens,
> in which case Input1 and Input2 should be considered identifcal. Does
> QueryParser doing any sort of pre-processing or filtering beforehand? If
>
> so, how can I turn it off?
>
> Aside from stopping tokens at punctuations, my analyzer is also doing
> Chinese word segmentation, so I'd like to be sure that QueryParser is
> using the analyzer the way I expect it to.
>
> Thanks,
> Wei
>
>
>
> -------- Original Message  --------
> Subject: Re: Lucene QueryParser and Analyzer
> From: Sudarsan, Sithu D.<Sithu.Sudarsan@fda.hhs.gov>
> To: java-user@lucene.apache.org
> Date: 4/29/2010 4:08 PM
>    
>> If so,
>>
>> Input1:  c1c2c3c4c5c6c7....
>> Input2: c1c2 c3c4 ...
>>
>> I guess, they are different! Add a whitespace after commas and see if
>> that works...
>>
>> Sincerely,
>> Sithu D Sudarsan
>>
>>
>> -----Original Message-----
>> From: Wei Ho [mailto:weiho@princeton.edu]
>> Sent: Thursday, April 29, 2010 4:04 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: Lucene QueryParser and Analyzer
>>
>> No, there is no whitespace after the comma in Input1
>>
>> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
>> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>>
>> Input1 is basically one big long word with commas and Chinese
>>      
> characters
>    
>> one after the other. Input2 is where I manually separated the string
>> into the component terms by replacing the comma with whitespace. My
>> confusion stems from the fact that I thought it should not matter
>>      
> since
>    
>> the analyzer should be discarding the punctuation anyway? So the
>> tokenization process should be the same for both Input1 and Input2? If
>> that is not the case, what do I need to change?
>>
>> Thanks,
>> Wei Ho
>>
>> -------- Original Message  --------
>> Subject: Re: Lucene QueryParser and Analyzer
>> From: Sudarsan, Sithu D.<Sithu.Sudarsan@fda.hhs.gov>
>> To: java-user@lucene.apache.org
>> Date: 4/29/2010 3:54 PM
>>
>>      
>>> Hi,
>>>
>>> Is there a whitespace after the comma?
>>>
>>>
>>> Sincerely,
>>> Sithu D Sudarsan
>>>
>>>
>>> -----Original Message-----
>>> From: Wei Ho [mailto:weiho@princeton.edu]
>>> Sent: Thursday, April 29, 2010 3:51 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Lucene QueryParser and Analyzer
>>>
>>> Hello,
>>>
>>> I'm using Lucene to index and search through a collection of Chinese
>>> documents. However, I'm noticing an odd behavior in query
>>> parsing/searching.
>>>
>>> Given the two queries below:
>>>
>>> (Ci refers to Chinese character i)
>>> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
>>> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>>>
>>> Input1 returns absolutely nothing, while Input2 (replacing the commas
>>> with spaces) works as expected. I'm a bit confused why this would be
>>> happening - it seems that QueryParser uses the Analyzer passed to it
>>>
>>>        
>> to
>>
>>      
>>> tokenize the input query string, so if the Analyzer ignores the
>>> punctuations, it seems that Input1 and Input2 should return identical
>>> results. Is there some pre-Analyzer filtering or whatever that
>>> QueryParser does? I've tried this with the StandardAnalyzer,
>>> SmartChineseAnalyzer, and an analyzer that I implemented which
>>> explicitly skips over punctuations and whitespaces in tokenizing the
>>> query string, but to no avail.
>>>
>>>
>>> -----------------------------------
>>>
>>> I'm probably just doing something dumb, but any help would be greatly
>>> appreciated!
>>>
>>> Thanks,
>>> Wei Ho
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>>        
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>      
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45980-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 07:39:24 2010
Return-Path: <java-user-return-45980-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10145 invoked from network); 30 Apr 2010 07:39:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 07:39:20 -0000
Received: (qmail 81294 invoked by uid 500); 30 Apr 2010 04:49:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80989 invoked by uid 500); 30 Apr 2010 04:49:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80976 invoked by uid 99); 30 Apr 2010 04:49:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 04:49:14 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=AWL,FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of vijay.raghavan08@gmail.com designates 209.85.223.197 as permitted sender)
Received: from [209.85.223.197] (HELO mail-iw0-f197.google.com) (209.85.223.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 04:49:09 +0000
Received: by iwn35 with SMTP id 35so12067831iwn.21
        for <java-user@lucene.apache.org>; Thu, 29 Apr 2010 21:48:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=jXCj02heEwPjMXBExpu0wpVqS1N4smmAeVYCgKPILrc=;
        b=vmg4FvuLZqOI3EGMyv2BrKsXlwcBt7DAPnF1Jb1Nkqs5GsRzZcTxbftB4EkYRB4Qv/
         PHbD/X5wYxOW9/dalhpHjj6zRgXmoZ9rYRwxwShD80e9XxTmv4fHx1pWlB6tg7G+yjJ+
         vvreF4aAgo0QTE92DBwA+M8vmsmVCPH1gfrAY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=xeDbZHzHzWrhABASRRSrUTnHYla6pHyVglmLW2Cc8SzKRay4XtzJJKBN+be3GJ/rEo
         YuVet/OLMZ3WjsGpxKSQy4FpL3lq6TiFjenpXm4NgVKCmTzVsIhmIHky1KxAw8tcHzZx
         VShhz/rp1tpY3xppZYc8WUcnt2+M1hPi18n/w=
MIME-Version: 1.0
Received: by 10.231.161.12 with SMTP id p12mr644427ibx.31.1272602927920; Thu, 
	29 Apr 2010 21:48:47 -0700 (PDT)
Received: by 10.231.81.205 with HTTP; Thu, 29 Apr 2010 21:48:47 -0700 (PDT)
In-Reply-To: <s2zbd236a1004290330ib1474600na34467b30ba3fe32@mail.gmail.com>
References: <s2zbd236a1004290330ib1474600na34467b30ba3fe32@mail.gmail.com>
Date: Fri, 30 Apr 2010 10:18:47 +0530
Message-ID: <z2qbd236a1004292148mdbefad4em6518237ba9bfcf0@mail.gmail.com>
Subject: Using lucene in NFS
From: Vijay Veeraraghavan <vijay.raghavan08@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

dear all,

I have a problem using lucene in NFS. A scheduler runs periodically
generating reports in pdf format and saves it to a file server. The
drive of the file server is mounted  to the scheduler server (NFS).
After generating reports finally the scheduler indexes the names of
the report and its path. This index is also stored to the same context
folder the reports are created, ie., mounted NFS folder. When i create
index in the local system (JFS2) its as fast as possible. (the local
system is AIX uses jfs2.) But in the NFS folder it keep doing and
doing... i didnt exactly know what happened inside. little later the
application freezed.I saw some lock files created inside the folder
but nothing like index files that usually created by the lucene. from
the web page i search this index in nfs for the report and read it. My
question is how to use lucene in NFS. anything special we need to do?
any reference codes? docs? How do i lock the index when my scheduler
is updating the index?

P.S: Please add CC to vijayv@kggroup.com

Thanks
Vijay Veeraraghavan



-- 
Thanks & Regards
Vijay Veeraraghavan

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45981-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 08:18:33 2010
Return-Path: <java-user-return-45981-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26356 invoked from network); 30 Apr 2010 08:18:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 08:18:32 -0000
Received: (qmail 33933 invoked by uid 500); 30 Apr 2010 08:18:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33424 invoked by uid 500); 30 Apr 2010 08:18:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33416 invoked by uid 99); 30 Apr 2010 08:18:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 08:18:25 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [217.12.10.244] (HELO web26207.mail.ukl.yahoo.com) (217.12.10.244)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Apr 2010 08:18:19 +0000
Received: (qmail 6752 invoked by uid 60001); 30 Apr 2010 08:17:52 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.de; s=s1024; t=1272615472; bh=RmskHJfV/EZsg7lLq1J0fYj+31CaamxjebKM7Xxf/DI=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=uJWRij19SUbkvmQstrpl04tNu/gHV/qc2bYA4aGfy7Ay2Cqq2Bqf3+fdEQE6st59ZcHDX0KY635VBb+Y28zXkKy4dvBUflMoSmy08soYPS1Xz+a+e2tc/nCtINrYS5uNPPtO0T2zEoxmkX+5cLpXcChKynQCb8BYGAD39H+nuxw=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.de;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=HHIDLqlPiM1EXgImr5bpuhGqXpUNuRQ3CyrChd8pbxr5xq/TAzx4n/t6KLpDnFtUSVrHlYdMHmlH3N4+rYSc0nRNgJIlTpznmejCDh8ei794fVpaOajKTjKfvgRBPGAT0WoTnHWVqKLuevCvfvMT2Tv1iYA29+JUkRfroI6BscE=;
Message-ID: <880820.6476.qm@web26207.mail.ukl.yahoo.com>
X-YMail-OSG: 3yi5s48VM1nhfQoJgAzXjLhEkv2I7N2AtPeTGg75o3FQqYf
 yWiZleK.CCBoSDzIOkCQZK6KtXYjY6QpuSCOztIRc_m8PypZim7l43Qnbpzy
 rpAykGoiA3FjpSEViYTiy8kmpX9zcejWwyhEa.q6xnTcB.UK4dEhfwvBySew
 DOyuADS7f.TF_cLxg9rvLfloveFvtI8c0p0Bwpv2VCCjFmbCHTyuIW3lktNa
 E8vs4Xgh0a2Nm.Mi5vPILr59HtG70XnXoVhGJOA9XF0aqUcvkafi0p.z_VE6
 WeenmUd7.YE7TsiwrgR0JOHb4CbE6mdvzxQ--
Received: from [10.2.3.51] by web26207.mail.ukl.yahoo.com via HTTP; Fri, 30 Apr 2010 08:17:52 GMT
X-Mailer: YahooMailClassic/10.1.11 YahooMailWebService/0.8.103.269680
Date: Fri, 30 Apr 2010 08:17:52 +0000 (GMT)
From: Anna Hunecke <annahunecke@yahoo.de>
Subject: Re: IOExceptions when optimising the index
To: java-user@lucene.apache.org
In-Reply-To: <r2m8c4e68611004290432kdece0129x2a4c0556578d439f@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Ian,

thanks for the answer. I also assumed something like this. Telling the cust=
omer to switch to unix is not an option, so I'll try to solve the problem b=
y scheduling the optimization to occur at some other time.

Can you explain a bit more why you think optimization is not necessary?
As far as I understand it, it is necessary compact the index files from tim=
e to time, especially if there are many changes in the index.
What I don't understand is what the difference is between the explicit opti=
mization and the automatic merging of the files.

Best,
Anna

--- Ian Lea <ian.lea@gmail.com> schrieb am Do, 29.4.2010:

> Von: Ian Lea <ian.lea@gmail.com>
> Betreff: Re: IOExceptions when optimising the index
> An: java-user@lucene.apache.org
> Datum: Donnerstag, 29. April, 2010 13:32 Uhr
> Hi
>=20
>=20
> It is not necessary to run optimize.=A0 At a guess there
> is some job
> such as a backup or virus check that is running overnight
> and locking
> files and parts of the file system.=A0 If that is the
> case, and you do
> want to run optimize, perhaps you could schedule around
> it.=A0 Or switch
> to a unix based system that doesn't have these locking
> issues.
>=20
>=20
> --
> Ian.
>=20
>=20
> On Thu, Apr 29, 2010 at 11:50 AM, Anna Hunecke <annahunecke@yahoo.de>
> wrote:
> > Hi!
> >
> > we are using Lucene 2.4.1 in our app. It works great
> so far, but now a customer ran into a strange problem.
> > During the day, the search index is updated regularly
> with the newest changes in the application. At night, when
> nothing much is happening in the application, the index is
> optimised.
> > The updating during the day works fine, but during the
> optimizing, all kinds of strange exceptions occur:
> >
> > java.io.IOException: Access is denied
> > at
> java.io.WinNTFileSystem.createFileExclusively(Native
> Method)
> > at java.io.File.createNewFile(Unknown Source)
> > at
> org.apache.lucene.store.SimpleFSLock.obtain(SimpleFSLockFactory.java:144)
> > at org.apache.lucene.store.Lock.obtain(Lock.java:73)
> > at
> org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1070)
> > at
> org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:566)
> >
> > or
> >
> > org.apache.lucene.store.LockReleaseFailedException:
> failed to delete searchindex\write.lock
> > at
> org.apache.lucene.store.SimpleFSLock.release(SimpleFSLockFactory.java:149=
)
> > at
> org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:1668)
> > at
> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1602)
> > at
> org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1578)
> >
> > or
> >
> > java.io.IOException: background merge hit exception:
> _dhi:c1195 _dlt:c33 into _dlu [optimize]
> > Exception in thread "Lucene Merge Thread #0" =A0 =A0at
> org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2273)
> > at
> org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2218)
> > at
> org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2198)
> > ...
> > Caused by: java.io.FileNotFoundException:
> searchindex\_dlu.fnm (The system cannot find the file
> specified)
> > at java.io.RandomAccessFile.open(Native Method)
> > at java.io.RandomAccessFile.<init>(Unknown
> Source)
> > at
> org.apache.lucene.store.FSDirectory$FSIndexInput$Descriptor.<init>(FSDire=
ctory.java:552)
> > at
> org.apache.lucene.store.FSDirectory$FSIndexInput.<init>(FSDirectory.java:=
582)
> > at
> org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:488)
> > at
> org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:482)
> > at
> org.apache.lucene.index.CompoundFileWriter.copyFile(CompoundFileWriter.ja=
va:221)
> > at
> org.apache.lucene.index.CompoundFileWriter.close(CompoundFileWriter.java:=
184)
> > at
> org.apache.lucene.index.SegmentMerger.createCompoundFile(SegmentMerger.ja=
va:204)
> > at
> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4263)
> > at
> org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3884)
> > at
> org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeS=
cheduler.java:205)
> > at
> org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(Concurre=
ntMergeScheduler.java:260)
> >
> > The indexes look fine when I open them with Luke, and
> since the normal updating works, I don't think it has
> something to do with write-rights of the disks.
> > So, what could be the cause of this?
> > And: How necessary is it really to run an optimisation
> every night? A lot of changes take place when the program
> runs, so the search index is changed quite frequently. Maybe
> it is enough to let the automatic merging take care of
> things?
> >
> > Greets,
> > Anna
> >
> >
> >
> >
> ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
> =0A=0A

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45982-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 09:07:54 2010
Return-Path: <java-user-return-45982-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42753 invoked from network); 30 Apr 2010 09:07:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 09:07:54 -0000
Received: (qmail 75585 invoked by uid 500); 30 Apr 2010 09:07:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75400 invoked by uid 500); 30 Apr 2010 09:07:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75392 invoked by uid 99); 30 Apr 2010 09:07:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 09:07:51 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 09:07:43 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id C1E15D36009
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 11:07:22 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id gPOsxkCQjmPE for <java-user@lucene.apache.org>;
	Fri, 30 Apr 2010 11:07:11 +0200 (CEST)
Received: from VEGA (electra-palace2.ath.forthnet.gr [193.92.254.29])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 95B3BD36001
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 11:07:10 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <r2m8c4e68611004290432kdece0129x2a4c0556578d439f@mail.gmail.com> <880820.6476.qm@web26207.mail.ukl.yahoo.com>
In-Reply-To: <880820.6476.qm@web26207.mail.ukl.yahoo.com>
Subject: RE: IOExceptions when optimising the index
Date: Fri, 30 Apr 2010 12:07:26 +0300
Message-ID: <011601cae844$8e4076d0$aac16470$@de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcroPcBGE+VpNjHYRt+woEw1eWVc7QABVybg
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

As Lucene 2.9 switched to per-segment search, every query run separately =
on each segment of an index and the results are combined. There is no =
difference between an optimized or unoptimized index for this process. =
Furthermore, if you sort by fields, you should not optimize at all, as =
the FieldCache needs to be completely refreshed after optimizing, which =
can take some time. Currently, only changed segments are reloaded.

If you update or add documents to the index, the merge process will =
automatically compact segments on the next merge. There may still be =
some deleted documents between (especially if you have the index =
optimized once and it consisted only of one *large* segment, which is =
not touched or merged until another very large segment of equal size is =
added).

Optimizing indexes only makes sense for static indexes like those =
delivered on CD-ROMs.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Anna Hunecke [mailto:annahunecke@yahoo.de]
> Sent: Friday, April 30, 2010 11:18 AM
> To: java-user@lucene.apache.org
> Subject: Re: IOExceptions when optimising the index
>=20
> Hi Ian,
>=20
> thanks for the answer. I also assumed something like this. Telling the
> customer to switch to unix is not an option, so I'll try to solve the
> problem by scheduling the optimization to occur at some other time.
>=20
> Can you explain a bit more why you think optimization is not =
necessary?
> As far as I understand it, it is necessary compact the index files =
from
> time to time, especially if there are many changes in the index.
> What I don't understand is what the difference is between the explicit
> optimization and the automatic merging of the files.
>=20
> Best,
> Anna
>=20
> --- Ian Lea <ian.lea@gmail.com> schrieb am Do, 29.4.2010:
>=20
> > Von: Ian Lea <ian.lea@gmail.com>
> > Betreff: Re: IOExceptions when optimising the index
> > An: java-user@lucene.apache.org
> > Datum: Donnerstag, 29. April, 2010 13:32 Uhr
> > Hi
> >
> >
> > It is not necessary to run optimize.  At a guess there
> > is some job
> > such as a backup or virus check that is running overnight
> > and locking
> > files and parts of the file system.  If that is the
> > case, and you do
> > want to run optimize, perhaps you could schedule around
> > it.  Or switch
> > to a unix based system that doesn't have these locking
> > issues.
> >
> >
> > --
> > Ian.
> >
> >
> > On Thu, Apr 29, 2010 at 11:50 AM, Anna Hunecke =
<annahunecke@yahoo.de>
> > wrote:
> > > Hi!
> > >
> > > we are using Lucene 2.4.1 in our app. It works great
> > so far, but now a customer ran into a strange problem.
> > > During the day, the search index is updated regularly
> > with the newest changes in the application. At night, when
> > nothing much is happening in the application, the index is
> > optimised.
> > > The updating during the day works fine, but during the
> > optimizing, all kinds of strange exceptions occur:
> > >
> > > java.io.IOException: Access is denied
> > > at
> > java.io.WinNTFileSystem.createFileExclusively(Native
> > Method)
> > > at java.io.File.createNewFile(Unknown Source)
> > > at
> >
> =
org.apache.lucene.store.SimpleFSLock.obtain(SimpleFSLockFactory.java:14
> 4)
> > > at org.apache.lucene.store.Lock.obtain(Lock.java:73)
> > > at
> > org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1070)
> > > at
> > org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:566)
> > >
> > > or
> > >
> > > org.apache.lucene.store.LockReleaseFailedException:
> > failed to delete searchindex\write.lock
> > > at
> >
> =
org.apache.lucene.store.SimpleFSLock.release(SimpleFSLockFactory.java:1
> 49)
> > > at
> >
> =
org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:1668
> )
> > > at
> > org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1602)
> > > at
> > org.apache.lucene.index.IndexWriter.close(IndexWriter.java:1578)
> > >
> > > or
> > >
> > > java.io.IOException: background merge hit exception:
> > _dhi:c1195 _dlt:c33 into _dlu [optimize]
> > > Exception in thread "Lucene Merge Thread #0"    at
> > org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2273)
> > > at
> > org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2218)
> > > at
> > org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:2198)
> > > ...
> > > Caused by: java.io.FileNotFoundException:
> > searchindex\_dlu.fnm (The system cannot find the file
> > specified)
> > > at java.io.RandomAccessFile.open(Native Method)
> > > at java.io.RandomAccessFile.<init>(Unknown
> > Source)
> > > at
> >
> =
org.apache.lucene.store.FSDirectory$FSIndexInput$Descriptor.<init>(FSDi
> rectory.java:552)
> > > at
> >
> =
org.apache.lucene.store.FSDirectory$FSIndexInput.<init>(FSDirectory.jav
> a:582)
> > > at
> > org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:488)
> > > at
> > org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:482)
> > > at
> >
> =
org.apache.lucene.index.CompoundFileWriter.copyFile(CompoundFileWriter.
> java:221)
> > > at
> >
> =
org.apache.lucene.index.CompoundFileWriter.close(CompoundFileWriter.jav
> a:184)
> > > at
> >
> =
org.apache.lucene.index.SegmentMerger.createCompoundFile(SegmentMerger.
> java:204)
> > > at
> >
> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4263)
> > > at
> > org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3884)
> > > at
> >
> =
org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMerg
> eScheduler.java:205)
> > > at
> >
> =
org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(Concur
> rentMergeScheduler.java:260)
> > >
> > > The indexes look fine when I open them with Luke, and
> > since the normal updating works, I don't think it has
> > something to do with write-rights of the disks.
> > > So, what could be the cause of this?
> > > And: How necessary is it really to run an optimisation
> > every night? A lot of changes take place when the program
> > runs, so the search index is changed quite frequently. Maybe
> > it is enough to let the automatic merging take care of
> > things?
> > >
> > > Greets,
> > > Anna
> > >
> > >
> > >
> > >
> > =
---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45983-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 09:48:59 2010
Return-Path: <java-user-return-45983-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54592 invoked from network); 30 Apr 2010 09:48:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 09:48:59 -0000
Received: (qmail 23860 invoked by uid 500); 30 Apr 2010 09:48:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23769 invoked by uid 500); 30 Apr 2010 09:48:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23761 invoked by uid 99); 30 Apr 2010 09:48:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 09:48:56 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 09:48:49 +0000
Received: by bwz22 with SMTP id 22so14603bwz.5
        for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 02:48:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=4oZO0LAYsQc7F1VrGhCFeGlfpplPbxltk4OwMd+cN4c=;
        b=Kt3A8dqhj19fVbzJGFDBOKxOhlLS8H51D74ys2PIcmzfNfpXhxe32zWk1BeskKiwkR
         LbYrBGTjCLh+EjI1fN3LYD8WxUqeYeRhSGjQReeMOAUGrX+1aLFGK5A1ykAd/BGBn3+S
         TdLJWTIXe8bkMs823EgwHmJQuGUTkSMo9ewd0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=BIpQQ0oYkDdwWIVHe5G6CaHsY9s7A/bdQC+jH/JU0gLUV4PFC7EtSGOk2wywK9fn8A
         PMjIZc1vlH+pwUK8L9mhyCpeRAB0m/SbvjqTteXDXXwlR5xEhacFYFBrBt8cUENe1JZn
         ozOj1ukc0pW8Cg/P2wVFQOymeULJVk+u4mMgw=
Received: by 10.204.151.71 with SMTP id b7mr6576750bkw.114.1272620909421; Fri, 
	30 Apr 2010 02:48:29 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Fri, 30 Apr 2010 02:48:09 -0700 (PDT)
In-Reply-To: <z2qbd236a1004292148mdbefad4em6518237ba9bfcf0@mail.gmail.com>
References: <s2zbd236a1004290330ib1474600na34467b30ba3fe32@mail.gmail.com> 
	<z2qbd236a1004292148mdbefad4em6518237ba9bfcf0@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 30 Apr 2010 10:48:09 +0100
Message-ID: <i2y8c4e68611004300248w91bfdb85s29f5859502a1c0c@mail.gmail.com>
Subject: Re: Using lucene in NFS
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

You don't say what version of lucene you are using, but in recent
versions you may need to use SimpleFSLockFactory rather than the
default, NativeFSLockFactory.  See the javadocs.  Lucene in general
does work on NFS but there can be problems, particularly with
concurrent access from multiple servers.

But your problem sounds different.  Does the NFS mount work properly
for non-lucene operations?  Or maybe you could maintain a copy of the
index on local disks and just copy it to NFS for access from other
servers.  Lucene locking should take care of locking the index when
updates are running.


--
Ian.


On Fri, Apr 30, 2010 at 5:48 AM, Vijay Veeraraghavan
<vijay.raghavan08@gmail.com> wrote:
> dear all,
>
> I have a problem using lucene in NFS. A scheduler runs periodically
> generating reports in pdf format and saves it to a file server. The
> drive of the file server is mounted =A0to the scheduler server (NFS).
> After generating reports finally the scheduler indexes the names of
> the report and its path. This index is also stored to the same context
> folder the reports are created, ie., mounted NFS folder. When i create
> index in the local system (JFS2) its as fast as possible. (the local
> system is AIX uses jfs2.) But in the NFS folder it keep doing and
> doing... i didnt exactly know what happened inside. little later the
> application freezed.I saw some lock files created inside the folder
> but nothing like index files that usually created by the lucene. from
> the web page i search this index in nfs for the report and read it. My
> question is how to use lucene in NFS. anything special we need to do?
> any reference codes? docs? How do i lock the index when my scheduler
> is updating the index?
>
> P.S: Please add CC to vijayv@kggroup.com
>
> Thanks
> Vijay Veeraraghavan
>
>
>
> --
> Thanks & Regards
> Vijay Veeraraghavan
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45984-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 12:00:36 2010
Return-Path: <java-user-return-45984-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86424 invoked from network); 30 Apr 2010 12:00:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 12:00:35 -0000
Received: (qmail 72412 invoked by uid 500); 30 Apr 2010 12:00:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72219 invoked by uid 500); 30 Apr 2010 12:00:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72211 invoked by uid 99); 30 Apr 2010 12:00:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 12:00:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=AWL,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of arosenschein@gmail.com designates 209.85.212.176 as permitted sender)
Received: from [209.85.212.176] (HELO mail-px0-f176.google.com) (209.85.212.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 12:00:27 +0000
Received: by pxi10 with SMTP id 10so60443pxi.35
        for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 05:00:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=B2faJDFWvLSmfgTQgO2lz97g8urEXoj3fRRNXhXrdRU=;
        b=WlGy0OfdR38J7V6/uI5C+Ac4I4wjIFFsv6jDC0rVZR16VXPKmjFJSaGs87COiwd5C5
         LL7xebSoRb3PUnSzygUk+TjVpGFnDMP1az2Bz/c5nwABppDg/iSytAOAkYSFgmlikUcG
         5J77p+qVDJHI1Y7UAz28aa0oTHpRGCNpSTlns=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=bXUKCTkalV6r8u7DN7oNyfdLl4XfzV2QhpEP5DLCjywpQ0Y+w3sQbhW/Xe77f5uu4e
         eEx/KDd2YXAYZ06RMFAjWkc9x15kojS2KCswS4WBz8RmY2bNELEOnd+Z5L2EVARuU0W9
         xW46QsdBLi6ht8uYrRPxCKDYIBZfp1/7ELIDY=
MIME-Version: 1.0
Received: by 10.140.58.15 with SMTP id g15mr746170rva.96.1272628806960; Fri, 
	30 Apr 2010 05:00:06 -0700 (PDT)
Received: by 10.141.18.15 with HTTP; Fri, 30 Apr 2010 05:00:06 -0700 (PDT)
In-Reply-To: <x2i3504767f1004290759u6de20a3ehfa4d46fb11a97954@mail.gmail.com>
References: <E6C119F7-C966-4280-94DD-3575BB3CE3F4@apache.org>
	 <x2i3504767f1004290759u6de20a3ehfa4d46fb11a97954@mail.gmail.com>
Date: Fri, 30 Apr 2010 15:00:06 +0300
Message-ID: <h2r698f0de11004300500g71aba2b1g21378ba061b674c@mail.gmail.com>
Subject: Re: Relevancy Practices
From: Avi Rosenschein <arosenschein@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636b2b118f8482a048572fbbc

--001636b2b118f8482a048572fbbc
Content-Type: text/plain; charset=UTF-8

On Thu, Apr 29, 2010 at 5:59 PM, Mark Bennett <mbennett@ideaeng.com> wrote:

> Hi Grant,
>
> You're welcome to use any of my slides (Dave's got them), with attribution
> of course.
>
> BUT....
>
> Have you considered a section something like "why the hell do you think
> Relevancy tweaking is gonna save you!?!?"


> Basically that, as a corpus grows exponentially, so do results list sizes,
> so ALL relevancy tweaks will eventually fail.  And FACETS (or other
> navigators) are the answer.  I've got slides on that as well.
>

The idea is to get the relevancy to fail on a smaller and smaller percent of
the queries, as the corpus grows larger. Facets can definitely help, but
they don't solve the basic problem of search, when there is no facet for the
particular way the user is looking for something. The strength of search is
that it can help the user to find things even when other forms of navigation
fail.

Of course relevancy matters.... but it's only ONE of perhaps a three pronged
> approach:
> 1: Organic Relevancy and top query suggetions
> 2: Results list Navigators, the best the system can support, and
> 3: Data quality (spidering, METADATA quality, source weighting, etc)
>

I would prefer to say that data quality can directly contribute to relevance
(besides being important for other reasons as well). Basically, search
relevancy is a combination of quality of data + quality of algorithm. In
general, they are both important, and data even has the potential to be more
important than algorithm, if you structure it right.

Also, tuning the algorithms to the users can be very important. For
instance, we have found that in a basic search functionality, the default
query parser operator OR works very well. But on a page for advanced users,
who want to very precisely tune their search results, a default of AND works
better.

Regards,
-- Avi

--001636b2b118f8482a048572fbbc--

From java-user-return-45985-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 12:02:23 2010
Return-Path: <java-user-return-45985-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87020 invoked from network); 30 Apr 2010 12:02:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 12:02:22 -0000
Received: (qmail 77823 invoked by uid 500); 30 Apr 2010 12:02:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77795 invoked by uid 500); 30 Apr 2010 12:02:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77787 invoked by uid 99); 30 Apr 2010 12:02:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 12:02:20 +0000
X-ASF-Spam-Status: No, hits=1.7 required=10.0
	tests=AWL,FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of vijay.raghavan08@gmail.com designates 209.85.223.197 as permitted sender)
Received: from [209.85.223.197] (HELO mail-iw0-f197.google.com) (209.85.223.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 12:02:15 +0000
Received: by iwn35 with SMTP id 35so133919iwn.21
        for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 05:01:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=pr4vv0F1KL12YpkNlLNzxWKb+7tiKqyXbgtEc4AZnMI=;
        b=NiF1beOBHrdWxdx3IcGuT+FCnOcmdllLmjxtruT1vb0BEFBT4Q+PxV83c1JXUelf9q
         kFcBdLP+0yVhCgR7ll4oLlsYwDNXghkyYLRRf+llmZ9s19cBBzjefgDPIY0HQnkqxkmW
         IyIGtK9Yis7oZHpfF9BGCq24k+3PmKkek63so=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ki3btXpKXfboLnRb5v+fzL8Khoq7/6k0XNPgSQSh3rPovXGS9Oraf50suNnZRqgzTR
         ZHtQ23rUrCOJ/RH0YBROXrtqSDW1VSymYDZh0alhT9n9mPCEUmgfbNIn/+Ab2jd29TxP
         CJs6QUMCMtOSTEjGFrC2S6ZmnCzEs1aAafqhA=
MIME-Version: 1.0
Received: by 10.231.182.79 with SMTP id cb15mr1033173ibb.71.1272628914708; 
	Fri, 30 Apr 2010 05:01:54 -0700 (PDT)
Received: by 10.231.81.205 with HTTP; Fri, 30 Apr 2010 05:01:54 -0700 (PDT)
In-Reply-To: <i2y8c4e68611004300248w91bfdb85s29f5859502a1c0c@mail.gmail.com>
References: <s2zbd236a1004290330ib1474600na34467b30ba3fe32@mail.gmail.com>
	 <z2qbd236a1004292148mdbefad4em6518237ba9bfcf0@mail.gmail.com>
	 <i2y8c4e68611004300248w91bfdb85s29f5859502a1c0c@mail.gmail.com>
Date: Fri, 30 Apr 2010 17:31:54 +0530
Message-ID: <q2jbd236a1004300501l8a055a4cs8343b74ff1fcfc87@mail.gmail.com>
Subject: Re: Using lucene in NFS
From: Vijay Veeraraghavan <vijay.raghavan08@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

hi Ian,
Thanks for your reply. I am using the Lucene core 3.0 version. The
index created will be accessed by the web application. The web
application contains 4 nodes, clustered. What if all the nodes access
the index. I think no any prob may raise.
If i have a local index then what about it in the clustered environment?
The NFS given is working good for saving the report, but only while i
start the indexing the app freezes. it creates a lock file, i cant see
whats happening inside as i cant see my console outputs too.
And i have once more question. How do u update the index. As my
scheduler keeps producing more reports to the file server, the index
need to be updated then and there. how do i update the new report
files to the index than doing again all the files. Or can i create a
local index of the newly created reports and join this with the old
index? any other professional solution?

Thanks
Vijay

On 4/30/10, Ian Lea <ian.lea@gmail.com> wrote:
> You don't say what version of lucene you are using, but in recent
> versions you may need to use SimpleFSLockFactory rather than the
> default, NativeFSLockFactory.  See the javadocs.  Lucene in general
> does work on NFS but there can be problems, particularly with
> concurrent access from multiple servers.
>
> But your problem sounds different.  Does the NFS mount work properly
> for non-lucene operations?  Or maybe you could maintain a copy of the
> index on local disks and just copy it to NFS for access from other
> servers.  Lucene locking should take care of locking the index when
> updates are running.
>
>
> --
> Ian.
>
>
> On Fri, Apr 30, 2010 at 5:48 AM, Vijay Veeraraghavan
> <vijay.raghavan08@gmail.com> wrote:
>> dear all,
>>
>> I have a problem using lucene in NFS. A scheduler runs periodically
>> generating reports in pdf format and saves it to a file server. The
>> drive of the file server is mounted  to the scheduler server (NFS).
>> After generating reports finally the scheduler indexes the names of
>> the report and its path. This index is also stored to the same context
>> folder the reports are created, ie., mounted NFS folder. When i create
>> index in the local system (JFS2) its as fast as possible. (the local
>> system is AIX uses jfs2.) But in the NFS folder it keep doing and
>> doing... i didnt exactly know what happened inside. little later the
>> application freezed.I saw some lock files created inside the folder
>> but nothing like index files that usually created by the lucene. from
>> the web page i search this index in nfs for the report and read it. My
>> question is how to use lucene in NFS. anything special we need to do?
>> any reference codes? docs? How do i lock the index when my scheduler
>> is updating the index?
>>
>> P.S: Please add CC to vijayv@kggroup.com
>>
>> Thanks
>> Vijay Veeraraghavan
>>
>>
>>
>> --
>> Thanks & Regards
>> Vijay Veeraraghavan
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Thanks & Regards
Vijay Veeraraghavan

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45986-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 13:43:24 2010
Return-Path: <java-user-return-45986-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14263 invoked from network); 30 Apr 2010 13:43:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 13:43:24 -0000
Received: (qmail 86480 invoked by uid 500); 30 Apr 2010 13:43:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86453 invoked by uid 500); 30 Apr 2010 13:43:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86444 invoked by uid 99); 30 Apr 2010 13:43:22 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 13:43:22 +0000
X-ASF-Spam-Status: No, hits=-2.5 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [150.148.0.65] (HELO ironport5.fda.gov) (150.148.0.65)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 13:43:16 +0000
X-SBRS: None
X-MID: 165931507
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApsEAMp62ksKoApN/2dsb2JhbACeEb4phRIE
Received: from fmd3tj002.fda.gov ([10.160.10.77])
  by ironport5.fda.gov with ESMTP; 30 Apr 2010 09:42:55 -0400
Received: from FMD3VS012.fda.gov ([10.160.10.62]) by FMD3TJ002.fda.gov with Microsoft SMTPSVC(6.0.3790.3959);
	 Fri, 30 Apr 2010 09:42:48 -0400
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Lucene QueryParser and Analyzer
Date: Fri, 30 Apr 2010 09:42:47 -0400
Message-ID: <F8A04958BB57B64096F9BE6B95725643081E3D77@FMD3VS012.fda.gov>
In-Reply-To: <4BDA0FB2.8020501@princeton.edu>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene QueryParser and Analyzer
thread-index: Acrn79LduFxXyu9hQc23Bc3ZywfmDwAeu/4g
References: <4BD9E329.5030306@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D74@FMD3VS012.fda.gov> <4BD9E616.7030103@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D75@FMD3VS012.fda.gov> <4BD9EF96.5030206@princeton.edu> <F8A04958BB57B64096F9BE6B95725643081E3D76@FMD3VS012.fda.gov> <4BDA0FB2.8020501@princeton.edu>
From: "Sudarsan, Sithu D." <Sithu.Sudarsan@fda.hhs.gov>
To: <java-user@lucene.apache.org>
X-OriginalArrivalTime: 30 Apr 2010 13:42:48.0341 (UTC) FILETIME=[05694450:01CAE86B]

=20

Quick fix:

Create a filter to replace commas with white space and then run your
code.

Sincerely,
Sithu D Sudarsan



-----Original Message-----
From: Wei Ho [mailto:weiho@princeton.edu]=20
Sent: Thursday, April 29, 2010 7:01 PM
To: java-user@lucene.apache.org
Subject: Re: Lucene QueryParser and Analyzer

I think I've figured out what the problem is. Given the inputs,

Input1: C1C2,C3C4,C5C6,C7,C8C9C10
Input2: C1C2  C3C4  C5C6  C7  C8C9C10

Input1 gets parsed as
Query1: (text: "C1C2  C3C4  C5C6  C7  C8C9C10")
whereas Input2 gets parsed as
Query2: (text: "C1C2") (text: "C3C4") (text: "C5C6") (text: "C7") (text:

"C8C9C10")

That is, Lucene constructs the query and then pass the query text=20
through the analyzer. Is there any way to
force QueryParser to pass the input string through the analyzer before=20
creating the query? That is, force Lucene
to create Query2 for both Input1 and Input2.

Thanks,
Wei


-------- Original Message  --------
Subject: Re: Lucene QueryParser and Analyzer
From: Sudarsan, Sithu D. <Sithu.Sudarsan@fda.hhs.gov>
To: java-user@lucene.apache.org
Date: 4/29/2010 4:54 PM
>
> -------sample code-------------
>   =20
>>> Analyzer analyzer =3D new LingPipeAnalyzer();
>>> Searcher searcher =3D new IndexSearcher(directory);
>>> QueryParser qParser =3D new MultiFieldQueryParser(Version.LUCENE_30,
>>> SEARCH_FIELDS, analyzer);
>>> Query query =3D qParser.parse(queryLine[1]);
>>> ScoreDoc[] results =3D searcher.search(query, TOP_N).scoreDocs;
>>>       =20
> qParser will use the analyzer LingPipeAnalyzer() before forming the
> query.
>
>
> Sincerely,
> Sithu D Sudarsan
>
>
> -----Original Message-----
> From: Wei Ho [mailto:weiho@princeton.edu]
> Sent: Thursday, April 29, 2010 4:44 PM
> To: java-user@lucene.apache.org
> Subject: Re: Lucene QueryParser and Analyzer
>
> Sorry, I guess "discarding the punctuation" was a bit misleading.
> I meant that given the two input strings,
>
> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>
> The analyzer I implemented tokenizes both Input1 and Input2 as "C1C2",
> "C3C4", "C5C6", "C7", "C8C9C10" - that is, it doesn't include the
> punctuation in the tokenization. I'm assuming that QueryParser is
simply
>
> passing the entire input string to the analyzer and taking the tokens,
> in which case Input1 and Input2 should be considered identifcal. Does
> QueryParser doing any sort of pre-processing or filtering beforehand?
If
>
> so, how can I turn it off?
>
> Aside from stopping tokens at punctuations, my analyzer is also doing
> Chinese word segmentation, so I'd like to be sure that QueryParser is
> using the analyzer the way I expect it to.
>
> Thanks,
> Wei
>
>
>
> -------- Original Message  --------
> Subject: Re: Lucene QueryParser and Analyzer
> From: Sudarsan, Sithu D.<Sithu.Sudarsan@fda.hhs.gov>
> To: java-user@lucene.apache.org
> Date: 4/29/2010 4:08 PM
>   =20
>> If so,
>>
>> Input1:  c1c2c3c4c5c6c7....
>> Input2: c1c2 c3c4 ...
>>
>> I guess, they are different! Add a whitespace after commas and see if
>> that works...
>>
>> Sincerely,
>> Sithu D Sudarsan
>>
>>
>> -----Original Message-----
>> From: Wei Ho [mailto:weiho@princeton.edu]
>> Sent: Thursday, April 29, 2010 4:04 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: Lucene QueryParser and Analyzer
>>
>> No, there is no whitespace after the comma in Input1
>>
>> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
>> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>>
>> Input1 is basically one big long word with commas and Chinese
>>     =20
> characters
>   =20
>> one after the other. Input2 is where I manually separated the string
>> into the component terms by replacing the comma with whitespace. My
>> confusion stems from the fact that I thought it should not matter
>>     =20
> since
>   =20
>> the analyzer should be discarding the punctuation anyway? So the
>> tokenization process should be the same for both Input1 and Input2?
If
>> that is not the case, what do I need to change?
>>
>> Thanks,
>> Wei Ho
>>
>> -------- Original Message  --------
>> Subject: Re: Lucene QueryParser and Analyzer
>> From: Sudarsan, Sithu D.<Sithu.Sudarsan@fda.hhs.gov>
>> To: java-user@lucene.apache.org
>> Date: 4/29/2010 3:54 PM
>>
>>     =20
>>> Hi,
>>>
>>> Is there a whitespace after the comma?
>>>
>>>
>>> Sincerely,
>>> Sithu D Sudarsan
>>>
>>>
>>> -----Original Message-----
>>> From: Wei Ho [mailto:weiho@princeton.edu]
>>> Sent: Thursday, April 29, 2010 3:51 PM
>>> To: java-user@lucene.apache.org
>>> Subject: Lucene QueryParser and Analyzer
>>>
>>> Hello,
>>>
>>> I'm using Lucene to index and search through a collection of Chinese
>>> documents. However, I'm noticing an odd behavior in query
>>> parsing/searching.
>>>
>>> Given the two queries below:
>>>
>>> (Ci refers to Chinese character i)
>>> Input1: C1C2,C3C4,C5C6,C7,C8C9C10
>>> Input2: C1C2  C3C4  C5C6  C7  C8C9C10
>>>
>>> Input1 returns absolutely nothing, while Input2 (replacing the
commas
>>> with spaces) works as expected. I'm a bit confused why this would be
>>> happening - it seems that QueryParser uses the Analyzer passed to it
>>>
>>>       =20
>> to
>>
>>     =20
>>> tokenize the input query string, so if the Analyzer ignores the
>>> punctuations, it seems that Input1 and Input2 should return
identical
>>> results. Is there some pre-Analyzer filtering or whatever that
>>> QueryParser does? I've tried this with the StandardAnalyzer,
>>> SmartChineseAnalyzer, and an analyzer that I implemented which
>>> explicitly skips over punctuations and whitespaces in tokenizing the
>>> query string, but to no avail.
>>>
>>>
>>> -----------------------------------
>>>
>>> I'm probably just doing something dumb, but any help would be
greatly
>>> appreciated!
>>>
>>> Thanks,
>>> Wei Ho
>>>
>>>
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>>       =20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     =20
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   =20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45987-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 15:02:07 2010
Return-Path: <java-user-return-45987-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31088 invoked from network); 30 Apr 2010 15:02:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 15:02:07 -0000
Received: (qmail 80625 invoked by uid 500); 30 Apr 2010 15:02:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80589 invoked by uid 500); 30 Apr 2010 15:02:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80581 invoked by uid 99); 30 Apr 2010 15:02:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 15:02:04 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 15:01:57 +0000
Received: by bwz22 with SMTP id 22so194363bwz.5
        for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 08:01:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=Ad130t5lqw6ymlbfLR9MKy+5Sw7d2J2Z7njrTyDQG8k=;
        b=AWRm59HmLfAM5EGFvxherpyz9O7uYTbiqpWuW8czF84fPRFRcZUJGbVMgJySG8dphB
         pYb5s8EFlE4+mZsXhU9dTX1Nz4h96Fh1XsFgphTvKKYcZQe1RljRRzyJ02Y3zfaQrUjb
         pommIet5ejCuT9M+40AAVX6Isq+GzoKjfA4xw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=SiPrew3sKpC5JC91f/gkE7/TZ82OD9GsiNIx8MLSX8r3tobz5AgZviVHwHe7fEfzfr
         nhJO4mCkpZKwfu1uKmPJBvIwiALqHpOqmFZAhtiGv0sUvcM6lUV6sFSafmTz0PRD3osj
         ZGL2YfaCC/K+wnvVDEJDMeBXFbljzsAWEiGzc=
Received: by 10.204.23.205 with SMTP id s13mr7125825bkb.195.1272639697325; 
	Fri, 30 Apr 2010 08:01:37 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.120.133 with HTTP; Fri, 30 Apr 2010 08:01:17 -0700 (PDT)
In-Reply-To: <q2jbd236a1004300501l8a055a4cs8343b74ff1fcfc87@mail.gmail.com>
References: <s2zbd236a1004290330ib1474600na34467b30ba3fe32@mail.gmail.com> 
	<z2qbd236a1004292148mdbefad4em6518237ba9bfcf0@mail.gmail.com> 
	<i2y8c4e68611004300248w91bfdb85s29f5859502a1c0c@mail.gmail.com> 
	<q2jbd236a1004300501l8a055a4cs8343b74ff1fcfc87@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 30 Apr 2010 16:01:17 +0100
Message-ID: <m2v8c4e68611004300801z1e208814xadfddc45437ab37f@mail.gmail.com>
Subject: Re: Using lucene in NFS
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

The suggestion was that your single indexing job should update a local
copy of the index and copy that to NFS for searching by other nodes.
That should work.

As for updating, you could index new reports into a new lucene index
and then merge that into the existing index
(IndexWriter.addIndexes()).  Or you could simple add them directly to
the existing index, making sure that you open it with create =3D false.


--
Ian.


On Fri, Apr 30, 2010 at 1:01 PM, Vijay Veeraraghavan
<vijay.raghavan08@gmail.com> wrote:
> hi Ian,
> Thanks for your reply. I am using the Lucene core 3.0 version. The
> index created will be accessed by the web application. The web
> application contains 4 nodes, clustered. What if all the nodes access
> the index. I think no any prob may raise.
> If i have a local index then what about it in the clustered environment?
> The NFS given is working good for saving the report, but only while i
> start the indexing the app freezes. it creates a lock file, i cant see
> whats happening inside as i cant see my console outputs too.
> And i have once more question. How do u update the index. As my
> scheduler keeps producing more reports to the file server, the index
> need to be updated then and there. how do i update the new report
> files to the index than doing again all the files. Or can i create a
> local index of the newly created reports and join this with the old
> index? any other professional solution?
>
> Thanks
> Vijay
>
> On 4/30/10, Ian Lea <ian.lea@gmail.com> wrote:
>> You don't say what version of lucene you are using, but in recent
>> versions you may need to use SimpleFSLockFactory rather than the
>> default, NativeFSLockFactory. =A0See the javadocs. =A0Lucene in general
>> does work on NFS but there can be problems, particularly with
>> concurrent access from multiple servers.
>>
>> But your problem sounds different. =A0Does the NFS mount work properly
>> for non-lucene operations? =A0Or maybe you could maintain a copy of the
>> index on local disks and just copy it to NFS for access from other
>> servers. =A0Lucene locking should take care of locking the index when
>> updates are running.
>>
>>
>> --
>> Ian.
>>
>>
>> On Fri, Apr 30, 2010 at 5:48 AM, Vijay Veeraraghavan
>> <vijay.raghavan08@gmail.com> wrote:
>>> dear all,
>>>
>>> I have a problem using lucene in NFS. A scheduler runs periodically
>>> generating reports in pdf format and saves it to a file server. The
>>> drive of the file server is mounted =A0to the scheduler server (NFS).
>>> After generating reports finally the scheduler indexes the names of
>>> the report and its path. This index is also stored to the same context
>>> folder the reports are created, ie., mounted NFS folder. When i create
>>> index in the local system (JFS2) its as fast as possible. (the local
>>> system is AIX uses jfs2.) But in the NFS folder it keep doing and
>>> doing... i didnt exactly know what happened inside. little later the
>>> application freezed.I saw some lock files created inside the folder
>>> but nothing like index files that usually created by the lucene. from
>>> the web page i search this index in nfs for the report and read it. My
>>> question is how to use lucene in NFS. anything special we need to do?
>>> any reference codes? docs? How do i lock the index when my scheduler
>>> is updating the index?
>>>
>>> P.S: Please add CC to vijayv@kggroup.com
>>>
>>> Thanks
>>> Vijay Veeraraghavan
>>>
>>>
>>>
>>> --
>>> Thanks & Regards
>>> Vijay Veeraraghavan
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> Thanks & Regards
> Vijay Veeraraghavan
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45988-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 15:21:40 2010
Return-Path: <java-user-return-45988-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36447 invoked from network); 30 Apr 2010 15:21:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 15:21:40 -0000
Received: (qmail 14346 invoked by uid 500); 30 Apr 2010 15:21:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14317 invoked by uid 500); 30 Apr 2010 15:21:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14309 invoked by uid 99); 30 Apr 2010 15:21:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 15:21:38 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gsiasf@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 15:21:29 +0000
Received: by vws13 with SMTP id 13so249684vws.35
        for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 08:21:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:content-type
         :mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        bh=PHoxETPkpSkM9KQhUv1UOaVP+U2M8OYQFaLTJrfe7gw=;
        b=BfeoBAuGKm8knPdxWhKvqUSAqnnBBCUIUksf0S0FelVNDa4PV9hXb76LsmYRaO41ZD
         B8COiLliQMGYJWfNFn6tezGQ5jtSg/Ques9KDGolUG7H2XDbLKlcUB569pbqbz2sThyt
         shmDmlI0fOYMf0ixmx1bwtNPkLWo65lXAZBh8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=WZbxt+samDLddK/z96ssLM26kEJgVxMfVaabuQPg2zB+nPLavbwslNZROQHEBRErou
         m5SoWrgdoXmZOMZ7WzLwaj8xuqHI1sopLgIilVu1fI9Hsz9ua2/R0xTRDYmfbcNRag1e
         ZeSh8Pykkb1kpCCT0VMFgSMoYYXkDz7uV5eTA=
Received: by 10.220.62.9 with SMTP id v9mr7751626vch.181.1272640867448;
        Fri, 30 Apr 2010 08:21:07 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id z17sm9346781vco.17.2010.04.30.08.21.06
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 30 Apr 2010 08:21:06 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1078)
Subject: Re: Relevancy Practices
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <h2r698f0de11004300500g71aba2b1g21378ba061b674c@mail.gmail.com>
Date: Fri, 30 Apr 2010 11:21:03 -0400
Content-Transfer-Encoding: quoted-printable
Message-Id: <E77D01D3-EB7D-4C8C-A817-03BE5A0E5D9E@apache.org>
References: <E6C119F7-C966-4280-94DD-3575BB3CE3F4@apache.org> <x2i3504767f1004290759u6de20a3ehfa4d46fb11a97954@mail.gmail.com> <h2r698f0de11004300500g71aba2b1g21378ba061b674c@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org


On Apr 30, 2010, at 8:00 AM, Avi Rosenschein wrote:
> Also, tuning the algorithms to the users can be very important. For
> instance, we have found that in a basic search functionality, the =
default
> query parser operator OR works very well. But on a page for advanced =
users,
> who want to very precisely tune their search results, a default of AND =
works
> better.

Avi,

Great example.  Can you elaborate on how you arrived at this conclusion? =
 What things did you do to determine it was a problem?

-Grant=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45989-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 15:31:09 2010
Return-Path: <java-user-return-45989-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39159 invoked from network); 30 Apr 2010 15:31:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 15:31:09 -0000
Received: (qmail 33354 invoked by uid 500); 30 Apr 2010 15:31:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33290 invoked by uid 500); 30 Apr 2010 15:31:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33280 invoked by uid 99); 30 Apr 2010 15:31:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 15:31:06 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gsiasf@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 15:30:58 +0000
Received: by vws13 with SMTP id 13so258505vws.35
        for <multiple recipients>; Fri, 30 Apr 2010 08:30:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:sender:from:content-type
         :content-transfer-encoding:subject:date:message-id:cc:to
         :mime-version:x-mailer;
        bh=WxHD/oZ6jpzVQshLhFPxTXyIgq5r7QdwVVcxCdpPIZ0=;
        b=l9qxJx0FHV8r9R0kOZXTLvSyjVRipqTX31+cZY+hL91o5juwsZ4z2Fln2Zb9CFosLt
         hQn5lqZ/w9A+SQKCblzYwR/UwApO7IpvKv61yticZtfAJcUbxz0olDjH2QUR2b6MPYPz
         WWu+B1ZQV9/uJ9fRD5cqNwzdKJ6ecUjo9Nu1Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=sender:from:content-type:content-transfer-encoding:subject:date
         :message-id:cc:to:mime-version:x-mailer;
        b=CBAf90tQ91uAtq/FKLduf064N6/I1xoV+e82COt/dWAOJ5cmq1wg3at8wuRvjpWBcN
         3Cthu5TksWx7bsGFJFPL1/RBeExM7uschN9hJ0ChdGdJUjwwTA9Y/GT8vdPgRHyuSqKz
         8KdiVOFKYQrcoi3muZBfyk7kt39NQHPb+neKc=
Received: by 10.220.108.106 with SMTP id e42mr7608651vcp.79.1272641437572;
        Fri, 30 Apr 2010 08:30:37 -0700 (PDT)
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
        by mx.google.com with ESMTPS id v12sm9368573vch.21.2010.04.30.08.30.35
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 30 Apr 2010 08:30:36 -0700 (PDT)
Sender: Grant Ingersoll <gsiasf@gmail.com>
From: Grant Ingersoll <gsingers@apache.org>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Subject: [OT] Lucene Boot Camp Training in Europe
Date: Fri, 30 Apr 2010 11:30:34 -0400
Message-Id: <6FF6CEB0-7637-4251-BCFE-514ED0FD2943@apache.org>
Cc: Lucene mailing list <general@lucene.apache.org>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1078)
X-Mailer: Apple Mail (2.1078)
X-Virus-Checked: Checked by ClamAV on apache.org

I will be once again providing Lucene training in Europe this year as =
part of Lucene EuroCon (in place of the usual ApacheCon venue).  This =
time it is in the beautiful city of Prague starting on May 18th.  =
Registration is open.  For more info, check out =
http://lucene-eurocon.org/training.html

Cheers,
Grant=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45990-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 20:11:13 2010
Return-Path: <java-user-return-45990-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26972 invoked from network); 30 Apr 2010 20:11:13 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 20:11:13 -0000
Received: (qmail 83864 invoked by uid 500); 30 Apr 2010 20:11:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83838 invoked by uid 500); 30 Apr 2010 20:11:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83829 invoked by uid 99); 30 Apr 2010 20:11:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 20:11:11 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [132.249.20.114] (HELO postal.sdsc.edu) (132.249.20.114)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 20:11:02 +0000
Received: from mta.ad.sdsc.edu (mta.ad.sdsc.edu [132.249.69.68])
	by postal.sdsc.edu (8.11.7/8.11.7/server/80) with ESMTP id o3UKAec14632
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 13:10:40 -0700 (PDT)
Received: from MBX.ad.sdsc.edu ([fe80::85f9:e068:7dc0:4fe0]) by
 mta.ad.sdsc.edu ([132.249.69.68]) with mapi; Fri, 30 Apr 2010 13:10:35 -0700
From: Christopher Condit <condit@sdsc.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 30 Apr 2010 13:10:32 -0700
Subject: Modify TermQueries or Tokens
Thread-Topic: Modify TermQueries or Tokens
Thread-Index: AcrooAxG+5ISL+55R72f7nqnl5LbjQ==
Message-ID: <BAFDED91EF7D5A43A30F897D6C94B1287294224CE6@MBX.ad.sdsc.edu>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

On a small index that I have I'd like to query certain fields by adding wil=
dcards on either side of the term: foo -> *foo*. I realize the performance =
implications but there are some cases where these terms are crammed togethe=
r in the indexed content (ie foonacho)  and I need to be able to return thi=
s result when searching for foo or when searching for nacho. I'm curious wh=
at the best way to modify the TermQuery object is. I thought about doing it=
 directly on the token as it gets parsed, but getNextToken() is final. Then=
 I thought I could iterate over the TermQueries under the returned Query an=
d change their term, but there's no setTerm method. Is the only way to do t=
his by modifying the query string? Or is there some more elegant way to mod=
ify the terms in a Query object? Something else I haven't considered?

Thanks,
-Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45991-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 20:41:42 2010
Return-Path: <java-user-return-45991-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31774 invoked from network); 30 Apr 2010 20:41:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 20:41:42 -0000
Received: (qmail 12992 invoked by uid 500); 30 Apr 2010 20:41:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12966 invoked by uid 500); 30 Apr 2010 20:41:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12958 invoked by uid 99); 30 Apr 2010 20:41:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 20:41:40 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of Lisheng.Zhang@broadvision.com designates 139.56.8.26 as permitted sender)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 20:41:32 +0000
X-ASG-Debug-ID: 1272660067-4813016b0000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id 8050F7D03F
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 13:41:07 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM (rw-ex2003.broadvision.com [10.10.160.33]) by mail-fw.broadvision.com with ESMTP id oQMyLXWWAu0q7M4I for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 13:41:07 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Modify TermQueries or Tokens
Subject: RE: Modify TermQueries or Tokens
Date: Fri, 30 Apr 2010 13:41:07 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13B9@rw-ex2003.BROADVISION.COM>
In-Reply-To: <BAFDED91EF7D5A43A30F897D6C94B1287294224CE6@MBX.ad.sdsc.edu>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Modify TermQueries or Tokens
Thread-Index: AcrooAxG+5ISL+55R72f7nqnl5LbjQABQRdw
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: rw-ex2003.broadvision.com[10.10.160.33]
X-Barracuda-Start-Time: 1272660067
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

Lucene already have class WildcardQuery, I think you can add "*" on =
either side
(or both), when creating Term:

http://lucene.apache.org/java/3_0_1/api/core/index.html

But notice by default QueryParser cannot parse *queryString.

Best regards, Lisheng

-----Original Message-----
From: Christopher Condit [mailto:condit@sdsc.edu]
Sent: Friday, April 30, 2010 1:11 PM
To: java-user@lucene.apache.org
Subject: Modify TermQueries or Tokens


On a small index that I have I'd like to query certain fields by adding =
wildcards on either side of the term: foo -> *foo*. I realize the =
performance implications but there are some cases where these terms are =
crammed together in the indexed content (ie foonacho)  and I need to be =
able to return this result when searching for foo or when searching for =
nacho. I'm curious what the best way to modify the TermQuery object is. =
I thought about doing it directly on the token as it gets parsed, but =
getNextToken() is final. Then I thought I could iterate over the =
TermQueries under the returned Query and change their term, but there's =
no setTerm method. Is the only way to do this by modifying the query =
string? Or is there some more elegant way to modify the terms in a Query =
object? Something else I haven't considered?

Thanks,
-Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45992-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 20:52:07 2010
Return-Path: <java-user-return-45992-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34282 invoked from network); 30 Apr 2010 20:52:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 20:52:07 -0000
Received: (qmail 30375 invoked by uid 500); 30 Apr 2010 20:52:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30334 invoked by uid 500); 30 Apr 2010 20:52:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30324 invoked by uid 99); 30 Apr 2010 20:52:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 20:52:05 +0000
X-ASF-Spam-Status: No, hits=-1.3 required=10.0
	tests=AWL,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of Lisheng.Zhang@broadvision.com designates 139.56.8.26 as permitted sender)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 20:51:58 +0000
X-ASG-Debug-ID: 1272660698-09b300b00000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id 52BFEA7A92
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 13:51:38 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM (rw-ex2003.broadvision.com [10.10.160.33]) by mail-fw.broadvision.com with ESMTP id KP5NH6I5djGVO2VB for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 13:51:38 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Modify TermQueries or Tokens
Subject: RE: Modify TermQueries or Tokens
Date: Fri, 30 Apr 2010 13:51:38 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13BA@rw-ex2003.BROADVISION.COM>
In-Reply-To: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13B9@rw-ex2003.BROADVISION.COM>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Modify TermQueries or Tokens
Thread-Index: AcrooAxG+5ISL+55R72f7nqnl5LbjQABQRdwAABbJJA=
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: rw-ex2003.broadvision.com[10.10.160.33]
X-Barracuda-Start-Time: 1272660698
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com

Hi,

Just to make sure, below is the code I used to create wildcard query:

String field =3D "title";
String value =3D "mytitle";
Term term =3D new Term(field, "*" + value + "*");
WildcardQuery wildcardQuery =3D new WildcardQuery(term);

I tested in 2.4.1 and it worked for me well.

Best regards, Lisheng

-----Original Message-----
From: Zhang, Lisheng [mailto:Lisheng.Zhang@BroadVision.com]
Sent: Friday, April 30, 2010 1:41 PM
To: java-user@lucene.apache.org
Subject: RE: Modify TermQueries or Tokens


Hi,

Lucene already have class WildcardQuery, I think you can add "*" on =
either side
(or both), when creating Term:

http://lucene.apache.org/java/3_0_1/api/core/index.html

But notice by default QueryParser cannot parse *queryString.

Best regards, Lisheng

-----Original Message-----
From: Christopher Condit [mailto:condit@sdsc.edu]
Sent: Friday, April 30, 2010 1:11 PM
To: java-user@lucene.apache.org
Subject: Modify TermQueries or Tokens


On a small index that I have I'd like to query certain fields by adding =
wildcards on either side of the term: foo -> *foo*. I realize the =
performance implications but there are some cases where these terms are =
crammed together in the indexed content (ie foonacho)  and I need to be =
able to return this result when searching for foo or when searching for =
nacho. I'm curious what the best way to modify the TermQuery object is. =
I thought about doing it directly on the token as it gets parsed, but =
getNextToken() is final. Then I thought I could iterate over the =
TermQueries under the returned Query and change their term, but there's =
no setTerm method. Is the only way to do this by modifying the query =
string? Or is there some more elegant way to modify the terms in a Query =
object? Something else I haven't considered?

Thanks,
-Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45993-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 21:08:47 2010
Return-Path: <java-user-return-45993-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40175 invoked from network); 30 Apr 2010 21:08:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 21:08:46 -0000
Received: (qmail 41986 invoked by uid 500); 30 Apr 2010 21:08:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41949 invoked by uid 500); 30 Apr 2010 21:08:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41941 invoked by uid 99); 30 Apr 2010 21:08:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 21:08:44 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [132.249.20.114] (HELO postal.sdsc.edu) (132.249.20.114)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 21:08:35 +0000
Received: from mta.ad.sdsc.edu (mta.ad.sdsc.edu [132.249.69.68])
	by postal.sdsc.edu (8.11.7/8.11.7/server/80) with ESMTP id o3UL8Ec23180;
	Fri, 30 Apr 2010 14:08:14 -0700 (PDT)
Received: from MBX.ad.sdsc.edu ([fe80::85f9:e068:7dc0:4fe0]) by
 mta.ad.sdsc.edu ([132.249.69.68]) with mapi; Fri, 30 Apr 2010 14:08:09 -0700
From: Christopher Condit <condit@sdsc.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
CC: "Lisheng.Zhang@BroadVision.com" <Lisheng.Zhang@BroadVision.com>
Date: Fri, 30 Apr 2010 14:08:06 -0700
Subject: RE: Modify TermQueries or Tokens
Thread-Topic: Modify TermQueries or Tokens
Thread-Index: AcrooAxG+5ISL+55R72f7nqnl5LbjQABQRdwAADeEBA=
Message-ID: <BAFDED91EF7D5A43A30F897D6C94B1287294224CEC@MBX.ad.sdsc.edu>
References: <BAFDED91EF7D5A43A30F897D6C94B1287294224CE6@MBX.ad.sdsc.edu>
 <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13B9@rw-ex2003.BROADVISION.COM>
In-Reply-To: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13B9@rw-ex2003.BROADVISION.COM>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Lisheng-
>> On a small index that I have I'd like to query certain fields by adding =
wildcards
>> on either side of the term: foo -> *foo*. I realize the performance
>> implications but there are some cases where these terms are crammed
>> together in the indexed content (ie foonacho)  and I need to be able to
>> return this result when searching for foo or when searching for nacho. I=
'm
>> curious what the best way to modify the TermQuery object is. I thought
>> about doing it directly on the token as it gets parsed, but getNextToken=
() is
>> final. Then I thought I could iterate over the TermQueries under the ret=
urned
>> Query and change their term, but there's no setTerm method. Is the only
>> way to do this by modifying the query string? Or is there some more eleg=
ant
>> way to modify the terms in a Query object? Something else I haven't
>> considered?

> Lucene already have class WildcardQuery, I think you can add "*" on eithe=
r
> side (or both), when creating Term:
>=20
> http://lucene.apache.org/java/3_0_1/api/core/index.html

What about a more complex query string like: (foo OR nacho) AND ("bar baz")=
 OR cheese~1.2. If I feed this to the MultiFieldQueryParser can I change th=
e TermQueries afterward? Or am I going to have write some code to modify th=
e original string?

Thanks for your response,
-Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45994-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 21:17:21 2010
Return-Path: <java-user-return-45994-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43211 invoked from network); 30 Apr 2010 21:17:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 21:17:21 -0000
Received: (qmail 55800 invoked by uid 500); 30 Apr 2010 21:17:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55752 invoked by uid 500); 30 Apr 2010 21:17:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55744 invoked by uid 99); 30 Apr 2010 21:17:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 21:17:18 +0000
X-ASF-Spam-Status: No, hits=4.2 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 21:17:11 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <mitch91@web.de>)
	id 1O7xZq-00052n-Ek
	for java-user@lucene.apache.org; Fri, 30 Apr 2010 14:16:50 -0700
Date: Fri, 30 Apr 2010 14:16:50 -0700 (PDT)
From: MitchK <mitch91@web.de>
To: java-user@lucene.apache.org
Message-ID: <1272662210449-768902.post@n3.nabble.com>
In-Reply-To: <E77D01D3-EB7D-4C8C-A817-03BE5A0E5D9E@apache.org>
References: <E6C119F7-C966-4280-94DD-3575BB3CE3F4@apache.org> <x2i3504767f1004290759u6de20a3ehfa4d46fb11a97954@mail.gmail.com> <h2r698f0de11004300500g71aba2b1g21378ba061b674c@mail.gmail.com> <E77D01D3-EB7D-4C8C-A817-03BE5A0E5D9E@apache.org>
Subject: Re: Relevancy Practices
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


I found your thread at the Solr-user-list. However, it seems like your topic
belongs more to Lucene in general?
I copy my posting from there, so that everything is accessible by one
thread.
--------------------------------------------------------------------------

I think the problems one has to solve are depending on the usecases one has
to deal with. 
It makes a difference whether I got much documents that are bloody similar
but with different contexts and I have to determine what query applies to
what context in what probability for which document - or if I have lots of
editorialy managed documents with relatively clear contexts, because they
offer human-created tags etc. 

I haven't made much experiences with Solr (and no experiences in a
productive environment). However, those experiences I have made show that
spliting the document's context in as small parts as possible is always a
good idea. 
I don't mean splitting in a sense of making the part's of a document
smaller. I mean that in a way of making it easier to decide which part of a
document is more important than another. 
e.g.: I got a social network and every user is able to create his or her own
blog - as a corporation I want to make them all searchable. It would be
beneficial for high-quality search, if I am able to extract the
introduction, the category  (maybe added by the author). 

According to this: If this is not done by people, or not well done enough,
than I need to do so algorithmically. 
e.g.: 
If I got a dictionary of person-names, than I could use the keepWordFilter
to create a field I can facet *and* boost on. 
Let's say the user writes about Paris Hilton, Barrack Obama or any other
well known person, than I can extract their names from the content in an
easy way - of course this could be done better, but that's not the point
here. 
If I search for "Obama's speech" all documents with "Obama" could get a
boost. 
The difference between the solution without this keepWordFilter-feature
would be, that Solr does not know that the most important word in this query
is "Obama". 

It is only a shortcut of some ideas on how one can improve the relevancy
with several features that Solr offers out-of-the-box. Some of them could be
improved with external NLP-tools. 

My biggest problem with relevancy is, that I can't work with metadata
computed on the fly or every hour out of the box (okay, you mentioned at the
discussion on the dev-list that it may be possible, however I answered that
the feature you talked about is not well documented, so that I don't know if
it fits my needs or how to use it). 

How to avoid over- or under-tuning? 
Easily: Testing every change I made on scoring-factors against a lot of
queries. If it looks good in 9 of 10 cases in a real good way, than the 10th
case runs against a really bad query or could be solved with a facet or...
there are a lot of ideas how to solve this. What I really want to say is:
Test as much as you can and try to realize what your changes really mean
(for example I can make a boost on the title of a document with a value of
1.000, every other field has got a boost-value between 1 and 10. I am
relatively sure that this meets the needs for some queries but works
catastrophal with the rest). 
It really helps to understand how Lucene's similarity works and what those
factors mean in reality to your existing data. Maybe you need to change the
smiliarity, because you don't want that the length of a document influences
the score of it. 

Just some thougths. I don't think that I tell you much new stuff, however,
if you got any questions or want to know more about this or that, please
ask. 
Unfortunately I can't go to the ApacheCon, but hopefully it helps to give a
good presentation. 

Kind regards 
- Mitch
-- 
View this message in context: http://lucene.472066.n3.nabble.com/Relevancy-Practices-tp765363p768902.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45995-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 21:29:58 2010
Return-Path: <java-user-return-45995-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46233 invoked from network); 30 Apr 2010 21:29:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 21:29:58 -0000
Received: (qmail 65096 invoked by uid 500); 30 Apr 2010 21:29:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65062 invoked by uid 500); 30 Apr 2010 21:29:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65054 invoked by uid 99); 30 Apr 2010 21:29:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 21:29:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of Lisheng.Zhang@broadvision.com designates 139.56.8.26 as permitted sender)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 21:29:48 +0000
X-ASG-Debug-ID: 1272662967-099a00ef0000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id 57F474878
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 14:29:27 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM (rw-ex2003.broadvision.com [10.10.160.33]) by mail-fw.broadvision.com with ESMTP id 7OkvpXIfAU9DnEU6 for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 14:29:27 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Modify TermQueries or Tokens
Subject: RE: Modify TermQueries or Tokens
Date: Fri, 30 Apr 2010 14:29:27 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13BB@rw-ex2003.BROADVISION.COM>
In-Reply-To: <BAFDED91EF7D5A43A30F897D6C94B1287294224CEC@MBX.ad.sdsc.edu>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Modify TermQueries or Tokens
Thread-Index: AcrooAxG+5ISL+55R72f7nqnl5LbjQABQRdwAADeEBAAAITpkA==
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: rw-ex2003.broadvision.com[10.10.160.33]
X-Barracuda-Start-Time: 1272662967
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

In that case, I would do:

1) if I can somehow know the input words (like foo, nacho, ...), I will =
create
   lucene BooleanQuery myself, that's the case in my application.

2) if I have to accept whole input string with all logic (AND, OR, ..) =
inside,
   I think it is easier to change TermQuery afterwards than parsing the =
string,
   since final result from query parser should be BooleanQuery (in your =
example),=20
   then we iterate through each BooleanClause, if the clause is still =
BooleanQuery,=20
   recursively go deep, if TermQuery, we may try to convert to =
WildCardQuery?

   I have not done that myself before, but feel it should work.

Best regards, Lisheng

-----Original Message-----
From: Christopher Condit [mailto:condit@sdsc.edu]
Sent: Friday, April 30, 2010 2:08 PM
To: java-user@lucene.apache.org
Cc: Zhang, Lisheng
Subject: RE: Modify TermQueries or Tokens


Hi Lisheng-
>> On a small index that I have I'd like to query certain fields by =
adding wildcards
>> on either side of the term: foo -> *foo*. I realize the performance
>> implications but there are some cases where these terms are crammed
>> together in the indexed content (ie foonacho)  and I need to be able =
to
>> return this result when searching for foo or when searching for =
nacho. I'm
>> curious what the best way to modify the TermQuery object is. I =
thought
>> about doing it directly on the token as it gets parsed, but =
getNextToken() is
>> final. Then I thought I could iterate over the TermQueries under the =
returned
>> Query and change their term, but there's no setTerm method. Is the =
only
>> way to do this by modifying the query string? Or is there some more =
elegant
>> way to modify the terms in a Query object? Something else I haven't
>> considered?

> Lucene already have class WildcardQuery, I think you can add "*" on =
either
> side (or both), when creating Term:
>=20
> http://lucene.apache.org/java/3_0_1/api/core/index.html

What about a more complex query string like: (foo OR nacho) AND ("bar =
baz") OR cheese~1.2. If I feed this to the MultiFieldQueryParser can I =
change the TermQueries afterward? Or am I going to have write some code =
to modify the original string?

Thanks for your response,
-Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-45996-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Apr 30 23:06:15 2010
Return-Path: <java-user-return-45996-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67081 invoked from network); 30 Apr 2010 23:06:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Apr 2010 23:06:15 -0000
Received: (qmail 51343 invoked by uid 500); 30 Apr 2010 23:06:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51298 invoked by uid 500); 30 Apr 2010 23:06:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51290 invoked by uid 99); 30 Apr 2010 23:06:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 23:06:13 +0000
X-ASF-Spam-Status: No, hits=-4.5 required=10.0
	tests=AWL,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [132.249.20.114] (HELO postal.sdsc.edu) (132.249.20.114)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Apr 2010 23:06:05 +0000
Received: from mta.ad.sdsc.edu (mta.ad.sdsc.edu [132.249.69.68])
	by postal.sdsc.edu (8.11.7/8.11.7/server/80) with ESMTP id o3UN5ic09186
	for <java-user@lucene.apache.org>; Fri, 30 Apr 2010 16:05:44 -0700 (PDT)
Received: from MBX.ad.sdsc.edu ([fe80::85f9:e068:7dc0:4fe0]) by
 mta.ad.sdsc.edu ([132.249.69.68]) with mapi; Fri, 30 Apr 2010 16:05:39 -0700
From: Christopher Condit <condit@sdsc.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 30 Apr 2010 16:05:37 -0700
Subject: RE: Modify TermQueries or Tokens
Thread-Topic: Modify TermQueries or Tokens
Thread-Index: AcrooAxG+5ISL+55R72f7nqnl5LbjQABQRdwAADeEBAAAITpkAADr1FQ
Message-ID: <BAFDED91EF7D5A43A30F897D6C94B1287294224CEE@MBX.ad.sdsc.edu>
References: <BAFDED91EF7D5A43A30F897D6C94B1287294224CEC@MBX.ad.sdsc.edu>
 <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13BB@rw-ex2003.BROADVISION.COM>
In-Reply-To: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB13BB@rw-ex2003.BROADVISION.COM>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0

> 2) if I have to accept whole input string with all logic (AND, OR, ..) in=
side,
>    I think it is easier to change TermQuery afterwards than parsing the s=
tring,
>    since final result from query parser should be BooleanQuery (in your
> example),
>    then we iterate through each BooleanClause, if the clause is still
> BooleanQuery,
>    recursively go deep, if TermQuery, we may try to convert to
> WildCardQuery?

protected static void wildcardQuery(Query query) {
		if (query instanceof BooleanQuery) {
			BooleanQuery bQuery =3D (BooleanQuery)query;
			for (BooleanClause clause: bQuery.getClauses()) {
				if (clause.getQuery() instanceof TermQuery) {
					Term term =3D ((TermQuery)clause.getQuery()).getTerm();
					clause.setQuery(new WildcardQuery(new Term(term.field(), "*" + term.te=
xt() + "*")));
				}
				else
					wildcardQuery(clause.getQuery());
			}		=09
		}=20
	}

Does the trick (as long as the original query is a BooleanQuery). Thanks fo=
r the suggestion!
-Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


