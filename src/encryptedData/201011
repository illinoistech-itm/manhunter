From java-user-return-47666-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 08:54:12 2010
Return-Path: <java-user-return-47666-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20096 invoked from network); 1 Nov 2010 08:54:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 08:54:11 -0000
Received: (qmail 1437 invoked by uid 500); 1 Nov 2010 08:54:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1318 invoked by uid 500); 1 Nov 2010 08:54:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1307 invoked by uid 99); 1 Nov 2010 08:54:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 08:54:36 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of i30817@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 08:54:30 +0000
Received: by ywp4 with SMTP id 4so3487027ywp.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 01:54:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=yKg+pdDHo3JI+MEatw3fcHlCCQL5Q5fsO26+YuZtGVc=;
        b=uLGMml0WA8DuqN5bs1fg6xzNFopQgKhSAHKT/noJz5Fsz8SslR0PpQuUXiDYQsxR0B
         fp6VkCwAtMrfAX2P6lGDnNNV5hR+C8A1xRWkdbTfKmXLkppudmnh8b2XBNuTSd/nDloL
         7jcbklLDEh1wz54hRGiWGjGo50uKu7kXlx8So=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=GzWoxltc0uf9+9YE1obId5aGFZlsxB22XKi6nV4yIbKajx19CSc7lEldaGA+RariOV
         u8cBG9D/o8QD2X9wqvXpVE6NvSLuOZ/G/IXxvsMAKSfAb317uOIRLSi8IWUn6/SMk2p+
         1Ge5fzSR/86GoeY01ekK62v8nXbnKizzw90rk=
Received: by 10.91.44.28 with SMTP id w28mr8866835agj.93.1288601649472; Mon,
 01 Nov 2010 01:54:09 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.90.154.4 with HTTP; Mon, 1 Nov 2010 01:53:49 -0700 (PDT)
In-Reply-To: <AANLkTinG+Vd-CX-UfCQieCsFdcOV2UTjvBJxpRx4RhWC@mail.gmail.com>
References: <AANLkTimNc=a_WU1oLg-p-SUunieoiF7QYy4BA7rqN1Qv@mail.gmail.com>
 <AANLkTi=9Z2L4bWP_KW1GKF7HvcAchkn_hzK0GPZJrEUp@mail.gmail.com>
 <AANLkTi=FRQh-OYKaK3LEHjLziBkq9A4SYnknt0Eev99i@mail.gmail.com>
 <AANLkTinmkW9tC0zc9F+aLk_Ht4Y7_rmwJt2iX5D1WHHB@mail.gmail.com> <AANLkTinG+Vd-CX-UfCQieCsFdcOV2UTjvBJxpRx4RhWC@mail.gmail.com>
From: Paulo Levi <i30817@gmail.com>
Date: Mon, 1 Nov 2010 08:53:49 +0000
Message-ID: <AANLkTik8Ys9QYLKFgZ66SywgzEB2dTCQwcf+0DkXcnhK@mail.gmail.com>
Subject: Re: Indexing with foreign key
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b7c1a92ea260493f9f325

--0016363b7c1a92ea260493f9f325
Content-Type: text/plain; charset=ISO-8859-1

Just self imposed.

--0016363b7c1a92ea260493f9f325--

From java-user-return-47667-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 17:32:40 2010
Return-Path: <java-user-return-47667-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80452 invoked from network); 1 Nov 2010 17:32:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 17:32:40 -0000
Received: (qmail 72729 invoked by uid 500); 1 Nov 2010 17:33:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72669 invoked by uid 500); 1 Nov 2010 17:33:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72661 invoked by uid 99); 1 Nov 2010 17:33:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 17:33:08 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of francisco.borges@gmail.com designates 209.85.213.176 as permitted sender)
Received: from [209.85.213.176] (HELO mail-yx0-f176.google.com) (209.85.213.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 17:33:02 +0000
Received: by yxn22 with SMTP id 22so3880110yxn.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 10:32:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=Z+EDuTdd5SubKwKeX+D6cnUnqrkKTOZQboZ9s6XcEQI=;
        b=iO63RO8+tr/RyAEh1Kc/v3PZ8LzX1b6p5ZcTOmnt091lzMA6JVLSC8d43wFq6DD+xN
         MJzGE0mprm1ma2dkZyyOVJGSnjMBrxS8g7Sxs8DYWY3uwHa+hz8gHaF3fhs2ngkSi0Rb
         fmDSDG3IFHjOVPiSESNozLzaFeXEoVSoxob5Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=sVobupMRThVjOcWkdRCKizEnbJYbdDDuHi8CjjGUmvSfZ/uDn65XOe+7w0YtTXOAVI
         nWCfH60Sa8gvBOU/2/TrXYY+nqSKq6KVvIlb0hCrxLoIipDl9vsHlAxzP5nbCmWk0M2L
         01MtcyjOiiGpcMD+hrnT51kqaCy54sneZIFKc=
Received: by 10.229.238.193 with SMTP id kt1mr6771906qcb.292.1288632761362;
 Mon, 01 Nov 2010 10:32:41 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.229.96.137 with HTTP; Mon, 1 Nov 2010 10:32:21 -0700 (PDT)
From: Francisco Borges <francisco.borges@gmail.com>
Date: Mon, 1 Nov 2010 18:32:21 +0100
Message-ID: <AANLkTinHCq4jO3uPZoUFc4SymjfCxB41w0oX=dWKxsGy@mail.gmail.com>
Subject: filtering results per field?
To: lucene user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=001485f9220cfcab7804940131df

--001485f9220cfcab7804940131df
Content-Type: text/plain; charset=UTF-8

Hello,

I would like to search several fields while applying different Filter's to
the results of different fields.

Is it possible to (efficiently) filter out results according to which fields
they are coming from? I've been navigating the code and Javadocs, and
haven't found any way to do it.

One alternative would be to search for each field (or groups of
fields) separately. Can anyone comment on the performance impact and
scalability of searching separately per field?

Kind regards,
-- 
Francisco

--001485f9220cfcab7804940131df--

From java-user-return-47668-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 19:00:34 2010
Return-Path: <java-user-return-47668-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23339 invoked from network); 1 Nov 2010 19:00:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 19:00:33 -0000
Received: (qmail 1521 invoked by uid 500); 1 Nov 2010 19:01:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1458 invoked by uid 500); 1 Nov 2010 19:01:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1450 invoked by uid 99); 1 Nov 2010 19:01:02 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 19:01:02 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 19:00:54 +0000
Received: by gwj19 with SMTP id 19so159821gwj.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 12:00:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Aw3UdFWomOjMhpMOQ1oBtCm9F1Ri+oiFPypxF9v9lPE=;
        b=npE6R1q7fETeaCPfluTNNXJdlv6nXns+WjNTIxUDZyHfjfKmFz33FhesSYhDThHpNk
         oWxgQnsaXPEgHbmWCE85t+1ytu/JAJd2vfCCZje88K/gUpaomf+XnO3HlRr6kPADY3Br
         Uo6V0HyHqvbmqn5wYazCT9MPIFhi3LPOxzmRA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=qwL6q/B4rJfjjKpv3UgnRjAr/gH2vot/DuWJaZPhgglvXzBqyvDJMvgX9tLHATJ4et
         fa7jWg1bSNHR7FDYsfkdXj0YvthoqMQnadaRO6q0zmh6jSgdfW4/9xscRfY5XD64QK8D
         eQCH/5Qu+KkNyTMpYmtixD2DmYYbKpl64zTN8=
MIME-Version: 1.0
Received: by 10.229.221.131 with SMTP id ic3mr15379785qcb.152.1288638007776;
 Mon, 01 Nov 2010 12:00:07 -0700 (PDT)
Received: by 10.229.229.14 with HTTP; Mon, 1 Nov 2010 12:00:07 -0700 (PDT)
In-Reply-To: <AANLkTinHCq4jO3uPZoUFc4SymjfCxB41w0oX=dWKxsGy@mail.gmail.com>
References: <AANLkTinHCq4jO3uPZoUFc4SymjfCxB41w0oX=dWKxsGy@mail.gmail.com>
Date: Mon, 1 Nov 2010 15:00:07 -0400
Message-ID: <AANLkTinK=XLo5RTUNYcu_MBOp7BfcypLuLA4t3rQ3vyq@mail.gmail.com>
Subject: Re: filtering results per field?
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016362841a4b294370494026a17
X-Virus-Checked: Checked by ClamAV on apache.org

--0016362841a4b294370494026a17
Content-Type: text/plain; charset=ISO-8859-1

I'm not quite following here. You can construct filters on any field you
want,
and combine them as you choose, then apply the resulting filter to your
query.
See TermsFilter for instance. Or, your filter could #be# your query.

If this is gibberish, could you give an example or two showing what you're
trying to accomplish?

Best
Erick

On Mon, Nov 1, 2010 at 1:32 PM, Francisco Borges <francisco.borges@gmail.com
> wrote:

> Hello,
>
> I would like to search several fields while applying different Filter's to
> the results of different fields.
>
> Is it possible to (efficiently) filter out results according to which
> fields
> they are coming from? I've been navigating the code and Javadocs, and
> haven't found any way to do it.
>
> One alternative would be to search for each field (or groups of
> fields) separately. Can anyone comment on the performance impact and
> scalability of searching separately per field?
>
> Kind regards,
> --
> Francisco
>

--0016362841a4b294370494026a17--

From java-user-return-47669-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 19:25:55 2010
Return-Path: <java-user-return-47669-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45603 invoked from network); 1 Nov 2010 19:25:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 19:25:49 -0000
Received: (qmail 42912 invoked by uid 500); 1 Nov 2010 19:26:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42869 invoked by uid 500); 1 Nov 2010 19:26:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42861 invoked by uid 99); 1 Nov 2010 19:26:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 19:26:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of iamjabour@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 19:26:10 +0000
Received: by ywp4 with SMTP id 4so3997283ywp.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 12:25:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=ld6guAfBIFybxc9KFAjqpgzZcJUgwmj6YU8gyaqTi/A=;
        b=rO/g1y3ceBPFdCfgYXsfM0vqlZVJ1Odt8gagNxQ3brVEAKqT8aimrClUE+vmhFDtWv
         p+sB0Ygti82/Q3Mb8hrD06tsdnITTp9VQfyudFglNFKB6XMiBNCA0VoAdqrcUKxJl/IC
         y043HqNq1inBs7J6XauIEQaCo0ZknHc5SDKcw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=JfjFNuyJnV3RjIyeEQcnW+vlhtpVQAXYmr03CiYm2REUsKGHRJ9KPT8IfBuRzNZN8x
         bJTOOL1ln7No42We1hQTruBC/QYeJv+dc0tOLmaaOkoL5I2myDRNcP8ya8SZJcnEFwlV
         7AdSKVvxtE2W10LDJPalqtvdsWVz2ESFe6/yY=
MIME-Version: 1.0
Received: by 10.42.212.200 with SMTP id gt8mr11873809icb.504.1288639549834;
 Mon, 01 Nov 2010 12:25:49 -0700 (PDT)
Received: by 10.42.241.137 with HTTP; Mon, 1 Nov 2010 12:25:49 -0700 (PDT)
Date: Mon, 1 Nov 2010 17:25:49 -0200
Message-ID: <AANLkTikUS2CU5U531SXz2wTg7b=orEww9vJ6180pEJQ4@mail.gmail.com>
Subject: Best way to create a Lucene Index with fields that can be updated
 frequently, and filtering the results by this field.
From: Iam Jabour <iamjabour@gmail.com>
To: lucene-group <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi, I use Lucene to index my documents and search. Actually I have
800k documents indexed in Lucene. Those documents have some fields:

Id: is a Numeric field to index the documents

Name: is a textual field to be stored and analyzed

Description: like name

Availability: is a numeric field to filter results. This field can be
updated frequently, every day.

My question is: What's the better way to create a filter for availability?

1 - add this information to index and make a lucene filter. With this
approach I have to update document (remove and add, because lucene
3.0.2 not have update support) every time the "availability" changes.
What the cost of reindex?

2 - don't add this information to index, and filter the results with a
DB select. This approach will do a lot of selects, because I need
select every id from database to check availability.

3 - Create a separated index with id and availability. I don't know if
it is a good solution, but I can create a index with static
information and other with information can be frequently updated. I
think it is better then update all document, just because some fields
were updated.

______________
Iam Jabour

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47670-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 20:07:01 2010
Return-Path: <java-user-return-47670-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83007 invoked from network); 1 Nov 2010 20:07:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 20:07:01 -0000
Received: (qmail 9754 invoked by uid 500); 1 Nov 2010 20:07:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9716 invoked by uid 500); 1 Nov 2010 20:07:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9708 invoked by uid 99); 1 Nov 2010 20:07:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 20:07:30 +0000
X-ASF-Spam-Status: No, hits=2.5 required=10.0
	tests=FREEMAIL_FROM,HTML_FONT_FACE_BAD,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of nilesh.vijay@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 20:07:24 +0000
Received: by gwj19 with SMTP id 19so223422gwj.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 13:07:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=nLUDaznyrKllCIMEbBGxby6EvxwbpaeZb/YkvYSnY3E=;
        b=Zhzyc9LPiRgajVPQLBTjuNqqFOsDh6vca7FrfIjo6Fv+Gfpaps8O67Qu+uFiTbMZ55
         vpaebgCquWAqx5h1dPk8x4QOEoWLNF8h/I0XyLdR6hzX6u/aLIhz0bDmCfHZvTnK26au
         628Jzb5irCgvFbsIGsbv92WpfsQ1GbWtqGld8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=vmeXn+96VKLrYRLO2K5Js9rqVndiO9XMVO7qjX+lBMGC4igY7JfL1L3d9NHYfFMpIH
         9KwzDr39K2bd8HOiy6SSEsL7Zquak9S4O13SSyqLZrwnO3E8W4CpKVhovCHBwKFrpkIS
         +ogpCFEBXFmTFNJXL0LMX9KkssY4Bl7fNvdIM=
Received: by 10.42.137.68 with SMTP id x4mr2168294ict.64.1288642023786; Mon,
 01 Nov 2010 13:07:03 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.229.215.16 with HTTP; Mon, 1 Nov 2010 12:58:58 -0700 (PDT)
In-Reply-To: <AANLkTikUS2CU5U531SXz2wTg7b=orEww9vJ6180pEJQ4@mail.gmail.com>
References: <AANLkTikUS2CU5U531SXz2wTg7b=orEww9vJ6180pEJQ4@mail.gmail.com>
From: Nilesh Vijaywargiay <nilesh.vijay@gmail.com>
Date: Mon, 1 Nov 2010 12:58:58 -0700
Message-ID: <AANLkTinCDrSABjahcbZeBnA+oxqETAxPK1VTo2US8PLo@mail.gmail.com>
Subject: Re: Best way to create a Lucene Index with fields that can be updated
 frequently, and filtering the results by this field.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=90e6ba6e835212077d0494035ad0

--90e6ba6e835212077d0494035ad0
Content-Type: text/plain; charset=ISO-8859-1

Hey Iam,

I have worked on the approach number 3 recently. It suits our requirement
although its not the best way to do incremental updates. Please find the
details here <http://the10minutes.blogspot.com/2010/10/lucene-index-update.html>

Nilesh

On Mon, Nov 1, 2010 at 12:25 PM, Iam Jabour <iamjabour@gmail.com> wrote:

> Hi, I use Lucene to index my documents and search. Actually I have
> 800k documents indexed in Lucene. Those documents have some fields:
>
> Id: is a Numeric field to index the documents
>
> Name: is a textual field to be stored and analyzed
>
> Description: like name
>
> Availability: is a numeric field to filter results. This field can be
> updated frequently, every day.
>
> My question is: What's the better way to create a filter for availability?
>
> 1 - add this information to index and make a lucene filter. With this
> approach I have to update document (remove and add, because lucene
> 3.0.2 not have update support) every time the "availability" changes.
> What the cost of reindex?
>
> 2 - don't add this information to index, and filter the results with a
> DB select. This approach will do a lot of selects, because I need
> select every id from database to check availability.
>
> 3 - Create a separated index with id and availability. I don't know if
> it is a good solution, but I can create a index with static
> information and other with information can be frequently updated. I
> think it is better then update all document, just because some fields
> were updated.
>
> ______________
> Iam Jabour
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--90e6ba6e835212077d0494035ad0--

From java-user-return-47671-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 20:40:49 2010
Return-Path: <java-user-return-47671-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2126 invoked from network); 1 Nov 2010 20:40:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 20:40:48 -0000
Received: (qmail 73512 invoked by uid 500); 1 Nov 2010 20:41:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73435 invoked by uid 500); 1 Nov 2010 20:41:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73427 invoked by uid 99); 1 Nov 2010 20:41:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 20:41:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of turian@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 20:41:12 +0000
Received: by wyg36 with SMTP id 36so6308027wyg.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 13:40:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=aKqAFthUwBcEJ7Go4BmKffmEQ+JjcuKHA4SvL9UYWx8=;
        b=eKLTEdXPLDubikdspF5l2oWZhyXcLe0i17Cnj2AMx1d/T0hciKQoxAftgEHmVCOpFk
         K7pNxcs1ChWkH+HYCk7VUbnZv0Y97JY27iMbLcrXMgrURbR0oRcaehOjoTJDFH8JhEnL
         uY82QUzuJv8/iZqXn1j1VgcIYz3Pl0Z4geuB4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=TYxJJUJ70HgjQ8QECLna++T4bvR6UXKT2Nr9WwucgxFBfhzuiJFdY+BXP7gSigHWtx
         /2PPHd0xfv/+t1C1nf6I1S7/My3XQLpp7eCv+O1wucs5IHfgF22a837/iAthc5tz37cI
         E5Mza5mFol9bHb0ojPbDe/8w1V4qy2o0VupOw=
MIME-Version: 1.0
Received: by 10.227.131.200 with SMTP id y8mr4095966wbs.209.1288644051501;
 Mon, 01 Nov 2010 13:40:51 -0700 (PDT)
Received: by 10.227.29.217 with HTTP; Mon, 1 Nov 2010 13:40:51 -0700 (PDT)
In-Reply-To: <AANLkTi=8UpELKtg+9++UzuEQqCgd=++EDb4jZScVFuAA@mail.gmail.com>
References: <AANLkTi=8UpELKtg+9++UzuEQqCgd=++EDb4jZScVFuAA@mail.gmail.com>
Date: Mon, 1 Nov 2010 16:40:51 -0400
Message-ID: <AANLkTik4PbaVOo+6D4s-xGDYPH=tbRDv5iK75Ya8oUpZ@mail.gmail.com>
Subject: Re: MemoryIndex or RAMDirectory, but score using term statistics from
 a corpus given during preprocessing?
From: Joseph Turian <turian@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6dab323ee82d9049403d29e

--0016e6dab323ee82d9049403d29e
Content-Type: text/plain; charset=ISO-8859-1

Does this question make sense?

What I want is to compute term statistics over a corpus, and then use these
statistics when doing scoring + retrieval using a MemoryIndex or
RAMDirectory.

How can I do that?

Thanks,
    Joseph

On Thu, Oct 28, 2010 at 8:06 PM, Joseph Turian <turian@gmail.com> wrote:

> How do I use MemoryIndex or RAMDirectory, but score using term statistics
> from a corpus given during preprocessing?
>
> Let's say I want to use a MemoryIndex or RAMDirectory to store a *single*
> document, and then run a query against it, and get the score of the query
> using just this one document.
> I know how to do this. See, for some example code, this blog post on
> persistent search:
> http://www.sajalkayan.com/prospective-search-using-python.html
>
> Now what I want to do is take a *corpus* of K documents, and "index" it
> during preprocessing to calculate the term statistics (e.g. idf).
> I then want to freeze these term statistics, and use them whenever I insert
> and compute the query score of a new document.
> I.e. I want to *quickly* query a new document, using preprocessed term
> statistics in the scoring function.
> How can I do this?
>
> Thanks,
>    Joseph
>

--0016e6dab323ee82d9049403d29e--

From java-user-return-47672-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 20:54:11 2010
Return-Path: <java-user-return-47672-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12606 invoked from network); 1 Nov 2010 20:54:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 20:54:11 -0000
Received: (qmail 96891 invoked by uid 500); 1 Nov 2010 20:54:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96853 invoked by uid 500); 1 Nov 2010 20:54:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96845 invoked by uid 99); 1 Nov 2010 20:54:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 20:54:40 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 20:54:32 +0000
Received: by gwj19 with SMTP id 19so263801gwj.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 13:54:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=snY8BWezBjOT0BB2VMX0/5DHtHLwimw/nlbQY9QXJkQ=;
        b=hXL7mmThfLP0ZNMIV6Bzqjy8y5Ut/JAKuJ1/sUDQL88WPHDjZe33OgG6YX9/56wevR
         dfEgqUvYkgZZVlbZh+RuSbRSCloRhEf5hOODGiggnl3D5NHnda7jQbwZlmUNMKnel1Q7
         KnN0WrOGRmTx5wLdtH+mthnLys4RwyCHcUz7U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=cLAYAml/k88SDv2KS40lyp4E9BqiAQ2Bx2MU1exYiNDODEAxhyQiUUg7SuTsHzfjRl
         HAzqzvAI1o9Lu/lZSu/lO4DQP3QUTnX0WvdjhhoiJqfe2TU5QSHKaOP9YcQsvctiDIIR
         pSMV5QBBEy/Iz3HbAzVvjo2AFwR3GqWT6IKqc=
MIME-Version: 1.0
Received: by 10.229.236.8 with SMTP id ki8mr10289349qcb.116.1288644850987;
 Mon, 01 Nov 2010 13:54:10 -0700 (PDT)
Received: by 10.229.229.14 with HTTP; Mon, 1 Nov 2010 13:54:10 -0700 (PDT)
In-Reply-To: <AANLkTikUS2CU5U531SXz2wTg7b=orEww9vJ6180pEJQ4@mail.gmail.com>
References: <AANLkTikUS2CU5U531SXz2wTg7b=orEww9vJ6180pEJQ4@mail.gmail.com>
Date: Mon, 1 Nov 2010 16:54:10 -0400
Message-ID: <AANLkTin=u0H6yHnN6CMKFWed7z-8Hxwq6LbbeLUfjUW3@mail.gmail.com>
Subject: Re: Best way to create a Lucene Index with fields that can be updated
 frequently, and filtering the results by this field.
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64ddcea95b5eb0494040276
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64ddcea95b5eb0494040276
Content-Type: text/plain; charset=ISO-8859-1

How often is "frequently"? How many updates do you expect to do in
a day? And how quickly must those updates be reflected in the search
results?

800K documents isn't all that many. I'd go with the simple approach first
and monitor the results, #then# go to a more complex solution if you
see a problem arising. Just update (delete/add) the documents when
the value changes.

Well, the cost to reindex is just about what the cost to index it orignally
is. The old version of the document is marked deleted and the new one
is added. It's essentially the same cost as to index a new document.
This leaves some gaps in your index, that is the deleted docs are still in
there, but the next optimize will compact them.

>From which you may infer that optimizing is the expensive part. I'd do that,
say
once daily (or even weekly).

HTH
Erick

On Mon, Nov 1, 2010 at 3:25 PM, Iam Jabour <iamjabour@gmail.com> wrote:

> Hi, I use Lucene to index my documents and search. Actually I have
> 800k documents indexed in Lucene. Those documents have some fields:
>
> Id: is a Numeric field to index the documents
>
> Name: is a textual field to be stored and analyzed
>
> Description: like name
>
> Availability: is a numeric field to filter results. This field can be
> updated frequently, every day.
>
> My question is: What's the better way to create a filter for availability?
>
> 1 - add this information to index and make a lucene filter. With this
> approach I have to update document (remove and add, because lucene
> 3.0.2 not have update support) every time the "availability" changes.
> What the cost of reindex?
>
> 2 - don't add this information to index, and filter the results with a
> DB select. This approach will do a lot of selects, because I need
> select every id from database to check availability.
>
> 3 - Create a separated index with id and availability. I don't know if
> it is a good solution, but I can create a index with static
> information and other with information can be frequently updated. I
> think it is better then update all document, just because some fields
> were updated.
>
> ______________
> Iam Jabour
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64ddcea95b5eb0494040276--

From java-user-return-47673-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 21:16:43 2010
Return-Path: <java-user-return-47673-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42527 invoked from network); 1 Nov 2010 21:16:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 21:16:43 -0000
Received: (qmail 48621 invoked by uid 500); 1 Nov 2010 21:17:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48549 invoked by uid 500); 1 Nov 2010 21:17:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48539 invoked by uid 99); 1 Nov 2010 21:17:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 21:17:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of Lisheng.Zhang@broadvision.com designates 139.56.8.26 as permitted sender)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 21:17:06 +0000
X-ASG-Debug-ID: 1288646204-1fbd03760000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id DED84D9221
	for <java-user@lucene.apache.org>; Mon,  1 Nov 2010 14:16:44 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM ([10.10.160.33]) by mail-fw.broadvision.com with ESMTP id Zrj5sQPowBbhrGkd for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 14:16:44 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: How to handle more than Integer.MAX_VALUE documents?
Subject: How to handle more than Integer.MAX_VALUE documents?
Date: Mon, 1 Nov 2010 14:16:44 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB1749@rw-ex2003.BROADVISION.COM>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: How to handle more than Integer.MAX_VALUE documents?
Thread-Index: Act6ChXE2POrGloHQPuNxLHDkHDEqg==
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: UNKNOWN[10.10.160.33]
X-Barracuda-Start-Time: 1288646204
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com


Hi,

Now lucene uses integer as document id, so it means we cannot have more
than 2^31-1 documents within one collection? Even if we use =
MultiSearcher
the document id is still integer so it seems this is still a problem?

We have been using lucene for some time and our document count is =
growing
rather rapidly, maybe this is a much-discussed issue already, but I did =
not
find the lead, any pointer would be really appreciated.

Thanks very much for helps, Lisheng



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47674-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 21:56:11 2010
Return-Path: <java-user-return-47674-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71509 invoked from network); 1 Nov 2010 21:56:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 21:56:11 -0000
Received: (qmail 16672 invoked by uid 500); 1 Nov 2010 21:56:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16517 invoked by uid 500); 1 Nov 2010 21:56:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16509 invoked by uid 99); 1 Nov 2010 21:56:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 21:56:40 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of iamjabour@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 21:56:32 +0000
Received: by ywp4 with SMTP id 4so4130171ywp.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 14:56:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=7J5J1dSJ/MgHjQaPyJ0gjjN/L+8ziDQ//txpC/bQzuk=;
        b=nEWuZJgs9mJ1oj1B6xfKF5sucqVFwHdN6EBRxBmwc3adxMxN99oV/VqNF/ONWZDMV7
         fhFgLSiUe7I5yueYvmW68+iAFfLp0LCQJ7nPBVfhIYNGF/IlVbhFCT9rNHd80UK9PDe+
         LoYwTxCfZEJXm6dhUbathEcvvIlF2OKyj9H0k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=lH/0GZmi9oqZ+JajImeZwKW30gKGXmJolsfby3gMHr75IqbVNVMLwer86HpkEvR0nu
         pSZau/ucI1QqIcDOBI7uo4pds5hrtl6UhT5SFVXUQx8eH7DWRMQro7KRLSfb89iZE+RD
         npb+BTQqefoPSw6MVaiY0YwdWISwiOLobclFk=
MIME-Version: 1.0
Received: by 10.42.147.4 with SMTP id l4mr3424100icv.145.1288648571270; Mon,
 01 Nov 2010 14:56:11 -0700 (PDT)
Received: by 10.42.241.137 with HTTP; Mon, 1 Nov 2010 14:56:11 -0700 (PDT)
In-Reply-To: <AANLkTin=u0H6yHnN6CMKFWed7z-8Hxwq6LbbeLUfjUW3@mail.gmail.com>
References: <AANLkTikUS2CU5U531SXz2wTg7b=orEww9vJ6180pEJQ4@mail.gmail.com>
	<AANLkTin=u0H6yHnN6CMKFWed7z-8Hxwq6LbbeLUfjUW3@mail.gmail.com>
Date: Mon, 1 Nov 2010 19:56:11 -0200
Message-ID: <AANLkTim2grOpXPF5ga-p+rVmG-uvy=-af+OCdZMBYjae@mail.gmail.com>
Subject: Re: Best way to create a Lucene Index with fields that can be updated
 frequently, and filtering the results by this field.
From: Iam Jabour <iamjabour@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks guys!

I can estimate frequently equal to update 20% of 800k weekly. If I
just optimize one time a week  the main cost will be in this
optimization, correctly?

Erick, I will use your approach, and if it don't work wheel I try
option 3, what do you think?

Nilesh,  your approach looks good, but looks complicated too. I will
try a simple approach first.
______________
Iam Jabour




On Mon, Nov 1, 2010 at 6:54 PM, Erick Erickson <erickerickson@gmail.com> wrote:
> How often is "frequently"? How many updates do you expect to do in
> a day? And how quickly must those updates be reflected in the search
> results?
>
> 800K documents isn't all that many. I'd go with the simple approach first
> and monitor the results, #then# go to a more complex solution if you
> see a problem arising. Just update (delete/add) the documents when
> the value changes.
>
> Well, the cost to reindex is just about what the cost to index it orignally
> is. The old version of the document is marked deleted and the new one
> is added. It's essentially the same cost as to index a new document.
> This leaves some gaps in your index, that is the deleted docs are still in
> there, but the next optimize will compact them.
>
> From which you may infer that optimizing is the expensive part. I'd do that,
> say
> once daily (or even weekly).
>
> HTH
> Erick
>
> On Mon, Nov 1, 2010 at 3:25 PM, Iam Jabour <iamjabour@gmail.com> wrote:
>
>> Hi, I use Lucene to index my documents and search. Actually I have
>> 800k documents indexed in Lucene. Those documents have some fields:
>>
>> Id: is a Numeric field to index the documents
>>
>> Name: is a textual field to be stored and analyzed
>>
>> Description: like name
>>
>> Availability: is a numeric field to filter results. This field can be
>> updated frequently, every day.
>>
>> My question is: What's the better way to create a filter for availability?
>>
>> 1 - add this information to index and make a lucene filter. With this
>> approach I have to update document (remove and add, because lucene
>> 3.0.2 not have update support) every time the "availability" changes.
>> What the cost of reindex?
>>
>> 2 - don't add this information to index, and filter the results with a
>> DB select. This approach will do a lot of selects, because I need
>> select every id from database to check availability.
>>
>> 3 - Create a separated index with id and availability. I don't know if
>> it is a good solution, but I can create a index with static
>> information and other with information can be frequently updated. I
>> think it is better then update all document, just because some fields
>> were updated.
>>
>> ______________
>> Iam Jabour
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47675-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 01 22:55:58 2010
Return-Path: <java-user-return-47675-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3547 invoked from network); 1 Nov 2010 22:55:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 1 Nov 2010 22:55:58 -0000
Received: (qmail 16323 invoked by uid 500); 1 Nov 2010 22:56:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16274 invoked by uid 500); 1 Nov 2010 22:56:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16266 invoked by uid 99); 1 Nov 2010 22:56:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 22:56:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 01 Nov 2010 22:56:18 +0000
Received: by ywp4 with SMTP id 4so4170373ywp.35
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 15:55:57 -0700 (PDT)
Received: by 10.151.15.5 with SMTP id s5mr29064572ybi.442.1288652156883;
        Mon, 01 Nov 2010 15:55:56 -0700 (PDT)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id q14sm8238909ybk.19.2010.11.01.15.55.49
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 01 Nov 2010 15:55:56 -0700 (PDT)
From: Mark Kristensson <mark.kristensson@smartsheet.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Subject: IndexWriter.close() performance issue
Date: Mon, 1 Nov 2010 15:55:45 -0700
Message-Id: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1081)
X-Mailer: Apple Mail (2.1081)
X-Virus-Checked: Checked by ClamAV on apache.org

Hello,

One of our  Lucene indexes has started misbehaving on indexWriter.close =
and I'm searching for ideas about what may have happened and how to fix =
it.

Here's our scenario:
- We have seven Lucene indexes that contain different sets of data from =
a web application are indexed for searching by end users
- A java service runs twice a minute to pull changes from SQL DB queue =
tables and update the relevant Lucene index(es)
- The two largest indexes (3.4GB and 3.8GB in size with 8 million and 6 =
million records, respectively) contain similar sets of data, but are =
structured differently for different consumption (e.g. one has an All =
field for general purpose searching, the other does not; one has numeric =
fields for ranges, the other does not, etc.)
- We expunge deletes from our indexes twice per day
- A  couple of weeks ago, one of the two large indexes became very slow =
to close after each round of changes is applied by our indexing service. =
Specifically, all of our indexes usually close in no more than 200 =
milliseconds, but this one index is now taking 6 to 8 seconds to close =
with every single pass (and is leading to delays which are affecting end =
users).=20

Questions from my attempts to troubleshoot the problem:
- Has anyone else seen behavior similar to this? What did you do to =
resolve it?
- Does the size of an index or its documents (record count, disk size, =
avg document size, max document size, etc.) have any correlation to the =
length of time it takes to close an index?
- We are not currently optimizing any of our indexes on a regular basis, =
could that have any impact upon indexing operations (e.g. =
indexWriter.close())? My understanding is that optimization only affects =
search performance, not indexing performance and to date we have not =
seen any need to optimize based upon the performance of the search =
queries.

Thanks,
Mark=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47676-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 00:58:53 2010
Return-Path: <java-user-return-47676-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79933 invoked from network); 2 Nov 2010 00:58:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 00:58:53 -0000
Received: (qmail 21777 invoked by uid 500); 2 Nov 2010 00:59:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21739 invoked by uid 500); 2 Nov 2010 00:59:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21731 invoked by uid 99); 2 Nov 2010 00:59:22 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 00:59:22 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of goksron@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 00:59:17 +0000
Received: by wwb39 with SMTP id 39so4057685wwb.5
        for <java-user@lucene.apache.org>; Mon, 01 Nov 2010 17:58:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=WGdKdoj1BuJJYxfWlULerZ/8DL1tF+pHL7NQY3252FM=;
        b=HIJr+jslfAbFxHGZRQm4dOmNpzgL0YTvLnxA17MPehYQtaHT0Fis3Fs8xxXXafv52f
         EEkhvBvG2aP49ECv+eTBI12dvKUjNbaa4l1fj1uCVACpE2lsSvO5PgedWs8mBhwWakzU
         G/MAr+B2YLl4TTUXvt3x8vCSEYCo6GFjjyztg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=CX2A+UZHk3lpFVlT7BGbQLaPoXngXVIMjOZpsMEGKU1Kh+quXhLnmjWYXcHplEfCHO
         e61gOyAQ1dY1ZQV+nIS3XoqKRodz2Q+dS5ZO3zObeNvoskI6mUPFctxKn2W0hPLO89wy
         zR4wrFT80NKcRMyEF8YjBWP5JDr868Fzaapgc=
MIME-Version: 1.0
Received: by 10.216.231.160 with SMTP id l32mr341937weq.98.1288659535939; Mon,
 01 Nov 2010 17:58:55 -0700 (PDT)
Received: by 10.216.64.203 with HTTP; Mon, 1 Nov 2010 17:58:55 -0700 (PDT)
In-Reply-To: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB1749@rw-ex2003.BROADVISION.COM>
References: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB1749@rw-ex2003.BROADVISION.COM>
Date: Mon, 1 Nov 2010 17:58:55 -0700
Message-ID: <AANLkTi=Cj9Fiy7vp9dTDG56Jh7WSV0dExtGqrCu6+zM2@mail.gmail.com>
Subject: Re: How to handle more than Integer.MAX_VALUE documents?
From: Lance Norskog <goksron@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

2billion is a hard limit. Usually people split indexes into multiple
index long before this, and use the parallel multi reader (I think) to
read from all of the sub-indexes.

On Mon, Nov 1, 2010 at 2:16 PM, Zhang, Lisheng
<Lisheng.Zhang@broadvision.com> wrote:
>
> Hi,
>
> Now lucene uses integer as document id, so it means we cannot have more
> than 2^31-1 documents within one collection? Even if we use MultiSearcher
> the document id is still integer so it seems this is still a problem?
>
> We have been using lucene for some time and our document count is growing
> rather rapidly, maybe this is a much-discussed issue already, but I did not
> find the lead, any pointer would be really appreciated.
>
> Thanks very much for helps, Lisheng
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



-- 
Lance Norskog
goksron@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47677-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 09:20:48 2010
Return-Path: <java-user-return-47677-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84555 invoked from network); 2 Nov 2010 09:20:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 09:20:48 -0000
Received: (qmail 40805 invoked by uid 500); 2 Nov 2010 09:21:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40609 invoked by uid 500); 2 Nov 2010 09:21:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40601 invoked by uid 99); 2 Nov 2010 09:21:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 09:21:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 09:21:07 +0000
Received: by pwj9 with SMTP id 9so1654884pwj.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 02:20:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=c6klyREIM+7zOHnGo97O4SPxPyxztDIoBny/kNtlxzc=;
        b=BCPk2eQeFGDibf5SBFYeU4fkRp/P+LQmrPphuP2c6lb0YI0HFaU8sU9eepQLoj9qej
         6jYTHZF+6/JUzIi8gKkGFxazp2vPn3SnjRINoJtOJ3dpsA09h73YYYZvnRwBaj6aSzBi
         v2Pe0Cs0vNlHrCDDJ1S+r5ofdYS+gIv0mc0kk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=qxLDHwUt+KnFjpF0N6mKW3JBaTUATr8y2j0nJMTxrQW3OtgrE9o9hBXfVK4Csnz9yw
         oRHTNdwtUYpEFKZDjg8JApPkYL6xxw9WRxIto2bD30v93Spl8ALN1wk5iWZ1lbSgons9
         XFs7s4Bwnd8/j8YlbofGaqq9WPXSHRB3s6wko=
MIME-Version: 1.0
Received: by 10.142.211.21 with SMTP id j21mr4454201wfg.123.1288689647750;
 Tue, 02 Nov 2010 02:20:47 -0700 (PDT)
Received: by 10.142.200.1 with HTTP; Tue, 2 Nov 2010 02:20:47 -0700 (PDT)
In-Reply-To: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
Date: Tue, 2 Nov 2010 11:20:47 +0200
Message-ID: <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd2bf1aae11ff04940e7006

--000e0cd2bf1aae11ff04940e7006
Content-Type: text/plain; charset=ISO-8859-1

When you close IndexWriter, it performs several operations that might have a
connection to the problem you describe:

* Commit all the pending updates -- if your update batch size is more or
less the same (i.e., comparable # of docs and total # bytes indexed), then
you should not see a performance difference between closes.

* Consults the MergePolicy and runs any merges it returns as candidates.

* Waits for the merges to finish.

Roughly, IndexWriter.close() can be substituted w/:
writer.commit(false); // commits the changes, but does not run merges.
writer.maybeMerge(); // runs merges returned by MergePolicy.
writer.waitForMerges(); // if you use ConcurrentMergeScheduler, the above
call returns immediately, not waiting for the merges to finish.
writer.close(); // at this point, commit + merging has finished, so it does
very little.

As your index grows in size, so does its # of segments, and the segments
size as well. So tweaking some parameters on the MergePolicy (such as
mergeFactor, maxMergeMB etc.) can result in not attempting to merge too
large segments.

Alternatively, you can try the following:

1) Replace the call to writer.close() w/ the above sequence. Then, measure
each call and report back which of them takes the suspicious amount of time.

2) Not running optimize() on a regular basis doesn't mean merges don't
happen in the background. So if you want close() to return as fast as
possible, you should call close(false). Note though that from time to time
you should allow merges to finish, in order to reduce the # of segments.

3) If you want to control when the merges are run, you can open IndexWriter
with NoMergePolicy, which always returns 0 merges to perform, or
NoMergeScheduler which never executes merges. But be aware that this is
dangerous as the # of segments in the index will continue to grow and search
performance will degrade.

The answers above is relevant for 3x, but most of them are also relevant for
2.9. If you have an older version of Lucene, then some of the solutions
might still apply (such as close(false)).

Hope this helps,
Shai

On Tue, Nov 2, 2010 at 12:55 AM, Mark Kristensson <
mark.kristensson@smartsheet.com> wrote:

> Hello,
>
> One of our  Lucene indexes has started misbehaving on indexWriter.close and
> I'm searching for ideas about what may have happened and how to fix it.
>
> Here's our scenario:
> - We have seven Lucene indexes that contain different sets of data from a
> web application are indexed for searching by end users
> - A java service runs twice a minute to pull changes from SQL DB queue
> tables and update the relevant Lucene index(es)
> - The two largest indexes (3.4GB and 3.8GB in size with 8 million and 6
> million records, respectively) contain similar sets of data, but are
> structured differently for different consumption (e.g. one has an All field
> for general purpose searching, the other does not; one has numeric fields
> for ranges, the other does not, etc.)
> - We expunge deletes from our indexes twice per day
> - A  couple of weeks ago, one of the two large indexes became very slow to
> close after each round of changes is applied by our indexing service.
> Specifically, all of our indexes usually close in no more than 200
> milliseconds, but this one index is now taking 6 to 8 seconds to close with
> every single pass (and is leading to delays which are affecting end users).
>
> Questions from my attempts to troubleshoot the problem:
> - Has anyone else seen behavior similar to this? What did you do to resolve
> it?
> - Does the size of an index or its documents (record count, disk size, avg
> document size, max document size, etc.) have any correlation to the length
> of time it takes to close an index?
> - We are not currently optimizing any of our indexes on a regular basis,
> could that have any impact upon indexing operations (e.g.
> indexWriter.close())? My understanding is that optimization only affects
> search performance, not indexing performance and to date we have not seen
> any need to optimize based upon the performance of the search queries.
>
> Thanks,
> Mark
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd2bf1aae11ff04940e7006--

From java-user-return-47678-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 13:45:55 2010
Return-Path: <java-user-return-47678-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10348 invoked from network); 2 Nov 2010 13:45:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 13:45:55 -0000
Received: (qmail 77807 invoked by uid 500); 2 Nov 2010 13:46:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77487 invoked by uid 500); 2 Nov 2010 13:46:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77479 invoked by uid 99); 2 Nov 2010 13:46:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 13:46:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of findbestopensource@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 13:46:14 +0000
Received: by fxm7 with SMTP id 7so5897180fxm.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 06:45:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Wtey9dhnzb3I9dSeuFUs0E8ig5buCcXrQXrm/FRJ7To=;
        b=olYqVKGF3Ziqk1CXgqtQKk6s0c53QxGaM35V6kvUQ5e5G9rQ3KxHkn9l2XAv71Xk7n
         PQNzxowExiEMlF5fj6E1MOR7b7Z6IHFu3c4/A2zPXWsKIjh8Yj/srNJXcLzsO2iEAtHC
         RSahP0KXMuqo3mKg0tDTPJrd176m33drzdAzc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=V7bQVHq9/r5eOrtTPmDRuWWRf0rOiVn46zmSn1tbT8EdsAJHSmSjCzU+n9WmmlJSIl
         Vxu0RY4kYnKdDpQOI2BGMxjdQ41jgSPeDpRCW7DemjcYkpDrutTsvY0jS5AiPTmF2t52
         59a/55stDjqzRhri3krTIESexlb2DwFlySL1U=
MIME-Version: 1.0
Received: by 10.223.69.141 with SMTP id z13mr7609353fai.72.1288705553581; Tue,
 02 Nov 2010 06:45:53 -0700 (PDT)
Received: by 10.223.75.131 with HTTP; Tue, 2 Nov 2010 06:45:53 -0700 (PDT)
In-Reply-To: <AANLkTinHCq4jO3uPZoUFc4SymjfCxB41w0oX=dWKxsGy@mail.gmail.com>
References: <AANLkTinHCq4jO3uPZoUFc4SymjfCxB41w0oX=dWKxsGy@mail.gmail.com>
Date: Tue, 2 Nov 2010 19:15:53 +0530
Message-ID: <AANLkTikZ-pzGko4UjGmL=pNgUoGRrZ9RcKOyhufKyMz0@mail.gmail.com>
Subject: Re: filtering results per field?
From: findbestopensource <findbestopensource@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf3054acafbdc8d904941224e7
X-Virus-Checked: Checked by ClamAV on apache.org

--20cf3054acafbdc8d904941224e7
Content-Type: text/plain; charset=ISO-8859-1

Hello

Doing single search with multiple filters will give faster results.
Doing search per field (multiple saerch) and combining the results is a bad
idea.

Regards
Aditya
www.findbestopensource.com


On Mon, Nov 1, 2010 at 11:02 PM, Francisco Borges <
francisco.borges@gmail.com> wrote:

> Hello,
>
> I would like to search several fields while applying different Filter's to
> the results of different fields.
>
> Is it possible to (efficiently) filter out results according to which
> fields
> they are coming from? I've been navigating the code and Javadocs, and
> haven't found any way to do it.
>
> One alternative would be to search for each field (or groups of
> fields) separately. Can anyone comment on the performance impact and
> scalability of searching separately per field?
>
> Kind regards,
> --
> Francisco
>

--20cf3054acafbdc8d904941224e7--

From java-user-return-47679-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 14:12:06 2010
Return-Path: <java-user-return-47679-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28574 invoked from network); 2 Nov 2010 14:12:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 14:12:05 -0000
Received: (qmail 24120 invoked by uid 500); 2 Nov 2010 14:12:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23829 invoked by uid 500); 2 Nov 2010 14:12:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23820 invoked by uid 99); 2 Nov 2010 14:12:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:12:30 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FILL_THIS_FORM_SHORT
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [178.63.79.121] (HELO ks309066.kimsufi.com) (178.63.79.121)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:12:24 +0000
Received: from mail.studiorga.de (unknown [178.63.79.121])
	by ks309066.kimsufi.com (Postfix) with ESMTPA id 67C697C0CC
	for <java-user@lucene.apache.org>; Tue,  2 Nov 2010 15:14:40 +0100 (CET)
MIME-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8;
 format=flowed
Content-Transfer-Encoding: 7bit
Date: Tue, 02 Nov 2010 15:14:40 +0100
From: Dirk Reske <dirk@studiorga.de>
To: <java-user@lucene.apache.org>
Subject: Simple search question
Organization: StudiOrga
Message-ID: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
X-Sender: dirk@studiorga.de
User-Agent: Roundcube Webmail/0.4

Hello,

we are quite new to lucene.
At first we want to create a simple user search for our web 
application.
My first thought was to map die 'display name' (= firstname + 
lastname) to a single field (analysed but not stored)
and to put the database id of the user to a stored, not analysed field 
(but indexed).

Then the user should have a simple text box, where he should be able 
to write the whole name, parts of the name etc...
So a search for "jo do" should also return the user "John Doe". How to 
create the query?

My first solution was to tokenize the string using whitespaces an add 
an * to each word and then concatenate all the words and use the query 
parser,
so that the search string would be "jo* do*"...but then I've read, 
that I should not programmaticly construct a string and use the 
queryparser.

So what is the right way?

Greets
Dirk


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47680-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 14:30:09 2010
Return-Path: <java-user-return-47680-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37868 invoked from network); 2 Nov 2010 14:30:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 14:30:09 -0000
Received: (qmail 59730 invoked by uid 500); 2 Nov 2010 14:30:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59463 invoked by uid 500); 2 Nov 2010 14:30:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59450 invoked by uid 99); 2 Nov 2010 14:30:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:30:35 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FILL_THIS_FORM_SHORT,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of findbestopensource@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:30:29 +0000
Received: by fxm7 with SMTP id 7so5941546fxm.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 07:30:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=HO5fpOpswjXiASlohYSn3FSpdBvxKqq1cezl/19GWmU=;
        b=jyKALhvqxpA/FlzDd8jCQM/g+jolnKICwrkeypNKAEpQK1rDtUaEe0NYvhljwUluYq
         y/hqt/jWvqhOb3tV+uIHnZ1he95UkhUJoEcYik/nuzW/UoMKXAhhVWwZY7ul2rUqpLzX
         gZvVKMQDJulsDLCxo0I7E/3NyAfQ2EsbhcwL8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=CY1iBfR12ifK/8nrhgHkGPbbKMMZIhKUisM8CIY96+OG+wN1JOXFil1et57N5BKor+
         4QDYVwugj7ForQwr9gTegkKjis1FmQ31Oum2h/APzsHEf29cOtpWH8cZpzETcMUY+IQO
         IZN2CHlO8JrFSR3tmBfvGhYMIEGB4Uvgmmga0=
MIME-Version: 1.0
Received: by 10.223.96.202 with SMTP id i10mr5550127fan.110.1288708208965;
 Tue, 02 Nov 2010 07:30:08 -0700 (PDT)
Received: by 10.223.75.131 with HTTP; Tue, 2 Nov 2010 07:30:08 -0700 (PDT)
In-Reply-To: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
References: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
Date: Tue, 2 Nov 2010 20:00:08 +0530
Message-ID: <AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
Subject: Re: Simple search question
From: findbestopensource <findbestopensource@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf30433f9e03b7f3049412c3c8
X-Virus-Checked: Checked by ClamAV on apache.org

--20cf30433f9e03b7f3049412c3c8
Content-Type: text/plain; charset=ISO-8859-1

Yes. Correct. It would be good, If User inputs the search string with *.

My Idea is to index two fields separately first name and last name. Provide
two text boxes with first name and last name. Leave the rest to the User.

Regrads
Aditya
www.findbestopensource.com



On Tue, Nov 2, 2010 at 7:44 PM, Dirk Reske <dirk@studiorga.de> wrote:

> Hello,
>
> we are quite new to lucene.
> At first we want to create a simple user search for our web application.
> My first thought was to map die 'display name' (= firstname + lastname) to
> a single field (analysed but not stored)
> and to put the database id of the user to a stored, not analysed field (but
> indexed).
>
> Then the user should have a simple text box, where he should be able to
> write the whole name, parts of the name etc...
> So a search for "jo do" should also return the user "John Doe". How to
> create the query?
>
> My first solution was to tokenize the string using whitespaces an add an *
> to each word and then concatenate all the words and use the query parser,
> so that the search string would be "jo* do*"...but then I've read, that I
> should not programmaticly construct a string and use the queryparser.
>
> So what is the right way?
>
> Greets
> Dirk
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--20cf30433f9e03b7f3049412c3c8--

From java-user-return-47681-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 14:37:17 2010
Return-Path: <java-user-return-47681-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42918 invoked from network); 2 Nov 2010 14:37:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 14:37:17 -0000
Received: (qmail 73132 invoked by uid 500); 2 Nov 2010 14:37:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72821 invoked by uid 500); 2 Nov 2010 14:37:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72813 invoked by uid 99); 2 Nov 2010 14:37:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:37:41 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=SPF_PASS,T_FILL_THIS_FORM_SHORT
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [178.63.79.121] (HELO ks309066.kimsufi.com) (178.63.79.121)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:37:35 +0000
Received: from mail.studiorga.de (unknown [178.63.79.121])
	by ks309066.kimsufi.com (Postfix) with ESMTPA id 2A1FB7C0CC
	for <java-user@lucene.apache.org>; Tue,  2 Nov 2010 15:39:52 +0100 (CET)
MIME-Version: 1.0
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit
Date: Tue, 02 Nov 2010 15:39:52 +0100
From: Dirk Reske <dirk@studiorga.de>
To: <java-user@lucene.apache.org>
Subject: Re: Simple search question
Organization: StudiOrga
In-Reply-To: <AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
References: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
 <AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
Message-ID: <80bd9fecd3bae9f2da359e71cbdec236@localhost>
X-Sender: dirk@studiorga.de
User-Agent: Roundcube Webmail/0.4
X-Virus-Checked: Checked by ClamAV on apache.org

No, we don't want to user to write the * itself.
And seperate fields for the first and the last name are also not
acceptable.

Image all the social networks, where you type a part of a name into the
textbox, and get all people whose names (first or last) contains one of
your searched words. The user should not be thinking about...just doing
it.

Dirk

On Tue, 2 Nov 2010 20:00:08 +0530, findbestopensource
<findbestopensource@gmail.com> wrote:
> Yes. Correct. It would be good, If User inputs the search string with *.
> 
> My Idea is to index two fields separately first name and last name. Provide
> two text boxes with first name and last name. Leave the rest to the User.
> 
> Regrads
> Aditya
> www.findbestopensource.com
> 
> 
> 
> On Tue, Nov 2, 2010 at 7:44 PM, Dirk Reske <dirk@studiorga.de> wrote:
> 
>> Hello,
>>
>> we are quite new to lucene.
>> At first we want to create a simple user search for our web application.
>> My first thought was to map die 'display name' (= firstname + lastname) to
>> a single field (analysed but not stored)
>> and to put the database id of the user to a stored, not analysed field (but
>> indexed).
>>
>> Then the user should have a simple text box, where he should be able to
>> write the whole name, parts of the name etc...
>> So a search for "jo do" should also return the user "John Doe". How to
>> create the query?
>>
>> My first solution was to tokenize the string using whitespaces an add an *
>> to each word and then concatenate all the words and use the query parser,
>> so that the search string would be "jo* do*"...but then I've read, that I
>> should not programmaticly construct a string and use the queryparser.
>>
>> So what is the right way?
>>
>> Greets
>> Dirk
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>

-- 
Dirk Reske
Vogelsangstr. 24
18437 Stralsund

mail: dirk@studiorga.de
mobile: +(49) 1522 2104741

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47682-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 14:46:34 2010
Return-Path: <java-user-return-47682-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48989 invoked from network); 2 Nov 2010 14:46:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 14:46:34 -0000
Received: (qmail 95871 invoked by uid 500); 2 Nov 2010 14:47:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95461 invoked by uid 500); 2 Nov 2010 14:47:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95453 invoked by uid 99); 2 Nov 2010 14:46:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:46:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FILL_THIS_FORM_SHORT,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of findbestopensource@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:46:53 +0000
Received: by ywp4 with SMTP id 4so4696125ywp.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 07:46:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=IP5uzv07JtcibMw0IZeGBHZlh8I6dd9i1TvOSSPK2/U=;
        b=ARAaROguyKsDB+MptpIjJ5jI2W7V65PbMaEUrrL0FZFg2RSE7zf5TYZWdw+HpnEfdp
         hKpRoRCY51vr+Zc/k1gTsCTRDuC3mv4PaudAughrlqCJsBncSS8RZhpL1HfqJHY0vXgZ
         JcBXox5+lEm04jGhrqOk504wzSieY7FaLTXng=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=aJgw7MUzPedQLfHmPBEhWM4Z/FPeRz0Kb4UBPpqvZ2gYLAthNOzpUJaT1XMheD0kHG
         p3yCMjxEYHMUAEOjCRaG7FmGB9FUZcxU7BmIEgSGJ8K+n2U8YqNDoB4Yy8zyap+pEWIl
         2sMwlqRbQynxj32l7p95in2JK3CBq/gCGWpi0=
MIME-Version: 1.0
Received: by 10.204.113.195 with SMTP id b3mr13422774bkq.210.1288709190043;
 Tue, 02 Nov 2010 07:46:30 -0700 (PDT)
Received: by 10.223.75.131 with HTTP; Tue, 2 Nov 2010 07:46:29 -0700 (PDT)
In-Reply-To: <80bd9fecd3bae9f2da359e71cbdec236@localhost>
References: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
	<AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
	<80bd9fecd3bae9f2da359e71cbdec236@localhost>
Date: Tue, 2 Nov 2010 20:16:29 +0530
Message-ID: <AANLkTikkBHFN-gGxoWBmafvc+RxczDsxN0JRuimD-LgM@mail.gmail.com>
Subject: Re: Simple search question
From: findbestopensource <findbestopensource@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163669754d7dc95c049412fd23
X-Virus-Checked: Checked by ClamAV on apache.org

--00163669754d7dc95c049412fd23
Content-Type: text/plain; charset=ISO-8859-1

In this case also, You may need to index the fields separately. This will
give better control. Have a parser, which splits the terms and applies * to
the end. Search using the terms.

Regards
Aditya
www.findbestopensource.com


On Tue, Nov 2, 2010 at 8:09 PM, Dirk Reske <dirk@studiorga.de> wrote:

> No, we don't want to user to write the * itself.
> And seperate fields for the first and the last name are also not
> acceptable.
>
> Image all the social networks, where you type a part of a name into the
> textbox, and get all people whose names (first or last) contains one of
> your searched words. The user should not be thinking about...just doing
> it.
>
> Dirk
>
> On Tue, 2 Nov 2010 20:00:08 +0530, findbestopensource
> <findbestopensource@gmail.com> wrote:
> > Yes. Correct. It would be good, If User inputs the search string with *.
> >
> > My Idea is to index two fields separately first name and last name.
> Provide
> > two text boxes with first name and last name. Leave the rest to the User.
> >
> > Regrads
> > Aditya
> > www.findbestopensource.com
> >
> >
> >
> > On Tue, Nov 2, 2010 at 7:44 PM, Dirk Reske <dirk@studiorga.de> wrote:
> >
> >> Hello,
> >>
> >> we are quite new to lucene.
> >> At first we want to create a simple user search for our web application.
> >> My first thought was to map die 'display name' (= firstname + lastname)
> to
> >> a single field (analysed but not stored)
> >> and to put the database id of the user to a stored, not analysed field
> (but
> >> indexed).
> >>
> >> Then the user should have a simple text box, where he should be able to
> >> write the whole name, parts of the name etc...
> >> So a search for "jo do" should also return the user "John Doe". How to
> >> create the query?
> >>
> >> My first solution was to tokenize the string using whitespaces an add an
> *
> >> to each word and then concatenate all the words and use the query
> parser,
> >> so that the search string would be "jo* do*"...but then I've read, that
> I
> >> should not programmaticly construct a string and use the queryparser.
> >>
> >> So what is the right way?
> >>
> >> Greets
> >> Dirk
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
>
> --
> Dirk Reske
> Vogelsangstr. 24
> 18437 Stralsund
>
> mail: dirk@studiorga.de
> mobile: +(49) 1522 2104741
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00163669754d7dc95c049412fd23--

From java-user-return-47683-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 14:53:57 2010
Return-Path: <java-user-return-47683-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52854 invoked from network); 2 Nov 2010 14:53:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 14:53:56 -0000
Received: (qmail 16619 invoked by uid 500); 2 Nov 2010 14:54:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16274 invoked by uid 500); 2 Nov 2010 14:54:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16266 invoked by uid 99); 2 Nov 2010 14:54:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:54:25 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FILL_THIS_FORM_SHORT,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 14:54:21 +0000
Received: by bwz19 with SMTP id 19so6335334bwz.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 07:53:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=tjqjCWG5LA/7pBl0lfS6pdyM9zP/GylVBxZimZ/Blew=;
        b=aL51h6dZOECGwtk4zEzVbAjdTCyEI6DARZsGepV+DDh6fYvzo3JUcM/GbTFJGuhuQF
         0wF6DL153r1AV/QjCP8bEkOiRI+uWIntdVrfpy1iPRXHNeM3VU5Lu/tC3GEKdXhnOZd0
         By94XQ5O02LzClxRw48YmG4O7XlYkxa+jXHVg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=PNWi+iiSASxxpuOrumq5m3zmLh01vglVCcIWsI2Guuo1ALNKDYzLnPaq46i/eEwy9h
         wKUc1+XKW+CBIrFwwd3GCKgH8AmLUDaBrE59E5kvrAX3pW0lfgxOVh7bogAW1gI1CZiW
         q97C55gClkdN1411f+kXg0E8gLqU4CmWGvHMQ=
Received: by 10.204.76.130 with SMTP id c2mr13045565bkk.26.1288709639491; Tue,
 02 Nov 2010 07:53:59 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.121.145 with HTTP; Tue, 2 Nov 2010 07:53:39 -0700 (PDT)
In-Reply-To: <80bd9fecd3bae9f2da359e71cbdec236@localhost>
References: <e885896ab95c10bfa8d9e732cf86bdfd@localhost> <AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
 <80bd9fecd3bae9f2da359e71cbdec236@localhost>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 2 Nov 2010 14:53:39 +0000
Message-ID: <AANLkTi=E4af3mjx167Wc4Us1ShUsoewrx921cRyEM8EN@mail.gmail.com>
Subject: Re: Simple search question
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Tokenizing and then passing through the query parser sounds reasonable
to me.  You could build the query yourself, but that will be a bit
more work.  You could also combine a non-wildcard search with a
wildcard search, boosting the first one.  So that "John Doe" would
score higher than "Johnny Doncaster".


--
Ian.


On Tue, Nov 2, 2010 at 2:39 PM, Dirk Reske <dirk@studiorga.de> wrote:
> No, we don't want to user to write the * itself.
> And seperate fields for the first and the last name are also not
> acceptable.
>
> Image all the social networks, where you type a part of a name into the
> textbox, and get all people whose names (first or last) contains one of
> your searched words. The user should not be thinking about...just doing
> it.
>
> Dirk
>
> On Tue, 2 Nov 2010 20:00:08 +0530, findbestopensource
> <findbestopensource@gmail.com> wrote:
>> Yes. Correct. It would be good, If User inputs the search string with *.
>>
>> My Idea is to index two fields separately first name and last name. Provide
>> two text boxes with first name and last name. Leave the rest to the User.
>>
>> Regrads
>> Aditya
>> www.findbestopensource.com
>>
>>
>>
>> On Tue, Nov 2, 2010 at 7:44 PM, Dirk Reske <dirk@studiorga.de> wrote:
>>
>>> Hello,
>>>
>>> we are quite new to lucene.
>>> At first we want to create a simple user search for our web application.
>>> My first thought was to map die 'display name' (= firstname + lastname) to
>>> a single field (analysed but not stored)
>>> and to put the database id of the user to a stored, not analysed field (but
>>> indexed).
>>>
>>> Then the user should have a simple text box, where he should be able to
>>> write the whole name, parts of the name etc...
>>> So a search for "jo do" should also return the user "John Doe". How to
>>> create the query?
>>>
>>> My first solution was to tokenize the string using whitespaces an add an *
>>> to each word and then concatenate all the words and use the query parser,
>>> so that the search string would be "jo* do*"...but then I've read, that I
>>> should not programmaticly construct a string and use the queryparser.
>>>
>>> So what is the right way?
>>>
>>> Greets
>>> Dirk
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>
> --
> Dirk Reske
> Vogelsangstr. 24
> 18437 Stralsund
>
> mail: dirk@studiorga.de
> mobile: +(49) 1522 2104741
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47684-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 15:06:14 2010
Return-Path: <java-user-return-47684-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68451 invoked from network); 2 Nov 2010 15:06:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 15:06:14 -0000
Received: (qmail 43984 invoked by uid 500); 2 Nov 2010 15:06:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43852 invoked by uid 500); 2 Nov 2010 15:06:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43844 invoked by uid 99); 2 Nov 2010 15:06:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 15:06:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_FILL_THIS_FORM_SHORT,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 15:06:36 +0000
Received: by pwj9 with SMTP id 9so1750650pwj.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 08:06:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Hj3wfx45D+ckYkciNc3ytpYMSdarWjTvHi+CRE9ic30=;
        b=CLS5fB4x2Kv6GYAB9fE0V3B177xy5C1Dh9+2ewIHIuDcd4xgnFfS2eHTX+6UxdrmYS
         LmanJEA1c85l4fIdiRKIV0R4ZxAT93Cf0yno2UVIlwkSUWDpaFXgepFIM90IGT1fo/nE
         kuLGr7jyigwDDfcU+exfoW/HZg2dKaxTR0QMc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=IjAiit7v8FvzD/bfOADwbeCqEbEDAp93wjZWQrfyITw98+k16c1dSWyAEtoxxE3tsC
         mTEc/34Ied0lVMHHZEjfZhO4c20wqACN3zZSgexIC8L3WzFGs01g5NRRr6x0kq55ELho
         1+YMi7n+XtPlWZBfKqC562bc93+npaSPahxfM=
MIME-Version: 1.0
Received: by 10.229.236.14 with SMTP id ki14mr728940qcb.78.1288710373961; Tue,
 02 Nov 2010 08:06:13 -0700 (PDT)
Received: by 10.229.229.14 with HTTP; Tue, 2 Nov 2010 08:06:13 -0700 (PDT)
In-Reply-To: <80bd9fecd3bae9f2da359e71cbdec236@localhost>
References: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
	<AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
	<80bd9fecd3bae9f2da359e71cbdec236@localhost>
Date: Tue, 2 Nov 2010 11:06:13 -0400
Message-ID: <AANLkTi=aMi7xs+CpP3n9v=47pvUjDx9nGq6hFrmpbBXs@mail.gmail.com>
Subject: Re: Simple search question
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f726200ef1e30494134452
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f726200ef1e30494134452
Content-Type: text/plain; charset=ISO-8859-1

You might take a look at Ngrams. These can be used to find partial
matches without resorting to wildcards, although they may add to
your index size...

Best
Erick

On Tue, Nov 2, 2010 at 10:39 AM, Dirk Reske <dirk@studiorga.de> wrote:

> No, we don't want to user to write the * itself.
> And seperate fields for the first and the last name are also not
> acceptable.
>
> Image all the social networks, where you type a part of a name into the
> textbox, and get all people whose names (first or last) contains one of
> your searched words. The user should not be thinking about...just doing
> it.
>
> Dirk
>
> On Tue, 2 Nov 2010 20:00:08 +0530, findbestopensource
> <findbestopensource@gmail.com> wrote:
> > Yes. Correct. It would be good, If User inputs the search string with *.
> >
> > My Idea is to index two fields separately first name and last name.
> Provide
> > two text boxes with first name and last name. Leave the rest to the User.
> >
> > Regrads
> > Aditya
> > www.findbestopensource.com
> >
> >
> >
> > On Tue, Nov 2, 2010 at 7:44 PM, Dirk Reske <dirk@studiorga.de> wrote:
> >
> >> Hello,
> >>
> >> we are quite new to lucene.
> >> At first we want to create a simple user search for our web application.
> >> My first thought was to map die 'display name' (= firstname + lastname)
> to
> >> a single field (analysed but not stored)
> >> and to put the database id of the user to a stored, not analysed field
> (but
> >> indexed).
> >>
> >> Then the user should have a simple text box, where he should be able to
> >> write the whole name, parts of the name etc...
> >> So a search for "jo do" should also return the user "John Doe". How to
> >> create the query?
> >>
> >> My first solution was to tokenize the string using whitespaces an add an
> *
> >> to each word and then concatenate all the words and use the query
> parser,
> >> so that the search string would be "jo* do*"...but then I've read, that
> I
> >> should not programmaticly construct a string and use the queryparser.
> >>
> >> So what is the right way?
> >>
> >> Greets
> >> Dirk
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
>
> --
> Dirk Reske
> Vogelsangstr. 24
> 18437 Stralsund
>
> mail: dirk@studiorga.de
> mobile: +(49) 1522 2104741
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f726200ef1e30494134452--

From java-user-return-47685-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 15:10:23 2010
Return-Path: <java-user-return-47685-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69704 invoked from network); 2 Nov 2010 15:10:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 15:10:23 -0000
Received: (qmail 53160 invoked by uid 500); 2 Nov 2010 15:10:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52828 invoked by uid 500); 2 Nov 2010 15:10:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52820 invoked by uid 99); 2 Nov 2010 15:10:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 15:10:48 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [66.39.3.83] (HELO www5.webmail.pair.com) (66.39.3.83)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 02 Nov 2010 15:10:42 +0000
Received: (qmail 39563 invoked by uid 65534); 2 Nov 2010 15:10:20 -0000
Received: from 160.147.158.33 ([160.147.158.33])
        (SquirrelMail authenticated user darren@ontrenet.com)
        by sm.webmail.pair.com with HTTP;
        Tue, 2 Nov 2010 11:10:20 -0400
Message-ID: <fccbc5c7723b362ccc22791bf6f39aab.squirrel@sm.webmail.pair.com>
In-Reply-To: <AANLkTi=aMi7xs+CpP3n9v=47pvUjDx9nGq6hFrmpbBXs@mail.gmail.com>
References: <e885896ab95c10bfa8d9e732cf86bdfd@localhost>
    <AANLkTik31nKP05g637hbMQU=haLj4vt_73z7gZPWWL1B@mail.gmail.com>
    <80bd9fecd3bae9f2da359e71cbdec236@localhost>
    <AANLkTi=aMi7xs+CpP3n9v=47pvUjDx9nGq6hFrmpbBXs@mail.gmail.com>
Date: Tue, 2 Nov 2010 11:10:20 -0400
Subject: Re: Simple search question
From: darren@ontrenet.com
To: java-user@lucene.apache.org
User-Agent: SquirrelMail/1.4.20
MIME-Version: 1.0
Content-Type: text/plain;charset=iso-8859-1
Content-Transfer-Encoding: 8bit
X-Priority: 3 (Normal)
Importance: Normal
X-Virus-Checked: Checked by ClamAV on apache.org

Couldn't one write a custom filter that modified the inbound term
semantics before doing the search? Then, wildcard behavior can be added to
terms without doing query string splicing.

> You might take a look at Ngrams. These can be used to find partial
> matches without resorting to wildcards, although they may add to
> your index size...
>
> Best
> Erick
>
> On Tue, Nov 2, 2010 at 10:39 AM, Dirk Reske <dirk@studiorga.de> wrote:
>
>> No, we don't want to user to write the * itself.
>> And seperate fields for the first and the last name are also not
>> acceptable.
>>
>> Image all the social networks, where you type a part of a name into the
>> textbox, and get all people whose names (first or last) contains one of
>> your searched words. The user should not be thinking about...just doing
>> it.
>>
>> Dirk
>>
>> On Tue, 2 Nov 2010 20:00:08 +0530, findbestopensource
>> <findbestopensource@gmail.com> wrote:
>> > Yes. Correct. It would be good, If User inputs the search string with
>> *.
>> >
>> > My Idea is to index two fields separately first name and last name.
>> Provide
>> > two text boxes with first name and last name. Leave the rest to the
>> User.
>> >
>> > Regrads
>> > Aditya
>> > www.findbestopensource.com
>> >
>> >
>> >
>> > On Tue, Nov 2, 2010 at 7:44 PM, Dirk Reske <dirk@studiorga.de> wrote:
>> >
>> >> Hello,
>> >>
>> >> we are quite new to lucene.
>> >> At first we want to create a simple user search for our web
>> application.
>> >> My first thought was to map die 'display name' (= firstname +
>> lastname)
>> to
>> >> a single field (analysed but not stored)
>> >> and to put the database id of the user to a stored, not analysed
>> field
>> (but
>> >> indexed).
>> >>
>> >> Then the user should have a simple text box, where he should be able
>> to
>> >> write the whole name, parts of the name etc...
>> >> So a search for "jo do" should also return the user "John Doe". How
>> to
>> >> create the query?
>> >>
>> >> My first solution was to tokenize the string using whitespaces an add
>> an
>> *
>> >> to each word and then concatenate all the words and use the query
>> parser,
>> >> so that the search string would be "jo* do*"...but then I've read,
>> that
>> I
>> >> should not programmaticly construct a string and use the queryparser.
>> >>
>> >> So what is the right way?
>> >>
>> >> Greets
>> >> Dirk
>> >>
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>>
>> --
>> Dirk Reske
>> Vogelsangstr. 24
>> 18437 Stralsund
>>
>> mail: dirk@studiorga.de
>> mobile: +(49) 1522 2104741
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47686-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 16:26:48 2010
Return-Path: <java-user-return-47686-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6014 invoked from network); 2 Nov 2010 16:26:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 16:26:48 -0000
Received: (qmail 51688 invoked by uid 500); 2 Nov 2010 16:27:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51599 invoked by uid 500); 2 Nov 2010 16:27:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51591 invoked by uid 99); 2 Nov 2010 16:27:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 16:27:16 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 16:27:10 +0000
Received: by iwn7 with SMTP id 7so9195834iwn.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 09:26:49 -0700 (PDT)
Received: by 10.231.59.197 with SMTP id m5mr10314013ibh.94.1288715209337;
        Tue, 02 Nov 2010 09:26:49 -0700 (PDT)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id x21sm6364168yhc.35.2010.11.02.09.26.43
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 02 Nov 2010 09:26:45 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1081)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
Date: Tue, 2 Nov 2010 09:26:39 -0700
Content-Transfer-Encoding: quoted-printable
Message-Id: <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1081)


Wonderful information on what happens during indexWriter.close(), thank =
you very much! I've got some testing to do as a result.

We are on Lucene 3.0.0 right now.

One other detail that I neglected to mention is that the batch size does =
not seem to have any relation to the time it takes to close on the index =
where we are having issues. We've had batches add as few as 3 documents =
and batches add as many as 2500 documents in the last hour and every =
single close() call for that index takes 6 to 8 seconds. While I won't =
know until I am able to individually test the different pieces of the =
close() operation, I'd be very surprised if a batch that adds just 3 new =
documents results in very much merge work being done. It seems as if =
there is some task happening during merge that the indexWriter is never =
able to successfully complete and so it tries to complete that task =
every single time close() is called. =20

So, my working theory until I can dig deeper is that something is mildly =
corrupt with the index (though not serious enough to affect most =
operations on the index). Are there any good utilities for examining the =
health of an index?=20

I've dabbled with the experimental checkIndex object in the past (before =
we upgraded to 3.0), but have found it to be incredibly slow and of =
marginal value. Does anyone have any experience using CheckIndex to =
track down an issue with a production index?

Thanks again!
Mark

On Nov 2, 2010, at 2:20 AM, Shai Erera wrote:

> When you close IndexWriter, it performs several operations that might =
have a
> connection to the problem you describe:
>=20
> * Commit all the pending updates -- if your update batch size is more =
or
> less the same (i.e., comparable # of docs and total # bytes indexed), =
then
> you should not see a performance difference between closes.
>=20
> * Consults the MergePolicy and runs any merges it returns as =
candidates.
>=20
> * Waits for the merges to finish.
>=20
> Roughly, IndexWriter.close() can be substituted w/:
> writer.commit(false); // commits the changes, but does not run merges.
> writer.maybeMerge(); // runs merges returned by MergePolicy.
> writer.waitForMerges(); // if you use ConcurrentMergeScheduler, the =
above
> call returns immediately, not waiting for the merges to finish.
> writer.close(); // at this point, commit + merging has finished, so it =
does
> very little.
>=20
> As your index grows in size, so does its # of segments, and the =
segments
> size as well. So tweaking some parameters on the MergePolicy (such as
> mergeFactor, maxMergeMB etc.) can result in not attempting to merge =
too
> large segments.
>=20
> Alternatively, you can try the following:
>=20
> 1) Replace the call to writer.close() w/ the above sequence. Then, =
measure
> each call and report back which of them takes the suspicious amount of =
time.
>=20
> 2) Not running optimize() on a regular basis doesn't mean merges don't
> happen in the background. So if you want close() to return as fast as
> possible, you should call close(false). Note though that from time to =
time
> you should allow merges to finish, in order to reduce the # of =
segments.
>=20
> 3) If you want to control when the merges are run, you can open =
IndexWriter
> with NoMergePolicy, which always returns 0 merges to perform, or
> NoMergeScheduler which never executes merges. But be aware that this =
is
> dangerous as the # of segments in the index will continue to grow and =
search
> performance will degrade.
>=20
> The answers above is relevant for 3x, but most of them are also =
relevant for
> 2.9. If you have an older version of Lucene, then some of the =
solutions
> might still apply (such as close(false)).
>=20
> Hope this helps,
> Shai
>=20
> On Tue, Nov 2, 2010 at 12:55 AM, Mark Kristensson <
> mark.kristensson@smartsheet.com> wrote:
>=20
>> Hello,
>>=20
>> One of our  Lucene indexes has started misbehaving on =
indexWriter.close and
>> I'm searching for ideas about what may have happened and how to fix =
it.
>>=20
>> Here's our scenario:
>> - We have seven Lucene indexes that contain different sets of data =
from a
>> web application are indexed for searching by end users
>> - A java service runs twice a minute to pull changes from SQL DB =
queue
>> tables and update the relevant Lucene index(es)
>> - The two largest indexes (3.4GB and 3.8GB in size with 8 million and =
6
>> million records, respectively) contain similar sets of data, but are
>> structured differently for different consumption (e.g. one has an All =
field
>> for general purpose searching, the other does not; one has numeric =
fields
>> for ranges, the other does not, etc.)
>> - We expunge deletes from our indexes twice per day
>> - A  couple of weeks ago, one of the two large indexes became very =
slow to
>> close after each round of changes is applied by our indexing service.
>> Specifically, all of our indexes usually close in no more than 200
>> milliseconds, but this one index is now taking 6 to 8 seconds to =
close with
>> every single pass (and is leading to delays which are affecting end =
users).
>>=20
>> Questions from my attempts to troubleshoot the problem:
>> - Has anyone else seen behavior similar to this? What did you do to =
resolve
>> it?
>> - Does the size of an index or its documents (record count, disk =
size, avg
>> document size, max document size, etc.) have any correlation to the =
length
>> of time it takes to close an index?
>> - We are not currently optimizing any of our indexes on a regular =
basis,
>> could that have any impact upon indexing operations (e.g.
>> indexWriter.close())? My understanding is that optimization only =
affects
>> search performance, not indexing performance and to date we have not =
seen
>> any need to optimize based upon the performance of the search =
queries.
>>=20
>> Thanks,
>> Mark
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>=20
>>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47687-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 02 19:03:16 2010
Return-Path: <java-user-return-47687-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 623 invoked from network); 2 Nov 2010 19:03:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 2 Nov 2010 19:03:15 -0000
Received: (qmail 57911 invoked by uid 500); 2 Nov 2010 19:03:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57869 invoked by uid 500); 2 Nov 2010 19:03:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57861 invoked by uid 99); 2 Nov 2010 19:03:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 19:03:44 +0000
X-ASF-Spam-Status: No, hits=2.8 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLYTO,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 02 Nov 2010 19:03:38 +0000
Received: by vws5 with SMTP id 5so29938vws.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 12:03:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:content-type;
        bh=eqbAusWfEMecaU3PRLGlA73dEcD4DUZNS6o8VmjLVAM=;
        b=WenMCuNEGGR1P4Y7FI8lncllUPl5k3Z/u8nx7/+2ThNpfHnb6y5fW44AtpXX8nlRBo
         +kECKfIIvMNBwGrfpJBh0+eqUM/7EI8y2RyDeRlBfZ0eaSTOxogn7iEDYwyHT4aZMxG2
         fdPmAsF0D2iNMGGQ7TkIK4+P+sLAGsPt5CIyg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=fuTJicX6v+/dDskq5LSjcVuPyWt+0J0BeisJMmYi9FUoCroK1EeTF9ycC17yomXj5a
         TyIfxn4klHRbPIICk8tFM/CGYc5d8sw0zkZ6epzqSDcg1yM2i24gbDqt48r2FX0wtruW
         PSX2pWtCae9NFzoVbCYxHIao3YFbC/dCmwrbo=
MIME-Version: 1.0
Received: by 10.224.197.5 with SMTP id ei5mr10438213qab.283.1288724597552;
 Tue, 02 Nov 2010 12:03:17 -0700 (PDT)
Received: by 10.229.70.135 with HTTP; Tue, 2 Nov 2010 12:03:17 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <AANLkTi=Cj9Fiy7vp9dTDG56Jh7WSV0dExtGqrCu6+zM2@mail.gmail.com>
References: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB1749@rw-ex2003.BROADVISION.COM>
	<AANLkTi=Cj9Fiy7vp9dTDG56Jh7WSV0dExtGqrCu6+zM2@mail.gmail.com>
Date: Tue, 2 Nov 2010 20:03:17 +0100
Message-ID: <AANLkTi=UksyZKYGb6h9Yz7RaDQZCLOrnSM7TfwJPcC15@mail.gmail.com>
Subject: Re: How to handle more than Integer.MAX_VALUE documents?
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

On Tue, Nov 2, 2010 at 1:58 AM, Lance Norskog <goksron@gmail.com> wrote:
> 2billion is a hard limit. Usually people split indexes into multiple
> index long before this, and use the parallel multi reader (I think) to
> read from all of the sub-indexes.
>
> On Mon, Nov 1, 2010 at 2:16 PM, Zhang, Lisheng
> <Lisheng.Zhang@broadvision.com> wrote:
>>
>> Hi,
>>
>> Now lucene uses integer as document id, so it means we cannot have more
>> than 2^31-1 documents within one collection? Even if we use MultiSearcher
>> the document id is still integer so it seems this is still a problem?

This is really the limit of a segment, I think you can write you own
collector and collect documents which higher (absolute) doc ids than
INT_MAX. Yet, I think if you reach the limit of INT_MAX documents you
should really rethink the way your search works and apply some
sharding techniques. I really haven't been up to that many docs in a
single index but I think it should work to have multiple segments with
INT_MAX documents in it since we search on segment level provided if
you collector supports it.

simon
>>
>> We have been using lucene for some time and our document count is growing
>> rather rapidly, maybe this is a much-discussed issue already, but I did not
>> find the lead, any pointer would be really appreciated.
>>
>> Thanks very much for helps, Lisheng
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
> --
> Lance Norskog
> goksron@gmail.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47688-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 02:00:19 2010
Return-Path: <java-user-return-47688-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8631 invoked from network); 3 Nov 2010 02:00:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 02:00:18 -0000
Received: (qmail 24761 invoked by uid 500); 3 Nov 2010 02:00:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 24682 invoked by uid 500); 3 Nov 2010 02:00:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 24672 invoked by uid 99); 3 Nov 2010 02:00:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 02:00:47 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of goksron@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 02:00:41 +0000
Received: by wyg36 with SMTP id 36so128716wyg.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 19:00:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=O404NtdNW307/Y5WEsaoZqD8D6uWzKzrVSh4IJ8aS/0=;
        b=IRMbedmbs0nPaV0TpJQyOieKRyt66y3cTU22tqIIhO5chjFGtUeKqEDhvXKFU1Hp3Z
         fOJKecSnfpgMDwWjUGW4RjMQpzT20IARISXfPNrS0lwn1n/Jn04X16euDu2jykVPMClC
         fdKAar3jdWd8/6ZLEGBdPtHEJ5nauYNTaY6y8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=kdKP4EfgobRWimkmBgS7byy5G8YunMUN+VMcds+vgEcOWwcHblehpxN1Cod/DhsssJ
         HnMdtaE/68LYxFEFDmIqONjkZozBQ53dD6rEXOvNQf4kx8XivX1gLcrfUMEIdSgHHnwi
         d6TrxFea3g90nijRiLeIj9D6Sq22tUtutVvPU=
MIME-Version: 1.0
Received: by 10.216.65.196 with SMTP id f46mr5804161wed.113.1288749620610;
 Tue, 02 Nov 2010 19:00:20 -0700 (PDT)
Received: by 10.216.64.203 with HTTP; Tue, 2 Nov 2010 19:00:20 -0700 (PDT)
In-Reply-To: <AANLkTi=UksyZKYGb6h9Yz7RaDQZCLOrnSM7TfwJPcC15@mail.gmail.com>
References: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB1749@rw-ex2003.BROADVISION.COM>
	<AANLkTi=Cj9Fiy7vp9dTDG56Jh7WSV0dExtGqrCu6+zM2@mail.gmail.com>
	<AANLkTi=UksyZKYGb6h9Yz7RaDQZCLOrnSM7TfwJPcC15@mail.gmail.com>
Date: Tue, 2 Nov 2010 19:00:20 -0700
Message-ID: <AANLkTin97QiAiq6sNZvwBq87LCyf12haP0zvnFCNh8FA@mail.gmail.com>
Subject: Re: How to handle more than Integer.MAX_VALUE documents?
From: Lance Norskog <goksron@gmail.com>
To: java-user@lucene.apache.org, simon.willnauer@gmail.com
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

You would have to control your MergePolicy so it doesn't collapse
everything back to one segment.

On Tue, Nov 2, 2010 at 12:03 PM, Simon Willnauer
<simon.willnauer@googlemail.com> wrote:
> On Tue, Nov 2, 2010 at 1:58 AM, Lance Norskog <goksron@gmail.com> wrote:
>> 2billion is a hard limit. Usually people split indexes into multiple
>> index long before this, and use the parallel multi reader (I think) to
>> read from all of the sub-indexes.
>>
>> On Mon, Nov 1, 2010 at 2:16 PM, Zhang, Lisheng
>> <Lisheng.Zhang@broadvision.com> wrote:
>>>
>>> Hi,
>>>
>>> Now lucene uses integer as document id, so it means we cannot have more
>>> than 2^31-1 documents within one collection? Even if we use MultiSearcher
>>> the document id is still integer so it seems this is still a problem?
>
> This is really the limit of a segment, I think you can write you own
> collector and collect documents which higher (absolute) doc ids than
> INT_MAX. Yet, I think if you reach the limit of INT_MAX documents you
> should really rethink the way your search works and apply some
> sharding techniques. I really haven't been up to that many docs in a
> single index but I think it should work to have multiple segments with
> INT_MAX documents in it since we search on segment level provided if
> you collector supports it.
>
> simon
>>>
>>> We have been using lucene for some time and our document count is growing
>>> rather rapidly, maybe this is a much-discussed issue already, but I did not
>>> find the lead, any pointer would be really appreciated.
>>>
>>> Thanks very much for helps, Lisheng
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>>
>>
>> --
>> Lance Norskog
>> goksron@gmail.com
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



-- 
Lance Norskog
goksron@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47689-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 06:09:26 2010
Return-Path: <java-user-return-47689-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93308 invoked from network); 3 Nov 2010 06:09:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 06:09:26 -0000
Received: (qmail 60963 invoked by uid 500); 3 Nov 2010 06:09:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60668 invoked by uid 500); 3 Nov 2010 06:09:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60659 invoked by uid 99); 3 Nov 2010 06:09:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 06:09:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of Lisheng.Zhang@broadvision.com designates 139.56.8.26 as permitted sender)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 06:09:46 +0000
X-ASG-Debug-ID: 1288764565-154400390000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id D0B8776BFF
	for <java-user@lucene.apache.org>; Tue,  2 Nov 2010 23:09:25 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM ([10.10.160.33]) by mail-fw.broadvision.com with ESMTP id 9Fs408F4FTBx5BMS for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 23:09:25 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
X-ASG-Orig-Subj: RE: How to handle more than Integer.MAX_VALUE documents?
Subject: RE: How to handle more than Integer.MAX_VALUE documents?
Date: Tue, 2 Nov 2010 23:09:22 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB175A@rw-ex2003.BROADVISION.COM>
In-Reply-To: <AANLkTin97QiAiq6sNZvwBq87LCyf12haP0zvnFCNh8FA@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: How to handle more than Integer.MAX_VALUE documents?
Thread-Index: Act6+vB70cXSPWSLRE6EOx4cu1nkRwAH3z0w
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: UNKNOWN[10.10.160.33]
X-Barracuda-Start-Time: 1288764565
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com

SGksDQoNClRoYW5rcyB2ZXJ5IG11Y2ggZm9yIHlvdXIgaGVscHMhIA0KDQpZb3VyIHBvaW50IGlz
IHdlbGwgdGFrZW4gYW5kIGl0IG1heSBjb3ZlciBtb3N0IHVzZSBjYXNlcywgYnV0IGl0IHNlZW1z
IA0KdG8gbWUgdGhhdCBpbiBwcmluY2lwbGUgdGhlIGxpbWl0IGlzIG5vdCBqdXN0IGZvciBvbmUg
c2VnbWVudDogc3VwcG9zZQ0Kd2l0aGluIG9uZSBpbmRleCB3ZSBoYXZlIDMgc2VnbWVudHMgYW5k
IGVhY2ggaGFzIGRvY3MgY2xvc2UgdG8gMl4zMS0xLA0KdGhlbiBpZiBJIG5lZWQgdG8gbG9vcCB0
aHJvdWdoIG1vc3QgZG9jcyBpbiBhbGwgdGhyZWUgc2VnbWVudHMgd2Ugd291bGQNCnN0aWxsIGhh
dmUgcHJvYmxlbXM/DQoNClRoZSB1c2UgY2FzZSBpcyAocmFyZSBvbmUpOiBpZiB1c2VyIHNlYXJj
aGVkIGEgd29yZCB3aGljaCBpcyBpbiBtb3N0IA0KZG9jcyBhbmQgd2UgdXNlIHBhZ2luYXRpb24s
IGFuZCB1c2VyIHNvbWVob3cganVzdCB3YW50cyB0byBnZXQgbGFzdCBhIA0KZmV3IHBhZ2VzIChs
b3dlc3QgcmFuayksIHRoZW4gd2UgaGF2ZSB0byB1c2UgYSBsYXJnZSBuRG9jcyB0byBjYWxsIHNl
YXJjaCANCihtYXkgZ28gYmV5b25kIEludGVnZXIuSU5URUdFUl9NQVgpLg0KDQpCZXN0IHJlZ2Fy
ZHMsIExpc2hlbmcNCg0KLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCkZyb206IExhbmNlIE5v
cnNrb2cgW21haWx0bzpnb2tzcm9uQGdtYWlsLmNvbV0NClNlbnQ6IFR1ZXNkYXksIE5vdmVtYmVy
IDAyLCAyMDEwIDc6MDAgUE0NClRvOiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmc7IHNpbW9u
LndpbGxuYXVlckBnbWFpbC5jb20NClN1YmplY3Q6IFJlOiBIb3cgdG8gaGFuZGxlIG1vcmUgdGhh
biBJbnRlZ2VyLk1BWF9WQUxVRSBkb2N1bWVudHM/DQoNCg0KWW91IHdvdWxkIGhhdmUgdG8gY29u
dHJvbCB5b3VyIE1lcmdlUG9saWN5IHNvIGl0IGRvZXNuJ3QgY29sbGFwc2UNCmV2ZXJ5dGhpbmcg
YmFjayB0byBvbmUgc2VnbWVudC4NCg0KT24gVHVlLCBOb3YgMiwgMjAxMCBhdCAxMjowMyBQTSwg
U2ltb24gV2lsbG5hdWVyDQo8c2ltb24ud2lsbG5hdWVyQGdvb2dsZW1haWwuY29tPiB3cm90ZToN
Cj4gT24gVHVlLCBOb3YgMiwgMjAxMCBhdCAxOjU4IEFNLCBMYW5jZSBOb3Jza29nIDxnb2tzcm9u
QGdtYWlsLmNvbT4gd3JvdGU6DQo+PiAyYmlsbGlvbiBpcyBhIGhhcmQgbGltaXQuIFVzdWFsbHkg
cGVvcGxlIHNwbGl0IGluZGV4ZXMgaW50byBtdWx0aXBsZQ0KPj4gaW5kZXggbG9uZyBiZWZvcmUg
dGhpcywgYW5kIHVzZSB0aGUgcGFyYWxsZWwgbXVsdGkgcmVhZGVyIChJIHRoaW5rKSB0bw0KPj4g
cmVhZCBmcm9tIGFsbCBvZiB0aGUgc3ViLWluZGV4ZXMuDQo+Pg0KPj4gT24gTW9uLCBOb3YgMSwg
MjAxMCBhdCAyOjE2IFBNLCBaaGFuZywgTGlzaGVuZw0KPj4gPExpc2hlbmcuWmhhbmdAYnJvYWR2
aXNpb24uY29tPiB3cm90ZToNCj4+Pg0KPj4+IEhpLA0KPj4+DQo+Pj4gTm93IGx1Y2VuZSB1c2Vz
IGludGVnZXIgYXMgZG9jdW1lbnQgaWQsIHNvIGl0IG1lYW5zIHdlIGNhbm5vdCBoYXZlIG1vcmUN
Cj4+PiB0aGFuIDJeMzEtMSBkb2N1bWVudHMgd2l0aGluIG9uZSBjb2xsZWN0aW9uPyBFdmVuIGlm
IHdlIHVzZSBNdWx0aVNlYXJjaGVyDQo+Pj4gdGhlIGRvY3VtZW50IGlkIGlzIHN0aWxsIGludGVn
ZXIgc28gaXQgc2VlbXMgdGhpcyBpcyBzdGlsbCBhIHByb2JsZW0/DQo+DQo+IFRoaXMgaXMgcmVh
bGx5IHRoZSBsaW1pdCBvZiBhIHNlZ21lbnQsIEkgdGhpbmsgeW91IGNhbiB3cml0ZSB5b3Ugb3du
DQo+IGNvbGxlY3RvciBhbmQgY29sbGVjdCBkb2N1bWVudHMgd2hpY2ggaGlnaGVyIChhYnNvbHV0
ZSkgZG9jIGlkcyB0aGFuDQo+IElOVF9NQVguIFlldCwgSSB0aGluayBpZiB5b3UgcmVhY2ggdGhl
IGxpbWl0IG9mIElOVF9NQVggZG9jdW1lbnRzIHlvdQ0KPiBzaG91bGQgcmVhbGx5IHJldGhpbmsg
dGhlIHdheSB5b3VyIHNlYXJjaCB3b3JrcyBhbmQgYXBwbHkgc29tZQ0KPiBzaGFyZGluZyB0ZWNo
bmlxdWVzLiBJIHJlYWxseSBoYXZlbid0IGJlZW4gdXAgdG8gdGhhdCBtYW55IGRvY3MgaW4gYQ0K
PiBzaW5nbGUgaW5kZXggYnV0IEkgdGhpbmsgaXQgc2hvdWxkIHdvcmsgdG8gaGF2ZSBtdWx0aXBs
ZSBzZWdtZW50cyB3aXRoDQo+IElOVF9NQVggZG9jdW1lbnRzIGluIGl0IHNpbmNlIHdlIHNlYXJj
aCBvbiBzZWdtZW50IGxldmVsIHByb3ZpZGVkIGlmDQo+IHlvdSBjb2xsZWN0b3Igc3VwcG9ydHMg
aXQuDQo+DQo+IHNpbW9uDQo+Pj4NCj4+PiBXZSBoYXZlIGJlZW4gdXNpbmcgbHVjZW5lIGZvciBz
b21lIHRpbWUgYW5kIG91ciBkb2N1bWVudCBjb3VudCBpcyBncm93aW5nDQo+Pj4gcmF0aGVyIHJh
cGlkbHksIG1heWJlIHRoaXMgaXMgYSBtdWNoLWRpc2N1c3NlZCBpc3N1ZSBhbHJlYWR5LCBidXQg
SSBkaWQgbm90DQo+Pj4gZmluZCB0aGUgbGVhZCwgYW55IHBvaW50ZXIgd291bGQgYmUgcmVhbGx5
IGFwcHJlY2lhdGVkLg0KPj4+DQo+Pj4gVGhhbmtzIHZlcnkgbXVjaCBmb3IgaGVscHMsIExpc2hl
bmcNCj4+Pg0KPj4+DQo+Pj4NCj4+PiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCj4+PiBUbyB1bnN1YnNjcmliZSwg
ZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJzY3JpYmVAbHVjZW5lLmFwYWNoZS5vcmcNCj4+PiBGb3Ig
YWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBqYXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hl
Lm9yZw0KPj4+DQo+Pj4NCj4+DQo+Pg0KPj4NCj4+IC0tDQo+PiBMYW5jZSBOb3Jza29nDQo+PiBn
b2tzcm9uQGdtYWlsLmNvbQ0KPj4NCj4+IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KPj4gVG8gdW5zdWJzY3JpYmUs
IGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+PiBGb3Ig
YWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBqYXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hl
Lm9yZw0KPj4NCj4+DQo+DQo+IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KPiBUbyB1bnN1YnNjcmliZSwgZS1tYWls
OiBqYXZhLXVzZXItdW5zdWJzY3JpYmVAbHVjZW5lLmFwYWNoZS5vcmcNCj4gRm9yIGFkZGl0aW9u
YWwgY29tbWFuZHMsIGUtbWFpbDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4N
Cj4NCg0KDQoNCi0tIA0KTGFuY2UgTm9yc2tvZw0KZ29rc3JvbkBnbWFpbC5jb20NCg0KLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tDQpUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJzY3JpYmVAbHVj
ZW5lLmFwYWNoZS5vcmcNCkZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1haWw6IGphdmEtdXNl
ci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQoNCg==


From java-user-return-47690-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 06:27:48 2010
Return-Path: <java-user-return-47690-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3366 invoked from network); 3 Nov 2010 06:27:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 06:27:47 -0000
Received: (qmail 70963 invoked by uid 500); 3 Nov 2010 06:28:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70824 invoked by uid 500); 3 Nov 2010 06:28:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70816 invoked by uid 99); 3 Nov 2010 06:28:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 06:28:13 +0000
X-ASF-Spam-Status: No, hits=2.8 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLYTO,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of simon.willnauer@googlemail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 06:28:08 +0000
Received: by gwj19 with SMTP id 19so248175gwj.35
        for <java-user@lucene.apache.org>; Tue, 02 Nov 2010 23:27:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:cc
         :content-type;
        bh=UXDR6RagKB/XtPDgIMBvq5TuvNpRGWToQpMEUDnvynE=;
        b=fvYw5pDV7PwTvD1PTlhIzzz2p7zpYDnjxAjVUFQehQks9JOlCNVsnOW11nyJSB5t9s
         4bOD5gRxNpg6ANSRxTpSAEIq3yOSv8E6OpqTNx3co9g2sx3VmqmkzXlFaR7db78uCjMY
         NQFj+xDJWnDW3PeAYTMdEfdKGXX52In4xIupQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:cc:content-type;
        b=yE0SkL91vcZ+y1PAcmxX6fik8KYToU/ymVzDi2DeSuvedhMEj4Vmp18If1/+dN66Tf
         cCuZy7TVqduAUbmAIHvv6AXgkw5neUERBhDbspwcucMUptSAFCvRYHZ9Hi7bVdk/TSP5
         Eh344DxyhL/D16UZcu/do0o7fL5d5TIfKZb1k=
MIME-Version: 1.0
Received: by 10.229.191.78 with SMTP id dl14mr3538675qcb.285.1288765667790;
 Tue, 02 Nov 2010 23:27:47 -0700 (PDT)
Received: by 10.229.70.135 with HTTP; Tue, 2 Nov 2010 23:27:47 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <AANLkTin97QiAiq6sNZvwBq87LCyf12haP0zvnFCNh8FA@mail.gmail.com>
References: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB1749@rw-ex2003.BROADVISION.COM>
	<AANLkTi=Cj9Fiy7vp9dTDG56Jh7WSV0dExtGqrCu6+zM2@mail.gmail.com>
	<AANLkTi=UksyZKYGb6h9Yz7RaDQZCLOrnSM7TfwJPcC15@mail.gmail.com>
	<AANLkTin97QiAiq6sNZvwBq87LCyf12haP0zvnFCNh8FA@mail.gmail.com>
Date: Wed, 3 Nov 2010 07:27:47 +0100
Message-ID: <AANLkTimK2+mFfF6m_GjrFynHH4HE2RSE2BMgrSJpgJzL@mail.gmail.com>
Subject: Re: How to handle more than Integer.MAX_VALUE documents?
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: Lance Norskog <goksron@gmail.com>
Cc: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

On Wed, Nov 3, 2010 at 3:00 AM, Lance Norskog <goksron@gmail.com> wrote:
> You would have to control your MergePolicy so it doesn't collapse
> everything back to one segment.
maxmergedocs is an int too though!

simon
>
> On Tue, Nov 2, 2010 at 12:03 PM, Simon Willnauer
> <simon.willnauer@googlemail.com> wrote:
>> On Tue, Nov 2, 2010 at 1:58 AM, Lance Norskog <goksron@gmail.com> wrote:
>>> 2billion is a hard limit. Usually people split indexes into multiple
>>> index long before this, and use the parallel multi reader (I think) to
>>> read from all of the sub-indexes.
>>>
>>> On Mon, Nov 1, 2010 at 2:16 PM, Zhang, Lisheng
>>> <Lisheng.Zhang@broadvision.com> wrote:
>>>>
>>>> Hi,
>>>>
>>>> Now lucene uses integer as document id, so it means we cannot have more
>>>> than 2^31-1 documents within one collection? Even if we use MultiSearcher
>>>> the document id is still integer so it seems this is still a problem?
>>
>> This is really the limit of a segment, I think you can write you own
>> collector and collect documents which higher (absolute) doc ids than
>> INT_MAX. Yet, I think if you reach the limit of INT_MAX documents you
>> should really rethink the way your search works and apply some
>> sharding techniques. I really haven't been up to that many docs in a
>> single index but I think it should work to have multiple segments with
>> INT_MAX documents in it since we search on segment level provided if
>> you collector supports it.
>>
>> simon
>>>>
>>>> We have been using lucene for some time and our document count is growing
>>>> rather rapidly, maybe this is a much-discussed issue already, but I did not
>>>> find the lead, any pointer would be really appreciated.
>>>>
>>>> Thanks very much for helps, Lisheng
>>>>
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>>
>>>
>>> --
>>> Lance Norskog
>>> goksron@gmail.com
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
> --
> Lance Norskog
> goksron@gmail.com
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47691-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 10:06:19 2010
Return-Path: <java-user-return-47691-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74255 invoked from network); 3 Nov 2010 10:06:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 10:06:19 -0000
Received: (qmail 74723 invoked by uid 500); 3 Nov 2010 10:06:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74396 invoked by uid 500); 3 Nov 2010 10:06:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74388 invoked by uid 99); 3 Nov 2010 10:06:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 10:06:43 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of samarzone@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 10:06:35 +0000
Received: by iwn7 with SMTP id 7so603062iwn.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 03:06:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=NLT6P/8xbVr1iVdR/TR1zm5V19fFuyCKE0lrmFMkStw=;
        b=dqFHWHnm7NoIvRwlkXGyNhLCA1DxEhF6lGCyCzrc505i6JBGckxsQHLJ2pndIByNMK
         0iZH5+uYtlufcshi113Gr/T9wF7ujxvtmmBCd5o/aRicfYuUkXOKRSkKjWz8/789aD8O
         NA3AjEVY2VWFqThGWf0K0krcSyuf0PW4YdAlc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=Ehc77S4GAYZU8BFiASx4Sykre3Pt+Mdg+/0Eiy7OLOt93PtasH0KATAlmiJvbR2O2Y
         8DFMn2ShcyuznS/9NRiWuAIv4A/Bg8q5gTV+FEQ+gBXBz7TDeka5Zp+/IQEnEyTwWObD
         8b4JGSaH4XH6KtgRHldnGXOgiD/LA1N+YANZI=
Received: by 10.231.145.1 with SMTP id b1mr6987865ibv.69.1288778774457; Wed,
 03 Nov 2010 03:06:14 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.231.10.200 with HTTP; Wed, 3 Nov 2010 03:05:59 -0700 (PDT)
From: Samarendra Pratap <samarzone@gmail.com>
Date: Wed, 3 Nov 2010 15:35:59 +0530
Message-ID: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
Subject: Single filter instance with different searchers
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485eba7980bac9e04942331ed
X-Virus-Checked: Checked by ClamAV on apache.org

--001485eba7980bac9e04942331ed
Content-Type: text/plain; charset=ISO-8859-1

Hi. We have a large index (~ 28 GB) which is distributed in three different
directories, each representing a country. Each of these country wise indexes
is further distributed on the basis of last update date into 21 smaller
indexes. This index is updated once in a day.

A user can search into any of one country and can choose last update date
plus some other criteria.

When the server application starts, index readers and hence searchers are
created for each of the small indexes (21 x 3) and put in an array.
Depending on the option (country and last update date) chosen by user we
pick the searchers of correct date range/country and create a new
ParallelMultiSearcher instance.

Now my question is - can I use single filter (caching filter) instance for
every search (may be on different searchers)?
===================================================================================

e.g
for first search i create an filter of experience 4 years and save it.

if another search for a different country (and hence difference index) also
has same experience criteria, i.e. 4 years, can i use the same filter
instance for second search too?

i have tested a little for this and surprisingly i have got correct results.
i was wondering if this is the correct way. or do i need to create different
filters for each searcher (or index reader) instance?

Thanks in advance.

-- 
Regards,
Samar

--001485eba7980bac9e04942331ed--

From java-user-return-47692-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 13:34:16 2010
Return-Path: <java-user-return-47692-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54231 invoked from network); 3 Nov 2010 13:34:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 13:34:16 -0000
Received: (qmail 95975 invoked by uid 500); 3 Nov 2010 13:34:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95876 invoked by uid 500); 3 Nov 2010 13:34:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95868 invoked by uid 99); 3 Nov 2010 13:34:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 13:34:39 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 13:34:33 +0000
Received: by qwk3 with SMTP id 3so33687qwk.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 06:34:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=XxPanRkuQVSSyandjyDE03uvWGI5xc7WerotMSVvnI4=;
        b=VYVpeSHrde3k4j3TCfoDiMoRfzFGMYPxQIsC7xmAI8FrQQfNyCfy/SpCbH90hMQEvp
         af6FuXCoXwVGu6hWfY2pjUjTMbyO6kfGxBRWdR05rWgQEeuwFK6N01w5ohIaaHs3Mgks
         XhJEpATX0oHYsRC95Bc4QSAwASWAoPD3W2ZoA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=w4+ZZHkvnna0SsUssjsMTNbkAajuQRaMEjAW57Bmf4R5CChejKL1UAG+PNnQPRHl8p
         L9wmwfDq65I3WejN6YK3fRu/2NS7E0N4Wwagk8tyK0QOC+xzH2o4wPakEet6RUO/9gz8
         C7PLpeyZtc5Y76junn9AIU8ysjOTWD2/gq8do=
MIME-Version: 1.0
Received: by 10.224.200.197 with SMTP id ex5mr545623qab.142.1288791252341;
 Wed, 03 Nov 2010 06:34:12 -0700 (PDT)
Received: by 10.229.229.14 with HTTP; Wed, 3 Nov 2010 06:34:12 -0700 (PDT)
In-Reply-To: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
References: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
Date: Wed, 3 Nov 2010 09:34:12 -0400
Message-ID: <AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
Subject: Re: Single filter instance with different searchers
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf3010ed83c911f604942618a9

--20cf3010ed83c911f604942618a9
Content-Type: text/plain; charset=ISO-8859-1

I'm assuming you're down in Lucene land. Unless somehow you've
gotten 63 separate filters when you think you only have one, I don't
think what you're doing will work. Or I'm failing to understand what
you're doing at all.

The problem is I expect each of your indexes starts with document
1. So your Filter is really a bit set keyed by Lucene document ID.

So applying filter 2 to index 54 will NOT do what you want. What I
suspect you're seeing is that applying your filter is producing enough
results from index 54 (to continue my example) to fool you into
thinking it's working.

Try running the query with and without the filter on each of your indexes,
perhaps as a control including a restrictive clause in the query
to do the same thing your filter is doing. Or construct the filter new
for comparison.... If the numbers continue to be the same, I clearly
don't understand something! <G>....

Best
Erick

On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap <samarzone@gmail.com>wrote:

> Hi. We have a large index (~ 28 GB) which is distributed in three different
> directories, each representing a country. Each of these country wise
> indexes
> is further distributed on the basis of last update date into 21 smaller
> indexes. This index is updated once in a day.
>
> A user can search into any of one country and can choose last update date
> plus some other criteria.
>
> When the server application starts, index readers and hence searchers are
> created for each of the small indexes (21 x 3) and put in an array.
> Depending on the option (country and last update date) chosen by user we
> pick the searchers of correct date range/country and create a new
> ParallelMultiSearcher instance.
>
> Now my question is - can I use single filter (caching filter) instance for
> every search (may be on different searchers)?
>
> ===================================================================================
>
> e.g
> for first search i create an filter of experience 4 years and save it.
>
> if another search for a different country (and hence difference index) also
> has same experience criteria, i.e. 4 years, can i use the same filter
> instance for second search too?
>
> i have tested a little for this and surprisingly i have got correct
> results.
> i was wondering if this is the correct way. or do i need to create
> different
> filters for each searcher (or index reader) instance?
>
> Thanks in advance.
>
> --
> Regards,
> Samar
>

--20cf3010ed83c911f604942618a9--

From java-user-return-47693-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 15:56:53 2010
Return-Path: <java-user-return-47693-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16555 invoked from network); 3 Nov 2010 15:56:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 15:56:53 -0000
Received: (qmail 17157 invoked by uid 500); 3 Nov 2010 15:57:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16956 invoked by uid 500); 3 Nov 2010 15:57:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16948 invoked by uid 99); 3 Nov 2010 15:57:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 15:57:18 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of Lisheng.Zhang@broadvision.com designates 139.56.8.26 as permitted sender)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 15:57:14 +0000
X-ASG-Debug-ID: 1288799812-2c2201360000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP
	id B90B977586; Wed,  3 Nov 2010 08:56:52 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM ([10.10.160.33]) by mail-fw.broadvision.com with ESMTP id XIx3QIaxERLYiXur; Wed, 03 Nov 2010 08:56:52 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
X-ASG-Orig-Subj: RE: How to handle more than Integer.MAX_VALUE documents?
Subject: RE: How to handle more than Integer.MAX_VALUE documents?
Date: Wed, 3 Nov 2010 08:56:52 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC02CB175B@rw-ex2003.BROADVISION.COM>
In-Reply-To: <AANLkTimK2+mFfF6m_GjrFynHH4HE2RSE2BMgrSJpgJzL@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: How to handle more than Integer.MAX_VALUE documents?
Thread-Index: Act7IE5LjZw+ctEtTkCGcnwLim+0VgAT167A
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>,
	<simon.willnauer@gmail.com>,
	"Lance Norskog" <goksron@gmail.com>
X-Barracuda-Connect: UNKNOWN[10.10.160.33]
X-Barracuda-Start-Time: 1288799812
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com

VGhhbmtzIHZlcnkgbXVjaCwgSSBnb3QgaXQuDQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0t
DQpGcm9tOiBTaW1vbiBXaWxsbmF1ZXIgW21haWx0bzpzaW1vbi53aWxsbmF1ZXJAZ29vZ2xlbWFp
bC5jb21dDQpTZW50OiBUdWVzZGF5LCBOb3ZlbWJlciAwMiwgMjAxMCAxMToyOCBQTQ0KVG86IExh
bmNlIE5vcnNrb2cNCkNjOiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNClN1YmplY3Q6IFJl
OiBIb3cgdG8gaGFuZGxlIG1vcmUgdGhhbiBJbnRlZ2VyLk1BWF9WQUxVRSBkb2N1bWVudHM/DQoN
Cg0KT24gV2VkLCBOb3YgMywgMjAxMCBhdCAzOjAwIEFNLCBMYW5jZSBOb3Jza29nIDxnb2tzcm9u
QGdtYWlsLmNvbT4gd3JvdGU6DQo+IFlvdSB3b3VsZCBoYXZlIHRvIGNvbnRyb2wgeW91ciBNZXJn
ZVBvbGljeSBzbyBpdCBkb2Vzbid0IGNvbGxhcHNlDQo+IGV2ZXJ5dGhpbmcgYmFjayB0byBvbmUg
c2VnbWVudC4NCm1heG1lcmdlZG9jcyBpcyBhbiBpbnQgdG9vIHRob3VnaCENCg0Kc2ltb24NCj4N
Cj4gT24gVHVlLCBOb3YgMiwgMjAxMCBhdCAxMjowMyBQTSwgU2ltb24gV2lsbG5hdWVyDQo+IDxz
aW1vbi53aWxsbmF1ZXJAZ29vZ2xlbWFpbC5jb20+IHdyb3RlOg0KPj4gT24gVHVlLCBOb3YgMiwg
MjAxMCBhdCAxOjU4IEFNLCBMYW5jZSBOb3Jza29nIDxnb2tzcm9uQGdtYWlsLmNvbT4gd3JvdGU6
DQo+Pj4gMmJpbGxpb24gaXMgYSBoYXJkIGxpbWl0LiBVc3VhbGx5IHBlb3BsZSBzcGxpdCBpbmRl
eGVzIGludG8gbXVsdGlwbGUNCj4+PiBpbmRleCBsb25nIGJlZm9yZSB0aGlzLCBhbmQgdXNlIHRo
ZSBwYXJhbGxlbCBtdWx0aSByZWFkZXIgKEkgdGhpbmspIHRvDQo+Pj4gcmVhZCBmcm9tIGFsbCBv
ZiB0aGUgc3ViLWluZGV4ZXMuDQo+Pj4NCj4+PiBPbiBNb24sIE5vdiAxLCAyMDEwIGF0IDI6MTYg
UE0sIFpoYW5nLCBMaXNoZW5nDQo+Pj4gPExpc2hlbmcuWmhhbmdAYnJvYWR2aXNpb24uY29tPiB3
cm90ZToNCj4+Pj4NCj4+Pj4gSGksDQo+Pj4+DQo+Pj4+IE5vdyBsdWNlbmUgdXNlcyBpbnRlZ2Vy
IGFzIGRvY3VtZW50IGlkLCBzbyBpdCBtZWFucyB3ZSBjYW5ub3QgaGF2ZSBtb3JlDQo+Pj4+IHRo
YW4gMl4zMS0xIGRvY3VtZW50cyB3aXRoaW4gb25lIGNvbGxlY3Rpb24/IEV2ZW4gaWYgd2UgdXNl
IE11bHRpU2VhcmNoZXINCj4+Pj4gdGhlIGRvY3VtZW50IGlkIGlzIHN0aWxsIGludGVnZXIgc28g
aXQgc2VlbXMgdGhpcyBpcyBzdGlsbCBhIHByb2JsZW0/DQo+Pg0KPj4gVGhpcyBpcyByZWFsbHkg
dGhlIGxpbWl0IG9mIGEgc2VnbWVudCwgSSB0aGluayB5b3UgY2FuIHdyaXRlIHlvdSBvd24NCj4+
IGNvbGxlY3RvciBhbmQgY29sbGVjdCBkb2N1bWVudHMgd2hpY2ggaGlnaGVyIChhYnNvbHV0ZSkg
ZG9jIGlkcyB0aGFuDQo+PiBJTlRfTUFYLiBZZXQsIEkgdGhpbmsgaWYgeW91IHJlYWNoIHRoZSBs
aW1pdCBvZiBJTlRfTUFYIGRvY3VtZW50cyB5b3UNCj4+IHNob3VsZCByZWFsbHkgcmV0aGluayB0
aGUgd2F5IHlvdXIgc2VhcmNoIHdvcmtzIGFuZCBhcHBseSBzb21lDQo+PiBzaGFyZGluZyB0ZWNo
bmlxdWVzLiBJIHJlYWxseSBoYXZlbid0IGJlZW4gdXAgdG8gdGhhdCBtYW55IGRvY3MgaW4gYQ0K
Pj4gc2luZ2xlIGluZGV4IGJ1dCBJIHRoaW5rIGl0IHNob3VsZCB3b3JrIHRvIGhhdmUgbXVsdGlw
bGUgc2VnbWVudHMgd2l0aA0KPj4gSU5UX01BWCBkb2N1bWVudHMgaW4gaXQgc2luY2Ugd2Ugc2Vh
cmNoIG9uIHNlZ21lbnQgbGV2ZWwgcHJvdmlkZWQgaWYNCj4+IHlvdSBjb2xsZWN0b3Igc3VwcG9y
dHMgaXQuDQo+Pg0KPj4gc2ltb24NCj4+Pj4NCj4+Pj4gV2UgaGF2ZSBiZWVuIHVzaW5nIGx1Y2Vu
ZSBmb3Igc29tZSB0aW1lIGFuZCBvdXIgZG9jdW1lbnQgY291bnQgaXMgZ3Jvd2luZw0KPj4+PiBy
YXRoZXIgcmFwaWRseSwgbWF5YmUgdGhpcyBpcyBhIG11Y2gtZGlzY3Vzc2VkIGlzc3VlIGFscmVh
ZHksIGJ1dCBJIGRpZCBub3QNCj4+Pj4gZmluZCB0aGUgbGVhZCwgYW55IHBvaW50ZXIgd291bGQg
YmUgcmVhbGx5IGFwcHJlY2lhdGVkLg0KPj4+Pg0KPj4+PiBUaGFua3MgdmVyeSBtdWNoIGZvciBo
ZWxwcywgTGlzaGVuZw0KPj4+Pg0KPj4+Pg0KPj4+Pg0KPj4+PiAtLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCj4+Pj4g
VG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFj
aGUub3JnDQo+Pj4+IEZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1haWw6IGphdmEtdXNlci1o
ZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQo+Pj4+DQo+Pj4+DQo+Pj4NCj4+Pg0KPj4+DQo+Pj4gLS0N
Cj4+PiBMYW5jZSBOb3Jza29nDQo+Pj4gZ29rc3JvbkBnbWFpbC5jb20NCj4+Pg0KPj4+IC0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQ0KPj4+IFRvIHVuc3Vic2NyaWJlLCBlLW1haWw6IGphdmEtdXNlci11bnN1YnNjcmli
ZUBsdWNlbmUuYXBhY2hlLm9yZw0KPj4+IEZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1haWw6
IGphdmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQo+Pj4NCj4+Pg0KPj4NCj4+IC0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQ0KPj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2NyaWJl
QGx1Y2VuZS5hcGFjaGUub3JnDQo+PiBGb3IgYWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBq
YXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KPj4NCj4+DQo+DQo+DQo+DQo+IC0tDQo+
IExhbmNlIE5vcnNrb2cNCj4gZ29rc3JvbkBnbWFpbC5jb20NCj4NCg0KLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpU
byB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJzY3JpYmVAbHVjZW5lLmFwYWNo
ZS5vcmcNCkZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1haWw6IGphdmEtdXNlci1oZWxwQGx1
Y2VuZS5hcGFjaGUub3JnDQoNCg==


From java-user-return-47694-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 18:18:47 2010
Return-Path: <java-user-return-47694-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20129 invoked from network); 3 Nov 2010 18:18:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 18:18:47 -0000
Received: (qmail 77204 invoked by uid 500); 3 Nov 2010 18:19:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77026 invoked by uid 500); 3 Nov 2010 18:19:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77017 invoked by uid 99); 3 Nov 2010 18:19:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 18:19:14 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.191.69.108] (HELO web32908.mail.mud.yahoo.com) (209.191.69.108)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 03 Nov 2010 18:19:06 +0000
Received: (qmail 68639 invoked by uid 60001); 3 Nov 2010 18:18:45 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1288808325; bh=sYrIJKfPnSH6oRUEPdUIFdvj18OIRf9gryoiNZFTc8U=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=YTQXug9TAA4kBGX0XSayVpCIeIPkk1bskm/JBm4h1p0v5We+jmjB6qZ4ba9/RbBs47oZxHN1/ZyKrvd38vlUjueg/L7RUcdEZMPzem5gmoekR5NBxrMGFEtbUR5aMPdtGzps1bPCtU3+pxwDloX+ZQ5inDOif8q4pbQ5Z2Le9N4=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=hLXw3B/lmgN0tQhh/YO0Q8D1TqcEi+UPCr3rOAf3R2zu6lObMaej150Tc/49WRJFv7WT4PwcSmkFe0fYLUKIPNxEfmPK+9uDq0if3J+M4Eq4epZrzuEnRxggtI0GOsKkM2yXCG0QdIbOmvThoUEyCpCQrr77asNJyyE6IXNShxo=;
Message-ID: <504487.63660.qm@web32908.mail.mud.yahoo.com>
X-YMail-OSG: .Grl7.oVM1lGcEKMPbDRjkX1eFmMTMZbuS0mq5.SsG87bmQ
 DMHqxFD..yhFxSoiFmWlhd1ISzKVx.71sskxBl04dyXNpLB.AVtiOg0tF1rC
 FsA_TiYiMnF.Uc55YZsDJlZfM5wrPhuOPGn3f622eBM0uFQ4aiae0gh09usP
 pav_TEIAzjncUkzj.QMDisKgZeKPtlqYwVs.ZjRfKmCbO9I8CzuWxxLBHRVO
 57rv5l01ac7dQpqJVrCUEUNd3g51MreAZHkcy_kcNO3KgNbZJPOfr94CM.Du
 ipulvXVXoujBCHnEqsa4AYuY0EYl7Em3nnBV_YuH7Df4CevpcGLC6jqR5.8C
 4mDjRUfFWiNd8Kl5KvYAZCEl1TQPy4ZXMGe8-
Received: from [72.36.94.20] by web32908.mail.mud.yahoo.com via HTTP; Wed, 03 Nov 2010 11:18:45 PDT
X-Mailer: YahooMailRC/504.5 YahooMailWebService/0.8.107.284920
Date: Wed, 3 Nov 2010 11:18:45 -0700 (PDT)
From: Justin <crynax@yahoo.com>
Subject: Options for multiple filters
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii

Is there a behavioral difference between:
    Query query = new FilteredQuery(query, filter1);
    searcher.search(query, filter2, n);

...and:
    ChainedFilter filter = new ChainedFilter(
        new Filter[]{filter1, filter2}, ChainedFilter.AND);
    searcher.search(query, filter, n);


I chose the former after reading performance measurements here:
http://wiki.apache.org/lucene-java/FilteringOptions

But I'm definitely getting different results.

I also see that BooleanFilter has been added since our chosen version. Is that 
preferred to the above? Is it worthwhile to update the wiki?

Thanks for any help!
Justin


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47695-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 18:53:09 2010
Return-Path: <java-user-return-47695-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41049 invoked from network); 3 Nov 2010 18:53:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 18:53:09 -0000
Received: (qmail 35697 invoked by uid 500); 3 Nov 2010 18:53:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35628 invoked by uid 500); 3 Nov 2010 18:53:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35620 invoked by uid 99); 3 Nov 2010 18:53:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 18:53:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mark.kristensson@smartsheet.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 18:53:29 +0000
Received: by gwj19 with SMTP id 19so826194gwj.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 11:53:07 -0700 (PDT)
Received: by 10.90.1.34 with SMTP id 34mr1391715aga.59.1288810387681;
        Wed, 03 Nov 2010 11:53:07 -0700 (PDT)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id j21sm308411yha.12.2010.11.03.11.53.05
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 03 Nov 2010 11:53:06 -0700 (PDT)
From: Mark Kristensson <mark.kristensson@smartsheet.com>
Mime-Version: 1.0 (Apple Message framework v1081)
Content-Type: multipart/alternative; boundary=Apple-Mail-1--881946564
Subject: Re: IndexWriter.close() performance issue
Date: Wed, 3 Nov 2010 11:53:02 -0700
In-Reply-To: <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
To: java-user@lucene.apache.org
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
Message-Id: <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
X-Mailer: Apple Mail (2.1081)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-1--881946564
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

I've successfully reproduced the issue in our lab with a copy from =
production and have broken the close() call into parts, as suggested, =
with one addition.

Previously, the call was simply=20

	...
	} finally {
		// Close
		if (indexWriter !=3D null) {
			try {
				indexWriter.close();
	...


Now, that is broken into the various parts, including a prepareCommit();
			=09
	...
	} finally {
		// Close
		if (indexWriter !=3D null) {
			try {
				indexWriter.prepareCommit();
				Logger.debug("prepareCommit() =
complete");
				indexWriter.commit();
				Logger.debug("commit() complete");
				indexWriter.maybeMerge();
				Logger.debug("maybeMerge() complete");
				indexWriter.waitForMerges();
				Logger.debug("waitForMerges() =
complete");
				indexWriter.close();
	...


It turns out that the prepareCommit() is the slow call here, taking =
several seconds to complete.=20

I've done some reading about it, but have not found anything that might =
be helpful here. The fact that it is slow every single time, even when =
I'm adding exactly one document to the index, is perplexing and leads to =
me to think something must be corrupt with the index.

Furthermore, I tried optimizing the index to see if that would have any =
impact (I wasn't expecting much) and it did not.

I'm stumped at this point and am thinking I may have to rebuild the =
index, though I would definitely prefer to avoid doing that and would =
like to know why this is happening.

Thanks for your help,
Mark


On Nov 2, 2010, at 9:26 AM, Mark Kristensson wrote:

>=20
> Wonderful information on what happens during indexWriter.close(), =
thank you very much! I've got some testing to do as a result.
>=20
> We are on Lucene 3.0.0 right now.
>=20
> One other detail that I neglected to mention is that the batch size =
does not seem to have any relation to the time it takes to close on the =
index where we are having issues. We've had batches add as few as 3 =
documents and batches add as many as 2500 documents in the last hour and =
every single close() call for that index takes 6 to 8 seconds. While I =
won't know until I am able to individually test the different pieces of =
the close() operation, I'd be very surprised if a batch that adds just 3 =
new documents results in very much merge work being done. It seems as if =
there is some task happening during merge that the indexWriter is never =
able to successfully complete and so it tries to complete that task =
every single time close() is called. =20
>=20
> So, my working theory until I can dig deeper is that something is =
mildly corrupt with the index (though not serious enough to affect most =
operations on the index). Are there any good utilities for examining the =
health of an index?=20
>=20
> I've dabbled with the experimental checkIndex object in the past =
(before we upgraded to 3.0), but have found it to be incredibly slow and =
of marginal value. Does anyone have any experience using CheckIndex to =
track down an issue with a production index?
>=20
> Thanks again!
> Mark
>=20
> On Nov 2, 2010, at 2:20 AM, Shai Erera wrote:
>=20
>> When you close IndexWriter, it performs several operations that might =
have a
>> connection to the problem you describe:
>>=20
>> * Commit all the pending updates -- if your update batch size is more =
or
>> less the same (i.e., comparable # of docs and total # bytes indexed), =
then
>> you should not see a performance difference between closes.
>>=20
>> * Consults the MergePolicy and runs any merges it returns as =
candidates.
>>=20
>> * Waits for the merges to finish.
>>=20
>> Roughly, IndexWriter.close() can be substituted w/:
>> writer.commit(false); // commits the changes, but does not run =
merges.
>> writer.maybeMerge(); // runs merges returned by MergePolicy.
>> writer.waitForMerges(); // if you use ConcurrentMergeScheduler, the =
above
>> call returns immediately, not waiting for the merges to finish.
>> writer.close(); // at this point, commit + merging has finished, so =
it does
>> very little.
>>=20
>> As your index grows in size, so does its # of segments, and the =
segments
>> size as well. So tweaking some parameters on the MergePolicy (such as
>> mergeFactor, maxMergeMB etc.) can result in not attempting to merge =
too
>> large segments.
>>=20
>> Alternatively, you can try the following:
>>=20
>> 1) Replace the call to writer.close() w/ the above sequence. Then, =
measure
>> each call and report back which of them takes the suspicious amount =
of time.
>>=20
>> 2) Not running optimize() on a regular basis doesn't mean merges =
don't
>> happen in the background. So if you want close() to return as fast as
>> possible, you should call close(false). Note though that from time to =
time
>> you should allow merges to finish, in order to reduce the # of =
segments.
>>=20
>> 3) If you want to control when the merges are run, you can open =
IndexWriter
>> with NoMergePolicy, which always returns 0 merges to perform, or
>> NoMergeScheduler which never executes merges. But be aware that this =
is
>> dangerous as the # of segments in the index will continue to grow and =
search
>> performance will degrade.
>>=20
>> The answers above is relevant for 3x, but most of them are also =
relevant for
>> 2.9. If you have an older version of Lucene, then some of the =
solutions
>> might still apply (such as close(false)).
>>=20
>> Hope this helps,
>> Shai
>>=20
>> On Tue, Nov 2, 2010 at 12:55 AM, Mark Kristensson <
>> mark.kristensson@smartsheet.com> wrote:
>>=20
>>> Hello,
>>>=20
>>> One of our  Lucene indexes has started misbehaving on =
indexWriter.close and
>>> I'm searching for ideas about what may have happened and how to fix =
it.
>>>=20
>>> Here's our scenario:
>>> - We have seven Lucene indexes that contain different sets of data =
from a
>>> web application are indexed for searching by end users
>>> - A java service runs twice a minute to pull changes from SQL DB =
queue
>>> tables and update the relevant Lucene index(es)
>>> - The two largest indexes (3.4GB and 3.8GB in size with 8 million =
and 6
>>> million records, respectively) contain similar sets of data, but are
>>> structured differently for different consumption (e.g. one has an =
All field
>>> for general purpose searching, the other does not; one has numeric =
fields
>>> for ranges, the other does not, etc.)
>>> - We expunge deletes from our indexes twice per day
>>> - A  couple of weeks ago, one of the two large indexes became very =
slow to
>>> close after each round of changes is applied by our indexing =
service.
>>> Specifically, all of our indexes usually close in no more than 200
>>> milliseconds, but this one index is now taking 6 to 8 seconds to =
close with
>>> every single pass (and is leading to delays which are affecting end =
users).
>>>=20
>>> Questions from my attempts to troubleshoot the problem:
>>> - Has anyone else seen behavior similar to this? What did you do to =
resolve
>>> it?
>>> - Does the size of an index or its documents (record count, disk =
size, avg
>>> document size, max document size, etc.) have any correlation to the =
length
>>> of time it takes to close an index?
>>> - We are not currently optimizing any of our indexes on a regular =
basis,
>>> could that have any impact upon indexing operations (e.g.
>>> indexWriter.close())? My understanding is that optimization only =
affects
>>> search performance, not indexing performance and to date we have not =
seen
>>> any need to optimize based upon the performance of the search =
queries.
>>>=20
>>> Thanks,
>>> Mark
>>> =
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>>=20
>=20


--Apple-Mail-1--881946564--

From java-user-return-47696-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 19:01:49 2010
Return-Path: <java-user-return-47696-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47067 invoked from network); 3 Nov 2010 19:01:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 19:01:49 -0000
Received: (qmail 56273 invoked by uid 500); 3 Nov 2010 19:02:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56001 invoked by uid 500); 3 Nov 2010 19:02:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55993 invoked by uid 99); 3 Nov 2010 19:02:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 19:02:16 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 19:02:11 +0000
Received: by fxm7 with SMTP id 7so820137fxm.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 12:01:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=oaO7GbT0qrSr8Wru4Uj/jXHkapvQm61Kwjxa8xEP4Dw=;
        b=wz8AXR/aVEe8muN66KFXAf46XvNCfqVNUOzXexo6DcNJmXbv3ckq8Bb+UoG10Wj8ai
         +ws6k5jwvVkab+GRZWet3+OlE8FzihpSquE1Q2h2R0gS6frZUt2n7MtpxEsUoZWvJkCk
         eyNJ6hHJe5+I0EL0CtMLGKZo35pXmvIPM7b5s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=fYzhzGPZo4xzt1Sj8yQnaVXjgemp9c9h/yp6jbClmrSTDVxHzi9hIR8q2EaQAiUOyi
         TpJ5Yb9qJwB0AfuM2B4V9Bz9d4YeJeQ6h7wiPVJaPRzEOYvHCMVTZoCq4EThGSEOjoNX
         iDsK8zI0R160u9SqBPtpJdJEg7OQF5zf5lgj4=
MIME-Version: 1.0
Received: by 10.223.123.209 with SMTP id q17mr10208286far.126.1288810910047;
 Wed, 03 Nov 2010 12:01:50 -0700 (PDT)
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.74.202 with HTTP; Wed, 3 Nov 2010 12:01:49 -0700 (PDT)
In-Reply-To: <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
Date: Wed, 3 Nov 2010 15:01:49 -0400
X-Google-Sender-Auth: mVj9UBlPgelw4EynLDESuYGrqx4
Message-ID: <AANLkTikkzfBhUDyuQn6guGPRLcFYn2uV8ZU9_uACLJ4Y@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

> It turns out that the prepareCommit() is the slow call here, taking sever=
al seconds to complete.
>
> I've done some reading about it, but have not found anything that might b=
e helpful here. The fact that it is slow
> every single time, even when I'm adding exactly one document to the index=
, is perplexing and leads to me to
> think something must be corrupt with the index.

prepareCommit() syncs the index files, making sure they are one stable stor=
age.
Some filesystems have issues with syncing individual files and
essentially sync all files with unflushed data, leading to poor
performance.

-Yonik
http://www.lucidimagination.com



On Wed, Nov 3, 2010 at 2:53 PM, Mark Kristensson
<mark.kristensson@smartsheet.com> wrote:
> I've successfully reproduced the issue in our lab with a copy from produc=
tion and have broken the close() call into parts, as suggested, with one ad=
dition.
>
> Previously, the call was simply
>
> =A0 =A0 =A0 =A0...
> =A0 =A0 =A0 =A0} finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0// Close
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (indexWriter !=3D null) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.close();
> =A0 =A0 =A0 =A0...
>
>
> Now, that is broken into the various parts, including a prepareCommit();
>
> =A0 =A0 =A0 =A0...
> =A0 =A0 =A0 =A0} finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0// Close
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (indexWriter !=3D null) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.prepareCommit();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("prepareCommit() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.commit();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("commit() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.maybeMerge();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("maybeMerge() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.waitForMerges();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("waitForMerges() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.close();
> =A0 =A0 =A0 =A0...
>
>
> It turns out that the prepareCommit() is the slow call here, taking sever=
al seconds to complete.
>
> I've done some reading about it, but have not found anything that might b=
e helpful here. The fact that it is slow every single time, even when I'm a=
dding exactly one document to the index, is perplexing and leads to me to t=
hink something must be corrupt with the index.
>
> Furthermore, I tried optimizing the index to see if that would have any i=
mpact (I wasn't expecting much) and it did not.
>
> I'm stumped at this point and am thinking I may have to rebuild the index=
, though I would definitely prefer to avoid doing that and would like to kn=
ow why this is happening.
>
> Thanks for your help,
> Mark
>
>
> On Nov 2, 2010, at 9:26 AM, Mark Kristensson wrote:
>
>>
>> Wonderful information on what happens during indexWriter.close(), thank =
you very much! I've got some testing to do as a result.
>>
>> We are on Lucene 3.0.0 right now.
>>
>> One other detail that I neglected to mention is that the batch size does=
 not seem to have any relation to the time it takes to close on the index w=
here we are having issues. We've had batches add as few as 3 documents and =
batches add as many as 2500 documents in the last hour and every single clo=
se() call for that index takes 6 to 8 seconds. While I won't know until I a=
m able to individually test the different pieces of the close() operation, =
I'd be very surprised if a batch that adds just 3 new documents results in =
very much merge work being done. It seems as if there is some task happenin=
g during merge that the indexWriter is never able to successfully complete =
and so it tries to complete that task every single time close() is called.
>>
>> So, my working theory until I can dig deeper is that something is mildly=
 corrupt with the index (though not serious enough to affect most operation=
s on the index). Are there any good utilities for examining the health of a=
n index?
>>
>> I've dabbled with the experimental checkIndex object in the past (before=
 we upgraded to 3.0), but have found it to be incredibly slow and of margin=
al value. Does anyone have any experience using CheckIndex to track down an=
 issue with a production index?
>>
>> Thanks again!
>> Mark
>>
>> On Nov 2, 2010, at 2:20 AM, Shai Erera wrote:
>>
>>> When you close IndexWriter, it performs several operations that might h=
ave a
>>> connection to the problem you describe:
>>>
>>> * Commit all the pending updates -- if your update batch size is more o=
r
>>> less the same (i.e., comparable # of docs and total # bytes indexed), t=
hen
>>> you should not see a performance difference between closes.
>>>
>>> * Consults the MergePolicy and runs any merges it returns as candidates=
.
>>>
>>> * Waits for the merges to finish.
>>>
>>> Roughly, IndexWriter.close() can be substituted w/:
>>> writer.commit(false); // commits the changes, but does not run merges.
>>> writer.maybeMerge(); // runs merges returned by MergePolicy.
>>> writer.waitForMerges(); // if you use ConcurrentMergeScheduler, the abo=
ve
>>> call returns immediately, not waiting for the merges to finish.
>>> writer.close(); // at this point, commit + merging has finished, so it =
does
>>> very little.
>>>
>>> As your index grows in size, so does its # of segments, and the segment=
s
>>> size as well. So tweaking some parameters on the MergePolicy (such as
>>> mergeFactor, maxMergeMB etc.) can result in not attempting to merge too
>>> large segments.
>>>
>>> Alternatively, you can try the following:
>>>
>>> 1) Replace the call to writer.close() w/ the above sequence. Then, meas=
ure
>>> each call and report back which of them takes the suspicious amount of =
time.
>>>
>>> 2) Not running optimize() on a regular basis doesn't mean merges don't
>>> happen in the background. So if you want close() to return as fast as
>>> possible, you should call close(false). Note though that from time to t=
ime
>>> you should allow merges to finish, in order to reduce the # of segments=
.
>>>
>>> 3) If you want to control when the merges are run, you can open IndexWr=
iter
>>> with NoMergePolicy, which always returns 0 merges to perform, or
>>> NoMergeScheduler which never executes merges. But be aware that this is
>>> dangerous as the # of segments in the index will continue to grow and s=
earch
>>> performance will degrade.
>>>
>>> The answers above is relevant for 3x, but most of them are also relevan=
t for
>>> 2.9. If you have an older version of Lucene, then some of the solutions
>>> might still apply (such as close(false)).
>>>
>>> Hope this helps,
>>> Shai
>>>
>>> On Tue, Nov 2, 2010 at 12:55 AM, Mark Kristensson <
>>> mark.kristensson@smartsheet.com> wrote:
>>>
>>>> Hello,
>>>>
>>>> One of our =A0Lucene indexes has started misbehaving on indexWriter.cl=
ose and
>>>> I'm searching for ideas about what may have happened and how to fix it=
.
>>>>
>>>> Here's our scenario:
>>>> - We have seven Lucene indexes that contain different sets of data fro=
m a
>>>> web application are indexed for searching by end users
>>>> - A java service runs twice a minute to pull changes from SQL DB queue
>>>> tables and update the relevant Lucene index(es)
>>>> - The two largest indexes (3.4GB and 3.8GB in size with 8 million and =
6
>>>> million records, respectively) contain similar sets of data, but are
>>>> structured differently for different consumption (e.g. one has an All =
field
>>>> for general purpose searching, the other does not; one has numeric fie=
lds
>>>> for ranges, the other does not, etc.)
>>>> - We expunge deletes from our indexes twice per day
>>>> - A =A0couple of weeks ago, one of the two large indexes became very s=
low to
>>>> close after each round of changes is applied by our indexing service.
>>>> Specifically, all of our indexes usually close in no more than 200
>>>> milliseconds, but this one index is now taking 6 to 8 seconds to close=
 with
>>>> every single pass (and is leading to delays which are affecting end us=
ers).
>>>>
>>>> Questions from my attempts to troubleshoot the problem:
>>>> - Has anyone else seen behavior similar to this? What did you do to re=
solve
>>>> it?
>>>> - Does the size of an index or its documents (record count, disk size,=
 avg
>>>> document size, max document size, etc.) have any correlation to the le=
ngth
>>>> of time it takes to close an index?
>>>> - We are not currently optimizing any of our indexes on a regular basi=
s,
>>>> could that have any impact upon indexing operations (e.g.
>>>> indexWriter.close())? My understanding is that optimization only affec=
ts
>>>> search performance, not indexing performance and to date we have not s=
een
>>>> any need to optimize based upon the performance of the search queries.
>>>>
>>>> Thanks,
>>>> Mark
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47697-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 19:03:25 2010
Return-Path: <java-user-return-47697-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47536 invoked from network); 3 Nov 2010 19:03:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 19:03:25 -0000
Received: (qmail 59303 invoked by uid 500); 3 Nov 2010 19:03:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59238 invoked by uid 500); 3 Nov 2010 19:03:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59225 invoked by uid 99); 3 Nov 2010 19:03:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 19:03:54 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 19:03:47 +0000
Received: by wwb39 with SMTP id 39so966903wwb.5
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 12:03:26 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.19.134 with SMTP id n6mr467206wen.9.1288811005682; Wed, 03
 Nov 2010 12:03:25 -0700 (PDT)
Received: by 10.216.93.14 with HTTP; Wed, 3 Nov 2010 12:03:25 -0700 (PDT)
In-Reply-To: <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
Date: Wed, 3 Nov 2010 15:03:25 -0400
Message-ID: <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Can you run CheckIndex (command line tool) and post the output?

How long does it take to open a reader on this same index, and perform
a simple query (eg TermQuery)?

Mike

On Wed, Nov 3, 2010 at 2:53 PM, Mark Kristensson
<mark.kristensson@smartsheet.com> wrote:
> I've successfully reproduced the issue in our lab with a copy from produc=
tion and have broken the close() call into parts, as suggested, with one ad=
dition.
>
> Previously, the call was simply
>
> =A0 =A0 =A0 =A0...
> =A0 =A0 =A0 =A0} finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0// Close
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (indexWriter !=3D null) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.close();
> =A0 =A0 =A0 =A0...
>
>
> Now, that is broken into the various parts, including a prepareCommit();
>
> =A0 =A0 =A0 =A0...
> =A0 =A0 =A0 =A0} finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0// Close
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (indexWriter !=3D null) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.prepareCommit();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("prepareCommit() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.commit();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("commit() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.maybeMerge();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("maybeMerge() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.waitForMerges();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.deb=
ug("waitForMerges() complete");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrite=
r.close();
> =A0 =A0 =A0 =A0...
>
>
> It turns out that the prepareCommit() is the slow call here, taking sever=
al seconds to complete.
>
> I've done some reading about it, but have not found anything that might b=
e helpful here. The fact that it is slow every single time, even when I'm a=
dding exactly one document to the index, is perplexing and leads to me to t=
hink something must be corrupt with the index.
>
> Furthermore, I tried optimizing the index to see if that would have any i=
mpact (I wasn't expecting much) and it did not.
>
> I'm stumped at this point and am thinking I may have to rebuild the index=
, though I would definitely prefer to avoid doing that and would like to kn=
ow why this is happening.
>
> Thanks for your help,
> Mark
>
>
> On Nov 2, 2010, at 9:26 AM, Mark Kristensson wrote:
>
>>
>> Wonderful information on what happens during indexWriter.close(), thank =
you very much! I've got some testing to do as a result.
>>
>> We are on Lucene 3.0.0 right now.
>>
>> One other detail that I neglected to mention is that the batch size does=
 not seem to have any relation to the time it takes to close on the index w=
here we are having issues. We've had batches add as few as 3 documents and =
batches add as many as 2500 documents in the last hour and every single clo=
se() call for that index takes 6 to 8 seconds. While I won't know until I a=
m able to individually test the different pieces of the close() operation, =
I'd be very surprised if a batch that adds just 3 new documents results in =
very much merge work being done. It seems as if there is some task happenin=
g during merge that the indexWriter is never able to successfully complete =
and so it tries to complete that task every single time close() is called.
>>
>> So, my working theory until I can dig deeper is that something is mildly=
 corrupt with the index (though not serious enough to affect most operation=
s on the index). Are there any good utilities for examining the health of a=
n index?
>>
>> I've dabbled with the experimental checkIndex object in the past (before=
 we upgraded to 3.0), but have found it to be incredibly slow and of margin=
al value. Does anyone have any experience using CheckIndex to track down an=
 issue with a production index?
>>
>> Thanks again!
>> Mark
>>
>> On Nov 2, 2010, at 2:20 AM, Shai Erera wrote:
>>
>>> When you close IndexWriter, it performs several operations that might h=
ave a
>>> connection to the problem you describe:
>>>
>>> * Commit all the pending updates -- if your update batch size is more o=
r
>>> less the same (i.e., comparable # of docs and total # bytes indexed), t=
hen
>>> you should not see a performance difference between closes.
>>>
>>> * Consults the MergePolicy and runs any merges it returns as candidates=
.
>>>
>>> * Waits for the merges to finish.
>>>
>>> Roughly, IndexWriter.close() can be substituted w/:
>>> writer.commit(false); // commits the changes, but does not run merges.
>>> writer.maybeMerge(); // runs merges returned by MergePolicy.
>>> writer.waitForMerges(); // if you use ConcurrentMergeScheduler, the abo=
ve
>>> call returns immediately, not waiting for the merges to finish.
>>> writer.close(); // at this point, commit + merging has finished, so it =
does
>>> very little.
>>>
>>> As your index grows in size, so does its # of segments, and the segment=
s
>>> size as well. So tweaking some parameters on the MergePolicy (such as
>>> mergeFactor, maxMergeMB etc.) can result in not attempting to merge too
>>> large segments.
>>>
>>> Alternatively, you can try the following:
>>>
>>> 1) Replace the call to writer.close() w/ the above sequence. Then, meas=
ure
>>> each call and report back which of them takes the suspicious amount of =
time.
>>>
>>> 2) Not running optimize() on a regular basis doesn't mean merges don't
>>> happen in the background. So if you want close() to return as fast as
>>> possible, you should call close(false). Note though that from time to t=
ime
>>> you should allow merges to finish, in order to reduce the # of segments=
.
>>>
>>> 3) If you want to control when the merges are run, you can open IndexWr=
iter
>>> with NoMergePolicy, which always returns 0 merges to perform, or
>>> NoMergeScheduler which never executes merges. But be aware that this is
>>> dangerous as the # of segments in the index will continue to grow and s=
earch
>>> performance will degrade.
>>>
>>> The answers above is relevant for 3x, but most of them are also relevan=
t for
>>> 2.9. If you have an older version of Lucene, then some of the solutions
>>> might still apply (such as close(false)).
>>>
>>> Hope this helps,
>>> Shai
>>>
>>> On Tue, Nov 2, 2010 at 12:55 AM, Mark Kristensson <
>>> mark.kristensson@smartsheet.com> wrote:
>>>
>>>> Hello,
>>>>
>>>> One of our =A0Lucene indexes has started misbehaving on indexWriter.cl=
ose and
>>>> I'm searching for ideas about what may have happened and how to fix it=
.
>>>>
>>>> Here's our scenario:
>>>> - We have seven Lucene indexes that contain different sets of data fro=
m a
>>>> web application are indexed for searching by end users
>>>> - A java service runs twice a minute to pull changes from SQL DB queue
>>>> tables and update the relevant Lucene index(es)
>>>> - The two largest indexes (3.4GB and 3.8GB in size with 8 million and =
6
>>>> million records, respectively) contain similar sets of data, but are
>>>> structured differently for different consumption (e.g. one has an All =
field
>>>> for general purpose searching, the other does not; one has numeric fie=
lds
>>>> for ranges, the other does not, etc.)
>>>> - We expunge deletes from our indexes twice per day
>>>> - A =A0couple of weeks ago, one of the two large indexes became very s=
low to
>>>> close after each round of changes is applied by our indexing service.
>>>> Specifically, all of our indexes usually close in no more than 200
>>>> milliseconds, but this one index is now taking 6 to 8 seconds to close=
 with
>>>> every single pass (and is leading to delays which are affecting end us=
ers).
>>>>
>>>> Questions from my attempts to troubleshoot the problem:
>>>> - Has anyone else seen behavior similar to this? What did you do to re=
solve
>>>> it?
>>>> - Does the size of an index or its documents (record count, disk size,=
 avg
>>>> document size, max document size, etc.) have any correlation to the le=
ngth
>>>> of time it takes to close an index?
>>>> - We are not currently optimizing any of our indexes on a regular basi=
s,
>>>> could that have any impact upon indexing operations (e.g.
>>>> indexWriter.close())? My understanding is that optimization only affec=
ts
>>>> search performance, not indexing performance and to date we have not s=
een
>>>> any need to optimize based upon the performance of the search queries.
>>>>
>>>> Thanks,
>>>> Mark
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47698-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 19:32:28 2010
Return-Path: <java-user-return-47698-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71273 invoked from network); 3 Nov 2010 19:32:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 19:32:28 -0000
Received: (qmail 596 invoked by uid 500); 3 Nov 2010 19:32:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 483 invoked by uid 500); 3 Nov 2010 19:32:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 472 invoked by uid 99); 3 Nov 2010 19:32:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 19:32:57 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 209.85.212.176 as permitted sender)
Received: from [209.85.212.176] (HELO mail-px0-f176.google.com) (209.85.212.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 19:32:50 +0000
Received: by pxi5 with SMTP id 5so31960pxi.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 12:32:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=PRTpiZuebJcpiJyYEWk+LkDmnvgX6aP1qv7GLnSg3g0=;
        b=FXe6JH1NxhGb6gIBWSjEJbSMGEHDebTjAIDknOsiGRzSDjcZY842kvyV74qtLMIRKl
         BN7lLGvcwqXsselnbqs7tx0mWMSvi3hhi0G+dn7t5HNPPf6+qi+EhWnW+TUMvyKpPEsN
         mvAu12mee5GUi8Pb1hiDoHN3GFzQAtKZGf4wY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=ZxyFJ8EQzHHT1U139Mdr3Bi1t9VuOttCcNno0LdMiS9MSdnEcLZ8voUxy39MbgvkhO
         y/XvYQCvEbGfHDtTCQXs3EE+WchB7JjqhOlSEhCf2XQHmXLYO6Ok1WprcYgAm9ND9/I0
         uZYMZJMTGMKfm0bNCj0AKXVf+5dEG7NuWhVVU=
MIME-Version: 1.0
Received: by 10.142.211.21 with SMTP id j21mr6250139wfg.123.1288812749659;
 Wed, 03 Nov 2010 12:32:29 -0700 (PDT)
Received: by 10.142.200.1 with HTTP; Wed, 3 Nov 2010 12:32:29 -0700 (PDT)
In-Reply-To: <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
Date: Wed, 3 Nov 2010 21:32:29 +0200
Message-ID: <AANLkTinbD18s9+M32PNSCYs0QPjDe=4m48a8igNxcbQp@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Shai Erera <serera@gmail.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

I'd even offer, if the index is small, perhaps you can post it
somewhere for us to download and debug trace commit()=85

Also, though not very scientific, you can turn on debug messages by
setting an infoSfream and observe which print take the most to appear.
Not very accurate but if there's one operation that takes long to
complete, you'll see it.

Shai

On Wednesday, November 3, 2010, Michael McCandless
<lucene@mikemccandless.com> wrote:
> Can you run CheckIndex (command line tool) and post the output?
>
> How long does it take to open a reader on this same index, and perform
> a simple query (eg TermQuery)?
>
> Mike
>
> On Wed, Nov 3, 2010 at 2:53 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>> I've successfully reproduced the issue in our lab with a copy from produ=
ction and have broken the close() call into parts, as suggested, with one a=
ddition.
>>
>> Previously, the call was simply
>>
>> =A0 =A0 =A0 =A0...
>> =A0 =A0 =A0 =A0} finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0// Close
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (indexWriter !=3D null) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrit=
er.close();
>> =A0 =A0 =A0 =A0...
>>
>>
>> Now, that is broken into the various parts, including a prepareCommit();
>>
>> =A0 =A0 =A0 =A0...
>> =A0 =A0 =A0 =A0} finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0// Close
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (indexWriter !=3D null) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrit=
er.prepareCommit();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.de=
bug("prepareCommit() complete");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrit=
er.commit();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.de=
bug("commit() complete");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrit=
er.maybeMerge();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.de=
bug("maybeMerge() complete");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrit=
er.waitForMerges();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Logger.de=
bug("waitForMerges() complete");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexWrit=
er.close();
>> =A0 =A0 =A0 =A0...
>>
>>
>> It turns out that the prepareCommit() is the slow call here, taking seve=
ral seconds to complete.
>>
>> I've done some reading about it, but have not found anything that might =
be helpful here. The fact that it is slow every single time, even when I'm =
adding exactly one document to the index, is perplexing and leads to me to =
think something must be corrupt with the index.
>>
>> Furthermore, I tried optimizing the index to see if that would have any =
impact (I wasn't expecting much) and it did not.
>>
>> I'm stumped at this point and am thinking I may have to rebuild the inde=
x, though I would definitely prefer to avoid doing that and would like to k=
now why this is happening.
>>
>> Thanks for your help,
>> Mark
>>
>>
>> On Nov 2, 2010, at 9:26 AM, Mark Kristensson wrote:
>>
>>>
>>> Wonderful information on what happens during indexWriter.close(), thank=
 you very much! I've got some testing to do as a result.
>>>
>>> We are on Lucene 3.0.0 right now.
>>>
>>> One other detail that I neglected to mention is that the batch size doe=
s not seem to have any relation to the time it takes to close on the index =
where we are having issues. We've had batches add as few as 3 documents and=
 batches add as many as 2500 documents in the last hour and every single cl=
ose() call for that index takes 6 to 8 seconds. While I won't know until I =
am able to individually test the different pieces of the close() operation,=
 I'd be very surprised if a batch that adds just 3 new documents results in=
 very much merge work being done. It seems as if there is some task happeni=
ng during merge that the indexWriter is never able to successfully complete=
 and so it tries to complete that task every single time close() is called.
>>>
>>> So, my working theory until I can dig deeper is that something is mildl=
y corrupt with the index (though not serious enough to affect most operatio=
ns on the index). Are there any good utilities for examining the health of =
an index?
>>>
>>> I've dabbled with the experimental checkIndex object in t

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47699-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 20:28:07 2010
Return-Path: <java-user-return-47699-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2334 invoked from network); 3 Nov 2010 20:28:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 20:28:07 -0000
Received: (qmail 71451 invoked by uid 500); 3 Nov 2010 20:28:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71385 invoked by uid 500); 3 Nov 2010 20:28:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71372 invoked by uid 99); 3 Nov 2010 20:28:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 20:28:35 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 20:28:27 +0000
Received: by ywp4 with SMTP id 4so908233ywp.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 13:28:06 -0700 (PDT)
Received: by 10.100.47.1 with SMTP id u1mr2406816anu.113.1288816086147;
        Wed, 03 Nov 2010 13:28:06 -0700 (PDT)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id g29sm5777613anh.36.2010.11.03.13.27.57
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 03 Nov 2010 13:28:00 -0700 (PDT)
Content-Type: text/plain; charset=utf-8
Mime-Version: 1.0 (Apple Message framework v1081)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
Date: Wed, 3 Nov 2010 13:27:53 -0700
Content-Transfer-Encoding: quoted-printable
Message-Id: <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1081)
X-Virus-Checked: Checked by ClamAV on apache.org


I've run checkIndex against the index and the results are below. That =
net is that it's telling me nothing is wrong with the index.

I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.

Thanks for your help,
Mark

-----------------------------------

Segments file=3Dsegments_9hir numSegments=3D4 version=3DFORMAT_DIAGNOSTICS=
 [Lucene 2.9]
  1 of 4: name=3D_aiaz docCount=3D5886773
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D3,628.377
    diagnostics =3D {optimize=3Dtrue, mergeFactor=3D4, =
os.version=3D2.6.18-194.17.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_aiaz_1.del]
    test: open reader.........OK [1 deleted docs]
    test: fields..............OK [296713 fields]
    test: field norms.........OK [296713 fields]
    test: terms, freq, prox...OK [43933037 terms; 669926342 terms/docs =
pairs; 669957608 tokens]
    test: stored fields.......OK [173363203 total field count; avg 29.45 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  2 of 4: name=3D_aib0 docCount=3D1
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D0.002
    diagnostics =3D {os.version=3D2.6.18-194.17.1.el5, os=3DLinux, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dflush, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_aib0_1.del]
    test: open reader.........OK [1 deleted docs]
    test: fields..............OK [28 fields]
    test: field norms.........OK [28 fields]
    test: terms, freq, prox...OK [79 terms; 79 terms/docs pairs; 0 =
tokens]
    test: stored fields.......OK [0 total field count; avg =EF=BF=BD =
fields per doc]
    test: term vectors........OK [0 total vector count; avg =EF=BF=BD =
term/freq vector fields per doc]

  3 of 4: name=3D_aib1 docCount=3D3
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D1
    size (MB)=3D0.003
    diagnostics =3D {os.version=3D2.6.18-194.17.1.el5, os=3DLinux, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dflush, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    no deletions
    test: open reader.........OK
    test: fields..............OK [28 fields]
    test: field norms.........OK [28 fields]
    test: terms, freq, prox...OK [109 terms; 237 terms/docs pairs; 237 =
tokens]
    test: stored fields.......OK [60 total field count; avg 20 fields =
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  4 of 4: name=3D_aib2 docCount=3D1
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D1
    size (MB)=3D0.002
    diagnostics =3D {os.version=3D2.6.18-194.17.1.el5, os=3DLinux, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dflush, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    no deletions
    test: open reader.........OK
    test: fields..............OK [28 fields]
    test: field norms.........OK [28 fields]
    test: terms, freq, prox...OK [79 terms; 79 terms/docs pairs; 79 =
tokens]
    test: stored fields.......OK [20 total field count; avg 20 fields =
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

No problems were detected with this index.



On Nov 3, 2010, at 12:03 PM, Michael McCandless wrote:

> Can you run CheckIndex (command line tool) and post the output?
>=20
> How long does it take to open a reader on this same index, and perform
> a simple query (eg TermQuery)?
>=20
> Mike
>=20
> On Wed, Nov 3, 2010 at 2:53 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>> I've successfully reproduced the issue in our lab with a copy from =
production and have broken the close() call into parts, as suggested, =
with one addition.
>>=20
>> Previously, the call was simply
>>=20
>>        ...
>>        } finally {
>>                // Close
>>                if (indexWriter !=3D null) {
>>                        try {
>>                                indexWriter.close();
>>        ...
>>=20
>>=20
>> Now, that is broken into the various parts, including a =
prepareCommit();
>>=20
>>        ...
>>        } finally {
>>                // Close
>>                if (indexWriter !=3D null) {
>>                        try {
>>                                indexWriter.prepareCommit();
>>                                Logger.debug("prepareCommit() =
complete");
>>                                indexWriter.commit();
>>                                Logger.debug("commit() complete");
>>                                indexWriter.maybeMerge();
>>                                Logger.debug("maybeMerge() complete");
>>                                indexWriter.waitForMerges();
>>                                Logger.debug("waitForMerges() =
complete");
>>                                indexWriter.close();
>>        ...
>>=20
>>=20
>> It turns out that the prepareCommit() is the slow call here, taking =
several seconds to complete.
>>=20
>> I've done some reading about it, but have not found anything that =
might be helpful here. The fact that it is slow every single time, even =
when I'm adding exactly one document to the index, is perplexing and =
leads to me to think something must be corrupt with the index.
>>=20
>> Furthermore, I tried optimizing the index to see if that would have =
any impact (I wasn't expecting much) and it did not.
>>=20
>> I'm stumped at this point and am thinking I may have to rebuild the =
index, though I would definitely prefer to avoid doing that and would =
like to know why this is happening.
>>=20
>> Thanks for your help,
>> Mark
>>=20
>>=20
>> On Nov 2, 2010, at 9:26 AM, Mark Kristensson wrote:
>>=20
>>>=20
>>> Wonderful information on what happens during indexWriter.close(), =
thank you very much! I've got some testing to do as a result.
>>>=20
>>> We are on Lucene 3.0.0 right now.
>>>=20
>>> One other detail that I neglected to mention is that the batch size =
does not seem to have any relation to the time it takes to close on the =
index where we are having issues. We've had batches add as few as 3 =
documents and batches add as many as 2500 documents in the last hour and =
every single close() call for that index takes 6 to 8 seconds. While I =
won't know until I am able to individually test the different pieces of =
the close() operation, I'd be very surprised if a batch that adds just 3 =
new documents results in very much merge work being done. It seems as if =
there is some task happening during merge that the indexWriter is never =
able to successfully complete and so it tries to complete that task =
every single time close() is called.
>>>=20
>>> So, my working theory until I can dig deeper is that something is =
mildly corrupt with the index (though not serious enough to affect most =
operations on the index). Are there any good utilities for examining the =
health of an index?
>>>=20
>>> I've dabbled with the experimental checkIndex object in the past =
(before we upgraded to 3.0), but have found it to be incredibly slow and =
of marginal value. Does anyone have any experience using CheckIndex to =
track down an issue with a production index?
>>>=20
>>> Thanks again!
>>> Mark
>>>=20
>>> On Nov 2, 2010, at 2:20 AM, Shai Erera wrote:
>>>=20
>>>> When you close IndexWriter, it performs several operations that =
might have a
>>>> connection to the problem you describe:
>>>>=20
>>>> * Commit all the pending updates -- if your update batch size is =
more or
>>>> less the same (i.e., comparable # of docs and total # bytes =
indexed), then
>>>> you should not see a performance difference between closes.
>>>>=20
>>>> * Consults the MergePolicy and runs any merges it returns as =
candidates.
>>>>=20
>>>> * Waits for the merges to finish.
>>>>=20
>>>> Roughly, IndexWriter.close() can be substituted w/:
>>>> writer.commit(false); // commits the changes, but does not run =
merges.
>>>> writer.maybeMerge(); // runs merges returned by MergePolicy.
>>>> writer.waitForMerges(); // if you use ConcurrentMergeScheduler, the =
above
>>>> call returns immediately, not waiting for the merges to finish.
>>>> writer.close(); // at this point, commit + merging has finished, so =
it does
>>>> very little.
>>>>=20
>>>> As your index grows in size, so does its # of segments, and the =
segments
>>>> size as well. So tweaking some parameters on the MergePolicy (such =
as
>>>> mergeFactor, maxMergeMB etc.) can result in not attempting to merge =
too
>>>> large segments.
>>>>=20
>>>> Alternatively, you can try the following:
>>>>=20
>>>> 1) Replace the call to writer.close() w/ the above sequence. Then, =
measure
>>>> each call and report back which of them takes the suspicious amount =
of time.
>>>>=20
>>>> 2) Not running optimize() on a regular basis doesn't mean merges =
don't
>>>> happen in the background. So if you want close() to return as fast =
as
>>>> possible, you should call close(false). Note though that from time =
to time
>>>> you should allow merges to finish, in order to reduce the # of =
segments.
>>>>=20
>>>> 3) If you want to control when the merges are run, you can open =
IndexWriter
>>>> with NoMergePolicy, which always returns 0 merges to perform, or
>>>> NoMergeScheduler which never executes merges. But be aware that =
this is
>>>> dangerous as the # of segments in the index will continue to grow =
and search
>>>> performance will degrade.
>>>>=20
>>>> The answers above is relevant for 3x, but most of them are also =
relevant for
>>>> 2.9. If you have an older version of Lucene, then some of the =
solutions
>>>> might still apply (such as close(false)).
>>>>=20
>>>> Hope this helps,
>>>> Shai
>>>>=20
>>>> On Tue, Nov 2, 2010 at 12:55 AM, Mark Kristensson <
>>>> mark.kristensson@smartsheet.com> wrote:
>>>>=20
>>>>> Hello,
>>>>>=20
>>>>> One of our  Lucene indexes has started misbehaving on =
indexWriter.close and
>>>>> I'm searching for ideas about what may have happened and how to =
fix it.
>>>>>=20
>>>>> Here's our scenario:
>>>>> - We have seven Lucene indexes that contain different sets of data =
from a
>>>>> web application are indexed for searching by end users
>>>>> - A java service runs twice a minute to pull changes from SQL DB =
queue
>>>>> tables and update the relevant Lucene index(es)
>>>>> - The two largest indexes (3.4GB and 3.8GB in size with 8 million =
and 6
>>>>> million records, respectively) contain similar sets of data, but =
are
>>>>> structured differently for different consumption (e.g. one has an =
All field
>>>>> for general purpose searching, the other does not; one has numeric =
fields
>>>>> for ranges, the other does not, etc.)
>>>>> - We expunge deletes from our indexes twice per day
>>>>> - A  couple of weeks ago, one of the two large indexes became very =
slow to
>>>>> close after each round of changes is applied by our indexing =
service.
>>>>> Specifically, all of our indexes usually close in no more than 200
>>>>> milliseconds, but this one index is now taking 6 to 8 seconds to =
close with
>>>>> every single pass (and is leading to delays which are affecting =
end users).
>>>>>=20
>>>>> Questions from my attempts to troubleshoot the problem:
>>>>> - Has anyone else seen behavior similar to this? What did you do =
to resolve
>>>>> it?
>>>>> - Does the size of an index or its documents (record count, disk =
size, avg
>>>>> document size, max document size, etc.) have any correlation to =
the length
>>>>> of time it takes to close an index?
>>>>> - We are not currently optimizing any of our indexes on a regular =
basis,
>>>>> could that have any impact upon indexing operations (e.g.
>>>>> indexWriter.close())? My understanding is that optimization only =
affects
>>>>> search performance, not indexing performance and to date we have =
not seen
>>>>> any need to optimize based upon the performance of the search =
queries.
>>>>>=20
>>>>> Thanks,
>>>>> Mark
>>>>> =
---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>=20
>>>>>=20
>>>=20
>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47700-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 21:02:46 2010
Return-Path: <java-user-return-47700-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21090 invoked from network); 3 Nov 2010 21:02:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 21:02:46 -0000
Received: (qmail 33099 invoked by uid 500); 3 Nov 2010 21:03:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32875 invoked by uid 500); 3 Nov 2010 21:03:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32867 invoked by uid 99); 3 Nov 2010 21:03:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 21:03:13 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 21:03:06 +0000
Received: by wwb39 with SMTP id 39so1162073wwb.5
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 14:02:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.187.82 with SMTP id x60mr53207wem.9.1288818165803; Wed, 03
 Nov 2010 14:02:45 -0700 (PDT)
Received: by 10.216.93.14 with HTTP; Wed, 3 Nov 2010 14:02:45 -0700 (PDT)
In-Reply-To: <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
Date: Wed, 3 Nov 2010 17:02:45 -0400
Message-ID: <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
<mark.kristensson@smartsheet.com> wrote:
>
> I've run checkIndex against the index and the results are below. That net=
 is that it's telling me nothing is wrong with the index.

Thanks.

> I did not have any instrumentation around the opening of the IndexSearche=
r (we don't use an IndexReader), just around the actual query execution so =
I had to add some additional logging. What I found surprised me, opening a =
search against this index takes the same 6 to 8 seconds that closing the in=
dexWriter takes.

IndexWriter opens a SegmentReader for each segment in the index, to
apply deletions, so I think this is the source of the slowness.

>From the CheckIndex output, it looks like you have many (296,713)
unique fields names on that one large segment -- does that sound
right?  I suspect such a very high field count is the source of the
slowness...

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47701-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 03 23:37:27 2010
Return-Path: <java-user-return-47701-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70349 invoked from network); 3 Nov 2010 23:37:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 3 Nov 2010 23:37:27 -0000
Received: (qmail 70383 invoked by uid 500); 3 Nov 2010 23:37:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70338 invoked by uid 500); 3 Nov 2010 23:37:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70330 invoked by uid 99); 3 Nov 2010 23:37:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 23:37:55 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 03 Nov 2010 23:37:49 +0000
Received: by gyf2 with SMTP id 2so1003210gyf.35
        for <java-user@lucene.apache.org>; Wed, 03 Nov 2010 16:37:27 -0700 (PDT)
Received: by 10.100.143.4 with SMTP id q4mr2573808and.21.1288827447619;
        Wed, 03 Nov 2010 16:37:27 -0700 (PDT)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id g18sm5963000anh.18.2010.11.03.16.37.20
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 03 Nov 2010 16:37:23 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1081)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
Date: Wed, 3 Nov 2010 16:37:15 -0700
Content-Transfer-Encoding: quoted-printable
Message-Id: <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1081)

Yes, we do have a large number of unique field names in that index, =
because they are driven by user named fields in our application (with =
some cleaning to remove illegal chars).

This slowness problem has appeared very suddenly in the last couple of =
weeks and the number of unique field names has not spiked in the last =
few weeks. Have we crept over some threshold with our linear growth in =
the number of unique field names? Perhaps there is a limit driven by the =
amount of RAM in the machine that we are violating? Are there any =
guidelines for the maximum number, or suggested number, of unique fields =
names in an index or segment? Any suggestions for potentially mitigating =
the problem?=20

Thanks,
Mark


On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:

> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>>=20
>> I've run checkIndex against the index and the results are below. That =
net is that it's telling me nothing is wrong with the index.
>=20
> Thanks.
>=20
>> I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.
>=20
> IndexWriter opens a SegmentReader for each segment in the index, to
> apply deletions, so I think this is the source of the slowness.
>=20
> =46rom the CheckIndex output, it looks like you have many (296,713)
> unique fields names on that one large segment -- does that sound
> right?  I suspect such a very high field count is the source of the
> slowness...
>=20
> Mike
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47702-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 08:47:50 2010
Return-Path: <java-user-return-47702-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95918 invoked from network); 4 Nov 2010 08:47:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 08:47:50 -0000
Received: (qmail 60278 invoked by uid 500); 4 Nov 2010 08:48:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59387 invoked by uid 500); 4 Nov 2010 08:48:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 12572 invoked by uid 99); 4 Nov 2010 07:54:21 -0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Thu, 4 Nov 2010 00:53:55 -0700 (PDT)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1288857235054-1839942.post@n3.nabble.com>
Subject: High frequency term for the searched query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


I need to find the most frequent terms that are appeared with a query. 

HighFreqTerms.java can be used only to obtain the high frequency terms in
the whole index. 

I need just to find the high frequency terms to the submitted query. 

What I do now is:

I search the index with the query and retrieve the relevant documents then
save those documents in a new folder then index them. At the end I use
HighFreqTerms.java in the new index so I can find the most frequent terms to
the query. However, this is very slow and need long time to run.

Any idea how I can do this task efficiently 


Thanks in advance

-- 
View this message in context: http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1839942.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47703-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 08:47:59 2010
Return-Path: <java-user-return-47703-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95980 invoked from network); 4 Nov 2010 08:47:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 08:47:58 -0000
Received: (qmail 62138 invoked by uid 500); 4 Nov 2010 08:48:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62057 invoked by uid 500); 4 Nov 2010 08:48:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 45475 invoked by uid 99); 4 Nov 2010 08:29:13 -0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of carmitsp@gmail.com designates 209.85.216.48 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=y77xl9/45TOL36SrW89sBZsxs72UuTxG55tzDnWGzUk=;
        b=Wyec4mG9tQNd+hcJCZ9PadhbjSvRz2Je5nWdLFPhcTk5bV7yiw/LHMBIflD666/b4B
         T+x0qCeZ99cLmnyjK4CXTjm//lraQnpe/x4NyMl41+p553DPVsrp4gE4JbAgTontQGeG
         40oXfZ/6srEYIqfqE6YQtaj9JLtXbGMd+t6jA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=vwIs9EOl9WTnUbXsLBTfuAcrMyiKCFZUyGpyK4Pn44VpDZgvdWQOgpbG+qcEdKsmT/
         KExX5v4e5ALP2KwLIvvZO6Mqty0DVuagKyH20MISPGtStnfZ8lnm8p2/yVzE/wfgRbp7
         0WGJf23we+guKOQsnvShrWOqc5ymMQeZvuB/M=
MIME-Version: 1.0
From: Carmit Sahar <carmitsp@gmail.com>
Date: Thu, 4 Nov 2010 10:27:25 +0200
Message-ID: <AANLkTin-D7yNkYKY01puY_scc17UtsY4rcaXuJ0o6EHc@mail.gmail.com>
Subject: Weird document equals and hash through IndexReader & IndexSearcher
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd294742387ce049435f29e

--000e0cd294742387ce049435f29e
Content-Type: text/plain; charset=ISO-8859-1

Hi,

I have a weird result:
If I access the same document through the IndexReader or IndexSearcher, they
are not equal and have different hash values:

                Document doc1 = indexSearcher.doc(i);
                Document doc2 = indexSearcher.getIndexReader().document(i);
                System.out.println("    Equal: " + doc1.equals(doc2) + ",
Hash: " + doc1.hashCode() + ", " + doc2.hashCode() + ", num:" + i);

I'm using Lucene 3.0.2
(No multithreads, nobody is simultaneously updating the index)
What am I missing?
Thanks
Carmit
(Could you please forward your answers to my private address as well?)

--000e0cd294742387ce049435f29e--

From java-user-return-47704-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 08:58:26 2010
Return-Path: <java-user-return-47704-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98768 invoked from network); 4 Nov 2010 08:58:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 08:58:26 -0000
Received: (qmail 69968 invoked by uid 500); 4 Nov 2010 08:58:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69898 invoked by uid 500); 4 Nov 2010 08:58:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69890 invoked by uid 99); 4 Nov 2010 08:58:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 08:58:55 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 08:58:49 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id B650945FA41
	for <java-user@lucene.apache.org>; Thu,  4 Nov 2010 09:58:27 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 9S+LBM8AkbY2 for <java-user@lucene.apache.org>;
	Thu,  4 Nov 2010 09:58:25 +0100 (CET)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.78])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 3C3EF45FA40
	for <java-user@lucene.apache.org>; Thu,  4 Nov 2010 09:58:25 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTin-D7yNkYKY01puY_scc17UtsY4rcaXuJ0o6EHc@mail.gmail.com>
In-Reply-To: <AANLkTin-D7yNkYKY01puY_scc17UtsY4rcaXuJ0o6EHc@mail.gmail.com>
Subject: RE: Weird document equals and hash through IndexReader & IndexSearcher
Date: Thu, 4 Nov 2010 09:58:28 +0100
Message-ID: <002c01cb7bfe$7327aa00$5976fe00$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQI/bvfFVwrSauZbTshV3tHIq2DJ0JJ5Hl2g
Content-Language: de

Hi Carmit,

equals and hashCode is not implemented for oal.document.Document, so two
instances always compare not to each other. The same happens if you retrieve
the document two times from same IndexReader.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Carmit Sahar [mailto:carmitsp@gmail.com]
> Sent: Thursday, November 04, 2010 9:27 AM
> To: java-user@lucene.apache.org
> Subject: Weird document equals and hash through IndexReader &
> IndexSearcher
> 
> Hi,
> 
> I have a weird result:
> If I access the same document through the IndexReader or IndexSearcher,
they
> are not equal and have different hash values:
> 
>                 Document doc1 = indexSearcher.doc(i);
>                 Document doc2 =
indexSearcher.getIndexReader().document(i);
>                 System.out.println("    Equal: " + doc1.equals(doc2) + ",
> Hash: " + doc1.hashCode() + ", " + doc2.hashCode() + ", num:" + i);
> 
> I'm using Lucene 3.0.2
> (No multithreads, nobody is simultaneously updating the index) What am I
> missing?
> Thanks
> Carmit
> (Could you please forward your answers to my private address as well?)


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47705-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 09:07:27 2010
Return-Path: <java-user-return-47705-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8622 invoked from network); 4 Nov 2010 09:07:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 09:07:27 -0000
Received: (qmail 77264 invoked by uid 500); 4 Nov 2010 09:07:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76747 invoked by uid 500); 4 Nov 2010 09:07:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76737 invoked by uid 99); 4 Nov 2010 09:07:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 09:07:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of tropicano@gmail.com designates 209.85.213.176 as permitted sender)
Received: from [209.85.213.176] (HELO mail-yx0-f176.google.com) (209.85.213.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 09:07:44 +0000
Received: by yxn22 with SMTP id 22so1328411yxn.35
        for <java-user@lucene.apache.org>; Thu, 04 Nov 2010 02:07:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to:date
         :message-id:subject:from:to:content-type;
        bh=wOk/Lpe3dUGRipXfb3HYdMD78oSgmjm1x1VSARh7Us8=;
        b=I6HgHFQi0E9mKk1TRGv6E0NtnTY4H4PZtTJR+1PJv8S3QZ8w2+ZzcGuKhvLu1V/BI4
         fWQJFQKknytsvamsIE5pP4nqPj+XEc0NQBJaCpCl6+oYlJiLyb2dLJ4/9KTGs0MXhuKT
         +sHkJhtJUvKOGdBdjmwwGFQw0Plc93CurDoFo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:reply-to:date:message-id:subject:from:to:content-type;
        b=DE7k5uGdq2VQa1bZ/P+zMiQCtkTLG/e4Ul0Jgqi2j/YIFgRrnYy+SB5k/YfudQTEB8
         8YQuj8bS1SZP4KaoFhAKHPKMi2uaHenkBYEMmrDR0CflfKP9b6QDqdJiLMpot/lnSbrZ
         ZC+iMi2DLRxbq9ONJKuc0cLZmJ4zORescuKSo=
MIME-Version: 1.0
Received: by 10.42.30.139 with SMTP id v11mr164441icc.35.1288861643825; Thu,
 04 Nov 2010 02:07:23 -0700 (PDT)
Received: by 10.220.18.3 with HTTP; Thu, 4 Nov 2010 02:07:23 -0700 (PDT)
Reply-To: tropicano@gmail.com
Date: Thu, 4 Nov 2010 10:07:23 +0100
Message-ID: <AANLkTimVfiKGV-sGbvBE8e9kJKHJZdDMyJrUDzpUmebx@mail.gmail.com>
Subject: Question about custom Analyzer
From: heikki <tropicano@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf304271b071e1150494367c4f

--20cf304271b071e1150494367c4f
Content-Type: text/plain; charset=UTF-8

hello Lucene list,

I have a question about a custom Analyzer we're trying to write. The
intention is that it tokenizes on whitespace, and abstracts over
upper/lowercase and accented characters. It is used both when indexing
documents, and before creating lucene queries from search terms.

I have 2 implementations. The first one seems to work only correctly if the
index is rebuilt after we add something to the index. If we do not rebuild,
the newly added document is not found when you search for it. I've no idea
what could cause this behaviour. I'm posting its code below, called "Attempt
A".

The second implementation seems to work better. Using it, newly indexed
documents are immediately findable, without first rebuilding the index. It
also seems to abstract over upper/lowercase, and in my colleague's tests
(but not in mine) seems to abstract over accented characters. I'm posting
its code below, called "Attempt B".

We do not understand why our first implementation "Attempt A" behaves like
it does. We also do not understand why the second implementation "Attempt B"
improves on that, and whether that implementation actually fulfills our
goals (seeing the different test results we got).

So I'd very much appreciate it if someone could help us understand this, and
tell us if we're taking the right approach here to achieve this seemingly
simple goal.


Kind regards
Heikki Doeleman

===============================================
Attempt A :

public final class GeoNetworkAnalyzer extends Analyzer {

         @Override
         public TokenStream tokenStream(String fieldName, Reader reader) {
             TokenStream ts = new WhitespaceTokenizer(reader);
             ts = new LowerCaseFilter(ts);
             ts = new ASCIIFoldingFilter(ts);
             return ts;
         }

         @Override
         public TokenStream reusableTokenStream(String fieldName, Reader
reader) throws IOException {
           TokenStream ts = (TokenStream) getPreviousTokenStream();
           if (ts == null) {
             ts = tokenStream(null, reader);
             setPreviousTokenStream(ts);
           }
           else {
             ts.reset();
           }
           return ts;
         }
}

=================================================
Attempt B :

public final class GeoNetworkAnalyzer extends Analyzer {

    @Override
    public TokenStream tokenStream(String fieldName, Reader reader) {
        return new ASCIIFoldingFilter(new LowerCaseFilter(new
WhitespaceTokenizer(reader)));
    }

    @Override
    public TokenStream reusableTokenStream(String fieldName, Reader reader)
throws IOException {
        Tokenizer tokenizer = (Tokenizer) getPreviousTokenStream();
        if (tokenizer == null) {
            tokenizer = new WhitespaceTokenizer(reader);
            setPreviousTokenStream(tokenizer);
        } else
            tokenizer.reset(reader);
        return tokenizer;
    }
}

=================================================

--20cf304271b071e1150494367c4f--

From java-user-return-47706-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 09:30:59 2010
Return-Path: <java-user-return-47706-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14496 invoked from network); 4 Nov 2010 09:30:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 09:30:59 -0000
Received: (qmail 2171 invoked by uid 500); 4 Nov 2010 09:31:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1859 invoked by uid 500); 4 Nov 2010 09:31:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 89713 invoked by uid 99); 4 Nov 2010 09:20:55 -0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of carmitsp@gmail.com designates 209.85.213.48 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=TdvgWuuQ3RHjKgAa6TExFlZsKbRp4D5V+3XU2dtQEWs=;
        b=JorgI69Q/l/UIzMQ4BD0QGI8Zqs3LJhY2ocpRDDiZYsZ0rK9VpEkisN3fUmaWdvqjS
         6Gsk1lN6AkUlYvPMe89hFTeIQE2yLnRyf0juSlTUijE3kTPOLpFUiNLViaPeJDyuFRVf
         fL5T5tRiEOPQNqLYJLuWuMrXtxHZ8Cq56gFQE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=a5Selx7PDHLnOv+EWg7SnX/8G9+NGTlkIo8XGLlNr9ruvDOykg5M2qTQkkS3WHaYcO
         hjlG2FDBgDDtJRgow3lhruOIXuDi49r5A4RR9wLidrhKAHlBPI7MlGlbVEli+w6Ihj+6
         fEtw6GalvOi5kjl+/8qJEqxpMhdmxItmnkMy4=
MIME-Version: 1.0
From: Carmit Sahar <carmitsp@gmail.com>
Date: Thu, 4 Nov 2010 11:19:49 +0200
Message-ID: <AANLkTimqJ2JAoSm_cwPgszDiwjXd1AY7mZf8QZ8gqEOf@mail.gmail.com>
Subject: Weird document equals and hash through IndexReader & IndexSearcher
To: uwe@thetaphi.de, java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b7a884dcf45049436abca

--0016363b7a884dcf45049436abca
Content-Type: text/plain; charset=ISO-8859-1

Thanks, Uwe!
Indeed you're right! Whenever IndexReader is called, a new document instance is
created! And since the Document class does no override equals &
hashCode, I can't know if the same doc was

retrieved. And since Document is final, I can only write a wrapper for it.
Is this an oversight or intentional?
In any case, it's not too convenient...
Carmit


Hi Carmit,

equals and hashCode is not implemented for oal.document.Document, so two
instances always compare not to each other. The same happens if you retrieve
the document two times from same IndexReader.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremenhttp://www.thetaphi.de
<http://www.lucidimagination.com/search/out?u=http%3A%2F%2Fwww.thetaphi.de>uwe@thetaphi.de
eMail:


-----Original Message-----
From: Carmit Sahar [mailto:carmitsp@gmail.com]
Sent: Thursday, November 04, 2010 9:27 AM
To: java-user@lucene.apache.org
Subject: Weird document equals and hash through IndexReader &
IndexSearcher

Hi,

I have a weird result:
If I access the same document through the IndexReader or IndexSearcher,

they

are not equal and have different hash values:

                Document doc1 = indexSearcher.doc(i);
                Document doc2 =

indexSearcher.getIndexReader().document(i);

                System.out.println("    Equal: " + doc1.equals(doc2) + ",
Hash: " + doc1.hashCode() + ", " + doc2.hashCode() + ", num:" + i);

I'm using Lucene 3.0.2
(No multithreads, nobody is simultaneously updating the index) What am I
missing?
Thanks
Carmit
(Could you please forward your answers to my private address as well?)

--0016363b7a884dcf45049436abca--

From java-user-return-47707-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 09:56:59 2010
Return-Path: <java-user-return-47707-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19862 invoked from network); 4 Nov 2010 09:56:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 09:56:58 -0000
Received: (qmail 21607 invoked by uid 500); 4 Nov 2010 09:57:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21381 invoked by uid 500); 4 Nov 2010 09:57:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21371 invoked by uid 99); 4 Nov 2010 09:57:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 09:57:25 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 09:57:19 +0000
Received: by wyg36 with SMTP id 36so1739974wyg.35
        for <java-user@lucene.apache.org>; Thu, 04 Nov 2010 02:56:58 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.19.134 with SMTP id n6mr654386wen.9.1288864617702; Thu, 04
 Nov 2010 02:56:57 -0700 (PDT)
Received: by 10.216.93.14 with HTTP; Thu, 4 Nov 2010 02:56:57 -0700 (PDT)
In-Reply-To: <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
	<AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
	<ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
Date: Thu, 4 Nov 2010 05:56:57 -0400
Message-ID: <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Likely what happened is you had a bunch of smaller segments, and then
suddenly they got merged into that one big segment (_aiaz) in your
index.

The representation for norms in particular is not sparse, so this
means the size of the norms file for a given segment will be
number-of-unique-indexed-fields X number-of-documents.

So this count grows quadratically on merge.

Do these fields really need to be indexed?   If so, it'd be better to
use a single field for all users for the indexable text if you can.

Failing that, a simple workaround is to set the maxMergeMB/Docs on the
merge policy; this'd prevent big segments from being produced.
Disabling norms should also workaround this, though that will affect
hit scores...

Mike

On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
<mark.kristensson@smartsheet.com> wrote:
> Yes, we do have a large number of unique field names in that index, becau=
se they are driven by user named fields in our application (with some clean=
ing to remove illegal chars).
>
> This slowness problem has appeared very suddenly in the last couple of we=
eks and the number of unique field names has not spiked in the last few wee=
ks. Have we crept over some threshold with our linear growth in the number =
of unique field names? Perhaps there is a limit driven by the amount of RAM=
 in the machine that we are violating? Are there any guidelines for the max=
imum number, or suggested number, of unique fields names in an index or seg=
ment? Any suggestions for potentially mitigating the problem?
>
> Thanks,
> Mark
>
>
> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>
>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>> <mark.kristensson@smartsheet.com> wrote:
>>>
>>> I've run checkIndex against the index and the results are below. That n=
et is that it's telling me nothing is wrong with the index.
>>
>> Thanks.
>>
>>> I did not have any instrumentation around the opening of the IndexSearc=
her (we don't use an IndexReader), just around the actual query execution s=
o I had to add some additional logging. What I found surprised me, opening =
a search against this index takes the same 6 to 8 seconds that closing the =
indexWriter takes.
>>
>> IndexWriter opens a SegmentReader for each segment in the index, to
>> apply deletions, so I think this is the source of the slowness.
>>
>> From the CheckIndex output, it looks like you have many (296,713)
>> unique fields names on that one large segment -- does that sound
>> right? =A0I suspect such a very high field count is the source of the
>> slowness...
>>
>> Mike
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47708-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 10:01:43 2010
Return-Path: <java-user-return-47708-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21650 invoked from network); 4 Nov 2010 10:01:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 10:01:43 -0000
Received: (qmail 26871 invoked by uid 500); 4 Nov 2010 10:02:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26522 invoked by uid 500); 4 Nov 2010 10:02:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26505 invoked by uid 99); 4 Nov 2010 10:02:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 10:02:10 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 10:02:02 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 5EFBA45FBA2;
	Thu,  4 Nov 2010 11:01:41 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 3ZxkFn-JvOB4; Thu,  4 Nov 2010 11:01:36 +0100 (CET)
Received: from VEGA (WDC-MARE.marum.de [134.102.249.78])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 4279445FB6C;
	Thu,  4 Nov 2010 11:01:36 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>,
	<tropicano@gmail.com>
References: <AANLkTimVfiKGV-sGbvBE8e9kJKHJZdDMyJrUDzpUmebx@mail.gmail.com>
In-Reply-To: <AANLkTimVfiKGV-sGbvBE8e9kJKHJZdDMyJrUDzpUmebx@mail.gmail.com>
Subject: RE: Question about custom Analyzer
Date: Thu, 4 Nov 2010 11:01:40 +0100
Message-ID: <004501cb7c07$46d1a1f0$d474e5d0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQG4qYkMEadFB73mBgqFaqfkmhtQvJOGtQDQ
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

The problem with your implementatio n of reuseableTokenStream is that it =
does not set a new reader when it reuses. Reset() is the wrong method. =
Attempt b is also wrong, as it does not reuse the whole analyzer chain. =
The correct way is to make some utility class that you use for storing =
the TokenStream and the Tokenizer:

class ReuseableTS {  Tokenizer tok; TokenStream ts }

In reuseableTokenStream you create the tokenizer, store it in this =
instance and also create all filters on top. The final TokenStream you =
also store in this instance. Save the instance use =
setPreviousTokenStream().

When getPreviousTokenStream() returns non-null for later calls, simply =
cast to above class, and then call tok.reset(reader) and after that =
return ts;

In Lucene 3.x branch there is a class called ReusabeAnalyzerBase that =
helps to correctly implement reusing. The implementation you did is =
wrong.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: heikki [mailto:tropicano@gmail.com]
> Sent: Thursday, November 04, 2010 10:07 AM
> To: java-user@lucene.apache.org
> Subject: Question about custom Analyzer
>=20
> hello Lucene list,
>=20
> I have a question about a custom Analyzer we're trying to write. The =
intention
> is that it tokenizes on whitespace, and abstracts over upper/lowercase =
and
> accented characters. It is used both when indexing documents, and =
before
> creating lucene queries from search terms.
>=20
> I have 2 implementations. The first one seems to work only correctly =
if the
> index is rebuilt after we add something to the index. If we do not =
rebuild, the
> newly added document is not found when you search for it. I've no idea =
what
> could cause this behaviour. I'm posting its code below, called =
"Attempt A".
>=20
> The second implementation seems to work better. Using it, newly =
indexed
> documents are immediately findable, without first rebuilding the =
index. It also
> seems to abstract over upper/lowercase, and in my colleague's tests =
(but not in
> mine) seems to abstract over accented characters. I'm posting its code =
below,
> called "Attempt B".
>=20
> We do not understand why our first implementation "Attempt A" behaves =
like it
> does. We also do not understand why the second implementation "Attempt =
B"
> improves on that, and whether that implementation actually fulfills =
our goals
> (seeing the different test results we got).
>=20
> So I'd very much appreciate it if someone could help us understand =
this, and
> tell us if we're taking the right approach here to achieve this =
seemingly simple
> goal.
>=20
>=20
> Kind regards
> Heikki Doeleman
>=20
> =
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> Attempt A :
>=20
> public final class GeoNetworkAnalyzer extends Analyzer {
>=20
>          @Override
>          public TokenStream tokenStream(String fieldName, Reader =
reader) {
>              TokenStream ts =3D new WhitespaceTokenizer(reader);
>              ts =3D new LowerCaseFilter(ts);
>              ts =3D new ASCIIFoldingFilter(ts);
>              return ts;
>          }
>=20
>          @Override
>          public TokenStream reusableTokenStream(String fieldName, =
Reader
> reader) throws IOException {
>            TokenStream ts =3D (TokenStream) getPreviousTokenStream();
>            if (ts =3D=3D null) {
>              ts =3D tokenStream(null, reader);
>              setPreviousTokenStream(ts);
>            }
>            else {
>              ts.reset();
>            }
>            return ts;
>          }
> }
>=20
> =
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> Attempt B :
>=20
> public final class GeoNetworkAnalyzer extends Analyzer {
>=20
>     @Override
>     public TokenStream tokenStream(String fieldName, Reader reader) {
>         return new ASCIIFoldingFilter(new LowerCaseFilter(new
> WhitespaceTokenizer(reader)));
>     }
>=20
>     @Override
>     public TokenStream reusableTokenStream(String fieldName, Reader =
reader)
> throws IOException {
>         Tokenizer tokenizer =3D (Tokenizer) getPreviousTokenStream();
>         if (tokenizer =3D=3D null) {
>             tokenizer =3D new WhitespaceTokenizer(reader);
>             setPreviousTokenStream(tokenizer);
>         } else
>             tokenizer.reset(reader);
>         return tokenizer;
>     }
> }
>=20
> =
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47709-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 13:49:55 2010
Return-Path: <java-user-return-47709-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33420 invoked from network); 4 Nov 2010 13:49:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 13:49:55 -0000
Received: (qmail 96727 invoked by uid 500); 4 Nov 2010 13:50:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96403 invoked by uid 500); 4 Nov 2010 13:50:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96395 invoked by uid 99); 4 Nov 2010 13:50:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 13:50:19 +0000
X-ASF-Spam-Status: No, hits=4.2 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 13:50:15 +0000
Received: by wyg36 with SMTP id 36so2013369wyg.35
        for <java-user@lucene.apache.org>; Thu, 04 Nov 2010 06:49:53 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.17.135 with SMTP id j7mr689342wej.97.1288878592741; Thu,
 04 Nov 2010 06:49:52 -0700 (PDT)
Received: by 10.216.30.81 with HTTP; Thu, 4 Nov 2010 06:49:52 -0700 (PDT)
In-Reply-To: <1288857235054-1839942.post@n3.nabble.com>
References: <1288857235054-1839942.post@n3.nabble.com>
Date: Thu, 4 Nov 2010 09:49:52 -0400
Message-ID: <AANLkTi=xGVK_9-GzjmY4GSRfEjNtAPwkx9c9DiWOQXv-@mail.gmail.com>
Subject: Re: High frequency term for the searched query
From: Seth Rosen <seth@architexa.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64c25c6add05304943a6e0c

--0016e64c25c6add05304943a6e0c
Content-Type: text/plain; charset=ISO-8859-1

You might want to take a look at this tutorial on how Lucene calculates
Scoring [1]. If all you are interested in is the term frequency and you want
to ignore other calculations you can override the others and have them
return 1.

Hope this helps!
Seth Rosen
seth@architexa.com
www.architexa.com



[1] http://www.lucenetutorial.com/advanced-topics/scoring.html

On Thu, Nov 4, 2010 at 3:53 AM, starz10de <farag_ahmed@yahoo.com> wrote:

>
> I need to find the most frequent terms that are appeared with a query.
>
> HighFreqTerms.java can be used only to obtain the high frequency terms in
> the whole index.
>
> I need just to find the high frequency terms to the submitted query.
>
> What I do now is:
>
> I search the index with the query and retrieve the relevant documents then
> save those documents in a new folder then index them. At the end I use
> HighFreqTerms.java in the new index so I can find the most frequent terms
> to
> the query. However, this is very slow and need long time to run.
>
> Any idea how I can do this task efficiently
>
>
> Thanks in advance
>
> --
> View this message in context:
> http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1839942.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64c25c6add05304943a6e0c--

From java-user-return-47710-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 15:40:05 2010
Return-Path: <java-user-return-47710-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86886 invoked from network); 4 Nov 2010 15:40:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 15:40:05 -0000
Received: (qmail 56473 invoked by uid 500); 4 Nov 2010 15:40:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56318 invoked by uid 500); 4 Nov 2010 15:40:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56310 invoked by uid 99); 4 Nov 2010 15:40:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 15:40:31 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [141.211.3.202] (HELO itcs-ehub-02.adsroot.itcs.umich.edu) (141.211.3.202)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 15:40:23 +0000
Received: from ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu ([141.211.3.233]) by
 itcs-ehub-02.adsroot.itcs.umich.edu ([141.211.3.202]) with mapi; Thu, 4 Nov
 2010 11:40:01 -0400
From: "Burton-West, Tom" <tburtonw@umich.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Thu, 4 Nov 2010 11:40:00 -0400
Subject: RE: High frequency term for the searched query
Thread-Topic: High frequency term for the searched query
Thread-Index: Act7/Qsx8zS3r9JvS+SaKN3YG2+seQAN1YIQ
Message-ID: <47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <1288857235054-1839942.post@n3.nabble.com>
In-Reply-To: <1288857235054-1839942.post@n3.nabble.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

Can you give more details about what you want?  Perhaps with an example?
Do you want the number of documents containing the query term, the number o=
f occurrences of the query term within a document, or the number of occurre=
nces of the term in the entire index?

You can use an explain query to get information on the number of occurrence=
s within each document and the number of documents within the index  search=
er.explain(query, doc)

If you want the number of occurrences of the term in the entire index, you =
can use=20
org/apache/lucene/misc/GetTermInfo.java. You can give it a term and it will=
 look up the total number of documents containing the term and the total nu=
mber of occurrences of the term in the index. =20


http://svn.apache.org/viewvc/lucene/dev/branches/branch_3x/lucene/contrib/m=
isc/src/java/org/apache/lucene/misc/GetTermInfo.java?revision=3D957522&view=
=3Dmarkup

Tom

Tom Burton-West
http://www.hathitrust.org/blogs/large-scale-search

-----Original Message-----
From: starz10de [mailto:farag_ahmed@yahoo.com]=20
Sent: Thursday, November 04, 2010 3:54 AM
To: java-user@lucene.apache.org
Subject: High frequency term for the searched query


I need to find the most frequent terms that are appeared with a query.=20

HighFreqTerms.java can be used only to obtain the high frequency terms in
the whole index.=20

I need just to find the high frequency terms to the submitted query.=20

What I do now is:

I search the index with the query and retrieve the relevant documents then
save those documents in a new folder then index them. At the end I use
HighFreqTerms.java in the new index so I can find the most frequent terms t=
o
the query. However, this is very slow and need long time to run.

Any idea how I can do this task efficiently=20


Thanks in advance

--=20
View this message in context: http://lucene.472066.n3.nabble.com/High-frequ=
ency-term-for-the-searched-query-tp1839942p1839942.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47711-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 16:52:31 2010
Return-Path: <java-user-return-47711-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27355 invoked from network); 4 Nov 2010 16:52:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 16:52:30 -0000
Received: (qmail 3677 invoked by uid 500); 4 Nov 2010 16:52:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3624 invoked by uid 500); 4 Nov 2010 16:52:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3616 invoked by uid 99); 4 Nov 2010 16:52:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 16:52:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 16:52:50 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01CB7C40.9CD813DC"
Subject: Search returning documents matching a NOT range
Date: Thu, 4 Nov 2010 12:52:05 -0400
Message-ID: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Search returning documents matching a NOT range
Thread-Index: Act8QJws4636CqwETfSbmA0bDq+haQ==
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

------_=_NextPart_001_01CB7C40.9CD813DC
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

I have an active lucene implementation that has been in place for a
couple years and was recently upgraded to the 3.02 branch. We are now
occasionally seeing documents returned from searches that should not be
returned. I have reduced the code and indexes to the smallest set
possible where I can still repeat the issue.

=20

My test cases uses 2 indexes.  These indexes have been rebuilt/optimized
using Luke 1.0.1 to make them the smallest possible.  One index has 1
document, which is being returned by the query but should not.   The
other index has 1000 documents, none of which match the search criteria.
The query should bring back 0 results, but brings back 1.  I can zip and
mail the indexes if it would aid in helping track down this issue.

=20

=20

=20

public class LuceneTest {

    static public void main(String[] args) {

        try {

            QueryParser queryParser =3D new =
QueryParser(Version.LUCENE_30,
"author", new KeywordAnalyzer());

            Query query =3D queryParser.parse("author:bentalcella AND =
NOT
publish_date:[20100601 TO 20100630]");

            Searchable[] searchables =3D new Searchable[2];

            searchables[0] =3D new IndexSearcher(new NIOFSDirectory(new
File("/home/dfertig/testIndexes/b1")), true);

            searchables[1] =3D new IndexSearcher(new NIOFSDirectory(new
File("/home/dfertig/testIndexes/m1")), true);

            Searcher searcher =3D new MultiSearcher(searchables);

            System.out.println("Query: " + query.toString());

            TopDocs topDocs =3D searcher.search(query, 10);

            System.out.println("Results: " + topDocs.totalHits);

            for (int in =3D 0; in < topDocs.totalHits; in++) {

                Document document =3D
searcher.doc(topDocs.scoreDocs[in].doc);

                System.out.println("publish_date: " +
document.get("publish_date"));

            }

            searcher.close();

        } catch (Exception e) {

            System.out.println(e.getMessage());

            e.printStackTrace();

        }

    }

}

=20

=20

=20


------_=_NextPart_001_01CB7C40.9CD813DC--

From java-user-return-47712-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 17:22:16 2010
Return-Path: <java-user-return-47712-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47051 invoked from network); 4 Nov 2010 17:22:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 17:22:15 -0000
Received: (qmail 58824 invoked by uid 500); 4 Nov 2010 17:22:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58620 invoked by uid 500); 4 Nov 2010 17:22:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58612 invoked by uid 99); 4 Nov 2010 17:22:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 17:22:43 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of chris.lu@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 17:22:37 +0000
Received: by pwj9 with SMTP id 9so787561pwj.35
        for <java-user@lucene.apache.org>; Thu, 04 Nov 2010 10:22:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=QINZU/2xk9eQ0Sb3y79oTRQhbEMESpVmxiaqsAfyUxA=;
        b=sEWU2nm8KETnUbe1IzsAgonzGu0QQNzcDvUNJRHru5t/ijrfHur19wHs9zd5sC6rZY
         0PW+J8JGZNFdlTtM+r2iK3AD2M6LQMYBeGxgFGYTivdPUvqLyGzRd9wXevM5fxmwlGN8
         twSZs4/yvdWyK/xeCd257pUuIimA9vG6A3OGw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=W7sYlrjft5vdE0DMJwcWCxDphvczyzKObcCKMn+BZpH/99RQNSzAmtydvegrP/oFPf
         YQ6MxGeq6qHpWKW/z0dI5GQ0zbay94J66ZPi/yP0QwkndgwwLlUCsd1p+wsrSe1PPCme
         kwMDEsAWPr7mnioVvhpS+tOL3SJrwztnC6Ruk=
Received: by 10.142.158.8 with SMTP id g8mr801061wfe.281.1288891336221;
        Thu, 04 Nov 2010 10:22:16 -0700 (PDT)
Received: from [192.168.1.79] (99-99-38-182.lightspeed.sntcca.sbcglobal.net [99.99.38.182])
        by mx.google.com with ESMTPS id p8sm203149wff.16.2010.11.04.10.22.13
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 04 Nov 2010 10:22:14 -0700 (PDT)
Message-ID: <4CD2EBC3.7050802@gmail.com>
Date: Thu, 04 Nov 2010 10:22:11 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.12) Gecko/20101027 Lightning/1.0b2 Thunderbird/3.1.6
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: High frequency term for the searched query
References: <1288857235054-1839942.post@n3.nabble.com>
In-Reply-To: <1288857235054-1839942.post@n3.nabble.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

After you get the query object, you can use IndexSearcher's function 
docFreq(), like this

final Set<Term> terms = new HashSet<Term>();
query = searcher.rewrite(query);
query.extractTerms(terms);
for(Term t : terms){
    int frequency = irs.getSearcher().docFreq(t);
}

-- 
--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes

On 11/4/2010 12:53 AM, starz10de wrote:

> I need to find the most frequent terms that are appeared with a query.
>
> HighFreqTerms.java can be used only to obtain the high frequency terms in
> the whole index.
>
> I need just to find the high frequency terms to the submitted query.
>
> What I do now is:
>
> I search the index with the query and retrieve the relevant documents then
> save those documents in a new folder then index them. At the end I use
> HighFreqTerms.java in the new index so I can find the most frequent terms to
> the query. However, this is very slow and need long time to run.
>
> Any idea how I can do this task efficiently
>
>
> Thanks in advance
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47713-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 04 17:22:44 2010
Return-Path: <java-user-return-47713-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47281 invoked from network); 4 Nov 2010 17:22:44 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 4 Nov 2010 17:22:44 -0000
Received: (qmail 60972 invoked by uid 500); 4 Nov 2010 17:23:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60764 invoked by uid 500); 4 Nov 2010 17:23:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60756 invoked by uid 99); 4 Nov 2010 17:23:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 17:23:13 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of chris.lu@gmail.com designates 209.85.212.176 as permitted sender)
Received: from [209.85.212.176] (HELO mail-px0-f176.google.com) (209.85.212.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 04 Nov 2010 17:23:07 +0000
Received: by pxi5 with SMTP id 5so332886pxi.35
        for <java-user@lucene.apache.org>; Thu, 04 Nov 2010 10:22:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=waJVLhtIwobRmo8+UOFI8cYoGfW910mWtqC2mkgq/BE=;
        b=eERCpxFQX35Eh1IiokxzzU6dAYMxyu9vMkVC/QVFDeUYedjRo1r3UNJ1fHy1UoD+hq
         6TRd22hXoLPNw//P/AafPA1lPT3O5EFFHa6ENQGkO2y3KbA3uQPgeMYLxNRtshunrMze
         arW2GqNe1egIQefpYW8vgNBnRgvJGHEPAEcf0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=SfyM6AVxjmDhXBruQCxIE8vH/zjihljiEO5HvIyOZY8WC3upWMZlcb+0k2Z/jHJJQK
         B9Owxjfeos9EY1Ph88jJuRgIuiB5tkbiNiMda+iJXU+XyWFEd3cydQ+9yWdLfCxnw8JJ
         lwwuO/xMN/rLp/diuUASherONhsE54nx+wYJw=
Received: by 10.142.156.18 with SMTP id d18mr825987wfe.81.1288891366758;
        Thu, 04 Nov 2010 10:22:46 -0700 (PDT)
Received: from [192.168.1.79] (99-99-38-182.lightspeed.sntcca.sbcglobal.net [99.99.38.182])
        by mx.google.com with ESMTPS id v19sm215825wfh.0.2010.11.04.10.22.44
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 04 Nov 2010 10:22:45 -0700 (PDT)
Message-ID: <4CD2EBE3.9090708@gmail.com>
Date: Thu, 04 Nov 2010 10:22:43 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.12) Gecko/20101027 Lightning/1.0b2 Thunderbird/3.1.6
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: High frequency term for the searched query
References: <1288857235054-1839942.post@n3.nabble.com>
In-Reply-To: <1288857235054-1839942.post@n3.nabble.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

After you get the query object, you can use IndexSearcher's function 
docFreq(), like this

final Set<Term> terms = new HashSet<Term>();
query = searcher.rewrite(query);
query.extractTerms(terms);
for(Term t : terms){
    int frequency = searcher.docFreq(t);
}

-- 
--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes

On 11/4/2010 12:53 AM, starz10de wrote:

> I need to find the most frequent terms that are appeared with a query.
>
> HighFreqTerms.java can be used only to obtain the high frequency terms in
> the whole index.
>
> I need just to find the high frequency terms to the submitted query.
>
> What I do now is:
>
> I search the index with the query and retrieve the relevant documents then
> save those documents in a new folder then index them. At the end I use
> HighFreqTerms.java in the new index so I can find the most frequent terms to
> the query. However, this is very slow and need long time to run.
>
> Any idea how I can do this task efficiently
>
>
> Thanks in advance
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47714-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 02:34:19 2010
Return-Path: <java-user-return-47714-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61139 invoked from network); 5 Nov 2010 02:34:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 02:34:18 -0000
Received: (qmail 40193 invoked by uid 500); 5 Nov 2010 02:34:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39956 invoked by uid 500); 5 Nov 2010 02:34:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39947 invoked by uid 99); 5 Nov 2010 02:34:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 02:34:45 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of celsowm@gmail.com designates 209.85.215.48 as permitted sender)
Received: from [209.85.215.48] (HELO mail-ew0-f48.google.com) (209.85.215.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 02:34:38 +0000
Received: by ewy3 with SMTP id 3so1492774ewy.35
        for <java-user@lucene.apache.org>; Thu, 04 Nov 2010 19:34:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=iRCdmnJHG6DmSwfr8qHKqsZZfoN+XBotg0FkgBBi5Nk=;
        b=OQOHEe0byfrqSD28wY2XDwTE5ns6N4bPlnevcsul2uWJgVkZkd+LcQR5wOLDcTl42W
         o/LDBkMTLrSIK/AjU+IVsFnGHj0Uv/UGuw+McStr0DrUEgld3s4wBwyqF62yL8gBk+0C
         BrGz5uLqDVoThqZ/lTzB0IavP+TMgKYAzeX7I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=VeIUUmRUHcK49zIDwOMcjnX7eLgPFrYq24KRdT6usl2M5i1SXpdU5VFi3HRyvRRgdB
         6obze/sf89aos0hzuTJKUdDkVqtRim69fL9L1cjPd8LpJsYFMDkMP2+u3vkDjEn5YWL1
         8LIs/G2XVoWfVtpOe6F/uqMcQ2VksokKM3Ruk=
Received: by 10.14.127.202 with SMTP id d50mr390070eei.36.1288924457645; Thu,
 04 Nov 2010 19:34:17 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.14.48.71 with HTTP; Thu, 4 Nov 2010 19:33:57 -0700 (PDT)
In-Reply-To: <AANLkTikMO_z89aHJXe=q0PsOdBCbpvsLPv_yUatrEhs_@mail.gmail.com>
References: <AANLkTikMO_z89aHJXe=q0PsOdBCbpvsLPv_yUatrEhs_@mail.gmail.com>
From: Celso Fontes <celsowm@gmail.com>
Date: Fri, 5 Nov 2010 00:33:57 -0200
Message-ID: <AANLkTimVE5dLYi9+v=PBQY9qYfE4RQB79JK+Zy70Uhxp@mail.gmail.com>
Subject: How index and search text files in Lucene 3.0.2 ?
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi ! I am newbie in lucene, and i have some problems to create a
simple code to query a text file collection.

My code is this (http://pastebin.com/HqrbBPtp), but does not works.
What is Wrong?

Thanks,
Celso.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47715-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 07:36:59 2010
Return-Path: <java-user-return-47715-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64280 invoked from network); 5 Nov 2010 07:36:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 07:36:58 -0000
Received: (qmail 88475 invoked by uid 500); 5 Nov 2010 07:37:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88102 invoked by uid 500); 5 Nov 2010 07:37:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 85790 invoked by uid 99); 5 Nov 2010 07:33:30 -0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Date: Fri, 5 Nov 2010 00:33:01 -0700 (PDT)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1288942381985-1846800.post@n3.nabble.com>
In-Reply-To: <47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <1288857235054-1839942.post@n3.nabble.com> <47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Subject: RE: High frequency term for the searched query
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

I need to expand the query with the most terms occurred with it in
documents. For example:  the word credits, tax, withdraw have high appearin=
g
with Bank. So my query is =E2=80=9CBank=E2=80=9D and the result should be r=
anked list of the
most frequent terms with "Bank"

I could do that as I explained but not in efficient way.

--=20
View this message in context: http://lucene.472066.n3.nabble.com/High-frequ=
ency-term-for-the-searched-query-tp1839942p1846800.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47716-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 07:37:18 2010
Return-Path: <java-user-return-47716-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64372 invoked from network); 5 Nov 2010 07:37:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 07:37:17 -0000
Received: (qmail 90056 invoked by uid 500); 5 Nov 2010 07:37:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89972 invoked by uid 500); 5 Nov 2010 07:37:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89964 invoked by uid 99); 5 Nov 2010 07:37:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 07:37:46 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 07:37:41 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 19C2A45FC67
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 08:37:19 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id cGnCaoWU2oUn for <java-user@lucene.apache.org>;
	Fri,  5 Nov 2010 08:37:16 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id B341045FA84
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 08:37:15 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTikMO_z89aHJXe=q0PsOdBCbpvsLPv_yUatrEhs_@mail.gmail.com> <AANLkTimVE5dLYi9+v=PBQY9qYfE4RQB79JK+Zy70Uhxp@mail.gmail.com>
In-Reply-To: <AANLkTimVE5dLYi9+v=PBQY9qYfE4RQB79JK+Zy70Uhxp@mail.gmail.com>
Subject: RE: How index and search text files in Lucene 3.0.2 ?
Date: Fri, 5 Nov 2010 08:37:20 +0100
Message-ID: <001501cb7cbc$47c09390$d741bab0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-index: AQHQf64HEiAiF7lHAfv/nkvoqjMY1AFO/qrrk04At4A=
Content-language: de

The default field of query parser is wrong:
QueryParser parser = new QueryParser(Version.LUCENE_30, "computer",
analyzer);

You haven't indexed a field with name "computer". Your query string does not
override the field, so your query is in fact "computer:computer".

A note: It is not recommended to instantiate TopScoreDocCollector directly
for such search cases, just use the IndexSearcher method that returns
TopDocs!

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Celso Fontes [mailto:celsowm@gmail.com]
> Sent: Friday, November 05, 2010 3:34 AM
> To: java-user@lucene.apache.org
> Subject: How index and search text files in Lucene 3.0.2 ?
> 
> Hi ! I am newbie in lucene, and i have some problems to create a simple
code
> to query a text file collection.
> 
> My code is this (http://pastebin.com/HqrbBPtp), but does not works.
> What is Wrong?
> 
> Thanks,
> Celso.
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47717-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 07:38:12 2010
Return-Path: <java-user-return-47717-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64620 invoked from network); 5 Nov 2010 07:38:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 07:38:11 -0000
Received: (qmail 92541 invoked by uid 500); 5 Nov 2010 07:38:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92410 invoked by uid 500); 5 Nov 2010 07:38:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 85265 invoked by uid 99); 5 Nov 2010 07:28:38 -0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Fri, 5 Nov 2010 00:28:12 -0700 (PDT)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1288942092206-1846781.post@n3.nabble.com>
In-Reply-To: <4CD2EBE3.9090708@gmail.com>
References: <1288857235054-1839942.post@n3.nabble.com> <4CD2EBE3.9090708@gmail.com>
Subject: Re: High frequency term for the searched query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


HI Chris,

I tried your solution and got one problem "the method
extractterms(Set<Term>) is undefined for the type Query"


this is the ocde:

Query query = QueryParser.parse(line, "contents", analyzer);
	//System.out.println("Searching for: " + query.toString("contents"));

	Hits hits = searcher.search(query);
	
       final Set<Term> terms = new HashSet<Term>();  
       
        query = searcher.rewrite(query); 
        
// the problem in this line
 query.extractTerms(terms); 
        
        for(Term t : terms){ 
            int frequency = searcher.docFreq(t); 
        } 

Thanks in advance

-- 
View this message in context: http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1846781.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47718-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 07:41:44 2010
Return-Path: <java-user-return-47718-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65129 invoked from network); 5 Nov 2010 07:41:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 07:41:43 -0000
Received: (qmail 97845 invoked by uid 500); 5 Nov 2010 07:42:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97529 invoked by uid 500); 5 Nov 2010 07:42:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97521 invoked by uid 99); 5 Nov 2010 07:42:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 07:42:09 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 07:42:02 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id CF885D36004
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 08:41:42 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id pOpnm6bU98xv for <java-user@lucene.apache.org>;
	Fri,  5 Nov 2010 08:41:40 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 79DCCD36003
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 08:41:39 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <1288857235054-1839942.post@n3.nabble.com> <4CD2EBE3.9090708@gmail.com> <1288942092206-1846781.post@n3.nabble.com>
In-Reply-To: <1288942092206-1846781.post@n3.nabble.com>
Subject: RE: High frequency term for the searched query
Date: Fri, 5 Nov 2010 08:41:44 +0100
Message-ID: <002201cb7cbc$e51733b0$af459b10$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-index: AQF0v7HdDio2JeCX0EAkXC5E/T4mUgJua/LkAbdlBJWT7svIwA==
Content-language: de
X-Virus-Checked: Checked by ClamAV on apache.org

It's there:

http://lucene.apache.org/java/3_0_2/api/core/org/apache/lucene/search/Query.
html#extractTerms(java.util.Set)


-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: starz10de [mailto:farag_ahmed@yahoo.com]
> Sent: Friday, November 05, 2010 8:28 AM
> To: java-user@lucene.apache.org
> Subject: Re: High frequency term for the searched query
> 
> 
> HI Chris,
> 
> I tried your solution and got one problem "the method
> extractterms(Set<Term>) is undefined for the type Query"
> 
> 
> this is the ocde:
> 
> Query query = QueryParser.parse(line, "contents", analyzer);
> 	//System.out.println("Searching for: " +
query.toString("contents"));
> 
> 	Hits hits = searcher.search(query);
> 
>        final Set<Term> terms = new HashSet<Term>();
> 
>         query = searcher.rewrite(query);
> 
> // the problem in this line
>  query.extractTerms(terms);
> 
>         for(Term t : terms){
>             int frequency = searcher.docFreq(t);
>         }
> 
> Thanks in advance
> 
> --
> View this message in context: http://lucene.472066.n3.nabble.com/High-
> frequency-term-for-the-searched-query-tp1839942p1846781.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47719-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 08:56:43 2010
Return-Path: <java-user-return-47719-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90956 invoked from network); 5 Nov 2010 08:56:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 08:56:42 -0000
Received: (qmail 93682 invoked by uid 500); 5 Nov 2010 08:57:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93382 invoked by uid 500); 5 Nov 2010 08:57:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93374 invoked by uid 99); 5 Nov 2010 08:57:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 08:57:08 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 08:57:02 +0000
Received: by wyg36 with SMTP id 36so2961297wyg.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 01:56:40 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.187.82 with SMTP id x60mr1211476wem.9.1288947400327; Fri,
 05 Nov 2010 01:56:40 -0700 (PDT)
Received: by 10.216.93.14 with HTTP; Fri, 5 Nov 2010 01:56:40 -0700 (PDT)
In-Reply-To: <1288942381985-1846800.post@n3.nabble.com>
References: <1288857235054-1839942.post@n3.nabble.com>
	<47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
	<1288942381985-1846800.post@n3.nabble.com>
Date: Fri, 5 Nov 2010 04:56:40 -0400
Message-ID: <AANLkTinbBtdodffUk7yWHmaB2pJVGD1J6k0yBQCSjXux@mail.gmail.com>
Subject: Re: High frequency term for the searched query
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Maybe MoreLikeThisQuery (under contrib/queries) will do what you want?

Mike

On Fri, Nov 5, 2010 at 3:33 AM, starz10de <farag_ahmed@yahoo.com> wrote:
>
> Hi,
>
> I need to expand the query with the most terms occurred with it in
> documents. For example: =A0the word credits, tax, withdraw have high appe=
aring
> with Bank. So my query is =93Bank=94 and the result should be ranked list=
 of the
> most frequent terms with "Bank"
>
> I could do that as I explained but not in efficient way.
>
> --
> View this message in context: http://lucene.472066.n3.nabble.com/High-fre=
quency-term-for-the-searched-query-tp1839942p1846800.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47720-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 10:08:23 2010
Return-Path: <java-user-return-47720-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24548 invoked from network); 5 Nov 2010 10:08:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 10:08:23 -0000
Received: (qmail 58795 invoked by uid 500); 5 Nov 2010 10:08:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58545 invoked by uid 500); 5 Nov 2010 10:08:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 69739 invoked by uid 99); 5 Nov 2010 08:37:32 -0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Fri, 5 Nov 2010 01:37:07 -0700 (PDT)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1288946227100-1847012.post@n3.nabble.com>
In-Reply-To: <002201cb7cbc$e51733b0$af459b10$@thetaphi.de>
References: <1288857235054-1839942.post@n3.nabble.com> <4CD2EBE3.9090708@gmail.com> <1288942092206-1846781.post@n3.nabble.com> <002201cb7cbc$e51733b0$af459b10$@thetaphi.de>
Subject: RE: High frequency term for the searched query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Hi,

I did as it is explained in the website:

 final Set<Term> terms = new HashSet<Term>();  
       
        query = searcher.rewrite(query); 
         query.extractTerms(terms); 
         
        for(Term t : terms){ 
            int frequency = searcher.docFreq(t); 
        } 



however I can't understand why this error appeared:

"the method extractterms(Set<Term>) is undefined for the type Query"




any idea

-- 
View this message in context: http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1847012.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47721-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 10:11:40 2010
Return-Path: <java-user-return-47721-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25644 invoked from network); 5 Nov 2010 10:11:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 10:11:39 -0000
Received: (qmail 63989 invoked by uid 500); 5 Nov 2010 10:12:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63598 invoked by uid 500); 5 Nov 2010 10:12:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63457 invoked by uid 99); 5 Nov 2010 10:12:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 10:12:07 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of tropicano@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 10:12:02 +0000
Received: by ywp4 with SMTP id 4so2291596ywp.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 03:11:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:cc
         :content-type;
        bh=W/SYG3XLpuqx4Sxq/A8KyqFiVKOmdx31W0QtcGCR6c0=;
        b=dLx6Ja73Z9ZvdQiW+AEVLizAozzehhONmywMl73VI0H85IyuxNu119usuTCtbUJwjI
         afnq7bWm0z3ep9kL/3E3c3hoqvrPr/cHVqLiEkreyHQQXOzNmFwu25BP7eP3pipm2ckx
         mlaqOBjEsrvE2RR6sLoMpucYbdcrzIDOI5QTM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:cc:content-type;
        b=m+Pd7+95W1hN8OI/RqVpxtxdQR7rb6LneW6HbVmbX02f2NlDzWoas/e4KKNhU/tRIA
         YKFxKZt0mzXXSSc9JpLFDMOdeyixjcbrYFcpiYnMWMGF8nK6DZfzXdh5m5pyLSMbcA/7
         4GqW5g1DtZrp9re5D/griLJZOTfvrNBL0NLuY=
MIME-Version: 1.0
Received: by 10.150.11.5 with SMTP id 5mr3222389ybk.110.1288951899898; Fri, 05
 Nov 2010 03:11:39 -0700 (PDT)
Received: by 10.220.18.3 with HTTP; Fri, 5 Nov 2010 03:11:39 -0700 (PDT)
Reply-To: tropicano@gmail.com
In-Reply-To: <004501cb7c07$46d1a1f0$d474e5d0$@thetaphi.de>
References: <AANLkTimVfiKGV-sGbvBE8e9kJKHJZdDMyJrUDzpUmebx@mail.gmail.com>
	<004501cb7c07$46d1a1f0$d474e5d0$@thetaphi.de>
Date: Fri, 5 Nov 2010 11:11:39 +0100
Message-ID: <AANLkTinFXxZviTdi_-0xzB20yjh=Nv4VxzPu3WG4e8f6@mail.gmail.com>
Subject: Re: Question about custom Analyzer
From: heikki <tropicano@gmail.com>
To: Uwe Schindler <uwe@thetaphi.de>
Cc: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd6a5c4204b2a04944b80ed

--000e0cd6a5c4204b2a04944b80ed
Content-Type: text/plain; charset=UTF-8

thanks !

With your fast response we've been able to get it to work.

Kind regards
Heikki Doeleman



On Thu, Nov 4, 2010 at 11:01 AM, Uwe Schindler <uwe@thetaphi.de> wrote:

> The problem with your implementatio n of reuseableTokenStream is that it
> does not set a new reader when it reuses. Reset() is the wrong method.
> Attempt b is also wrong, as it does not reuse the whole analyzer chain. The
> correct way is to make some utility class that you use for storing the
> TokenStream and the Tokenizer:
>
> class ReuseableTS {  Tokenizer tok; TokenStream ts }
>
> In reuseableTokenStream you create the tokenizer, store it in this instance
> and also create all filters on top. The final TokenStream you also store in
> this instance. Save the instance use setPreviousTokenStream().
>
> When getPreviousTokenStream() returns non-null for later calls, simply cast
> to above class, and then call tok.reset(reader) and after that return ts;
>
> In Lucene 3.x branch there is a class called ReusabeAnalyzerBase that helps
> to correctly implement reusing. The implementation you did is wrong.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: heikki [mailto:tropicano@gmail.com]
> > Sent: Thursday, November 04, 2010 10:07 AM
> > To: java-user@lucene.apache.org
> > Subject: Question about custom Analyzer
> >
> > hello Lucene list,
> >
> > I have a question about a custom Analyzer we're trying to write. The
> intention
> > is that it tokenizes on whitespace, and abstracts over upper/lowercase
> and
> > accented characters. It is used both when indexing documents, and before
> > creating lucene queries from search terms.
> >
> > I have 2 implementations. The first one seems to work only correctly if
> the
> > index is rebuilt after we add something to the index. If we do not
> rebuild, the
> > newly added document is not found when you search for it. I've no idea
> what
> > could cause this behaviour. I'm posting its code below, called "Attempt
> A".
> >
> > The second implementation seems to work better. Using it, newly indexed
> > documents are immediately findable, without first rebuilding the index.
> It also
> > seems to abstract over upper/lowercase, and in my colleague's tests (but
> not in
> > mine) seems to abstract over accented characters. I'm posting its code
> below,
> > called "Attempt B".
> >
> > We do not understand why our first implementation "Attempt A" behaves
> like it
> > does. We also do not understand why the second implementation "Attempt B"
> > improves on that, and whether that implementation actually fulfills our
> goals
> > (seeing the different test results we got).
> >
> > So I'd very much appreciate it if someone could help us understand this,
> and
> > tell us if we're taking the right approach here to achieve this seemingly
> simple
> > goal.
> >
> >
> > Kind regards
> > Heikki Doeleman
> >
> > ===============================================
> > Attempt A :
> >
> > public final class GeoNetworkAnalyzer extends Analyzer {
> >
> >          @Override
> >          public TokenStream tokenStream(String fieldName, Reader reader)
> {
> >              TokenStream ts = new WhitespaceTokenizer(reader);
> >              ts = new LowerCaseFilter(ts);
> >              ts = new ASCIIFoldingFilter(ts);
> >              return ts;
> >          }
> >
> >          @Override
> >          public TokenStream reusableTokenStream(String fieldName, Reader
> > reader) throws IOException {
> >            TokenStream ts = (TokenStream) getPreviousTokenStream();
> >            if (ts == null) {
> >              ts = tokenStream(null, reader);
> >              setPreviousTokenStream(ts);
> >            }
> >            else {
> >              ts.reset();
> >            }
> >            return ts;
> >          }
> > }
> >
> > =================================================
> > Attempt B :
> >
> > public final class GeoNetworkAnalyzer extends Analyzer {
> >
> >     @Override
> >     public TokenStream tokenStream(String fieldName, Reader reader) {
> >         return new ASCIIFoldingFilter(new LowerCaseFilter(new
> > WhitespaceTokenizer(reader)));
> >     }
> >
> >     @Override
> >     public TokenStream reusableTokenStream(String fieldName, Reader
> reader)
> > throws IOException {
> >         Tokenizer tokenizer = (Tokenizer) getPreviousTokenStream();
> >         if (tokenizer == null) {
> >             tokenizer = new WhitespaceTokenizer(reader);
> >             setPreviousTokenStream(tokenizer);
> >         } else
> >             tokenizer.reset(reader);
> >         return tokenizer;
> >     }
> > }
> >
> > =================================================
>
>

--000e0cd6a5c4204b2a04944b80ed--

From java-user-return-47722-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 15:11:18 2010
Return-Path: <java-user-return-47722-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65555 invoked from network); 5 Nov 2010 15:11:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 15:11:18 -0000
Received: (qmail 87869 invoked by uid 500); 5 Nov 2010 15:11:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85571 invoked by uid 500); 5 Nov 2010 15:11:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 62037 invoked by uid 99); 5 Nov 2010 15:01:03 -0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Date: Fri, 5 Nov 2010 08:00:38 -0700 (PDT)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1288969238216-1848702.post@n3.nabble.com>
In-Reply-To: <AANLkTinbBtdodffUk7yWHmaB2pJVGD1J6k0yBQCSjXux@mail.gmail.com>
References: <1288857235054-1839942.post@n3.nabble.com> <47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu> <1288942381985-1846800.post@n3.nabble.com> <AANLkTinbBtdodffUk7yWHmaB2pJVGD1J6k0yBQCSjXux@mail.gmail.com>
Subject: Re: High frequency term for the searched query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


HI Mike,

I implemented MoreLikeThis but I couldn't figure out where or how to print
the related term to the given query. All what I got is the relevant
documents to the query with their scores.

Any idea how to get the related terms?

-- 
View this message in context: http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1848702.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47723-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 15:33:09 2010
Return-Path: <java-user-return-47723-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83192 invoked from network); 5 Nov 2010 15:33:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 15:33:09 -0000
Received: (qmail 40484 invoked by uid 500); 5 Nov 2010 15:33:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40342 invoked by uid 500); 5 Nov 2010 15:33:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 16254 invoked by uid 99); 5 Nov 2010 15:26:12 -0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prvs=9182a6941=aca@ngi.be designates 193.190.215.50 as permitted sender)
X-IronPort-AV: E=Sophos;i="4.58,303,1286143200"; 
   d="scan'208,217";a="3122127"
Date: Fri, 5 Nov 2010 16:25:43 +0100 (CET)
From: Alain Camus <aca@ngi.be>
To: java-user@lucene.apache.org
Message-ID: <26636555.69547.1288970743847.JavaMail.root@morpheus>
In-Reply-To: <5211613.69517.1288970336555.JavaMail.root@morpheus>
Subject: RangeQuery with multiple ranges ?
MIME-Version: 1.0
Content-Type: multipart/alternative; 
	boundary="----=_Part_69546_1772441.1288970743846"
X-Originating-IP: [10.1.110.110]
X-Mailer: Zimbra 6.0.8_GA_2661 (ZimbraWebClient - FF3.0 (Win)/6.0.8_GA_2661)
X-Virus-Checked: Checked by ClamAV on apache.org

------=_Part_69546_1772441.1288970743846
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 7bit

Hello list, 

I'm new to lucene, trying to find out if this is possible : 

In Luke, I can write a query that gets me the results I want, that is : 
+denominator:([10000 TO 10000] OR [20000 TO 20000]) 

I'd like to write the same in java. I tried the next code but it doesn't work : 
BooleanClause.Occur scaleOccur = LuceneUtils.convertRequiredAndProhibitedToOccur(true, false); 
Term term1 = new Term(LuceneIndexField.SCALE, "10000"); 
Term term2 = new Term(LuceneIndexField.SCALE, "50000"); 
RangeQuery rangeQuery1 = new RangeQuery(term1, term1, true); 
RangeQuery rangeQuery2 = new RangeQuery(term2, term2, true); 
BooleanQuery booleanQuery = new BooleanQuery(); 
booleanQuery .setMinimumNumberShouldMatch(1); 
booleanQuery .add(rangeQuery1, scaleOccur); 
booleanQuery .add(rangeQuery2, scaleOccur); 
BooleanClause scaleRangeClause = new BooleanClause(bq, scaleOccur); 
query.add(scaleRangeClause); 
The resulting query doesn't give me the expected results : 
+((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1) 

Is it possible to do what I want ? Any documentation I could read about this ? 

Alain 


------=_Part_69546_1772441.1288970743846--

From java-user-return-47724-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 15:43:43 2010
Return-Path: <java-user-return-47724-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88352 invoked from network); 5 Nov 2010 15:43:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 15:43:43 -0000
Received: (qmail 56757 invoked by uid 500); 5 Nov 2010 15:44:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56717 invoked by uid 500); 5 Nov 2010 15:44:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56709 invoked by uid 99); 5 Nov 2010 15:44:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 15:44:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 15:44:05 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
Subject: RE: RangeQuery with multiple ranges ?
Date: Fri, 5 Nov 2010 11:43:42 -0400
Message-ID: <E5331E53F021E443B53EC78F375B3C761F91A4@buf-ex02.cymfony.com>
In-Reply-To: <26636555.69547.1288970743847.JavaMail.root@morpheus>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: RangeQuery with multiple ranges ?
Thread-Index: Act8/tMg9r0C01KlRmauJsGRgdLfFwAAVgEw
References: <5211613.69517.1288970336555.JavaMail.root@morpheus> <26636555.69547.1288970743847.JavaMail.root@morpheus>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>

WW91IGNhbiB1c2UgYSBxdWVyeSBwYXJzZXIgdG8gcGFyc2UgeW91ciB0ZXh0IHF1ZXJ5IGludG8g
dGhlIGFwcHJvcHJpYXRlIHF1ZXJ5IG9iamVjdHMuDQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0t
LS0tDQpGcm9tOiBBbGFpbiBDYW11cyBbbWFpbHRvOmFjYUBuZ2kuYmVdIA0KU2VudDogRnJpZGF5
LCBOb3ZlbWJlciA1LCAyMDEwIDExOjI2IEFNDQpUbzogamF2YS11c2VyQGx1Y2VuZS5hcGFjaGUu
b3JnDQpTdWJqZWN0OiBSYW5nZVF1ZXJ5IHdpdGggbXVsdGlwbGUgcmFuZ2VzID8NCg0KSGVsbG8g
bGlzdCwgDQoNCkknbSBuZXcgdG8gbHVjZW5lLCB0cnlpbmcgdG8gZmluZCBvdXQgaWYgdGhpcyBp
cyBwb3NzaWJsZSA6IA0KDQpJbiBMdWtlLCBJIGNhbiB3cml0ZSBhIHF1ZXJ5IHRoYXQgZ2V0cyBt
ZSB0aGUgcmVzdWx0cyBJIHdhbnQsIHRoYXQgaXMgOiANCitkZW5vbWluYXRvcjooWzEwMDAwIFRP
IDEwMDAwXSBPUiBbMjAwMDAgVE8gMjAwMDBdKSANCg0KSSdkIGxpa2UgdG8gd3JpdGUgdGhlIHNh
bWUgaW4gamF2YS4gSSB0cmllZCB0aGUgbmV4dCBjb2RlIGJ1dCBpdCBkb2Vzbid0IHdvcmsgOiAN
CkJvb2xlYW5DbGF1c2UuT2NjdXIgc2NhbGVPY2N1ciA9IEx1Y2VuZVV0aWxzLmNvbnZlcnRSZXF1
aXJlZEFuZFByb2hpYml0ZWRUb09jY3VyKHRydWUsIGZhbHNlKTsgDQpUZXJtIHRlcm0xID0gbmV3
IFRlcm0oTHVjZW5lSW5kZXhGaWVsZC5TQ0FMRSwgIjEwMDAwIik7IA0KVGVybSB0ZXJtMiA9IG5l
dyBUZXJtKEx1Y2VuZUluZGV4RmllbGQuU0NBTEUsICI1MDAwMCIpOyANClJhbmdlUXVlcnkgcmFu
Z2VRdWVyeTEgPSBuZXcgUmFuZ2VRdWVyeSh0ZXJtMSwgdGVybTEsIHRydWUpOyANClJhbmdlUXVl
cnkgcmFuZ2VRdWVyeTIgPSBuZXcgUmFuZ2VRdWVyeSh0ZXJtMiwgdGVybTIsIHRydWUpOyANCkJv
b2xlYW5RdWVyeSBib29sZWFuUXVlcnkgPSBuZXcgQm9vbGVhblF1ZXJ5KCk7IA0KYm9vbGVhblF1
ZXJ5IC5zZXRNaW5pbXVtTnVtYmVyU2hvdWxkTWF0Y2goMSk7IA0KYm9vbGVhblF1ZXJ5IC5hZGQo
cmFuZ2VRdWVyeTEsIHNjYWxlT2NjdXIpOyANCmJvb2xlYW5RdWVyeSAuYWRkKHJhbmdlUXVlcnky
LCBzY2FsZU9jY3VyKTsgDQpCb29sZWFuQ2xhdXNlIHNjYWxlUmFuZ2VDbGF1c2UgPSBuZXcgQm9v
bGVhbkNsYXVzZShicSwgc2NhbGVPY2N1cik7IA0KcXVlcnkuYWRkKHNjYWxlUmFuZ2VDbGF1c2Up
OyANClRoZSByZXN1bHRpbmcgcXVlcnkgZG9lc24ndCBnaXZlIG1lIHRoZSBleHBlY3RlZCByZXN1
bHRzIDogDQorKCgrZGVub21pbmF0b3I6WzEwMDAwIFRPIDEwMDAwXSArZGVub21pbmF0b3I6WzUw
MDAwIFRPIDUwMDAwXSl+MSkgDQoNCklzIGl0IHBvc3NpYmxlIHRvIGRvIHdoYXQgSSB3YW50ID8g
QW55IGRvY3VtZW50YXRpb24gSSBjb3VsZCByZWFkIGFib3V0IHRoaXMgPyANCg0KQWxhaW4gDQoN
Cg==


From java-user-return-47725-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 15:52:55 2010
Return-Path: <java-user-return-47725-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91476 invoked from network); 5 Nov 2010 15:52:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 15:52:55 -0000
Received: (qmail 73654 invoked by uid 500); 5 Nov 2010 15:53:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73581 invoked by uid 500); 5 Nov 2010 15:53:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73573 invoked by uid 99); 5 Nov 2010 15:53:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 15:53:24 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 15:53:16 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 5653CD36005
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 16:52:56 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id wY-dgyWjAy3k for <java-user@lucene.apache.org>;
	Fri,  5 Nov 2010 16:52:53 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 71B37D36004
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 16:52:53 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <5211613.69517.1288970336555.JavaMail.root@morpheus> <26636555.69547.1288970743847.JavaMail.root@morpheus>
In-Reply-To: <26636555.69547.1288970743847.JavaMail.root@morpheus>
Subject: RE: RangeQuery with multiple ranges ?
Date: Fri, 5 Nov 2010 16:52:58 +0100
Message-ID: <008b01cb7d01$84dbd5b0$8e938110$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-index: AQKjObWddhmKK2Yvwu9ZpvSC6h4855Gzjpmg
Content-language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Why do you use such complicated stuff to build the BQ?

Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
BooleanQuery bq =3D new BooleanQuery();
bq.add(new RangeQuery(term1, term1, true), BooleanClause.Occur.SHOULD);=20
bq.add(new RangeQuery(term2, term2, true), BooleanClause.Occur.SHOULD);

By the way, your code is outdated, you should better use =
NumericRangeQuery for numerics! Else RangeQuery is deprecated and =
replaced by TermRangeQuery:

String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, =
true), BooleanClause.Occur.SHOULD);=20
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, =
true), BooleanClause.Occur.SHOULD);

Uwe
-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Alain Camus [mailto:aca@ngi.be]
> Sent: Friday, November 05, 2010 4:26 PM
> To: java-user@lucene.apache.org
> Subject: RangeQuery with multiple ranges ?
>=20
> Hello list,
>=20
> I'm new to lucene, trying to find out if this is possible :
>=20
> In Luke, I can write a query that gets me the results I want, that is =
:
> +denominator:([10000 TO 10000] OR [20000 TO 20000])
>=20
> I'd like to write the same in java. I tried the next code but it =
doesn't work :
> BooleanClause.Occur scaleOccur =3D
> LuceneUtils.convertRequiredAndProhibitedToOccur(true, false);
> Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
> Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
> RangeQuery rangeQuery1 =3D new RangeQuery(term1, term1, true);
> RangeQuery rangeQuery2 =3D new RangeQuery(term2, term2, true);
> BooleanQuery booleanQuery =3D new BooleanQuery();
> booleanQuery .setMinimumNumberShouldMatch(1);
> booleanQuery .add(rangeQuery1, scaleOccur);
> booleanQuery .add(rangeQuery2, scaleOccur);
> BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
> query.add(scaleRangeClause);
> The resulting query doesn't give me the expected results :
> +((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
>=20
> Is it possible to do what I want ? Any documentation I could read =
about this ?
>=20
> Alain



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47726-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 16:01:27 2010
Return-Path: <java-user-return-47726-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95467 invoked from network); 5 Nov 2010 16:01:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 16:01:27 -0000
Received: (qmail 85344 invoked by uid 500); 5 Nov 2010 16:01:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85152 invoked by uid 500); 5 Nov 2010 16:01:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85139 invoked by uid 99); 5 Nov 2010 16:01:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 16:01:56 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of celsowm@gmail.com designates 209.85.215.176 as permitted sender)
Received: from [209.85.215.176] (HELO mail-ey0-f176.google.com) (209.85.215.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 16:01:51 +0000
Received: by eyz10 with SMTP id 10so1749334eyz.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 09:01:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=4C6RbeiJKLtkwvkalz/gi7aTfiKUy63FdvcLe7li02Y=;
        b=DPz/aTsqU9tRvVBg2XnRrtNgXCmzm/UDjdOzERdG61zR5T/kRm26JMEaYUAbnUSUzC
         xQByveoZ/wgV9lQjdjrJGU+F9etJ1K1bS/mosxkFsYW0Tp6B9DikoxGIPlEey0XNmYVN
         Eon3E3PbwBQQVX/QlUafmUEkADXtdmH58nQCE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=NnD3IkyEs8S6kmJAQ6D//tgQNyLD+LY77z070MxvspHunW1LToz4YMJUGdBEnzu4J7
         GBPzYOnh66o2t81IoWSd3qZYYmzp7ygPMxJaszcFTayLf5/6XBbjL4TWpXbzytTVCPBR
         G10mp/bW3qjrX+9XFq4C0I45yR7uvxe/Q9XEQ=
Received: by 10.14.119.135 with SMTP id n7mr961577eeh.29.1288972890127; Fri,
 05 Nov 2010 09:01:30 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.14.48.71 with HTTP; Fri, 5 Nov 2010 09:01:06 -0700 (PDT)
In-Reply-To: <001501cb7cbc$47c09390$d741bab0$@thetaphi.de>
References: <AANLkTikMO_z89aHJXe=q0PsOdBCbpvsLPv_yUatrEhs_@mail.gmail.com>
 <AANLkTimVE5dLYi9+v=PBQY9qYfE4RQB79JK+Zy70Uhxp@mail.gmail.com> <001501cb7cbc$47c09390$d741bab0$@thetaphi.de>
From: Celso Fontes <celsowm@gmail.com>
Date: Fri, 5 Nov 2010 13:01:06 -0300
Message-ID: <AANLkTim181Tzo6NmVU1S8u5XBxAvNzno5EuXRvDzMj8T@mail.gmail.com>
Subject: Re: How index and search text files in Lucene 3.0.2 ?
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Thanks Uwe, its works with:

            QueryParser parser = new QueryParser(Version.LUCENE_30,
"content:computer", analyzer);
            Query query = parser.parse("content:computer");

But, if i need get results like google in a query like "What is the
role of PrnP in mad cow disease?"

Thanks
CElso.

2010/11/5 Uwe Schindler <uwe@thetaphi.de>:
> The default field of query parser is wrong:
> QueryParser parser = new QueryParser(Version.LUCENE_30, "computer",
> analyzer);
>
> You haven't indexed a field with name "computer". Your query string does not
> override the field, so your query is in fact "computer:computer".
>
> A note: It is not recommended to instantiate TopScoreDocCollector directly
> for such search cases, just use the IndexSearcher method that returns
> TopDocs!
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>> -----Original Message-----
>> From: Celso Fontes [mailto:celsowm@gmail.com]
>> Sent: Friday, November 05, 2010 3:34 AM
>> To: java-user@lucene.apache.org
>> Subject: How index and search text files in Lucene 3.0.2 ?
>>
>> Hi ! I am newbie in lucene, and i have some problems to create a simple
> code
>> to query a text file collection.
>>
>> My code is this (http://pastebin.com/HqrbBPtp), but does not works.
>> What is Wrong?
>>
>> Thanks,
>> Celso.
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47727-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 16:06:42 2010
Return-Path: <java-user-return-47727-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5160 invoked from network); 5 Nov 2010 16:06:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 16:06:42 -0000
Received: (qmail 93619 invoked by uid 500); 5 Nov 2010 16:07:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93576 invoked by uid 500); 5 Nov 2010 16:07:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93568 invoked by uid 99); 5 Nov 2010 16:07:11 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 16:07:11 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 16:07:06 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 17F56D36005
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 17:06:44 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Q-6rGm+K7+3V for <java-user@lucene.apache.org>;
	Fri,  5 Nov 2010 17:06:41 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 30B4DD36004
	for <java-user@lucene.apache.org>; Fri,  5 Nov 2010 17:06:41 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTikMO_z89aHJXe=q0PsOdBCbpvsLPv_yUatrEhs_@mail.gmail.com> <AANLkTimVE5dLYi9+v=PBQY9qYfE4RQB79JK+Zy70Uhxp@mail.gmail.com> <001501cb7cbc$47c09390$d741bab0$@thetaphi.de> <AANLkTim181Tzo6NmVU1S8u5XBxAvNzno5EuXRvDzMj8T@mail.gmail.com>
In-Reply-To: <AANLkTim181Tzo6NmVU1S8u5XBxAvNzno5EuXRvDzMj8T@mail.gmail.com>
Subject: RE: How index and search text files in Lucene 3.0.2 ?
Date: Fri, 5 Nov 2010 17:06:46 +0100
Message-ID: <009401cb7d03$72690450$573b0cf0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-index: AQHQf64HEiAiF7lHAfv/nkvoqjMY1AFO/qrrASRAZ/ABOvB16JM7lT7Q
Content-language: de

Hi Celso,

just a note, your code makes no sense:

In the constructor of QueryParser you have to give the default field, e.g.
"content" only - With parse() you have to give the query string (which can
contain a field name or not): "computer" or alternatively "content:computer"
(which returns equal results because the default field from the ctor is
content:

QueryParser parser = new QueryParser(Version.LUCENE_30, "content",
analyzer);
Query query = parser.parse("computer");

or:

Query query = parser.parse("content:computer");

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Celso Fontes [mailto:celsowm@gmail.com]
> Sent: Friday, November 05, 2010 5:01 PM
> To: java-user@lucene.apache.org
> Subject: Re: How index and search text files in Lucene 3.0.2 ?
> 
> Thanks Uwe, its works with:
> 
>             QueryParser parser = new QueryParser(Version.LUCENE_30,
> "content:computer", analyzer);
>             Query query = parser.parse("content:computer");
> 
> But, if i need get results like google in a query like "What is the role
of PrnP in
> mad cow disease?"
> 
> Thanks
> CElso.
> 
> 2010/11/5 Uwe Schindler <uwe@thetaphi.de>:
> > The default field of query parser is wrong:
> > QueryParser parser = new QueryParser(Version.LUCENE_30, "computer",
> > analyzer);
> >
> > You haven't indexed a field with name "computer". Your query string
> > does not override the field, so your query is in fact
"computer:computer".
> >
> > A note: It is not recommended to instantiate TopScoreDocCollector
> > directly for such search cases, just use the IndexSearcher method that
> > returns TopDocs!
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >> -----Original Message-----
> >> From: Celso Fontes [mailto:celsowm@gmail.com]
> >> Sent: Friday, November 05, 2010 3:34 AM
> >> To: java-user@lucene.apache.org
> >> Subject: How index and search text files in Lucene 3.0.2 ?
> >>
> >> Hi ! I am newbie in lucene, and i have some problems to create a
> >> simple
> > code
> >> to query a text file collection.
> >>
> >> My code is this (http://pastebin.com/HqrbBPtp), but does not works.
> >> What is Wrong?
> >>
> >> Thanks,
> >> Celso.
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47728-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 16:08:47 2010
Return-Path: <java-user-return-47728-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5917 invoked from network); 5 Nov 2010 16:08:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 16:08:47 -0000
Received: (qmail 621 invoked by uid 500); 5 Nov 2010 16:09:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 561 invoked by uid 500); 5 Nov 2010 16:09:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 553 invoked by uid 99); 5 Nov 2010 16:09:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 16:09:16 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of celsowm@gmail.com designates 209.85.215.48 as permitted sender)
Received: from [209.85.215.48] (HELO mail-ew0-f48.google.com) (209.85.215.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 16:09:09 +0000
Received: by ewy3 with SMTP id 3so1802063ewy.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 09:08:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=UAushzESJLHq8HGOTfbxv6ZCkez3EXq+AvvlGwH/yyg=;
        b=HKuNAklwKuaDGBt7/X8Lfft4pv0eAwb6Wl8WkHgaVaKiH4MtjksXGQsZ6wmOPGggGP
         O2DF+MYfMvt1OoKJKrggyCbBGCSpz+IuQT12B9/3xVrDAHDwDauwcpeh2bp6NPJ/UkMK
         DnouAqxTJPFVdQic7OfRU9LXJovXrTtrpFDmI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=hKD1YKuXH7WOKvOQs0xi8p5MedcW920mArJD7CWFD0KsrY+EQ3ACO6aliYTaXWsKJ8
         6pieiGmQYf0QTTmiK9c6uBUZMev/egQhNQkCgZZxoPFcpCg3jRZ7ficSSRn7YhAzzGhN
         rxpsD6/SgOYCkgFBlXzCohrlbOefdjdUJoktc=
Received: by 10.213.34.9 with SMTP id j9mr1634462ebd.75.1288973328376; Fri, 05
 Nov 2010 09:08:48 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.14.48.71 with HTTP; Fri, 5 Nov 2010 09:08:24 -0700 (PDT)
In-Reply-To: <009401cb7d03$72690450$573b0cf0$@thetaphi.de>
References: <AANLkTikMO_z89aHJXe=q0PsOdBCbpvsLPv_yUatrEhs_@mail.gmail.com>
 <AANLkTimVE5dLYi9+v=PBQY9qYfE4RQB79JK+Zy70Uhxp@mail.gmail.com>
 <001501cb7cbc$47c09390$d741bab0$@thetaphi.de> <AANLkTim181Tzo6NmVU1S8u5XBxAvNzno5EuXRvDzMj8T@mail.gmail.com>
 <009401cb7d03$72690450$573b0cf0$@thetaphi.de>
From: Celso Fontes <celsowm@gmail.com>
Date: Fri, 5 Nov 2010 13:08:24 -0300
Message-ID: <AANLkTiniGA7nftOJyZ_YMq5R=DH_n+jYK5FFvye_sPef@mail.gmail.com>
Subject: Re: How index and search text files in Lucene 3.0.2 ?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015174bdf445ce5180494507dfe
X-Virus-Checked: Checked by ClamAV on apache.org

--0015174bdf445ce5180494507dfe
Content-Type: text/plain; charset=ISO-8859-1

thanks !

2010/11/5 Uwe Schindler <uwe@thetaphi.de>

> Hi Celso,
>
> just a note, your code makes no sense:
>
> In the constructor of QueryParser you have to give the default field, e.g.
> "content" only - With parse() you have to give the query string (which can
> contain a field name or not): "computer" or alternatively
> "content:computer"
> (which returns equal results because the default field from the ctor is
> content:
>
> QueryParser parser = new QueryParser(Version.LUCENE_30, "content",
> analyzer);
> Query query = parser.parse("computer");
>
> or:
>
> Query query = parser.parse("content:computer");
>
> Uwe
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Celso Fontes [mailto:celsowm@gmail.com]
> > Sent: Friday, November 05, 2010 5:01 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: How index and search text files in Lucene 3.0.2 ?
> >
> > Thanks Uwe, its works with:
> >
> >             QueryParser parser = new QueryParser(Version.LUCENE_30,
> > "content:computer", analyzer);
> >             Query query = parser.parse("content:computer");
> >
> > But, if i need get results like google in a query like "What is the role
> of PrnP in
> > mad cow disease?"
> >
> > Thanks
> > CElso.
> >
> > 2010/11/5 Uwe Schindler <uwe@thetaphi.de>:
> > > The default field of query parser is wrong:
> > > QueryParser parser = new QueryParser(Version.LUCENE_30, "computer",
> > > analyzer);
> > >
> > > You haven't indexed a field with name "computer". Your query string
> > > does not override the field, so your query is in fact
> "computer:computer".
> > >
> > > A note: It is not recommended to instantiate TopScoreDocCollector
> > > directly for such search cases, just use the IndexSearcher method that
> > > returns TopDocs!
> > >
> > > -----
> > > Uwe Schindler
> > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > http://www.thetaphi.de
> > > eMail: uwe@thetaphi.de
> > >
> > >> -----Original Message-----
> > >> From: Celso Fontes [mailto:celsowm@gmail.com]
> > >> Sent: Friday, November 05, 2010 3:34 AM
> > >> To: java-user@lucene.apache.org
> > >> Subject: How index and search text files in Lucene 3.0.2 ?
> > >>
> > >> Hi ! I am newbie in lucene, and i have some problems to create a
> > >> simple
> > > code
> > >> to query a text file collection.
> > >>
> > >> My code is this (http://pastebin.com/HqrbBPtp), but does not works.
> > >> What is Wrong?
> > >>
> > >> Thanks,
> > >> Celso.
> > >>
> > >> ---------------------------------------------------------------------
> > >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > >> For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0015174bdf445ce5180494507dfe--

From java-user-return-47729-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 17:38:05 2010
Return-Path: <java-user-return-47729-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68101 invoked from network); 5 Nov 2010 17:38:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 17:38:05 -0000
Received: (qmail 1739 invoked by uid 500); 5 Nov 2010 17:38:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1673 invoked by uid 500); 5 Nov 2010 17:38:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1662 invoked by uid 99); 5 Nov 2010 17:38:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 17:38:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 17:38:28 +0000
Received: by gwaa12 with SMTP id a12so644874gwa.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 10:38:06 -0700 (PDT)
Received: by 10.151.109.17 with SMTP id l17mr3939230ybm.58.1288978686805;
        Fri, 05 Nov 2010 10:38:06 -0700 (PDT)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id t9sm1117230ybe.21.2010.11.05.10.37.46
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 05 Nov 2010 10:37:58 -0700 (PDT)
From: Mark Kristensson <mark.kristensson@smartsheet.com>
Mime-Version: 1.0 (Apple Message framework v1081)
Content-Type: multipart/alternative; boundary=Apple-Mail-2--713666768
Subject: Re: IndexWriter.close() performance issue
Date: Fri, 5 Nov 2010 10:37:42 -0700
In-Reply-To: <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
To: java-user@lucene.apache.org
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com> <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com> <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
Message-Id: <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
X-Mailer: Apple Mail (2.1081)

--Apple-Mail-2--713666768
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

While most of our Lucene indexes are used for more traditional =
searching, this index in particular is used more like a reporting =
repository. Thus, we really do need to have that many fields indexed and =
they do need to be broken out into separate fields. There may be another =
way to structure the index to reduce the number of fields, but I'm =
hoping we can optimize the current design and avoid (yet another) index =
redesign.

I'll look into the tweaking the merge policy, but I'm more interested in =
disabling norms because scoring really doesn't matter for us. Basically, =
we need nothing more than a binary answer from Lucene: either a record =
meets the provided criteria (which can be a rather complex boolean query =
with many subqueries) or it doesn't. If the record does match, then we =
get the IDs from lucene and run off to get the live data from our =
primary data store and sort it (in Java) based upon criteria provided by =
the user, not by score.

After our initial design mushroomed in size, we redesigned and now (I =
thought) do not have norms on any of the fields in this index. So, I'm =
wondering if there was something in the results from the CheckIndex that =
I provided which indicates to you that we may have norms still enabled? =
I know that if you have norms on any one document's field, then any =
other document with that same field will get "infected" with norms as =
well.

My understanding is that any field that uses the constants  =
Index.NOT_ANALYZED_NO_NORMS or  Index.NO will not  have norms on it, =
regardless of whether or not the field is stored. Is that not correct?

Thanks,
Mark



On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:

> Likely what happened is you had a bunch of smaller segments, and then
> suddenly they got merged into that one big segment (_aiaz) in your
> index.
>=20
> The representation for norms in particular is not sparse, so this
> means the size of the norms file for a given segment will be
> number-of-unique-indexed-fields X number-of-documents.
>=20
> So this count grows quadratically on merge.
>=20
> Do these fields really need to be indexed?   If so, it'd be better to
> use a single field for all users for the indexable text if you can.
>=20
> Failing that, a simple workaround is to set the maxMergeMB/Docs on the
> merge policy; this'd prevent big segments from being produced.
> Disabling norms should also workaround this, though that will affect
> hit scores...
>=20
> Mike
>=20
> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>> Yes, we do have a large number of unique field names in that index, =
because they are driven by user named fields in our application (with =
some cleaning to remove illegal chars).
>>=20
>> This slowness problem has appeared very suddenly in the last couple =
of weeks and the number of unique field names has not spiked in the last =
few weeks. Have we crept over some threshold with our linear growth in =
the number of unique field names? Perhaps there is a limit driven by the =
amount of RAM in the machine that we are violating? Are there any =
guidelines for the maximum number, or suggested number, of unique fields =
names in an index or segment? Any suggestions for potentially mitigating =
the problem?
>>=20
>> Thanks,
>> Mark
>>=20
>>=20
>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>=20
>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>> <mark.kristensson@smartsheet.com> wrote:
>>>>=20
>>>> I've run checkIndex against the index and the results are below. =
That net is that it's telling me nothing is wrong with the index.
>>>=20
>>> Thanks.
>>>=20
>>>> I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.
>>>=20
>>> IndexWriter opens a SegmentReader for each segment in the index, to
>>> apply deletions, so I think this is the source of the slowness.
>>>=20
>>> =46rom the CheckIndex output, it looks like you have many (296,713)
>>> unique fields names on that one large segment -- does that sound
>>> right?  I suspect such a very high field count is the source of the
>>> slowness...
>>>=20
>>> Mike
>>>=20
>>> =
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>=20
>>=20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


--Apple-Mail-2--713666768--

From java-user-return-47730-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 17:53:41 2010
Return-Path: <java-user-return-47730-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75409 invoked from network); 5 Nov 2010 17:53:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 17:53:41 -0000
Received: (qmail 41622 invoked by uid 500); 5 Nov 2010 17:54:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41521 invoked by uid 500); 5 Nov 2010 17:54:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41513 invoked by uid 99); 5 Nov 2010 17:54:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 17:54:10 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.215.176] (HELO mail-ey0-f176.google.com) (209.85.215.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 17:54:06 +0000
Received: by eyz10 with SMTP id 10so1848064eyz.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 10:53:44 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.187.82 with SMTP id x60mr1969856wem.9.1288979623260; Fri,
 05 Nov 2010 10:53:43 -0700 (PDT)
Received: by 10.216.93.14 with HTTP; Fri, 5 Nov 2010 10:53:42 -0700 (PDT)
In-Reply-To: <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
	<AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
	<ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
	<AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
	<1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
Date: Fri, 5 Nov 2010 13:53:42 -0400
Message-ID: <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hmm...

So, I was going on this output from your CheckIndex:

   test: field norms.........OK [296713 fields]

But in fact I just looked and that number is bogus -- it's always
equal to total number of fields, not number of fields with norms
enabled.  I'll open an issue to fix this, but in the meantime can you
apply this patch to your CheckIndex and run it again?

Index: src/java/org/apache/lucene/index/CheckIndex.java
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
--- src/java/org/apache/lucene/index/CheckIndex.java	(revision 1031678)
+++ src/java/org/apache/lucene/index/CheckIndex.java	(working copy)
@@ -570,8 +570,10 @@
       }
       final byte[] b =3D new byte[reader.maxDoc()];
       for (final String fieldName : fieldNames) {
-        reader.norms(fieldName, b, 0);
-        ++status.totFields;
+        if (reader.hasNorms(fieldName)) {
+          reader.norms(fieldName, b, 0);
+          ++status.totFields;
+        }
       }

       msg("OK [" + status.totFields + " fields]");

So if in fact you have already disabled norms then something else is
the source of the sudden slowness.  Though, such a huge number of
unique field names is not an area of Lucene that's very well tested...
perhaps there's something silly somewhere.  Maybe you can try
profiling just the init of your IndexReader?  (Eg, run java with
-agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).

Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
as long as no document in the index ever had norms on (yes it does
"infect" heh).

Mike

On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
<mark.kristensson@smartsheet.com> wrote:
> While most of our Lucene indexes are used for more traditional searching,=
 this index in particular is used more like a reporting repository. Thus, w=
e really do need to have that many fields indexed and they do need to be br=
oken out into separate fields. There may be another way to structure the in=
dex to reduce the number of fields, but I'm hoping we can optimize the curr=
ent design and avoid (yet another) index redesign.
>
> I'll look into the tweaking the merge policy, but I'm more interested in =
disabling norms because scoring really doesn't matter for us. Basically, we=
 need nothing more than a binary answer from Lucene: either a record meets =
the provided criteria (which can be a rather complex boolean query with man=
y subqueries) or it doesn't. If the record does match, then we get the IDs =
from lucene and run off to get the live data from our primary data store an=
d sort it (in Java) based upon criteria provided by the user, not by score.
>
> After our initial design mushroomed in size, we redesigned and now (I tho=
ught) do not have norms on any of the fields in this index. So, I'm wonderi=
ng if there was something in the results from the CheckIndex that I provide=
d which indicates to you that we may have norms still enabled? I know that =
if you have norms on any one document's field, then any other document with=
 that same field will get "infected" with norms as well.
>
> My understanding is that any field that uses the constants =A0Index.NOT_A=
NALYZED_NO_NORMS or =A0Index.NO will not =A0have norms on it, regardless of=
 whether or not the field is stored. Is that not correct?
>
> Thanks,
> Mark
>
>
>
> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>
>> Likely what happened is you had a bunch of smaller segments, and then
>> suddenly they got merged into that one big segment (_aiaz) in your
>> index.
>>
>> The representation for norms in particular is not sparse, so this
>> means the size of the norms file for a given segment will be
>> number-of-unique-indexed-fields X number-of-documents.
>>
>> So this count grows quadratically on merge.
>>
>> Do these fields really need to be indexed? =A0 If so, it'd be better to
>> use a single field for all users for the indexable text if you can.
>>
>> Failing that, a simple workaround is to set the maxMergeMB/Docs on the
>> merge policy; this'd prevent big segments from being produced.
>> Disabling norms should also workaround this, though that will affect
>> hit scores...
>>
>> Mike
>>
>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>> <mark.kristensson@smartsheet.com> wrote:
>>> Yes, we do have a large number of unique field names in that index, bec=
ause they are driven by user named fields in our application (with some cle=
aning to remove illegal chars).
>>>
>>> This slowness problem has appeared very suddenly in the last couple of =
weeks and the number of unique field names has not spiked in the last few w=
eeks. Have we crept over some threshold with our linear growth in the numbe=
r of unique field names? Perhaps there is a limit driven by the amount of R=
AM in the machine that we are violating? Are there any guidelines for the m=
aximum number, or suggested number, of unique fields names in an index or s=
egment? Any suggestions for potentially mitigating the problem?
>>>
>>> Thanks,
>>> Mark
>>>
>>>
>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>>
>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>>
>>>>> I've run checkIndex against the index and the results are below. That=
 net is that it's telling me nothing is wrong with the index.
>>>>
>>>> Thanks.
>>>>
>>>>> I did not have any instrumentation around the opening of the IndexSea=
rcher (we don't use an IndexReader), just around the actual query execution=
 so I had to add some additional logging. What I found surprised me, openin=
g a search against this index takes the same 6 to 8 seconds that closing th=
e indexWriter takes.
>>>>
>>>> IndexWriter opens a SegmentReader for each segment in the index, to
>>>> apply deletions, so I think this is the source of the slowness.
>>>>
>>>> From the CheckIndex output, it looks like you have many (296,713)
>>>> unique fields names on that one large segment -- does that sound
>>>> right? =A0I suspect such a very high field count is the source of the
>>>> slowness...
>>>>
>>>> Mike
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47731-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 20:57:43 2010
Return-Path: <java-user-return-47731-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10948 invoked from network); 5 Nov 2010 20:57:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 20:57:43 -0000
Received: (qmail 35388 invoked by uid 500); 5 Nov 2010 20:58:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35344 invoked by uid 500); 5 Nov 2010 20:58:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35336 invoked by uid 99); 5 Nov 2010 20:58:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 20:58:11 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 20:58:04 +0000
Received: by bwz19 with SMTP id 19so3261720bwz.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 13:57:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=Fe+rQ24SSqEXSME66erUQpxQNxR/LdMTAcZn3w0p4fE=;
        b=sT6HFnl8Ygjnir/aMIO7FIj7sKxrr3NsQdhKqUMIQTRRbCyqAUleDFokF/VL5Vy6sY
         Q2t0+3neRoUR0k4ZDide2lau41Qv9MZh+SQQXFch6SQdTe3THc0voKjTsiXPfe4hlbn3
         FFttfUmHgemC5wdi7a52MazQVLtXEWmAIg+kM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=DWr1RuysZjZueK8rBLZMadPNF1S6c1iRAEVvbUf/Me5HPDp7zK6AiKgil8psfNbxh9
         8P/0I8T6V0X28gnQKx4x4WuhdJCXPYnSwxpZbcoHUQwc3ovhD7uDfZ+LhxSlM6qJsx4R
         6Q/fvJxIDCsfsr2tXiDEqRVf8SQUoAV9edZJ4=
Received: by 10.204.101.84 with SMTP id b20mr2214900bko.53.1288990664432; Fri,
 05 Nov 2010 13:57:44 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.121.145 with HTTP; Fri, 5 Nov 2010 13:57:24 -0700 (PDT)
In-Reply-To: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 5 Nov 2010 20:57:24 +0000
Message-ID: <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Do you get the bogus hit on the small index if search that index
alone?  Are you positive it only holds the one doc? Loading the one
doc into a new RAM based index in the test would prove it.

You are more likely to get help if post a self-contained example -
people can see everything relevant and are more likely to spot a
problem.


--
Ian.


On Thu, Nov 4, 2010 at 4:52 PM, David Fertig <dfertig@cymfony.com> wrote:
> I have an active lucene implementation that has been in place for a
> couple years and was recently upgraded to the 3.02 branch. We are now
> occasionally seeing documents returned from searches that should not be
> returned. I have reduced the code and indexes to the smallest set
> possible where I can still repeat the issue.
>
>
>
> My test cases uses 2 indexes. =A0These indexes have been rebuilt/optimize=
d
> using Luke 1.0.1 to make them the smallest possible. =A0One index has 1
> document, which is being returned by the query but should not. =A0 The
> other index has 1000 documents, none of which match the search criteria.
> The query should bring back 0 results, but brings back 1. =A0I can zip an=
d
> mail the indexes if it would aid in helping track down this issue.
>
>
>
>
>
>
>
> public class LuceneTest {
>
> =A0 =A0static public void main(String[] args) {
>
> =A0 =A0 =A0 =A0try {
>
> =A0 =A0 =A0 =A0 =A0 =A0QueryParser queryParser =3D new QueryParser(Versio=
n.LUCENE_30,
> "author", new KeywordAnalyzer());
>
> =A0 =A0 =A0 =A0 =A0 =A0Query query =3D queryParser.parse("author:bentalce=
lla AND NOT
> publish_date:[20100601 TO 20100630]");
>
> =A0 =A0 =A0 =A0 =A0 =A0Searchable[] searchables =3D new Searchable[2];
>
> =A0 =A0 =A0 =A0 =A0 =A0searchables[0] =3D new IndexSearcher(new NIOFSDire=
ctory(new
> File("/home/dfertig/testIndexes/b1")), true);
>
> =A0 =A0 =A0 =A0 =A0 =A0searchables[1] =3D new IndexSearcher(new NIOFSDire=
ctory(new
> File("/home/dfertig/testIndexes/m1")), true);
>
> =A0 =A0 =A0 =A0 =A0 =A0Searcher searcher =3D new MultiSearcher(searchable=
s);
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Query: " + query.toString());
>
> =A0 =A0 =A0 =A0 =A0 =A0TopDocs topDocs =3D searcher.search(query, 10);
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Results: " + topDocs.totalHits=
);
>
> =A0 =A0 =A0 =A0 =A0 =A0for (int in =3D 0; in < topDocs.totalHits; in++) {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Document document =3D
> searcher.doc(topDocs.scoreDocs[in].doc);
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.println("publish_date: " +
> document.get("publish_date"));
>
> =A0 =A0 =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0 =A0 =A0searcher.close();
>
> =A0 =A0 =A0 =A0} catch (Exception e) {
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(e.getMessage());
>
> =A0 =A0 =A0 =A0 =A0 =A0e.printStackTrace();
>
> =A0 =A0 =A0 =A0}
>
> =A0 =A0}
>
> }
>
>
>
>
>
>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47732-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 21:13:28 2010
Return-Path: <java-user-return-47732-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25217 invoked from network); 5 Nov 2010 21:13:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 21:13:27 -0000
Received: (qmail 57039 invoked by uid 500); 5 Nov 2010 21:13:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56960 invoked by uid 500); 5 Nov 2010 21:13:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56761 invoked by uid 99); 5 Nov 2010 21:13:54 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 21:13:54 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 21:13:48 +0000
Received: by bwz19 with SMTP id 19so3274387bwz.35
        for <java-user@lucene.apache.org>; Fri, 05 Nov 2010 14:13:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=ZhowocnPSyvvuchKdDRX5RCpuCDvm+Bifa8m0J6tsk4=;
        b=SI9mGnuVsnPQd1aJJGNuF/Ab3ak4W4i1/YFRJkVU3hrxxmVS5fzK/t1VcMNqkg+5e1
         4p7wQEst/T52mjLvainQGy4/i6Yl/wsdTkwVb3weGgWsvgqPVxuohe3RUgvhpZN/6ipI
         XQBN05gcllfiLExOZlz7CyUNFyMMFUJvjp8xk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=DpN0c2fh96xkFBm/v1xEUWDjyLvTUyA596yt5nO7yeTLrHvKY95LvP8YqXffVLk0bQ
         ix4B6c8rtzPMzBn3doDPkO8iywxA6LSpHmoqfDeIPv3XnfE7fSTSrk1+AGfHE0qvkUbC
         JhZEnFHUTZeWM1JAW+laEShgbwfSyV2eRhAzE=
Received: by 10.204.46.71 with SMTP id i7mr2209764bkf.134.1288991606741; Fri,
 05 Nov 2010 14:13:26 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.121.145 with HTTP; Fri, 5 Nov 2010 14:13:06 -0700 (PDT)
In-Reply-To: <504487.63660.qm@web32908.mail.mud.yahoo.com>
References: <504487.63660.qm@web32908.mail.mud.yahoo.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 5 Nov 2010 21:13:06 +0000
Message-ID: <AANLkTinhEtTAAQjeUpqtQbzfGiw=MFMgzR==32u3kR6Q@mail.gmail.com>
Subject: Re: Options for multiple filters
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

What is your chosen version?  At first glance I'd say your two
examples should be the same but I know there is lots going on behind
the scenes that I don't know about.  Is one giving you correct results
and the other not?

As for BooleanFilter - no idea.  FWIW I use QueryWrapperFilter,
CachingWrapperFilter and ChainedFilter.  Works for me.


--
Ian.

On Wed, Nov 3, 2010 at 6:18 PM, Justin <crynax@yahoo.com> wrote:
> Is there a behavioral difference between:
> =A0 =A0Query query =3D new FilteredQuery(query, filter1);
> =A0 =A0searcher.search(query, filter2, n);
>
> ...and:
> =A0 =A0ChainedFilter filter =3D new ChainedFilter(
> =A0 =A0 =A0 =A0new Filter[]{filter1, filter2}, ChainedFilter.AND);
> =A0 =A0searcher.search(query, filter, n);
>
>
> I chose the former after reading performance measurements here:
> http://wiki.apache.org/lucene-java/FilteringOptions
>
> But I'm definitely getting different results.
>
> I also see that BooleanFilter has been added since our chosen version. Is=
 that
> preferred to the above? Is it worthwhile to update the wiki?
>
> Thanks for any help!
> Justin
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47733-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 05 21:18:19 2010
Return-Path: <java-user-return-47733-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26836 invoked from network); 5 Nov 2010 21:18:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 5 Nov 2010 21:18:19 -0000
Received: (qmail 64609 invoked by uid 500); 5 Nov 2010 21:18:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64564 invoked by uid 500); 5 Nov 2010 21:18:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64556 invoked by uid 99); 5 Nov 2010 21:18:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 21:18:48 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 05 Nov 2010 21:18:41 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Search returning documents matching a NOT range
Date: Fri, 5 Nov 2010 17:18:19 -0400
Message-ID: <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
In-Reply-To: <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Search returning documents matching a NOT range
Thread-Index: Act9LCrj87jQGkDVTNaPTQd3wfDvkAAAie9w
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com> <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

Ian,
Thank you for getting back to me.  No, I do not get a bogus hit from =
searching the small index alone.  Also, I do not get a hit if I delete =
any more documents from the larger index.

I have updated my test to use RamDirectory and also print maxDoc() for =
the searchables and the searcher, all numbers are as expected.  I have =
posted all the code, but did not want to post the indexes due to their =
size (2.2 meg uncompressed).  I will mail them to anyone who can help.

Here is the complete latest test code and its output



public class LuceneTest {
    static public void main(String[] args) {
        try {
            QueryParser queryParser =3D new =
QueryParser(Version.LUCENE_30, "author", new KeywordAnalyzer());
            Query query =3D queryParser.parse("author:bentalcella AND =
NOT publish_date:[20100601 TO 20100630]");
            Searchable[] searchables =3D new Searchable[2];
            RAMDirectory ram1 =3D new RAMDirectory(new =
NIOFSDirectory(new File("/home/dfertig/testIndexes/b1")));
            RAMDirectory ram2 =3D new RAMDirectory(new =
NIOFSDirectory(new File("/home/dfertig/testIndexes/m1")));
            searchables[0] =3D new IndexSearcher(ram1, true);
            searchables[1] =3D new IndexSearcher(ram2, true);
            MultiSearcher searcher =3D new MultiSearcher(searchables);
            System.out.println("MaxDocs for index 1: " + =
searchables[0].maxDoc());
            System.out.println("MaxDocs for index 2: " + =
searchables[1].maxDoc());
            System.out.println("MaxDocs for MultiSearcher: " + =
searcher.maxDoc());
            System.out.println("Query: " + query.toString());
            TopDocs topDocs =3D searcher.search(query, 10);
            System.out.println("Results: " + topDocs.totalHits);
            for (int in =3D 0; in < topDocs.totalHits; in++) {
                Document document =3D =
searcher.doc(topDocs.scoreDocs[in].doc);
                System.out.println("publish_date: " + =
document.get("publish_date"));
            }
            searcher.close();
            ram1.close();
            ram2.close();
        } catch (Exception e) {
            System.out.println(e.getMessage());
            e.printStackTrace();
        }
    }
}

Output:
MaxDocs for index 1: 1
MaxDocs for index 2: 1000
MaxDocs for MultiSearcher: 1001
Query: +author:bentalcella -publish_date:[20100601 TO 20100630]
Results: 1
publish_date: 20100606




-----Original Message-----
From: Ian Lea [mailto:ian.lea@gmail.com]=20
Sent: Friday, November 5, 2010 4:57 PM
To: java-user@lucene.apache.org
Subject: Re: Search returning documents matching a NOT range

Do you get the bogus hit on the small index if search that index
alone?  Are you positive it only holds the one doc? Loading the one
doc into a new RAM based index in the test would prove it.

You are more likely to get help if post a self-contained example -
people can see everything relevant and are more likely to spot a
problem.


--
Ian.


On Thu, Nov 4, 2010 at 4:52 PM, David Fertig <dfertig@cymfony.com> =
wrote:
> I have an active lucene implementation that has been in place for a
> couple years and was recently upgraded to the 3.02 branch. We are now
> occasionally seeing documents returned from searches that should not =
be
> returned. I have reduced the code and indexes to the smallest set
> possible where I can still repeat the issue.
>
>
>
> My test cases uses 2 indexes. =A0These indexes have been =
rebuilt/optimized
> using Luke 1.0.1 to make them the smallest possible. =A0One index has =
1
> document, which is being returned by the query but should not. =A0 The
> other index has 1000 documents, none of which match the search =
criteria.
> The query should bring back 0 results, but brings back 1. =A0I can zip =
and
> mail the indexes if it would aid in helping track down this issue.
>
>
>
>
>
>
>
> public class LuceneTest {
>
> =A0 =A0static public void main(String[] args) {
>
> =A0 =A0 =A0 =A0try {
>
> =A0 =A0 =A0 =A0 =A0 =A0QueryParser queryParser =3D new =
QueryParser(Version.LUCENE_30,
> "author", new KeywordAnalyzer());
>
> =A0 =A0 =A0 =A0 =A0 =A0Query query =3D =
queryParser.parse("author:bentalcella AND NOT
> publish_date:[20100601 TO 20100630]");
>
> =A0 =A0 =A0 =A0 =A0 =A0Searchable[] searchables =3D new Searchable[2];
>
> =A0 =A0 =A0 =A0 =A0 =A0searchables[0] =3D new IndexSearcher(new =
NIOFSDirectory(new
> File("/home/dfertig/testIndexes/b1")), true);
>
> =A0 =A0 =A0 =A0 =A0 =A0searchables[1] =3D new IndexSearcher(new =
NIOFSDirectory(new
> File("/home/dfertig/testIndexes/m1")), true);
>
> =A0 =A0 =A0 =A0 =A0 =A0Searcher searcher =3D new =
MultiSearcher(searchables);
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Query: " + =
query.toString());
>
> =A0 =A0 =A0 =A0 =A0 =A0TopDocs topDocs =3D searcher.search(query, 10);
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Results: " + =
topDocs.totalHits);
>
> =A0 =A0 =A0 =A0 =A0 =A0for (int in =3D 0; in < topDocs.totalHits; =
in++) {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Document document =3D
> searcher.doc(topDocs.scoreDocs[in].doc);
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.println("publish_date: " +
> document.get("publish_date"));
>
> =A0 =A0 =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0 =A0 =A0searcher.close();
>
> =A0 =A0 =A0 =A0} catch (Exception e) {
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(e.getMessage());
>
> =A0 =A0 =A0 =A0 =A0 =A0e.printStackTrace();
>
> =A0 =A0 =A0 =A0}
>
> =A0 =A0}
>
> }
>
>
>
>
>
>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47734-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 06 10:13:49 2010
Return-Path: <java-user-return-47734-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93178 invoked from network); 6 Nov 2010 10:13:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 6 Nov 2010 10:13:48 -0000
Received: (qmail 5937 invoked by uid 500); 6 Nov 2010 10:14:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5681 invoked by uid 500); 6 Nov 2010 10:14:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5673 invoked by uid 99); 6 Nov 2010 10:14:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 06 Nov 2010 10:14:13 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 06 Nov 2010 10:14:06 +0000
Received: by wwb17 with SMTP id 17so2101338wwb.5
        for <java-user@lucene.apache.org>; Sat, 06 Nov 2010 03:13:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.216.19.134 with SMTP id n6mr4208578wen.9.1289038424314; Sat,
 06 Nov 2010 03:13:44 -0700 (PDT)
Received: by 10.216.93.14 with HTTP; Sat, 6 Nov 2010 03:13:44 -0700 (PDT)
In-Reply-To: <1288969238216-1848702.post@n3.nabble.com>
References: <1288857235054-1839942.post@n3.nabble.com>
	<47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
	<1288942381985-1846800.post@n3.nabble.com>
	<AANLkTinbBtdodffUk7yWHmaB2pJVGD1J6k0yBQCSjXux@mail.gmail.com>
	<1288969238216-1848702.post@n3.nabble.com>
Date: Sat, 6 Nov 2010 06:13:44 -0400
Message-ID: <AANLkTinKjTPX7JOjbi=F6x-v0tSQZNEh88dGBUnB1SRA@mail.gmail.com>
Subject: Re: High frequency term for the searched query
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Looks like maybe if you use MoreLikeThis directly, you can call it's
retrieveInterestingTerms(Reader) method?

Or, MoreLikeThisQuery.rewrite will return a BooleanQuery whose clauses
are the interesting terms?

Mike

On Fri, Nov 5, 2010 at 11:00 AM, starz10de <farag_ahmed@yahoo.com> wrote:
>
> HI Mike,
>
> I implemented MoreLikeThis but I couldn't figure out where or how to print
> the related term to the given query. All what I got is the relevant
> documents to the query with their scores.
>
> Any idea how to get the related terms?
>
> --
> View this message in context: http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1848702.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47735-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 06 12:50:56 2010
Return-Path: <java-user-return-47735-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45686 invoked from network); 6 Nov 2010 12:50:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 6 Nov 2010 12:50:56 -0000
Received: (qmail 90095 invoked by uid 500); 6 Nov 2010 12:51:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89867 invoked by uid 500); 6 Nov 2010 12:51:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 54502 invoked by uid 99); 6 Nov 2010 11:41:00 -0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Date: Sat, 6 Nov 2010 04:40:32 -0700 (PDT)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1289043632702-1852936.post@n3.nabble.com>
In-Reply-To: <AANLkTinKjTPX7JOjbi=F6x-v0tSQZNEh88dGBUnB1SRA@mail.gmail.com>
References: <1288857235054-1839942.post@n3.nabble.com> <47316FE3F6BA0D4DADF996635125526808EB885F28@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu> <1288942381985-1846800.post@n3.nabble.com> <AANLkTinbBtdodffUk7yWHmaB2pJVGD1J6k0yBQCSjXux@mail.gmail.com> <1288969238216-1848702.post@n3.nabble.com> <AANLkTinKjTPX7JOjbi=F6x-v0tSQZNEh88dGBUnB1SRA@mail.gmail.com>
Subject: Re: High frequency term for the searched query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Hi Mic,

I tried like this:

 String indexName = "path";
 IndexReader r = IndexReader.open(indexName);
 MoreLikeThis mlt = new MoreLikeThis(r);
. .
. .
. .
. .
 BooleanQuery result = (BooleanQuery) mlt.like(docNum);
        result.add(query, BooleanClause.Occur.MUST_NOT);
       
how I can print the result content to see if it contain the releated terms
to the query ?  

 I tried also:
    String []   wordlist=mlt.retrieveInterestingTerms(r);
but was some error "the method retrieveInterestingTerms(int) in the type
MoreLikeThis is not applicable for the arguments (IndexReader)"

thanks a lot
-- 
View this message in context: http://lucene.472066.n3.nabble.com/High-frequency-term-for-the-searched-query-tp1839942p1852936.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47736-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 07 07:24:58 2010
Return-Path: <java-user-return-47736-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45069 invoked from network); 7 Nov 2010 07:24:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Nov 2010 07:24:58 -0000
Received: (qmail 6729 invoked by uid 500); 7 Nov 2010 07:25:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6349 invoked by uid 500); 7 Nov 2010 07:25:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6341 invoked by uid 99); 7 Nov 2010 07:25:22 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 07:25:22 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [98.139.91.216] (HELO nm19-vm0.bullet.mail.sp2.yahoo.com) (98.139.91.216)
    by apache.org (qpsmtpd/0.29) with SMTP; Sun, 07 Nov 2010 07:25:13 +0000
Received: from [98.139.91.66] by nm19.bullet.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 07:24:52 -0000
Received: from [98.139.91.2] by tm6.bullet.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 07:24:52 -0000
Received: from [127.0.0.1] by omp1002.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 07:24:52 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 699070.65285.bm@omp1002.mail.sp2.yahoo.com
Received: (qmail 44369 invoked by uid 60001); 7 Nov 2010 07:18:11 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1289114291; bh=3IFwa6h5+4OIpA2xwEBv+PBFuhsy+Yivrgflq2cNNFo=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=VFOqb55OVHTukHPCpwsaHl2r8PS6ZIID83Lp8CHnlfCF2DRRf6HZyL47wl7PFo/Ri83dOjUnm9+oo/+L0JNhIBS01O/XLzHYW6lRH88l0l0laovLgKZS3Pc4EPzLwIs7NeewH9mXqUU0nUEoNSnh9IY9t3GRjklQYOyBPVLxQWY=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=O1Qhg0QmqKJjPZCEJKwNvfi6Nmgp4UDHa4bCyPkyEBS0mPDh1j5+PvZpR2dx1R3eMZdtXr/M9wzeGwv7Pl9VM9UXSYW8y4N48SH/Q7UW+KMcsVYEpFfql0nq4Az6siTSyq1wCuR0Y7fERdrK21fp7wrJ4ivsiMPVs3WRDZdVZis=;
Message-ID: <70996.40597.qm@web113306.mail.gq1.yahoo.com>
X-YMail-OSG: 925vnIwVM1l3miH4lBK3KThilFyb5veU4rSeBsXCR8F0Lg5
 KJh6pnJzgqwo6dx7FWk7tS1OGAgF7nH0BRxzlHlkUFCfwO92tyaDULWOR8gL
 YFUUStjbYev3iosghLdxpi3Z8QavvAL96IXkSRrjMSngjAWiKHIcMQ.C3BSb
 wGRUxYVwUXFICmtx0XD6BVV6iL1KuxxOYxPjlZtbnZh9hz_.LL797xC4IxNQ
 2NVAJRfBdB6.5j5VhcdlZC7OFTG07w57L00sHBjowWMN0CkmamyX5dMwrOO3
 8GhTP2Vmb8oSPp2UueRTAfGDxTtTTQ2kMLF99DWz6pRTyvy0h_t8azLg-
Received: from [78.86.199.52] by web113306.mail.gq1.yahoo.com via HTTP; Sun, 07 Nov 2010 00:18:10 PDT
X-Mailer: YahooMailClassic/11.4.9 YahooMailWebService/0.8.107.284920
Date: Sun, 7 Nov 2010 00:18:10 -0700 (PDT)
From: farouk alhassan <osbert252003@yahoo.com>
Subject: Newbie Question
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-298661499-1289114290=:40597"

--0-298661499-1289114290=:40597
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi All,

I'm new to Lucene and have picked up the Lucene in Action book to get start=
ed. Really enjoying it but I have a small nagging question.

Is the index stored in the same "physical document" as the fields and value=
s? If not, where is it stored and how is it linked.

This is because of this statement in the book

When you retrieve a document from the index, only stored fields will be pre=
sent. For example, fields that were indexed but not stored won't be in the =
document. This behavior
is frequently a source of confusion

Thanks
Farouk A=0A=0A=0A      
--0-298661499-1289114290=:40597--

From java-user-return-47737-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 07 08:30:31 2010
Return-Path: <java-user-return-47737-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62689 invoked from network); 7 Nov 2010 08:30:31 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Nov 2010 08:30:31 -0000
Received: (qmail 25595 invoked by uid 500); 7 Nov 2010 08:31:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25402 invoked by uid 500); 7 Nov 2010 08:30:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25394 invoked by uid 99); 7 Nov 2010 08:30:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 08:30:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of senthilruban@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 08:30:50 +0000
Received: by qyk32 with SMTP id 32so412033qyk.14
        for <java-user@lucene.apache.org>; Sun, 07 Nov 2010 01:30:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=08yuKCs0Hh3jmADfZSe/o5mjW/pUfF+duBmLXKKE5Ec=;
        b=ghRKcJ2ELjaXMl4eT35+oIwKphMyG53boDy1zUc/l2ovwxYGwZZyug4FvrCWjRHVru
         d7MeBybko0RJc1Zq00c0sbyF+q3FQ3Wh0Gpwl3WKaqrwSrinoFIsL9KrZwITP0JnKE+5
         hcI4MbFzF76nyB2caBXZDoenNdAMU34X6AP6w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=qwLnhBCionIdxQT6i+BuHtTM1l14ghoTRll+wtDPTqir4f/mG/kFV1xDluTewJ4Pox
         fq/7inyun4OXAdlzS4LVvjmYOzzBRmVJcXy8/jlZZl8lCdbUpCU8bG3+/NbQOt2X7Ixr
         pW4UtwJ3to5wyMKFX0XZPQ9uzM7H4MIO2LIno=
MIME-Version: 1.0
Received: by 10.229.87.72 with SMTP id v8mr3754595qcl.215.1289118629473; Sun,
 07 Nov 2010 01:30:29 -0700 (PDT)
Received: by 10.229.187.18 with HTTP; Sun, 7 Nov 2010 01:30:29 -0700 (PDT)
In-Reply-To: <70996.40597.qm@web113306.mail.gq1.yahoo.com>
References: <70996.40597.qm@web113306.mail.gq1.yahoo.com>
Date: Sun, 7 Nov 2010 21:30:29 +1300
Message-ID: <AANLkTi=F2nRgfmmqZv1HeSgJsBcMVd6DtUyD53=WFV9K@mail.gmail.com>
Subject: Re: Newbie Question
From: Senthil <senthilruban@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016367f99f8fbaff5049472519f

--0016367f99f8fbaff5049472519f
Content-Type: text/plain; charset=ISO-8859-1

Hi,
  I recommend you to try simple indexer and searcher code from book which
clear the confusion.

  You need to specify the indexing folder and all the fields and values
selected for indexing will stored in that folder. And during search, it
searches from index and get the reference file path for search result too.

regards
Senthil


On Sun, Nov 7, 2010 at 8:18 PM, farouk alhassan <osbert252003@yahoo.com>wrote:

> Hi All,
>
> I'm new to Lucene and have picked up the Lucene in Action book to get
> started. Really enjoying it but I have a small nagging question.
>
> Is the index stored in the same "physical document" as the fields and
> values? If not, where is it stored and how is it linked.
>
> This is because of this statement in the book
>
> When you retrieve a document from the index, only stored fields will be
> present. For example, fields that were indexed but not stored won't be in
> the document. This behavior
> is frequently a source of confusion
>
> Thanks
> Farouk A
>
>
>

--0016367f99f8fbaff5049472519f--

From java-user-return-47738-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 07 09:09:42 2010
Return-Path: <java-user-return-47738-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76491 invoked from network); 7 Nov 2010 09:09:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Nov 2010 09:09:42 -0000
Received: (qmail 37173 invoked by uid 500); 7 Nov 2010 09:10:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36819 invoked by uid 500); 7 Nov 2010 09:10:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36808 invoked by uid 99); 7 Nov 2010 09:10:06 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 09:10:06 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [98.139.91.75] (HELO nm5.bullet.mail.sp2.yahoo.com) (98.139.91.75)
    by apache.org (qpsmtpd/0.29) with SMTP; Sun, 07 Nov 2010 09:09:57 +0000
Received: from [98.139.91.64] by nm5.bullet.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 09:09:37 -0000
Received: from [98.139.91.59] by tm4.bullet.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 09:09:37 -0000
Received: from [127.0.0.1] by omp1059.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 09:09:37 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 274673.25785.bm@omp1059.mail.sp2.yahoo.com
Received: (qmail 17119 invoked by uid 60001); 7 Nov 2010 09:09:36 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1289120976; bh=NBbvk1gBx3HU+hc5vkPd7iiLQ20P0cDsNoV48MDaYAg=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=rkGeLx1VEZTEWXeZd4zYk+T0hkBmR/+UmEAFCZRJJ3je7v071C4sZBiU8Z4O9Sva2aGBXPwAWpyjXqyKZaMwGAPIpVzxzWFCWlZukowDuXoXr6xYvEiV5Bg4DJE4cozTmpvsV2sWPnmsgSy7imFzrep7ke3I08lugx0J/3y7cGc=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=H6clwhlYBRB1s7R/gVmk9rP7TIG2BUlhJM3Sa0t9ueDMwT8Pd9OYB8OuE+ogfm+13uBzoSJ0eNVfGKiq2moRK6OaQJM5BTELsyPouiHvt8u0thYhdD9CZArQ6rdHVMwuj9BI6IRZm8cv5CtGqbEO4AuXjSwES+Yy64+FWQUrAPQ=;
Message-ID: <771399.17100.qm@web113305.mail.gq1.yahoo.com>
X-YMail-OSG: ffLQ48UVM1lwxJiR626pg5neXz7tm0jkawkc0hQhRpqu71d
 i1gOg7RENPVu9iZvcBJtpFpK0xfQm0sRvp4IEbVEnkHRtOMyQrvngMqQANYj
 MB2.CxKieuCbvFbj9VYcxTYwkuEkefhqNzm2xU4Zx6paCD45gazyRUk4NWwQ
 cHRXkRJyD5cTEOpX4unRSy_UCC67IicW.lcK1fvAzqLdFSjRmy.TKnR6RCHK
 4PEtotkwC_7P12yYAyo8kS8UIpH5U4uz5xjN_x9TJHG2o6lyYrvJXpRmDTXY
 mIYq4N.qWGlWeZRBhEOPLDm.i7ZOAp_jZjHluEbdxvt_7wr73HKgZ6LEzpO8
 Enwc7yejE_dM18nuAsJO0E09CIrC_ZWmg.TQ-
Received: from [78.86.199.52] by web113305.mail.gq1.yahoo.com via HTTP; Sun, 07 Nov 2010 01:09:36 PST
X-Mailer: YahooMailClassic/11.4.9 YahooMailWebService/0.8.107.284920
Date: Sun, 7 Nov 2010 01:09:36 -0800 (PST)
From: farouk alhassan <osbert252003@yahoo.com>
Subject: Re: Newbie Question
To: java-user@lucene.apache.org
In-Reply-To: <AANLkTi=F2nRgfmmqZv1HeSgJsBcMVd6DtUyD53=WFV9K@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-872529027-1289120976=:17100"

--0-872529027-1289120976=:17100
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Thanks for your response.
I have already done that and understand the code perfectly.

Just to rephrase my question

What is the relationship between an index and a document at the conceptual =
level.

Does an index include a document or an index is a collection of documents?

Also is index =3D=3D document if there is only one document?

Thanks

--- On Sun, 7/11/10, Senthil <senthilruban@gmail.com> wrote:

From: Senthil <senthilruban@gmail.com>
Subject: Re: Newbie Question
To: java-user@lucene.apache.org
Date: Sunday, 7 November, 2010, 8:30

Hi,
=A0 I recommend you to try simple indexer and searcher code from book which
clear the confusion.

=A0 You need to specify the indexing folder and all the fields and values
selected for indexing will stored in that folder. And during search, it
searches from index and get the reference file path for search result too.

regards
Senthil


On Sun, Nov 7, 2010 at 8:18 PM, farouk alhassan <osbert252003@yahoo.com>wro=
te:

> Hi All,
>
> I'm new to Lucene and have picked up the Lucene in Action book to get
> started. Really enjoying it but I have a small nagging question.
>
> Is the index stored in the same "physical document" as the fields and
> values? If not, where is it stored and how is it linked.
>
> This is because of this statement in the book
>
> When you retrieve a document from the index, only stored fields will be
> present. For example, fields that were indexed but not stored won't be in
> the document. This behavior
> is frequently a source of confusion
>
> Thanks
> Farouk A
>
>
>
=0A=0A=0A      
--0-872529027-1289120976=:17100--

From java-user-return-47739-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 07 09:54:52 2010
Return-Path: <java-user-return-47739-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85606 invoked from network); 7 Nov 2010 09:54:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Nov 2010 09:54:52 -0000
Received: (qmail 63780 invoked by uid 500); 7 Nov 2010 09:55:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63380 invoked by uid 500); 7 Nov 2010 09:55:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63372 invoked by uid 99); 7 Nov 2010 09:55:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 09:55:17 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of itsadok@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 09:55:11 +0000
Received: by wyf19 with SMTP id 19so1321271wyf.35
        for <java-user@lucene.apache.org>; Sun, 07 Nov 2010 01:54:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=fbkms/YwTHHJOk79S5dqOSqQQK8SvsHT7lJJnNRubUg=;
        b=n3bttPgi7dV3tDz1YEe7nDBgs5zag9T7abcWutz3w3oaPcwSQA2R1r9/VMr+1xg/3R
         0TPCmeed8y38xQctUWKMfAX+7cLJlZ8veZHo60Kb3fkvMTcBCyqDeo3Q1bFVrfXe26KD
         t6iRr46bPyVsaA2QKgz7p9o2yYh4MfCBROuP4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=JUxleD25MaI6CqE8yBIL1GITSoqhp8qVYRRK6sXTMPlv9YQk8YhFgZmgSJzcLNiquh
         Pi0qNOYV3R8AJu+5VY8GYYjVL7hQo4grHMNiu0bhc/fhh73zlkWJvimoyw+9JjuE1m42
         W4e+UZAdk8MhnbKcoPUmUig0Fr56yKDnARKeg=
Received: by 10.227.145.6 with SMTP id b6mr2745159wbv.163.1289123689454; Sun,
 07 Nov 2010 01:54:49 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.68.193 with HTTP; Sun, 7 Nov 2010 01:54:29 -0800 (PST)
In-Reply-To: <771399.17100.qm@web113305.mail.gq1.yahoo.com>
References: <AANLkTi=F2nRgfmmqZv1HeSgJsBcMVd6DtUyD53=WFV9K@mail.gmail.com> <771399.17100.qm@web113305.mail.gq1.yahoo.com>
From: Israel Tsadok <itsadok@gmail.com>
Date: Sun, 7 Nov 2010 11:54:29 +0200
Message-ID: <AANLkTi=3ZmtX2=3tPtsetJB1XjhcH3Brbv3K0Y+LffyC@mail.gmail.com>
Subject: Re: Newbie Question
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016367fb64194dd1b0494737fd1

--0016367fb64194dd1b0494737fd1
Content-Type: text/plain; charset=ISO-8859-1

(If I may)
In Lucene terminology, an "index" is what would be a "database" in RDBMS
terminology. It's the whole thing.
A document is akin to a row in a table. Most of the interesting stuff in
lucene revolves around locating the document, not retrieving the data
actually stored inside it. This is done using Term Vectors, Norms, Term
Frequencies, Document Frequencies etc. These are not stored per document,
but are rather properties of the whole index, and they are therefore similar
to the concept of "index" in an RDBMS.

I hope I didn't make to much of a mess trying to clear things up. I probably
missed some parts and may have misrepresented others, but this is roughly
how I look at it.

Israel

On Sun, Nov 7, 2010 at 11:09 AM, farouk alhassan <osbert252003@yahoo.com>wrote:

> Thanks for your response.
> I have already done that and understand the code perfectly.
>
> Just to rephrase my question
>
> What is the relationship between an index and a document at the conceptual
> level.
>
> Does an index include a document or an index is a collection of documents?
>
> Also is index == document if there is only one document?
>
> Thanks
>
> --- On Sun, 7/11/10, Senthil <senthilruban@gmail.com> wrote:
>
> From: Senthil <senthilruban@gmail.com>
> Subject: Re: Newbie Question
> To: java-user@lucene.apache.org
> Date: Sunday, 7 November, 2010, 8:30
>
> Hi,
>   I recommend you to try simple indexer and searcher code from book which
> clear the confusion.
>
>   You need to specify the indexing folder and all the fields and values
> selected for indexing will stored in that folder. And during search, it
> searches from index and get the reference file path for search result too.
>
> regards
> Senthil
>
>
> On Sun, Nov 7, 2010 at 8:18 PM, farouk alhassan <osbert252003@yahoo.com
> >wrote:
>
> > Hi All,
> >
> > I'm new to Lucene and have picked up the Lucene in Action book to get
> > started. Really enjoying it but I have a small nagging question.
> >
> > Is the index stored in the same "physical document" as the fields and
> > values? If not, where is it stored and how is it linked.
> >
> > This is because of this statement in the book
> >
> > When you retrieve a document from the index, only stored fields will be
> > present. For example, fields that were indexed but not stored won't be in
> > the document. This behavior
> > is frequently a source of confusion
> >
> > Thanks
> > Farouk A
> >
> >
> >
>
>
>
>
>

--0016367fb64194dd1b0494737fd1--

From java-user-return-47740-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 07 10:16:04 2010
Return-Path: <java-user-return-47740-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98641 invoked from network); 7 Nov 2010 10:16:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Nov 2010 10:16:04 -0000
Received: (qmail 71135 invoked by uid 500); 7 Nov 2010 10:16:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70846 invoked by uid 500); 7 Nov 2010 10:16:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70838 invoked by uid 99); 7 Nov 2010 10:16:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 10:16:30 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [98.139.91.246] (HELO nm14-vm0.bullet.mail.sp2.yahoo.com) (98.139.91.246)
    by apache.org (qpsmtpd/0.29) with SMTP; Sun, 07 Nov 2010 10:16:21 +0000
Received: from [98.139.91.66] by nm14.bullet.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 10:16:00 -0000
Received: from [98.139.91.56] by tm6.bullet.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 10:16:00 -0000
Received: from [127.0.0.1] by omp1056.mail.sp2.yahoo.com with NNFMP; 07 Nov 2010 10:16:00 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 902978.33556.bm@omp1056.mail.sp2.yahoo.com
Received: (qmail 99211 invoked by uid 60001); 7 Nov 2010 10:09:19 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1289124559; bh=J1QFkKgRmPkGxVM+xQAtE8c+Zhe+Mo911y8fSVn14JM=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=kkH9E2TjQ/oQHQwVr8xSwX8uhWFCzi/uhztxil9y5rsImjtyDgTMkyOU4rDSNfAO+woeUiGo8WpvlQZjZgsRAZEDepHtxyIBk1nivBcTcecCTt6fNWFM6/H7sEPahqubNgMupDlaoohOqO1tX2RtRiS2tkHcMhjqzfUPRa6gi9E=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=ifFGmVA6em0EDFsojWuO6FJhiCbXUKGxxBteQgEUm0wRcXAAM60yjGvuVNO7ayhGvQ/wm8HWlAUFB+zZLjpLKz/oWTJN9z/EZWz//pojQJuvAGHPWtwD2xSOaYE0JmC3JVWr5IRZgCZ63UV2O9RqbknptghG/RJtepHNEseRX6M=;
Message-ID: <515974.96442.qm@web113303.mail.gq1.yahoo.com>
X-YMail-OSG: hzK3ESAVM1n5rNdEhlsc1zvL0T4MFjVeDB67hRRmaY23D5A
 M0tf2vjMv
Received: from [78.86.199.52] by web113303.mail.gq1.yahoo.com via HTTP; Sun, 07 Nov 2010 02:09:18 PST
X-Mailer: YahooMailClassic/11.4.9 YahooMailWebService/0.8.107.284920
Date: Sun, 7 Nov 2010 02:09:18 -0800 (PST)
From: farouk alhassan <osbert252003@yahoo.com>
Subject: Re: Newbie Question
To: java-user@lucene.apache.org
In-Reply-To: <AANLkTi=3ZmtX2=3tPtsetJB1XjhcH3Brbv3K0Y+LffyC@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1124940013-1289124558=:96442"

--0-1124940013-1289124558=:96442
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi,

Thanks for your cobntribution. very much welcomed. I like the way you relat=
e it to a relational database. we are all familiar with databases so it mak=
es it even much more clearer.

I also like the indexing details ...
Hoping to be a Lucene guru very sooon!!

Tx

--- On Sun, 7/11/10, Israel Tsadok <itsadok@gmail.com> wrote:

From: Israel Tsadok <itsadok@gmail.com>
Subject: Re: Newbie Question
To: java-user@lucene.apache.org
Date: Sunday, 7 November, 2010, 9:54

(If I may)
In Lucene terminology, an "index" is what would be a "database" in RDBMS
terminology. It's the whole thing.
A document is akin to a row in a table. Most of the interesting stuff in
lucene revolves around locating the document, not retrieving the data
actually stored inside it. This is done using Term Vectors, Norms, Term
Frequencies, Document Frequencies etc. These are not stored per document,
but are rather properties of the whole index, and they are therefore simila=
r
to the concept of "index" in an RDBMS.

I hope I didn't make to much of a mess trying to clear things up. I probabl=
y
missed some parts and may have misrepresented others, but this is roughly
how I look at it.

Israel

On Sun, Nov 7, 2010 at 11:09 AM, farouk alhassan <osbert252003@yahoo.com>wr=
ote:

> Thanks for your response.
> I have already done that and understand the code perfectly.
>
> Just to rephrase my question
>
> What is the relationship between an index and a document at the conceptua=
l
> level.
>
> Does an index include a document or an index is a collection of documents=
?
>
> Also is index =3D=3D document if there is only one document?
>
> Thanks
>
> --- On Sun, 7/11/10, Senthil <senthilruban@gmail.com> wrote:
>
> From: Senthil <senthilruban@gmail.com>
> Subject: Re: Newbie Question
> To: java-user@lucene.apache.org
> Date: Sunday, 7 November, 2010, 8:30
>
> Hi,
>=A0=A0=A0I recommend you to try simple indexer and searcher code from book=
 which
> clear the confusion.
>
>=A0=A0=A0You need to specify the indexing folder and all the fields and va=
lues
> selected for indexing will stored in that folder. And during search, it
> searches from index and get the reference file path for search result too=
.
>
> regards
> Senthil
>
>
> On Sun, Nov 7, 2010 at 8:18 PM, farouk alhassan <osbert252003@yahoo.com
> >wrote:
>
> > Hi All,
> >
> > I'm new to Lucene and have picked up the Lucene in Action book to get
> > started. Really enjoying it but I have a small nagging question.
> >
> > Is the index stored in the same "physical document" as the fields and
> > values? If not, where is it stored and how is it linked.
> >
> > This is because of this statement in the book
> >
> > When you retrieve a document from the index, only stored fields will be
> > present. For example, fields that were indexed but not stored won't be =
in
> > the document. This behavior
> > is frequently a source of confusion
> >
> > Thanks
> > Farouk A
> >
> >
> >
>
>
>
>
>
=0A=0A=0A      
--0-1124940013-1289124558=:96442--

From java-user-return-47741-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 07 16:11:37 2010
Return-Path: <java-user-return-47741-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40299 invoked from network); 7 Nov 2010 16:11:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 7 Nov 2010 16:11:36 -0000
Received: (qmail 37889 invoked by uid 500); 7 Nov 2010 16:12:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37837 invoked by uid 500); 7 Nov 2010 16:12:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37826 invoked by uid 99); 7 Nov 2010 16:12:04 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 16:12:04 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 07 Nov 2010 16:11:59 +0000
Received: by qwk3 with SMTP id 3so4191581qwk.35
        for <java-user@lucene.apache.org>; Sun, 07 Nov 2010 08:11:38 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=9KSUjuI0NMRgYp/T9IbHANGSwzq/Xw3dMEXo2fMOdf8=;
        b=ofnewjcTtt7UQw/c5oCdcjBhCUjMW4ma49LLdfuAQOpcXiAcKy5MBkjOqf5fCnQoEE
         L4rVyNnnOUbKkt4A6Mso6b7a+fyVigQDAPoNw35hCG9ocOhHatWvE4qOrlLNKO5JAoUu
         EUHt32hMGUCmmteAfJ3W4chfqUDMw/5rCpJ+A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n1nlxA3EmMwNRWbmWGdh5ceImu50TWyMbfAuGc4xEucKkLensta12y62+0G0rhms8C
         p9IvheP5O14u8e+/jemcxsoHlZDK4u/qKWbXHQsffoUYiyPNWa9NGGVNVZBTID0sWSUx
         ZMSfQM+YIZpb9HySAJVInYU7WT7RLuKERWNzg=
MIME-Version: 1.0
Received: by 10.224.195.138 with SMTP id ec10mr1109611qab.42.1289146298641;
 Sun, 07 Nov 2010 08:11:38 -0800 (PST)
Received: by 10.229.216.19 with HTTP; Sun, 7 Nov 2010 08:11:38 -0800 (PST)
In-Reply-To: <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
	<AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
Date: Sun, 7 Nov 2010 11:11:38 -0500
Message-ID: <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf300fabd531ace1049478c368

--20cf300fabd531ace1049478c368
Content-Type: text/plain; charset=ISO-8859-1

What kind of field is publish_date? And how do you store data there?
Is it possible you're getting some date presentation wonkiness in here?
One thing that might shed light on your problem is if you enumerated the
terms in that field and
printed them out rather than the document.get. That is, be sure you're
getting what's in the index
(and thus being searched) rather than wha's stored in the document.

Luke might get you there faster/easier....

Best
Erick

On Fri, Nov 5, 2010 at 5:18 PM, David Fertig <dfertig@cymfony.com> wrote:

> Ian,
> Thank you for getting back to me.  No, I do not get a bogus hit from
> searching the small index alone.  Also, I do not get a hit if I delete any
> more documents from the larger index.
>
> I have updated my test to use RamDirectory and also print maxDoc() for the
> searchables and the searcher, all numbers are as expected.  I have posted
> all the code, but did not want to post the indexes due to their size (2.2
> meg uncompressed).  I will mail them to anyone who can help.
>
> Here is the complete latest test code and its output
>
>
>
> public class LuceneTest {
>    static public void main(String[] args) {
>        try {
>            QueryParser queryParser = new QueryParser(Version.LUCENE_30,
> "author", new KeywordAnalyzer());
>            Query query = queryParser.parse("author:bentalcella AND NOT
> publish_date:[20100601 TO 20100630]");
>            Searchable[] searchables = new Searchable[2];
>             RAMDirectory ram1 = new RAMDirectory(new NIOFSDirectory(new
> File("/home/dfertig/testIndexes/b1")));
>            RAMDirectory ram2 = new RAMDirectory(new NIOFSDirectory(new
> File("/home/dfertig/testIndexes/m1")));
>            searchables[0] = new IndexSearcher(ram1, true);
>            searchables[1] = new IndexSearcher(ram2, true);
>            MultiSearcher searcher = new MultiSearcher(searchables);
>            System.out.println("MaxDocs for index 1: " +
> searchables[0].maxDoc());
>            System.out.println("MaxDocs for index 2: " +
> searchables[1].maxDoc());
>            System.out.println("MaxDocs for MultiSearcher: " +
> searcher.maxDoc());
>             System.out.println("Query: " + query.toString());
>            TopDocs topDocs = searcher.search(query, 10);
>            System.out.println("Results: " + topDocs.totalHits);
>            for (int in = 0; in < topDocs.totalHits; in++) {
>                Document document = searcher.doc(topDocs.scoreDocs[in].doc);
>                System.out.println("publish_date: " +
> document.get("publish_date"));
>            }
>            searcher.close();
>             ram1.close();
>            ram2.close();
>         } catch (Exception e) {
>            System.out.println(e.getMessage());
>            e.printStackTrace();
>        }
>    }
> }
>
> Output:
> MaxDocs for index 1: 1
> MaxDocs for index 2: 1000
> MaxDocs for MultiSearcher: 1001
> Query: +author:bentalcella -publish_date:[20100601 TO 20100630]
> Results: 1
> publish_date: 20100606
>
>
>
>
> -----Original Message-----
> From: Ian Lea [mailto:ian.lea@gmail.com]
> Sent: Friday, November 5, 2010 4:57 PM
> To: java-user@lucene.apache.org
> Subject: Re: Search returning documents matching a NOT range
>
> Do you get the bogus hit on the small index if search that index
> alone?  Are you positive it only holds the one doc? Loading the one
> doc into a new RAM based index in the test would prove it.
>
> You are more likely to get help if post a self-contained example -
> people can see everything relevant and are more likely to spot a
> problem.
>
>
> --
> Ian.
>
>
> On Thu, Nov 4, 2010 at 4:52 PM, David Fertig <dfertig@cymfony.com> wrote:
> > I have an active lucene implementation that has been in place for a
> > couple years and was recently upgraded to the 3.02 branch. We are now
> > occasionally seeing documents returned from searches that should not be
> > returned. I have reduced the code and indexes to the smallest set
> > possible where I can still repeat the issue.
> >
> >
> >
> > My test cases uses 2 indexes.  These indexes have been rebuilt/optimized
> > using Luke 1.0.1 to make them the smallest possible.  One index has 1
> > document, which is being returned by the query but should not.   The
> > other index has 1000 documents, none of which match the search criteria.
> > The query should bring back 0 results, but brings back 1.  I can zip and
> > mail the indexes if it would aid in helping track down this issue.
> >
> >
> >
> >
> >
> >
> >
> > public class LuceneTest {
> >
> >    static public void main(String[] args) {
> >
> >        try {
> >
> >            QueryParser queryParser = new QueryParser(Version.LUCENE_30,
> > "author", new KeywordAnalyzer());
> >
> >            Query query = queryParser.parse("author:bentalcella AND NOT
> > publish_date:[20100601 TO 20100630]");
> >
> >            Searchable[] searchables = new Searchable[2];
> >
> >            searchables[0] = new IndexSearcher(new NIOFSDirectory(new
> > File("/home/dfertig/testIndexes/b1")), true);
> >
> >            searchables[1] = new IndexSearcher(new NIOFSDirectory(new
> > File("/home/dfertig/testIndexes/m1")), true);
> >
> >            Searcher searcher = new MultiSearcher(searchables);
> >
> >            System.out.println("Query: " + query.toString());
> >
> >            TopDocs topDocs = searcher.search(query, 10);
> >
> >            System.out.println("Results: " + topDocs.totalHits);
> >
> >            for (int in = 0; in < topDocs.totalHits; in++) {
> >
> >                Document document =
> > searcher.doc(topDocs.scoreDocs[in].doc);
> >
> >                System.out.println("publish_date: " +
> > document.get("publish_date"));
> >
> >            }
> >
> >            searcher.close();
> >
> >        } catch (Exception e) {
> >
> >            System.out.println(e.getMessage());
> >
> >            e.printStackTrace();
> >
> >        }
> >
> >    }
> >
> > }
> >
> >
> >
> >
> >
> >
> >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--20cf300fabd531ace1049478c368--

From java-user-return-47742-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 03:21:26 2010
Return-Path: <java-user-return-47742-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44862 invoked from network); 8 Nov 2010 03:21:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 03:21:25 -0000
Received: (qmail 49354 invoked by uid 500); 8 Nov 2010 03:21:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48940 invoked by uid 500); 8 Nov 2010 03:21:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48930 invoked by uid 99); 8 Nov 2010 03:21:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 03:21:48 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 03:21:41 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Search returning documents matching a NOT range
Date: Sun, 7 Nov 2010 22:21:16 -0500
Message-ID: <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
In-Reply-To: <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Search returning documents matching a NOT range
Thread-Index: Act+loegOOHs4ubnR2m8DNigt3mGpwAW1fvg
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com><AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com> <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

publish_date is a string, formatted as YYYYMMDD, so it string sorting
should work correctly for this field.

The field is indexed as a keyword and the field's value is also stored.

I have previously reviewed the terms and optimized the index with luke
1.0.1 to make sure there was no index corruption. It is a very useful
tool, however it can only open 1 index at a time so I can't reproduce
the issue with it.

At your suggestion I added code to enumerate all terms in the indexes
and there are no inconsistencies.

The two fields being searched each only have 1 term in the first index
(as expected) and those terms are not in the second index.

David



-----Original Message-----
From: Erick Erickson [mailto:erickerickson@gmail.com]=20
Sent: Sunday, November 7, 2010 11:12 AM
To: java-user@lucene.apache.org
Subject: Re: Search returning documents matching a NOT range

What kind of field is publish_date? And how do you store data there?
Is it possible you're getting some date presentation wonkiness in here?
One thing that might shed light on your problem is if you enumerated the
terms in that field and
printed them out rather than the document.get. That is, be sure you're
getting what's in the index
(and thus being searched) rather than wha's stored in the document.

Luke might get you there faster/easier....

Best
Erick

On Fri, Nov 5, 2010 at 5:18 PM, David Fertig <dfertig@cymfony.com>
wrote:

> Ian,
> Thank you for getting back to me.  No, I do not get a bogus hit from
> searching the small index alone.  Also, I do not get a hit if I delete
any
> more documents from the larger index.
>
> I have updated my test to use RamDirectory and also print maxDoc() for
the
> searchables and the searcher, all numbers are as expected.  I have
posted
> all the code, but did not want to post the indexes due to their size
(2.2
> meg uncompressed).  I will mail them to anyone who can help.
>
> Here is the complete latest test code and its output
>
>
>
> public class LuceneTest {
>    static public void main(String[] args) {
>        try {
>            QueryParser queryParser =3D new
QueryParser(Version.LUCENE_30,
> "author", new KeywordAnalyzer());
>            Query query =3D queryParser.parse("author:bentalcella AND =
NOT
> publish_date:[20100601 TO 20100630]");
>            Searchable[] searchables =3D new Searchable[2];
>             RAMDirectory ram1 =3D new RAMDirectory(new
NIOFSDirectory(new
> File("/home/dfertig/testIndexes/b1")));
>            RAMDirectory ram2 =3D new RAMDirectory(new =
NIOFSDirectory(new
> File("/home/dfertig/testIndexes/m1")));
>            searchables[0] =3D new IndexSearcher(ram1, true);
>            searchables[1] =3D new IndexSearcher(ram2, true);
>            MultiSearcher searcher =3D new MultiSearcher(searchables);
>            System.out.println("MaxDocs for index 1: " +
> searchables[0].maxDoc());
>            System.out.println("MaxDocs for index 2: " +
> searchables[1].maxDoc());
>            System.out.println("MaxDocs for MultiSearcher: " +
> searcher.maxDoc());
>             System.out.println("Query: " + query.toString());
>            TopDocs topDocs =3D searcher.search(query, 10);
>            System.out.println("Results: " + topDocs.totalHits);
>            for (int in =3D 0; in < topDocs.totalHits; in++) {
>                Document document =3D
searcher.doc(topDocs.scoreDocs[in].doc);
>                System.out.println("publish_date: " +
> document.get("publish_date"));
>            }
>            searcher.close();
>             ram1.close();
>            ram2.close();
>         } catch (Exception e) {
>            System.out.println(e.getMessage());
>            e.printStackTrace();
>        }
>    }
> }
>
> Output:
> MaxDocs for index 1: 1
> MaxDocs for index 2: 1000
> MaxDocs for MultiSearcher: 1001
> Query: +author:bentalcella -publish_date:[20100601 TO 20100630]
> Results: 1
> publish_date: 20100606
>
>
>
>
> -----Original Message-----
> From: Ian Lea [mailto:ian.lea@gmail.com]
> Sent: Friday, November 5, 2010 4:57 PM
> To: java-user@lucene.apache.org
> Subject: Re: Search returning documents matching a NOT range
>
> Do you get the bogus hit on the small index if search that index
> alone?  Are you positive it only holds the one doc? Loading the one
> doc into a new RAM based index in the test would prove it.
>
> You are more likely to get help if post a self-contained example -
> people can see everything relevant and are more likely to spot a
> problem.
>
>
> --
> Ian.
>
>
> On Thu, Nov 4, 2010 at 4:52 PM, David Fertig <dfertig@cymfony.com>
wrote:
> > I have an active lucene implementation that has been in place for a
> > couple years and was recently upgraded to the 3.02 branch. We are
now
> > occasionally seeing documents returned from searches that should not
be
> > returned. I have reduced the code and indexes to the smallest set
> > possible where I can still repeat the issue.
> >
> >
> >
> > My test cases uses 2 indexes.  These indexes have been
rebuilt/optimized
> > using Luke 1.0.1 to make them the smallest possible.  One index has
1
> > document, which is being returned by the query but should not.   The
> > other index has 1000 documents, none of which match the search
criteria.
> > The query should bring back 0 results, but brings back 1.  I can zip
and
> > mail the indexes if it would aid in helping track down this issue.
> >
> >
> >
> >
> >
> >
> >
> > public class LuceneTest {
> >
> >    static public void main(String[] args) {
> >
> >        try {
> >
> >            QueryParser queryParser =3D new
QueryParser(Version.LUCENE_30,
> > "author", new KeywordAnalyzer());
> >
> >            Query query =3D queryParser.parse("author:bentalcella AND
NOT
> > publish_date:[20100601 TO 20100630]");
> >
> >            Searchable[] searchables =3D new Searchable[2];
> >
> >            searchables[0] =3D new IndexSearcher(new =
NIOFSDirectory(new
> > File("/home/dfertig/testIndexes/b1")), true);
> >
> >            searchables[1] =3D new IndexSearcher(new =
NIOFSDirectory(new
> > File("/home/dfertig/testIndexes/m1")), true);
> >
> >            Searcher searcher =3D new MultiSearcher(searchables);
> >
> >            System.out.println("Query: " + query.toString());
> >
> >            TopDocs topDocs =3D searcher.search(query, 10);
> >
> >            System.out.println("Results: " + topDocs.totalHits);
> >
> >            for (int in =3D 0; in < topDocs.totalHits; in++) {
> >
> >                Document document =3D
> > searcher.doc(topDocs.scoreDocs[in].doc);
> >
> >                System.out.println("publish_date: " +
> > document.get("publish_date"));
> >
> >            }
> >
> >            searcher.close();
> >
> >        } catch (Exception e) {
> >
> >            System.out.println(e.getMessage());
> >
> >            e.printStackTrace();
> >
> >        }
> >
> >    }
> >
> > }
> >
> >
> >
> >
> >
> >
> >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47743-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 04:32:36 2010
Return-Path: <java-user-return-47743-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76155 invoked from network); 8 Nov 2010 04:32:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 04:32:36 -0000
Received: (qmail 85099 invoked by uid 500); 8 Nov 2010 04:33:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84770 invoked by uid 500); 8 Nov 2010 04:33:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84741 invoked by uid 99); 8 Nov 2010 04:33:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 04:33:01 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 04:32:55 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 6BDBD45FE01
	for <java-user@lucene.apache.org>; Mon,  8 Nov 2010 05:32:32 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id QY4bX+FsLzKZ for <java-user@lucene.apache.org>;
	Mon,  8 Nov 2010 05:32:27 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id C7E6B45FDFD
	for <java-user@lucene.apache.org>; Mon,  8 Nov 2010 05:32:26 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com><AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com> <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
In-Reply-To: <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
Subject: RE: Search returning documents matching a NOT range
Date: Mon, 8 Nov 2010 05:32:34 +0100
Message-ID: <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-index: AQIFBEM7LuaSiXYA0QxlDQQjTS0N4gEvKa5aASf9Jy0C0vYl3AI0wNULkrj7/pA=
Content-language: de

Does the same happen with a MultiReader on top of both indexes and using a
single IndexSearcher on top of this MultiReader?

P.S.: How about using NumericField?

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: David Fertig [mailto:dfertig@cymfony.com]
> Sent: Monday, November 08, 2010 4:21 AM
> To: java-user@lucene.apache.org
> Subject: RE: Search returning documents matching a NOT range
> 
> publish_date is a string, formatted as YYYYMMDD, so it string sorting
should
> work correctly for this field.
> 
> The field is indexed as a keyword and the field's value is also stored.
> 
> I have previously reviewed the terms and optimized the index with luke
> 1.0.1 to make sure there was no index corruption. It is a very useful
tool,
> however it can only open 1 index at a time so I can't reproduce the issue
with
> it.
> 
> At your suggestion I added code to enumerate all terms in the indexes and
> there are no inconsistencies.
> 
> The two fields being searched each only have 1 term in the first index (as
> expected) and those terms are not in the second index.
> 
> David
> 
> 
> 
> -----Original Message-----
> From: Erick Erickson [mailto:erickerickson@gmail.com]
> Sent: Sunday, November 7, 2010 11:12 AM
> To: java-user@lucene.apache.org
> Subject: Re: Search returning documents matching a NOT range
> 
> What kind of field is publish_date? And how do you store data there?
> Is it possible you're getting some date presentation wonkiness in here?
> One thing that might shed light on your problem is if you enumerated the
> terms in that field and printed them out rather than the document.get.
That is,
> be sure you're getting what's in the index (and thus being searched)
rather than
> wha's stored in the document.
> 
> Luke might get you there faster/easier....
> 
> Best
> Erick
> 
> On Fri, Nov 5, 2010 at 5:18 PM, David Fertig <dfertig@cymfony.com>
> wrote:
> 
> > Ian,
> > Thank you for getting back to me.  No, I do not get a bogus hit from
> > searching the small index alone.  Also, I do not get a hit if I delete
> any
> > more documents from the larger index.
> >
> > I have updated my test to use RamDirectory and also print maxDoc() for
> the
> > searchables and the searcher, all numbers are as expected.  I have
> posted
> > all the code, but did not want to post the indexes due to their size
> (2.2
> > meg uncompressed).  I will mail them to anyone who can help.
> >
> > Here is the complete latest test code and its output
> >
> >
> >
> > public class LuceneTest {
> >    static public void main(String[] args) {
> >        try {
> >            QueryParser queryParser = new
> QueryParser(Version.LUCENE_30,
> > "author", new KeywordAnalyzer());
> >            Query query = queryParser.parse("author:bentalcella AND NOT
> > publish_date:[20100601 TO 20100630]");
> >            Searchable[] searchables = new Searchable[2];
> >             RAMDirectory ram1 = new RAMDirectory(new
> NIOFSDirectory(new
> > File("/home/dfertig/testIndexes/b1")));
> >            RAMDirectory ram2 = new RAMDirectory(new NIOFSDirectory(new
> > File("/home/dfertig/testIndexes/m1")));
> >            searchables[0] = new IndexSearcher(ram1, true);
> >            searchables[1] = new IndexSearcher(ram2, true);
> >            MultiSearcher searcher = new MultiSearcher(searchables);
> >            System.out.println("MaxDocs for index 1: " +
> > searchables[0].maxDoc());
> >            System.out.println("MaxDocs for index 2: " +
> > searchables[1].maxDoc());
> >            System.out.println("MaxDocs for MultiSearcher: " +
> > searcher.maxDoc());
> >             System.out.println("Query: " + query.toString());
> >            TopDocs topDocs = searcher.search(query, 10);
> >            System.out.println("Results: " + topDocs.totalHits);
> >            for (int in = 0; in < topDocs.totalHits; in++) {
> >                Document document =
> searcher.doc(topDocs.scoreDocs[in].doc);
> >                System.out.println("publish_date: " +
> > document.get("publish_date"));
> >            }
> >            searcher.close();
> >             ram1.close();
> >            ram2.close();
> >         } catch (Exception e) {
> >            System.out.println(e.getMessage());
> >            e.printStackTrace();
> >        }
> >    }
> > }
> >
> > Output:
> > MaxDocs for index 1: 1
> > MaxDocs for index 2: 1000
> > MaxDocs for MultiSearcher: 1001
> > Query: +author:bentalcella -publish_date:[20100601 TO 20100630]
> > Results: 1
> > publish_date: 20100606
> >
> >
> >
> >
> > -----Original Message-----
> > From: Ian Lea [mailto:ian.lea@gmail.com]
> > Sent: Friday, November 5, 2010 4:57 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: Search returning documents matching a NOT range
> >
> > Do you get the bogus hit on the small index if search that index
> > alone?  Are you positive it only holds the one doc? Loading the one
> > doc into a new RAM based index in the test would prove it.
> >
> > You are more likely to get help if post a self-contained example -
> > people can see everything relevant and are more likely to spot a
> > problem.
> >
> >
> > --
> > Ian.
> >
> >
> > On Thu, Nov 4, 2010 at 4:52 PM, David Fertig <dfertig@cymfony.com>
> wrote:
> > > I have an active lucene implementation that has been in place for a
> > > couple years and was recently upgraded to the 3.02 branch. We are
> now
> > > occasionally seeing documents returned from searches that should not
> be
> > > returned. I have reduced the code and indexes to the smallest set
> > > possible where I can still repeat the issue.
> > >
> > >
> > >
> > > My test cases uses 2 indexes.  These indexes have been
> rebuilt/optimized
> > > using Luke 1.0.1 to make them the smallest possible.  One index has
> 1
> > > document, which is being returned by the query but should not.   The
> > > other index has 1000 documents, none of which match the search
> criteria.
> > > The query should bring back 0 results, but brings back 1.  I can zip
> and
> > > mail the indexes if it would aid in helping track down this issue.
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > > public class LuceneTest {
> > >
> > >    static public void main(String[] args) {
> > >
> > >        try {
> > >
> > >            QueryParser queryParser = new
> QueryParser(Version.LUCENE_30,
> > > "author", new KeywordAnalyzer());
> > >
> > >            Query query = queryParser.parse("author:bentalcella AND
> NOT
> > > publish_date:[20100601 TO 20100630]");
> > >
> > >            Searchable[] searchables = new Searchable[2];
> > >
> > >            searchables[0] = new IndexSearcher(new NIOFSDirectory(new
> > > File("/home/dfertig/testIndexes/b1")), true);
> > >
> > >            searchables[1] = new IndexSearcher(new NIOFSDirectory(new
> > > File("/home/dfertig/testIndexes/m1")), true);
> > >
> > >            Searcher searcher = new MultiSearcher(searchables);
> > >
> > >            System.out.println("Query: " + query.toString());
> > >
> > >            TopDocs topDocs = searcher.search(query, 10);
> > >
> > >            System.out.println("Results: " + topDocs.totalHits);
> > >
> > >            for (int in = 0; in < topDocs.totalHits; in++) {
> > >
> > >                Document document =
> > > searcher.doc(topDocs.scoreDocs[in].doc);
> > >
> > >                System.out.println("publish_date: " +
> > > document.get("publish_date"));
> > >
> > >            }
> > >
> > >            searcher.close();
> > >
> > >        } catch (Exception e) {
> > >
> > >            System.out.println(e.getMessage());
> > >
> > >            e.printStackTrace();
> > >
> > >        }
> > >
> > >    }
> > >
> > > }
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47744-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 08:33:57 2010
Return-Path: <java-user-return-47744-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67913 invoked from network); 8 Nov 2010 08:33:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 08:33:57 -0000
Received: (qmail 23681 invoked by uid 500); 8 Nov 2010 08:34:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23348 invoked by uid 500); 8 Nov 2010 08:34:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23334 invoked by uid 99); 8 Nov 2010 08:34:21 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 08:34:21 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 08:34:15 +0000
Received: by iwn7 with SMTP id 7so6152919iwn.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 00:33:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=/QU5yneySyW1YiGW8+0emcbL/rtZDFZX3nz6iG32fEU=;
        b=jBpqOyBYEEZaRJ3x17vQ5sVE0WoQSyrut3PJ38IIKBl7bgPxuBllZ/yBqo8zzcdTJy
         UUdf64MGS57//0VZ1P8geNOY2mF1dDu+fWo1aR9Hu13YHNov1skirc8gdpNv/FXa2JAS
         gjrDFjESjBc/jbNOT4k+UpDmQphh7Wsk6GwGo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=S096ghXOPFLiqRe4dfRWL812lKnQmCGiqOU0pwDPFhGrWmGgFNnv8Zuicl8y45SrQ5
         yw2DJRH0NsqTVH6E0t2b9am6m4BXweJthHZ9CmvuOCZ8jiTuzVOGXNZGYhwWyQizP1Di
         2lxKQRJ0PgZmJnt/yNAW+xfDgjALxQnp3Qgww=
Received: by 10.42.153.72 with SMTP id l8mr3270567icw.79.1289205234421; Mon,
 08 Nov 2010 00:33:54 -0800 (PST)
MIME-Version: 1.0
Received: by 10.231.32.66 with HTTP; Mon, 8 Nov 2010 00:33:38 -0800 (PST)
In-Reply-To: <AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
References: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com> <AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Mon, 8 Nov 2010 14:03:38 +0530
Message-ID: <AANLkTikP7GyrpBZ=AubXAFkrUjqwuWwWKBavTCPQom1g@mail.gmail.com>
Subject: Re: Single filter instance with different searchers
To: java-user@lucene.apache.org
Content-Type: multipart/mixed; boundary=90e6ba61359e0a4ebc0494867c40

--90e6ba61359e0a4ebc0494867c40
Content-Type: multipart/alternative; boundary=90e6ba61359e0a4eb70494867c3e

--90e6ba61359e0a4eb70494867c3e
Content-Type: text/plain; charset=ISO-8859-1

Hi Erick, Thanks for the reply.
 Your answer have puzzled me more because what I am able to view is not what
you say or I am not able to grasp your meaning.
 I have written a small program which is exactly what my original question
was. Here I am creating a CachingWrapperFilter on one index and reusing it
on other indexes. This single filter gives me results as expected from each
of the index. I will appreciate if you can throw some light.

I have given the output after the program ends

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// following program is compiled with java6

import org.apache.lucene.index.*;
import org.apache.lucene.analysis.*;
import org.apache.lucene.analysis.standard.*;
import org.apache.lucene.search.*;
import org.apache.lucene.search.spans.*;
import org.apache.lucene.store.*;
import org.apache.lucene.document.*;
import org.apache.lucene.queryParser.*;
import org.apache.lucene.util.*;

import java.util.*;

public class FilterTest
{
protected Directory[] dirs;
 protected Analyzer a;
protected Searcher[] searchers;
protected QueryParser qp;
 protected Filter f;
protected Hashtable<String, Filter> filters;

 public FilterTest()
{
// create analyzer
 a = new StandardAnalyzer(Version.LUCENE_29);
// create query parser
qp = new QueryParser(Version.LUCENE_29, "content", a);
 // initialize "filters" Hashtable
filters = new Hashtable<String, Filter>();
 }

protected void createDirectories(int length)
{
 // create specified number of RAM directories
dirs = new Directory[length];
 for(int i=0;i<length;i++)
dirs[i] = new RAMDirectory();
}

protected void createIndexes() throws Exception
{
/* create indexes for each directory.
 each index contains two documents.
every document contains one term, unique across all indexes, one term unique
across single index and one term common to all indexes
 */
for(int i=0;i<dirs.length;i++)
{
 IndexWriter iw = new IndexWriter(dirs[i], a, true,
IndexWriter.MaxFieldLength.LIMITED);

Document d = new Document();
 // unique id across all indexes
d.add(new Field("id", ""+(i*2+1), Field.Store.YES, Field.Index.NOT_ANALYZED,
Field.TermVector.YES));
 // unique id in a single indexes
d.add(new Field("docnumber", "1", Field.Store.YES, Field.Index.NOT_ANALYZED,
Field.TermVector.YES));
 // common word in all indexes
d.add(new Field("content", "common", Field.Store.YES, Field.Index.ANALYZED,
Field.TermVector.YES));
 iw.addDocument(d);

d = new Document();
// unique id across all indexes
 d.add(new Field("id", ""+(i*2+2), Field.Store.YES,
Field.Index.NOT_ANALYZED, Field.TermVector.YES));
// unique id in a single indexes
 d.add(new Field("docnumber", "2", Field.Store.YES,
Field.Index.NOT_ANALYZED, Field.TermVector.YES));
// common word in all indexes
 d.add(new Field("content", "common", Field.Store.YES, Field.Index.ANALYZED,
Field.TermVector.YES));
iw.addDocument(d);

iw.close();
}
}

protected void openSearchers() throws Exception
{
// open searches for every directory and save it in an array
 searchers = new Searcher[dirs.length];
for(int i=0;i<dirs.length;i++)
 searchers[i] = new IndexSearcher(IndexReader.open(dirs[i], true));
}

 protected Searcher getSearcher(int[] arr) throws Exception
{
// provides a ParallelMultiSearcher instance with the searchers lying at
index positions provided in the argument
 Searcher[] s = new Searcher[arr.length];
for(int i=0;i<arr.length;i++)
 s[i] = this.searchers[arr[i]];

return new ParallelMultiSearcher(s);
 }

protected ScoreDoc[] search(String query, String filter, Searcher s) throws
Exception
 {
Filter f = null;
if(filter != null)
 {
if(filters.containsKey(filter))
{
 System.out.println("Reusing filter for - " + filter);
f = filters.get(filter);
 }
else
{
 System.out.println("Creating new filter for - " + filter);
f = new CachingWrapperFilter(new QueryWrapperFilter(qp.parse(filter)));
 filters.put(filter, f);
}
}
 System.out.println("Query:("+query+"), Filter:("+filter+")");
return s.search(qp.parse(query), f, 1000).scoreDocs;
 }

public static void main(String[] args) throws Exception
{
 FilterTest ft = new FilterTest();
ft.startTest();
}

public void startTest()
{
try
 {
Query q;

createDirectories(3);
 createIndexes();
openSearchers();
Searcher s;
 ScoreDoc[] sd;

System.out.println("===================================");
 System.out.println("Fields of all the documents");
// creating searcher for all indexes
 s = getSearcher(new int[]{0,1,2});
// search all documents and their ids
 sd = search("+content:common", null, s);
for(int i=0;i<sd.length;i++)
 {
System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
docnumber:"+s.doc(sd[i].doc).get("docnumber"));
 }
System.out.println("\n\n");

System.out.println("===================================");
 System.out.println("Searching for documents in a single index. Filter will
be created and cached");
s = getSearcher(new int[]{0});
 sd = search("+content:common", "docnumber:1", s);
System.out.println("Hits:"+sd.length);
 for(int i=0;i<sd.length;i++)
{
System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
docnumber:"+s.doc(sd[i].doc).get("docnumber"));
 }
System.out.println("\n\n");

System.out.println("===================================");
 System.out.println("Searching for documents in a other indexes other than
previous search. Query and filter will be same. Filter will be reused");
 s = getSearcher(new int[]{1,2});
sd = search("+content:common", "docnumber:1", s);
 System.out.println("Hits:"+sd.length);
for(int i=0;i<sd.length;i++)
 {
System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
docnumber:"+s.doc(sd[i].doc).get("docnumber"));
 }

}
catch(Exception e)
 {
e.printStackTrace();
}
 }
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
OUTPUT:
[samar@myserver java]$ java FilterTest
===================================
Fields of all the documents
Query:(+content:common), Filter:(null)
        id:1, docid:1
        id:2, docid:2
        id:3, docid:1
        id:4, docid:2
        id:5, docid:1
        id:6, docid:2



===================================
Searching for documents in a single index. Filter will be created and cached
Creating new filter for - docid:1
Query:(+content:common), Filter:(docid:1)
Hits:1
        id:1, docid:1



===================================
Searching for documents in indexes other than previous search. Query and
filter will be same. Filter will be reused
Reusing filter for - docid:1
Query:(+content:common), Filter:(docid:1)
Hits:2
        id:3, docid:1
        id:5, docid:1










On Wed, Nov 3, 2010 at 7:04 PM, Erick Erickson <erickerickson@gmail.com>wrote:

> I'm assuming you're down in Lucene land. Unless somehow you've
> gotten 63 separate filters when you think you only have one, I don't
> think what you're doing will work. Or I'm failing to understand what
> you're doing at all.
>
> The problem is I expect each of your indexes starts with document
> 1. So your Filter is really a bit set keyed by Lucene document ID.
>
> So applying filter 2 to index 54 will NOT do what you want. What I
> suspect you're seeing is that applying your filter is producing enough
> results from index 54 (to continue my example) to fool you into
> thinking it's working.
>
> Try running the query with and without the filter on each of your indexes,
> perhaps as a control including a restrictive clause in the query
> to do the same thing your filter is doing. Or construct the filter new
> for comparison.... If the numbers continue to be the same, I clearly
> don't understand something! <G>....
>
> Best
> Erick
>
> On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap <samarzone@gmail.com
> >wrote:
>
> > Hi. We have a large index (~ 28 GB) which is distributed in three
> different
> > directories, each representing a country. Each of these country wise
> > indexes
> > is further distributed on the basis of last update date into 21 smaller
> > indexes. This index is updated once in a day.
> >
> > A user can search into any of one country and can choose last update date
> > plus some other criteria.
> >
> > When the server application starts, index readers and hence searchers are
> > created for each of the small indexes (21 x 3) and put in an array.
> > Depending on the option (country and last update date) chosen by user we
> > pick the searchers of correct date range/country and create a new
> > ParallelMultiSearcher instance.
> >
> > Now my question is - can I use single filter (caching filter) instance
> for
> > every search (may be on different searchers)?
> >
> >
> ===================================================================================
> >
> > e.g
> > for first search i create an filter of experience 4 years and save it.
> >
> > if another search for a different country (and hence difference index)
> also
> > has same experience criteria, i.e. 4 years, can i use the same filter
> > instance for second search too?
> >
> > i have tested a little for this and surprisingly i have got correct
> > results.
> > i was wondering if this is the correct way. or do i need to create
> > different
> > filters for each searcher (or index reader) instance?
> >
> > Thanks in advance.
> >
> > --
> > Regards,
> > Samar
> >
>



-- 
Regards,
Samar

--90e6ba61359e0a4eb70494867c3e
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Erick, Thanks for the reply.<div>=A0Your answer have puzzled me more bec=
ause what I am able to view is not what you say or I am not able to grasp y=
our meaning.<br>=A0I have written a small program which is exactly what my =
original question was. Here I am creating a CachingWrapperFilter on one ind=
ex and reusing it on other indexes. This single filter gives me results as =
expected from each of the index. I will appreciate if you can throw some li=
ght.</div>

<div><br></div><div>I have given the output after the program ends</div><di=
v><br></div><div>//////////////////////////////////////////////////////////=
//////////////////////////////////////////////////////////////////////</div=
>

<div>// following program is compiled with java6</div><div><br></div><div><=
div>import org.apache.lucene.index.*;</div><div>import org.apache.lucene.an=
alysis.*;</div><div>import org.apache.lucene.analysis.standard.*;</div>

<div>import org.apache.lucene.search.*;</div><div>import org.apache.lucene.=
search.spans.*;</div><div>import org.apache.lucene.store.*;</div><div>impor=
t org.apache.lucene.document.*;</div><div>import org.apache.lucene.queryPar=
ser.*;</div>

<div>import org.apache.lucene.util.*;</div><div><br></div><div>import java.=
util.*;</div><div><br></div><div>public class FilterTest</div><div>{</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>protec=
ted Directory[] dirs;</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>prote=
cted Analyzer a;</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">	</span>protected Searcher[] searchers;</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">	</span>protected QueryParser qp;<=
/div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>prote=
cted Filter f;</div><div><span class=3D"Apple-tab-span" style=3D"white-spac=
e:pre">	</span>protected Hashtable&lt;String, Filter&gt; filters;</div><div=
><br>

</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span=
>public FilterTest()</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">	</span>{</div><div><span class=3D"Apple-tab-span" style=3D"wh=
ite-space:pre">		</span>// create analyzer</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>a =
=3D new StandardAnalyzer(Version.LUCENE_29);</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">		</span>// create query parser</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>qp =
=3D new QueryParser(Version.LUCENE_29, &quot;content&quot;, a);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>// i=
nitialize &quot;filters&quot; Hashtable</div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">		</span>filters =3D new Hashtable&lt;Strin=
g, Filter&gt;();</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>}</di=
v><div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">	</span>protected void createDirectories(int length)</div><div><span cl=
ass=3D"Apple-tab-span" style=3D"white-space:pre">	</span>{</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>// c=
reate specified number of RAM directories</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">		</span>dirs =3D new Directory[length];<=
/div>
<div>
<span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>for(int i=
=3D0;i&lt;length;i++)</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">			</span>dirs[i] =3D new RAMDirectory();</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">	</span>}</div>

<div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">	</span>protected void createIndexes() throws Exception</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">	</span>{</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>/* create inde=
xes for each directory.</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>each=
 index contains two documents.</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">		</span>every document contains one term, unique ac=
ross all indexes, one term unique across single index and one term common t=
o all indexes=A0</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>*/</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>=
for(int i=3D0;i&lt;dirs.length;i++)</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">		</span>{</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Ind=
exWriter iw =3D new IndexWriter(dirs[i], a, true, IndexWriter.MaxFieldLengt=
h.LIMITED);</div><div><br></div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">			</span>Document d =3D new Document();</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>// =
unique id across all indexes</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">			</span>d.add(new Field(&quot;id&quot;, &quot;&quot;=
+(i*2+1), Field.Store.YES, Field.Index.NOT_ANALYZED, Field.TermVector.YES))=
;</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>// =
unique id in a single indexes</div><div><span class=3D"Apple-tab-span" styl=
e=3D"white-space:pre">			</span>d.add(new Field(&quot;docnumber&quot;, &quo=
t;1&quot;, Field.Store.YES, Field.Index.NOT_ANALYZED, Field.TermVector.YES)=
);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>// =
common word in all indexes</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">			</span>d.add(new Field(&quot;content&quot;, &quot;c=
ommon&quot;, Field.Store.YES, Field.Index.ANALYZED, Field.TermVector.YES));=
</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>iw.=
addDocument(d);</div><div><br></div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">			</span>d =3D new Document();</div><div><span clas=
s=3D"Apple-tab-span" style=3D"white-space:pre">			</span>// unique id acros=
s all indexes</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>d.a=
dd(new Field(&quot;id&quot;, &quot;&quot;+(i*2+2), Field.Store.YES, Field.I=
ndex.NOT_ANALYZED, Field.TermVector.YES));</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>// unique id in a single index=
es</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>d.a=
dd(new Field(&quot;docnumber&quot;, &quot;2&quot;, Field.Store.YES, Field.I=
ndex.NOT_ANALYZED, Field.TermVector.YES));</div><div><span class=3D"Apple-t=
ab-span" style=3D"white-space:pre">			</span>// common word in all indexes<=
/div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>d.a=
dd(new Field(&quot;content&quot;, &quot;common&quot;, Field.Store.YES, Fiel=
d.Index.ANALYZED, Field.TermVector.YES));</div><div><span class=3D"Apple-ta=
b-span" style=3D"white-space:pre">			</span>iw.addDocument(d);</div>

<div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">			</span>iw.close();</div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">		</span>}</div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">	</span>}</div>

<div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">	</span>protected void openSearchers() throws Exception</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">	</span>{</div><div><span=
 class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>// open search=
es for every directory and save it in an array</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>sear=
chers =3D new Searcher[dirs.length];</div><div><span class=3D"Apple-tab-spa=
n" style=3D"white-space:pre">		</span>for(int i=3D0;i&lt;dirs.length;i++)</=
div><div>

<span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>searcher=
s[i] =3D new IndexSearcher(IndexReader.open(dirs[i], true));</div><div><spa=
n class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>}</div><div><b=
r></div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>prote=
cted Searcher getSearcher(int[] arr) throws Exception</div><div><span class=
=3D"Apple-tab-span" style=3D"white-space:pre">	</span>{</div><div><span cla=
ss=3D"Apple-tab-span" style=3D"white-space:pre">		</span>// provides a Para=
llelMultiSearcher instance with the searchers lying at index positions prov=
ided in the argument</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>Sear=
cher[] s =3D new Searcher[arr.length];</div><div><span class=3D"Apple-tab-s=
pan" style=3D"white-space:pre">		</span>for(int i=3D0;i&lt;arr.length;i++)<=
/div><div>

<span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>s[i] =3D=
 this.searchers[arr[i]];</div><div><br></div><div><span class=3D"Apple-tab-=
span" style=3D"white-space:pre">		</span>return new ParallelMultiSearcher(s=
);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>}</di=
v><div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">	</span>protected ScoreDoc[] search(String query, String filter, Search=
er s) throws Exception</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>{</di=
v><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>Fi=
lter f =3D null;</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">		</span>if(filter !=3D null)</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>{</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>=
if(filters.containsKey(filter))</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">			</span>{</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>Sy=
stem.out.println(&quot;Reusing filter for - &quot; + filter);</div><div><sp=
an class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>f =3D filt=
ers.get(filter);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>}</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span=
>else</div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		=
	</span>{</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>Sy=
stem.out.println(&quot;Creating new filter for - &quot; + filter);</div><di=
v><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>f =3D=
 new CachingWrapperFilter(new QueryWrapperFilter(qp.parse(filter)));</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</span>fi=
lters.put(filter, f);</div><div><span class=3D"Apple-tab-span" style=3D"whi=
te-space:pre">			</span>}</div><div><span class=3D"Apple-tab-span" style=3D=
"white-space:pre">		</span>}</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>Syst=
em.out.println(&quot;Query:(&quot;+query+&quot;), Filter:(&quot;+filter+&qu=
ot;)&quot;);</div><div><span class=3D"Apple-tab-span" style=3D"white-space:=
pre">		</span>return s.search(qp.parse(query), f, 1000).scoreDocs;</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>}</di=
v><div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:p=
re">	</span>public static void main(String[] args) throws Exception</div><d=
iv>
<span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>{</div>
<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>Filt=
erTest ft =3D new FilterTest();</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">		</span>ft.startTest();</div><div><span class=3D"A=
pple-tab-span" style=3D"white-space:pre">	</span>}</div>

<div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre=
">	</span>public void startTest()</div><div><span class=3D"Apple-tab-span" =
style=3D"white-space:pre">	</span>{</div><div><span class=3D"Apple-tab-span=
" style=3D"white-space:pre">		</span>try</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>{</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>=
Query q;</div><div><br></div><div><span class=3D"Apple-tab-span" style=3D"w=
hite-space:pre">			</span>createDirectories(3);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>cre=
ateIndexes();</div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">			</span>openSearchers();</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>Searcher s;</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Sco=
reDoc[] sd;</div><div><br></div><div><span class=3D"Apple-tab-span" style=
=3D"white-space:pre">			</span>System.out.println(&quot;=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D&quot;);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Sys=
tem.out.println(&quot;Fields of all the documents&quot;);</div><div><span c=
lass=3D"Apple-tab-span" style=3D"white-space:pre">			</span>// creating sea=
rcher for all indexes</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>s =
=3D getSearcher(new int[]{0,1,2});</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">			</span>// search all documents and their ids<=
/div><div>

<span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>sd =3D s=
earch(&quot;+content:common&quot;, null, s);</div><div><span class=3D"Apple=
-tab-span" style=3D"white-space:pre">			</span>for(int i=3D0;i&lt;sd.length=
;i++)</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>{</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</spa=
n>System.out.println(&quot;\tid:&quot;+s.doc(sd[i].doc).get(&quot;id&quot;)=
+&quot;, docnumber:&quot;+s.doc(sd[i].doc).get(&quot;docnumber&quot;));</di=
v>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>}</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span=
>System.out.println(&quot;\n\n&quot;);</div><div><br></div><div><span class=
=3D"Apple-tab-span" style=3D"white-space:pre">			</span>System.out.println(=
&quot;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D&quot;);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Sys=
tem.out.println(&quot;Searching for documents in a single index. Filter wil=
l be created and cached&quot;);</div><div><span class=3D"Apple-tab-span" st=
yle=3D"white-space:pre">			</span>s =3D getSearcher(new int[]{0});</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>sd =
=3D search(&quot;+content:common&quot;, &quot;docnumber:1&quot;, s);</div><=
div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Syst=
em.out.println(&quot;Hits:&quot;+sd.length);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>for=
(int i=3D0;i&lt;sd.length;i++)</div><div><span class=3D"Apple-tab-span" sty=
le=3D"white-space:pre">			</span>{</div><div><span class=3D"Apple-tab-span"=
 style=3D"white-space:pre">				</span>System.out.println(&quot;\tid:&quot;+=
s.doc(sd[i].doc).get(&quot;id&quot;)+&quot;, docnumber:&quot;+s.doc(sd[i].d=
oc).get(&quot;docnumber&quot;));</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>}</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span=
>System.out.println(&quot;\n\n&quot;);</div><div><br></div><div><span class=
=3D"Apple-tab-span" style=3D"white-space:pre">			</span>System.out.println(=
&quot;=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D&quot;);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Sys=
tem.out.println(&quot;Searching for documents in a other indexes other than=
 previous search. Query and filter will be same. Filter will be reused&quot=
;);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>s =
=3D getSearcher(new int[]{1,2});</div><div><span class=3D"Apple-tab-span" s=
tyle=3D"white-space:pre">			</span>sd =3D search(&quot;+content:common&quot=
;, &quot;docnumber:1&quot;, s);</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>Sys=
tem.out.println(&quot;Hits:&quot;+sd.length);</div><div><span class=3D"Appl=
e-tab-span" style=3D"white-space:pre">			</span>for(int i=3D0;i&lt;sd.lengt=
h;i++)</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>{</=
div><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">				</spa=
n>System.out.println(&quot;\tid:&quot;+s.doc(sd[i].doc).get(&quot;id&quot;)=
+&quot;, docnumber:&quot;+s.doc(sd[i].doc).get(&quot;docnumber&quot;));</di=
v>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>}</=
div><div><br></div><div><span class=3D"Apple-tab-span" style=3D"white-space=
:pre">		</span>}</div><div><span class=3D"Apple-tab-span" style=3D"white-sp=
ace:pre">		</span>catch(Exception e)</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">		</span>{</d=
iv><div><span class=3D"Apple-tab-span" style=3D"white-space:pre">			</span>=
e.printStackTrace();</div><div><span class=3D"Apple-tab-span" style=3D"whit=
e-space:pre">		</span>}</div>

<div><span class=3D"Apple-tab-span" style=3D"white-space:pre">	</span>}</di=
v><div>}</div></div><div>//////////////////////////////////////////////////=
///////////////////////////////////////////////////////////////////////////=
///</div>

<div>OUTPUT:</div><div><div>[samar@myserver java]$ java FilterTest</div><di=
v>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><div>Fields of all the documents</di=
v><div>Query:(+content:common), Filter:(null)</div><div>=A0=A0 =A0 =A0 =A0i=
d:1, docid:1</div>

<div>=A0=A0 =A0 =A0 =A0id:2, docid:2</div><div>=A0=A0 =A0 =A0 =A0id:3, doci=
d:1</div><div>=A0=A0 =A0 =A0 =A0id:4, docid:2</div><div>=A0=A0 =A0 =A0 =A0i=
d:5, docid:1</div><div>=A0=A0 =A0 =A0 =A0id:6, docid:2</div><div><br></div>=
<div><br></div><div><br></div><div>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</div>

<div>Searching for documents in a single index. Filter will be created and =
cached</div><div>Creating new filter for - docid:1</div><div>Query:(+conten=
t:common), Filter:(docid:1)</div><div>Hits:1</div><div>=A0=A0 =A0 =A0 =A0id=
:1, docid:1</div>

<div><br></div><div><br></div><div><br></div><div>=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D</div><div>Searching for documents in indexes other than previous sea=
rch. Query and filter will be same. Filter will be reused</div><div>

Reusing filter for - docid:1</div><div>Query:(+content:common), Filter:(doc=
id:1)</div><div>Hits:2</div><div>=A0=A0 =A0 =A0 =A0id:3, docid:1</div><div>=
=A0=A0 =A0 =A0 =A0id:5, docid:1</div></div><div><br></div><div><br></div><d=
iv><br></div><div>

<br></div><div><br></div><div><br></div><div><br></div><div><br></div><div>=
<br></div><div><br><div class=3D"gmail_quote">On Wed, Nov 3, 2010 at 7:04 P=
M, Erick Erickson <span dir=3D"ltr">&lt;<a href=3D"mailto:erickerickson@gma=
il.com">erickerickson@gmail.com</a>&gt;</span> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex;">I&#39;m assuming you&#39;re down in Lucene =
land. Unless somehow you&#39;ve<br>
gotten 63 separate filters when you think you only have one, I don&#39;t<br=
>
think what you&#39;re doing will work. Or I&#39;m failing to understand wha=
t<br>
you&#39;re doing at all.<br>
<br>
The problem is I expect each of your indexes starts with document<br>
1. So your Filter is really a bit set keyed by Lucene document ID.<br>
<br>
So applying filter 2 to index 54 will NOT do what you want. What I<br>
suspect you&#39;re seeing is that applying your filter is producing enough<=
br>
results from index 54 (to continue my example) to fool you into<br>
thinking it&#39;s working.<br>
<br>
Try running the query with and without the filter on each of your indexes,<=
br>
perhaps as a control including a restrictive clause in the query<br>
to do the same thing your filter is doing. Or construct the filter new<br>
for comparison.... If the numbers continue to be the same, I clearly<br>
don&#39;t understand something! &lt;G&gt;....<br>
<br>
Best<br>
Erick<br>
<br>
On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap &lt;<a href=3D"mailto:sam=
arzone@gmail.com">samarzone@gmail.com</a>&gt;wrote:<br>
<div><div></div><div class=3D"h5"><br>
&gt; Hi. We have a large index (~ 28 GB) which is distributed in three diff=
erent<br>
&gt; directories, each representing a country. Each of these country wise<b=
r>
&gt; indexes<br>
&gt; is further distributed on the basis of last update date into 21 smalle=
r<br>
&gt; indexes. This index is updated once in a day.<br>
&gt;<br>
&gt; A user can search into any of one country and can choose last update d=
ate<br>
&gt; plus some other criteria.<br>
&gt;<br>
&gt; When the server application starts, index readers and hence searchers =
are<br>
&gt; created for each of the small indexes (21 x 3) and put in an array.<br=
>
&gt; Depending on the option (country and last update date) chosen by user =
we<br>
&gt; pick the searchers of correct date range/country and create a new<br>
&gt; ParallelMultiSearcher instance.<br>
&gt;<br>
&gt; Now my question is - can I use single filter (caching filter) instance=
 for<br>
&gt; every search (may be on different searchers)?<br>
&gt;<br>
&gt; =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D<br>
&gt;<br>
&gt; e.g<br>
&gt; for first search i create an filter of experience 4 years and save it.=
<br>
&gt;<br>
&gt; if another search for a different country (and hence difference index)=
 also<br>
&gt; has same experience criteria, i.e. 4 years, can i use the same filter<=
br>
&gt; instance for second search too?<br>
&gt;<br>
&gt; i have tested a little for this and surprisingly i have got correct<br=
>
&gt; results.<br>
&gt; i was wondering if this is the correct way. or do i need to create<br>
&gt; different<br>
&gt; filters for each searcher (or index reader) instance?<br>
&gt;<br>
&gt; Thanks in advance.<br>
&gt;<br>
&gt; --<br>
&gt; Regards,<br>
&gt; Samar<br>
&gt;<br>
</div></div></blockquote></div><br><br clear=3D"all"><br>-- <br>Regards,<br=
>Samar<br>
</div>

--90e6ba61359e0a4eb70494867c3e--

--90e6ba61359e0a4ebc0494867c40
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--90e6ba61359e0a4ebc0494867c40--

From java-user-return-47745-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 09:04:55 2010
Return-Path: <java-user-return-47745-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76804 invoked from network); 8 Nov 2010 09:04:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 09:04:55 -0000
Received: (qmail 56690 invoked by uid 500); 8 Nov 2010 09:05:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56471 invoked by uid 500); 8 Nov 2010 09:05:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56454 invoked by uid 99); 8 Nov 2010 09:05:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 09:05:20 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prvs=921b9a2d6=aca@ngi.be designates 193.190.215.50 as permitted sender)
Received: from [193.190.215.50] (HELO iron1.dmz.ngi.be) (193.190.215.50)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 09:05:14 +0000
X-IronPort-AV: E=Sophos;i="4.58,313,1286143200"; 
   d="scan'208";a="3124576"
Received: from gandalf.dmz.ngi.be (HELO morpheus.int.ngi.be) ([172.16.254.1])
  by iron1-priv.dmz.ngi.be with ESMTP; 08 Nov 2010 10:04:54 +0100
Received: from morpheus.int.ngi.be (morpheus.int.ngi.be [10.1.110.48])
	by morpheus.int.ngi.be (Postfix) with ESMTP id 4E7B13A70120
	for <java-user@lucene.apache.org>; Mon,  8 Nov 2010 10:04:54 +0100 (CET)
Date: Mon, 8 Nov 2010 10:04:54 +0100 (CET)
From: Alain Camus <aca@ngi.be>
To: java-user@lucene.apache.org
Message-ID: <2125854.70473.1289207094162.JavaMail.root@morpheus>
In-Reply-To: <4886798.70367.1289206157634.JavaMail.root@morpheus>
Subject: Re: RangeQuery with multiple ranges ?
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Originating-IP: [10.1.110.110]
X-Mailer: Zimbra 6.0.8_GA_2661 (ZimbraWebClient - FF3.0 (Win)/6.0.8_GA_2661)
X-Virus-Checked: Checked by ClamAV on apache.org

Hello,

Thanks for your replies. I'm sorry but I couldn't get one of David's or Uwe=
's solution to work.


For the QueryParser, I tried :

QueryParser parser =3D new QueryParser("denominator", new StandardAnalyzer(=
));
Query bq =3D new BooleanQuery();=20
try {
=09bq =3D parser.parse("+denominator:([10000 TO 10000] OR [20000 TO 20000])=
");
} catch (ParseException pe) {
=09Log.error(Geonet.SEARCH_ENGINE, "\n\nQueryParser.parse exception\n" + pe=
 + "\n\n");
}
BooleanClause.Occur scaleOccur =3D LuceneUtils.convertRequiredAndProhibited=
ToOccur(true, false);
BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
query.add(scaleRangeClause);


With TermRangeQuery :

BooleanClause.Occur scaleOccur =3D LuceneUtils.convertRequiredAndProhibited=
ToOccur(true, false);
String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, true)=
, BooleanClause.Occur.SHOULD);
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, true)=
, BooleanClause.Occur.SHOULD);
BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
query.add(scaleRangeClause);

I also tried with Uwe's code for the deprecated RangeQuery.


The result I get is always the same :=20
+((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
which doesn't work, neither deployed on the server or in Luke. The queries =
that works in Luke are=20
+denominator:([10000 TO 10000] OR [50000 TO 50000]) or
+denominator:([10000 TO 10000] [50000 TO 50000])


A little more background information :
 * The field denominator is indexed alphabetically. If it was indexed numer=
ically, I'd be fine with a simple NumericRangeQuery [10000 TO 50000] but I =
don't have the time to change the way it is indexed (it will be for the nex=
t release).=20
 * If you have a solution where denominator takes a single value and not a =
range (like +denominator:(10000 OR 50000)), that is probably what I'm looki=
ng for.
 * I have to insert this query in a global query, hence the last line query=
.add(scaleRangeClause);
 * The deprecated RangeQuery is used everywhere in the code I'm modifying, =
so I didn't try to replace it with TermRangeQuery and NumericRangeQuery.

Would you have another hint ?

Alain

----- Mail original -----
De: "David Fertig" <dfertig@cymfony.com>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Vendredi 5 Novembre 2010 16:43:42
Objet: RE: RangeQuery with multiple ranges ?

You can use a query parser to parse your text query into the appropriate qu=
ery objects.

----- Mail original -----
De: "Uwe Schindler" <uwe@thetaphi.de>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Vendredi 5 Novembre 2010 16:52:58
Objet: RE: RangeQuery with multiple ranges ?

Why do you use such complicated stuff to build the BQ?

Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
BooleanQuery bq =3D new BooleanQuery();
bq.add(new RangeQuery(term1, term1, true), BooleanClause.Occur.SHOULD);=20
bq.add(new RangeQuery(term2, term2, true), BooleanClause.Occur.SHOULD);

By the way, your code is outdated, you should better use NumericRangeQuery =
for numerics! Else RangeQuery is deprecated and replaced by TermRangeQuery:

String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, true)=
, BooleanClause.Occur.SHOULD);=20
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, true)=
, BooleanClause.Occur.SHOULD);

Uwe
-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Alain Camus [mailto:aca@ngi.be]
> Sent: Friday, November 05, 2010 4:26 PM
> To: java-user@lucene.apache.org
> Subject: RangeQuery with multiple ranges ?
>=20
> Hello list,
>=20
> I'm new to lucene, trying to find out if this is possible :
>=20
> In Luke, I can write a query that gets me the results I want, that is :
> +denominator:([10000 TO 10000] OR [20000 TO 20000])
>=20
> I'd like to write the same in java. I tried the next code but it doesn't =
work :
> BooleanClause.Occur scaleOccur =3D
> LuceneUtils.convertRequiredAndProhibitedToOccur(true, false);
> Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
> Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
> RangeQuery rangeQuery1 =3D new RangeQuery(term1, term1, true);
> RangeQuery rangeQuery2 =3D new RangeQuery(term2, term2, true);
> BooleanQuery booleanQuery =3D new BooleanQuery();
> booleanQuery .setMinimumNumberShouldMatch(1);
> booleanQuery .add(rangeQuery1, scaleOccur);
> booleanQuery .add(rangeQuery2, scaleOccur);
> BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
> query.add(scaleRangeClause);
> The resulting query doesn't give me the expected results :
> +((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
>=20
> Is it possible to do what I want ? Any documentation I could read about t=
his ?
>=20
> Alain



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47746-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 09:08:40 2010
Return-Path: <java-user-return-47746-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85615 invoked from network); 8 Nov 2010 09:08:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 09:08:39 -0000
Received: (qmail 61669 invoked by uid 500); 8 Nov 2010 09:09:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61369 invoked by uid 500); 8 Nov 2010 09:09:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 37967 invoked by uid 99); 8 Nov 2010 08:49:44 -0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prvs=921b9a2d6=aca@ngi.be designates 193.190.215.50 as permitted sender)
X-IronPort-AV: E=Sophos;i="4.58,313,1286143200"; 
   d="scan'208";a="3124465"
Date: Mon, 8 Nov 2010 09:49:17 +0100 (CET)
From: Alain Camus <aca@ngi.be>
To: java-user@lucene.apache.org
Message-ID: <4886798.70367.1289206157634.JavaMail.root@morpheus>
In-Reply-To: <008b01cb7d01$84dbd5b0$8e938110$@thetaphi.de>
Subject: Re: RangeQuery with multiple ranges ?
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Originating-IP: [10.1.110.110]
X-Mailer: Zimbra 6.0.8_GA_2661 (ZimbraWebClient - FF3.0 (Win)/6.0.8_GA_2661)
X-Virus-Checked: Checked by ClamAV on apache.org

Hello,

Thanks for your replies. I'm sorry but I couldn't get one of David's or Uwe=
's solution to work.


For the QueryParser, I tried :

QueryParser parser =3D new QueryParser("denominator", new StandardAnalyzer(=
));
Query bq =3D new BooleanQuery();=20
try {
=09bq =3D parser.parse("+denominator:([10000 TO 10000] OR [20000 TO 20000])=
");
} catch (ParseException pe) {
=09Log.error(Geonet.SEARCH_ENGINE, "\n\nQueryParser.parse exception\n" + pe=
 + "\n\n");
}
BooleanClause.Occur scaleOccur =3D LuceneUtils.convertRequiredAndProhibited=
ToOccur(true, false);
BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
query.add(scaleRangeClause);


With TermRangeQuery :

BooleanClause.Occur scaleOccur =3D LuceneUtils.convertRequiredAndProhibited=
ToOccur(true, false);
String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, true)=
, BooleanClause.Occur.SHOULD);
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, true)=
, BooleanClause.Occur.SHOULD);
BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
query.add(scaleRangeClause);

I also tried with Uwe's code for the deprecated RangeQuery.


The result I get is always the same :=20
+((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
which doesn't work, neither deployed on the server or in Luke. The queries =
that works in Luke are=20
+denominator:([10000 TO 10000] OR [50000 TO 50000]) or
+denominator:([10000 TO 10000] [50000 TO 50000])


A little more background information :
 * The field denominator is indexed alphabetically. If it was indexed numer=
ically, I'd be fine with a simple NumericRangeQuery [10000 TO 50000] but I =
don't have the time to change the way it is indexed (it will be for the nex=
t release).=20
 * If you have a solution where denominator takes a single value and not a =
range (like +denominator:(10000 OR 50000)), that is probably what I'm looki=
ng for.
 * I have to insert this query in a global query, hence the last line query=
.add(scaleRangeClause);
 * The deprecated RangeQuery is used everywhere in the code I'm modifying, =
so I didn't try to replace it with TermRangeQuery and NumericRangeQuery.

Would you have another hint ?

Alain

----- Mail original -----
De: "David Fertig" <dfertig@cymfony.com>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Vendredi 5 Novembre 2010 16:43:42
Objet: RE: RangeQuery with multiple ranges ?

You can use a query parser to parse your text query into the appropriate qu=
ery objects.

----- Mail original -----
De: "Uwe Schindler" <uwe@thetaphi.de>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Vendredi 5 Novembre 2010 16:52:58
Objet: RE: RangeQuery with multiple ranges ?

Why do you use such complicated stuff to build the BQ?

Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
BooleanQuery bq =3D new BooleanQuery();
bq.add(new RangeQuery(term1, term1, true), BooleanClause.Occur.SHOULD);=20
bq.add(new RangeQuery(term2, term2, true), BooleanClause.Occur.SHOULD);

By the way, your code is outdated, you should better use NumericRangeQuery =
for numerics! Else RangeQuery is deprecated and replaced by TermRangeQuery:

String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, true)=
, BooleanClause.Occur.SHOULD);=20
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, true)=
, BooleanClause.Occur.SHOULD);

Uwe
-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Alain Camus [mailto:aca@ngi.be]
> Sent: Friday, November 05, 2010 4:26 PM
> To: java-user@lucene.apache.org
> Subject: RangeQuery with multiple ranges ?
>=20
> Hello list,
>=20
> I'm new to lucene, trying to find out if this is possible :
>=20
> In Luke, I can write a query that gets me the results I want, that is :
> +denominator:([10000 TO 10000] OR [20000 TO 20000])
>=20
> I'd like to write the same in java. I tried the next code but it doesn't =
work :
> BooleanClause.Occur scaleOccur =3D
> LuceneUtils.convertRequiredAndProhibitedToOccur(true, false);
> Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
> Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
> RangeQuery rangeQuery1 =3D new RangeQuery(term1, term1, true);
> RangeQuery rangeQuery2 =3D new RangeQuery(term2, term2, true);
> BooleanQuery booleanQuery =3D new BooleanQuery();
> booleanQuery .setMinimumNumberShouldMatch(1);
> booleanQuery .add(rangeQuery1, scaleOccur);
> booleanQuery .add(rangeQuery2, scaleOccur);
> BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
> query.add(scaleRangeClause);
> The resulting query doesn't give me the expected results :
> +((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
>=20
> Is it possible to do what I want ? Any documentation I could read about t=
his ?
>=20
> Alain



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47747-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 10:06:56 2010
Return-Path: <java-user-return-47747-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11401 invoked from network); 8 Nov 2010 10:06:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 10:06:55 -0000
Received: (qmail 25900 invoked by uid 500); 8 Nov 2010 10:07:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25421 invoked by uid 500); 8 Nov 2010 10:07:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25369 invoked by uid 99); 8 Nov 2010 10:07:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 10:07:20 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of prvs=921b9a2d6=aca@ngi.be designates 193.190.215.50 as permitted sender)
Received: from [193.190.215.50] (HELO iron1.dmz.ngi.be) (193.190.215.50)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 10:07:14 +0000
X-IronPort-AV: E=Sophos;i="4.58,313,1286143200"; 
   d="scan'208";a="3124834"
Received: from gandalf.dmz.ngi.be (HELO morpheus.int.ngi.be) ([172.16.254.1])
  by iron1-priv.dmz.ngi.be with ESMTP; 08 Nov 2010 11:06:54 +0100
Received: from morpheus.int.ngi.be (morpheus.int.ngi.be [10.1.110.48])
	by morpheus.int.ngi.be (Postfix) with ESMTP id 474403A70120
	for <java-user@lucene.apache.org>; Mon,  8 Nov 2010 11:06:54 +0100 (CET)
Date: Mon, 8 Nov 2010 11:06:54 +0100 (CET)
From: Alain Camus <aca@ngi.be>
To: java-user@lucene.apache.org
Message-ID: <16580417.70747.1289210814109.JavaMail.root@morpheus>
In-Reply-To: <2125854.70473.1289207094162.JavaMail.root@morpheus>
Subject: Re: RangeQuery with multiple ranges ?
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Originating-IP: [10.1.110.110]
X-Mailer: Zimbra 6.0.8_GA_2661 (ZimbraWebClient - FF3.0 (Win)/6.0.8_GA_2661)
X-Virus-Checked: Checked by ClamAV on apache.org

Nevermind, and sorry for the double post.
The compiled file wasn't going at the right place, so no change was taken i=
nto account.
Both your solutions seem to work fine.

Thanks a lot!

Alain

----- Mail original -----
De: "Alain Camus" <aca@ngi.be>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Lundi 8 Novembre 2010 10:04:54
Objet: Re: RangeQuery with multiple ranges ?

Hello,

Thanks for your replies. I'm sorry but I couldn't get one of David's or Uwe=
's solution to work.


For the QueryParser, I tried :

QueryParser parser =3D new QueryParser("denominator", new StandardAnalyzer(=
));
Query bq =3D new BooleanQuery();=20
try {
=09bq =3D parser.parse("+denominator:([10000 TO 10000] OR [20000 TO 20000])=
");
} catch (ParseException pe) {
=09Log.error(Geonet.SEARCH_ENGINE, "\n\nQueryParser.parse exception\n" + pe=
 + "\n\n");
}
BooleanClause.Occur scaleOccur =3D LuceneUtils.convertRequiredAndProhibited=
ToOccur(true, false);
BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
query.add(scaleRangeClause);


With TermRangeQuery :

BooleanClause.Occur scaleOccur =3D LuceneUtils.convertRequiredAndProhibited=
ToOccur(true, false);
String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, true)=
, BooleanClause.Occur.SHOULD);
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, true)=
, BooleanClause.Occur.SHOULD);
BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
query.add(scaleRangeClause);

I also tried with Uwe's code for the deprecated RangeQuery.


The result I get is always the same :=20
+((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
which doesn't work, neither deployed on the server or in Luke. The queries =
that works in Luke are=20
+denominator:([10000 TO 10000] OR [50000 TO 50000]) or
+denominator:([10000 TO 10000] [50000 TO 50000])


A little more background information :
 * The field denominator is indexed alphabetically. If it was indexed numer=
ically, I'd be fine with a simple NumericRangeQuery [10000 TO 50000] but I =
don't have the time to change the way it is indexed (it will be for the nex=
t release).=20
 * If you have a solution where denominator takes a single value and not a =
range (like +denominator:(10000 OR 50000)), that is probably what I'm looki=
ng for.
 * I have to insert this query in a global query, hence the last line query=
.add(scaleRangeClause);
 * The deprecated RangeQuery is used everywhere in the code I'm modifying, =
so I didn't try to replace it with TermRangeQuery and NumericRangeQuery.

Would you have another hint ?

Alain

----- Mail original -----
De: "David Fertig" <dfertig@cymfony.com>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Vendredi 5 Novembre 2010 16:43:42
Objet: RE: RangeQuery with multiple ranges ?

You can use a query parser to parse your text query into the appropriate qu=
ery objects.

----- Mail original -----
De: "Uwe Schindler" <uwe@thetaphi.de>
=C3=80: java-user@lucene.apache.org
Envoy=C3=A9: Vendredi 5 Novembre 2010 16:52:58
Objet: RE: RangeQuery with multiple ranges ?

Why do you use such complicated stuff to build the BQ?

Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
BooleanQuery bq =3D new BooleanQuery();
bq.add(new RangeQuery(term1, term1, true), BooleanClause.Occur.SHOULD);=20
bq.add(new RangeQuery(term2, term2, true), BooleanClause.Occur.SHOULD);

By the way, your code is outdated, you should better use NumericRangeQuery =
for numerics! Else RangeQuery is deprecated and replaced by TermRangeQuery:

String term1 =3D "10000", term2 =3D "50000";
BooleanQuery bq =3D new BooleanQuery();
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term1, term1, true, true)=
, BooleanClause.Occur.SHOULD);=20
bq.add(new TermRangeQuery(LuceneIndexField.SCALE, term2, term2, true, true)=
, BooleanClause.Occur.SHOULD);

Uwe
-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Alain Camus [mailto:aca@ngi.be]
> Sent: Friday, November 05, 2010 4:26 PM
> To: java-user@lucene.apache.org
> Subject: RangeQuery with multiple ranges ?
>=20
> Hello list,
>=20
> I'm new to lucene, trying to find out if this is possible :
>=20
> In Luke, I can write a query that gets me the results I want, that is :
> +denominator:([10000 TO 10000] OR [20000 TO 20000])
>=20
> I'd like to write the same in java. I tried the next code but it doesn't =
work :
> BooleanClause.Occur scaleOccur =3D
> LuceneUtils.convertRequiredAndProhibitedToOccur(true, false);
> Term term1 =3D new Term(LuceneIndexField.SCALE, "10000");
> Term term2 =3D new Term(LuceneIndexField.SCALE, "50000");
> RangeQuery rangeQuery1 =3D new RangeQuery(term1, term1, true);
> RangeQuery rangeQuery2 =3D new RangeQuery(term2, term2, true);
> BooleanQuery booleanQuery =3D new BooleanQuery();
> booleanQuery .setMinimumNumberShouldMatch(1);
> booleanQuery .add(rangeQuery1, scaleOccur);
> booleanQuery .add(rangeQuery2, scaleOccur);
> BooleanClause scaleRangeClause =3D new BooleanClause(bq, scaleOccur);
> query.add(scaleRangeClause);
> The resulting query doesn't give me the expected results :
> +((+denominator:[10000 TO 10000] +denominator:[50000 TO 50000])~1)
>=20
> Is it possible to do what I want ? Any documentation I could read about t=
his ?
>=20
> Alain



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47748-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 11:46:08 2010
Return-Path: <java-user-return-47748-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49838 invoked from network); 8 Nov 2010 11:46:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 11:46:07 -0000
Received: (qmail 31672 invoked by uid 500); 8 Nov 2010 11:46:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31292 invoked by uid 500); 8 Nov 2010 11:46:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31284 invoked by uid 99); 8 Nov 2010 11:46:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 11:46:31 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 11:46:24 +0000
Received: by bwz19 with SMTP id 19so5104371bwz.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 03:46:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:cc:content-type
         :content-transfer-encoding;
        bh=E47gyjfbWCrLyhBfxFGBkobaZ4R+rk71/rvYvqijW0E=;
        b=C2zobhc3hh4rv3hdkPgnr9UH1/tNgRQIuXzkM+Ky02D18cN+OdvdqYJsb7/tbVUA3N
         U5mOyA6V/iix7TBc9nSS0eKGdSzKZUWkLeWciXJ4wi4xSRMJu8H+LKoyync/LGzZz5KD
         X/QqvtFZQ4W891osl+ycfF1RWV0CkR+WOu1cs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :cc:content-type:content-transfer-encoding;
        b=AnzIvBAmrYI7V+Y4oH/wMkwonFzRAelce7+j/VpubGrGv0HS/Nsx4QxfJQCS9Re5xv
         o7htBHV1E6szJkGeuV26Mx8cI8FV4cmXhcwmUqTBh3p1l/OMCdkZlXY+Md2iSYMJ2RMc
         ZNz0iPABCxW5kiyje9Uez3D7ugxyJLkuFMOCI=
Received: by 10.204.55.208 with SMTP id v16mr4706622bkg.214.1289216764539;
 Mon, 08 Nov 2010 03:46:04 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Mon, 8 Nov 2010 03:45:44 -0800 (PST)
In-Reply-To: <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
 <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
 <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com> <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 8 Nov 2010 11:45:44 +0000
Message-ID: <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Cc: David Fertig <dfertig@cymfony.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

This does seem extremely odd.  David sent me a copy of his index and
I've played around with it and also written a self-contained RAM index
program, below, that shows the same problem, namely that if the second
index has 1000+ docs the one and only doc in the first index is
incorrectly matched if the search is done with a MultiSearcher.  In
answer to Uwe's question, it works correctly if use a single
IndexSearcher on top of a MultiReader.

Tests run with lucene-core-3.0.2.jar.

Snippet from program output:

Larger index with 999 docs
--- multi reader ---
Query: +author:aaa -pubdate:[aaa TO bbb]
MaxDocs: 1000
Hit count: 0
--- multi searcher ---
Query: +author:aaa -pubdate:[aaa TO bbb]
MaxDocs: 1000
Hit count: 0

Larger index with 1000 docs
--- multi reader ---
Query: +author:aaa -pubdate:[aaa TO bbb]
MaxDocs: 1001
Hit count: 0
--- multi searcher ---
Query: +author:aaa -pubdate:[aaa TO bbb]
MaxDocs: 1001
Hit count: 1
Docno: 0
author: /aaa/, indexed: true
pubdate: /abc/, indexed: true

-----------------------------------------------------------------------
package test;

import org.apache.lucene.analysis.*;
import org.apache.lucene.analysis.standard.*;
import org.apache.lucene.document.*;
import org.apache.lucene.queryParser.QueryParser;
import org.apache.lucene.index.*;
import org.apache.lucene.search.*;
import org.apache.lucene.store.*;
import org.apache.lucene.util.Version;

public class LuceneTest8 {

    static public void main(String[] args) throws Exception {
	test(999);
	test(1000);
	test(1001);
    }


    static void test(int _max) throws Exception {
	System.out.printf("\n\nLarger index with %s docs\n", _max);
	Analyzer anl =3D new StandardAnalyzer(Version.LUCENE_30);
	Directory dir1 =3D loadIndex(anl, 1, "aaa", "abc");
	Directory dir2 =3D loadIndex(anl, _max, "zzz", "zzz");
	QueryParser qp =3D new QueryParser(Version.LUCENE_30, "author", anl);
	String qstr =3D "author:aaa AND NOT pubdate:[aaa TO bbb]";
	Query q =3D qp.parse(qstr);
	IndexReader ir1 =3D IndexReader.open(dir1);
	IndexReader ir2 =3D IndexReader.open(dir2);
	Searcher searcher1 =3D new IndexSearcher(ir1);
	Searcher searcher2 =3D new IndexSearcher(ir2);
	MultiReader mr =3D new MultiReader(ir1, ir2);
	Searcher searcherm1 =3D new IndexSearcher(mr);
	MultiSearcher searcherm2 =3D new MultiSearcher(searcher1, searcher2);
	search(q, searcher1, "small index");
	search(q, searcher2, "larger index");
	search(q, searcherm1, "multi reader");
	search(q, searcherm2, "multi searcher");
    }



    static Directory loadIndex(Analyzer _anl,
			       int _max,
			       String _author,
			       String _pd) throws Exception {
	RAMDirectory dir =3D new RAMDirectory();
	IndexWriter iw =3D new IndexWriter(dir,
					 _anl,
					 true,
					 IndexWriter.MaxFieldLength.UNLIMITED);
	for (int i =3D 0; i < _max; i++) {
	    Document d =3D new Document();
	    d.add(new Field("author", _author,
			    Field.Store.YES, Field.Index.ANALYZED));
	    d.add(new Field("pubdate", _pd,
			    Field.Store.YES, Field.Index.ANALYZED));
	    iw.addDocument(d);
	}
	iw.close();
	return dir;
    }


    static void search(Query _q,
		       Searcher _searcher,
		       String _what) throws Exception {
	System.out.printf("--- %s ---\n", _what);
	System.out.printf("Query: %s\n", _q.toString());
	System.out.printf("MaxDocs: %s\n", _searcher.maxDoc());
	TopDocs topDocs =3D _searcher.search(_q, 10);
	System.out.printf("Hit count: %s\n", topDocs.totalHits);
	for (int in =3D 0; in < topDocs.totalHits; in++) {
	    int docno =3D topDocs.scoreDocs[in].doc;
	    Document ldoc =3D _searcher.doc(docno);
	    System.out.printf("Docno: %s\n", docno);
	    for (Fieldable f : ldoc.getFields()) {
		System.out.printf("%s: /%s/, indexed: %s\n",
				  f.name(), f.stringValue(), f.isIndexed());
	    }
	}
    }
}


--
Ian.


On Mon, Nov 8, 2010 at 4:32 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
> Does the same happen with a MultiReader on top of both indexes and using =
a
> single IndexSearcher on top of this MultiReader?
>
> P.S.: How about using NumericField?
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
>> -----Original Message-----
>> From: David Fertig [mailto:dfertig@cymfony.com]
>> Sent: Monday, November 08, 2010 4:21 AM
>> To: java-user@lucene.apache.org
>> Subject: RE: Search returning documents matching a NOT range
>>
>> publish_date is a string, formatted as YYYYMMDD, so it string sorting
> should
>> work correctly for this field.
>>
>> The field is indexed as a keyword and the field's value is also stored.
>>
>> I have previously reviewed the terms and optimized the index with luke
>> 1.0.1 to make sure there was no index corruption. It is a very useful
> tool,
>> however it can only open 1 index at a time so I can't reproduce the issu=
e
> with
>> it.
>>
>> At your suggestion I added code to enumerate all terms in the indexes an=
d
>> there are no inconsistencies.
>>
>> The two fields being searched each only have 1 term in the first index (=
as
>> expected) and those terms are not in the second index.
>>
>> David
>>
>>
>>
>> -----Original Message-----
>> From: Erick Erickson [mailto:erickerickson@gmail.com]
>> Sent: Sunday, November 7, 2010 11:12 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: Search returning documents matching a NOT range
>>
>> What kind of field is publish_date? And how do you store data there?
>> Is it possible you're getting some date presentation wonkiness in here?
>> One thing that might shed light on your problem is if you enumerated the
>> terms in that field and printed them out rather than the document.get.
> That is,
>> be sure you're getting what's in the index (and thus being searched)
> rather than
>> wha's stored in the document.
>>
>> Luke might get you there faster/easier....
>>
>> Best
>> Erick
>>
>> On Fri, Nov 5, 2010 at 5:18 PM, David Fertig <dfertig@cymfony.com>
>> wrote:
>>
>> > Ian,
>> > Thank you for getting back to me. =A0No, I do not get a bogus hit from
>> > searching the small index alone. =A0Also, I do not get a hit if I dele=
te
>> any
>> > more documents from the larger index.
>> >
>> > I have updated my test to use RamDirectory and also print maxDoc() for
>> the
>> > searchables and the searcher, all numbers are as expected. =A0I have
>> posted
>> > all the code, but did not want to post the indexes due to their size
>> (2.2
>> > meg uncompressed). =A0I will mail them to anyone who can help.
>> >
>> > Here is the complete latest test code and its output
>> >
>> >
>> >
>> > public class LuceneTest {
>> > =A0 =A0static public void main(String[] args) {
>> > =A0 =A0 =A0 =A0try {
>> > =A0 =A0 =A0 =A0 =A0 =A0QueryParser queryParser =3D new
>> QueryParser(Version.LUCENE_30,
>> > "author", new KeywordAnalyzer());
>> > =A0 =A0 =A0 =A0 =A0 =A0Query query =3D queryParser.parse("author:benta=
lcella AND NOT
>> > publish_date:[20100601 TO 20100630]");
>> > =A0 =A0 =A0 =A0 =A0 =A0Searchable[] searchables =3D new Searchable[2];
>> > =A0 =A0 =A0 =A0 =A0 =A0 RAMDirectory ram1 =3D new RAMDirectory(new
>> NIOFSDirectory(new
>> > File("/home/dfertig/testIndexes/b1")));
>> > =A0 =A0 =A0 =A0 =A0 =A0RAMDirectory ram2 =3D new RAMDirectory(new NIOF=
SDirectory(new
>> > File("/home/dfertig/testIndexes/m1")));
>> > =A0 =A0 =A0 =A0 =A0 =A0searchables[0] =3D new IndexSearcher(ram1, true=
);
>> > =A0 =A0 =A0 =A0 =A0 =A0searchables[1] =3D new IndexSearcher(ram2, true=
);
>> > =A0 =A0 =A0 =A0 =A0 =A0MultiSearcher searcher =3D new MultiSearcher(se=
archables);
>> > =A0 =A0 =A0 =A0 =A0 =A0System.out.println("MaxDocs for index 1: " +
>> > searchables[0].maxDoc());
>> > =A0 =A0 =A0 =A0 =A0 =A0System.out.println("MaxDocs for index 2: " +
>> > searchables[1].maxDoc());
>> > =A0 =A0 =A0 =A0 =A0 =A0System.out.println("MaxDocs for MultiSearcher: =
" +
>> > searcher.maxDoc());
>> > =A0 =A0 =A0 =A0 =A0 =A0 System.out.println("Query: " + query.toString(=
));
>> > =A0 =A0 =A0 =A0 =A0 =A0TopDocs topDocs =3D searcher.search(query, 10);
>> > =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Results: " + topDocs.totalH=
its);
>> > =A0 =A0 =A0 =A0 =A0 =A0for (int in =3D 0; in < topDocs.totalHits; in++=
) {
>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Document document =3D
>> searcher.doc(topDocs.scoreDocs[in].doc);
>> > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.println("publish_date: " +
>> > document.get("publish_date"));
>> > =A0 =A0 =A0 =A0 =A0 =A0}
>> > =A0 =A0 =A0 =A0 =A0 =A0searcher.close();
>> > =A0 =A0 =A0 =A0 =A0 =A0 ram1.close();
>> > =A0 =A0 =A0 =A0 =A0 =A0ram2.close();
>> > =A0 =A0 =A0 =A0 } catch (Exception e) {
>> > =A0 =A0 =A0 =A0 =A0 =A0System.out.println(e.getMessage());
>> > =A0 =A0 =A0 =A0 =A0 =A0e.printStackTrace();
>> > =A0 =A0 =A0 =A0}
>> > =A0 =A0}
>> > }
>> >
>> > Output:
>> > MaxDocs for index 1: 1
>> > MaxDocs for index 2: 1000
>> > MaxDocs for MultiSearcher: 1001
>> > Query: +author:bentalcella -publish_date:[20100601 TO 20100630]
>> > Results: 1
>> > publish_date: 20100606
>> >
>> >
>> >
>> >
>> > -----Original Message-----
>> > From: Ian Lea [mailto:ian.lea@gmail.com]
>> > Sent: Friday, November 5, 2010 4:57 PM
>> > To: java-user@lucene.apache.org
>> > Subject: Re: Search returning documents matching a NOT range
>> >
>> > Do you get the bogus hit on the small index if search that index
>> > alone? =A0Are you positive it only holds the one doc? Loading the one
>> > doc into a new RAM based index in the test would prove it.
>> >
>> > You are more likely to get help if post a self-contained example -
>> > people can see everything relevant and are more likely to spot a
>> > problem.
>> >
>> >
>> > --
>> > Ian.
>> >
>> >
>> > On Thu, Nov 4, 2010 at 4:52 PM, David Fertig <dfertig@cymfony.com>
>> wrote:
>> > > I have an active lucene implementation that has been in place for a
>> > > couple years and was recently upgraded to the 3.02 branch. We are
>> now
>> > > occasionally seeing documents returned from searches that should not
>> be
>> > > returned. I have reduced the code and indexes to the smallest set
>> > > possible where I can still repeat the issue.
>> > >
>> > >
>> > >
>> > > My test cases uses 2 indexes. =A0These indexes have been
>> rebuilt/optimized
>> > > using Luke 1.0.1 to make them the smallest possible. =A0One index ha=
s
>> 1
>> > > document, which is being returned by the query but should not. =A0 T=
he
>> > > other index has 1000 documents, none of which match the search
>> criteria.
>> > > The query should bring back 0 results, but brings back 1. =A0I can z=
ip
>> and
>> > > mail the indexes if it would aid in helping track down this issue.
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > > public class LuceneTest {
>> > >
>> > > =A0 =A0static public void main(String[] args) {
>> > >
>> > > =A0 =A0 =A0 =A0try {
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0QueryParser queryParser =3D new
>> QueryParser(Version.LUCENE_30,
>> > > "author", new KeywordAnalyzer());
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0Query query =3D queryParser.parse("author:ben=
talcella AND
>> NOT
>> > > publish_date:[20100601 TO 20100630]");
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0Searchable[] searchables =3D new Searchable[2=
];
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0searchables[0] =3D new IndexSearcher(new NIOF=
SDirectory(new
>> > > File("/home/dfertig/testIndexes/b1")), true);
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0searchables[1] =3D new IndexSearcher(new NIOF=
SDirectory(new
>> > > File("/home/dfertig/testIndexes/m1")), true);
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0Searcher searcher =3D new MultiSearcher(searc=
hables);
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Query: " + query.toString=
());
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0TopDocs topDocs =3D searcher.search(query, 10=
);
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Results: " + topDocs.tota=
lHits);
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0for (int in =3D 0; in < topDocs.totalHits; in=
++) {
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Document document =3D
>> > > searcher.doc(topDocs.scoreDocs[in].doc);
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.println("publish_date: " +
>> > > document.get("publish_date"));
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0}
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0searcher.close();
>> > >
>> > > =A0 =A0 =A0 =A0} catch (Exception e) {
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0System.out.println(e.getMessage());
>> > >
>> > > =A0 =A0 =A0 =A0 =A0 =A0e.printStackTrace();
>> > >
>> > > =A0 =A0 =A0 =A0}
>> > >
>> > > =A0 =A0}
>> > >
>> > > }
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47749-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 12:14:33 2010
Return-Path: <java-user-return-47749-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64478 invoked from network); 8 Nov 2010 12:14:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 12:14:33 -0000
Received: (qmail 58825 invoked by uid 500); 8 Nov 2010 12:15:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58361 invoked by uid 500); 8 Nov 2010 12:15:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58353 invoked by uid 99); 8 Nov 2010 12:14:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 12:14:58 +0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 12:14:52 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <farag_ahmed@yahoo.com>)
	id 1PFQcJ-0004HJ-1q
	for java-user@lucene.apache.org; Mon, 08 Nov 2010 04:14:31 -0800
Date: Mon, 8 Nov 2010 04:14:30 -0800 (PST)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1289218470994-1862280.post@n3.nabble.com>
Subject: high frequent terms in the search result set
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Extract the high frequent terms in the search result set.


I need to know how to extract the most frequent terms in the search result
set after submitting the query.

Here the class where you can use to extract the most frequent terms from the
index:

int j=0;
		int numTerms=5;
		 TermEnum terms = r.terms(); 
		
		TermDocs dok = r.termDocs();
		
		
		 TermInfoQueue tiq = new TermInfoQueue(numTerms);
		   
  while (terms.next()) {
	  tiq.insert(new TermInfo(terms.term(), terms.docFreq()));
		        }
		     
		      while (tiq.size() > 0) {
		      	
		        TermInfo termInfo = (TermInfo) tiq.pop();
		    
		        if(termInfo.docFreq>=70)
		        {
		      
		     System.out.println(termInfo.term.text() + "     " +
termInfo.docFreq);
		       
		   
		         j++;
		         
		      }
		       
		    
		      }

Is there a way to apply this class only in the result of the search?

Thanks in advance

-- 
View this message in context: http://lucene.472066.n3.nabble.com/high-frequent-terms-in-the-search-result-set-tp1862280p1862280.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47750-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 12:23:14 2010
Return-Path: <java-user-return-47750-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66095 invoked from network); 8 Nov 2010 12:23:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 12:23:14 -0000
Received: (qmail 68228 invoked by uid 500); 8 Nov 2010 12:23:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67988 invoked by uid 500); 8 Nov 2010 12:23:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67968 invoked by uid 99); 8 Nov 2010 12:23:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 12:23:38 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 12:23:33 +0000
Received: by bwz9 with SMTP id 9so8034bwz.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 04:23:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:cc:content-type
         :content-transfer-encoding;
        bh=aPoYZV9t3dxOVDSmKWtioqckQD0Gb/j03wcUzwU3k9o=;
        b=u3bLGZdEdnXR3KUiqrxmFAHXw5KIfzoVTdqIT05W3S7Qvg0mKY3ZQyWfp3aKsKbcKT
         3OaZwnmTFiiUwAa+yJrotwlonC1Cq5jTnwWJvz6eQw8HGSYpaJPoT0n9pVpaVBeE033f
         OtFi/zUBVBcb3kE2xV3PqxY3mCPS49sJPuXxg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :cc:content-type:content-transfer-encoding;
        b=l3+K2iFCfMVlRp9/oLcl406F3Oz9UGTFMBz0qddtlwymDilP9Ckr7aVuWWiyQZPid8
         Lc169XgRovbpNeIDBOb1aqf/EyORcITU7BnWLtO3KhrNoBQkYjEE2CdQlGRkNYWF4Yko
         CEhRXCIivxfd+WumSQD/b77a+HHZa0jMkkqpw=
Received: by 10.204.55.208 with SMTP id v16mr4736521bkg.214.1289218991829;
 Mon, 08 Nov 2010 04:23:11 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Mon, 8 Nov 2010 04:22:51 -0800 (PST)
In-Reply-To: <20101108120512.B7814D36002@mail.troja.net>
References: <20101108120512.B7814D36002@mail.troja.net>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 8 Nov 2010 12:22:51 +0000
Message-ID: <AANLkTikwfsWN5iRx5eYzpS+X5sqvkmjb-dS3vTgoOgbs@mail.gmail.com>
Subject: Re: Antw.: Search returning documents matching a NOT range
To: Uwe Schindler <uwe@thetaphi.de>
Cc: java-user@lucene.apache.org, David Fertig <dfertig@cymfony.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

It occurs in David's index and in my much simplifed test/demo index.
There is nothing special in mine so I'd guess the problem isn't really
index or data related, but certainly can't vouch for that.


--
Ian.


On Mon, Nov 8, 2010 at 12:05 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> That's extremely strange. If this is a bug in Multisearcher, we should fi=
x
> in proposed 3.0.3 release. Does the problem only occur with this special
> index?
>
> ---
> Uwe Schindler
> Generics Policeman
> Bremen, Germany
>
> ----- Reply message -----
> Von: "Ian Lea" <ian.lea@gmail.com>
> Datum: Mo., Nov. 8, 2010 12:45
> Betreff: Search returning documents matching a NOT range
> An: <java-user@lucene.apache.org>
> Cc: "David Fertig" <dfertig@cymfony.com>
>
>
> This does seem extremely odd. =A0David sent me a copy of his index and
> I've played around with it and also written a self-contained RAM index
> program, below, that shows the same problem, namely that if the second
> index has 1000+ docs the one and only doc in the first index is
> incorrectly matched if the search is done with a MultiSearcher. =A0In
> answer to Uwe's question, it works correctly if use a single
> IndexSearcher on top of a MultiReader.
>
> Tests run with lucene-core-3.0.2.jar.
>
> Snippet from program output:
>
> Larger index with 999 docs
> --- multi reader ---
> Query: +author:aaa -pubdate:[aaa TO bbb]
> MaxDocs: 1000
> Hit count: 0
> --- multi searcher ---
> Query: +author:aaa -pubdate:[aaa TO bbb]
> MaxDocs: 1000
> Hit count: 0
>
> Larger index with 1000 docs
> --- multi reader ---
> Query: +author:aaa -pubdate:[aaa TO bbb]
> MaxDocs: 1001
> Hit count: 0
> --- multi searcher ---
> Query: +author:aaa -pubdate:[aaa TO bbb]
> MaxDocs: 1001
> Hit count: 1
> Docno: 0
> author: /aaa/, indexed: true
> pubdate: /abc/, indexed: true
>
> -----------------------------------------------------------------------
> package test;
>
> import org.apache.lucene.analysis.*;
> import org.apache.lucene.analysis.standard.*;
> import org.apache.lucene.document.*;
> import org.apache.lucene.queryParser.QueryParser;
> import org.apache.lucene.index.*;
> import org.apache.lucene.search.*;
> import org.apache.lucene.store.*;
> import org.apache.lucene.util.Version;
>
> public class LuceneTest8 {
>
> =A0 =A0static public void main(String[] args) throws Exception {
> test(999);
> test(1000);
> test(1001);
> =A0 =A0}
>
>
> =A0 =A0static void test(int _max) throws Exception {
> System.out.printf("\n\nLarger index with %s docs\n", _max);
> Analyzer anl =3D new StandardAnalyzer(Version.LUCENE_30);
> Directory dir1 =3D loadIndex(anl, 1, "aaa", "abc");
> Directory dir2 =3D loadIndex(anl, _max, "zzz", "zzz");
> QueryParser qp =3D new QueryParser(Version.LUCENE_30, "author", anl);
> String qstr =3D "author:aaa AND NOT pubdate:[aaa TO bbb]";
> Query q =3D qp.parse(qstr);
> IndexReader ir1 =3D IndexReader.open(dir1);
> IndexReader ir2 =3D IndexReader.open(dir2);
> Searcher searcher1 =3D new IndexSearcher(ir1);
> Searcher searcher2 =3D new IndexSearcher(ir2);
> MultiReader mr =3D new MultiReader(ir1, ir2);
> Searcher searcherm1 =3D new IndexSearcher(mr);
> MultiSearcher searcherm2 =3D new MultiSearcher(searcher1, searcher2);
> search(q, searcher1, "small index");
> search(q, searcher2, "larger index");
> search(q, searcherm1, "multi reader");
> search(q, searcherm2, "multi searcher");
> =A0 =A0}
>
>
>
> =A0 =A0static Directory loadIndex(Analyzer _anl,
> =A0 =A0 =A0 int _max,
> =A0 =A0 =A0 String _author,
> =A0 =A0 =A0 String _pd) throws Exception {
> RAMDirectory dir =3D new RAMDirectory();
> IndexWriter iw =3D new IndexWriter(dir,
> _anl,
> true,
> IndexWriter.MaxFieldLength.UNLIMITED);
> for (int i =3D 0; i < _max; i++) {
> =A0 =A0Document d =3D new Document();
> =A0 =A0d.add(new Field("author", _author,
> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
> =A0 =A0d.add(new Field("pubdate", _pd,
> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
> =A0 =A0iw.addDocument(d);
> }
> iw.close();
> return dir;
> =A0 =A0}
>
>
> =A0 =A0static void search(Query _q,
> =A0 =A0 =A0 Searcher _searcher,
> =A0 =A0 =A0 String _what) throws Exception {
> System.out.printf("--- %s ---\n", _what);
> System.out.printf("Query: %s\n", _q.toString());
> System.out.printf("MaxDocs: %s\n", _searcher.maxDoc());
> TopDocs topDocs =3D _searcher.search(_q, 10);
> System.out.printf("Hit count: %s\n", topDocs.totalHits);
> for (int in =3D 0; in < topDocs.totalHits; in++) {
> =A0 =A0int docno =3D topDocs.scoreDocs[in].doc;
> =A0 =A0Document ldoc =3D _searcher.doc(docno);
> =A0 =A0System.out.printf("Docno: %s\n", docno);
> =A0 =A0for (Fieldable f : ldoc.getFields()) {
> System.out.printf("%s: /%s/, indexed: %s\n",
> =A0f.name(), f.stringValue(), f.isIndexed());
> =A0 =A0}
> }
> =A0 =A0}
> }
>
>
> --
> Ian.
>
>
> On Mon, Nov 8, 2010 at 4:32 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
>> Does the same happen with a MultiReader on top of both indexes and using=
 a
>> single IndexSearcher on top of this MultiReader?
>>
>> P.S.: How about using NumericField?
>>
>> -----
>> Uwe Schindler
>> H.-H.-Meier-Allee 63, D-28213 Bremen
>> http://www.thetaphi.de
>> eMail: uwe@thetaphi.de
>>
>>
>>> -----Original Message-----
>>> From: David Fertig [mailto:dfertig@cymfony.com]
>>> Sent: Monday, November 08, 2010 4:21 AM
>>> To: java-user@lucene.apache.org
>>> Subject: RE: Search returning documents matching a NOT range
>>>
>>> publish_date is a string, formatted as YYYYMMDD, so it string sorting
>> should
>>> work correctly for this field.
>>>
>>> The field is indexed as a keyword and the field's value is also stored.
>>>
>>> I have previously reviewed the terms and optimized the index with luke
>>> 1.0.1 to make sure there was no index corruption. It is a very useful
>> tool,
>>> however it can only open 1 index at a time so I can't reproduce the iss=
ue
>> with
>>> it.
>>>
>>> At your suggestion I added code to enumerate all terms in the indexes a=
nd
>>> there are no inconsistencies.
>>>
>>> Th
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47751-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 15:13:14 2010
Return-Path: <java-user-return-47751-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66358 invoked from network); 8 Nov 2010 15:13:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 15:13:14 -0000
Received: (qmail 45429 invoked by uid 500); 8 Nov 2010 15:13:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45183 invoked by uid 500); 8 Nov 2010 15:13:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45175 invoked by uid 99); 8 Nov 2010 15:13:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 15:13:39 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.161.176 as permitted sender)
Received: from [209.85.161.176] (HELO mail-gx0-f176.google.com) (209.85.161.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 15:13:35 +0000
Received: by gxk4 with SMTP id 4so2379549gxk.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 07:13:14 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=WHEUdJg8CwZDDUS+IwNtInxYoQJfixh9fbqmshJEO9c=;
        b=K56NFotW04nnmNlg/cFpwF0B2K077FSlTCQPMAb9gP+26LBp4TfyuNexbpeEBJLGAZ
         kLvda7CPXhEFjM16LyrZnJ8H9PzSzh06KoTfNry9irJNBe7UlMqW+5J9ek1KxMBmDEeM
         wx36dTxWa4WPEapE4V1kLU120HOys3V5DfNHk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=qxoIlSTo/Zt5UTte3zifU8fr1+pXLV/IIFCx7Ew1BCThhS5AC/FytjHDFI5e9YyvdX
         2asumBx3WHBvA/B4G3pdqvGTwfAfUXXf293yki6aBM9s4nFFeJfTygy+hxlPgW3sb8tM
         AJgXBJn+qI3Rq2iXd7B1cQaYgw0WMhUmOKgbM=
Received: by 10.204.72.80 with SMTP id l16mr4937387bkj.133.1289229192764; Mon,
 08 Nov 2010 07:13:12 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Mon, 8 Nov 2010 07:12:51 -0800 (PST)
In-Reply-To: <AANLkTikwfsWN5iRx5eYzpS+X5sqvkmjb-dS3vTgoOgbs@mail.gmail.com>
References: <20101108120512.B7814D36002@mail.troja.net> <AANLkTikwfsWN5iRx5eYzpS+X5sqvkmjb-dS3vTgoOgbs@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 8 Nov 2010 15:12:51 +0000
Message-ID: <AANLkTikkW-1rzjzN=d79TxFxcxMkTR1=6sMixF+_d+zM@mail.gmail.com>
Subject: Re: Antw.: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I think it might be an edge case around TermRangeQuery and
MultiTermQuery and rewrite methods.  It only seems to happen when part
of the query is a TermRangeQuery and I can make the problem go away
with a call to setRewriteMethod(MultiTermQuery.xxx).

Where xxx is

CONSTANT_SCORE_BOOLEAN_QUERY_REWRITE  get spurious hit
CONSTANT_SCORE_AUTO_REWRITE_DEFAULT   get spurious hit
CONSTANT_SCORE_FILTER_REWRITE         all OK

>From o.a.l.search.MultiTermQuery.java for 3.0.2

    // If the query will hit more than 1 in 1000 of the docs
    // in the index (0.1%), the filter method is fastest:
    public static double DEFAULT_DOC_COUNT_PERCENT =3D 0.1;

The literal value 1000 might be a clue, but this is getting beyond my
level of expertise.


--
Ian.


On Mon, Nov 8, 2010 at 12:22 PM, Ian Lea <ian.lea@gmail.com> wrote:
> It occurs in David's index and in my much simplifed test/demo index.
> There is nothing special in mine so I'd guess the problem isn't really
> index or data related, but certainly can't vouch for that.
>
>
> --
> Ian.
>
>
> On Mon, Nov 8, 2010 at 12:05 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>> That's extremely strange. If this is a bug in Multisearcher, we should f=
ix
>> in proposed 3.0.3 release. Does the problem only occur with this special
>> index?
>>
>> ---
>> Uwe Schindler
>> Generics Policeman
>> Bremen, Germany
>>
>> ----- Reply message -----
>> Von: "Ian Lea" <ian.lea@gmail.com>
>> Datum: Mo., Nov. 8, 2010 12:45
>> Betreff: Search returning documents matching a NOT range
>> An: <java-user@lucene.apache.org>
>> Cc: "David Fertig" <dfertig@cymfony.com>
>>
>>
>> This does seem extremely odd. =A0David sent me a copy of his index and
>> I've played around with it and also written a self-contained RAM index
>> program, below, that shows the same problem, namely that if the second
>> index has 1000+ docs the one and only doc in the first index is
>> incorrectly matched if the search is done with a MultiSearcher. =A0In
>> answer to Uwe's question, it works correctly if use a single
>> IndexSearcher on top of a MultiReader.
>>
>> Tests run with lucene-core-3.0.2.jar.
>>
>> Snippet from program output:
>>
>> Larger index with 999 docs
>> --- multi reader ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1000
>> Hit count: 0
>> --- multi searcher ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1000
>> Hit count: 0
>>
>> Larger index with 1000 docs
>> --- multi reader ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1001
>> Hit count: 0
>> --- multi searcher ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1001
>> Hit count: 1
>> Docno: 0
>> author: /aaa/, indexed: true
>> pubdate: /abc/, indexed: true
>>
>> -----------------------------------------------------------------------
>> package test;
>>
>> import org.apache.lucene.analysis.*;
>> import org.apache.lucene.analysis.standard.*;
>> import org.apache.lucene.document.*;
>> import org.apache.lucene.queryParser.QueryParser;
>> import org.apache.lucene.index.*;
>> import org.apache.lucene.search.*;
>> import org.apache.lucene.store.*;
>> import org.apache.lucene.util.Version;
>>
>> public class LuceneTest8 {
>>
>> =A0 =A0static public void main(String[] args) throws Exception {
>> test(999);
>> test(1000);
>> test(1001);
>> =A0 =A0}
>>
>>
>> =A0 =A0static void test(int _max) throws Exception {
>> System.out.printf("\n\nLarger index with %s docs\n", _max);
>> Analyzer anl =3D new StandardAnalyzer(Version.LUCENE_30);
>> Directory dir1 =3D loadIndex(anl, 1, "aaa", "abc");
>> Directory dir2 =3D loadIndex(anl, _max, "zzz", "zzz");
>> QueryParser qp =3D new QueryParser(Version.LUCENE_30, "author", anl);
>> String qstr =3D "author:aaa AND NOT pubdate:[aaa TO bbb]";
>> Query q =3D qp.parse(qstr);
>> IndexReader ir1 =3D IndexReader.open(dir1);
>> IndexReader ir2 =3D IndexReader.open(dir2);
>> Searcher searcher1 =3D new IndexSearcher(ir1);
>> Searcher searcher2 =3D new IndexSearcher(ir2);
>> MultiReader mr =3D new MultiReader(ir1, ir2);
>> Searcher searcherm1 =3D new IndexSearcher(mr);
>> MultiSearcher searcherm2 =3D new MultiSearcher(searcher1, searcher2);
>> search(q, searcher1, "small index");
>> search(q, searcher2, "larger index");
>> search(q, searcherm1, "multi reader");
>> search(q, searcherm2, "multi searcher");
>> =A0 =A0}
>>
>>
>>
>> =A0 =A0static Directory loadIndex(Analyzer _anl,
>> =A0 =A0 =A0 int _max,
>> =A0 =A0 =A0 String _author,
>> =A0 =A0 =A0 String _pd) throws Exception {
>> RAMDirectory dir =3D new RAMDirectory();
>> IndexWriter iw =3D new IndexWriter(dir,
>> _anl,
>> true,
>> IndexWriter.MaxFieldLength.UNLIMITED);
>> for (int i =3D 0; i < _max; i++) {
>> =A0 =A0Document d =3D new Document();
>> =A0 =A0d.add(new Field("author", _author,
>> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
>> =A0 =A0d.add(new Field("pubdate", _pd,
>> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
>> =A0 =A0iw.addDocument(d);
>> }
>> iw.close();
>> return dir;
>> =A0 =A0}
>>
>>
>> =A0 =A0static void search(Query _q,
>> =A0 =A0 =A0 Searcher _searcher,
>> =A0 =A0 =A0 String _what) throws Exception {
>> System.out.printf("--- %s ---\n", _what);
>> System.out.printf("Query: %s\n", _q.toString());
>> System.out.printf("MaxDocs: %s\n", _searcher.maxDoc());
>> TopDocs topDocs =3D _searcher.search(_q, 10);
>> System.out.printf("Hit count: %s\n", topDocs.totalHits);
>> for (int in =3D 0; in < topDocs.totalHits; in++) {
>> =A0 =A0int docno =3D topDocs.scoreDocs[in].doc;
>> =A0 =A0Document ldoc =3D _searcher.doc(docno);
>> =A0 =A0System.out.printf("Docno: %s\n", docno);
>> =A0 =A0for (Fieldable f : ldoc.getFields()) {
>> System.out.printf("%s: /%s/, indexed: %s\n",
>> =A0f.name(), f.stringValue(), f.isIndexed());
>> =A0 =A0}
>> }
>> =A0 =A0}
>> }
>>
>>
>> --
>> Ian.
>>
>>
>> On Mon, Nov 8, 2010 at 4:32 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
>>> Does the same happen with a MultiReader on top of both indexes and usin=
g a
>>> single IndexSearcher on top of this MultiReader?
>>>
>>> P.S.: How about using NumericField?
>>>
>>> -----
>>> Uwe Schindler
>>> H.-H.-Meier-Allee 63, D-28213 Bremen
>>> http://www.thetaphi.de
>>> eMail: uwe@thetaphi.de
>>>
>>>
>>>> -----Original Message-----
>>>> From: David Fertig [mailto:dfertig@cymfony.com]
>>>> Sent: Monday, November 08, 2010 4:21 AM
>>>> To: java-user@lucene.apache.org
>>>> Subject: RE: Search returning documents matching a NOT range
>>>>
>>>> publish_date is a string, formatted as YYYYMMDD, so it string sorting
>>> should
>>>> work correctly for this field.
>>>>
>>>> The field is indexed as a keyword and the field's value is also stored=
.
>>>>
>>>> I have previously reviewed the terms and optimized the index with luke
>>>> 1.0.1 to make sure there was no index corruption. It is a very useful
>>> tool,
>>>> however it can only open 1 index at a time so I can't reproduce the is=
sue
>>> with
>>>> it.
>>>>
>>>> At your suggestion I added code to enumerate all terms in the indexes =
and
>>>> there are no inconsistencies.
>>>>
>>>> Th
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47752-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 17:42:55 2010
Return-Path: <java-user-return-47752-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60258 invoked from network); 8 Nov 2010 17:42:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 17:42:55 -0000
Received: (qmail 77758 invoked by uid 500); 8 Nov 2010 17:43:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77688 invoked by uid 500); 8 Nov 2010 17:43:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77675 invoked by uid 99); 8 Nov 2010 17:43:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 17:43:23 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 17:43:16 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Antw.: Search returning documents matching a NOT range
Date: Mon, 8 Nov 2010 12:42:52 -0500
Message-ID: <E5331E53F021E443B53EC78F375B3C761F91E5@buf-ex02.cymfony.com>
In-Reply-To: <AANLkTikkW-1rzjzN=d79TxFxcxMkTR1=6sMixF+_d+zM@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Antw.: Search returning documents matching a NOT range
Thread-Index: Act/V4qAbS/fYis6SWaIIOtk9DlJrAAE7ZJQ
References: <20101108120512.B7814D36002@mail.troja.net> <AANLkTikwfsWN5iRx5eYzpS+X5sqvkmjb-dS3vTgoOgbs@mail.gmail.com> <AANLkTikkW-1rzjzN=d79TxFxcxMkTR1=6sMixF+_d+zM@mail.gmail.com>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

This is roughly where I decided to ask for help as well. Ian's test case =
removes any question about my indexes being corrupted and reproduces the =
issue very cleanly.  I will try to continue digging deeper but nothing =
jumped out at me the first several times I've stepped through this but =
may try using Ian's more uniformly generated index.

Should I add a JIRA ticket for this or will someone else take care of =
this?  Hopefully I can add my email so I can track this issue.

David


-----Original Message-----
From: Ian Lea [mailto:ian.lea@gmail.com]=20
Sent: Monday, November 8, 2010 10:13 AM
To: java-user@lucene.apache.org
Subject: Re: Antw.: Search returning documents matching a NOT range

I think it might be an edge case around TermRangeQuery and
MultiTermQuery and rewrite methods.  It only seems to happen when part
of the query is a TermRangeQuery and I can make the problem go away
with a call to setRewriteMethod(MultiTermQuery.xxx).

Where xxx is

CONSTANT_SCORE_BOOLEAN_QUERY_REWRITE  get spurious hit
CONSTANT_SCORE_AUTO_REWRITE_DEFAULT   get spurious hit
CONSTANT_SCORE_FILTER_REWRITE         all OK

>From o.a.l.search.MultiTermQuery.java for 3.0.2

    // If the query will hit more than 1 in 1000 of the docs
    // in the index (0.1%), the filter method is fastest:
    public static double DEFAULT_DOC_COUNT_PERCENT =3D 0.1;

The literal value 1000 might be a clue, but this is getting beyond my
level of expertise.


--
Ian.


On Mon, Nov 8, 2010 at 12:22 PM, Ian Lea <ian.lea@gmail.com> wrote:
> It occurs in David's index and in my much simplifed test/demo index.
> There is nothing special in mine so I'd guess the problem isn't really
> index or data related, but certainly can't vouch for that.
>
>
> --
> Ian.
>
>
> On Mon, Nov 8, 2010 at 12:05 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>> That's extremely strange. If this is a bug in Multisearcher, we =
should fix
>> in proposed 3.0.3 release. Does the problem only occur with this =
special
>> index?
>>
>> ---
>> Uwe Schindler
>> Generics Policeman
>> Bremen, Germany
>>
>> ----- Reply message -----
>> Von: "Ian Lea" <ian.lea@gmail.com>
>> Datum: Mo., Nov. 8, 2010 12:45
>> Betreff: Search returning documents matching a NOT range
>> An: <java-user@lucene.apache.org>
>> Cc: "David Fertig" <dfertig@cymfony.com>
>>
>>
>> This does seem extremely odd. =A0David sent me a copy of his index =
and
>> I've played around with it and also written a self-contained RAM =
index
>> program, below, that shows the same problem, namely that if the =
second
>> index has 1000+ docs the one and only doc in the first index is
>> incorrectly matched if the search is done with a MultiSearcher. =A0In
>> answer to Uwe's question, it works correctly if use a single
>> IndexSearcher on top of a MultiReader.
>>
>> Tests run with lucene-core-3.0.2.jar.
>>
>> Snippet from program output:
>>
>> Larger index with 999 docs
>> --- multi reader ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1000
>> Hit count: 0
>> --- multi searcher ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1000
>> Hit count: 0
>>
>> Larger index with 1000 docs
>> --- multi reader ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1001
>> Hit count: 0
>> --- multi searcher ---
>> Query: +author:aaa -pubdate:[aaa TO bbb]
>> MaxDocs: 1001
>> Hit count: 1
>> Docno: 0
>> author: /aaa/, indexed: true
>> pubdate: /abc/, indexed: true
>>
>> =
-----------------------------------------------------------------------
>> package test;
>>
>> import org.apache.lucene.analysis.*;
>> import org.apache.lucene.analysis.standard.*;
>> import org.apache.lucene.document.*;
>> import org.apache.lucene.queryParser.QueryParser;
>> import org.apache.lucene.index.*;
>> import org.apache.lucene.search.*;
>> import org.apache.lucene.store.*;
>> import org.apache.lucene.util.Version;
>>
>> public class LuceneTest8 {
>>
>> =A0 =A0static public void main(String[] args) throws Exception {
>> test(999);
>> test(1000);
>> test(1001);
>> =A0 =A0}
>>
>>
>> =A0 =A0static void test(int _max) throws Exception {
>> System.out.printf("\n\nLarger index with %s docs\n", _max);
>> Analyzer anl =3D new StandardAnalyzer(Version.LUCENE_30);
>> Directory dir1 =3D loadIndex(anl, 1, "aaa", "abc");
>> Directory dir2 =3D loadIndex(anl, _max, "zzz", "zzz");
>> QueryParser qp =3D new QueryParser(Version.LUCENE_30, "author", anl);
>> String qstr =3D "author:aaa AND NOT pubdate:[aaa TO bbb]";
>> Query q =3D qp.parse(qstr);
>> IndexReader ir1 =3D IndexReader.open(dir1);
>> IndexReader ir2 =3D IndexReader.open(dir2);
>> Searcher searcher1 =3D new IndexSearcher(ir1);
>> Searcher searcher2 =3D new IndexSearcher(ir2);
>> MultiReader mr =3D new MultiReader(ir1, ir2);
>> Searcher searcherm1 =3D new IndexSearcher(mr);
>> MultiSearcher searcherm2 =3D new MultiSearcher(searcher1, searcher2);
>> search(q, searcher1, "small index");
>> search(q, searcher2, "larger index");
>> search(q, searcherm1, "multi reader");
>> search(q, searcherm2, "multi searcher");
>> =A0 =A0}
>>
>>
>>
>> =A0 =A0static Directory loadIndex(Analyzer _anl,
>> =A0 =A0 =A0 int _max,
>> =A0 =A0 =A0 String _author,
>> =A0 =A0 =A0 String _pd) throws Exception {
>> RAMDirectory dir =3D new RAMDirectory();
>> IndexWriter iw =3D new IndexWriter(dir,
>> _anl,
>> true,
>> IndexWriter.MaxFieldLength.UNLIMITED);
>> for (int i =3D 0; i < _max; i++) {
>> =A0 =A0Document d =3D new Document();
>> =A0 =A0d.add(new Field("author", _author,
>> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
>> =A0 =A0d.add(new Field("pubdate", _pd,
>> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
>> =A0 =A0iw.addDocument(d);
>> }
>> iw.close();
>> return dir;
>> =A0 =A0}
>>
>>
>> =A0 =A0static void search(Query _q,
>> =A0 =A0 =A0 Searcher _searcher,
>> =A0 =A0 =A0 String _what) throws Exception {
>> System.out.printf("--- %s ---\n", _what);
>> System.out.printf("Query: %s\n", _q.toString());
>> System.out.printf("MaxDocs: %s\n", _searcher.maxDoc());
>> TopDocs topDocs =3D _searcher.search(_q, 10);
>> System.out.printf("Hit count: %s\n", topDocs.totalHits);
>> for (int in =3D 0; in < topDocs.totalHits; in++) {
>> =A0 =A0int docno =3D topDocs.scoreDocs[in].doc;
>> =A0 =A0Document ldoc =3D _searcher.doc(docno);
>> =A0 =A0System.out.printf("Docno: %s\n", docno);
>> =A0 =A0for (Fieldable f : ldoc.getFields()) {
>> System.out.printf("%s: /%s/, indexed: %s\n",
>> =A0f.name(), f.stringValue(), f.isIndexed());
>> =A0 =A0}
>> }
>> =A0 =A0}
>> }
>>
>>
>> --
>> Ian.
>>
>>
>> On Mon, Nov 8, 2010 at 4:32 AM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>>> Does the same happen with a MultiReader on top of both indexes and =
using a
>>> single IndexSearcher on top of this MultiReader?
>>>
>>> P.S.: How about using NumericField?
>>>
>>> -----
>>> Uwe Schindler
>>> H.-H.-Meier-Allee 63, D-28213 Bremen
>>> http://www.thetaphi.de
>>> eMail: uwe@thetaphi.de
>>>
>>>
>>>> -----Original Message-----
>>>> From: David Fertig [mailto:dfertig@cymfony.com]
>>>> Sent: Monday, November 08, 2010 4:21 AM
>>>> To: java-user@lucene.apache.org
>>>> Subject: RE: Search returning documents matching a NOT range
>>>>
>>>> publish_date is a string, formatted as YYYYMMDD, so it string =
sorting
>>> should
>>>> work correctly for this field.
>>>>
>>>> The field is indexed as a keyword and the field's value is also =
stored.
>>>>
>>>> I have previously reviewed the terms and optimized the index with =
luke
>>>> 1.0.1 to make sure there was no index corruption. It is a very =
useful
>>> tool,
>>>> however it can only open 1 index at a time so I can't reproduce the =
issue
>>> with
>>>> it.
>>>>
>>>> At your suggestion I added code to enumerate all terms in the =
indexes and
>>>> there are no inconsistencies.
>>>>
>>>> Th
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47753-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 18:18:55 2010
Return-Path: <java-user-return-47753-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81192 invoked from network); 8 Nov 2010 18:18:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 18:18:55 -0000
Received: (qmail 42367 invoked by uid 500); 8 Nov 2010 18:19:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42281 invoked by uid 500); 8 Nov 2010 18:19:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42273 invoked by uid 99); 8 Nov 2010 18:19:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 18:19:23 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 18:19:18 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 6FDA445FE41
	for <java-user@lucene.apache.org>; Mon,  8 Nov 2010 19:18:56 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id YYC7ynveJNaq for <java-user@lucene.apache.org>;
	Mon,  8 Nov 2010 19:18:53 +0100 (CET)
Received: from VEGA (unknown [89.204.139.96])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id B227F45FE1F
	for <java-user@lucene.apache.org>; Mon,  8 Nov 2010 19:18:02 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <20101108120512.B7814D36002@mail.troja.net> <AANLkTikwfsWN5iRx5eYzpS+X5sqvkmjb-dS3vTgoOgbs@mail.gmail.com> <AANLkTikkW-1rzjzN=d79TxFxcxMkTR1=6sMixF+_d+zM@mail.gmail.com>
In-Reply-To: <AANLkTikkW-1rzjzN=d79TxFxcxMkTR1=6sMixF+_d+zM@mail.gmail.com>
Subject: RE: Antw.: Search returning documents matching a NOT range
Date: Mon, 8 Nov 2010 19:18:04 +0100
Message-ID: <000901cb7f71$4d2d7d90$e78878b0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHC1jyKfRkqhWpLEYoc2AWsns8siAJaf+MwAVaSC/qTW6u+UA==
Content-Language: de

Thanks for testing.

You should open an issue and attach the self-containing test to track =
this.

>From what you describe, it seems to be a problem in BooleanQuery =
(because it
only happens in BQ rewrite modes, not in Filter rewrites). For this =
case,
the query uses finally BooleanQuery rewrite in auto mode, as the number =
of
terms is low or equals 0 (depending on how many segments).

Does the problem also happen when you use MultiReader and BQ-only =
rewrite?
Maybe in MultiReader the index is bigger, so the auto rewrite uses =
Filter
rewrite then (your indexes seem to be quite small so you hit the limit =
very
easy by using MultiReader). If it also happens in MultiReader with =
Constant
score BQ rewrite, it=92s a BQ-related problem then. Does it also happen =
with a
Scoring BQ rewrite? (if NO, then it=92s a
ConstantScoreQuery(QueryWrapperFilter(BQ)) problem).

I would like to halt 3.0.3 and 2.9.4 for this to be checked and solved.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Ian Lea [mailto:ian.lea@gmail.com]
> Sent: Monday, November 08, 2010 4:13 PM
> To: java-user@lucene.apache.org
> Subject: Re: Antw.: Search returning documents matching a NOT range
>=20
> I think it might be an edge case around TermRangeQuery and =
MultiTermQuery
> and rewrite methods.  It only seems to happen when part of the query =
is a
> TermRangeQuery and I can make the problem go away with a call to
> setRewriteMethod(MultiTermQuery.xxx).
>=20
> Where xxx is
>=20
> CONSTANT_SCORE_BOOLEAN_QUERY_REWRITE  get spurious hit
> CONSTANT_SCORE_AUTO_REWRITE_DEFAULT   get spurious hit
> CONSTANT_SCORE_FILTER_REWRITE         all OK
>=20
> From o.a.l.search.MultiTermQuery.java for 3.0.2
>=20
>     // If the query will hit more than 1 in 1000 of the docs
>     // in the index (0.1%), the filter method is fastest:
>     public static double DEFAULT_DOC_COUNT_PERCENT =3D 0.1;
>=20
> The literal value 1000 might be a clue, but this is getting beyond my
level of
> expertise.
>=20
>=20
> --
> Ian.
>=20
>=20
> On Mon, Nov 8, 2010 at 12:22 PM, Ian Lea <ian.lea@gmail.com> wrote:
> > It occurs in David's index and in my much simplifed test/demo index.
> > There is nothing special in mine so I'd guess the problem isn't =
really
> > index or data related, but certainly can't vouch for that.
> >
> >
> > --
> > Ian.
> >
> >
> > On Mon, Nov 8, 2010 at 12:05 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
> >> That's extremely strange. If this is a bug in Multisearcher, we
> >> should fix in proposed 3.0.3 release. Does the problem only occur
> >> with this special index?
> >>
> >> ---
> >> Uwe Schindler
> >> Generics Policeman
> >> Bremen, Germany
> >>
> >> ----- Reply message -----
> >> Von: "Ian Lea" <ian.lea@gmail.com>
> >> Datum: Mo., Nov. 8, 2010 12:45
> >> Betreff: Search returning documents matching a NOT range
> >> An: <java-user@lucene.apache.org>
> >> Cc: "David Fertig" <dfertig@cymfony.com>
> >>
> >>
> >> This does seem extremely odd. =A0David sent me a copy of his index =
and
> >> I've played around with it and also written a self-contained RAM
> >> index program, below, that shows the same problem, namely that if =
the
> >> second index has 1000+ docs the one and only doc in the first index
> >> is incorrectly matched if the search is done with a MultiSearcher.
> >> In answer to Uwe's question, it works correctly if use a single
> >> IndexSearcher on top of a MultiReader.
> >>
> >> Tests run with lucene-core-3.0.2.jar.
> >>
> >> Snippet from program output:
> >>
> >> Larger index with 999 docs
> >> --- multi reader ---
> >> Query: +author:aaa -pubdate:[aaa TO bbb]
> >> MaxDocs: 1000
> >> Hit count: 0
> >> --- multi searcher ---
> >> Query: +author:aaa -pubdate:[aaa TO bbb]
> >> MaxDocs: 1000
> >> Hit count: 0
> >>
> >> Larger index with 1000 docs
> >> --- multi reader ---
> >> Query: +author:aaa -pubdate:[aaa TO bbb]
> >> MaxDocs: 1001
> >> Hit count: 0
> >> --- multi searcher ---
> >> Query: +author:aaa -pubdate:[aaa TO bbb]
> >> MaxDocs: 1001
> >> Hit count: 1
> >> Docno: 0
> >> author: /aaa/, indexed: true
> >> pubdate: /abc/, indexed: true
> >>
> >> =
---------------------------------------------------------------------
> >> --
> >> package test;
> >>
> >> import org.apache.lucene.analysis.*;
> >> import org.apache.lucene.analysis.standard.*;
> >> import org.apache.lucene.document.*;
> >> import org.apache.lucene.queryParser.QueryParser;
> >> import org.apache.lucene.index.*;
> >> import org.apache.lucene.search.*;
> >> import org.apache.lucene.store.*;
> >> import org.apache.lucene.util.Version;
> >>
> >> public class LuceneTest8 {
> >>
> >> =A0 =A0static public void main(String[] args) throws Exception {
> >> test(999); test(1000); test(1001);
> >> =A0 =A0}
> >>
> >>
> >> =A0 =A0static void test(int _max) throws Exception {
> >> System.out.printf("\n\nLarger index with %s docs\n", _max); =
Analyzer
> >> anl =3D new StandardAnalyzer(Version.LUCENE_30);
> >> Directory dir1 =3D loadIndex(anl, 1, "aaa", "abc"); Directory dir2 =
=3D
> >> loadIndex(anl, _max, "zzz", "zzz"); QueryParser qp =3D new
> >> QueryParser(Version.LUCENE_30, "author", anl); String qstr =3D
> >> "author:aaa AND NOT pubdate:[aaa TO bbb]"; Query q =3D =
qp.parse(qstr);
> >> IndexReader ir1 =3D IndexReader.open(dir1); IndexReader ir2 =3D
> >> IndexReader.open(dir2); Searcher searcher1 =3D new =
IndexSearcher(ir1);
> >> Searcher searcher2 =3D new IndexSearcher(ir2); MultiReader mr =3D =
new
> >> MultiReader(ir1, ir2); Searcher searcherm1 =3D new =
IndexSearcher(mr);
> >> MultiSearcher searcherm2 =3D new MultiSearcher(searcher1, =
searcher2);
> >> search(q, searcher1, "small index"); search(q, searcher2, "larger
> >> index"); search(q, searcherm1, "multi reader"); search(q, =
searcherm2,
> >> "multi searcher");
> >> =A0 =A0}
> >>
> >>
> >>
> >> =A0 =A0static Directory loadIndex(Analyzer _anl,
> >> =A0 =A0 =A0 int _max,
> >> =A0 =A0 =A0 String _author,
> >> =A0 =A0 =A0 String _pd) throws Exception {
> >> RAMDirectory dir =3D new RAMDirectory(); IndexWriter iw =3D new
> >> IndexWriter(dir, _anl, true, IndexWriter.MaxFieldLength.UNLIMITED);
> >> for (int i =3D 0; i < _max; i++) {
> >> =A0 =A0Document d =3D new Document();
> >> =A0 =A0d.add(new Field("author", _author,
> >> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
> >> =A0 =A0d.add(new Field("pubdate", _pd,
> >> =A0 =A0Field.Store.YES, Field.Index.ANALYZED));
> >> =A0 =A0iw.addDocument(d);
> >> }
> >> iw.close();
> >> return dir;
> >> =A0 =A0}
> >>
> >>
> >> =A0 =A0static void search(Query _q,
> >> =A0 =A0 =A0 Searcher _searcher,
> >> =A0 =A0 =A0 String _what) throws Exception {
> >> System.out.printf("--- %s ---\n", _what);
> >> System.out.printf("Query: %s\n", _q.toString());
> >> System.out.printf("MaxDocs: %s\n", _searcher.maxDoc()); TopDocs
> >> topDocs =3D _searcher.search(_q, 10); System.out.printf("Hit count:
> >> %s\n", topDocs.totalHits); for (int in =3D 0; in < =
topDocs.totalHits;
> >> in++) {
> >> =A0 =A0int docno =3D topDocs.scoreDocs[in].doc;
> >> =A0 =A0Document ldoc =3D _searcher.doc(docno);
> >> =A0 =A0System.out.printf("Docno: %s\n", docno);
> >> =A0 =A0for (Fieldable f : ldoc.getFields()) {
> >> System.out.printf("%s: /%s/, indexed: %s\n",
> >> =A0f.name(), f.stringValue(), f.isIndexed());
> >> =A0 =A0}
> >> }
> >> =A0 =A0}
> >> }
> >>
> >>
> >> --
> >> Ian.
> >>
> >>
> >> On Mon, Nov 8, 2010 at 4:32 AM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
> >>> Does the same happen with a MultiReader on top of both indexes and
> >>> using a single IndexSearcher on top of this MultiReader?
> >>>
> >>> P.S.: How about using NumericField?
> >>>
> >>> -----
> >>> Uwe Schindler
> >>> H.-H.-Meier-Allee 63, D-28213 Bremen http://www.thetaphi.de
> >>> eMail: uwe@thetaphi.de
> >>>
> >>>
> >>>> -----Original Message-----
> >>>> From: David Fertig [mailto:dfertig@cymfony.com]
> >>>> Sent: Monday, November 08, 2010 4:21 AM
> >>>> To: java-user@lucene.apache.org
> >>>> Subject: RE: Search returning documents matching a NOT range
> >>>>
> >>>> publish_date is a string, formatted as YYYYMMDD, so it string =
sorting
> >>> should
> >>>> work correctly for this field.
> >>>>
> >>>> The field is indexed as a keyword and the field's value is also
stored.
> >>>>
> >>>> I have previously reviewed the terms and optimized the index with
luke
> >>>> 1.0.1 to make sure there was no index corruption. It is a very =
useful
> >>> tool,
> >>>> however it can only open 1 index at a time so I can't reproduce =
the
issue
> >>> with
> >>>> it.
> >>>>
> >>>> At your suggestion I added code to enumerate all terms in the =
indexes
> and
> >>>> there are no inconsistencies.
> >>>>
> >>>> Th
> >>
> >>
> >
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47754-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 19:13:17 2010
Return-Path: <java-user-return-47754-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14926 invoked from network); 8 Nov 2010 19:13:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 19:13:17 -0000
Received: (qmail 8873 invoked by uid 500); 8 Nov 2010 19:13:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8827 invoked by uid 500); 8 Nov 2010 19:13:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8819 invoked by uid 99); 8 Nov 2010 19:13:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 19:13:46 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jafsnano@hotmail.com designates 65.55.90.105 as permitted sender)
Received: from [65.55.90.105] (HELO snt0-omc2-s30.snt0.hotmail.com) (65.55.90.105)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 19:13:37 +0000
Received: from SNT137-W57 ([65.55.90.71]) by snt0-omc2-s30.snt0.hotmail.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Mon, 8 Nov 2010 11:13:16 -0800
Message-ID: <SNT137-w575DFCDE79E87BDFC65DBCDF4F0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_06a9f859-524b-4057-98aa-0cfdbfe7ca22_"
X-Originating-IP: [201.130.143.206]
From: Juan Felix <jafsnano@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: solrj digest authentication
Date: Mon, 8 Nov 2010 13:13:17 -0600
Importance: Normal
MIME-Version: 1.0
X-OriginalArrivalTime: 08 Nov 2010 19:13:16.0933 (UTC) FILETIME=[FF7C4B50:01CB7F78]

--_06a9f859-524b-4057-98aa-0cfdbfe7ca22_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


Hi.

I'm trying to use solrj to add documents in solr with use digest authentica=
tion but it displays the following error:

org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpcl=
ient.
ProtocolException: Unbuffered entity enclosing request can not be repeated.
        at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(=
Commo
nsHttpSolrServer.java:469)
        at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(=
Commo
nsHttpSolrServer.java:243)
        at org.apache.solr.client.solrj.request.AbstractUpdateRequest.proce=
ss(Ab
stractUpdateRequest.java:105)
        at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:64)
        at org.apache.nutch.indexer.solr.TestSolr.main(TestSolr.java:18)
Caused by: org.apache.commons.httpclient.ProtocolException: Unbuffered enti=
ty en
closing request can not be repeated.
        at org.apache.commons.httpclient.methods.EntityEnclosingMethod.writ=
eRequ
estBody(EntityEnclosingMethod.java:487)
        at org.apache.commons.httpclient.HttpMethodBase.writeRequest(HttpMe=
thodB
ase.java:2114)
        at org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodB=
ase.j
ava:1096)
        at org.apache.commons.httpclient.HttpMethodDirector.executeWithRetr=
y(Htt
pMethodDirector.java:398)
        at org.apache.commons.httpclient.HttpMethodDirector.executeMethod(H=
ttpMe
thodDirector.java:171)
        at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClien=
t.jav
a:397)
        at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClien=
t.jav
a:323)
        at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(=
Commo
nsHttpSolrServer.java:416)
        ... 4 more

I already try the following but it didn't work: "httpclient.getParams().set=
AuthenticationPreemptive(true)=3B"

If some body has a solution to this please let me know. Because if not I wi=
ll need to use PostMethod instead of that and I will need to translate the =
SolrInputDocuments to xml also. This will be very intrusive for nutch.

Thanks
Juan
 		 	   		  =

--_06a9f859-524b-4057-98aa-0cfdbfe7ca22_--

From java-user-return-47755-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 20:25:15 2010
Return-Path: <java-user-return-47755-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56777 invoked from network); 8 Nov 2010 20:25:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 20:25:15 -0000
Received: (qmail 29840 invoked by uid 500); 8 Nov 2010 20:25:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29768 invoked by uid 500); 8 Nov 2010 20:25:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29760 invoked by uid 99); 8 Nov 2010 20:25:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 20:25:43 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of celsowm@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 20:25:36 +0000
Received: by ywp4 with SMTP id 4so4288023ywp.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 12:25:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=RXl6cPE3Cv/NHNiUytaOO7qHt0bgjahvDSI1HHKwMj8=;
        b=dKaFbmKfP9cd05GVBDUu6ONCp+xKpx0BpcfJVGZR7L3TKPuoRKcPy6zsD9oh6ioxCx
         zTWHCd0Zk0PbFCSR+MRq4G2YRIxNsU9TQiFsfemaBdkNUjpIx6iOkJmXUXecZmP7JUuu
         wRnouEv+1YNOHWkURfszbm5udN+86df+xcr4M=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=f2wZcsUSmLIN4mM55EDMeD5g4MK1LO/NT7MWLBYsKoATcvGcfaT3yn8dz8/tn+cLYx
         DXwh2kHfqF6MMxNweaIkFJYIhlYhIvUtojr+Wk9EslvfX6lO5louqZ4eKbiiAXly6Zpq
         Ix1QFGgiBGdgoIjRJNkTqevVB0qa9uR2QCJPk=
Received: by 10.216.143.163 with SMTP id l35mr5839292wej.68.1289247914333;
 Mon, 08 Nov 2010 12:25:14 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.221.28 with HTTP; Mon, 8 Nov 2010 12:24:54 -0800 (PST)
From: Celso Fontes <celsowm@gmail.com>
Date: Mon, 8 Nov 2010 17:24:54 -0300
Message-ID: <AANLkTinsH4QVKRdxyzWwXWf-Mnc74V6Ed7HSrWDrqdfj@mail.gmail.com>
Subject: ParseException (How escape a question?)
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

How escape a question like (version 3.0.2):

     "What is the role of Transforming growth factor-beta1 (TGF-beta1)
in cerebral amyloid angiopathy (CAA)?"

Exception in thread "main"
org.apache.lucene.queryParser.ParseException: Cannot parse 'What is
the role of Transforming growth factor-beta1 (TGF-beta1) in cerebral
amyloid angiopathy (CAA)?': '*' or '?' not allowed as first character
in WildcardQuery

thanks,
celso

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47756-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 21:05:24 2010
Return-Path: <java-user-return-47756-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80657 invoked from network); 8 Nov 2010 21:05:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 21:05:23 -0000
Received: (qmail 2135 invoked by uid 500); 8 Nov 2010 21:05:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2023 invoked by uid 500); 8 Nov 2010 21:05:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2015 invoked by uid 99); 8 Nov 2010 21:05:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 21:05:49 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 21:05:43 +0000
Received: by bwz9 with SMTP id 9so534973bwz.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 13:05:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=2pwfLl+ehfevrMeLjNhhU+v5q3utn6Vec9F6QZ7/V2o=;
        b=PPhWjBW2LTu6KtENio0XChRL8NEUg55KT4FLWOMUCkglvLqe9NW1rUa2bndP8gAazC
         Dk3y6gDh77JDEY5fXdOgfOUUnu5u2nkA162PvTmukjHpSV4kiDxKEoRSl0dLgw7h0bsl
         CvQb4NP4tu2PsxXM9S87I6+0KTzBC9EAbhj3g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=cy8R93CsJg+f9y3LeHSO4WAV5hM+cy5cLc6mKzJHhAmn8U1gpJjqjOQuTbNEawb4bZ
         gcdePTT/PgiMzb8UywjMexlET24Ien4Bh/UVVmdNTd3izwPM5HKX9wwIvFsw2IHEK+1R
         coiKUmNDVvpQzRBk+6gRNVTpXcHf5X+feTaB0=
Received: by 10.204.68.142 with SMTP id v14mr5415804bki.106.1289250322017;
 Mon, 08 Nov 2010 13:05:22 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Mon, 8 Nov 2010 13:05:01 -0800 (PST)
In-Reply-To: <AANLkTinsH4QVKRdxyzWwXWf-Mnc74V6Ed7HSrWDrqdfj@mail.gmail.com>
References: <AANLkTinsH4QVKRdxyzWwXWf-Mnc74V6Ed7HSrWDrqdfj@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 8 Nov 2010 21:05:01 +0000
Message-ID: <AANLkTik=TqSkLbfTz1_+3V0QV62-664dANrd6NJDHBHU@mail.gmail.com>
Subject: Re: ParseException (How escape a question?)
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

You can use QueryParser.escape(s) if you want to keep the ? and
brackets and whatever.  Or you could remove them.

One technique is to parse the query as supplied and catch the
ParseException, remove any special characters and resubmit the query.
See http://lucene.apache.org/java/3_0_2/queryparsersyntax.html#Escaping%20S=
pecial%20Characters
for a list of special characters.


--
Ian.

On Mon, Nov 8, 2010 at 8:24 PM, Celso Fontes <celsowm@gmail.com> wrote:
> How escape a question like (version 3.0.2):
>
> =A0 =A0 "What is the role of Transforming growth factor-beta1 (TGF-beta1)
> in cerebral amyloid angiopathy (CAA)?"
>
> Exception in thread "main"
> org.apache.lucene.queryParser.ParseException: Cannot parse 'What is
> the role of Transforming growth factor-beta1 (TGF-beta1) in cerebral
> amyloid angiopathy (CAA)?': '*' or '?' not allowed as first character
> in WildcardQuery
>
> thanks,
> celso
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47757-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 21:45:33 2010
Return-Path: <java-user-return-47757-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96315 invoked from network); 8 Nov 2010 21:45:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 21:45:33 -0000
Received: (qmail 62422 invoked by uid 500); 8 Nov 2010 21:46:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62362 invoked by uid 500); 8 Nov 2010 21:46:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62354 invoked by uid 99); 8 Nov 2010 21:46:02 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 21:46:02 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.42] (HELO mail-ww0-f42.google.com) (74.125.82.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 21:45:55 +0000
Received: by wwc33 with SMTP id 33so444268wwc.5
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 13:45:34 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.129.83 with SMTP id n19mr5999248wbs.33.1289252731769; Mon,
 08 Nov 2010 13:45:31 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Mon, 8 Nov 2010 13:45:31 -0800 (PST)
In-Reply-To: <1289218470994-1862280.post@n3.nabble.com>
References: <1289218470994-1862280.post@n3.nabble.com>
Date: Mon, 8 Nov 2010 16:45:31 -0500
Message-ID: <AANLkTi=yPPhQRGkJ5DDVr9C4QLSgTLMjFN8fueMjt=td@mail.gmail.com>
Subject: Re: high frequent terms in the search result set
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Maybe you can use the [very new] feature committed under this issue:

    https://issues.apache.org/jira/browse/LUCENE-2590

This lets you see which doc matched which terms from the query.

But, it hasn't be released yet (it'll be in 3.1 and 4.0).

Mike

On Mon, Nov 8, 2010 at 7:14 AM, starz10de <farag_ahmed@yahoo.com> wrote:
>
> Extract the high frequent terms in the search result set.
>
>
> I need to know how to extract the most frequent terms in the search resul=
t
> set after submitting the query.
>
> Here the class where you can use to extract the most frequent terms from =
the
> index:
>
> int j=3D0;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0int numTerms=3D5;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 TermEnum terms =3D r.terms();
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0TermDocs dok =3D r.termDocs();
>
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 TermInfoQueue tiq =3D new TermInfoQueue(n=
umTerms);
>
> =A0while (terms.next()) {
> =A0 =A0 =A0 =A0 =A0tiq.insert(new TermInfo(terms.term(), terms.docFreq())=
);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0while (tiq.size() > 0) {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0TermInfo termInfo =3D (Ter=
mInfo) tiq.pop();
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if(termInfo.docFreq>=3D70)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0{
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 System.out.println(termInfo.term.=
text() + " =A0 =A0 " +
> termInfo.docFreq);
>
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 j++;
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>
> Is there a way to apply this class only in the result of the search?
>
> Thanks in advance
>
> --
> View this message in context: http://lucene.472066.n3.nabble.com/high-fre=
quent-terms-in-the-search-result-set-tp1862280p1862280.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47758-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 08 22:55:34 2010
Return-Path: <java-user-return-47758-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27571 invoked from network); 8 Nov 2010 22:55:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 8 Nov 2010 22:55:33 -0000
Received: (qmail 56106 invoked by uid 500); 8 Nov 2010 22:56:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56057 invoked by uid 500); 8 Nov 2010 22:56:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56049 invoked by uid 99); 8 Nov 2010 22:56:02 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 22:56:02 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 08 Nov 2010 22:55:53 +0000
Received: by vws16 with SMTP id 16so671986vws.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 14:55:32 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=8J8bBELb0TgBa56+tCRhG4vRHm6ff3V7JB9/0W0Hrgg=;
        b=iRm7ZtufOduOx4YPiNtRShN4niDb/4ZNV7VORTEHhJDvt3ioo03uUCQrCOLF9QwViH
         V6ZdKIGPYDeVHyNkDN2TROKf5ae+INRF5evnS5vPTK11Mim6+Cr0cu2tusa4R2emx3i3
         Rs7db7i0JVmpBmYwF8rosYp/MccQMxR0LpXkU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=R61jDCRzyQDBZod3I0esLTllAvYrIekQVSouhUwbs47ygqZtOUnCWaMqb0oDwtCwMt
         ktzV4VmYC2I0bU5y/P8bG2ZKD4xJVcvtpNDdAnBBRS3q9/tv35lYD1BV1UhCMTyy3UqN
         /LVoes7t2Ey0T/zjGQ/Eg5Nzydxq9L/n6wrX8=
MIME-Version: 1.0
Received: by 10.224.193.194 with SMTP id dv2mr5007114qab.192.1289256931342;
 Mon, 08 Nov 2010 14:55:31 -0800 (PST)
Received: by 10.229.216.19 with HTTP; Mon, 8 Nov 2010 14:55:31 -0800 (PST)
In-Reply-To: <AANLkTikP7GyrpBZ=AubXAFkrUjqwuWwWKBavTCPQom1g@mail.gmail.com>
References: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
	<AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
	<AANLkTikP7GyrpBZ=AubXAFkrUjqwuWwWKBavTCPQom1g@mail.gmail.com>
Date: Mon, 8 Nov 2010 17:55:31 -0500
Message-ID: <AANLkTim03jcxnu1ZsOVZ+PezTL+QTZhJGWjdTDgvSXES@mail.gmail.com>
Subject: Re: Single filter instance with different searchers
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf300fb4636ab9c1049492857d
X-Virus-Checked: Checked by ClamAV on apache.org

--20cf300fb4636ab9c1049492857d
Content-Type: text/plain; charset=ISO-8859-1

Ignore my previous, I thought you were constructing your own filters. What
you're doing should
be OK.

Here's the source of my confusion.  Each of your indexes has Lucene document
IDs starting at
0. In your example, you have two docs/index. So, if you created a Filter via
lower-level
calls, it could not be applied across different indexes. See the discussion
here:
http://www.gossamer-threads.com/lists/lucene/java-user/106376. That is,
the bit in your Filter for index0, doc0 would be the same bit as in index1,
doc0.

But, that's not what you are doing. The (Parallel)MultiSearcher takes
care of mapping these doc IDs appropriately for you so you don't have to
worry about
what I was thinking about. Here's a program that illustrates this. It
creates
three RAMDirectories then  dumps the Lucene doc ID from each. Then it
creates
a multisearcher from the same three dirs and walks that, dumping the Lucene
doc ID.
You'll see that the doc IDs change even though the contents are the same....

Again, though, this isn't a problem because you are using a MultiSearcher,
which
takes care of this for you.

Which is yet another reason to never, never, never count on lucene doc IDs
outside their context!

Output at the end......

import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.Field;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.search.*;
import org.apache.lucene.store.Directory;
import org.apache.lucene.store.RAMDirectory;
import org.apache.lucene.util.Version;

import java.io.IOException;

import static org.apache.lucene.index.IndexWriter.*;

public class EoeTest {
    public static void main(String[] args) {
        EoeTest eoe = new EoeTest();
        eoe.doIt();
    }
    private void doIt() {
        try {
            populateIndexes();
            searchAndSpit();
            tryMulti();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    private Searcher getMulti() throws IOException {
        IndexSearcher[] searchers = new IndexSearcher[3];
        searchers[0] = new IndexSearcher(_ram1, true);
        searchers[1] = new IndexSearcher(_ram2, true);
        searchers[2] = new IndexSearcher(_ram3, true);
        return new MultiSearcher(searchers);
    }
    private void tryMulti() throws IOException {
        searchOne("multi ", getMulti());
    }

    private void searchAndSpit() throws IOException {
        searchOne("ram1", new IndexSearcher(_ram1, true));
        searchOne("ram2", new IndexSearcher(_ram2, true));
        searchOne("ram3", new IndexSearcher(_ram3, true));
    }
    private void searchOne(String which, Searcher is) throws IOException {
        log("dumping " + which);
        TopDocs hits = is.search(new MatchAllDocsQuery(), 100);
        for (int idx = 0; idx < hits.scoreDocs.length; ++idx) {
            ScoreDoc sd = hits.scoreDocs[idx];
            Document doc = is.doc(sd.doc);
            log(String.format("lid: %d, content: %s", sd.doc,
doc.get("content")));
        }
        is.close();
    }
    private void log(String msg) {
        System.out.println(msg);
    }
    private void populateIndexes() throws IOException {
        popOne(_ram1);
        popOne(_ram2);
        popOne(_ram3);
    }

    private void popOne(Directory dir) throws IOException {
        IndexWriter iw = new IndexWriter(dir, _std, MaxFieldLength.LIMITED);
        Document doc = new Document();
        doc.add(new Field("content", "common " +
Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
Field.TermVector.YES));
        iw.addDocument(doc);

        doc = new Document();
        doc.add(new Field("content", "common " +
Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
Field.TermVector.YES));
        iw.addDocument(doc);

        iw.close();
    }


    Directory _ram1 = new RAMDirectory();
    Directory _ram2 = new RAMDirectory();
    Directory _ram3 = new RAMDirectory();
    Analyzer _std = new StandardAnalyzer(Version.LUCENE_29);
}

************************************output****************
where lid: ### is the Lucene doc ID returned in scoreDocs
***********************************************************

dumping ram1
lid: 0, content: common 0.11100571422470962
lid: 1, content: common 0.31555863707233567
dumping ram2
lid: 0, content: common 0.01235509997022377
lid: 1, content: common 0.7017712652104814
dumping ram3
lid: 0, content: common 0.9472403989314128
lid: 1, content: common 0.7105628402082196
dumping multi
lid: 0, content: common 0.11100571422470962
lid: 1, content: common 0.31555863707233567
lid: 2, content: common 0.01235509997022377
lid: 3, content: common 0.7017712652104814
lid: 4, content: common 0.9472403989314128
lid: 5, content: common 0.7105628402082196




On Mon, Nov 8, 2010 at 3:33 AM, Samarendra Pratap <samarzone@gmail.com>wrote:

> Hi Erick, Thanks for the reply.
>  Your answer have puzzled me more because what I am able to view is not
> what you say or I am not able to grasp your meaning.
>  I have written a small program which is exactly what my original question
> was. Here I am creating a CachingWrapperFilter on one index and reusing it
> on other indexes. This single filter gives me results as expected from each
> of the index. I will appreciate if you can throw some light.
>
> I have given the output after the program ends
>
>
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> // following program is compiled with java6
>
> import org.apache.lucene.index.*;
> import org.apache.lucene.analysis.*;
> import org.apache.lucene.analysis.standard.*;
> import org.apache.lucene.search.*;
> import org.apache.lucene.search.spans.*;
> import org.apache.lucene.store.*;
> import org.apache.lucene.document.*;
> import org.apache.lucene.queryParser.*;
> import org.apache.lucene.util.*;
>
> import java.util.*;
>
> public class FilterTest
> {
> protected Directory[] dirs;
>  protected Analyzer a;
> protected Searcher[] searchers;
> protected QueryParser qp;
>  protected Filter f;
> protected Hashtable<String, Filter> filters;
>
>  public FilterTest()
> {
> // create analyzer
>  a = new StandardAnalyzer(Version.LUCENE_29);
> // create query parser
> qp = new QueryParser(Version.LUCENE_29, "content", a);
>  // initialize "filters" Hashtable
> filters = new Hashtable<String, Filter>();
>  }
>
> protected void createDirectories(int length)
> {
>  // create specified number of RAM directories
> dirs = new Directory[length];
>  for(int i=0;i<length;i++)
> dirs[i] = new RAMDirectory();
> }
>
> protected void createIndexes() throws Exception
> {
> /* create indexes for each directory.
>  each index contains two documents.
> every document contains one term, unique across all indexes, one term
> unique across single index and one term common to all indexes
>  */
> for(int i=0;i<dirs.length;i++)
> {
>  IndexWriter iw = new IndexWriter(dirs[i], a, true,
> IndexWriter.MaxFieldLength.LIMITED);
>
> Document d = new Document();
>  // unique id across all indexes
> d.add(new Field("id", ""+(i*2+1), Field.Store.YES,
> Field.Index.NOT_ANALYZED, Field.TermVector.YES));
>  // unique id in a single indexes
> d.add(new Field("docnumber", "1", Field.Store.YES,
> Field.Index.NOT_ANALYZED, Field.TermVector.YES));
>  // common word in all indexes
> d.add(new Field("content", "common", Field.Store.YES, Field.Index.ANALYZED,
> Field.TermVector.YES));
>  iw.addDocument(d);
>
> d = new Document();
> // unique id across all indexes
>  d.add(new Field("id", ""+(i*2+2), Field.Store.YES,
> Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> // unique id in a single indexes
>  d.add(new Field("docnumber", "2", Field.Store.YES,
> Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> // common word in all indexes
>  d.add(new Field("content", "common", Field.Store.YES,
> Field.Index.ANALYZED, Field.TermVector.YES));
> iw.addDocument(d);
>
> iw.close();
> }
> }
>
> protected void openSearchers() throws Exception
> {
> // open searches for every directory and save it in an array
>  searchers = new Searcher[dirs.length];
> for(int i=0;i<dirs.length;i++)
>  searchers[i] = new IndexSearcher(IndexReader.open(dirs[i], true));
> }
>
>  protected Searcher getSearcher(int[] arr) throws Exception
> {
> // provides a ParallelMultiSearcher instance with the searchers lying at
> index positions provided in the argument
>  Searcher[] s = new Searcher[arr.length];
> for(int i=0;i<arr.length;i++)
>  s[i] = this.searchers[arr[i]];
>
> return new ParallelMultiSearcher(s);
>  }
>
> protected ScoreDoc[] search(String query, String filter, Searcher s) throws
> Exception
>  {
> Filter f = null;
> if(filter != null)
>  {
> if(filters.containsKey(filter))
> {
>  System.out.println("Reusing filter for - " + filter);
> f = filters.get(filter);
>  }
> else
> {
>  System.out.println("Creating new filter for - " + filter);
> f = new CachingWrapperFilter(new QueryWrapperFilter(qp.parse(filter)));
>  filters.put(filter, f);
> }
> }
>  System.out.println("Query:("+query+"), Filter:("+filter+")");
> return s.search(qp.parse(query), f, 1000).scoreDocs;
>  }
>
> public static void main(String[] args) throws Exception
>  {
>  FilterTest ft = new FilterTest();
> ft.startTest();
> }
>
> public void startTest()
> {
> try
>  {
> Query q;
>
> createDirectories(3);
>  createIndexes();
> openSearchers();
> Searcher s;
>  ScoreDoc[] sd;
>
> System.out.println("===================================");
>  System.out.println("Fields of all the documents");
> // creating searcher for all indexes
>  s = getSearcher(new int[]{0,1,2});
> // search all documents and their ids
>  sd = search("+content:common", null, s);
> for(int i=0;i<sd.length;i++)
>  {
> System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> docnumber:"+s.doc(sd[i].doc).get("docnumber"));
>  }
> System.out.println("\n\n");
>
> System.out.println("===================================");
>  System.out.println("Searching for documents in a single index. Filter
> will be created and cached");
> s = getSearcher(new int[]{0});
>  sd = search("+content:common", "docnumber:1", s);
> System.out.println("Hits:"+sd.length);
>  for(int i=0;i<sd.length;i++)
> {
> System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> docnumber:"+s.doc(sd[i].doc).get("docnumber"));
>  }
> System.out.println("\n\n");
>
> System.out.println("===================================");
>  System.out.println("Searching for documents in a other indexes other than
> previous search. Query and filter will be same. Filter will be reused");
>  s = getSearcher(new int[]{1,2});
> sd = search("+content:common", "docnumber:1", s);
>  System.out.println("Hits:"+sd.length);
> for(int i=0;i<sd.length;i++)
>  {
> System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> docnumber:"+s.doc(sd[i].doc).get("docnumber"));
>  }
>
> }
> catch(Exception e)
>  {
> e.printStackTrace();
> }
>  }
> }
>
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> OUTPUT:
> [samar@myserver java]$ java FilterTest
> ===================================
> Fields of all the documents
> Query:(+content:common), Filter:(null)
>         id:1, docid:1
>         id:2, docid:2
>         id:3, docid:1
>         id:4, docid:2
>         id:5, docid:1
>         id:6, docid:2
>
>
>
> ===================================
> Searching for documents in a single index. Filter will be created and
> cached
> Creating new filter for - docid:1
> Query:(+content:common), Filter:(docid:1)
> Hits:1
>         id:1, docid:1
>
>
>
> ===================================
> Searching for documents in indexes other than previous search. Query and
> filter will be same. Filter will be reused
> Reusing filter for - docid:1
> Query:(+content:common), Filter:(docid:1)
> Hits:2
>         id:3, docid:1
>         id:5, docid:1
>
>
>
>
>
>
>
>
>
>
> On Wed, Nov 3, 2010 at 7:04 PM, Erick Erickson <erickerickson@gmail.com>wrote:
>
>> I'm assuming you're down in Lucene land. Unless somehow you've
>> gotten 63 separate filters when you think you only have one, I don't
>> think what you're doing will work. Or I'm failing to understand what
>> you're doing at all.
>>
>> The problem is I expect each of your indexes starts with document
>> 1. So your Filter is really a bit set keyed by Lucene document ID.
>>
>> So applying filter 2 to index 54 will NOT do what you want. What I
>> suspect you're seeing is that applying your filter is producing enough
>> results from index 54 (to continue my example) to fool you into
>> thinking it's working.
>>
>> Try running the query with and without the filter on each of your indexes,
>> perhaps as a control including a restrictive clause in the query
>> to do the same thing your filter is doing. Or construct the filter new
>> for comparison.... If the numbers continue to be the same, I clearly
>> don't understand something! <G>....
>>
>> Best
>> Erick
>>
>> On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap <samarzone@gmail.com
>> >wrote:
>>
>> > Hi. We have a large index (~ 28 GB) which is distributed in three
>> different
>> > directories, each representing a country. Each of these country wise
>> > indexes
>> > is further distributed on the basis of last update date into 21 smaller
>> > indexes. This index is updated once in a day.
>> >
>> > A user can search into any of one country and can choose last update
>> date
>> > plus some other criteria.
>> >
>> > When the server application starts, index readers and hence searchers
>> are
>> > created for each of the small indexes (21 x 3) and put in an array.
>> > Depending on the option (country and last update date) chosen by user we
>> > pick the searchers of correct date range/country and create a new
>> > ParallelMultiSearcher instance.
>> >
>> > Now my question is - can I use single filter (caching filter) instance
>> for
>> > every search (may be on different searchers)?
>> >
>> >
>> ===================================================================================
>> >
>> > e.g
>> > for first search i create an filter of experience 4 years and save it.
>> >
>> > if another search for a different country (and hence difference index)
>> also
>> > has same experience criteria, i.e. 4 years, can i use the same filter
>> > instance for second search too?
>> >
>> > i have tested a little for this and surprisingly i have got correct
>> > results.
>> > i was wondering if this is the correct way. or do i need to create
>> > different
>> > filters for each searcher (or index reader) instance?
>> >
>> > Thanks in advance.
>> >
>> > --
>> > Regards,
>> > Samar
>> >
>>
>
>
>
> --
> Regards,
> Samar
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--20cf300fb4636ab9c1049492857d--

From java-user-return-47759-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 09 07:49:04 2010
Return-Path: <java-user-return-47759-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59785 invoked from network); 9 Nov 2010 07:49:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Nov 2010 07:49:04 -0000
Received: (qmail 2656 invoked by uid 500); 9 Nov 2010 07:49:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2332 invoked by uid 500); 9 Nov 2010 07:49:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2324 invoked by uid 99); 9 Nov 2010 07:49:28 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 07:49:28 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 07:49:23 +0000
Received: by iwn7 with SMTP id 7so7501383iwn.35
        for <java-user@lucene.apache.org>; Mon, 08 Nov 2010 23:49:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=qeVEQM2u2MW/OSIxqiHXv9s761EalvXuuuFchTKmw/0=;
        b=V3QlFupRlpRdGCg3/SbEBt/W5fnVtWHA6IXS4m8f5trKdwrJp5SZQFIHjiiQbVTvPB
         WmLvwDgFGeUPS+hcuHjq5OVP7bZLbN2XSmJapkJ3R0L5G547Lc+hChsmSzsk5el5TM5m
         wUeN/J7D6cNNnXTQtDEgLKAmupvRl0MD3aahA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=WTdhaUpQ+H45MPDG4PXcGnbr9yVHiodiK2YCswhZ/X+77tJK71tdY3omrqKraCpkRF
         mKNEzKKV29zfLu7pYdlVV3qCRsT2OWWKsbUYyblqLxhVIX6v8sq9HVM1g/Fb5tK3aKj3
         bOe4jLFwBqDwKiq0g2pmZZAPOcv+0lxA2qrJ0=
Received: by 10.231.169.199 with SMTP id a7mr2571656ibz.5.1289288941019; Mon,
 08 Nov 2010 23:49:01 -0800 (PST)
MIME-Version: 1.0
Received: by 10.231.32.66 with HTTP; Mon, 8 Nov 2010 23:48:45 -0800 (PST)
In-Reply-To: <AANLkTim03jcxnu1ZsOVZ+PezTL+QTZhJGWjdTDgvSXES@mail.gmail.com>
References: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
 <AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
 <AANLkTikP7GyrpBZ=AubXAFkrUjqwuWwWKBavTCPQom1g@mail.gmail.com> <AANLkTim03jcxnu1ZsOVZ+PezTL+QTZhJGWjdTDgvSXES@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Tue, 9 Nov 2010 13:18:45 +0530
Message-ID: <AANLkTikbwX3sv5sGxNFcyPunkNFjH8kBPhoycWmwUsAh@mail.gmail.com>
Subject: Re: Single filter instance with different searchers
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636d34dc457a29f049499f984

--001636d34dc457a29f049499f984
Content-Type: text/plain; charset=ISO-8859-1

Thanks Erick, you cleared some of my confusions. But I still have a doubt.

 As you can see in previous example code I am re-creating parallel multi
searcher for each search. (This is the actual scenario on production
servers)
The ParallelMultiSearcher constructor is taking different combination of
searchers each time. It means that the same document may be assigned a
different docid for next search.

So my primary question is - Will the cached results from a filter created
with one multi searcher, work fine with another multi searcher? (Underlying
IndexSearchers are opened only once. It is combination of IndexSearchers
which is varying for each search.)

 I have tested it with my real code and sample indexes and it gives me a
feeling that results are correct, but I am not able to understand how, given
my above confusion.

Can you suggest me a something with another curiosity - Which option will be
more efficient - 1. MultiSearchers  (either recreating for each search or
reusing cached ones) with different searchers or 2. having a single index
for all last update date criteria and using filters for different
combinations of last update dates.
 As I wrote in my previous mail we have different physical indexes based on
different ranges of update dates. We select appropriate indexes based on the
user selected options.

On Tue, Nov 9, 2010 at 4:25 AM, Erick Erickson <erickerickson@gmail.com>wrote:

> Ignore my previous, I thought you were constructing your own filters. What
> you're doing should
> be OK.
>
> Here's the source of my confusion.  Each of your indexes has Lucene
> document
> IDs starting at
> 0. In your example, you have two docs/index. So, if you created a Filter
> via
> lower-level
> calls, it could not be applied across different indexes. See the discussion
> here:
> http://www.gossamer-threads.com/lists/lucene/java-user/106376. That is,
> the bit in your Filter for index0, doc0 would be the same bit as in index1,
> doc0.
>
> But, that's not what you are doing. The (Parallel)MultiSearcher takes
> care of mapping these doc IDs appropriately for you so you don't have to
> worry about
> what I was thinking about. Here's a program that illustrates this. It
> creates
> three RAMDirectories then  dumps the Lucene doc ID from each. Then it
> creates
> a multisearcher from the same three dirs and walks that, dumping the Lucene
> doc ID.
> You'll see that the doc IDs change even though the contents are the
> same....
>
> Again, though, this isn't a problem because you are using a MultiSearcher,
> which
> takes care of this for you.
>
> Which is yet another reason to never, never, never count on lucene doc IDs
> outside their context!
>
> Output at the end......
>
> import org.apache.lucene.analysis.Analyzer;
> import org.apache.lucene.analysis.standard.StandardAnalyzer;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.document.Field;
> import org.apache.lucene.index.IndexWriter;
> import org.apache.lucene.search.*;
> import org.apache.lucene.store.Directory;
> import org.apache.lucene.store.RAMDirectory;
> import org.apache.lucene.util.Version;
>
> import java.io.IOException;
>
> import static org.apache.lucene.index.IndexWriter.*;
>
> public class EoeTest {
>    public static void main(String[] args) {
>        EoeTest eoe = new EoeTest();
>        eoe.doIt();
>    }
>    private void doIt() {
>        try {
>            populateIndexes();
>            searchAndSpit();
>            tryMulti();
>         } catch (Exception e) {
>            e.printStackTrace();
>        }
>
>    }
>
>     private Searcher getMulti() throws IOException {
>        IndexSearcher[] searchers = new IndexSearcher[3];
>        searchers[0] = new IndexSearcher(_ram1, true);
>        searchers[1] = new IndexSearcher(_ram2, true);
>        searchers[2] = new IndexSearcher(_ram3, true);
>        return new MultiSearcher(searchers);
>    }
>    private void tryMulti() throws IOException {
>        searchOne("multi ", getMulti());
>    }
>
>    private void searchAndSpit() throws IOException {
>        searchOne("ram1", new IndexSearcher(_ram1, true));
>        searchOne("ram2", new IndexSearcher(_ram2, true));
>        searchOne("ram3", new IndexSearcher(_ram3, true));
>    }
>    private void searchOne(String which, Searcher is) throws IOException {
>        log("dumping " + which);
>        TopDocs hits = is.search(new MatchAllDocsQuery(), 100);
>        for (int idx = 0; idx < hits.scoreDocs.length; ++idx) {
>            ScoreDoc sd = hits.scoreDocs[idx];
>            Document doc = is.doc(sd.doc);
>            log(String.format("lid: %d, content: %s", sd.doc,
> doc.get("content")));
>        }
>        is.close();
>    }
>    private void log(String msg) {
>        System.out.println(msg);
>    }
>    private void populateIndexes() throws IOException {
>        popOne(_ram1);
>        popOne(_ram2);
>        popOne(_ram3);
>    }
>
>    private void popOne(Directory dir) throws IOException {
>        IndexWriter iw = new IndexWriter(dir, _std, MaxFieldLength.LIMITED);
>        Document doc = new Document();
>        doc.add(new Field("content", "common " +
> Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
> Field.TermVector.YES));
>        iw.addDocument(doc);
>
>        doc = new Document();
>        doc.add(new Field("content", "common " +
> Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
> Field.TermVector.YES));
>        iw.addDocument(doc);
>
>        iw.close();
>    }
>
>
>    Directory _ram1 = new RAMDirectory();
>    Directory _ram2 = new RAMDirectory();
>    Directory _ram3 = new RAMDirectory();
>    Analyzer _std = new StandardAnalyzer(Version.LUCENE_29);
> }
>
> ************************************output****************
> where lid: ### is the Lucene doc ID returned in scoreDocs
> ***********************************************************
>
> dumping ram1
> lid: 0, content: common 0.11100571422470962
> lid: 1, content: common 0.31555863707233567
> dumping ram2
> lid: 0, content: common 0.01235509997022377
> lid: 1, content: common 0.7017712652104814
> dumping ram3
> lid: 0, content: common 0.9472403989314128
> lid: 1, content: common 0.7105628402082196
> dumping multi
> lid: 0, content: common 0.11100571422470962
> lid: 1, content: common 0.31555863707233567
> lid: 2, content: common 0.01235509997022377
> lid: 3, content: common 0.7017712652104814
> lid: 4, content: common 0.9472403989314128
> lid: 5, content: common 0.7105628402082196
>
>
>
>
> On Mon, Nov 8, 2010 at 3:33 AM, Samarendra Pratap <samarzone@gmail.com
> >wrote:
>
> > Hi Erick, Thanks for the reply.
> >  Your answer have puzzled me more because what I am able to view is not
> > what you say or I am not able to grasp your meaning.
> >  I have written a small program which is exactly what my original
> question
> > was. Here I am creating a CachingWrapperFilter on one index and reusing
> it
> > on other indexes. This single filter gives me results as expected from
> each
> > of the index. I will appreciate if you can throw some light.
> >
> > I have given the output after the program ends
> >
> >
> >
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> > // following program is compiled with java6
> >
> > import org.apache.lucene.index.*;
> > import org.apache.lucene.analysis.*;
> > import org.apache.lucene.analysis.standard.*;
> > import org.apache.lucene.search.*;
> > import org.apache.lucene.search.spans.*;
> > import org.apache.lucene.store.*;
> > import org.apache.lucene.document.*;
> > import org.apache.lucene.queryParser.*;
> > import org.apache.lucene.util.*;
> >
> > import java.util.*;
> >
> > public class FilterTest
> > {
> > protected Directory[] dirs;
> >  protected Analyzer a;
> > protected Searcher[] searchers;
> > protected QueryParser qp;
> >  protected Filter f;
> > protected Hashtable<String, Filter> filters;
> >
> >  public FilterTest()
> > {
> > // create analyzer
> >  a = new StandardAnalyzer(Version.LUCENE_29);
> > // create query parser
> > qp = new QueryParser(Version.LUCENE_29, "content", a);
> >  // initialize "filters" Hashtable
> > filters = new Hashtable<String, Filter>();
> >  }
> >
> > protected void createDirectories(int length)
> > {
> >  // create specified number of RAM directories
> > dirs = new Directory[length];
> >  for(int i=0;i<length;i++)
> > dirs[i] = new RAMDirectory();
> > }
> >
> > protected void createIndexes() throws Exception
> > {
> > /* create indexes for each directory.
> >  each index contains two documents.
> > every document contains one term, unique across all indexes, one term
> > unique across single index and one term common to all indexes
> >  */
> > for(int i=0;i<dirs.length;i++)
> > {
> >  IndexWriter iw = new IndexWriter(dirs[i], a, true,
> > IndexWriter.MaxFieldLength.LIMITED);
> >
> > Document d = new Document();
> >  // unique id across all indexes
> > d.add(new Field("id", ""+(i*2+1), Field.Store.YES,
> > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> >  // unique id in a single indexes
> > d.add(new Field("docnumber", "1", Field.Store.YES,
> > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> >  // common word in all indexes
> > d.add(new Field("content", "common", Field.Store.YES,
> Field.Index.ANALYZED,
> > Field.TermVector.YES));
> >  iw.addDocument(d);
> >
> > d = new Document();
> > // unique id across all indexes
> >  d.add(new Field("id", ""+(i*2+2), Field.Store.YES,
> > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > // unique id in a single indexes
> >  d.add(new Field("docnumber", "2", Field.Store.YES,
> > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > // common word in all indexes
> >  d.add(new Field("content", "common", Field.Store.YES,
> > Field.Index.ANALYZED, Field.TermVector.YES));
> > iw.addDocument(d);
> >
> > iw.close();
> > }
> > }
> >
> > protected void openSearchers() throws Exception
> > {
> > // open searches for every directory and save it in an array
> >  searchers = new Searcher[dirs.length];
> > for(int i=0;i<dirs.length;i++)
> >  searchers[i] = new IndexSearcher(IndexReader.open(dirs[i], true));
> > }
> >
> >  protected Searcher getSearcher(int[] arr) throws Exception
> > {
> > // provides a ParallelMultiSearcher instance with the searchers lying at
> > index positions provided in the argument
> >  Searcher[] s = new Searcher[arr.length];
> > for(int i=0;i<arr.length;i++)
> >  s[i] = this.searchers[arr[i]];
> >
> > return new ParallelMultiSearcher(s);
> >  }
> >
> > protected ScoreDoc[] search(String query, String filter, Searcher s)
> throws
> > Exception
> >  {
> > Filter f = null;
> > if(filter != null)
> >  {
> > if(filters.containsKey(filter))
> > {
> >  System.out.println("Reusing filter for - " + filter);
> > f = filters.get(filter);
> >  }
> > else
> > {
> >  System.out.println("Creating new filter for - " + filter);
> > f = new CachingWrapperFilter(new QueryWrapperFilter(qp.parse(filter)));
> >  filters.put(filter, f);
> > }
> > }
> >  System.out.println("Query:("+query+"), Filter:("+filter+")");
> > return s.search(qp.parse(query), f, 1000).scoreDocs;
> >  }
> >
> > public static void main(String[] args) throws Exception
> >  {
> >  FilterTest ft = new FilterTest();
> > ft.startTest();
> > }
> >
> > public void startTest()
> > {
> > try
> >  {
> > Query q;
> >
> > createDirectories(3);
> >  createIndexes();
> > openSearchers();
> > Searcher s;
> >  ScoreDoc[] sd;
> >
> > System.out.println("===================================");
> >  System.out.println("Fields of all the documents");
> > // creating searcher for all indexes
> >  s = getSearcher(new int[]{0,1,2});
> > // search all documents and their ids
> >  sd = search("+content:common", null, s);
> > for(int i=0;i<sd.length;i++)
> >  {
> > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> >  }
> > System.out.println("\n\n");
> >
> > System.out.println("===================================");
> >  System.out.println("Searching for documents in a single index. Filter
> > will be created and cached");
> > s = getSearcher(new int[]{0});
> >  sd = search("+content:common", "docnumber:1", s);
> > System.out.println("Hits:"+sd.length);
> >  for(int i=0;i<sd.length;i++)
> > {
> > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> >  }
> > System.out.println("\n\n");
> >
> > System.out.println("===================================");
> >  System.out.println("Searching for documents in a other indexes other
> than
> > previous search. Query and filter will be same. Filter will be reused");
> >  s = getSearcher(new int[]{1,2});
> > sd = search("+content:common", "docnumber:1", s);
> >  System.out.println("Hits:"+sd.length);
> > for(int i=0;i<sd.length;i++)
> >  {
> > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> >  }
> >
> > }
> > catch(Exception e)
> >  {
> > e.printStackTrace();
> > }
> >  }
> > }
> >
> >
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> > OUTPUT:
> > [samar@myserver java]$ java FilterTest
> > ===================================
> > Fields of all the documents
> > Query:(+content:common), Filter:(null)
> >         id:1, docid:1
> >         id:2, docid:2
> >         id:3, docid:1
> >         id:4, docid:2
> >         id:5, docid:1
> >         id:6, docid:2
> >
> >
> >
> > ===================================
> > Searching for documents in a single index. Filter will be created and
> > cached
> > Creating new filter for - docid:1
> > Query:(+content:common), Filter:(docid:1)
> > Hits:1
> >         id:1, docid:1
> >
> >
> >
> > ===================================
> > Searching for documents in indexes other than previous search. Query and
> > filter will be same. Filter will be reused
> > Reusing filter for - docid:1
> > Query:(+content:common), Filter:(docid:1)
> > Hits:2
> >         id:3, docid:1
> >         id:5, docid:1
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > On Wed, Nov 3, 2010 at 7:04 PM, Erick Erickson <erickerickson@gmail.com
> >wrote:
> >
> >> I'm assuming you're down in Lucene land. Unless somehow you've
> >> gotten 63 separate filters when you think you only have one, I don't
> >> think what you're doing will work. Or I'm failing to understand what
> >> you're doing at all.
> >>
> >> The problem is I expect each of your indexes starts with document
> >> 1. So your Filter is really a bit set keyed by Lucene document ID.
> >>
> >> So applying filter 2 to index 54 will NOT do what you want. What I
> >> suspect you're seeing is that applying your filter is producing enough
> >> results from index 54 (to continue my example) to fool you into
> >> thinking it's working.
> >>
> >> Try running the query with and without the filter on each of your
> indexes,
> >> perhaps as a control including a restrictive clause in the query
> >> to do the same thing your filter is doing. Or construct the filter new
> >> for comparison.... If the numbers continue to be the same, I clearly
> >> don't understand something! <G>....
> >>
> >> Best
> >> Erick
> >>
> >> On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap <samarzone@gmail.com
> >> >wrote:
> >>
> >> > Hi. We have a large index (~ 28 GB) which is distributed in three
> >> different
> >> > directories, each representing a country. Each of these country wise
> >> > indexes
> >> > is further distributed on the basis of last update date into 21
> smaller
> >> > indexes. This index is updated once in a day.
> >> >
> >> > A user can search into any of one country and can choose last update
> >> date
> >> > plus some other criteria.
> >> >
> >> > When the server application starts, index readers and hence searchers
> >> are
> >> > created for each of the small indexes (21 x 3) and put in an array.
> >> > Depending on the option (country and last update date) chosen by user
> we
> >> > pick the searchers of correct date range/country and create a new
> >> > ParallelMultiSearcher instance.
> >> >
> >> > Now my question is - can I use single filter (caching filter) instance
> >> for
> >> > every search (may be on different searchers)?
> >> >
> >> >
> >>
> ===================================================================================
> >> >
> >> > e.g
> >> > for first search i create an filter of experience 4 years and save it.
> >> >
> >> > if another search for a different country (and hence difference index)
> >> also
> >> > has same experience criteria, i.e. 4 years, can i use the same filter
> >> > instance for second search too?
> >> >
> >> > i have tested a little for this and surprisingly i have got correct
> >> > results.
> >> > i was wondering if this is the correct way. or do i need to create
> >> > different
> >> > filters for each searcher (or index reader) instance?
> >> >
> >> > Thanks in advance.
> >> >
> >> > --
> >> > Regards,
> >> > Samar
> >> >
> >>
> >
> >
> >
> > --
> > Regards,
> > Samar
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>



-- 
Regards,
Samar

--001636d34dc457a29f049499f984--

From java-user-return-47760-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 09 10:47:07 2010
Return-Path: <java-user-return-47760-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42416 invoked from network); 9 Nov 2010 10:47:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Nov 2010 10:47:06 -0000
Received: (qmail 14242 invoked by uid 500); 9 Nov 2010 10:47:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13881 invoked by uid 500); 9 Nov 2010 10:47:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13866 invoked by uid 99); 9 Nov 2010 10:47:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 10:47:31 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 10:47:23 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id DAC6131547
	for <java-user@lucene.apache.org>; Tue,  9 Nov 2010 11:47:00 +0100 (CET)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id BA3FD31491
	for <java-user@lucene.apache.org>; Tue,  9 Nov 2010 11:47:00 +0100 (CET)
Received: from [192.168.2.2] (vpn-int.sb.dfki.de [134.96.191.230])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id 9436031109
	for <java-user@lucene.apache.org>; Tue,  9 Nov 2010 11:47:00 +0100 (CET)
From: Paul Libbrecht <paul@activemath.org>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Subject: Lucene index exchange format?
Date: Tue, 9 Nov 2010 11:46:59 +0100
Message-Id: <7AAF0F73-3FF9-48D6-94B7-124B4AD82129@activemath.org>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1081)
X-Mailer: Apple Mail (2.1081)

hello list,

more and more I seem to encounter situations where the delivery of a =
prebuilt lucene index is desirable.

The binary format probably works (experience hints would be welcome) but =
I fear it would be fragile with versioning (it certainly fails at =
version-downgrading).

Did anyone work on a lucene import-export format? Something like XML =
that would load fairly fast provided I/O goes fast?

thanks in advance

paul=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47761-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 09 11:50:53 2010
Return-Path: <java-user-return-47761-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72741 invoked from network); 9 Nov 2010 11:50:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Nov 2010 11:50:53 -0000
Received: (qmail 85941 invoked by uid 500); 9 Nov 2010 11:51:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85604 invoked by uid 500); 9 Nov 2010 11:51:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85591 invoked by uid 99); 9 Nov 2010 11:51:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 11:51:17 +0000
X-ASF-Spam-Status: No, hits=3.0 required=10.0
	tests=FORGED_YAHOO_RCVD,FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 11:51:11 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <farag_ahmed@yahoo.com>)
	id 1PFmiw-0004Lu-5F
	for java-user@lucene.apache.org; Tue, 09 Nov 2010 03:50:50 -0800
Date: Tue, 9 Nov 2010 03:50:50 -0800 (PST)
From: starz10de <farag_ahmed@yahoo.com>
To: java-user@lucene.apache.org
Message-ID: <1289303450155-1868347.post@n3.nabble.com>
In-Reply-To: <AANLkTi=yPPhQRGkJ5DDVr9C4QLSgTLMjFN8fueMjt=td@mail.gmail.com>
References: <1289218470994-1862280.post@n3.nabble.com> <AANLkTi=yPPhQRGkJ5DDVr9C4QLSgTLMjFN8fueMjt=td@mail.gmail.com>
Subject: Re: high frequent terms in the search result set
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org


Thanks for the answer. My request is might easier.=20

I will describe it in basic way:

1- I submit a query
2- I retrieve the matched documents
3- From this matched document I need to =C2=B4have a list of terms based on=
 their
high co-occurrence.

Currently I could do this for the whole index but I still can=E2=80=99t for=
 the
matched documents. What I do is to index the matched documents but this is
very slow and not applicable.


--=20
View this message in context: http://lucene.472066.n3.nabble.com/high-frequ=
ent-terms-in-the-search-result-set-tp1862280p1868347.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47762-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 09 12:09:00 2010
Return-Path: <java-user-return-47762-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87749 invoked from network); 9 Nov 2010 12:09:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Nov 2010 12:09:00 -0000
Received: (qmail 1559 invoked by uid 500); 9 Nov 2010 12:09:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1190 invoked by uid 500); 9 Nov 2010 12:09:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1177 invoked by uid 99); 9 Nov 2010 12:09:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 12:09:23 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=
X-Spam-Check-By: apache.org
Received: from [140.211.11.9] (HELO minotaur.apache.org) (140.211.11.9)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 09 Nov 2010 12:09:23 +0000
Received: (qmail 87680 invoked by uid 99); 9 Nov 2010 12:08:31 -0000
Received: from localhost.apache.org (HELO [10.0.0.77]) (127.0.0.1)
  (smtp-auth username gsingers, mechanism plain)
  by minotaur.apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 12:08:31 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1081)
Subject: Re: Lucene index exchange format?
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <7AAF0F73-3FF9-48D6-94B7-124B4AD82129@activemath.org>
Date: Tue, 9 Nov 2010 07:08:58 -0500
Content-Transfer-Encoding: quoted-printable
Message-Id: <CDAEF480-377A-48DA-A0CD-28421A1027E7@apache.org>
References: <7AAF0F73-3FF9-48D6-94B7-124B4AD82129@activemath.org>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1081)

You can do this in trunk right now using the Codec capability.  In fact, =
there is a text version already, but it is likely to be really slow on =
anything significant.  You could likely produce something that is faster =
but still readable.

On Nov 9, 2010, at 5:46 AM, Paul Libbrecht wrote:

> hello list,
>=20
> more and more I seem to encounter situations where the delivery of a =
prebuilt lucene index is desirable.
>=20
> The binary format probably works (experience hints would be welcome) =
but I fear it would be fragile with versioning (it certainly fails at =
version-downgrading).
>=20
> Did anyone work on a lucene import-export format? Something like XML =
that would load fairly fast provided I/O goes fast?
>=20
> thanks in advance
>=20
> paul
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20

--------------------------
Grant Ingersoll
http://www.lucidimagination.com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47763-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 09 17:57:27 2010
Return-Path: <java-user-return-47763-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17483 invoked from network); 9 Nov 2010 17:57:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Nov 2010 17:57:27 -0000
Received: (qmail 99783 invoked by uid 500); 9 Nov 2010 17:57:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99735 invoked by uid 500); 9 Nov 2010 17:57:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99722 invoked by uid 99); 9 Nov 2010 17:57:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 17:57:55 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 17:57:49 +0000
Received: by qwk3 with SMTP id 3so5002247qwk.35
        for <java-user@lucene.apache.org>; Tue, 09 Nov 2010 09:57:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Ziu3bPRgUrG4XFN8wlPusdMYtRB/R6A4Ldpgs66uLy4=;
        b=JL04zX+TA+s98vovjCYwpzpKZJ4VEhXNZ4jaXFNB+AgFRVLAlerenW38CeVUqIMgXN
         Pnu9nMIGX7OwXdMifhkHF4+sBu4Te5IshyL5RIbi9bCOOVNMJUYfwh/NLGlyXJ+2IIei
         wVwLZBbQqj4lUXgx4GGjG/wJSnrcumP53BY7c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Feg3DDg3dG39oORTAxhDPoszBUI49D4hc3RzzS1RxByxlKqAazsY8PvPQHWOOBZy5A
         EO3xdqMsD2l+sFYgOrLFPHLVQWAMnziDpeSb2JG5v2T8jMtN3PbuEW1Lvx68bFGTAZ5W
         FjyYpbT68feAUqxDvi2sHQNgVEh0ZlNneFGR8=
MIME-Version: 1.0
Received: by 10.229.218.210 with SMTP id hr18mr6110192qcb.78.1289325448403;
 Tue, 09 Nov 2010 09:57:28 -0800 (PST)
Received: by 10.229.216.19 with HTTP; Tue, 9 Nov 2010 09:57:28 -0800 (PST)
In-Reply-To: <AANLkTikbwX3sv5sGxNFcyPunkNFjH8kBPhoycWmwUsAh@mail.gmail.com>
References: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
	<AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
	<AANLkTikP7GyrpBZ=AubXAFkrUjqwuWwWKBavTCPQom1g@mail.gmail.com>
	<AANLkTim03jcxnu1ZsOVZ+PezTL+QTZhJGWjdTDgvSXES@mail.gmail.com>
	<AANLkTikbwX3sv5sGxNFcyPunkNFjH8kBPhoycWmwUsAh@mail.gmail.com>
Date: Tue, 9 Nov 2010 12:57:28 -0500
Message-ID: <AANLkTimpmWvAHi0dB1qHJK9Y7au9uw9xYtRYWN6Ao-PB@mail.gmail.com>
Subject: Re: Single filter instance with different searchers
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163630f5855a1c9b0494a279c5

--00163630f5855a1c9b0494a279c5
Content-Type: text/plain; charset=ISO-8859-1

I'm going to have to leave answering that to people with more
familiarity with the underlying code than I have...

That said, I'd #guess# that you'll be OK because I'd #guess# that
filters are maintained on a per-reader basis and the results
are synthesized when combined in a MultiSearcher.

But that's all a guess....

Best
Erick

On Tue, Nov 9, 2010 at 2:48 AM, Samarendra Pratap <samarzone@gmail.com>wrote:

> Thanks Erick, you cleared some of my confusions. But I still have a doubt.
>
>  As you can see in previous example code I am re-creating parallel multi
> searcher for each search. (This is the actual scenario on production
> servers)
> The ParallelMultiSearcher constructor is taking different combination of
> searchers each time. It means that the same document may be assigned a
> different docid for next search.
>
> So my primary question is - Will the cached results from a filter created
> with one multi searcher, work fine with another multi searcher? (Underlying
> IndexSearchers are opened only once. It is combination of IndexSearchers
> which is varying for each search.)
>
>  I have tested it with my real code and sample indexes and it gives me a
> feeling that results are correct, but I am not able to understand how,
> given
> my above confusion.
>
> Can you suggest me a something with another curiosity - Which option will
> be
> more efficient - 1. MultiSearchers  (either recreating for each search or
> reusing cached ones) with different searchers or 2. having a single index
> for all last update date criteria and using filters for different
> combinations of last update dates.
>  As I wrote in my previous mail we have different physical indexes based on
> different ranges of update dates. We select appropriate indexes based on
> the
> user selected options.
>
> On Tue, Nov 9, 2010 at 4:25 AM, Erick Erickson <erickerickson@gmail.com
> >wrote:
>
> > Ignore my previous, I thought you were constructing your own filters.
> What
> > you're doing should
> > be OK.
> >
> > Here's the source of my confusion.  Each of your indexes has Lucene
> > document
> > IDs starting at
> > 0. In your example, you have two docs/index. So, if you created a Filter
> > via
> > lower-level
> > calls, it could not be applied across different indexes. See the
> discussion
> > here:
> > http://www.gossamer-threads.com/lists/lucene/java-user/106376. That is,
> > the bit in your Filter for index0, doc0 would be the same bit as in
> index1,
> > doc0.
> >
> > But, that's not what you are doing. The (Parallel)MultiSearcher takes
> > care of mapping these doc IDs appropriately for you so you don't have to
> > worry about
> > what I was thinking about. Here's a program that illustrates this. It
> > creates
> > three RAMDirectories then  dumps the Lucene doc ID from each. Then it
> > creates
> > a multisearcher from the same three dirs and walks that, dumping the
> Lucene
> > doc ID.
> > You'll see that the doc IDs change even though the contents are the
> > same....
> >
> > Again, though, this isn't a problem because you are using a
> MultiSearcher,
> > which
> > takes care of this for you.
> >
> > Which is yet another reason to never, never, never count on lucene doc
> IDs
> > outside their context!
> >
> > Output at the end......
> >
> > import org.apache.lucene.analysis.Analyzer;
> > import org.apache.lucene.analysis.standard.StandardAnalyzer;
> > import org.apache.lucene.document.Document;
> > import org.apache.lucene.document.Field;
> > import org.apache.lucene.index.IndexWriter;
> > import org.apache.lucene.search.*;
> > import org.apache.lucene.store.Directory;
> > import org.apache.lucene.store.RAMDirectory;
> > import org.apache.lucene.util.Version;
> >
> > import java.io.IOException;
> >
> > import static org.apache.lucene.index.IndexWriter.*;
> >
> > public class EoeTest {
> >    public static void main(String[] args) {
> >        EoeTest eoe = new EoeTest();
> >        eoe.doIt();
> >    }
> >    private void doIt() {
> >        try {
> >            populateIndexes();
> >            searchAndSpit();
> >            tryMulti();
> >         } catch (Exception e) {
> >            e.printStackTrace();
> >        }
> >
> >    }
> >
> >     private Searcher getMulti() throws IOException {
> >        IndexSearcher[] searchers = new IndexSearcher[3];
> >        searchers[0] = new IndexSearcher(_ram1, true);
> >        searchers[1] = new IndexSearcher(_ram2, true);
> >        searchers[2] = new IndexSearcher(_ram3, true);
> >        return new MultiSearcher(searchers);
> >    }
> >    private void tryMulti() throws IOException {
> >        searchOne("multi ", getMulti());
> >    }
> >
> >    private void searchAndSpit() throws IOException {
> >        searchOne("ram1", new IndexSearcher(_ram1, true));
> >        searchOne("ram2", new IndexSearcher(_ram2, true));
> >        searchOne("ram3", new IndexSearcher(_ram3, true));
> >    }
> >    private void searchOne(String which, Searcher is) throws IOException {
> >        log("dumping " + which);
> >        TopDocs hits = is.search(new MatchAllDocsQuery(), 100);
> >        for (int idx = 0; idx < hits.scoreDocs.length; ++idx) {
> >            ScoreDoc sd = hits.scoreDocs[idx];
> >            Document doc = is.doc(sd.doc);
> >            log(String.format("lid: %d, content: %s", sd.doc,
> > doc.get("content")));
> >        }
> >        is.close();
> >    }
> >    private void log(String msg) {
> >        System.out.println(msg);
> >    }
> >    private void populateIndexes() throws IOException {
> >        popOne(_ram1);
> >        popOne(_ram2);
> >        popOne(_ram3);
> >    }
> >
> >    private void popOne(Directory dir) throws IOException {
> >        IndexWriter iw = new IndexWriter(dir, _std,
> MaxFieldLength.LIMITED);
> >        Document doc = new Document();
> >        doc.add(new Field("content", "common " +
> > Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
> > Field.TermVector.YES));
> >        iw.addDocument(doc);
> >
> >        doc = new Document();
> >        doc.add(new Field("content", "common " +
> > Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
> > Field.TermVector.YES));
> >        iw.addDocument(doc);
> >
> >        iw.close();
> >    }
> >
> >
> >    Directory _ram1 = new RAMDirectory();
> >    Directory _ram2 = new RAMDirectory();
> >    Directory _ram3 = new RAMDirectory();
> >    Analyzer _std = new StandardAnalyzer(Version.LUCENE_29);
> > }
> >
> > ************************************output****************
> > where lid: ### is the Lucene doc ID returned in scoreDocs
> > ***********************************************************
> >
> > dumping ram1
> > lid: 0, content: common 0.11100571422470962
> > lid: 1, content: common 0.31555863707233567
> > dumping ram2
> > lid: 0, content: common 0.01235509997022377
> > lid: 1, content: common 0.7017712652104814
> > dumping ram3
> > lid: 0, content: common 0.9472403989314128
> > lid: 1, content: common 0.7105628402082196
> > dumping multi
> > lid: 0, content: common 0.11100571422470962
> > lid: 1, content: common 0.31555863707233567
> > lid: 2, content: common 0.01235509997022377
> > lid: 3, content: common 0.7017712652104814
> > lid: 4, content: common 0.9472403989314128
> > lid: 5, content: common 0.7105628402082196
> >
> >
> >
> >
> > On Mon, Nov 8, 2010 at 3:33 AM, Samarendra Pratap <samarzone@gmail.com
> > >wrote:
> >
> > > Hi Erick, Thanks for the reply.
> > >  Your answer have puzzled me more because what I am able to view is not
> > > what you say or I am not able to grasp your meaning.
> > >  I have written a small program which is exactly what my original
> > question
> > > was. Here I am creating a CachingWrapperFilter on one index and reusing
> > it
> > > on other indexes. This single filter gives me results as expected from
> > each
> > > of the index. I will appreciate if you can throw some light.
> > >
> > > I have given the output after the program ends
> > >
> > >
> > >
> >
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> > > // following program is compiled with java6
> > >
> > > import org.apache.lucene.index.*;
> > > import org.apache.lucene.analysis.*;
> > > import org.apache.lucene.analysis.standard.*;
> > > import org.apache.lucene.search.*;
> > > import org.apache.lucene.search.spans.*;
> > > import org.apache.lucene.store.*;
> > > import org.apache.lucene.document.*;
> > > import org.apache.lucene.queryParser.*;
> > > import org.apache.lucene.util.*;
> > >
> > > import java.util.*;
> > >
> > > public class FilterTest
> > > {
> > > protected Directory[] dirs;
> > >  protected Analyzer a;
> > > protected Searcher[] searchers;
> > > protected QueryParser qp;
> > >  protected Filter f;
> > > protected Hashtable<String, Filter> filters;
> > >
> > >  public FilterTest()
> > > {
> > > // create analyzer
> > >  a = new StandardAnalyzer(Version.LUCENE_29);
> > > // create query parser
> > > qp = new QueryParser(Version.LUCENE_29, "content", a);
> > >  // initialize "filters" Hashtable
> > > filters = new Hashtable<String, Filter>();
> > >  }
> > >
> > > protected void createDirectories(int length)
> > > {
> > >  // create specified number of RAM directories
> > > dirs = new Directory[length];
> > >  for(int i=0;i<length;i++)
> > > dirs[i] = new RAMDirectory();
> > > }
> > >
> > > protected void createIndexes() throws Exception
> > > {
> > > /* create indexes for each directory.
> > >  each index contains two documents.
> > > every document contains one term, unique across all indexes, one term
> > > unique across single index and one term common to all indexes
> > >  */
> > > for(int i=0;i<dirs.length;i++)
> > > {
> > >  IndexWriter iw = new IndexWriter(dirs[i], a, true,
> > > IndexWriter.MaxFieldLength.LIMITED);
> > >
> > > Document d = new Document();
> > >  // unique id across all indexes
> > > d.add(new Field("id", ""+(i*2+1), Field.Store.YES,
> > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > >  // unique id in a single indexes
> > > d.add(new Field("docnumber", "1", Field.Store.YES,
> > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > >  // common word in all indexes
> > > d.add(new Field("content", "common", Field.Store.YES,
> > Field.Index.ANALYZED,
> > > Field.TermVector.YES));
> > >  iw.addDocument(d);
> > >
> > > d = new Document();
> > > // unique id across all indexes
> > >  d.add(new Field("id", ""+(i*2+2), Field.Store.YES,
> > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > > // unique id in a single indexes
> > >  d.add(new Field("docnumber", "2", Field.Store.YES,
> > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > > // common word in all indexes
> > >  d.add(new Field("content", "common", Field.Store.YES,
> > > Field.Index.ANALYZED, Field.TermVector.YES));
> > > iw.addDocument(d);
> > >
> > > iw.close();
> > > }
> > > }
> > >
> > > protected void openSearchers() throws Exception
> > > {
> > > // open searches for every directory and save it in an array
> > >  searchers = new Searcher[dirs.length];
> > > for(int i=0;i<dirs.length;i++)
> > >  searchers[i] = new IndexSearcher(IndexReader.open(dirs[i], true));
> > > }
> > >
> > >  protected Searcher getSearcher(int[] arr) throws Exception
> > > {
> > > // provides a ParallelMultiSearcher instance with the searchers lying
> at
> > > index positions provided in the argument
> > >  Searcher[] s = new Searcher[arr.length];
> > > for(int i=0;i<arr.length;i++)
> > >  s[i] = this.searchers[arr[i]];
> > >
> > > return new ParallelMultiSearcher(s);
> > >  }
> > >
> > > protected ScoreDoc[] search(String query, String filter, Searcher s)
> > throws
> > > Exception
> > >  {
> > > Filter f = null;
> > > if(filter != null)
> > >  {
> > > if(filters.containsKey(filter))
> > > {
> > >  System.out.println("Reusing filter for - " + filter);
> > > f = filters.get(filter);
> > >  }
> > > else
> > > {
> > >  System.out.println("Creating new filter for - " + filter);
> > > f = new CachingWrapperFilter(new QueryWrapperFilter(qp.parse(filter)));
> > >  filters.put(filter, f);
> > > }
> > > }
> > >  System.out.println("Query:("+query+"), Filter:("+filter+")");
> > > return s.search(qp.parse(query), f, 1000).scoreDocs;
> > >  }
> > >
> > > public static void main(String[] args) throws Exception
> > >  {
> > >  FilterTest ft = new FilterTest();
> > > ft.startTest();
> > > }
> > >
> > > public void startTest()
> > > {
> > > try
> > >  {
> > > Query q;
> > >
> > > createDirectories(3);
> > >  createIndexes();
> > > openSearchers();
> > > Searcher s;
> > >  ScoreDoc[] sd;
> > >
> > > System.out.println("===================================");
> > >  System.out.println("Fields of all the documents");
> > > // creating searcher for all indexes
> > >  s = getSearcher(new int[]{0,1,2});
> > > // search all documents and their ids
> > >  sd = search("+content:common", null, s);
> > > for(int i=0;i<sd.length;i++)
> > >  {
> > > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> > >  }
> > > System.out.println("\n\n");
> > >
> > > System.out.println("===================================");
> > >  System.out.println("Searching for documents in a single index. Filter
> > > will be created and cached");
> > > s = getSearcher(new int[]{0});
> > >  sd = search("+content:common", "docnumber:1", s);
> > > System.out.println("Hits:"+sd.length);
> > >  for(int i=0;i<sd.length;i++)
> > > {
> > > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> > >  }
> > > System.out.println("\n\n");
> > >
> > > System.out.println("===================================");
> > >  System.out.println("Searching for documents in a other indexes other
> > than
> > > previous search. Query and filter will be same. Filter will be
> reused");
> > >  s = getSearcher(new int[]{1,2});
> > > sd = search("+content:common", "docnumber:1", s);
> > >  System.out.println("Hits:"+sd.length);
> > > for(int i=0;i<sd.length;i++)
> > >  {
> > > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> > >  }
> > >
> > > }
> > > catch(Exception e)
> > >  {
> > > e.printStackTrace();
> > > }
> > >  }
> > > }
> > >
> > >
> >
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> > > OUTPUT:
> > > [samar@myserver java]$ java FilterTest
> > > ===================================
> > > Fields of all the documents
> > > Query:(+content:common), Filter:(null)
> > >         id:1, docid:1
> > >         id:2, docid:2
> > >         id:3, docid:1
> > >         id:4, docid:2
> > >         id:5, docid:1
> > >         id:6, docid:2
> > >
> > >
> > >
> > > ===================================
> > > Searching for documents in a single index. Filter will be created and
> > > cached
> > > Creating new filter for - docid:1
> > > Query:(+content:common), Filter:(docid:1)
> > > Hits:1
> > >         id:1, docid:1
> > >
> > >
> > >
> > > ===================================
> > > Searching for documents in indexes other than previous search. Query
> and
> > > filter will be same. Filter will be reused
> > > Reusing filter for - docid:1
> > > Query:(+content:common), Filter:(docid:1)
> > > Hits:2
> > >         id:3, docid:1
> > >         id:5, docid:1
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > > On Wed, Nov 3, 2010 at 7:04 PM, Erick Erickson <
> erickerickson@gmail.com
> > >wrote:
> > >
> > >> I'm assuming you're down in Lucene land. Unless somehow you've
> > >> gotten 63 separate filters when you think you only have one, I don't
> > >> think what you're doing will work. Or I'm failing to understand what
> > >> you're doing at all.
> > >>
> > >> The problem is I expect each of your indexes starts with document
> > >> 1. So your Filter is really a bit set keyed by Lucene document ID.
> > >>
> > >> So applying filter 2 to index 54 will NOT do what you want. What I
> > >> suspect you're seeing is that applying your filter is producing enough
> > >> results from index 54 (to continue my example) to fool you into
> > >> thinking it's working.
> > >>
> > >> Try running the query with and without the filter on each of your
> > indexes,
> > >> perhaps as a control including a restrictive clause in the query
> > >> to do the same thing your filter is doing. Or construct the filter new
> > >> for comparison.... If the numbers continue to be the same, I clearly
> > >> don't understand something! <G>....
> > >>
> > >> Best
> > >> Erick
> > >>
> > >> On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap <
> samarzone@gmail.com
> > >> >wrote:
> > >>
> > >> > Hi. We have a large index (~ 28 GB) which is distributed in three
> > >> different
> > >> > directories, each representing a country. Each of these country wise
> > >> > indexes
> > >> > is further distributed on the basis of last update date into 21
> > smaller
> > >> > indexes. This index is updated once in a day.
> > >> >
> > >> > A user can search into any of one country and can choose last update
> > >> date
> > >> > plus some other criteria.
> > >> >
> > >> > When the server application starts, index readers and hence
> searchers
> > >> are
> > >> > created for each of the small indexes (21 x 3) and put in an array.
> > >> > Depending on the option (country and last update date) chosen by
> user
> > we
> > >> > pick the searchers of correct date range/country and create a new
> > >> > ParallelMultiSearcher instance.
> > >> >
> > >> > Now my question is - can I use single filter (caching filter)
> instance
> > >> for
> > >> > every search (may be on different searchers)?
> > >> >
> > >> >
> > >>
> >
> ===================================================================================
> > >> >
> > >> > e.g
> > >> > for first search i create an filter of experience 4 years and save
> it.
> > >> >
> > >> > if another search for a different country (and hence difference
> index)
> > >> also
> > >> > has same experience criteria, i.e. 4 years, can i use the same
> filter
> > >> > instance for second search too?
> > >> >
> > >> > i have tested a little for this and surprisingly i have got correct
> > >> > results.
> > >> > i was wondering if this is the correct way. or do i need to create
> > >> > different
> > >> > filters for each searcher (or index reader) instance?
> > >> >
> > >> > Thanks in advance.
> > >> >
> > >> > --
> > >> > Regards,
> > >> > Samar
> > >> >
> > >>
> > >
> > >
> > >
> > > --
> > > Regards,
> > > Samar
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> >
>
>
>
> --
> Regards,
> Samar
>

--00163630f5855a1c9b0494a279c5--

From java-user-return-47764-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 09 22:30:21 2010
Return-Path: <java-user-return-47764-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76343 invoked from network); 9 Nov 2010 22:30:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 9 Nov 2010 22:30:21 -0000
Received: (qmail 68854 invoked by uid 500); 9 Nov 2010 22:30:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68786 invoked by uid 500); 9 Nov 2010 22:30:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68778 invoked by uid 99); 9 Nov 2010 22:30:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 22:30:49 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 09 Nov 2010 22:30:45 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <mail@avomberg.de>)
	id 1PFwhq-0004vm-7v
	for java-user@lucene.apache.org; Tue, 09 Nov 2010 14:30:22 -0800
Date: Tue, 9 Nov 2010 14:30:22 -0800 (PST)
From: Alex vB <mail@avomberg.de>
To: java-user@lucene.apache.org
Message-ID: <1289341822239-1872701.post@n3.nabble.com>
Subject: Implementing indexing of Versioned Document Collections
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Hello everybody,

I would like to implement the paper "Compact Full-Text Indexing of Versioned
Document Collections" [1] from Torsten Suel for my diploma thesis in Lucene.
The basic idea is to create a two-level index structure. On the first level
a document is identified by document ID with a posting list entry if the
term exists at least in one version. For every posting on the first level
with term t we have a bitvector on the second one. These bitvectors contain
as many bits as there are versions for one document, and bit i is set to 1
if version i contains term t or otherwise it remains 0. 

http://lucene.472066.n3.nabble.com/file/n1872701/Unbenannt_1.jpg 

This little picture is just for demonstration purposes. It shows a posting
list for the term car and is composed of 4 document IDs. If a hit is found
in document 6 another look-up is needed on the second level to get the
corresponding versions (version 1, 5, 7, 8, 9, 10 from 10 versions at all). 

At the moment I am using wikipedia (simplewiki dump) as source with a
SAXParser and can resolve each document with all its versions from the XML
file (Fields are Title, ID, Content(seperated for each version)). My problem
is that I am unsure how to connect the second level with the first one and
how to store it. The key points that are needed:
- Information from posting list creation to create the bitvector (term ->
doc -> versions)
- Storing the bitvectors
- Implementing search on second level

For the first steps I disabled term frequencies and positions because the
paper isn't handling them. I would be happy to get any running version at
all. :)
At the moment I can create bitvectors for the documents. I realized this
with a HashMap<String, BitSet> in TermsHashPerField where I grab the current
term in add() (I hope this is the correct location for retrieving the
inverted lists terms). Anyway I can create the corret bitvectors and write
them into a text file.
Excerpt of bitVectors from article "April":
april : 
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101101110111111111111111111
never : 
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000
ayriway : 
0000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111101101110111111111111111111
inclusive : 
1111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 

Next step would be storing all bitvecors in the index. At first glance I
like to use an extra field to store the created bitvectors permanent in the
index. It seems to be the easiest way for a first implementation without
accessing the low level functions of Lucene. Can I add a field after I
already started writing the document through IndexWriter? How would I do
this? Or are there any other suggestions for storing? Another idea is to
expand the index format of Lucene but this seems a little bit to difficult
for me. Maybe I could write these information into my own file. Could
anybody point me to the right direction? :)

Currently I am focusing on storing and try to extend Lucenes search after
the former step.

THX in advance & best regards 
Alex

[1] http://cis.poly.edu/suel/
-- 
View this message in context: http://lucene.472066.n3.nabble.com/Implementing-indexing-of-Versioned-Document-Collections-tp1872701p1872701.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47765-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 06:27:53 2010
Return-Path: <java-user-return-47765-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 975 invoked from network); 10 Nov 2010 06:27:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 06:27:52 -0000
Received: (qmail 39283 invoked by uid 500); 10 Nov 2010 06:28:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38991 invoked by uid 500); 10 Nov 2010 06:28:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38983 invoked by uid 99); 10 Nov 2010 06:28:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 06:28:16 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of samarzone@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 06:28:11 +0000
Received: by iwn7 with SMTP id 7so400097iwn.35
        for <java-user@lucene.apache.org>; Tue, 09 Nov 2010 22:27:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=Q/+W+qVOuCYDjRD2J+UvPenQkJGMXaZtPpTbV+aD3+o=;
        b=oVtBV6sORGUJDGCXo1/BbW6J73Fv7tOKbvgg39EKYcSzWt5adgR+7zgUgEw8o8jo8C
         KLK307cUZNWpaIhrnh/yyqfE9oleVE1JULkWB3D4iUQ+bEekdOCu92eiBRBCO11/PY+c
         C/MKnSaeDBqjhOeCX9zHMT2qzBpJrwqxzPckM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Lb3F9xpd8WIEFBOfiIMquXrA18DnEVY8NBhkxgvyhT0W5DjIMUE6UMeUyNQ6LGGiLp
         LluIpXMlu1GpigzyggxwMl6nmvudYB/0xA/BR3x/3YZEAPRRs4bcoOqQcLEHLkS5DA6J
         2cJ3E3NmukvK2oBFz3xkLwb+L2uk1CcCnK49A=
Received: by 10.42.226.5 with SMTP id iu5mr5728432icb.12.1289370470255; Tue,
 09 Nov 2010 22:27:50 -0800 (PST)
MIME-Version: 1.0
Received: by 10.231.32.66 with HTTP; Tue, 9 Nov 2010 22:27:34 -0800 (PST)
In-Reply-To: <AANLkTimpmWvAHi0dB1qHJK9Y7au9uw9xYtRYWN6Ao-PB@mail.gmail.com>
References: <AANLkTi=vaYBDewbe-awwogHP4QrDfCCHv0rb8x1cgb_B@mail.gmail.com>
 <AANLkTinxp8WmoyFVisbWKUS9z5v3wq5f_iYTb6bn6DiE@mail.gmail.com>
 <AANLkTikP7GyrpBZ=AubXAFkrUjqwuWwWKBavTCPQom1g@mail.gmail.com>
 <AANLkTim03jcxnu1ZsOVZ+PezTL+QTZhJGWjdTDgvSXES@mail.gmail.com>
 <AANLkTikbwX3sv5sGxNFcyPunkNFjH8kBPhoycWmwUsAh@mail.gmail.com> <AANLkTimpmWvAHi0dB1qHJK9Y7au9uw9xYtRYWN6Ao-PB@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Wed, 10 Nov 2010 11:57:34 +0530
Message-ID: <AANLkTi=5fEGOof57nv=HkLtceR2fBy86hv0my_JmO_ZT@mail.gmail.com>
Subject: Re: Single filter instance with different searchers
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=90e6ba476b23dd0e7b0494acf40e

--90e6ba476b23dd0e7b0494acf40e
Content-Type: text/plain; charset=ISO-8859-1

Thanks Erick for you insight.

I'd appreciate if someone could throw more light on it.

Thanks

On Tue, Nov 9, 2010 at 11:27 PM, Erick Erickson <erickerickson@gmail.com>wrote:

> I'm going to have to leave answering that to people with more
> familiarity with the underlying code than I have...
>
> That said, I'd #guess# that you'll be OK because I'd #guess# that
> filters are maintained on a per-reader basis and the results
> are synthesized when combined in a MultiSearcher.
>
> But that's all a guess....
>
> Best
> Erick
>
> On Tue, Nov 9, 2010 at 2:48 AM, Samarendra Pratap <samarzone@gmail.com
> >wrote:
>
> > Thanks Erick, you cleared some of my confusions. But I still have a
> doubt.
> >
> >  As you can see in previous example code I am re-creating parallel multi
> > searcher for each search. (This is the actual scenario on production
> > servers)
> > The ParallelMultiSearcher constructor is taking different combination of
> > searchers each time. It means that the same document may be assigned a
> > different docid for next search.
> >
> > So my primary question is - Will the cached results from a filter created
> > with one multi searcher, work fine with another multi searcher?
> (Underlying
> > IndexSearchers are opened only once. It is combination of IndexSearchers
> > which is varying for each search.)
> >
> >  I have tested it with my real code and sample indexes and it gives me a
> > feeling that results are correct, but I am not able to understand how,
> > given
> > my above confusion.
> >
> > Can you suggest me a something with another curiosity - Which option will
> > be
> > more efficient - 1. MultiSearchers  (either recreating for each search or
> > reusing cached ones) with different searchers or 2. having a single index
> > for all last update date criteria and using filters for different
> > combinations of last update dates.
> >  As I wrote in my previous mail we have different physical indexes based
> on
> > different ranges of update dates. We select appropriate indexes based on
> > the
> > user selected options.
> >
> > On Tue, Nov 9, 2010 at 4:25 AM, Erick Erickson <erickerickson@gmail.com
> > >wrote:
> >
> > > Ignore my previous, I thought you were constructing your own filters.
> > What
> > > you're doing should
> > > be OK.
> > >
> > > Here's the source of my confusion.  Each of your indexes has Lucene
> > > document
> > > IDs starting at
> > > 0. In your example, you have two docs/index. So, if you created a
> Filter
> > > via
> > > lower-level
> > > calls, it could not be applied across different indexes. See the
> > discussion
> > > here:
> > > http://www.gossamer-threads.com/lists/lucene/java-user/106376. That
> is,
> > > the bit in your Filter for index0, doc0 would be the same bit as in
> > index1,
> > > doc0.
> > >
> > > But, that's not what you are doing. The (Parallel)MultiSearcher takes
> > > care of mapping these doc IDs appropriately for you so you don't have
> to
> > > worry about
> > > what I was thinking about. Here's a program that illustrates this. It
> > > creates
> > > three RAMDirectories then  dumps the Lucene doc ID from each. Then it
> > > creates
> > > a multisearcher from the same three dirs and walks that, dumping the
> > Lucene
> > > doc ID.
> > > You'll see that the doc IDs change even though the contents are the
> > > same....
> > >
> > > Again, though, this isn't a problem because you are using a
> > MultiSearcher,
> > > which
> > > takes care of this for you.
> > >
> > > Which is yet another reason to never, never, never count on lucene doc
> > IDs
> > > outside their context!
> > >
> > > Output at the end......
> > >
> > > import org.apache.lucene.analysis.Analyzer;
> > > import org.apache.lucene.analysis.standard.StandardAnalyzer;
> > > import org.apache.lucene.document.Document;
> > > import org.apache.lucene.document.Field;
> > > import org.apache.lucene.index.IndexWriter;
> > > import org.apache.lucene.search.*;
> > > import org.apache.lucene.store.Directory;
> > > import org.apache.lucene.store.RAMDirectory;
> > > import org.apache.lucene.util.Version;
> > >
> > > import java.io.IOException;
> > >
> > > import static org.apache.lucene.index.IndexWriter.*;
> > >
> > > public class EoeTest {
> > >    public static void main(String[] args) {
> > >        EoeTest eoe = new EoeTest();
> > >        eoe.doIt();
> > >    }
> > >    private void doIt() {
> > >        try {
> > >            populateIndexes();
> > >            searchAndSpit();
> > >            tryMulti();
> > >         } catch (Exception e) {
> > >            e.printStackTrace();
> > >        }
> > >
> > >    }
> > >
> > >     private Searcher getMulti() throws IOException {
> > >        IndexSearcher[] searchers = new IndexSearcher[3];
> > >        searchers[0] = new IndexSearcher(_ram1, true);
> > >        searchers[1] = new IndexSearcher(_ram2, true);
> > >        searchers[2] = new IndexSearcher(_ram3, true);
> > >        return new MultiSearcher(searchers);
> > >    }
> > >    private void tryMulti() throws IOException {
> > >        searchOne("multi ", getMulti());
> > >    }
> > >
> > >    private void searchAndSpit() throws IOException {
> > >        searchOne("ram1", new IndexSearcher(_ram1, true));
> > >        searchOne("ram2", new IndexSearcher(_ram2, true));
> > >        searchOne("ram3", new IndexSearcher(_ram3, true));
> > >    }
> > >    private void searchOne(String which, Searcher is) throws IOException
> {
> > >        log("dumping " + which);
> > >        TopDocs hits = is.search(new MatchAllDocsQuery(), 100);
> > >        for (int idx = 0; idx < hits.scoreDocs.length; ++idx) {
> > >            ScoreDoc sd = hits.scoreDocs[idx];
> > >            Document doc = is.doc(sd.doc);
> > >            log(String.format("lid: %d, content: %s", sd.doc,
> > > doc.get("content")));
> > >        }
> > >        is.close();
> > >    }
> > >    private void log(String msg) {
> > >        System.out.println(msg);
> > >    }
> > >    private void populateIndexes() throws IOException {
> > >        popOne(_ram1);
> > >        popOne(_ram2);
> > >        popOne(_ram3);
> > >    }
> > >
> > >    private void popOne(Directory dir) throws IOException {
> > >        IndexWriter iw = new IndexWriter(dir, _std,
> > MaxFieldLength.LIMITED);
> > >        Document doc = new Document();
> > >        doc.add(new Field("content", "common " +
> > > Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
> > > Field.TermVector.YES));
> > >        iw.addDocument(doc);
> > >
> > >        doc = new Document();
> > >        doc.add(new Field("content", "common " +
> > > Double.toString(Math.random()), Field.Store.YES, Field.Index.ANALYZED,
> > > Field.TermVector.YES));
> > >        iw.addDocument(doc);
> > >
> > >        iw.close();
> > >    }
> > >
> > >
> > >    Directory _ram1 = new RAMDirectory();
> > >    Directory _ram2 = new RAMDirectory();
> > >    Directory _ram3 = new RAMDirectory();
> > >    Analyzer _std = new StandardAnalyzer(Version.LUCENE_29);
> > > }
> > >
> > > ************************************output****************
> > > where lid: ### is the Lucene doc ID returned in scoreDocs
> > > ***********************************************************
> > >
> > > dumping ram1
> > > lid: 0, content: common 0.11100571422470962
> > > lid: 1, content: common 0.31555863707233567
> > > dumping ram2
> > > lid: 0, content: common 0.01235509997022377
> > > lid: 1, content: common 0.7017712652104814
> > > dumping ram3
> > > lid: 0, content: common 0.9472403989314128
> > > lid: 1, content: common 0.7105628402082196
> > > dumping multi
> > > lid: 0, content: common 0.11100571422470962
> > > lid: 1, content: common 0.31555863707233567
> > > lid: 2, content: common 0.01235509997022377
> > > lid: 3, content: common 0.7017712652104814
> > > lid: 4, content: common 0.9472403989314128
> > > lid: 5, content: common 0.7105628402082196
> > >
> > >
> > >
> > >
> > > On Mon, Nov 8, 2010 at 3:33 AM, Samarendra Pratap <samarzone@gmail.com
> > > >wrote:
> > >
> > > > Hi Erick, Thanks for the reply.
> > > >  Your answer have puzzled me more because what I am able to view is
> not
> > > > what you say or I am not able to grasp your meaning.
> > > >  I have written a small program which is exactly what my original
> > > question
> > > > was. Here I am creating a CachingWrapperFilter on one index and
> reusing
> > > it
> > > > on other indexes. This single filter gives me results as expected
> from
> > > each
> > > > of the index. I will appreciate if you can throw some light.
> > > >
> > > > I have given the output after the program ends
> > > >
> > > >
> > > >
> > >
> >
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> > > > // following program is compiled with java6
> > > >
> > > > import org.apache.lucene.index.*;
> > > > import org.apache.lucene.analysis.*;
> > > > import org.apache.lucene.analysis.standard.*;
> > > > import org.apache.lucene.search.*;
> > > > import org.apache.lucene.search.spans.*;
> > > > import org.apache.lucene.store.*;
> > > > import org.apache.lucene.document.*;
> > > > import org.apache.lucene.queryParser.*;
> > > > import org.apache.lucene.util.*;
> > > >
> > > > import java.util.*;
> > > >
> > > > public class FilterTest
> > > > {
> > > > protected Directory[] dirs;
> > > >  protected Analyzer a;
> > > > protected Searcher[] searchers;
> > > > protected QueryParser qp;
> > > >  protected Filter f;
> > > > protected Hashtable<String, Filter> filters;
> > > >
> > > >  public FilterTest()
> > > > {
> > > > // create analyzer
> > > >  a = new StandardAnalyzer(Version.LUCENE_29);
> > > > // create query parser
> > > > qp = new QueryParser(Version.LUCENE_29, "content", a);
> > > >  // initialize "filters" Hashtable
> > > > filters = new Hashtable<String, Filter>();
> > > >  }
> > > >
> > > > protected void createDirectories(int length)
> > > > {
> > > >  // create specified number of RAM directories
> > > > dirs = new Directory[length];
> > > >  for(int i=0;i<length;i++)
> > > > dirs[i] = new RAMDirectory();
> > > > }
> > > >
> > > > protected void createIndexes() throws Exception
> > > > {
> > > > /* create indexes for each directory.
> > > >  each index contains two documents.
> > > > every document contains one term, unique across all indexes, one term
> > > > unique across single index and one term common to all indexes
> > > >  */
> > > > for(int i=0;i<dirs.length;i++)
> > > > {
> > > >  IndexWriter iw = new IndexWriter(dirs[i], a, true,
> > > > IndexWriter.MaxFieldLength.LIMITED);
> > > >
> > > > Document d = new Document();
> > > >  // unique id across all indexes
> > > > d.add(new Field("id", ""+(i*2+1), Field.Store.YES,
> > > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > > >  // unique id in a single indexes
> > > > d.add(new Field("docnumber", "1", Field.Store.YES,
> > > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > > >  // common word in all indexes
> > > > d.add(new Field("content", "common", Field.Store.YES,
> > > Field.Index.ANALYZED,
> > > > Field.TermVector.YES));
> > > >  iw.addDocument(d);
> > > >
> > > > d = new Document();
> > > > // unique id across all indexes
> > > >  d.add(new Field("id", ""+(i*2+2), Field.Store.YES,
> > > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > > > // unique id in a single indexes
> > > >  d.add(new Field("docnumber", "2", Field.Store.YES,
> > > > Field.Index.NOT_ANALYZED, Field.TermVector.YES));
> > > > // common word in all indexes
> > > >  d.add(new Field("content", "common", Field.Store.YES,
> > > > Field.Index.ANALYZED, Field.TermVector.YES));
> > > > iw.addDocument(d);
> > > >
> > > > iw.close();
> > > > }
> > > > }
> > > >
> > > > protected void openSearchers() throws Exception
> > > > {
> > > > // open searches for every directory and save it in an array
> > > >  searchers = new Searcher[dirs.length];
> > > > for(int i=0;i<dirs.length;i++)
> > > >  searchers[i] = new IndexSearcher(IndexReader.open(dirs[i], true));
> > > > }
> > > >
> > > >  protected Searcher getSearcher(int[] arr) throws Exception
> > > > {
> > > > // provides a ParallelMultiSearcher instance with the searchers lying
> > at
> > > > index positions provided in the argument
> > > >  Searcher[] s = new Searcher[arr.length];
> > > > for(int i=0;i<arr.length;i++)
> > > >  s[i] = this.searchers[arr[i]];
> > > >
> > > > return new ParallelMultiSearcher(s);
> > > >  }
> > > >
> > > > protected ScoreDoc[] search(String query, String filter, Searcher s)
> > > throws
> > > > Exception
> > > >  {
> > > > Filter f = null;
> > > > if(filter != null)
> > > >  {
> > > > if(filters.containsKey(filter))
> > > > {
> > > >  System.out.println("Reusing filter for - " + filter);
> > > > f = filters.get(filter);
> > > >  }
> > > > else
> > > > {
> > > >  System.out.println("Creating new filter for - " + filter);
> > > > f = new CachingWrapperFilter(new
> QueryWrapperFilter(qp.parse(filter)));
> > > >  filters.put(filter, f);
> > > > }
> > > > }
> > > >  System.out.println("Query:("+query+"), Filter:("+filter+")");
> > > > return s.search(qp.parse(query), f, 1000).scoreDocs;
> > > >  }
> > > >
> > > > public static void main(String[] args) throws Exception
> > > >  {
> > > >  FilterTest ft = new FilterTest();
> > > > ft.startTest();
> > > > }
> > > >
> > > > public void startTest()
> > > > {
> > > > try
> > > >  {
> > > > Query q;
> > > >
> > > > createDirectories(3);
> > > >  createIndexes();
> > > > openSearchers();
> > > > Searcher s;
> > > >  ScoreDoc[] sd;
> > > >
> > > > System.out.println("===================================");
> > > >  System.out.println("Fields of all the documents");
> > > > // creating searcher for all indexes
> > > >  s = getSearcher(new int[]{0,1,2});
> > > > // search all documents and their ids
> > > >  sd = search("+content:common", null, s);
> > > > for(int i=0;i<sd.length;i++)
> > > >  {
> > > > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > > > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> > > >  }
> > > > System.out.println("\n\n");
> > > >
> > > > System.out.println("===================================");
> > > >  System.out.println("Searching for documents in a single index.
> Filter
> > > > will be created and cached");
> > > > s = getSearcher(new int[]{0});
> > > >  sd = search("+content:common", "docnumber:1", s);
> > > > System.out.println("Hits:"+sd.length);
> > > >  for(int i=0;i<sd.length;i++)
> > > > {
> > > > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > > > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> > > >  }
> > > > System.out.println("\n\n");
> > > >
> > > > System.out.println("===================================");
> > > >  System.out.println("Searching for documents in a other indexes other
> > > than
> > > > previous search. Query and filter will be same. Filter will be
> > reused");
> > > >  s = getSearcher(new int[]{1,2});
> > > > sd = search("+content:common", "docnumber:1", s);
> > > >  System.out.println("Hits:"+sd.length);
> > > > for(int i=0;i<sd.length;i++)
> > > >  {
> > > > System.out.println("\tid:"+s.doc(sd[i].doc).get("id")+",
> > > > docnumber:"+s.doc(sd[i].doc).get("docnumber"));
> > > >  }
> > > >
> > > > }
> > > > catch(Exception e)
> > > >  {
> > > > e.printStackTrace();
> > > > }
> > > >  }
> > > > }
> > > >
> > > >
> > >
> >
> ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
> > > > OUTPUT:
> > > > [samar@myserver java]$ java FilterTest
> > > > ===================================
> > > > Fields of all the documents
> > > > Query:(+content:common), Filter:(null)
> > > >         id:1, docid:1
> > > >         id:2, docid:2
> > > >         id:3, docid:1
> > > >         id:4, docid:2
> > > >         id:5, docid:1
> > > >         id:6, docid:2
> > > >
> > > >
> > > >
> > > > ===================================
> > > > Searching for documents in a single index. Filter will be created and
> > > > cached
> > > > Creating new filter for - docid:1
> > > > Query:(+content:common), Filter:(docid:1)
> > > > Hits:1
> > > >         id:1, docid:1
> > > >
> > > >
> > > >
> > > > ===================================
> > > > Searching for documents in indexes other than previous search. Query
> > and
> > > > filter will be same. Filter will be reused
> > > > Reusing filter for - docid:1
> > > > Query:(+content:common), Filter:(docid:1)
> > > > Hits:2
> > > >         id:3, docid:1
> > > >         id:5, docid:1
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > >
> > > > On Wed, Nov 3, 2010 at 7:04 PM, Erick Erickson <
> > erickerickson@gmail.com
> > > >wrote:
> > > >
> > > >> I'm assuming you're down in Lucene land. Unless somehow you've
> > > >> gotten 63 separate filters when you think you only have one, I don't
> > > >> think what you're doing will work. Or I'm failing to understand what
> > > >> you're doing at all.
> > > >>
> > > >> The problem is I expect each of your indexes starts with document
> > > >> 1. So your Filter is really a bit set keyed by Lucene document ID.
> > > >>
> > > >> So applying filter 2 to index 54 will NOT do what you want. What I
> > > >> suspect you're seeing is that applying your filter is producing
> enough
> > > >> results from index 54 (to continue my example) to fool you into
> > > >> thinking it's working.
> > > >>
> > > >> Try running the query with and without the filter on each of your
> > > indexes,
> > > >> perhaps as a control including a restrictive clause in the query
> > > >> to do the same thing your filter is doing. Or construct the filter
> new
> > > >> for comparison.... If the numbers continue to be the same, I clearly
> > > >> don't understand something! <G>....
> > > >>
> > > >> Best
> > > >> Erick
> > > >>
> > > >> On Wed, Nov 3, 2010 at 6:05 AM, Samarendra Pratap <
> > samarzone@gmail.com
> > > >> >wrote:
> > > >>
> > > >> > Hi. We have a large index (~ 28 GB) which is distributed in three
> > > >> different
> > > >> > directories, each representing a country. Each of these country
> wise
> > > >> > indexes
> > > >> > is further distributed on the basis of last update date into 21
> > > smaller
> > > >> > indexes. This index is updated once in a day.
> > > >> >
> > > >> > A user can search into any of one country and can choose last
> update
> > > >> date
> > > >> > plus some other criteria.
> > > >> >
> > > >> > When the server application starts, index readers and hence
> > searchers
> > > >> are
> > > >> > created for each of the small indexes (21 x 3) and put in an
> array.
> > > >> > Depending on the option (country and last update date) chosen by
> > user
> > > we
> > > >> > pick the searchers of correct date range/country and create a new
> > > >> > ParallelMultiSearcher instance.
> > > >> >
> > > >> > Now my question is - can I use single filter (caching filter)
> > instance
> > > >> for
> > > >> > every search (may be on different searchers)?
> > > >> >
> > > >> >
> > > >>
> > >
> >
> ===================================================================================
> > > >> >
> > > >> > e.g
> > > >> > for first search i create an filter of experience 4 years and save
> > it.
> > > >> >
> > > >> > if another search for a different country (and hence difference
> > index)
> > > >> also
> > > >> > has same experience criteria, i.e. 4 years, can i use the same
> > filter
> > > >> > instance for second search too?
> > > >> >
> > > >> > i have tested a little for this and surprisingly i have got
> correct
> > > >> > results.
> > > >> > i was wondering if this is the correct way. or do i need to create
> > > >> > different
> > > >> > filters for each searcher (or index reader) instance?
> > > >> >
> > > >> > Thanks in advance.
> > > >> >
> > > >> > --
> > > >> > Regards,
> > > >> > Samar
> > > >> >
> > > >>
> > > >
> > > >
> > > >
> > > > --
> > > > Regards,
> > > > Samar
> > > >
> > > >
> > > > ---------------------------------------------------------------------
> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >
> > >
> >
> >
> >
> > --
> > Regards,
> > Samar
> >
>



-- 
Regards,
Samar

--90e6ba476b23dd0e7b0494acf40e--

From java-user-return-47766-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 11:18:42 2010
Return-Path: <java-user-return-47766-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41885 invoked from network); 10 Nov 2010 11:18:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 11:18:42 -0000
Received: (qmail 95742 invoked by uid 500); 10 Nov 2010 11:19:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95285 invoked by uid 500); 10 Nov 2010 11:19:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95273 invoked by uid 99); 10 Nov 2010 11:19:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 11:19:05 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of trewig@mufin.com designates 195.214.216.122 as permitted sender)
Received: from [195.214.216.122] (HELO mx2.de.magix.net) (195.214.216.122)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 11:18:59 +0000
Received: from [192.168.1.18] (port=40194)
	by mx2.de.magix.net with esmtpa (Exim 4.69)
	(envelope-from <trewig@mufin.com>)
	id 1PG8hJ-0003sK-87
	for java-user@lucene.apache.org; Wed, 10 Nov 2010 12:18:37 +0100
Message-ID: <4CDA7F86.4090002@mufin.com>
Date: Wed, 10 Nov 2010 12:18:30 +0100
From: Thomas Rewig <trewig@mufin.com>
Organization: mufin
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.9) Gecko/20100915 Thunderbird/3.1.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: File Handle Leaks During Lucene 3.0.2 Merge
References: <4CA37BD8.8050608@stimulussoft.com>	<006d01cb6003$2f298650$8d7c92f0$@thetaphi.de>	<4CA38A5F.1000100@stimulussoft.com>	<000001cb607d$486b9660$d942c320$@thetaphi.de>	<4CA457AE.8080203@stimulussoft.com>	<AANLkTin43PLTQKt5oLqd9GreaqUdnrR31cumF9BpBtnD@mail.gmail.com>	<4CA45F93.4000503@stimulussoft.com>	<AANLkTikWz0rG3YfEbX_3Og4vD=b8TaW81hGn-RhqXHwe@mail.gmail.com>	<4CA57479.8000405@stimulussoft.com> <AANLkTinmP6i5hMwTAiZPOb221_ieOVNon3sQGThyUiRK@mail.gmail.com>
In-Reply-To: <AANLkTinmP6i5hMwTAiZPOb221_ieOVNon3sQGThyUiRK@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------040909080000020108070503"
X-SA-Exim-Connect-IP: 192.168.1.18
X-SA-Exim-Mail-From: trewig@mufin.com
X-SA-Exim-Scanned: No (on mx2.de.magix.net); SAEximRunCond expanded to false

--------------040909080000020108070503
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

  Hello,
please excuse that I hijack this old thread but I have the same problem 
with the deleted file handles, so I think this is the right place for.

I also integrated the searchManager in our Code and see the file handles 
fluctuate up and down. At first glance the situation seems stable but 
the count of the deleted file handles never drops to zero and I think 
the deleted file handles are constantly rising. About +50 handles stay 
per day by refreshing the searchers every 2 minutes and committing after 
10 minutes. I think some deleted handles remain open after the 
committing, but I could not figure out why. The max value of deleted 
handles until now was about 250, because the Index will be changed after 
a few days. Jamie could you achieve that all deleted handles have been 
removed? Do you have some information how to repair this or is that an 
expected behavior and the amount of the deleted file handles will be 
stable - but first at a amount of 500 or so.

Thanks in advance

Thomas

>> I integrated your
>> SearchManager class into our code, but I am still seeing file handles marked
>> deleted in the index directory. I am running the following command on Linux:
>>
>> sudo watch -n 0 "lsof | grep /var/index | grep deleted | wc -l"
>>
>> Every 0.1s: lsof | grep /var/index | grep deleted |...  Fri Oct  1 09:37:36
>> 2010
>>
>> 54
>>
>> The deleted file handles fluctuate up and down. 54 ->  102 ->  64 ->  32, etc.
>> They seem stable though. Is this to be expected when using NRT search?
>>
>>   I am pretty certain that all Searchers are released at the end of every
>> search. I double checked it at least twenty times.
> SearcherManager always keeps one IndexReader open (the current "live"
> one), so it's expected that this reader is holding open references to
> deleted files if in fact IndexWriter has completed merges since the
> reader was opened. Though.. I would expect you to sometimes see 0
> deleted files in your lsof...
>
> Maybe try this: 1) pause your indexing, 2) reopen the reader (call
> SearcherManager.reopen), and then 3) run lsof again, at which point
> you should see no deleted files still held open.
>
> But note that to truly pause your indexing, you should switch
> (temporarily, for this test) your IndexWriter to the
> SerialMergeScheduler, and then ensure you stop calling IndexWriter ops
> while you run steps 2 and 3.
>
> Mike
>



--------------040909080000020108070503--

From java-user-return-47767-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 12:00:49 2010
Return-Path: <java-user-return-47767-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56196 invoked from network); 10 Nov 2010 12:00:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 12:00:48 -0000
Received: (qmail 45722 invoked by uid 500); 10 Nov 2010 12:01:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45427 invoked by uid 500); 10 Nov 2010 12:01:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45419 invoked by uid 99); 10 Nov 2010 12:01:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 12:01:11 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 12:01:03 +0000
Received: by bwz9 with SMTP id 9so668402bwz.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 04:00:43 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:cc:content-type
         :content-transfer-encoding;
        bh=FJ/jZ0pR3+zK/NHwadvFWfwf2OsKOGUU+rFhwFCzRTw=;
        b=R1HRlf8E7qiqHUpWacSilyOsyUDjwihIgUwdIaQUueknMJSuSlk4eTEFhqoxcjdwQg
         aMIayLDWNn0b01zRNCLI1XcG1rf2EbAAvvD6kuMPST5Ca99xCljCcqn3WHoJ6QY0TREo
         mnjAwP0bu+DIx2fkiQBkIJgemd+dheWCMM690=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :cc:content-type:content-transfer-encoding;
        b=NKXsHpqgXncmWPIVQ4crPi87bf43yGQjd5jKYBaBX6BoYzdt/03Nw9HOUT9qJM4GM7
         EJWr1BfZWq3zEC7Kn5xplZOiXIAyWmOxduPdmaOrqcw0PF4az6191bucK7PSdTNSah15
         /MlYkLBaybTLX+3g1tHXOrl5ozTQ1Z7HPejlU=
Received: by 10.204.103.66 with SMTP id j2mr7785890bko.160.1289390443519; Wed,
 10 Nov 2010 04:00:43 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Wed, 10 Nov 2010 04:00:23 -0800 (PST)
In-Reply-To: <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
 <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
 <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
 <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de> <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 10 Nov 2010 07:00:23 -0500
Message-ID: <AANLkTik6qfB7RUbhVEGRBA19xB+co5hD48_iLWdxewbN@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Cc: David Fertig <dfertig@cymfony.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Mon, Nov 8, 2010 at 6:45 AM, Ian Lea <ian.lea@gmail.com> wrote:
> This does seem extremely odd. =C2=A0David sent me a copy of his index and
> I've played around with it and also written a self-contained RAM index
> program, below, that shows the same problem, namely that if the second
> index has 1000+ docs the one and only doc in the first index is
> incorrectly matched if the search is done with a MultiSearcher. =C2=A0In
> answer to Uwe's question, it works correctly if use a single
> IndexSearcher on top of a MultiReader.

Ian, I haven't looked at this issue in detail yet (only that i can run
your code and reproduce).

I just wanted to say, big thanks for spending the time to boil this
down into a test case.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47768-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 12:25:48 2010
Return-Path: <java-user-return-47768-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73484 invoked from network); 10 Nov 2010 12:25:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 12:25:48 -0000
Received: (qmail 77686 invoked by uid 500); 10 Nov 2010 12:26:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77124 invoked by uid 500); 10 Nov 2010 12:26:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77114 invoked by uid 99); 10 Nov 2010 12:26:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 12:26:12 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 12:26:06 +0000
Received: by fxm7 with SMTP id 7so295310fxm.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 04:25:45 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:cc:content-type
         :content-transfer-encoding;
        bh=OystFFUDk84da/OUmROZYwF+zuAZtQNxnAMFkZU24rU=;
        b=kfgI1JjmrRr/jevyDpEG0ffXbMq8OiGYrrmoI4hdVfNiHAxVgfyaANEQ3y/8zzTiVu
         pV+eYA2Pkz9KOCTK4VdSuPc0hhrC6OoRQiQfMOeTnXwKqyaUrHzxmQY84KrTff/T6u/L
         n4jt8jvGz7n4NomWjLgdPisiHzpvkAyUG2tI4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :cc:content-type:content-transfer-encoding;
        b=w9zHLF2D5mclgBfwQeS7CUu9B4w3W9NjQlWOz0NOESJvKOeDZ3zcEQMorLpBlb4c/m
         6nJpaVcKBXkCMUkDO95klN8CqZeHA3ZSkqs3XazRSoJaxFWhKnfdUgxkrWMcynKFjV6P
         WXj7dWgCPRJ52AF7HDXo+eqzxie/oJLqquafM=
Received: by 10.204.113.74 with SMTP id z10mr7825473bkp.25.1289391944882; Wed,
 10 Nov 2010 04:25:44 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Wed, 10 Nov 2010 04:25:24 -0800 (PST)
In-Reply-To: <AANLkTik6qfB7RUbhVEGRBA19xB+co5hD48_iLWdxewbN@mail.gmail.com>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
 <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
 <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
 <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de> <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com>
 <AANLkTik6qfB7RUbhVEGRBA19xB+co5hD48_iLWdxewbN@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 10 Nov 2010 07:25:24 -0500
Message-ID: <AANLkTim5W6LFUoj4EMzcQ76gW+7WwovReMFF7oB=GRh9@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Cc: David Fertig <dfertig@cymfony.com>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

On Wed, Nov 10, 2010 at 7:00 AM, Robert Muir <rcmuir@gmail.com> wrote:
> On Mon, Nov 8, 2010 at 6:45 AM, Ian Lea <ian.lea@gmail.com> wrote:
>> This does seem extremely odd. =C2=A0David sent me a copy of his index an=
d
>> I've played around with it and also written a self-contained RAM index
>> program, below, that shows the same problem, namely that if the second
>> index has 1000+ docs the one and only doc in the first index is
>> incorrectly matched if the search is done with a MultiSearcher. =C2=A0In
>> answer to Uwe's question, it works correctly if use a single
>> IndexSearcher on top of a MultiReader.
>

I played with your testcase, and it seems the rewrite() implementation
is causing the strangeness you see.
for your query: author:aaa -pubdate:[aaa TO bbb], here are the rewritten fo=
rms:

MultiReader case: +author:aaa -ConstantScore(pubdate:[aaa TO bbb])
MultiSearcher case: (+author:aaa -()) (+author:aaa
-ConstantScore(pubdate:[aaa TO bbb]))

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47769-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 12:54:04 2010
Return-Path: <java-user-return-47769-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87816 invoked from network); 10 Nov 2010 12:54:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 12:54:04 -0000
Received: (qmail 4586 invoked by uid 500); 10 Nov 2010 12:54:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3980 invoked by uid 500); 10 Nov 2010 12:54:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3972 invoked by uid 99); 10 Nov 2010 12:54:29 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 12:54:29 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 12:54:24 +0000
Received: by bwz9 with SMTP id 9so726444bwz.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 04:54:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=gc5DM2QAn2lsZeSlDZzXuu2Iqxu+Vq1XvxL3EDgf/Uw=;
        b=AsQnGC/v3YiN3ccAn7eZiWbdk17x9EZjGSujCHQ5eAf4NQfd2T8aZyhbNl+GeVSWqG
         aoA4dlDSePuo2DNStqHXbSmsgvl0lt2Nb9fQVE/P8OsUc4IyyJH55koRVuILrShYSpI6
         miSQVXrhwXPQQrPdd0+mqyfxM9PUPy/ZBgyxg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=VpoQhCTJo2JyqWJJg3vDWx901CDb+5XCOi0NxYaAo9eKIL69UbPtmDhBGJE2edTfFe
         l92ma5Xi4WBaSVHfkOOoZwvzuVhSa07w6uyotAZOhaGb3sjV5E1djaGa8sAnYXxvWAhh
         WSIcGLweCai9ISr+28fJmOV/kv91drqa47Ymo=
Received: by 10.204.113.74 with SMTP id z10mr7865236bkp.25.1289393643332; Wed,
 10 Nov 2010 04:54:03 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Wed, 10 Nov 2010 04:53:43 -0800 (PST)
In-Reply-To: <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
 <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
 <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com> <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 10 Nov 2010 07:53:43 -0500
Message-ID: <AANLkTineBm816XWig-VY4M38JU9tiyLXVkxg6tFP=AqP@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

On Sun, Nov 7, 2010 at 11:32 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> Does the same happen with a MultiReader on top of both indexes and using a
> single IndexSearcher on top of this MultiReader?
>
> P.S.: How about using NumericField?
>

should be no problem there, it always uses filter rewrite?
the problem is when you are doing boolean multitermrewrite... in how
the query is rewritten and combined from its sub-searchers.

in otherwords, you can also do this to workaround the issue:
qp.setMultiTermRewriteMethod(MultiTermQuery.CONSTANT_SCORE_FILTER_REWRITE);

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47770-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 13:05:14 2010
Return-Path: <java-user-return-47770-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97517 invoked from network); 10 Nov 2010 13:05:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 13:05:14 -0000
Received: (qmail 24388 invoked by uid 500); 10 Nov 2010 13:05:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23985 invoked by uid 500); 10 Nov 2010 13:05:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23963 invoked by uid 99); 10 Nov 2010 13:05:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 13:05:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 13:05:33 +0000
Received: by qyk32 with SMTP id 32so57091qyk.14
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 05:05:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Lrum2w65/tvGwl5WRKldbZ0DOH2Od6djpZzb/+/SNro=;
        b=Nk1uyHMZw2PltxHPZN9a1p8lrGTfvQF+UJfDNXzSsFe3Rgi0FaAIYAwsrzK2iBE1SU
         P1IEhzUd67Yllnf3Mh3P+yz6n8etTjqSerTV/PKmPr+g6gCTUt/9ChkoxIpQE4HmtdCg
         Ex93QQ9gVwU0lKBRSwICmMY9Z6p1KFPMIjD/g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=tt45LSrGgsThh0UCuqpyi4obZz+brpNguwNOIBvv3qU1GB5HorcN/0PqSa3rlIa39/
         Vo96YKTunoWMvRywG5H61Aj/H+VlNHHed505+EOAyl8yG8Wwreb+WG023vK8g6SyyRjA
         APfnwK5ygQMZKUHn34IWESR3irS+VEbM1XRSo=
MIME-Version: 1.0
Received: by 10.224.200.197 with SMTP id ex5mr6997860qab.142.1289394312305;
 Wed, 10 Nov 2010 05:05:12 -0800 (PST)
Received: by 10.229.216.19 with HTTP; Wed, 10 Nov 2010 05:05:12 -0800 (PST)
In-Reply-To: <AANLkTineBm816XWig-VY4M38JU9tiyLXVkxg6tFP=AqP@mail.gmail.com>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
	<AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
	<AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
	<018f01cb7efd$f771ff20$e655fd60$@thetaphi.de>
	<AANLkTineBm816XWig-VY4M38JU9tiyLXVkxg6tFP=AqP@mail.gmail.com>
Date: Wed, 10 Nov 2010 08:05:12 -0500
Message-ID: <AANLkTimWuG0r0rvQeN9Hhoc3v54OSE1EQB-ST56GeYcw@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf3010ed83f5dcf00494b2813c

--20cf3010ed83f5dcf00494b2813c
Content-Type: text/plain; charset=ISO-8859-1

Has anyone opened a JIRA on this?

Erick

On Wed, Nov 10, 2010 at 7:53 AM, Robert Muir <rcmuir@gmail.com> wrote:

> On Sun, Nov 7, 2010 at 11:32 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> > Does the same happen with a MultiReader on top of both indexes and using
> a
> > single IndexSearcher on top of this MultiReader?
> >
> > P.S.: How about using NumericField?
> >
>
> should be no problem there, it always uses filter rewrite?
> the problem is when you are doing boolean multitermrewrite... in how
> the query is rewritten and combined from its sub-searchers.
>
> in otherwords, you can also do this to workaround the issue:
> qp.setMultiTermRewriteMethod(MultiTermQuery.CONSTANT_SCORE_FILTER_REWRITE);
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--20cf3010ed83f5dcf00494b2813c--

From java-user-return-47771-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 14:30:11 2010
Return-Path: <java-user-return-47771-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41222 invoked from network); 10 Nov 2010 14:30:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 14:30:11 -0000
Received: (qmail 34098 invoked by uid 500); 10 Nov 2010 14:30:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34054 invoked by uid 500); 10 Nov 2010 14:30:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34044 invoked by uid 99); 10 Nov 2010 14:30:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 14:30:35 +0000
X-ASF-Spam-Status: No, hits=3.5 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 14:30:28 +0000
Received: by ywp4 with SMTP id 4so436153ywp.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 06:30:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=8ezWUluMRLzPoNJezxHaY0sgq11H9vht2GVKiHRDEx4=;
        b=BC3gZtOy84oeI98fzfuTvV6pCMXRTpIG+PV5xob3EBaeOXBA9/woPL/wd6mMv1ms5o
         o5q7G/a9aS2bzP/mpf5kpcS3uzmbjK+ffJvQeVpUyhkApHDVQrHLWnVwAzyR2x60hDTS
         7cCwRCzuJo6cmjmJKpmCqEkB/H/ZBjcSGpWMc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=d5Pv/AKWnYPwWBef+ykiwyIIM/V7H7je1BKISucMokE5Bl0ylaPBbsCfOfC68keOBF
         XNjvAU0jWPmb0OAuJ/4/nRs/DDSwWT7GPVi1JW4IE3+icraThM+W9QqFIGPlT4dKm7ur
         6hagq7TA6mqIWSyxDF0xUoQDFKP1lOi3LZGbw=
MIME-Version: 1.0
Received: by 10.150.143.21 with SMTP id q21mr13051070ybd.321.1289399406379;
 Wed, 10 Nov 2010 06:30:06 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 10 Nov 2010 06:30:06 -0800 (PST)
In-Reply-To: <1289341822239-1872701.post@n3.nabble.com>
References: <1289341822239-1872701.post@n3.nabble.com>
Date: Wed, 10 Nov 2010 09:30:06 -0500
Message-ID: <AANLkTinAVUHycw664b27Zg_rkbcOVMYJTi82s303Bppn@mail.gmail.com>
Subject: Re: Implementing indexing of Versioned Document Collections
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd56a6497432e0494b3b1f2
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd56a6497432e0494b3b1f2
Content-Type: text/plain; charset=UTF-8

1) You can attach byte array "Payloads" for every occurrence of a term
during indexing. It will be stored at each term position, during indexing,
and then
can be retrieved during searching. You may want to consider taking this
approach rather than writing bitvectors to a text file. If you feel that I
should have read your thesis summary more closely and don't know what the
heck I'm talking about ... then I politely yield :)

2) Can I add a field after I already started writing the document through
IndexWriter?
Yes, you can. You can add new documents that have more fields than the ones
you added in the past. You can also "update" (internally it does a delete
then add) your document to have more fields at a later point in time.
Although in your use-case I simply didn't see why you would need to go back
and add more fields.

3) How would I do this?
a) Well if you are simply adding documents, keep adding new ones with more
fields and lucene won't complain. If you use stored fields then you may
notice inconsistencies when you pull documents in your search results
because some documents will have additional stored fields while others will
not... I am not sure how you would want to handle that.
b) If you are updating, then my personal approach would be to fetch the
document via a search that is unique enough to just get you that one doc
back. In order to do this, people usually make sure to store a unique id
when indexing the document. Then using that document, create a new one with
all the values of the old one plus the new fields you want to add. Deleted
the old doc. Add the new doc.

Good luck!

- Pulkit

On Tue, Nov 9, 2010 at 5:30 PM, Alex vB <mail@avomberg.de> wrote:

>
> Hello everybody,
>
> I would like to implement the paper "Compact Full-Text Indexing of
> Versioned
> Document Collections" [1] from Torsten Suel for my diploma thesis in
> Lucene.
> The basic idea is to create a two-level index structure. On the first level
> a document is identified by document ID with a posting list entry if the
> term exists at least in one version. For every posting on the first level
> with term t we have a bitvector on the second one. These bitvectors contain
> as many bits as there are versions for one document, and bit i is set to 1
> if version i contains term t or otherwise it remains 0.
>
> http://lucene.472066.n3.nabble.com/file/n1872701/Unbenannt_1.jpg
>
> This little picture is just for demonstration purposes. It shows a posting
> list for the term car and is composed of 4 document IDs. If a hit is found
> in document 6 another look-up is needed on the second level to get the
> corresponding versions (version 1, 5, 7, 8, 9, 10 from 10 versions at all).
>
> At the moment I am using wikipedia (simplewiki dump) as source with a
> SAXParser and can resolve each document with all its versions from the XML
> file (Fields are Title, ID, Content(seperated for each version)). My
> problem
> is that I am unsure how to connect the second level with the first one and
> how to store it. The key points that are needed:
> - Information from posting list creation to create the bitvector (term ->
> doc -> versions)
> - Storing the bitvectors
> - Implementing search on second level
>
> For the first steps I disabled term frequencies and positions because the
> paper isn't handling them. I would be happy to get any running version at
> all. :)
> At the moment I can create bitvectors for the documents. I realized this
> with a HashMap<String, BitSet> in TermsHashPerField where I grab the
> current
> term in add() (I hope this is the correct location for retrieving the
> inverted lists terms). Anyway I can create the corret bitvectors and write
> them into a text file.
> Excerpt of bitVectors from article "April":
> april :
>
> 1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101101110111111111111111111
> never :
>
> 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000
> ayriway :
>
> 0000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111101101110111111111111111111
> inclusive :
>
> 1111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
>
> Next step would be storing all bitvecors in the index. At first glance I
> like to use an extra field to store the created bitvectors permanent in the
> index. It seems to be the easiest way for a first implementation without
> accessing the low level functions of Lucene. Can I add a field after I
> already started writing the document through IndexWriter? How would I do
> this? Or are there any other suggestions for storing? Another idea is to
> expand the index format of Lucene but this seems a little bit to difficult
> for me. Maybe I could write these information into my own file. Could
> anybody point me to the right direction? :)
>
> Currently I am focusing on storing and try to extend Lucenes search after
> the former step.
>
> THX in advance & best regards
> Alex
>
> [1] http://cis.poly.edu/suel/
> --
> View this message in context:
> http://lucene.472066.n3.nabble.com/Implementing-indexing-of-Versioned-Document-Collections-tp1872701p1872701.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd56a6497432e0494b3b1f2--

From java-user-return-47772-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 14:38:10 2010
Return-Path: <java-user-return-47772-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45913 invoked from network); 10 Nov 2010 14:38:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 14:38:10 -0000
Received: (qmail 50833 invoked by uid 500); 10 Nov 2010 14:38:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50615 invoked by uid 500); 10 Nov 2010 14:38:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50607 invoked by uid 99); 10 Nov 2010 14:38:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 14:38:39 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.161.176 as permitted sender)
Received: from [209.85.161.176] (HELO mail-gx0-f176.google.com) (209.85.161.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 14:38:31 +0000
Received: by gxk4 with SMTP id 4so434974gxk.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 06:38:10 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=ib7h7khwItpKHIFaEXvQ/iUA1Zewo1W2i45/DOVn780=;
        b=fYs1ybhuGRveNqU7m52aVzoOeBzLsTr+b5uHX/vQpzj76YM4Rl+HRQcVDe4pNC2W+s
         X+o1hXDq2JbrNCWfg7YpfaCZX0f4kzNeLGmfKhBdbQPVIHVfCHRfLvvYeUBXduZhQPCB
         5v/4NaxByOCz8P9HTYv79sGtw9HbabtOxbdYg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=jQhcbMNbQBnB7RjXdtM5HiVrGDok8CPIrFPdUaVj9UKD4UC0a85YX1IlXmKeuIkPGU
         i2kamCqpwKz/r0eiZIVuFg6bVNTXgZ5045IlCNvZHkqmS1615aG43jccEEXNLJDHW2Sa
         1andSc5lHoIfOPSqVmVKZ1JOJyRGZoe/X1oPU=
MIME-Version: 1.0
Received: by 10.150.52.18 with SMTP id z18mr7148887ybz.378.1289399889631; Wed,
 10 Nov 2010 06:38:09 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 10 Nov 2010 06:38:09 -0800 (PST)
Date: Wed, 10 Nov 2010 09:38:09 -0500
Message-ID: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
Subject: IndexWriters and write locks
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd6e7e0651ba00494b3ce20
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd6e7e0651ba00494b3ce20
Content-Type: text/plain; charset=UTF-8

Hello,

1) On Windows, I often shut down my application server (which has active
IndexWriters open) using the ctrl+c keys.
2) I inspect my directories on the file system I see that the write.lock
file is still there.
3) I start the app server again, and do some operations that would require
IndexWriters to write to the same directories again and it works!

I don't understand why I do not run into any exceptions?
I mean there is already a lock file present which should prevent the
IndexWriters from getting access to the directories ... no?
I should be happy but I'm not because other folks are able to get exceptions
when they bounce their servers an I'm unable to reproduce the problem and I
can't help them.

Any clues? Anyone?

Thank You,
- Pulkit

--000e0cd6e7e0651ba00494b3ce20--

From java-user-return-47773-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 16:21:27 2010
Return-Path: <java-user-return-47773-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14594 invoked from network); 10 Nov 2010 16:21:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 16:21:27 -0000
Received: (qmail 62712 invoked by uid 500); 10 Nov 2010 16:21:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62657 invoked by uid 500); 10 Nov 2010 16:21:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62649 invoked by uid 99); 10 Nov 2010 16:21:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 16:21:53 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.215.48] (HELO mail-ew0-f48.google.com) (209.85.215.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 16:21:46 +0000
Received: by ewy3 with SMTP id 3so406977ewy.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 08:21:25 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.187.82 with SMTP id x60mr1711051wem.9.1289406084824; Wed,
 10 Nov 2010 08:21:24 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Wed, 10 Nov 2010 08:21:24 -0800 (PST)
In-Reply-To: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
Date: Wed, 10 Nov 2010 11:21:24 -0500
Message-ID: <AANLkTinspCo-4F8pntes8Gbkp1rs67YE5cppFYcEGPo-@mail.gmail.com>
Subject: Re: IndexWriters and write locks
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Likely you are using NativeFSLockFactory?

In which case, a leftover lock file does not mean the index is in fact
locked, since the OS will [correctly] release the lock on process
exit.

Mike

On Wed, Nov 10, 2010 at 9:38 AM, Pulkit Singhal <pulkitsinghal@gmail.com> wrote:
> Hello,
>
> 1) On Windows, I often shut down my application server (which has active
> IndexWriters open) using the ctrl+c keys.
> 2) I inspect my directories on the file system I see that the write.lock
> file is still there.
> 3) I start the app server again, and do some operations that would require
> IndexWriters to write to the same directories again and it works!
>
> I don't understand why I do not run into any exceptions?
> I mean there is already a lock file present which should prevent the
> IndexWriters from getting access to the directories ... no?
> I should be happy but I'm not because other folks are able to get exceptions
> when they bounce their servers an I'm unable to reproduce the problem and I
> can't help them.
>
> Any clues? Anyone?
>
> Thank You,
> - Pulkit
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47774-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 16:24:23 2010
Return-Path: <java-user-return-47774-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16376 invoked from network); 10 Nov 2010 16:24:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 16:24:23 -0000
Received: (qmail 72362 invoked by uid 500); 10 Nov 2010 16:24:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72310 invoked by uid 500); 10 Nov 2010 16:24:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72302 invoked by uid 99); 10 Nov 2010 16:24:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 16:24:52 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 16:24:46 +0000
Received: by gyf2 with SMTP id 2so538584gyf.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 08:24:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=ektFqYcVTlIlCnhDgIU5L3PJ5oLHBn8mrSNI14AdqHU=;
        b=EhCMlM2cLWrQ/K/Gs8gJzW+Ms5mVPT39T8zG3WGncGyPf3quxnePhrApNS+zf8dvFK
         VBBKDx1m8hTQcOLw5tSf+LiRK8NzTPBWZjhWx/VTxqUi1KxBZrN7StF7yx2dfxA3Loib
         BrkUD3TeeL6fo+o8SQM+q9+3JTM4T6y+RZBF8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=aamP6jQBhSX+8GKdRYxAtDV0FBU/Fi/KFIK3w+eaD9w2mQvF71jiL41qJ/EfbH5zLF
         TiRwFXnl1H7L5e/odmTkcoauL9tus0ger45Lfu7pstIQ4Suo1IFQ9oIEHnJuV19sRd7M
         ORwkMmkgGHL+eEdbNq2YEaoawWdWtB9tTXWF8=
Received: by 10.204.115.73 with SMTP id h9mr970136bkq.52.1289406264809; Wed,
 10 Nov 2010 08:24:24 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Wed, 10 Nov 2010 08:24:04 -0800 (PST)
In-Reply-To: <AANLkTimWuG0r0rvQeN9Hhoc3v54OSE1EQB-ST56GeYcw@mail.gmail.com>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
 <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
 <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
 <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de> <AANLkTineBm816XWig-VY4M38JU9tiyLXVkxg6tFP=AqP@mail.gmail.com>
 <AANLkTimWuG0r0rvQeN9Hhoc3v54OSE1EQB-ST56GeYcw@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 10 Nov 2010 11:24:04 -0500
Message-ID: <AANLkTimuLNXq0L2k9x5w89G9KzoBuL+__zHhoh6E0=aN@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

On Wed, Nov 10, 2010 at 8:05 AM, Erick Erickson <erickerickson@gmail.com> wrote:
> Has anyone opened a JIRA on this?
>

I'm not sure if we should call it a bug or not (in this particular
example, it would be nice if we could find a fix i think though).

Because in general we can't guarantee MultiSearcher(Searcher...) will
return the same results as MultiReader for MultiTermQueries like
RangeQuery... it depends on the rewrite method.

For the Filter rewrite, i think they will be mostly or always the same.

But when rewriting to booleanqueries, its going to be inconsistent by
definition, since the rewrite happens for each sub and then is
combined... but this isn't necessary equivalent to performing the
rewrite on a single MultiReader, especially when the rewrite method
has some notion of "top-N" even if N=max boolean clause count.

the inconsistencies i'm sure will revolve around things like exceeding
max clause count (probably even with CONSTANT_SCORE_AUTO!!!),
combine()ing queries that are really top-N rewrites (e.g. fuzzy or
using toptermsrewrite anywhere else), and maybe corner cases like your
example where the multitermquery rewrites to a simpler form for an
individual sub.

Maybe we should just deprecate and remove MultiSearcher? Why not just
use a MultiReader instead?

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47775-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 17:36:22 2010
Return-Path: <java-user-return-47775-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55962 invoked from network); 10 Nov 2010 17:36:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 17:36:22 -0000
Received: (qmail 10187 invoked by uid 500); 10 Nov 2010 17:36:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10152 invoked by uid 500); 10 Nov 2010 17:36:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10144 invoked by uid 99); 10 Nov 2010 17:36:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 17:36:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 17:36:44 +0000
Received: by ywp4 with SMTP id 4so622283ywp.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 09:36:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=iO8NzULsY5fUHQjMVN2CTLrTfRP1z215Z/Wi+H3mOZw=;
        b=PPrbduCwrnokuZgOmzPwknesFdSgVBySn0Ec623BW5fC2Xwgg4CgNGPur0vUK5rw3U
         VDSJg3H7cyQEtx4ibW1LHYWNxIMj1gFRa7BCWVKaorL+Gh2ovTaX1cPmoK+MxhSoSH02
         lzGmopxxEsvFUYiffqq5Ogy8xa0URWeJPzLWE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=jsrHTDVMCAMnMF1nCAMihBIjR6oVZJl22Z6v4ioqzHsLENRAI7Q8VntUleykcsyAnq
         diNahDc6ptyyTs3s86NGEE5gctgdqeWSDCXsehaMaQSoF7qZqxtkS3vaLE0+AdhXqABD
         +DtrTQLDpdYDBlxZJz1mFiZebOFG832aF5+cQ=
MIME-Version: 1.0
Received: by 10.151.48.9 with SMTP id a9mr5885864ybk.150.1289410583419; Wed,
 10 Nov 2010 09:36:23 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 10 Nov 2010 09:36:23 -0800 (PST)
In-Reply-To: <AANLkTinspCo-4F8pntes8Gbkp1rs67YE5cppFYcEGPo-@mail.gmail.com>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
	<AANLkTinspCo-4F8pntes8Gbkp1rs67YE5cppFYcEGPo-@mail.gmail.com>
Date: Wed, 10 Nov 2010 12:36:23 -0500
Message-ID: <AANLkTi=ow9nr=063oh4u9F9YhgZvb0JGjaY3c45_jOUw@mail.gmail.com>
Subject: Re: IndexWriters and write locks
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015175110a8cb5d220494b64b5a
X-Virus-Checked: Checked by ClamAV on apache.org

--0015175110a8cb5d220494b64b5a
Content-Type: text/plain; charset=UTF-8

I do not actually take the trouble to specify what Lock Factory to use,
hmmm.

Are you suggesting that because I'm using FSDirectory.open() in my code, I
get a locking scheme that works ... while on other machine for other folks,
they get one that runs into issues and throws
java.nio.channels.OverlappingFileLockException?

- Pulkit

On Wed, Nov 10, 2010 at 11:21 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Likely you are using NativeFSLockFactory?
>
> In which case, a leftover lock file does not mean the index is in fact
> locked, since the OS will [correctly] release the lock on process
> exit.
>
> Mike
>
> On Wed, Nov 10, 2010 at 9:38 AM, Pulkit Singhal <pulkitsinghal@gmail.com>
> wrote:
> > Hello,
> >
> > 1) On Windows, I often shut down my application server (which has active
> > IndexWriters open) using the ctrl+c keys.
> > 2) I inspect my directories on the file system I see that the write.lock
> > file is still there.
> > 3) I start the app server again, and do some operations that would
> require
> > IndexWriters to write to the same directories again and it works!
> >
> > I don't understand why I do not run into any exceptions?
> > I mean there is already a lock file present which should prevent the
> > IndexWriters from getting access to the directories ... no?
> > I should be happy but I'm not because other folks are able to get
> exceptions
> > when they bounce their servers an I'm unable to reproduce the problem and
> I
> > can't help them.
> >
> > Any clues? Anyone?
> >
> > Thank You,
> > - Pulkit
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0015175110a8cb5d220494b64b5a--

From java-user-return-47776-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 17:57:40 2010
Return-Path: <java-user-return-47776-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67034 invoked from network); 10 Nov 2010 17:57:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 17:57:40 -0000
Received: (qmail 57094 invoked by uid 500); 10 Nov 2010 17:58:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57038 invoked by uid 500); 10 Nov 2010 17:58:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57030 invoked by uid 99); 10 Nov 2010 17:58:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 17:58:09 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 17:58:01 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id A46B645FDFC
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 18:57:41 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Sgz3xRZyqvto for <java-user@lucene.apache.org>;
	Wed, 10 Nov 2010 18:57:36 +0100 (CET)
Received: from VEGA (p5DD07B48.dip.t-dialin.net [93.208.123.72])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 76A2845FD3E
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 18:57:36 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
In-Reply-To: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
Subject: RE: IndexWriters and write locks
Date: Wed, 10 Nov 2010 18:57:46 +0100
Message-ID: <001201cb8100$c804ec20$580ec460$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQJZ1XQ01k4Rm2YoRc0ZE7ncWOkAYZJOJUzw
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

This is because Lucene uses Native Filesystem Locks. The lock file =
itself is just a placeholder which is not cleaned up on Ctrl-C. The lock =
is not the file itself, its *on* the file.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> Sent: Wednesday, November 10, 2010 3:38 PM
> To: java-user@lucene.apache.org
> Subject: IndexWriters and write locks
>=20
> Hello,
>=20
> 1) On Windows, I often shut down my application server (which has =
active
> IndexWriters open) using the ctrl+c keys.
> 2) I inspect my directories on the file system I see that the =
write.lock file is still
> there.
> 3) I start the app server again, and do some operations that would =
require
> IndexWriters to write to the same directories again and it works!
>=20
> I don't understand why I do not run into any exceptions?
> I mean there is already a lock file present which should prevent the
> IndexWriters from getting access to the directories ... no?
> I should be happy but I'm not because other folks are able to get =
exceptions
> when they bounce their servers an I'm unable to reproduce the problem =
and I
> can't help them.
>=20
> Any clues? Anyone?
>=20
> Thank You,
> - Pulkit


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47777-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 18:04:50 2010
Return-Path: <java-user-return-47777-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71212 invoked from network); 10 Nov 2010 18:04:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 18:04:49 -0000
Received: (qmail 71743 invoked by uid 500); 10 Nov 2010 18:05:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71707 invoked by uid 500); 10 Nov 2010 18:05:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71699 invoked by uid 99); 10 Nov 2010 18:05:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:05:13 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:05:07 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 58DD145FF1A
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 19:04:46 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id iYyAg3JKFUDF for <java-user@lucene.apache.org>;
	Wed, 10 Nov 2010 19:04:41 +0100 (CET)
Received: from VEGA (p5DD07B48.dip.t-dialin.net [93.208.123.72])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 26DFC45FF12
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 19:04:41 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com> <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com> <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com> <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de> <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com> <AANLkTik6qfB7RUbhVEGRBA19xB+co5hD48_iLWdxewbN@mail.gmail.com> <AANLkTim5W6LFUoj4EMzcQ76gW+7WwovReMFF7oB=GRh9@mail.gmail.com>
In-Reply-To: <AANLkTim5W6LFUoj4EMzcQ76gW+7WwovReMFF7oB=GRh9@mail.gmail.com>
Subject: RE: Search returning documents matching a NOT range
Date: Wed, 10 Nov 2010 19:04:50 +0100
Message-ID: <001301cb8101$c5400a50$4fc01ef0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQIFBEM7LuaSiXYA0QxlDQQjTS0N4gEvKa5aASf9Jy0C0vYl3AI0wNULAUVUCl8BfNITVAK+ePHuAUjBD7OShrfn8A==
Content-Language: de

I know where the bug is...

The problem has nothing to to with MultiSearcher at all, its just the =
rewritten query. Because (as Robert said) MultiSearcher rewrites per =
index, the rewritten query is different for each sub-index. The =
problems, Robert mentioned only affect scoring (which is different). As =
Range is ConstantScore it should still return same documents.

The problem here seems to be that in the first searcher der Boolean =
rewrites to an empty BooleanQuery(), which is fine for ranges that hit =
no terms at all (this is also supported and works). The problem seems to =
be that a SHOULD_NOT clause on an empty Boolean query produces this bug!

I will try to reproduce with an easy testcase using a single IndexReader =
and single IndexSearcher.

The reason why you sometimes don't see the problem is, that auto rewrite =
not always rewrites to BooleanQuery.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Robert Muir [mailto:rcmuir@gmail.com]
> Sent: Wednesday, November 10, 2010 1:25 PM
> To: java-user@lucene.apache.org
> Cc: David Fertig
> Subject: Re: Search returning documents matching a NOT range
>=20
> On Wed, Nov 10, 2010 at 7:00 AM, Robert Muir <rcmuir@gmail.com> wrote:
> > On Mon, Nov 8, 2010 at 6:45 AM, Ian Lea <ian.lea@gmail.com> wrote:
> >> This does seem extremely odd.  David sent me a copy of his index =
and
> >> I've played around with it and also written a self-contained RAM
> >> index program, below, that shows the same problem, namely that if =
the
> >> second index has 1000+ docs the one and only doc in the first index
> >> is incorrectly matched if the search is done with a MultiSearcher.
> >> In answer to Uwe's question, it works correctly if use a single
> >> IndexSearcher on top of a MultiReader.
> >
>=20
> I played with your testcase, and it seems the rewrite() implementation =
is
> causing the strangeness you see.
> for your query: author:aaa -pubdate:[aaa TO bbb], here are the =
rewritten
> forms:
>=20
> MultiReader case: +author:aaa -ConstantScore(pubdate:[aaa TO bbb])
> MultiSearcher case: (+author:aaa -()) (+author:aaa -
> ConstantScore(pubdate:[aaa TO bbb]))
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47778-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 18:14:03 2010
Return-Path: <java-user-return-47778-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82186 invoked from network); 10 Nov 2010 18:14:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 18:14:03 -0000
Received: (qmail 87237 invoked by uid 500); 10 Nov 2010 18:14:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87200 invoked by uid 500); 10 Nov 2010 18:14:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87192 invoked by uid 99); 10 Nov 2010 18:14:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:14:30 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of dianpuma@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:14:23 +0000
Received: by iwn7 with SMTP id 7so1126633iwn.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 10:14:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=psIs3/EiCe/gaewwBkoa+C55FZy8tbJhlhbomh44LMI=;
        b=OiHqzmDaOPb0NkGeMNw6aEa6QrRafrz6Qs8Nv++euv/P4h3a+f+DUm9hrbMp+/5uKF
         hlqt3LO96I4Nm8LTpACTV8vkghgOVaF2wRbSAfPF14PhJlMpDMGnJL5H/UpN28DRQel5
         vIayuwlhaV6sssKaVt80cT2q+U5uYYm1ulFOA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=TUGzY/S1MFpErtU3PFWwvJSZ5wZB+qWP5HsqcPF5S7nSJ9mkfF3xGqhLn9qaRlaMNO
         keS6/vxJ9c5hC1kY8boRwk13JRcFGOfsTxGjjMD7FBFvx9nULRR4Zwn6l6Dq4YxF1HOK
         22C6q7/IypSx6bqROq/FgDmcW+wKxRKO1Pjm0=
MIME-Version: 1.0
Received: by 10.231.157.14 with SMTP id z14mr6879438ibw.85.1289412842026; Wed,
 10 Nov 2010 10:14:02 -0800 (PST)
Received: by 10.231.148.205 with HTTP; Wed, 10 Nov 2010 10:14:01 -0800 (PST)
Date: Thu, 11 Nov 2010 01:14:01 +0700
Message-ID: <AANLkTik51YjBe6opUZ2aFdgFsn88OcoK0UCDwRG29CS4@mail.gmail.com>
Subject: How to DeleteDocuments from Index?
From: dian puma <dianpuma@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hi All,

I'm struggling with Lucene on deleting a specific document from the index.
I've read the book Lucene in Action to see how to do it.
There are 2 ways to delete documents from index, using
IndexWriter.deleteDocuments(term) OR IndexReader.deleteDocuments.
CMIIW

FYI, I use PHP/Java Bridge and Lucene 2.2,
But my code below didn't work, generating error:

Exception occured: [[o:Exception]:"java.lang.Exception: Invoke failed:
[[o:IndexWriter]]->deleteDocuments([o:Term]). Cause:
java.lang.NoSuchMethodException: deleteDocuments([o:Term]).
Candidates: [] Responsible VM: 1.6.0_20@http://java.sun.com/" at: #-5
php.java.bridge.JavaBridge.Invoke(JavaBridge.java:1045) #-4
php.java.bridge.Request.handleRequest(Request.java:342) #-3
php.java.bridge.Request.handleRequests(Request.java:388) #0
Java.inc(161): java_ThrowExceptionProxyFactory->getProxy(4, true) #1
Java.inc(314): java_Arg->getResult(true) #2 Java.inc(320):
java_Client->getWrappedResult(true) #3 Java.inc(499):
java_Client->getResult() #4 Java.inc(743):
java_Client->invokeMethod(2, 'deleteDocuments', Array) #5
Java.inc(861): java_JavaProxy->__call('deleteDocuments', Array) #6
[internal function]: Java->__call('deleteDocuments', Array)

============= snippet code with IndexWriter =============
$directory = dirname(__FILE__)."/../indexLucene/";
$path = getcwd()."/txtfiles/testing.txt";

if (strlen($path) > 0) {
	//delete
    	echo "Delete [".$path."]</br>";
	$analyzer_idx = new
Java('org.apache.lucene.analysis.standard.StandardAnalyzer');
  	$writer_idx = new
java("org.apache.lucene.index.IndexWriter",$directory, $analyzer_idx,
false);
	echo java_values($writer_idx->docCount());
	$term = new Java('org.apache.lucene.index.Term','pathfile',$path);
	$writer_idx->deleteDocuments($term);
	$writer_idx->close();
}//end if


Then, I tried to use IndexReader, instead.
But, even worst. It failed to echo the numDocs or just to close the reader.

error message:
Exception occured: [[o:Exception]:"java.lang.Exception: Invoke failed:
[[c:IndexReader]]->numDocs. Cause: java.lang.NoSuchMethodException:
numDocs()........................

======= snippet code with IndexReader ========
$directory = dirname(__FILE__)."/../indexLucene/";
$path = getcwd()."/txtfiles/testing.txt";
$reader = new Java('org.apache.lucene.index.IndexReader');
$reader->open($directory);
//echo java_values($reader->numDocs());
$reader->close();

Hopefully someone would help me for this.
Thanks in advance
--
Dian Puma

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47779-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 18:19:42 2010
Return-Path: <java-user-return-47779-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83554 invoked from network); 10 Nov 2010 18:19:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 18:19:42 -0000
Received: (qmail 95322 invoked by uid 500); 10 Nov 2010 18:20:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95276 invoked by uid 500); 10 Nov 2010 18:20:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95268 invoked by uid 99); 10 Nov 2010 18:20:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:20:09 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:20:03 +0000
Received: by bwz9 with SMTP id 9so1056661bwz.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 10:19:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=SJh8UCTbpuqagdTgS+4LyaVO2A9fgS0K4ILLIETI4vM=;
        b=jkPPn2MV799ANfRO/zdVbvwmRx0yH1XpU/+U3amCyYvJmnLdw+kEDgpIZ9KfRFSe9w
         RwypJCGpLkPJ5C9JAX8n3/TsKMlIJ1gPGULFuN5LxPzmoRPb+u+FlQJXexdPU/SrXEO2
         W3astN2iG4k45oidIUe8FdBWAXODtT5KVw/p0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=IkkcMSD9Fo1I3dInwsqA1SIQunyR74F0dGcmNcu3qcaGDpfQ0Y3sK39IRE94SsGn9G
         U/KWu5yBZGIpqD5eRb2w8EZcwxIJG7cIsDA8xexDc8O1DT48EcZwPCwqwxOSLPykKEYN
         67M3qvG20j6cayLy3Q02nVu1i8GHEJrioNlOM=
Received: by 10.204.72.80 with SMTP id l16mr8369655bkj.133.1289413182776; Wed,
 10 Nov 2010 10:19:42 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Wed, 10 Nov 2010 10:19:22 -0800 (PST)
In-Reply-To: <001301cb8101$c5400a50$4fc01ef0$@thetaphi.de>
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com>
 <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com>
 <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com>
 <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de> <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com>
 <AANLkTik6qfB7RUbhVEGRBA19xB+co5hD48_iLWdxewbN@mail.gmail.com>
 <AANLkTim5W6LFUoj4EMzcQ76gW+7WwovReMFF7oB=GRh9@mail.gmail.com> <001301cb8101$c5400a50$4fc01ef0$@thetaphi.de>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 10 Nov 2010 13:19:22 -0500
Message-ID: <AANLkTimqE1DHECdiH03TRm4m21MNNBDgCK=0Cz3Yqqum@mail.gmail.com>
Subject: Re: Search returning documents matching a NOT range
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Wed, Nov 10, 2010 at 1:04 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> I know where the bug is...
>
> The problem has nothing to to with MultiSearcher at all, its just the rew=
ritten query. Because (as Robert said) MultiSearcher rewrites per index, th=
e rewritten query is different for each sub-index. The problems, Robert men=
tioned only affect scoring (which is different). As Range is ConstantScore =
it should still return same documents.
>

I disagree, it really is because of how MultiSearcher combine()s the
queries from the subsearchers.

and the problems again don't affect scoring:

* you might hit boolean max clause count with AUTO if you use
MultiSearcher (e.g. 5 subs return 250 terms each and the total unique
across all in combine() is > 1024). In this case the query won't work
at all, but it works with MultiReader. And this is really bad, because
i think we document you will not hit this boolean max clause count
with AUTO, and we default to it for this reason.

* fuzzyquery etc will return completely different documents, or if you
manually use TopTermsRewrite for some other query.

none of these problems happen if you use MultiReader. This is why i
suggested removing MultiSearcher, at the least, if you use this thing
i think you should explicitly set FILTER_REWRITE.

> The problem here seems to be that in the first searcher der Boolean rewri=
tes to an empty BooleanQuery(), which is fine for ranges that hit no terms =
at all (this is also supported and works). The problem seems to be that a S=
HOULD_NOT clause on an empty Boolean query produces this bug!

yes, i'm not sure this is the "problem", i think the problem is in
combine(), but this is the root cause.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47780-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 18:57:05 2010
Return-Path: <java-user-return-47780-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5823 invoked from network); 10 Nov 2010 18:57:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 18:57:04 -0000
Received: (qmail 65128 invoked by uid 500); 10 Nov 2010 18:57:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65102 invoked by uid 500); 10 Nov 2010 18:57:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65094 invoked by uid 99); 10 Nov 2010 18:57:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:57:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.161.176 as permitted sender)
Received: from [209.85.161.176] (HELO mail-gx0-f176.google.com) (209.85.161.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 18:57:27 +0000
Received: by gxk4 with SMTP id 4so695739gxk.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 10:57:06 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=a137crbJIy8Jwi56jIpasUA9rRWQyUNIO2FAnvUANwc=;
        b=adiUBze7O2IJPQCzqPx3AEKbo3QY1gtrvmXSNs8sm7qKDWcKOD6gaYOy0smnVC8ohp
         g59EGAlOgxT7nXU7meZAv03VeomUAkxQncbKQYbjJckpp1ktvUYWw5SVWD3s+wOwF+MK
         r/ldtjXChStJD3G19Zi8OT3HGyXrsnpnRG2OI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n9Y6nOrZvR35JnRMnKNcf+QwHe8htTB6JMn1X2MAfGWnhxBL+1X/e6InAoWhYKIurD
         rOyfRNCTw54Inn+9RaI6G2qA8hLfRVr2Op0unCsNnvR9bZOcQlotXrJlQMOZeaabXXzW
         mxJfr3/bD8ZpbZWiZrY0jUloV5t9ZTXAFp/J4=
MIME-Version: 1.0
Received: by 10.151.48.9 with SMTP id a9mr63731ybk.150.1289415424833; Wed, 10
 Nov 2010 10:57:04 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 10 Nov 2010 10:57:04 -0800 (PST)
In-Reply-To: <001201cb8100$c804ec20$580ec460$@thetaphi.de>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
	<001201cb8100$c804ec20$580ec460$@thetaphi.de>
Date: Wed, 10 Nov 2010 13:57:04 -0500
Message-ID: <AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
Subject: Re: IndexWriters and write locks
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015175110a85d7a480494b76cda
X-Virus-Checked: Checked by ClamAV on apache.org

--0015175110a85d7a480494b76cda
Content-Type: text/plain; charset=UTF-8

Thanks Uwe, that helps explain why the lock file is still there.

The last piece of the puzzle is why someone may see exceptions such as the
following from time to time:

java.nio.channels.OverlappingFileLockException
    at
sun.nio.ch.FileChannelImpl$SharedFileLockTable.checkList(FileChannelImpl.java:1176)
    at
sun.nio.ch.FileChannelImpl$SharedFileLockTable.add(FileChannelImpl.java:1078)
    at sun.nio.ch.FileChannelImpl.tryLock(FileChannelImpl.java:878)
    at java.nio.channels.FileChannel.tryLock(FileChannel.java:962)
    at
org.apache.lucene.store.NativeFSLock.obtain(NativeFSLockFactory.java:236)
    at org.apache.lucene.store.Lock.obtain(Lock.java:72)
    at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1041)
    at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:864)

I suppose this means that the OS itself hasn't released the lock even after
I shut down my application server and restarted it.
Am I right?

Or is there something else that can possibly be the culprit (in anyone's
experience) that I can investigate?

- Pulkit

On Wed, Nov 10, 2010 at 12:57 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> This is because Lucene uses Native Filesystem Locks. The lock file itself
> is just a placeholder which is not cleaned up on Ctrl-C. The lock is not the
> file itself, its *on* the file.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
> > -----Original Message-----
> > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > Sent: Wednesday, November 10, 2010 3:38 PM
> > To: java-user@lucene.apache.org
> > Subject: IndexWriters and write locks
> >
> > Hello,
> >
> > 1) On Windows, I often shut down my application server (which has active
> > IndexWriters open) using the ctrl+c keys.
> > 2) I inspect my directories on the file system I see that the write.lock
> file is still
> > there.
> > 3) I start the app server again, and do some operations that would
> require
> > IndexWriters to write to the same directories again and it works!
> >
> > I don't understand why I do not run into any exceptions?
> > I mean there is already a lock file present which should prevent the
> > IndexWriters from getting access to the directories ... no?
> > I should be happy but I'm not because other folks are able to get
> exceptions
> > when they bounce their servers an I'm unable to reproduce the problem and
> I
> > can't help them.
> >
> > Any clues? Anyone?
> >
> > Thank You,
> > - Pulkit
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0015175110a85d7a480494b76cda--

From java-user-return-47781-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 19:40:48 2010
Return-Path: <java-user-return-47781-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29902 invoked from network); 10 Nov 2010 19:40:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 19:40:48 -0000
Received: (qmail 52867 invoked by uid 500); 10 Nov 2010 19:41:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52828 invoked by uid 500); 10 Nov 2010 19:41:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52819 invoked by uid 99); 10 Nov 2010 19:41:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 19:41:17 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 19:41:09 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id E397845FE33
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 20:40:48 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id EO7GfO5rypX5 for <java-user@lucene.apache.org>;
	Wed, 10 Nov 2010 20:40:43 +0100 (CET)
Received: from VEGA (p5DD07B48.dip.t-dialin.net [93.208.123.72])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id A665945FA12
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 20:40:43 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>	<001201cb8100$c804ec20$580ec460$@thetaphi.de> <AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
In-Reply-To: <AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
Subject: RE: IndexWriters and write locks
Date: Wed, 10 Nov 2010 20:40:53 +0100
Message-ID: <003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQJZ1XQ01k4Rm2YoRc0ZE7ncWOkAYQLSCZXVAcY/7/WSKbEMQA==
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Are you using NFS as filesystem? NFS is incompatible to lucene :-)

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> Sent: Wednesday, November 10, 2010 7:57 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriters and write locks
>=20
> Thanks Uwe, that helps explain why the lock file is still there.
>=20
> The last piece of the puzzle is why someone may see exceptions such as =
the
> following from time to time:
>=20
> java.nio.channels.OverlappingFileLockException
>     at
> =
sun.nio.ch.FileChannelImpl$SharedFileLockTable.checkList(FileChannelImpl.=
java
> :1176)
>     at
> =
sun.nio.ch.FileChannelImpl$SharedFileLockTable.add(FileChannelImpl.java:1=
07
> 8)
>     at sun.nio.ch.FileChannelImpl.tryLock(FileChannelImpl.java:878)
>     at java.nio.channels.FileChannel.tryLock(FileChannel.java:962)
>     at
> =
org.apache.lucene.store.NativeFSLock.obtain(NativeFSLockFactory.java:236)=

>     at org.apache.lucene.store.Lock.obtain(Lock.java:72)
>     at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1041)
>     at =
org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:864)
>=20
> I suppose this means that the OS itself hasn't released the lock even =
after I shut
> down my application server and restarted it.
> Am I right?
>=20
> Or is there something else that can possibly be the culprit (in =
anyone's
> experience) that I can investigate?
>=20
> - Pulkit
>=20
> On Wed, Nov 10, 2010 at 12:57 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>=20
> > This is because Lucene uses Native Filesystem Locks. The lock file
> > itself is just a placeholder which is not cleaned up on Ctrl-C. The
> > lock is not the file itself, its *on* the file.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> > > -----Original Message-----
> > > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > > Sent: Wednesday, November 10, 2010 3:38 PM
> > > To: java-user@lucene.apache.org
> > > Subject: IndexWriters and write locks
> > >
> > > Hello,
> > >
> > > 1) On Windows, I often shut down my application server (which has
> > > active IndexWriters open) using the ctrl+c keys.
> > > 2) I inspect my directories on the file system I see that the
> > > write.lock
> > file is still
> > > there.
> > > 3) I start the app server again, and do some operations that would
> > require
> > > IndexWriters to write to the same directories again and it works!
> > >
> > > I don't understand why I do not run into any exceptions?
> > > I mean there is already a lock file present which should prevent =
the
> > > IndexWriters from getting access to the directories ... no?
> > > I should be happy but I'm not because other folks are able to get
> > exceptions
> > > when they bounce their servers an I'm unable to reproduce the
> > > problem and
> > I
> > > can't help them.
> > >
> > > Any clues? Anyone?
> > >
> > > Thank You,
> > > - Pulkit
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47782-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 19:55:05 2010
Return-Path: <java-user-return-47782-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34393 invoked from network); 10 Nov 2010 19:55:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 19:55:05 -0000
Received: (qmail 85250 invoked by uid 500); 10 Nov 2010 19:55:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85213 invoked by uid 500); 10 Nov 2010 19:55:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85205 invoked by uid 99); 10 Nov 2010 19:55:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 19:55:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.176 as permitted sender)
Received: from [209.85.213.176] (HELO mail-yx0-f176.google.com) (209.85.213.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 19:55:29 +0000
Received: by yxm8 with SMTP id 8so149878yxm.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 11:55:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=382y8qMwCTc3wi2981v7j3WSno6XXJHFwU9pkLJX81A=;
        b=Iv93QAlkFShyu37RwGGlyVw7a+aNgC2ZAxlTtFraLeQDT3EKFpXDIQynA06EAl11eV
         wwHHLG+rbKC2FxjKDk7qYcFU2m8btXwBPEylVOkdi5KIb7h2eCL83M4pJRSoFr3tRjPo
         bAhcarJKYF80RJFr9hJ7vgen7tq5wZU0eD2yc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=kDJuwi5xwifXwVI8eWxnrGKWRobhNNJEhDorChwFQWv2i9RiOZIi729SYIaq9VeWpY
         TrqGBpAe8Dc5TniAxoU+k7rCgsNvdybeHS8h7YhM613Z1K8sOzyToronfwiUVbss2Pmu
         l9X8acPvES/m+hPefpM9gZd5F5p4COJcsfdy4=
MIME-Version: 1.0
Received: by 10.150.202.11 with SMTP id z11mr140115ybf.207.1289418907531; Wed,
 10 Nov 2010 11:55:07 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 10 Nov 2010 11:55:07 -0800 (PST)
In-Reply-To: <003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
	<001201cb8100$c804ec20$580ec460$@thetaphi.de>
	<AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
	<003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
Date: Wed, 10 Nov 2010 14:55:07 -0500
Message-ID: <AANLkTi=VYiBNnf2NRQOOad1rauH29cfHwHq00At1srEV@mail.gmail.com>
Subject: Re: IndexWriters and write locks
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd4d35cf339d40494b83b61

--000e0cd4d35cf339d40494b83b61
Content-Type: text/plain; charset=UTF-8

You know that really confuses me. I've heard that stated a few times and
every time I just felt that it couldn't possibly be right. Maybe it was
meant in some very specific manner because otherwise aren't all Windows OSs
off-limits to Lucene then?

On Wed, Nov 10, 2010 at 2:40 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> Are you using NFS as filesystem? NFS is incompatible to lucene :-)
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > Sent: Wednesday, November 10, 2010 7:57 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: IndexWriters and write locks
> >
> > Thanks Uwe, that helps explain why the lock file is still there.
> >
> > The last piece of the puzzle is why someone may see exceptions such as
> the
> > following from time to time:
> >
> > java.nio.channels.OverlappingFileLockException
> >     at
> >
> sun.nio.ch.FileChannelImpl$SharedFileLockTable.checkList(FileChannelImpl.java
> > :1176)
> >     at
> >
> sun.nio.ch.FileChannelImpl$SharedFileLockTable.add(FileChannelImpl.java:107
> > 8)
> >     at sun.nio.ch.FileChannelImpl.tryLock(FileChannelImpl.java:878)
> >     at java.nio.channels.FileChannel.tryLock(FileChannel.java:962)
> >     at
> > org.apache.lucene.store.NativeFSLock.obtain(NativeFSLockFactory.java:236)
> >     at org.apache.lucene.store.Lock.obtain(Lock.java:72)
> >     at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1041)
> >     at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:864)
> >
> > I suppose this means that the OS itself hasn't released the lock even
> after I shut
> > down my application server and restarted it.
> > Am I right?
> >
> > Or is there something else that can possibly be the culprit (in anyone's
> > experience) that I can investigate?
> >
> > - Pulkit
> >
> > On Wed, Nov 10, 2010 at 12:57 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> >
> > > This is because Lucene uses Native Filesystem Locks. The lock file
> > > itself is just a placeholder which is not cleaned up on Ctrl-C. The
> > > lock is not the file itself, its *on* the file.
> > >
> > > -----
> > > Uwe Schindler
> > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > http://www.thetaphi.de
> > > eMail: uwe@thetaphi.de
> > >
> > > > -----Original Message-----
> > > > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > > > Sent: Wednesday, November 10, 2010 3:38 PM
> > > > To: java-user@lucene.apache.org
> > > > Subject: IndexWriters and write locks
> > > >
> > > > Hello,
> > > >
> > > > 1) On Windows, I often shut down my application server (which has
> > > > active IndexWriters open) using the ctrl+c keys.
> > > > 2) I inspect my directories on the file system I see that the
> > > > write.lock
> > > file is still
> > > > there.
> > > > 3) I start the app server again, and do some operations that would
> > > require
> > > > IndexWriters to write to the same directories again and it works!
> > > >
> > > > I don't understand why I do not run into any exceptions?
> > > > I mean there is already a lock file present which should prevent the
> > > > IndexWriters from getting access to the directories ... no?
> > > > I should be happy but I'm not because other folks are able to get
> > > exceptions
> > > > when they bounce their servers an I'm unable to reproduce the
> > > > problem and
> > > I
> > > > can't help them.
> > > >
> > > > Any clues? Anyone?
> > > >
> > > > Thank You,
> > > > - Pulkit
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd4d35cf339d40494b83b61--

From java-user-return-47783-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 20:01:47 2010
Return-Path: <java-user-return-47783-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36807 invoked from network); 10 Nov 2010 20:01:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 20:01:47 -0000
Received: (qmail 4406 invoked by uid 500); 10 Nov 2010 20:02:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4365 invoked by uid 500); 10 Nov 2010 20:02:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4339 invoked by uid 99); 10 Nov 2010 20:02:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 20:02:14 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 20:02:06 +0000
Received: from suex07-hub-01.ad.syr.edu (suex07-hub-01.ad.syr.edu [128.230.108.195])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id oAAK1UT0011296
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 15:01:44 -0500
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-01.ad.syr.edu ([128.230.108.195]) with mapi; Wed, 10 Nov 2010
 15:01:43 -0500
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Wed, 10 Nov 2010 15:01:45 -0500
Subject: RE: IndexWriters and write locks
Thread-Topic: IndexWriters and write locks
Thread-Index: AcuBEUHIuCoJm9B+TuOBIc/0aT+qgQAAJQ8w
Message-ID: <2D127F11DC79714E9B6A43AC9458147F805F1513@suex07-mbx-03.ad.syr.edu>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
	<001201cb8100$c804ec20$580ec460$@thetaphi.de>
	<AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
	<003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
 <AANLkTi=VYiBNnf2NRQOOad1rauH29cfHwHq00At1srEV@mail.gmail.com>
In-Reply-To: <AANLkTi=VYiBNnf2NRQOOad1rauH29cfHwHq00At1srEV@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=2.50.10432:5.2.15,1.0.148,0.0.0000
 definitions=2010-11-10_08:2010-11-10,2010-11-10,1970-01-01 signatures=0
X-Proofpoint-Spam-Reason: safe
X-Virus-Checked: Checked by ClamAV on apache.org

TkZTWzFdICE9IE5URlNbMl0NCg0KWzFdIE5GUzogPGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dp
a2kvTmV0d29ya19GaWxlX1N5c3RlbV8lMjhwcm90b2NvbCUyOT4NClsyXSBOVEZTOiA8aHR0cDov
L2VuLndpa2lwZWRpYS5vcmcvd2lraS9OVEZTPg0KDQo+IC0tLS0tT3JpZ2luYWwgTWVzc2FnZS0t
LS0tDQo+IEZyb206IFB1bGtpdCBTaW5naGFsIFttYWlsdG86cHVsa2l0c2luZ2hhbEBnbWFpbC5j
b21dDQo+IFNlbnQ6IFdlZG5lc2RheSwgTm92ZW1iZXIgMTAsIDIwMTAgMjo1NSBQTQ0KPiBUbzog
amF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3JnDQo+IFN1YmplY3Q6IFJlOiBJbmRleFdyaXRlcnMg
YW5kIHdyaXRlIGxvY2tzDQo+IA0KPiBZb3Uga25vdyB0aGF0IHJlYWxseSBjb25mdXNlcyBtZS4g
SSd2ZSBoZWFyZCB0aGF0IHN0YXRlZCBhIGZldyB0aW1lcyBhbmQNCj4gZXZlcnkgdGltZSBJIGp1
c3QgZmVsdCB0aGF0IGl0IGNvdWxkbid0IHBvc3NpYmx5IGJlIHJpZ2h0LiBNYXliZSBpdCB3YXMN
Cj4gbWVhbnQgaW4gc29tZSB2ZXJ5IHNwZWNpZmljIG1hbm5lciBiZWNhdXNlIG90aGVyd2lzZSBh
cmVuJ3QgYWxsIFdpbmRvd3MNCj4gT1NzDQo+IG9mZi1saW1pdHMgdG8gTHVjZW5lIHRoZW4/DQo+
IA0KPiBPbiBXZWQsIE5vdiAxMCwgMjAxMCBhdCAyOjQwIFBNLCBVd2UgU2NoaW5kbGVyIDx1d2VA
dGhldGFwaGkuZGU+IHdyb3RlOg0KPiANCj4gPiBBcmUgeW91IHVzaW5nIE5GUyBhcyBmaWxlc3lz
dGVtPyBORlMgaXMgaW5jb21wYXRpYmxlIHRvIGx1Y2VuZSA6LSkNCj4gPg0KPiA+IC0tLS0tDQo+
ID4gVXdlIFNjaGluZGxlcg0KPiA+IEguLUguLU1laWVyLUFsbGVlIDYzLCBELTI4MjEzIEJyZW1l
bg0KPiA+IGh0dHA6Ly93d3cudGhldGFwaGkuZGUNCj4gPiBlTWFpbDogdXdlQHRoZXRhcGhpLmRl
DQo+ID4NCj4gPg0KPiA+ID4gLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCj4gPiA+IEZyb206
IFB1bGtpdCBTaW5naGFsIFttYWlsdG86cHVsa2l0c2luZ2hhbEBnbWFpbC5jb21dDQo+ID4gPiBT
ZW50OiBXZWRuZXNkYXksIE5vdmVtYmVyIDEwLCAyMDEwIDc6NTcgUE0NCj4gPiA+IFRvOiBqYXZh
LXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4gPiA+IFN1YmplY3Q6IFJlOiBJbmRleFdyaXRlcnMg
YW5kIHdyaXRlIGxvY2tzDQo+ID4gPg0KPiA+ID4gVGhhbmtzIFV3ZSwgdGhhdCBoZWxwcyBleHBs
YWluIHdoeSB0aGUgbG9jayBmaWxlIGlzIHN0aWxsIHRoZXJlLg0KPiA+ID4NCj4gPiA+IFRoZSBs
YXN0IHBpZWNlIG9mIHRoZSBwdXp6bGUgaXMgd2h5IHNvbWVvbmUgbWF5IHNlZSBleGNlcHRpb25z
IHN1Y2ggYXMNCj4gPiB0aGUNCj4gPiA+IGZvbGxvd2luZyBmcm9tIHRpbWUgdG8gdGltZToNCj4g
PiA+DQo+ID4gPiBqYXZhLm5pby5jaGFubmVscy5PdmVybGFwcGluZ0ZpbGVMb2NrRXhjZXB0aW9u
DQo+ID4gPiAgICAgYXQNCj4gPiA+DQo+ID4NCj4gc3VuLm5pby5jaC5GaWxlQ2hhbm5lbEltcGwk
U2hhcmVkRmlsZUxvY2tUYWJsZS5jaGVja0xpc3QoRmlsZUNoYW5uZWxJbXBsLmoNCj4gYXZhDQo+
ID4gPiA6MTE3NikNCj4gPiA+ICAgICBhdA0KPiA+ID4NCj4gPg0KPiBzdW4ubmlvLmNoLkZpbGVD
aGFubmVsSW1wbCRTaGFyZWRGaWxlTG9ja1RhYmxlLmFkZChGaWxlQ2hhbm5lbEltcGwuamF2YTox
MA0KPiA3DQo+ID4gPiA4KQ0KPiA+ID4gICAgIGF0IHN1bi5uaW8uY2guRmlsZUNoYW5uZWxJbXBs
LnRyeUxvY2soRmlsZUNoYW5uZWxJbXBsLmphdmE6ODc4KQ0KPiA+ID4gICAgIGF0IGphdmEubmlv
LmNoYW5uZWxzLkZpbGVDaGFubmVsLnRyeUxvY2soRmlsZUNoYW5uZWwuamF2YTo5NjIpDQo+ID4g
PiAgICAgYXQNCj4gPiA+DQo+IG9yZy5hcGFjaGUubHVjZW5lLnN0b3JlLk5hdGl2ZUZTTG9jay5v
YnRhaW4oTmF0aXZlRlNMb2NrRmFjdG9yeS5qYXZhOjIzNikNCj4gPiA+ICAgICBhdCBvcmcuYXBh
Y2hlLmx1Y2VuZS5zdG9yZS5Mb2NrLm9idGFpbihMb2NrLmphdmE6NzIpDQo+ID4gPiAgICAgYXQg
b3JnLmFwYWNoZS5sdWNlbmUuaW5kZXguSW5kZXhXcml0ZXIuaW5pdChJbmRleFdyaXRlci5qYXZh
OjEwNDEpDQo+ID4gPiAgICAgYXQNCj4gb3JnLmFwYWNoZS5sdWNlbmUuaW5kZXguSW5kZXhXcml0
ZXIuPGluaXQ+KEluZGV4V3JpdGVyLmphdmE6ODY0KQ0KPiA+ID4NCj4gPiA+IEkgc3VwcG9zZSB0
aGlzIG1lYW5zIHRoYXQgdGhlIE9TIGl0c2VsZiBoYXNuJ3QgcmVsZWFzZWQgdGhlIGxvY2sgZXZl
bg0KPiA+IGFmdGVyIEkgc2h1dA0KPiA+ID4gZG93biBteSBhcHBsaWNhdGlvbiBzZXJ2ZXIgYW5k
IHJlc3RhcnRlZCBpdC4NCj4gPiA+IEFtIEkgcmlnaHQ/DQo+ID4gPg0KPiA+ID4gT3IgaXMgdGhl
cmUgc29tZXRoaW5nIGVsc2UgdGhhdCBjYW4gcG9zc2libHkgYmUgdGhlIGN1bHByaXQgKGluDQo+
IGFueW9uZSdzDQo+ID4gPiBleHBlcmllbmNlKSB0aGF0IEkgY2FuIGludmVzdGlnYXRlPw0KPiA+
ID4NCj4gPiA+IC0gUHVsa2l0DQo+ID4gPg0KPiA+ID4gT24gV2VkLCBOb3YgMTAsIDIwMTAgYXQg
MTI6NTcgUE0sIFV3ZSBTY2hpbmRsZXIgPHV3ZUB0aGV0YXBoaS5kZT4NCj4gd3JvdGU6DQo+ID4g
Pg0KPiA+ID4gPiBUaGlzIGlzIGJlY2F1c2UgTHVjZW5lIHVzZXMgTmF0aXZlIEZpbGVzeXN0ZW0g
TG9ja3MuIFRoZSBsb2NrIGZpbGUNCj4gPiA+ID4gaXRzZWxmIGlzIGp1c3QgYSBwbGFjZWhvbGRl
ciB3aGljaCBpcyBub3QgY2xlYW5lZCB1cCBvbiBDdHJsLUMuIFRoZQ0KPiA+ID4gPiBsb2NrIGlz
IG5vdCB0aGUgZmlsZSBpdHNlbGYsIGl0cyAqb24qIHRoZSBmaWxlLg0KPiA+ID4gPg0KPiA+ID4g
PiAtLS0tLQ0KPiA+ID4gPiBVd2UgU2NoaW5kbGVyDQo+ID4gPiA+IEguLUguLU1laWVyLUFsbGVl
IDYzLCBELTI4MjEzIEJyZW1lbg0KPiA+ID4gPiBodHRwOi8vd3d3LnRoZXRhcGhpLmRlDQo+ID4g
PiA+IGVNYWlsOiB1d2VAdGhldGFwaGkuZGUNCj4gPiA+ID4NCj4gPiA+ID4gPiAtLS0tLU9yaWdp
bmFsIE1lc3NhZ2UtLS0tLQ0KPiA+ID4gPiA+IEZyb206IFB1bGtpdCBTaW5naGFsIFttYWlsdG86
cHVsa2l0c2luZ2hhbEBnbWFpbC5jb21dDQo+ID4gPiA+ID4gU2VudDogV2VkbmVzZGF5LCBOb3Zl
bWJlciAxMCwgMjAxMCAzOjM4IFBNDQo+ID4gPiA+ID4gVG86IGphdmEtdXNlckBsdWNlbmUuYXBh
Y2hlLm9yZw0KPiA+ID4gPiA+IFN1YmplY3Q6IEluZGV4V3JpdGVycyBhbmQgd3JpdGUgbG9ja3MN
Cj4gPiA+ID4gPg0KPiA+ID4gPiA+IEhlbGxvLA0KPiA+ID4gPiA+DQo+ID4gPiA+ID4gMSkgT24g
V2luZG93cywgSSBvZnRlbiBzaHV0IGRvd24gbXkgYXBwbGljYXRpb24gc2VydmVyICh3aGljaCBo
YXMNCj4gPiA+ID4gPiBhY3RpdmUgSW5kZXhXcml0ZXJzIG9wZW4pIHVzaW5nIHRoZSBjdHJsK2Mg
a2V5cy4NCj4gPiA+ID4gPiAyKSBJIGluc3BlY3QgbXkgZGlyZWN0b3JpZXMgb24gdGhlIGZpbGUg
c3lzdGVtIEkgc2VlIHRoYXQgdGhlDQo+ID4gPiA+ID4gd3JpdGUubG9jaw0KPiA+ID4gPiBmaWxl
IGlzIHN0aWxsDQo+ID4gPiA+ID4gdGhlcmUuDQo+ID4gPiA+ID4gMykgSSBzdGFydCB0aGUgYXBw
IHNlcnZlciBhZ2FpbiwgYW5kIGRvIHNvbWUgb3BlcmF0aW9ucyB0aGF0IHdvdWxkDQo+ID4gPiA+
IHJlcXVpcmUNCj4gPiA+ID4gPiBJbmRleFdyaXRlcnMgdG8gd3JpdGUgdG8gdGhlIHNhbWUgZGly
ZWN0b3JpZXMgYWdhaW4gYW5kIGl0IHdvcmtzIQ0KPiA+ID4gPiA+DQo+ID4gPiA+ID4gSSBkb24n
dCB1bmRlcnN0YW5kIHdoeSBJIGRvIG5vdCBydW4gaW50byBhbnkgZXhjZXB0aW9ucz8NCj4gPiA+
ID4gPiBJIG1lYW4gdGhlcmUgaXMgYWxyZWFkeSBhIGxvY2sgZmlsZSBwcmVzZW50IHdoaWNoIHNo
b3VsZCBwcmV2ZW50DQo+IHRoZQ0KPiA+ID4gPiA+IEluZGV4V3JpdGVycyBmcm9tIGdldHRpbmcg
YWNjZXNzIHRvIHRoZSBkaXJlY3RvcmllcyAuLi4gbm8/DQo+ID4gPiA+ID4gSSBzaG91bGQgYmUg
aGFwcHkgYnV0IEknbSBub3QgYmVjYXVzZSBvdGhlciBmb2xrcyBhcmUgYWJsZSB0byBnZXQNCj4g
PiA+ID4gZXhjZXB0aW9ucw0KPiA+ID4gPiA+IHdoZW4gdGhleSBib3VuY2UgdGhlaXIgc2VydmVy
cyBhbiBJJ20gdW5hYmxlIHRvIHJlcHJvZHVjZSB0aGUNCj4gPiA+ID4gPiBwcm9ibGVtIGFuZA0K
PiA+ID4gPiBJDQo+ID4gPiA+ID4gY2FuJ3QgaGVscCB0aGVtLg0KPiA+ID4gPiA+DQo+ID4gPiA+
ID4gQW55IGNsdWVzPyBBbnlvbmU/DQo+ID4gPiA+ID4NCj4gPiA+ID4gPiBUaGFuayBZb3UsDQo+
ID4gPiA+ID4gLSBQdWxraXQNCj4gPiA+ID4NCj4gPiA+ID4NCj4gPiA+ID4gLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0N
Cj4gLQ0KPiA+ID4gPiBUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5zdWJzY3Jp
YmVAbHVjZW5lLmFwYWNoZS5vcmcNCj4gPiA+ID4gRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUt
bWFpbDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4gPiA+ID4NCj4gPiA+ID4N
Cj4gPg0KPiA+DQo+ID4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQo+ID4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDog
amF2YS11c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+ID4gRm9yIGFkZGl0aW9u
YWwgY29tbWFuZHMsIGUtbWFpbDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4g
Pg0KPiA+DQo=


From java-user-return-47784-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 20:02:41 2010
Return-Path: <java-user-return-47784-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37105 invoked from network); 10 Nov 2010 20:02:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 20:02:41 -0000
Received: (qmail 7881 invoked by uid 500); 10 Nov 2010 20:03:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7686 invoked by uid 500); 10 Nov 2010 20:03:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7678 invoked by uid 99); 10 Nov 2010 20:03:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 20:03:07 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 20:03:01 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9BDE9D36006
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 21:02:39 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id IHdirZBR+xTP for <java-user@lucene.apache.org>;
	Wed, 10 Nov 2010 21:02:34 +0100 (CET)
Received: from VEGA (p5DD07B48.dip.t-dialin.net [93.208.123.72])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 56183D36003
	for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 21:02:34 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>	<001201cb8100$c804ec20$580ec460$@thetaphi.de>	<AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>	<003801cb810f$2fc25ab0$8f471010$@thetaphi.de> <AANLkTi=VYiBNnf2NRQOOad1rauH29cfHwHq00At1srEV@mail.gmail.com>
In-Reply-To: <AANLkTi=VYiBNnf2NRQOOad1rauH29cfHwHq00At1srEV@mail.gmail.com>
Subject: RE: IndexWriters and write locks
Date: Wed, 10 Nov 2010 21:02:44 +0100
Message-ID: <004301cb8112$3d1baf10$b7530d30$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQJZ1XQ01k4Rm2YoRc0ZE7ncWOkAYQLSCZXVAcY/7/UCdl8dxAJ8nLR9kgIeyvA=
Content-Language: de

Windows does not use NFS natively, it=E2=80=99s a network file system =
for UNIX O/S.=20

But can you confirm that you are working on a local filesystem even on =
windows (NTFS?). Not something like samba shares?

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> Sent: Wednesday, November 10, 2010 8:55 PM
> To: java-user@lucene.apache.org
> Subject: Re: IndexWriters and write locks
>=20
> You know that really confuses me. I've heard that stated a few times =
and every
> time I just felt that it couldn't possibly be right. Maybe it was =
meant in some
> very specific manner because otherwise aren't all Windows OSs =
off-limits to
> Lucene then?
>=20
> On Wed, Nov 10, 2010 at 2:40 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>=20
> > Are you using NFS as filesystem? NFS is incompatible to lucene :-)
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > > Sent: Wednesday, November 10, 2010 7:57 PM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: IndexWriters and write locks
> > >
> > > Thanks Uwe, that helps explain why the lock file is still there.
> > >
> > > The last piece of the puzzle is why someone may see exceptions =
such
> > > as
> > the
> > > following from time to time:
> > >
> > > java.nio.channels.OverlappingFileLockException
> > >     at
> > >
> > =
sun.nio.ch.FileChannelImpl$SharedFileLockTable.checkList(FileChannelIm
> > pl.java
> > > :1176)
> > >     at
> > >
> > =
sun.nio.ch.FileChannelImpl$SharedFileLockTable.add(FileChannelImpl.jav
> > a:107
> > > 8)
> > >     at =
sun.nio.ch.FileChannelImpl.tryLock(FileChannelImpl.java:878)
> > >     at java.nio.channels.FileChannel.tryLock(FileChannel.java:962)
> > >     at
> > > =
org.apache.lucene.store.NativeFSLock.obtain(NativeFSLockFactory.java:236)=

> > >     at org.apache.lucene.store.Lock.obtain(Lock.java:72)
> > >     at =
org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1041)
> > >     at
> > > org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:864)
> > >
> > > I suppose this means that the OS itself hasn't released the lock
> > > even
> > after I shut
> > > down my application server and restarted it.
> > > Am I right?
> > >
> > > Or is there something else that can possibly be the culprit (in
> > > anyone's
> > > experience) that I can investigate?
> > >
> > > - Pulkit
> > >
> > > On Wed, Nov 10, 2010 at 12:57 PM, Uwe Schindler <uwe@thetaphi.de>
> wrote:
> > >
> > > > This is because Lucene uses Native Filesystem Locks. The lock =
file
> > > > itself is just a placeholder which is not cleaned up on Ctrl-C.
> > > > The lock is not the file itself, its *on* the file.
> > > >
> > > > -----
> > > > Uwe Schindler
> > > > H.-H.-Meier-Allee 63, D-28213 Bremen http://www.thetaphi.de
> > > > eMail: uwe@thetaphi.de
> > > >
> > > > > -----Original Message-----
> > > > > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > > > > Sent: Wednesday, November 10, 2010 3:38 PM
> > > > > To: java-user@lucene.apache.org
> > > > > Subject: IndexWriters and write locks
> > > > >
> > > > > Hello,
> > > > >
> > > > > 1) On Windows, I often shut down my application server (which
> > > > > has active IndexWriters open) using the ctrl+c keys.
> > > > > 2) I inspect my directories on the file system I see that the
> > > > > write.lock
> > > > file is still
> > > > > there.
> > > > > 3) I start the app server again, and do some operations that
> > > > > would
> > > > require
> > > > > IndexWriters to write to the same directories again and it =
works!
> > > > >
> > > > > I don't understand why I do not run into any exceptions?
> > > > > I mean there is already a lock file present which should =
prevent
> > > > > the IndexWriters from getting access to the directories ... =
no?
> > > > > I should be happy but I'm not because other folks are able to
> > > > > get
> > > > exceptions
> > > > > when they bounce their servers an I'm unable to reproduce the
> > > > > problem and
> > > > I
> > > > > can't help them.
> > > > >
> > > > > Any clues? Anyone?
> > > > >
> > > > > Thank You,
> > > > > - Pulkit
> > > >
> > > >
> > > > =
------------------------------------------------------------------
> > > > --- To unsubscribe, e-mail:
> > > > java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: =
java-user-help@lucene.apache.org
> > > >
> > > >
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47785-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 20:13:24 2010
Return-Path: <java-user-return-47785-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48075 invoked from network); 10 Nov 2010 20:13:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 20:13:23 -0000
Received: (qmail 24551 invoked by uid 500); 10 Nov 2010 20:13:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 24485 invoked by uid 500); 10 Nov 2010 20:13:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 24474 invoked by uid 99); 10 Nov 2010 20:13:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 20:13:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 20:13:35 +0000
Received: by gwj15 with SMTP id 15so775936gwj.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 12:13:14 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=4PcqxMJFbTg9F4XH9QRicvUo8hsVQOgxfdMdXQnwBXM=;
        b=l4Pf17lc1iMrq5snJNPiGkamBdjFYda3MB07M9mo9Hwzp1GFRG+IUIOqFyQKs1vzyI
         yV5bdzvNRH+sP5y2zSsE1VQm5pLz/BFZ6MU/kBHHHguA6jq3zVyLgaDzFM5RH83KuFQr
         6hh72X2NhJHXvdH/8l45wdoHvuOx3kXu3BwXM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=BvV6iU7za9XN7+vnzkVv8kCj0NtrCHKN0xExBZzJcFDmb/Ta27LTV4mjRemQSJiMoA
         h5o38sd6gBEOQA17qHHcERmVxhrkD9kEyx04kzpz+jRHZppyPsclVFbt4HR1oec7vy1c
         alyHFjteXUSP16TtH7TP6Z2oY7wSHIzKLIJpg=
MIME-Version: 1.0
Received: by 10.151.41.3 with SMTP id t3mr200805ybj.36.1289419994523; Wed, 10
 Nov 2010 12:13:14 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 10 Nov 2010 12:13:14 -0800 (PST)
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F805F1513@suex07-mbx-03.ad.syr.edu>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
	<001201cb8100$c804ec20$580ec460$@thetaphi.de>
	<AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
	<003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
	<AANLkTi=VYiBNnf2NRQOOad1rauH29cfHwHq00At1srEV@mail.gmail.com>
	<2D127F11DC79714E9B6A43AC9458147F805F1513@suex07-mbx-03.ad.syr.edu>
Date: Wed, 10 Nov 2010 15:13:14 -0500
Message-ID: <AANLkTincut8xrFZF1bj+sCk3gcTpDWBjCfn0kdwkAW5Y@mail.gmail.com>
Subject: Re: IndexWriters and write locks
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151750dd7abd6af00494b87c38
X-Virus-Checked: Checked by ClamAV on apache.org

--00151750dd7abd6af00494b87c38
Content-Type: text/plain; charset=UTF-8

Ah exactly the kind of wake-up call that I was looking for! Thank You :)

On Wed, Nov 10, 2010 at 3:01 PM, Steven A Rowe <sarowe@syr.edu> wrote:

> NFS[1] != NTFS[2]
>
> [1] NFS: <http://en.wikipedia.org/wiki/Network_File_System_%28protocol%29>
> [2] NTFS: <http://en.wikipedia.org/wiki/NTFS>
>
> > -----Original Message-----
> > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > Sent: Wednesday, November 10, 2010 2:55 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: IndexWriters and write locks
> >
> > You know that really confuses me. I've heard that stated a few times and
> > every time I just felt that it couldn't possibly be right. Maybe it was
> > meant in some very specific manner because otherwise aren't all Windows
> > OSs
> > off-limits to Lucene then?
> >
> > On Wed, Nov 10, 2010 at 2:40 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> >
> > > Are you using NFS as filesystem? NFS is incompatible to lucene :-)
> > >
> > > -----
> > > Uwe Schindler
> > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > http://www.thetaphi.de
> > > eMail: uwe@thetaphi.de
> > >
> > >
> > > > -----Original Message-----
> > > > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > > > Sent: Wednesday, November 10, 2010 7:57 PM
> > > > To: java-user@lucene.apache.org
> > > > Subject: Re: IndexWriters and write locks
> > > >
> > > > Thanks Uwe, that helps explain why the lock file is still there.
> > > >
> > > > The last piece of the puzzle is why someone may see exceptions such
> as
> > > the
> > > > following from time to time:
> > > >
> > > > java.nio.channels.OverlappingFileLockException
> > > >     at
> > > >
> > >
> >
> sun.nio.ch.FileChannelImpl$SharedFileLockTable.checkList(FileChannelImpl.j
> > ava
> > > > :1176)
> > > >     at
> > > >
> > >
> >
> sun.nio.ch.FileChannelImpl$SharedFileLockTable.add(FileChannelImpl.java:10
> > 7
> > > > 8)
> > > >     at sun.nio.ch.FileChannelImpl.tryLock(FileChannelImpl.java:878)
> > > >     at java.nio.channels.FileChannel.tryLock(FileChannel.java:962)
> > > >     at
> > > >
> > org.apache.lucene.store.NativeFSLock.obtain(NativeFSLockFactory.java:236)
> > > >     at org.apache.lucene.store.Lock.obtain(Lock.java:72)
> > > >     at
> org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1041)
> > > >     at
> > org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:864)
> > > >
> > > > I suppose this means that the OS itself hasn't released the lock even
> > > after I shut
> > > > down my application server and restarted it.
> > > > Am I right?
> > > >
> > > > Or is there something else that can possibly be the culprit (in
> > anyone's
> > > > experience) that I can investigate?
> > > >
> > > > - Pulkit
> > > >
> > > > On Wed, Nov 10, 2010 at 12:57 PM, Uwe Schindler <uwe@thetaphi.de>
> > wrote:
> > > >
> > > > > This is because Lucene uses Native Filesystem Locks. The lock file
> > > > > itself is just a placeholder which is not cleaned up on Ctrl-C. The
> > > > > lock is not the file itself, its *on* the file.
> > > > >
> > > > > -----
> > > > > Uwe Schindler
> > > > > H.-H.-Meier-Allee 63, D-28213 Bremen
> > > > > http://www.thetaphi.de
> > > > > eMail: uwe@thetaphi.de
> > > > >
> > > > > > -----Original Message-----
> > > > > > From: Pulkit Singhal [mailto:pulkitsinghal@gmail.com]
> > > > > > Sent: Wednesday, November 10, 2010 3:38 PM
> > > > > > To: java-user@lucene.apache.org
> > > > > > Subject: IndexWriters and write locks
> > > > > >
> > > > > > Hello,
> > > > > >
> > > > > > 1) On Windows, I often shut down my application server (which has
> > > > > > active IndexWriters open) using the ctrl+c keys.
> > > > > > 2) I inspect my directories on the file system I see that the
> > > > > > write.lock
> > > > > file is still
> > > > > > there.
> > > > > > 3) I start the app server again, and do some operations that
> would
> > > > > require
> > > > > > IndexWriters to write to the same directories again and it works!
> > > > > >
> > > > > > I don't understand why I do not run into any exceptions?
> > > > > > I mean there is already a lock file present which should prevent
> > the
> > > > > > IndexWriters from getting access to the directories ... no?
> > > > > > I should be happy but I'm not because other folks are able to get
> > > > > exceptions
> > > > > > when they bounce their servers an I'm unable to reproduce the
> > > > > > problem and
> > > > > I
> > > > > > can't help them.
> > > > > >
> > > > > > Any clues? Anyone?
> > > > > >
> > > > > > Thank You,
> > > > > > - Pulkit
> > > > >
> > > > >
> > > > >
> --------------------------------------------------------------------
> > -
> > > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > > >
> > > > >
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
>

--00151750dd7abd6af00494b87c38--

From java-user-return-47786-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 21:03:05 2010
Return-Path: <java-user-return-47786-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63750 invoked from network); 10 Nov 2010 21:03:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 21:03:05 -0000
Received: (qmail 13290 invoked by uid 500); 10 Nov 2010 21:03:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13248 invoked by uid 500); 10 Nov 2010 21:03:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13238 invoked by uid 99); 10 Nov 2010 21:03:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 21:03:32 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [141.211.3.201] (HELO itcs-ehub-01.adsroot.itcs.umich.edu) (141.211.3.201)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 21:03:25 +0000
Received: from ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu ([141.211.3.231]) by
 itcs-ehub-01.adsroot.itcs.umich.edu ([141.211.3.201]) with mapi; Wed, 10 Nov
 2010 16:03:02 -0500
From: "Burton-West, Tom" <tburtonw@umich.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Wed, 10 Nov 2010 16:02:51 -0500
Subject: API access to in-memory tii file (3.x not flex).
Thread-Topic: API access to in-memory tii file (3.x not flex).
Thread-Index: AcuBGqMVvg9xVPiBS528au6R+xCSnQ==
Message-ID: <47316FE3F6BA0D4DADF996635125526809F597EDA7@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/alternative;
	boundary="_000_47316FE3F6BA0D4DADF996635125526809F597EDA7ITCSECLS1VS3a_"
MIME-Version: 1.0

--_000_47316FE3F6BA0D4DADF996635125526809F597EDA7ITCSECLS1VS3a_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hello all,

We have an extremely large number of terms in our indexes.  I want to be ab=
le to extract a sample of the terms, say something like every 128th term.  =
 If I use code based on org.apache.lucene.misc.HighFreqTerms or org.apache.=
lucene.index.CheckIndex I would get a TermsEnum, call termEnum.next() 128 t=
imes, grab the term and then call next another 128 times.
termEnum =3D reader.terms();
while (termEnum.next()
{ }

Since the tii file contains every 128th (or IndexInterval ) term and it is =
loaded into memory, is there some programmatic way (in the public API) to r=
ead that data structure in memory rather than having to force Lucene to act=
ually read the entire tis file by using termEnum.next() ?


Tom Burton-West
http://www.hathitrust.org/blogs/large-scale-search


--_000_47316FE3F6BA0D4DADF996635125526809F597EDA7ITCSECLS1VS3a_--

From java-user-return-47787-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 21:39:01 2010
Return-Path: <java-user-return-47787-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87160 invoked from network); 10 Nov 2010 21:39:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 21:39:01 -0000
Received: (qmail 82791 invoked by uid 500); 10 Nov 2010 21:39:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82694 invoked by uid 500); 10 Nov 2010 21:39:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82685 invoked by uid 99); 10 Nov 2010 21:39:30 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 21:39:30 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 21:39:24 +0000
Received: by qwk3 with SMTP id 3so1160055qwk.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 13:39:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=qVmfbmlS+nb2fsXVDJXRiYSPG471asCF2jLGzSExG3Q=;
        b=cQg9sdQjSwQxfJJy8UKqs6DNbNVRxwH7R9AR6q7+7YyBfjEhq+fpjAxoEc2D8utWeY
         8yBlW5fFu/Jq+7FciAij37S7GBdfW0Ib96ZgVbVjHUFxMtiCtOQa0WswgJXnzA0bOjNc
         Xc6Oa+ievYzGs3ZMp6qszWx8lWnqoKtp16N2M=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=Nz8Id5HclDF60mDQECzXUWQ00WeYxt1u/tx8M4aiR7yrkOkysCG9FA0GCzPdARAH5k
         Ur8kXFf29HdTBAZAU87N7ch61VGdsL1JMQb+iRtgrlgJJrxbVlA28tg9AqGPNZizhZWb
         J5fQLXcpLPPsRcvInlcwxPXcLVJU8PBjUZ24Q=
MIME-Version: 1.0
Received: by 10.224.45.142 with SMTP id e14mr61300qaf.321.1289425143374; Wed,
 10 Nov 2010 13:39:03 -0800 (PST)
Received: by 10.229.84.10 with HTTP; Wed, 10 Nov 2010 13:39:03 -0800 (PST)
In-Reply-To: <47316FE3F6BA0D4DADF996635125526809F597EDA7@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <47316FE3F6BA0D4DADF996635125526809F597EDA7@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Date: Wed, 10 Nov 2010 13:39:03 -0800
Message-ID: <AANLkTinCvhF8L=2RxCj5fPR4-GEgsR9eDqyLOUUJZWJZ@mail.gmail.com>
Subject: Re: API access to in-memory tii file (3.x not flex).
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

In a word, no.  You'd need to customize the Lucene source to accomplish thi=
s.

On Wed, Nov 10, 2010 at 1:02 PM, Burton-West, Tom <tburtonw@umich.edu> wrot=
e:
> Hello all,
>
> We have an extremely large number of terms in our indexes. =A0I want to b=
e able to extract a sample of the terms, say something like every 128th ter=
m. =A0 If I use code based on org.apache.lucene.misc.HighFreqTerms or org.a=
pache.lucene.index.CheckIndex I would get a TermsEnum, call termEnum.next()=
 128 times, grab the term and then call next another 128 times.
> termEnum =3D reader.terms();
> while (termEnum.next()
> { }
>
> Since the tii file contains every 128th (or IndexInterval ) term and it i=
s loaded into memory, is there some programmatic way (in the public API) to=
 read that data structure in memory rather than having to force Lucene to a=
ctually read the entire tis file by using termEnum.next() ?
>
>
> Tom Burton-West
> http://www.hathitrust.org/blogs/large-scale-search
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47788-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 10 22:10:23 2010
Return-Path: <java-user-return-47788-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9183 invoked from network); 10 Nov 2010 22:10:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 10 Nov 2010 22:10:23 -0000
Received: (qmail 32552 invoked by uid 500); 10 Nov 2010 22:10:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32396 invoked by uid 500); 10 Nov 2010 22:10:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32387 invoked by uid 99); 10 Nov 2010 22:10:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 22:10:50 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 10 Nov 2010 22:10:44 +0000
Received: by wyf19 with SMTP id 19so1245455wyf.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 14:10:23 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.187.82 with SMTP id x60mr2175463wem.9.1289427023291; Wed,
 10 Nov 2010 14:10:23 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Wed, 10 Nov 2010 14:10:23 -0800 (PST)
In-Reply-To: <47316FE3F6BA0D4DADF996635125526809F597EDA7@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <47316FE3F6BA0D4DADF996635125526809F597EDA7@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Date: Wed, 10 Nov 2010 17:10:23 -0500
Message-ID: <AANLkTi=zdc+jbS-0s4FByyP7MOwkzG1ye6ngrq0WrVO-@mail.gmail.com>
Subject: Re: API access to in-memory tii file (3.x not flex).
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Actually, the .tii file pre-flex (3.x) is nearly identical to the .tis
file, just that it only contains every 128th term.

If you just make SegmentTermEnum public (or, sneak your class into
oal.index package) then you can instantiate SegmentTermsEnum passing
it an IndexInput opened on the .tii file.

Then you can enum the terms directly...

Mike

On Wed, Nov 10, 2010 at 4:02 PM, Burton-West, Tom <tburtonw@umich.edu> wrot=
e:
> Hello all,
>
> We have an extremely large number of terms in our indexes. =A0I want to b=
e able to extract a sample of the terms, say something like every 128th ter=
m. =A0 If I use code based on org.apache.lucene.misc.HighFreqTerms or org.a=
pache.lucene.index.CheckIndex I would get a TermsEnum, call termEnum.next()=
 128 times, grab the term and then call next another 128 times.
> termEnum =3D reader.terms();
> while (termEnum.next()
> { }
>
> Since the tii file contains every 128th (or IndexInterval ) term and it i=
s loaded into memory, is there some programmatic way (in the public API) to=
 read that data structure in memory rather than having to force Lucene to a=
ctually read the entire tis file by using termEnum.next() ?
>
>
> Tom Burton-West
> http://www.hathitrust.org/blogs/large-scale-search
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47789-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 11 01:42:27 2010
Return-Path: <java-user-return-47789-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14559 invoked from network); 11 Nov 2010 01:42:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Nov 2010 01:42:27 -0000
Received: (qmail 55642 invoked by uid 500); 11 Nov 2010 01:42:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55602 invoked by uid 500); 11 Nov 2010 01:42:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55594 invoked by uid 99); 11 Nov 2010 01:42:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 01:42:56 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 01:42:48 +0000
Received: by vws16 with SMTP id 16so157815vws.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 17:42:27 -0800 (PST)
Received: by 10.220.180.138 with SMTP id bu10mr43582vcb.48.1289439747614;
        Wed, 10 Nov 2010 17:42:27 -0800 (PST)
Received: from [10.0.1.6] (rrcs-24-43-144-226.west.biz.rr.com [24.43.144.226])
        by mx.google.com with ESMTPS id k11sm520996vbp.13.2010.11.10.17.42.25
        (version=SSLv3 cipher=RC4-MD5);
        Wed, 10 Nov 2010 17:42:26 -0800 (PST)
Subject: Non matched terms
From: "Brian C. Dilley" <brian@shopnation.com>
Reply-To: brian@shopnation.com
To: java-user@lucene.apache.org
Content-Type: text/plain; charset="UTF-8"
Organization: Shop Nation Inc.
Date: Wed, 10 Nov 2010 17:41:46 -0800
Message-ID: <1289439706.9757.28.camel@bdilley-workstation>
Mime-Version: 1.0
X-Mailer: Evolution 2.28.3 
Content-Transfer-Encoding: 7bit

Hi, I'm using Lucene for a search project and I have the following
requirements and I was wondering if one of you fine folks could point me
in the right direction (currently i'm using the RAMDirectory,
IndexSearcher, StandardAnalyzer and QueryParser):

Given the example search string:

"red leather calvin klein shiny pants"

I will be searching 2 indexes.  One is an index of category names the
other is an index of attributes.  Lets say the following happens:

red - matches an attribute
leather - matches an attribute
calvin klein - matches an antribute
pants - matches a category
shiny - matches nothing.

I want to identify the non-matching "shiny" search term.  That is, given
a search string i want lucene to tell me what part(s) of it don't match
anything.

Is this possible?  I've tried using extractTerms (along with another API
call that I am forgetting the name of right now) but it doesn't work for
all Query types (ie: Fuzzy).

Thanks in advance!


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47790-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 11 05:12:53 2010
Return-Path: <java-user-return-47790-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19132 invoked from network); 11 Nov 2010 05:12:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Nov 2010 05:12:52 -0000
Received: (qmail 87907 invoked by uid 500); 11 Nov 2010 05:13:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87859 invoked by uid 500); 11 Nov 2010 05:13:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87851 invoked by uid 99); 11 Nov 2010 05:13:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 05:13:19 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 05:13:13 +0000
Received: by qyk1 with SMTP id 1so887349qyk.14
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 21:12:52 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=PggJJuh1IvvcXrwWgt7Zi0PrS48WOKGt5PMNguagECE=;
        b=Plr5WCQc+Ieisj5vNhtwifp6oabohnmUxpbZ9XTxyZzoVJr7Hj74tvxoHpWnNFAPBf
         NMwcbRf6AiLiDB1LTXU+N9ntSSNRKgRFNJ6qFp7WPMYLOkfBTBtbZM+vL1EsfOmo9DAQ
         AvKcH1NGooULkrlk6gLRtgiVnrkXW0ITXchDs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=KwYuA62oSgh9wJRWntlaILIuT5AuLTOW/NvT7zuga4KXJJIxZDQmlOwVakJoFHoM0A
         9+UouBaVDM48kZJQJCuNQ4A9KjZ8rKPPlk0vYXmF2K/7dEilPZYtbaUxiP4lu1TFJSj1
         ueNc1484sbS1jBf9fVaE/csrTibRK8PFNQfQY=
MIME-Version: 1.0
Received: by 10.229.225.213 with SMTP id it21mr395281qcb.90.1289452372630;
 Wed, 10 Nov 2010 21:12:52 -0800 (PST)
Received: by 10.229.84.10 with HTTP; Wed, 10 Nov 2010 21:12:52 -0800 (PST)
In-Reply-To: <AANLkTi=zdc+jbS-0s4FByyP7MOwkzG1ye6ngrq0WrVO-@mail.gmail.com>
References: <47316FE3F6BA0D4DADF996635125526809F597EDA7@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
	<AANLkTi=zdc+jbS-0s4FByyP7MOwkzG1ye6ngrq0WrVO-@mail.gmail.com>
Date: Wed, 10 Nov 2010 21:12:52 -0800
Message-ID: <AANLkTim-siYDC9Wz=008MD74MSgFK2q=jzuwSD+kA8Bv@mail.gmail.com>
Subject: Re: API access to in-memory tii file (3.x not flex).
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Yeah that's customizing the Lucene source. :)  I should have gone into
more detail, I will next time.

On Wed, Nov 10, 2010 at 2:10 PM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> Actually, the .tii file pre-flex (3.x) is nearly identical to the .tis
> file, just that it only contains every 128th term.
>
> If you just make SegmentTermEnum public (or, sneak your class into
> oal.index package) then you can instantiate SegmentTermsEnum passing
> it an IndexInput opened on the .tii file.
>
> Then you can enum the terms directly...
>
> Mike
>
> On Wed, Nov 10, 2010 at 4:02 PM, Burton-West, Tom <tburtonw@umich.edu> wr=
ote:
>> Hello all,
>>
>> We have an extremely large number of terms in our indexes. =A0I want to =
be able to extract a sample of the terms, say something like every 128th te=
rm. =A0 If I use code based on org.apache.lucene.misc.HighFreqTerms or org.=
apache.lucene.index.CheckIndex I would get a TermsEnum, call termEnum.next(=
) 128 times, grab the term and then call next another 128 times.
>> termEnum =3D reader.terms();
>> while (termEnum.next()
>> { }
>>
>> Since the tii file contains every 128th (or IndexInterval ) term and it =
is loaded into memory, is there some programmatic way (in the public API) t=
o read that data structure in memory rather than having to force Lucene to =
actually read the entire tis file by using termEnum.next() ?
>>
>>
>> Tom Burton-West
>> http://www.hathitrust.org/blogs/large-scale-search
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47791-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 11 06:54:14 2010
Return-Path: <java-user-return-47791-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71656 invoked from network); 11 Nov 2010 06:54:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Nov 2010 06:54:14 -0000
Received: (qmail 33746 invoked by uid 500); 11 Nov 2010 06:54:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33587 invoked by uid 500); 11 Nov 2010 06:54:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33579 invoked by uid 99); 11 Nov 2010 06:54:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 06:54:43 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of dianpuma@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 06:54:35 +0000
Received: by iwn7 with SMTP id 7so1938131iwn.35
        for <java-user@lucene.apache.org>; Wed, 10 Nov 2010 22:54:14 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=psIs3/EiCe/gaewwBkoa+C55FZy8tbJhlhbomh44LMI=;
        b=kz7V3799Ljhy+cp8b2jQInuAm5m066nMMAhX+9hqNjgX/tyM+8ubG9oVqw7nQtIv4K
         EHNGy8TTo9Ygl6JZ42PfGwr1RsTX+0KYHAVEFixicm/Qq5uUWTiiRjVnvPjtv34ej756
         rn87CC8OX0avTPfcbkk7NDcJHHJ/xOzyvp++w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=TUzXVRynulwD9nG0xDJB58OB5aeWg+HWhUKxLnzwYey7t6XBXmxzlh1Lg2vWX7xSyZ
         qQ8M4gDTIGuaX43t4napMVOfEZA3QmgfgZLjJ5b0xd7QgWpOoxxv55BUjImnhF2n1xKA
         M/qbB+/95Gz1rjJPCudr9dIiwFxiYp7+wEfjk=
MIME-Version: 1.0
Received: by 10.231.14.199 with SMTP id h7mr256184iba.60.1289458452529; Wed,
 10 Nov 2010 22:54:12 -0800 (PST)
Received: by 10.231.148.205 with HTTP; Wed, 10 Nov 2010 22:54:12 -0800 (PST)
Date: Thu, 11 Nov 2010 13:54:12 +0700
Message-ID: <AANLkTimWskGmbNhR+2PzCsKybhGsrq=mrQHdKegiZa4d@mail.gmail.com>
Subject: Delete Document from Index. How?
From: dian puma <dianpuma@gmail.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi All,

I'm struggling with Lucene on deleting a specific document from the index.
I've read the book Lucene in Action to see how to do it.
There are 2 ways to delete documents from index, using
IndexWriter.deleteDocuments(term) OR IndexReader.deleteDocuments.
CMIIW

FYI, I use PHP/Java Bridge and Lucene 2.2,
But my code below didn't work, generating error:

Exception occured: [[o:Exception]:"java.lang.Exception: Invoke failed:
[[o:IndexWriter]]->deleteDocuments([o:Term]). Cause:
java.lang.NoSuchMethodException: deleteDocuments([o:Term]).
Candidates: [] Responsible VM: 1.6.0_20@http://java.sun.com/" at: #-5
php.java.bridge.JavaBridge.Invoke(JavaBridge.java:1045) #-4
php.java.bridge.Request.handleRequest(Request.java:342) #-3
php.java.bridge.Request.handleRequests(Request.java:388) #0
Java.inc(161): java_ThrowExceptionProxyFactory->getProxy(4, true) #1
Java.inc(314): java_Arg->getResult(true) #2 Java.inc(320):
java_Client->getWrappedResult(true) #3 Java.inc(499):
java_Client->getResult() #4 Java.inc(743):
java_Client->invokeMethod(2, 'deleteDocuments', Array) #5
Java.inc(861): java_JavaProxy->__call('deleteDocuments', Array) #6
[internal function]: Java->__call('deleteDocuments', Array)

============= snippet code with IndexWriter =============
$directory = dirname(__FILE__)."/../indexLucene/";
$path = getcwd()."/txtfiles/testing.txt";

if (strlen($path) > 0) {
       //delete
       echo "Delete [".$path."]</br>";
       $analyzer_idx = new
Java('org.apache.lucene.analysis.standard.StandardAnalyzer');
       $writer_idx = new
java("org.apache.lucene.index.IndexWriter",$directory, $analyzer_idx,
false);
       echo java_values($writer_idx->docCount());
       $term = new Java('org.apache.lucene.index.Term','pathfile',$path);
       $writer_idx->deleteDocuments($term);
       $writer_idx->close();
}//end if


Then, I tried to use IndexReader, instead.
But, even worst. It failed to echo the numDocs or just to close the reader.

error message:
Exception occured: [[o:Exception]:"java.lang.Exception: Invoke failed:
[[c:IndexReader]]->numDocs. Cause: java.lang.NoSuchMethodException:
numDocs()........................

======= snippet code with IndexReader ========
$directory = dirname(__FILE__)."/../indexLucene/";
$path = getcwd()."/txtfiles/testing.txt";
$reader = new Java('org.apache.lucene.index.IndexReader');
$reader->open($directory);
//echo java_values($reader->numDocs());
$reader->close();

Hopefully someone would help me for this.
Thanks in advance
--
Dian Puma

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47792-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 11 14:43:20 2010
Return-Path: <java-user-return-47792-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3772 invoked from network); 11 Nov 2010 14:43:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Nov 2010 14:43:20 -0000
Received: (qmail 46637 invoked by uid 500); 11 Nov 2010 14:43:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46483 invoked by uid 500); 11 Nov 2010 14:43:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46466 invoked by uid 99); 11 Nov 2010 14:43:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 14:43:48 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of glen.newton@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 14:43:41 +0000
Received: by qwg5 with SMTP id 5so2021qwg.35
        for <multiple recipients>; Thu, 11 Nov 2010 06:43:20 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=/9wwcsS+gmRbrcSJUkE6sRVcLJ/+o7n7y4j4qWZvP5I=;
        b=rH6fS7EbkfKCM3+fJwUEvXeenmJlwHBE70TJElT0nhPnOcuu29LzMKGDwNNQwMTfDp
         rfw78SaKklnW5HLHBREaKezx82B+Qizm/7sUtcxcsYE8YTRPRQAKUr/qmRRmoP/SAcxF
         PXYmrFTacXdUvjNyy3Xqry2DCsMoF8gKVOPFU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=YYirByCmMKV4OOmv8M/OqoIqSNvWO+sQkNsNTUSDSRw2rPG+pZZpseb1YTOwiqzRmh
         TfC43smMNzqtP9vVIcaRCOVE2R93eJKh9IFCI7VZbkQwjryQYCxZVXocmIZ0NaQ0CB72
         P+k+0Bdky9+nLC/wllwxxBBPvS974i3ndef0c=
Received: by 10.229.220.201 with SMTP id hz9mr778781qcb.194.1289486599586;
 Thu, 11 Nov 2010 06:43:19 -0800 (PST)
MIME-Version: 1.0
Received: by 10.229.67.35 with HTTP; Thu, 11 Nov 2010 06:42:59 -0800 (PST)
From: Glen Newton <glen.newton@gmail.com>
Date: Thu, 11 Nov 2010 09:42:59 -0500
Message-ID: <AANLkTi=XHOEP-s_BTzCXPZ88GA-nBE1awbbwTDg+0uiu@mail.gmail.com>
Subject: IndexTank technology...
To: solr <solr-user@lucene.apache.org>, java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Does anyone know what technology they are using: http://www.indextank.com/
Is it Lucene under the hood?

Thanks, and apologies for cross-posting.
-Glen

http://zzzoot.blogspot.com

-- 

-

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47793-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 11 18:43:06 2010
Return-Path: <java-user-return-47793-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54719 invoked from network); 11 Nov 2010 18:43:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Nov 2010 18:43:06 -0000
Received: (qmail 12626 invoked by uid 500); 11 Nov 2010 18:43:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12528 invoked by uid 500); 11 Nov 2010 18:43:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12520 invoked by uid 99); 11 Nov 2010 18:43:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 18:43:34 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 18:43:29 +0000
Received: by wwb17 with SMTP id 17so2365552wwb.5
        for <java-user@lucene.apache.org>; Thu, 11 Nov 2010 10:43:07 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.0.79 with SMTP id 57mr1189929wea.39.1289500987476; Thu, 11
 Nov 2010 10:43:07 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Thu, 11 Nov 2010 10:43:07 -0800 (PST)
In-Reply-To: <003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
References: <AANLkTinPCWQq79725v8MTjYf+rQHtQot6-MTzZT0D1=i@mail.gmail.com>
	<001201cb8100$c804ec20$580ec460$@thetaphi.de>
	<AANLkTikdpcv_kQ+bgwkJtpHrAjF3amPz7Re9tond=MEK@mail.gmail.com>
	<003801cb810f$2fc25ab0$8f471010$@thetaphi.de>
Date: Thu, 11 Nov 2010 13:43:07 -0500
Message-ID: <AANLkTikFAXdTTHsgx_yFpJRt6R9H_Pv4tnu7=kWY6BG6@mail.gmail.com>
Subject: Re: IndexWriters and write locks
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Wed, Nov 10, 2010 at 2:40 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> Are you using NFS as filesystem? NFS is incompatible to lucene :-)

Actually Lucene can work over NFS, except, it's not a well tested combination.

However, because NFS does not protect open files from deletion, you
must use an app-specific deletion policy to protect commit points
still in use.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47794-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 11 20:52:20 2010
Return-Path: <java-user-return-47794-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15093 invoked from network); 11 Nov 2010 20:52:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 11 Nov 2010 20:52:19 -0000
Received: (qmail 69695 invoked by uid 500); 11 Nov 2010 20:52:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69514 invoked by uid 500); 11 Nov 2010 20:52:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69498 invoked by uid 99); 11 Nov 2010 20:52:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 20:52:45 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 11 Nov 2010 20:52:37 +0000
Received: by fxm10 with SMTP id 10so1376395fxm.35
        for <multiple recipients>; Thu, 11 Nov 2010 12:52:17 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:reply-to:received
         :date:x-google-sender-auth:message-id:subject:from:to:content-type;
        bh=JF2V8Dk5Tg/CjI4OwNE6EZQ3tmp6RY0ODZ42Y/rItrg=;
        b=iKk81mtU47Pps4gfAGJAeMWXKVkhkXE07U35sxBtj0MRiBn+aB+UCKaVYIfQPfJzlv
         1VnxOvWE2H9nbSrKBJMZ3mTgIaMq+MLSfPafpkrY0iwxfFoyfo5nrNs4L/d9cZ9OmKT7
         q0NfCVl74W3U5oTma3ez/fFqk+WyrJ1FWOPeY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:date:x-google-sender-auth:message-id
         :subject:from:to:content-type;
        b=U3/sgWgk16I3NWeogv7kQ7Em1SD8X2UC19DKgaNI5Rs4uPHyKjNBfsYeG4xGsnN93L
         oVet7UCuL0SzqpPx0bZDqWiMse21hnstcVsA3eaqWwfDYLWzrajyVvlKObuQxe181bK8
         AKGLve25Kf72o5vP9q0MAp6+Ns5udFqLOUFd4=
MIME-Version: 1.0
Received: by 10.223.102.69 with SMTP id f5mr628933fao.107.1289508737284; Thu,
 11 Nov 2010 12:52:17 -0800 (PST)
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.74.202 with HTTP; Thu, 11 Nov 2010 12:52:17 -0800 (PST)
Date: Thu, 11 Nov 2010 15:52:17 -0500
X-Google-Sender-Auth: AdKITLhSK6baBcaOE3aRponEIcw
Message-ID: <AANLkTi=mJ42aFiXyh3bAMTPj+MudHeH6uJK8JS5xMWgw@mail.gmail.com>
Subject: FAST ESP -> Solr migration webinar
From: Yonik Seeley <yonik@lucidimagination.com>
To: solr-user@lucene.apache.org, java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

We're holding a free webinar on migration from FAST to Solr.  Details below.

-Yonik
http://www.lucidimagination.com

=============================================================================
Solr To The Rescue: Successful Migration From FAST ESP to Open Source
Search Based on Apache Solr

Thursday, Nov 18, 2010, 14:00 EST (19:00 GMT)
Hosted by SearchDataManagement.com

For anyone concerned about the future of their FAST ESP applications
since the purchase of Fast Search and Transfer by Microsoft in 2008,
this webinar will provide valuable insights on making the switch to
Solr.  A three-person rountable will discuss factors driving the need
for FAST ESP alternatives, differences between FAST and Solr, a
typical migration project lifecycle & methodology, complementary open
source tools, best practices, customer examples, and recommended next
steps.

The speakers for this webinar are:

Helge Legernes, Founding Partner & CTO of Findwise
Michael McIntosh, VP Search Solutions for TNR Global
Eric Gaumer, Chief Architect for ESR Technology.

For more information and to register, please go to:

http://SearchDataManagement.bitpipe.com/detail/RES/1288718603_527.html?asrc=CL_PRM_Lucid2
=============================================================================

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47795-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 07:30:26 2010
Return-Path: <java-user-return-47795-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 99402 invoked from network); 12 Nov 2010 07:30:26 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 07:30:26 -0000
Received: (qmail 43191 invoked by uid 500); 12 Nov 2010 07:30:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43009 invoked by uid 500); 12 Nov 2010 07:30:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42988 invoked by uid 99); 12 Nov 2010 07:30:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 07:30:54 +0000
X-ASF-Spam-Status: No, hits=2.8 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLYTO,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 07:30:47 +0000
Received: by qwf7 with SMTP id 7so837402qwf.35
        for <java-user@lucene.apache.org>; Thu, 11 Nov 2010 23:30:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=mc7GvZe/RP9O8dZmVqihopRpz6D0mcYswQTY6mePMbw=;
        b=khfqJLwNRhk8zfw2T2NFrdrkv1BjAOJnfVZV/Ki5C1RRCgnff9pbGA4ujSW1z2jEta
         FyAMs0SZNcHdDSxX2WJOvtKxdhzqsixZFnh/OeayAyo22aPH5bJC7/UFJrXZIStvIDi2
         3XEkdr7XYex06KwSQSRsdgEJCgw4OHMHziez0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        b=s398VX8+1Y8cuwPQRKmsHyRYYU8CXY5J4FFOByVWVLKfdsyQDoXdvGhKmWawsO4Uwu
         txjehK+lT1Sr3oHvTPawJgqIrGDLuqXsTqoQEvDPMuc83UVFi1hOXm5qqsb2lKqb5qVX
         tjC//a+zSsAYNqgHzJrYAujBGRzhtmN+h0aMw=
MIME-Version: 1.0
Received: by 10.229.235.142 with SMTP id kg14mr1697268qcb.128.1289547026568;
 Thu, 11 Nov 2010 23:30:26 -0800 (PST)
Received: by 10.229.100.139 with HTTP; Thu, 11 Nov 2010 23:30:26 -0800 (PST)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <1289439706.9757.28.camel@bdilley-workstation>
References: <1289439706.9757.28.camel@bdilley-workstation>
Date: Fri, 12 Nov 2010 08:30:26 +0100
Message-ID: <AANLkTi=cXsdeU5XgHQkYdcMcv-d3H-Oty3y9xdoZLoNN@mail.gmail.com>
Subject: Re: Non matched terms
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org, brian@shopnation.com
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

I assume that you don't use trunk and you don't have access to the new
Scorer#visitScorers(ScorerVisitor<Query, Query, Scorer> visitor)
methods which would make that little easier I guess. Yet, what you
could do is you could override TermQuery and wrap the created scorer
such that you set a flag if and only if that scorer scores a document
(which corresponds to a match then). that way you can afterwards
easily figure out what parts of you query did or did not match.

does that help?

simon


On Thu, Nov 11, 2010 at 2:41 AM, Brian C. Dilley <brian@shopnation.com> wro=
te:
> Hi, I'm using Lucene for a search project and I have the following
> requirements and I was wondering if one of you fine folks could point me
> in the right direction (currently i'm using the RAMDirectory,
> IndexSearcher, StandardAnalyzer and QueryParser):
>
> Given the example search string:
>
> "red leather calvin klein shiny pants"
>
> I will be searching 2 indexes. =C2=A0One is an index of category names th=
e
> other is an index of attributes. =C2=A0Lets say the following happens:
>
> red - matches an attribute
> leather - matches an attribute
> calvin klein - matches an antribute
> pants - matches a category
> shiny - matches nothing.
>
> I want to identify the non-matching "shiny" search term. =C2=A0That is, g=
iven
> a search string i want lucene to tell me what part(s) of it don't match
> anything.
>
> Is this possible? =C2=A0I've tried using extractTerms (along with another=
 API
> call that I am forgetting the name of right now) but it doesn't work for
> all Query types (ie: Fuzzy).
>
> Thanks in advance!
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47796-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 10:49:55 2010
Return-Path: <java-user-return-47796-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88214 invoked from network); 12 Nov 2010 10:49:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 10:49:54 -0000
Received: (qmail 33761 invoked by uid 500); 12 Nov 2010 10:50:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33724 invoked by uid 500); 12 Nov 2010 10:50:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33716 invoked by uid 99); 12 Nov 2010 10:50:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 10:50:23 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of trewig@mufin.com designates 195.214.216.124 as permitted sender)
Received: from [195.214.216.124] (HELO mx4.de.magix.net) (195.214.216.124)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 10:50:17 +0000
Received: from [192.168.1.18] (port=21769)
	by mx4.de.magix.net with esmtpa (Exim 4.69)
	(envelope-from <trewig@mufin.com>)
	id 1PGrCd-0003dW-P4
	for java-user@lucene.apache.org; Fri, 12 Nov 2010 11:49:55 +0100
Message-ID: <4CDD1BCA.5000700@mufin.com>
Date: Fri, 12 Nov 2010 11:49:46 +0100
From: Thomas Rewig <trewig@mufin.com>
Organization: mufin
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.9) Gecko/20100915 Thunderbird/3.1.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Deleted File Handles - Index Writer
Content-Type: multipart/alternative;
 boundary="------------070909040104040102010200"
X-SA-Exim-Connect-IP: 192.168.1.18
X-SA-Exim-Mail-From: trewig@mufin.com
X-SA-Exim-Scanned: No (on mx4.de.magix.net); SAEximRunCond expanded to false

--------------070909040104040102010200
Content-Type: text/plain; charset=ISO-8859-15; format=flowed
Content-Transfer-Encoding: 7bit

  Hello,

I use the searcherManager for LiveIndexing. With  watch -n 60 "lsof | 
grep indexname | grep deleted | wc -l" I see the number of deleted file 
handles. The number of handles fluctuates during the indexing.  0 -> 35 
-> 53 -> 135 -> 40 -> 85 ... Uwe said that this is expected because 
segments are still referenced by the open IndexReaders, but files were 
already deleted by IndexWriter.

But something puzzles me:

Let's say we have a deleted file handle number of 85. If I switch the 
NearRealTime Searcher to the readOnlySearcher the file handle number is 
still 85. If i close afterwards the no more used indexwriter, the number 
drops to 35.  I think that means, that the indexwriter referenced 
deleted files that are not referenced by the readers.  It seems, that 
with every commit the number of deleted file handles (which maybe are 
"caused" by the indexwriter) grows.
Is that possible and if yes why does the indexwriter do it? Is there a 
max Value of deleted handles an IndexWriter could own, because I don't 
want to chrash the system because of too much open filehandles?

Thanks in advance.
Thomas
-- 


--------------070909040104040102010200--

From java-user-return-47797-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 12:07:23 2010
Return-Path: <java-user-return-47797-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27619 invoked from network); 12 Nov 2010 12:07:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 12:07:23 -0000
Received: (qmail 92536 invoked by uid 500); 12 Nov 2010 12:07:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92441 invoked by uid 500); 12 Nov 2010 12:07:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92432 invoked by uid 99); 12 Nov 2010 12:07:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 12:07:50 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 12:07:44 +0000
Received: by ywp4 with SMTP id 4so2062556ywp.35
        for <java-user@lucene.apache.org>; Fri, 12 Nov 2010 04:07:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=1vNPzebOAFMUPYCU4YdJEJt2YOg87dIiIR17wjmTpZc=;
        b=pBzjQsUcs5D7hcVjKe72VqxNU/RH+nzhZ7xrSqG269zuWuVaiWWSTfSyKLqnx2ColC
         Hp+JKl5yOX30JA9iFArSmB1WGnRuawzF5ECRMVg0sblMGvB6BLJwoVvnv/1g6QXnyphX
         VsiwS26+yv36rl13YIxmR5etNuEPk4eTwWt9o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=BHBeNcTuqo4iF4k2gZU+56krqWPBFjqdotyiuSZicg8MyfxeRceLlPTi0LX6A/1a8f
         vyyoKGMxCNx7DKjIYzcLgBCQWnxL3V8iOfSs6prCtW+AA1Fttb6C8JPGi+zxr/F0jwu9
         uH8V82Kl5WD5IGYM+hSX3M6KCBaOwJzKaXDds=
MIME-Version: 1.0
Received: by 10.150.202.11 with SMTP id z11mr3765591ybf.207.1289563642504;
 Fri, 12 Nov 2010 04:07:22 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Fri, 12 Nov 2010 04:07:22 -0800 (PST)
In-Reply-To: <AANLkTimWskGmbNhR+2PzCsKybhGsrq=mrQHdKegiZa4d@mail.gmail.com>
References: <AANLkTimWskGmbNhR+2PzCsKybhGsrq=mrQHdKegiZa4d@mail.gmail.com>
Date: Fri, 12 Nov 2010 07:07:22 -0500
Message-ID: <AANLkTin0_d_SE05vtZVnNiC8mLsCP5_NUXr2j5Epod6e@mail.gmail.com>
Subject: Re: Delete Document from Index. How?
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd4d35cd3a73b0494d9ee55

--000e0cd4d35cd3a73b0494d9ee55
Content-Type: text/plain; charset=UTF-8

Looked at 2.2 api and those methods should be there. So the
NoSuchMethodException makes no sense.
Are you absolutely sure that your integration between PHP & Java is setup
properly and you really are using 2.2?
Could there be multiple versions of lucene jars in your classpath? such that
older ones might be getting in your way and you wouldn't really be accessing
the 2.2 jars?

On Thu, Nov 11, 2010 at 1:54 AM, dian puma <dianpuma@gmail.com> wrote:

> Hi All,
>
> I'm struggling with Lucene on deleting a specific document from the index.
> I've read the book Lucene in Action to see how to do it.
> There are 2 ways to delete documents from index, using
> IndexWriter.deleteDocuments(term) OR IndexReader.deleteDocuments.
> CMIIW
>
> FYI, I use PHP/Java Bridge and Lucene 2.2,
> But my code below didn't work, generating error:
>
> Exception occured: [[o:Exception]:"java.lang.Exception: Invoke failed:
> [[o:IndexWriter]]->deleteDocuments([o:Term]). Cause:
> java.lang.NoSuchMethodException: deleteDocuments([o:Term]).
> Candidates: [] Responsible VM: 1.6.0_20@http://java.sun.com/" at: #-5
> php.java.bridge.JavaBridge.Invoke(JavaBridge.java:1045) #-4
> php.java.bridge.Request.handleRequest(Request.java:342) #-3
> php.java.bridge.Request.handleRequests(Request.java:388) #0
> Java.inc(161): java_ThrowExceptionProxyFactory->getProxy(4, true) #1
> Java.inc(314): java_Arg->getResult(true) #2 Java.inc(320):
> java_Client->getWrappedResult(true) #3 Java.inc(499):
> java_Client->getResult() #4 Java.inc(743):
> java_Client->invokeMethod(2, 'deleteDocuments', Array) #5
> Java.inc(861): java_JavaProxy->__call('deleteDocuments', Array) #6
> [internal function]: Java->__call('deleteDocuments', Array)
>
> ============= snippet code with IndexWriter =============
> $directory = dirname(__FILE__)."/../indexLucene/";
> $path = getcwd()."/txtfiles/testing.txt";
>
> if (strlen($path) > 0) {
>       //delete
>       echo "Delete [".$path."]</br>";
>       $analyzer_idx = new
> Java('org.apache.lucene.analysis.standard.StandardAnalyzer');
>       $writer_idx = new
> java("org.apache.lucene.index.IndexWriter",$directory, $analyzer_idx,
> false);
>       echo java_values($writer_idx->docCount());
>       $term = new Java('org.apache.lucene.index.Term','pathfile',$path);
>       $writer_idx->deleteDocuments($term);
>       $writer_idx->close();
> }//end if
>
>
> Then, I tried to use IndexReader, instead.
> But, even worst. It failed to echo the numDocs or just to close the reader.
>
> error message:
> Exception occured: [[o:Exception]:"java.lang.Exception: Invoke failed:
> [[c:IndexReader]]->numDocs. Cause: java.lang.NoSuchMethodException:
> numDocs()........................
>
> ======= snippet code with IndexReader ========
> $directory = dirname(__FILE__)."/../indexLucene/";
> $path = getcwd()."/txtfiles/testing.txt";
> $reader = new Java('org.apache.lucene.index.IndexReader');
> $reader->open($directory);
> //echo java_values($reader->numDocs());
> $reader->close();
>
> Hopefully someone would help me for this.
> Thanks in advance
> --
> Dian Puma
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd4d35cd3a73b0494d9ee55--

From java-user-return-47798-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 15:05:34 2010
Return-Path: <java-user-return-47798-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16401 invoked from network); 12 Nov 2010 15:05:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 15:05:34 -0000
Received: (qmail 93975 invoked by uid 500); 12 Nov 2010 15:06:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93907 invoked by uid 500); 12 Nov 2010 15:06:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93891 invoked by uid 99); 12 Nov 2010 15:06:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 15:06:01 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jhandl@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 15:05:55 +0000
Received: by wyf19 with SMTP id 19so3444910wyf.35
        for <java-user@lucene.apache.org>; Fri, 12 Nov 2010 07:05:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:reply-to:received
         :in-reply-to:references:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        bh=JrcNIBSLLMmmmGivPFNdS181jY/Fd2XofmMmuDcEQhU=;
        b=BkaEo7O/qZ/AYztZX4LnnNhB/DOzHfcmki+SmfHeRv6SaDJCzZFyF6Xju2nB8Shljh
         OP/YNLYNrRsDsNAONu1w8c6d9CxC3DBgOxGoRY/qMV+7AOtnCpEbSWVuvDcvpJbahOKd
         cPCI9VX2c4UpbY6yFimj+bk6/IF+uxBgDmQ1E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        b=ppbOSCka57j7dLZ35Q5adWShimp9RT0abNtk1qo6Sa55XsnhbaV11iuHV5s4M+krlB
         /AFBDWZj2HOwHQIMNL19rWirElmfh1jMb7ui9yCybc/wVUNg0u1nDujm8eeFF1F4RZ0O
         BYwu2yua3DZ/0/1SKqhKtmMDX8GRHHTis4ClE=
Received: by 10.227.137.76 with SMTP id v12mr2535141wbt.16.1289574333357; Fri,
 12 Nov 2010 07:05:33 -0800 (PST)
MIME-Version: 1.0
Sender: jhandl@gmail.com
Reply-To: jhandl@flaptor.com
Received: by 10.227.144.195 with HTTP; Fri, 12 Nov 2010 07:05:03 -0800 (PST)
In-Reply-To: <AANLkTi=XHOEP-s_BTzCXPZ88GA-nBE1awbbwTDg+0uiu@mail.gmail.com>
References: <AANLkTi=XHOEP-s_BTzCXPZ88GA-nBE1awbbwTDg+0uiu@mail.gmail.com>
From: Jorge Handl <jhandl@flaptor.com>
Date: Fri, 12 Nov 2010 12:05:03 -0300
X-Google-Sender-Auth: r_TCIXK_5hjwavHdv8hCekHEoxg
Message-ID: <AANLkTin3WQv9csQ0B-5Y+wVG4s9tLE8LQMO3sZgFA5tL@mail.gmail.com>
Subject: Re: IndexTank technology...
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e659f5340d23320494dc6c40

--0016e659f5340d23320494dc6c40
Content-Type: text/plain; charset=ISO-8859-1

> Does anyone know what technology they are using: http://www.indextank.com/
> Is it Lucene under the hood?
> Thanks, and apologies for cross-posting.
> -Glen

I happen to be one of Indextank's developers, so I think I'm qualified to
answer your question! ;)
We do use a small portion of Lucene, namely the index file structure and
tokenizer, but not much else. We think lucene's inverted index is a good
implementation and didn't want to mess with tokenizers at this point, so we
didn't feel the need to replace those, although we might in the future.

Regards,
Jorge

--0016e659f5340d23320494dc6c40--

From java-user-return-47799-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 15:34:10 2010
Return-Path: <java-user-return-47799-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26369 invoked from network); 12 Nov 2010 15:34:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 15:34:09 -0000
Received: (qmail 41621 invoked by uid 500); 12 Nov 2010 15:34:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41516 invoked by uid 500); 12 Nov 2010 15:34:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 16163 invoked by uid 99); 12 Nov 2010 15:18:32 -0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 216.139.236.158 is neither permitted nor denied by domain of marc.sturlese@gmail.com)
Date: Fri, 12 Nov 2010 07:18:05 -0800 (PST)
From: Marc Sturlese <marc.sturlese@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1289575085649-1889378.post@n3.nabble.com>
Subject: performance merging indexes with addIndexesNoOptimize
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


I am doing some test about merge indexing and have a performance doubt 
I am doing merge in a simple way, something like: 

      FSDirectory indexes[] = new FSDirectory[indexList.size()]; 
      for (int i = 0; i < indexList.size(); i++) { 
        indexes[i] = FSDirectory.open(new File(indexList.get(i))); 
      } 
      w.addIndexesNoOptimize(indexes); 
      w.close(); 

IndexList.size() is 50 and contains paths to index. These 50 indexes contain
500.000 docs each and have about 500m size each (each index). I have
realised that 50% of the time is spent in w.addIndexesNoOptimize(indexes)
and the other 50 in w.close() (I suppose because close commits and have to
wait for all the merges to be completed). 

I am wondering if is there a way to do this faster. For example, merge the
50 indexes into 25 indexes, these 25 into 12, these 12 into 6... till geting
a single big index. Could this be faster? 

Does anyone have experience with this? Any advice? 
Thanks in advance
-- 
View this message in context: http://lucene.472066.n3.nabble.com/performance-merging-indexes-with-addIndexesNoOptimize-tp1889378p1889378.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47800-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 16:39:29 2010
Return-Path: <java-user-return-47800-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63398 invoked from network); 12 Nov 2010 16:39:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 16:39:29 -0000
Received: (qmail 51264 invoked by uid 500); 12 Nov 2010 16:39:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51178 invoked by uid 500); 12 Nov 2010 16:39:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51170 invoked by uid 99); 12 Nov 2010 16:39:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 16:39:57 +0000
X-ASF-Spam-Status: No, hits=1.3 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 209.85.210.48 as permitted sender)
Received: from [209.85.210.48] (HELO mail-pz0-f48.google.com) (209.85.210.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 16:39:49 +0000
Received: by pzk35 with SMTP id 35so777924pzk.35
        for <java-user@lucene.apache.org>; Fri, 12 Nov 2010 08:39:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=eoBfA6UMKLIVp+A1dS5lEONUVnUMi2Z1U/pB6V56PwI=;
        b=vidXRLzrHmpADCvyUosP7aCLIsTW/B3tZz0Hdw304ks4DHK03Y4Bd6qlXQZR11GFFz
         ojZdlkHU2MgsHDAi8h6qTJ0/iRXLEGBwvEmCRjGX1MT6Bi+Fc0xt4IaSz3eQ6LjpPQGV
         PRj5VSX5gcur8tgaoA5hbXRLd22sz+VkpF6tQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=NCZsSTDXCdJZSM0mB9Zor68bW9F+EhNpgPKMUPi+qIIArB/Pgvpbxpa3fVJuu/S38G
         m+fi4PnArtA2os+qodJy1fUhmBC8YWeXcQH8IUj0DaBGE/eTw9tMY+O9DvmVbDzogBs9
         Kn8X5nBaWD3iU8wAl63sVyX5FnBuhXPbRkDU0=
MIME-Version: 1.0
Received: by 10.142.158.8 with SMTP id g8mr2080731wfe.281.1289579968085; Fri,
 12 Nov 2010 08:39:28 -0800 (PST)
Received: by 10.142.229.21 with HTTP; Fri, 12 Nov 2010 08:39:28 -0800 (PST)
In-Reply-To: <1289575085649-1889378.post@n3.nabble.com>
References: <1289575085649-1889378.post@n3.nabble.com>
Date: Fri, 12 Nov 2010 18:39:28 +0200
Message-ID: <AANLkTimii717u4aEiyWtVH4JBBzpMe+4vWn5-aEtNq+W@mail.gmail.com>
Subject: Re: performance merging indexes with addIndexesNoOptimize
From: Shai Erera <serera@gmail.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

 In Lucene 3x there is a new addIndexes which accepts Directory=85 that
simply registers the new indexes in the index, without running merges.
That makes addIndexes very fast.

Also, you can consider calling close(false) to not wait for merges.
That can speed things up as well.

But note that not running merges, or letting them finish, is not
recommended long term. The approachs I've mentioned are good if you
want to quickly add new indexes and plan to run index optimization at
a later time.

Shai

On Friday, November 12, 2010, Marc Sturlese <marc.sturlese@gmail.com> wrote=
:
>
> I am doing some test about merge indexing and have a performance doubt
> I am doing merge in a simple way, something like:
>
>  =A0 =A0 =A0FSDirectory indexes[] =3D new FSDirectory[indexList.size()];
>  =A0 =A0 =A0for (int i =3D 0; i < indexList.size(); i++) {
>  =A0 =A0 =A0 =A0indexes[i] =3D FSDirectory.open(new File(indexList.get(i)=
));
>  =A0 =A0 =A0}
>  =A0 =A0 =A0w.addIndexesNoOptimize(indexes);
>  =A0 =A0 =A0w.close();
>
> IndexList.size() is 50 and contains paths to index. These 50 indexes cont=
ain
> 500.000 docs each and have about 500m size each (each index). I have
> realised that 50% of the time is spent in w.addIndexesNoOptimize(indexes)
> and the other 50 in w.close() (I suppose because close commits and have t=
o
> wait for all the merges to be completed).
>
> I am wondering if is there a way to do this faster. For example, merge th=
e
> 50 indexes into 25 indexes, these 25 into 12, these 12 into 6... till get=
ing
> a single big index. Could this be faster?
>
> Does anyone have experience with this? Any advice?
> Thanks in advance
> --
> View this message in context: http://lucene.472066.n3.nabble.com/performa=
nce-merging-indexes-with-addIndexesNoOptimize-tp1889378p1889378.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47801-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 17:12:05 2010
Return-Path: <java-user-return-47801-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84295 invoked from network); 12 Nov 2010 17:12:04 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 17:12:04 -0000
Received: (qmail 98145 invoked by uid 500); 12 Nov 2010 17:12:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97929 invoked by uid 500); 12 Nov 2010 17:12:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 82754 invoked by uid 99); 12 Nov 2010 16:57:06 -0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of marc.sturlese@gmail.com)
Date: Fri, 12 Nov 2010 08:56:37 -0800 (PST)
From: Marc Sturlese <marc.sturlese@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1289580997422-1890077.post@n3.nabble.com>
In-Reply-To: <AANLkTimii717u4aEiyWtVH4JBBzpMe+4vWn5-aEtNq+W@mail.gmail.com>
References: <1289575085649-1889378.post@n3.nabble.com> <AANLkTimii717u4aEiyWtVH4JBBzpMe+4vWn5-aEtNq+W@mail.gmail.com>
Subject: Re: performance merging indexes with addIndexesNoOptimize
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org


Thanks a lot Shai, couple of questions:

>> In Lucene 3x there is a new addIndexes which accepts Directory=E2=80=A6 =
that=20
>> simply registers the new indexes in the index, without running merges.=
=20
>> That makes addIndexes very fast.=20
With the lucene 3.X addIndexes which accepts Directory, if after the merge =
I
need to optimize the index using compound file, what would happen? Would
this optimize be slower than if I use the addIndexesNoOptimize?

>> But note that not running merges, or letting them finish, is not=20
>> recommended long term. The approach I've mentioned are good if you=20
>> want to quickly add new indexes and plan to run index optimization at=20
>> a later time.

Actually I always build all the "small indexes" from scratch and have to
optimize my final index using compound file (the merged one). If i do:
w.optimze() ;=20
w.close (false) ;
Would I be getting any benefit if the w.close (false) ?

Thanks in advance


--=20
View this message in context: http://lucene.472066.n3.nabble.com/performanc=
e-merging-indexes-with-addIndexesNoOptimize-tp1889378p1890077.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47802-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 17:22:36 2010
Return-Path: <java-user-return-47802-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89427 invoked from network); 12 Nov 2010 17:22:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 17:22:36 -0000
Received: (qmail 22714 invoked by uid 500); 12 Nov 2010 17:23:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22676 invoked by uid 500); 12 Nov 2010 17:23:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22668 invoked by uid 99); 12 Nov 2010 17:23:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 17:23:05 +0000
X-ASF-Spam-Status: No, hits=3.5 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 17:22:57 +0000
Received: by pwj9 with SMTP id 9so792828pwj.35
        for <java-user@lucene.apache.org>; Fri, 12 Nov 2010 09:22:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=AQKdRDwRXFOvUw8GQ2LDyFgDw7pmPnJuTLjug15oHDQ=;
        b=soPB/TYeT6fLHandZwThcLAVWCQ59vDTR+unCs+h9pr351AJ53m5EyZa3rU1dr1i2n
         iaZkpWvAMSd2plY9oOMsy//XC7GT9l5ZXmDyQ9JIIWXi6fTaYUtW6Q4lYdjA6A1JuHQX
         ZvOkudtKr1lp3uuZlDMNP+xyv/fY5PChHv4VE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=NOymajOA8bdV+WRL/aANmlJPjLtIdff0ZzIxE7pCp65XkTIbIgY+69pyHNGbfK1yjJ
         3Q3Z7f+dZ6e5ykpoZl12W0t1zRrNY9G+ivhgOS1j/kDTEMKhPcSa+CPt4K9hcAhJI+OD
         uuD6YF9r/VaPWvRjdbww2fgL8fPgJW/W2V4hU=
MIME-Version: 1.0
Received: by 10.142.158.8 with SMTP id g8mr2145849wfe.281.1289582554558; Fri,
 12 Nov 2010 09:22:34 -0800 (PST)
Received: by 10.142.229.21 with HTTP; Fri, 12 Nov 2010 09:22:34 -0800 (PST)
In-Reply-To: <1289580997422-1890077.post@n3.nabble.com>
References: <1289575085649-1889378.post@n3.nabble.com>
	<AANLkTimii717u4aEiyWtVH4JBBzpMe+4vWn5-aEtNq+W@mail.gmail.com>
	<1289580997422-1890077.post@n3.nabble.com>
Date: Fri, 12 Nov 2010 19:22:34 +0200
Message-ID: <AANLkTikAonkaNvNQqfnF1qNFOakJ-8C9=aHNuY3Lv69r@mail.gmail.com>
Subject: Re: performance merging indexes with addIndexesNoOptimize
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd181be12b16d0494de5699
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd181be12b16d0494de5699
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Ok, so a couple of clarifications:

addIndexes(Directory...) *does not* trigger any merges. It simply registers
the incoming directories in the target index, and returns. You can later
call maybeMerge() or optimize() as you see fit.

Compound files are irrelevant to addIndexes - it just adds the incoming
ones. To later merge them and into a compound file, you'd have to change th=
e
MergePolicy settings to create compound files and then call optimize(). Thi=
s
is true even if you're not using addIndexes - say you're adding documents t=
o
an index w/ setUseCompoundFiles(false), commits a couple of times, then
setUseCompFiles(true) and call optimize(), they will be converted to
compound files.

Calling w.optimize() will trigger merges and wait for all of them to
complete before the method returns. Therefore calling close() or
close(false) afterwards is the same. Calling optimize(false) followed by a
close(false) (immediately) means that ~0 merges will complete, so that's no=
t
good either.

If you want optimize to finish, call optimize(). If you want to close the
IndexWriter as soon as possible, call close(false). Placing these two metho=
d
calls immediately one after the other makes sense only if you call either:
1) optimize(); close(); or
2) optimize(false); close();

In either case, you want to wait for merges. If you don't want that, then
just don't call optimize() can use close(false).

Shai

On Fri, Nov 12, 2010 at 6:56 PM, Marc Sturlese <marc.sturlese@gmail.com>wro=
te:

>
> Thanks a lot Shai, couple of questions:
>
> >> In Lucene 3x there is a new addIndexes which accepts Directory=85 that
> >> simply registers the new indexes in the index, without running merges.
> >> That makes addIndexes very fast.
> With the lucene 3.X addIndexes which accepts Directory, if after the merg=
e
> I
> need to optimize the index using compound file, what would happen? Would
> this optimize be slower than if I use the addIndexesNoOptimize?
>
> >> But note that not running merges, or letting them finish, is not
> >> recommended long term. The approach I've mentioned are good if you
> >> want to quickly add new indexes and plan to run index optimization at
> >> a later time.
>
> Actually I always build all the "small indexes" from scratch and have to
> optimize my final index using compound file (the merged one). If i do:
> w.optimze() ;
> w.close (false) ;
> Would I be getting any benefit if the w.close (false) ?
>
> Thanks in advance
>
>
> --
> View this message in context:
> http://lucene.472066.n3.nabble.com/performance-merging-indexes-with-addIn=
dexesNoOptimize-tp1889378p1890077.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd181be12b16d0494de5699--

From java-user-return-47803-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 19:25:08 2010
Return-Path: <java-user-return-47803-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71668 invoked from network); 12 Nov 2010 19:25:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 19:25:08 -0000
Received: (qmail 34595 invoked by uid 500); 12 Nov 2010 19:25:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34535 invoked by uid 500); 12 Nov 2010 19:25:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 28971 invoked by uid 99); 12 Nov 2010 18:27:36 -0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=FREEMAIL_FROM,SPF_HELO_PASS,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 216.139.236.158 is neither permitted nor denied by domain of marc.sturlese@gmail.com)
Date: Fri, 12 Nov 2010 10:27:06 -0800 (PST)
From: Marc Sturlese <marc.sturlese@gmail.com>
To: java-user@lucene.apache.org
Message-ID: <1289586426676-1890595.post@n3.nabble.com>
In-Reply-To: <AANLkTikAonkaNvNQqfnF1qNFOakJ-8C9=aHNuY3Lv69r@mail.gmail.com>
References: <1289575085649-1889378.post@n3.nabble.com> <AANLkTimii717u4aEiyWtVH4JBBzpMe+4vWn5-aEtNq+W@mail.gmail.com> <1289580997422-1890077.post@n3.nabble.com> <AANLkTikAonkaNvNQqfnF1qNFOakJ-8C9=aHNuY3Lv69r@mail.gmail.com>
Subject: Re: performance merging indexes with addIndexesNoOptimize
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Thanks, so clarifying. As far as I've understood, if I have to end up
optimizing the index just after merging it, no matter if I use the lucene
3.X addIndexes or addIndexesNoOptimize as the sum of time of doing both
things will be the same in one case or other. Am I right?

-- 
View this message in context: http://lucene.472066.n3.nabble.com/performance-merging-indexes-with-addIndexesNoOptimize-tp1889378p1890595.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47804-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 12 22:21:29 2010
Return-Path: <java-user-return-47804-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63993 invoked from network); 12 Nov 2010 22:21:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 12 Nov 2010 22:21:28 -0000
Received: (qmail 48588 invoked by uid 500); 12 Nov 2010 22:21:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48543 invoked by uid 500); 12 Nov 2010 22:21:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48535 invoked by uid 99); 12 Nov 2010 22:21:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 22:21:57 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 12 Nov 2010 22:21:50 +0000
Received: by wyf19 with SMTP id 19so3872807wyf.35
        for <java-user@lucene.apache.org>; Fri, 12 Nov 2010 14:21:29 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.177.71 with SMTP id c49mr4346760wem.54.1289600488531; Fri,
 12 Nov 2010 14:21:28 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Fri, 12 Nov 2010 14:21:28 -0800 (PST)
In-Reply-To: <4CDD1BCA.5000700@mufin.com>
References: <4CDD1BCA.5000700@mufin.com>
Date: Fri, 12 Nov 2010 17:21:28 -0500
Message-ID: <AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
Subject: Re: Deleted File Handles - Index Writer
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Are you using compound file format (the default)?

If you turn that off (just for this test) do you still see that
IndexWriter is holding open the files (35 in your example) after you
close all readers?

I've found a case, only with compound file, where IndexWriter holds
open a SegmentReader on the pre-compound-file files... I'm working on
a test case & fix.

Mike

On Fri, Nov 12, 2010 at 5:49 AM, Thomas Rewig <trewig@mufin.com> wrote:
> =A0Hello,
>
> I use the searcherManager for LiveIndexing. With =A0watch -n 60 "lsof | g=
rep
> indexname | grep deleted | wc -l" I see the number of deleted file handle=
s.
> The number of handles fluctuates during the indexing. =A00 -> 35 -> 53 ->=
 135
> -> 40 -> 85 ... Uwe said that this is expected because segments are still
> referenced by the open IndexReaders, but files were already deleted by
> IndexWriter.
>
> But something puzzles me:
>
> Let's say we have a deleted file handle number of 85. If I switch the
> NearRealTime Searcher to the readOnlySearcher the file handle number is
> still 85. If i close afterwards the no more used indexwriter, the number
> drops to 35. =A0I think that means, that the indexwriter referenced delet=
ed
> files that are not referenced by the readers. =A0It seems, that with ever=
y
> commit the number of deleted file handles (which maybe are "caused" by th=
e
> indexwriter) grows.
> Is that possible and if yes why does the indexwriter do it? Is there a ma=
x
> Value of deleted handles an IndexWriter could own, because I don't want t=
o
> chrash the system because of too much open filehandles?
>
> Thanks in advance.
> Thomas
> --
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47805-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 13 05:09:40 2010
Return-Path: <java-user-return-47805-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36669 invoked from network); 13 Nov 2010 05:09:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Nov 2010 05:09:39 -0000
Received: (qmail 90288 invoked by uid 500); 13 Nov 2010 05:10:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90040 invoked by uid 500); 13 Nov 2010 05:10:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90029 invoked by uid 99); 13 Nov 2010 05:10:06 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 13 Nov 2010 05:10:06 +0000
X-ASF-Spam-Status: No, hits=1.3 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of serera@gmail.com designates 74.125.83.176 as permitted sender)
Received: from [74.125.83.176] (HELO mail-pv0-f176.google.com) (74.125.83.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 13 Nov 2010 05:10:00 +0000
Received: by pva18 with SMTP id 18so606447pva.35
        for <java-user@lucene.apache.org>; Fri, 12 Nov 2010 21:09:40 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=uryIR9Lpbh/hb51RD2IYo6B5bK3nJ3/kSG2s14J19tg=;
        b=Drs+9iljJMGGiUysmu913CI8zJoDvaCr4TxSz8NqDlCAIUbOPuZRUnDMocybh3D1Iy
         nSgHTAcrmjiceOSvi9KIUEEHyo6mhZtjqRO8U5xyAGk95boKDUuCEQDDIkFJ+/63WSUA
         LZJY+o2BZmtjHqoVFAtkOJgQ3HoqMLIFmkV/U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ALRxR/kyE+PRlmovED5HrpaPbPxvi3l/aiieTp6wKcNJhQtahuOMIw3gczzgU1hgOq
         Zm1tPTLkhu/oEQhfPqqQBxtVEsRatZVXjQ2on+1mqIhf8W7H2ZqilO+SlY8lytQ53acy
         u2uCRzT0C/SJJp8jTAppFNaEzafYsrjpnSYWs=
MIME-Version: 1.0
Received: by 10.142.215.11 with SMTP id n11mr2551154wfg.224.1289624978282;
 Fri, 12 Nov 2010 21:09:38 -0800 (PST)
Received: by 10.142.229.21 with HTTP; Fri, 12 Nov 2010 21:09:38 -0800 (PST)
In-Reply-To: <1289586426676-1890595.post@n3.nabble.com>
References: <1289575085649-1889378.post@n3.nabble.com>
	<AANLkTimii717u4aEiyWtVH4JBBzpMe+4vWn5-aEtNq+W@mail.gmail.com>
	<1289580997422-1890077.post@n3.nabble.com>
	<AANLkTikAonkaNvNQqfnF1qNFOakJ-8C9=aHNuY3Lv69r@mail.gmail.com>
	<1289586426676-1890595.post@n3.nabble.com>
Date: Sat, 13 Nov 2010 07:09:38 +0200
Message-ID: <AANLkTinKpf=YnSeSrN_a6TQ==37QcSaL2pj9DJtTGaVs@mail.gmail.com>
Subject: Re: performance merging indexes with addIndexesNoOptimize
From: Shai Erera <serera@gmail.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1

That's right. In 3x though you have to call addIndexes followed by
maybeMerge if you want to achieve the same effect of
addindexesNoOptimize.

Shai

On Friday, November 12, 2010, Marc Sturlese <marc.sturlese@gmail.com> wrote:
>
> Thanks, so clarifying. As far as I've understood, if I have to end up
> optimizing the index just after merging it, no matter if I use the lucene
> 3.X addIndexes or addIndexesNoOptimize as the sum of time of doing both
> things will be the same in one case or other. Am I right?
>
> --
> View this message in context: http://lucene.472066.n3.nabble.com/performance-merging-indexes-with-addIndexesNoOptimize-tp1889378p1890595.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47806-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 13 14:23:57 2010
Return-Path: <java-user-return-47806-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60047 invoked from network); 13 Nov 2010 14:23:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Nov 2010 14:23:57 -0000
Received: (qmail 43627 invoked by uid 500); 13 Nov 2010 14:24:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43488 invoked by uid 500); 13 Nov 2010 14:24:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43470 invoked by uid 99); 13 Nov 2010 14:24:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 13 Nov 2010 14:24:25 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,HTML_OBFUSCATE_05_10,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ursu.cip@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 13 Nov 2010 14:24:17 +0000
Received: by wyf19 with SMTP id 19so4430645wyf.35
        for <java-user@lucene.apache.org>; Sat, 13 Nov 2010 06:23:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=Wi6kxxtvVJfF0ZcBE1ElvGia2wNxDlfWVipBczvLEK8=;
        b=DWov4eICiJY/4N/zUDLyS25xRlOQwdgSXgpTwlwj7wsKQ8xSAPrGtu7C7v6SqZ7gKw
         RXPIOnuDiqIH/H83ula9xuztATkbamTTZJyz47cGThbGMZM/0hZKZ9z7y8LZqPPbLb+W
         w9aF5RqpxyUg/mUnJClQZzUAxgghDJw1rswQ8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=lCFcEni2zwcWkCBK/Id4/nnuU4szl8LSP67HAimJB6fN/Fba9oxJ0L5U4+GH7B5cWN
         XDmE6ndwJNyb2PDWseW2g+QQxVR4v8tldAKCN8xxmYL4W1J5JSThojq9IHk1fTlrOq3O
         V6f5EbnXp/Y1TC2Gr+iLbNCmi+7JU3Iish71Y=
MIME-Version: 1.0
Received: by 10.216.176.20 with SMTP id a20mr3252634wem.14.1289658237507; Sat,
 13 Nov 2010 06:23:57 -0800 (PST)
Received: by 10.216.245.12 with HTTP; Sat, 13 Nov 2010 06:23:57 -0800 (PST)
Date: Sat, 13 Nov 2010 16:23:57 +0200
Message-ID: <AANLkTinDdTdZFJZku3Q0GiFaJZsOV68msjOhc83HSZTM@mail.gmail.com>
Subject: Can I use Lucene for this?
From: Ciprian URSU <ursu.cip@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e657b15020d81b0494eff5a0
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e657b15020d81b0494eff5a0
Content-Type: text/plain; charset=ISO-8859-1

Hi Guys,

        I just find out about Lucene; after reading the main things on wiki
it seems to be a great tool, but I still didn't find out how can I use it
for my needs. What I want to do is a small tool which has some documents
(mainly text) inside and then when I have a new document as input, to
compare it with all those which are stored and to give me back as a
percentage of similarity. I have read this part:
http://wiki.apache.org/lucene-java/ScoresAsPercentages but it is not yet
very clear to me how to use Lucene for that. Is it possible that some of you
have a sample code for that?
        Thanks a lot, and I apologize for the fact that for many of you this
looks like a stupid post :).

Best Regards,
Ciprian.

--0016e657b15020d81b0494eff5a0--

From java-user-return-47807-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 13 15:07:35 2010
Return-Path: <java-user-return-47807-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78936 invoked from network); 13 Nov 2010 15:07:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 13 Nov 2010 15:07:34 -0000
Received: (qmail 67048 invoked by uid 500); 13 Nov 2010 15:08:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66943 invoked by uid 500); 13 Nov 2010 15:08:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66935 invoked by uid 99); 13 Nov 2010 15:08:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 13 Nov 2010 15:08:01 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of shashi.mit@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 13 Nov 2010 15:07:53 +0000
Received: by wyf19 with SMTP id 19so4460014wyf.35
        for <java-user@lucene.apache.org>; Sat, 13 Nov 2010 07:07:33 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:received
         :in-reply-to:references:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        bh=zNwpd5CxpPZOLlm+Qr2/U9mEQ80bB37K+R5PrNN5gZU=;
        b=JjSuYSdNU5JvAv/+VaXsmFvgqsJtvXMdtV5bkaT5aB0eFsJD11GQi49aoXQW/n3LPS
         F4YHLHRgMb6QMLBxf4tZWwWaDkuJGjjh4/aKK6OarjH3Pb97ICQ3okqHJZ6xGOHd2ALK
         XxJoe7EJGkwfNqiWrgjpZRQRdOP4WNg22g5LQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        b=gVxxSWqnLglY0JAIBWX5SuVv4g78cl5Y6ORlxtTzPKNwHx+p2+O34gmd4ehB9t27Jr
         PepOhDukaRrMrP3nEhoGc35owKtm5zPLg/zJ0rde/8gkUlUug55BvX2NZ0LjsN4TdJ6s
         yTkzbRJ7PjkiGqFS6xokbbERz6oMIFKYiKc8E=
Received: by 10.216.188.71 with SMTP id z49mr3110812wem.82.1289660852359; Sat,
 13 Nov 2010 07:07:32 -0800 (PST)
MIME-Version: 1.0
Sender: shashi.mit@gmail.com
Received: by 10.216.6.145 with HTTP; Sat, 13 Nov 2010 07:07:01 -0800 (PST)
In-Reply-To: <AANLkTinDdTdZFJZku3Q0GiFaJZsOV68msjOhc83HSZTM@mail.gmail.com>
References: <AANLkTinDdTdZFJZku3Q0GiFaJZsOV68msjOhc83HSZTM@mail.gmail.com>
From: Shashi Kant <skant@sloan.mit.edu>
Date: Sat, 13 Nov 2010 10:07:01 -0500
X-Google-Sender-Auth: NnP0P6065-nay2JRb1NihusuDx4
Message-ID: <AANLkTimBBVU2Sj-BNw+4PkicsO3uwJebiAJpO4ZQqw4Y@mail.gmail.com>
Subject: Re: Can I use Lucene for this?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016367fb4b7fc57690494f09065
X-Virus-Checked: Checked by ClamAV on apache.org

--0016367fb4b7fc57690494f09065
Content-Type: text/plain; charset=ISO-8859-1

There are multiple measures of similarity for documents: Cosine similarity
is a frequently used one.


On Sat, Nov 13, 2010 at 9:23 AM, Ciprian URSU <ursu.cip@gmail.com> wrote:

> Hi Guys,
>
>        I just find out about Lucene; after reading the main things on wiki
> it seems to be a great tool, but I still didn't find out how can I use it
> for my needs. What I want to do is a small tool which has some documents
> (mainly text) inside and then when I have a new document as input, to
> compare it with all those which are stored and to give me back as a
> percentage of similarity. I have read this part:
> http://wiki.apache.org/lucene-java/ScoresAsPercentages but it is not yet
> very clear to me how to use Lucene for that. Is it possible that some of
> you
> have a sample code for that?
>        Thanks a lot, and I apologize for the fact that for many of you this
> looks like a stupid post :).
>
> Best Regards,
> Ciprian.
>

--0016367fb4b7fc57690494f09065--

From java-user-return-47808-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 14 01:16:18 2010
Return-Path: <java-user-return-47808-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37574 invoked from network); 14 Nov 2010 01:16:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 14 Nov 2010 01:16:17 -0000
Received: (qmail 18453 invoked by uid 500); 14 Nov 2010 01:16:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18410 invoked by uid 500); 14 Nov 2010 01:16:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18402 invoked by uid 99); 14 Nov 2010 01:16:45 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 14 Nov 2010 01:16:45 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of goksron@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 14 Nov 2010 01:16:38 +0000
Received: by wyf19 with SMTP id 19so4799198wyf.35
        for <java-user@lucene.apache.org>; Sat, 13 Nov 2010 17:16:17 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=W4FielZayD5aeg440v873/DJ52hN6jzzKw5NotRtdPE=;
        b=hGQEwYAfQCdRv9QOhM0MBkvQ8AA/6v3Dbi2Uk+uIPn3X5D+9Cw7sqyEs3vifZ9Ba8u
         rlCBMfzM3VuE3u3Wo8h7C9ZiO0Y6GeCJctaiSaZVgDrCb9eFouiWKLl6iY9lxWhKI31F
         NkV1eXx5AmSO/XT7RwXmjAjOgXZLCrEbAcFDc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=tKZOcKY9MF1n72eVFSnQ4xrILR5HVVnTnmzrNcpCvvA0pICrtzvq+Z6v9fFslID1rh
         yMEJydXee8GWCEc55eX1BPbEGUhM60LWNOr2bl93j6lVy4c2rjBHca5XvEMREThmICqr
         0zoHkJpFIJgX7JOLySpfqzv0JnEinhsHuIhVA=
MIME-Version: 1.0
Received: by 10.216.73.8 with SMTP id u8mr3480804wed.103.1289697377106; Sat,
 13 Nov 2010 17:16:17 -0800 (PST)
Received: by 10.216.52.73 with HTTP; Sat, 13 Nov 2010 17:16:17 -0800 (PST)
In-Reply-To: <AANLkTimBBVU2Sj-BNw+4PkicsO3uwJebiAJpO4ZQqw4Y@mail.gmail.com>
References: <AANLkTinDdTdZFJZku3Q0GiFaJZsOV68msjOhc83HSZTM@mail.gmail.com>
	<AANLkTimBBVU2Sj-BNw+4PkicsO3uwJebiAJpO4ZQqw4Y@mail.gmail.com>
Date: Sat, 13 Nov 2010 17:16:17 -0800
Message-ID: <AANLkTikj2G1fEqKajseeQ4aTaO0meVLxj+Qd1PwTfNqj@mail.gmail.com>
Subject: Re: Can I use Lucene for this?
From: Lance Norskog <goksron@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

The Lucene MoreLikeThis tool in lucene/contrib/similar will do one
variant of what you want.

You can do this particular test in Solr- you'll find it much much
easier to put together.
For other text similarities, you'll have to code them directly.

Lance

On Sat, Nov 13, 2010 at 7:07 AM, Shashi Kant <skant@sloan.mit.edu> wrote:
> There are multiple measures of similarity for documents: Cosine similarit=
y
> is a frequently used one.
>
>
> On Sat, Nov 13, 2010 at 9:23 AM, Ciprian URSU <ursu.cip@gmail.com> wrote:
>
>> Hi Guys,
>>
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0I just find out about Lucene; after reading t=
he main things on wiki
>> it seems to be a great tool, but I still didn't find out how can I use i=
t
>> for my needs. What I want to do is a small tool which has some documents
>> (mainly text) inside and then when I have a new document as input, to
>> compare it with all those which are stored and to give me back as a
>> percentage of similarity. I have read this part:
>> http://wiki.apache.org/lucene-java/ScoresAsPercentages but it is not yet
>> very clear to me how to use Lucene for that. Is it possible that some of
>> you
>> have a sample code for that?
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0Thanks a lot, and I apologize for the fact th=
at for many of you this
>> looks like a stupid post :).
>>
>> Best Regards,
>> Ciprian.
>>
>



--=20
Lance Norskog
goksron@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47809-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 16:40:47 2010
Return-Path: <java-user-return-47809-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22247 invoked from network); 15 Nov 2010 16:40:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 16:40:46 -0000
Received: (qmail 28276 invoked by uid 500); 15 Nov 2010 16:41:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27772 invoked by uid 500); 15 Nov 2010 16:41:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27742 invoked by uid 99); 15 Nov 2010 16:41:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 16:41:09 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erik.hatcher@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 16:41:02 +0000
Received: by vws19 with SMTP id 19so883873vws.35
        for <multiple recipients>; Mon, 15 Nov 2010 08:40:41 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:content-type
         :content-transfer-encoding:date:subject:to:message-id:mime-version
         :x-mailer;
        bh=UuRs2LGu8kzVUd/nkXhi2UAB0tsRn2X2tZ9zYFNhNsY=;
        b=UetM0GwZ7rUfSf5iUmQ0yChN2X/ER9JNLJAYi4VuF5k4UasLBXtSASfLVjXVUFFEgl
         bJIn8+k84NVdl6+yHlP2nyQjC5G3IcTrgtxtVnXSFDvi5pBBb105gnVFrRReU/G0n1vg
         mFn5RUmF7D45YlmqqZW79OZu5tJrjnblln8lU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:content-type:content-transfer-encoding:date:subject:to
         :message-id:mime-version:x-mailer;
        b=cYzSpIqOlpGEQRKIZ+mnLkiXcXBbpqsevPYTJ8zJglbjyUgNtYk8DVyUriGlIywzcO
         8RdRR1bRQPL4K+yMs+y51hR8xIUpLPejVUh0c51KqU0tREylbYiEF1VmUL4gg+ihwZJc
         yNioIa6nd98GQsCMU+5d08e/xkp0B52i9CDYI=
Received: by 10.220.194.193 with SMTP id dz1mr1433212vcb.264.1289839240379;
        Mon, 15 Nov 2010 08:40:40 -0800 (PST)
Received: from [192.168.1.111] (216-12-64-43.access.ntelos.net [216.12.64.43])
        by mx.google.com with ESMTPS id q3sm53632vcr.3.2010.11.15.08.40.37
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 15 Nov 2010 08:40:38 -0800 (PST)
From: Erik Hatcher <erik.hatcher@gmail.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Mon, 15 Nov 2010 11:40:34 -0500
Subject: NoVA/DC - Lucene/Solr Meetup - Wednesday, Nov. 17
To: solr-user@lucene.apache.org,
 java-user@lucene.apache.org,
 general@lucene.apache.org
Message-Id: <32347689-50B3-44C8-A3A6-151D11F5633D@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1081)
X-Mailer: Apple Mail (2.1081)

We still have some open spots for the meetup we're hosting this =
Wednesday night in DC.  Come on out, it'll be a great time.

	Erik

=
<http://www.lucidimagination.com/blog/2010/11/01/nova-dc-apache-lucenesolr=
-meetup-630-pm-et-17-november/>




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47810-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 18:14:45 2010
Return-Path: <java-user-return-47810-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81333 invoked from network); 15 Nov 2010 18:14:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 18:14:45 -0000
Received: (qmail 78933 invoked by uid 500); 15 Nov 2010 18:15:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78719 invoked by uid 500); 15 Nov 2010 18:15:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78711 invoked by uid 99); 15 Nov 2010 18:15:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 18:15:12 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.215.176] (HELO mail-ey0-f176.google.com) (209.85.215.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 18:15:04 +0000
Received: by eyz10 with SMTP id 10so3053681eyz.35
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 10:14:44 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.175.196 with SMTP id z46mr6711793wel.9.1289844883840; Mon,
 15 Nov 2010 10:14:43 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Mon, 15 Nov 2010 10:14:43 -0800 (PST)
In-Reply-To: <AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
References: <4CDD1BCA.5000700@mufin.com>
	<AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
Date: Mon, 15 Nov 2010 13:14:43 -0500
Message-ID: <AANLkTik7JfVBubbp+wc-xYd-n4C1i5NBM=9kYGhHqF2H@mail.gmail.com>
Subject: Re: Deleted File Handles - Index Writer
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

OK I opened https://issues.apache.org/jira/browse/LUCENE-2762 for this issu=
e.

Mike

On Fri, Nov 12, 2010 at 5:21 PM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> Are you using compound file format (the default)?
>
> If you turn that off (just for this test) do you still see that
> IndexWriter is holding open the files (35 in your example) after you
> close all readers?
>
> I've found a case, only with compound file, where IndexWriter holds
> open a SegmentReader on the pre-compound-file files... I'm working on
> a test case & fix.
>
> Mike
>
> On Fri, Nov 12, 2010 at 5:49 AM, Thomas Rewig <trewig@mufin.com> wrote:
>> =A0Hello,
>>
>> I use the searcherManager for LiveIndexing. With =A0watch -n 60 "lsof | =
grep
>> indexname | grep deleted | wc -l" I see the number of deleted file handl=
es.
>> The number of handles fluctuates during the indexing. =A00 -> 35 -> 53 -=
> 135
>> -> 40 -> 85 ... Uwe said that this is expected because segments are stil=
l
>> referenced by the open IndexReaders, but files were already deleted by
>> IndexWriter.
>>
>> But something puzzles me:
>>
>> Let's say we have a deleted file handle number of 85. If I switch the
>> NearRealTime Searcher to the readOnlySearcher the file handle number is
>> still 85. If i close afterwards the no more used indexwriter, the number
>> drops to 35. =A0I think that means, that the indexwriter referenced dele=
ted
>> files that are not referenced by the readers. =A0It seems, that with eve=
ry
>> commit the number of deleted file handles (which maybe are "caused" by t=
he
>> indexwriter) grows.
>> Is that possible and if yes why does the indexwriter do it? Is there a m=
ax
>> Value of deleted handles an IndexWriter could own, because I don't want =
to
>> chrash the system because of too much open filehandles?
>>
>> Thanks in advance.
>> Thomas
>> --
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47811-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 19:21:17 2010
Return-Path: <java-user-return-47811-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22153 invoked from network); 15 Nov 2010 19:21:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 19:21:16 -0000
Received: (qmail 78029 invoked by uid 500); 15 Nov 2010 19:21:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77982 invoked by uid 500); 15 Nov 2010 19:21:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77973 invoked by uid 99); 15 Nov 2010 19:21:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 19:21:46 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of celsowm@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 19:21:40 +0000
Received: by gwb15 with SMTP id 15so99744gwb.35
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 11:21:19 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=AxiiUJRqeIzQQ/SKKc0tXPsyvvVsAd7Y/0ZT1Vh+T7I=;
        b=rLPzIDrKxYQx39OC+pQjeseuaaf1XDhe1UMRs/rSpxy6FDkWKbHf8mN8GMBZiDqM7y
         JIdD3A0hIWtTGf7V69u9pD29nwE2mHlENiU4t0LkFpwIy+wk3cgi8JchhApceKAkoIWJ
         JzHfjav1q+JsnPLb+YuzC9ww5zqluHG5akFzI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=bNwrmD16LfY650m+CK72qWD2oDhDc/uPA65NFv/dUzxMBwX3x5jmwig5d5MysL/F/X
         4KNDMskxpQJbKDUsjx63RHxX6NGINLMu1wvqwgbifaMBwgp8Px1NA1h+8/M9nifC5SbC
         6RwCteKODqCJ9AHGBdS4PK48VI/VS3xvAEZ3A=
Received: by 10.150.195.6 with SMTP id s6mr10030733ybf.261.1289848879025; Mon,
 15 Nov 2010 11:21:19 -0800 (PST)
MIME-Version: 1.0
Received: by 10.236.109.137 with HTTP; Mon, 15 Nov 2010 11:20:58 -0800 (PST)
From: Celso Fontes <celsowm@gmail.com>
Date: Mon, 15 Nov 2010 17:20:58 -0200
Message-ID: <AANLkTi=BmyJXYGN=Yn1D7MqUqkrguNMKnO2yzod1-XB2@mail.gmail.com>
Subject: What is the best Analyzer and Parser for this type of question?
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

I am using this code, with SnowBall and TopDocScore
the code: http://pastebin.com/3X3gbpXE

Example of Question:
- What is the role of PrnP in mad cow disease?

I am running in 11.638 documents and the result is 10410 docs for this
question (lowwwwww precision)
How optimize this?

Thanks,
Celso.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47812-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 21:46:48 2010
Return-Path: <java-user-return-47812-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92440 invoked from network); 15 Nov 2010 21:46:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 21:46:47 -0000
Received: (qmail 1352 invoked by uid 500); 15 Nov 2010 21:47:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1248 invoked by uid 500); 15 Nov 2010 21:47:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1240 invoked by uid 99); 15 Nov 2010 21:47:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 21:47:16 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of johannes.goll@gmail.com designates 209.85.210.48 as permitted sender)
Received: from [209.85.210.48] (HELO mail-pz0-f48.google.com) (209.85.210.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 21:47:10 +0000
Received: by pzk35 with SMTP id 35so1365109pzk.35
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 13:46:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=9Jul4N9Q7BC3YJh7h1nUWfuCZfQFodg7FvF/C64ns+o=;
        b=gpFKKeSwdkaCp4v5S8x71DA95uOvhOkgz30sK2biFR99CzDomROEQa/wGXZuJqFDPz
         duTtBFQTnR3rJGIlIE3paJqYAXWKbQErVLDaFoda1wup39p80gtezD0v59GBdEUK4Gq6
         uAC/r9AIaR+bFvGd4gw7y+85x1Xy+ci2bAGzo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=Mim7BXtlzdLuaRp4/XTaTsp/UoX8pCd3/KNvZGj9hO7I8WrUrwYnsg2tbkn51RTtEN
         cK/k4bbbO4ojBISL7nupO7CGHbe8Gj6gAVBMzF4N/BiWepPMqWXCZhGaT1V6YNhphIEU
         kVsRXNMYwDaS1zPoVmKI+ze7EUG4y6S0SD9DM=
MIME-Version: 1.0
Received: by 10.142.255.8 with SMTP id c8mr1793960wfi.331.1289857610102; Mon,
 15 Nov 2010 13:46:50 -0800 (PST)
Received: by 10.142.80.7 with HTTP; Mon, 15 Nov 2010 13:46:50 -0800 (PST)
Date: Mon, 15 Nov 2010 16:46:50 -0500
Message-ID: <AANLkTikJ5+L8o=LtP-9ngA04jQY-6u80Vmwy8ZSQJ0Vq@mail.gmail.com>
Subject: Solr 1.4.1 stats component count not matching facet count for multi
 valued field
From: Johannes Goll <johannes.goll@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636e1f9c2a938b704951e6009

--001636e1f9c2a938b704951e6009
Content-Type: text/plain; charset=ISO-8859-1

Hi,

I have a facet field called option which may be multi-valued and
a weight field which is single-valued.

When I use the Solr 1.4.1 stats component with a facet field, i.e.

q=*:*&version=2.2&stats=true&stats.field=weight&stats.facet=option

I get conflicting results for the stats count result
<long name="count">1</long>

when compared with the faceting counts obtained by

q=*:*&version=2.2&facet=true&facet.field=option

I would expect the same count for either method.

This happens if multiple values are stored in the options field.

It seem that for a multiple values only the last entered value is being
considered in the stats component? What am I doing wrong here?

Thanks,
Johannes

--001636e1f9c2a938b704951e6009--

From java-user-return-47813-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 22:20:03 2010
Return-Path: <java-user-return-47813-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10850 invoked from network); 15 Nov 2010 22:20:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 22:20:02 -0000
Received: (qmail 36578 invoked by uid 500); 15 Nov 2010 22:20:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36536 invoked by uid 500); 15 Nov 2010 22:20:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36528 invoked by uid 99); 15 Nov 2010 22:20:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 22:20:32 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 22:20:24 +0000
Received: by qyk1 with SMTP id 1so279633qyk.14
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 14:20:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=usJQeiyiq4EZijSRtetWJVWq0Qi2sh+sKD0PyAY1TBE=;
        b=Y5GgYjIt21wND39JO0kbjRV+0vfaY3ZCaaNkhmqws1qBvs3O2ztOoqSMq+MDnUonl7
         w5K8lRpsXEk+gWNxOco65lSN39hpnIEBpXLN/bbNB6icZES8HJnCjJv3MWBfp9JzSvzP
         ZTSDIFzsEh1jfsrI43k8sl7LNBs8eUhHsXfXw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Pt+0fTZC2nba0DwOvMdmwN11SWvKKaSiJ2YCMIF1qyOUU+15M7J+G/BVAp7ghGbT3g
         Ck1W8FfJeMFJDBnKPeoarAYS5ElhY6UahELLf5nmaMtYGmWS8/UZonhxj12KXxQ/IHs8
         LDrXCMTBOLEED1T3CJpIcd0a72WNrchajFS9g=
MIME-Version: 1.0
Received: by 10.229.212.12 with SMTP id gq12mr5544151qcb.154.1289859603180;
 Mon, 15 Nov 2010 14:20:03 -0800 (PST)
Received: by 10.229.216.19 with HTTP; Mon, 15 Nov 2010 14:20:03 -0800 (PST)
In-Reply-To: <AANLkTi=BmyJXYGN=Yn1D7MqUqkrguNMKnO2yzod1-XB2@mail.gmail.com>
References: <AANLkTi=BmyJXYGN=Yn1D7MqUqkrguNMKnO2yzod1-XB2@mail.gmail.com>
Date: Mon, 15 Nov 2010 17:20:03 -0500
Message-ID: <AANLkTin2_E=ZqJq-yGUynNbUz66KNfvEmBoT6CH8UYZu@mail.gmail.com>
Subject: Re: What is the best Analyzer and Parser for this type of question?
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b82c0752c4a04951ed771
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b82c0752c4a04951ed771
Content-Type: text/plain; charset=ISO-8859-1

First question:  What's the default operator? Out of
the box, its OR. See QueryParser.setDefaultOperator...

Second, how are you forming your query? Just running
it at the query parser? Query.toString() may be your friend.

Best
Erick

On Mon, Nov 15, 2010 at 2:20 PM, Celso Fontes <celsowm@gmail.com> wrote:

> I am using this code, with SnowBall and TopDocScore
> the code: http://pastebin.com/3X3gbpXE
>
> Example of Question:
> - What is the role of PrnP in mad cow disease?
>
> I am running in 11.638 documents and the result is 10410 docs for this
> question (lowwwwww precision)
> How optimize this?
>
> Thanks,
> Celso.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016363b82c0752c4a04951ed771--

From java-user-return-47814-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 23:01:53 2010
Return-Path: <java-user-return-47814-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28296 invoked from network); 15 Nov 2010 23:01:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 23:01:53 -0000
Received: (qmail 87914 invoked by uid 500); 15 Nov 2010 23:02:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87865 invoked by uid 500); 15 Nov 2010 23:02:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87856 invoked by uid 99); 15 Nov 2010 23:02:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 23:02:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of celsowm@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 23:02:10 +0000
Received: by wyf19 with SMTP id 19so13229wyf.35
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 15:01:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=UbYujR2BkTTa8XjEZAGdLofNmLNmC1VvWDPo51wFlCg=;
        b=tr5BbddvFoLD3pDvpnNUm8uzO+U6nlZMLgAvv0kjjye6rqH+XzLj13BOlaRzsMDjqE
         S59lCSgQKDXwY70pSZ9QtBIyGrQHlzzKfGr6Oly562V2F9KWLYAvwBibSivHZE+iISxY
         7p9k1boQ4BILkRm2h/VukIjFDOxUIMtlL1+2I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=slRGwxlpxzctwxa5oOx/dOkvs9Qlt44m587C0sfUlqfhLhwFqg9HtO8tmMlrYEyivh
         uxZPx/C/hF3WcayERXq0RLSvP3Fq1Shle4QT4/a66Vmc0E/m50nJoVVFQQBO8NTHR8Fh
         d8d66xg7cUPkj1cF84V7TlMdqKS9ROGiz57EE=
Received: by 10.216.25.9 with SMTP id y9mr7149631wey.83.1289862109544; Mon, 15
 Nov 2010 15:01:49 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.221.28 with HTTP; Mon, 15 Nov 2010 15:01:29 -0800 (PST)
In-Reply-To: <AANLkTin2_E=ZqJq-yGUynNbUz66KNfvEmBoT6CH8UYZu@mail.gmail.com>
References: <AANLkTi=BmyJXYGN=Yn1D7MqUqkrguNMKnO2yzod1-XB2@mail.gmail.com> <AANLkTin2_E=ZqJq-yGUynNbUz66KNfvEmBoT6CH8UYZu@mail.gmail.com>
From: Celso Fontes <celsowm@gmail.com>
Date: Mon, 15 Nov 2010 21:01:29 -0200
Message-ID: <AANLkTikyMzvkfm52N32+t=eqnz=mVsp2t9RqXFuXAOAa@mail.gmail.com>
Subject: Re: What is the best Analyzer and Parser for this type of question?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d9a15bd9408104951f6cd6
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d9a15bd9408104951f6cd6
Content-Type: text/plain; charset=ISO-8859-1

Hi Erick,

My queries going from a list of Genomic TREC 2006...

What the operator you recommend to me?

Thanks,
Celso


2010/11/15 Erick Erickson <erickerickson@gmail.com>

> First question:  What's the default operator? Out of
> the box, its OR. See QueryParser.setDefaultOperator...
>
> Second, how are you forming your query? Just running
> it at the query parser? Query.toString() may be your friend.
>
> Best
> Erick
>
> On Mon, Nov 15, 2010 at 2:20 PM, Celso Fontes <celsowm@gmail.com> wrote:
>
> > I am using this code, with SnowBall and TopDocScore
> > the code: http://pastebin.com/3X3gbpXE
> >
> > Example of Question:
> > - What is the role of PrnP in mad cow disease?
> >
> > I am running in 11.638 documents and the result is 10410 docs for this
> > question (lowwwwww precision)
> > How optimize this?
> >
> > Thanks,
> > Celso.
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>

--0016e6d9a15bd9408104951f6cd6--

From java-user-return-47815-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 15 23:32:23 2010
Return-Path: <java-user-return-47815-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44220 invoked from network); 15 Nov 2010 23:32:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 15 Nov 2010 23:32:22 -0000
Received: (qmail 4496 invoked by uid 500); 15 Nov 2010 23:32:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4440 invoked by uid 500); 15 Nov 2010 23:32:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4432 invoked by uid 99); 15 Nov 2010 23:32:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 15 Nov 2010 23:32:52 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.49.16] (HELO web52906.mail.re2.yahoo.com) (206.190.49.16)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 15 Nov 2010 23:32:44 +0000
Received: (qmail 42665 invoked by uid 60001); 15 Nov 2010 23:32:22 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1289863942; bh=MG3/jXr1Zv07gSB6+hC8ehSOpk1NcbjeNDrtj0/0g80=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=pK171w6Y7Qh0esRWjjMIYQt4Jn7+kZAFaNtipBl7uINRJ7xF/+hX/upzukeqzE1BFGsNA4SvHydZRTQDNFv6T+Wi8DeOjdLOW6Bda8jxD4AovH9GRB+0CCn5GYJXLVJWo62EaZqZX3QgkVSWbeJoSJqdP52OcBAKTl94UJNFPJU=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=U7l/bSjO1hzJXmnVl11VrGdLmKwDNbE7737kXUFK4Mr/pXHBbDR3Wy1jb0mo7OXs+Cp1s2iysaFcOwlhMFzA08fCvYJY8pgh8VbeXiY9GHvPmt7muwDakamGuDtqzM5eCU/f8OgmXth62zSDt3Lac1y1w0DJlP41LEXGzXQxYG0=;
Message-ID: <841536.42106.qm@web52906.mail.re2.yahoo.com>
X-YMail-OSG: w2RfVxkVM1l..hHJ7ZockQ2ojNo6mIlb5_2ztYddqP4FNLy
 iVRpDABatWNcY.UdZcQspXGNwvPuLDaGDnq8kA9ur8cMy9GhI5Mb6IeeCRmu
 vQnCknMOL8vDjhzW7L8MkXs76qtqjXT8NWttPErsozpLaFXnBid6HCZzgsFx
 SVx78ZDpwZBuCJ7g2_p4iKrp_K68MoEnCb_CyTXHhlzxkJNjroGR2CxMti_N
 pwtP6qxMwc18HR1vFcPoDgGmCtVp2twxT.3DhP7G3fP0mz_aCR5mwbEUiGF4
 .8OFsA0CnB5juunREZNlv6n9oDMkZxN77a4rMh4pPs22imk4__pDvN9DKI_o
 c6DjMW4JHCDdQesFW5b7q979.iU7I5i1MXaid7jahTPwv
Received: from [78.164.82.12] by web52906.mail.re2.yahoo.com via HTTP; Mon, 15 Nov 2010 15:32:22 PST
X-Mailer: YahooMailClassic/11.4.9 YahooMailWebService/0.8.107.285259
Date: Mon, 15 Nov 2010 15:32:22 -0800 (PST)
From: Ahmet Arslan <iorixxx@yahoo.com>
Subject: Re: What is the best Analyzer and Parser for this type of question?
To: java-user@lucene.apache.org
In-Reply-To: <AANLkTi=BmyJXYGN=Yn1D7MqUqkrguNMKnO2yzod1-XB2@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org


> Example of Question:
> - What is the role of PrnP in mad cow disease?

First thing is do not directly query questions. Manually formulate queries:
remove 'what' 'is' 'the' 'of' '?' etc.

For example i would convert this question into:

"mad cow"^5 "cow disease"^3 "mad cow disease"^15 "role PrnP"~5^2 "role mad cow disease"~45 mad^0.1 role^0.5 cow disease PrnP^10

> I am running in 11.638 documents and the result is 10410
> docs for this question (lowwwwww precision)

Use OR default operator, collect and evaluate top 1000 documents only.

And instead of Porter you can try KStem.
http://ciir.cs.umass.edu/cgi-bin/downloads/downloads.cgi

Try different length normalization described here. Also their Lucene query example (SpanNear) can inspire you.  http://trec.nist.gov/pubs/trec16/papers/ibm-haifa.mq.final.pdf


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47816-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 05:56:22 2010
Return-Path: <java-user-return-47816-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68788 invoked from network); 16 Nov 2010 05:56:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 05:56:21 -0000
Received: (qmail 99112 invoked by uid 500); 16 Nov 2010 05:56:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98918 invoked by uid 500); 16 Nov 2010 05:56:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98909 invoked by uid 99); 16 Nov 2010 05:56:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 05:56:49 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of goksron@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 05:56:42 +0000
Received: by qyk29 with SMTP id 29so347510qyk.14
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 21:56:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding:x-antivirus
         :x-antivirus-status;
        bh=PtkQB9jaoKENwxQ6Jxxw2z+rcS9l0HXFfKhCBkavUXM=;
        b=BB9MlltMzp1CWa07LW/DkrfEcvErm01dPcvTefBjo3Qca9+itF+CQdHhZ8hZuUlLH5
         4d+ixllb04uT4jtqKEm0pCytjqvU3LFHdMz63EEW9D85pRmfw2RdtzFCJCQbOKLswYc0
         LGfW1PprYHr6RixlZVojhgxdQh4xYtHuAz624=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding:x-antivirus
         :x-antivirus-status;
        b=V8iyV7yy3DGJ9N1ARdQAOt2OD82GjCn2D7VPOpTsSwPbrlrd+4uHfvqU+MKvd/QqdJ
         siIgwi9GundaKwkMCEuvqqRfgWBe/hUAmccrc7dE1JsJgZJKxMsTaR7NVejTOWItkCkm
         KFDoE1vdfS+KdZJKNUoxjAXpNOy2YGpMqy7Ok=
Received: by 10.229.220.78 with SMTP id hx14mr5910928qcb.148.1289886980974;
        Mon, 15 Nov 2010 21:56:20 -0800 (PST)
Received: from [127.0.0.1] ([207.179.4.183])
        by mx.google.com with ESMTPS id nb14sm547109qcb.24.2010.11.15.21.56.19
        (version=SSLv3 cipher=RC4-MD5);
        Mon, 15 Nov 2010 21:56:20 -0800 (PST)
Message-ID: <4CE21D07.4030009@gmail.com>
Date: Mon, 15 Nov 2010 21:56:23 -0800
From: Lance Norskog <goksron@gmail.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.14) Gecko/20100930 SeaMonkey/2.0.9
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: What is the best Analyzer and Parser for this type of question?
References: <841536.42106.qm@web52906.mail.re2.yahoo.com>
In-Reply-To: <841536.42106.qm@web52906.mail.re2.yahoo.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Antivirus: avast! (VPS 101115-1, 11/15/2010), Outbound message
X-Antivirus-Status: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

First, to understand what your query looks like, go to 
admin/analysis.jsp. It lets you see what happens to your queries when 
they go in. Then, do the query with debugQuery=true. This will add some 
complex junk to the end of the XML page that describes in painful detail 
exactly how each document was scored.

After all that- you might have a problem with the PrnP etc. stuff 
getting chopped up in weird ways. I don't know how people handle this in 
chemistry/bio search.

Lance

Ahmet Arslan wrote:
>    
>> Example of Question:
>> - What is the role of PrnP in mad cow disease?
>>      
> First thing is do not directly query questions. Manually formulate queries:
> remove 'what' 'is' 'the' 'of' '?' etc.
>
> For example i would convert this question into:
>
> "mad cow"^5 "cow disease"^3 "mad cow disease"^15 "role PrnP"~5^2 "role mad cow disease"~45 mad^0.1 role^0.5 cow disease PrnP^10
>
>    
>> I am running in 11.638 documents and the result is 10410
>> docs for this question (lowwwwww precision)
>>      
> Use OR default operator, collect and evaluate top 1000 documents only.
>
> And instead of Porter you can try KStem.
> http://ciir.cs.umass.edu/cgi-bin/downloads/downloads.cgi
>
> Try different length normalization described here. Also their Lucene query example (SpanNear) can inspire you.  http://trec.nist.gov/pubs/trec16/papers/ibm-haifa.mq.final.pdf
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47817-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 06:06:01 2010
Return-Path: <java-user-return-47817-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79483 invoked from network); 16 Nov 2010 06:06:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 06:06:01 -0000
Received: (qmail 11091 invoked by uid 500); 16 Nov 2010 06:06:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10958 invoked by uid 500); 16 Nov 2010 06:06:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10950 invoked by uid 99); 16 Nov 2010 06:06:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 06:06:28 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.161.176] (HELO mail-gx0-f176.google.com) (209.85.161.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 06:06:21 +0000
Received: by gxk4 with SMTP id 4so159706gxk.35
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 22:06:00 -0800 (PST)
MIME-Version: 1.0
Received: by 10.150.52.4 with SMTP id z4mr11008526ybz.37.1289887560103; Mon,
 15 Nov 2010 22:06:00 -0800 (PST)
Received: by 10.150.200.5 with HTTP; Mon, 15 Nov 2010 22:06:00 -0800 (PST)
Date: Tue, 16 Nov 2010 13:06:00 +0700
Message-ID: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
Subject: asking about index verification tools
From: Yakob <jacobian@opensuse-id.org>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

hello all,
I would like to ask about lucene index. I mean I created a simple
program that created lucene indexes and stored it in a folder. also I
had use a diagnostic tools name Luke to be able to lurk inside lucene
index and find out its content. and I know that lucene is a standard
framework when it come to building a search engine. but I just wanted
to be sure that lucene indexes every term that existed in a file.

I mean is there a way for me or some tools out there to verify that
the index contains in lucene indexes is dependable? and not a single
term went missing there?

I know that this is subjective question but I just wanted to hear your
two cents.
thanks though. :-)

tl;dr: how can we know that the index in lucene is correct?

-- 
http://jacobian.web.id

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47818-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 06:23:04 2010
Return-Path: <java-user-return-47818-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83753 invoked from network); 16 Nov 2010 06:23:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 06:23:03 -0000
Received: (qmail 19359 invoked by uid 500); 16 Nov 2010 06:23:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19185 invoked by uid 500); 16 Nov 2010 06:23:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19171 invoked by uid 99); 16 Nov 2010 06:23:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 06:23:32 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 06:23:27 +0000
Received: by wyf19 with SMTP id 19so363644wyf.35
        for <java-user@lucene.apache.org>; Mon, 15 Nov 2010 22:23:06 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=pZ2GNRywztxG83GkJiqiLPrgvrx32g4qHOZFGTz2PpM=;
        b=Aot8Ri1Fm9X7/aXlOAt9AZ8Ebo1QGwo/+gYOotM6T1CGaa9HhSyADq39AESUxHYXGv
         JZzPV0PDhwf63ElV6gx9BaFOPbkYGGf22RtHd8lFKc+scUtKmiipTco5yk0bFs1l028e
         eu6uVPJsG3FOYCMT2/cP5Xm+Pyk/V2ML5Vtog=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=qaZYgQRXnRZW9oQmTLe9SucY400WafPIMv3r/RL5LtKnFTUgp5t8guJj5xa4YnStxm
         TmhSLcVGapBV7vCqEaIIhSQgDW67XREBQZEXankv4TGBgvlvFF0WEPD3YX/F9pbcZGjK
         ZEySliIa5QLzkWEPQA8LgExwgQoxgA0Qej6KY=
Received: by 10.227.143.136 with SMTP id v8mr7129188wbu.90.1289888585980; Mon,
 15 Nov 2010 22:23:05 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.69.138 with HTTP; Mon, 15 Nov 2010 22:22:45 -0800 (PST)
In-Reply-To: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
References: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Tue, 16 Nov 2010 11:52:45 +0530
Message-ID: <AANLkTi=N1CPsp_D_en7kmAzT61DjiiOELqjrA+Xh-FUZ@mail.gmail.com>
Subject: Re: asking about index verification tools
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f44cf6f7b27d0495259650

--001485f44cf6f7b27d0495259650
Content-Type: text/plain; charset=ISO-8859-1

Hi,

One way to do that would be to iterate the terms and then reconstruct the
document or just check for the terms one after the other. Though Luke also
reconstructs the document and you could use the reconstruction logic to do
the same and compare, it is not guaranteed that the reconstruction would be
proper (from the inverted index that is).
I am assuming you'd only want to verify the index on some sampled set and
not the entire corpus, else it'd just take a lot of time.
You may also take the document corpus again, tokenize the terms and then
search for each of those in the index. This would also give you a fair idea
of the index state.

--
Anshum Gupta
http://ai-cafe.blogspot.com


On Tue, Nov 16, 2010 at 11:36 AM, Yakob <jacobian@opensuse-id.org> wrote:

> hello all,
> I would like to ask about lucene index. I mean I created a simple
> program that created lucene indexes and stored it in a folder. also I
> had use a diagnostic tools name Luke to be able to lurk inside lucene
> index and find out its content. and I know that lucene is a standard
> framework when it come to building a search engine. but I just wanted
> to be sure that lucene indexes every term that existed in a file.
>
> I mean is there a way for me or some tools out there to verify that
> the index contains in lucene indexes is dependable? and not a single
> term went missing there?
>
> I know that this is subjective question but I just wanted to hear your
> two cents.
> thanks though. :-)
>
> tl;dr: how can we know that the index in lucene is correct?
>
> --
> http://jacobian.web.id
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f44cf6f7b27d0495259650--

From java-user-return-47819-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 08:10:57 2010
Return-Path: <java-user-return-47819-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36734 invoked from network); 16 Nov 2010 08:10:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 08:10:57 -0000
Received: (qmail 95650 invoked by uid 500); 16 Nov 2010 08:11:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95470 invoked by uid 500); 16 Nov 2010 08:11:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95459 invoked by uid 99); 16 Nov 2010 08:11:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 08:11:24 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of samarzone@gmail.com designates 209.85.214.176 as permitted sender)
Received: from [209.85.214.176] (HELO mail-iw0-f176.google.com) (209.85.214.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 08:11:18 +0000
Received: by iwn33 with SMTP id 33so528932iwn.35
        for <java-user@lucene.apache.org>; Tue, 16 Nov 2010 00:10:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=ewDlX9yAnUq4Lmkb4Qpw4efSOoznqeJBucQdJttoT9Q=;
        b=jfA+YT0TuhNKkpxYBH8dJAJ0n8KeXiJkQvrAfTYaoGCUuu5cD9liKehUQ8KpPIHYKR
         ChobE+xw3m+hBZM2SReoiJeC3MDvr3uhURnkdrqlHisFU/a1dhnlWp3nS+6yuMqL0wl1
         KomuVjeH9pXK8TH4HFA2UdmQ9pgD+x1u7d8AA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=VJDt38haWJQVCh0QIzYU9d29sgCuWlSvv4I5haYB2fnUDk2mLznD+coVudyDp+mBNb
         H27M6YFCw5+ngXfbGvRVis0STQjuk8T5jJZdELVK8IUwMkQuBG2FHJHG8JclfeEz1A/p
         RKF4Z9wMH7dWHO3Pa47WWZ/q2AYYX0dyqUV7Y=
Received: by 10.231.40.10 with SMTP id i10mr5237398ibe.55.1289895055533; Tue,
 16 Nov 2010 00:10:55 -0800 (PST)
MIME-Version: 1.0
Received: by 10.231.19.76 with HTTP; Tue, 16 Nov 2010 00:10:40 -0800 (PST)
In-Reply-To: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
References: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
From: Samarendra Pratap <samarzone@gmail.com>
Date: Tue, 16 Nov 2010 13:40:40 +0530
Message-ID: <AANLkTi=2e6kym7VKD8dR-PGz7sadPVRx0MgGmXMEA291@mail.gmail.com>
Subject: Re: asking about index verification tools
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000325575c5a9527410495271820
X-Virus-Checked: Checked by ClamAV on apache.org

--000325575c5a9527410495271820
Content-Type: text/plain; charset=ISO-8859-1

It is not guaranteed that every term will be indexed. There is a limit on
maximum number of terms (as in lucene 3.0 and may be earlier too) per field.
Check out this
http://lucene.apache.org/java/3_0_2/api/all/org/apache/lucene/index/IndexWriter.html#setMaxFieldLength(int)

On Tue, Nov 16, 2010 at 11:36 AM, Yakob <jacobian@opensuse-id.org> wrote:

> hello all,
> I would like to ask about lucene index. I mean I created a simple
> program that created lucene indexes and stored it in a folder. also I
> had use a diagnostic tools name Luke to be able to lurk inside lucene
> index and find out its content. and I know that lucene is a standard
> framework when it come to building a search engine. but I just wanted
> to be sure that lucene indexes every term that existed in a file.
>
> I mean is there a way for me or some tools out there to verify that
> the index contains in lucene indexes is dependable? and not a single
> term went missing there?
>
> I know that this is subjective question but I just wanted to hear your
> two cents.
> thanks though. :-)
>
> tl;dr: how can we know that the index in lucene is correct?
>
> --
> http://jacobian.web.id
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Regards,
Samar

--000325575c5a9527410495271820--

From java-user-return-47820-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 09:40:31 2010
Return-Path: <java-user-return-47820-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75181 invoked from network); 16 Nov 2010 09:40:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 09:40:30 -0000
Received: (qmail 86043 invoked by uid 500); 16 Nov 2010 09:41:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85856 invoked by uid 500); 16 Nov 2010 09:40:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85842 invoked by uid 99); 16 Nov 2010 09:40:59 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 09:40:59 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 09:40:53 +0000
Received: by bwz9 with SMTP id 9so475894bwz.35
        for <java-user@lucene.apache.org>; Tue, 16 Nov 2010 01:40:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=yD7xVnqxEZw/XHdEWyFmqzBVLkVw9NVDhOD673uFGVM=;
        b=aXxsh04fv5KUeVjgWRplrHW//3Ow97FWsgLrMH331QIfDSkC6Szv55jyuX2Y+ImuVH
         k0IXBjqSujVyfxvc3QFQo8NWCfKN0q4RphfCm4B2TfqxtGQkiVn2vkp5PaV2qj8Wsw++
         d3rYHP1WPLj9sSmuxpOjdoGXR4XHcKZ86i1Aw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=C+6mQw03WBlzEgO86Bxa6dOOC8Q30k19TOGZckkFwvr3TcnZMHs+kztsj3BOlrhK5Z
         TEwScTZUFyBussVa5gf39GR3LO8we16LRqxivO7JicePMsbrV0DVEZnDHmoq/gH0ABzV
         YDNc5aVT10Oile3xMkFv/yYHWgZAfvJBR2bd0=
Received: by 10.204.98.15 with SMTP id o15mr7136940bkn.136.1289900431082; Tue,
 16 Nov 2010 01:40:31 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Tue, 16 Nov 2010 01:40:10 -0800 (PST)
In-Reply-To: <AANLkTinV3qdx8mORr-5AbXYnQSQZV8DU0-Yc9ti13yrV@mail.gmail.com>
References: <AANLkTinV3qdx8mORr-5AbXYnQSQZV8DU0-Yc9ti13yrV@mail.gmail.com>
From: maven apache <apachemaven0@gmail.com>
Date: Tue, 16 Nov 2010 17:40:10 +0800
Message-ID: <AANLkTinhxF7j80XFS63AhF_FU=18RLFGcGiNEBkSAxwY@mail.gmail.com>
Subject: lucene query type
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f85aecfd868d04952858a7

--001485f85aecfd868d04952858a7
Content-Type: text/plain; charset=ISO-8859-1

Hi:
There are types of TermQuery,TermRangeQuery,and the BooleanQuery and etc
built in lucene,and they can be combined to make a powerful search.

However I wonder if this is useful for a user in the client side?

For example,I build a web user interface with a search textfield(like the
google) for inputting,when user enter something to the textfield,I got it
and do the searching.

Now is that mean I should do something to the string from user?

Suppose user enter "lucene document" for searching, then I can change them
to "lucene AND document" or "lucene OR document" or "+lucene-document" or
.... and something else.

But the problem is that how did I know the intention of the user?


BTW,In my opinion there is always a contradiction between the *quantity* and
*quality* of the search result.

That's to say if I want the search result as precise as possible I should
use the "Lucene AND document" instead of the user entered string,however if
there is no precise result,it seems that I should use the "lucene or
document"(just return something to user).

So I am confused how to handle these problem.

PS:
Maybe this topic is not very a lucene question,but it is search related, and
you guys are experter of searching,so I asked for help. :)

--001485f85aecfd868d04952858a7--

From java-user-return-47821-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 09:58:27 2010
Return-Path: <java-user-return-47821-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80308 invoked from network); 16 Nov 2010 09:58:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 09:58:27 -0000
Received: (qmail 11112 invoked by uid 500); 16 Nov 2010 09:58:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10847 invoked by uid 500); 16 Nov 2010 09:58:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10839 invoked by uid 99); 16 Nov 2010 09:58:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 09:58:56 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 09:58:48 +0000
Received: by bwz9 with SMTP id 9so488966bwz.35
        for <java-user@lucene.apache.org>; Tue, 16 Nov 2010 01:58:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=VrLjy9P2WoGGxfO8Gswx8yl+tY2SfNbxA15hCRc8/Yk=;
        b=p+XP/kboGIghzXFvsGB3/eByhfAbcLfM1xNnD0feOEzvA/QkeOPc12R+bpFI3SBGtX
         kM89wZk9B6CFgWIt+q9bxtjhq4ONrUbf0GQH2jAqGg7Fodsp3d7Aqxo5DLcl6G79M5PP
         /8w20c1yz3zfVzh/ldDvvDwojrovLzHJVtk1E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=K4tlVEdcrVCfeWQZjbBYXIXausWO1lWOiY4SQuYZtVaCzDAOWQJ0LtoDQsHGV0ePJp
         KmvkN2K644qTpl1Z2EuhG4hTdRbUgHgw5opW649w1zvBefTDn68HMa5OZej2Vbw5Vv+b
         XMZMpf/os1PcHTP5WdL65dNwx+7kDB0XH9v+g=
Received: by 10.204.72.80 with SMTP id l16mr7043892bkj.133.1289901507934; Tue,
 16 Nov 2010 01:58:27 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Tue, 16 Nov 2010 01:58:07 -0800 (PST)
In-Reply-To: <AANLkTinhxF7j80XFS63AhF_FU=18RLFGcGiNEBkSAxwY@mail.gmail.com>
References: <AANLkTinV3qdx8mORr-5AbXYnQSQZV8DU0-Yc9ti13yrV@mail.gmail.com> <AANLkTinhxF7j80XFS63AhF_FU=18RLFGcGiNEBkSAxwY@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 16 Nov 2010 09:58:07 +0000
Message-ID: <AANLkTinQVQb-dSXoej62E0xQ11jWCby6BZrbJdOUoT3c@mail.gmail.com>
Subject: Re: lucene query type
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Lucene will generally do the right thing without much help - docs with
more matches will score better and thus be presented first.  But you
can give it a helping hand, perhaps with some query boosting: build a
boolean query and add an AND query with a positive boost, then an OR
query with smaller or no boost.  Or do as you suggest: do an AND query
and if you get enough hits, quit, otherwise do an OR query and add
those results (deduped) to the first list.  Proximity qualifiers, or
span queries, can be helpful too, again with boost, so that docs with
"xxx lucene document yyy" can be made to score higher than "xxx lucene
aaa bbb ccc ddd some other junk document".

What is "best" is debatable, and dependent on your data and users.
Keeping everybody happy all the time is hard!


--
Ian.


On Tue, Nov 16, 2010 at 9:40 AM, maven apache <apachemaven0@gmail.com> wrote:
> Hi:
> There are types of TermQuery,TermRangeQuery,and the BooleanQuery and etc
> built in lucene,and they can be combined to make a powerful search.
>
> However I wonder if this is useful for a user in the client side?
>
> For example,I build a web user interface with a search textfield(like the
> google) for inputting,when user enter something to the textfield,I got it
> and do the searching.
>
> Now is that mean I should do something to the string from user?
>
> Suppose user enter "lucene document" for searching, then I can change them
> to "lucene AND document" or "lucene OR document" or "+lucene-document" or
> .... and something else.
>
> But the problem is that how did I know the intention of the user?
>
>
> BTW,In my opinion there is always a contradiction between the *quantity* and
> *quality* of the search result.
>
> That's to say if I want the search result as precise as possible I should
> use the "Lucene AND document" instead of the user entered string,however if
> there is no precise result,it seems that I should use the "lucene or
> document"(just return something to user).
>
> So I am confused how to handle these problem.
>
> PS:
> Maybe this topic is not very a lucene question,but it is search related, and
> you guys are experter of searching,so I asked for help. :)
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47822-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 11:35:45 2010
Return-Path: <java-user-return-47822-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30012 invoked from network); 16 Nov 2010 11:35:45 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 11:35:45 -0000
Received: (qmail 35845 invoked by uid 500); 16 Nov 2010 11:36:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35656 invoked by uid 500); 16 Nov 2010 11:36:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35648 invoked by uid 99); 16 Nov 2010 11:36:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 11:36:13 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 11:36:08 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <mail@avomberg.de>)
	id 1PIJpD-0004wi-2k
	for java-user@lucene.apache.org; Tue, 16 Nov 2010 03:35:47 -0800
Date: Tue, 16 Nov 2010 03:35:47 -0800 (PST)
From: Alex vB <mail@avomberg.de>
To: java-user@lucene.apache.org
Message-ID: <1289907347052-1910449.post@n3.nabble.com>
In-Reply-To: <AANLkTinAVUHycw664b27Zg_rkbcOVMYJTi82s303Bppn@mail.gmail.com>
References: <1289341822239-1872701.post@n3.nabble.com> <AANLkTinAVUHycw664b27Zg_rkbcOVMYJTi82s303Bppn@mail.gmail.com>
Subject: Re: Implementing indexing of Versioned Document Collections
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit


Hello Pulkit,

thank you for your answer and excuse me for my late reply. I am currently
working on the payload stuff and have implemented my own Analyzer and
Tokenfilter for adding custom payloads. As far as I understand I can add
Payload for every term occurence and write this into the posting list. My
posting list now looks like this:

car -> DocID1, [Payload 1], DocID2, [Payload2]....., DocID N, [Payload N]

Where each payload is a BitSet depending on the versions of a document. I
must admit that the index is getting really big at the moment because I am
adding around 8 to 16 bytes with each payload. I have to find a good
compression for the bitvectors. 
Further I am always getting the error
org.apache.lucene.index.CorruptIndexException: checksum mismatch in segments
file if I use my own Analyzer. After I uncomment the checksum test
everything works fine. Even Luke isn't giving me an error. Any ideas?
Another problem is the BitVector creation during tokenization. I am running
through all versions during the tokenizing step for creating my bitvectors
(stored in a HashMap). So my bitvectors are completly created after the last
field is analyzed (I added every wikipedia verison as an own field).
Therefore I need to add the payload after the tokenizing step. Is this
possible? What happens if I add payload for a current term and I add another
payload for the same term later ? Is it overwritten or appended?

Greetings
Alex
-- 
View this message in context: http://lucene.472066.n3.nabble.com/Implementing-indexing-of-Versioned-Document-Collections-tp1872701p1910449.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47823-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 16:56:51 2010
Return-Path: <java-user-return-47823-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83458 invoked from network); 16 Nov 2010 16:56:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 16:56:51 -0000
Received: (qmail 86164 invoked by uid 500); 16 Nov 2010 16:57:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85761 invoked by uid 500); 16 Nov 2010 16:57:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85752 invoked by uid 99); 16 Nov 2010 16:57:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 16:57:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of johannes.goll@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 16:57:12 +0000
Received: by ywh1 with SMTP id 1so539214ywh.35
        for <java-user@lucene.apache.org>; Tue, 16 Nov 2010 08:56:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=v/SckMUrI3uO/rie8Z2G39xxNiPvzFLnifUgWoHDHno=;
        b=UnZflYBR6EV+EvLNkyRk5J1BrTNySPtr2ttgkwr3uPYb72AgHJMPjsrCH6ApMtV+t1
         /Yj7zPwqYehtsZpeanmbmqEPpyLxE5DX7WAKhBI7cFb5t4qlHgJqm+6XvVDrk9pH5fN1
         vQ6ehq29z0u2n/rVDFEJxbjHkttY4d4Lzr940=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=n5YNlJ92PD2fpIUTIAFbnWAc3+jUtxHzc+XnbTTFpNEtDq7qdwsB2KD9oySoNP2o/E
         qP77JiBtTzOuPMQWJCQbKAS11hagqbO6ZhbOxDgWScvCW1GFMOd7SvlJz9njRPE0CEAN
         riNkpgC7WDXVA6tZ2V/gjWaMquYrS1gN2+8Zg=
MIME-Version: 1.0
Received: by 10.204.122.8 with SMTP id j8mr7675581bkr.135.1289926610549; Tue,
 16 Nov 2010 08:56:50 -0800 (PST)
Received: by 10.204.72.212 with HTTP; Tue, 16 Nov 2010 08:56:50 -0800 (PST)
Date: Tue, 16 Nov 2010 11:56:50 -0500
Message-ID: <AANLkTinrpcFk11HqwRLe2cSeFyzwUO4CaF6iJpKR-Goo@mail.gmail.com>
Subject: Jason format exception for stats component facet results | stddev
 value of NaN
From: Johannes Goll <johannes.goll@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6deea8c68824804952e71aa

--0016e6deea8c68824804952e71aa
Content-Type: text/plain; charset=ISO-8859-1

Hi,

I am getting a mal-formatted json response when using the
stats component with a facet that returns a stddev value of NaN ,e.g

                  "facet-1":{

                     "min":0.0604898,

                     "max":0.0604898,

                     "sum":1.209796,

                     "count":20,

                     "missing":0,

                     "sumOfSquares":0.0731803180808,

                     "mean":0.0604898,

                     "stddev":NaN

                  },
I have submitted my complete response to

http://jsonformatter.curiousconcept.com

and got the following exception:

Warning:Invalid quotes on string for the line with  "stddev":NaN
The Solr response broke my PHP code; replacing "NaN" with 0.0 solved the
issue.

Any thoughts on this?

Thanks a lot.
Johannes

--0016e6deea8c68824804952e71aa--

From java-user-return-47824-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 16 20:39:36 2010
Return-Path: <java-user-return-47824-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20556 invoked from network); 16 Nov 2010 20:39:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 16 Nov 2010 20:39:36 -0000
Received: (qmail 43935 invoked by uid 500); 16 Nov 2010 20:40:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 43849 invoked by uid 500); 16 Nov 2010 20:40:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 43841 invoked by uid 99); 16 Nov 2010 20:40:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 20:40:05 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=SPF_HELO_PASS,SPF_NEUTRAL,URI_HEX
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 16 Nov 2010 20:39:58 +0000
Received: from ben.nabble.com ([192.168.236.152])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <mail@avomberg.de>)
	id 1PISJV-0001vt-Ks
	for java-user@lucene.apache.org; Tue, 16 Nov 2010 12:39:37 -0800
Date: Tue, 16 Nov 2010 12:39:37 -0800 (PST)
From: Alex vB <mail@avomberg.de>
To: java-user@lucene.apache.org
Message-ID: <1289939977637-1913140.post@n3.nabble.com>
In-Reply-To: <1289907347052-1910449.post@n3.nabble.com>
References: <1289341822239-1872701.post@n3.nabble.com> <AANLkTinAVUHycw664b27Zg_rkbcOVMYJTi82s303Bppn@mail.gmail.com> <1289907347052-1910449.post@n3.nabble.com>
Subject: Re: Implementing indexing of Versioned Document Collections
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org


Hi again,

my Payloads are working fine as I figured out now (haven't seen the
nextPosition method). I really have problems with adding the bitvectors.
Currently I am creating them during tokenization. Therefore, as already
mentioned, they are only completely created when all fields are tokenized
because I add every new term occurence into HashMap and create/update the
linked bitvector during this analysis process. I read in another post that
changing or updating already set payloads isn't possible. Furthermore I need
to store payload only ONCE for a term and not on every term position. For
example on the wiki article for April I would have around 5000 term
occurrences for the term "April"! This would save a lot of memory.

1) Is it possible to pre analyze fields? Maybe analyzing twice. First time
for getting the bitvectors (without writing them!) and second time for
normal index writing with bitvector payloads.
2) Alternatively I could still add the bitvectors during tokenization if I
would be able to set the current term in my custom Filter (extends
TokenFilter). In my HashMap I have pairs of <Term, BitVector> and I could
iterate over all term keys. Is it possible to manually set the current term
and the corresponding payload? I tried something like this after all fields
and streams have been tokenized (Without success):

for (Map.Entry<String, BitSet> e : map.entrySet()) {
	key = e.getKey();
	value = e.getValue();

	termAtt.setTermBuffer(key);
	bitvectorPalyoad = new Payload(toByteArray(value)); 
        payloadAttr.setPayload(bitvectorPalyoad);
}

3) Can I use payloads without term positions? 

If my questions are unclear please tell me! :)

Best regards
Alex



-- 
View this message in context: http://lucene.472066.n3.nabble.com/Implementing-indexing-of-Versioned-Document-Collections-tp1872701p1913140.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47825-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 08:06:57 2010
Return-Path: <java-user-return-47825-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54974 invoked from network); 17 Nov 2010 08:06:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 08:06:57 -0000
Received: (qmail 81862 invoked by uid 500); 17 Nov 2010 08:07:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81685 invoked by uid 500); 17 Nov 2010 08:07:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81675 invoked by uid 99); 17 Nov 2010 08:07:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 08:07:24 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of goksron@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 08:07:17 +0000
Received: by ywh1 with SMTP id 1so1097907ywh.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 00:06:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding:x-antivirus
         :x-antivirus-status;
        bh=bmYISQPqBx8G3FFd7J2QA4Tynvsz882Wx07TUDGx//s=;
        b=cJeWuskullaHccN7aac/jaxcWcCf9zDjEG/I2/PBOjdTiAVKoRuahAMFM5qn2CI30O
         335tGy5rwtWQ1AhxcbCdBtJshboGFLRvAoEqQ1dHurpPrE8DWQ4H8PUDE9Z8MpVaEm8W
         jSZFInmk47RDwkdegb/M9LK9imY8ZtXWHyw/I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding:x-antivirus
         :x-antivirus-status;
        b=SdT2aUcba/VV7PzBn1r0eparWzeNY2Dj0d8gssoHhuMDqnoIF9AKiPZOcqtcBP5KCo
         7waHPN6o0Apsc1KuHnst1k3EGSeErMttxAsKHKM3aImbbXy2LaMXL+UvXBwmyyoUUxHn
         oL2pk96h0KBdhTDUrnQm3ytvzxnyUOy4dnc7Y=
Received: by 10.151.110.2 with SMTP id n2mr13496920ybm.164.1289981216409;
        Wed, 17 Nov 2010 00:06:56 -0800 (PST)
Received: from [127.0.0.1] ([207.179.4.183])
        by mx.google.com with ESMTPS id d10sm6112960and.39.2010.11.17.00.06.54
        (version=SSLv3 cipher=RC4-MD5);
        Wed, 17 Nov 2010 00:06:55 -0800 (PST)
Message-ID: <4CE38D23.2080106@gmail.com>
Date: Wed, 17 Nov 2010 00:06:59 -0800
From: Lance Norskog <goksron@gmail.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.14) Gecko/20100930 SeaMonkey/2.0.9
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: asking about index verification tools
References: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com> <AANLkTi=2e6kym7VKD8dR-PGz7sadPVRx0MgGmXMEA291@mail.gmail.com>
In-Reply-To: <AANLkTi=2e6kym7VKD8dR-PGz7sadPVRx0MgGmXMEA291@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Antivirus: avast! (VPS 101116-1, 11/16/2010), Outbound message
X-Antivirus-Status: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

The Lucene CheckIndex program does this. It is a class somewhere in 
Lucene with a main() method.

Samarendra Pratap wrote:
> It is not guaranteed that every term will be indexed. There is a limit on
> maximum number of terms (as in lucene 3.0 and may be earlier too) per field.
> Check out this
> http://lucene.apache.org/java/3_0_2/api/all/org/apache/lucene/index/IndexWriter.html#setMaxFieldLength(int)
>
> On Tue, Nov 16, 2010 at 11:36 AM, Yakob<jacobian@opensuse-id.org>  wrote:
>
>    
>> hello all,
>> I would like to ask about lucene index. I mean I created a simple
>> program that created lucene indexes and stored it in a folder. also I
>> had use a diagnostic tools name Luke to be able to lurk inside lucene
>> index and find out its content. and I know that lucene is a standard
>> framework when it come to building a search engine. but I just wanted
>> to be sure that lucene indexes every term that existed in a file.
>>
>> I mean is there a way for me or some tools out there to verify that
>> the index contains in lucene indexes is dependable? and not a single
>> term went missing there?
>>
>> I know that this is subjective question but I just wanted to hear your
>> two cents.
>> thanks though. :-)
>>
>> tl;dr: how can we know that the index in lucene is correct?
>>
>> --
>> http://jacobian.web.id
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>      
>
>    

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47826-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 09:04:30 2010
Return-Path: <java-user-return-47826-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73932 invoked from network); 17 Nov 2010 09:04:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 09:04:30 -0000
Received: (qmail 45246 invoked by uid 500); 17 Nov 2010 09:04:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44935 invoked by uid 500); 17 Nov 2010 09:04:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44921 invoked by uid 99); 17 Nov 2010 09:04:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 09:04:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 09:04:51 +0000
Received: by wyf19 with SMTP id 19so1759457wyf.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 01:04:30 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=lBKyd82rAjGL0zoewl+w3nXnfzFBBdma35LRUo3rbqY=;
        b=FwNzpgNqKrNU6d5ATe1ah8k88CP611hi+7YtWPtBTG6Gn5ocIGLVvUjt3KzwMS2ZbP
         fjCpVbz0UdxcEmXJL/r9onvFIuo0/DkKDOT3AY2GyMtGLMnQiqJsDnuor3B2VrxkYNh+
         /xawsv5HFBYC8DKBO3hDJQVRvm9qoAYoJUvGs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=IVJTiZq3sjczZubNAsJNMrt30zoiNojF72b8cE3wuBgu+TmYX2bW8+vQAZxMPbcMTT
         78cdhST4uwPA3LbVhkLJboIn5tYsqeHLDIDjwcRXd2+t6WxQeiU8GstbIpCNkI+kwih7
         6bOn0Pd0QJ291Iy0//gdvmaUrxtaCQxoYFG2c=
Received: by 10.227.158.4 with SMTP id d4mr7030356wbx.61.1289984670289; Wed,
 17 Nov 2010 01:04:30 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.69.138 with HTTP; Wed, 17 Nov 2010 01:04:09 -0800 (PST)
In-Reply-To: <4CE38D23.2080106@gmail.com>
References: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
 <AANLkTi=2e6kym7VKD8dR-PGz7sadPVRx0MgGmXMEA291@mail.gmail.com> <4CE38D23.2080106@gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Wed, 17 Nov 2010 14:34:09 +0530
Message-ID: <AANLkTimkGhF_D8KBX-hvJ55yzES6DRVhPS-9M1TK2RrR@mail.gmail.com>
Subject: Re: asking about index verification tools
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016367fb62909d30604953bf696
X-Virus-Checked: Checked by ClamAV on apache.org

--0016367fb62909d30604953bf696
Content-Type: text/plain; charset=ISO-8859-1

Lance, CheckIndex would only check for the sanity of the index and not
really if all words from the source got added into the index or not.
CheckIndex would only check for corrupt indexes and in the process also take
a lot of time.
Perhaps what Yakob wanted here is just a cross check between the index and
the source.

--
Anshum Gupta
http://ai-cafe.blogspot.com


On Wed, Nov 17, 2010 at 1:36 PM, Lance Norskog <goksron@gmail.com> wrote:

> The Lucene CheckIndex program does this. It is a class somewhere in Lucene
> with a main() method.
>
>
> Samarendra Pratap wrote:
>
>> It is not guaranteed that every term will be indexed. There is a limit on
>> maximum number of terms (as in lucene 3.0 and may be earlier too) per
>> field.
>> Check out this
>>
>> http://lucene.apache.org/java/3_0_2/api/all/org/apache/lucene/index/IndexWriter.html#setMaxFieldLength(int)
>>
>> On Tue, Nov 16, 2010 at 11:36 AM, Yakob<jacobian@opensuse-id.org>  wrote:
>>
>>
>>
>>> hello all,
>>> I would like to ask about lucene index. I mean I created a simple
>>> program that created lucene indexes and stored it in a folder. also I
>>> had use a diagnostic tools name Luke to be able to lurk inside lucene
>>> index and find out its content. and I know that lucene is a standard
>>> framework when it come to building a search engine. but I just wanted
>>> to be sure that lucene indexes every term that existed in a file.
>>>
>>> I mean is there a way for me or some tools out there to verify that
>>> the index contains in lucene indexes is dependable? and not a single
>>> term went missing there?
>>>
>>> I know that this is subjective question but I just wanted to hear your
>>> two cents.
>>> thanks though. :-)
>>>
>>> tl;dr: how can we know that the index in lucene is correct?
>>>
>>> --
>>> http://jacobian.web.id
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>>
>>
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016367fb62909d30604953bf696--

From java-user-return-47827-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 10:17:55 2010
Return-Path: <java-user-return-47827-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14219 invoked from network); 17 Nov 2010 10:17:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 10:17:54 -0000
Received: (qmail 52769 invoked by uid 500); 17 Nov 2010 10:18:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52567 invoked by uid 500); 17 Nov 2010 10:18:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52554 invoked by uid 99); 17 Nov 2010 10:18:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 10:18:20 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.213.176] (HELO mail-yx0-f176.google.com) (209.85.213.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 10:18:13 +0000
Received: by yxm8 with SMTP id 8so1125172yxm.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 02:17:52 -0800 (PST)
MIME-Version: 1.0
Received: by 10.150.135.1 with SMTP id i1mr10164173ybd.436.1289989072487; Wed,
 17 Nov 2010 02:17:52 -0800 (PST)
Received: by 10.150.200.5 with HTTP; Wed, 17 Nov 2010 02:17:52 -0800 (PST)
In-Reply-To: <AANLkTimkGhF_D8KBX-hvJ55yzES6DRVhPS-9M1TK2RrR@mail.gmail.com>
References: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
	<AANLkTi=2e6kym7VKD8dR-PGz7sadPVRx0MgGmXMEA291@mail.gmail.com>
	<4CE38D23.2080106@gmail.com>
	<AANLkTimkGhF_D8KBX-hvJ55yzES6DRVhPS-9M1TK2RrR@mail.gmail.com>
Date: Wed, 17 Nov 2010 17:17:52 +0700
Message-ID: <AANLkTinLOpVj3fU8uwYF3cLYmXJK9bk0Xxc7Ldc0eRR=@mail.gmail.com>
Subject: Re: asking about index verification tools
From: Yakob <jacobian@opensuse-id.org>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

yes you're correct.but I was just wondering my chances here though.
are there any tools that do this crosschecking of index?or else when
you make a search engine then you just feel complacent about it and
feel the crosschecking of index isn't really necessary? what do you do
in this situation? :-)

On 11/17/10, Anshum <anshumg@gmail.com> wrote:
> Lance, CheckIndex would only check for the sanity of the index and not
> really if all words from the source got added into the index or not.
> CheckIndex would only check for corrupt indexes and in the process also take
> a lot of time.
> Perhaps what Yakob wanted here is just a cross check between the index and
> the source.
>
> --



-- 
http://jacobian.web.id

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47828-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 16:48:12 2010
Return-Path: <java-user-return-47828-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18708 invoked from network); 17 Nov 2010 16:48:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 16:48:11 -0000
Received: (qmail 56852 invoked by uid 500); 17 Nov 2010 16:48:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56592 invoked by uid 500); 17 Nov 2010 16:48:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56583 invoked by uid 99); 17 Nov 2010 16:48:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 16:48:39 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of fajerski@informatik.hu-berlin.de designates 141.20.20.51 as permitted sender)
Received: from [141.20.20.51] (HELO mailslv1.informatik.hu-berlin.de) (141.20.20.51)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 16:48:33 +0000
Received: from [192.168.178.25] (p5B3F998C.dip0.t-ipconnect.de [91.63.153.140])
	(authenticated bits=0)
	by mailslv1.informatik.hu-berlin.de (8.14.2+Sun/8.14.2/INF-2.0-MA-SOLARIS-2.10-25) with ESMTP id oAHGlnjF026363
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 17:48:10 +0100 (CET)
Subject: uncorrect results
From: Jan <fajerski@informatik.hu-berlin.de>
To: java-user@lucene.apache.org
Content-Type: multipart/signed; micalg="pgp-sha1"; protocol="application/pgp-signature"; boundary="=-rmQFfg14PpTDNprB4OCN"
Date: Wed, 17 Nov 2010 17:47:49 +0100
Message-ID: <1290012469.1798.23.camel@maschine>
Mime-Version: 1.0
X-Mailer: Evolution 2.28.3 
X-Greylist: Sender succeeded SMTP AUTH, not delayed by milter-greylist-4.2.6 (mailslv1.informatik.hu-berlin.de [141.20.20.51]); Wed, 17 Nov 2010 17:48:10 +0100 (CET)
X-Virus-Scanned: clamav-milter 0.96.3 at sigma
X-Virus-Status: Clean
X-Spam-Level: ***
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on condor
X-Old-Spam-Status: No, score=3.5 required=5.0 tests=AWL,BAYES_00,
	RCVD_IN_BRBL_LASTEXT,RCVD_IN_PBL,SPF_NEUTRAL autolearn=no version=3.3.1

--=-rmQFfg14PpTDNprB4OCN
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Hi,
i have an assignment in my Text Analytics class. I am supposed to create
an index and search it. The corpus is a PubMed-like XML file. it is
possible to query terms (programcall a few terms) and phrases
(programcall "a phrase").=20
When a phrase is queried the program should answer how often the phrase
occured.
The problem is, on certain queries the IndexSearcher returns some
documents that do not have that particular query in its fields.
I'd be delighted if someone could tell me what i am doing wrong.
See the source code at my github repo
https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textanalytic=
s2/

Thanks in advance
jan

PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea6
1.8.2) on an 64 bit Linux machine.

--=-rmQFfg14PpTDNprB4OCN
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Dies ist ein digital signierter Nachrichtenteil

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEABECAAYFAkzkBzUACgkQ0FiIQaGp0Nlb2wCfYRJg7M/piOhhheZTIbbF8WLA
2GMAoJSTYnssiCatOLKp4Qz0gEJAD9uM
=+N5X
-----END PGP SIGNATURE-----

--=-rmQFfg14PpTDNprB4OCN--


From java-user-return-47829-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 17:57:32 2010
Return-Path: <java-user-return-47829-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53470 invoked from network); 17 Nov 2010 17:57:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 17:57:32 -0000
Received: (qmail 70518 invoked by uid 500); 17 Nov 2010 17:58:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70470 invoked by uid 500); 17 Nov 2010 17:58:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70462 invoked by uid 99); 17 Nov 2010 17:58:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 17:58:01 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of gresh@us.ibm.com designates 32.97.182.137 as permitted sender)
Received: from [32.97.182.137] (HELO e7.ny.us.ibm.com) (32.97.182.137)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 17:57:53 +0000
Received: from d01relay05.pok.ibm.com (d01relay05.pok.ibm.com [9.56.227.237])
	by e7.ny.us.ibm.com (8.14.4/8.13.1) with ESMTP id oAHHefUB022196
	for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 12:40:41 -0500
Received: from d01av02.pok.ibm.com (d01av02.pok.ibm.com [9.56.224.216])
	by d01relay05.pok.ibm.com (8.13.8/8.13.8/NCO v10.0) with ESMTP id oAHHvWZc163946
	for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 12:57:32 -0500
Received: from d01av02.pok.ibm.com (loopback [127.0.0.1])
	by d01av02.pok.ibm.com (8.14.4/8.13.1/NCO v10.0 AVout) with ESMTP id oAHHvVfK007125
	for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 15:57:31 -0200
Received: from d01ml605.pok.ibm.com (d01ml605.pok.ibm.com [9.56.227.91])
	by d01av02.pok.ibm.com (8.14.4/8.13.1/NCO v10.0 AVin) with ESMTP id oAHHvVNT007096
	for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 15:57:31 -0200
In-Reply-To: <1290012469.1798.23.camel@maschine>
References: <1290012469.1798.23.camel@maschine>
To: java-user@lucene.apache.org
MIME-Version: 1.0
Subject: Re: uncorrect results
X-KeepSent: F76851AF:C9EE71BA-852577DE:0062190C;
 type=4; name=$KeepSent
X-Mailer: Lotus Notes Release 8.0.2 HF623 January 16, 2009
From: Donna L Gresh <gresh@us.ibm.com>
Message-ID: <OFF76851AF.C9EE71BA-ON852577DE.0062190C-852577DE.006277F3@us.ibm.com>
Date: Wed, 17 Nov 2010 12:57:31 -0500
X-MIMETrack: Serialize by Router on D01ML605/01/M/IBM(Release 8.5.2HF18 | August 31, 2010) at
 11/17/2010 12:57:31,
	Serialize complete at 11/17/2010 12:57:31
Content-Type: multipart/alternative; boundary="=_alternative 0062771D852577DE_="
X-Virus-Checked: Checked by ClamAV on apache.org

--=_alternative 0062771D852577DE_=
Content-Type: text/plain; charset="US-ASCII"

As it is probably more likely that you're doing something incorrect than 
that Lucene is reporting incorrect results :), it might help if you 
reported the exact query that is being submitted to the IndexSearcher, and 
then showing us the document that was incorrectly returned. My guess is 
that either looking at the query itself will immediately reveal the 
problem to you, or that the query in combination with the document and 
knowledge of which analyzers you are using will reveal the problem-

Donna 


Jan <fajerski@informatik.hu-berlin.de> wrote on 11/17/2010 11:47:49 AM:

> [image removed] 
> 
> uncorrect results
> 
> Jan 
> 
> to:
> 
> java-user
> 
> 11/17/2010 11:51 AM
> 
> Please respond to java-user
> 
> Hi,
> i have an assignment in my Text Analytics class. I am supposed to create
> an index and search it. The corpus is a PubMed-like XML file. it is
> possible to query terms (programcall a few terms) and phrases
> (programcall "a phrase"). 
> When a phrase is queried the program should answer how often the phrase
> occured.
> The problem is, on certain queries the IndexSearcher returns some
> documents that do not have that particular query in its fields.
> I'd be delighted if someone could tell me what i am doing wrong.
> See the source code at my github repo
> 
https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textanalytics2/

> 
> Thanks in advance
> jan
> 
> PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea6
> 1.8.2) on an 64 bit Linux machine.
> [attachment "signature.asc" deleted by Donna L Gresh/Watson/IBM] 
--=_alternative 0062771D852577DE_=--

From java-user-return-47830-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 18:20:09 2010
Return-Path: <java-user-return-47830-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72311 invoked from network); 17 Nov 2010 18:20:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 18:20:08 -0000
Received: (qmail 10623 invoked by uid 500); 17 Nov 2010 18:20:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10586 invoked by uid 500); 17 Nov 2010 18:20:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10578 invoked by uid 99); 17 Nov 2010 18:20:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 18:20:37 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=MIME_QP_LONG_LINE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of fajerski@informatik.hu-berlin.de designates 141.20.20.51 as permitted sender)
Received: from [141.20.20.51] (HELO mailslv1.informatik.hu-berlin.de) (141.20.20.51)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 18:20:31 +0000
Received: from [192.168.178.25] (p5B3F998C.dip0.t-ipconnect.de [91.63.153.140])
	(authenticated bits=0)
	by mailslv1.informatik.hu-berlin.de (8.14.2+Sun/8.14.2/INF-2.0-MA-SOLARIS-2.10-25) with ESMTP id oAHIJmH8003653
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 19:20:09 +0100 (CET)
Subject: Re: uncorrect results
From: Jan <fajerski@informatik.hu-berlin.de>
To: java-user@lucene.apache.org
In-Reply-To: <OFF76851AF.C9EE71BA-ON852577DE.0062190C-852577DE.006277F3@us.ibm.com>
References: <1290012469.1798.23.camel@maschine>
	 <OFF76851AF.C9EE71BA-ON852577DE.0062190C-852577DE.006277F3@us.ibm.com>
Content-Type: multipart/signed; micalg="pgp-sha1"; protocol="application/pgp-signature"; boundary="=-jOpK2eMq1eBHJEJE/vSL"
Date: Wed, 17 Nov 2010 19:19:48 +0100
Message-ID: <1290017988.1798.34.camel@maschine>
Mime-Version: 1.0
X-Mailer: Evolution 2.28.3 
X-Greylist: Sender succeeded SMTP AUTH, not delayed by milter-greylist-4.2.6 (mailslv1.informatik.hu-berlin.de [141.20.20.51]); Wed, 17 Nov 2010 19:20:09 +0100 (CET)
X-Virus-Scanned: clamav-milter 0.96.3 at sigma
X-Virus-Status: Clean
X-Spam-Level: ***
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on condor
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, score=3.5 required=5.0 tests=AWL,BAYES_00,MIME_QP_LONG_LINE,
	RCVD_IN_BRBL_LASTEXT,RCVD_IN_PBL,SPF_NEUTRAL autolearn=no version=3.3.1

--=-jOpK2eMq1eBHJEJE/vSL
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

thats what i figured...i can't find out what i'm doing wrong though ;)

so the query is "experiment" (i know not really a phrase...but the
assignment requested precisely so). The program constructs the following
query

+(AbstractText:"experiment" ArticleTitle:"experiment")

which looks good to me. the results look like this:

Found 95 hits.
1. 19810 phrase occurs 3 times=20
2. 587340 phrase occurs once=20
...
80. 896889 phrase occurs 0 times=20
...
95. 900325 phrase occurs once

so here is the document 896889
PMID
	896889
ArticleTitle
	Estrogen-induced sexual receptivity and localization of 3H-estradiol in
brains of female mice: effects of 5 alpha-reduced androgens, progestins
and cyproterone acetate.
AbstractText
	Sexual receptivity induced in ovariectomized CD-1 mice with chronic
daily administration of estradiol benzoate (E2 B) was blocked by
concurrent administration of the 5 alpha-reduced androgen,
dihydrotestosterone (DHT). Receptivity was restored in these females
with progesterone-, but not with dihydroprogesterone-priming 6 hr prior
to testing. Delaying the DHT injections until 12 hr after the E2 B
injections greatly reduced its inhibitory properties. Receptivity in E2
B-primed females was also blocked by concurrent treatment with
cyproterone acetate and 3 alpha-, but not 3 beta-adrostanediol.
Pretreatment with DHT, or 3 alpha- or 3 beta-androstanediol failed to
consistently affects 3H-estradiol accumulation in crude nuclear and
supernatant fractions from brain and pituitary

so apart from doing something wrong while indexing/analyzing (the text
above is from the xml, but i double checked...it is put in teh index
with these textfragments) or so, the token "experiment" does not even
occur. thats what baffles me.

thanks for the very quick reaction
jan

Am Mittwoch, den 17.11.2010, 12:57 -0500 schrieb Donna L Gresh:
> As it is probably more likely that you're doing something incorrect than=20
> that Lucene is reporting incorrect results :), it might help if you=20
> reported the exact query that is being submitted to the IndexSearcher, an=
d=20
> then showing us the document that was incorrectly returned. My guess is=20
> that either looking at the query itself will immediately reveal the=20
> problem to you, or that the query in combination with the document and=20
> knowledge of which analyzers you are using will reveal the problem-
>=20
> Donna=20
>=20
>=20
> Jan <fajerski@informatik.hu-berlin.de> wrote on 11/17/2010 11:47:49 AM:
>=20
> > [image removed]=20
> >=20
> > uncorrect results
> >=20
> > Jan=20
> >=20
> > to:
> >=20
> > java-user
> >=20
> > 11/17/2010 11:51 AM
> >=20
> > Please respond to java-user
> >=20
> > Hi,
> > i have an assignment in my Text Analytics class. I am supposed to creat=
e
> > an index and search it. The corpus is a PubMed-like XML file. it is
> > possible to query terms (programcall a few terms) and phrases
> > (programcall "a phrase").=20
> > When a phrase is queried the program should answer how often the phrase
> > occured.
> > The problem is, on certain queries the IndexSearcher returns some
> > documents that do not have that particular query in its fields.
> > I'd be delighted if someone could tell me what i am doing wrong.
> > See the source code at my github repo
> >=20
> https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textanalyt=
ics2/
>=20
> >=20
> > Thanks in advance
> > jan
> >=20
> > PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea6
> > 1.8.2) on an 64 bit Linux machine.
> > [attachment "signature.asc" deleted by Donna L Gresh/Watson/IBM]=20


--=-jOpK2eMq1eBHJEJE/vSL
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Dies ist ein digital signierter Nachrichtenteil

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEABECAAYFAkzkHMMACgkQ0FiIQaGp0NkunwCeMFXQXIZhfz0uhMklOH9YoZR3
6RoAn2Uf7Ord122RKExZieDMUjuNJIlM
=M5iX
-----END PGP SIGNATURE-----

--=-jOpK2eMq1eBHJEJE/vSL--


From java-user-return-47831-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 18:38:39 2010
Return-Path: <java-user-return-47831-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84692 invoked from network); 17 Nov 2010 18:38:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 18:38:39 -0000
Received: (qmail 46735 invoked by uid 500); 17 Nov 2010 18:39:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46671 invoked by uid 500); 17 Nov 2010 18:39:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46636 invoked by uid 99); 17 Nov 2010 18:39:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 18:39:08 +0000
X-ASF-Spam-Status: No, hits=2.8 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLYTO,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 18:39:02 +0000
Received: by pwj9 with SMTP id 9so727435pwj.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 10:38:41 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:content-type;
        bh=eRDqI45ftOcwbsk3Yefifo9xP+8sFqRauHT4fWBdnhs=;
        b=JV3kzxZwXl6yCOvbnACXX3VfJOYrKmx6ZObG+Xxx+vTMaG150u9zrbphNxvNjoQjVJ
         Mhprx146enlqNmPnykN+hwzThaOCDJfkKyY82k813KEsmrw5cDF/RumVMZYYfHz5g3tH
         RUROKmNjnBEHfweJyKPfaBvXlHTxbTvkcpj90=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=hon8T5EyNcdsA4FzyfLrkMsp4tTFnwrk7jKnKgWaLSEhF4pw3zVSan+2QvjCackEiX
         a4wAm58eOpeorjf868luq9sIrhx5S19SytzL1WInbVAPjWQrZwE+c0rfwUKmMi5IXR2I
         Yws5GpmA/EDlP8Jky9ggCU78gMLVjLae7f9Qg=
MIME-Version: 1.0
Received: by 10.229.235.142 with SMTP id kg14mr7912396qcb.128.1290019119828;
 Wed, 17 Nov 2010 10:38:39 -0800 (PST)
Received: by 10.229.100.139 with HTTP; Wed, 17 Nov 2010 10:38:39 -0800 (PST)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <1290012469.1798.23.camel@maschine>
References: <1290012469.1798.23.camel@maschine>
Date: Wed, 17 Nov 2010 19:38:39 +0100
Message-ID: <AANLkTinA1BQkFtS7y3SsbcX6QhGQ0by+MbWhRu2vVJ+Y@mail.gmail.com>
Subject: Re: uncorrect results
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Jan, can you elaborate the problem a little more. I see you do
indextime analysis with lowercasing (look at LowerCaseTokenizer btw.)
but you don't do lowercaseing at query time.
You could also use the QueryParser to create phrase query automatically though.

Could you give us an idea what the "wrong" documents look like an what
it matched?

One more unrelated question, what course are you doing - just out of curiosity.

simon

On Wed, Nov 17, 2010 at 5:47 PM, Jan <fajerski@informatik.hu-berlin.de> wrote:
> Hi,
> i have an assignment in my Text Analytics class. I am supposed to create
> an index and search it. The corpus is a PubMed-like XML file. it is
> possible to query terms (programcall a few terms) and phrases
> (programcall "a phrase").
> When a phrase is queried the program should answer how often the phrase
> occured.
> The problem is, on certain queries the IndexSearcher returns some
> documents that do not have that particular query in its fields.
> I'd be delighted if someone could tell me what i am doing wrong.
> See the source code at my github repo
> https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textanalytics2/
>
> Thanks in advance
> jan
>
> PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea6
> 1.8.2) on an 64 bit Linux machine.
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47832-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 20:39:09 2010
Return-Path: <java-user-return-47832-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49799 invoked from network); 17 Nov 2010 20:39:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 20:39:09 -0000
Received: (qmail 38090 invoked by uid 500); 17 Nov 2010 20:39:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38021 invoked by uid 500); 17 Nov 2010 20:39:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37894 invoked by uid 99); 17 Nov 2010 20:39:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 20:39:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 20:39:31 +0000
Received: by gwb15 with SMTP id 15so1604466gwb.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 12:39:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=H1YTSOorjhqwpKWeoqEQLLn814rdN1k/w1NrTCvY0M4=;
        b=xz1pmGEPvUo4FFi6USLbc+G7PLTkcp5BvMWVUwnm4H3ddSwZeD4zIOM+jhYMkTDVAy
         ed9KnxiyDwGU1UzHqZcy/p3lHqW/ddWKOAiSHaS7HCY9WtXd2tcrInrE+D8xxr2QWU/6
         uHVDJ5et9Z/CL3EoX6X2nRbWpTtplVe/ya72o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=FXNZou6ubnQlOZP0X5wqFzhuiWA1qo8/mppdEDw6Pp8nMhuQtmMu2kgkW1Gqj+eV0i
         qk0pn++wgHO4dsJEKuMolmwWiBucRrWLgqfAjAAggmypaebn4uedJP+ipypVWCd9L7ox
         Lu4H+1CixpUDrYlw5+xPh3pFTHv/HF4CnWX7c=
MIME-Version: 1.0
Received: by 10.229.233.142 with SMTP id jy14mr7953551qcb.2.1290026351027;
 Wed, 17 Nov 2010 12:39:11 -0800 (PST)
Received: by 10.229.216.19 with HTTP; Wed, 17 Nov 2010 12:39:10 -0800 (PST)
In-Reply-To: <AANLkTinLOpVj3fU8uwYF3cLYmXJK9bk0Xxc7Ldc0eRR=@mail.gmail.com>
References: <AANLkTi=AYyQVROOdvEQeDE3rGWQDyWiwygBQHYnSDMUD@mail.gmail.com>
	<AANLkTi=2e6kym7VKD8dR-PGz7sadPVRx0MgGmXMEA291@mail.gmail.com>
	<4CE38D23.2080106@gmail.com>
	<AANLkTimkGhF_D8KBX-hvJ55yzES6DRVhPS-9M1TK2RrR@mail.gmail.com>
	<AANLkTinLOpVj3fU8uwYF3cLYmXJK9bk0Xxc7Ldc0eRR=@mail.gmail.com>
Date: Wed, 17 Nov 2010 15:39:10 -0500
Message-ID: <AANLkTi=TQr-5EaTdM0gs+veR+5DybM+rsDimtaUu-N-q@mail.gmail.com>
Subject: Re: asking about index verification tools
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016362851686765d2049545aae4
X-Virus-Checked: Checked by ClamAV on apache.org

--0016362851686765d2049545aae4
Content-Type: text/plain; charset=ISO-8859-1

How could there be such a tool? Consider the number of ways
that a given input stream can be defined. WordDelimiter, Stopwords,
synonyms, etc. Eventually, you'd reconstruct all of the logic embedded
in the analysis process in your checking program. Then you'd wonder
if that was correct.

There's quite a bit of testing done automatically, but that doesn't
really answer your question. You can easily create a special-purpose
tool that would spin through the terms for a given field and figure
out that they were what was expected, but then you have to define
expected terms.

So, you're stuck with just assuming it works or writing a custom tool
I think.

best
Erick

On Wed, Nov 17, 2010 at 5:17 AM, Yakob <jacobian@opensuse-id.org> wrote:

> yes you're correct.but I was just wondering my chances here though.
> are there any tools that do this crosschecking of index?or else when
> you make a search engine then you just feel complacent about it and
> feel the crosschecking of index isn't really necessary? what do you do
> in this situation? :-)
>
> On 11/17/10, Anshum <anshumg@gmail.com> wrote:
> > Lance, CheckIndex would only check for the sanity of the index and not
> > really if all words from the source got added into the index or not.
> > CheckIndex would only check for corrupt indexes and in the process also
> take
> > a lot of time.
> > Perhaps what Yakob wanted here is just a cross check between the index
> and
> > the source.
> >
> > --
>
>
>
> --
> http://jacobian.web.id
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016362851686765d2049545aae4--

From java-user-return-47833-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 21:39:07 2010
Return-Path: <java-user-return-47833-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84786 invoked from network); 17 Nov 2010 21:39:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 21:39:06 -0000
Received: (qmail 55316 invoked by uid 500); 17 Nov 2010 21:39:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55245 invoked by uid 500); 17 Nov 2010 21:39:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55237 invoked by uid 99); 17 Nov 2010 21:39:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:39:35 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,LOTS_OF_MONEY,MIME_QP_LONG_LINE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.160.48 as permitted sender)
Received: from [209.85.160.48] (HELO mail-pw0-f48.google.com) (209.85.160.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:39:29 +0000
Received: by pwj9 with SMTP id 9so782407pwj.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 13:39:09 -0800 (PST)
Received: by 10.142.89.20 with SMTP id m20mr8776517wfb.13.1290029948352;
        Wed, 17 Nov 2010 13:39:08 -0800 (PST)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id x18sm3264310wfa.11.2010.11.17.13.39.04
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 17 Nov 2010 13:39:05 -0800 (PST)
From: Mark Kristensson <mark.kristensson@smartsheet.com>
Mime-Version: 1.0 (Apple Message framework v1081)
Content-Type: multipart/alternative; boundary=Apple-Mail-4-337610772
Subject: Re: IndexWriter.close() performance issue
Date: Wed, 17 Nov 2010 13:38:59 -0800
In-Reply-To: <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
To: java-user@lucene.apache.org
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com> <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com> <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com> <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com> <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
Message-Id: <96794F59-9635-4FE8-9A8D-1BFC23DAA5F4@smartsheet.com>
X-Mailer: Apple Mail (2.1081)

--Apple-Mail-4-337610772
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

After a week away, I'm back and still working to get to the bottom of =
this issue. We run Lucene from the binaries, so making changes to the =
source code is not something we are really setup to do right now.

I have, however, created a trivial Java app that just opens an =
IndexReader for our problematic index and then closes it:

	try {
		IndexReader indexReader =3D =
IndexReader.open(getIndexDirectory(indexPath));
		System.out.println("Successfully opened index at " + =
indexPath);
		indexReader.close();
		System.out.println("Successfully closed index at " + =
indexPath);
	} catch (Exception ex) {
		System.out.println("Exception while opening index: " + =
ex.getMessage());
	}

I've run this simple app with the hprof commands suggested below and it =
appears that a huge amount of the CPU work is spent on String =
function(s). Below is the summary from the end of the java.hprof.txt. =
I'm happy to attach the whole file, but I wasn't sure whether that was =
appropriate for this mailing list.

Thanks,
Mark



CPU SAMPLES BEGIN (total =3D 5295) Wed Nov 17 11:54:15 2010
rank   self  accum   count trace method
   1 80.40% 80.40%    4257 300165 java.lang.String.intern
   2  1.83% 82.23%      97 300189 sun.nio.ch.FileDispatcher.pread0
   3  0.83% 83.06%      44 300232 java.util.HashMap.transfer
   4  0.72% 83.78%      38 300201 sun.nio.ch.FileDispatcher.pread0
   5  0.70% 84.48%      37 300252 =
org.apache.lucene.util.SimpleStringInterner.intern
   6  0.60% 85.08%      32 300191 =
java.lang.StringCoding$StringDecoder.decode
   7  0.59% 85.67%      31 300202 java.lang.System.arraycopy
   8  0.38% 86.04%      20 300098 java.util.zip.ZipFile.read
   9  0.36% 86.40%      19 300203 java.util.Arrays.copyOfRange
  10  0.36% 86.76%      19 300224 sun.nio.ch.FileDispatcher.pread0
  11  0.32% 87.08%      17 300089 java.lang.Class.forName0
  12  0.32% 87.40%      17 300237 java.lang.Thread.currentThread
  13  0.28% 87.69%      15 300049 =
java.lang.ClassLoader.findBootstrapClass
  14  0.28% 87.97%      15 300102 java.util.zip.ZipFile.read
  15  0.26% 88.23%      14 300180 java.util.zip.ZipFile.read
  16  0.26% 88.50%      14 300255 java.lang.Thread.currentThread
  17  0.26% 88.76%      14 300335 sun.nio.ch.FileDispatcher.pread0
  18  0.25% 89.01%      13 300164 java.lang.System.arraycopy
  19  0.25% 89.25%      13 300286 sun.nio.ch.NativeThread.current
  20  0.23% 89.48%      12 300240 sun.nio.ch.FileDispatcher.pread0
  21  0.23% 89.71%      12 300242 java.lang.System.arraycopy
  22  0.21% 89.92%      11 300207 java.lang.Thread.currentThread
  23  0.21% 90.12%      11 300231 java.lang.System.getSecurityManager
  24  0.19% 90.31%      10 300155 java.util.zip.ZipFile.read
  25  0.19% 90.50%      10 300216 =
java.lang.ClassLoader.findBootstrapClass
  26  0.19% 90.69%      10 300239 java.nio.Bits.copyToByteArray
  27  0.19% 90.88%      10 300350 java.util.HashMap.values
  28  0.17% 91.05%       9 300034 =
sun.net.www.protocol.file.Handler.createFileURLConnection
  29  0.17% 91.22%       9 300283 sun.nio.ch.FileDispatcher.pread0
  30  0.15% 91.37%       8 300006 java.util.jar.JarFile.getBytes
  31  0.15% 91.52%       8 300008 java.util.zip.ZipFile.getInputStream
  32  0.15% 91.67%       8 300166 java.util.zip.ZipFile.read
  33  0.15% 91.82%       8 300179 =
java.lang.ClassLoader.findBootstrapClass
  34  0.15% 91.97%       8 300209 sun.nio.ch.FileDispatcher.pread0
  35  0.13% 92.11%       7 300123 =
java.lang.ClassLoader$NativeLibrary.load
  36  0.13% 92.24%       7 300140 sun.nio.ch.FileDispatcher.pread0
  37  0.13% 92.37%       7 300225 sun.nio.ch.FileDispatcher.pread0
  38  0.13% 92.50%       7 300246 java.nio.Bits.copyToByteArray
  39  0.11% 92.62%       6 300031 java.util.zip.ZipFile.read
  40  0.11% 92.73%       6 300059 java.io.FileInputStream.readBytes
  41  0.11% 92.84%       6 300101 =
java.lang.ClassLoader.findBootstrapClass
  42  0.11% 92.96%       6 300138 =
java.lang.ClassLoader.findBootstrapClass
  43  0.11% 93.07%       6 300241 sun.nio.ch.FileDispatcher.pread0
  44  0.11% 93.18%       6 300282 java.lang.Thread.currentThread
  45  0.11% 93.30%       6 300290 =
org.apache.lucene.index.TermInfosReader.<init>
  46  0.11% 93.41%       6 300311 =
org.apache.lucene.util.UnicodeUtil.UTF8toUTF16
  47  0.09% 93.50%       5 300047 java.util.zip.ZipFile.read
  48  0.09% 93.60%       5 300057 =
java.io.UnixFileSystem.getBooleanAttributes0
  49  0.09% 93.69%       5 300064 sun.security.jca.Providers.<clinit>
  50  0.09% 93.79%       5 300254 sun.nio.ch.NativeThread.current
  51  0.09% 93.88%       5 300324 =
org.apache.lucene.index.SegmentTermEnum.next
  52  0.09% 93.98%       5 300340 java.util.HashMap.put
  53  0.08% 94.05%       4 300007 java.util.zip.ZipFile.getInputStream
  54  0.08% 94.13%       4 300009 java.util.zip.ZipFile.getInflater
  55  0.08% 94.20%       4 300010 =
java.util.jar.JarFile.getManifestFromReference
  56  0.08% 94.28%       4 300051 =
java.lang.ClassLoader.findBootstrapClass
  57  0.08% 94.35%       4 300054 =
java.lang.ClassLoader.findBootstrapClass
  58  0.08% 94.43%       4 300083 java.util.HashMap.entrySet0
  59  0.08% 94.50%       4 300108 java.util.zip.ZipFile.read
  60  0.08% 94.58%       4 300135 java.util.zip.ZipFile.read
  61  0.08% 94.66%       4 300142 java.util.zip.ZipFile.read
  62  0.08% 94.73%       4 300238 java.lang.Thread.currentThread
  63  0.08% 94.81%       4 300247 sun.nio.ch.FileDispatcher.pread0
  64  0.08% 94.88%       4 300253 java.lang.Thread.currentThread
  65  0.08% 94.96%       4 300257 java.util.HashMap.resize
  66  0.08% 95.03%       4 300275 sun.nio.ch.FileDispatcher.pread0
  67  0.08% 95.11%       4 300295 =
org.apache.lucene.index.TermBuffer.read
  68  0.08% 95.18%       4 300299 =
org.apache.lucene.index.SegmentTermEnum.next
  69  0.06% 95.24%       3 300004 java.util.zip.ZipFile.getEntry
  70  0.06% 95.30%       3 300021 sun.misc.URLClassPath$3.run
  71  0.06% 95.35%       3 300050 java.util.zip.ZipFile.read
  72  0.06% 95.41%       3 300055 =
java.security.MessageDigest.getInstance
  73  0.06% 95.47%       3 300124 =
java.lang.ClassLoader$NativeLibrary.load
  74  0.06% 95.52%       3 300249 java.util.HashMap.getEntry
  75  0.06% 95.58%       3 300250 java.util.HashMap.getEntry
  76  0.06% 95.64%       3 300261 java.lang.System.arraycopy
  77  0.06% 95.69%       3 300267 java.util.Arrays.copyOf
  78  0.06% 95.75%       3 300276 =
org.apache.lucene.index.TermInfosReader.<init>
  79  0.06% 95.81%       3 300277 =
org.apache.lucene.index.SegmentTermEnum.next
  80  0.06% 95.86%       3 300300 =
org.apache.lucene.index.TermInfosReader.<init>
  81  0.06% 95.92%       3 300304 =
org.apache.lucene.store.IndexInput.readVLong
  82  0.06% 95.98%       3 300318 sun.nio.ch.NativeThread.current
  83  0.06% 96.03%       3 300338 sun.nio.cs.UTF_8.updatePositions
  84  0.06% 96.09%       3 300339 =
org.apache.lucene.util.SimpleStringInterner.intern
  85  0.04% 96.13%       2 300001 =
java.lang.ClassLoader.findBootstrapClass
  86  0.04% 96.17%       2 300079 java.lang.Math.floor
  87  0.04% 96.20%       2 300085 java.security.Provider.parseLegacyPut
  88  0.04% 96.24%       2 300107 =
org.apache.lucene.index.IndexReader.open
  89  0.04% 96.28%       2 300119 java.io.RandomAccessFile.getChannel
  90  0.04% 96.32%       2 300190 java.lang.System.arraycopy
  91  0.04% 96.36%       2 300197 java.nio.ByteBuffer.hasArray
  92  0.04% 96.39%       2 300198 java.util.HashMap.put
  93  0.04% 96.43%       2 300199 java.util.HashMap.hash
  94  0.04% 96.47%       2 300210 java.util.HashMap.addEntry
  95  0.04% 96.51%       2 300217 java.util.HashMap.hash
  96  0.04% 96.54%       2 300220 java.nio.Buffer.position
  97  0.04% 96.58%       2 300222 =
org.apache.lucene.index.FieldInfos.read
  98  0.04% 96.62%       2 300235 java.util.Arrays.copyOf
  99  0.04% 96.66%       2 300243 java.lang.System.arraycopy
 100  0.04% 96.69%       2 300248 =
org.apache.lucene.index.FieldInfos.hasVectors
 101  0.04% 96.73%       2 300258 java.lang.Thread.currentThread
 102  0.04% 96.77%       2 300262 =
org.apache.lucene.util.StringHelper.intern
 103  0.04% 96.81%       2 300264 java.lang.Thread.isInterrupted
 104  0.04% 96.85%       2 300292 =
org.apache.lucene.index.TermInfosReader.<init>
 105  0.04% 96.88%       2 300297 =
org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal
 106  0.04% 96.92%       2 300309 sun.nio.ch.FileDispatcher.pread0
 107  0.04% 96.96%       2 300319 =
org.apache.lucene.store.IndexInput.readVLong
 108  0.04% 97.00%       2 300321 =
org.apache.lucene.store.IndexInput.readVLong
 109  0.04% 97.03%       2 300323 =
org.apache.lucene.store.BufferedIndexInput.refill
 110  0.04% 97.07%       2 300326 sun.nio.ch.NativeThread.current
 111  0.04% 97.11%       2 300332 =
org.apache.lucene.index.SegmentReader$CoreReaders.openDocStores
 112  0.04% 97.15%       2 300334 =
org.apache.lucene.index.SegmentReader.get
 113  0.04% 97.19%       2 300341 java.util.HashMap.put
 114  0.04% 97.22%       2 300344 =
org.apache.lucene.util.SimpleStringInterner.intern
 115  0.04% 97.26%       2 300346 =
org.apache.lucene.store.IndexInput.readString
 116  0.02% 97.28%       1 300003 java.util.zip.ZipFile.open
 117  0.02% 97.30%       1 300014 java.util.jar.Attributes.putValue
 118  0.02% 97.32%       1 300019 sun.misc.URLClassPath.getLoader
 119  0.02% 97.34%       1 300023 =
sun.misc.URLClassPath$JarLoader.ensureOpen
 120  0.02% 97.36%       1 300027 =
sun.misc.URLClassPath$JarLoader.checkResource
 121  0.02% 97.37%       1 300029 =
sun.security.util.ManifestEntryVerifier.<init>
 122  0.02% 97.39%       1 300036 sun.net.www.URLConnection.<init>
 123  0.02% 97.41%       1 300039 java.io.FilePermission$1.run
 124  0.02% 97.43%       1 300060 =
java.util.Properties$LineReader.readLine
 125  0.02% 97.45%       1 300066 sun.security.jca.ProviderList.<clinit>
 126  0.02% 97.47%       1 300071 java.security.Provider.<init>
 127  0.02% 97.49%       1 300075 =
sun.security.jca.ProviderConfig.getLock
 128  0.02% 97.51%       1 300081 =
sun.security.provider.NativePRNG.initIO
 129  0.02% 97.53%       1 300086 java.lang.Character.toUpperCaseEx
 130  0.02% 97.54%       1 300088 java.util.HashMap.put
 131  0.02% 97.56%       1 300093 =
org.apache.lucene.store.FSDirectory.<clinit>
 132  0.02% 97.58%       1 300095 java.lang.ClassLoader.defineClass1
 133  0.02% 97.60%       1 300096 java.util.zip.Inflater.inflateBytes
 134  0.02% 97.62%       1 300097 sun.security.provider.MD5.implDigest
 135  0.02% 97.64%       1 300099 java.util.zip.Inflater.inflateBytes
 136  0.02% 97.66%       1 300103 java.lang.ClassLoader.defineClass1
 137  0.02% 97.68%       1 300104 java.util.Arrays.copyOf
 138  0.02% 97.70%       1 300105 java.lang.String.indexOf
 139  0.02% 97.71%       1 300106 =
java.util.zip.InflaterInputStream.<init>
 140  0.02% 97.73%       1 300109 java.util.zip.ZipFile.read
 141  0.02% 97.75%       1 300111 java.util.Arrays.copyOfRange
 142  0.02% 97.77%       1 300113 java.util.zip.Inflater.inflateBytes
 143  0.02% 97.79%       1 300115 java.util.Arrays.copyOf
 144  0.02% 97.81%       1 300116 =
java.lang.ClassLoader.findBootstrapClass
 145  0.02% 97.83%       1 300117 java.lang.String.lastIndexOf
 146  0.02% 97.85%       1 300122 =
sun.security.action.LoadLibraryAction.<init>
 147  0.02% 97.87%       1 300127 sun.nio.ch.FileChannelImpl.<init>
 148  0.02% 97.88%       1 300132 java.nio.DirectByteBuffer.<init>
 149  0.02% 97.90%       1 300136 java.util.Arrays.copyOfRange
 150  0.02% 97.92%       1 300141 java.lang.ref.SoftReference.get
 151  0.02% 97.94%       1 300143 java.util.zip.Inflater.inflateBytes
 152  0.02% 97.96%       1 300145 =
org.apache.lucene.index.SegmentInfos.read
 153  0.02% 97.98%       1 300146 java.util.zip.CRC32.update
 154  0.02% 98.00%       1 300147 java.nio.CharBuffer.hasArray
 155  0.02% 98.02%       1 300148 java.lang.ClassLoader.defineClass1
 156  0.02% 98.04%       1 300149 =
org.apache.lucene.index.DirectoryReader.<init>
 157  0.02% 98.05%       1 300150 java.lang.ClassLoader.defineClass1
 158  0.02% 98.07%       1 300151 java.lang.AbstractStringBuilder.<init>
 159  0.02% 98.09%       1 300154 java.lang.ClassLoader.defineClass1
 160  0.02% 98.11%       1 300157 =
org.apache.lucene.index.SegmentReader$CoreReaders.<init>
 161  0.02% 98.13%       1 300159 =
org.apache.lucene.util.StringHelper.<clinit>
 162  0.02% 98.15%       1 300161 =
org.apache.lucene.util.SimpleStringInterner.<init>
 163  0.02% 98.17%       1 300167 java.lang.ClassLoader.defineClass1
 164  0.02% 98.19%       1 300168 =
org.apache.lucene.index.SegmentReader$CoreReaders.<init>
 165  0.02% 98.21%       1 300170 =
org.apache.lucene.index.SegmentTermEnum.<init>
 166  0.02% 98.22%       1 300174 java.util.zip.Inflater.inflateBytes
 167  0.02% 98.24%       1 300177 =
java.security.AccessController.doPrivileged
 168  0.02% 98.26%       1 300181 java.util.zip.Inflater.inflateBytes
 169  0.02% 98.28%       1 300182 java.util.Arrays.copyOf
 170  0.02% 98.30%       1 300183 java.util.Arrays.copyOf
 171  0.02% 98.32%       1 300184 java.lang.ClassLoader.defineClass1
 172  0.02% 98.34%       1 300185 java.lang.ref.SoftReference.get
 173  0.02% 98.36%       1 300186 java.lang.String.replace
 174  0.02% 98.38%       1 300187 =
org.apache.lucene.index.SegmentReader.openNorms
 175  0.02% 98.39%       1 300188 java.nio.charset.CharsetDecoder.flush
 176  0.02% 98.41%       1 300192 sun.nio.cs.UTF_8$Decoder.decodeLoop
 177  0.02% 98.43%       1 300193 java.lang.StringCoding.decode
 178  0.02% 98.45%       1 300194 java.lang.System.arraycopy
 179  0.02% 98.47%       1 300195 =
sun.nio.cs.UTF_8$Decoder.decodeArrayLoop
 180  0.02% 98.49%       1 300196 java.util.HashMap.hash
 181  0.02% 98.51%       1 300200 sun.nio.cs.UTF_8$Decoder.isMalformed2
 182  0.02% 98.53%       1 300204 java.lang.System.arraycopy
 183  0.02% 98.55%       1 300205 java.io.RandomAccessFile.open
 184  0.02% 98.56%       1 300206 =
org.apache.lucene.util.SimpleStringInterner.intern
 185  0.02% 98.58%       1 300208 =
java.nio.charset.CoderResult.isUnderflow
 186  0.02% 98.60%       1 300211 =
org.apache.lucene.util.SimpleStringInterner.intern
 187  0.02% 98.62%       1 300212 java.util.HashMap.addEntry
 188  0.02% 98.64%       1 300213 =
org.apache.lucene.store.IndexInput.readVInt
 189  0.02% 98.66%       1 300214 java.util.ArrayList.RangeCheck
 190  0.02% 98.68%       1 300218 =
org.apache.lucene.index.FieldInfos.read
 191  0.02% 98.70%       1 300219 java.lang.Thread.currentThread
 192  0.02% 98.72%       1 300221 java.util.HashMap.transfer
 193  0.02% 98.73%       1 300223 java.lang.System.arraycopy
 194  0.02% 98.75%       1 300226 =
org.apache.lucene.store.IndexInput.readString
 195  0.02% 98.77%       1 300227 =
org.apache.lucene.store.BufferedIndexInput.readBytes
 196  0.02% 98.79%       1 300228 java.util.ArrayList.size
 197  0.02% 98.81%       1 300229 java.lang.StringCoding.access$100
 198  0.02% 98.83%       1 300230 java.lang.Thread.currentThread
 199  0.02% 98.85%       1 300233 java.lang.Throwable.fillInStackTrace
 200  0.02% 98.87%       1 300236 java.lang.StringCoding.decode
 201  0.02% 98.89%       1 300244 sun.nio.ch.FileDispatcher.pread0
 202  0.02% 98.90%       1 300245 sun.nio.ch.NativeThread.current
 203  0.02% 98.92%       1 300251 java.util.HashMap.getEntry
 204  0.02% 98.94%       1 300259 java.nio.Bits.copyToByteArray
 205  0.02% 98.96%       1 300260 java.nio.DirectByteBuffer.get
 206  0.02% 98.98%       1 300263 java.lang.Thread.currentThread
 207  0.02% 99.00%       1 300265 sun.nio.ch.FileChannelImpl.read
 208  0.02% 99.02%       1 300266 =
java.nio.channels.spi.AbstractInterruptibleChannel.begin
 209  0.02% 99.04%       1 300268 sun.nio.ch.NativeThread.current
 210  0.02% 99.06%       1 300269 sun.nio.ch.FileChannelImpl.read
 211  0.02% 99.07%       1 300270 java.nio.Bits.copyToByteArray
 212  0.02% 99.09%       1 300271 java.lang.Thread.currentThread
 213  0.02% 99.11%       1 300272 java.lang.Object.clone
 214  0.02% 99.13%       1 300273 =
org.apache.lucene.index.TermInfosReader.<init>
 215  0.02% 99.15%       1 300274 =
org.apache.lucene.index.TermInfosReader.<init>
 216  0.02% 99.17%       1 300278 =
org.apache.lucene.index.SegmentTermEnum.next
 217  0.02% 99.19%       1 300279 =
java.nio.channels.spi.AbstractInterruptibleChannel.isOpen
 218  0.02% 99.21%       1 300280 java.lang.Thread.isInterrupted
 219  0.02% 99.23%       1 300281 java.lang.Thread.currentThread
 220  0.02% 99.24%       1 300284 java.lang.System.arraycopy
 221  0.02% 99.26%       1 300285 java.lang.System.arraycopy
 222  0.02% 99.28%       1 300287 java.lang.Thread.currentThread
 223  0.02% 99.30%       1 300288 java.nio.Bits.copyToByteArray
 224  0.02% 99.32%       1 300289 =
org.apache.lucene.store.BufferedIndexInput.readBytes
 225  0.02% 99.34%       1 300291 =
org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal
 226  0.02% 99.36%       1 300293 java.lang.Thread.isInterrupted
 227  0.02% 99.38%       1 300294 =
org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal
 228  0.02% 99.40%       1 300296 =
org.apache.lucene.store.BufferedIndexInput.readByte
 229  0.02% 99.41%       1 300298 sun.nio.ch.FileChannelImpl.read
 230  0.02% 99.43%       1 300301 java.lang.Thread.currentThread
 231  0.02% 99.45%       1 300302 sun.nio.ch.FileChannelImpl.ensureOpen
 232  0.02% 99.47%       1 300303 sun.nio.ch.FileDispatcher.pread0
 233  0.02% 99.49%       1 300305 sun.nio.ch.FileDispatcher.pread0
 234  0.02% 99.51%       1 300306 sun.nio.ch.NativeThread.current
 235  0.02% 99.53%       1 300307 =
org.apache.lucene.index.TermBuffer.toTerm
 236  0.02% 99.55%       1 300308 =
org.apache.lucene.store.BufferedIndexInput.refill
 237  0.02% 99.57%       1 300310 sun.nio.ch.FileChannelImpl.read
 238  0.02% 99.58%       1 300312 sun.nio.ch.NativeThread.current
 239  0.02% 99.60%       1 300313 sun.nio.ch.FileChannelImpl.read
 240  0.02% 99.62%       1 300314 sun.nio.ch.NativeThread.current
 241  0.02% 99.64%       1 300315 =
org.apache.lucene.store.BufferedIndexInput.refill
 242  0.02% 99.66%       1 300316 =
org.apache.lucene.store.BufferedIndexInput.refill
 243  0.02% 99.68%       1 300317 sun.nio.ch.FileChannelImpl.read
 244  0.02% 99.70%       1 300320 =
org.apache.lucene.index.TermBuffer.read
 245  0.02% 99.72%       1 300322 =
org.apache.lucene.store.BufferedIndexInput.refill
 246  0.02% 99.74%       1 300325 =
org.apache.lucene.index.CompoundFileReader$CSIndexInput.readInternal
 247  0.02% 99.75%       1 300327 =
org.apache.lucene.store.IndexInput.readVInt
 248  0.02% 99.77%       1 300328 =
org.apache.lucene.store.BufferedIndexInput.refill
 249  0.02% 99.79%       1 300329 java.nio.Bits.copyToByteArray
 250  0.02% 99.81%       1 300330 =
org.apache.lucene.store.BufferedIndexInput.refill
 251  0.02% 99.83%       1 300331 sun.nio.ch.NativeThread.current
 252  0.02% 99.85%       1 300333 sun.misc.Unsafe.setMemory
 253  0.02% 99.87%       1 300336 =
org.apache.lucene.index.TermInfosReader.<init>
 254  0.02% 99.89%       1 300337 java.lang.Thread.currentThread
 255  0.02% 99.91%       1 300342 =
org.apache.lucene.index.FieldInfos.read
 256  0.02% 99.92%       1 300343 =
org.apache.lucene.store.IndexInput.readString
 257  0.02% 99.94%       1 300345 sun.nio.ch.IOUtil.read
 258  0.02% 99.96%       1 300347 =
java.nio.channels.spi.AbstractInterruptibleChannel.begin
 259  0.02% 99.98%       1 300348 =
org.apache.lucene.index.FieldInfos.addInternal
 260  0.02% 100.00%       1 300349 =
java.nio.channels.spi.AbstractInterruptibleChannel.begin
CPU SAMPLES END



On Nov 5, 2010, at 10:53 AM, Michael McCandless wrote:

> Hmm...
>=20
> So, I was going on this output from your CheckIndex:
>=20
>   test: field norms.........OK [296713 fields]
>=20
> But in fact I just looked and that number is bogus -- it's always
> equal to total number of fields, not number of fields with norms
> enabled.  I'll open an issue to fix this, but in the meantime can you
> apply this patch to your CheckIndex and run it again?
>=20
> Index: src/java/org/apache/lucene/index/CheckIndex.java
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> --- src/java/org/apache/lucene/index/CheckIndex.java	(revision =
1031678)
> +++ src/java/org/apache/lucene/index/CheckIndex.java	(working copy)
> @@ -570,8 +570,10 @@
>       }
>       final byte[] b =3D new byte[reader.maxDoc()];
>       for (final String fieldName : fieldNames) {
> -        reader.norms(fieldName, b, 0);
> -        ++status.totFields;
> +        if (reader.hasNorms(fieldName)) {
> +          reader.norms(fieldName, b, 0);
> +          ++status.totFields;
> +        }
>       }
>=20
>       msg("OK [" + status.totFields + " fields]");
>=20
> So if in fact you have already disabled norms then something else is
> the source of the sudden slowness.  Though, such a huge number of
> unique field names is not an area of Lucene that's very well tested...
> perhaps there's something silly somewhere.  Maybe you can try
> profiling just the init of your IndexReader?  (Eg, run java with
> -agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).
>=20
> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
> as long as no document in the index ever had norms on (yes it does
> "infect" heh).
>=20
> Mike
>=20
> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>> While most of our Lucene indexes are used for more traditional =
searching, this index in particular is used more like a reporting =
repository. Thus, we really do need to have that many fields indexed and =
they do need to be broken out into separate fields. There may be another =
way to structure the index to reduce the number of fields, but I'm =
hoping we can optimize the current design and avoid (yet another) index =
redesign.
>>=20
>> I'll look into the tweaking the merge policy, but I'm more interested =
in disabling norms because scoring really doesn't matter for us. =
Basically, we need nothing more than a binary answer from Lucene: either =
a record meets the provided criteria (which can be a rather complex =
boolean query with many subqueries) or it doesn't. If the record does =
match, then we get the IDs from lucene and run off to get the live data =
from our primary data store and sort it (in Java) based upon criteria =
provided by the user, not by score.
>>=20
>> After our initial design mushroomed in size, we redesigned and now (I =
thought) do not have norms on any of the fields in this index. So, I'm =
wondering if there was something in the results from the CheckIndex that =
I provided which indicates to you that we may have norms still enabled? =
I know that if you have norms on any one document's field, then any =
other document with that same field will get "infected" with norms as =
well.
>>=20
>> My understanding is that any field that uses the constants  =
Index.NOT_ANALYZED_NO_NORMS or  Index.NO will not  have norms on it, =
regardless of whether or not the field is stored. Is that not correct?
>>=20
>> Thanks,
>> Mark
>>=20
>>=20
>>=20
>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>>=20
>>> Likely what happened is you had a bunch of smaller segments, and =
then
>>> suddenly they got merged into that one big segment (_aiaz) in your
>>> index.
>>>=20
>>> The representation for norms in particular is not sparse, so this
>>> means the size of the norms file for a given segment will be
>>> number-of-unique-indexed-fields X number-of-documents.
>>>=20
>>> So this count grows quadratically on merge.
>>>=20
>>> Do these fields really need to be indexed?   If so, it'd be better =
to
>>> use a single field for all users for the indexable text if you can.
>>>=20
>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on =
the
>>> merge policy; this'd prevent big segments from being produced.
>>> Disabling norms should also workaround this, though that will affect
>>> hit scores...
>>>=20
>>> Mike
>>>=20
>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>>> <mark.kristensson@smartsheet.com> wrote:
>>>> Yes, we do have a large number of unique field names in that index, =
because they are driven by user named fields in our application (with =
some cleaning to remove illegal chars).
>>>>=20
>>>> This slowness problem has appeared very suddenly in the last couple =
of weeks and the number of unique field names has not spiked in the last =
few weeks. Have we crept over some threshold with our linear growth in =
the number of unique field names? Perhaps there is a limit driven by the =
amount of RAM in the machine that we are violating? Are there any =
guidelines for the maximum number, or suggested number, of unique fields =
names in an index or segment? Any suggestions for potentially mitigating =
the problem?
>>>>=20
>>>> Thanks,
>>>> Mark
>>>>=20
>>>>=20
>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>>>=20
>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>>>=20
>>>>>> I've run checkIndex against the index and the results are below. =
That net is that it's telling me nothing is wrong with the index.
>>>>>=20
>>>>> Thanks.
>>>>>=20
>>>>>> I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.
>>>>>=20
>>>>> IndexWriter opens a SegmentReader for each segment in the index, =
to
>>>>> apply deletions, so I think this is the source of the slowness.
>>>>>=20
>>>>> =46rom the CheckIndex output, it looks like you have many =
(296,713)
>>>>> unique fields names on that one large segment -- does that sound
>>>>> right?  I suspect such a very high field count is the source of =
the
>>>>> slowness...
>>>>>=20
>>>>> Mike
>>>>>=20
>>>>> =
---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>=20
>>>>=20
>>>>=20
>>>> =
---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>=20
>>>>=20
>>>=20
>>> =
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


--Apple-Mail-4-337610772--

From java-user-return-47834-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 21:50:14 2010
Return-Path: <java-user-return-47834-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90030 invoked from network); 17 Nov 2010 21:50:14 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 21:50:14 -0000
Received: (qmail 71761 invoked by uid 500); 17 Nov 2010 21:50:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71695 invoked by uid 500); 17 Nov 2010 21:50:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71687 invoked by uid 99); 17 Nov 2010 21:50:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:50:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:50:36 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
Subject: RE: Search returning documents matching a NOT range
Date: Wed, 17 Nov 2010 16:50:12 -0500
Message-ID: <E5331E53F021E443B53EC78F375B3C761F93C3@buf-ex02.cymfony.com>
In-Reply-To: <AANLkTimqE1DHECdiH03TRm4m21MNNBDgCK=0Cz3Yqqum@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Search returning documents matching a NOT range
Thread-Index: AcuBA+qCHQT/MjpKQ4SEV4xryCtUSwFnQCvQ
References: <E5331E53F021E443B53EC78F375B3C761F9170@buf-ex02.cymfony.com> <AANLkTinRmhryUb8QetQPqjoNkVSuHYRRBbq4J1e8TBT5@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F91C9@buf-ex02.cymfony.com> <AANLkTi=Bfh5R9Zsd+Jdo5TUkxerdtpS9H4bkpRYuM4sk@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F91CD@buf-ex02.cymfony.com> <018f01cb7efd$f771ff20$e655fd60$@thetaphi.de> <AANLkTikkqHUjsOk=A3YAq1LYrVXi=JjQCZ+S-ywfXY13@mail.gmail.com> <AANLkTik6qfB7RUbhVEGRBA19xB+co5hD48_iLWdxewbN@mail.gmail.com> <AANLkTim5W6LFUoj4EMzcQ76gW+7WwovReMFF7oB=GRh9@mail.gmail.com> <001301cb8101$c5400a50$4fc01ef0$@thetaphi.de> <AANLkTimqE1DHECdiH03TRm4m21MNNBDgCK=0Cz3Yqqum@mail.gmail.com>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

SSBub3RpY2VkIHRoZXJlIGlzIHN0aWxsIG5vIEpJUkEgdGlja2V0IGZvciB0aGlzLCBkbyB3ZSBo
YXZlIGFueSB0eXBlIG9uIGNvbnNlbnN1cyBvbiBob3cgdGhpcyBpc3N1ZSB3aWxsL3dpbGwgbm90
IGJlIHJlc29sdmVkPyAgDQoNCklmIE11bHRpU2VhcmNoZXIgYW5kIGFuZCBNdWx0aVJlYWRlciBk
byBub3QgZ2l2ZSB0aGUgc2FtZSByZXN1bHRzLCBJIHdvdWxkIHRoaW5rIG9uZSB3b3VsZCBiZSBj
b25zaWRlcmVkICJicm9rZW4iIGFuZC9vciBwb3NzaWJseSAidW5maXhhYmxlIi4gIElzIE11bHRp
U2VhcmNoZXIgZ29pbmcgdG8gYmUgZGVwcmVjYXRlZCBhbmQgcmVtb3ZlZD8gIFNob3VsZCBvbmUg
YWx3YXlzIHVzZSBNdWx0aVJlYWRlciBpbiBvcmRlciB0byBnZXQgYWNjdXJhdGUgcmVzdWx0cz8N
Cg0KDQotLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KRnJvbTogUm9iZXJ0IE11aXIgW21haWx0
bzpyY211aXJAZ21haWwuY29tXSANClNlbnQ6IFdlZG5lc2RheSwgTm92ZW1iZXIgMTAsIDIwMTAg
MToxOSBQTQ0KVG86IGphdmEtdXNlckBsdWNlbmUuYXBhY2hlLm9yZw0KU3ViamVjdDogUmU6IFNl
YXJjaCByZXR1cm5pbmcgZG9jdW1lbnRzIG1hdGNoaW5nIGEgTk9UIHJhbmdlDQoNCk9uIFdlZCwg
Tm92IDEwLCAyMDEwIGF0IDE6MDQgUE0sIFV3ZSBTY2hpbmRsZXIgPHV3ZUB0aGV0YXBoaS5kZT4g
d3JvdGU6DQo+IEkga25vdyB3aGVyZSB0aGUgYnVnIGlzLi4uDQo+DQo+IFRoZSBwcm9ibGVtIGhh
cyBub3RoaW5nIHRvIHRvIHdpdGggTXVsdGlTZWFyY2hlciBhdCBhbGwsIGl0cyBqdXN0IHRoZSBy
ZXdyaXR0ZW4gcXVlcnkuIEJlY2F1c2UgKGFzIFJvYmVydCBzYWlkKSBNdWx0aVNlYXJjaGVyIHJl
d3JpdGVzIHBlciBpbmRleCwgdGhlIHJld3JpdHRlbiBxdWVyeSBpcyBkaWZmZXJlbnQgZm9yIGVh
Y2ggc3ViLWluZGV4LiBUaGUgcHJvYmxlbXMsIFJvYmVydCBtZW50aW9uZWQgb25seSBhZmZlY3Qg
c2NvcmluZyAod2hpY2ggaXMgZGlmZmVyZW50KS4gQXMgUmFuZ2UgaXMgQ29uc3RhbnRTY29yZSBp
dCBzaG91bGQgc3RpbGwgcmV0dXJuIHNhbWUgZG9jdW1lbnRzLg0KPg0KDQpJIGRpc2FncmVlLCBp
dCByZWFsbHkgaXMgYmVjYXVzZSBvZiBob3cgTXVsdGlTZWFyY2hlciBjb21iaW5lKClzIHRoZQ0K
cXVlcmllcyBmcm9tIHRoZSBzdWJzZWFyY2hlcnMuDQoNCmFuZCB0aGUgcHJvYmxlbXMgYWdhaW4g
ZG9uJ3QgYWZmZWN0IHNjb3Jpbmc6DQoNCiogeW91IG1pZ2h0IGhpdCBib29sZWFuIG1heCBjbGF1
c2UgY291bnQgd2l0aCBBVVRPIGlmIHlvdSB1c2UNCk11bHRpU2VhcmNoZXIgKGUuZy4gNSBzdWJz
IHJldHVybiAyNTAgdGVybXMgZWFjaCBhbmQgdGhlIHRvdGFsIHVuaXF1ZQ0KYWNyb3NzIGFsbCBp
biBjb21iaW5lKCkgaXMgPiAxMDI0KS4gSW4gdGhpcyBjYXNlIHRoZSBxdWVyeSB3b24ndCB3b3Jr
DQphdCBhbGwsIGJ1dCBpdCB3b3JrcyB3aXRoIE11bHRpUmVhZGVyLiBBbmQgdGhpcyBpcyByZWFs
bHkgYmFkLCBiZWNhdXNlDQppIHRoaW5rIHdlIGRvY3VtZW50IHlvdSB3aWxsIG5vdCBoaXQgdGhp
cyBib29sZWFuIG1heCBjbGF1c2UgY291bnQNCndpdGggQVVUTywgYW5kIHdlIGRlZmF1bHQgdG8g
aXQgZm9yIHRoaXMgcmVhc29uLg0KDQoqIGZ1enp5cXVlcnkgZXRjIHdpbGwgcmV0dXJuIGNvbXBs
ZXRlbHkgZGlmZmVyZW50IGRvY3VtZW50cywgb3IgaWYgeW91DQptYW51YWxseSB1c2UgVG9wVGVy
bXNSZXdyaXRlIGZvciBzb21lIG90aGVyIHF1ZXJ5Lg0KDQpub25lIG9mIHRoZXNlIHByb2JsZW1z
IGhhcHBlbiBpZiB5b3UgdXNlIE11bHRpUmVhZGVyLiBUaGlzIGlzIHdoeSBpDQpzdWdnZXN0ZWQg
cmVtb3ZpbmcgTXVsdGlTZWFyY2hlciwgYXQgdGhlIGxlYXN0LCBpZiB5b3UgdXNlIHRoaXMgdGhp
bmcNCmkgdGhpbmsgeW91IHNob3VsZCBleHBsaWNpdGx5IHNldCBGSUxURVJfUkVXUklURS4NCg0K
PiBUaGUgcHJvYmxlbSBoZXJlIHNlZW1zIHRvIGJlIHRoYXQgaW4gdGhlIGZpcnN0IHNlYXJjaGVy
IGRlciBCb29sZWFuIHJld3JpdGVzIHRvIGFuIGVtcHR5IEJvb2xlYW5RdWVyeSgpLCB3aGljaCBp
cyBmaW5lIGZvciByYW5nZXMgdGhhdCBoaXQgbm8gdGVybXMgYXQgYWxsICh0aGlzIGlzIGFsc28g
c3VwcG9ydGVkIGFuZCB3b3JrcykuIFRoZSBwcm9ibGVtIHNlZW1zIHRvIGJlIHRoYXQgYSBTSE9V
TERfTk9UIGNsYXVzZSBvbiBhbiBlbXB0eSBCb29sZWFuIHF1ZXJ5IHByb2R1Y2VzIHRoaXMgYnVn
IQ0KDQp5ZXMsIGknbSBub3Qgc3VyZSB0aGlzIGlzIHRoZSAicHJvYmxlbSIsIGkgdGhpbmsgdGhl
IHByb2JsZW0gaXMgaW4NCmNvbWJpbmUoKSwgYnV0IHRoaXMgaXMgdGhlIHJvb3QgY2F1c2UuDQoN
Ci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQ0KVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2Ny
aWJlQGx1Y2VuZS5hcGFjaGUub3JnDQpGb3IgYWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBq
YXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KDQo=


From java-user-return-47835-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 21:51:48 2010
Return-Path: <java-user-return-47835-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90918 invoked from network); 17 Nov 2010 21:51:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 21:51:47 -0000
Received: (qmail 82627 invoked by uid 500); 17 Nov 2010 21:52:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82499 invoked by uid 500); 17 Nov 2010 21:52:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82491 invoked by uid 99); 17 Nov 2010 21:52:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:52:17 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:52:12 +0000
Received: by wwb39 with SMTP id 39so2560576wwb.5
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 13:51:50 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.187.82 with SMTP id x60mr270280wem.9.1290030709769; Wed,
 17 Nov 2010 13:51:49 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Wed, 17 Nov 2010 13:51:49 -0800 (PST)
In-Reply-To: <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
	<AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
	<ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
	<AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
	<1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
	<AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
Date: Wed, 17 Nov 2010 16:51:49 -0500
Message-ID: <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Lucene interns field names... since you have a truly enormous number
of unique fields it's expected intern will be called alot.

But that said it's odd that it's this costly.

Can you post the stack traces that call intern?

Mike

On Fri, Nov 5, 2010 at 1:53 PM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> Hmm...
>
> So, I was going on this output from your CheckIndex:
>
> =A0 test: field norms.........OK [296713 fields]
>
> But in fact I just looked and that number is bogus -- it's always
> equal to total number of fields, not number of fields with norms
> enabled. =A0I'll open an issue to fix this, but in the meantime can you
> apply this patch to your CheckIndex and run it again?
>
> Index: src/java/org/apache/lucene/index/CheckIndex.java
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> --- src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(revision 103=
1678)
> +++ src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(working copy=
)
> @@ -570,8 +570,10 @@
> =A0 =A0 =A0 }
> =A0 =A0 =A0 final byte[] b =3D new byte[reader.maxDoc()];
> =A0 =A0 =A0 for (final String fieldName : fieldNames) {
> - =A0 =A0 =A0 =A0reader.norms(fieldName, b, 0);
> - =A0 =A0 =A0 =A0++status.totFields;
> + =A0 =A0 =A0 =A0if (reader.hasNorms(fieldName)) {
> + =A0 =A0 =A0 =A0 =A0reader.norms(fieldName, b, 0);
> + =A0 =A0 =A0 =A0 =A0++status.totFields;
> + =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 }
>
> =A0 =A0 =A0 msg("OK [" + status.totFields + " fields]");
>
> So if in fact you have already disabled norms then something else is
> the source of the sudden slowness. =A0Though, such a huge number of
> unique field names is not an area of Lucene that's very well tested...
> perhaps there's something silly somewhere. =A0Maybe you can try
> profiling just the init of your IndexReader? =A0(Eg, run java with
> -agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).
>
> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
> as long as no document in the index ever had norms on (yes it does
> "infect" heh).
>
> Mike
>
> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>> While most of our Lucene indexes are used for more traditional searching=
, this index in particular is used more like a reporting repository. Thus, =
we really do need to have that many fields indexed and they do need to be b=
roken out into separate fields. There may be another way to structure the i=
ndex to reduce the number of fields, but I'm hoping we can optimize the cur=
rent design and avoid (yet another) index redesign.
>>
>> I'll look into the tweaking the merge policy, but I'm more interested in=
 disabling norms because scoring really doesn't matter for us. Basically, w=
e need nothing more than a binary answer from Lucene: either a record meets=
 the provided criteria (which can be a rather complex boolean query with ma=
ny subqueries) or it doesn't. If the record does match, then we get the IDs=
 from lucene and run off to get the live data from our primary data store a=
nd sort it (in Java) based upon criteria provided by the user, not by score=
.
>>
>> After our initial design mushroomed in size, we redesigned and now (I th=
ought) do not have norms on any of the fields in this index. So, I'm wonder=
ing if there was something in the results from the CheckIndex that I provid=
ed which indicates to you that we may have norms still enabled? I know that=
 if you have norms on any one document's field, then any other document wit=
h that same field will get "infected" with norms as well.
>>
>> My understanding is that any field that uses the constants =A0Index.NOT_=
ANALYZED_NO_NORMS or =A0Index.NO will not =A0have norms on it, regardless o=
f whether or not the field is stored. Is that not correct?
>>
>> Thanks,
>> Mark
>>
>>
>>
>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>>
>>> Likely what happened is you had a bunch of smaller segments, and then
>>> suddenly they got merged into that one big segment (_aiaz) in your
>>> index.
>>>
>>> The representation for norms in particular is not sparse, so this
>>> means the size of the norms file for a given segment will be
>>> number-of-unique-indexed-fields X number-of-documents.
>>>
>>> So this count grows quadratically on merge.
>>>
>>> Do these fields really need to be indexed? =A0 If so, it'd be better to
>>> use a single field for all users for the indexable text if you can.
>>>
>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on the
>>> merge policy; this'd prevent big segments from being produced.
>>> Disabling norms should also workaround this, though that will affect
>>> hit scores...
>>>
>>> Mike
>>>
>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>>> <mark.kristensson@smartsheet.com> wrote:
>>>> Yes, we do have a large number of unique field names in that index, be=
cause they are driven by user named fields in our application (with some cl=
eaning to remove illegal chars).
>>>>
>>>> This slowness problem has appeared very suddenly in the last couple of=
 weeks and the number of unique field names has not spiked in the last few =
weeks. Have we crept over some threshold with our linear growth in the numb=
er of unique field names? Perhaps there is a limit driven by the amount of =
RAM in the machine that we are violating? Are there any guidelines for the =
maximum number, or suggested number, of unique fields names in an index or =
segment? Any suggestions for potentially mitigating the problem?
>>>>
>>>> Thanks,
>>>> Mark
>>>>
>>>>
>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>>>
>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>>>
>>>>>> I've run checkIndex against the index and the results are below. Tha=
t net is that it's telling me nothing is wrong with the index.
>>>>>
>>>>> Thanks.
>>>>>
>>>>>> I did not have any instrumentation around the opening of the IndexSe=
archer (we don't use an IndexReader), just around the actual query executio=
n so I had to add some additional logging. What I found surprised me, openi=
ng a search against this index takes the same 6 to 8 seconds that closing t=
he indexWriter takes.
>>>>>
>>>>> IndexWriter opens a SegmentReader for each segment in the index, to
>>>>> apply deletions, so I think this is the source of the slowness.
>>>>>
>>>>> From the CheckIndex output, it looks like you have many (296,713)
>>>>> unique fields names on that one large segment -- does that sound
>>>>> right? =A0I suspect such a very high field count is the source of the
>>>>> slowness...
>>>>>
>>>>> Mike
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47836-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 17 21:57:58 2010
Return-Path: <java-user-return-47836-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94351 invoked from network); 17 Nov 2010 21:57:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 17 Nov 2010 21:57:58 -0000
Received: (qmail 3668 invoked by uid 500); 17 Nov 2010 21:58:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3634 invoked by uid 500); 17 Nov 2010 21:58:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3626 invoked by uid 99); 17 Nov 2010 21:58:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:58:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.212.176 as permitted sender)
Received: from [209.85.212.176] (HELO mail-px0-f176.google.com) (209.85.212.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 17 Nov 2010 21:58:22 +0000
Received: by pxi11 with SMTP id 11so484253pxi.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 13:58:02 -0800 (PST)
Received: by 10.142.115.6 with SMTP id n6mr9389909wfc.169.1290031082265;
        Wed, 17 Nov 2010 13:58:02 -0800 (PST)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id x18sm3281599wfa.11.2010.11.17.13.57.59
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 17 Nov 2010 13:58:00 -0800 (PST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1081)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
Date: Wed, 17 Nov 2010 13:57:54 -0800
Content-Transfer-Encoding: quoted-printable
Message-Id: <778F13F3-C842-4132-AC5D-9FF31D721442@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com> <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com> <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com> <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com> <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com> <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1081)

Sure,

There is only one stack trace (that seems to be how the output for this =
tool works) for java.lang.String.intern:

TRACE 300165:
	java.lang.String.intern(<Unknown Source>:Unknown line)
	=
org.apache.lucene.util.SimpleStringInterner.intern(SimpleStringInterner.ja=
va:74)
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:353)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)

But there are several for =
org.apache.lucene.util.SimpleStringInterner.intern and =
org.apache.lucene.util.StringHelper.intern:


TRACE 300252:
	=
org.apache.lucene.util.SimpleStringInterner.intern(SimpleStringInterner.ja=
va:61)
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:353)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)
TRACE 300339:
	=
org.apache.lucene.util.SimpleStringInterner.intern(SimpleStringInterner.ja=
va:75)
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:353)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)
TRACE 300262:
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	=
org.apache.lucene.index.FieldInfos.addInternal(FieldInfos.java:249)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:363)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)
TRACE 300344:
	=
org.apache.lucene.util.SimpleStringInterner.intern(SimpleStringInterner.ja=
va:78)
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:353)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)
TRACE 300206:
	=
org.apache.lucene.util.SimpleStringInterner.intern(SimpleStringInterner.ja=
va:54)
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:353)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)
TRACE 300211:
	=
org.apache.lucene.util.SimpleStringInterner.intern(SimpleStringInterner.ja=
va:51)
	org.apache.lucene.util.StringHelper.intern(StringHelper.java:34)
	org.apache.lucene.index.FieldInfos.read(FieldInfos.java:353)
	org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:71)
	=
org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.jav=
a:116)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:576)
	=
org.apache.lucene.index.SegmentReader.get(SegmentReader.java:554)
	=
org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:105)
	=
org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryRe=
ader.java:27)
	=
org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:75)
	=
org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.jav=
a:677)
	=
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:69)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:316)
	org.apache.lucene.index.IndexReader.open(IndexReader.java:188)
	com.smartsheet.Main.main(<Unknown Source>:Unknown line)

-Mark



On Nov 17, 2010, at 1:51 PM, Michael McCandless wrote:

> Lucene interns field names... since you have a truly enormous number
> of unique fields it's expected intern will be called alot.
>=20
> But that said it's odd that it's this costly.
>=20
> Can you post the stack traces that call intern?
>=20
> Mike
>=20
> On Fri, Nov 5, 2010 at 1:53 PM, Michael McCandless
> <lucene@mikemccandless.com> wrote:
>> Hmm...
>>=20
>> So, I was going on this output from your CheckIndex:
>>=20
>>   test: field norms.........OK [296713 fields]
>>=20
>> But in fact I just looked and that number is bogus -- it's always
>> equal to total number of fields, not number of fields with norms
>> enabled.  I'll open an issue to fix this, but in the meantime can you
>> apply this patch to your CheckIndex and run it again?
>>=20
>> Index: src/java/org/apache/lucene/index/CheckIndex.java
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision =
1031678)
>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working =
copy)
>> @@ -570,8 +570,10 @@
>>       }
>>       final byte[] b =3D new byte[reader.maxDoc()];
>>       for (final String fieldName : fieldNames) {
>> -        reader.norms(fieldName, b, 0);
>> -        ++status.totFields;
>> +        if (reader.hasNorms(fieldName)) {
>> +          reader.norms(fieldName, b, 0);
>> +          ++status.totFields;
>> +        }
>>       }
>>=20
>>       msg("OK [" + status.totFields + " fields]");
>>=20
>> So if in fact you have already disabled norms then something else is
>> the source of the sudden slowness.  Though, such a huge number of
>> unique field names is not an area of Lucene that's very well =
tested...
>> perhaps there's something silly somewhere.  Maybe you can try
>> profiling just the init of your IndexReader?  (Eg, run java with
>> -agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).
>>=20
>> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
>> as long as no document in the index ever had norms on (yes it does
>> "infect" heh).
>>=20
>> Mike
>>=20
>> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
>> <mark.kristensson@smartsheet.com> wrote:
>>> While most of our Lucene indexes are used for more traditional =
searching, this index in particular is used more like a reporting =
repository. Thus, we really do need to have that many fields indexed and =
they do need to be broken out into separate fields. There may be another =
way to structure the index to reduce the number of fields, but I'm =
hoping we can optimize the current design and avoid (yet another) index =
redesign.
>>>=20
>>> I'll look into the tweaking the merge policy, but I'm more =
interested in disabling norms because scoring really doesn't matter for =
us. Basically, we need nothing more than a binary answer from Lucene: =
either a record meets the provided criteria (which can be a rather =
complex boolean query with many subqueries) or it doesn't. If the record =
does match, then we get the IDs from lucene and run off to get the live =
data from our primary data store and sort it (in Java) based upon =
criteria provided by the user, not by score.
>>>=20
>>> After our initial design mushroomed in size, we redesigned and now =
(I thought) do not have norms on any of the fields in this index. So, =
I'm wondering if there was something in the results from the CheckIndex =
that I provided which indicates to you that we may have norms still =
enabled? I know that if you have norms on any one document's field, then =
any other document with that same field will get "infected" with norms =
as well.
>>>=20
>>> My understanding is that any field that uses the constants  =
Index.NOT_ANALYZED_NO_NORMS or  Index.NO will not  have norms on it, =
regardless of whether or not the field is stored. Is that not correct?
>>>=20
>>> Thanks,
>>> Mark
>>>=20
>>>=20
>>>=20
>>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>>>=20
>>>> Likely what happened is you had a bunch of smaller segments, and =
then
>>>> suddenly they got merged into that one big segment (_aiaz) in your
>>>> index.
>>>>=20
>>>> The representation for norms in particular is not sparse, so this
>>>> means the size of the norms file for a given segment will be
>>>> number-of-unique-indexed-fields X number-of-documents.
>>>>=20
>>>> So this count grows quadratically on merge.
>>>>=20
>>>> Do these fields really need to be indexed?   If so, it'd be better =
to
>>>> use a single field for all users for the indexable text if you can.
>>>>=20
>>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on =
the
>>>> merge policy; this'd prevent big segments from being produced.
>>>> Disabling norms should also workaround this, though that will =
affect
>>>> hit scores...
>>>>=20
>>>> Mike
>>>>=20
>>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>> Yes, we do have a large number of unique field names in that =
index, because they are driven by user named fields in our application =
(with some cleaning to remove illegal chars).
>>>>>=20
>>>>> This slowness problem has appeared very suddenly in the last =
couple of weeks and the number of unique field names has not spiked in =
the last few weeks. Have we crept over some threshold with our linear =
growth in the number of unique field names? Perhaps there is a limit =
driven by the amount of RAM in the machine that we are violating? Are =
there any guidelines for the maximum number, or suggested number, of =
unique fields names in an index or segment? Any suggestions for =
potentially mitigating the problem?
>>>>>=20
>>>>> Thanks,
>>>>> Mark
>>>>>=20
>>>>>=20
>>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>>>>=20
>>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>>>>=20
>>>>>>> I've run checkIndex against the index and the results are below. =
That net is that it's telling me nothing is wrong with the index.
>>>>>>=20
>>>>>> Thanks.
>>>>>>=20
>>>>>>> I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.
>>>>>>=20
>>>>>> IndexWriter opens a SegmentReader for each segment in the index, =
to
>>>>>> apply deletions, so I think this is the source of the slowness.
>>>>>>=20
>>>>>> =46rom the CheckIndex output, it looks like you have many =
(296,713)
>>>>>> unique fields names on that one large segment -- does that sound
>>>>>> right?  I suspect such a very high field count is the source of =
the
>>>>>> slowness...
>>>>>>=20
>>>>>> Mike
>>>>>>=20
>>>>>> =
---------------------------------------------------------------------
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>=20
>>>>>=20
>>>>>=20
>>>>> =
---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>=20
>>>>>=20
>>>>=20
>>>> =
---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>=20
>>>=20
>>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47837-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 00:09:55 2010
Return-Path: <java-user-return-47837-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87095 invoked from network); 18 Nov 2010 00:09:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 00:09:55 -0000
Received: (qmail 4912 invoked by uid 500); 18 Nov 2010 00:10:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4875 invoked by uid 500); 18 Nov 2010 00:10:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4867 invoked by uid 99); 18 Nov 2010 00:10:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 00:10:20 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 00:10:14 +0000
Received: by ywh1 with SMTP id 1so1763607ywh.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 16:09:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=9O+peZT283+WekiqJlj9Iy6WVd/td2HCLXy+OX3LMFA=;
        b=GhAt0FDAM6GjDV9RMujCgHNNdEjfHmxt44W59XCf3DHsjBmPPC5JRFwfzq37vgbpZ6
         zJot6zHs5GbkWfSMUZn17OAYI+ZW+ouOSze1oP2hjb4mg3cad9KTpj1Ric6PVfZPnt0x
         SBrERGkMj3sZ7N1Py6wfn+S4wIKet4tL92xGI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=Ju0anqf2Qqau+E1M9Wwgo1RwKU84qa+ku/yZrwPO+tUw0jCqY0tSPI4n/7NWx/y3w8
         9uxSwhgAhWFsI3+qWVCss4q2Wi4Fr2rDWwlr7o8p04d+QKv8RNn23UBsRFUTDaGwZeYL
         viCJS/cblEIHuF3j645t72ilzRP5n5Us0tpfU=
MIME-Version: 1.0
Received: by 10.150.143.21 with SMTP id q21mr15164143ybd.321.1290038993321;
 Wed, 17 Nov 2010 16:09:53 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 17 Nov 2010 16:09:53 -0800 (PST)
Date: Wed, 17 Nov 2010 19:09:53 -0500
Message-ID: <AANLkTi=pKEnnMR-a_xC0Hcw=3QzshN=k4ZG2BOBM2Jgx@mail.gmail.com>
Subject: KeywordAnalyzer and Boosting
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

Greetings!

When using KeywordAnalyzer for indexing a field which has the
Field.Index.ANALYZED option selected.

Does the use of KeywordAnalyzer automatically mean that there is no
point in trying to set the index-time boosts on that field in the
document because it will be treated as a full token but without any
NORMS?

Or does the fact that I said used ANALYZED instead of
ANALYZED_NO_NORMS make some difference and I can get the index-time
boosts information stored the way I want?\
Even though I'm using a KeywordAnalyzer ...

Thanks for reading through my confusing question :)

- Pulkit

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47838-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 00:54:52 2010
Return-Path: <java-user-return-47838-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7362 invoked from network); 18 Nov 2010 00:54:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 00:54:52 -0000
Received: (qmail 38561 invoked by uid 500); 18 Nov 2010 00:55:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38516 invoked by uid 500); 18 Nov 2010 00:55:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38508 invoked by uid 99); 18 Nov 2010 00:55:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 00:55:21 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 00:55:14 +0000
Received: by gyf2 with SMTP id 2so1758770gyf.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 16:54:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=R4DdXpUYHfq77x37tQavStd22u0tQBdxgS3eYMaVE3Q=;
        b=nbL8xr4WA0sX3h+mNkB7visl8ILH44YS/kbwn8gKg8WbtPhgwiy95uvKC2eNaQzGsW
         tfTZkp459x5AEdmSZ+zU69pYyuSH9rsM3T9l5pd5ieGzvIZbPAbAL/P0Prd1n0RmdCoG
         wn/pHuIKL8/3KPwjCN8pDeY+LvdMfF5nZw8Ag=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=bDoHM+MEeJASO7WAWf7AUHM5BKm+cI/bDf3T6dtoUcmCyDqtwlNe1ZN0oLhfaDUdRi
         SkmUtjbe+0cEqTTZ5YjeE2X9hDeVMpqK4IAcS2oli2XMPHeZXnTKCRRagmFJ2UlaW2cL
         SuAmP2pankwKNqE424LFMc1NTnAkWHUkoAXUo=
MIME-Version: 1.0
Received: by 10.150.143.21 with SMTP id q21mr15235997ybd.321.1290041692446;
 Wed, 17 Nov 2010 16:54:52 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Wed, 17 Nov 2010 16:54:52 -0800 (PST)
In-Reply-To: <AANLkTi=pKEnnMR-a_xC0Hcw=3QzshN=k4ZG2BOBM2Jgx@mail.gmail.com>
References: <AANLkTi=pKEnnMR-a_xC0Hcw=3QzshN=k4ZG2BOBM2Jgx@mail.gmail.com>
Date: Wed, 17 Nov 2010 19:54:52 -0500
Message-ID: <AANLkTint68gJzS-buPHS_Hy52Oixg91WenUTmWjo0irr@mail.gmail.com>
Subject: Re: KeywordAnalyzer and Boosting
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Based on my experimentation and what it says in the Lucene 2nd edition book:
"Using a KeywordAnalyzer on special fields during indexing would
eliminate the use of Index.NOT_ANALYZED_NO_NORMS during indexing and
replace it with Index.ANALYZED."

I guess that there is no way to use KeywordAnalyzer during indexing
and get NORMS.

So much for being elegant, if someone has some way to make it happen,
please let me know.

Thanks.

On Wed, Nov 17, 2010 at 7:09 PM, Pulkit Singhal <pulkitsinghal@gmail.com> wrote:
> Greetings!
>
> When using KeywordAnalyzer for indexing a field which has the
> Field.Index.ANALYZED option selected.
>
> Does the use of KeywordAnalyzer automatically mean that there is no
> point in trying to set the index-time boosts on that field in the
> document because it will be treated as a full token but without any
> NORMS?
>
> Or does the fact that I said used ANALYZED instead of
> ANALYZED_NO_NORMS make some difference and I can get the index-time
> boosts information stored the way I want?\
> Even though I'm using a KeywordAnalyzer ...
>
> Thanks for reading through my confusing question :)
>
> - Pulkit
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47839-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 02:08:59 2010
Return-Path: <java-user-return-47839-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42216 invoked from network); 18 Nov 2010 02:08:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 02:08:58 -0000
Received: (qmail 91929 invoked by uid 500); 18 Nov 2010 02:09:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91880 invoked by uid 500); 18 Nov 2010 02:09:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91872 invoked by uid 99); 18 Nov 2010 02:09:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 02:09:24 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of m4eclipse@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 02:09:18 +0000
Received: by qyk31 with SMTP id 31so737372qyk.14
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 18:08:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=FCkPNyJY3CSTmI6hHdPbCRWQFqtJXiqN9WQqY462GQs=;
        b=O9P/aaOJnux6BsDh85mb7TA81M9Lo13VHza8l356DRW3ff6IzxUQXnq+1ux6unYJID
         BLzesateM99Bb/USb68Vz04pTWH/dSLEZSkqNlwLDzUpEKLo7GFaqEFgUOtelDQUXSfo
         U2ML8UsPMK2CT9UG60hx5P6cEpWOI2E/2QtpU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=Ina8oCE8QepPiDIZ301FA12t8ZHb4sSYv8vW62fTpX2LsAtM3AuKVq7u3lRET2UwbC
         d3x5EbxZSM5UeQVX+H4xyyw+fnw38ULPyRrYVfdn6DrK76hUDtiwB9Q+nxXH0BBImqF7
         qQ2N4AF++vjr/QNslGkH0aPIk+OuCKO+0A3QI=
MIME-Version: 1.0
Received: by 10.229.215.6 with SMTP id hc6mr8224774qcb.133.1290046137826; Wed,
 17 Nov 2010 18:08:57 -0800 (PST)
Received: by 10.220.128.8 with HTTP; Wed, 17 Nov 2010 18:08:57 -0800 (PST)
Date: Thu, 18 Nov 2010 10:08:57 +0800
Message-ID: <AANLkTinEvowtFvLUtpG-ihNXF5Z7tBv+1bs6TUEch3XU@mail.gmail.com>
Subject: lucene anchor-distance based search
From: yang Yang <m4eclipse@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636310085ca00a004954a4519

--001636310085ca00a004954a4519
Content-Type: text/plain; charset=ISO-8859-1

We are using the hibernate search which is based on lucene as the search
engine to build a full text search for our position-related data in the
MYSQL db.
This is the main structure of the table(it save the id,coordinate and name
of one Surface_Feature):
+----+--------+---------+------------+
| id | co_x   | co_y    | name       |
+----+--------+---------+------------+
|  1 | 11111  | 22222   | Disney Park|
+----+--------+---------+------------+
Then these attributes are mapped as the fields in lucene by hibernate
search.And I do the following configuration to the field:
.....
field_co_x -->Store.Yes,Index.UN_TOKENIZED.
field_co_y -->Store.Yes,Index.UN_TOKENIZED.
field_name -->Store.Yes,Index.TOKENIZED.
...


Then we want to query the Surface_Features basing on a special scope.

For example:
1) Range search
if we want to search the Surface_Feature whose co_x  is between [minX,maxX]
and whose iny is between [minY,maxY],for this requirement I thought the
RangeTermQuery.
--code snippet--

        TermRangeQuery trq_x=new TermRangeQuery("co_x ", minX, maxX, ture,
true);
        TermRangeQuery trq_Y=new TermRangeQuery("co_y", minY, maxY, ture,
true);

        BooleanQuery query=new BooleanQuery();
        query.add(trq_x, BooleanClause.Occur.MUST);
        query.add(trq_Y,BooleanClause.Occur.MUST);
Is this right?

2) Anchor-distance based search
But I have no idea about how to query features basing on a anchor and a
distance.

That'to say I want to search features who are located inside the circle
defined by the anchor and the distance.

It seems that the sphinx provide a function named SetGeoAnchor(),so I wonder
if lucene can implement the same requirement?

BWT,for some condition-required search I can make the condition as a filter
and then filter the result.

Also I can build a BooleanQuery according to the condition just like the
code in the range search,I wonder which is better?

--001636310085ca00a004954a4519--

From java-user-return-47840-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 05:42:49 2010
Return-Path: <java-user-return-47840-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30310 invoked from network); 18 Nov 2010 05:42:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 05:42:49 -0000
Received: (qmail 3440 invoked by uid 500); 18 Nov 2010 05:43:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3083 invoked by uid 500); 18 Nov 2010 05:43:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3075 invoked by uid 99); 18 Nov 2010 05:43:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 05:43:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 05:43:10 +0000
Received: by wyf19 with SMTP id 19so2937928wyf.35
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 21:42:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=wkIwrIpS/gzm11L3e0YUpdkndwyMQGrcYBY3JkHVl3I=;
        b=sE9wNcrMKhbIDXWGktvyM0xKOaNTIoMaZLbXJT9sOltgAaOKLFS139Sa9naa+QYyBo
         lOzlRCpJdUJ1TNbJk978/YxqHp4HSaCn879Nqdo5hAW8f5FDcLhZi51voYjEfFZ34zTb
         Kj6He2uXmN7yyEeq4FTlKCQNxoOCWFgx/YeNs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=HLghy05qVrWv5gXe0tIYCbv7RP4WDifft38WEqmuLBbBkNXVhtdf/0jxizaff9RWPA
         gS0mNnQNpG3wDW1Ppa+5lBDLA+tSPaDFIjJY24tZipFj2qF91rcvIh6dJoD/xlTgz8a0
         J2Bq4uNSLbaWMNkpsbLaFuYq0BJe6veCcUuhg=
Received: by 10.227.154.3 with SMTP id m3mr144388wbw.119.1290058968004; Wed,
 17 Nov 2010 21:42:48 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.69.138 with HTTP; Wed, 17 Nov 2010 21:42:27 -0800 (PST)
In-Reply-To: <AANLkTinEvowtFvLUtpG-ihNXF5Z7tBv+1bs6TUEch3XU@mail.gmail.com>
References: <AANLkTinEvowtFvLUtpG-ihNXF5Z7tBv+1bs6TUEch3XU@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Thu, 18 Nov 2010 11:12:27 +0530
Message-ID: <AANLkTinjFiegzTP0X0uNHy6k1i5s31DxP==18eFc8y-x@mail.gmail.com>
Subject: Re: lucene anchor-distance based search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016367fb99a86f8c904954d42e6
X-Virus-Checked: Checked by ClamAV on apache.org

--0016367fb99a86f8c904954d42e6
Content-Type: text/plain; charset=ISO-8859-1

Hi.
The way you're forming the BooleanQuery seems fine to me (minus the ture
should've been true, and 'm guessing its a typo).
About the geo-spatial search, you may have a look at the various approaches
there are for the same. Have a look at the  contrib module in lucene.
http://wiki.apache.org/lucene-java/SpatialSearch
For your understanding, you could have a look at the bounding box approach.

--
Anshum Gupta
http://ai-cafe.blogspot.com


On Thu, Nov 18, 2010 at 7:38 AM, yang Yang <m4eclipse@gmail.com> wrote:

> We are using the hibernate search which is based on lucene as the search
> engine to build a full text search for our position-related data in the
> MYSQL db.
> This is the main structure of the table(it save the id,coordinate and name
> of one Surface_Feature):
> +----+--------+---------+------------+
> | id | co_x   | co_y    | name       |
> +----+--------+---------+------------+
> |  1 | 11111  | 22222   | Disney Park|
> +----+--------+---------+------------+
> Then these attributes are mapped as the fields in lucene by hibernate
> search.And I do the following configuration to the field:
> .....
> field_co_x -->Store.Yes,Index.UN_TOKENIZED.
> field_co_y -->Store.Yes,Index.UN_TOKENIZED.
> field_name -->Store.Yes,Index.TOKENIZED.
> ...
>
>
> Then we want to query the Surface_Features basing on a special scope.
>
> For example:
> 1) Range search
> if we want to search the Surface_Feature whose co_x  is between [minX,maxX]
> and whose iny is between [minY,maxY],for this requirement I thought the
> RangeTermQuery.
> --code snippet--
>
>        TermRangeQuery trq_x=new TermRangeQuery("co_x ", minX, maxX, ture,
> true);
>        TermRangeQuery trq_Y=new TermRangeQuery("co_y", minY, maxY, ture,
> true);
>
>        BooleanQuery query=new BooleanQuery();
>        query.add(trq_x, BooleanClause.Occur.MUST);
>        query.add(trq_Y,BooleanClause.Occur.MUST);
> Is this right?
>
> 2) Anchor-distance based search
> But I have no idea about how to query features basing on a anchor and a
> distance.
>
> That'to say I want to search features who are located inside the circle
> defined by the anchor and the distance.
>
> It seems that the sphinx provide a function named SetGeoAnchor(),so I
> wonder
> if lucene can implement the same requirement?
>
> BWT,for some condition-required search I can make the condition as a filter
> and then filter the result.
>
> Also I can build a BooleanQuery according to the condition just like the
> code in the range search,I wonder which is better?
>

--0016367fb99a86f8c904954d42e6--

From java-user-return-47841-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 07:06:16 2010
Return-Path: <java-user-return-47841-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75863 invoked from network); 18 Nov 2010 07:06:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 07:06:16 -0000
Received: (qmail 85985 invoked by uid 500); 18 Nov 2010 07:06:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85747 invoked by uid 500); 18 Nov 2010 07:06:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85733 invoked by uid 99); 18 Nov 2010 07:06:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 07:06:43 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of m4eclipse@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 07:06:36 +0000
Received: by qyk29 with SMTP id 29so1677018qyk.14
        for <java-user@lucene.apache.org>; Wed, 17 Nov 2010 23:06:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=SbDZ7L3O2rf5LgcOqWjtvh9NpKgN7olE4csRe9/K8bo=;
        b=XSXLf3G43WSVp7qf+aEed+IFniLKDB2yjNoFoktacLdghdh7NpSE3TvWe4pNA0oEb2
         fXns2PZu81wbWG65fpKAZBzndbaISC7jgwQ2VSUwhLvllGZW2EQ4Fdcv5VDvYnxAzHE7
         5zDJRRJbwORlQ9c2OkXGSJzKGKrnDVMXV0cVA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n9zIGigPNbo9+CJpZe5OhudDUE5j09Yi750bWoqOQHyGmgKx5qTk0bfQjSwp6KMQ+y
         E+gs1M3iqvqF/90R56WcCOD/uRv+VK2Z+W/T8RnD7JpNE+CEBUDTZwvgWJ0M/7dfUWtM
         4uAnnCGAf8VkKdjW+bAvZLewJZj+ezvq+hDiA=
MIME-Version: 1.0
Received: by 10.224.11.77 with SMTP id s13mr266051qas.9.1290063975415; Wed, 17
 Nov 2010 23:06:15 -0800 (PST)
Received: by 10.220.128.8 with HTTP; Wed, 17 Nov 2010 23:06:15 -0800 (PST)
In-Reply-To: <AANLkTinjFiegzTP0X0uNHy6k1i5s31DxP==18eFc8y-x@mail.gmail.com>
References: <AANLkTinEvowtFvLUtpG-ihNXF5Z7tBv+1bs6TUEch3XU@mail.gmail.com>
	<AANLkTinjFiegzTP0X0uNHy6k1i5s31DxP==18eFc8y-x@mail.gmail.com>
Date: Thu, 18 Nov 2010 15:06:15 +0800
Message-ID: <AANLkTimZZA75LGx4ef-x0p+kxwW8_ivrheOb+FR2h_Ad@mail.gmail.com>
Subject: Re: lucene anchor-distance based search
From: yang Yang <m4eclipse@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015175cd62afdff2404954e6cb0
X-Virus-Checked: Checked by ClamAV on apache.org

--0015175cd62afdff2404954e6cb0
Content-Type: text/plain; charset=ISO-8859-1

Thank you very much!!! :)

I will have a look at the docs .

2010/11/18 Anshum <anshumg@gmail.com>

> Hi.
> The way you're forming the BooleanQuery seems fine to me (minus the ture
> should've been true, and 'm guessing its a typo).
> About the geo-spatial search, you may have a look at the various approaches
> there are for the same. Have a look at the  contrib module in lucene.
> http://wiki.apache.org/lucene-java/SpatialSearch
> For your understanding, you could have a look at the bounding box approach.
>
> --
> Anshum Gupta
> http://ai-cafe.blogspot.com
>
>
> On Thu, Nov 18, 2010 at 7:38 AM, yang Yang <m4eclipse@gmail.com> wrote:
>
> > We are using the hibernate search which is based on lucene as the search
> > engine to build a full text search for our position-related data in the
> > MYSQL db.
> > This is the main structure of the table(it save the id,coordinate and
> name
> > of one Surface_Feature):
> > +----+--------+---------+------------+
> > | id | co_x   | co_y    | name       |
> > +----+--------+---------+------------+
> > |  1 | 11111  | 22222   | Disney Park|
> > +----+--------+---------+------------+
> > Then these attributes are mapped as the fields in lucene by hibernate
> > search.And I do the following configuration to the field:
> > .....
> > field_co_x -->Store.Yes,Index.UN_TOKENIZED.
> > field_co_y -->Store.Yes,Index.UN_TOKENIZED.
> > field_name -->Store.Yes,Index.TOKENIZED.
> > ...
> >
> >
> > Then we want to query the Surface_Features basing on a special scope.
> >
> > For example:
> > 1) Range search
> > if we want to search the Surface_Feature whose co_x  is between
> [minX,maxX]
> > and whose iny is between [minY,maxY],for this requirement I thought the
> > RangeTermQuery.
> > --code snippet--
> >
> >        TermRangeQuery trq_x=new TermRangeQuery("co_x ", minX, maxX, ture,
> > true);
> >        TermRangeQuery trq_Y=new TermRangeQuery("co_y", minY, maxY, ture,
> > true);
> >
> >        BooleanQuery query=new BooleanQuery();
> >        query.add(trq_x, BooleanClause.Occur.MUST);
> >        query.add(trq_Y,BooleanClause.Occur.MUST);
> > Is this right?
> >
> > 2) Anchor-distance based search
> > But I have no idea about how to query features basing on a anchor and a
> > distance.
> >
> > That'to say I want to search features who are located inside the circle
> > defined by the anchor and the distance.
> >
> > It seems that the sphinx provide a function named SetGeoAnchor(),so I
> > wonder
> > if lucene can implement the same requirement?
> >
> > BWT,for some condition-required search I can make the condition as a
> filter
> > and then filter the result.
> >
> > Also I can build a BooleanQuery according to the condition just like the
> > code in the range search,I wonder which is better?
> >
>

--0015175cd62afdff2404954e6cb0--

From java-user-return-47842-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 09:10:54 2010
Return-Path: <java-user-return-47842-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23148 invoked from network); 18 Nov 2010 09:10:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 09:10:54 -0000
Received: (qmail 82717 invoked by uid 500); 18 Nov 2010 09:11:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82426 invoked by uid 500); 18 Nov 2010 09:11:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82418 invoked by uid 99); 18 Nov 2010 09:11:21 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 09:11:21 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 09:11:15 +0000
Received: by bwz9 with SMTP id 9so2905020bwz.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 01:10:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=O/5H9m60M9shE/E2X1eJjJazY73z7+doTlN2BqjMlLo=;
        b=aWTAKZHmp96xbRTISo+piECL3qApVWjyA4x88W2Q3aaPycbRDwvisMIYKaagHmjqKb
         UY0YW8SwykOWckJVvJuXJAVxW+nLDuVne/Ay52UCerZvgztfJw2ZRVbqL1JnqEq/WrZ8
         JXMhCb5Nn+XGEgKwtKpq+2QYVSn/x/Cr7tAKY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Xb+Ib5d0dJZYRKLyJcDzu6A98Ljio864VRqOD0oAzAuutnuuLkV1DPuY/C4Df/S2NV
         eIxLoD9eyscaAZe/2vfqY1QBtT8IrxK/J/K1Ap0sRWasz6Sm8N4ZEnbr0b9sDdVxwSz2
         c8XMGgyMf8maX/0BbhGv7XVu9AdPsbF3W+J0c=
Received: by 10.204.103.66 with SMTP id j2mr281729bko.160.1290071453672; Thu,
 18 Nov 2010 01:10:53 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Thu, 18 Nov 2010 01:10:29 -0800 (PST)
In-Reply-To: <AANLkTint68gJzS-buPHS_Hy52Oixg91WenUTmWjo0irr@mail.gmail.com>
References: <AANLkTi=pKEnnMR-a_xC0Hcw=3QzshN=k4ZG2BOBM2Jgx@mail.gmail.com> <AANLkTint68gJzS-buPHS_Hy52Oixg91WenUTmWjo0irr@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 18 Nov 2010 09:10:29 +0000
Message-ID: <AANLkTike0DG5nCE_4U1D28UNvsy7_nQ52k727qDwMQ7M@mail.gmail.com>
Subject: Re: KeywordAnalyzer and Boosting
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Have you tried explicitly setting norms on/off the way you want with
Field.setOmitNorms(boolean)?


--
Ian.

On Thu, Nov 18, 2010 at 12:54 AM, Pulkit Singhal
<pulkitsinghal@gmail.com> wrote:
> Based on my experimentation and what it says in the Lucene 2nd edition book:
> "Using a KeywordAnalyzer on special fields during indexing would
> eliminate the use of Index.NOT_ANALYZED_NO_NORMS during indexing and
> replace it with Index.ANALYZED."
>
> I guess that there is no way to use KeywordAnalyzer during indexing
> and get NORMS.
>
> So much for being elegant, if someone has some way to make it happen,
> please let me know.
>
> Thanks.
>
> On Wed, Nov 17, 2010 at 7:09 PM, Pulkit Singhal <pulkitsinghal@gmail.com> wrote:
>> Greetings!
>>
>> When using KeywordAnalyzer for indexing a field which has the
>> Field.Index.ANALYZED option selected.
>>
>> Does the use of KeywordAnalyzer automatically mean that there is no
>> point in trying to set the index-time boosts on that field in the
>> document because it will be treated as a full token but without any
>> NORMS?
>>
>> Or does the fact that I said used ANALYZED instead of
>> ANALYZED_NO_NORMS make some difference and I can get the index-time
>> boosts information stored the way I want?\
>> Even though I'm using a KeywordAnalyzer ...
>>
>> Thanks for reading through my confusing question :)
>>
>> - Pulkit
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47843-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 11:03:11 2010
Return-Path: <java-user-return-47843-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65343 invoked from network); 18 Nov 2010 11:03:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 11:03:11 -0000
Received: (qmail 23328 invoked by uid 500); 18 Nov 2010 11:03:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23089 invoked by uid 500); 18 Nov 2010 11:03:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23079 invoked by uid 99); 18 Nov 2010 11:03:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 11:03:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of m4eclipse@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 11:03:32 +0000
Received: by qyk29 with SMTP id 29so1888810qyk.14
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 03:03:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=10kzpf6whlL32Pw5NbrhXpMvqYVPbrd7nzsyHC8SYcQ=;
        b=wY5skFbeN3XEd078ow02xVtOv7q+S9VN12ulZczF2dNMfzntmICSej/Id/CV4Lmuoh
         S9mzNtFquv9B39KPd0cEMq7RhvIVYi7GncAdTbiUNj1nWPWvwXbv55V6ryZ7UwyxfSJu
         0mB4QaTrGu9uvrKNnViutZnRrfpM+AZSbSbmQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=bxzN34UjaRCJhzGejtPSs9oimEDNsYhHflTtRGP8Cniei+5/OzloBFw1ACz2Bf0vnQ
         3sLUwM7MKjtfHQrpQmyOgJUG3XtJreJQEJdKOusYS74OHbFrwvW8xugywJQWTZJ9i9cZ
         2mRxFf4tKdy4eSa3Miht5LAg7LjYBIEcAgYVE=
MIME-Version: 1.0
Received: by 10.224.213.198 with SMTP id gx6mr496305qab.59.1290078191536; Thu,
 18 Nov 2010 03:03:11 -0800 (PST)
Received: by 10.220.128.8 with HTTP; Thu, 18 Nov 2010 03:03:11 -0800 (PST)
In-Reply-To: <AANLkTimZZA75LGx4ef-x0p+kxwW8_ivrheOb+FR2h_Ad@mail.gmail.com>
References: <AANLkTinEvowtFvLUtpG-ihNXF5Z7tBv+1bs6TUEch3XU@mail.gmail.com>
	<AANLkTinjFiegzTP0X0uNHy6k1i5s31DxP==18eFc8y-x@mail.gmail.com>
	<AANLkTimZZA75LGx4ef-x0p+kxwW8_ivrheOb+FR2h_Ad@mail.gmail.com>
Date: Thu, 18 Nov 2010 19:03:11 +0800
Message-ID: <AANLkTikfXO9+98--Zj7Rd3AQx3ZFZkuJ2wi67PYD_vtP@mail.gmail.com>
Subject: Re: lucene anchor-distance based search
From: yang Yang <m4eclipse@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf30050d9056c9e8049551bca6

--20cf30050d9056c9e8049551bca6
Content-Type: text/plain; charset=ISO-8859-1

BWT,for some condition-required search I can make the condition as a filter
and then filter the result.

Also I can build a BooleanQuery according to the condition just like the
code in the range search,I wonder which is better?

2010/11/18 yang Yang <m4eclipse@gmail.com>

> Thank you very much!!! :)
>
> I will have a look at the docs .
>
> 2010/11/18 Anshum <anshumg@gmail.com>
>
> Hi.
>> The way you're forming the BooleanQuery seems fine to me (minus the ture
>> should've been true, and 'm guessing its a typo).
>> About the geo-spatial search, you may have a look at the various
>> approaches
>> there are for the same. Have a look at the  contrib module in lucene.
>> http://wiki.apache.org/lucene-java/SpatialSearch
>> For your understanding, you could have a look at the bounding box
>> approach.
>>
>> --
>> Anshum Gupta
>> http://ai-cafe.blogspot.com
>>
>>
>> On Thu, Nov 18, 2010 at 7:38 AM, yang Yang <m4eclipse@gmail.com> wrote:
>>
>> > We are using the hibernate search which is based on lucene as the search
>> > engine to build a full text search for our position-related data in the
>> > MYSQL db.
>> > This is the main structure of the table(it save the id,coordinate and
>> name
>> > of one Surface_Feature):
>> > +----+--------+---------+------------+
>> > | id | co_x   | co_y    | name       |
>> > +----+--------+---------+------------+
>> > |  1 | 11111  | 22222   | Disney Park|
>> > +----+--------+---------+------------+
>> > Then these attributes are mapped as the fields in lucene by hibernate
>> > search.And I do the following configuration to the field:
>> > .....
>> > field_co_x -->Store.Yes,Index.UN_TOKENIZED.
>> > field_co_y -->Store.Yes,Index.UN_TOKENIZED.
>> > field_name -->Store.Yes,Index.TOKENIZED.
>> > ...
>> >
>> >
>> > Then we want to query the Surface_Features basing on a special scope.
>> >
>> > For example:
>> > 1) Range search
>> > if we want to search the Surface_Feature whose co_x  is between
>> [minX,maxX]
>> > and whose iny is between [minY,maxY],for this requirement I thought the
>> > RangeTermQuery.
>> > --code snippet--
>> >
>> >        TermRangeQuery trq_x=new TermRangeQuery("co_x ", minX, maxX,
>> ture,
>> > true);
>> >        TermRangeQuery trq_Y=new TermRangeQuery("co_y", minY, maxY, ture,
>> > true);
>> >
>> >        BooleanQuery query=new BooleanQuery();
>> >        query.add(trq_x, BooleanClause.Occur.MUST);
>> >        query.add(trq_Y,BooleanClause.Occur.MUST);
>> > Is this right?
>> >
>> > 2) Anchor-distance based search
>> > But I have no idea about how to query features basing on a anchor and a
>> > distance.
>> >
>> > That'to say I want to search features who are located inside the circle
>> > defined by the anchor and the distance.
>> >
>> > It seems that the sphinx provide a function named SetGeoAnchor(),so I
>> > wonder
>> > if lucene can implement the same requirement?
>> >
>> > BWT,for some condition-required search I can make the condition as a
>> filter
>> > and then filter the result.
>> >
>> > Also I can build a BooleanQuery according to the condition just like the
>> > code in the range search,I wonder which is better?
>> >
>>
>
>

--20cf30050d9056c9e8049551bca6--

From java-user-return-47844-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 12:20:59 2010
Return-Path: <java-user-return-47844-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3914 invoked from network); 18 Nov 2010 12:20:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 12:20:59 -0000
Received: (qmail 38925 invoked by uid 500); 18 Nov 2010 12:21:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38703 invoked by uid 500); 18 Nov 2010 12:21:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38695 invoked by uid 99); 18 Nov 2010 12:21:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 12:21:27 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.176 as permitted sender)
Received: from [209.85.213.176] (HELO mail-yx0-f176.google.com) (209.85.213.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 12:21:19 +0000
Received: by yxm8 with SMTP id 8so2021502yxm.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 04:20:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=gJlmBNfPatOdAF4BwoGgHT2xpuoOFBoBI/JHeKbvIIM=;
        b=wX9kpnxW7vtHMQru3yTfHXrUW5ma8mnlV+VXm7t02aZUaVMufIExTAXqKtvvldnlcR
         wsAVZAmL0xZfmhK9tQROMjpNY5mUrvXw8EqcfNS3Gzv2eAhW+l/QLM8I7W0QtLVtLp2Z
         f9M4W7k5pPLAYkFnpsCaedCgTVwualV1d09Ow=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=vSzwNxGonvEah8HiK22VcUGIuwr2OP1+eBXO4zNK32Moj/UxCnjllNTV9axZ5S/lbN
         xqUjyrGuhRmlx6FUqSl+rfKATf0NmgU31az3Kop6QNNOe4p4ob4C9tODZkw4jd5tqcI6
         caFfRmuZG3Kc9xOCWNpZ47p+dREX9paIQ6bLQ=
MIME-Version: 1.0
Received: by 10.151.48.9 with SMTP id a9mr1135628ybk.150.1290082858666; Thu,
 18 Nov 2010 04:20:58 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Thu, 18 Nov 2010 04:20:58 -0800 (PST)
In-Reply-To: <AANLkTike0DG5nCE_4U1D28UNvsy7_nQ52k727qDwMQ7M@mail.gmail.com>
References: <AANLkTi=pKEnnMR-a_xC0Hcw=3QzshN=k4ZG2BOBM2Jgx@mail.gmail.com>
	<AANLkTint68gJzS-buPHS_Hy52Oixg91WenUTmWjo0irr@mail.gmail.com>
	<AANLkTike0DG5nCE_4U1D28UNvsy7_nQ52k727qDwMQ7M@mail.gmail.com>
Date: Thu, 18 Nov 2010 07:20:58 -0500
Message-ID: <AANLkTinX=i77aoJxi1Gt4i0pPmJdLYtVYutMyRyTt6TH@mail.gmail.com>
Subject: Re: KeywordAnalyzer and Boosting
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks Ian,

Yup that would do the trick for me, it seems.

Also I would like to say that the following also worked, I only
realized it after I went through the scores coming from my results
step by step:

KeywordAnalyzer + Index.ANALYZED (index-time norms were present)

Cheers!

On Thu, Nov 18, 2010 at 4:10 AM, Ian Lea <ian.lea@gmail.com> wrote:
> Have you tried explicitly setting norms on/off the way you want with
> Field.setOmitNorms(boolean)?
>
>
> --
> Ian.
>
> On Thu, Nov 18, 2010 at 12:54 AM, Pulkit Singhal
> <pulkitsinghal@gmail.com> wrote:
>> Based on my experimentation and what it says in the Lucene 2nd edition book:
>> "Using a KeywordAnalyzer on special fields during indexing would
>> eliminate the use of Index.NOT_ANALYZED_NO_NORMS during indexing and
>> replace it with Index.ANALYZED."
>>
>> I guess that there is no way to use KeywordAnalyzer during indexing
>> and get NORMS.
>>
>> So much for being elegant, if someone has some way to make it happen,
>> please let me know.
>>
>> Thanks.
>>
>> On Wed, Nov 17, 2010 at 7:09 PM, Pulkit Singhal <pulkitsinghal@gmail.com> wrote:
>>> Greetings!
>>>
>>> When using KeywordAnalyzer for indexing a field which has the
>>> Field.Index.ANALYZED option selected.
>>>
>>> Does the use of KeywordAnalyzer automatically mean that there is no
>>> point in trying to set the index-time boosts on that field in the
>>> document because it will be treated as a full token but without any
>>> NORMS?
>>>
>>> Or does the fact that I said used ANALYZED instead of
>>> ANALYZED_NO_NORMS make some difference and I can get the index-time
>>> boosts information stored the way I want?\
>>> Even though I'm using a KeywordAnalyzer ...
>>>
>>> Thanks for reading through my confusing question :)
>>>
>>> - Pulkit
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47845-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 14:23:12 2010
Return-Path: <java-user-return-47845-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69178 invoked from network); 18 Nov 2010 14:23:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 14:23:12 -0000
Received: (qmail 8633 invoked by uid 500); 18 Nov 2010 14:23:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8481 invoked by uid 500); 18 Nov 2010 14:23:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8473 invoked by uid 99); 18 Nov 2010 14:23:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 14:23:40 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mailer.thomas@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 14:23:31 +0000
Received: by bwz9 with SMTP id 9so3213242bwz.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 06:23:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:content-type
         :content-transfer-encoding;
        bh=IQa4Y58lAWOH23baPd5u6TYSwwRjk4lXlu3pt6pb+tU=;
        b=X18JARcWr5t6QMPs/qlckm+J3JWUEuKEz3nAmM9ty6JpeApmC9tkiaaLB5eQS50NwC
         Nqb7WobAKIYLwYw45ZVrh/hKW9RDjVq15RsrYbnl+Szz86PwXgBrmTs0KcJmSbBFw25N
         T1cbDx0K6AYGqNpWXc1Mn9EXhcjE6Uoo3yCo4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject
         :content-type:content-transfer-encoding;
        b=ph1TDD6sNMGGahV1wHN/brcU/o2yLbNmVahd5Ek5GIF95REQai6uqovAFc/54hC2/F
         HdP8OVUmUDdCQudSbze2NDnuPUwlPaIKRIB5L1fMRQ2l+NIsH0C1dbZzuJAwXkTuJZxr
         gmx5UBvlGOW+/DRPL0OwyOTxy8n5Bhpl3lFbA=
Received: by 10.204.52.136 with SMTP id i8mr632104bkg.96.1290090191209;
        Thu, 18 Nov 2010 06:23:11 -0800 (PST)
Received: from [192.168.24.133] (funny.informatik.hu-berlin.de [141.20.24.156])
        by mx.google.com with ESMTPS id v1sm253083bkt.5.2010.11.18.06.23.10
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 18 Nov 2010 06:23:10 -0800 (PST)
Message-ID: <4CE536CD.6020601@gmail.com>
Date: Thu, 18 Nov 2010 15:23:09 +0100
From: Philippe <mailer.thomas@gmail.com>
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.12) Gecko/20101027 Thunderbird/3.1.6
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Custom similarity calculation ignoring  fieldnorm
Content-Type: text/plain; charset=ISO-8859-15; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Dear Lucene group,

I wrote my own Scorer by extending Similarity.  The scorer works quite 
well, but I would like to ignore the fieldnorm value. Is this somehow 
possible during search time? Or do I have to add a field indexed with 
no_norm?

Best,
     Philippe

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47846-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 15:10:48 2010
Return-Path: <java-user-return-47846-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93400 invoked from network); 18 Nov 2010 15:10:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 15:10:48 -0000
Received: (qmail 81003 invoked by uid 500); 18 Nov 2010 15:11:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80777 invoked by uid 500); 18 Nov 2010 15:11:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80769 invoked by uid 99); 18 Nov 2010 15:11:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 15:11:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of trewig@mufin.com designates 195.214.216.122 as permitted sender)
Received: from [195.214.216.122] (HELO mx2.de.magix.net) (195.214.216.122)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 15:11:09 +0000
Received: from [192.168.1.18] (port=20243)
	by mx2.de.magix.net with esmtpa (Exim 4.69)
	(envelope-from <trewig@mufin.com>)
	id 1PJ68N-0004tQ-99
	for java-user@lucene.apache.org; Thu, 18 Nov 2010 16:10:47 +0100
Message-ID: <4CE541F6.2040607@mufin.com>
Date: Thu, 18 Nov 2010 16:10:46 +0100
From: Thomas Rewig <trewig@mufin.com>
Organization: mufin
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.9) Gecko/20100915 Thunderbird/3.1.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Deleted File Handles - Index Writer
References: <4CDD1BCA.5000700@mufin.com> <AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
In-Reply-To: <AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------020505070906060104080505"
X-SA-Exim-Connect-IP: 192.168.1.18
X-SA-Exim-Mail-From: trewig@mufin.com
X-SA-Exim-Scanned: No (on mx2.de.magix.net); SAEximRunCond expanded to false

--------------020505070906060104080505
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

  Hi Michael,

Thanks for your answer and sorry for my late reply.
> Are you using compound file format (the default)?
>
Yes I am using the compound file format as default.
> If you turn that off (just for this test) do you still see that
> IndexWriter is holding open the files (35 in your example) after you
> close all readers?

If I set
writer.setUseCompoundFile(false);
than I see a short time the 35 handles and than it drops to zero.

If I do not use the compound file format as my new default until the new 
version with the fix is available, what would be the disadvantages?

Thanks for your help.
Thomas

> I've found a case, only with compound file, where IndexWriter holds
> open a SegmentReader on the pre-compound-file files... I'm working on
> a test case&  fix.
>
> Mike
>
> On Fri, Nov 12, 2010 at 5:49 AM, Thomas Rewig<trewig@mufin.com>  wrote:
>>   Hello,
>>
>> I use the searcherManager for LiveIndexing. With  watch -n 60 "lsof | grep
>> indexname | grep deleted | wc -l" I see the number of deleted file handles.
>> The number of handles fluctuates during the indexing.  0 ->  35 ->  53 ->  135
>> ->  40 ->  85 ... Uwe said that this is expected because segments are still
>> referenced by the open IndexReaders, but files were already deleted by
>> IndexWriter.
>>
>> But something puzzles me:
>>
>> Let's say we have a deleted file handle number of 85. If I switch the
>> NearRealTime Searcher to the readOnlySearcher the file handle number is
>> still 85. If i close afterwards the no more used indexwriter, the number
>> drops to 35.  I think that means, that the indexwriter referenced deleted
>> files that are not referenced by the readers.  It seems, that with every
>> commit the number of deleted file handles (which maybe are "caused" by the
>> indexwriter) grows.
>> Is that possible and if yes why does the indexwriter do it? Is there a max
>> Value of deleted handles an IndexWriter could own, because I don't want to
>> chrash the system because of too much open filehandles?
>>
>> Thanks in advance.
>> Thomas
>> --
>>
>>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


--------------020505070906060104080505--

From java-user-return-47847-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 15:36:49 2010
Return-Path: <java-user-return-47847-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4308 invoked from network); 18 Nov 2010 15:36:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 15:36:49 -0000
Received: (qmail 40966 invoked by uid 500); 18 Nov 2010 15:37:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40764 invoked by uid 500); 18 Nov 2010 15:37:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40756 invoked by uid 99); 18 Nov 2010 15:37:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 15:37:18 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.213.176 as permitted sender)
Received: from [209.85.213.176] (HELO mail-yx0-f176.google.com) (209.85.213.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 15:37:11 +0000
Received: by yxm8 with SMTP id 8so2163395yxm.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 07:36:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=UwaaF5//pg5gx8IqICQApDsTHEJdiPKs7EZTXeJd9vg=;
        b=Wsbp9Al9mrwAI1s/RyynhydtdlgTe5P0T11kTMiApUCzu0s5nI++GIutoZUsPmtfgs
         y7yNd/ky9z+ORiNyrJRyYEjtTm7vtMV0uYIr2V9v11qjFugwUQ3fjAQJLsGJgAPr6lFm
         ROk8PwDEGuWQ6rDBAauekOB24OZ3OstN0P/ag=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=aUqAbd2Yv+0lCNoZOlWN7Pjpix0EXSCqpdv+PH8qFPWXvQSSLAH3aa1tjMB/zFAI5V
         uPCx0t4EA/A2L+jxK2aENZH3TxaiLzxNIU8pv93H289P1ps2Js4/Yx99JdZ5C4lOmrMS
         7dq4M3Cjoaj2UDriTyY1xFp8XjBsNU07TbRvo=
MIME-Version: 1.0
Received: by 10.151.11.12 with SMTP id o12mr1408320ybi.435.1290094610871; Thu,
 18 Nov 2010 07:36:50 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Thu, 18 Nov 2010 07:36:50 -0800 (PST)
Date: Thu, 18 Nov 2010 10:36:50 -0500
Message-ID: <AANLkTinDL+dRwqS7+B0VhpqfXzrMfzJab9T+KCLpiEw+@mail.gmail.com>
Subject: How to combine QueryParser and Wildcard search
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

Hello,

I was wondering if there is any API call in Lucene that allows
something like the following:

Step 1: Take the user input
"hello world" you are beautiful

Step 2: QueryParser does its thing
defaultField:hello world defaultField:you defaultField:are
defaultField:beautiful

Step 3: And somehow a desired transformation like the following one is
the next thing to happen:
defaultField:hello world defaultField:you* defaultField:are*
defaultField:beautiful*

How can I tell QueryParser to throw in the wildcard "*" expression
where applicable?

You can see that I'm not expecting it to use "*" with something that
will turn into a phrase query:
"hello world" becomes defaultField:hello world
Just the rest of the tokens:
defaultField:you* defaultField:are* defaultField:beautiful*

Thanks!

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47848-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 16:51:15 2010
Return-Path: <java-user-return-47848-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56641 invoked from network); 18 Nov 2010 16:51:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 16:51:15 -0000
Received: (qmail 73060 invoked by uid 500); 18 Nov 2010 16:51:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72963 invoked by uid 500); 18 Nov 2010 16:51:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72955 invoked by uid 99); 18 Nov 2010 16:51:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 16:51:43 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 16:51:38 +0000
Received: by wyf19 with SMTP id 19so3568052wyf.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 08:51:16 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.28.15 with SMTP id f15mr3576735wea.39.1290099075491; Thu,
 18 Nov 2010 08:51:15 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Thu, 18 Nov 2010 08:51:15 -0800 (PST)
In-Reply-To: <4CE541F6.2040607@mufin.com>
References: <4CDD1BCA.5000700@mufin.com>
	<AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
	<4CE541F6.2040607@mufin.com>
Date: Thu, 18 Nov 2010 11:51:15 -0500
Message-ID: <AANLkTikgBM2gi+FjkJOm5DKZawPhn4PYQSoj6j=uVPCU@mail.gmail.com>
Subject: Re: Deleted File Handles - Index Writer
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Thu, Nov 18, 2010 at 10:10 AM, Thomas Rewig <trewig@mufin.com> wrote:
> =A0Hi Michael,
>
> Thanks for your answer and sorry for my late reply.
>>
>> Are you using compound file format (the default)?
>>
> Yes I am using the compound file format as default.
>>
>> If you turn that off (just for this test) do you still see that
>> IndexWriter is holding open the files (35 in your example) after you
>> close all readers?
>
> If I set
> writer.setUseCompoundFile(false);
> than I see a short time the 35 handles and than it drops to zero.

Hmm what's happening during that short time?  Do you have a reader open?

> If I do not use the compound file format as my new default until the new
> version with the fix is available, what would be the disadvantages?

The big issue with CFS turned off is you risk running out of file
descriptors if you have too many segments in your index.  The exact
limit is very OS dependent though, so if you're on an OS that's
generous, and mergeFactor stays low, then you should be fine.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47849-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 17:55:19 2010
Return-Path: <java-user-return-47849-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10460 invoked from network); 18 Nov 2010 17:55:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 17:55:19 -0000
Received: (qmail 19028 invoked by uid 500); 18 Nov 2010 17:55:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18935 invoked by uid 500); 18 Nov 2010 17:55:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18927 invoked by uid 99); 18 Nov 2010 17:55:48 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 17:55:48 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pulkitsinghal@gmail.com designates 209.85.161.176 as permitted sender)
Received: from [209.85.161.176] (HELO mail-gx0-f176.google.com) (209.85.161.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 17:55:43 +0000
Received: by gxk4 with SMTP id 4so2310747gxk.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 09:55:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=3If4+ELQZIxjbplP2vSejb0Wfz7wgGeJpL74eaVzEl4=;
        b=G5DNt8B5MvFKiK37QzwfnM1EWIh46nmIw8Rtk4yGZob1OLIG7k1UD/y7QJ+GgRhBn1
         Sb90xg0Sv3O1h0RMr2Kd1zwPHQcXFLMKO7SUk3D2oqX6ym3tSfQy8bemn9oIwjWLZ/8E
         xdOfkwJsAMnfzMrqTBmHa6Ab1h3MHcS1N4RhQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=TQ+FHYWWckb9Ahhw0+Tho7UzW2284L2HGGRqKJSBVveYHEZNLyWJpFp8GpCd9HAUGV
         ZSV9LdsHTGEydBGRp/7JSxXZWRZvlpPzbSuk1+jC2Ex4Dx5KIL86tep2o4L0zJQmeXiI
         wukMT3wS+ddxN/DVCp7fKh47mhg6y5eFqMSNg=
MIME-Version: 1.0
Received: by 10.151.48.9 with SMTP id a9mr1688611ybk.150.1290102922377; Thu,
 18 Nov 2010 09:55:22 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Thu, 18 Nov 2010 09:55:22 -0800 (PST)
In-Reply-To: <1290017988.1798.34.camel@maschine>
References: <1290012469.1798.23.camel@maschine>
	<OFF76851AF.C9EE71BA-ON852577DE.0062190C-852577DE.006277F3@us.ibm.com>
	<1290017988.1798.34.camel@maschine>
Date: Thu, 18 Nov 2010 12:55:22 -0500
Message-ID: <AANLkTikm=1jUZ8H4B5mObrCCXzJgr0_K9nW4ZPnQUMTF@mail.gmail.com>
Subject: Re: uncorrect results
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Wow, you live in a really great country and attend an awesome
university where they have classes like "Text Analytics" I'm gonna
send my kid there to study :)

In all seriousness I think the problem may be with how you are
collecting your results.

I find this very amusing:
> 80. 896889 phrase occurs 0 times

How can it claim there are zero hits and still be returning you a result? W=
eird.

Have you tried removing all other docs and then only leaving the one
problem child in there indexing just that and seeing what comes back?

On Wed, Nov 17, 2010 at 1:19 PM, Jan <fajerski@informatik.hu-berlin.de> wro=
te:
> thats what i figured...i can't find out what i'm doing wrong though ;)
>
> so the query is "experiment" (i know not really a phrase...but the
> assignment requested precisely so). The program constructs the following
> query
>
> +(AbstractText:"experiment" ArticleTitle:"experiment")
>
> which looks good to me. the results look like this:
>
> Found 95 hits.
> 1. 19810 phrase occurs 3 times
> 2. 587340 phrase occurs once
> ...
> 80. 896889 phrase occurs 0 times
> ...
> 95. 900325 phrase occurs once
>
> so here is the document 896889
> PMID
> =C2=A0 =C2=A0 =C2=A0 =C2=A0896889
> ArticleTitle
> =C2=A0 =C2=A0 =C2=A0 =C2=A0Estrogen-induced sexual receptivity and locali=
zation of 3H-estradiol in
> brains of female mice: effects of 5 alpha-reduced androgens, progestins
> and cyproterone acetate.
> AbstractText
> =C2=A0 =C2=A0 =C2=A0 =C2=A0Sexual receptivity induced in ovariectomized C=
D-1 mice with chronic
> daily administration of estradiol benzoate (E2 B) was blocked by
> concurrent administration of the 5 alpha-reduced androgen,
> dihydrotestosterone (DHT). Receptivity was restored in these females
> with progesterone-, but not with dihydroprogesterone-priming 6 hr prior
> to testing. Delaying the DHT injections until 12 hr after the E2 B
> injections greatly reduced its inhibitory properties. Receptivity in E2
> B-primed females was also blocked by concurrent treatment with
> cyproterone acetate and 3 alpha-, but not 3 beta-adrostanediol.
> Pretreatment with DHT, or 3 alpha- or 3 beta-androstanediol failed to
> consistently affects 3H-estradiol accumulation in crude nuclear and
> supernatant fractions from brain and pituitary
>
> so apart from doing something wrong while indexing/analyzing (the text
> above is from the xml, but i double checked...it is put in teh index
> with these textfragments) or so, the token "experiment" does not even
> occur. thats what baffles me.
>
> thanks for the very quick reaction
> jan
>
> Am Mittwoch, den 17.11.2010, 12:57 -0500 schrieb Donna L Gresh:
>> As it is probably more likely that you're doing something incorrect than
>> that Lucene is reporting incorrect results :), it might help if you
>> reported the exact query that is being submitted to the IndexSearcher, a=
nd
>> then showing us the document that was incorrectly returned. My guess is
>> that either looking at the query itself will immediately reveal the
>> problem to you, or that the query in combination with the document and
>> knowledge of which analyzers you are using will reveal the problem-
>>
>> Donna
>>
>>
>> Jan <fajerski@informatik.hu-berlin.de> wrote on 11/17/2010 11:47:49 AM:
>>
>> > [image removed]
>> >
>> > uncorrect results
>> >
>> > Jan
>> >
>> > to:
>> >
>> > java-user
>> >
>> > 11/17/2010 11:51 AM
>> >
>> > Please respond to java-user
>> >
>> > Hi,
>> > i have an assignment in my Text Analytics class. I am supposed to crea=
te
>> > an index and search it. The corpus is a PubMed-like XML file. it is
>> > possible to query terms (programcall a few terms) and phrases
>> > (programcall "a phrase").
>> > When a phrase is queried the program should answer how often the phras=
e
>> > occured.
>> > The problem is, on certain queries the IndexSearcher returns some
>> > documents that do not have that particular query in its fields.
>> > I'd be delighted if someone could tell me what i am doing wrong.
>> > See the source code at my github repo
>> >
>> https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textanaly=
tics2/
>>
>> >
>> > Thanks in advance
>> > jan
>> >
>> > PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea6
>> > 1.8.2) on an 64 bit Linux machine.
>> > [attachment "signature.asc" deleted by Donna L Gresh/Watson/IBM]
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47850-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 18:05:11 2010
Return-Path: <java-user-return-47850-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17457 invoked from network); 18 Nov 2010 18:05:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 18:05:11 -0000
Received: (qmail 28855 invoked by uid 500); 18 Nov 2010 18:05:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28636 invoked by uid 500); 18 Nov 2010 18:05:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28628 invoked by uid 99); 18 Nov 2010 18:05:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 18:05:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pulkitsinghal@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 18:05:29 +0000
Received: by gwb15 with SMTP id 15so2311952gwb.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 10:05:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=FSNWMe+//Vj3HKROVLey+Vo1qw3CO/srkhxmm42HDpM=;
        b=KkfHfnlkVAgDTs3EnshUdHX3bE/uZV70Or62LxkTS6iHSxp2K0/UUkGTlZEzB66Ium
         Gm/QrFV2HA5jVbe6X+ARnGjk1eTPryLtWI3Qmu5RwSX2qkeZ2W0jqFdSKlp90eL3p0Gi
         IyILExjTD+S5NyT51JI0czYjqTR2jaRY743OA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=lAmivNuBQkCettWrq5OMjuqqXc9m/+yNYoDRLISEfjPJ5tp2ONcBwGOxKNz/D3nbXV
         cS94UNMM6wh2NzbOEkwDWNbzMXWqjbPsR5mK34nOKPovhUOv2CM7WcWsQpYWCiQvC05g
         vGcOrgzx1lUFMjqZQ7vQNLQtUTLjKqFHoN5yA=
MIME-Version: 1.0
Received: by 10.151.11.12 with SMTP id o12mr1651616ybi.435.1290103507934; Thu,
 18 Nov 2010 10:05:07 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Thu, 18 Nov 2010 10:05:07 -0800 (PST)
In-Reply-To: <AANLkTikm=1jUZ8H4B5mObrCCXzJgr0_K9nW4ZPnQUMTF@mail.gmail.com>
References: <1290012469.1798.23.camel@maschine>
	<OFF76851AF.C9EE71BA-ON852577DE.0062190C-852577DE.006277F3@us.ibm.com>
	<1290017988.1798.34.camel@maschine>
	<AANLkTikm=1jUZ8H4B5mObrCCXzJgr0_K9nW4ZPnQUMTF@mail.gmail.com>
Date: Thu, 18 Nov 2010 13:05:07 -0500
Message-ID: <AANLkTi=Fh25DFu3jZehWbfOSHn79j7PskO9axR+Uyi2G@mail.gmail.com>
Subject: Re: uncorrect results
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Briefly looked at your code and there is no way that I'm right about
this but I'll say it anyway:
Every single field you index doesn't have any NORMS so how will the
scoring happen?
It probably happens based on the matches at query time but its not
like you are specifying any boosts in you query.
Lucene has a complex scoring formula that I don't claim to fully
understand ... but what if somehow (stay with me, don't shoot the
messenger) due to the fact that you have no NORMS at all, the results
being collected somehow give a score to the document that doesn't have
a match at all and therefore present it in the results?

Just a theory (a bad one perhaps) ... but one which can be easily
blown away by using ANALYZED in your indexer and then trying again.

- Pulkit

On Thu, Nov 18, 2010 at 12:55 PM, Pulkit Singhal
<pulkitsinghal@gmail.com> wrote:
> Wow, you live in a really great country and attend an awesome
> university where they have classes like "Text Analytics" I'm gonna
> send my kid there to study :)
>
> In all seriousness I think the problem may be with how you are
> collecting your results.
>
> I find this very amusing:
>> 80. 896889 phrase occurs 0 times
>
> How can it claim there are zero hits and still be returning you a result?=
 Weird.
>
> Have you tried removing all other docs and then only leaving the one
> problem child in there indexing just that and seeing what comes back?
>
> On Wed, Nov 17, 2010 at 1:19 PM, Jan <fajerski@informatik.hu-berlin.de> w=
rote:
>> thats what i figured...i can't find out what i'm doing wrong though ;)
>>
>> so the query is "experiment" (i know not really a phrase...but the
>> assignment requested precisely so). The program constructs the following
>> query
>>
>> +(AbstractText:"experiment" ArticleTitle:"experiment")
>>
>> which looks good to me. the results look like this:
>>
>> Found 95 hits.
>> 1. 19810 phrase occurs 3 times
>> 2. 587340 phrase occurs once
>> ...
>> 80. 896889 phrase occurs 0 times
>> ...
>> 95. 900325 phrase occurs once
>>
>> so here is the document 896889
>> PMID
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0896889
>> ArticleTitle
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0Estrogen-induced sexual receptivity and local=
ization of 3H-estradiol in
>> brains of female mice: effects of 5 alpha-reduced androgens, progestins
>> and cyproterone acetate.
>> AbstractText
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0Sexual receptivity induced in ovariectomized =
CD-1 mice with chronic
>> daily administration of estradiol benzoate (E2 B) was blocked by
>> concurrent administration of the 5 alpha-reduced androgen,
>> dihydrotestosterone (DHT). Receptivity was restored in these females
>> with progesterone-, but not with dihydroprogesterone-priming 6 hr prior
>> to testing. Delaying the DHT injections until 12 hr after the E2 B
>> injections greatly reduced its inhibitory properties. Receptivity in E2
>> B-primed females was also blocked by concurrent treatment with
>> cyproterone acetate and 3 alpha-, but not 3 beta-adrostanediol.
>> Pretreatment with DHT, or 3 alpha- or 3 beta-androstanediol failed to
>> consistently affects 3H-estradiol accumulation in crude nuclear and
>> supernatant fractions from brain and pituitary
>>
>> so apart from doing something wrong while indexing/analyzing (the text
>> above is from the xml, but i double checked...it is put in teh index
>> with these textfragments) or so, the token "experiment" does not even
>> occur. thats what baffles me.
>>
>> thanks for the very quick reaction
>> jan
>>
>> Am Mittwoch, den 17.11.2010, 12:57 -0500 schrieb Donna L Gresh:
>>> As it is probably more likely that you're doing something incorrect tha=
n
>>> that Lucene is reporting incorrect results :), it might help if you
>>> reported the exact query that is being submitted to the IndexSearcher, =
and
>>> then showing us the document that was incorrectly returned. My guess is
>>> that either looking at the query itself will immediately reveal the
>>> problem to you, or that the query in combination with the document and
>>> knowledge of which analyzers you are using will reveal the problem-
>>>
>>> Donna
>>>
>>>
>>> Jan <fajerski@informatik.hu-berlin.de> wrote on 11/17/2010 11:47:49 AM:
>>>
>>> > [image removed]
>>> >
>>> > uncorrect results
>>> >
>>> > Jan
>>> >
>>> > to:
>>> >
>>> > java-user
>>> >
>>> > 11/17/2010 11:51 AM
>>> >
>>> > Please respond to java-user
>>> >
>>> > Hi,
>>> > i have an assignment in my Text Analytics class. I am supposed to cre=
ate
>>> > an index and search it. The corpus is a PubMed-like XML file. it is
>>> > possible to query terms (programcall a few terms) and phrases
>>> > (programcall "a phrase").
>>> > When a phrase is queried the program should answer how often the phra=
se
>>> > occured.
>>> > The problem is, on certain queries the IndexSearcher returns some
>>> > documents that do not have that particular query in its fields.
>>> > I'd be delighted if someone could tell me what i am doing wrong.
>>> > See the source code at my github repo
>>> >
>>> https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textanal=
ytics2/
>>>
>>> >
>>> > Thanks in advance
>>> > jan
>>> >
>>> > PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea6
>>> > 1.8.2) on an 64 bit Linux machine.
>>> > [attachment "signature.asc" deleted by Donna L Gresh/Watson/IBM]
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47851-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 18 18:52:53 2010
Return-Path: <java-user-return-47851-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45898 invoked from network); 18 Nov 2010 18:52:52 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 18 Nov 2010 18:52:52 -0000
Received: (qmail 7026 invoked by uid 500); 18 Nov 2010 18:53:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6983 invoked by uid 500); 18 Nov 2010 18:53:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6975 invoked by uid 99); 18 Nov 2010 18:53:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 18:53:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of fajerski@informatik.hu-berlin.de designates 141.20.20.51 as permitted sender)
Received: from [141.20.20.51] (HELO mailslv1.informatik.hu-berlin.de) (141.20.20.51)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 18 Nov 2010 18:53:15 +0000
Received: from [192.168.178.25] (p5B3F96B9.dip0.t-ipconnect.de [91.63.150.185])
	(authenticated bits=0)
	by mailslv1.informatik.hu-berlin.de (8.14.2+Sun/8.14.2/INF-2.0-MA-SOLARIS-2.10-25) with ESMTP id oAIIqRSl022984
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 19:52:48 +0100 (CET)
Subject: Re: uncorrect results
From: Jan <fajerski@informatik.hu-berlin.de>
To: java-user@lucene.apache.org
In-Reply-To: <AANLkTi=Fh25DFu3jZehWbfOSHn79j7PskO9axR+Uyi2G@mail.gmail.com>
References: <1290012469.1798.23.camel@maschine>
	 <OFF76851AF.C9EE71BA-ON852577DE.0062190C-852577DE.006277F3@us.ibm.com>
	 <1290017988.1798.34.camel@maschine>
	 <AANLkTikm=1jUZ8H4B5mObrCCXzJgr0_K9nW4ZPnQUMTF@mail.gmail.com>
	 <AANLkTi=Fh25DFu3jZehWbfOSHn79j7PskO9axR+Uyi2G@mail.gmail.com>
Content-Type: multipart/signed; micalg="pgp-sha1"; protocol="application/pgp-signature"; boundary="=-eFyWPtEDEe5qe/t/svrw"
Date: Thu, 18 Nov 2010 19:52:26 +0100
Message-ID: <1290106346.1798.56.camel@maschine>
Mime-Version: 1.0
X-Mailer: Evolution 2.28.3 
X-Greylist: Sender succeeded SMTP AUTH, not delayed by milter-greylist-4.2.6 (mailslv1.informatik.hu-berlin.de [141.20.20.51]); Thu, 18 Nov 2010 19:52:48 +0100 (CET)
X-Virus-Scanned: clamav-milter 0.96.3 at sigma
X-Virus-Status: Clean
X-Spam-Level: ***
X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on condor
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, score=3.3 required=5.0 tests=AWL,BAYES_00,RCVD_IN_PBL,
	RDNS_DYNAMIC,SPF_NEUTRAL autolearn=no version=3.3.1

--=-eFyWPtEDEe5qe/t/svrw
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

hmm ok i tried it but to no avail.=20
It would have confused me even more to be honest.
actually i would not have used a Document Collector at all, because I
was supposed to give all results even when queried "the". What i mean is
that i would not need the score at all. I just didn't know how ;)
Anyway a scoring system should not "invent" token i think.

but thanks
jan

Am Donnerstag, den 18.11.2010, 13:05 -0500 schrieb Pulkit Singhal:
> Briefly looked at your code and there is no way that I'm right about
> this but I'll say it anyway:
> Every single field you index doesn't have any NORMS so how will the
> scoring happen?
> It probably happens based on the matches at query time but its not
> like you are specifying any boosts in you query.
> Lucene has a complex scoring formula that I don't claim to fully
> understand ... but what if somehow (stay with me, don't shoot the
> messenger) due to the fact that you have no NORMS at all, the results
> being collected somehow give a score to the document that doesn't have
> a match at all and therefore present it in the results?
>=20
> Just a theory (a bad one perhaps) ... but one which can be easily
> blown away by using ANALYZED in your indexer and then trying again.
>=20
> - Pulkit
>=20
> On Thu, Nov 18, 2010 at 12:55 PM, Pulkit Singhal
> <pulkitsinghal@gmail.com> wrote:
> > Wow, you live in a really great country and attend an awesome
> > university where they have classes like "Text Analytics" I'm gonna
> > send my kid there to study :)
> >
> > In all seriousness I think the problem may be with how you are
> > collecting your results.
> >
> > I find this very amusing:
> >> 80. 896889 phrase occurs 0 times
> >
> > How can it claim there are zero hits and still be returning you a resul=
t? Weird.
> >
> > Have you tried removing all other docs and then only leaving the one
> > problem child in there indexing just that and seeing what comes back?
> >
> > On Wed, Nov 17, 2010 at 1:19 PM, Jan <fajerski@informatik.hu-berlin.de>=
 wrote:
> >> thats what i figured...i can't find out what i'm doing wrong though ;)
> >>
> >> so the query is "experiment" (i know not really a phrase...but the
> >> assignment requested precisely so). The program constructs the followi=
ng
> >> query
> >>
> >> +(AbstractText:"experiment" ArticleTitle:"experiment")
> >>
> >> which looks good to me. the results look like this:
> >>
> >> Found 95 hits.
> >> 1. 19810 phrase occurs 3 times
> >> 2. 587340 phrase occurs once
> >> ...
> >> 80. 896889 phrase occurs 0 times
> >> ...
> >> 95. 900325 phrase occurs once
> >>
> >> so here is the document 896889
> >> PMID
> >>        896889
> >> ArticleTitle
> >>        Estrogen-induced sexual receptivity and localization of 3H-estr=
adiol in
> >> brains of female mice: effects of 5 alpha-reduced androgens, progestin=
s
> >> and cyproterone acetate.
> >> AbstractText
> >>        Sexual receptivity induced in ovariectomized CD-1 mice with chr=
onic
> >> daily administration of estradiol benzoate (E2 B) was blocked by
> >> concurrent administration of the 5 alpha-reduced androgen,
> >> dihydrotestosterone (DHT). Receptivity was restored in these females
> >> with progesterone-, but not with dihydroprogesterone-priming 6 hr prio=
r
> >> to testing. Delaying the DHT injections until 12 hr after the E2 B
> >> injections greatly reduced its inhibitory properties. Receptivity in E=
2
> >> B-primed females was also blocked by concurrent treatment with
> >> cyproterone acetate and 3 alpha-, but not 3 beta-adrostanediol.
> >> Pretreatment with DHT, or 3 alpha- or 3 beta-androstanediol failed to
> >> consistently affects 3H-estradiol accumulation in crude nuclear and
> >> supernatant fractions from brain and pituitary
> >>
> >> so apart from doing something wrong while indexing/analyzing (the text
> >> above is from the xml, but i double checked...it is put in teh index
> >> with these textfragments) or so, the token "experiment" does not even
> >> occur. thats what baffles me.
> >>
> >> thanks for the very quick reaction
> >> jan
> >>
> >> Am Mittwoch, den 17.11.2010, 12:57 -0500 schrieb Donna L Gresh:
> >>> As it is probably more likely that you're doing something incorrect t=
han
> >>> that Lucene is reporting incorrect results :), it might help if you
> >>> reported the exact query that is being submitted to the IndexSearcher=
, and
> >>> then showing us the document that was incorrectly returned. My guess =
is
> >>> that either looking at the query itself will immediately reveal the
> >>> problem to you, or that the query in combination with the document an=
d
> >>> knowledge of which analyzers you are using will reveal the problem-
> >>>
> >>> Donna
> >>>
> >>>
> >>> Jan <fajerski@informatik.hu-berlin.de> wrote on 11/17/2010 11:47:49 A=
M:
> >>>
> >>> > [image removed]
> >>> >
> >>> > uncorrect results
> >>> >
> >>> > Jan
> >>> >
> >>> > to:
> >>> >
> >>> > java-user
> >>> >
> >>> > 11/17/2010 11:51 AM
> >>> >
> >>> > Please respond to java-user
> >>> >
> >>> > Hi,
> >>> > i have an assignment in my Text Analytics class. I am supposed to c=
reate
> >>> > an index and search it. The corpus is a PubMed-like XML file. it is
> >>> > possible to query terms (programcall a few terms) and phrases
> >>> > (programcall "a phrase").
> >>> > When a phrase is queried the program should answer how often the ph=
rase
> >>> > occured.
> >>> > The problem is, on certain queries the IndexSearcher returns some
> >>> > documents that do not have that particular query in its fields.
> >>> > I'd be delighted if someone could tell me what i am doing wrong.
> >>> > See the source code at my github repo
> >>> >
> >>> https://github.com/jangingnicht/TextAnalytics2/tree/master/src/textan=
alytics2/
> >>>
> >>> >
> >>> > Thanks in advance
> >>> > jan
> >>> >
> >>> > PS: I use Lucene 3.0.2 and the OpenJDK Runtime Environment (IcedTea=
6
> >>> > 1.8.2) on an 64 bit Linux machine.
> >>> > [attachment "signature.asc" deleted by Donna L Gresh/Watson/IBM]
> >>
> >>
> >
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


--=-eFyWPtEDEe5qe/t/svrw
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Dies ist ein digital signierter Nachrichtenteil

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEABECAAYFAkzldeoACgkQ0FiIQaGp0Nn06gCguMBiwWrLikacLHXfEZn+wy0U
IrwAnRC6AB/FLb1fEy8VlFh+mm/d0CPX
=dS6Q
-----END PGP SIGNATURE-----

--=-eFyWPtEDEe5qe/t/svrw--


From java-user-return-47852-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 00:09:38 2010
Return-Path: <java-user-return-47852-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 1548 invoked from network); 19 Nov 2010 00:09:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 00:09:38 -0000
Received: (qmail 39068 invoked by uid 500); 19 Nov 2010 00:10:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39034 invoked by uid 500); 19 Nov 2010 00:10:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39026 invoked by uid 99); 19 Nov 2010 00:10:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 00:10:03 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 00:09:58 +0000
Received: by gyf2 with SMTP id 2so2639702gyf.35
        for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 16:09:36 -0800 (PST)
Received: by 10.90.62.26 with SMTP id k26mr1643215aga.1.1290125376374;
        Thu, 18 Nov 2010 16:09:36 -0800 (PST)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id 66sm620845yhl.2.2010.11.18.16.09.34
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 18 Nov 2010 16:09:35 -0800 (PST)
Content-Type: text/plain; charset=utf-8
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
Date: Thu, 18 Nov 2010 16:09:29 -0800
Content-Transfer-Encoding: quoted-printable
Message-Id: <15F216C6-D9F0-4ED6-9429-41D9D3091AC3@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com> <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com> <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com> <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com> <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com> <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1082)

I finally bucked up and made the change to CheckIndex to verify that I =
do not, in fact, have any fields with norms in this index. The result is =
below - the largest segment currently is #3, which 300,000+ fields but =
no norms.

-Mark



Segments file=3Dsegments_acew numSegments=3D9 version=3DFORMAT_DIAGNOSTICS=
 [Lucene 2.9]
  1 of 9: name=3D_bfkv docCount=3D8642
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D7.921
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D1, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_bfkv_1.del]
    test: open reader.........OK [77 deleted docs]
    test: fields..............OK [114226 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [103996 terms; 926779 terms/docs pairs; =
919464 tokens]
    test: stored fields.......OK [202850 total field count; avg 23.684 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  2 of 9: name=3D_1gi5 docCount=3D0
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D1
    size (MB)=3D0.001
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D1, =
os.version=3D2.6.18-128.7.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    no deletions
    test: open reader.........OK
    test: fields..............OK [28 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [0 terms; 0 terms/docs pairs; 0 tokens]
    test: stored fields.......OK [0 total field count; avg =EF=BF=BD =
fields per doc]
    test: term vectors........OK [0 total vector count; avg =EF=BF=BD =
term/freq vector fields per doc]

  3 of 9: name=3D_bfkw docCount=3D6433351
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D3,969.392
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D10, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_bfkw_s7.del]
    test: open reader.........OK [89111 deleted docs]
    test: fields..............OK [308832 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [47362222 terms; 733184933 terms/docs =
pairs; 720556927 tokens]
    test: stored fields.......OK [186735038 total field count; avg =
29.434 fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  4 of 9: name=3D_bglk docCount=3D100296
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D83.448
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D10, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_bglk_1p.del]
    test: open reader.........OK [7027 deleted docs]
    test: fields..............OK [19192 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [1342162 terms; 13987377 terms/docs =
pairs; 13126384 tokens]
    test: stored fields.......OK [3713794 total field count; avg 39.818 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  5 of 9: name=3D_bglt docCount=3D3123
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D1.999
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D10, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_bglt_q.del]
    test: open reader.........OK [878 deleted docs]
    test: fields..............OK [911 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [28803 terms; 345429 terms/docs pairs; =
218626 tokens]
    test: stored fields.......OK [73229 total field count; avg 32.619 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  6 of 9: name=3D_bgme docCount=3D2339
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D1.704
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D10, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_bgme_h.del]
    test: open reader.........OK [329 deleted docs]
    test: fields..............OK [1122 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [30846 terms; 316451 terms/docs pairs; =
272709 tokens]
    test: stored fields.......OK [69847 total field count; avg 34.75 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  7 of 9: name=3D_bgnj docCount=3D2941
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D2
    size (MB)=3D2.2
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D10, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    has deletions [delFileName=3D_bgnj_d.del]
    test: open reader.........OK [527 deleted docs]
    test: fields..............OK [1846 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [42379 terms; 412630 terms/docs pairs; =
341300 tokens]
    test: stored fields.......OK [83805 total field count; avg 34.716 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  8 of 9: name=3D_bgo4 docCount=3D3899
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D1
    size (MB)=3D2.988
    diagnostics =3D {optimize=3Dfalse, mergeFactor=3D10, =
os.version=3D2.6.18-194.26.1.el5, os=3DLinux, mergeDocStores=3Dtrue, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dmerge, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    no deletions
    test: open reader.........OK
    test: fields..............OK [1367 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [52773 terms; 505461 terms/docs pairs; =
505461 tokens]
    test: stored fields.......OK [160630 total field count; avg 41.198 =
fields per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]

  9 of 9: name=3D_bgo5 docCount=3D4
    compound=3Dtrue
    hasProx=3Dtrue
    numFiles=3D1
    size (MB)=3D0.007
    diagnostics =3D {os.version=3D2.6.18-194.26.1.el5, os=3DLinux, =
lucene.version=3D3.0.0 883080 - 2009-11-22 15:43:58, source=3Dflush, =
os.arch=3Damd64, java.version=3D1.6.0_20, java.vendor=3DSun Microsystems =
Inc.}
    no deletions
    test: open reader.........OK
    test: fields..............OK [87 fields]
    test: field norms.........OK [0 fields]
    test: terms, freq, prox...OK [298 terms; 440 terms/docs pairs; 440 =
tokens]
    test: stored fields.......OK [95 total field count; avg 23.75 fields =
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq =
vector fields per doc]



On Nov 17, 2010, at 1:51 PM, Michael McCandless wrote:

> Lucene interns field names... since you have a truly enormous number
> of unique fields it's expected intern will be called alot.
>=20
> But that said it's odd that it's this costly.
>=20
> Can you post the stack traces that call intern?
>=20
> Mike
>=20
> On Fri, Nov 5, 2010 at 1:53 PM, Michael McCandless
> <lucene@mikemccandless.com> wrote:
>> Hmm...
>>=20
>> So, I was going on this output from your CheckIndex:
>>=20
>>   test: field norms.........OK [296713 fields]
>>=20
>> But in fact I just looked and that number is bogus -- it's always
>> equal to total number of fields, not number of fields with norms
>> enabled.  I'll open an issue to fix this, but in the meantime can you
>> apply this patch to your CheckIndex and run it again?
>>=20
>> Index: src/java/org/apache/lucene/index/CheckIndex.java
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision =
1031678)
>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working =
copy)
>> @@ -570,8 +570,10 @@
>>       }
>>       final byte[] b =3D new byte[reader.maxDoc()];
>>       for (final String fieldName : fieldNames) {
>> -        reader.norms(fieldName, b, 0);
>> -        ++status.totFields;
>> +        if (reader.hasNorms(fieldName)) {
>> +          reader.norms(fieldName, b, 0);
>> +          ++status.totFields;
>> +        }
>>       }
>>=20
>>       msg("OK [" + status.totFields + " fields]");
>>=20
>> So if in fact you have already disabled norms then something else is
>> the source of the sudden slowness.  Though, such a huge number of
>> unique field names is not an area of Lucene that's very well =
tested...
>> perhaps there's something silly somewhere.  Maybe you can try
>> profiling just the init of your IndexReader?  (Eg, run java with
>> -agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).
>>=20
>> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
>> as long as no document in the index ever had norms on (yes it does
>> "infect" heh).
>>=20
>> Mike
>>=20
>> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
>> <mark.kristensson@smartsheet.com> wrote:
>>> While most of our Lucene indexes are used for more traditional =
searching, this index in particular is used more like a reporting =
repository. Thus, we really do need to have that many fields indexed and =
they do need to be broken out into separate fields. There may be another =
way to structure the index to reduce the number of fields, but I'm =
hoping we can optimize the current design and avoid (yet another) index =
redesign.
>>>=20
>>> I'll look into the tweaking the merge policy, but I'm more =
interested in disabling norms because scoring really doesn't matter for =
us. Basically, we need nothing more than a binary answer from Lucene: =
either a record meets the provided criteria (which can be a rather =
complex boolean query with many subqueries) or it doesn't. If the record =
does match, then we get the IDs from lucene and run off to get the live =
data from our primary data store and sort it (in Java) based upon =
criteria provided by the user, not by score.
>>>=20
>>> After our initial design mushroomed in size, we redesigned and now =
(I thought) do not have norms on any of the fields in this index. So, =
I'm wondering if there was something in the results from the CheckIndex =
that I provided which indicates to you that we may have norms still =
enabled? I know that if you have norms on any one document's field, then =
any other document with that same field will get "infected" with norms =
as well.
>>>=20
>>> My understanding is that any field that uses the constants  =
Index.NOT_ANALYZED_NO_NORMS or  Index.NO will not  have norms on it, =
regardless of whether or not the field is stored. Is that not correct?
>>>=20
>>> Thanks,
>>> Mark
>>>=20
>>>=20
>>>=20
>>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>>>=20
>>>> Likely what happened is you had a bunch of smaller segments, and =
then
>>>> suddenly they got merged into that one big segment (_aiaz) in your
>>>> index.
>>>>=20
>>>> The representation for norms in particular is not sparse, so this
>>>> means the size of the norms file for a given segment will be
>>>> number-of-unique-indexed-fields X number-of-documents.
>>>>=20
>>>> So this count grows quadratically on merge.
>>>>=20
>>>> Do these fields really need to be indexed?   If so, it'd be better =
to
>>>> use a single field for all users for the indexable text if you can.
>>>>=20
>>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on =
the
>>>> merge policy; this'd prevent big segments from being produced.
>>>> Disabling norms should also workaround this, though that will =
affect
>>>> hit scores...
>>>>=20
>>>> Mike
>>>>=20
>>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>> Yes, we do have a large number of unique field names in that =
index, because they are driven by user named fields in our application =
(with some cleaning to remove illegal chars).
>>>>>=20
>>>>> This slowness problem has appeared very suddenly in the last =
couple of weeks and the number of unique field names has not spiked in =
the last few weeks. Have we crept over some threshold with our linear =
growth in the number of unique field names? Perhaps there is a limit =
driven by the amount of RAM in the machine that we are violating? Are =
there any guidelines for the maximum number, or suggested number, of =
unique fields names in an index or segment? Any suggestions for =
potentially mitigating the problem?
>>>>>=20
>>>>> Thanks,
>>>>> Mark
>>>>>=20
>>>>>=20
>>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>>>>=20
>>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>>>>=20
>>>>>>> I've run checkIndex against the index and the results are below. =
That net is that it's telling me nothing is wrong with the index.
>>>>>>=20
>>>>>> Thanks.
>>>>>>=20
>>>>>>> I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.
>>>>>>=20
>>>>>> IndexWriter opens a SegmentReader for each segment in the index, =
to
>>>>>> apply deletions, so I think this is the source of the slowness.
>>>>>>=20
>>>>>> =46rom the CheckIndex output, it looks like you have many =
(296,713)
>>>>>> unique fields names on that one large segment -- does that sound
>>>>>> right?  I suspect such a very high field count is the source of =
the
>>>>>> slowness...
>>>>>>=20
>>>>>> Mike
>>>>>>=20
>>>>>> =
---------------------------------------------------------------------
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>=20
>>>>>=20
>>>>>=20
>>>>> =
---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>=20
>>>>>=20
>>>>=20
>>>> =
---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>=20
>>>=20
>>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47853-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 06:58:13 2010
Return-Path: <java-user-return-47853-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73961 invoked from network); 19 Nov 2010 06:58:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 06:58:12 -0000
Received: (qmail 92398 invoked by uid 500); 19 Nov 2010 06:58:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92131 invoked by uid 500); 19 Nov 2010 06:58:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92118 invoked by uid 99); 19 Nov 2010 06:58:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 06:58:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of hossman_lucene@fucit.org designates 208.69.42.181 as permitted sender)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 06:58:33 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 4819E71C207; Thu, 18 Nov 2010 22:58:10 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id AB28071C13A
	for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 22:58:10 -0800 (PST)
Date: Thu, 18 Nov 2010 22:58:10 -0800 (PST)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: Solr 1.4.1 stats component count not matching facet count for
 multi valued field
In-Reply-To: <AANLkTikJ5+L8o=LtP-9ngA04jQY-6u80Vmwy8ZSQJ0Vq@mail.gmail.com>
Message-ID: <alpine.DEB.1.10.1011182256330.24300@radix.cryptio.net>
References: <AANLkTikJ5+L8o=LtP-9ngA04jQY-6u80Vmwy8ZSQJ0Vq@mail.gmail.com>
User-Agent: Alpine 1.10 (DEB 962 2008-03-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


1) i would suggest you use the solr-user mailing list for questions like 
this.

2) stats faceting has known bugs with multivalued *and* non string 
fields..

   https://issues.apache.org/jira/browse/SOLR-1782


-Hoss

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47854-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 07:06:42 2010
Return-Path: <java-user-return-47854-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83732 invoked from network); 19 Nov 2010 07:06:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 07:06:42 -0000
Received: (qmail 95685 invoked by uid 500); 19 Nov 2010 07:07:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95504 invoked by uid 500); 19 Nov 2010 07:07:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95496 invoked by uid 99); 19 Nov 2010 07:07:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 07:07:09 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of hossman_lucene@fucit.org designates 208.69.42.181 as permitted sender)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 07:07:03 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id B6F3971C21C; Thu, 18 Nov 2010 23:06:42 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id B2CDD71C137
	for <java-user@lucene.apache.org>; Thu, 18 Nov 2010 23:06:42 -0800 (PST)
Date: Thu, 18 Nov 2010 23:06:42 -0800 (PST)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: Lucene Users <java-user@lucene.apache.org>
Subject: Re: Jason format exception for stats component facet results | stddev
 value of NaN
In-Reply-To: <AANLkTinrpcFk11HqwRLe2cSeFyzwUO4CaF6iJpKR-Goo@mail.gmail.com>
Message-ID: <alpine.DEB.1.10.1011182303480.24300@radix.cryptio.net>
References: <AANLkTinrpcFk11HqwRLe2cSeFyzwUO4CaF6iJpKR-Goo@mail.gmail.com>
User-Agent: Alpine 1.10 (DEB 962 2008-03-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: I am getting a mal-formatted json response when using the
: stats component with a facet that returns a stddev value of NaN ,e.g

I'm not a JSON expert, but i suspect NaN just isn't legal JSON, and the 
JSON response writer has a bug.

quick google search...
http://stackoverflow.com/questions/1423081/json-left-out-infinity-and-nan-json-status-in-ecmascript
...suggests that the only valid value is "null"

please file a bug.

-Hoss

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47855-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 10:06:21 2010
Return-Path: <java-user-return-47855-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55094 invoked from network); 19 Nov 2010 10:06:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 10:06:21 -0000
Received: (qmail 87919 invoked by uid 500); 19 Nov 2010 10:06:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87669 invoked by uid 500); 19 Nov 2010 10:06:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87658 invoked by uid 99); 19 Nov 2010 10:06:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 10:06:47 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of trewig@mufin.com designates 195.214.216.124 as permitted sender)
Received: from [195.214.216.124] (HELO mx4.de.magix.net) (195.214.216.124)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 10:06:39 +0000
Received: from [192.168.1.18] (port=56070)
	by mx4.de.magix.net with esmtpa (Exim 4.69)
	(envelope-from <trewig@mufin.com>)
	id 1PJNrH-0007Cm-8G
	for java-user@lucene.apache.org; Fri, 19 Nov 2010 11:06:19 +0100
Message-ID: <4CE64C19.20004@mufin.com>
Date: Fri, 19 Nov 2010 11:06:17 +0100
From: Thomas Rewig <trewig@mufin.com>
Organization: mufin
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.9) Gecko/20100915 Thunderbird/3.1.4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Deleted File Handles - Index Writer
References: <4CDD1BCA.5000700@mufin.com>	<AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>	<4CE541F6.2040607@mufin.com> <AANLkTikgBM2gi+FjkJOm5DKZawPhn4PYQSoj6j=uVPCU@mail.gmail.com>
In-Reply-To: <AANLkTikgBM2gi+FjkJOm5DKZawPhn4PYQSoj6j=uVPCU@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------010900060902080909000309"
X-SA-Exim-Connect-IP: 192.168.1.18
X-SA-Exim-Mail-From: trewig@mufin.com
X-SA-Exim-Scanned: No (on mx4.de.magix.net); SAEximRunCond expanded to false
X-Virus-Checked: Checked by ClamAV on apache.org

--------------010900060902080909000309
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

  Hi.
>> If I set
>> writer.setUseCompoundFile(false);
>> than I see a short time the 35 handles and than it drops to zero.
> Hmm what's happening during that short time?  Do you have a reader open?
>
Yes after a commit has been initiated, a short time a reader is still 
open and that's ok. This behavior is therefore expected if I have 
understood all correctly.
>> If I do not use the compound file format as my new default until the new
>> version with the fix is available, what would be the disadvantages?
> The big issue with CFS turned off is you risk running out of file
> descriptors if you have too many segments in your index.  The exact
> limit is very OS dependent though, so if you're on an OS that's
> generous, and mergeFactor stays low, then you should be fine.
>
Ok I think the limit of file descriptors would be a problem ... there 
are 5 Liveindices.

At the moment I do not change the MergeFactor. So I think the 
DEFAULT_MERGE_FACTOR with 10 is used. The only thing I changed is:

writer = new IndexWriter(directory, analyzer, 
create,IndexWriter.MaxFieldLength.UNLIMITED);
writer.setRAMBufferSizeMB(48);

I think it is to risky to turn of the CFS, because I have no experience 
with MergeFactor and the number of descriptors 5 Liveindices will use.
At the moment it looks as if I does not bump with the current 
configuration into any limits, as long as I change the whole Index every 
week. I leave the settings with CFS and wait for the fix. Is there a way 
to patch the 3.0.2 Release version or have I wait for a future release?

Thanks for your help.
Thomas
Listen
Read phonetically


--------------010900060902080909000309--

From java-user-return-47856-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 10:46:29 2010
Return-Path: <java-user-return-47856-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67560 invoked from network); 19 Nov 2010 10:46:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 10:46:29 -0000
Received: (qmail 26817 invoked by uid 500); 19 Nov 2010 10:46:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26561 invoked by uid 500); 19 Nov 2010 10:46:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26547 invoked by uid 99); 19 Nov 2010 10:46:57 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 10:46:57 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 10:46:52 +0000
Received: by wyf19 with SMTP id 19so4506921wyf.35
        for <java-user@lucene.apache.org>; Fri, 19 Nov 2010 02:46:31 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.175.196 with SMTP id z46mr2045412wel.9.1290163590660; Fri,
 19 Nov 2010 02:46:30 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Fri, 19 Nov 2010 02:46:30 -0800 (PST)
In-Reply-To: <4CE64C19.20004@mufin.com>
References: <4CDD1BCA.5000700@mufin.com>
	<AANLkTikehTReVUVhMYZB=riCjrd-9+K_SzYrT=Ww3KYA@mail.gmail.com>
	<4CE541F6.2040607@mufin.com>
	<AANLkTikgBM2gi+FjkJOm5DKZawPhn4PYQSoj6j=uVPCU@mail.gmail.com>
	<4CE64C19.20004@mufin.com>
Date: Fri, 19 Nov 2010 05:46:30 -0500
Message-ID: <AANLkTikM=mucy_Q_WEKxvfy0jrq8rztV35MeDykijkGJ@mail.gmail.com>
Subject: Re: Deleted File Handles - Index Writer
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Fri, Nov 19, 2010 at 5:06 AM, Thomas Rewig <trewig@mufin.com> wrote:
> =A0Hi.
>>>
>>> If I set
>>> writer.setUseCompoundFile(false);
>>> than I see a short time the 35 handles and than it drops to zero.
>>
>> Hmm what's happening during that short time? =A0Do you have a reader ope=
n?
>>
> Yes after a commit has been initiated, a short time a reader is still ope=
n
> and that's ok. This behavior is therefore expected if I have understood a=
ll
> correctly.

OK excellent.

>>>
>>> If I do not use the compound file format as my new default until the ne=
w
>>> version with the fix is available, what would be the disadvantages?
>>
>> The big issue with CFS turned off is you risk running out of file
>> descriptors if you have too many segments in your index. =A0The exact
>> limit is very OS dependent though, so if you're on an OS that's
>> generous, and mergeFactor stays low, then you should be fine.
>>
> Ok I think the limit of file descriptors would be a problem ... there are=
 5
> Liveindices.
>
> At the moment I do not change the MergeFactor. So I think the
> DEFAULT_MERGE_FACTOR with 10 is used. The only thing I changed is:
>
> writer =3D new IndexWriter(directory, analyzer,
> create,IndexWriter.MaxFieldLength.UNLIMITED);
> writer.setRAMBufferSizeMB(48);
>
> I think it is to risky to turn of the CFS, because I have no experience w=
ith
> MergeFactor and the number of descriptors 5 Liveindices will use.
> At the moment it looks as if I does not bump with the current configurati=
on
> into any limits, as long as I change the whole Index every week. I leave =
the
> settings with CFS and wait for the fix.

Likely you'd be fine with no CFS, but I understand the risk
aversion... it's a lesser of evils situation.

The open but deleted file limit is bounded by the number of segments
in the index.

> Is there a way to patch the 3.0.2
> Release version or have I wait for a future release?

I haven't yet committed the fix... when I do (soon!), I'll backport to
3.0.x and 2.9.x, and then you can just get a source checkout of that
branch and build the JAR from it, eg:

  svn checkout https://svn.apache.org/repos/asf/lucene/java/branches/lucene=
_3_0
  cd lucene_3_0
  ant jar
  cp build/lucene-core-3.0.3-dev.jar /path/to/your/lucene/jar

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47857-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 12:40:34 2010
Return-Path: <java-user-return-47857-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23077 invoked from network); 19 Nov 2010 12:40:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 12:40:33 -0000
Received: (qmail 22271 invoked by uid 500); 19 Nov 2010 12:41:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22017 invoked by uid 500); 19 Nov 2010 12:41:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21987 invoked by uid 99); 19 Nov 2010 12:41:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 12:41:01 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of itsadok@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 12:40:55 +0000
Received: by wyf19 with SMTP id 19so4622585wyf.35
        for <java-user@lucene.apache.org>; Fri, 19 Nov 2010 04:40:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=1iSt8OHWsqDiyOIXSF5IdhwX/MymYp/wSA61jZa0seY=;
        b=MAiMQtCvhYEyTveiYQZtA28pJLriXetiflblvAB6Tfx/ToLhaPQhzQgHC+BN84ofZH
         lFp8YnJFBc5MoRU1ogiCa42u93r6S11U3+Zjg4fjgZ3/zf3oY4raClwOO1d4TkKyTMrg
         LJxYMNRNfJJleRVYfZ80+bvffplSFImeLFpgg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=wyv5bH/rnf9UbDcbCbiqGGPhScqNApJ2UPjHC7QQVX7cWZm1ColdcMUC9jVlF+aG39
         /n0NEJkEhYEJDBmHsoDLqGYSB3PiDkKepVvMTi4UWqYSuE3eFhX1/0f5Uuxtt6vl7XlK
         E2um+5fn537vQGdLCifid8WFI5tONJ+3wcGHg=
Received: by 10.227.144.20 with SMTP id x20mr2156973wbu.134.1290170433860;
 Fri, 19 Nov 2010 04:40:33 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.68.193 with HTTP; Fri, 19 Nov 2010 04:40:13 -0800 (PST)
In-Reply-To: <AANLkTinDL+dRwqS7+B0VhpqfXzrMfzJab9T+KCLpiEw+@mail.gmail.com>
References: <AANLkTinDL+dRwqS7+B0VhpqfXzrMfzJab9T+KCLpiEw+@mail.gmail.com>
From: Israel Tsadok <itsadok@gmail.com>
Date: Fri, 19 Nov 2010 14:40:13 +0200
Message-ID: <AANLkTi=vCjWqg+KtCQkCQi6kojqc2p1RhE9Z1fjpdY_+@mail.gmail.com>
Subject: Re: How to combine QueryParser and Wildcard search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363ba60868f3eb04956736f1

--0016363ba60868f3eb04956736f1
Content-Type: text/plain; charset=ISO-8859-1

I'm not sure what you're trying to do, but it seems to me that your best bet
is to rewrite the query returned from the QueryParser. Just traverse the
BooleanQuery clauses, converting any TermQuery to a WildcardQuery. You can
then have control over what transformation exactly you want to perform.

Israel


On Thu, Nov 18, 2010 at 5:36 PM, Pulkit Singhal <pulkitsinghal@gmail.com>wrote:

> Hello,
>
> I was wondering if there is any API call in Lucene that allows
> something like the following:
>
> Step 1: Take the user input
> "hello world" you are beautiful
>
> Step 2: QueryParser does its thing
> defaultField:hello world defaultField:you defaultField:are
> defaultField:beautiful
>
> Step 3: And somehow a desired transformation like the following one is
> the next thing to happen:
> defaultField:hello world defaultField:you* defaultField:are*
> defaultField:beautiful*
>
> How can I tell QueryParser to throw in the wildcard "*" expression
> where applicable?
>
> You can see that I'm not expecting it to use "*" with something that
> will turn into a phrase query:
> "hello world" becomes defaultField:hello world
> Just the rest of the tokens:
> defaultField:you* defaultField:are* defaultField:beautiful*
>
> Thanks!
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016363ba60868f3eb04956736f1--

From java-user-return-47858-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 19:09:10 2010
Return-Path: <java-user-return-47858-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45443 invoked from network); 19 Nov 2010 19:09:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 19:09:10 -0000
Received: (qmail 83243 invoked by uid 500); 19 Nov 2010 19:09:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83187 invoked by uid 500); 19 Nov 2010 19:09:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83179 invoked by uid 99); 19 Nov 2010 19:09:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 19:09:35 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of adrianocrestani@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 19:09:29 +0000
Received: by wyf19 with SMTP id 19so5025032wyf.35
        for <java-user@lucene.apache.org>; Fri, 19 Nov 2010 11:09:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=lnj6QBZEnZpoM66qZMoMAdh1xENeJPMjMfrJ2cZogow=;
        b=bA3F9jiWbISRza7B8Y+JAeiW1D3QHN2MRWdeuCuFlbySlvOAzzS3BU1L3DMoHFx5Fl
         03o/ON6EK0t8gjqup9UMkS1e0JfEpFB/jihL7BjvDqdfEbdaj9ArdKFuvF7LZqLzhRP8
         ZiFyF90zW0/XJBJ2UMpVohQUNEBZPK1Y0Uy+s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=aNgWYNDxFMua7BXVqBRo/IQ8Mzr09qSgei9xa8rb/3RltmZWmpaNI1TAjJcV0WKKe0
         38Jupt780l7BBmnLVRQRljplReiri2UAEB2Q4zEd8YlNJc97/fLoN5nDH7x6I1QtvBcu
         QYh/mpE3pwYsaohbe3sOGKbAZE9BA3t/Mu1hE=
Received: by 10.216.87.20 with SMTP id x20mr1298371wee.52.1290193738983; Fri,
 19 Nov 2010 11:08:58 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.85.131 with HTTP; Fri, 19 Nov 2010 11:08:38 -0800 (PST)
In-Reply-To: <AANLkTi=vCjWqg+KtCQkCQi6kojqc2p1RhE9Z1fjpdY_+@mail.gmail.com>
References: <AANLkTinDL+dRwqS7+B0VhpqfXzrMfzJab9T+KCLpiEw+@mail.gmail.com> <AANLkTi=vCjWqg+KtCQkCQi6kojqc2p1RhE9Z1fjpdY_+@mail.gmail.com>
From: Adriano Crestani <adrianocrestani@gmail.com>
Date: Fri, 19 Nov 2010 16:08:38 -0300
Message-ID: <AANLkTi=TttSeBRj=MVyMCHxxbRZ=j3czYYYt8ApDajeV@mail.gmail.com>
Subject: Re: How to combine QueryParser and Wildcard search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d976fb80e82204956ca347

--0016e6d976fb80e82204956ca347
Content-Type: text/plain; charset=ISO-8859-1

Hi Pulkit,

In case you are using the standard contrib query parser (equivalent to
lucence QP), you may want to create a QueryNodeProcessor, that will convert
TermQueryNodes to WildcardQueryNodes, and attach it to the processor
pipeline:

StandardQueryParser qp = new StandardQueryParser();
((QueryNodeProcessorPipeline) qp.getQueryNodeProcessor()).add(new
MyQueryNodeProcessor());

// qp is ready for use


Please, let me know if you have any question about how to implement your own
QueryNodeProcessor.

Regards,
Adriano Crestani

On Fri, Nov 19, 2010 at 9:40 AM, Israel Tsadok <itsadok@gmail.com> wrote:

> I'm not sure what you're trying to do, but it seems to me that your best
> bet
> is to rewrite the query returned from the QueryParser. Just traverse the
> BooleanQuery clauses, converting any TermQuery to a WildcardQuery. You can
> then have control over what transformation exactly you want to perform.
>
> Israel
>
>
> On Thu, Nov 18, 2010 at 5:36 PM, Pulkit Singhal <pulkitsinghal@gmail.com
> >wrote:
>
> > Hello,
> >
> > I was wondering if there is any API call in Lucene that allows
> > something like the following:
> >
> > Step 1: Take the user input
> > "hello world" you are beautiful
> >
> > Step 2: QueryParser does its thing
> > defaultField:hello world defaultField:you defaultField:are
> > defaultField:beautiful
> >
> > Step 3: And somehow a desired transformation like the following one is
> > the next thing to happen:
> > defaultField:hello world defaultField:you* defaultField:are*
> > defaultField:beautiful*
> >
> > How can I tell QueryParser to throw in the wildcard "*" expression
> > where applicable?
> >
> > You can see that I'm not expecting it to use "*" with something that
> > will turn into a phrase query:
> > "hello world" becomes defaultField:hello world
> > Just the rest of the tokens:
> > defaultField:you* defaultField:are* defaultField:beautiful*
> >
> > Thanks!
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>

--0016e6d976fb80e82204956ca347--

From java-user-return-47859-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 19 22:41:59 2010
Return-Path: <java-user-return-47859-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39520 invoked from network); 19 Nov 2010 22:41:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 19 Nov 2010 22:41:59 -0000
Received: (qmail 45366 invoked by uid 500); 19 Nov 2010 22:42:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45298 invoked by uid 500); 19 Nov 2010 22:42:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45290 invoked by uid 99); 19 Nov 2010 22:42:28 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 22:42:28 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 19 Nov 2010 22:42:23 +0000
Received: by gyf2 with SMTP id 2so3488872gyf.35
        for <java-user@lucene.apache.org>; Fri, 19 Nov 2010 14:42:02 -0800 (PST)
Received: by 10.150.228.12 with SMTP id a12mr4354971ybh.313.1290206521149;
        Fri, 19 Nov 2010 14:42:01 -0800 (PST)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id q8sm117971ybk.12.2010.11.19.14.41.58
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 19 Nov 2010 14:41:59 -0800 (PST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
Date: Fri, 19 Nov 2010 14:41:53 -0800
Content-Transfer-Encoding: quoted-printable
Message-Id: <50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com> <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com> <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com> <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com> <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com> <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1082)

My findings from the hprof results which showed 80% of the CPU time =
being in String.intern() led me to do some reading about String.intern() =
and what I found surprised me.

First, there are some very strong feelings about String.intern() and its =
value. First, is this guy =
(http://www.codeinstructions.com/2009/01/busting-javalangstringintern-myth=
s.html) who doesn't have much good to say about it. This guy =
(http://kohlerm.blogspot.com/2009/01/is-javalangstringintern-really-evil.h=
tml) responds to the key points, but acknowledges there are some issues =
with it. The net, to me, is that using String.intern() has some =
potential performance benefits IF you KNOW that the set of strings you =
are intern-ing will be small. If the set is large...watch out. The one =
element that has me especially worried is that intern-ing a String leads =
to it getting stored in PermGen space.

=46rom what I've read, the main reasons to intern a string are 1) =
comparison performance and 2) uniqueness (including having a single =
instance of the String). In looking at the source code for =
org.apache.lucene.util.StringHelper, StringInterner and =
SimpleStringInterner it appears that the primary reason for intern-ing =
strings in Lucene is for uniqueness (but that's just a guess). So, I =
decided to try tackling the uniqueness problem a different way: HashMap! =
I modified StringHelper to use a static instance of a HashMap instead of =
SimpleStringInterner just to see if it would make any difference.=20

Much to my surprise, the change was very easy to make (see below) and =
(for the IndexReader.open) massively improved the performance of opening =
my large, problematic index. Instead of taking nearly 10 seconds to open =
the index on one of our lab servers, it takes only a couple of seconds =
for this index which has over 300,000 field names.

Now, there are a lot of caveats to this test
1) Right now, I'm only testing a tiny little bit of even my own =
application's usage of Lucene, so I have no idea what the large impact =
of this change will be on my own app
2) I really am guessing at the reasons for intern-ing the Strings. I'm =
going to keep digging through source code to see where else StringHelper =
is used and how it is used, but I'm not going to be an expert on this =
code any time soon.

Finally, this seems to address the issues I'm having opening =
IndexReaders against this index, but I have not been able to repro the =
IndexWriter.close() slowness that initially  led me down this path in my =
test app (though I can repro them our lab with our full app).

Here's the changes I made to org.apache.lucene.util.StringHelper:

  //public static StringInterner interner =3D new =
SimpleStringInterner(1024,8);
  public static HashMap<Integer, String> uniqueStrings =3D new =
HashMap<Integer, String>();

  /** Return the same string object for all equal strings */
  public static String intern(String s) {
//    return interner.intern(s);
    int h =3D s.hashCode();
    if (!uniqueStrings.containsKey(h)) {
     	uniqueStrings.put(h, s);
    }
    return uniqueStrings.get(h);
  }



On Nov 17, 2010, at 1:51 PM, Michael McCandless wrote:

> Lucene interns field names... since you have a truly enormous number
> of unique fields it's expected intern will be called alot.
>=20
> But that said it's odd that it's this costly.
>=20
> Can you post the stack traces that call intern?
>=20
> Mike
>=20
> On Fri, Nov 5, 2010 at 1:53 PM, Michael McCandless
> <lucene@mikemccandless.com> wrote:
>> Hmm...
>>=20
>> So, I was going on this output from your CheckIndex:
>>=20
>>   test: field norms.........OK [296713 fields]
>>=20
>> But in fact I just looked and that number is bogus -- it's always
>> equal to total number of fields, not number of fields with norms
>> enabled.  I'll open an issue to fix this, but in the meantime can you
>> apply this patch to your CheckIndex and run it again?
>>=20
>> Index: src/java/org/apache/lucene/index/CheckIndex.java
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision =
1031678)
>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working =
copy)
>> @@ -570,8 +570,10 @@
>>       }
>>       final byte[] b =3D new byte[reader.maxDoc()];
>>       for (final String fieldName : fieldNames) {
>> -        reader.norms(fieldName, b, 0);
>> -        ++status.totFields;
>> +        if (reader.hasNorms(fieldName)) {
>> +          reader.norms(fieldName, b, 0);
>> +          ++status.totFields;
>> +        }
>>       }
>>=20
>>       msg("OK [" + status.totFields + " fields]");
>>=20
>> So if in fact you have already disabled norms then something else is
>> the source of the sudden slowness.  Though, such a huge number of
>> unique field names is not an area of Lucene that's very well =
tested...
>> perhaps there's something silly somewhere.  Maybe you can try
>> profiling just the init of your IndexReader?  (Eg, run java with
>> -agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).
>>=20
>> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
>> as long as no document in the index ever had norms on (yes it does
>> "infect" heh).
>>=20
>> Mike
>>=20
>> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
>> <mark.kristensson@smartsheet.com> wrote:
>>> While most of our Lucene indexes are used for more traditional =
searching, this index in particular is used more like a reporting =
repository. Thus, we really do need to have that many fields indexed and =
they do need to be broken out into separate fields. There may be another =
way to structure the index to reduce the number of fields, but I'm =
hoping we can optimize the current design and avoid (yet another) index =
redesign.
>>>=20
>>> I'll look into the tweaking the merge policy, but I'm more =
interested in disabling norms because scoring really doesn't matter for =
us. Basically, we need nothing more than a binary answer from Lucene: =
either a record meets the provided criteria (which can be a rather =
complex boolean query with many subqueries) or it doesn't. If the record =
does match, then we get the IDs from lucene and run off to get the live =
data from our primary data store and sort it (in Java) based upon =
criteria provided by the user, not by score.
>>>=20
>>> After our initial design mushroomed in size, we redesigned and now =
(I thought) do not have norms on any of the fields in this index. So, =
I'm wondering if there was something in the results from the CheckIndex =
that I provided which indicates to you that we may have norms still =
enabled? I know that if you have norms on any one document's field, then =
any other document with that same field will get "infected" with norms =
as well.
>>>=20
>>> My understanding is that any field that uses the constants  =
Index.NOT_ANALYZED_NO_NORMS or  Index.NO will not  have norms on it, =
regardless of whether or not the field is stored. Is that not correct?
>>>=20
>>> Thanks,
>>> Mark
>>>=20
>>>=20
>>>=20
>>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>>>=20
>>>> Likely what happened is you had a bunch of smaller segments, and =
then
>>>> suddenly they got merged into that one big segment (_aiaz) in your
>>>> index.
>>>>=20
>>>> The representation for norms in particular is not sparse, so this
>>>> means the size of the norms file for a given segment will be
>>>> number-of-unique-indexed-fields X number-of-documents.
>>>>=20
>>>> So this count grows quadratically on merge.
>>>>=20
>>>> Do these fields really need to be indexed?   If so, it'd be better =
to
>>>> use a single field for all users for the indexable text if you can.
>>>>=20
>>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on =
the
>>>> merge policy; this'd prevent big segments from being produced.
>>>> Disabling norms should also workaround this, though that will =
affect
>>>> hit scores...
>>>>=20
>>>> Mike
>>>>=20
>>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>> Yes, we do have a large number of unique field names in that =
index, because they are driven by user named fields in our application =
(with some cleaning to remove illegal chars).
>>>>>=20
>>>>> This slowness problem has appeared very suddenly in the last =
couple of weeks and the number of unique field names has not spiked in =
the last few weeks. Have we crept over some threshold with our linear =
growth in the number of unique field names? Perhaps there is a limit =
driven by the amount of RAM in the machine that we are violating? Are =
there any guidelines for the maximum number, or suggested number, of =
unique fields names in an index or segment? Any suggestions for =
potentially mitigating the problem?
>>>>>=20
>>>>> Thanks,
>>>>> Mark
>>>>>=20
>>>>>=20
>>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>>>>>=20
>>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>>>>>> <mark.kristensson@smartsheet.com> wrote:
>>>>>>>=20
>>>>>>> I've run checkIndex against the index and the results are below. =
That net is that it's telling me nothing is wrong with the index.
>>>>>>=20
>>>>>> Thanks.
>>>>>>=20
>>>>>>> I did not have any instrumentation around the opening of the =
IndexSearcher (we don't use an IndexReader), just around the actual =
query execution so I had to add some additional logging. What I found =
surprised me, opening a search against this index takes the same 6 to 8 =
seconds that closing the indexWriter takes.
>>>>>>=20
>>>>>> IndexWriter opens a SegmentReader for each segment in the index, =
to
>>>>>> apply deletions, so I think this is the source of the slowness.
>>>>>>=20
>>>>>> =46rom the CheckIndex output, it looks like you have many =
(296,713)
>>>>>> unique fields names on that one large segment -- does that sound
>>>>>> right?  I suspect such a very high field count is the source of =
the
>>>>>> slowness...
>>>>>>=20
>>>>>> Mike
>>>>>>=20
>>>>>> =
---------------------------------------------------------------------
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>=20
>>>>>=20
>>>>>=20
>>>>> =
---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>=20
>>>>>=20
>>>>=20
>>>> =
---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>=20
>>>=20
>>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47860-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 20 05:10:58 2010
Return-Path: <java-user-return-47860-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95560 invoked from network); 20 Nov 2010 05:10:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Nov 2010 05:10:57 -0000
Received: (qmail 38362 invoked by uid 500); 20 Nov 2010 05:11:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38105 invoked by uid 500); 20 Nov 2010 05:11:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38097 invoked by uid 99); 20 Nov 2010 05:11:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 20 Nov 2010 05:11:25 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 209.85.210.48 as permitted sender)
Received: from [209.85.210.48] (HELO mail-pz0-f48.google.com) (209.85.210.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 20 Nov 2010 05:11:18 +0000
Received: by pzk35 with SMTP id 35so1447878pzk.35
        for <java-user@lucene.apache.org>; Fri, 19 Nov 2010 21:10:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=HaysKpUQ9DdWX8jozAgFqEIkyH/Nm7Xrzs4UdB/GKtA=;
        b=MWRdGkCj79IazwDSA/+SLRrgEwyGPXclUgDmATEY3U/nsO7SdQkAHOiaRVvXH/IBPa
         +FLR0JEvuFiaCCE6PxD4oDuxSzfL83AjwCD8R5Xor3wfSNBwP5hkso5BHLRg9L1l/NLH
         O3KWR8o/2YgDObiCseq0ZDP9kfZFO8+SHNlEY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VLzNSlyCdv2xGDmJCCJm/XoS5CSkyHqtEhDaLKxUihoLS1lY0YUdfXk9F3tvj+lqpx
         HLyX1xTSkZ7Kcls0uYNnzFxgO6EGY9xqSYmZ9VQtfB3eBIotmmPoInyYcBraRFnwLqdm
         Q+IaiSIgMkTXk9M713YgMuCbUic2VUQ/HfLMc=
MIME-Version: 1.0
Received: by 10.142.158.8 with SMTP id g8mr2513253wfe.281.1290229856942; Fri,
 19 Nov 2010 21:10:56 -0800 (PST)
Received: by 10.142.229.21 with HTTP; Fri, 19 Nov 2010 21:10:56 -0800 (PST)
In-Reply-To: <50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
	<AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
	<ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
	<AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
	<1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
	<AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
	<AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
	<50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com>
Date: Sat, 20 Nov 2010 07:10:56 +0200
Message-ID: <AANLkTi=ig_xTsCFj13eVLdfH6JBdz+m9-0jxdF4kzu1u@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd181be4d3c550495750c04
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd181be4d3c550495750c04
Content-Type: text/plain; charset=ISO-8859-1

I actually think that the main reason for interning the field names in
Lucene is for comparison purposes and not to guarantee uniqueness (though
you get both). You will see many places in the Lucene's code where the field
name is compared using != operator instead of equals.

BTW, in your patch above, you use the hashCode as the key, which for Strings
is a bad idea especially if they are not all ASCII - Java's hashCode is
32-bit which is very bad -- you'll hit collisions very fast. I once counted
1M collisions on 100M ASCII words and even more when non-ASCII text was
involved.

Shai

On Sat, Nov 20, 2010 at 12:41 AM, Mark Kristensson <
mark.kristensson@smartsheet.com> wrote:

> My findings from the hprof results which showed 80% of the CPU time being
> in String.intern() led me to do some reading about String.intern() and what
> I found surprised me.
>
> First, there are some very strong feelings about String.intern() and its
> value. First, is this guy (
> http://www.codeinstructions.com/2009/01/busting-javalangstringintern-myths.html)
> who doesn't have much good to say about it. This guy (
> http://kohlerm.blogspot.com/2009/01/is-javalangstringintern-really-evil.html)
> responds to the key points, but acknowledges there are some issues with it.
> The net, to me, is that using String.intern() has some potential performance
> benefits IF you KNOW that the set of strings you are intern-ing will be
> small. If the set is large...watch out. The one element that has me
> especially worried is that intern-ing a String leads to it getting stored in
> PermGen space.
>
> From what I've read, the main reasons to intern a string are 1) comparison
> performance and 2) uniqueness (including having a single instance of the
> String). In looking at the source code for
> org.apache.lucene.util.StringHelper, StringInterner and SimpleStringInterner
> it appears that the primary reason for intern-ing strings in Lucene is for
> uniqueness (but that's just a guess). So, I decided to try tackling the
> uniqueness problem a different way: HashMap! I modified StringHelper to use
> a static instance of a HashMap instead of SimpleStringInterner just to see
> if it would make any difference.
>
> Much to my surprise, the change was very easy to make (see below) and (for
> the IndexReader.open) massively improved the performance of opening my
> large, problematic index. Instead of taking nearly 10 seconds to open the
> index on one of our lab servers, it takes only a couple of seconds for this
> index which has over 300,000 field names.
>
> Now, there are a lot of caveats to this test
> 1) Right now, I'm only testing a tiny little bit of even my own
> application's usage of Lucene, so I have no idea what the large impact of
> this change will be on my own app
> 2) I really am guessing at the reasons for intern-ing the Strings. I'm
> going to keep digging through source code to see where else StringHelper is
> used and how it is used, but I'm not going to be an expert on this code any
> time soon.
>
> Finally, this seems to address the issues I'm having opening IndexReaders
> against this index, but I have not been able to repro the
> IndexWriter.close() slowness that initially  led me down this path in my
> test app (though I can repro them our lab with our full app).
>
> Here's the changes I made to org.apache.lucene.util.StringHelper:
>
>  //public static StringInterner interner = new
> SimpleStringInterner(1024,8);
>  public static HashMap<Integer, String> uniqueStrings = new
> HashMap<Integer, String>();
>
>  /** Return the same string object for all equal strings */
>  public static String intern(String s) {
> //    return interner.intern(s);
>    int h = s.hashCode();
>    if (!uniqueStrings.containsKey(h)) {
>        uniqueStrings.put(h, s);
>    }
>    return uniqueStrings.get(h);
>  }
>
>
>
> On Nov 17, 2010, at 1:51 PM, Michael McCandless wrote:
>
> > Lucene interns field names... since you have a truly enormous number
> > of unique fields it's expected intern will be called alot.
> >
> > But that said it's odd that it's this costly.
> >
> > Can you post the stack traces that call intern?
> >
> > Mike
> >
> > On Fri, Nov 5, 2010 at 1:53 PM, Michael McCandless
> > <lucene@mikemccandless.com> wrote:
> >> Hmm...
> >>
> >> So, I was going on this output from your CheckIndex:
> >>
> >>   test: field norms.........OK [296713 fields]
> >>
> >> But in fact I just looked and that number is bogus -- it's always
> >> equal to total number of fields, not number of fields with norms
> >> enabled.  I'll open an issue to fix this, but in the meantime can you
> >> apply this patch to your CheckIndex and run it again?
> >>
> >> Index: src/java/org/apache/lucene/index/CheckIndex.java
> >> ===================================================================
> >> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
> 1031678)
> >> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working copy)
> >> @@ -570,8 +570,10 @@
> >>       }
> >>       final byte[] b = new byte[reader.maxDoc()];
> >>       for (final String fieldName : fieldNames) {
> >> -        reader.norms(fieldName, b, 0);
> >> -        ++status.totFields;
> >> +        if (reader.hasNorms(fieldName)) {
> >> +          reader.norms(fieldName, b, 0);
> >> +          ++status.totFields;
> >> +        }
> >>       }
> >>
> >>       msg("OK [" + status.totFields + " fields]");
> >>
> >> So if in fact you have already disabled norms then something else is
> >> the source of the sudden slowness.  Though, such a huge number of
> >> unique field names is not an area of Lucene that's very well tested...
> >> perhaps there's something silly somewhere.  Maybe you can try
> >> profiling just the init of your IndexReader?  (Eg, run java with
> >> -agentlib:hprof=cpu=samples,depth=16,interval=1).
> >>
> >> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
> >> as long as no document in the index ever had norms on (yes it does
> >> "infect" heh).
> >>
> >> Mike
> >>
> >> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
> >> <mark.kristensson@smartsheet.com> wrote:
> >>> While most of our Lucene indexes are used for more traditional
> searching, this index in particular is used more like a reporting
> repository. Thus, we really do need to have that many fields indexed and
> they do need to be broken out into separate fields. There may be another way
> to structure the index to reduce the number of fields, but I'm hoping we can
> optimize the current design and avoid (yet another) index redesign.
> >>>
> >>> I'll look into the tweaking the merge policy, but I'm more interested
> in disabling norms because scoring really doesn't matter for us. Basically,
> we need nothing more than a binary answer from Lucene: either a record meets
> the provided criteria (which can be a rather complex boolean query with many
> subqueries) or it doesn't. If the record does match, then we get the IDs
> from lucene and run off to get the live data from our primary data store and
> sort it (in Java) based upon criteria provided by the user, not by score.
> >>>
> >>> After our initial design mushroomed in size, we redesigned and now (I
> thought) do not have norms on any of the fields in this index. So, I'm
> wondering if there was something in the results from the CheckIndex that I
> provided which indicates to you that we may have norms still enabled? I know
> that if you have norms on any one document's field, then any other document
> with that same field will get "infected" with norms as well.
> >>>
> >>> My understanding is that any field that uses the constants
>  Index.NOT_ANALYZED_NO_NORMS or  Index.NO will not  have norms on it,
> regardless of whether or not the field is stored. Is that not correct?
> >>>
> >>> Thanks,
> >>> Mark
> >>>
> >>>
> >>>
> >>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
> >>>
> >>>> Likely what happened is you had a bunch of smaller segments, and then
> >>>> suddenly they got merged into that one big segment (_aiaz) in your
> >>>> index.
> >>>>
> >>>> The representation for norms in particular is not sparse, so this
> >>>> means the size of the norms file for a given segment will be
> >>>> number-of-unique-indexed-fields X number-of-documents.
> >>>>
> >>>> So this count grows quadratically on merge.
> >>>>
> >>>> Do these fields really need to be indexed?   If so, it'd be better to
> >>>> use a single field for all users for the indexable text if you can.
> >>>>
> >>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on the
> >>>> merge policy; this'd prevent big segments from being produced.
> >>>> Disabling norms should also workaround this, though that will affect
> >>>> hit scores...
> >>>>
> >>>> Mike
> >>>>
> >>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
> >>>> <mark.kristensson@smartsheet.com> wrote:
> >>>>> Yes, we do have a large number of unique field names in that index,
> because they are driven by user named fields in our application (with some
> cleaning to remove illegal chars).
> >>>>>
> >>>>> This slowness problem has appeared very suddenly in the last couple
> of weeks and the number of unique field names has not spiked in the last few
> weeks. Have we crept over some threshold with our linear growth in the
> number of unique field names? Perhaps there is a limit driven by the amount
> of RAM in the machine that we are violating? Are there any guidelines for
> the maximum number, or suggested number, of unique fields names in an index
> or segment? Any suggestions for potentially mitigating the problem?
> >>>>>
> >>>>> Thanks,
> >>>>> Mark
> >>>>>
> >>>>>
> >>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
> >>>>>
> >>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
> >>>>>> <mark.kristensson@smartsheet.com> wrote:
> >>>>>>>
> >>>>>>> I've run checkIndex against the index and the results are below.
> That net is that it's telling me nothing is wrong with the index.
> >>>>>>
> >>>>>> Thanks.
> >>>>>>
> >>>>>>> I did not have any instrumentation around the opening of the
> IndexSearcher (we don't use an IndexReader), just around the actual query
> execution so I had to add some additional logging. What I found surprised
> me, opening a search against this index takes the same 6 to 8 seconds that
> closing the indexWriter takes.
> >>>>>>
> >>>>>> IndexWriter opens a SegmentReader for each segment in the index, to
> >>>>>> apply deletions, so I think this is the source of the slowness.
> >>>>>>
> >>>>>> From the CheckIndex output, it looks like you have many (296,713)
> >>>>>> unique fields names on that one large segment -- does that sound
> >>>>>> right?  I suspect such a very high field count is the source of the
> >>>>>> slowness...
> >>>>>>
> >>>>>> Mike
> >>>>>>
> >>>>>>
> ---------------------------------------------------------------------
> >>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>>>
> >>>>>
> >>>>>
> >>>>> ---------------------------------------------------------------------
> >>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>>
> >>>>>
> >>>>
> >>>> ---------------------------------------------------------------------
> >>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>
> >>>
> >>>
> >>
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd181be4d3c550495750c04--

From java-user-return-47861-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 20 10:05:22 2010
Return-Path: <java-user-return-47861-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9209 invoked from network); 20 Nov 2010 10:05:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Nov 2010 10:05:22 -0000
Received: (qmail 40022 invoked by uid 500); 20 Nov 2010 10:05:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39710 invoked by uid 500); 20 Nov 2010 10:05:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39702 invoked by uid 99); 20 Nov 2010 10:05:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 20 Nov 2010 10:05:49 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 20 Nov 2010 10:05:43 +0000
Received: by wwb39 with SMTP id 39so5594141wwb.5
        for <java-user@lucene.apache.org>; Sat, 20 Nov 2010 02:05:22 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.44.208 with SMTP id n58mr403462web.39.1290247521760; Sat,
 20 Nov 2010 02:05:21 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Sat, 20 Nov 2010 02:05:21 -0800 (PST)
In-Reply-To: <AANLkTi=ig_xTsCFj13eVLdfH6JBdz+m9-0jxdF4kzu1u@mail.gmail.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
	<AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
	<ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
	<AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
	<1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
	<AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
	<AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
	<50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com>
	<AANLkTi=ig_xTsCFj13eVLdfH6JBdz+m9-0jxdF4kzu1u@mail.gmail.com>
Date: Sat, 20 Nov 2010 05:05:21 -0500
Message-ID: <AANLkTikmys6Pd37uKjVCpGTZfhCVm7k0WFQgC5ff+oaS@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Also, you'd have to synchronize access to the HashMap.

But it is surprising intern is this much of a performance hog that you
can shave ~7 seconds of IR init time.

We've talked about removing the interning of field names, especially
with flexible indexing (4.0) where fields and term text are now
separately enum'd, there's really no more search-time benefit to
interning field names.

Even pre-flex, global interning seems silly since we have a FieldInfos
which holds the String name for each field; instead of interning, we
should be able to consistently always use the specific instance for
that FieldInfo...

Mike

On Sat, Nov 20, 2010 at 12:10 AM, Shai Erera <serera@gmail.com> wrote:
> I actually think that the main reason for interning the field names in
> Lucene is for comparison purposes and not to guarantee uniqueness (though
> you get both). You will see many places in the Lucene's code where the fi=
eld
> name is compared using !=3D operator instead of equals.
>
> BTW, in your patch above, you use the hashCode as the key, which for Stri=
ngs
> is a bad idea especially if they are not all ASCII - Java's hashCode is
> 32-bit which is very bad -- you'll hit collisions very fast. I once count=
ed
> 1M collisions on 100M ASCII words and even more when non-ASCII text was
> involved.
>
> Shai
>
> On Sat, Nov 20, 2010 at 12:41 AM, Mark Kristensson <
> mark.kristensson@smartsheet.com> wrote:
>
>> My findings from the hprof results which showed 80% of the CPU time bein=
g
>> in String.intern() led me to do some reading about String.intern() and w=
hat
>> I found surprised me.
>>
>> First, there are some very strong feelings about String.intern() and its
>> value. First, is this guy (
>> http://www.codeinstructions.com/2009/01/busting-javalangstringintern-myt=
hs.html)
>> who doesn't have much good to say about it. This guy (
>> http://kohlerm.blogspot.com/2009/01/is-javalangstringintern-really-evil.=
html)
>> responds to the key points, but acknowledges there are some issues with =
it.
>> The net, to me, is that using String.intern() has some potential perform=
ance
>> benefits IF you KNOW that the set of strings you are intern-ing will be
>> small. If the set is large...watch out. The one element that has me
>> especially worried is that intern-ing a String leads to it getting store=
d in
>> PermGen space.
>>
>> From what I've read, the main reasons to intern a string are 1) comparis=
on
>> performance and 2) uniqueness (including having a single instance of the
>> String). In looking at the source code for
>> org.apache.lucene.util.StringHelper, StringInterner and SimpleStringInte=
rner
>> it appears that the primary reason for intern-ing strings in Lucene is f=
or
>> uniqueness (but that's just a guess). So, I decided to try tackling the
>> uniqueness problem a different way: HashMap! I modified StringHelper to =
use
>> a static instance of a HashMap instead of SimpleStringInterner just to s=
ee
>> if it would make any difference.
>>
>> Much to my surprise, the change was very easy to make (see below) and (f=
or
>> the IndexReader.open) massively improved the performance of opening my
>> large, problematic index. Instead of taking nearly 10 seconds to open th=
e
>> index on one of our lab servers, it takes only a couple of seconds for t=
his
>> index which has over 300,000 field names.
>>
>> Now, there are a lot of caveats to this test
>> 1) Right now, I'm only testing a tiny little bit of even my own
>> application's usage of Lucene, so I have no idea what the large impact o=
f
>> this change will be on my own app
>> 2) I really am guessing at the reasons for intern-ing the Strings. I'm
>> going to keep digging through source code to see where else StringHelper=
 is
>> used and how it is used, but I'm not going to be an expert on this code =
any
>> time soon.
>>
>> Finally, this seems to address the issues I'm having opening IndexReader=
s
>> against this index, but I have not been able to repro the
>> IndexWriter.close() slowness that initially =A0led me down this path in =
my
>> test app (though I can repro them our lab with our full app).
>>
>> Here's the changes I made to org.apache.lucene.util.StringHelper:
>>
>> =A0//public static StringInterner interner =3D new
>> SimpleStringInterner(1024,8);
>> =A0public static HashMap<Integer, String> uniqueStrings =3D new
>> HashMap<Integer, String>();
>>
>> =A0/** Return the same string object for all equal strings */
>> =A0public static String intern(String s) {
>> // =A0 =A0return interner.intern(s);
>> =A0 =A0int h =3D s.hashCode();
>> =A0 =A0if (!uniqueStrings.containsKey(h)) {
>> =A0 =A0 =A0 =A0uniqueStrings.put(h, s);
>> =A0 =A0}
>> =A0 =A0return uniqueStrings.get(h);
>> =A0}
>>
>>
>>
>> On Nov 17, 2010, at 1:51 PM, Michael McCandless wrote:
>>
>> > Lucene interns field names... since you have a truly enormous number
>> > of unique fields it's expected intern will be called alot.
>> >
>> > But that said it's odd that it's this costly.
>> >
>> > Can you post the stack traces that call intern?
>> >
>> > Mike
>> >
>> > On Fri, Nov 5, 2010 at 1:53 PM, Michael McCandless
>> > <lucene@mikemccandless.com> wrote:
>> >> Hmm...
>> >>
>> >> So, I was going on this output from your CheckIndex:
>> >>
>> >> =A0 test: field norms.........OK [296713 fields]
>> >>
>> >> But in fact I just looked and that number is bogus -- it's always
>> >> equal to total number of fields, not number of fields with norms
>> >> enabled. =A0I'll open an issue to fix this, but in the meantime can y=
ou
>> >> apply this patch to your CheckIndex and run it again?
>> >>
>> >> Index: src/java/org/apache/lucene/index/CheckIndex.java
>> >> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> >> --- src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(revision
>> 1031678)
>> >> +++ src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(working =
copy)
>> >> @@ -570,8 +570,10 @@
>> >> =A0 =A0 =A0 }
>> >> =A0 =A0 =A0 final byte[] b =3D new byte[reader.maxDoc()];
>> >> =A0 =A0 =A0 for (final String fieldName : fieldNames) {
>> >> - =A0 =A0 =A0 =A0reader.norms(fieldName, b, 0);
>> >> - =A0 =A0 =A0 =A0++status.totFields;
>> >> + =A0 =A0 =A0 =A0if (reader.hasNorms(fieldName)) {
>> >> + =A0 =A0 =A0 =A0 =A0reader.norms(fieldName, b, 0);
>> >> + =A0 =A0 =A0 =A0 =A0++status.totFields;
>> >> + =A0 =A0 =A0 =A0}
>> >> =A0 =A0 =A0 }
>> >>
>> >> =A0 =A0 =A0 msg("OK [" + status.totFields + " fields]");
>> >>
>> >> So if in fact you have already disabled norms then something else is
>> >> the source of the sudden slowness. =A0Though, such a huge number of
>> >> unique field names is not an area of Lucene that's very well tested..=
.
>> >> perhaps there's something silly somewhere. =A0Maybe you can try
>> >> profiling just the init of your IndexReader? =A0(Eg, run java with
>> >> -agentlib:hprof=3Dcpu=3Dsamples,depth=3D16,interval=3D1).
>> >>
>> >> Yes, both Index.NOT_ANALYZED_NO_NORMS and Index.NO will disable norms
>> >> as long as no document in the index ever had norms on (yes it does
>> >> "infect" heh).
>> >>
>> >> Mike
>> >>
>> >> On Fri, Nov 5, 2010 at 1:37 PM, Mark Kristensson
>> >> <mark.kristensson@smartsheet.com> wrote:
>> >>> While most of our Lucene indexes are used for more traditional
>> searching, this index in particular is used more like a reporting
>> repository. Thus, we really do need to have that many fields indexed and
>> they do need to be broken out into separate fields. There may be another=
 way
>> to structure the index to reduce the number of fields, but I'm hoping we=
 can
>> optimize the current design and avoid (yet another) index redesign.
>> >>>
>> >>> I'll look into the tweaking the merge policy, but I'm more intereste=
d
>> in disabling norms because scoring really doesn't matter for us. Basical=
ly,
>> we need nothing more than a binary answer from Lucene: either a record m=
eets
>> the provided criteria (which can be a rather complex boolean query with =
many
>> subqueries) or it doesn't. If the record does match, then we get the IDs
>> from lucene and run off to get the live data from our primary data store=
 and
>> sort it (in Java) based upon criteria provided by the user, not by score=
.
>> >>>
>> >>> After our initial design mushroomed in size, we redesigned and now (=
I
>> thought) do not have norms on any of the fields in this index. So, I'm
>> wondering if there was something in the results from the CheckIndex that=
 I
>> provided which indicates to you that we may have norms still enabled? I =
know
>> that if you have norms on any one document's field, then any other docum=
ent
>> with that same field will get "infected" with norms as well.
>> >>>
>> >>> My understanding is that any field that uses the constants
>> =A0Index.NOT_ANALYZED_NO_NORMS or =A0Index.NO will not =A0have norms on =
it,
>> regardless of whether or not the field is stored. Is that not correct?
>> >>>
>> >>> Thanks,
>> >>> Mark
>> >>>
>> >>>
>> >>>
>> >>> On Nov 4, 2010, at 2:56 AM, Michael McCandless wrote:
>> >>>
>> >>>> Likely what happened is you had a bunch of smaller segments, and th=
en
>> >>>> suddenly they got merged into that one big segment (_aiaz) in your
>> >>>> index.
>> >>>>
>> >>>> The representation for norms in particular is not sparse, so this
>> >>>> means the size of the norms file for a given segment will be
>> >>>> number-of-unique-indexed-fields X number-of-documents.
>> >>>>
>> >>>> So this count grows quadratically on merge.
>> >>>>
>> >>>> Do these fields really need to be indexed? =A0 If so, it'd be bette=
r to
>> >>>> use a single field for all users for the indexable text if you can.
>> >>>>
>> >>>> Failing that, a simple workaround is to set the maxMergeMB/Docs on =
the
>> >>>> merge policy; this'd prevent big segments from being produced.
>> >>>> Disabling norms should also workaround this, though that will affec=
t
>> >>>> hit scores...
>> >>>>
>> >>>> Mike
>> >>>>
>> >>>> On Wed, Nov 3, 2010 at 7:37 PM, Mark Kristensson
>> >>>> <mark.kristensson@smartsheet.com> wrote:
>> >>>>> Yes, we do have a large number of unique field names in that index=
,
>> because they are driven by user named fields in our application (with so=
me
>> cleaning to remove illegal chars).
>> >>>>>
>> >>>>> This slowness problem has appeared very suddenly in the last coupl=
e
>> of weeks and the number of unique field names has not spiked in the last=
 few
>> weeks. Have we crept over some threshold with our linear growth in the
>> number of unique field names? Perhaps there is a limit driven by the amo=
unt
>> of RAM in the machine that we are violating? Are there any guidelines fo=
r
>> the maximum number, or suggested number, of unique fields names in an in=
dex
>> or segment? Any suggestions for potentially mitigating the problem?
>> >>>>>
>> >>>>> Thanks,
>> >>>>> Mark
>> >>>>>
>> >>>>>
>> >>>>> On Nov 3, 2010, at 2:02 PM, Michael McCandless wrote:
>> >>>>>
>> >>>>>> On Wed, Nov 3, 2010 at 4:27 PM, Mark Kristensson
>> >>>>>> <mark.kristensson@smartsheet.com> wrote:
>> >>>>>>>
>> >>>>>>> I've run checkIndex against the index and the results are below.
>> That net is that it's telling me nothing is wrong with the index.
>> >>>>>>
>> >>>>>> Thanks.
>> >>>>>>
>> >>>>>>> I did not have any instrumentation around the opening of the
>> IndexSearcher (we don't use an IndexReader), just around the actual quer=
y
>> execution so I had to add some additional logging. What I found surprise=
d
>> me, opening a search against this index takes the same 6 to 8 seconds th=
at
>> closing the indexWriter takes.
>> >>>>>>
>> >>>>>> IndexWriter opens a SegmentReader for each segment in the index, =
to
>> >>>>>> apply deletions, so I think this is the source of the slowness.
>> >>>>>>
>> >>>>>> From the CheckIndex output, it looks like you have many (296,713)
>> >>>>>> unique fields names on that one large segment -- does that sound
>> >>>>>> right? =A0I suspect such a very high field count is the source of=
 the
>> >>>>>> slowness...
>> >>>>>>
>> >>>>>> Mike
>> >>>>>>
>> >>>>>>
>> ---------------------------------------------------------------------
>> >>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>>>>>
>> >>>>>
>> >>>>>
>> >>>>> ------------------------------------------------------------------=
---
>> >>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>>>>
>> >>>>>
>> >>>>
>> >>>> -------------------------------------------------------------------=
--
>> >>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>>>
>> >>>
>> >>>
>> >>
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47862-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 20 13:44:00 2010
Return-Path: <java-user-return-47862-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96037 invoked from network); 20 Nov 2010 13:43:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 20 Nov 2010 13:43:59 -0000
Received: (qmail 58632 invoked by uid 500); 20 Nov 2010 13:44:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58289 invoked by uid 500); 20 Nov 2010 13:44:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58267 invoked by uid 99); 20 Nov 2010 13:44:28 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 20 Nov 2010 13:44:28 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 20 Nov 2010 13:44:23 +0000
Received: by fxm2 with SMTP id 2so1526027fxm.35
        for <java-user@lucene.apache.org>; Sat, 20 Nov 2010 05:44:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=Xdaak34nuR5FMI3euI3jL/9UquJoEfAXJf9vqeo3U0k=;
        b=Za7Hn2zpyhCbVB6xJiwdFmDfr44O8PmuLhiP7NG7s2iQhLDjRGO8aXs06cBPuwcxDH
         nJk42KGjrm16pejlywfSS/2qz/zz8qRHd4UMXI9FuMBzL3WL69B3uAYTCahW8PG62YBB
         gsMNiwQQAfCQ6X8aP9JioSkcB6BDWLognwPTY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=KAfHwSJQnt2fKo+3QCP/wW4luHOv1XUD/0TBr9ySOTPmKp3h8TRHMvMFp/IUdrg22o
         FBPdS5W0axjI6PYVwOWz6+Y2ZxXXqJQq8sVorJXs/mjn7zPKJ8YwA7leeHRF34taH0iS
         ffGZo9mDYd1NK1+4zLD0GtMX1+DRP5BMzegxM=
MIME-Version: 1.0
Received: by 10.223.100.9 with SMTP id w9mr2098055fan.12.1290260642053; Sat,
 20 Nov 2010 05:44:02 -0800 (PST)
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.74.202 with HTTP; Sat, 20 Nov 2010 05:44:01 -0800 (PST)
In-Reply-To: <50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com>
	<AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com>
	<79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com>
	<8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com>
	<AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com>
	<1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com>
	<AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com>
	<ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com>
	<AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com>
	<1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com>
	<AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com>
	<AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com>
	<50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com>
Date: Sat, 20 Nov 2010 08:44:01 -0500
X-Google-Sender-Auth: 9-a5IJZYm4Mc491UmcU6L6qYHpY
Message-ID: <AANLkTim=onWvY2Re3rXSMqzG8UPkgz64SO=6dgCPFJ3H@mail.gmail.com>
Subject: Re: IndexWriter.close() performance issue
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Fri, Nov 19, 2010 at 5:41 PM, Mark Kristensson
<mark.kristensson@smartsheet.com> wrote:
> Here's the changes I made to org.apache.lucene.util.StringHelper:
>
> =A0//public static StringInterner interner =3D new SimpleStringInterner(1=
024,8);

As Mike said, the real fix for trunk is to get rid of interning.
But for your version, you could try making the string intern cache larger.

StringHelper.interner =3D new SimpleStringInterner(300000,8);

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47863-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 21 01:48:07 2010
Return-Path: <java-user-return-47863-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71263 invoked from network); 21 Nov 2010 01:48:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Nov 2010 01:48:06 -0000
Received: (qmail 66846 invoked by uid 500); 21 Nov 2010 01:48:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66785 invoked by uid 500); 21 Nov 2010 01:48:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66777 invoked by uid 99); 21 Nov 2010 01:48:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 01:48:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pulkitsinghal@gmail.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 01:48:28 +0000
Received: by gwb15 with SMTP id 15so4013252gwb.35
        for <java-user@lucene.apache.org>; Sat, 20 Nov 2010 17:48:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=8qitvSgeni/fTL6x7IfOZvOIFUYx1fX75y8r2wvHu60=;
        b=uScnWdiFyueQ9BIhIvLADD9DUcwhxsOfWDG75pPGvnTntxK+R6vEukgnmpBN7CYHQM
         tq7DOm54rLKsfbu0o9KKENCNpGqsFi49Syq0YxEWNUg6P8E0VedATuBJ2Ryb1GiUycZT
         AOXNskQ9MqCy8WMhrHh6CeGy/E+gAYlt9rzMo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=UfX6EkwbvGfI9LRQhEeCku/cEPy3NfMzpZMJ9AQihF0rGcLBQNEivnSp2Y93/eXDXy
         tHIM9Bb8Kwk1NuDf7pJKqUj3TTE0VdR51psCq9e+3zm7uQSmbUERr6FyrWPiJvdnobbB
         DHIOfa390eVMr0/7jcrLVHx3/g/auKgiZb9V8=
MIME-Version: 1.0
Received: by 10.150.52.18 with SMTP id z18mr6077483ybz.378.1290304087849; Sat,
 20 Nov 2010 17:48:07 -0800 (PST)
Received: by 10.150.147.1 with HTTP; Sat, 20 Nov 2010 17:48:07 -0800 (PST)
Date: Sat, 20 Nov 2010 20:48:07 -0500
Message-ID: <AANLkTik9Ttiu4mUEsqA1=j5a9Ua2MNXUKWgPWNiT3Hos@mail.gmail.com>
Subject: Dismax in Lucene
From: Pulkit Singhal <pulkitsinghal@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

Hello,

I heard Yonik talk about a better dismax query parser for Solr so I
was wondering if Lucene already has this functionality contributed to
its contrib modules?

- Pulkit

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47864-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 21 05:49:51 2010
Return-Path: <java-user-return-47864-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58858 invoked from network); 21 Nov 2010 05:49:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Nov 2010 05:49:51 -0000
Received: (qmail 11672 invoked by uid 500); 21 Nov 2010 05:50:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11386 invoked by uid 500); 21 Nov 2010 05:50:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11377 invoked by uid 99); 21 Nov 2010 05:50:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 05:50:19 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.49.16] (HELO web52906.mail.re2.yahoo.com) (206.190.49.16)
    by apache.org (qpsmtpd/0.29) with SMTP; Sun, 21 Nov 2010 05:50:10 +0000
Received: (qmail 66949 invoked by uid 60001); 21 Nov 2010 05:49:49 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1290318589; bh=6OCuWCn+dWWdJCtbrtHxOvWyKD5DI+zJF+9ya2l1QKg=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=0pge70I13LsM4VT6cpWelFE3UiL5nNkuj45ZK6Sq4WQ8zucu5MeZq07ezfiPPJRQRK1/galc3VeRfsoqYNYLIaqq61+8iQhhf0rltsI3GCqObiR54S3lLy9J30x3GodwPIMr6/hoRBxhzS1VHrMFT/9TxqemVCwamQlcdpoFAsE=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=4lnBNKJNP7lRINNa2ogj3/HQdhQXyToFPARD9tmQmnnp6l/dRQkGSS3QbqkOMIq25z1lTbG/R2frzSukEWfe2imFEog9UJNLemzyXtpU/Lq8xSe54qO/sySds8wbvedYBreY0P8/fvYXm6wii0ui9gzwFMXQpFhwyVBB6PR35eU=;
Message-ID: <65755.66740.qm@web52906.mail.re2.yahoo.com>
X-YMail-OSG: Q6RhsYEVM1n.tVgfbnCiUDxgsWO0MKK_CNCspxuW4CEvObD
 G56YIc4qchtZARAMlGL5lOCYuuLRcQO3XQoNgMZvncyKcOxBUJh2vh.1AP76
 vUv3LF6Xn5nkO2J9FvEHZCVgvahbW_.C_mhzi2jLDUSTIpg6LRPhFhHbr4G0
 iuAph9Kj25_nybsbVcP6L50CswQc4zZXfaS0OcCaQc54jPhJtlBQZMU.Jd4d
 3cBg1ssc7o9KOTT2gHvXqI..dx7ENpjsUoyIagLIVL5If5.oIKTiD5IUCtQv
 154ozd96mnAo5VV.RGWwzbK8bMP1Vt06dZTOpQB75PRkfNAwZ4oRQCAw_nNI
 XUrvz.cbTEohpvjmi0WkKIUFcOLtaQsH8FIJTzPLrvbVBJA--
Received: from [78.164.82.12] by web52906.mail.re2.yahoo.com via HTTP; Sat, 20 Nov 2010 21:49:48 PST
X-Mailer: YahooMailClassic/11.4.9 YahooMailWebService/0.8.107.285259
Date: Sat, 20 Nov 2010 21:49:48 -0800 (PST)
From: Ahmet Arslan <iorixxx@yahoo.com>
Subject: Re: Dismax in Lucene
To: java-user@lucene.apache.org
In-Reply-To: <AANLkTik9Ttiu4mUEsqA1=j5a9Ua2MNXUKWgPWNiT3Hos@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

> I heard Yonik talk about a better dismax query parser for
> Solr so I
> was wondering if Lucene already has this functionality
> contributed to
> its contrib modules?

Dismax use Lucene's DisjunctionMaxQuery

http://lucene.apache.org/java/2_9_3/api/core/org/apache/lucene/search/DisjunctionMaxQuery.html


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47865-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 21 23:33:08 2010
Return-Path: <java-user-return-47865-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88964 invoked from network); 21 Nov 2010 23:33:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Nov 2010 23:33:07 -0000
Received: (qmail 45533 invoked by uid 500); 21 Nov 2010 23:33:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45206 invoked by uid 500); 21 Nov 2010 23:33:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45196 invoked by uid 99); 21 Nov 2010 23:33:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 23:33:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of luca.rondanini@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 23:33:28 +0000
Received: by fxm2 with SMTP id 2so2235045fxm.35
        for <java-user@lucene.apache.org>; Sun, 21 Nov 2010 15:33:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=l/gSM5Dx1Ajge2yhlH1An7zYSQeCneDPxkz/0Oq1FJE=;
        b=sCUfx71nAiwuNz4OgXZEWYjDiavRCb65LaWeyuqOXKXVokQ+2Ncnu6yfx20gkQr6bJ
         mwfaKkV8cVzvmXAX7CvPETtkm1lx0yIYoU1BVNiALEQks88rW67j94GTAUQ6krbNi8/r
         3R36J4vGITzmAfbuv/m1ttNy2c7+ArqaBOqDg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=gaaIXKSTD3kIgjbbmOrNKY3lT/siYoGszErxWPIVmFMAVpPVnakjkMQGZJ56AkPRp7
         9C9F2i5qFWdUlS3XVLgxG6M7MELja00yPvErvtf3eLRvtJ91h+oI8tNdNsiDLNRHwcrC
         GTwqgHNG6qQ+ppFlWUj5MHZZwAagMFDTwvwsU=
MIME-Version: 1.0
Received: by 10.223.71.198 with SMTP id i6mr3470179faj.140.1290382386866; Sun,
 21 Nov 2010 15:33:06 -0800 (PST)
Received: by 10.223.98.193 with HTTP; Sun, 21 Nov 2010 15:33:06 -0800 (PST)
Date: Sun, 21 Nov 2010 15:33:06 -0800
Message-ID: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
Subject: best practice: 1.4 billions documents
From: Luca Rondanini <luca.rondanini@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf3054a8cfcb2f9b0495988f37

--20cf3054a8cfcb2f9b0495988f37
Content-Type: text/plain; charset=UTF-8

Hi everybody,

I really need some good advice! I need to index in lucene something like 1.4
billions documents. I had experience in lucene but I've never worked with
such a big number of documents. Also this is just the number of docs at
"start-up": they are going to grow and fast.

I don't have to tell you that I need the system to be fast and to support
real time updates to the documents

The first solution that came to my mind was to use ParallelMultiSearcher,
splitting the index into many "sub-index" (how many docs per index?
100,000?) but I don't have experience with it and I don't know how well will
scale while the number of documents grows!

A more solid solution seems to build some kind of integration with hadoop.
But I didn't find match about lucene and hadoop integration.

Any idea? Which direction should I go (pure lucene or hadoop)?

Thanks
Luca

--20cf3054a8cfcb2f9b0495988f37--

From java-user-return-47866-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 21 23:40:41 2010
Return-Path: <java-user-return-47866-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90550 invoked from network); 21 Nov 2010 23:40:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Nov 2010 23:40:40 -0000
Received: (qmail 51387 invoked by uid 500); 21 Nov 2010 23:41:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51213 invoked by uid 500); 21 Nov 2010 23:41:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51205 invoked by uid 99); 21 Nov 2010 23:41:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 23:41:10 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of johannes.goll@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 23:41:04 +0000
Received: by fxm2 with SMTP id 2so2237641fxm.35
        for <java-user@lucene.apache.org>; Sun, 21 Nov 2010 15:40:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=HHkF6BO5vYil+Ku0GJSzE6mgphbbU/oroQk6cx2shck=;
        b=HJXvHmRLMepES7ACwd581AKaNMLg9/SZ3ol+d5ioBzYf+S6fzzChA3OSyAyH0VBmdW
         84SD8Fi65spn0zaNBwaXKlZ6uABPAN4rqqnvX1WdDQct3PPu6CM+3e+QxkvkGJIVshrY
         dchYYJGWSENVjeE4GQ+yBTnRMBDizHYkYFBN8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=gUL0h9nSfrE4ILYbkwGECq8QOiM3dYtd8ACcMuDlWaIEkJ9w9GaIG27gR4voX3t+c7
         FN99SMaRLqCOBCJwx1KEuW4ye9hdjtr5xQaP/Ryd/PDul6D/rhTCTkUzf2E08gawEsDJ
         y8ji8Jl5UfuvZlESnCDXs5ZiqFHyUIp9It8lA=
MIME-Version: 1.0
Received: by 10.223.72.195 with SMTP id n3mr3497913faj.132.1290382842134; Sun,
 21 Nov 2010 15:40:42 -0800 (PST)
Received: by 10.223.105.66 with HTTP; Sun, 21 Nov 2010 15:40:42 -0800 (PST)
In-Reply-To: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
Date: Sun, 21 Nov 2010 18:40:42 -0500
Message-ID: <AANLkTims=kX78yJue5NZyXNoSvX=qJGRE6XgqPfPkFxU@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Johannes Goll <johannes.goll@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf3054a2e1edffe9049598aab7

--20cf3054a2e1edffe9049598aab7
Content-Type: text/plain; charset=ISO-8859-1

Hi Luca,

Katta is an open-source project that integrates Lucene with Hadoop
http://katta.sourceforge.net

Johannes

2010/11/21 Luca Rondanini <luca.rondanini@gmail.com>

> Hi everybody,
>
> I really need some good advice! I need to index in lucene something like
> 1.4
> billions documents. I had experience in lucene but I've never worked with
> such a big number of documents. Also this is just the number of docs at
> "start-up": they are going to grow and fast.
>
> I don't have to tell you that I need the system to be fast and to support
> real time updates to the documents
>
> The first solution that came to my mind was to use ParallelMultiSearcher,
> splitting the index into many "sub-index" (how many docs per index?
> 100,000?) but I don't have experience with it and I don't know how well
> will
> scale while the number of documents grows!
>
> A more solid solution seems to build some kind of integration with hadoop.
> But I didn't find match about lucene and hadoop integration.
>
> Any idea? Which direction should I go (pure lucene or hadoop)?
>
> Thanks
> Luca
>



-- 
Johannes Goll
211 Curry Ford Lane
Gaithersburg, Maryland 20878

--20cf3054a2e1edffe9049598aab7--

From java-user-return-47867-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 21 23:48:00 2010
Return-Path: <java-user-return-47867-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91623 invoked from network); 21 Nov 2010 23:48:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 21 Nov 2010 23:48:00 -0000
Received: (qmail 54727 invoked by uid 500); 21 Nov 2010 23:48:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54677 invoked by uid 500); 21 Nov 2010 23:48:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54669 invoked by uid 99); 21 Nov 2010 23:48:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 23:48:30 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 21 Nov 2010 23:48:24 +0000
Received: by fxm2 with SMTP id 2so2240472fxm.35
        for <java-user@lucene.apache.org>; Sun, 21 Nov 2010 15:48:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        bh=Dh80tY6csJk/eWVSgqKoL9pHOQlOoZ6HIKVVG1JbIH4=;
        b=Moj6aaijl6rvjPu2khC38Ccj14KEFXaClOFXgXixaHjBhIRXRHINdETFlzoDQ/z3zY
         DGKR8zYPhxxYQ3hum9UISpAJBodVlv1FhRhSMkQlnSAKqTKhvxhZHj5bpSmIjojHUMkc
         s123EKjU3meZ0vhkqB8rlayiEiffdiEpZMioM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type;
        b=fwSXSgsqx/YO+3/bro2Ife/HLFOZmOzUYsTuU02m1LJjYs0bQHRn0LHjRg6oXCW0NY
         TdcgKLqvIhh8vRYxdZSjW/kofhUKbHO/IDjPmv5ytnesOEkSC3veRsXiSwhkR9ZTJn8X
         tJICi6iJUEhHlS8tK4lLKMMa6OaeEYziqPkOA=
MIME-Version: 1.0
Received: by 10.223.79.65 with SMTP id o1mr3509635fak.145.1290383283465; Sun,
 21 Nov 2010 15:48:03 -0800 (PST)
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.74.202 with HTTP; Sun, 21 Nov 2010 15:48:03 -0800 (PST)
In-Reply-To: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
Date: Sun, 21 Nov 2010 18:48:03 -0500
X-Google-Sender-Auth: 0VvShMEo3C0P_RZhxdFbqpmq5mg
Message-ID: <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
<luca.rondanini@gmail.com> wrote:
> Hi everybody,
>
> I really need some good advice! I need to index in lucene something like 1.4
> billions documents. I had experience in lucene but I've never worked with
> such a big number of documents. Also this is just the number of docs at
> "start-up": they are going to grow and fast.
>
> I don't have to tell you that I need the system to be fast and to support
> real time updates to the documents
>
> The first solution that came to my mind was to use ParallelMultiSearcher,
> splitting the index into many "sub-index" (how many docs per index?
> 100,000?) but I don't have experience with it and I don't know how well will
> scale while the number of documents grows!
>
> A more solid solution seems to build some kind of integration with hadoop.
> But I didn't find match about lucene and hadoop integration.
>
> Any idea? Which direction should I go (pure lucene or hadoop)?

There seems to be a common misconception about hadoop regarding search.
Map-reduce as implemented in hadoop is really for batch oriented jobs
only (or those types of jobs where you don't need a quick response
time).  It's definitely not for normal queries (unless you have
unusual requirements).

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47868-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 01:13:03 2010
Return-Path: <java-user-return-47868-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33118 invoked from network); 22 Nov 2010 01:13:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 01:13:02 -0000
Received: (qmail 92423 invoked by uid 500); 22 Nov 2010 01:13:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92387 invoked by uid 500); 22 Nov 2010 01:13:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92378 invoked by uid 99); 22 Nov 2010 01:13:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 01:13:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of luca.rondanini@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 01:13:21 +0000
Received: by fxm2 with SMTP id 2so2274762fxm.35
        for <java-user@lucene.apache.org>; Sun, 21 Nov 2010 17:13:00 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Dz7KzIZer3Um8KaBs0sP/66wP38TiNGgqntvcFwWK3Y=;
        b=mMqvLTlOqpt4TSEJaq7m0PnMNkVXVEiowxG/MJBBQmj8Pt6L/cLp4AOxl6k6rRJ2gi
         YBtOwVZHg0tbgKch4dvL8tN1731utty5lzE6tVy1EESo9NEooERTpGy7X3cC8+c3zJCQ
         HV1owb8dWpf51cISkvCy3UxZ7Bb+TwL1d3y+k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=dJy4ZT5F1PR3k70CEW0aEKGkrgY1zSukSM5D88zJMz/gnvh8lk93+1MX8OK16JWGg9
         bbWfOCOwvyDQ0HSY2fd4hHfrr1eASZJvEu/4VbkCSpmarQZ5RTrrNsuXh7ayP861U6yv
         ozmrp7zf/eZaOyjvMdS4Kc4uCk2TdFPgyr+I4=
MIME-Version: 1.0
Received: by 10.223.100.15 with SMTP id w15mr2297773fan.121.1290388380335;
 Sun, 21 Nov 2010 17:13:00 -0800 (PST)
Received: by 10.223.98.193 with HTTP; Sun, 21 Nov 2010 17:13:00 -0800 (PST)
In-Reply-To: <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
Date: Sun, 21 Nov 2010 17:13:00 -0800
Message-ID: <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Luca Rondanini <luca.rondanini@gmail.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: multipart/alternative; boundary=20cf3054a2e9083d1c049599f51b

--20cf3054a2e9083d1c049599f51b
Content-Type: text/plain; charset=UTF-8

thank you both!

Johannes, katta seems interesting but I will need to solve the problems of
"hot" updates to the index

Yonik, I see your point - so your suggestion would be to build an
architecture based on ParallelMultiSearcher?


On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley <yonik@lucidimagination.com>wrote:

> On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> <luca.rondanini@gmail.com> wrote:
> > Hi everybody,
> >
> > I really need some good advice! I need to index in lucene something like
> 1.4
> > billions documents. I had experience in lucene but I've never worked with
> > such a big number of documents. Also this is just the number of docs at
> > "start-up": they are going to grow and fast.
> >
> > I don't have to tell you that I need the system to be fast and to support
> > real time updates to the documents
> >
> > The first solution that came to my mind was to use ParallelMultiSearcher,
> > splitting the index into many "sub-index" (how many docs per index?
> > 100,000?) but I don't have experience with it and I don't know how well
> will
> > scale while the number of documents grows!
> >
> > A more solid solution seems to build some kind of integration with
> hadoop.
> > But I didn't find match about lucene and hadoop integration.
> >
> > Any idea? Which direction should I go (pure lucene or hadoop)?
>
> There seems to be a common misconception about hadoop regarding search.
> Map-reduce as implemented in hadoop is really for batch oriented jobs
> only (or those types of jobs where you don't need a quick response
> time).  It's definitely not for normal queries (unless you have
> unusual requirements).
>
> -Yonik
> http://www.lucidimagination.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--20cf3054a2e9083d1c049599f51b--

From java-user-return-47869-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 02:23:00 2010
Return-Path: <java-user-return-47869-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66771 invoked from network); 22 Nov 2010 02:23:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 02:23:00 -0000
Received: (qmail 32368 invoked by uid 500); 22 Nov 2010 02:23:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32332 invoked by uid 500); 22 Nov 2010 02:23:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32324 invoked by uid 99); 22 Nov 2010 02:23:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 02:23:30 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 02:23:24 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
Subject: RE: best practice: 1.4 billions documents
Date: Sun, 21 Nov 2010 21:22:58 -0500
Message-ID: <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
In-Reply-To: <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: best practice: 1.4 billions documents
Thread-Index: AcuJ4nnpQhHmARD+QdaMbc5AD2NNdAACVmYw
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com> <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>,
	<yonik@lucidimagination.com>

QWN0dWFsbHkgSSd2ZSBiZWVuIGJpdHRlbiBieSBhbiBzdGlsbC11bnJlc29sdmVkIGlzc3VlIHdp
dGggdGhlIHBhcmFsbGVsIHNlYXJjaGVycyBhbmQgcmVjb21tZW5kIGEgTXVsdGlSZWFkZXIgaW5z
dGVhZC4NCldlIGhhdmUgYSBjb3VwbGUgYmlsbGlvbiBkb2NzIGluIG91ciBhcmNoaXZlcyBhcyB3
ZWxsLiAgQnJlYWtpbmcgdGhlbSB1cCBieSBkYXkgd29ya2VkIHdlbGwgZm9yIHVzLCBidXQgeW91
J2xsIG5lZWQgdG8gZG8gc29tZXRoaW5nLg0KDQotLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0K
RnJvbTogTHVjYSBSb25kYW5pbmkgW21haWx0bzpsdWNhLnJvbmRhbmluaUBnbWFpbC5jb21dIA0K
U2VudDogU3VuZGF5LCBOb3ZlbWJlciAyMSwgMjAxMCA4OjEzIFBNDQpUbzogamF2YS11c2VyQGx1
Y2VuZS5hcGFjaGUub3JnOyB5b25pa0BsdWNpZGltYWdpbmF0aW9uLmNvbQ0KU3ViamVjdDogUmU6
IGJlc3QgcHJhY3RpY2U6IDEuNCBiaWxsaW9ucyBkb2N1bWVudHMNCg0KdGhhbmsgeW91IGJvdGgh
DQoNCkpvaGFubmVzLCBrYXR0YSBzZWVtcyBpbnRlcmVzdGluZyBidXQgSSB3aWxsIG5lZWQgdG8g
c29sdmUgdGhlIHByb2JsZW1zIG9mDQoiaG90IiB1cGRhdGVzIHRvIHRoZSBpbmRleA0KDQpZb25p
aywgSSBzZWUgeW91ciBwb2ludCAtIHNvIHlvdXIgc3VnZ2VzdGlvbiB3b3VsZCBiZSB0byBidWls
ZCBhbg0KYXJjaGl0ZWN0dXJlIGJhc2VkIG9uIFBhcmFsbGVsTXVsdGlTZWFyY2hlcj8NCg0KDQpP
biBTdW4sIE5vdiAyMSwgMjAxMCBhdCAzOjQ4IFBNLCBZb25payBTZWVsZXkgPHlvbmlrQGx1Y2lk
aW1hZ2luYXRpb24uY29tPndyb3RlOg0KDQo+IE9uIFN1biwgTm92IDIxLCAyMDEwIGF0IDY6MzMg
UE0sIEx1Y2EgUm9uZGFuaW5pDQo+IDxsdWNhLnJvbmRhbmluaUBnbWFpbC5jb20+IHdyb3RlOg0K
PiA+IEhpIGV2ZXJ5Ym9keSwNCj4gPg0KPiA+IEkgcmVhbGx5IG5lZWQgc29tZSBnb29kIGFkdmlj
ZSEgSSBuZWVkIHRvIGluZGV4IGluIGx1Y2VuZSBzb21ldGhpbmcgbGlrZQ0KPiAxLjQNCj4gPiBi
aWxsaW9ucyBkb2N1bWVudHMuIEkgaGFkIGV4cGVyaWVuY2UgaW4gbHVjZW5lIGJ1dCBJJ3ZlIG5l
dmVyIHdvcmtlZCB3aXRoDQo+ID4gc3VjaCBhIGJpZyBudW1iZXIgb2YgZG9jdW1lbnRzLiBBbHNv
IHRoaXMgaXMganVzdCB0aGUgbnVtYmVyIG9mIGRvY3MgYXQNCj4gPiAic3RhcnQtdXAiOiB0aGV5
IGFyZSBnb2luZyB0byBncm93IGFuZCBmYXN0Lg0KPiA+DQo+ID4gSSBkb24ndCBoYXZlIHRvIHRl
bGwgeW91IHRoYXQgSSBuZWVkIHRoZSBzeXN0ZW0gdG8gYmUgZmFzdCBhbmQgdG8gc3VwcG9ydA0K
PiA+IHJlYWwgdGltZSB1cGRhdGVzIHRvIHRoZSBkb2N1bWVudHMNCj4gPg0KPiA+IFRoZSBmaXJz
dCBzb2x1dGlvbiB0aGF0IGNhbWUgdG8gbXkgbWluZCB3YXMgdG8gdXNlIFBhcmFsbGVsTXVsdGlT
ZWFyY2hlciwNCj4gPiBzcGxpdHRpbmcgdGhlIGluZGV4IGludG8gbWFueSAic3ViLWluZGV4IiAo
aG93IG1hbnkgZG9jcyBwZXIgaW5kZXg/DQo+ID4gMTAwLDAwMD8pIGJ1dCBJIGRvbid0IGhhdmUg
ZXhwZXJpZW5jZSB3aXRoIGl0IGFuZCBJIGRvbid0IGtub3cgaG93IHdlbGwNCj4gd2lsbA0KPiA+
IHNjYWxlIHdoaWxlIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIGdyb3dzIQ0KPiA+DQo+ID4gQSBt
b3JlIHNvbGlkIHNvbHV0aW9uIHNlZW1zIHRvIGJ1aWxkIHNvbWUga2luZCBvZiBpbnRlZ3JhdGlv
biB3aXRoDQo+IGhhZG9vcC4NCj4gPiBCdXQgSSBkaWRuJ3QgZmluZCBtYXRjaCBhYm91dCBsdWNl
bmUgYW5kIGhhZG9vcCBpbnRlZ3JhdGlvbi4NCj4gPg0KPiA+IEFueSBpZGVhPyBXaGljaCBkaXJl
Y3Rpb24gc2hvdWxkIEkgZ28gKHB1cmUgbHVjZW5lIG9yIGhhZG9vcCk/DQo+DQo+IFRoZXJlIHNl
ZW1zIHRvIGJlIGEgY29tbW9uIG1pc2NvbmNlcHRpb24gYWJvdXQgaGFkb29wIHJlZ2FyZGluZyBz
ZWFyY2guDQo+IE1hcC1yZWR1Y2UgYXMgaW1wbGVtZW50ZWQgaW4gaGFkb29wIGlzIHJlYWxseSBm
b3IgYmF0Y2ggb3JpZW50ZWQgam9icw0KPiBvbmx5IChvciB0aG9zZSB0eXBlcyBvZiBqb2JzIHdo
ZXJlIHlvdSBkb24ndCBuZWVkIGEgcXVpY2sgcmVzcG9uc2UNCj4gdGltZSkuICBJdCdzIGRlZmlu
aXRlbHkgbm90IGZvciBub3JtYWwgcXVlcmllcyAodW5sZXNzIHlvdSBoYXZlDQo+IHVudXN1YWwg
cmVxdWlyZW1lbnRzKS4NCj4NCj4gLVlvbmlrDQo+IGh0dHA6Ly93d3cubHVjaWRpbWFnaW5hdGlv
bi5jb20NCj4NCj4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQo+IFRvIHVuc3Vic2NyaWJlLCBlLW1haWw6IGphdmEt
dXNlci11bnN1YnNjcmliZUBsdWNlbmUuYXBhY2hlLm9yZw0KPiBGb3IgYWRkaXRpb25hbCBjb21t
YW5kcywgZS1tYWlsOiBqYXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KPg0KPg0K


From java-user-return-47870-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 06:46:34 2010
Return-Path: <java-user-return-47870-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80344 invoked from network); 22 Nov 2010 06:46:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 06:46:33 -0000
Received: (qmail 34055 invoked by uid 500); 22 Nov 2010 06:47:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33889 invoked by uid 500); 22 Nov 2010 06:47:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33881 invoked by uid 99); 22 Nov 2010 06:47:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 06:47:02 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of luca.rondanini@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 06:46:56 +0000
Received: by fxm2 with SMTP id 2so2415068fxm.35
        for <java-user@lucene.apache.org>; Sun, 21 Nov 2010 22:46:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=DZdLFFokjshpGxsIaOVNctinKXC7SsA65m5nlpOys8M=;
        b=fWclh2pmgCsRAVdwtZCHrWw5zMcT8zlN4TWZ2iYV43cUb2v0VvjzE3p6aUsG5Ud7sA
         EYqBIocrBkp/ziZ9905kXZPmsJVn7JS/rre7AcARaQbYj249W+jEOwb0NKhKBVAXV6u1
         Qh8oj7HhULDbTnBXa8g8RAwDYEZcBGuqKyz5E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=K5vSYZyA7ehYjHLKEtv/CHLVklZxxltRsjvk47ghEgsrKUcIZw93F9CzLpLN5Klrog
         q47j9qZsAToWGV6hzXl8UDslKpr3o5/bz27QBBg0Tj6pafiu5OdN0kLyzdMT/KCHjr3J
         pGo1j9DZfWz8vmZFS2Tj7k4DKVdZ4WHyFVCos=
MIME-Version: 1.0
Received: by 10.223.100.4 with SMTP id w4mr4798250fan.26.1290408394335; Sun,
 21 Nov 2010 22:46:34 -0800 (PST)
Received: by 10.223.98.193 with HTTP; Sun, 21 Nov 2010 22:46:34 -0800 (PST)
In-Reply-To: <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
Date: Sun, 21 Nov 2010 22:46:34 -0800
Message-ID: <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Luca Rondanini <luca.rondanini@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf30433e32f5a76c04959e9d24

--20cf30433e32f5a76c04959e9d24
Content-Type: text/plain; charset=UTF-8

Hi David, thanks for your answer. it really helped a lot! so, you have an
index with more than 2 billions segments. this is pretty much the answer I
was searching for: lucene alone is able to manage such a big index.

which kind of problems do you have with the parallel searchers? I'm going to
build my index in the next couple of weeks if you want we can confront our
data

thanks again
Luca


On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com> wrote:

> Actually I've been bitten by an still-unresolved issue with the parallel
> searchers and recommend a MultiReader instead.
> We have a couple billion docs in our archives as well.  Breaking them up by
> day worked well for us, but you'll need to do something.
>
> -----Original Message-----
> From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> Sent: Sunday, November 21, 2010 8:13 PM
> To: java-user@lucene.apache.org; yonik@lucidimagination.com
> Subject: Re: best practice: 1.4 billions documents
>
> thank you both!
>
> Johannes, katta seems interesting but I will need to solve the problems of
> "hot" updates to the index
>
> Yonik, I see your point - so your suggestion would be to build an
> architecture based on ParallelMultiSearcher?
>
>
> On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley <yonik@lucidimagination.com
> >wrote:
>
> > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > <luca.rondanini@gmail.com> wrote:
> > > Hi everybody,
> > >
> > > I really need some good advice! I need to index in lucene something
> like
> > 1.4
> > > billions documents. I had experience in lucene but I've never worked
> with
> > > such a big number of documents. Also this is just the number of docs at
> > > "start-up": they are going to grow and fast.
> > >
> > > I don't have to tell you that I need the system to be fast and to
> support
> > > real time updates to the documents
> > >
> > > The first solution that came to my mind was to use
> ParallelMultiSearcher,
> > > splitting the index into many "sub-index" (how many docs per index?
> > > 100,000?) but I don't have experience with it and I don't know how well
> > will
> > > scale while the number of documents grows!
> > >
> > > A more solid solution seems to build some kind of integration with
> > hadoop.
> > > But I didn't find match about lucene and hadoop integration.
> > >
> > > Any idea? Which direction should I go (pure lucene or hadoop)?
> >
> > There seems to be a common misconception about hadoop regarding search.
> > Map-reduce as implemented in hadoop is really for batch oriented jobs
> > only (or those types of jobs where you don't need a quick response
> > time).  It's definitely not for normal queries (unless you have
> > unusual requirements).
> >
> > -Yonik
> > http://www.lucidimagination.com
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>

--20cf30433e32f5a76c04959e9d24--

From java-user-return-47871-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 09:57:20 2010
Return-Path: <java-user-return-47871-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61030 invoked from network); 22 Nov 2010 09:57:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 09:57:20 -0000
Received: (qmail 98890 invoked by uid 500); 22 Nov 2010 09:57:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98549 invoked by uid 500); 22 Nov 2010 09:57:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98541 invoked by uid 99); 22 Nov 2010 09:57:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 09:57:49 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jan.kurella@nokia.com designates 192.100.122.230 as permitted sender)
Received: from [192.100.122.230] (HELO mgw-mx03.nokia.com) (192.100.122.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 09:57:39 +0000
Received: from esebh106.NOE.Nokia.com (esebh106.ntc.nokia.com [172.21.138.213])
	by mgw-mx03.nokia.com (Switch-3.3.3/Switch-3.3.3) with ESMTP id oAM9ugrh014671
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 11:57:17 +0200
Received: from esebh102.NOE.Nokia.com ([172.21.138.183]) by esebh106.NOE.Nokia.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Mon, 22 Nov 2010 11:56:25 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.7]) by esebh102.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Mon, 22 Nov 2010 11:56:24 +0200
Received: from 008-AM1MMR1-005.mgdnok.nokia.com (65.54.30.60) by
 NOK-AM1MHUB-03.mgdnok.nokia.com (65.54.30.7) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Mon, 22 Nov 2010 10:56:19 +0100
Received: from 008-AM1MPN1-006.mgdnok.nokia.com ([169.254.6.90]) by
 008-AM1MMR1-005.mgdnok.nokia.com ([65.54.30.60]) with mapi; Mon, 22 Nov 2010
 10:56:19 +0100
From: <jan.kurella@nokia.com>
To: <java-user@lucene.apache.org>
Subject: [SOLR] DisMaxQParserPlugin and Tokenization
Thread-Topic: [SOLR] DisMaxQParserPlugin and Tokenization
Thread-Index: AcuKK4AJ7c24GnGITYyH/taTWy1Bfw==
Date: Mon, 22 Nov 2010 09:56:14 +0000
Message-ID: <56F65098677DF5489254BE51675614E405E5FF@008-AM1MPN1-006.mgdnok.nokia.com>
Accept-Language: de-DE, en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
x-cr-hashedpuzzle: bfI= A/qn CQyT CXaZ Ci6k DvfC Dwxj EWSP FD1c GFmw GGXD
 GR2l GuG2 G9qw JkHH
 K5hc;1;agBhAHYAYQAtAHUAcwBlAHIAQABsAHUAYwBlAG4AZQAuAGEAcABhAGMAaABlAC4AbwByAGcA;Sosha1_v1;7;{6B922782-0218-4F07-AFB1-D2D4ABDD9A13};agBhAG4ALgBrAHUAcgBlAGwAbABhAEAAbgBvAGsAaQBhAC4AYwBvAG0A;Mon,
 22 Nov 2010 09:56:14
 GMT;WwBTAE8ATABSAF0AIABEAGkAcwBNAGEAeABRAFAAYQByAHMAZQByAFAAbAB1AGcAaQBuACAAYQBuAGQAIABUAG8AawBlAG4AaQB6AGEAdABpAG8AbgA=
x-cr-puzzleid: {6B922782-0218-4F07-AFB1-D2D4ABDD9A13}
Content-Type: multipart/alternative;
	boundary="_000_56F65098677DF5489254BE51675614E405E5FF008AM1MPN1006mgdn_"
MIME-Version: 1.0
X-OriginalArrivalTime: 22 Nov 2010 09:56:24.0966 (UTC) FILETIME=[862F3A60:01CB8A2B]
X-Nokia-AV: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

--_000_56F65098677DF5489254BE51675614E405E5FF008AM1MPN1006mgdn_
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

SGksDQoNCmlmIHRoZXJlIGlzIGEgc29sciBuZXdzZ3JvdXAgYmV0dGVyIHN1aXRlZCBmb3JtIHkg
cXVlc3Rpb24sIHBsZWFzZSBwb2ludCBtZSB0aGVyZS4NCg0KVXNpbmcgdGhlIFNlYXJjaEhhbmRs
ZXIgd2l0aCB0aGUgZGVmdHlwZT3igJ1kaXNtYXjigJ0gb3B0aW9uIGVuYWJsZXMgdGhlIERpc01h
eFFQYXJzZXJQbHVnaW4uIEZyb20gaW52ZXN0aWdhdGluZyBpdCBzZWVtcywgaXQgaXMganVzdCB0
b2tlbml6aW5nIGJ5IHdoaXRlc3BhY2UuDQoNCkFsdGhvdWdoIGJ5IGxvb2tpbmcgaW4gdGhlIGNv
ZGUgSSBjb3VsZCBub3QgZmluZCB0aGUgcGxhY2UsIHdoZXJlIHRoaXMgYmVoYXZpb3IgaXMgZW5m
b3JjZWQ/IEkgb25seSBmb3VuZCwgdGhhdCBmb3IgZWFjaCBmaWVsZCB0aGUgZ2V0RmllbGRRdWVy
eSgpIG1ldGhvZCBpcyBjYWxsZWQsIHdoaWNoIGVpdGhlciB0aHJvd3MgYW4g4oCcdW5rbm93bkZp
ZWxk4oCdIGV4Y2VwdGlvbiBvciByZXR1cm5zIHRoZSBjb3JyZWN0IGFuYWx5emVyIGluY2x1ZGlu
ZyB0b2tlbml6ZXIgYW5kIGZpbHRlciBmb3IgdGhlIGdpdmVuIGZpZWxkLg0KDQpXZSB3YW50IHRv
IHVzZSBhIG1vcmUgZmFuY2llciBUb2tlbml6ZXIvZmlsdGVyIHNldHRpbmcgd2l0aCB0aGUgRGlz
TWF4UXVlcnkgc3R1ZmYuDQoNCldoZXJlIHRvIGhvb2sgaW4gYmVzdD8NCg0KSmFuDQo=

--_000_56F65098677DF5489254BE51675614E405E5FF008AM1MPN1006mgdn_--

From java-user-return-47872-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 10:12:48 2010
Return-Path: <java-user-return-47872-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73352 invoked from network); 22 Nov 2010 10:12:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 10:12:48 -0000
Received: (qmail 13593 invoked by uid 500); 22 Nov 2010 10:13:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13366 invoked by uid 500); 22 Nov 2010 10:13:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13358 invoked by uid 99); 22 Nov 2010 10:13:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 10:13:16 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 10:13:08 +0000
Received: by bwz9 with SMTP id 9so6780582bwz.35
        for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 02:12:48 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=xvpt8EDQHExalm6gTVUgisjZ/qL5W/lUxcXq3Mmmwwk=;
        b=qZbksJ9RjBKSUjsipsY87Hl1s+nABs5e7C5MBPn7HJAwIIAUYgmtsdT9o9YwNMDTJE
         00vUK+JI7MNqG+1o2l0epZQ1i5J2kc3897tNZiXSFv0qG1CBlVIgsWxFDhed42k4q6d9
         kvqH4OEkui/IujX2elqxnVQAilg9RGHQJbqq8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=bI/ysHOSPy0RM+XgzA/hOUxT9zZx2hnunMvfa1Y15CmhpVtKjenPA78VwjPHFxfrAs
         ToeeJlAzt6IARkOMnFOyChJ+zNkEk+n6HfpG5bdbduWU7PZwnjQkFKpjiatzEgak7/iI
         nRfxsG03xMWNbSfq8hvPNlpKJknxIrhnAqWts=
Received: by 10.204.113.74 with SMTP id z10mr4969040bkp.25.1290420768402; Mon,
 22 Nov 2010 02:12:48 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Mon, 22 Nov 2010 02:12:27 -0800 (PST)
In-Reply-To: <56F65098677DF5489254BE51675614E405E5FF@008-AM1MPN1-006.mgdnok.nokia.com>
References: <56F65098677DF5489254BE51675614E405E5FF@008-AM1MPN1-006.mgdnok.nokia.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 22 Nov 2010 10:12:27 +0000
Message-ID: <AANLkTimdB0LU7FzJEJrb_7pGmZgqv7LU2BX_4QDbvASC@mail.gmail.com>
Subject: Re: [SOLR] DisMaxQParserPlugin and Tokenization
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

> if there is a solr newsgroup better suited form y question, please point me there.

http://lucene.apache.org/solr/mailing_lists.html


--
Ian.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47873-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 12:54:23 2010
Return-Path: <java-user-return-47873-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49201 invoked from network); 22 Nov 2010 12:54:23 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 12:54:23 -0000
Received: (qmail 81932 invoked by uid 500); 22 Nov 2010 12:54:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81517 invoked by uid 500); 22 Nov 2010 12:54:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81509 invoked by uid 99); 22 Nov 2010 12:54:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 12:54:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 12:54:47 +0000
Received: by qyk4 with SMTP id 4so198419qyk.14
        for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 04:54:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=3ltyrdyXjQuFavt/SRKepHg5aHg3f4tyawYSE6VPseQ=;
        b=xdzuQLfKPi1Gf7777g1Wr74mlzv4HzRpnuYOUo5Qwpw607Vy8nA0HWCIrU1NP5r6rJ
         RSN4FNjnNcMwNwi1OJZNbQvTkPiTEoeFQZBdd1kRJAZ3BuvjfKSILT9c4Ul0CG2LOfQG
         jKPB8vqVB72JN9MPCxJGAGRSecayXAgebcUZk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=wkK8PhQ2qby4gGkKwS2nbH1wbV965N5t5GISOsGYmGUFztsYMXi45HyPxiuzPtgdPV
         5oOlUkzaJu/Cebr8Iq300U/c55tCsMb1UkZRTQ1UnnD87UasAkCSD78ReL7eDNtF9D2g
         C6RZHD1RwOCzHS6nwoAjE//5FjWn5rHH/UWh8=
MIME-Version: 1.0
Received: by 10.224.32.165 with SMTP id c37mr5120965qad.97.1290430465812; Mon,
 22 Nov 2010 04:54:25 -0800 (PST)
Received: by 10.220.200.4 with HTTP; Mon, 22 Nov 2010 04:54:25 -0800 (PST)
In-Reply-To: <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
Date: Mon, 22 Nov 2010 07:54:25 -0500
Message-ID: <AANLkTi=hNefQZQYrRUQLgBzps29cM0-3Yp0jy=c+5xP2@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd6ec1285abd50495a3c1d5

--000e0cd6ec1285abd50495a3c1d5
Content-Type: text/plain; charset=ISO-8859-1

Are you looking at Solr? It has a lot of the infrastructure you'll be
building
yourself for Lucene already built in. Including replication, distributed
searching, etc. Yes, there's a learning curve for something new, but
your Lucene experience will help you a LOT with that. It has support
for sharding (which is what you'll certainly have to do to handle your
billion+ documents). Don't re-invent the wheel!!

In conjunction, see SolrJ which provides you a java interface to Solr which
may come in handy.

Start here: http://wiki.apache.org/solr/

Best
Erick

On Mon, Nov 22, 2010 at 1:46 AM, Luca Rondanini <luca.rondanini@gmail.com>wrote:

> Hi David, thanks for your answer. it really helped a lot! so, you have an
> index with more than 2 billions segments. this is pretty much the answer I
> was searching for: lucene alone is able to manage such a big index.
>
> which kind of problems do you have with the parallel searchers? I'm going
> to
> build my index in the next couple of weeks if you want we can confront our
> data
>
> thanks again
> Luca
>
>
> On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com> wrote:
>
> > Actually I've been bitten by an still-unresolved issue with the parallel
> > searchers and recommend a MultiReader instead.
> > We have a couple billion docs in our archives as well.  Breaking them up
> by
> > day worked well for us, but you'll need to do something.
> >
> > -----Original Message-----
> > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > Sent: Sunday, November 21, 2010 8:13 PM
> > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> > Subject: Re: best practice: 1.4 billions documents
> >
> > thank you both!
> >
> > Johannes, katta seems interesting but I will need to solve the problems
> of
> > "hot" updates to the index
> >
> > Yonik, I see your point - so your suggestion would be to build an
> > architecture based on ParallelMultiSearcher?
> >
> >
> > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley <
> yonik@lucidimagination.com
> > >wrote:
> >
> > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > > <luca.rondanini@gmail.com> wrote:
> > > > Hi everybody,
> > > >
> > > > I really need some good advice! I need to index in lucene something
> > like
> > > 1.4
> > > > billions documents. I had experience in lucene but I've never worked
> > with
> > > > such a big number of documents. Also this is just the number of docs
> at
> > > > "start-up": they are going to grow and fast.
> > > >
> > > > I don't have to tell you that I need the system to be fast and to
> > support
> > > > real time updates to the documents
> > > >
> > > > The first solution that came to my mind was to use
> > ParallelMultiSearcher,
> > > > splitting the index into many "sub-index" (how many docs per index?
> > > > 100,000?) but I don't have experience with it and I don't know how
> well
> > > will
> > > > scale while the number of documents grows!
> > > >
> > > > A more solid solution seems to build some kind of integration with
> > > hadoop.
> > > > But I didn't find match about lucene and hadoop integration.
> > > >
> > > > Any idea? Which direction should I go (pure lucene or hadoop)?
> > >
> > > There seems to be a common misconception about hadoop regarding search.
> > > Map-reduce as implemented in hadoop is really for batch oriented jobs
> > > only (or those types of jobs where you don't need a quick response
> > > time).  It's definitely not for normal queries (unless you have
> > > unusual requirements).
> > >
> > > -Yonik
> > > http://www.lucidimagination.com
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
>

--000e0cd6ec1285abd50495a3c1d5--

From java-user-return-47874-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 15:53:56 2010
Return-Path: <java-user-return-47874-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37461 invoked from network); 22 Nov 2010 15:53:56 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 15:53:56 -0000
Received: (qmail 71399 invoked by uid 500); 22 Nov 2010 15:54:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71266 invoked by uid 500); 22 Nov 2010 15:54:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71258 invoked by uid 99); 22 Nov 2010 15:54:21 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 15:54:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 15:54:17 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 10:53:50 -0500
Message-ID: <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
In-Reply-To: <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: best practice: 1.4 billions documents
Thread-Index: AcuKERQqXmFAvYFzTu+x9MGX+qLqewASxj6g
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>

Pj4gV2UgaGF2ZSBhIGNvdXBsZSBiaWxsaW9uIGRvY3MgaW4gb3VyIGFyY2hpdmVzIGFzIHdlbGwu
Li5CcmVha2luZyB0aGVtIHVwIGJ5IGRheSB3b3JrZWQgd2VsbCBmb3IgdXMNCg0KV2UgZG8gbm90
IGhhdmUgMiBiaWxsaW9uIHNlZ21lbnRzIGluIG9uZSBpbmRleCAgV2UgaGF2ZSByb3VnaGx5IDUt
MTAgbWlsbGlvbiBkb2N1bWVudHMgcGVyIGluZGV4LiBXZSBhcmUgY3VycmVudGx5IHVzaW5nIGEg
bWlsdGlzZWFyY2hlciBidXQgdW5yZXNvbHZlZCBsdWNlbmUgaXNzdWVzIGluIHRoaXMgd2lsbCBm
b3JjZSB1cyB0byBtb3ZlIHRvIGEgbXVsdGlyZWFkZXIuDQoNCkFzIGZhciBhcyB0aGUgcGFyYWxs
ZWwgc2VhcmNoZXIgZ29lcywgcmVhZCBiYWNrIG9uIHRoZSB0aHJlYWQgd2l0aCBzdWJqZWN0ICJT
ZWFyY2ggcmV0dXJuaW5nIGRvY3VtZW50cyBtYXRjaGluZyBhIE5PVCByYW5nZSIuDQpUaGVyZSBp
cyBhbiBhY2tub3dsZWRnZWQvcHJvdmVuIGJ1ZyB3aXRoIGEgc21hbGwgdW5pdCB0ZXN0LCBidXQg
dGhlcmUgaXMgc29tZSBkaXNhZ3JlZW1lbnQgYWJvdXQgdGhlIGludGVybmFsIHJlYXNvbnMgaXQg
ZmFpbHMuIEkgaGF2ZSBiZWVuIHVuYWJsZSB0byBnZW5lcmF0ZSBmdXJ0aGVyIGRpc2N1c3Npb24g
b3IgYSByZXNvbHV0aW9uLiBUaGlzIHdhcyBzdXBwb3NlZCB0byBiZSBhZGRlZCBhcyBhIGJ1ZyB0
byB0aGUgSklSQSBmb3IgdGhlIDMuMyByZWxlYXNlLCBidXQgaGFzIG5vdCBiZWVuLiAgSSBhbSBu
b3Qgd2hpY2ggY2xhc3MgU29sciB1c2VzLCBidXQgaWYgaXQgdXNlcyBNdWx0aVNlYXJjaGVyLCBp
dCB3aWxsIGhhdmUgdGhlIHNhbWUgYnVnLg0KDQotLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0K
RnJvbTogTHVjYSBSb25kYW5pbmkgW21haWx0bzpsdWNhLnJvbmRhbmluaUBnbWFpbC5jb21dIA0K
U2VudDogTW9uZGF5LCBOb3ZlbWJlciAyMiwgMjAxMCAxOjQ3IEFNDQpUbzogamF2YS11c2VyQGx1
Y2VuZS5hcGFjaGUub3JnDQpTdWJqZWN0OiBSZTogYmVzdCBwcmFjdGljZTogMS40IGJpbGxpb25z
IGRvY3VtZW50cw0KDQpIaSBEYXZpZCwgdGhhbmtzIGZvciB5b3VyIGFuc3dlci4gaXQgcmVhbGx5
IGhlbHBlZCBhIGxvdCEgc28sIHlvdSBoYXZlIGFuDQppbmRleCB3aXRoIG1vcmUgdGhhbiAyIGJp
bGxpb25zIHNlZ21lbnRzLiB0aGlzIGlzIHByZXR0eSBtdWNoIHRoZSBhbnN3ZXIgSQ0Kd2FzIHNl
YXJjaGluZyBmb3I6IGx1Y2VuZSBhbG9uZSBpcyBhYmxlIHRvIG1hbmFnZSBzdWNoIGEgYmlnIGlu
ZGV4Lg0KDQp3aGljaCBraW5kIG9mIHByb2JsZW1zIGRvIHlvdSBoYXZlIHdpdGggdGhlIHBhcmFs
bGVsIHNlYXJjaGVycz8gSSdtIGdvaW5nIHRvDQpidWlsZCBteSBpbmRleCBpbiB0aGUgbmV4dCBj
b3VwbGUgb2Ygd2Vla3MgaWYgeW91IHdhbnQgd2UgY2FuIGNvbmZyb250IG91cg0KZGF0YQ0KDQp0
aGFua3MgYWdhaW4NCkx1Y2ENCg0KDQpPbiBTdW4sIE5vdiAyMSwgMjAxMCBhdCA2OjIyIFBNLCBE
YXZpZCBGZXJ0aWcgPGRmZXJ0aWdAY3ltZm9ueS5jb20+IHdyb3RlOg0KDQo+IEFjdHVhbGx5IEkn
dmUgYmVlbiBiaXR0ZW4gYnkgYW4gc3RpbGwtdW5yZXNvbHZlZCBpc3N1ZSB3aXRoIHRoZSBwYXJh
bGxlbA0KPiBzZWFyY2hlcnMgYW5kIHJlY29tbWVuZCBhIE11bHRpUmVhZGVyIGluc3RlYWQuDQo+
IFdlIGhhdmUgYSBjb3VwbGUgYmlsbGlvbiBkb2NzIGluIG91ciBhcmNoaXZlcyBhcyB3ZWxsLiAg
QnJlYWtpbmcgdGhlbSB1cCBieQ0KPiBkYXkgd29ya2VkIHdlbGwgZm9yIHVzLCBidXQgeW91J2xs
IG5lZWQgdG8gZG8gc29tZXRoaW5nLg0KPg0KPiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0K
PiBGcm9tOiBMdWNhIFJvbmRhbmluaSBbbWFpbHRvOmx1Y2Eucm9uZGFuaW5pQGdtYWlsLmNvbV0N
Cj4gU2VudDogU3VuZGF5LCBOb3ZlbWJlciAyMSwgMjAxMCA4OjEzIFBNDQo+IFRvOiBqYXZhLXVz
ZXJAbHVjZW5lLmFwYWNoZS5vcmc7IHlvbmlrQGx1Y2lkaW1hZ2luYXRpb24uY29tDQo+IFN1Ympl
Y3Q6IFJlOiBiZXN0IHByYWN0aWNlOiAxLjQgYmlsbGlvbnMgZG9jdW1lbnRzDQo+DQo+IHRoYW5r
IHlvdSBib3RoIQ0KPg0KPiBKb2hhbm5lcywga2F0dGEgc2VlbXMgaW50ZXJlc3RpbmcgYnV0IEkg
d2lsbCBuZWVkIHRvIHNvbHZlIHRoZSBwcm9ibGVtcyBvZg0KPiAiaG90IiB1cGRhdGVzIHRvIHRo
ZSBpbmRleA0KPg0KPiBZb25paywgSSBzZWUgeW91ciBwb2ludCAtIHNvIHlvdXIgc3VnZ2VzdGlv
biB3b3VsZCBiZSB0byBidWlsZCBhbg0KPiBhcmNoaXRlY3R1cmUgYmFzZWQgb24gUGFyYWxsZWxN
dWx0aVNlYXJjaGVyPw0KPg0KPg0KPiBPbiBTdW4sIE5vdiAyMSwgMjAxMCBhdCAzOjQ4IFBNLCBZ
b25payBTZWVsZXkgPHlvbmlrQGx1Y2lkaW1hZ2luYXRpb24uY29tDQo+ID53cm90ZToNCj4NCj4g
PiBPbiBTdW4sIE5vdiAyMSwgMjAxMCBhdCA2OjMzIFBNLCBMdWNhIFJvbmRhbmluaQ0KPiA+IDxs
dWNhLnJvbmRhbmluaUBnbWFpbC5jb20+IHdyb3RlOg0KPiA+ID4gSGkgZXZlcnlib2R5LA0KPiA+
ID4NCj4gPiA+IEkgcmVhbGx5IG5lZWQgc29tZSBnb29kIGFkdmljZSEgSSBuZWVkIHRvIGluZGV4
IGluIGx1Y2VuZSBzb21ldGhpbmcNCj4gbGlrZQ0KPiA+IDEuNA0KPiA+ID4gYmlsbGlvbnMgZG9j
dW1lbnRzLiBJIGhhZCBleHBlcmllbmNlIGluIGx1Y2VuZSBidXQgSSd2ZSBuZXZlciB3b3JrZWQN
Cj4gd2l0aA0KPiA+ID4gc3VjaCBhIGJpZyBudW1iZXIgb2YgZG9jdW1lbnRzLiBBbHNvIHRoaXMg
aXMganVzdCB0aGUgbnVtYmVyIG9mIGRvY3MgYXQNCj4gPiA+ICJzdGFydC11cCI6IHRoZXkgYXJl
IGdvaW5nIHRvIGdyb3cgYW5kIGZhc3QuDQo+ID4gPg0KPiA+ID4gSSBkb24ndCBoYXZlIHRvIHRl
bGwgeW91IHRoYXQgSSBuZWVkIHRoZSBzeXN0ZW0gdG8gYmUgZmFzdCBhbmQgdG8NCj4gc3VwcG9y
dA0KPiA+ID4gcmVhbCB0aW1lIHVwZGF0ZXMgdG8gdGhlIGRvY3VtZW50cw0KPiA+ID4NCj4gPiA+
IFRoZSBmaXJzdCBzb2x1dGlvbiB0aGF0IGNhbWUgdG8gbXkgbWluZCB3YXMgdG8gdXNlDQo+IFBh
cmFsbGVsTXVsdGlTZWFyY2hlciwNCj4gPiA+IHNwbGl0dGluZyB0aGUgaW5kZXggaW50byBtYW55
ICJzdWItaW5kZXgiIChob3cgbWFueSBkb2NzIHBlciBpbmRleD8NCj4gPiA+IDEwMCwwMDA/KSBi
dXQgSSBkb24ndCBoYXZlIGV4cGVyaWVuY2Ugd2l0aCBpdCBhbmQgSSBkb24ndCBrbm93IGhvdyB3
ZWxsDQo+ID4gd2lsbA0KPiA+ID4gc2NhbGUgd2hpbGUgdGhlIG51bWJlciBvZiBkb2N1bWVudHMg
Z3Jvd3MhDQo+ID4gPg0KPiA+ID4gQSBtb3JlIHNvbGlkIHNvbHV0aW9uIHNlZW1zIHRvIGJ1aWxk
IHNvbWUga2luZCBvZiBpbnRlZ3JhdGlvbiB3aXRoDQo+ID4gaGFkb29wLg0KPiA+ID4gQnV0IEkg
ZGlkbid0IGZpbmQgbWF0Y2ggYWJvdXQgbHVjZW5lIGFuZCBoYWRvb3AgaW50ZWdyYXRpb24uDQo+
ID4gPg0KPiA+ID4gQW55IGlkZWE/IFdoaWNoIGRpcmVjdGlvbiBzaG91bGQgSSBnbyAocHVyZSBs
dWNlbmUgb3IgaGFkb29wKT8NCj4gPg0KPiA+IFRoZXJlIHNlZW1zIHRvIGJlIGEgY29tbW9uIG1p
c2NvbmNlcHRpb24gYWJvdXQgaGFkb29wIHJlZ2FyZGluZyBzZWFyY2guDQo+ID4gTWFwLXJlZHVj
ZSBhcyBpbXBsZW1lbnRlZCBpbiBoYWRvb3AgaXMgcmVhbGx5IGZvciBiYXRjaCBvcmllbnRlZCBq
b2JzDQo+ID4gb25seSAob3IgdGhvc2UgdHlwZXMgb2Ygam9icyB3aGVyZSB5b3UgZG9uJ3QgbmVl
ZCBhIHF1aWNrIHJlc3BvbnNlDQo+ID4gdGltZSkuICBJdCdzIGRlZmluaXRlbHkgbm90IGZvciBu
b3JtYWwgcXVlcmllcyAodW5sZXNzIHlvdSBoYXZlDQo+ID4gdW51c3VhbCByZXF1aXJlbWVudHMp
Lg0KPiA+DQo+ID4gLVlvbmlrDQo+ID4gaHR0cDovL3d3dy5sdWNpZGltYWdpbmF0aW9uLmNvbQ0K
PiA+DQo+ID4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tDQo+ID4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11
c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+ID4gRm9yIGFkZGl0aW9uYWwgY29t
bWFuZHMsIGUtbWFpbDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4gPg0KPiA+
DQo+DQo=


From java-user-return-47875-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 16:18:34 2010
Return-Path: <java-user-return-47875-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52440 invoked from network); 22 Nov 2010 16:18:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 16:18:33 -0000
Received: (qmail 93491 invoked by uid 500); 22 Nov 2010 16:19:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93244 invoked by uid 500); 22 Nov 2010 16:19:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93236 invoked by uid 99); 22 Nov 2010 16:19:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 16:19:00 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 16:18:55 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 5EBE6D36009
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 17:18:33 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id DP0yRVhLOfXR for <java-user@lucene.apache.org>;
	Mon, 22 Nov 2010 17:18:27 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 37526D36008
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 17:18:27 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
In-Reply-To: <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 17:18:51 +0100
Message-ID: <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAmS8ga8kA==
Content-Language: de

There is no reason to use MultiSearcher instead the much more consistent =
and effective  MultiReader! We (Robert and me) are already planning to =
deprecate it. MultiSearcher itsself has no benefit over a simple =
IndexSearcher on top of a MultiReader since Lucene 2.9, it has only =
problems.

Use cases for real MultiSearchers are only the subclasses for "remote =
search" or (perhaps) multi-threaded search, but the latter I would not =
recommend (instead let the additional CPUs in your machine be free for =
other users doing searches in parallel). Multithreading a single search =
should not be done, as it slows down multiple users accessing the same =
index at the same time. Spend the additional CPU power for other things =
like warming searchers, indexing additional documents, or filling =
FieldCache in parallel.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: David Fertig [mailto:dfertig@cymfony.com]
> Sent: Monday, November 22, 2010 4:54 PM
> To: java-user@lucene.apache.org
> Subject: RE: best practice: 1.4 billions documents
>=20
> >> We have a couple billion docs in our archives as well...Breaking =
them
> >> up by day worked well for us
>=20
> We do not have 2 billion segments in one index  We have roughly 5-10 =
million
> documents per index. We are currently using a miltisearcher but =
unresolved
> lucene issues in this will force us to move to a multireader.
>=20
> As far as the parallel searcher goes, read back on the thread with =
subject
> "Search returning documents matching a NOT range".
> There is an acknowledged/proven bug with a small unit test, but there =
is some
> disagreement about the internal reasons it fails. I have been unable =
to
> generate further discussion or a resolution. This was supposed to be =
added as a
> bug to the JIRA for the 3.3 release, but has not been.  I am not which =
class Solr
> uses, but if it uses MultiSearcher, it will have the same bug.
>=20
> -----Original Message-----
> From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> Sent: Monday, November 22, 2010 1:47 AM
> To: java-user@lucene.apache.org
> Subject: Re: best practice: 1.4 billions documents
>=20
> Hi David, thanks for your answer. it really helped a lot! so, you have =
an index
> with more than 2 billions segments. this is pretty much the answer I =
was
> searching for: lucene alone is able to manage such a big index.
>=20
> which kind of problems do you have with the parallel searchers? I'm =
going to
> build my index in the next couple of weeks if you want we can confront =
our
> data
>=20
> thanks again
> Luca
>=20
>=20
> On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com> =
wrote:
>=20
> > Actually I've been bitten by an still-unresolved issue with the
> > parallel searchers and recommend a MultiReader instead.
> > We have a couple billion docs in our archives as well.  Breaking =
them
> > up by day worked well for us, but you'll need to do something.
> >
> > -----Original Message-----
> > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > Sent: Sunday, November 21, 2010 8:13 PM
> > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> > Subject: Re: best practice: 1.4 billions documents
> >
> > thank you both!
> >
> > Johannes, katta seems interesting but I will need to solve the
> > problems of "hot" updates to the index
> >
> > Yonik, I see your point - so your suggestion would be to build an
> > architecture based on ParallelMultiSearcher?
> >
> >
> > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
> > <yonik@lucidimagination.com
> > >wrote:
> >
> > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > > <luca.rondanini@gmail.com> wrote:
> > > > Hi everybody,
> > > >
> > > > I really need some good advice! I need to index in lucene
> > > > something
> > like
> > > 1.4
> > > > billions documents. I had experience in lucene but I've never
> > > > worked
> > with
> > > > such a big number of documents. Also this is just the number of
> > > > docs at
> > > > "start-up": they are going to grow and fast.
> > > >
> > > > I don't have to tell you that I need the system to be fast and =
to
> > support
> > > > real time updates to the documents
> > > >
> > > > The first solution that came to my mind was to use
> > ParallelMultiSearcher,
> > > > splitting the index into many "sub-index" (how many docs per =
index?
> > > > 100,000?) but I don't have experience with it and I don't know =
how
> > > > well
> > > will
> > > > scale while the number of documents grows!
> > > >
> > > > A more solid solution seems to build some kind of integration =
with
> > > hadoop.
> > > > But I didn't find match about lucene and hadoop integration.
> > > >
> > > > Any idea? Which direction should I go (pure lucene or hadoop)?
> > >
> > > There seems to be a common misconception about hadoop regarding
> search.
> > > Map-reduce as implemented in hadoop is really for batch oriented
> > > jobs only (or those types of jobs where you don't need a quick
> > > response time).  It's definitely not for normal queries (unless =
you
> > > have unusual requirements).
> > >
> > > -Yonik
> > > http://www.lucidimagination.com
> > >
> > > =
--------------------------------------------------------------------
> > > - To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47876-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 16:20:57 2010
Return-Path: <java-user-return-47876-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53097 invoked from network); 22 Nov 2010 16:20:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 16:20:57 -0000
Received: (qmail 96649 invoked by uid 500); 22 Nov 2010 16:21:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96429 invoked by uid 500); 22 Nov 2010 16:21:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96414 invoked by uid 99); 22 Nov 2010 16:21:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 16:21:23 +0000
X-ASF-Spam-Status: No, hits=0.6 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [64.208.49.57] (HELO smail2.alcatel.fr) (64.208.49.57)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 16:21:14 +0000
Received: from FRMRSSXCHHUB03.dc-m.alcatel-lucent.com (FRMRSSXCHHUB03.dc-m.alcatel-lucent.com [135.120.45.63])
	by smail2.alcatel.fr (8.14.3/8.14.3/ICT) with ESMTP id oAMGKqsU020450
	(version=TLSv1/SSLv3 cipher=RC4-MD5 bits=128 verify=NOT)
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 17:20:53 +0100
Received: from FRMRSSXCHMBSD1.dc-m.alcatel-lucent.com ([135.120.45.51]) by
 FRMRSSXCHHUB03.dc-m.alcatel-lucent.com ([135.120.45.63]) with mapi; Mon, 22
 Nov 2010 17:20:52 +0100
From: "ZYWALEWSKI, DANIEL (DANIEL)" <daniel.zywalewski@alcatel-lucent.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 22 Nov 2010 17:20:51 +0100
Subject: incremental indexation
Thread-Topic: incremental indexation
Thread-Index: AcuKYTrytS3ccVYBRd2buuwH8uKHYw==
Message-ID: <DD3CD532C204E24992220E891AD05CA4472C4D8B56@FRMRSSXCHMBSD1.dc-m.alcatel-lucent.com>
Accept-Language: fr-FR, en-US
Content-Language: fr-FR
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: fr-FR, en-US
Content-Type: multipart/alternative;
	boundary="_000_DD3CD532C204E24992220E891AD05CA4472C4D8B56FRMRSSXCHMBSD_"
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.64 on 155.132.188.80
X-Virus-Checked: Checked by ClamAV on apache.org

--_000_DD3CD532C204E24992220E891AD05CA4472C4D8B56FRMRSSXCHMBSD_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hello,
 I'm just stuck with one problem and don't know how to figure it out. I'm w=
orking on the indexation of the objects that are in computer memory (they e=
xist only in my java code). Don't have any problems with indexing it, howev=
er I have no idea how to re-index it if they change during the execution of=
 this code; one of my ideas is adding some events to this objects (if you c=
hange any parameters -> reindex it ). However I'm not sure about its effici=
ency?
 Thank you in advance
   Daniel


--_000_DD3CD532C204E24992220E891AD05CA4472C4D8B56FRMRSSXCHMBSD_--

From java-user-return-47877-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 16:57:03 2010
Return-Path: <java-user-return-47877-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16503 invoked from network); 22 Nov 2010 16:57:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 16:57:02 -0000
Received: (qmail 50068 invoked by uid 500); 22 Nov 2010 16:57:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50015 invoked by uid 500); 22 Nov 2010 16:57:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50007 invoked by uid 99); 22 Nov 2010 16:57:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 16:57:31 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.83.124.80] (HELO buf-ex02.cymfony.com) (208.83.124.80)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 16:57:27 +0000
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: base64
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 11:57:04 -0500
Message-ID: <E5331E53F021E443B53EC78F375B3C761F9443@buf-ex02.cymfony.com>
In-Reply-To: <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: best practice: 1.4 billions documents
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAmS8ga8kIAAC6iA
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com> <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
From: "David Fertig" <dfertig@cymfony.com>
To: <java-user@lucene.apache.org>

PiBpdCBoYXMgb25seSBwcm9ibGVtcy4NClBlcmhhcHMgdGhlc2Uga25vd24gcHJvYmxlbXMgc2hv
dWxkIGJlIGFkZGVkIHRvIHRoZSBkb2MgYXBpLCBzbyB1c2VycyB3aG8gYXJlIGVuY291cmFnZWQg
dG8gc3RhcnQgY2xlYW4gd2l0aCB0aGUgMy54IEFQSSBkb24ndCBidWlsZCBiYWQgYXBwbGljYXRp
b25zIGZyb20gc2NyYXRjaD8NCg0KUGFyYWxsZWwgc2VhcmNoaW5nIGlzIGV4dHJlbWVseSBwb3dl
cmZ1bCBhbmQgc2hvdWxkIG5vdCBiZSBhYmFuZG9uZWQuDQoNCg0KDQotLS0tLU9yaWdpbmFsIE1l
c3NhZ2UtLS0tLQ0KRnJvbTogVXdlIFNjaGluZGxlciBbbWFpbHRvOnV3ZUB0aGV0YXBoaS5kZV0g
DQpTZW50OiBNb25kYXksIE5vdmVtYmVyIDIyLCAyMDEwIDExOjE5IEFNDQpUbzogamF2YS11c2Vy
QGx1Y2VuZS5hcGFjaGUub3JnDQpTdWJqZWN0OiBSRTogYmVzdCBwcmFjdGljZTogMS40IGJpbGxp
b25zIGRvY3VtZW50cw0KDQpUaGVyZSBpcyBubyByZWFzb24gdG8gdXNlIE11bHRpU2VhcmNoZXIg
aW5zdGVhZCB0aGUgbXVjaCBtb3JlIGNvbnNpc3RlbnQgYW5kIGVmZmVjdGl2ZSAgTXVsdGlSZWFk
ZXIhIFdlIChSb2JlcnQgYW5kIG1lKSBhcmUgYWxyZWFkeSBwbGFubmluZyB0byBkZXByZWNhdGUg
aXQuIE11bHRpU2VhcmNoZXIgaXRzc2VsZiBoYXMgbm8gYmVuZWZpdCBvdmVyIGEgc2ltcGxlIElu
ZGV4U2VhcmNoZXIgb24gdG9wIG9mIGEgTXVsdGlSZWFkZXIgc2luY2UgTHVjZW5lIDIuOSwgaXQg
aGFzIG9ubHkgcHJvYmxlbXMuDQoNClVzZSBjYXNlcyBmb3IgcmVhbCBNdWx0aVNlYXJjaGVycyBh
cmUgb25seSB0aGUgc3ViY2xhc3NlcyBmb3IgInJlbW90ZSBzZWFyY2giIG9yIChwZXJoYXBzKSBt
dWx0aS10aHJlYWRlZCBzZWFyY2gsIGJ1dCB0aGUgbGF0dGVyIEkgd291bGQgbm90IHJlY29tbWVu
ZCAoaW5zdGVhZCBsZXQgdGhlIGFkZGl0aW9uYWwgQ1BVcyBpbiB5b3VyIG1hY2hpbmUgYmUgZnJl
ZSBmb3Igb3RoZXIgdXNlcnMgZG9pbmcgc2VhcmNoZXMgaW4gcGFyYWxsZWwpLiBNdWx0aXRocmVh
ZGluZyBhIHNpbmdsZSBzZWFyY2ggc2hvdWxkIG5vdCBiZSBkb25lLCBhcyBpdCBzbG93cyBkb3du
IG11bHRpcGxlIHVzZXJzIGFjY2Vzc2luZyB0aGUgc2FtZSBpbmRleCBhdCB0aGUgc2FtZSB0aW1l
LiBTcGVuZCB0aGUgYWRkaXRpb25hbCBDUFUgcG93ZXIgZm9yIG90aGVyIHRoaW5ncyBsaWtlIHdh
cm1pbmcgc2VhcmNoZXJzLCBpbmRleGluZyBhZGRpdGlvbmFsIGRvY3VtZW50cywgb3IgZmlsbGlu
ZyBGaWVsZENhY2hlIGluIHBhcmFsbGVsLg0KDQpVd2UNCg0KLS0tLS0NClV3ZSBTY2hpbmRsZXIN
CkguLUguLU1laWVyLUFsbGVlIDYzLCBELTI4MjEzIEJyZW1lbg0KaHR0cDovL3d3dy50aGV0YXBo
aS5kZQ0KZU1haWw6IHV3ZUB0aGV0YXBoaS5kZQ0KDQoNCj4gLS0tLS1PcmlnaW5hbCBNZXNzYWdl
LS0tLS0NCj4gRnJvbTogRGF2aWQgRmVydGlnIFttYWlsdG86ZGZlcnRpZ0BjeW1mb255LmNvbV0N
Cj4gU2VudDogTW9uZGF5LCBOb3ZlbWJlciAyMiwgMjAxMCA0OjU0IFBNDQo+IFRvOiBqYXZhLXVz
ZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4gU3ViamVjdDogUkU6IGJlc3QgcHJhY3RpY2U6IDEuNCBi
aWxsaW9ucyBkb2N1bWVudHMNCj4gDQo+ID4+IFdlIGhhdmUgYSBjb3VwbGUgYmlsbGlvbiBkb2Nz
IGluIG91ciBhcmNoaXZlcyBhcyB3ZWxsLi4uQnJlYWtpbmcgdGhlbQ0KPiA+PiB1cCBieSBkYXkg
d29ya2VkIHdlbGwgZm9yIHVzDQo+IA0KPiBXZSBkbyBub3QgaGF2ZSAyIGJpbGxpb24gc2VnbWVu
dHMgaW4gb25lIGluZGV4ICBXZSBoYXZlIHJvdWdobHkgNS0xMCBtaWxsaW9uDQo+IGRvY3VtZW50
cyBwZXIgaW5kZXguIFdlIGFyZSBjdXJyZW50bHkgdXNpbmcgYSBtaWx0aXNlYXJjaGVyIGJ1dCB1
bnJlc29sdmVkDQo+IGx1Y2VuZSBpc3N1ZXMgaW4gdGhpcyB3aWxsIGZvcmNlIHVzIHRvIG1vdmUg
dG8gYSBtdWx0aXJlYWRlci4NCj4gDQo+IEFzIGZhciBhcyB0aGUgcGFyYWxsZWwgc2VhcmNoZXIg
Z29lcywgcmVhZCBiYWNrIG9uIHRoZSB0aHJlYWQgd2l0aCBzdWJqZWN0DQo+ICJTZWFyY2ggcmV0
dXJuaW5nIGRvY3VtZW50cyBtYXRjaGluZyBhIE5PVCByYW5nZSIuDQo+IFRoZXJlIGlzIGFuIGFj
a25vd2xlZGdlZC9wcm92ZW4gYnVnIHdpdGggYSBzbWFsbCB1bml0IHRlc3QsIGJ1dCB0aGVyZSBp
cyBzb21lDQo+IGRpc2FncmVlbWVudCBhYm91dCB0aGUgaW50ZXJuYWwgcmVhc29ucyBpdCBmYWls
cy4gSSBoYXZlIGJlZW4gdW5hYmxlIHRvDQo+IGdlbmVyYXRlIGZ1cnRoZXIgZGlzY3Vzc2lvbiBv
ciBhIHJlc29sdXRpb24uIFRoaXMgd2FzIHN1cHBvc2VkIHRvIGJlIGFkZGVkIGFzIGENCj4gYnVn
IHRvIHRoZSBKSVJBIGZvciB0aGUgMy4zIHJlbGVhc2UsIGJ1dCBoYXMgbm90IGJlZW4uICBJIGFt
IG5vdCB3aGljaCBjbGFzcyBTb2xyDQo+IHVzZXMsIGJ1dCBpZiBpdCB1c2VzIE11bHRpU2VhcmNo
ZXIsIGl0IHdpbGwgaGF2ZSB0aGUgc2FtZSBidWcuDQo+IA0KPiAtLS0tLU9yaWdpbmFsIE1lc3Nh
Z2UtLS0tLQ0KPiBGcm9tOiBMdWNhIFJvbmRhbmluaSBbbWFpbHRvOmx1Y2Eucm9uZGFuaW5pQGdt
YWlsLmNvbV0NCj4gU2VudDogTW9uZGF5LCBOb3ZlbWJlciAyMiwgMjAxMCAxOjQ3IEFNDQo+IFRv
OiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4gU3ViamVjdDogUmU6IGJlc3QgcHJhY3Rp
Y2U6IDEuNCBiaWxsaW9ucyBkb2N1bWVudHMNCj4gDQo+IEhpIERhdmlkLCB0aGFua3MgZm9yIHlv
dXIgYW5zd2VyLiBpdCByZWFsbHkgaGVscGVkIGEgbG90ISBzbywgeW91IGhhdmUgYW4gaW5kZXgN
Cj4gd2l0aCBtb3JlIHRoYW4gMiBiaWxsaW9ucyBzZWdtZW50cy4gdGhpcyBpcyBwcmV0dHkgbXVj
aCB0aGUgYW5zd2VyIEkgd2FzDQo+IHNlYXJjaGluZyBmb3I6IGx1Y2VuZSBhbG9uZSBpcyBhYmxl
IHRvIG1hbmFnZSBzdWNoIGEgYmlnIGluZGV4Lg0KPiANCj4gd2hpY2gga2luZCBvZiBwcm9ibGVt
cyBkbyB5b3UgaGF2ZSB3aXRoIHRoZSBwYXJhbGxlbCBzZWFyY2hlcnM/IEknbSBnb2luZyB0bw0K
PiBidWlsZCBteSBpbmRleCBpbiB0aGUgbmV4dCBjb3VwbGUgb2Ygd2Vla3MgaWYgeW91IHdhbnQg
d2UgY2FuIGNvbmZyb250IG91cg0KPiBkYXRhDQo+IA0KPiB0aGFua3MgYWdhaW4NCj4gTHVjYQ0K
PiANCj4gDQo+IE9uIFN1biwgTm92IDIxLCAyMDEwIGF0IDY6MjIgUE0sIERhdmlkIEZlcnRpZyA8
ZGZlcnRpZ0BjeW1mb255LmNvbT4gd3JvdGU6DQo+IA0KPiA+IEFjdHVhbGx5IEkndmUgYmVlbiBi
aXR0ZW4gYnkgYW4gc3RpbGwtdW5yZXNvbHZlZCBpc3N1ZSB3aXRoIHRoZQ0KPiA+IHBhcmFsbGVs
IHNlYXJjaGVycyBhbmQgcmVjb21tZW5kIGEgTXVsdGlSZWFkZXIgaW5zdGVhZC4NCj4gPiBXZSBo
YXZlIGEgY291cGxlIGJpbGxpb24gZG9jcyBpbiBvdXIgYXJjaGl2ZXMgYXMgd2VsbC4gIEJyZWFr
aW5nIHRoZW0NCj4gPiB1cCBieSBkYXkgd29ya2VkIHdlbGwgZm9yIHVzLCBidXQgeW91J2xsIG5l
ZWQgdG8gZG8gc29tZXRoaW5nLg0KPiA+DQo+ID4gLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0N
Cj4gPiBGcm9tOiBMdWNhIFJvbmRhbmluaSBbbWFpbHRvOmx1Y2Eucm9uZGFuaW5pQGdtYWlsLmNv
bV0NCj4gPiBTZW50OiBTdW5kYXksIE5vdmVtYmVyIDIxLCAyMDEwIDg6MTMgUE0NCj4gPiBUbzog
amF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3JnOyB5b25pa0BsdWNpZGltYWdpbmF0aW9uLmNvbQ0K
PiA+IFN1YmplY3Q6IFJlOiBiZXN0IHByYWN0aWNlOiAxLjQgYmlsbGlvbnMgZG9jdW1lbnRzDQo+
ID4NCj4gPiB0aGFuayB5b3UgYm90aCENCj4gPg0KPiA+IEpvaGFubmVzLCBrYXR0YSBzZWVtcyBp
bnRlcmVzdGluZyBidXQgSSB3aWxsIG5lZWQgdG8gc29sdmUgdGhlDQo+ID4gcHJvYmxlbXMgb2Yg
ImhvdCIgdXBkYXRlcyB0byB0aGUgaW5kZXgNCj4gPg0KPiA+IFlvbmlrLCBJIHNlZSB5b3VyIHBv
aW50IC0gc28geW91ciBzdWdnZXN0aW9uIHdvdWxkIGJlIHRvIGJ1aWxkIGFuDQo+ID4gYXJjaGl0
ZWN0dXJlIGJhc2VkIG9uIFBhcmFsbGVsTXVsdGlTZWFyY2hlcj8NCj4gPg0KPiA+DQo+ID4gT24g
U3VuLCBOb3YgMjEsIDIwMTAgYXQgMzo0OCBQTSwgWW9uaWsgU2VlbGV5DQo+ID4gPHlvbmlrQGx1
Y2lkaW1hZ2luYXRpb24uY29tDQo+ID4gPndyb3RlOg0KPiA+DQo+ID4gPiBPbiBTdW4sIE5vdiAy
MSwgMjAxMCBhdCA2OjMzIFBNLCBMdWNhIFJvbmRhbmluaQ0KPiA+ID4gPGx1Y2Eucm9uZGFuaW5p
QGdtYWlsLmNvbT4gd3JvdGU6DQo+ID4gPiA+IEhpIGV2ZXJ5Ym9keSwNCj4gPiA+ID4NCj4gPiA+
ID4gSSByZWFsbHkgbmVlZCBzb21lIGdvb2QgYWR2aWNlISBJIG5lZWQgdG8gaW5kZXggaW4gbHVj
ZW5lDQo+ID4gPiA+IHNvbWV0aGluZw0KPiA+IGxpa2UNCj4gPiA+IDEuNA0KPiA+ID4gPiBiaWxs
aW9ucyBkb2N1bWVudHMuIEkgaGFkIGV4cGVyaWVuY2UgaW4gbHVjZW5lIGJ1dCBJJ3ZlIG5ldmVy
DQo+ID4gPiA+IHdvcmtlZA0KPiA+IHdpdGgNCj4gPiA+ID4gc3VjaCBhIGJpZyBudW1iZXIgb2Yg
ZG9jdW1lbnRzLiBBbHNvIHRoaXMgaXMganVzdCB0aGUgbnVtYmVyIG9mDQo+ID4gPiA+IGRvY3Mg
YXQNCj4gPiA+ID4gInN0YXJ0LXVwIjogdGhleSBhcmUgZ29pbmcgdG8gZ3JvdyBhbmQgZmFzdC4N
Cj4gPiA+ID4NCj4gPiA+ID4gSSBkb24ndCBoYXZlIHRvIHRlbGwgeW91IHRoYXQgSSBuZWVkIHRo
ZSBzeXN0ZW0gdG8gYmUgZmFzdCBhbmQgdG8NCj4gPiBzdXBwb3J0DQo+ID4gPiA+IHJlYWwgdGlt
ZSB1cGRhdGVzIHRvIHRoZSBkb2N1bWVudHMNCj4gPiA+ID4NCj4gPiA+ID4gVGhlIGZpcnN0IHNv
bHV0aW9uIHRoYXQgY2FtZSB0byBteSBtaW5kIHdhcyB0byB1c2UNCj4gPiBQYXJhbGxlbE11bHRp
U2VhcmNoZXIsDQo+ID4gPiA+IHNwbGl0dGluZyB0aGUgaW5kZXggaW50byBtYW55ICJzdWItaW5k
ZXgiIChob3cgbWFueSBkb2NzIHBlciBpbmRleD8NCj4gPiA+ID4gMTAwLDAwMD8pIGJ1dCBJIGRv
bid0IGhhdmUgZXhwZXJpZW5jZSB3aXRoIGl0IGFuZCBJIGRvbid0IGtub3cgaG93DQo+ID4gPiA+
IHdlbGwNCj4gPiA+IHdpbGwNCj4gPiA+ID4gc2NhbGUgd2hpbGUgdGhlIG51bWJlciBvZiBkb2N1
bWVudHMgZ3Jvd3MhDQo+ID4gPiA+DQo+ID4gPiA+IEEgbW9yZSBzb2xpZCBzb2x1dGlvbiBzZWVt
cyB0byBidWlsZCBzb21lIGtpbmQgb2YgaW50ZWdyYXRpb24gd2l0aA0KPiA+ID4gaGFkb29wLg0K
PiA+ID4gPiBCdXQgSSBkaWRuJ3QgZmluZCBtYXRjaCBhYm91dCBsdWNlbmUgYW5kIGhhZG9vcCBp
bnRlZ3JhdGlvbi4NCj4gPiA+ID4NCj4gPiA+ID4gQW55IGlkZWE/IFdoaWNoIGRpcmVjdGlvbiBz
aG91bGQgSSBnbyAocHVyZSBsdWNlbmUgb3IgaGFkb29wKT8NCj4gPiA+DQo+ID4gPiBUaGVyZSBz
ZWVtcyB0byBiZSBhIGNvbW1vbiBtaXNjb25jZXB0aW9uIGFib3V0IGhhZG9vcCByZWdhcmRpbmcN
Cj4gc2VhcmNoLg0KPiA+ID4gTWFwLXJlZHVjZSBhcyBpbXBsZW1lbnRlZCBpbiBoYWRvb3AgaXMg
cmVhbGx5IGZvciBiYXRjaCBvcmllbnRlZA0KPiA+ID4gam9icyBvbmx5IChvciB0aG9zZSB0eXBl
cyBvZiBqb2JzIHdoZXJlIHlvdSBkb24ndCBuZWVkIGEgcXVpY2sNCj4gPiA+IHJlc3BvbnNlIHRp
bWUpLiAgSXQncyBkZWZpbml0ZWx5IG5vdCBmb3Igbm9ybWFsIHF1ZXJpZXMgKHVubGVzcyB5b3UN
Cj4gPiA+IGhhdmUgdW51c3VhbCByZXF1aXJlbWVudHMpLg0KPiA+ID4NCj4gPiA+IC1Zb25paw0K
PiA+ID4gaHR0cDovL3d3dy5sdWNpZGltYWdpbmF0aW9uLmNvbQ0KPiA+ID4NCj4gPiA+IC0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tDQo+ID4gPiAtIFRvIHVuc3Vic2NyaWJlLCBlLW1haWw6IGphdmEtdXNlci11bnN1YnNj
cmliZUBsdWNlbmUuYXBhY2hlLm9yZw0KPiA+ID4gRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUt
bWFpbDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4gPiA+DQo+ID4gPg0KPiA+
DQoNCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tDQpUbyB1bnN1YnNjcmliZSwgZS1tYWlsOiBqYXZhLXVzZXItdW5z
dWJzY3JpYmVAbHVjZW5lLmFwYWNoZS5vcmcNCkZvciBhZGRpdGlvbmFsIGNvbW1hbmRzLCBlLW1h
aWw6IGphdmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQoNCg==


From java-user-return-47878-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 17:05:33 2010
Return-Path: <java-user-return-47878-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70759 invoked from network); 22 Nov 2010 17:05:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 17:05:33 -0000
Received: (qmail 59439 invoked by uid 500); 22 Nov 2010 17:06:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59394 invoked by uid 500); 22 Nov 2010 17:06:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59385 invoked by uid 99); 22 Nov 2010 17:05:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:05:59 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:05:52 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 5C3C2D36009
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 18:05:32 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 7-KEnu7MYFFG for <java-user@lucene.apache.org>;
	Mon, 22 Nov 2010 18:05:26 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 3B2EFD36008
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 18:05:26 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com> <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <E5331E53F021E443B53EC78F375B3C761F9443@buf-ex02.cymfony.com>
In-Reply-To: <E5331E53F021E443B53EC78F375B3C761F9443@buf-ex02.cymfony.com>
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 18:05:50 +0100
Message-ID: <00fb01cb8a67$83b6f020$8b24d060$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAkCKnrzXAE2KuvrktcPPMA=
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

A local multithreaded search can be done in another way even for a =
single index, but not using the impl of (Parallel)MultiSearcher. This =
may be a new class directly extending IndexSearcher, which may even do =
parallel search on e.g. different segments (because searching a =
MultiReader is no longer different from DirectoryReader, as segments of =
a single Lucene index are internally also handled like MultiReaders).

The problem with MultiSearcher is the way how query rewriting is =
handled, because soring needs every subsearcher docing the same query.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: David Fertig [mailto:dfertig@cymfony.com]
> Sent: Monday, November 22, 2010 5:57 PM
> To: java-user@lucene.apache.org
> Subject: RE: best practice: 1.4 billions documents
>=20
> > it has only problems.
> Perhaps these known problems should be added to the doc api, so users =
who
> are encouraged to start clean with the 3.x API don't build bad =
applications from
> scratch?
>=20
> Parallel searching is extremely powerful and should not be abandoned.
>=20
>=20
>=20
> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Monday, November 22, 2010 11:19 AM
> To: java-user@lucene.apache.org
> Subject: RE: best practice: 1.4 billions documents
>=20
> There is no reason to use MultiSearcher instead the much more =
consistent and
> effective  MultiReader! We (Robert and me) are already planning to =
deprecate
> it. MultiSearcher itsself has no benefit over a simple IndexSearcher =
on top of a
> MultiReader since Lucene 2.9, it has only problems.
>=20
> Use cases for real MultiSearchers are only the subclasses for "remote =
search"
> or (perhaps) multi-threaded search, but the latter I would not =
recommend
> (instead let the additional CPUs in your machine be free for other =
users doing
> searches in parallel). Multithreading a single search should not be =
done, as it
> slows down multiple users accessing the same index at the same time. =
Spend
> the additional CPU power for other things like warming searchers, =
indexing
> additional documents, or filling FieldCache in parallel.
>=20
> Uwe
>=20
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>=20
>=20
> > -----Original Message-----
> > From: David Fertig [mailto:dfertig@cymfony.com]
> > Sent: Monday, November 22, 2010 4:54 PM
> > To: java-user@lucene.apache.org
> > Subject: RE: best practice: 1.4 billions documents
> >
> > >> We have a couple billion docs in our archives as well...Breaking
> > >> them up by day worked well for us
> >
> > We do not have 2 billion segments in one index  We have roughly 5-10
> > million documents per index. We are currently using a miltisearcher
> > but unresolved lucene issues in this will force us to move to a =
multireader.
> >
> > As far as the parallel searcher goes, read back on the thread with
> > subject "Search returning documents matching a NOT range".
> > There is an acknowledged/proven bug with a small unit test, but =
there
> > is some disagreement about the internal reasons it fails. I have =
been
> > unable to generate further discussion or a resolution. This was
> > supposed to be added as a bug to the JIRA for the 3.3 release, but =
has
> > not been.  I am not which class Solr uses, but if it uses =
MultiSearcher, it will
> have the same bug.
> >
> > -----Original Message-----
> > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > Sent: Monday, November 22, 2010 1:47 AM
> > To: java-user@lucene.apache.org
> > Subject: Re: best practice: 1.4 billions documents
> >
> > Hi David, thanks for your answer. it really helped a lot! so, you =
have
> > an index with more than 2 billions segments. this is pretty much the
> > answer I was searching for: lucene alone is able to manage such a =
big index.
> >
> > which kind of problems do you have with the parallel searchers? I'm
> > going to build my index in the next couple of weeks if you want we =
can
> > confront our data
> >
> > thanks again
> > Luca
> >
> >
> > On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com>
> wrote:
> >
> > > Actually I've been bitten by an still-unresolved issue with the
> > > parallel searchers and recommend a MultiReader instead.
> > > We have a couple billion docs in our archives as well.  Breaking
> > > them up by day worked well for us, but you'll need to do =
something.
> > >
> > > -----Original Message-----
> > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > > Sent: Sunday, November 21, 2010 8:13 PM
> > > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> > > Subject: Re: best practice: 1.4 billions documents
> > >
> > > thank you both!
> > >
> > > Johannes, katta seems interesting but I will need to solve the
> > > problems of "hot" updates to the index
> > >
> > > Yonik, I see your point - so your suggestion would be to build an
> > > architecture based on ParallelMultiSearcher?
> > >
> > >
> > > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
> > > <yonik@lucidimagination.com
> > > >wrote:
> > >
> > > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > > > <luca.rondanini@gmail.com> wrote:
> > > > > Hi everybody,
> > > > >
> > > > > I really need some good advice! I need to index in lucene
> > > > > something
> > > like
> > > > 1.4
> > > > > billions documents. I had experience in lucene but I've never
> > > > > worked
> > > with
> > > > > such a big number of documents. Also this is just the number =
of
> > > > > docs at
> > > > > "start-up": they are going to grow and fast.
> > > > >
> > > > > I don't have to tell you that I need the system to be fast and
> > > > > to
> > > support
> > > > > real time updates to the documents
> > > > >
> > > > > The first solution that came to my mind was to use
> > > ParallelMultiSearcher,
> > > > > splitting the index into many "sub-index" (how many docs per =
index?
> > > > > 100,000?) but I don't have experience with it and I don't know
> > > > > how well
> > > > will
> > > > > scale while the number of documents grows!
> > > > >
> > > > > A more solid solution seems to build some kind of integration
> > > > > with
> > > > hadoop.
> > > > > But I didn't find match about lucene and hadoop integration.
> > > > >
> > > > > Any idea? Which direction should I go (pure lucene or hadoop)?
> > > >
> > > > There seems to be a common misconception about hadoop regarding
> > search.
> > > > Map-reduce as implemented in hadoop is really for batch oriented
> > > > jobs only (or those types of jobs where you don't need a quick
> > > > response time).  It's definitely not for normal queries (unless
> > > > you have unusual requirements).
> > > >
> > > > -Yonik
> > > > http://www.lucidimagination.com
> > > >
> > > > =
------------------------------------------------------------------
> > > > --
> > > > - To unsubscribe, e-mail: =
java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: =
java-user-help@lucene.apache.org
> > > >
> > > >
> > >
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47879-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 17:10:39 2010
Return-Path: <java-user-return-47879-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4944 invoked from network); 22 Nov 2010 17:10:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 17:10:38 -0000
Received: (qmail 65886 invoked by uid 500); 22 Nov 2010 17:11:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65710 invoked by uid 500); 22 Nov 2010 17:11:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Delivered-To: moderator for java-user@lucene.apache.org
Received: (qmail 46679 invoked by uid 99); 22 Nov 2010 16:55:14 -0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of eksdev@googlemail.com designates 209.85.214.176 as permitted sender)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        bh=lseNJVha0WvQ9XtPnHlMRhZBOztIUSrLk4lOpSJYckY=;
        b=Cp+kjSvREfljiy0d/q9Pz6HCp7EwZ1WEuXkfEzYX028eRI53ym77MMFkHiDESLqkX+
         mbk/8JlQUgng330AzDiYLfwVEWsNupB+EF/iUTbolCo4MORstakQ95gXjImoq8zUdqCY
         JQ93TI7rVUFI8i+wyGyLRnK8GUQl4AcyzLh6s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type;
        b=RavEj0byWFUZ134CO/4gWg6nsObKswTBL0q6c29UMvs5CewdyIpiC14sFmxMzGghxP
         CXS2qys4ElHyK68I1gXicgyR1BBS7EBlBuP4+jmGRttD427ywwSSRa87YrJgm0cZ8ue2
         9Kc/MMlN4bcQcmFl8Z/H7p6gzHem8ugZ6NoqI=
MIME-Version: 1.0
Sender: eksdev@googlemail.com
In-Reply-To: <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
Date: Mon, 22 Nov 2010 17:54:45 +0100
X-Google-Sender-Auth: cG7kwITPAjyjRDi0VOB854o3bfM
Message-ID: <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: eks dev <eksdev@yahoo.co.uk>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000325575326012a110495a71d07
X-Virus-Checked: Checked by ClamAV on apache.org

--000325575326012a110495a71d07
Content-Type: text/plain; charset=ISO-8859-1

Am I the only one who thinks this is not the way to go, MultiReader (or
MulitiSearcher) is not going to fix your problems. Having 1.4B Documents on
one machine is a big number, does not matter how you partition them (or you
have some really expensive hardware at your disposal).  Did I miss the point
somewhere with this recommendation "use MultiReader and you are good for
1.4B Document"?

Imo, you must distribute your index across many machines.

Your best chance is to look at solr cloud and solr replication (solr Wiki is
your friend). Of course, you can do it yourself, but building distributet
setup with what you call "real time updates" is a huge pain.

Alternatively, google for lucene or solr on cassandra (has some very nice
properties about update latency and architectural simplicity).I do not know
if this is somewhere in production.

Good luck,
e.



On Mon, Nov 22, 2010 at 5:18 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> There is no reason to use MultiSearcher instead the much more consistent
> and effective  MultiReader! We (Robert and me) are already planning to
> deprecate it. MultiSearcher itsself has no benefit over a simple
> IndexSearcher on top of a MultiReader since Lucene 2.9, it has only
> problems.
>
> Use cases for real MultiSearchers are only the subclasses for "remote
> search" or (perhaps) multi-threaded search, but the latter I would not
> recommend (instead let the additional CPUs in your machine be free for other
> users doing searches in parallel). Multithreading a single search should not
> be done, as it slows down multiple users accessing the same index at the
> same time. Spend the additional CPU power for other things like warming
> searchers, indexing additional documents, or filling FieldCache in parallel.
>
> Uwe
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: David Fertig [mailto:dfertig@cymfony.com]
> > Sent: Monday, November 22, 2010 4:54 PM
> > To: java-user@lucene.apache.org
> > Subject: RE: best practice: 1.4 billions documents
> >
> > >> We have a couple billion docs in our archives as well...Breaking them
> > >> up by day worked well for us
> >
> > We do not have 2 billion segments in one index  We have roughly 5-10
> million
> > documents per index. We are currently using a miltisearcher but
> unresolved
> > lucene issues in this will force us to move to a multireader.
> >
> > As far as the parallel searcher goes, read back on the thread with
> subject
> > "Search returning documents matching a NOT range".
> > There is an acknowledged/proven bug with a small unit test, but there is
> some
> > disagreement about the internal reasons it fails. I have been unable to
> > generate further discussion or a resolution. This was supposed to be
> added as a
> > bug to the JIRA for the 3.3 release, but has not been.  I am not which
> class Solr
> > uses, but if it uses MultiSearcher, it will have the same bug.
> >
> > -----Original Message-----
> > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > Sent: Monday, November 22, 2010 1:47 AM
> > To: java-user@lucene.apache.org
> > Subject: Re: best practice: 1.4 billions documents
> >
> > Hi David, thanks for your answer. it really helped a lot! so, you have an
> index
> > with more than 2 billions segments. this is pretty much the answer I was
> > searching for: lucene alone is able to manage such a big index.
> >
> > which kind of problems do you have with the parallel searchers? I'm going
> to
> > build my index in the next couple of weeks if you want we can confront
> our
> > data
> >
> > thanks again
> > Luca
> >
> >
> > On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com>
> wrote:
> >
> > > Actually I've been bitten by an still-unresolved issue with the
> > > parallel searchers and recommend a MultiReader instead.
> > > We have a couple billion docs in our archives as well.  Breaking them
> > > up by day worked well for us, but you'll need to do something.
> > >
> > > -----Original Message-----
> > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > > Sent: Sunday, November 21, 2010 8:13 PM
> > > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> > > Subject: Re: best practice: 1.4 billions documents
> > >
> > > thank you both!
> > >
> > > Johannes, katta seems interesting but I will need to solve the
> > > problems of "hot" updates to the index
> > >
> > > Yonik, I see your point - so your suggestion would be to build an
> > > architecture based on ParallelMultiSearcher?
> > >
> > >
> > > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
> > > <yonik@lucidimagination.com
> > > >wrote:
> > >
> > > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > > > <luca.rondanini@gmail.com> wrote:
> > > > > Hi everybody,
> > > > >
> > > > > I really need some good advice! I need to index in lucene
> > > > > something
> > > like
> > > > 1.4
> > > > > billions documents. I had experience in lucene but I've never
> > > > > worked
> > > with
> > > > > such a big number of documents. Also this is just the number of
> > > > > docs at
> > > > > "start-up": they are going to grow and fast.
> > > > >
> > > > > I don't have to tell you that I need the system to be fast and to
> > > support
> > > > > real time updates to the documents
> > > > >
> > > > > The first solution that came to my mind was to use
> > > ParallelMultiSearcher,
> > > > > splitting the index into many "sub-index" (how many docs per index?
> > > > > 100,000?) but I don't have experience with it and I don't know how
> > > > > well
> > > > will
> > > > > scale while the number of documents grows!
> > > > >
> > > > > A more solid solution seems to build some kind of integration with
> > > > hadoop.
> > > > > But I didn't find match about lucene and hadoop integration.
> > > > >
> > > > > Any idea? Which direction should I go (pure lucene or hadoop)?
> > > >
> > > > There seems to be a common misconception about hadoop regarding
> > search.
> > > > Map-reduce as implemented in hadoop is really for batch oriented
> > > > jobs only (or those types of jobs where you don't need a quick
> > > > response time).  It's definitely not for normal queries (unless you
> > > > have unusual requirements).
> > > >
> > > > -Yonik
> > > > http://www.lucidimagination.com
> > > >
> > > > --------------------------------------------------------------------
> > > > - To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >
> > > >
> > >
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000325575326012a110495a71d07--

From java-user-return-47880-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 17:16:54 2010
Return-Path: <java-user-return-47880-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30070 invoked from network); 22 Nov 2010 17:16:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 17:16:53 -0000
Received: (qmail 82475 invoked by uid 500); 22 Nov 2010 17:17:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82300 invoked by uid 500); 22 Nov 2010 17:17:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82292 invoked by uid 99); 22 Nov 2010 17:17:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:17:22 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:17:16 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id EAE53D3600B
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 18:16:55 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id AepQsaimbzGN for <java-user@lucene.apache.org>;
	Mon, 22 Nov 2010 18:16:48 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 37107D36008
	for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 18:16:48 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
In-Reply-To: <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 18:17:12 +0100
Message-ID: <010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAkCKnrzXAGCgulzktSvckA=
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

The latest discussion was more about MultiReader vs. MultiSearcher.

But you are right, 1.4 B documents is not easy to go, especially when you
index grows and you get to the 2.1 B marker, then no MultiSearcher or
whatever helps.

On the other hand even distributed Solr has the same problems like
MultiSearcher: scoring MultiTermQueries (Fuzzy) doesn't work correctly and
negative MTQ clauses may produce wrong results if the query rewriting is
done like in MultiSearcher (which is unsolveable broken and broken and
broken and again broken for some queries as Boolean clauses - see DeMorgan
laws).

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: eksdev@googlemail.com [mailto:eksdev@googlemail.com] On Behalf Of
> eks dev
> Sent: Monday, November 22, 2010 5:55 PM
> To: java-user@lucene.apache.org
> Subject: Re: best practice: 1.4 billions documents
> 
> Am I the only one who thinks this is not the way to go, MultiReader (or
> MulitiSearcher) is not going to fix your problems. Having 1.4B Documents
on
> one machine is a big number, does not matter how you partition them (or
you
> have some really expensive hardware at your disposal).  Did I miss the
point
> somewhere with this recommendation "use MultiReader and you are good for
> 1.4B Document"?
> 
> Imo, you must distribute your index across many machines.
> 
> Your best chance is to look at solr cloud and solr replication (solr Wiki
is your
> friend). Of course, you can do it yourself, but building distributet setup
with
> what you call "real time updates" is a huge pain.
> 
> Alternatively, google for lucene or solr on cassandra (has some very nice
> properties about update latency and architectural simplicity).I do not
know if
> this is somewhere in production.
> 
> Good luck,
> e.
> 
> 
> 
> On Mon, Nov 22, 2010 at 5:18 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> 
> > There is no reason to use MultiSearcher instead the much more
> > consistent and effective  MultiReader! We (Robert and me) are already
> > planning to deprecate it. MultiSearcher itsself has no benefit over a
> > simple IndexSearcher on top of a MultiReader since Lucene 2.9, it has
> > only problems.
> >
> > Use cases for real MultiSearchers are only the subclasses for "remote
> > search" or (perhaps) multi-threaded search, but the latter I would not
> > recommend (instead let the additional CPUs in your machine be free for
> > other users doing searches in parallel). Multithreading a single
> > search should not be done, as it slows down multiple users accessing
> > the same index at the same time. Spend the additional CPU power for
> > other things like warming searchers, indexing additional documents, or
filling
> FieldCache in parallel.
> >
> > Uwe
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: David Fertig [mailto:dfertig@cymfony.com]
> > > Sent: Monday, November 22, 2010 4:54 PM
> > > To: java-user@lucene.apache.org
> > > Subject: RE: best practice: 1.4 billions documents
> > >
> > > >> We have a couple billion docs in our archives as well...Breaking
> > > >> them up by day worked well for us
> > >
> > > We do not have 2 billion segments in one index  We have roughly 5-10
> > million
> > > documents per index. We are currently using a miltisearcher but
> > unresolved
> > > lucene issues in this will force us to move to a multireader.
> > >
> > > As far as the parallel searcher goes, read back on the thread with
> > subject
> > > "Search returning documents matching a NOT range".
> > > There is an acknowledged/proven bug with a small unit test, but
> > > there is
> > some
> > > disagreement about the internal reasons it fails. I have been unable
> > > to generate further discussion or a resolution. This was supposed to
> > > be
> > added as a
> > > bug to the JIRA for the 3.3 release, but has not been.  I am not
> > > which
> > class Solr
> > > uses, but if it uses MultiSearcher, it will have the same bug.
> > >
> > > -----Original Message-----
> > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > > Sent: Monday, November 22, 2010 1:47 AM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: best practice: 1.4 billions documents
> > >
> > > Hi David, thanks for your answer. it really helped a lot! so, you
> > > have an
> > index
> > > with more than 2 billions segments. this is pretty much the answer I
> > > was searching for: lucene alone is able to manage such a big index.
> > >
> > > which kind of problems do you have with the parallel searchers? I'm
> > > going
> > to
> > > build my index in the next couple of weeks if you want we can
> > > confront
> > our
> > > data
> > >
> > > thanks again
> > > Luca
> > >
> > >
> > > On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com>
> > wrote:
> > >
> > > > Actually I've been bitten by an still-unresolved issue with the
> > > > parallel searchers and recommend a MultiReader instead.
> > > > We have a couple billion docs in our archives as well.  Breaking
> > > > them up by day worked well for us, but you'll need to do something.
> > > >
> > > > -----Original Message-----
> > > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > > > Sent: Sunday, November 21, 2010 8:13 PM
> > > > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> > > > Subject: Re: best practice: 1.4 billions documents
> > > >
> > > > thank you both!
> > > >
> > > > Johannes, katta seems interesting but I will need to solve the
> > > > problems of "hot" updates to the index
> > > >
> > > > Yonik, I see your point - so your suggestion would be to build an
> > > > architecture based on ParallelMultiSearcher?
> > > >
> > > >
> > > > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
> > > > <yonik@lucidimagination.com
> > > > >wrote:
> > > >
> > > > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > > > > <luca.rondanini@gmail.com> wrote:
> > > > > > Hi everybody,
> > > > > >
> > > > > > I really need some good advice! I need to index in lucene
> > > > > > something
> > > > like
> > > > > 1.4
> > > > > > billions documents. I had experience in lucene but I've never
> > > > > > worked
> > > > with
> > > > > > such a big number of documents. Also this is just the number
> > > > > > of docs at
> > > > > > "start-up": they are going to grow and fast.
> > > > > >
> > > > > > I don't have to tell you that I need the system to be fast and
> > > > > > to
> > > > support
> > > > > > real time updates to the documents
> > > > > >
> > > > > > The first solution that came to my mind was to use
> > > > ParallelMultiSearcher,
> > > > > > splitting the index into many "sub-index" (how many docs per
index?
> > > > > > 100,000?) but I don't have experience with it and I don't know
> > > > > > how well
> > > > > will
> > > > > > scale while the number of documents grows!
> > > > > >
> > > > > > A more solid solution seems to build some kind of integration
> > > > > > with
> > > > > hadoop.
> > > > > > But I didn't find match about lucene and hadoop integration.
> > > > > >
> > > > > > Any idea? Which direction should I go (pure lucene or hadoop)?
> > > > >
> > > > > There seems to be a common misconception about hadoop regarding
> > > search.
> > > > > Map-reduce as implemented in hadoop is really for batch oriented
> > > > > jobs only (or those types of jobs where you don't need a quick
> > > > > response time).  It's definitely not for normal queries (unless
> > > > > you have unusual requirements).
> > > > >
> > > > > -Yonik
> > > > > http://www.lucidimagination.com
> > > > >
> > > > > ----------------------------------------------------------------
> > > > > ----
> > > > > - To unsubscribe, e-mail:
> > > > > java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail:
> > > > > java-user-help@lucene.apache.org
> > > > >
> > > > >
> > > >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47881-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 17:28:31 2010
Return-Path: <java-user-return-47881-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34517 invoked from network); 22 Nov 2010 17:28:31 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 17:28:31 -0000
Received: (qmail 102 invoked by uid 500); 22 Nov 2010 17:29:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99960 invoked by uid 500); 22 Nov 2010 17:29:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99952 invoked by uid 99); 22 Nov 2010 17:29:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:29:00 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:28:54 +0000
Received: by fxm2 with SMTP id 2so2952599fxm.35
        for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 09:28:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        bh=p5Oqv2z5TmUJq609LyLQjrnFq4jLqBJvu6WKc9FxfF0=;
        b=O8iHqWOwz093KF5rBdYKOQRm6ezsRZMXrQXHgjxiFZkG8i6AO53iVOcaLQOys6D1O4
         Zn9CkTI/e4eERT5/+2TB4SH8TyvO7M9t4UtClE/IR1UYwBdOX6tzJNN6xfl9WinMsuDM
         hz4KMEN506fdsbgeYJW0g7hYbLXBOnX3YTWgo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type;
        b=Um63Kc2tfBAbzEQrBODyqDrvVECL8nT+feciGS8NcYnrscwdqSIeytHFEDZSUEHtKi
         ljfT52DMNseWQUlDDGPkrocwg774BbQkNs8vr9wtOBrf84+lJP5k00NMDLGZX94ZPfp2
         HR77A56fQ02iAM94vLSAAGwSKupg+D2JBUBlc=
MIME-Version: 1.0
Received: by 10.223.79.65 with SMTP id o1mr4532742fak.145.1290446914226; Mon,
 22 Nov 2010 09:28:34 -0800 (PST)
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.74.202 with HTTP; Mon, 22 Nov 2010 09:28:34 -0800 (PST)
In-Reply-To: <010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
	<AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
	<010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de>
Date: Mon, 22 Nov 2010 12:28:34 -0500
X-Google-Sender-Auth: HHKIopSVsOdA7J0hDZaZQ34Umfk
Message-ID: <AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On Mon, Nov 22, 2010 at 12:17 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> The latest discussion was more about MultiReader vs. MultiSearcher.
>
> But you are right, 1.4 B documents is not easy to go, especially when you
> index grows and you get to the 2.1 B marker, then no MultiSearcher or
> whatever helps.
>
> On the other hand even distributed Solr has the same problems like
> MultiSearcher: scoring MultiTermQueries (Fuzzy) doesn't work correctly

Are you referring to the idf being local to the shard instead of
global to the whole colleciton?
Andrzej has a patch in the works, but it's not committed yet.

> negative MTQ clauses may produce wrong results if the query rewriting is
> done like in MultiSearcher (which is unsolveable broken and broken and
> broken and again broken for some queries as Boolean clauses - see DeMorgan
> laws).

I don't think this is a problem for Solr.  Queries are executed on
each shard as normal (no difference from a non-distributed query).

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47882-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 17:48:48 2010
Return-Path: <java-user-return-47882-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49190 invoked from network); 22 Nov 2010 17:48:47 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 17:48:47 -0000
Received: (qmail 41515 invoked by uid 500); 22 Nov 2010 17:49:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41470 invoked by uid 500); 22 Nov 2010 17:49:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41462 invoked by uid 99); 22 Nov 2010 17:49:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:49:17 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:49:10 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 15950D3600B;
	Mon, 22 Nov 2010 18:48:50 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Xz824YP3WrER; Mon, 22 Nov 2010 18:48:44 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 14086D36009;
	Mon, 22 Nov 2010 18:48:44 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>,
	<yonik@lucidimagination.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>	<AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>	<010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de> <AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>
In-Reply-To: <AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 18:49:07 +0100
Message-ID: <011001cb8a6d$900de850$b029b8f0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAkCKnrzXAGCgulzAuZoJLICxKvBZpKnX3rg
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Yonik,

Can we do the same for Lucene, the problem is combining the rewritten
queries using the broken method in Query?

As far as I know, the problem is that e.g. MTQs rewrite *per searcher* so
each searcher uses a different rewritten query (with different terms). So
the scores are totally different even with a tf-idf patch (Fuzzy scores on
MultiSearcher and Solr are totally wrong because each shard uses another
rewritten query). To work around that, the Query class has a broken, broken,
broken, broken, broken method to combine queries, which violates DeMorgans
laws when there are e.g. negative clauses. And this method cannot be fixed
to work with all queries
(https://issues.apache.org/jira/browse/LUCENE-2756).

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: yseeley@gmail.com [mailto:yseeley@gmail.com] On Behalf Of Yonik
> Seeley
> Sent: Monday, November 22, 2010 6:29 PM
> To: java-user@lucene.apache.org
> Subject: Re: best practice: 1.4 billions documents
> 
> On Mon, Nov 22, 2010 at 12:17 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> > The latest discussion was more about MultiReader vs. MultiSearcher.
> >
> > But you are right, 1.4 B documents is not easy to go, especially when
> > you index grows and you get to the 2.1 B marker, then no MultiSearcher
> > or whatever helps.
> >
> > On the other hand even distributed Solr has the same problems like
> > MultiSearcher: scoring MultiTermQueries (Fuzzy) doesn't work correctly
> 
> Are you referring to the idf being local to the shard instead of global to
the
> whole colleciton?
> Andrzej has a patch in the works, but it's not committed yet.
> 
> > negative MTQ clauses may produce wrong results if the query rewriting
> > is done like in MultiSearcher (which is unsolveable broken and broken
> > and broken and again broken for some queries as Boolean clauses - see
> > DeMorgan laws).
> 
> I don't think this is a problem for Solr.  Queries are executed on each
shard as
> normal (no difference from a non-distributed query).
> 
> -Yonik
> http://www.lucidimagination.com
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47883-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 17:59:06 2010
Return-Path: <java-user-return-47883-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56728 invoked from network); 22 Nov 2010 17:59:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 17:59:06 -0000
Received: (qmail 61177 invoked by uid 500); 22 Nov 2010 17:59:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61132 invoked by uid 500); 22 Nov 2010 17:59:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61124 invoked by uid 99); 22 Nov 2010 17:59:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:59:35 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of luca.rondanini@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 17:59:31 +0000
Received: by fxm2 with SMTP id 2so2985910fxm.35
        for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 09:59:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=oWXgDpjFCf4eUAw168ddlVP4oHV9mVq0rEcu7/vn8zI=;
        b=GHqEW03BioT/YLIKKLVCJJgxNvQR+nr1ib9HxCe4tp1szO+wUX6Fj5UVYpb+B9GbjX
         P60C7zILa4pjNAgXLOG3purjWkMBzY9rR+4pu/aTGXv+d0qEB1hrCMRloSSh5f9xtYI3
         M1pG4d0qKEAcmzDHrhrqquHLiyfFsXrTB2WSU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=g/jC6e0ec/GwJ/NlnRrCYbOg8TsPL7ok1f/yGD0ZZYAItjujxJM0iKXP9f5Wwj6G90
         LdAqS5GXokzIVBJCnZbRi5Rli3cOG+Mdd32SiJ+Z0rpUi5Q6rGl05PSA3QymzuHQ+C22
         ys76dawv8MGwbpptEwbRVGhCVun2DMiejYVfY=
MIME-Version: 1.0
Received: by 10.223.79.72 with SMTP id o8mr696569fak.83.1290448748886; Mon, 22
 Nov 2010 09:59:08 -0800 (PST)
Received: by 10.223.98.193 with HTTP; Mon, 22 Nov 2010 09:59:08 -0800 (PST)
In-Reply-To: <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
	<AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
Date: Mon, 22 Nov 2010 09:59:08 -0800
Message-ID: <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Luca Rondanini <luca.rondanini@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf3054a6b9473cd20495a803f5

--20cf3054a6b9473cd20495a803f5
Content-Type: text/plain; charset=UTF-8

Thank you all, I really got some good hints!

of course I will distribute my index over many machines: store everything on
one computer is just crazy, 1.4B docs is going to be an index of almost 2T
(in my case)

the best solution for me at the moment (from your suggestions) seems to
identify a criteria to force a request (search/update) to access only a
subset of the index. Multi or Parallel Searchers....I'll decide later.

Solr is a really good option and I've already planned of "stealing" parts of
code but I have time and resources to try to build my own platform
especially since my data need heavy processing.

I'll keep you posted
Luca






On Mon, Nov 22, 2010 at 8:54 AM, eks dev <eksdev@yahoo.co.uk> wrote:

> Am I the only one who thinks this is not the way to go, MultiReader (or
> MulitiSearcher) is not going to fix your problems. Having 1.4B Documents on
> one machine is a big number, does not matter how you partition them (or you
> have some really expensive hardware at your disposal).  Did I miss the
> point
> somewhere with this recommendation "use MultiReader and you are good for
> 1.4B Document"?
>
> Imo, you must distribute your index across many machines.
>
> Your best chance is to look at solr cloud and solr replication (solr Wiki
> is
> your friend). Of course, you can do it yourself, but building distributet
> setup with what you call "real time updates" is a huge pain.
>
> Alternatively, google for lucene or solr on cassandra (has some very nice
> properties about update latency and architectural simplicity).I do not know
> if this is somewhere in production.
>
> Good luck,
> e.
>
>
>
> On Mon, Nov 22, 2010 at 5:18 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>
> > There is no reason to use MultiSearcher instead the much more consistent
> > and effective  MultiReader! We (Robert and me) are already planning to
> > deprecate it. MultiSearcher itsself has no benefit over a simple
> > IndexSearcher on top of a MultiReader since Lucene 2.9, it has only
> > problems.
> >
> > Use cases for real MultiSearchers are only the subclasses for "remote
> > search" or (perhaps) multi-threaded search, but the latter I would not
> > recommend (instead let the additional CPUs in your machine be free for
> other
> > users doing searches in parallel). Multithreading a single search should
> not
> > be done, as it slows down multiple users accessing the same index at the
> > same time. Spend the additional CPU power for other things like warming
> > searchers, indexing additional documents, or filling FieldCache in
> parallel.
> >
> > Uwe
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: David Fertig [mailto:dfertig@cymfony.com]
> > > Sent: Monday, November 22, 2010 4:54 PM
> > > To: java-user@lucene.apache.org
> > > Subject: RE: best practice: 1.4 billions documents
> > >
> > > >> We have a couple billion docs in our archives as well...Breaking
> them
> > > >> up by day worked well for us
> > >
> > > We do not have 2 billion segments in one index  We have roughly 5-10
> > million
> > > documents per index. We are currently using a miltisearcher but
> > unresolved
> > > lucene issues in this will force us to move to a multireader.
> > >
> > > As far as the parallel searcher goes, read back on the thread with
> > subject
> > > "Search returning documents matching a NOT range".
> > > There is an acknowledged/proven bug with a small unit test, but there
> is
> > some
> > > disagreement about the internal reasons it fails. I have been unable to
> > > generate further discussion or a resolution. This was supposed to be
> > added as a
> > > bug to the JIRA for the 3.3 release, but has not been.  I am not which
> > class Solr
> > > uses, but if it uses MultiSearcher, it will have the same bug.
> > >
> > > -----Original Message-----
> > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > > Sent: Monday, November 22, 2010 1:47 AM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: best practice: 1.4 billions documents
> > >
> > > Hi David, thanks for your answer. it really helped a lot! so, you have
> an
> > index
> > > with more than 2 billions segments. this is pretty much the answer I
> was
> > > searching for: lucene alone is able to manage such a big index.
> > >
> > > which kind of problems do you have with the parallel searchers? I'm
> going
> > to
> > > build my index in the next couple of weeks if you want we can confront
> > our
> > > data
> > >
> > > thanks again
> > > Luca
> > >
> > >
> > > On Sun, Nov 21, 2010 at 6:22 PM, David Fertig <dfertig@cymfony.com>
> > wrote:
> > >
> > > > Actually I've been bitten by an still-unresolved issue with the
> > > > parallel searchers and recommend a MultiReader instead.
> > > > We have a couple billion docs in our archives as well.  Breaking them
> > > > up by day worked well for us, but you'll need to do something.
> > > >
> > > > -----Original Message-----
> > > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> > > > Sent: Sunday, November 21, 2010 8:13 PM
> > > > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> > > > Subject: Re: best practice: 1.4 billions documents
> > > >
> > > > thank you both!
> > > >
> > > > Johannes, katta seems interesting but I will need to solve the
> > > > problems of "hot" updates to the index
> > > >
> > > > Yonik, I see your point - so your suggestion would be to build an
> > > > architecture based on ParallelMultiSearcher?
> > > >
> > > >
> > > > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
> > > > <yonik@lucidimagination.com
> > > > >wrote:
> > > >
> > > > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> > > > > <luca.rondanini@gmail.com> wrote:
> > > > > > Hi everybody,
> > > > > >
> > > > > > I really need some good advice! I need to index in lucene
> > > > > > something
> > > > like
> > > > > 1.4
> > > > > > billions documents. I had experience in lucene but I've never
> > > > > > worked
> > > > with
> > > > > > such a big number of documents. Also this is just the number of
> > > > > > docs at
> > > > > > "start-up": they are going to grow and fast.
> > > > > >
> > > > > > I don't have to tell you that I need the system to be fast and to
> > > > support
> > > > > > real time updates to the documents
> > > > > >
> > > > > > The first solution that came to my mind was to use
> > > > ParallelMultiSearcher,
> > > > > > splitting the index into many "sub-index" (how many docs per
> index?
> > > > > > 100,000?) but I don't have experience with it and I don't know
> how
> > > > > > well
> > > > > will
> > > > > > scale while the number of documents grows!
> > > > > >
> > > > > > A more solid solution seems to build some kind of integration
> with
> > > > > hadoop.
> > > > > > But I didn't find match about lucene and hadoop integration.
> > > > > >
> > > > > > Any idea? Which direction should I go (pure lucene or hadoop)?
> > > > >
> > > > > There seems to be a common misconception about hadoop regarding
> > > search.
> > > > > Map-reduce as implemented in hadoop is really for batch oriented
> > > > > jobs only (or those types of jobs where you don't need a quick
> > > > > response time).  It's definitely not for normal queries (unless you
> > > > > have unusual requirements).
> > > > >
> > > > > -Yonik
> > > > > http://www.lucidimagination.com
> > > > >
> > > > >
> --------------------------------------------------------------------
> > > > > - To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > > >
> > > > >
> > > >
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>

--20cf3054a6b9473cd20495a803f5--

From java-user-return-47884-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 18:16:52 2010
Return-Path: <java-user-return-47884-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77397 invoked from network); 22 Nov 2010 18:16:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 18:16:51 -0000
Received: (qmail 92143 invoked by uid 500); 22 Nov 2010 18:17:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92067 invoked by uid 500); 22 Nov 2010 18:17:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92059 invoked by uid 99); 22 Nov 2010 18:17:21 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 18:17:21 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of spring@gmx.eu designates 213.165.64.22 as permitted sender)
Received: from [213.165.64.22] (HELO mail.gmx.net) (213.165.64.22)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 22 Nov 2010 18:17:13 +0000
Received: (qmail invoked by alias); 22 Nov 2010 18:16:50 -0000
Received: from e178082144.adsl.alicedsl.de (EHLO msrvcn04) [85.178.82.144]
  by mail.gmx.net (mp062) with SMTP; 22 Nov 2010 19:16:50 +0100
X-Authenticated: #2635966
X-Provags-ID: V01U2FsdGVkX18eJxp5GVYeE0LR9IdIEc60SCbmmLWYfjNyHLXVFK
	pj7nK8He/MIPKz
From: <spring@gmx.eu>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com><AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com><00e401cb8a60$f390d5c0$dab28140$@thetaphi.de><AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com> <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com>
Subject: RE: best practice: 1.4 billions documents
Date: Mon, 22 Nov 2010 19:16:51 +0100
Message-ID: <4828D89CD94C4349831DB1BAF29598F7@msrvcn04>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcuKbwdh/xJQyEntT7W4NhbuP7upMAAAYk1A
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.3790.4721
In-Reply-To: <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com>
X-Y-GMX-Trusted: 0

> of course I will distribute my index over many machines: 
> store everything on
> one computer is just crazy, 1.4B docs is going to be an index 
> of almost 2T
> (in my case)

billion = giga in english
billion = tera in non-english

2T docs = 2.000.000.000.000 docs... ;)

AFAIK 2 ^ 32 - 1 docs is still the max for a lucene instance.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47885-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 18:23:50 2010
Return-Path: <java-user-return-47885-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90959 invoked from network); 22 Nov 2010 18:23:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 18:23:50 -0000
Received: (qmail 3770 invoked by uid 500); 22 Nov 2010 18:24:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3717 invoked by uid 500); 22 Nov 2010 18:24:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3709 invoked by uid 99); 22 Nov 2010 18:24:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 18:24:19 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of luca.rondanini@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 18:24:13 +0000
Received: by fxm2 with SMTP id 2so3010830fxm.35
        for <java-user@lucene.apache.org>; Mon, 22 Nov 2010 10:23:52 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=KV9Tcz6bCVcU7KKyIbLO43SezNBajysfnKWQXMLLMxk=;
        b=l2Zg/1m+4jqtukMelcF0Cq0zgvpMOi5DsBBWlUx5F1naVDB9lrAHJmclZNyaJMjXcL
         OjtMPtU8E3kTJiquOl6cTZA90P4DzFr4b8DXlNQmA4MPh+2GXlx7UV6Mjz38aa2A/u5+
         IYVkbjU719q/st1f+dw+MZRhkzXQolDt9Uu9E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=GnLnYW61dK5MVUn/k3Fl8pIsv22J9jRCrcl9XbeIHBYa4ge4MIC4peGtUmueoAsGUo
         A5aNmyoiqTEre2wYuBzFnfwsma4g/rKUUogbZEjNz7+qZa7bexb+Kq+uq1i2qkpYxEnp
         7KPNmzQZDKt6S0/C5DwMXsXImG1+TOoWhL2OY=
MIME-Version: 1.0
Received: by 10.223.100.4 with SMTP id w4mr712134fan.26.1290450232757; Mon, 22
 Nov 2010 10:23:52 -0800 (PST)
Received: by 10.223.98.193 with HTTP; Mon, 22 Nov 2010 10:23:52 -0800 (PST)
In-Reply-To: <4828D89CD94C4349831DB1BAF29598F7@msrvcn04>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
	<AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
	<AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com>
	<4828D89CD94C4349831DB1BAF29598F7@msrvcn04>
Date: Mon, 22 Nov 2010 10:23:52 -0800
Message-ID: <AANLkTi=hcBiF2amKcpMwQm8fGnQRZtRO_yAJJ_Vz=bXb@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Luca Rondanini <luca.rondanini@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf30433e32b94e4f0495a85bbb
X-Virus-Checked: Checked by ClamAV on apache.org

--20cf30433e32b94e4f0495a85bbb
Content-Type: text/plain; charset=UTF-8

eheheheh,

1.4 billion of documents = 1,400,000,000 documents for almost 2T = 2
therabites = 2000 gigas on HD!





On Mon, Nov 22, 2010 at 10:16 AM, <spring@gmx.eu> wrote:

> > of course I will distribute my index over many machines:
> > store everything on
> > one computer is just crazy, 1.4B docs is going to be an index
> > of almost 2T
> > (in my case)
>
> billion = giga in english
> billion = tera in non-english
>
> 2T docs = 2.000.000.000.000 docs... ;)
>
> AFAIK 2 ^ 32 - 1 docs is still the max for a lucene instance.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--20cf30433e32b94e4f0495a85bbb--

From java-user-return-47886-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 22 23:50:53 2010
Return-Path: <java-user-return-47886-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72060 invoked from network); 22 Nov 2010 23:50:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 22 Nov 2010 23:50:53 -0000
Received: (qmail 72420 invoked by uid 500); 22 Nov 2010 23:51:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72336 invoked by uid 500); 22 Nov 2010 23:51:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72328 invoked by uid 99); 22 Nov 2010 23:51:22 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 23:51:22 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [141.211.3.202] (HELO itcs-ehub-02.adsroot.itcs.umich.edu) (141.211.3.202)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Nov 2010 23:51:15 +0000
Received: from ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu ([141.211.3.233]) by
 itcs-ehub-02.adsroot.itcs.umich.edu ([141.211.3.202]) with mapi; Mon, 22 Nov
 2010 18:50:52 -0500
From: "Burton-West, Tom" <tburtonw@umich.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 22 Nov 2010 18:50:55 -0500
Subject: ICUTokenizer and CJK
Thread-Topic: ICUTokenizer and CJK
Thread-Index: AcuKoBrQeD5vP04TT3O/ioWSVttXng==
Message-ID: <47316FE3F6BA0D4DADF996635125526809F6463198@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/alternative;
	boundary="_000_47316FE3F6BA0D4DADF996635125526809F6463198ITCSECLS1VS3a_"
MIME-Version: 1.0

--_000_47316FE3F6BA0D4DADF996635125526809F6463198ITCSECLS1VS3a_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hi all,

I see in the javadoc for the ICUTokenizer that it has special handling for =
Lao,Myanmar, Khmer word breaking but no details in the javadoc about what i=
t does with CJK, which for C and J appears to be breaking into unigrams. Is=
 this correct?


Tom


--_000_47316FE3F6BA0D4DADF996635125526809F6463198ITCSECLS1VS3a_--

From java-user-return-47887-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 10:06:05 2010
Return-Path: <java-user-return-47887-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94858 invoked from network); 23 Nov 2010 10:06:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 10:06:05 -0000
Received: (qmail 12403 invoked by uid 500); 23 Nov 2010 10:06:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12020 invoked by uid 500); 23 Nov 2010 10:06:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11941 invoked by uid 99); 23 Nov 2010 10:06:29 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 10:06:29 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 10:06:24 +0000
Received: by bwz9 with SMTP id 9so7872931bwz.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 02:06:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=dgPO0UllGdaafOt9wQlgvFDxS4emZlntgg6ApGJ6mVI=;
        b=If/zrQX7ZxgkP6Gvt4iPjyc/jqIQfuWhe2V7pzEqGlCsSpi0oQL/6QtkHY7Z93hSTf
         qFVzSRE2SOXkF//o7HewCRHOmQ8dCUBxVlsGwLtI3OtImRy3Jv60Jth8OyMXLwT2WL8V
         Be3r7FmHKnT8shaXOtL4uw1yhETC44EX4hISE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=Q/EbJksOyXafpOBeyDB6EZgUz109K3PBoRJ3qo1+TBYeIL+dccZqiKTLJwnFb/ncX2
         vVogeh8ubluO2Wt/lQAJXiqK+08BPKhCSGqJr1oN6KQqcaafb47YSu5yzIv057AtHOrP
         3T+YAPjTo8crP6DjAJK0ypJj+SC4w+lJf9z7w=
Received: by 10.204.103.66 with SMTP id j2mr6231099bko.160.1290506762914; Tue,
 23 Nov 2010 02:06:02 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Tue, 23 Nov 2010 02:05:42 -0800 (PST)
In-Reply-To: <DD3CD532C204E24992220E891AD05CA4472C4D8B56@FRMRSSXCHMBSD1.dc-m.alcatel-lucent.com>
References: <DD3CD532C204E24992220E891AD05CA4472C4D8B56@FRMRSSXCHMBSD1.dc-m.alcatel-lucent.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 23 Nov 2010 10:05:42 +0000
Message-ID: <AANLkTimKiTmh77XDnYWxFo9oYDnXkQPYfuU8+nJFgcxb@mail.gmail.com>
Subject: Re: incremental indexation
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Sounds like a good plan to me. Unless you've got evidence of
inefficiency, don't worry about it.

--
Ian.


On Mon, Nov 22, 2010 at 4:20 PM, ZYWALEWSKI, DANIEL (DANIEL)
<daniel.zywalewski@alcatel-lucent.com> wrote:
> Hello,
> =A0I'm just stuck with one problem and don't know how to figure it out. I=
'm working on the indexation of the objects that are in computer memory (th=
ey exist only in my java code). Don't have any problems with indexing it, h=
owever I have no idea how to re-index it if they change during the executio=
n of this code; one of my ideas is adding some events to this objects (if y=
ou change any parameters -> reindex it ). However I'm not sure about its ef=
ficiency?
> =A0Thank you in advance
> =A0 Daniel
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47888-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 11:07:46 2010
Return-Path: <java-user-return-47888-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24780 invoked from network); 23 Nov 2010 11:07:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 11:07:46 -0000
Received: (qmail 94540 invoked by uid 500); 23 Nov 2010 11:08:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94389 invoked by uid 500); 23 Nov 2010 11:08:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94381 invoked by uid 99); 23 Nov 2010 11:08:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 11:08:13 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 11:08:07 +0000
Received: by bwz9 with SMTP id 9so7925898bwz.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 03:07:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=Z0SAbGCuDNhlC5zvTU8v20WqlrBn5ZsJwjrI6r2AusY=;
        b=Oo/odECIpt2n/fInmNusOJX9aT3u1hIqG7WuX/fLjHsEPkGEdORIKgvsYWe345q7UQ
         3mY8wyI5LeMmTyglRKFLDa5+YlOBpEnKm9bxakNMrDLNMkinOAsWCP/OZTfQYJjyDCk1
         feERycIFlUAmmSBpzvLbNSdlu9XHTZ8hDlvpU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=T3P95nk88fTsWcFqPMImLW8ZGx6ehTh+kKtGhzTD6MoZwie5h5iIGZoKVa/7HJ3w6I
         75MeoeOD22ofvA38iiqKNLbLlSb5LDiP9tyX4H4LrSxLI18esWQjl+pswfJkNq8PYVnH
         2Z1GneITUJCS+cSpxC7M1unrJzpodfO9aT5ww=
Received: by 10.204.69.74 with SMTP id y10mr6310537bki.79.1290510466547; Tue,
 23 Nov 2010 03:07:46 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Tue, 23 Nov 2010 03:07:25 -0800 (PST)
In-Reply-To: <47316FE3F6BA0D4DADF996635125526809F6463198@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
References: <AcuKoBrQeD5vP04TT3O/ioWSVttXng==> <47316FE3F6BA0D4DADF996635125526809F6463198@ITCS-ECLS-1-VS3.adsroot.itcs.umich.edu>
From: Robert Muir <rcmuir@gmail.com>
Date: Tue, 23 Nov 2010 06:07:25 -0500
Message-ID: <AANLkTinXi=rXoxm7QUFrmYTLFyrM62uu63_fqVtFR7zg@mail.gmail.com>
Subject: Re: ICUTokenizer and CJK
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

On Mon, Nov 22, 2010 at 6:50 PM, Burton-West, Tom <tburtonw@umich.edu> wrote:
> Hi all,
>
> I see in the javadoc for the ICUTokenizer that it has special handling for Lao,Myanmar, Khmer word breaking but no details in the javadoc about what it does with CJK, which for C and J appears to be breaking into unigrams. Is this correct?
>

The han ideographs are segmented into unigram (this is the uax#29
default behavior). I don't know off the top of my head what the rules
are for japanese kana...

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47889-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 13:44:21 2010
Return-Path: <java-user-return-47889-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4461 invoked from network); 23 Nov 2010 13:44:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 13:44:21 -0000
Received: (qmail 98566 invoked by uid 500); 23 Nov 2010 13:44:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98439 invoked by uid 500); 23 Nov 2010 13:44:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98431 invoked by uid 99); 23 Nov 2010 13:44:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 13:44:46 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jan.kurella@nokia.com designates 192.100.122.233 as permitted sender)
Received: from [192.100.122.233] (HELO mgw-mx06.nokia.com) (192.100.122.233)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 13:44:38 +0000
Received: from esebh106.NOE.Nokia.com (esebh106.ntc.nokia.com [172.21.138.213])
	by mgw-mx06.nokia.com (Switch-3.3.3/Switch-3.3.3) with ESMTP id oANDiEiL005962
	for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 15:44:15 +0200
Received: from vaebh102.NOE.Nokia.com ([10.160.244.23]) by esebh106.NOE.Nokia.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Tue, 23 Nov 2010 15:44:14 +0200
Received: from vaebh101.NOE.Nokia.com ([10.160.244.22]) by vaebh102.NOE.Nokia.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Tue, 23 Nov 2010 15:44:02 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.8]) by vaebh101.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Tue, 23 Nov 2010 15:43:55 +0200
Received: from 008-AM1MMR1-001.mgdnok.nokia.com (65.54.30.56) by
 NOK-AM1MHUB-04.mgdnok.nokia.com (65.54.30.8) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Tue, 23 Nov 2010 14:43:53 +0100
Received: from 008-AM1MPN1-006.mgdnok.nokia.com ([169.254.6.90]) by
 008-AM1MMR1-001.mgdnok.nokia.com ([65.54.30.56]) with mapi; Tue, 23 Nov 2010
 14:43:54 +0100
From: <jan.kurella@nokia.com>
To: <java-user@lucene.apache.org>
Subject: custom attributs in tokens
Thread-Topic: custom attributs in tokens
Thread-Index: AcuLFHa8Zy/jOUsiSZidZAyL1bKrtg==
Date: Tue, 23 Nov 2010 13:43:51 +0000
Message-ID: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
Accept-Language: de-DE, en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
Content-Type: multipart/alternative;
	boundary="_000_56F65098677DF5489254BE51675614E4061E11008AM1MPN1006mgdn_"
MIME-Version: 1.0
X-OriginalArrivalTime: 23 Nov 2010 13:43:55.0005 (UTC) FILETIME=[78A7A2D0:01CB8B14]
X-Nokia-AV: Clean

--_000_56F65098677DF5489254BE51675614E4061E11008AM1MPN1006mgdn_
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

SGksDQoNCkkgZm91bmQgYSBibG9nIHBvc3QgZnJvbSAyMDA4IHdoZXJlIGl0IHNheXMsIHRoZXJl
IHdpbGwgYmUgYWRkaXRpb25hbCBjdXN0b20gYXR0cmlidXRlcyBmb3IgdG9rZW5zIGluIHRoZSBm
dXR1cmUsIHRoYXQgd2lsbCBiZSBzZWFyY2hhYmxlLg0KV2hhdCBpcyB0aGUgc3RhdHVzIG9mIHRo
ZXNlPw0KDQpKYW4NCg==

--_000_56F65098677DF5489254BE51675614E4061E11008AM1MPN1006mgdn_--

From java-user-return-47890-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 15:43:44 2010
Return-Path: <java-user-return-47890-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67389 invoked from network); 23 Nov 2010 15:43:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 15:43:43 -0000
Received: (qmail 96444 invoked by uid 500); 23 Nov 2010 15:44:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96334 invoked by uid 500); 23 Nov 2010 15:44:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96326 invoked by uid 99); 23 Nov 2010 15:44:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 15:44:13 +0000
X-ASF-Spam-Status: No, hits=2.8 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLYTO,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 15:44:07 +0000
Received: by qyk10 with SMTP id 10so1673856qyk.14
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 07:43:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:content-type;
        bh=J7VSa9VL+A8wFoPEHuRZtmRVR7cgyRCgfne0DQb2gS8=;
        b=b1/q01vFZkWFBvLXYKJsYR/WaX0+0AO8btfm8ceNTaujc7Q8POojqozRjZyiiRmi8l
         Jo2r0Il1pysAPhOw3sb3zbp902h5srTgXgSVqHZeFpWHHahxkjLzj0mLb3PBW6WRQ0fj
         xMvzWuoy+FBgYYlGAZn/LxbOR8paQ+RkkkT+s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=mwtcoO/ROMzk1geXq6is42Nq7RP/gRCd2Og5zKw9zSuTuc3X6mdxoiERonLzM4vCj6
         lQLRYlEn/E9O5CCsUwj0mto7chLbjQmP/LtfrGAJlnkwoIyVLfriG4nHVV6HWIX84aLA
         64+rjIcZvePMNi2Q5ynVkPzHno9ZHaXh/QyLs=
MIME-Version: 1.0
Received: by 10.229.236.203 with SMTP id kl11mr6409968qcb.204.1290527025905;
 Tue, 23 Nov 2010 07:43:45 -0800 (PST)
Received: by 10.229.100.139 with HTTP; Tue, 23 Nov 2010 07:43:45 -0800 (PST)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
Date: Tue, 23 Nov 2010 16:43:45 +0100
Message-ID: <AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
Subject: Re: custom attributs in tokens
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Attribute Serialization is not implemented yet, not even in trunk. You
can use payloads instead.

Simon

On Tue, Nov 23, 2010 at 2:43 PM,  <jan.kurella@nokia.com> wrote:
> Hi,
>
> I found a blog post from 2008 where it says, there will be additional custom attributes for tokens in the future, that will be searchable.
> What is the status of these?
>
> Jan
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47891-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 15:51:09 2010
Return-Path: <java-user-return-47891-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70432 invoked from network); 23 Nov 2010 15:51:08 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 15:51:08 -0000
Received: (qmail 8756 invoked by uid 500); 23 Nov 2010 15:51:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8637 invoked by uid 500); 23 Nov 2010 15:51:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8629 invoked by uid 99); 23 Nov 2010 15:51:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 15:51:37 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jan.kurella@nokia.com designates 192.100.122.233 as permitted sender)
Received: from [192.100.122.233] (HELO mgw-mx06.nokia.com) (192.100.122.233)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 15:51:31 +0000
Received: from vaebh105.NOE.Nokia.com (vaebh105.europe.nokia.com [10.160.244.31])
	by mgw-mx06.nokia.com (Switch-3.3.3/Switch-3.3.3) with ESMTP id oANForFM016259
	for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 17:51:08 +0200
Received: from vaebh104.NOE.Nokia.com ([10.160.244.30]) by vaebh105.NOE.Nokia.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Tue, 23 Nov 2010 17:51:06 +0200
Received: from vaebh101.NOE.Nokia.com ([10.160.244.22]) by vaebh104.NOE.Nokia.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Tue, 23 Nov 2010 17:51:01 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.7]) by vaebh101.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Tue, 23 Nov 2010 17:50:57 +0200
Received: from 008-AM1MMR1-006.mgdnok.nokia.com (65.54.30.61) by
 NOK-AM1MHUB-03.mgdnok.nokia.com (65.54.30.7) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Tue, 23 Nov 2010 16:50:56 +0100
Received: from 008-AM1MPN1-006.mgdnok.nokia.com ([169.254.6.90]) by
 008-AM1MMR1-006.mgdnok.nokia.com ([65.54.30.61]) with mapi; Tue, 23 Nov 2010
 16:50:56 +0100
From: <jan.kurella@nokia.com>
To: <java-user@lucene.apache.org>
Subject: RE: custom attributs in tokens
Thread-Topic: custom attributs in tokens
Thread-Index: AcuLFHa8Zy/jOUsiSZidZAyL1bKrtgACF26AAAJLarA=
Date: Tue, 23 Nov 2010 15:50:54 +0000
Message-ID: <56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
 <AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
In-Reply-To: <AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
Accept-Language: de-DE, en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginalArrivalTime: 23 Nov 2010 15:50:57.0376 (UTC) FILETIME=[37F12600:01CB8B26]
X-Nokia-AV: Clean

WWVzLCBwYXlsb2FkcyBJIHdpbGwgdXNlLiBCdXQgdGhleSBwZXJmb3JtIGF0IHNjb3JlIHRpbWUg
YW5kIG5vdCBhdCBzZWFyY2ggdGltZS4gSSBqdXN0IHdhbnRlZCB0byBrbm93IGlmIHRoZXJlIGlz
IGFueXRoaW5nIGxpa2UgdGhhdC4NCg0KIm5vdCBldmVuIG9uIHRydW5rIiBkb2VzIHRoaXMgbWVh
biB0aGVyZSBpcyBhIGRpc2N1c3Npb24gYWJvdXQgdGhpcyBvbmdvaW5nIHNvbWV3aGVyZT8gSSdt
IGp1c3QgY3VyaW91cy4NCg0KSmFuDQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQpGcm9t
OiBleHQgU2ltb24gV2lsbG5hdWVyIFttYWlsdG86c2ltb24ud2lsbG5hdWVyQGdvb2dsZW1haWwu
Y29tXSANClNlbnQ6IERpZW5zdGFnLCAyMy4gTm92ZW1iZXIgMjAxMCAxNjo0NA0KVG86IGphdmEt
dXNlckBsdWNlbmUuYXBhY2hlLm9yZw0KU3ViamVjdDogUmU6IGN1c3RvbSBhdHRyaWJ1dHMgaW4g
dG9rZW5zDQoNCkF0dHJpYnV0ZSBTZXJpYWxpemF0aW9uIGlzIG5vdCBpbXBsZW1lbnRlZCB5ZXQs
IG5vdCBldmVuIGluIHRydW5rLiBZb3UNCmNhbiB1c2UgcGF5bG9hZHMgaW5zdGVhZC4NCg0KU2lt
b24NCg0KT24gVHVlLCBOb3YgMjMsIDIwMTAgYXQgMjo0MyBQTSwgIDxqYW4ua3VyZWxsYUBub2tp
YS5jb20+IHdyb3RlOg0KPiBIaSwNCj4NCj4gSSBmb3VuZCBhIGJsb2cgcG9zdCBmcm9tIDIwMDgg
d2hlcmUgaXQgc2F5cywgdGhlcmUgd2lsbCBiZSBhZGRpdGlvbmFsIGN1c3RvbSBhdHRyaWJ1dGVz
IGZvciB0b2tlbnMgaW4gdGhlIGZ1dHVyZSwgdGhhdCB3aWxsIGJlIHNlYXJjaGFibGUuDQo+IFdo
YXQgaXMgdGhlIHN0YXR1cyBvZiB0aGVzZT8NCj4NCj4gSmFuDQo+DQoNCi0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0K
VG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFj
aGUub3JnDQpGb3IgYWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBqYXZhLXVzZXItaGVscEBs
dWNlbmUuYXBhY2hlLm9yZw0KDQo=


From java-user-return-47892-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 16:49:39 2010
Return-Path: <java-user-return-47892-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 284 invoked from network); 23 Nov 2010 16:49:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 16:49:38 -0000
Received: (qmail 87102 invoked by uid 500); 23 Nov 2010 16:50:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87019 invoked by uid 500); 23 Nov 2010 16:50:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87011 invoked by uid 99); 23 Nov 2010 16:50:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 16:50:07 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 16:50:03 +0000
Received: by qwf7 with SMTP id 7so246560qwf.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 08:49:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=QaaKwgQKonC2eRNwHu31vi4xugaKkbVLh0C+1GioS/8=;
        b=a0szSDBXSTEIjSYVF9V1ccA62DlErrqzdLfMFRWuglBSo2o4WcZ4pN+sIX4w4Xs8Cn
         2zmEHMBfovIjhT+m2dcyBI4zd4Ow1t5sEefTqdG60M6O5FcYk9OLl4eibhSXXC/uvfEX
         LWdP6NIToOYQMVcI5x/yPzNIAXAimth/NE/go=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        b=My1ZknEplEXjhykvZtUcaks3/UPAdf3ZhXwf8dFHp5kxdu0WQgckzZeuc42q1P7yBI
         wTRVQZz0UcNMe/ON6j43+korMeXvkEwmeeZSiIw+RJVuGTMzCutRQqfkoo7AZp4Ud1db
         nBtrzxkqPxxUntIvWRbnRwNN2YHyiL4Cu4XFc=
MIME-Version: 1.0
Received: by 10.229.225.213 with SMTP id it21mr6542492qcb.90.1290530981800;
 Tue, 23 Nov 2010 08:49:41 -0800 (PST)
Received: by 10.229.100.139 with HTTP; Tue, 23 Nov 2010 08:49:41 -0800 (PST)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
	<56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>
Date: Tue, 23 Nov 2010 17:49:41 +0100
Message-ID: <AANLkTimuJFZvAydUAKUSJo_zbzBiAhAFBK=v2Kq+3o0j@mail.gmail.com>
Subject: Re: custom attributs in tokens
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

On Tue, Nov 23, 2010 at 4:50 PM,  <jan.kurella@nokia.com> wrote:
> Yes, payloads I will use. But they perform at score time and not at searc=
h time. I just wanted to know if there is anything like that.
>
So what is the difference? Maybe you can elaborate a little what are
you trying to do?

simon
> "not even on trunk" does this mean there is a discussion about this ongoi=
ng somewhere? I'm just curious.
>
> Jan
>
> -----Original Message-----
> From: ext Simon Willnauer [mailto:simon.willnauer@googlemail.com]
> Sent: Dienstag, 23. November 2010 16:44
> To: java-user@lucene.apache.org
> Subject: Re: custom attributs in tokens
>
> Attribute Serialization is not implemented yet, not even in trunk. You
> can use payloads instead.
>
> Simon
>
> On Tue, Nov 23, 2010 at 2:43 PM, =C2=A0<jan.kurella@nokia.com> wrote:
>> Hi,
>>
>> I found a blog post from 2008 where it says, there will be additional cu=
stom attributes for tokens in the future, that will be searchable.
>> What is the status of these?
>>
>> Jan
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47893-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 17:20:51 2010
Return-Path: <java-user-return-47893-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25590 invoked from network); 23 Nov 2010 17:20:50 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 17:20:50 -0000
Received: (qmail 20980 invoked by uid 500); 23 Nov 2010 17:21:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20855 invoked by uid 500); 23 Nov 2010 17:21:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20847 invoked by uid 99); 23 Nov 2010 17:21:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 17:21:20 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of karl.wettin@gmail.com designates 209.85.215.176 as permitted sender)
Received: from [209.85.215.176] (HELO mail-ey0-f176.google.com) (209.85.215.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 17:21:14 +0000
Received: by eyz10 with SMTP id 10so4894359eyz.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 09:20:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:content-transfer-encoding:message-id
         :references:to:x-mailer;
        bh=2ez0USSIbtdYFMpGeBqvuy+QrRjET6tL3ZvutatAB+A=;
        b=Z64L+beTztzfnNQIQKj+vQd5xOxZXrw6AwJjtMKevhFbjgKvo8pMTayml2d+WWfLiU
         Q+XaSzSFygDZYMVh8382/1SINJ16Ws9OA3Gcm+xeQeWnWE5zOIJJbZny0NnFWZdVcLzl
         G63lTHP1cicXLqOgP6x9bdjZtvhVHq4DZvv4Q=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=BAQlZLC4NovqGft0IBKxSn/prsrcmtHuRdCdLaXJI/l6l21g5LZS9XPKdbwMmRt6d3
         gySI8gtcy5v2PtD7iMrz8VIbAUntVzglNyHPjbGPQm2adx3DO0rszrXWGOM7xGqQo3qv
         DE4qwTJE7bsTdEFv7/FaeeC8NfRKDwO7IChew=
Received: by 10.213.103.74 with SMTP id j10mr7211473ebo.46.1290532852917;
        Tue, 23 Nov 2010 09:20:52 -0800 (PST)
Received: from [192.168.2.2] (dslb-088-072-227-170.pools.arcor-ip.net [88.72.227.170])
        by mx.google.com with ESMTPS id v51sm6002534eeh.16.2010.11.23.09.20.51
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 23 Nov 2010 09:20:52 -0800 (PST)
Content-Type: text/plain; charset=windows-1252
Mime-Version: 1.0 (Apple Message framework v1081)
Subject: Re: [SOLR] DisMaxQParserPlugin and Tokenization
From: Karl Wettin <karl.wettin@gmail.com>
In-Reply-To: <56F65098677DF5489254BE51675614E405E5FF@008-AM1MPN1-006.mgdnok.nokia.com>
Date: Tue, 23 Nov 2010 18:20:47 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <DF31C024-C005-496D-A64C-DF3D74AA661D@gmail.com>
References: <56F65098677DF5489254BE51675614E405E5FF@008-AM1MPN1-006.mgdnok.nokia.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1081)


22 nov 2010 kl. 10.56 skrev <jan.kurella@nokia.com> =
<jan.kurella@nokia.com>:

> Using the SearchHandler with the deftype=3D=94dismax=94 option enables =
the DisMaxQParserPlugin. =46rom investigating it seems, it is just =
tokenizing by whitespace.
>=20
> Although by looking in the code I could not find the place, where this =
behavior is enforced? I only found, that for each field the =
getFieldQuery() method is called, which either throws an =93unknownField=94=
 exception or returns the correct analyzer including tokenizer and =
filter for the given field.
>=20
> We want to use a more fancier Tokenizer/filter setting with the =
DisMaxQuery stuff.
>=20
> Where to hook in best?


Hi Jan,

you might want to start looking at =
SolrPluginUtils.DisjunctionMaxQueryParser.


	karl


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47894-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 18:42:33 2010
Return-Path: <java-user-return-47894-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79490 invoked from network); 23 Nov 2010 18:42:33 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 18:42:33 -0000
Received: (qmail 29281 invoked by uid 500); 23 Nov 2010 18:43:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29156 invoked by uid 500); 23 Nov 2010 18:43:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29148 invoked by uid 99); 23 Nov 2010 18:43:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 18:43:02 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [98.138.90.72] (HELO nm9.bullet.mail.ne1.yahoo.com) (98.138.90.72)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 23 Nov 2010 18:42:54 +0000
Received: from [98.138.90.50] by nm9.bullet.mail.ne1.yahoo.com with NNFMP; 23 Nov 2010 18:42:33 -0000
Received: from [98.138.87.9] by tm3.bullet.mail.ne1.yahoo.com with NNFMP; 23 Nov 2010 18:42:33 -0000
Received: from [127.0.0.1] by omp1009.mail.ne1.yahoo.com with NNFMP; 23 Nov 2010 18:42:33 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 502579.83700.bm@omp1009.mail.ne1.yahoo.com
Received: (qmail 6658 invoked by uid 60001); 23 Nov 2010 18:34:34 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1290537273; bh=2oNuI09vsvNV0cEwxhsoVxXJln99yF0pO7q2zxQvfuY=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=aaMIn7qvPnJQpqCWhBuJjhkpg8DksRO1Gjpcyb/fxUvEGIpNp06ILwXWDPUCM98XHktK+wRjOX7N77KCQCS91cmGIa7zCnKPPJpy3ahuQwTGuDgcWEInxSZYnMrqiMl/IBpJuR24ug9YnqbKU0nZL3t0IQIGKrk5Dva3fFz3vUY=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=15LRs0oFmSe8ChpYzUVK+2gUrSGEUvJBG4j29Q0Y9+xTKgbJ0pKbEdpuqB915maKfr1byYZ43wggcP7OnFCCYJGJtTrbViBIR5Jz6E+vy7FmVO725bc/jLr50bkRr1l5uWhWHpwMaaUeGawJ40oYJhKIdQCOoVhy7StE5T9kMus=;
Message-ID: <838765.5346.qm@web113316.mail.gq1.yahoo.com>
X-YMail-OSG: IXTAx8sVM1nwAuWTgX4eO4z1cNsJwzM_pvm.KlX11fjjC0u
 yrp7L0LbFZhdXdjcINnwzNYuJatPdUZnHyHluhPkbpHXOvVcqxF2vAEJm25U
 hAiPaS583LwkeMCuDBg90Sppeu7KSQSH4G5ZWPGj5eYSX8wt0GfDA_4Og2X9
 9d76iRXAy6FcQhQ5zfrBjz6XjPxqhgSqvlXAU6Y0CE8d3QhwWg08k.nFx2Ki
 faXDubzWfn8B.Y3lWrniCfq83gQAwsFqYR_XhAJXaeyMvLhYzOlZezPah5o2
 pgJOA.kn9c.arfyxNHXPJUimcjUdI09x9bVdB_Ktgjq6c_ckfd5v6VQD9VoA
 tcg--
Received: from [78.86.199.52] by web113316.mail.gq1.yahoo.com via HTTP; Tue, 23 Nov 2010 10:34:33 PST
X-Mailer: YahooMailClassic/11.4.9 YahooMailWebService/0.8.107.285259
Date: Tue, 23 Nov 2010 10:34:33 -0800 (PST)
From: farouk alhassan <osbert252003@yahoo.com>
Subject: Lucene with Geospatial Data
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-777104992-1290537273=:5346"

--0-777104992-1290537273=:5346
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi All,
Is there a lucene plugin that allows indexing and searching of geospatial D=
ata?
=0A=0A=0A      
--0-777104992-1290537273=:5346--

From java-user-return-47895-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 19:00:10 2010
Return-Path: <java-user-return-47895-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86381 invoked from network); 23 Nov 2010 19:00:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 19:00:10 -0000
Received: (qmail 50530 invoked by uid 500); 23 Nov 2010 19:00:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50491 invoked by uid 500); 23 Nov 2010 19:00:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50483 invoked by uid 99); 23 Nov 2010 19:00:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 19:00:34 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,MIME_BASE64_BLANKS,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.212.176 as permitted sender)
Received: from [209.85.212.176] (HELO mail-px0-f176.google.com) (209.85.212.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 19:00:26 +0000
Received: by pxi11 with SMTP id 11so2311551pxi.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 11:00:05 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:x-rim-org-msg-ref-id
         :message-id:content-transfer-encoding:reply-to:x-priority:references
         :in-reply-to:sensitivity:importance:subject:to:from:date
         :content-type:mime-version;
        bh=aA01T2Z/mC2sFB53doQili0MI3xBgZTD8w/37cMyWcw=;
        b=w0jf1fpPRycSFDi3bhMGMnTrJ0jV1oZDT+SknaDpjvpKLrv/tjSoSEwIXZwGABpdrW
         tQak5uAvl/S1Ez3idDgbLMs2OmpmZGwRq2Q4hxHH4AdmRgpbeBhNFKq/AeDr72D464xs
         0IcoTGUb++n3SO8NxwSueMfuVcx6o+6ityj2U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=x-rim-org-msg-ref-id:message-id:content-transfer-encoding:reply-to
         :x-priority:references:in-reply-to:sensitivity:importance:subject:to
         :from:date:content-type:mime-version;
        b=UXbAgptfOlks+d+plqeZAnAVeZk3qAozNtQjPyDMa/VP2LNlHfIm2EYiG6qf72kUU0
         XTVVA8U5wgfxMCYIbEtuf2chuv8oiUucOk3hcwUi2zSd6+9zxNN+QIopaRjVQwsS+HkP
         rO21EjCyrAOs37OeuiyS9mPoibpCCO2jIIrb8=
Received: by 10.204.59.193 with SMTP id m1mr7384752bkh.176.1290538801391;
        Tue, 23 Nov 2010 11:00:01 -0800 (PST)
Received: from ups49.c1.bise7.blackberry (bda-178-239-83-187.bis7.eu.blackberry.com [178.239.83.187])
        by mx.google.com with ESMTPS id d27sm3276275bkw.14.2010.11.23.11.00.00
        (version=SSLv3 cipher=RC4-MD5);
        Tue, 23 Nov 2010 11:00:00 -0800 (PST)
X-rim-org-msg-ref-id:983549310
Message-ID:<983549310-1290538798-cardhu_decombobulator_blackberry.rim.net-2027073456-@b12.c1.bise7.blackberry>
Content-Transfer-Encoding: base64
Reply-To: anshumg@gmail.com
X-Priority: Normal
References: <838765.5346.qm@web113316.mail.gq1.yahoo.com>
In-Reply-To: <838765.5346.qm@web113316.mail.gq1.yahoo.com>
Sensitivity: Normal
Importance: Normal
Subject: Re: Lucene with Geospatial Data
To: java-user@lucene.apache.org
From: "anshum.gupta@naukri.com" <anshumg@gmail.com>
Date: Tue, 23 Nov 2010 18:59:47 +0000
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

WW91IGNvdWxkIGhhdmUgYSBsb29rIGF0IGx1Y2VuZSBzcGF0aWFsIGluIHRoZSBjb250cmliIQ0K
DQotLQ0KQW5zaHVtDQpodHRwOi8vYmxvZy5hbnNodW1ndXB0YS5uZXQNCg0KU2VudCBmcm9tIEJs
YWNrQmVycnnCrg0KDQotLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KRnJvbTogZmFyb3VrIGFs
aGFzc2FuIDxvc2JlcnQyNTIwMDNAeWFob28uY29tPg0KRGF0ZTogVHVlLCAyMyBOb3YgMjAxMCAx
MDozNDozMyANClRvOiA8amF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3JnPg0KUmVwbHktVG86IGph
dmEtdXNlckBsdWNlbmUuYXBhY2hlLm9yZw0KU3ViamVjdDogTHVjZW5lIHdpdGggR2Vvc3BhdGlh
bCBEYXRhDQoNCkhpIEFsbCwNCklzIHRoZXJlIGEgbHVjZW5lIHBsdWdpbiB0aGF0IGFsbG93cyBp
bmRleGluZyBhbmQgc2VhcmNoaW5nIG9mIGdlb3NwYXRpYWwgRGF0YT8NCgoKCg0K



From java-user-return-47896-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 23 22:22:41 2010
Return-Path: <java-user-return-47896-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13135 invoked from network); 23 Nov 2010 22:22:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 23 Nov 2010 22:22:40 -0000
Received: (qmail 31775 invoked by uid 500); 23 Nov 2010 22:23:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31720 invoked by uid 500); 23 Nov 2010 22:23:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31712 invoked by uid 99); 23 Nov 2010 22:23:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 22:23:10 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 74.125.83.176 as permitted sender)
Received: from [74.125.83.176] (HELO mail-pv0-f176.google.com) (74.125.83.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 23 Nov 2010 22:23:04 +0000
Received: by pvb32 with SMTP id 32so2604548pvb.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 14:22:44 -0800 (PST)
Received: by 10.231.35.8 with SMTP id n8mr8855689ibd.73.1290550963145;
        Tue, 23 Nov 2010 14:22:43 -0800 (PST)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id gy41sm6956699ibb.11.2010.11.23.14.22.41
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 23 Nov 2010 14:22:42 -0800 (PST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: IndexWriter.close() performance issue
From: Mark Kristensson <mark.kristensson@smartsheet.com>
In-Reply-To: <AANLkTim=onWvY2Re3rXSMqzG8UPkgz64SO=6dgCPFJ3H@mail.gmail.com>
Date: Tue, 23 Nov 2010 14:22:34 -0800
Content-Transfer-Encoding: quoted-printable
Message-Id: <0B90E668-A9BA-4C0B-A531-9E77C3FCB61E@smartsheet.com>
References: <B0BF640B-3986-42D6-B081-9C8B51B8E07E@smartsheet.com> <AANLkTi=JbCXFPSNucwnY5OK4fKTfQojk_5yt0==avpr8@mail.gmail.com> <79A8B638-16FD-486C-BE62-76CCAE58D620@smartsheet.com> <8ED783FE-BBE2-415A-A3B0-847D7500509E@smartsheet.com> <AANLkTi=N-4VbdG1qDRUH+0rMyOjSQ8f_GTZJMJ_=_s4B@mail.gmail.com> <1D4E4B59-1D3E-4CC2-B655-2729861E179B@smartsheet.com> <AANLkTimJjZC8ZJYsKpSn50ER-nSUhmOG_ZMQYYwLVHA5@mail.gmail.com> <ACBD00C9-7962-4E60-9F5D-0C8A9A6A730C@smartsheet.com> <AANLkTinZcwETVu3VXLqhzBpin6UpP2c5e417V3nduaPs@mail.gmail.com> <1F455CF6-C0F6-48E0-906D-989B374BB23E@smartsheet.com> <AANLkTinyXmXnN3xftEugQnF3EAT+LmHeEe_64ytvojhy@mail.gmail.com> <AANLkTikQx9OgpZw7RWZUdjNJrTtriKGO5Zv7F7EpNqxp@mail.gmail.com> <50E7FE59-B632-471A-A3E0-6B46FE5FDC10@smartsheet.com> <AANLkTim=onWvY2Re3rXSMqzG8UPkgz64SO=6dgCPFJ3H@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1082)

I've tried the suggestion below, but it really doesn't seem to have any =
impact. I guess that's not surprising since 80% of the CPU time when I =
ran hprof was in String.intern(), not in the StringHelper class.=20

Clearly, if I'm going to hack things up at this level, I've got some =
work do to, including:
- Synchronizing access to the storage mechanism I use for the strings
- Using something else (String?) for the hashCode (instead of the =
String's built-in integer hashcode).

Could I not use the HashMap solution I proposed to ensure that all field =
name strings that are the same refer to the same instance of the String? =
Does a HashMap.get() not return the same instance with every call?=20

I'm also intrigued by a comment from Mike about FieldInfos and using =
those to control the uniqueness. Any suggestions on how I go about doing =
that? Would that be instead of monkeying with StringHelper or in =
addition to it?

Thanks,
Mark



On Nov 20, 2010, at 5:44 AM, Yonik Seeley wrote:

> On Fri, Nov 19, 2010 at 5:41 PM, Mark Kristensson
> <mark.kristensson@smartsheet.com> wrote:
>> Here's the changes I made to org.apache.lucene.util.StringHelper:
>>=20
>>  //public static StringInterner interner =3D new =
SimpleStringInterner(1024,8);
>=20
> As Mike said, the real fix for trunk is to get rid of interning.
> But for your version, you could try making the string intern cache =
larger.
>=20
> StringHelper.interner =3D new SimpleStringInterner(300000,8);
>=20
> -Yonik
> http://www.lucidimagination.com
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47897-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 24 01:04:49 2010
Return-Path: <java-user-return-47897-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 1589 invoked from network); 24 Nov 2010 01:04:49 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Nov 2010 01:04:49 -0000
Received: (qmail 92042 invoked by uid 500); 24 Nov 2010 01:05:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92003 invoked by uid 500); 24 Nov 2010 01:05:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91995 invoked by uid 99); 24 Nov 2010 01:05:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 01:05:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nabiber@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 01:05:05 +0000
Received: by ywk9 with SMTP id 9so263496ywk.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 17:04:44 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=dFsou69Te/4QFiPkHRk018ApBEAwBU0Wo0gdtmEiEwI=;
        b=TDiBPVw/Uy1uCCxis8cyL1Ka84bSx0iUpkbNy4BVWwhwzqO5je0kcUH4CbkBvp2H/y
         RKvSSHelAl+o+WjdDgmxl6fChyMoKDiyRI3AMF00URsZTCTqHGNB7Q1zWY47Dn0zPStp
         id1iD6BLfjdgV+yqC4wJjCVV0134IrzLtpdvA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=xXBHzqRHd+deib5JUGOZ1DjEATZFE1S++JkMKvXIzDZBVp6/lL7ozqmEc36bcSQ+u4
         msUGFjHXO0nvmsS47EQsiaQNjIVYhFdS7kLROt/KBj0m/rl6T1pnLV8q2V/dZQJOWUjM
         8/rphmE5PXHy290ZKvKqh1Kl2TniNHOwNb2hs=
MIME-Version: 1.0
Received: by 10.100.167.18 with SMTP id p18mr5684402ane.180.1290560684317;
 Tue, 23 Nov 2010 17:04:44 -0800 (PST)
Received: by 10.100.244.10 with HTTP; Tue, 23 Nov 2010 17:04:44 -0800 (PST)
Date: Tue, 23 Nov 2010 17:04:44 -0800
Message-ID: <AANLkTi=a59yq1gvimYv8orgXa5FPzr_UEw=YBOTuFZOM@mail.gmail.com>
Subject: Not query help.
From: Nabib El-Rahman <nabiber@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f6d1ae265d6b0495c21329
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f6d1ae265d6b0495c21329
Content-Type: text/plain; charset=ISO-8859-1

Hi,

What I need is a Not TermQuery. I did not see one in the API, so I did the
following:

Query query = new BooleanQuery(new BooleanClause(new
TermQuery(..), BooleanClause.Occur.MUST_NOT)));

This did not produce the correct search result. Does anyone have any idea on
how to accomplish this?

And is here such a thing as NotTermQuery(..) ?

Thanks in advance!

-Nabib

--001485f6d1ae265d6b0495c21329--

From java-user-return-47898-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 24 01:14:44 2010
Return-Path: <java-user-return-47898-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12736 invoked from network); 24 Nov 2010 01:14:44 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Nov 2010 01:14:44 -0000
Received: (qmail 98251 invoked by uid 500); 24 Nov 2010 01:15:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98124 invoked by uid 500); 24 Nov 2010 01:15:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98116 invoked by uid 99); 24 Nov 2010 01:15:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 01:15:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 74.125.83.48 as permitted sender)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 01:15:07 +0000
Received: by gwj19 with SMTP id 19so1759367gwj.35
        for <java-user@lucene.apache.org>; Tue, 23 Nov 2010 17:14:46 -0800 (PST)
MIME-Version: 1.0
Received: by 10.90.57.2 with SMTP id f2mr9617466aga.118.1290561285836; Tue, 23
 Nov 2010 17:14:45 -0800 (PST)
Received: by 10.236.84.235 with HTTP; Tue, 23 Nov 2010 17:14:45 -0800 (PST)
In-Reply-To: <AANLkTi=a59yq1gvimYv8orgXa5FPzr_UEw=YBOTuFZOM@mail.gmail.com>
References: <AANLkTi=a59yq1gvimYv8orgXa5FPzr_UEw=YBOTuFZOM@mail.gmail.com>
Date: Tue, 23 Nov 2010 17:14:45 -0800
Message-ID: <AANLkTimRLUvJrxbHfDJsn_z=WB46f7argyrNDTdm+F2r@mail.gmail.com>
Subject: Re: Not query help.
From: Mark Kristensson <mark.kristensson@smartsheet.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163630fa1b00d1930495c23764

--00163630fa1b00d1930495c23764
Content-Type: text/plain; charset=UTF-8

I've had to deal with exactly this same scenario and, from what I know,
there is no equivalent in Lucene to a SQL != kind of query. So, you have to
have some way to select "everything" (whatever that means in your scenario)
and then remove the stuff that you don't want (the NOT portion). For my
application, I have a user permission field that I can use to select
everything that a user has access to and then I can "NOT out" the stuff
specified by the != portion of the query. These, of course, are two queries
that I AND together with a BooleanQuery.

-Mark

On Tue, Nov 23, 2010 at 5:04 PM, Nabib El-Rahman <nabiber@gmail.com> wrote:

> Hi,
>
> What I need is a Not TermQuery. I did not see one in the API, so I did the
> following:
>
> Query query = new BooleanQuery(new BooleanClause(new
> TermQuery(..), BooleanClause.Occur.MUST_NOT)));
>
> This did not produce the correct search result. Does anyone have any idea
> on
> how to accomplish this?
>
> And is here such a thing as NotTermQuery(..) ?
>
> Thanks in advance!
>
> -Nabib
>

--00163630fa1b00d1930495c23764--

From java-user-return-47899-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 24 07:56:06 2010
Return-Path: <java-user-return-47899-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 99169 invoked from network); 24 Nov 2010 07:56:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Nov 2010 07:56:06 -0000
Received: (qmail 86996 invoked by uid 500); 24 Nov 2010 07:56:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86685 invoked by uid 500); 24 Nov 2010 07:56:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86677 invoked by uid 99); 24 Nov 2010 07:56:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 07:56:34 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 07:56:26 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 4887445E9C2
	for <java-user@lucene.apache.org>; Wed, 24 Nov 2010 08:56:06 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 0Q0Lcfz5mtCx for <java-user@lucene.apache.org>;
	Wed, 24 Nov 2010 08:56:01 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id C401645E821
	for <java-user@lucene.apache.org>; Wed, 24 Nov 2010 08:56:00 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTi=a59yq1gvimYv8orgXa5FPzr_UEw=YBOTuFZOM@mail.gmail.com>
In-Reply-To: <AANLkTi=a59yq1gvimYv8orgXa5FPzr_UEw=YBOTuFZOM@mail.gmail.com>
Subject: RE: Not query help.
Date: Wed, 24 Nov 2010 08:56:26 +0100
Message-ID: <002301cb8bad$18749e10$495dda30$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQGE+We1lP0TEpcPmMa+90tQ1sXpBpQNZqAA
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

Do it like that:

BooleanQuery bq = new BooleanQuery();
bq.add(new MatchAllDocsQuery(), BooleanClause.Occur.MUST);
bq.add(new TermQuery(..), BooleanClause.Occur.MUST_NOT);

Uwe
-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Nabib El-Rahman [mailto:nabiber@gmail.com]
> Sent: Wednesday, November 24, 2010 2:05 AM
> To: java-user@lucene.apache.org
> Subject: Not query help.
> 
> Hi,
> 
> What I need is a Not TermQuery. I did not see one in the API, so I did the
> following:
> 
> Query query = new BooleanQuery(new BooleanClause(new TermQuery(..),
> BooleanClause.Occur.MUST_NOT)));
> 
> This did not produce the correct search result. Does anyone have any idea
on
> how to accomplish this?
> 
> And is here such a thing as NotTermQuery(..) ?
> 
> Thanks in advance!
> 
> -Nabib


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47900-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 24 08:13:32 2010
Return-Path: <java-user-return-47900-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13605 invoked from network); 24 Nov 2010 08:13:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Nov 2010 08:13:32 -0000
Received: (qmail 1674 invoked by uid 500); 24 Nov 2010 08:14:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1357 invoked by uid 500); 24 Nov 2010 08:14:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1349 invoked by uid 99); 24 Nov 2010 08:13:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 08:13:59 +0000
X-ASF-Spam-Status: No, hits=-5.0 required=10.0
	tests=RCVD_IN_DNSWL_HI,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jan.kurella@nokia.com designates 192.100.105.134 as permitted sender)
Received: from [192.100.105.134] (HELO mgw-mx09.nokia.com) (192.100.105.134)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 08:13:51 +0000
Received: from vaebh105.NOE.Nokia.com (vaebh105.europe.nokia.com [10.160.244.31])
	by mgw-mx09.nokia.com (Switch-3.3.3/Switch-3.3.3) with ESMTP id oAO8D2eg014608
	for <java-user@lucene.apache.org>; Wed, 24 Nov 2010 02:13:27 -0600
Received: from esebh102.NOE.Nokia.com ([172.21.138.183]) by vaebh105.NOE.Nokia.com with Microsoft SMTPSVC(6.0.3790.4675);
	 Wed, 24 Nov 2010 10:13:05 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.5]) by esebh102.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Wed, 24 Nov 2010 10:13:05 +0200
Received: from 008-AM1MMR1-004.mgdnok.nokia.com (65.54.30.59) by
 NOK-am1MHUB-01.mgdnok.nokia.com (65.54.30.5) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Wed, 24 Nov 2010 09:13:04 +0100
Received: from 008-AM1MPN1-006.mgdnok.nokia.com ([169.254.6.90]) by
 008-AM1MMR1-004.mgdnok.nokia.com ([65.54.30.59]) with mapi; Wed, 24 Nov 2010
 09:12:52 +0100
From: <jan.kurella@nokia.com>
To: <java-user@lucene.apache.org>
Subject: RE: custom attributs in tokens
Thread-Topic: custom attributs in tokens
Thread-Index: AcuLFHa8Zy/jOUsiSZidZAyL1bKrtgACF26AAAJLarAAAAITgAAiCdDQ
Date: Wed, 24 Nov 2010 08:12:51 +0000
Message-ID: <56F65098677DF5489254BE51675614E406425C@008-AM1MPN1-006.mgdnok.nokia.com>
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
	<56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>
 <AANLkTimuJFZvAydUAKUSJo_zbzBiAhAFBK=v2Kq+3o0j@mail.gmail.com>
In-Reply-To: <AANLkTimuJFZvAydUAKUSJo_zbzBiAhAFBK=v2Kq+3o0j@mail.gmail.com>
Accept-Language: de-DE, en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginalArrivalTime: 24 Nov 2010 08:13:05.0468 (UTC) FILETIME=[6BD267C0:01CB8BAF]
X-Nokia-AV: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

T2YgY291cnNlOg0KDQpXZSBhcmUgdHJ5aW5nIHRvIHNlYXJjaCBpbiBkb2N1bWVudHMgdGhhdCBj
b250YWluIHRleHQgaW4gc2V2ZXJhbCBsYW5ndWFnZXMuIFdlIGFyZSBhbHNvIGludmVzdGlnYXRp
bmcgb3RoZXIgYXBwcm9hY2hlcyosIHNvIHRoaXMgaXMgbm90IGFib3V0IGZpbmRpbmcgb3RoZXIg
dmFyaWFudHMuDQp0aGUgZ29hbCBpcyB0byBvbmx5IG1hdGNoIHRva2VucyBmcm9tIDEgb3IgbW9y
ZSBnaXZlbiBsYW5ndWFnZXMgYW5kIG5vdCB0byBtYXRjaCB0aGUgdG9rZW4gaWYgaXQgaXMgYnkg
YWNjaWRlbnQgdGhlIHNhbWUgaW4gYW5vdGhlciBsYW5ndWFnZS4NCg0KRm9yIHRoZSBwYXlsb2Fk
cyBteSBwbGFuIGlzIHRvIGFkZCB0aGUgY29ycmVjdCBsYW5ndWFnZSB0byBlYWNoIGFuZCBldmVy
eSB0b2tlbiBkdXJpbmcgaW5kZXhpbmcgKEknbSBub3Qgc3VyZSBob3cgdG8gc29sdmUgdGhpcyBi
ZXN0LCBidXQgSSdtIHN1cmUgdGhpcyBjYW4gYmUgc29sdmVkIGF0IGxlYXN0IHdpdGggbHVjZW5l
IGRpcmVjdGx5KS4NCk9uIHNlYXJjaCBzaWRlIG15IGN1cnJlbnQgaWRlYSBpcyB0byB3cmFwIGFy
b3VuZCBhIFRlcm1Qb3NpdGlvbiBhbmQgc2tpcCBhbGwgZG9jcywgd2hlcmUgdGhlIGN1cnJlbnQg
cGF5bG9hZCBoYXMgbm90IG9uZSBvZiB0aGUgcmVxdWVzdGVkIGxhbmd1YWdlcy4NCkkgcHJvYmFi
bHkgbmVlZCB0byB1c2UgbXkgb3duIFF1ZXJ5L1dlaWdodCBmb3IgdGhpcz8NCkFub3RoZXIgYXBw
cm9hY2ggd291bGQgYmUgdG8ganVzdCBvdmVyd3JpdGUgdGhlIFNpbWlsYXJpdHksIGJ1dCB0aGlz
IHdpbGwgb25seSBpbmZsdWVuY2Ugc2NvcmluZyBhbmQgZGVwZW5kaW5nIG9uIHRoZSB1bmRlcmx5
aW5nIHF1ZXJ5IG5vdCBjb21wbGV0ZWx5IHNraXAgdGhlIHRva2VuIC0gSSBoYXZlIHRvIHRlc3Qg
dGhlIGRpZmZlcmVuY2UgZm9yIHRoZSBmaW5hbCBzY29yZSBiZXR3ZWVuIHRoaXMgYXBwcm9hY2hl
cy4NCg0KVGhpcyBvbmUgYmxvZyBtYWRlIG1lIGN1cmlvdXMgaWYgdGhlcmUgaXMgYWxyZWFkeSBz
b21ldGhpbmcgc2ltaWxhciwgdGhhdCBza2lwcyBUZXJtUG9zaXRpb25zIGJhc2VkIG9uIGdpdmVu
IGF0dHJpYnV0ZXM/IEkgY291bGQgaW1hZ2luZSBzb21ldGhpbmcgc2ltaWxhciB0byB0aGUgY3Vy
cmVudCBUb2tlbmF0dHJpYnV0ZSBjb25jZXB0IGR1cmluZyBpbmRleCB0aW1lLCBidXQgYWxzbyBh
dmFpbGFibGUgZHVyaW5nIHNlYXJjaCBhbmQgY29udHJvbGxlZCBieSBhIHNpbWlsYXJpdHkuLi4N
Cg0KSmFuDQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQpGcm9tOiBleHQgU2ltb24gV2ls
bG5hdWVyIFttYWlsdG86c2ltb24ud2lsbG5hdWVyQGdvb2dsZW1haWwuY29tXSANClNlbnQ6IERp
ZW5zdGFnLCAyMy4gTm92ZW1iZXIgMjAxMCAxNzo1MA0KVG86IGphdmEtdXNlckBsdWNlbmUuYXBh
Y2hlLm9yZw0KU3ViamVjdDogUmU6IGN1c3RvbSBhdHRyaWJ1dHMgaW4gdG9rZW5zDQoNCk9uIFR1
ZSwgTm92IDIzLCAyMDEwIGF0IDQ6NTAgUE0sICA8amFuLmt1cmVsbGFAbm9raWEuY29tPiB3cm90
ZToNCj4gWWVzLCBwYXlsb2FkcyBJIHdpbGwgdXNlLiBCdXQgdGhleSBwZXJmb3JtIGF0IHNjb3Jl
IHRpbWUgYW5kIG5vdCBhdCBzZWFyY2ggdGltZS4gSSBqdXN0IHdhbnRlZCB0byBrbm93IGlmIHRo
ZXJlIGlzIGFueXRoaW5nIGxpa2UgdGhhdC4NCj4NClNvIHdoYXQgaXMgdGhlIGRpZmZlcmVuY2U/
IE1heWJlIHlvdSBjYW4gZWxhYm9yYXRlIGEgbGl0dGxlIHdoYXQgYXJlDQp5b3UgdHJ5aW5nIHRv
IGRvPw0KDQpzaW1vbg0KPiAibm90IGV2ZW4gb24gdHJ1bmsiIGRvZXMgdGhpcyBtZWFuIHRoZXJl
IGlzIGEgZGlzY3Vzc2lvbiBhYm91dCB0aGlzIG9uZ29pbmcgc29tZXdoZXJlPyBJJ20ganVzdCBj
dXJpb3VzLg0KPg0KPiBKYW4NCj4NCj4gLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCj4gRnJv
bTogZXh0IFNpbW9uIFdpbGxuYXVlciBbbWFpbHRvOnNpbW9uLndpbGxuYXVlckBnb29nbGVtYWls
LmNvbV0NCj4gU2VudDogRGllbnN0YWcsIDIzLiBOb3ZlbWJlciAyMDEwIDE2OjQ0DQo+IFRvOiBq
YXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNCj4gU3ViamVjdDogUmU6IGN1c3RvbSBhdHRyaWJ1
dHMgaW4gdG9rZW5zDQo+DQo+IEF0dHJpYnV0ZSBTZXJpYWxpemF0aW9uIGlzIG5vdCBpbXBsZW1l
bnRlZCB5ZXQsIG5vdCBldmVuIGluIHRydW5rLiBZb3UNCj4gY2FuIHVzZSBwYXlsb2FkcyBpbnN0
ZWFkLg0KPg0KPiBTaW1vbg0KPg0KPiBPbiBUdWUsIE5vdiAyMywgMjAxMCBhdCAyOjQzIFBNLCDC
oDxqYW4ua3VyZWxsYUBub2tpYS5jb20+IHdyb3RlOg0KPj4gSGksDQo+Pg0KPj4gSSBmb3VuZCBh
IGJsb2cgcG9zdCBmcm9tIDIwMDggd2hlcmUgaXQgc2F5cywgdGhlcmUgd2lsbCBiZSBhZGRpdGlv
bmFsIGN1c3RvbSBhdHRyaWJ1dGVzIGZvciB0b2tlbnMgaW4gdGhlIGZ1dHVyZSwgdGhhdCB3aWxs
IGJlIHNlYXJjaGFibGUuDQo+PiBXaGF0IGlzIHRoZSBzdGF0dXMgb2YgdGhlc2U/DQo+Pg0KPj4g
SmFuDQo+Pg0KPg0KPiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2
YS11c2VyLXVuc3Vic2NyaWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+IEZvciBhZGRpdGlvbmFsIGNv
bW1hbmRzLCBlLW1haWw6IGphdmEtdXNlci1oZWxwQGx1Y2VuZS5hcGFjaGUub3JnDQo+DQo+DQoN
Ci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQ0KVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2Ny
aWJlQGx1Y2VuZS5hcGFjaGUub3JnDQpGb3IgYWRkaXRpb25hbCBjb21tYW5kcywgZS1tYWlsOiBq
YXZhLXVzZXItaGVscEBsdWNlbmUuYXBhY2hlLm9yZw0KDQo=


From java-user-return-47901-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Nov 24 17:02:22 2010
Return-Path: <java-user-return-47901-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87420 invoked from network); 24 Nov 2010 17:02:22 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 24 Nov 2010 17:02:22 -0000
Received: (qmail 93385 invoked by uid 500); 24 Nov 2010 17:02:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93249 invoked by uid 500); 24 Nov 2010 17:02:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93236 invoked by uid 99); 24 Nov 2010 17:02:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 17:02:48 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_BL_SPAMCOP_NET,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jzillmann@googlemail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 24 Nov 2010 17:02:41 +0000
Received: by fxm2 with SMTP id 2so5341610fxm.35
        for <java-user@lucene.apache.org>; Wed, 24 Nov 2010 09:02:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:received:received:from:content-type
         :content-transfer-encoding:date:subject:to:message-id:mime-version
         :x-mailer;
        bh=V3U5HasNT9QhQ0VzTcngFVY/XrnMhhbhLP3TLq2JnXU=;
        b=HZLT88yfn0csLMMm6J/aov5s3nzcflZ1M9Q3prJ8+Ezpv7LodOV3iCjt2m2ZGZjagv
         RRiK5fXcyntJpUyOVnjsjB8tX4Cs3tsMRUkLXiLl3m08ZWSN0FouKRivaexHr2B74Sud
         U3rlMzYv/VjrWpoBSyFTnONVGWQrhkCB/HsqM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=from:content-type:content-transfer-encoding:date:subject:to
         :message-id:mime-version:x-mailer;
        b=yC5m39svee95FUw/B5YmBbDcO+6rRHJ9Vi5CxvcQuBhz8cpOODnjt6q3eJbbhOS+3C
         9CzfX5OKWp1H+msD4XE2iKLhZY9s0PHtQp+yuhe1uOYyU1ubkmu8smTsBB94AAvq6l4/
         Xp5e6eNozCC9AgQHt5HNtu7roQcqrrRuuE63w=
Received: by 10.223.70.139 with SMTP id d11mr7511765faj.36.1290618140941;
        Wed, 24 Nov 2010 09:02:20 -0800 (PST)
Received: from [10.148.243.16] (tmo-100-16.customers.d1-online.com [80.187.100.16])
        by mx.google.com with ESMTPS id c10sm2280575fat.30.2010.11.24.09.02.18
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 24 Nov 2010 09:02:19 -0800 (PST)
From: Johannes Zillmann <jzillmann@googlemail.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Wed, 24 Nov 2010 18:02:16 +0100
Subject: [ANNOUNCE] Katta 0.6.3 released
To: Katta Dev <katta-developer@lists.sourceforge.net>
Message-Id: <4E76704E-87FD-4A73-8081-2A3F6DC3812D@googlemail.com>
Mime-Version: 1.0 (Apple Message framework v1081)
X-Mailer: Apple Mail (2.1081)
X-Virus-Checked: Checked by ClamAV on apache.org

Release 0.6.3 of Katta is now available.
Katta - Lucene (or Hadoop Mapfiles or any content which can be split =
into shards) in the cloud.
http://katta.sourceforge.net

The changes of the 0.6.3 release:
 fix KATTA-165, fix IndexOutOfBoundsException when adding index with =
enabled throttling
 fix KATTA-161, fix deadlock situation when node gets disconnected from =
zk and so becomes unresponsive
 fix KATTA-162, Allow LuceneClient to be extended more easily
 fix KATTA-156, allow shard selection by regular expression
 fix KATTA-163, don't exit node/master operation thread in case an =
unexpected exception occurs
 fix KATTA-160, Stop trying to rebalance/replicate an index when the =
index could not be found in the file system any more
 fix KATTA-134, cobertura.jar version mismatch when compiling =
/extras/indexing
 fix KATTA-153, LuceneServer loads all fields from index, even if only =
fewer are requested
 fix KATTA-157, set timeout on LuceneClient
 fix KATTA-154, HitsMapWritable readFields does not add hits optimally
 fix KATTA-152, modify LuceneServer for easier sub-classing
 fix KATTA-159, LuceneServerTest does not compile
 fix KATTA-150, port parameter for startNode command
 fix KATTA-149, remove unnecessary synchronization from LuceneServer
 fix KATTA-148, fix debug statement which prevent katta from running =
with debug log level
 fix KATTA-147, upgrade to zookeeper 3.3.1


See full list of changes at
=
http://oss.101tec.com/jira/secure/ReleaseNote.jspa?projectId=3D10000&style=
Name=3DHtml&version=3D10061

Binary distribution is available at
https://sourceforge.net/projects/katta/

Special Thanks to Mathias Walter for his contributions!

The Katta Team=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47902-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 05:44:16 2010
Return-Path: <java-user-return-47902-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75592 invoked from network); 25 Nov 2010 05:44:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 05:44:16 -0000
Received: (qmail 43080 invoked by uid 500); 25 Nov 2010 05:44:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42693 invoked by uid 500); 25 Nov 2010 05:44:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42685 invoked by uid 99); 25 Nov 2010 05:44:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 05:44:44 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,MIME_QP_LONG_LINE,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_NEUTRAL,UNPARSEABLE_RELAY
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [121.101.151.226] (HELO nm4.bullet.mail.in.yahoo.com) (121.101.151.226)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 25 Nov 2010 05:44:36 +0000
Received: from [121.101.151.237] by nm4.bullet.mail.in.yahoo.com with NNFMP; 25 Nov 2010 05:44:22 -0000
Received: from [121.101.151.233] by tm2.bullet.mail.in.yahoo.com with NNFMP; 25 Nov 2010 05:44:13 -0000
Received: from [127.0.0.1] by omp1002.mail.in.yahoo.com with NNFMP; 25 Nov 2010 05:44:13 -0000
X-Yahoo-Newman-Id: 102685.87373.bm@omp1002.mail.in.yahoo.com
Received: (qmail 59039 invoked from network); 25 Nov 2010 05:44:14 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.in;
  h=DKIM-Signature:Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE;
  b=zQ0Izkatu10yPNE/ouI3u0cluwc6aQc4PlJyg1i8ufaoiz9nStb3JYq8eQ2fdbPkyI1DXGQ6kFh2PUY2JnV6TlXRk59sppxvtjln1SgiUGBDgc0viEhmL+H8Rnmzb2vRIyARnP408u+YxHUHKIEo9U+ba9o0v1S598QtdtcVwF0=  ;
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.co.in; s=s1024; t=1290663853; bh=z664T5c0o1ScL5S17n34ZuHtnjEvEmEUVt/ywEQW/oQ=; h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE; b=IsrKF3EcBkNL4ufLtex9pMlOr0YnKyleuhBRLhRnSwzJl0N3wpykP/vecAjtdTVe7/tzc+T3XAN5vh2vPIepvlHjTSSUfuYVRv+78r9KRXq5e68LSw3qeb9W4dOIJn/8KAV4hGn+mw6JxefrbngVUQn+a0M1L1lZC/hk0NV8p5I=
Received: from GaneshM (emailgane@121.244.159.130 with login)
        by smtp108.mail.in.yahoo.com with SMTP; 25 Nov 2010 11:14:13 +0530 IST
X-Yahoo-SMTP: JObyHkuswBBrNSLZp.Ycd7Boqpr_GQ--
X-YMail-OSG: PiqBKXsVM1mNpC9T8l8rCOaYgir82I9TdMtfTScpEyvCZZn
 9n_fjm8Epm8_jkTxTU08Y1JTYk5OqL13Mopt58pkTx7RcRztlaPpjMw2oSIM
 xL9OM1cdznBVtxtLXJ._a5nmLmQvr7BN9RoEVJm22wFr282y.fdqEiAzX2jq
 OfXw4ZtLUWlonoAashONBFZVxRUT2JapvaHJvzt_b_6XiT_4CVcnMrKi_atH
 mcxbUYLXV3R9eNKVH0mYjCbG4Qrd3VRRi_WeF606d5ooZPlMcoA--
X-Yahoo-Newman-Property: ymail-3
Message-ID: <100E98B677A547C3BE16871066C3614D@sv.us.sonicwall.com>
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com><AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com><00e401cb8a60$f390d5c0$dab28140$@thetaphi.de><AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com> <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
Date: Thu, 25 Nov 2010 11:14:13 +0530
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5931
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5931
X-Virus-Checked: Checked by ClamAV on apache.org

Since there was a debate about using multisearcher, what about using =
ParallelMultiSearcher?

I am having indexes with 60 million documents and sometimes it grows to =
100 million. I shard the DB by week. I use ParallelMultiSearcher to =
search across the shards.  All data is in single system. Till now i =
didn't faced any issue. I used Lucene 2.9 and recently upgraded to =
3.0.2.

Do i need to switch to MultiReader?

Regards
Ganesh=20


----- Original Message -----=20
From: "Luca Rondanini" <luca.rondanini@gmail.com>
To: <java-user@lucene.apache.org>
Sent: Monday, November 22, 2010 11:29 PM
Subject: Re: best practice: 1.4 billions documents


> Thank you all, I really got some good hints!
>=20
> of course I will distribute my index over many machines: store =
everything on
> one computer is just crazy, 1.4B docs is going to be an index of =
almost 2T
> (in my case)
>=20
> the best solution for me at the moment (from your suggestions) seems =
to
> identify a criteria to force a request (search/update) to access only =
a
> subset of the index. Multi or Parallel Searchers....I'll decide later.
>=20
> Solr is a really good option and I've already planned of "stealing" =
parts of
> code but I have time and resources to try to build my own platform
> especially since my data need heavy processing.
>=20
> I'll keep you posted
> Luca
>=20
>=20
>=20
>=20
>=20
>=20
> On Mon, Nov 22, 2010 at 8:54 AM, eks dev <eksdev@yahoo.co.uk> wrote:
>=20
>> Am I the only one who thinks this is not the way to go, MultiReader =
(or
>> MulitiSearcher) is not going to fix your problems. Having 1.4B =
Documents on
>> one machine is a big number, does not matter how you partition them =
(or you
>> have some really expensive hardware at your disposal).  Did I miss =
the
>> point
>> somewhere with this recommendation "use MultiReader and you are good =
for
>> 1.4B Document"?
>>
>> Imo, you must distribute your index across many machines.
>>
>> Your best chance is to look at solr cloud and solr replication (solr =
Wiki
>> is
>> your friend). Of course, you can do it yourself, but building =
distributet
>> setup with what you call "real time updates" is a huge pain.
>>
>> Alternatively, google for lucene or solr on cassandra (has some very =
nice
>> properties about update latency and architectural simplicity).I do =
not know
>> if this is somewhere in production.
>>
>> Good luck,
>> e.
>>
>>
>>
>> On Mon, Nov 22, 2010 at 5:18 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>>
>> > There is no reason to use MultiSearcher instead the much more =
consistent
>> > and effective  MultiReader! We (Robert and me) are already planning =
to
>> > deprecate it. MultiSearcher itsself has no benefit over a simple
>> > IndexSearcher on top of a MultiReader since Lucene 2.9, it has only
>> > problems.
>> >
>> > Use cases for real MultiSearchers are only the subclasses for =
"remote
>> > search" or (perhaps) multi-threaded search, but the latter I would =
not
>> > recommend (instead let the additional CPUs in your machine be free =
for
>> other
>> > users doing searches in parallel). Multithreading a single search =
should
>> not
>> > be done, as it slows down multiple users accessing the same index =
at the
>> > same time. Spend the additional CPU power for other things like =
warming
>> > searchers, indexing additional documents, or filling FieldCache in
>> parallel.
>> >
>> > Uwe
>> >
>> > -----
>> > Uwe Schindler
>> > H.-H.-Meier-Allee 63, D-28213 Bremen
>> > http://www.thetaphi.de
>> > eMail: uwe@thetaphi.de
>> >
>> >
>> > > -----Original Message-----
>> > > From: David Fertig [mailto:dfertig@cymfony.com]
>> > > Sent: Monday, November 22, 2010 4:54 PM
>> > > To: java-user@lucene.apache.org
>> > > Subject: RE: best practice: 1.4 billions documents
>> > >
>> > > >> We have a couple billion docs in our archives as =
well...Breaking
>> them
>> > > >> up by day worked well for us
>> > >
>> > > We do not have 2 billion segments in one index  We have roughly =
5-10
>> > million
>> > > documents per index. We are currently using a miltisearcher but
>> > unresolved
>> > > lucene issues in this will force us to move to a multireader.
>> > >
>> > > As far as the parallel searcher goes, read back on the thread =
with
>> > subject
>> > > "Search returning documents matching a NOT range".
>> > > There is an acknowledged/proven bug with a small unit test, but =
there
>> is
>> > some
>> > > disagreement about the internal reasons it fails. I have been =
unable to
>> > > generate further discussion or a resolution. This was supposed to =
be
>> > added as a
>> > > bug to the JIRA for the 3.3 release, but has not been.  I am not =
which
>> > class Solr
>> > > uses, but if it uses MultiSearcher, it will have the same bug.
>> > >
>> > > -----Original Message-----
>> > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
>> > > Sent: Monday, November 22, 2010 1:47 AM
>> > > To: java-user@lucene.apache.org
>> > > Subject: Re: best practice: 1.4 billions documents
>> > >
>> > > Hi David, thanks for your answer. it really helped a lot! so, you =
have
>> an
>> > index
>> > > with more than 2 billions segments. this is pretty much the =
answer I
>> was
>> > > searching for: lucene alone is able to manage such a big index.
>> > >
>> > > which kind of problems do you have with the parallel searchers? =
I'm
>> going
>> > to
>> > > build my index in the next couple of weeks if you want we can =
confront
>> > our
>> > > data
>> > >
>> > > thanks again
>> > > Luca
>> > >
>> > >
>> > > On Sun, Nov 21, 2010 at 6:22 PM, David Fertig =
<dfertig@cymfony.com>
>> > wrote:
>> > >
>> > > > Actually I've been bitten by an still-unresolved issue with the
>> > > > parallel searchers and recommend a MultiReader instead.
>> > > > We have a couple billion docs in our archives as well.  =
Breaking them
>> > > > up by day worked well for us, but you'll need to do something.
>> > > >
>> > > > -----Original Message-----
>> > > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
>> > > > Sent: Sunday, November 21, 2010 8:13 PM
>> > > > To: java-user@lucene.apache.org; yonik@lucidimagination.com
>> > > > Subject: Re: best practice: 1.4 billions documents
>> > > >
>> > > > thank you both!
>> > > >
>> > > > Johannes, katta seems interesting but I will need to solve the
>> > > > problems of "hot" updates to the index
>> > > >
>> > > > Yonik, I see your point - so your suggestion would be to build =
an
>> > > > architecture based on ParallelMultiSearcher?
>> > > >
>> > > >
>> > > > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
>> > > > <yonik@lucidimagination.com
>> > > > >wrote:
>> > > >
>> > > > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
>> > > > > <luca.rondanini@gmail.com> wrote:
>> > > > > > Hi everybody,
>> > > > > >
>> > > > > > I really need some good advice! I need to index in lucene
>> > > > > > something
>> > > > like
>> > > > > 1.4
>> > > > > > billions documents. I had experience in lucene but I've =
never
>> > > > > > worked
>> > > > with
>> > > > > > such a big number of documents. Also this is just the =
number of
>> > > > > > docs at
>> > > > > > "start-up": they are going to grow and fast.
>> > > > > >
>> > > > > > I don't have to tell you that I need the system to be fast =
and to
>> > > > support
>> > > > > > real time updates to the documents
>> > > > > >
>> > > > > > The first solution that came to my mind was to use
>> > > > ParallelMultiSearcher,
>> > > > > > splitting the index into many "sub-index" (how many docs =
per
>> index?
>> > > > > > 100,000?) but I don't have experience with it and I don't =
know
>> how
>> > > > > > well
>> > > > > will
>> > > > > > scale while the number of documents grows!
>> > > > > >
>> > > > > > A more solid solution seems to build some kind of =
integration
>> with
>> > > > > hadoop.
>> > > > > > But I didn't find match about lucene and hadoop =
integration.
>> > > > > >
>> > > > > > Any idea? Which direction should I go (pure lucene or =
hadoop)?
>> > > > >
>> > > > > There seems to be a common misconception about hadoop =
regarding
>> > > search.
>> > > > > Map-reduce as implemented in hadoop is really for batch =
oriented
>> > > > > jobs only (or those types of jobs where you don't need a =
quick
>> > > > > response time).  It's definitely not for normal queries =
(unless you
>> > > > > have unusual requirements).
>> > > > >
>> > > > > -Yonik
>> > > > > http://www.lucidimagination.com
>> > > > >
>> > > > >
>> --------------------------------------------------------------------
>> > > > > - To unsubscribe, e-mail: =
java-user-unsubscribe@lucene.apache.org
>> > > > > For additional commands, e-mail: =
java-user-help@lucene.apache.org
>> > > > >
>> > > > >
>> > > >
>> >
>> >
>> > =
---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>
Send free SMS to your Friends on Mobile from your Yahoo! Messenger. Download Now! http://messenger.yahoo.com/download.php

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47905-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 08:55:39 2010
Return-Path: <java-user-return-47905-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15906 invoked from network); 25 Nov 2010 08:55:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 08:55:39 -0000
Received: (qmail 80989 invoked by uid 500); 25 Nov 2010 08:55:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80742 invoked by uid 500); 25 Nov 2010 08:55:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80734 invoked by uid 99); 25 Nov 2010 08:55:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 08:55:36 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,MIME_QP_LONG_LINE,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_NEUTRAL,UNPARSEABLE_RELAY
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [121.101.151.225] (HELO nm3.bullet.mail.in.yahoo.com) (121.101.151.225)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 25 Nov 2010 08:55:28 +0000
Received: from [121.101.151.236] by nm3.bullet.mail.in.yahoo.com with NNFMP; 25 Nov 2010 08:55:08 -0000
Received: from [121.101.151.235] by tm1.bullet.mail.in.yahoo.com with NNFMP; 25 Nov 2010 08:55:11 -0000
Received: from [127.0.0.1] by omp1004.mail.in.yahoo.com with NNFMP; 25 Nov 2010 08:55:35 -0000
X-Yahoo-Newman-Id: 559083.84094.bm@omp1004.mail.in.yahoo.com
Received: (qmail 87797 invoked from network); 25 Nov 2010 08:55:06 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.in;
  h=DKIM-Signature:Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE;
  b=qivFEj02MG6CfiGt4t50zQT1BMZUSQaZ4cXOH9XgwGDOvgTTfZY29DrS6Os1cBlTvNjU2jweJPNvgFcEFdrF/Ihv8UtPoXmxxXKF9I+7doKQmGDi0x2hLl4FvXUzqj0rvNAqqKHLqpX/IsfUufqYsAFrRxff07Fx4DudlX6k/aI=  ;
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.co.in; s=s1024; t=1290675306; bh=HZDmRU5EEySoJESNahg+6k3gtnYPEFgHv6WydvIGnqk=; h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE; b=Nwwyxobgf4Phn/u9ipM0TxEagmR9PG9DqHXag+bqH1YGmCzUt3Aj6UztyY9/UrfjmEQJUK1Nli6VQ88+cY7iiFbHGCECMWjX//dkxAVnOmyC8nZ2WRfLyjb7YmnEHxOVl5E/Ubg5mi8EJJlZ6lC/yBsjG+7PeXL4mP3OpPZZLko=
Received: from GaneshM (emailgane@121.244.159.130 with login)
        by smtp105.mail.in.yahoo.com with SMTP; 25 Nov 2010 14:25:05 +0530 IST
X-Yahoo-SMTP: JObyHkuswBBrNSLZp.Ycd7Boqpr_GQ--
X-YMail-OSG: qQM3gYAVM1mdWTVuWrboTBkIIZ4VpZnkbtBrOBvH_C7q6yv
 JkxQi9_OHKXGUNiKzZFe_gcC9CcnijblD_vVDZoEm3x9E4xD1uH2XWmvKQOX
 cjOj4JNM1j.gAaODbmEpuCI5GeVyvgGTaIZQkNS1JRG7.6kmWQIVvFICgcK3
 ntD.3Knrlj2EKVnuWnCBqd7E8ftXmy9qrmNoD0..PMS8_OTdoQDAmLpS3G4j
 _Fk05vdzrl4L_6Kk4heUGUmSkV6ZH4Lr2K8najP8PN1P7NQRUrQ--
X-Yahoo-Newman-Property: ymail-3
Message-ID: <565726F0A1EF4793BDFB7BAC5A44CB81@sv.us.sonicwall.com>
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com> <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com> <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com> <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com> <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com> <100E98B677A547C3BE16871066C3614D@sv.us.sonicwall.com> <001301cb8c76$8af2d230$a0d87690$@thetaphi.de> <AANLkTiktmOUv-pEHhRfcSpUsKT_f=8LF=Apd2ujEmeh1@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
Date: Thu, 25 Nov 2010 14:25:05 +0530
MIME-Version: 1.0
Content-Type: text/plain;
	charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5931
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5931
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks for the input.

My results are sorted by date and i am not much bothered about score. =
Will i still be in trouble?

Regards
Ganesh


----- Original Message -----=20
From: "Robert Muir" <rcmuir@gmail.com>
To: <java-user@lucene.apache.org>
Sent: Thursday, November 25, 2010 1:45 PM
Subject: Re: best practice: 1.4 billions documents


On Thu, Nov 25, 2010 at 2:58 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
> ParallelMultiSearcher as subclass of MultiSearcher has the same =
problems. These are not crashes, but more that some queries do not =
return correct scored results for some queries. This effects especially =
all MultiTermQueries (TermRange, Fuzzy, NumericRange, Wildcard, Prefix) =
if they are used in a negative fashion (using MUST_NOT resp. "-" in =
QueryParser). For all of those queries except Fuzzy, you are safe if you =
use CONSTANT_SCORE_REWRITE_METHOD (using setRewriteMethod). The same =
problems apply for span queries. For *all* Fuzzy Queries (negative or =
not), the scores are simply wrong and so scoring is broken with =
(Parallel)MultiSearcher; wrong results are only returned when negative =
clauses!
>

you can use constant score rewrite method with fuzzy, too. then it
will work "correctly" (even negative) with multisearcher too. but it
will be slow, with unbounded number of results, and the fuzziness will
not affect the scoring. (this is what constant score rewrite implies)

the reason i say "correctly" is that for all of these queries,
constant score rewrite is just a general workaround, and might still
be incorrect. This is because many queries often have special cases
where they rewrite to simpler things and in general the MultiSearcher
combine() logic is broken here, so there might be more problems.

> A new class ParallelIndexSearcher could help with that, when it =
parallelizes multiple segments, this is still in planning phase. The =
difference to ParallelMultiSearcher would be that it takes a "single" =
IndexReader (e.g. a MultiReader in your case) and parallelizes per =
segment/segment bunches.
>

Besides the inherited broken-ness from multisearcher,
parallelmultisearcher is broken further because it requires you to
organize your index structure in a special way to get concurrency.

This is all pretty silly though, since ParallelMultiSearcher on a
single machine isn't going to increase QPS, so how useful really is it
in general???

we should deprecate both the broken Multi & ParallelMulti Searchers
and never look back.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org

Send free SMS to your Friends on Mobile from your Yahoo! Messenger. Download Now! http://messenger.yahoo.com/download.php

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47903-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 09:00:36 2010
Return-Path: <java-user-return-47903-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21415 invoked from network); 25 Nov 2010 09:00:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 09:00:36 -0000
Received: (qmail 8403 invoked by uid 500); 25 Nov 2010 07:58:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8151 invoked by uid 500); 25 Nov 2010 07:58:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8140 invoked by uid 99); 25 Nov 2010 07:58:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 07:58:33 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 07:58:26 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id C724BD3600C
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 08:58:05 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id olAhE3ST9067 for <java-user@lucene.apache.org>;
	Thu, 25 Nov 2010 08:58:00 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id A365FD36003
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 08:57:59 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com><AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com><AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com><AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com><E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com><00e401cb8a60$f390d5c0$dab28140$@thetaphi.de><AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com> <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com> <100E98B677A547C3BE16871066C3614D@sv.us.sonicwall.com>
In-Reply-To: <100E98B677A547C3BE16871066C3614D@sv.us.sonicwall.com>
Subject: RE: best practice: 1.4 billions documents
Date: Thu, 25 Nov 2010 08:58:27 +0100
Message-ID: <001301cb8c76$8af2d230$a0d87690$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAkCKnrzXAGCgulzAa4U+0kBL2CExZLB3Ybw
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

ParallelMultiSearcher as subclass of MultiSearcher has the same =
problems. These are not crashes, but more that some queries do not =
return correct scored results for some queries. This effects especially =
all MultiTermQueries (TermRange, Fuzzy, NumericRange, Wildcard, Prefix) =
if they are used in a negative fashion (using MUST_NOT resp. "-" in =
QueryParser). For all of those queries except Fuzzy, you are safe if you =
use CONSTANT_SCORE_REWRITE_METHOD (using setRewriteMethod). The same =
problems apply for span queries. For *all* Fuzzy Queries (negative or =
not), the scores are simply wrong and so scoring is broken with =
(Parallel)MultiSearcher; wrong results are only returned when negative =
clauses!

A new class ParallelIndexSearcher could help with that, when it =
parallelizes multiple segments, this is still in planning phase. The =
difference to ParallelMultiSearcher would be that it takes a "single" =
IndexReader (e.g. a MultiReader in your case) and parallelizes per =
segment/segment bunches.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ganesh [mailto:emailgane@yahoo.co.in]
> Sent: Thursday, November 25, 2010 6:44 AM
> To: java-user@lucene.apache.org
> Subject: Re: best practice: 1.4 billions documents
>=20
> Since there was a debate about using multisearcher, what about using
> ParallelMultiSearcher?
>=20
> I am having indexes with 60 million documents and sometimes it grows =
to 100
> million. I shard the DB by week. I use ParallelMultiSearcher to search =
across
> the shards.  All data is in single system. Till now i didn't faced any =
issue. I used
> Lucene 2.9 and recently upgraded to 3.0.2.
>=20
> Do i need to switch to MultiReader?
>=20
> Regards
> Ganesh
>=20
>=20
> ----- Original Message -----
> From: "Luca Rondanini" <luca.rondanini@gmail.com>
> To: <java-user@lucene.apache.org>
> Sent: Monday, November 22, 2010 11:29 PM
> Subject: Re: best practice: 1.4 billions documents
>=20
>=20
> > Thank you all, I really got some good hints!
> >
> > of course I will distribute my index over many machines: store =
everything on
> > one computer is just crazy, 1.4B docs is going to be an index of =
almost 2T
> > (in my case)
> >
> > the best solution for me at the moment (from your suggestions) seems =
to
> > identify a criteria to force a request (search/update) to access =
only a
> > subset of the index. Multi or Parallel Searchers....I'll decide =
later.
> >
> > Solr is a really good option and I've already planned of "stealing" =
parts of
> > code but I have time and resources to try to build my own platform
> > especially since my data need heavy processing.
> >
> > I'll keep you posted
> > Luca
> >
> >
> >
> >
> >
> >
> > On Mon, Nov 22, 2010 at 8:54 AM, eks dev <eksdev@yahoo.co.uk> wrote:
> >
> >> Am I the only one who thinks this is not the way to go, MultiReader =
(or
> >> MulitiSearcher) is not going to fix your problems. Having 1.4B =
Documents on
> >> one machine is a big number, does not matter how you partition them =
(or
> you
> >> have some really expensive hardware at your disposal).  Did I miss =
the
> >> point
> >> somewhere with this recommendation "use MultiReader and you are =
good
> for
> >> 1.4B Document"?
> >>
> >> Imo, you must distribute your index across many machines.
> >>
> >> Your best chance is to look at solr cloud and solr replication =
(solr Wiki
> >> is
> >> your friend). Of course, you can do it yourself, but building =
distributet
> >> setup with what you call "real time updates" is a huge pain.
> >>
> >> Alternatively, google for lucene or solr on cassandra (has some =
very nice
> >> properties about update latency and architectural simplicity).I do =
not know
> >> if this is somewhere in production.
> >>
> >> Good luck,
> >> e.
> >>
> >>
> >>
> >> On Mon, Nov 22, 2010 at 5:18 PM, Uwe Schindler <uwe@thetaphi.de>
> wrote:
> >>
> >> > There is no reason to use MultiSearcher instead the much more =
consistent
> >> > and effective  MultiReader! We (Robert and me) are already =
planning to
> >> > deprecate it. MultiSearcher itsself has no benefit over a simple
> >> > IndexSearcher on top of a MultiReader since Lucene 2.9, it has =
only
> >> > problems.
> >> >
> >> > Use cases for real MultiSearchers are only the subclasses for =
"remote
> >> > search" or (perhaps) multi-threaded search, but the latter I =
would not
> >> > recommend (instead let the additional CPUs in your machine be =
free for
> >> other
> >> > users doing searches in parallel). Multithreading a single search =
should
> >> not
> >> > be done, as it slows down multiple users accessing the same index =
at the
> >> > same time. Spend the additional CPU power for other things like =
warming
> >> > searchers, indexing additional documents, or filling FieldCache =
in
> >> parallel.
> >> >
> >> > Uwe
> >> >
> >> > -----
> >> > Uwe Schindler
> >> > H.-H.-Meier-Allee 63, D-28213 Bremen
> >> > http://www.thetaphi.de
> >> > eMail: uwe@thetaphi.de
> >> >
> >> >
> >> > > -----Original Message-----
> >> > > From: David Fertig [mailto:dfertig@cymfony.com]
> >> > > Sent: Monday, November 22, 2010 4:54 PM
> >> > > To: java-user@lucene.apache.org
> >> > > Subject: RE: best practice: 1.4 billions documents
> >> > >
> >> > > >> We have a couple billion docs in our archives as =
well...Breaking
> >> them
> >> > > >> up by day worked well for us
> >> > >
> >> > > We do not have 2 billion segments in one index  We have roughly =
5-10
> >> > million
> >> > > documents per index. We are currently using a miltisearcher but
> >> > unresolved
> >> > > lucene issues in this will force us to move to a multireader.
> >> > >
> >> > > As far as the parallel searcher goes, read back on the thread =
with
> >> > subject
> >> > > "Search returning documents matching a NOT range".
> >> > > There is an acknowledged/proven bug with a small unit test, but =
there
> >> is
> >> > some
> >> > > disagreement about the internal reasons it fails. I have been =
unable to
> >> > > generate further discussion or a resolution. This was supposed =
to be
> >> > added as a
> >> > > bug to the JIRA for the 3.3 release, but has not been.  I am =
not which
> >> > class Solr
> >> > > uses, but if it uses MultiSearcher, it will have the same bug.
> >> > >
> >> > > -----Original Message-----
> >> > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> >> > > Sent: Monday, November 22, 2010 1:47 AM
> >> > > To: java-user@lucene.apache.org
> >> > > Subject: Re: best practice: 1.4 billions documents
> >> > >
> >> > > Hi David, thanks for your answer. it really helped a lot! so, =
you have
> >> an
> >> > index
> >> > > with more than 2 billions segments. this is pretty much the =
answer I
> >> was
> >> > > searching for: lucene alone is able to manage such a big index.
> >> > >
> >> > > which kind of problems do you have with the parallel searchers? =
I'm
> >> going
> >> > to
> >> > > build my index in the next couple of weeks if you want we can =
confront
> >> > our
> >> > > data
> >> > >
> >> > > thanks again
> >> > > Luca
> >> > >
> >> > >
> >> > > On Sun, Nov 21, 2010 at 6:22 PM, David Fertig =
<dfertig@cymfony.com>
> >> > wrote:
> >> > >
> >> > > > Actually I've been bitten by an still-unresolved issue with =
the
> >> > > > parallel searchers and recommend a MultiReader instead.
> >> > > > We have a couple billion docs in our archives as well.  =
Breaking them
> >> > > > up by day worked well for us, but you'll need to do =
something.
> >> > > >
> >> > > > -----Original Message-----
> >> > > > From: Luca Rondanini [mailto:luca.rondanini@gmail.com]
> >> > > > Sent: Sunday, November 21, 2010 8:13 PM
> >> > > > To: java-user@lucene.apache.org; yonik@lucidimagination.com
> >> > > > Subject: Re: best practice: 1.4 billions documents
> >> > > >
> >> > > > thank you both!
> >> > > >
> >> > > > Johannes, katta seems interesting but I will need to solve =
the
> >> > > > problems of "hot" updates to the index
> >> > > >
> >> > > > Yonik, I see your point - so your suggestion would be to =
build an
> >> > > > architecture based on ParallelMultiSearcher?
> >> > > >
> >> > > >
> >> > > > On Sun, Nov 21, 2010 at 3:48 PM, Yonik Seeley
> >> > > > <yonik@lucidimagination.com
> >> > > > >wrote:
> >> > > >
> >> > > > > On Sun, Nov 21, 2010 at 6:33 PM, Luca Rondanini
> >> > > > > <luca.rondanini@gmail.com> wrote:
> >> > > > > > Hi everybody,
> >> > > > > >
> >> > > > > > I really need some good advice! I need to index in lucene
> >> > > > > > something
> >> > > > like
> >> > > > > 1.4
> >> > > > > > billions documents. I had experience in lucene but I've =
never
> >> > > > > > worked
> >> > > > with
> >> > > > > > such a big number of documents. Also this is just the =
number of
> >> > > > > > docs at
> >> > > > > > "start-up": they are going to grow and fast.
> >> > > > > >
> >> > > > > > I don't have to tell you that I need the system to be =
fast and to
> >> > > > support
> >> > > > > > real time updates to the documents
> >> > > > > >
> >> > > > > > The first solution that came to my mind was to use
> >> > > > ParallelMultiSearcher,
> >> > > > > > splitting the index into many "sub-index" (how many docs =
per
> >> index?
> >> > > > > > 100,000?) but I don't have experience with it and I don't =
know
> >> how
> >> > > > > > well
> >> > > > > will
> >> > > > > > scale while the number of documents grows!
> >> > > > > >
> >> > > > > > A more solid solution seems to build some kind of =
integration
> >> with
> >> > > > > hadoop.
> >> > > > > > But I didn't find match about lucene and hadoop =
integration.
> >> > > > > >
> >> > > > > > Any idea? Which direction should I go (pure lucene or =
hadoop)?
> >> > > > >
> >> > > > > There seems to be a common misconception about hadoop
> regarding
> >> > > search.
> >> > > > > Map-reduce as implemented in hadoop is really for batch =
oriented
> >> > > > > jobs only (or those types of jobs where you don't need a =
quick
> >> > > > > response time).  It's definitely not for normal queries =
(unless you
> >> > > > > have unusual requirements).
> >> > > > >
> >> > > > > -Yonik
> >> > > > > http://www.lucidimagination.com
> >> > > > >
> >> > > > >
> >> =
--------------------------------------------------------------------
> >> > > > > - To unsubscribe, e-mail: =
java-user-unsubscribe@lucene.apache.org
> >> > > > > For additional commands, e-mail: =
java-user-help@lucene.apache.org
> >> > > > >
> >> > > > >
> >> > > >
> >> >
> >> >
> >> > =
---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >
> >> >
> >>
> >
> Send free SMS to your Friends on Mobile from your Yahoo! Messenger.
> Download Now! http://messenger.yahoo.com/download.php
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47904-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 09:18:48 2010
Return-Path: <java-user-return-47904-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42331 invoked from network); 25 Nov 2010 09:18:48 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 09:18:48 -0000
Received: (qmail 25987 invoked by uid 500); 25 Nov 2010 08:16:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25734 invoked by uid 500); 25 Nov 2010 08:16:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25720 invoked by uid 99); 25 Nov 2010 08:16:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 08:16:44 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 08:16:39 +0000
Received: by bwz9 with SMTP id 9so697870bwz.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 00:16:17 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=AtqBxcFUErsDjALsYSKFEI4lP/TVdkXOrqPJu8DfqEw=;
        b=CoOdL0KpCCuEWkO31mOUxvIFVxu3R7cAd3urDEhrIeDZ+go48ojmgs1WjKPZJgoy0w
         YhKjKX6FnGBU+DykwSVf0e0pV2wyF+qs/bjXpSaWO5lI+Uljq6xBPNU35D+MvDhVu3Go
         xnK6erZSEgaj7XhQeIqKBVWUdAZKY0qPM9+Ro=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=dHeAhhJ7lZBOFBeo3deSbdYn/0yjkGC2JeyUeGKXhjTfJ5bbCb221xqaBF1RpnxVC8
         2edIfaR4kKyMYAM50dPytGCGbHWH9SdKuWSehQXEh6TpUOp9GdtRR728ZixL7YyOGWmW
         D4pkYWSiiUeTmxAxM4/1uuA0s6twzi4hJ/ni0=
Received: by 10.204.120.130 with SMTP id d2mr344474bkr.214.1290672977857; Thu,
 25 Nov 2010 00:16:17 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Thu, 25 Nov 2010 00:15:57 -0800 (PST)
In-Reply-To: <001301cb8c76$8af2d230$a0d87690$@thetaphi.de>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
 <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
 <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
 <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
 <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
 <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com>
 <100E98B677A547C3BE16871066C3614D@sv.us.sonicwall.com> <001301cb8c76$8af2d230$a0d87690$@thetaphi.de>
From: Robert Muir <rcmuir@gmail.com>
Date: Thu, 25 Nov 2010 03:15:57 -0500
Message-ID: <AANLkTiktmOUv-pEHhRfcSpUsKT_f=8LF=Apd2ujEmeh1@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

On Thu, Nov 25, 2010 at 2:58 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
> ParallelMultiSearcher as subclass of MultiSearcher has the same problems.=
 These are not crashes, but more that some queries do not return correct sc=
ored results for some queries. This effects especially all MultiTermQueries=
 (TermRange, Fuzzy, NumericRange, Wildcard, Prefix) if they are used in a n=
egative fashion (using MUST_NOT resp. "-" in QueryParser). For all of those=
 queries except Fuzzy, you are safe if you use CONSTANT_SCORE_REWRITE_METHO=
D (using setRewriteMethod). The same problems apply for span queries. For *=
all* Fuzzy Queries (negative or not), the scores are simply wrong and so sc=
oring is broken with (Parallel)MultiSearcher; wrong results are only return=
ed when negative clauses!
>

you can use constant score rewrite method with fuzzy, too. then it
will work "correctly" (even negative) with multisearcher too. but it
will be slow, with unbounded number of results, and the fuzziness will
not affect the scoring. (this is what constant score rewrite implies)

the reason i say "correctly" is that for all of these queries,
constant score rewrite is just a general workaround, and might still
be incorrect. This is because many queries often have special cases
where they rewrite to simpler things and in general the MultiSearcher
combine() logic is broken here, so there might be more problems.

> A new class ParallelIndexSearcher could help with that, when it paralleli=
zes multiple segments, this is still in planning phase. The difference to P=
arallelMultiSearcher would be that it takes a "single" IndexReader (e.g. a =
MultiReader in your case) and parallelizes per segment/segment bunches.
>

Besides the inherited broken-ness from multisearcher,
parallelmultisearcher is broken further because it requires you to
organize your index structure in a special way to get concurrency.

This is all pretty silly though, since ParallelMultiSearcher on a
single machine isn't going to increase QPS, so how useful really is it
in general???

we should deprecate both the broken Multi & ParallelMulti Searchers
and never look back.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47906-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 09:24:55 2010
Return-Path: <java-user-return-47906-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44645 invoked from network); 25 Nov 2010 09:24:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 09:24:55 -0000
Received: (qmail 28427 invoked by uid 500); 25 Nov 2010 09:24:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28109 invoked by uid 500); 25 Nov 2010 09:24:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28096 invoked by uid 99); 25 Nov 2010 09:24:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 09:24:52 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 09:24:45 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id A9BB3D3600C
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 10:24:23 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 9dSuF7RD82Zy for <java-user@lucene.apache.org>;
	Thu, 25 Nov 2010 10:24:18 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 16F10D36003
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 10:24:18 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com> <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com> <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com> <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com> <AANLkTi=Zkv3Q5Jmc38gqjuN6woPAUur9w+w93WSkC20T@mail.gmail.com> <100E98B677A547C3BE16871066C3614D@sv.us.sonicwall.com> <001301cb8c76$8af2d230$a0d87690$@thetaphi.de> <AANLkTiktmOUv-pEHhRfcSpUsKT_f=8LF=Apd2ujEmeh1@mail.gmail.com> <565726F0A1EF4793BDFB7BAC5A44CB81@sv.us.sonicwall.com>
In-Reply-To: <565726F0A1EF4793BDFB7BAC5A44CB81@sv.us.sonicwall.com>
Subject: RE: best practice: 1.4 billions documents
Date: Thu, 25 Nov 2010 10:24:45 +0100
Message-ID: <002201cb8c82$99730440$cc590cc0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAkCKnrzXAGCgulzAa4U+0kBL2CExQGwqcanAnwkVq8Bq/fP9pKTMYZA
Content-Language: de

You are in trouble if you use MultiTermQuery subclasses as negative =
clause in a BooleanQuery, e.g a range like "-[A TO B]" or even =
NumericRanges or Wildcards. The query will then incorrect results.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Ganesh [mailto:emailgane@yahoo.co.in]
> Sent: Thursday, November 25, 2010 9:55 AM
> To: java-user@lucene.apache.org
> Subject: Re: best practice: 1.4 billions documents
>=20
> Thanks for the input.
>=20
> My results are sorted by date and i am not much bothered about score. =
Will i
> still be in trouble?
>=20
> Regards
> Ganesh
>=20
>=20
> ----- Original Message -----
> From: "Robert Muir" <rcmuir@gmail.com>
> To: <java-user@lucene.apache.org>
> Sent: Thursday, November 25, 2010 1:45 PM
> Subject: Re: best practice: 1.4 billions documents
>=20
>=20
> On Thu, Nov 25, 2010 at 2:58 AM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
> > ParallelMultiSearcher as subclass of MultiSearcher has the same =
problems.
> These are not crashes, but more that some queries do not return =
correct scored
> results for some queries. This effects especially all MultiTermQueries
> (TermRange, Fuzzy, NumericRange, Wildcard, Prefix) if they are used in =
a
> negative fashion (using MUST_NOT resp. "-" in QueryParser). For all of =
those
> queries except Fuzzy, you are safe if you use
> CONSTANT_SCORE_REWRITE_METHOD (using setRewriteMethod). The same
> problems apply for span queries. For *all* Fuzzy Queries (negative or =
not), the
> scores are simply wrong and so scoring is broken with =
(Parallel)MultiSearcher;
> wrong results are only returned when negative clauses!
> >
>=20
> you can use constant score rewrite method with fuzzy, too. then it
> will work "correctly" (even negative) with multisearcher too. but it
> will be slow, with unbounded number of results, and the fuzziness will
> not affect the scoring. (this is what constant score rewrite implies)
>=20
> the reason i say "correctly" is that for all of these queries,
> constant score rewrite is just a general workaround, and might still
> be incorrect. This is because many queries often have special cases
> where they rewrite to simpler things and in general the MultiSearcher
> combine() logic is broken here, so there might be more problems.
>=20
> > A new class ParallelIndexSearcher could help with that, when it =
parallelizes
> multiple segments, this is still in planning phase. The difference to
> ParallelMultiSearcher would be that it takes a "single" IndexReader =
(e.g. a
> MultiReader in your case) and parallelizes per segment/segment =
bunches.
> >
>=20
> Besides the inherited broken-ness from multisearcher,
> parallelmultisearcher is broken further because it requires you to
> organize your index structure in a special way to get concurrency.
>=20
> This is all pretty silly though, since ParallelMultiSearcher on a
> single machine isn't going to increase QPS, so how useful really is it
> in general???
>=20
> we should deprecate both the broken Multi & ParallelMulti Searchers
> and never look back.
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
> Send free SMS to your Friends on Mobile from your Yahoo! Messenger.
> Download Now! http://messenger.yahoo.com/download.php
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47907-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 09:41:15 2010
Return-Path: <java-user-return-47907-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53923 invoked from network); 25 Nov 2010 09:41:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 09:41:15 -0000
Received: (qmail 59500 invoked by uid 500); 25 Nov 2010 09:41:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59134 invoked by uid 500); 25 Nov 2010 09:41:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59126 invoked by uid 99); 25 Nov 2010 09:41:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 09:41:12 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 09:41:06 +0000
Received: by qwe5 with SMTP id 5so794011qwe.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 01:40:45 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=+UrANW80YKK3B+XJSzMtZHCEn+cYlmSCEdVlHyRIBK0=;
        b=uBChNSbeQUbv8LFo8n2SArWBFdKGFJsO4YrsPsulU7gwngrOPMmONvRJVWpm4WNPl0
         WkYhK6bTp3HC6h0wTKmwzmamrASNbIje4ACyUjgjLshZNDGh/vudrVLXSsIczdMeZ+g3
         KgnY1LiIX3UJMonSL+scyTNCohkcASO/C4xNQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        b=tgVe5Re32+FPcDB0I0C7ZNF8bttIIAlH6/NQsgnpikEJKF4Ia2ZjJxUMR5MSe5LwLo
         0J+yRwrTW/vdsncMfOHDwX9yOKwKiJKoYzSl7PPofuruCduOCwk3WUBN1T0ED6vnJ1XE
         3wvYQa8xkHvBEd7arI5SBclkrk6jpaZGtJzok=
MIME-Version: 1.0
Received: by 10.229.245.206 with SMTP id lv14mr529032qcb.52.1290678045469;
 Thu, 25 Nov 2010 01:40:45 -0800 (PST)
Received: by 10.229.100.139 with HTTP; Thu, 25 Nov 2010 01:40:45 -0800 (PST)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <56F65098677DF5489254BE51675614E406425C@008-AM1MPN1-006.mgdnok.nokia.com>
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
	<56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTimuJFZvAydUAKUSJo_zbzBiAhAFBK=v2Kq+3o0j@mail.gmail.com>
	<56F65098677DF5489254BE51675614E406425C@008-AM1MPN1-006.mgdnok.nokia.com>
Date: Thu, 25 Nov 2010 10:40:45 +0100
Message-ID: <AANLkTim6O8ZWuKLCejNc_axnAdBd9uGLNSMFRDoad6NJ@mail.gmail.com>
Subject: Re: custom attributs in tokens
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Jan,

On Wed, Nov 24, 2010 at 9:12 AM,  <jan.kurella@nokia.com> wrote:
> Of course:
>
> We are trying to search in documents that contain text in several languag=
es. We are also investigating other approaches*, so this is not about findi=
ng other variants.
> the goal is to only match tokens from 1 or more given languages and not t=
o match the token if it is by accident the same in another language.
>
> For the payloads my plan is to add the correct language to each and every=
 token during indexing (I'm not sure how to solve this best, but I'm sure t=
his can be solved at least with lucene directly).
> On search side my current idea is to wrap around a TermPosition and skip =
all docs, where the current payload has not one of the requested languages.
> I probably need to use my own Query/Weight for this?

You don't need to start from nothing here, I suggest you to look at
SpanTermQuery and TermSpans which uses DocsAndPositionsEnum (or rather
TermPositions in non-trunk versions). TermSpan gives you the ability
to override #next() and #skipTo() which is from what I understand what
you are looking for, right?

> Another approach would be to just overwrite the Similarity, but this will=
 only influence scoring and depending on the underlying query not completel=
y skip the token - I have to test the difference for the final score betwee=
n this approaches.

Well as you figured correctly this is rather for scoring really.
>
> This one blog made me curious if there is already something similar, that=
 skips TermPositions based on given attributes? I could imagine something s=
imilar to the current Tokenattribute concept during index time, but also av=
ailable during search and controlled by a similarity...

Actually in lucene 4.0 each Flex-Enum has a AttributeSource that
allows you to add custom attributes to you enumerations. Yet there is
no logic that skips based on that though.

Simon
>
> Jan
>
> -----Original Message-----
> From: ext Simon Willnauer [mailto:simon.willnauer@googlemail.com]
> Sent: Dienstag, 23. November 2010 17:50
> To: java-user@lucene.apache.org
> Subject: Re: custom attributs in tokens
>
> On Tue, Nov 23, 2010 at 4:50 PM, =C2=A0<jan.kurella@nokia.com> wrote:
>> Yes, payloads I will use. But they perform at score time and not at sear=
ch time. I just wanted to know if there is anything like that.
>>
> So what is the difference? Maybe you can elaborate a little what are
> you trying to do?
>
> simon
>> "not even on trunk" does this mean there is a discussion about this ongo=
ing somewhere? I'm just curious.
>>
>> Jan
>>
>> -----Original Message-----
>> From: ext Simon Willnauer [mailto:simon.willnauer@googlemail.com]
>> Sent: Dienstag, 23. November 2010 16:44
>> To: java-user@lucene.apache.org
>> Subject: Re: custom attributs in tokens
>>
>> Attribute Serialization is not implemented yet, not even in trunk. You
>> can use payloads instead.
>>
>> Simon
>>
>> On Tue, Nov 23, 2010 at 2:43 PM, =C2=A0<jan.kurella@nokia.com> wrote:
>>> Hi,
>>>
>>> I found a blog post from 2008 where it says, there will be additional c=
ustom attributes for tokens in the future, that will be searchable.
>>> What is the status of these?
>>>
>>> Jan
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47908-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 11:48:53 2010
Return-Path: <java-user-return-47908-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3498 invoked from network); 25 Nov 2010 11:48:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 11:48:53 -0000
Received: (qmail 25521 invoked by uid 500); 25 Nov 2010 11:48:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25229 invoked by uid 500); 25 Nov 2010 11:48:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25217 invoked by uid 99); 25 Nov 2010 11:48:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 11:48:50 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [193.205.191.1] (HELO gauss.crmpa.unisa.it) (193.205.191.1)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 25 Nov 2010 11:48:42 +0000
Received: from nelson (unknown [193.205.191.127])
	by gauss.crmpa.unisa.it (Postfix) with ESMTP id 4801D140D2
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 12:46:49 +0100 (CET)
From: "Claudia Grieco" <grieco@crmpa.unisa.it>
To: <java-user@lucene.apache.org>
Subject: Retrieve found keywords from document
Date: Thu, 25 Nov 2010 12:48:18 +0100
Message-ID: <000a01cb8c96$a6ed6570$f4c83050$@unisa.it>
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_000B_01CB8C9F.08B1CD70"
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcuMlqbHXQnbKGxUTZ28FgTDaeq6Ig==
Content-Language: it

------=_NextPart_000_000B_01CB8C9F.08B1CD70
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

Hi guys,

I have this problem:

I'm using Lucene to create a search engine on people profiles.

I have a set of hobbies (let's say {"reading" , "singing"} for example)  and
I want to find people who have at least one of these hobbies AND which of
these hobbies they have.

Currently I search for each one of these hobbies (ex, one search for
reading, one search for singing) but since the list of hobbies is very long
(200+) I'd like to do the following:

 

1)Do ONE search that finds all the documents who have at least an hobby in
the text ( this is easily accomplished using BooleanQuery) 

2)For each document, retrieve the keywords found.

 

Do you have any ideas on how to do n# 2?

Thank you 

Claudia


------=_NextPart_000_000B_01CB8C9F.08B1CD70--


From java-user-return-47909-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 12:01:29 2010
Return-Path: <java-user-return-47909-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6675 invoked from network); 25 Nov 2010 12:01:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 12:01:28 -0000
Received: (qmail 44313 invoked by uid 500); 25 Nov 2010 12:01:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44139 invoked by uid 500); 25 Nov 2010 12:01:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44124 invoked by uid 99); 25 Nov 2010 12:01:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 12:01:23 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 12:01:18 +0000
Received: by bwz9 with SMTP id 9so878672bwz.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 04:00:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=9IAQnMqTcTFrMX3y/beQErQNM26nvxE4Owbv26dE/CE=;
        b=qb5iC7DFnGbH3vUUdOO2QZNcX69/8QJkeQ//Sits8ujNBrHvyCmN6LO1z/5QHodaGw
         MhHP88q0XdQZsjVWjs9NQuI5G0RWZIQ+erwMUn3oUtiT5KJiBTIHxZfKVZ4tdK/8qXfU
         G4RPGS1Wo6YhY4PNz3YJzTTCka93Q7ACmoeG4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=efN0zFo0Sd/jGjNKw5LOUgoyPRBSiiayXdIib5D+TxtIl/7az84Qpzdhj8TfiyDQ09
         GCTlFuP/bgHkIYVmruXlbu97byYXwV3xiOdhHasB8IUBKRjtuyA6enys2jNX9j3k5bgi
         2T0FbXExddILSFfj0/ZllydcRTdJQP51EKCVk=
Received: by 10.204.68.142 with SMTP id v14mr567810bki.106.1290686456000; Thu,
 25 Nov 2010 04:00:56 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Thu, 25 Nov 2010 04:00:34 -0800 (PST)
In-Reply-To: <000a01cb8c96$a6ed6570$f4c83050$@unisa.it>
References: <000a01cb8c96$a6ed6570$f4c83050$@unisa.it>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 25 Nov 2010 12:00:34 +0000
Message-ID: <AANLkTi=eo8CZkYFB0sG4efJCnzp+XSjW0ioJ2CHDpdWD@mail.gmail.com>
Subject: Re: Retrieve found keywords from document
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Can't you just store the hobbies as standard stored fields
(Field.Store.YES), or as a single field, call doc.get("hobbies") and
do what you want with them?

This sounds rather like faceting - if so you might want to consider
using Solr.  http://wiki.apache.org/solr/SolrFacetingOverview


--
Ian.

On Thu, Nov 25, 2010 at 11:48 AM, Claudia Grieco <grieco@crmpa.unisa.it> wr=
ote:
> Hi guys,
>
> I have this problem:
>
> I'm using Lucene to create a search engine on people profiles.
>
> I have a set of hobbies (let's say {"reading" , "singing"} for example) =
=A0and
> I want to find people who have at least one of these hobbies AND which of
> these hobbies they have.
>
> Currently I search for each one of these hobbies (ex, one search for
> reading, one search for singing) but since the list of hobbies is very lo=
ng
> (200+) I'd like to do the following:
>
>
>
> 1)Do ONE search that finds all the documents who have at least an hobby i=
n
> the text ( this is easily accomplished using BooleanQuery)
>
> 2)For each document, retrieve the keywords found.
>
>
>
> Do you have any ideas on how to do n# 2?
>
> Thank you
>
> Claudia
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47910-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 12:37:54 2010
Return-Path: <java-user-return-47910-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37150 invoked from network); 25 Nov 2010 12:37:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 12:37:54 -0000
Received: (qmail 90078 invoked by uid 500); 25 Nov 2010 12:37:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89818 invoked by uid 500); 25 Nov 2010 12:37:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89810 invoked by uid 99); 25 Nov 2010 12:37:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 12:37:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [194.116.199.142] (HELO thb-mta-03.emailfiltering.com) (194.116.199.142)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 12:37:43 +0000
Received: from arklet.gcal.ac.uk ([193.62.224.72])
	by thb-mta-03.emailfiltering.com with emfmta (version 4.6.0.72) by TLS id 8106994016
	for java-user@lucene.apache.org;68620fff6f4687b5; Thu, 25 Nov 2010 12:37:23 +0000
Received: from ITSEMBXCLUS.enterprise.gcal.ac.uk
 ([fe80:0000:0000:0000:19cc:b8e3:177.173.188.238]) by
 ITSEHUB2.enterprise.gcal.ac.uk ([193.62.224.72]) with mapi; Thu, 25 Nov 2010
 12:37:21 +0000
From: "McGibbney, Lewis John" <Lewis.McGibbney@gcu.ac.uk>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Thu, 25 Nov 2010 12:37:21 +0000
Subject: IndexWriter Class
Thread-Topic: IndexWriter Class
Thread-Index: AQHLjJ2ANDsySEJnOUSUq8rxw5fEdA==
Message-ID: <90362ECB07906C40A0297F9D5211A24323C3CBEA71@ITSEMBXCLUS.enterprise.gcal.ac.uk>
Accept-Language: en-US
Content-Language: en-GB
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

Hello List,

Lucene 3.0.1
Windows Vista Premium Home Edition

I am currently attempting to configure my IndexFiles.java file. My intentio=
n is to add the following functionality to the code as I require input text=
 to be further analyzed than what the default analyzer does.


IndexWriter writer =3D new IndexWriter(FSDirectory.open(INDEX_DIR),

new NGramTokenFilter(

new LowerCaseFilter(

new StandardFilter(

new StandardTokenizer

(Version.LUCENE_CURRENT, null)))), true,

IndexWriter.MaxFieldLength.LIMITED);

System.out.println("Indexing to directory '" +INDEX_DIR+ "'...");

indexDocs(writer, docDir);

System.out.println("Optimizing...");

writer.optimize();

writer.close();

Date end =3D new Date();

System.out.println(end.getTime() - start.getTime() + " total milliseconds")=
;



My problem lies in the IndexWriter class and the number of analyzer's/token=
izer's I am permitted to pass as parameters and I find that this is slightl=
y unclear from the javadocs. Are there any existing resources to solve this=
 problem? or can someone help me out please.



Anything would be greatly appreciated.



Lews Mc

Glasgow Caledonian University is a registered Scottish charity, number SC02=
1474

Winner: Times Higher Education's Widening Participation Initiative of the Y=
ear 2009 and Herald Society's Education Initiative of the Year 2009
http://www.gcu.ac.uk/newsevents/news/bycategory/theuniversity/1/name,6219,e=
n.html

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47911-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 13:08:53 2010
Return-Path: <java-user-return-47911-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53543 invoked from network); 25 Nov 2010 13:08:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 13:08:53 -0000
Received: (qmail 34361 invoked by uid 500); 25 Nov 2010 13:08:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34227 invoked by uid 500); 25 Nov 2010 13:08:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34216 invoked by uid 99); 25 Nov 2010 13:08:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:08:48 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bernd.fehling@uni-bielefeld.de designates 129.70.204.73 as permitted sender)
Received: from [129.70.204.73] (HELO mux2-unibi-smtp.hrz.uni-bielefeld.de) (129.70.204.73)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:08:39 +0000
MIME-version: 1.0
Content-transfer-encoding: 7BIT
Content-type: text/plain; charset=ISO-8859-15
Received: from pmxchannel-daemon.mux2-unibi-smtp.hrz.uni-bielefeld.de by
 mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 id <0LCF00I00Z5V9T00@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Thu, 25 Nov 2010 14:08:19 +0100 (CET)
Received: from [129.70.11.68] ([129.70.11.68])
 by mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 with ESMTPPSA id <0LCF008ZIZ5UGVB0@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Thu, 25 Nov 2010 14:08:18 +0100 (CET)
Date: Thu, 25 Nov 2010 14:08:18 +0100
From: Bernd Fehling <bernd.fehling@uni-bielefeld.de>
Subject: not indexing analyzed field
To: java-user@lucene.apache.org
Message-id: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
X-EnvFrom: bernd.fehling@uni-bielefeld.de
X-PMX-Version: 5.5.9.395186, Antispam-Engine: 2.7.2.376379,
 Antispam-Data: 2010.11.25.125717, pmx8
X-Connecting-IP: 129.70.11.68
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.1.15) Gecko/20101026
 SUSE/3.0.10 Thunderbird/3.0.10
X-Virus-Checked: Checked by ClamAV on apache.org

I used KeywordAnalyzer and KeywordTokenizer as templates for
a new analyzer.
The analyzer works fine but the result never reaches the index.

My analyzer is called in "DocInverterPerField.processFields"
with "stream.incrementToken()".
...
try {
    boolean hasMoreTokens = stream.incrementToken();

    fieldState.attributeSource = stream;

    OffsetAttribute offsetAttribute = fieldState.attributeSource.addAttribute(OffsetAttribute.class);
    PositionIncrementAttribute posIncrAttribute = fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);

    consumer.start(field);
...

The result goes to "fieldState.attributeSource" but is not in "field".
So "field.fieldsData" still has the old content before calling my
analyzer. And when calling "consumer.start(field)" the old content
is going to the index and not the new analyzed one.
Does the analyzer has to care about "Fieldable field.fieldsData"
or who is responsible for it?

Regards
Bernd

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47912-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 13:27:37 2010
Return-Path: <java-user-return-47912-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62767 invoked from network); 25 Nov 2010 13:27:36 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 13:27:36 -0000
Received: (qmail 81496 invoked by uid 500); 25 Nov 2010 13:27:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81188 invoked by uid 500); 25 Nov 2010 13:27:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81174 invoked by uid 99); 25 Nov 2010 13:27:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:27:33 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [193.205.191.1] (HELO gauss.crmpa.unisa.it) (193.205.191.1)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 25 Nov 2010 13:27:26 +0000
Received: from nelson (unknown [193.205.191.127])
	by gauss.crmpa.unisa.it (Postfix) with ESMTP id 27608140D2
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 14:25:33 +0100 (CET)
From: "Claudia Grieco" <grieco@crmpa.unisa.it>
To: <java-user@lucene.apache.org>
References: <000a01cb8c96$a6ed6570$f4c83050$@unisa.it> <AANLkTi=eo8CZkYFB0sG4efJCnzp+XSjW0ioJ2CHDpdWD@mail.gmail.com>
In-Reply-To: <AANLkTi=eo8CZkYFB0sG4efJCnzp+XSjW0ioJ2CHDpdWD@mail.gmail.com>
Subject: R: Retrieve found keywords from document
Date: Thu, 25 Nov 2010 14:27:03 +0100
Message-ID: <000001cb8ca4$728a1bd0$579e5370$@unisa.it>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcuMmEa+2GIT4z79RKiRljjzwY7fYQAC6ZIQ
Content-Language: it

What I call "profile" is free text (extracted from a pdf) and not the =
result
of the user listing hobbies in a form
So to store hobbies in a field called "hobbies" I have to extract =
hobbies
from text first...is it possible to do it using Lucene?

-----Messaggio originale-----
Da: Ian Lea [mailto:ian.lea@gmail.com]=20
Inviato: gioved=EC 25 novembre 2010 13.01
A: java-user@lucene.apache.org
Oggetto: Re: Retrieve found keywords from document

Can't you just store the hobbies as standard stored fields
(Field.Store.YES), or as a single field, call doc.get("hobbies") and
do what you want with them?

This sounds rather like faceting - if so you might want to consider
using Solr.  http://wiki.apache.org/solr/SolrFacetingOverview


--
Ian.

On Thu, Nov 25, 2010 at 11:48 AM, Claudia Grieco <grieco@crmpa.unisa.it>
wrote:
> Hi guys,
>
> I have this problem:
>
> I'm using Lucene to create a search engine on people profiles.
>
> I have a set of hobbies (let's say {"reading" , "singing"} for =
example)
=A0and
> I want to find people who have at least one of these hobbies AND which =
of
> these hobbies they have.
>
> Currently I search for each one of these hobbies (ex, one search for
> reading, one search for singing) but since the list of hobbies is very
long
> (200+) I'd like to do the following:
>
>
>
> 1)Do ONE search that finds all the documents who have at least an =
hobby in
> the text ( this is easily accomplished using BooleanQuery)
>
> 2)For each document, retrieve the keywords found.
>
>
>
> Do you have any ideas on how to do n# 2?
>
> Thank you
>
> Claudia
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47913-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 13:46:35 2010
Return-Path: <java-user-return-47913-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68214 invoked from network); 25 Nov 2010 13:46:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 13:46:34 -0000
Received: (qmail 11770 invoked by uid 500); 25 Nov 2010 13:46:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11439 invoked by uid 500); 25 Nov 2010 13:46:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11431 invoked by uid 99); 25 Nov 2010 13:46:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:46:31 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:46:25 +0000
Received: by bwz9 with SMTP id 9so969527bwz.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 05:46:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=rK9aiwNz4ToR98JA+1O6iHr/zSOJtLSB5/Nly8OL2vo=;
        b=xg3ZhPdIGCyiCRVvGsDuX+YwhtVfYyG7cYnDIjTQwqFr52qKj0CDFk1B2MfCWwG036
         f/6nXaEwd/PCwtF7gnoe4c9CUev3LtB37P57LBEvhYHnos6sVU/xuq0zLbMjjJxqPugC
         VY79UEZ/ppqyqARLqA8p5ZpPCHp5FY50JNRDc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=Me9+FGRxVOVYQA6HwHSMGi5nkRzDJ82vIaXS2TZKGFycvndeMTFQg8qdlBZKL4c3zM
         V1Gf5hQ26oXGyaFn/SzPyC6KCZL/LwDW6BiJZbCTuh2xzcmqiPbJQUU8JWiWReXiIns9
         utsf0M+ZqLlh+I07/SrX6NfjF9Xeu4SOUJJSU=
Received: by 10.204.68.142 with SMTP id v14mr673585bki.106.1290692762936; Thu,
 25 Nov 2010 05:46:02 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Thu, 25 Nov 2010 05:45:42 -0800 (PST)
In-Reply-To: <90362ECB07906C40A0297F9D5211A24323C3CBEA71@ITSEMBXCLUS.enterprise.gcal.ac.uk>
References: <90362ECB07906C40A0297F9D5211A24323C3CBEA71@ITSEMBXCLUS.enterprise.gcal.ac.uk>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 25 Nov 2010 13:45:42 +0000
Message-ID: <AANLkTin5A-TTjZYQZqWYB0ydwCuDQ3EV0UKwvLzC5_Ue@mail.gmail.com>
Subject: Re: IndexWriter Class
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

The normal technique is to write your own analyzer.  See
http://wiki.apache.org/lucene-java/LuceneFAQ#How_do_I_write_my_own_Analyzer=
.3F.
 Then pass that to IndexWriter - and be sure to use the same analyzer
when you are searching, unless you're doing clever things.

--
Ian.


On Thu, Nov 25, 2010 at 12:37 PM, McGibbney, Lewis John
<Lewis.McGibbney@gcu.ac.uk> wrote:
> Hello List,
>
> Lucene 3.0.1
> Windows Vista Premium Home Edition
>
> I am currently attempting to configure my IndexFiles.java file. My intent=
ion is to add the following functionality to the code as I require input te=
xt to be further analyzed than what the default analyzer does.
>
>
> IndexWriter writer =3D new IndexWriter(FSDirectory.open(INDEX_DIR),
>
> new NGramTokenFilter(
>
> new LowerCaseFilter(
>
> new StandardFilter(
>
> new StandardTokenizer
>
> (Version.LUCENE_CURRENT, null)))), true,
>
> IndexWriter.MaxFieldLength.LIMITED);
>
> System.out.println("Indexing to directory '" +INDEX_DIR+ "'...");
>
> indexDocs(writer, docDir);
>
> System.out.println("Optimizing...");
>
> writer.optimize();
>
> writer.close();
>
> Date end =3D new Date();
>
> System.out.println(end.getTime() - start.getTime() + " total milliseconds=
");
>
>
>
> My problem lies in the IndexWriter class and the number of analyzer's/tok=
enizer's I am permitted to pass as parameters and I find that this is sligh=
tly unclear from the javadocs. Are there any existing resources to solve th=
is problem? or can someone help me out please.
>
>
>
> Anything would be greatly appreciated.
>
>
>
> Lews Mc
>
> Glasgow Caledonian University is a registered Scottish charity, number SC=
021474
>
> Winner: Times Higher Education's Widening Participation Initiative of the=
 Year 2009 and Herald Society's Education Initiative of the Year 2009
> http://www.gcu.ac.uk/newsevents/news/bycategory/theuniversity/1/name,6219=
,en.html
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47914-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 13:52:29 2010
Return-Path: <java-user-return-47914-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70095 invoked from network); 25 Nov 2010 13:52:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 13:52:29 -0000
Received: (qmail 35432 invoked by uid 500); 25 Nov 2010 13:52:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35171 invoked by uid 500); 25 Nov 2010 13:52:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35163 invoked by uid 99); 25 Nov 2010 13:52:26 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:52:26 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 13:52:21 +0000
Received: by bwz9 with SMTP id 9so974858bwz.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 05:51:59 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=mr1JRvqHhm1upUVj8VebOX/PcIYPFDjAX1JhJdPGvtw=;
        b=buNj/M9EiP6JVxQS0ChVluryW/4+3MIIYFvLwHUYYdVvoSAL6CQ6NcCUk6PbL/nI9w
         aMqdq/wr5wGw47dEvNhCJLtylzUAGAFrowjIu7WxjMqPc8MZYcRs/MKutbOjD4u49x5h
         hoI18bDb9IF8fV8U++bLytPmcIScZQ78EoIEM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=u7DT3fWTR6Rvbts3A/vx8l66bWEGhTNkrXPBs0rmYF+loPA1UdY7VXjTvqPJHIsfSw
         avaiy3ttpctw6P3EMBhxW2LdgIaYIswluVrmjc1BlwJTwikQLnbCZ3IZ8PU8sdCikdBf
         qg/Qcwi/2aUTk4jyZ2KtSHKKV5W5+hv+WcguM=
Received: by 10.204.113.74 with SMTP id z10mr687213bkp.25.1290693119498; Thu,
 25 Nov 2010 05:51:59 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Thu, 25 Nov 2010 05:51:39 -0800 (PST)
In-Reply-To: <000001cb8ca4$728a1bd0$579e5370$@unisa.it>
References: <000a01cb8c96$a6ed6570$f4c83050$@unisa.it> <AANLkTi=eo8CZkYFB0sG4efJCnzp+XSjW0ioJ2CHDpdWD@mail.gmail.com>
 <000001cb8ca4$728a1bd0$579e5370$@unisa.it>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 25 Nov 2010 13:51:39 +0000
Message-ID: <AANLkTinvERyVdQP03kTyDKAMSrjK=-65tB_dh-hJRQ-+@mail.gmail.com>
Subject: Re: Retrieve found keywords from document
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

You could parse the output from the lucene analyzer that you are using
to get hold of a list of terms and pick the ones that are hobbies.  Or
do it outside lucene using whatever string parsing technique you like.

Or take a look at the recent thread on this list on a similar topic:
"High frequency term for the searched query".


--
Ian.


On Thu, Nov 25, 2010 at 1:27 PM, Claudia Grieco <grieco@crmpa.unisa.it> wro=
te:
> What I call "profile" is free text (extracted from a pdf) and not the res=
ult
> of the user listing hobbies in a form
> So to store hobbies in a field called "hobbies" I have to extract hobbies
> from text first...is it possible to do it using Lucene?
>
> -----Messaggio originale-----
> Da: Ian Lea [mailto:ian.lea@gmail.com]
> Inviato: gioved=EC 25 novembre 2010 13.01
> A: java-user@lucene.apache.org
> Oggetto: Re: Retrieve found keywords from document
>
> Can't you just store the hobbies as standard stored fields
> (Field.Store.YES), or as a single field, call doc.get("hobbies") and
> do what you want with them?
>
> This sounds rather like faceting - if so you might want to consider
> using Solr. =A0http://wiki.apache.org/solr/SolrFacetingOverview
>
>
> --
> Ian.
>
> On Thu, Nov 25, 2010 at 11:48 AM, Claudia Grieco <grieco@crmpa.unisa.it>
> wrote:
>> Hi guys,
>>
>> I have this problem:
>>
>> I'm using Lucene to create a search engine on people profiles.
>>
>> I have a set of hobbies (let's say {"reading" , "singing"} for example)
> =A0and
>> I want to find people who have at least one of these hobbies AND which o=
f
>> these hobbies they have.
>>
>> Currently I search for each one of these hobbies (ex, one search for
>> reading, one search for singing) but since the list of hobbies is very
> long
>> (200+) I'd like to do the following:
>>
>>
>>
>> 1)Do ONE search that finds all the documents who have at least an hobby =
in
>> the text ( this is easily accomplished using BooleanQuery)
>>
>> 2)For each document, retrieve the keywords found.
>>
>>
>>
>> Do you have any ideas on how to do n# 2?
>>
>> Thank you
>>
>> Claudia
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47915-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 14:26:04 2010
Return-Path: <java-user-return-47915-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93506 invoked from network); 25 Nov 2010 14:26:03 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 14:26:03 -0000
Received: (qmail 92430 invoked by uid 500); 25 Nov 2010 14:26:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92240 invoked by uid 500); 25 Nov 2010 14:26:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92232 invoked by uid 99); 25 Nov 2010 14:26:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 14:26:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jan.kurella@nokia.com designates 147.243.128.26 as permitted sender)
Received: from [147.243.128.26] (HELO mgw-da02.nokia.com) (147.243.128.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 14:25:53 +0000
Received: from vaebh104.NOE.Nokia.com (vaebh104.europe.nokia.com [10.160.244.30])
	by mgw-da02.nokia.com (Switch-3.4.3/Switch-3.4.3) with ESMTP id oAPEPUTr020026;
	Thu, 25 Nov 2010 16:25:30 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.6]) by vaebh104.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Thu, 25 Nov 2010 16:25:24 +0200
Received: from 008-AM1MMR1-003.mgdnok.nokia.com (65.54.30.58) by
 NOK-am1MHUB-02.mgdnok.nokia.com (65.54.30.6) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Thu, 25 Nov 2010 15:25:24 +0100
Received: from [127.0.0.1] (172.25.239.54) by clientsmtp.nokia.com
 (65.54.30.58) with Microsoft SMTP Server id 14.0.694.0; Thu, 25 Nov 2010
 15:25:24 +0100
Message-ID: <4CEE71C6.2010103@nokia.com>
Date: Thu, 25 Nov 2010 15:25:10 +0100
From: Jan Kurella <jan.kurella@nokia.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.12) Gecko/20101027 Thunderbird/3.1.6
MIME-Version: 1.0
To: <java-user@lucene.apache.org>, <simon.willnauer@gmail.com>
Subject: Re: custom attributs in tokens
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>	<AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>	<56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>	<AANLkTimuJFZvAydUAKUSJo_zbzBiAhAFBK=v2Kq+3o0j@mail.gmail.com>	<56F65098677DF5489254BE51675614E406425C@008-AM1MPN1-006.mgdnok.nokia.com> <AANLkTim6O8ZWuKLCejNc_axnAdBd9uGLNSMFRDoad6NJ@mail.gmail.com>
In-Reply-To: <AANLkTim6O8ZWuKLCejNc_axnAdBd9uGLNSMFRDoad6NJ@mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"; format=flowed
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 25 Nov 2010 14:25:24.0867 (UTC) FILETIME=[998DED30:01CB8CAC]
X-Nokia-AV: Clean

Hi Simon,

On 25.11.2010 10:40, ext Simon Willnauer wrote:
> Hi Jan,
>
> On Wed, Nov 24, 2010 at 9:12 AM,<jan.kurella@nokia.com>  wrote:
>> Of course:
>>
>> We are trying to search in documents that contain text in several languages. We are also investigating other approaches*, so this is not about finding other variants.
>> the goal is to only match tokens from 1 or more given languages and not to match the token if it is by accident the same in another language.
>>
>> For the payloads my plan is to add the correct language to each and every token during indexing (I'm not sure how to solve this best, but I'm sure this can be solved at least with lucene directly).
>> On search side my current idea is to wrap around a TermPosition and skip all docs, where the current payload has not one of the requested languages.
>> I probably need to use my own Query/Weight for this?
> You don't need to start from nothing here, I suggest you to look at
> SpanTermQuery and TermSpans which uses DocsAndPositionsEnum (or rather
> TermPositions in non-trunk versions). TermSpan gives you the ability
> to override #next() and #skipTo() which is from what I understand what
> you are looking for, right?
Just to get it right: I only subclass the SpanTermQuery to verwrite the 
getSpans(Reader) method to return MyTermSpans().
MyTermSpans are a subclass of TermSpans where I just extend #next() and 
#skipTo() to go further until my desired Payload is found.

Sounds pretty easy and straight forward.
>> Another approach would be to just overwrite the Similarity, but this will only influence scoring and depending on the underlying query not completely skip the token - I have to test the difference for the final score between this approaches.
> Well as you figured correctly this is rather for scoring really.
So if I'm going to use the scoring stuff also, I rather subclass 
PayloadTermQuery then
>> This one blog made me curious if there is already something similar, that skips TermPositions based on given attributes? I could imagine something similar to the current Tokenattribute concept during index time, but also available during search and controlled by a similarity...
> Actually in lucene 4.0 each Flex-Enum has a AttributeSource that
> allows you to add custom attributes to you enumerations. Yet there is
> no logic that skips based on that though.
>
> Simon
lucene 4.0 is  a little far away today? If the above approach performs 
good (and it sounds like it will) it should be good enough for now

Jan



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47916-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 15:56:58 2010
Return-Path: <java-user-return-47916-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30728 invoked from network); 25 Nov 2010 15:56:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 15:56:58 -0000
Received: (qmail 2461 invoked by uid 500); 25 Nov 2010 15:56:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2150 invoked by uid 500); 25 Nov 2010 15:56:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2141 invoked by uid 99); 25 Nov 2010 15:56:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 15:56:55 +0000
X-ASF-Spam-Status: No, hits=2.8 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLYTO,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 15:56:50 +0000
Received: by vws18 with SMTP id 18so413135vws.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 07:56:30 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:reply-to
         :in-reply-to:references:date:message-id:subject:from:to:cc
         :content-type:content-transfer-encoding;
        bh=R/xVUmItpvyUSkGD7Njn1bGggjfT7v0G+KgyOvPysck=;
        b=IpjJJ8BcmlowSzz22M1U6y6ZlunIw8howSsmRVDOD7ueFdcK3pxUVrlsUzzpt0we5C
         lBY8kecOdBcyDZCqKuzBWzdszHHnq+eRZ6VDWmCvQdV0pB2ccIhV2bbOixoTkGjZOIwn
         PpQy4jBS33sMBd+16lTliJ+yRFGelEgfct1GY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:cc:content-type:content-transfer-encoding;
        b=gQYVve805Jt25JT7EunGVa6DFIB4wIlwcs9Wbav4SCxvxMdjkrgyiX4agcSa33hU2X
         LdYTrG1MDO88hHbCGSycukCb6qWNx3c5D1R/qiBFPPvghQXuy44YVBVd9RorJyIFzkRW
         BXG6ZfQExC1oiqsJVfwRFeFcG3H/9bLvc9Qto=
MIME-Version: 1.0
Received: by 10.229.109.197 with SMTP id k5mr857264qcp.14.1290700589856; Thu,
 25 Nov 2010 07:56:29 -0800 (PST)
Received: by 10.229.100.139 with HTTP; Thu, 25 Nov 2010 07:56:29 -0800 (PST)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <4CEE71C6.2010103@nokia.com>
References: <56F65098677DF5489254BE51675614E4061E11@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTikSH_GBgt38cCbZ-0oPRLjy6-gz=G972cF+ZU6E@mail.gmail.com>
	<56F65098677DF5489254BE51675614E40631E1@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTimuJFZvAydUAKUSJo_zbzBiAhAFBK=v2Kq+3o0j@mail.gmail.com>
	<56F65098677DF5489254BE51675614E406425C@008-AM1MPN1-006.mgdnok.nokia.com>
	<AANLkTim6O8ZWuKLCejNc_axnAdBd9uGLNSMFRDoad6NJ@mail.gmail.com>
	<4CEE71C6.2010103@nokia.com>
Date: Thu, 25 Nov 2010 16:56:29 +0100
Message-ID: <AANLkTikH_sVE2T91S113oP9EV9fG3pUbWi0ZJX-2iN7B@mail.gmail.com>
Subject: Re: custom attributs in tokens
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: Jan Kurella <jan.kurella@nokia.com>
Cc: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

On Thu, Nov 25, 2010 at 3:25 PM, Jan Kurella <jan.kurella@nokia.com> wrote:
> Hi Simon,
>
> On 25.11.2010 10:40, ext Simon Willnauer wrote:
>>
>> Hi Jan,
>>
>> On Wed, Nov 24, 2010 at 9:12 AM,<jan.kurella@nokia.com> =C2=A0wrote:
>>>
>>> Of course:
>>>
>>> We are trying to search in documents that contain text in several
>>> languages. We are also investigating other approaches*, so this is not =
about
>>> finding other variants.
>>> the goal is to only match tokens from 1 or more given languages and not
>>> to match the token if it is by accident the same in another language.
>>>
>>> For the payloads my plan is to add the correct language to each and eve=
ry
>>> token during indexing (I'm not sure how to solve this best, but I'm sur=
e
>>> this can be solved at least with lucene directly).
>>> On search side my current idea is to wrap around a TermPosition and ski=
p
>>> all docs, where the current payload has not one of the requested langua=
ges.
>>> I probably need to use my own Query/Weight for this?
>>
>> You don't need to start from nothing here, I suggest you to look at
>> SpanTermQuery and TermSpans which uses DocsAndPositionsEnum (or rather
>> TermPositions in non-trunk versions). TermSpan gives you the ability
>> to override #next() and #skipTo() which is from what I understand what
>> you are looking for, right?
>
> Just to get it right: I only subclass the SpanTermQuery to verwrite the
> getSpans(Reader) method to return MyTermSpans().
> MyTermSpans are a subclass of TermSpans where I just extend #next() and
> #skipTo() to go further until my desired Payload is found.

that sounds about right...
>
> Sounds pretty easy and straight forward.
>>>
>>> Another approach would be to just overwrite the Similarity, but this wi=
ll
>>> only influence scoring and depending on the underlying query not comple=
tely
>>> skip the token - I have to test the difference for the final score betw=
een
>>> this approaches.
>>
>> Well as you figured correctly this is rather for scoring really.
>
> So if I'm going to use the scoring stuff also, I rather subclass
> PayloadTermQuery then

hmm I am not a span expert but I guess that would make it easier though.
>>>
>>> This one blog made me curious if there is already something similar, th=
at
>>> skips TermPositions based on given attributes? I could imagine somethin=
g
>>> similar to the current Tokenattribute concept during index time, but al=
so
>>> available during search and controlled by a similarity...
>>
>> Actually in lucene 4.0 each Flex-Enum has a AttributeSource that
>> allows you to add custom attributes to you enumerations. Yet there is
>> no logic that skips based on that though.
>>
>> Simon
>
> lucene 4.0 is =C2=A0a little far away today? If the above approach perfor=
ms good
> (and it sounds like it will) it should be good enough for now

i was just saying that this is on the way... and yeah you might need
to wait a bit until 4.0 :)

simon

>
> Jan
>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47917-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 16:48:35 2010
Return-Path: <java-user-return-47917-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52129 invoked from network); 25 Nov 2010 16:48:35 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 16:48:35 -0000
Received: (qmail 52568 invoked by uid 500); 25 Nov 2010 16:48:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52377 invoked by uid 500); 25 Nov 2010 16:48:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52368 invoked by uid 99); 25 Nov 2010 16:48:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 16:48:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [193.205.191.1] (HELO gauss.crmpa.unisa.it) (193.205.191.1)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 25 Nov 2010 16:48:24 +0000
Received: from nelson (unknown [193.205.191.127])
	by gauss.crmpa.unisa.it (Postfix) with ESMTP id 89847140CF
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 17:46:30 +0100 (CET)
From: "Claudia Grieco" <grieco@crmpa.unisa.it>
To: <java-user@lucene.apache.org>
References: <000a01cb8c96$a6ed6570$f4c83050$@unisa.it> <AANLkTi=eo8CZkYFB0sG4efJCnzp+XSjW0ioJ2CHDpdWD@mail.gmail.com> <000001cb8ca4$728a1bd0$579e5370$@unisa.it> <AANLkTinvERyVdQP03kTyDKAMSrjK=-65tB_dh-hJRQ-+@mail.gmail.com>
In-Reply-To: <AANLkTinvERyVdQP03kTyDKAMSrjK=-65tB_dh-hJRQ-+@mail.gmail.com>
Subject: R: Retrieve found keywords from document
Date: Thu, 25 Nov 2010 17:48:03 +0100
Message-ID: <000e01cb8cc0$869e1e70$93da5b50$@unisa.it>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcuMp8hpbglnx+7USdacQF7GtPhAowAEAKEA
Content-Language: it
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks a lot.
I used the lucene analyzer to parse the profile and everything works :)

-----Messaggio originale-----
Da: Ian Lea [mailto:ian.lea@gmail.com]=20
Inviato: gioved=EC 25 novembre 2010 14.52
A: java-user@lucene.apache.org
Oggetto: Re: Retrieve found keywords from document

You could parse the output from the lucene analyzer that you are using
to get hold of a list of terms and pick the ones that are hobbies.  Or
do it outside lucene using whatever string parsing technique you like.

Or take a look at the recent thread on this list on a similar topic:
"High frequency term for the searched query".


--
Ian.


On Thu, Nov 25, 2010 at 1:27 PM, Claudia Grieco <grieco@crmpa.unisa.it>
wrote:
> What I call "profile" is free text (extracted from a pdf) and not the
result
> of the user listing hobbies in a form
> So to store hobbies in a field called "hobbies" I have to extract =
hobbies
> from text first...is it possible to do it using Lucene?
>
> -----Messaggio originale-----
> Da: Ian Lea [mailto:ian.lea@gmail.com]
> Inviato: gioved=EC 25 novembre 2010 13.01
> A: java-user@lucene.apache.org
> Oggetto: Re: Retrieve found keywords from document
>
> Can't you just store the hobbies as standard stored fields
> (Field.Store.YES), or as a single field, call doc.get("hobbies") and
> do what you want with them?
>
> This sounds rather like faceting - if so you might want to consider
> using Solr. =A0http://wiki.apache.org/solr/SolrFacetingOverview
>
>
> --
> Ian.
>
> On Thu, Nov 25, 2010 at 11:48 AM, Claudia Grieco =
<grieco@crmpa.unisa.it>
> wrote:
>> Hi guys,
>>
>> I have this problem:
>>
>> I'm using Lucene to create a search engine on people profiles.
>>
>> I have a set of hobbies (let's say {"reading" , "singing"} for =
example)
> =A0and
>> I want to find people who have at least one of these hobbies AND =
which of
>> these hobbies they have.
>>
>> Currently I search for each one of these hobbies (ex, one search for
>> reading, one search for singing) but since the list of hobbies is =
very
> long
>> (200+) I'd like to do the following:
>>
>>
>>
>> 1)Do ONE search that finds all the documents who have at least an =
hobby
in
>> the text ( this is easily accomplished using BooleanQuery)
>>
>> 2)For each document, retrieve the keywords found.
>>
>>
>>
>> Do you have any ideas on how to do n# 2?
>>
>> Thank you
>>
>> Claudia
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47918-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 17:19:27 2010
Return-Path: <java-user-return-47918-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67067 invoked from network); 25 Nov 2010 17:19:27 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 17:19:27 -0000
Received: (qmail 78450 invoked by uid 500); 25 Nov 2010 17:19:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78376 invoked by uid 500); 25 Nov 2010 17:19:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78368 invoked by uid 99); 25 Nov 2010 17:19:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 17:19:24 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 17:19:17 +0000
Received: by qwf6 with SMTP id 6so258553qwf.35
        for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 09:18:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=DlaGYyW2D+NM0xnqqpThX9zGkBFq/VtQGMob4Iw/044=;
        b=gAJe6xkqjwPdAJqCCLaP/qiqfnBys/M495pe6+rps9/hv8ElNtSr1UZtP2w1nLq8mq
         FeGcEDfNDX8DRSQ7lMwQvSx3SnCuI4ybtZY08J7GvfJ5tLXpnBJIN4hcxYOB403bMnnJ
         +GpSXN/WHhU523ouSu62CJmPFGjkL4RUU25Cg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=whRYmF1hWiTmODTaWGifau7icqGAOhajk5mXOJZVYz5wZo0+Lmr45hiL5Yv6zM0quz
         I/2i+G1LqUI+UXYVM6FdLot16IRKrZGc7yyzAytycAP80zUwlsGRkIIzw6VTsn2O5f9O
         JLG9qg5MiCaq3R+iq71a2k6xUvvNgfWHbWM1A=
MIME-Version: 1.0
Received: by 10.229.86.149 with SMTP id s21mr850633qcl.234.1290705536022; Thu,
 25 Nov 2010 09:18:56 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Thu, 25 Nov 2010 09:18:55 -0800 (PST)
In-Reply-To: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
References: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
Date: Thu, 25 Nov 2010 12:18:55 -0500
Message-ID: <AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
Subject: Re: not indexing analyzed field
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364272b5fbf84f0495e3cc13
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364272b5fbf84f0495e3cc13
Content-Type: text/plain; charset=ISO-8859-1

What is your evidence that "the result never reaches the index?"

Are you sure:
1> you commit afterwards
2> you reopen the underlying reader to see
3> if you don't store the value for the field, how are you sure?
4> If you search and don't find it, did you index it?

First, I'd be sure the value in question is in the document just before
sending it to be added to your index to see if the value you think
is in there really is. Something like Document.get() and see if

Best
Erick

On Thu, Nov 25, 2010 at 8:08 AM, Bernd Fehling <
bernd.fehling@uni-bielefeld.de> wrote:

> I used KeywordAnalyzer and KeywordTokenizer as templates for
> a new analyzer.
> The analyzer works fine but the result never reaches the index.
>
> My analyzer is called in "DocInverterPerField.processFields"
> with "stream.incrementToken()".
> ...
> try {
>    boolean hasMoreTokens = stream.incrementToken();
>
>    fieldState.attributeSource = stream;
>
>    OffsetAttribute offsetAttribute =
> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
>    PositionIncrementAttribute posIncrAttribute =
> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);
>
>    consumer.start(field);
> ...
>
> The result goes to "fieldState.attributeSource" but is not in "field".
> So "field.fieldsData" still has the old content before calling my
> analyzer. And when calling "consumer.start(field)" the old content
> is going to the index and not the new analyzed one.
> Does the analyzer has to care about "Fieldable field.fieldsData"
> or who is responsible for it?
>
> Regards
> Bernd
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364272b5fbf84f0495e3cc13--

From java-user-return-47919-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Nov 25 17:33:25 2010
Return-Path: <java-user-return-47919-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73260 invoked from network); 25 Nov 2010 17:33:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 25 Nov 2010 17:33:25 -0000
Received: (qmail 4182 invoked by uid 500); 25 Nov 2010 17:33:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3940 invoked by uid 500); 25 Nov 2010 17:33:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3932 invoked by uid 99); 25 Nov 2010 17:33:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 17:33:22 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 25 Nov 2010 17:33:15 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 2684C45FD54
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 18:32:55 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id kvF2BnnJ5Sed for <java-user@lucene.apache.org>;
	Thu, 25 Nov 2010 18:32:50 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id A522645FD8D
	for <java-user@lucene.apache.org>; Thu, 25 Nov 2010 18:32:49 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
In-Reply-To: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
Subject: RE: not indexing analyzed field
Date: Thu, 25 Nov 2010 18:33:16 +0100
Message-ID: <006601cb8cc6$d89bbf10$89d33d30$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQI8CDXjZiYJrRyYxcrIP4XD1s+STJKhfKaA
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

field.fieldsData is used for the stored field contents and so only *stored*
in index, of course not analyzed (why should I analyze a stored field). The
indexed tokens go of course through your analyzer and the returned tokens
are indexed as terms. Where is the problem?

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Bernd Fehling [mailto:bernd.fehling@uni-bielefeld.de]
> Sent: Thursday, November 25, 2010 2:08 PM
> To: java-user@lucene.apache.org
> Subject: not indexing analyzed field
> 
> I used KeywordAnalyzer and KeywordTokenizer as templates for a new
> analyzer.
> The analyzer works fine but the result never reaches the index.
> 
> My analyzer is called in "DocInverterPerField.processFields"
> with "stream.incrementToken()".
> ...
> try {
>     boolean hasMoreTokens = stream.incrementToken();
> 
>     fieldState.attributeSource = stream;
> 
>     OffsetAttribute offsetAttribute =
> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
>     PositionIncrementAttribute posIncrAttribute =
> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);
> 
>     consumer.start(field);
> ...
> 
> The result goes to "fieldState.attributeSource" but is not in "field".
> So "field.fieldsData" still has the old content before calling my
analyzer. And
> when calling "consumer.start(field)" the old content is going to the index
and
> not the new analyzed one.
> Does the analyzer has to care about "Fieldable field.fieldsData"
> or who is responsible for it?
> 
> Regards
> Bernd
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47920-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 07:11:29 2010
Return-Path: <java-user-return-47920-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17716 invoked from network); 26 Nov 2010 07:11:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 07:11:28 -0000
Received: (qmail 69113 invoked by uid 500); 26 Nov 2010 07:11:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68858 invoked by uid 500); 26 Nov 2010 07:11:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68827 invoked by uid 99); 26 Nov 2010 07:11:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 07:11:24 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bernd.fehling@uni-bielefeld.de designates 129.70.204.73 as permitted sender)
Received: from [129.70.204.73] (HELO mux2-unibi-smtp.hrz.uni-bielefeld.de) (129.70.204.73)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 07:11:17 +0000
MIME-version: 1.0
Content-transfer-encoding: 8BIT
Content-type: text/plain; charset=ISO-8859-1
Received: from pmxchannel-daemon.mux2-unibi-smtp.hrz.uni-bielefeld.de by
 mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 id <0LCH00900DA88P00@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Fri, 26 Nov 2010 08:10:56 +0100 (CET)
Received: from [129.70.11.68] ([129.70.11.68])
 by mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 with ESMTPPSA id <0LCH00AM6DA77XA0@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Fri, 26 Nov 2010 08:10:56 +0100 (CET)
Date: Fri, 26 Nov 2010 08:10:55 +0100
From: Bernd Fehling <bernd.fehling@uni-bielefeld.de>
Subject: Re: not indexing analyzed field
In-reply-to: <AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
To: java-user@lucene.apache.org
Message-id:
 <29187_1290755456_ZZh0c3XercuX7.00_4CEF5D7F.5010003@uni-bielefeld.de>
X-EnvFrom: bernd.fehling@uni-bielefeld.de
X-PMX-Version: 5.5.9.395186, Antispam-Engine: 2.7.2.376379,
 Antispam-Data: 2010.11.26.65414, pmx10
X-Connecting-IP: 129.70.11.68
References:
 <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
 <AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.1.15) Gecko/20101026
 SUSE/3.0.10 Thunderbird/3.0.10
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Erik,

my evidence is that I load a single document into an empty index
with a field "id" and a second field "dcdocid". The field "dcdocid"
has the word "foo". This goes through my analyzer and changes to
MD5 string which is then "acbd18db4cc2f85cedef654fccc4a4d8".
After indexing and commit a search for *:* shows me "foo" for
the field "dcdocid" and not my MD5.

my fieldType:
<fieldType name="text_md" class="solr.TextField" omitNorms="true" >
  <analyzer type="index" class="de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
</fieldType>

<!-- UNIQUE ID -->
<field name="id" type="string" indexed="true" stored="true" required="true" />
<field name="dcdocid" type="text_md" indexed="true" stored="true" />
<copyField source="id" dest="dcdocid" />

Using the debugger shows that the value in question is going
through the TextMessageDigestAnalyzer and coming out as MD5
but it is not as MD5 in the index.

I also tried a filter but no success.
So why is something that is analyzed (and the value has changed
due to analysis) not stored with its new value in the index?

Best regards,
Bernd


Am 25.11.2010 18:18, schrieb Erick Erickson:
> What is your evidence that "the result never reaches the index?"
> 
> Are you sure:
> 1> you commit afterwards
> 2> you reopen the underlying reader to see
> 3> if you don't store the value for the field, how are you sure?
> 4> If you search and don't find it, did you index it?
> 
> First, I'd be sure the value in question is in the document just before
> sending it to be added to your index to see if the value you think
> is in there really is. Something like Document.get() and see if
> 
> Best
> Erick
> 
> On Thu, Nov 25, 2010 at 8:08 AM, Bernd Fehling <
> bernd.fehling@uni-bielefeld.de> wrote:
> 
>> I used KeywordAnalyzer and KeywordTokenizer as templates for
>> a new analyzer.
>> The analyzer works fine but the result never reaches the index.
>>
>> My analyzer is called in "DocInverterPerField.processFields"
>> with "stream.incrementToken()".
>> ...
>> try {
>>    boolean hasMoreTokens = stream.incrementToken();
>>
>>    fieldState.attributeSource = stream;
>>
>>    OffsetAttribute offsetAttribute =
>> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
>>    PositionIncrementAttribute posIncrAttribute =
>> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);
>>
>>    consumer.start(field);
>> ...
>>
>> The result goes to "fieldState.attributeSource" but is not in "field".
>> So "field.fieldsData" still has the old content before calling my
>> analyzer. And when calling "consumer.start(field)" the old content
>> is going to the index and not the new analyzed one.
>> Does the analyzer has to care about "Fieldable field.fieldsData"
>> or who is responsible for it?
>>
>> Regards
>> Bernd
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 

-- 
*************************************************************
Bernd Fehling                Universittsbibliothek Bielefeld
Dipl.-Inform. (FH)                        Universittsstr. 25
Tel. +49 521 106-4060                   Fax. +49 521 106-4052
bernd.fehling@uni-bielefeld.de                33615 Bielefeld

BASE - Bielefeld Academic Search Engine - www.base-search.net
*************************************************************

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47921-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 07:23:59 2010
Return-Path: <java-user-return-47921-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19133 invoked from network); 26 Nov 2010 07:23:59 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 07:23:59 -0000
Received: (qmail 75930 invoked by uid 500); 26 Nov 2010 07:23:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75779 invoked by uid 500); 26 Nov 2010 07:23:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75771 invoked by uid 99); 26 Nov 2010 07:23:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 07:23:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of bernd.fehling@uni-bielefeld.de designates 129.70.204.73 as permitted sender)
Received: from [129.70.204.73] (HELO mux2-unibi-smtp.hrz.uni-bielefeld.de) (129.70.204.73)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 07:23:51 +0000
MIME-version: 1.0
Content-transfer-encoding: 8BIT
Content-type: text/plain; charset=ISO-8859-1
Received: from pmxchannel-daemon.mux2-unibi-smtp.hrz.uni-bielefeld.de by
 mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 id <0LCH00B00DV57I00@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Fri, 26 Nov 2010 08:23:29 +0100 (CET)
Received: from [129.70.11.68] ([129.70.11.68])
 by mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 with ESMTPPSA id <0LCH00AIADV47XC0@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Fri, 26 Nov 2010 08:23:29 +0100 (CET)
Date: Fri, 26 Nov 2010 08:23:29 +0100
From: Bernd Fehling <bernd.fehling@uni-bielefeld.de>
Subject: Re: not indexing analyzed field
In-reply-to: <006601cb8cc6$d89bbf10$89d33d30$@thetaphi.de>
To: java-user@lucene.apache.org
Message-id:
 <27775_1290756209_ZZh0c3XiucqX9.00_4CEF6071.5080000@uni-bielefeld.de>
X-EnvFrom: bernd.fehling@uni-bielefeld.de
X-PMX-Version: 5.5.9.395186, Antispam-Engine: 2.7.2.376379,
 Antispam-Data: 2010.11.26.71221, pmx8
X-Connecting-IP: 129.70.11.68
References:
 <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
 <006601cb8cc6$d89bbf10$89d33d30$@thetaphi.de>
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.1.15) Gecko/20101026
 SUSE/3.0.10 Thunderbird/3.0.10

Hi Uwe,

my fieldType and fields are as follows:

<fieldType name="text_md" class="solr.TextField" omitNorms="true" >
  <analyzer type="index" class="de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
</fieldType>

<!-- UNIQUE ID -->
<field name="id" type="string" indexed="true" stored="true" required="true" />
<field name="dcdocid" type="text_md" indexed="true" stored="true" />
<copyField source="id" dest="dcdocid" />

So the field dcdocid has the attribute *stored* which I can also see
in the debugger.
Why should I analyze a stored field?
I don't know if I need to analyze it, I also tried a filter but also no success.

My understanding is to send something to a field and the field has a processing
chain. The processing chain analyzes, filters, ... is doing something to the
content and then stores the content to that field in the index.

May be it is a misunderstanding on my side about the field based processing
because I'm normally working with FAST search engines which is document based.

Best regards
Bernd



Am 25.11.2010 18:33, schrieb Uwe Schindler:
> field.fieldsData is used for the stored field contents and so only *stored*
> in index, of course not analyzed (why should I analyze a stored field). The
> indexed tokens go of course through your analyzer and the returned tokens
> are indexed as terms. Where is the problem?
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
> 
>> -----Original Message-----
>> From: Bernd Fehling [mailto:bernd.fehling@uni-bielefeld.de]
>> Sent: Thursday, November 25, 2010 2:08 PM
>> To: java-user@lucene.apache.org
>> Subject: not indexing analyzed field
>>
>> I used KeywordAnalyzer and KeywordTokenizer as templates for a new
>> analyzer.
>> The analyzer works fine but the result never reaches the index.
>>
>> My analyzer is called in "DocInverterPerField.processFields"
>> with "stream.incrementToken()".
>> ...
>> try {
>>     boolean hasMoreTokens = stream.incrementToken();
>>
>>     fieldState.attributeSource = stream;
>>
>>     OffsetAttribute offsetAttribute =
>> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
>>     PositionIncrementAttribute posIncrAttribute =
>> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);
>>
>>     consumer.start(field);
>> ...
>>
>> The result goes to "fieldState.attributeSource" but is not in "field".
>> So "field.fieldsData" still has the old content before calling my
> analyzer. And
>> when calling "consumer.start(field)" the old content is going to the index
> and
>> not the new analyzed one.
>> Does the analyzer has to care about "Fieldable field.fieldsData"
>> or who is responsible for it?
>>
>> Regards
>> Bernd
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 

-- 
*************************************************************
Bernd Fehling                Universittsbibliothek Bielefeld
Dipl.-Inform. (FH)                        Universittsstr. 25
Tel. +49 521 106-4060                   Fax. +49 521 106-4052
bernd.fehling@uni-bielefeld.de                33615 Bielefeld

BASE - Bielefeld Academic Search Engine - www.base-search.net
*************************************************************

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47922-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 13:40:55 2010
Return-Path: <java-user-return-47922-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58103 invoked from network); 26 Nov 2010 13:40:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 13:40:55 -0000
Received: (qmail 53791 invoked by uid 500); 26 Nov 2010 13:40:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53443 invoked by uid 500); 26 Nov 2010 13:40:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53430 invoked by uid 99); 26 Nov 2010 13:40:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 13:40:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jan.kurella@nokia.com designates 147.243.1.48 as permitted sender)
Received: from [147.243.1.48] (HELO mgw-sa02.nokia.com) (147.243.1.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 13:40:42 +0000
Received: from esebh102.NOE.Nokia.com (esebh102.ntc.nokia.com [172.21.138.183])
	by mgw-sa02.nokia.com (Switch-3.4.3/Switch-3.4.3) with ESMTP id oAQDeJoq012346
	for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 15:40:21 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.8]) by esebh102.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Fri, 26 Nov 2010 15:40:01 +0200
Received: from 008-AM1MMR1-004.mgdnok.nokia.com (65.54.30.59) by
 NOK-AM1MHUB-04.mgdnok.nokia.com (65.54.30.8) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Fri, 26 Nov 2010 14:40:00 +0100
Received: from [127.0.0.1] (172.25.239.54) by clientsmtp.nokia.com
 (65.54.30.59) with Microsoft SMTP Server id 14.0.694.0; Fri, 26 Nov 2010
 14:39:59 +0100
Message-ID: <4CEFB8A9.1060802@nokia.com>
Date: Fri, 26 Nov 2010 14:39:53 +0100
From: Jan Kurella <jan.kurella@nokia.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.12) Gecko/20101027 Thunderbird/3.1.6
MIME-Version: 1.0
To: <java-user@lucene.apache.org>
Subject: DisMaxQuery calculating too high sumOfSquaredWeights?
Content-Type: text/plain; charset="UTF-8"; format=flowed
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 26 Nov 2010 13:40:01.0450 (UTC) FILETIME=[6CAF38A0:01CB8D6F]
X-Nokia-AV: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

Hi there,

I was composing a Query like the Solr.DisMaxQueryHandler would do on my 
own as I needed a different Tokenizing strategy for non whitespace 
separated languages and more. The concept I took from
http://www.lucidimagination.com/blog/2010/05/23/whats-a-dismax/

Assume now the following:
Documents having two fields "title" and "tag". User input can match any 
field but must be found almost fully
Document <title:blue star> <tag:have fun>

Query: "blue star fun"

And my Query from my query parser looks like the following:

BooleanQuery (
     DisjunctionMaxQuery (
         SpanTermQuery(title:blue),
         SpanTermQuery(tag:blue)
     ),
     DisjunctionMaxQuery (
         SpanTermQuery(title:star),
         SpanTermQuery(tag:star)
     ),
     DisjunctionMaxQuery (
         SpanTermQuery(title:fun),
         SpanTermQuery(tag:fun)
     ),
     minShouldMatch = 2
)

Obviously this is a "full match", meaning all three terms are found, and 
from subjective user perspective this should not be a big difference in 
the score to a pure OR-query "blue star fun" with all tokens in the same 
field. But surprisingly the score from the DMQuery is extremly low!

Looking into it it turns out, that the querynorm multiplied into each 
queryWeight of each SpanTermQuery is very small (0.16). It is calculated 
by the BooleanQuery by getting the sum of sumOfSquaredWeights() of each 
DMQuery. And here is the problem. The idf of the STQuery (or a 
TermQuery) used to elaborate the weight is very high for a Term not 
present (that is on purpose) Unfortunately the DMQuery takes the highest 
idf (assuming tie=0.0) from all clauses.

By concept for the whole dismax query the chance that there will be a 
Term not found in a concrete DMQuery is near 100%, especially if you 
search across many fields. Thus, the idf of a DMQuery is almost always 
equal to a Termquery which term will not be found. But For scoring only 
the clause of the DMQuery that hit will be taken into account. This 
leads to too small scores!

What I think would be the correct idf for a DMQuery with pure 
TermQueries would be rather something like

if any term matches
     take the highest (plus tiestuff) idf from these clauses,
else
     take the highest idf

Unfortunately, when calculating sumOfSquaredWeights(), the idf is 
already calculated in a general correct way and I do not see a way to to 
know in DisjunctionMaxQuery.DisjunctionMaxWeight.sumOfSquaredWeights() 
whether a returned currentWeight.sumOfSquaredWeights() comes from a 
TermQuery which only term has a df of 0?

How to solve this problem to get a "better" sumOfSquaredWeights() from 
DisMaxQuery? The current value does not reflect the intention of this query.

Jan


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47923-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 13:51:21 2010
Return-Path: <java-user-return-47923-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60904 invoked from network); 26 Nov 2010 13:51:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 13:51:21 -0000
Received: (qmail 72161 invoked by uid 500); 26 Nov 2010 13:51:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71883 invoked by uid 500); 26 Nov 2010 13:51:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71875 invoked by uid 99); 26 Nov 2010 13:51:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 13:51:18 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jan.kurella@nokia.com designates 147.243.128.24 as permitted sender)
Received: from [147.243.128.24] (HELO mgw-da01.nokia.com) (147.243.128.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 13:51:09 +0000
Received: from vaebh102.NOE.Nokia.com (vaebh102.europe.nokia.com [10.160.244.23])
	by mgw-da01.nokia.com (Switch-3.4.3/Switch-3.4.3) with ESMTP id oAQDoQmD011615
	for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 15:50:47 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.7]) by vaebh102.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Fri, 26 Nov 2010 15:50:39 +0200
Received: from 008-AM1MMR1-006.mgdnok.nokia.com (65.54.30.61) by
 NOK-AM1MHUB-03.mgdnok.nokia.com (65.54.30.7) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Fri, 26 Nov 2010 14:50:39 +0100
Received: from [127.0.0.1] (172.25.239.54) by clientsmtp.nokia.com
 (65.54.30.61) with Microsoft SMTP Server id 14.0.694.0; Fri, 26 Nov 2010
 14:50:37 +0100
Message-ID: <4CEFBB2C.1070901@nokia.com>
Date: Fri, 26 Nov 2010 14:50:36 +0100
From: Jan Kurella <jan.kurella@nokia.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.12) Gecko/20101027 Thunderbird/3.1.6
MIME-Version: 1.0
To: <java-user@lucene.apache.org>
Subject: Re: DisMaxQuery calculating too high sumOfSquaredWeights?
References: <4CEFB8A9.1060802@nokia.com>
In-Reply-To: <4CEFB8A9.1060802@nokia.com>
Content-Type: text/plain; charset="UTF-8"; format=flowed
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 26 Nov 2010 13:50:39.0418 (UTC) FILETIME=[E8F169A0:01CB8D70]
X-Nokia-AV: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

On 26.11.2010 14:39, ext Jan Kurella wrote:
> Hi there,
>
> I was composing a Query like the Solr.DisMaxQueryHandler would do on 
> my own as I needed a different Tokenizing strategy for non whitespace 
> separated languages and more. The concept I took from
> http://www.lucidimagination.com/blog/2010/05/23/whats-a-dismax/
>
> Assume now the following:
> Documents having two fields "title" and "tag". User input can match 
> any field but must be found almost fully
> Document <title:blue star> <tag:have fun>
>
> Query: "blue star fun"
>
> And my Query from my query parser looks like the following:
>
> BooleanQuery (
>     DisjunctionMaxQuery (
>         SpanTermQuery(title:blue),
>         SpanTermQuery(tag:blue)
>     ),
>     DisjunctionMaxQuery (
>         SpanTermQuery(title:star),
>         SpanTermQuery(tag:star)
>     ),
>     DisjunctionMaxQuery (
>         SpanTermQuery(title:fun),
>         SpanTermQuery(tag:fun)
>     ),
>     minShouldMatch = 2
> )
>
> Obviously this is a "full match", meaning all three terms are found, 
> and from subjective user perspective this should not be a big 
> difference in the score to a pure OR-query "blue star fun" with all 
> tokens in the same field. But surprisingly the score from the DMQuery 
> is extremly low!
>
> Looking into it it turns out, that the querynorm multiplied into each 
> queryWeight of each SpanTermQuery is very small (0.16). It is 
> calculated by the BooleanQuery by getting the sum of 
> sumOfSquaredWeights() of each DMQuery. And here is the problem. The 
> idf of the STQuery (or a TermQuery) used to elaborate the weight is 
> very high for a Term not present (that is on purpose) Unfortunately 
> the DMQuery takes the highest idf (assuming tie=0.0) from all clauses.
>
> By concept for the whole dismax query the chance that there will be a 
> Term not found in a concrete DMQuery is near 100%, especially if you 
> search across many fields. Thus, the idf of a DMQuery is almost always 
> equal to a Termquery which term will not be found. But For scoring 
> only the clause of the DMQuery that hit will be taken into account. 
> This leads to too small scores!
>
> What I think would be the correct idf for a DMQuery with pure 
> TermQueries would be rather something like
>
> if any term matches
>     take the highest (plus tiestuff) idf from these clauses,
> else
>     take the highest idf
>
> Unfortunately, when calculating sumOfSquaredWeights(), the idf is 
> already calculated in a general correct way and I do not see a way to 
> to know in 
> DisjunctionMaxQuery.DisjunctionMaxWeight.sumOfSquaredWeights() whether 
> a returned currentWeight.sumOfSquaredWeights() comes from a TermQuery 
> which only term has a df of 0?
>
> How to solve this problem to get a "better" sumOfSquaredWeights() from 
> DisMaxQuery? The current value does not reflect the intention of this 
> query.
>
> Jan
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
What is about this?

public float sumOfSquaredWeights() throws IOException {
     float min = Float.MAX_VALUE, sum = 0.0f;
     for (Weight currentWeight : weights) {
         float sub = currentWeight.sumOfSquaredWeights();
         sum += sub;
         min = Math.min(min, sub);
     }
     if (min == Float.MAX_VALUE) min=0.0f;
     float boost = getBoost();
     return (((sum - min) * tieBreakerMultiplier * tieBreakerMultiplier) 
+ min) * boost * boost;
}





---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47924-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 14:04:46 2010
Return-Path: <java-user-return-47924-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63854 invoked from network); 26 Nov 2010 14:04:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 14:04:46 -0000
Received: (qmail 91619 invoked by uid 500); 26 Nov 2010 14:04:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91524 invoked by uid 500); 26 Nov 2010 14:04:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91516 invoked by uid 99); 26 Nov 2010 14:04:41 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:04:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jan.kurella@nokia.com designates 147.243.128.26 as permitted sender)
Received: from [147.243.128.26] (HELO mgw-da02.nokia.com) (147.243.128.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:04:34 +0000
Received: from vaebh101.NOE.Nokia.com (vaebh101.europe.nokia.com [10.160.244.22])
	by mgw-da02.nokia.com (Switch-3.4.3/Switch-3.4.3) with ESMTP id oAQE3lAj011264
	for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 16:04:12 +0200
Received: from smtp.mgd.nokia.com ([65.54.30.8]) by vaebh101.NOE.Nokia.com over TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675);
	 Fri, 26 Nov 2010 16:04:06 +0200
Received: from 008-AM1MMR1-006.mgdnok.nokia.com (65.54.30.61) by
 NOK-AM1MHUB-04.mgdnok.nokia.com (65.54.30.8) with Microsoft SMTP Server (TLS)
 id 8.2.254.0; Fri, 26 Nov 2010 15:04:04 +0100
Received: from [127.0.0.1] (172.25.239.54) by clientsmtp.nokia.com
 (65.54.30.61) with Microsoft SMTP Server id 14.0.694.0; Fri, 26 Nov 2010
 15:04:03 +0100
Message-ID: <4CEFBE52.70908@nokia.com>
Date: Fri, 26 Nov 2010 15:04:02 +0100
From: Jan Kurella <jan.kurella@nokia.com>
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.12) Gecko/20101027 Thunderbird/3.1.6
MIME-Version: 1.0
To: <java-user@lucene.apache.org>
Subject: Re: DisMaxQuery calculating too high sumOfSquaredWeights?
References: <4CEFB8A9.1060802@nokia.com> <4CEFBB2C.1070901@nokia.com>
In-Reply-To: <4CEFBB2C.1070901@nokia.com>
Content-Type: text/plain; charset="UTF-8"; format=flowed
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 26 Nov 2010 14:04:06.0320 (UTC) FILETIME=[C9E4E300:01CB8D72]
X-Nokia-AV: Clean

On 26.11.2010 14:50, ext Jan Kurella wrote:
> On 26.11.2010 14:39, ext Jan Kurella wrote:
>> Hi there,
>>
>> I was composing a Query like the Solr.DisMaxQueryHandler would do on 
>> my own as I needed a different Tokenizing strategy for non whitespace 
>> separated languages and more. The concept I took from
>> http://www.lucidimagination.com/blog/2010/05/23/whats-a-dismax/
>>
>> Assume now the following:
>> Documents having two fields "title" and "tag". User input can match 
>> any field but must be found almost fully
>> Document <title:blue star> <tag:have fun>
>>
>> Query: "blue star fun"
>>
>> And my Query from my query parser looks like the following:
>>
>> BooleanQuery (
>>     DisjunctionMaxQuery (
>>         SpanTermQuery(title:blue),
>>         SpanTermQuery(tag:blue)
>>     ),
>>     DisjunctionMaxQuery (
>>         SpanTermQuery(title:star),
>>         SpanTermQuery(tag:star)
>>     ),
>>     DisjunctionMaxQuery (
>>         SpanTermQuery(title:fun),
>>         SpanTermQuery(tag:fun)
>>     ),
>>     minShouldMatch = 2
>> )
>>
>> Obviously this is a "full match", meaning all three terms are found, 
>> and from subjective user perspective this should not be a big 
>> difference in the score to a pure OR-query "blue star fun" with all 
>> tokens in the same field. But surprisingly the score from the DMQuery 
>> is extremly low!
>>
>> Looking into it it turns out, that the querynorm multiplied into each 
>> queryWeight of each SpanTermQuery is very small (0.16). It is 
>> calculated by the BooleanQuery by getting the sum of 
>> sumOfSquaredWeights() of each DMQuery. And here is the problem. The 
>> idf of the STQuery (or a TermQuery) used to elaborate the weight is 
>> very high for a Term not present (that is on purpose) Unfortunately 
>> the DMQuery takes the highest idf (assuming tie=0.0) from all clauses.
>>
>> By concept for the whole dismax query the chance that there will be a 
>> Term not found in a concrete DMQuery is near 100%, especially if you 
>> search across many fields. Thus, the idf of a DMQuery is almost 
>> always equal to a Termquery which term will not be found. But For 
>> scoring only the clause of the DMQuery that hit will be taken into 
>> account. This leads to too small scores!
>>
>> What I think would be the correct idf for a DMQuery with pure 
>> TermQueries would be rather something like
>>
>> if any term matches
>>     take the highest (plus tiestuff) idf from these clauses,
>> else
>>     take the highest idf
>>
>> Unfortunately, when calculating sumOfSquaredWeights(), the idf is 
>> already calculated in a general correct way and I do not see a way to 
>> to know in 
>> DisjunctionMaxQuery.DisjunctionMaxWeight.sumOfSquaredWeights() 
>> whether a returned currentWeight.sumOfSquaredWeights() comes from a 
>> TermQuery which only term has a df of 0?
>>
>> How to solve this problem to get a "better" sumOfSquaredWeights() 
>> from DisMaxQuery? The current value does not reflect the intention of 
>> this query.
>>
>> Jan
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
> What is about this?
>
> public float sumOfSquaredWeights() throws IOException {
>     float min = Float.MAX_VALUE, sum = 0.0f;
>     for (Weight currentWeight : weights) {
>         float sub = currentWeight.sumOfSquaredWeights();
>         sum += sub;
>         min = Math.min(min, sub);
>     }
>     if (min == Float.MAX_VALUE) min=0.0f;
>     float boost = getBoost();
>     return (((sum - min) * tieBreakerMultiplier * 
> tieBreakerMultiplier) + min) * boost * boost;
> }
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
I tried it with this little wrapper class:

public class MinDisMaxQuery extends DisjunctionMaxQuery {

     private final float _tieBreakerMultiplier;

     protected class MinDisMaxWeight extends DisjunctionMaxWeight {

         public MinDisMaxWeight(Searcher pSearcher) throws IOException {
             super(pSearcher);
         }

         @Override
         public float sumOfSquaredWeights() throws IOException {
             float min = Float.MAX_VALUE, sum = 0.0f;
             for (Weight currentWeight : weights) {
                 float sub = currentWeight.sumOfSquaredWeights();
                 sum += sub;
                 min = Math.min(min, sub);
             }
             if (min == Float.MAX_VALUE) {
                 min = 0.0f;
             }
             float boost = getBoost();
             return (((sum - min) * _tieBreakerMultiplier * 
_tieBreakerMultiplier) + min) * boost * boost;
         }

     }

     public MinDisMaxQuery(float pTieBreakerMultiplier) {
         super(pTieBreakerMultiplier);
         _tieBreakerMultiplier = pTieBreakerMultiplier;
     }

     public MinDisMaxQuery(Collection<Query> pDisjuncts, float 
pTieBreakerMultiplier) {
         super(pDisjuncts, pTieBreakerMultiplier);
         _tieBreakerMultiplier = pTieBreakerMultiplier;
     }

     @Override
     public Weight createWeight(Searcher pSearcher) throws IOException {
         return new MinDisMaxWeight(pSearcher);
     }

}


might this be the better approach for DisMax? at least the scores coming 
now look very promising!


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47925-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 14:05:40 2010
Return-Path: <java-user-return-47925-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72235 invoked from network); 26 Nov 2010 14:05:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 14:05:39 -0000
Received: (qmail 93651 invoked by uid 500); 26 Nov 2010 14:05:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93521 invoked by uid 500); 26 Nov 2010 14:05:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93513 invoked by uid 99); 26 Nov 2010 14:05:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:05:36 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:05:31 +0000
Received: by qyk10 with SMTP id 10so2175472qyk.14
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 06:05:10 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=yT1AKSXzkHlTP+ns8TiB972/qE2NKQ/SkYMeOcmtcIc=;
        b=OPB7aLcw6kvTw02baEVGtMK6Btpm72rMlkAmJSmfmzDpjX0kd8gzSrOaRsBEB4ZZf3
         jyh8fKGo/0AV2Dt+dWu3ZVSdyqsSVy2FkA28fnFPfWkZ00rEFHkvdjMu4wqBPcy5m69Z
         h+2nAnhDpEKGPi4eyA45KLEzrzsM7CQjp9Rus=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Q1oRbOLZa4Yy9G9AyTAI5EwYcgZ+ZIHgMgr67hZzpWEHXYbqYM794CAwNVX9HzIY4G
         QG/8Vgm0nMlBVQWx0cNQIY21ijGo2/iP0MKQ8MbMrX2PCUnhO37STYouRpsBcnD8Y7c5
         FRzWXQqvtOcX1I09wAGPoMYih84kquSf8Kx3Y=
MIME-Version: 1.0
Received: by 10.229.79.212 with SMTP id q20mr1781466qck.272.1290780310600;
 Fri, 26 Nov 2010 06:05:10 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Fri, 26 Nov 2010 06:05:10 -0800 (PST)
In-Reply-To: <29187_1290755456_ZZh0c3XercuX7.00_4CEF5D7F.5010003@uni-bielefeld.de>
References: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
	<AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
	<29187_1290755456_ZZh0c3XercuX7.00_4CEF5D7F.5010003@uni-bielefeld.de>
Date: Fri, 26 Nov 2010 09:05:10 -0500
Message-ID: <AANLkTikoSoy1QwSqaDsiUZrBApFXSNmXo2O39BgVo0mj@mail.gmail.com>
Subject: Re: not indexing analyzed field
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636426bbfe57b910495f53580

--001636426bbfe57b910495f53580
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

So, you're using Solr, right? And have a custom analyzer? If that's the
case, Uwe pointed you in the right direction and I think everything may
be working fine, or at least as I'd expect.

Specifying stored=3D"true" puts a verbatim, unanalyzed copy of the data
in the index. When you display a field in a document (i.e. query
on *:*) the *stored* value is returned, *not* the results of analysis. The
stored
value has nothing to do with what's searched.

To see if I've got it right, go into the admin page of solr, click on
"schema browser",
and then the field dcdocid should have the MD5 in it. If that's true, then
Solr
is working as expected.

If the analyzed values were returned, humans would be in a world of hurt
since
all the transformations would be applied and results pages would have
gibberish.
Imagine applying lowercase and stemming to input for "Running on Empty",
your
display would be something like "run on empti".

And if you're doing pure lucene, you can see this by enumerating the terms
in your
dcdocid field.

Best
Erick

On Fri, Nov 26, 2010 at 2:10 AM, Bernd Fehling <
bernd.fehling@uni-bielefeld.de> wrote:

> Hi Erik,
>
> my evidence is that I load a single document into an empty index
> with a field "id" and a second field "dcdocid". The field "dcdocid"
> has the word "foo". This goes through my analyzer and changes to
> MD5 string which is then "acbd18db4cc2f85cedef654fccc4a4d8".
> After indexing and commit a search for *:* shows me "foo" for
> the field "dcdocid" and not my MD5.
>
> my fieldType:
> <fieldType name=3D"text_md" class=3D"solr.TextField" omitNorms=3D"true" >
>  <analyzer type=3D"index"
> class=3D"de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
> </fieldType>
>
> <!-- UNIQUE ID -->
> <field name=3D"id" type=3D"string" indexed=3D"true" stored=3D"true" requi=
red=3D"true"
> />
> <field name=3D"dcdocid" type=3D"text_md" indexed=3D"true" stored=3D"true"=
 />
> <copyField source=3D"id" dest=3D"dcdocid" />
>
> Using the debugger shows that the value in question is going
> through the TextMessageDigestAnalyzer and coming out as MD5
> but it is not as MD5 in the index.
>
> I also tried a filter but no success.
> So why is something that is analyzed (and the value has changed
> due to analysis) not stored with its new value in the index?
>
> Best regards,
> Bernd
>
>
> Am 25.11.2010 18:18, schrieb Erick Erickson:
> > What is your evidence that "the result never reaches the index?"
> >
> > Are you sure:
> > 1> you commit afterwards
> > 2> you reopen the underlying reader to see
> > 3> if you don't store the value for the field, how are you sure?
> > 4> If you search and don't find it, did you index it?
> >
> > First, I'd be sure the value in question is in the document just before
> > sending it to be added to your index to see if the value you think
> > is in there really is. Something like Document.get() and see if
> >
> > Best
> > Erick
> >
> > On Thu, Nov 25, 2010 at 8:08 AM, Bernd Fehling <
> > bernd.fehling@uni-bielefeld.de> wrote:
> >
> >> I used KeywordAnalyzer and KeywordTokenizer as templates for
> >> a new analyzer.
> >> The analyzer works fine but the result never reaches the index.
> >>
> >> My analyzer is called in "DocInverterPerField.processFields"
> >> with "stream.incrementToken()".
> >> ...
> >> try {
> >>    boolean hasMoreTokens =3D stream.incrementToken();
> >>
> >>    fieldState.attributeSource =3D stream;
> >>
> >>    OffsetAttribute offsetAttribute =3D
> >> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
> >>    PositionIncrementAttribute posIncrAttribute =3D
> >>
> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class)=
;
> >>
> >>    consumer.start(field);
> >> ...
> >>
> >> The result goes to "fieldState.attributeSource" but is not in "field".
> >> So "field.fieldsData" still has the old content before calling my
> >> analyzer. And when calling "consumer.start(field)" the old content
> >> is going to the index and not the new analyzed one.
> >> Does the analyzer has to care about "Fieldable field.fieldsData"
> >> or who is responsible for it?
> >>
> >> Regards
> >> Bernd
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> --
> *************************************************************
> Bernd Fehling                Universit=E4tsbibliothek Bielefeld
> Dipl.-Inform. (FH)                        Universit=E4tsstr. 25
> Tel. +49 521 106-4060                   Fax. +49 521 106-4052
> bernd.fehling@uni-bielefeld.de                33615 Bielefeld
>
> BASE - Bielefeld Academic Search Engine - www.base-search.net
> *************************************************************
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636426bbfe57b910495f53580--

From java-user-return-47926-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 14:19:16 2010
Return-Path: <java-user-return-47926-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76892 invoked from network); 26 Nov 2010 14:19:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 14:19:15 -0000
Received: (qmail 19172 invoked by uid 500); 26 Nov 2010 14:19:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18902 invoked by uid 500); 26 Nov 2010 14:19:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18894 invoked by uid 99); 26 Nov 2010 14:19:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:19:12 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of aminmc@gmail.com designates 74.125.82.42 as permitted sender)
Received: from [74.125.82.42] (HELO mail-ww0-f42.google.com) (74.125.82.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:19:03 +0000
Received: by wwb34 with SMTP id 34so647615wwb.5
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 06:18:43 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:content-type
         :content-transfer-encoding:subject:date:message-id:to:mime-version
         :x-mailer;
        bh=0tEFvssr2og0XgwIPl8J59FTOhCA38fBDw7RTH3owSg=;
        b=M5/kyqtD7ZWeTiQcAWmN5FtLguw/S//ibMJWQu/531zGvt/4n9OJYVIxeFMAHXM2qq
         MsPfuskZZnlngiv2AkDPUyOgv49eOHsjs3cd2IZmpbKVjNqDHore6a7Mcq/xbfZCnzcb
         jF/c2MqRSzuPeBkiCz6OmQuIym6907UKTRJYs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:content-type:content-transfer-encoding:subject:date:message-id
         :to:mime-version:x-mailer;
        b=FHRQ2wNw2QxJu/yBBY6ATJPkP585fI/NorDdUZziaED9t65HD3uIMXiF2eS1Ks/Wo0
         gEwRA6aVQJkgez9dCTzbx8RYI6xYNR3kdtR7kEnQO25x4lM+s9Wt/EQ/n9bZ2adD4Ko4
         sglnU4hyh8oN6KYfVqWxPlcyNI+oDCcZab+nc=
Received: by 10.216.7.8 with SMTP id 8mr243930weo.30.1290781122724;
        Fri, 26 Nov 2010 06:18:42 -0800 (PST)
Received: from [192.168.1.90] (host86-156-93-172.range86-156.btcentralplus.com [86.156.93.172])
        by mx.google.com with ESMTPS id l51sm942487wer.2.2010.11.26.06.18.41
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 26 Nov 2010 06:18:41 -0800 (PST)
From: Amin Mohammed-Coleman <aminmc@gmail.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Subject: TermRangeQuery
Date: Fri, 26 Nov 2010 14:18:39 +0000
Message-Id: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1082)
X-Mailer: Apple Mail (2.1082)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi All

I was wondering whether I can use TermRangeQuery for my use case.  I =
have a collection of ids (represented as XDF-123) and I would like to do =
a search for all the ids (might be in the range of 10000) and for each =
matching id I want to get the corresponding data that is stored in the =
index (for example the document contains id and string value).  I am =
using a custom collector to collect that string value for each match.  =
Is it ok to use a TermRangeQuery for the ids rather than creating a =
massive query string?


Thanks
Amin=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47927-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 14:28:19 2010
Return-Path: <java-user-return-47927-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80591 invoked from network); 26 Nov 2010 14:28:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 14:28:18 -0000
Received: (qmail 42197 invoked by uid 500); 26 Nov 2010 14:28:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41870 invoked by uid 500); 26 Nov 2010 14:28:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41853 invoked by uid 99); 26 Nov 2010 14:28:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:28:15 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:28:11 +0000
Received: by fxm2 with SMTP id 2so1690845fxm.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 06:27:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        bh=BtG2TMVsepj8m7InSBD3oeIfRs2YLTnhd/H69AZnrWg=;
        b=Fn+e1GMUftip6qTYli4usVsq1swmvGdIZwuR4CeR9DVUt2efj9pkKEXdxPcwNndwTh
         uNuJlQSCQnl9mJdOMR6TK1SAtPCo4TuCFzoLwPpCVCrzlS52CAS9f2QKeiWVn+H2tS3s
         cDa0wyP1SD2Nc2JkpQlUdJ/aEnMtVDnS6+ARc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type;
        b=uke/MZB49Fj8wq6t7HPJlakVQe383pVGBsxNoPUXEOpD2Hp7nTrvabClrYHLWYV07I
         8YVZaQ5w/vTbcLYv9Tk8mjPrvhSyFTYsjlYDmYXfl7iZwW3+oPg0/Gm1ufxbCpCwtQFh
         5prAoV0XZjqANxq/2aGEkOKcNt+5QcHwSX0mA=
MIME-Version: 1.0
Received: by 10.223.79.4 with SMTP id n4mr2154571fak.69.1290781669718; Fri, 26
 Nov 2010 06:27:49 -0800 (PST)
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.74.202 with HTTP; Fri, 26 Nov 2010 06:27:49 -0800 (PST)
In-Reply-To: <011001cb8a6d$900de850$b029b8f0$@thetaphi.de>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>
	<AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
	<010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de>
	<AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>
	<011001cb8a6d$900de850$b029b8f0$@thetaphi.de>
Date: Fri, 26 Nov 2010 09:27:49 -0500
X-Google-Sender-Auth: s-abi_YcWXiwVtz3L34cNVCl9sw
Message-ID: <AANLkTi=kxH+Dgwk1FwBjGEiMfbLXyrOWJqUspmUt6M2k@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org, Uwe Schindler <uwe@thetaphi.de>
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Nov 22, 2010 at 12:49 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>  (Fuzzy scores on
> MultiSearcher and Solr are totally wrong because each shard uses another
> rewritten query).

Hmmm, really?  I thought that fuzzy scoring should just rely on edit distance?
Oh wait, I think I see - it's because we can use a hard cutoff for the
number of expansions rather than an edit distance cutoff.  If we used
the latter, everything should be fine?

The fuzzy issue I would classify as "working as designed".  Either
that, or classify FuzzyQuery as broken.  A cuttoff based on number of
terms will yield strange results even on a single index.  Consider
this scenario: it's possible to add more docs to a single index and
have the same fuzzy query return fewer docs than it did before!

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47928-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 14:40:39 2010
Return-Path: <java-user-return-47928-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84670 invoked from network); 26 Nov 2010 14:40:38 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 14:40:38 -0000
Received: (qmail 60935 invoked by uid 500); 26 Nov 2010 14:40:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60648 invoked by uid 500); 26 Nov 2010 14:40:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60640 invoked by uid 99); 26 Nov 2010 14:40:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:40:36 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:40:28 +0000
Received: by bwz9 with SMTP id 9so2067416bwz.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 06:40:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=K35o7CmYMUD3oRyq+aowWr9t6DU8xK3uspEHQ5ZfD5o=;
        b=PKLxg6Rw47GWrwhqZxVaYoto6CL9Tb4Eo8pHei0/ccncTWgXj5lTD/toJKYKGMx3PF
         BP7kdzubD/PRkvLbUWdMrFc7NA7vrqalxPpfvyjVV/4uLJLgtj4/7TkL9/BDKQCCNGuY
         1BVQzCPTIgNosdIRXFqtssO8OyMT66wnVkhiM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=TdhBq7Cb0IiClEU+3WllRKrUuvuW8zgr3388ThTZYgsRcjw2lJugS/fG9FChjIB+FK
         c3P29S1FoFZN1dJKIfnFzoRbBVCXA3XI2jOMA92CKdPMJhutR8brzz904rZ7r9meZle3
         mbw71mF3t71626T88uvPaW7D1LNJggvMI2rSg=
Received: by 10.204.103.66 with SMTP id j2mr1970925bko.160.1290782407623; Fri,
 26 Nov 2010 06:40:07 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Fri, 26 Nov 2010 06:39:47 -0800 (PST)
In-Reply-To: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 26 Nov 2010 14:39:47 +0000
Message-ID: <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
Subject: Re: TermRangeQuery
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Absolutely, as long as your ids will sort as you expect.

I'm not clear what you mean by XDF-123 but if you've got

AAA-123
AAA-124
...
ABC-123
ABC-234
etc.

then you'll be fine.  If they don't sort so neatly you can use the
TermRangeQuery constructor that takes a Collator but note the
performance warning in the javadocs.


--
Ian.


On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman <aminmc@gmail.com> w=
rote:
> Hi All
>
> I was wondering whether I can use TermRangeQuery for my use case. =A0I ha=
ve a collection of ids (represented as XDF-123) and I would like to do a se=
arch for all the ids (might be in the range of 10000) and for each matching=
 id I want to get the corresponding data that is stored in the index (for e=
xample the document contains id and string value). =A0I am using a custom c=
ollector to collect that string value for each match. =A0Is it ok to use a =
TermRangeQuery for the ids rather than creating a massive query string?
>
>
> Thanks
> Amin
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47929-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 14:55:11 2010
Return-Path: <java-user-return-47929-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89999 invoked from network); 26 Nov 2010 14:55:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 14:55:11 -0000
Received: (qmail 79617 invoked by uid 500); 26 Nov 2010 14:55:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79362 invoked by uid 500); 26 Nov 2010 14:55:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79354 invoked by uid 99); 26 Nov 2010 14:55:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:55:08 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of bernd.fehling@uni-bielefeld.de designates 129.70.204.65 as permitted sender)
Received: from [129.70.204.65] (HELO mux1-unibi-smtp.hrz.uni-bielefeld.de) (129.70.204.65)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 14:55:01 +0000
MIME-version: 1.0
Content-transfer-encoding: 7BIT
Content-type: text/plain; charset=ISO-8859-1
Received: from pmxchannel-daemon.mux1-unibi-smtp.hrz.uni-bielefeld.de by
 mux1-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 id <0LCH00800YR3HC00@mux1-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Fri, 26 Nov 2010 15:54:39 +0100 (CET)
Received: from [129.70.11.68] ([129.70.11.68])
 by mux1-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 with ESMTPPSA id <0LCH00MHPYR29180@mux1-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Fri, 26 Nov 2010 15:54:38 +0100 (CET)
Date: Fri, 26 Nov 2010 15:54:37 +0100
From: Bernd Fehling <bernd.fehling@uni-bielefeld.de>
Subject: Re: not indexing analyzed field
In-reply-to: <AANLkTikoSoy1QwSqaDsiUZrBApFXSNmXo2O39BgVo0mj@mail.gmail.com>
To: java-user@lucene.apache.org
Message-id:
 <24363_1290783279_ZZh0c7Zm_2~z1.00_4CEFCA2D.4060602@uni-bielefeld.de>
X-EnvFrom: bernd.fehling@uni-bielefeld.de
X-PMX-Version: 5.5.9.395186, Antispam-Engine: 2.7.2.376379,
 Antispam-Data: 2010.11.26.143915, pmx8
X-Connecting-IP: 129.70.11.68
References:
 <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
 <AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
 <29187_1290755456_ZZh0c3XercuX7.00_4CEF5D7F.5010003@uni-bielefeld.de>
 <AANLkTikoSoy1QwSqaDsiUZrBApFXSNmXo2O39BgVo0mj@mail.gmail.com>
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.1.15) Gecko/20101026
 SUSE/3.0.10 Thunderbird/3.0.10

Hi Erik,

I see my problem, caused by a misunderstanding of the indexing by lucene.
I guess its due to the fact that FAST Data Search has real processing pipelines.

Youre right I use Solr but, as a matter of fact, in this special case
I really want to change the indexed _and_ stored data.
For security reasons I have to MD5 or even better SHA256 strings which
go into a field. So where is the sense if I SHA256 the string but
still display the plain text of the stored field?

So the Analyzer or Filter should MessageDigest the content and index and
store it as MessageDigest.

Can this be achived somehow with Analyzer or Filter,
what is your opinion?

May be a hint which classes to use?

Kind regards,
Bernd



Am 26.11.2010 15:05, schrieb Erick Erickson:
> So, you're using Solr, right? And have a custom analyzer? If that's the
> case, Uwe pointed you in the right direction and I think everything may
> be working fine, or at least as I'd expect.
> 
> Specifying stored="true" puts a verbatim, unanalyzed copy of the data
> in the index. When you display a field in a document (i.e. query
> on *:*) the *stored* value is returned, *not* the results of analysis. The
> stored
> value has nothing to do with what's searched.
> 
> To see if I've got it right, go into the admin page of solr, click on
> "schema browser",
> and then the field dcdocid should have the MD5 in it. If that's true, then
> Solr
> is working as expected.
> 
> If the analyzed values were returned, humans would be in a world of hurt
> since
> all the transformations would be applied and results pages would have
> gibberish.
> Imagine applying lowercase and stemming to input for "Running on Empty",
> your
> display would be something like "run on empti".
> 
> And if you're doing pure lucene, you can see this by enumerating the terms
> in your
> dcdocid field.
> 
> Best
> Erick
> 
> On Fri, Nov 26, 2010 at 2:10 AM, Bernd Fehling <
> bernd.fehling@uni-bielefeld.de> wrote:
> 
>> Hi Erik,
>>
>> my evidence is that I load a single document into an empty index
>> with a field "id" and a second field "dcdocid". The field "dcdocid"
>> has the word "foo". This goes through my analyzer and changes to
>> MD5 string which is then "acbd18db4cc2f85cedef654fccc4a4d8".
>> After indexing and commit a search for *:* shows me "foo" for
>> the field "dcdocid" and not my MD5.
>>
>> my fieldType:
>> <fieldType name="text_md" class="solr.TextField" omitNorms="true" >
>>  <analyzer type="index"
>> class="de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
>> </fieldType>
>>
>> <!-- UNIQUE ID -->
>> <field name="id" type="string" indexed="true" stored="true" required="true"
>> />
>> <field name="dcdocid" type="text_md" indexed="true" stored="true" />
>> <copyField source="id" dest="dcdocid" />
>>
>> Using the debugger shows that the value in question is going
>> through the TextMessageDigestAnalyzer and coming out as MD5
>> but it is not as MD5 in the index.
>>
>> I also tried a filter but no success.
>> So why is something that is analyzed (and the value has changed
>> due to analysis) not stored with its new value in the index?
>>
>> Best regards,
>> Bernd
>>
>>
>> Am 25.11.2010 18:18, schrieb Erick Erickson:
>>> What is your evidence that "the result never reaches the index?"
>>>
>>> Are you sure:
>>> 1> you commit afterwards
>>> 2> you reopen the underlying reader to see
>>> 3> if you don't store the value for the field, how are you sure?
>>> 4> If you search and don't find it, did you index it?
>>>
>>> First, I'd be sure the value in question is in the document just before
>>> sending it to be added to your index to see if the value you think
>>> is in there really is. Something like Document.get() and see if
>>>
>>> Best
>>> Erick
>>>
>>> On Thu, Nov 25, 2010 at 8:08 AM, Bernd Fehling <
>>> bernd.fehling@uni-bielefeld.de> wrote:
>>>
>>>> I used KeywordAnalyzer and KeywordTokenizer as templates for
>>>> a new analyzer.
>>>> The analyzer works fine but the result never reaches the index.
>>>>
>>>> My analyzer is called in "DocInverterPerField.processFields"
>>>> with "stream.incrementToken()".
>>>> ...
>>>> try {
>>>>    boolean hasMoreTokens = stream.incrementToken();
>>>>
>>>>    fieldState.attributeSource = stream;
>>>>
>>>>    OffsetAttribute offsetAttribute =
>>>> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
>>>>    PositionIncrementAttribute posIncrAttribute =
>>>>
>> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);
>>>>
>>>>    consumer.start(field);
>>>> ...
>>>>
>>>> The result goes to "fieldState.attributeSource" but is not in "field".
>>>> So "field.fieldsData" still has the old content before calling my
>>>> analyzer. And when calling "consumer.start(field)" the old content
>>>> is going to the index and not the new analyzed one.
>>>> Does the analyzer has to care about "Fieldable field.fieldsData"
>>>> or who is responsible for it?
>>>>
>>>> Regards
>>>> Bernd
>>>>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47930-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 15:04:15 2010
Return-Path: <java-user-return-47930-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92711 invoked from network); 26 Nov 2010 15:04:15 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 15:04:15 -0000
Received: (qmail 90204 invoked by uid 500); 26 Nov 2010 15:04:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90042 invoked by uid 500); 26 Nov 2010 15:04:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90034 invoked by uid 99); 26 Nov 2010 15:04:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 15:04:11 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of aminmc@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 15:04:02 +0000
Received: by wyf28 with SMTP id 28so2232851wyf.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 07:03:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:content-transfer-encoding:message-id
         :references:to:x-mailer;
        bh=sm4a9HrdmIpCxXmMaBIJ+wlDNgeKnTNlr+Bi5xpRr+0=;
        b=FywbOx3O2IIkngS7EsEZOgTYexmbHnY+HZv39U3fPWqRSqp5e1UfBazXglgpiqo1DJ
         NrrWdp/v645lYtXnKZnwkAb3PrHHcm+2DNK0K++QAayeLT5xai2GHTW5gGd2WgOFHMaS
         nfG81iEG8gPg13mqoM8WjDpLcS8RpHhtYtmNg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=Id+tf+Khx1hgqt1Q9oOQzCiKLIeJHlFMy+CpJZmo98siUx2P90ZFT9pcgeA+89w7uU
         CY46bBm93ISiWCGECSEeOnE2iPG6Ono+kkGNn6rgm4UjhBQJyWPTT2oXFE9xGV/fMVRJ
         r5NTccg6fklsOYXF+V0sPAsFyYr8d94QQKjOs=
Received: by 10.227.39.210 with SMTP id h18mr2508244wbe.75.1290783822126;
        Fri, 26 Nov 2010 07:03:42 -0800 (PST)
Received: from [192.168.1.90] (host86-156-93-172.range86-156.btcentralplus.com [86.156.93.172])
        by mx.google.com with ESMTPS id b30sm1382321wbb.10.2010.11.26.07.03.40
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 26 Nov 2010 07:03:41 -0800 (PST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: TermRangeQuery
From: Amin Mohammed-Coleman <aminmc@gmail.com>
In-Reply-To: <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
Date: Fri, 26 Nov 2010 15:03:39 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <92FDD0C2-6BEA-4CAD-A2FD-B5DDD7A43A78@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com> <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1082)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi

Basically test my ids look like:

AAA-231
AAD-234
ADD-123

Didn't now about the collator, i was going to do a custom sort based on =
the number part of the id.


Thanks
Amin

On 26 Nov 2010, at 14:39, Ian Lea wrote:

> Absolutely, as long as your ids will sort as you expect.
>=20
> I'm not clear what you mean by XDF-123 but if you've got
>=20
> AAA-123
> AAA-124
> ...
> ABC-123
> ABC-234
> etc.
>=20
> then you'll be fine.  If they don't sort so neatly you can use the
> TermRangeQuery constructor that takes a Collator but note the
> performance warning in the javadocs.
>=20
>=20
> --
> Ian.
>=20
>=20
> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman =
<aminmc@gmail.com> wrote:
>> Hi All
>>=20
>> I was wondering whether I can use TermRangeQuery for my use case.  I =
have a collection of ids (represented as XDF-123) and I would like to do =
a search for all the ids (might be in the range of 10000) and for each =
matching id I want to get the corresponding data that is stored in the =
index (for example the document contains id and string value).  I am =
using a custom collector to collect that string value for each match.  =
Is it ok to use a TermRangeQuery for the ids rather than creating a =
massive query string?
>>=20
>>=20
>> Thanks
>> Amin
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47931-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 16:28:19 2010
Return-Path: <java-user-return-47931-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29821 invoked from network); 26 Nov 2010 16:28:19 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 16:28:19 -0000
Received: (qmail 78182 invoked by uid 500); 26 Nov 2010 16:28:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77903 invoked by uid 500); 26 Nov 2010 16:28:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77895 invoked by uid 99); 26 Nov 2010 16:28:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 16:28:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.212.48 as permitted sender)
Received: from [209.85.212.48] (HELO mail-vw0-f48.google.com) (209.85.212.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 16:28:05 +0000
Received: by vws18 with SMTP id 18so640049vws.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 08:27:44 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=TGr/XjVq8ifmmovfBQsPC3HIyCplbpcr4/V0FgGlXSQ=;
        b=YtT0DZLW2bT+QLo00Cy+t2XPXJizqOEFJFZoM9CGybbK0jahGEjuuZzlD9gGg0urSQ
         11AT4iqr8dIG2X16bvOGQeX8+vhxAgo2VI9NKUw/jOsSSupvGrz/htj5+aPtTmCSIvLV
         DN4XSazFh3mMFBE4LCCpWqFK3qKTI7EOvITGQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=qYEkegGUP24DPq3PF26OD5vOwto3Ju4xzmLaqd1AJz+wgCa4NUkT2dJw3JIw3JECRC
         dTABxqIRmf142x4eZo54VwdLD9z/r6w77VHxs2Jc88BPvPaPgq2jLY7oC4zHVmMh7yv8
         cf0Xs6js2nt80q1c3ELAb4WdRI+15xcCuQmLk=
MIME-Version: 1.0
Received: by 10.229.100.76 with SMTP id x12mr1972642qcn.6.1290788864412; Fri,
 26 Nov 2010 08:27:44 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Fri, 26 Nov 2010 08:27:44 -0800 (PST)
In-Reply-To: <24363_1290783279_ZZh0c7Zm_2~z1.00_4CEFCA2D.4060602@uni-bielefeld.de>
References: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
	<AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
	<29187_1290755456_ZZh0c3XercuX7.00_4CEF5D7F.5010003@uni-bielefeld.de>
	<AANLkTikoSoy1QwSqaDsiUZrBApFXSNmXo2O39BgVo0mj@mail.gmail.com>
	<24363_1290783279_ZZh0c7Zm_2~z1.00_4CEFCA2D.4060602@uni-bielefeld.de>
Date: Fri, 26 Nov 2010 11:27:44 -0500
Message-ID: <AANLkTimsP22y_YGp=Y8Sbtx7Wrf9=guFrs6o_DEzz-kX@mail.gmail.com>
Subject: Re: not indexing analyzed field
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364eea8abe50210495f73377
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364eea8abe50210495f73377
Content-Type: text/plain; charset=ISO-8859-1

Can you "define the problem away"? That is, why do you want to store it at
all?
If there's no value to the users in seeing the encoded value, just don't
store it.
You can still search on the encoded value if in that case....

Which is a way of saying that I don't know, off the top of my head, how
you'd
index one thing and store the result of analysis...

Best
Erick

On Fri, Nov 26, 2010 at 9:54 AM, Bernd Fehling <
bernd.fehling@uni-bielefeld.de> wrote:

> Hi Erik,
>
> I see my problem, caused by a misunderstanding of the indexing by lucene.
> I guess its due to the fact that FAST Data Search has real processing
> pipelines.
>
> Youre right I use Solr but, as a matter of fact, in this special case
> I really want to change the indexed _and_ stored data.
> For security reasons I have to MD5 or even better SHA256 strings which
> go into a field. So where is the sense if I SHA256 the string but
> still display the plain text of the stored field?
>
> So the Analyzer or Filter should MessageDigest the content and index and
> store it as MessageDigest.
>
> Can this be achived somehow with Analyzer or Filter,
> what is your opinion?
>
> May be a hint which classes to use?
>
> Kind regards,
> Bernd
>
>
>
> Am 26.11.2010 15:05, schrieb Erick Erickson:
> > So, you're using Solr, right? And have a custom analyzer? If that's the
> > case, Uwe pointed you in the right direction and I think everything may
> > be working fine, or at least as I'd expect.
> >
> > Specifying stored="true" puts a verbatim, unanalyzed copy of the data
> > in the index. When you display a field in a document (i.e. query
> > on *:*) the *stored* value is returned, *not* the results of analysis.
> The
> > stored
> > value has nothing to do with what's searched.
> >
> > To see if I've got it right, go into the admin page of solr, click on
> > "schema browser",
> > and then the field dcdocid should have the MD5 in it. If that's true,
> then
> > Solr
> > is working as expected.
> >
> > If the analyzed values were returned, humans would be in a world of hurt
> > since
> > all the transformations would be applied and results pages would have
> > gibberish.
> > Imagine applying lowercase and stemming to input for "Running on Empty",
> > your
> > display would be something like "run on empti".
> >
> > And if you're doing pure lucene, you can see this by enumerating the
> terms
> > in your
> > dcdocid field.
> >
> > Best
> > Erick
> >
> > On Fri, Nov 26, 2010 at 2:10 AM, Bernd Fehling <
> > bernd.fehling@uni-bielefeld.de> wrote:
> >
> >> Hi Erik,
> >>
> >> my evidence is that I load a single document into an empty index
> >> with a field "id" and a second field "dcdocid". The field "dcdocid"
> >> has the word "foo". This goes through my analyzer and changes to
> >> MD5 string which is then "acbd18db4cc2f85cedef654fccc4a4d8".
> >> After indexing and commit a search for *:* shows me "foo" for
> >> the field "dcdocid" and not my MD5.
> >>
> >> my fieldType:
> >> <fieldType name="text_md" class="solr.TextField" omitNorms="true" >
> >>  <analyzer type="index"
> >> class="de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
> >> </fieldType>
> >>
> >> <!-- UNIQUE ID -->
> >> <field name="id" type="string" indexed="true" stored="true"
> required="true"
> >> />
> >> <field name="dcdocid" type="text_md" indexed="true" stored="true" />
> >> <copyField source="id" dest="dcdocid" />
> >>
> >> Using the debugger shows that the value in question is going
> >> through the TextMessageDigestAnalyzer and coming out as MD5
> >> but it is not as MD5 in the index.
> >>
> >> I also tried a filter but no success.
> >> So why is something that is analyzed (and the value has changed
> >> due to analysis) not stored with its new value in the index?
> >>
> >> Best regards,
> >> Bernd
> >>
> >>
> >> Am 25.11.2010 18:18, schrieb Erick Erickson:
> >>> What is your evidence that "the result never reaches the index?"
> >>>
> >>> Are you sure:
> >>> 1> you commit afterwards
> >>> 2> you reopen the underlying reader to see
> >>> 3> if you don't store the value for the field, how are you sure?
> >>> 4> If you search and don't find it, did you index it?
> >>>
> >>> First, I'd be sure the value in question is in the document just before
> >>> sending it to be added to your index to see if the value you think
> >>> is in there really is. Something like Document.get() and see if
> >>>
> >>> Best
> >>> Erick
> >>>
> >>> On Thu, Nov 25, 2010 at 8:08 AM, Bernd Fehling <
> >>> bernd.fehling@uni-bielefeld.de> wrote:
> >>>
> >>>> I used KeywordAnalyzer and KeywordTokenizer as templates for
> >>>> a new analyzer.
> >>>> The analyzer works fine but the result never reaches the index.
> >>>>
> >>>> My analyzer is called in "DocInverterPerField.processFields"
> >>>> with "stream.incrementToken()".
> >>>> ...
> >>>> try {
> >>>>    boolean hasMoreTokens = stream.incrementToken();
> >>>>
> >>>>    fieldState.attributeSource = stream;
> >>>>
> >>>>    OffsetAttribute offsetAttribute =
> >>>> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
> >>>>    PositionIncrementAttribute posIncrAttribute =
> >>>>
> >>
> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.class);
> >>>>
> >>>>    consumer.start(field);
> >>>> ...
> >>>>
> >>>> The result goes to "fieldState.attributeSource" but is not in "field".
> >>>> So "field.fieldsData" still has the old content before calling my
> >>>> analyzer. And when calling "consumer.start(field)" the old content
> >>>> is going to the index and not the new analyzed one.
> >>>> Does the analyzer has to care about "Fieldable field.fieldsData"
> >>>> or who is responsible for it?
> >>>>
> >>>> Regards
> >>>> Bernd
> >>>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364eea8abe50210495f73377--

From java-user-return-47932-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 16:35:03 2010
Return-Path: <java-user-return-47932-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31514 invoked from network); 26 Nov 2010 16:35:02 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 16:35:02 -0000
Received: (qmail 89934 invoked by uid 500); 26 Nov 2010 16:35:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89653 invoked by uid 500); 26 Nov 2010 16:34:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89645 invoked by uid 99); 26 Nov 2010 16:34:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 16:34:57 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of aminmc@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 16:34:48 +0000
Received: by wyf28 with SMTP id 28so2320102wyf.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 08:34:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:content-transfer-encoding:message-id
         :references:to:x-mailer;
        bh=ZIAH40lFvxoJXxNWOFqPk+6cQe1zl9iKZtq55WoMN0A=;
        b=CC+dfnqS3IWy2wMs8WkY6sO90Q04dypkyP9shqkdgEYAob6RCDOO62BYjNl6GXn6vE
         h1cNkcdVTcoYfS2C7xHoK/CDFuWRAcr1C4vuJ3N4vCZca4ncpkM894ynUVExpIXGwMdb
         Vd7Sjzw4LZvDIjVi+jw16rxb1lLFdykrMtc20=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=cR5qBEXByjK6m0Zd9SD9f/GLWyDwD5nZ/r3e70WZg5Cx1xFMxhedFwVWORB85d6h4K
         tZOSQjzIS7P3qQ/wSJ2kjyJXDnN9iRbonbqGAK4N/YxLtMmPudCmc1gnFoYFhXkI8LWy
         1csOTn9Mt6XGq/hPyVyCo4C648DyB9/T2Rv9k=
Received: by 10.227.134.206 with SMTP id k14mr2607792wbt.160.1290789267296;
        Fri, 26 Nov 2010 08:34:27 -0800 (PST)
Received: from [192.168.1.90] (host86-156-93-172.range86-156.btcentralplus.com [86.156.93.172])
        by mx.google.com with ESMTPS id x23sm1014146weq.10.2010.11.26.08.34.25
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 26 Nov 2010 08:34:26 -0800 (PST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: TermRangeQuery
From: Amin Mohammed-Coleman <aminmc@gmail.com>
In-Reply-To: <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
Date: Fri, 26 Nov 2010 16:34:24 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com> <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1082)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi

Unfortunately my range query approach did not work.   It seems to be =
related to the ids themselves.  The list has ids that look this:


ID-NYC-1234
ID-LND-1234
TX-NYC-1334
TX-NYC-BBC-123

The ids may range from 90 to 1000.  Is there another approach I could =
take?  I tried building a string with all the ids and set them against a =
field for example:

dataId: ID-NYC-123 dataId: ID-NYC-1234....

but that's not a great approach I know...

any help would be appreciated.

Thanks
Amin



On 26 Nov 2010, at 14:39, Ian Lea wrote:

> Absolutely, as long as your ids will sort as you expect.
>=20
> I'm not clear what you mean by XDF-123 but if you've got
>=20
> AAA-123
> AAA-124
> ...
> ABC-123
> ABC-234
> etc.
>=20
> then you'll be fine.  If they don't sort so neatly you can use the
> TermRangeQuery constructor that takes a Collator but note the
> performance warning in the javadocs.
>=20
>=20
> --
> Ian.
>=20
>=20
> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman =
<aminmc@gmail.com> wrote:
>> Hi All
>>=20
>> I was wondering whether I can use TermRangeQuery for my use case.  I =
have a collection of ids (represented as XDF-123) and I would like to do =
a search for all the ids (might be in the range of 10000) and for each =
matching id I want to get the corresponding data that is stored in the =
index (for example the document contains id and string value).  I am =
using a custom collector to collect that string value for each match.  =
Is it ok to use a TermRangeQuery for the ids rather than creating a =
massive query string?
>>=20
>>=20
>> Thanks
>> Amin
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47933-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 17:49:57 2010
Return-Path: <java-user-return-47933-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57370 invoked from network); 26 Nov 2010 17:49:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 17:49:57 -0000
Received: (qmail 66958 invoked by uid 500); 26 Nov 2010 17:49:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66916 invoked by uid 500); 26 Nov 2010 17:49:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66908 invoked by uid 99); 26 Nov 2010 17:49:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 17:49:53 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 17:49:48 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 957BC45FE72;
	Fri, 26 Nov 2010 18:49:24 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id hG5nChlYKFNF; Fri, 26 Nov 2010 18:49:19 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 84A8845FE3C;
	Fri, 26 Nov 2010 18:49:18 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <yonik@lucidimagination.com>,
	<java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>	<AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>	<AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>	<E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>	<AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>	<E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>	<00e401cb8a60$f390d5c0$dab28140$@thetaphi.de>	<AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>	<010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de>	<AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>	<011001cb8a6d$900de850$b029b8f0$@thetaphi.de> <AANLkTi=kxH+Dgwk1FwBjGEiMfbLXyrOWJqUspmUt6M2k@mail.gmail.com>
In-Reply-To: <AANLkTi=kxH+Dgwk1FwBjGEiMfbLXyrOWJqUspmUt6M2k@mail.gmail.com>
Subject: RE: best practice: 1.4 billions documents
Date: Fri, 26 Nov 2010 18:49:46 +0100
Message-ID: <007f01cb8d92$50f2c460$f2d84d20$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
thread-index: AQHhYFvo3/M6gIf4T+1hOFRnD2ErSgGenclxAYTZujQDQu3A9AMpE27/Am+iCAkCKnrzXAGCgulzAuZoJLICxKvBZgG2G2xGAe479xeSkIR6UA==
Content-Language: de

This is the problem for Fuzzy: each searcher expands the fuzzy query to a
different Boolean Query and so the scores are not comparable - MultiSearcher
(but not Solr) tries to combine the resulting rewritten queries into one
query, so every searcher has the same query.

And here starts the second bug: If one of the clauses of a BQ are negative
MTQs (MUST_NOT), then the result is wrong - and this is not fixable as it
not only affects BQ. Also MTQs that rewrite to Span (like the new
SpanOrWrapper) are totally wrong combined. The problem is that the negative
clauses are only correct for the searcher they were created for. If you pass
the rewritten query to another searcher (what MultiSearcher does) it may not
exclude all needed documents, because some TermQueries or whatever are
missing (because the got no term hit in the first searcher). The combine
method is too stupid and does not handle that correctly.

And the latter is the big problem:
https://issues.apache.org/jira/browse/LUCENE-2756 (sorry the issue is not
filled with all necessary information, as Robert an Me had lots of sleepless
nights and discussions and tests done and came to the final answer: It's
unfixable :( for all queries)

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: yseeley@gmail.com [mailto:yseeley@gmail.com] On Behalf Of Yonik
> Seeley
> Sent: Friday, November 26, 2010 3:28 PM
> To: java-user@lucene.apache.org; Uwe Schindler
> Subject: Re: best practice: 1.4 billions documents
> 
> On Mon, Nov 22, 2010 at 12:49 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> >  (Fuzzy scores on
> > MultiSearcher and Solr are totally wrong because each shard uses
> > another rewritten query).
> 
> Hmmm, really?  I thought that fuzzy scoring should just rely on edit
distance?
> Oh wait, I think I see - it's because we can use a hard cutoff for the
number of
> expansions rather than an edit distance cutoff.  If we used the latter,
everything
> should be fine?
> 
> The fuzzy issue I would classify as "working as designed".  Either that,
or classify
> FuzzyQuery as broken.  A cuttoff based on number of terms will yield
strange
> results even on a single index.  Consider this scenario: it's possible to
add more
> docs to a single index and have the same fuzzy query return fewer docs
than it
> did before!
> 
> -Yonik
> http://www.lucidimagination.com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47934-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 19:59:37 2010
Return-Path: <java-user-return-47934-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12333 invoked from network); 26 Nov 2010 19:59:37 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 19:59:37 -0000
Received: (qmail 72963 invoked by uid 500); 26 Nov 2010 19:59:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72834 invoked by uid 500); 26 Nov 2010 19:59:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72826 invoked by uid 99); 26 Nov 2010 19:59:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 19:59:34 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 19:59:29 +0000
Received: by bwz9 with SMTP id 9so2352405bwz.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 11:59:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=eHjW63BAMGRHRly6a1G8xtjxAXG9SGUyg+Xp12LeGUo=;
        b=WBOqqMihGyw3cnhoXUjA/8+9/OLejs7aE1TizoUaRAk1r7pTw6WzTTaNu/0thB0rKG
         p4YewcstiBcTw0Wdl/6uYbZ+nUv4x7xsegIu+DpPjfUwntcgaFK3c7d64KEeIW1bIuPw
         Tc6SFarEYP045Xcf6etqkfJw3z2cDAcP5pOBM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=WYLFf5gVBAscry8z0a0KS6F8WCCAoeB3hZC6nhoWsp0N3U7ZTEcvLkytykCkl0sg3H
         I1lBayjzRtSr/RXtE1OuDlu9EiR6+o9gQbuKOtDEQ7yjQ1zx822rQ9Sg6v8SPbrk4/Q7
         Q3pIkxR/C3ckEZnDBj4hazSRhm8Bph83DTBZQ=
Received: by 10.204.120.130 with SMTP id d2mr2238255bkr.214.1290801548327;
 Fri, 26 Nov 2010 11:59:08 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Fri, 26 Nov 2010 11:58:47 -0800 (PST)
In-Reply-To: <007f01cb8d92$50f2c460$f2d84d20$@thetaphi.de>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
 <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
 <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
 <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
 <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
 <010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de> <AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>
 <011001cb8a6d$900de850$b029b8f0$@thetaphi.de> <AANLkTi=kxH+Dgwk1FwBjGEiMfbLXyrOWJqUspmUt6M2k@mail.gmail.com>
 <007f01cb8d92$50f2c460$f2d84d20$@thetaphi.de>
From: Robert Muir <rcmuir@gmail.com>
Date: Fri, 26 Nov 2010 14:58:47 -0500
Message-ID: <AANLkTik7GhNNgCFTtzQOTwffQ+hqxe0czm-4LSMJNKuK@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

On Fri, Nov 26, 2010 at 12:49 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> This is the problem for Fuzzy: each searcher expands the fuzzy query to a
> different Boolean Query and so the scores are not comparable - MultiSearcher
> (but not Solr) tries to combine the resulting rewritten queries into one
> query, so every searcher has the same query.

The problem is not actually any issue with FuzzyQuery, it is the
Query.combine() with any Boolean rewrite... including AUTO as i
mentioned earlier in this thread!

AUTO starts out building a boolean rewrite... if certain magical
conditions are hit (exceeds certain number of terms, or certain DF),
then it switches over to a Filter.

So, for example AUTO proclaims it will never hit boolean maxclauses
exceeded exception, but it can (imagine multisearcher with 5
searchers, it expands to 250 each, but then after combine() this is >
1024).

In my opinion Query.combine() is completely broken, and i don't see
how it can really be fixed to work with arbitrary query structures
since a query might rewrite() differently on the different searchers.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47935-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 20:19:10 2010
Return-Path: <java-user-return-47935-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26062 invoked from network); 26 Nov 2010 20:19:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 20:19:09 -0000
Received: (qmail 93512 invoked by uid 500); 26 Nov 2010 20:19:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93456 invoked by uid 500); 26 Nov 2010 20:19:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93448 invoked by uid 99); 26 Nov 2010 20:19:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 20:19:07 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 20:19:01 +0000
Received: by bwz9 with SMTP id 9so2367347bwz.35
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 12:18:40 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=QBytb61RDXdOw5jEi8hoCIEe+2+5D72s6iPejWxvpn8=;
        b=g+aLRoBihCPg5zWGb+9MJYdW6//v5tm6GjyD3TNlXKiMaGPNCB7Qdogd9NCp5ZJHQW
         ayPhz5qKzzhE/t0EPtUzfpHO/i5mlUheBhVyYP1cloLvW9sp0kCa0sWhhfBPXSAIzNAe
         7qtmFW1oZyNHB/PSIYssp8qJf95IUqKeQTJTg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=YYxIzwVD12ugtnUolHkZxrfUvzDQbu6L+dEQQh8MZcyWNrdxBgFnR6/lIM2NaiHQBX
         PxQLK/ecFF0fx1garFSBqizL7GxRdEhJSNEjPaiuMUPaG4Nvay6dcr84VkP7C1awF8EI
         H7wBg8kBalDSTfZRoECeXUSHQ5Cpy2o1/weWg=
Received: by 10.204.120.130 with SMTP id d2mr2253767bkr.214.1290802719725;
 Fri, 26 Nov 2010 12:18:39 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Fri, 26 Nov 2010 12:18:18 -0800 (PST)
In-Reply-To: <13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com>
 <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com> <13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 26 Nov 2010 20:18:18 +0000
Message-ID: <AANLkTikSVxDNX5vvJU4gzFgKV-Osni6fouLu5GpWeJAF@mail.gmail.com>
Subject: Re: TermRangeQuery
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

What sort of ranges are you trying to use?  Maybe you could store a
separate field, just for these queries, with some normalized form of
the ids, with all numbers padded out to the same length etc.

--
Ian.

On Fri, Nov 26, 2010 at 4:34 PM, Amin Mohammed-Coleman <aminmc@gmail.com> w=
rote:
> Hi
>
> Unfortunately my range query approach did not work. =A0 It seems to be re=
lated to the ids themselves. =A0The list has ids that look this:
>
>
> ID-NYC-1234
> ID-LND-1234
> TX-NYC-1334
> TX-NYC-BBC-123
>
> The ids may range from 90 to 1000. =A0Is there another approach I could t=
ake? =A0I tried building a string with all the ids and set them against a f=
ield for example:
>
> dataId: ID-NYC-123 dataId: ID-NYC-1234....
>
> but that's not a great approach I know...
>
> any help would be appreciated.
>
> Thanks
> Amin
>
>
>
> On 26 Nov 2010, at 14:39, Ian Lea wrote:
>
>> Absolutely, as long as your ids will sort as you expect.
>>
>> I'm not clear what you mean by XDF-123 but if you've got
>>
>> AAA-123
>> AAA-124
>> ...
>> ABC-123
>> ABC-234
>> etc.
>>
>> then you'll be fine. =A0If they don't sort so neatly you can use the
>> TermRangeQuery constructor that takes a Collator but note the
>> performance warning in the javadocs.
>>
>>
>> --
>> Ian.
>>
>>
>> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman <aminmc@gmail.com=
> wrote:
>>> Hi All
>>>
>>> I was wondering whether I can use TermRangeQuery for my use case. =A0I =
have a collection of ids (represented as XDF-123) and I would like to do a =
search for all the ids (might be in the range of 10000) and for each matchi=
ng id I want to get the corresponding data that is stored in the index (for=
 example the document contains id and string value). =A0I am using a custom=
 collector to collect that string value for each match. =A0Is it ok to use =
a TermRangeQuery for the ids rather than creating a massive query string?
>>>
>>>
>>> Thanks
>>> Amin
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47936-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 22:02:17 2010
Return-Path: <java-user-return-47936-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56486 invoked from network); 26 Nov 2010 22:02:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 22:02:16 -0000
Received: (qmail 81408 invoked by uid 500); 26 Nov 2010 22:02:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81354 invoked by uid 500); 26 Nov 2010 22:02:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81346 invoked by uid 99); 26 Nov 2010 22:02:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 22:02:10 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,MIME_QP_LONG_LINE,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of aminmc@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 22:02:02 +0000
Received: by wwi17 with SMTP id 17so150837wwi.5
        for <java-user@lucene.apache.org>; Fri, 26 Nov 2010 14:01:41 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:references:in-reply-to
         :mime-version:content-transfer-encoding:content-type:message-id:cc
         :x-mailer:from:subject:date:to;
        bh=7zGUkstVsevfvuAufku0v2PT2AAmEBhVtixiMmmGmjw=;
        b=jl5LSJk4I9/CwQF8ZwZA9p7iorui62Db0WWbYmLsEKu8tWFeWrmOY/5v/hGqS47AUv
         ViIqxYX3hc2h5x28FOR4Y6IIUWspyps2b6AJkRRs9Z5osIC24kTqdlRs+5oRX8G0wA5T
         jHfktEZ7aduHXNUPlvmoeeqHvxL7rD0q7lTRw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=references:in-reply-to:mime-version:content-transfer-encoding
         :content-type:message-id:cc:x-mailer:from:subject:date:to;
        b=Ii0t8K5+yq8z1JznhynVt2EOKe/i4ZoYkcDBbXKv8JGeh67ou9ODQ/2AAjGLb3e5vE
         2bHrKK5YwU5dZj5edKu4LYNL3EX/lyCcdyMRM4Gzz6Z/sE3/yXocnRlbCdzQWzZ5gyxe
         vkX2Z0Xnuwt64nXHDIjiG+MGzvbNnNto5PyoQ=
Received: by 10.216.191.160 with SMTP id g32mr425109wen.18.1290808901272;
        Fri, 26 Nov 2010 14:01:41 -0800 (PST)
Received: from [192.168.1.84] (host86-156-93-172.range86-156.btcentralplus.com [86.156.93.172])
        by mx.google.com with ESMTPS id 7sm1152605wet.24.2010.11.26.14.01.39
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 26 Nov 2010 14:01:40 -0800 (PST)
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com> <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com> <13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com> <AANLkTikSVxDNX5vvJU4gzFgKV-Osni6fouLu5GpWeJAF@mail.gmail.com>
In-Reply-To: <AANLkTikSVxDNX5vvJU4gzFgKV-Osni6fouLu5GpWeJAF@mail.gmail.com>
Mime-Version: 1.0 (iPhone Mail 8B117)
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii
Message-Id: <53592900-5E33-48E9-A956-F1A74FCF4FBB@gmail.com>
Cc: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
X-Mailer: iPhone Mail (8B117)
From: Amin Mohammed-Coleman <aminmc@gmail.com>
Subject: Re: TermRangeQuery
Date: Fri, 26 Nov 2010 22:01:57 +0000
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>

Essentially I'd like to construct a query which is almost like SQL in clause=
.  The lucene document contains the id and a string value. I'd like to get t=
he string value based on the id key.  The ids may range within 1000. Is this=
 possible to do?

Thanks
Amin

Sent from my iPhone

On 26 Nov 2010, at 20:18, Ian Lea <ian.lea@gmail.com> wrote:

> What sort of ranges are you trying to use?  Maybe you could store a
> separate field, just for these queries, with some normalized form of
> the ids, with all numbers padded out to the same length etc.
>=20
> --
> Ian.
>=20
> On Fri, Nov 26, 2010 at 4:34 PM, Amin Mohammed-Coleman <aminmc@gmail.com> w=
rote:
>> Hi
>>=20
>> Unfortunately my range query approach did not work.   It seems to be rela=
ted to the ids themselves.  The list has ids that look this:
>>=20
>>=20
>> ID-NYC-1234
>> ID-LND-1234
>> TX-NYC-1334
>> TX-NYC-BBC-123
>>=20
>> The ids may range from 90 to 1000.  Is there another approach I could tak=
e?  I tried building a string with all the ids and set them against a field f=
or example:
>>=20
>> dataId: ID-NYC-123 dataId: ID-NYC-1234....
>>=20
>> but that's not a great approach I know...
>>=20
>> any help would be appreciated.
>>=20
>> Thanks
>> Amin
>>=20
>>=20
>>=20
>> On 26 Nov 2010, at 14:39, Ian Lea wrote:
>>=20
>>> Absolutely, as long as your ids will sort as you expect.
>>>=20
>>> I'm not clear what you mean by XDF-123 but if you've got
>>>=20
>>> AAA-123
>>> AAA-124
>>> ...
>>> ABC-123
>>> ABC-234
>>> etc.
>>>=20
>>> then you'll be fine.  If they don't sort so neatly you can use the
>>> TermRangeQuery constructor that takes a Collator but note the
>>> performance warning in the javadocs.
>>>=20
>>>=20
>>> --
>>> Ian.
>>>=20
>>>=20
>>> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman <aminmc@gmail.com=
> wrote:
>>>> Hi All
>>>>=20
>>>> I was wondering whether I can use TermRangeQuery for my use case.  I ha=
ve a collection of ids (represented as XDF-123) and I would like to do a sea=
rch for all the ids (might be in the range of 10000) and for each matching i=
d I want to get the corresponding data that is stored in the index (for exam=
ple the document contains id and string value).  I am using a custom collect=
or to collect that string value for each match.  Is it ok to use a TermRange=
Query for the ids rather than creating a massive query string?
>>>>=20
>>>>=20
>>>> Thanks
>>>> Amin
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>=20
>>>>=20
>>>=20
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>=20
>>=20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>=20
>>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47937-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Nov 26 23:01:34 2010
Return-Path: <java-user-return-47937-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74804 invoked from network); 26 Nov 2010 23:01:34 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 26 Nov 2010 23:01:34 -0000
Received: (qmail 21145 invoked by uid 500); 26 Nov 2010 23:01:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21068 invoked by uid 500); 26 Nov 2010 23:01:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21059 invoked by uid 99); 26 Nov 2010 23:01:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 23:01:29 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bernd.fehling@uni-bielefeld.de designates 129.70.204.65 as permitted sender)
Received: from [129.70.204.65] (HELO mux1-unibi-smtp.hrz.uni-bielefeld.de) (129.70.204.65)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 26 Nov 2010 23:01:20 +0000
MIME-version: 1.0
Content-disposition: inline
Content-type: text/plain; charset=iso-8859-1
Received: from pmxchannel-daemon.mux1-unibi-smtp.hrz.uni-bielefeld.de by
 mux1-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 id <0LCI00800L9NVV00@mux1-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Sat, 27 Nov 2010 00:00:59 +0100 (CET)
Received: from msg-int.uni-bielefeld.de ([129.70.242.10])
 by mux1-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 with ESMTPPA id <0LCI00E75L9N4580@mux1-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Sat, 27 Nov 2010 00:00:59 +0100 (CET)
Received: from [129.70.204.94] (Forwarded-For: 217.25.160.47)
 by mux4-unibi-web.hrz.uni-bielefeld.de (mshttpd); Sat,
 27 Nov 2010 00:00:59 +0100
Date: Sat, 27 Nov 2010 00:00:59 +0100
From: Bernd Fehling <bernd.fehling@uni-bielefeld.de>
Subject: Re: not indexing analyzed field
In-reply-to: <AANLkTimsP22y_YGp=Y8Sbtx7Wrf9=guFrs6o_DEzz-kX@mail.gmail.com>
To: java-user@lucene.apache.org
Message-id:
 <2193_1290812459_ZZh0d40bWr_Py.00_fc75e34466cb.4cf04a3b@uni-bielefeld.de>
X-Mailer: Sun Java(tm) System Messenger Express 6.3-4.01 (built Aug  3 2007;
 32bit)
Content-language: de
Content-transfer-encoding: quoted-printable
X-Accept-Language: de
Priority: normal
X-EnvFrom: bernd.fehling@uni-bielefeld.de
X-PMX-Version: 5.5.9.395186, Antispam-Engine: 2.7.2.376379,
 Antispam-Data: 2010.11.26.225121, pmx9
X-Connecting-IP: 129.70.242.10
References:
 <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
 <AANLkTimskxcD5JtePuP_zrtk6CmL7L6u5Oeh9xS7937E@mail.gmail.com>
 <29187_1290755456_ZZh0c3XercuX7.00_4CEF5D7F.5010003@uni-bielefeld.de>
 <AANLkTikoSoy1QwSqaDsiUZrBApFXSNmXo2O39BgVo0mj@mail.gmail.com>
 <24363_1290783279_ZZh0c7Zm_2~z1.00_4CEFCA2D.4060602@uni-bielefeld.de>
 <AANLkTimsP22y_YGp=Y8Sbtx7Wrf9=guFrs6o_DEzz-kX@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Erik=2C

the =22problem=22 can be described as follows=3A
- we have a database for users
- users can search and mark/store records for watching
- the record marker is the unique path to the source and also the unique=
 record id of the database
- therefore we decided to sha256 the id as backreference from the watche=
d record database
  to the solr database holding more than 25 mio=2E records=2E
- this way we don=27t have to care about special characters of the uniqu=
e id because of the sha256
- we have a direct =22connection=22 between document database and user d=
atabase=2E
- if the record of the document database has been deleted the customer g=
ets notified by the
  sha256 identifier via the user database=2E
=2E=2E=2E and so on=2E

So we are really interested in getting a MessageDigest which changes the=
 value of a field
=5Fand=5F stores the changed value=2E
This is how it is currently working in our FAST search engine and becaus=
e of switching
to Solr we wanted to keep this feature instead of redesigning our curren=
t system=2E =


This said I=27m still in the need of a solution for =22processing=22 and=
 storing the changed value
of a field=2E

Anyway=2C thanks a lot for your help Erik and giving me some ideas how
the lucene index is =22thinking=22 =3A-)

Anyone else an idea how to achive this=3F=3F=3F

Best regards=2C
Bernd


=3E Can you =22define the problem away=22=3F That is=2C why do you want =
to =

=3E store it at
=3E all=3F
=3E If there=27s no value to the users in seeing the encoded value=2C =

=3E just don=27t
=3E store it=2E
=3E You can still search on the encoded value if in that case=2E=2E=2E=2E=

=3E =

=3E Which is a way of saying that I don=27t know=2C off the top of my =

=3E head=2C how
=3E you=27d
=3E index one thing and store the result of analysis=2E=2E=2E
=3E =

=3E Best
=3E Erick
=3E =

=3E On Fri=2C Nov 26=2C 2010 at 9=3A54 AM=2C Bernd Fehling =3C
=3E bernd=2Efehling=40uni-bielefeld=2Ede=3E wrote=3A
=3E =

=3E =3E Hi Erik=2C
=3E =3E
=3E =3E I see my problem=2C caused by a misunderstanding of the indexing=
 =

=3E by lucene=2E
=3E =3E I guess its due to the fact that FAST Data Search has real =

=3E processing=3E pipelines=2E
=3E =3E
=3E =3E Youre right I use Solr but=2C as a matter of fact=2C in this =

=3E special case
=3E =3E I really want to change the indexed =5Fand=5F stored data=2E
=3E =3E For security reasons I have to MD5 or even better SHA256 =

=3E strings which
=3E =3E go into a field=2E So where is the sense if I SHA256 the string =
but
=3E =3E still display the plain text of the stored field=3F
=3E =3E
=3E =3E So the Analyzer or Filter should MessageDigest the content and =

=3E index and
=3E =3E store it as MessageDigest=2E
=3E =3E
=3E =3E Can this be achived somehow with Analyzer or Filter=2C
=3E =3E what is your opinion=3F
=3E =3E
=3E =3E May be a hint which classes to use=3F
=3E =3E
=3E =3E Kind regards=2C
=3E =3E Bernd
=3E =3E
=3E =3E
=3E =3E
=3E =3E Am 26=2E11=2E2010 15=3A05=2C schrieb Erick Erickson=3A
=3E =3E =3E So=2C you=27re using Solr=2C right=3F And have a custom anal=
yzer=3F If =

=3E that=27s the
=3E =3E =3E case=2C Uwe pointed you in the right direction and I think =

=3E everything may
=3E =3E =3E be working fine=2C or at least as I=27d expect=2E
=3E =3E =3E
=3E =3E =3E Specifying stored=3D=22true=22 puts a verbatim=2C unanalyzed=
 copy of =

=3E the data
=3E =3E =3E in the index=2E When you display a field in a document (i=2E=
e=2E query
=3E =3E =3E on *=3A*) the *stored* value is returned=2C *not* the result=
s of =

=3E analysis=2E=3E The
=3E =3E =3E stored
=3E =3E =3E value has nothing to do with what=27s searched=2E
=3E =3E =3E
=3E =3E =3E To see if I=27ve got it right=2C go into the admin page of s=
olr=2C =

=3E click on
=3E =3E =3E =22schema browser=22=2C
=3E =3E =3E and then the field dcdocid should have the MD5 in it=2E If =

=3E that=27s true=2C
=3E =3E then
=3E =3E =3E Solr
=3E =3E =3E is working as expected=2E
=3E =3E =3E
=3E =3E =3E If the analyzed values were returned=2C humans would be in a=
 =

=3E world of hurt
=3E =3E =3E since
=3E =3E =3E all the transformations would be applied and results pages =

=3E would have
=3E =3E =3E gibberish=2E
=3E =3E =3E Imagine applying lowercase and stemming to input for =

=3E =22Running on Empty=22=2C
=3E =3E =3E your
=3E =3E =3E display would be something like =22run on empti=22=2E
=3E =3E =3E
=3E =3E =3E And if you=27re doing pure lucene=2C you can see this by =

=3E enumerating the
=3E =3E terms
=3E =3E =3E in your
=3E =3E =3E dcdocid field=2E
=3E =3E =3E
=3E =3E =3E Best
=3E =3E =3E Erick
=3E =3E =3E
=3E =3E =3E On Fri=2C Nov 26=2C 2010 at 2=3A10 AM=2C Bernd Fehling =3C
=3E =3E =3E bernd=2Efehling=40uni-bielefeld=2Ede=3E wrote=3A
=3E =3E =3E
=3E =3E =3E=3E Hi Erik=2C
=3E =3E =3E=3E
=3E =3E =3E=3E my evidence is that I load a single document into an empt=
y index
=3E =3E =3E=3E with a field =22id=22 and a second field =22dcdocid=22=2E=
 The field =

=3E =22dcdocid=22=3E =3E=3E has the word =22foo=22=2E This goes through =
my analyzer =

=3E and changes to
=3E =3E =3E=3E MD5 string which is then =22acbd18db4cc2f85cedef654fccc4a=
4d8=22=2E
=3E =3E =3E=3E After indexing and commit a search for *=3A* shows me =22=
foo=22 for
=3E =3E =3E=3E the field =22dcdocid=22 and not my MD5=2E
=3E =3E =3E=3E
=3E =3E =3E=3E my fieldType=3A
=3E =3E =3E=3E =3CfieldType name=3D=22text=5Fmd=22 class=3D=22solr=2ETex=
tField=22 =

=3E omitNorms=3D=22true=22 =3E
=3E =3E =3E=3E=A0 =3Canalyzer type=3D=22index=22
=3E =3E =3E=3E =

=3E class=3D=22de=2Eubbielefeld=2Esolr=2Eanalysis=2ETextMessageDigestAna=
lyzer=22 /=3E
=3E =3E =3E=3E =3C/fieldType=3E
=3E =3E =3E=3E
=3E =3E =3E=3E =3C!-- UNIQUE ID --=3E
=3E =3E =3E=3E =3Cfield name=3D=22id=22 type=3D=22string=22 indexed=3D=22=
true=22 stored=3D=22true=22
=3E =3E required=3D=22true=22
=3E =3E =3E=3E /=3E
=3E =3E =3E=3E =3Cfield name=3D=22dcdocid=22 type=3D=22text=5Fmd=22 inde=
xed=3D=22true=22 =

=3E stored=3D=22true=22 /=3E
=3E =3E =3E=3E =3CcopyField source=3D=22id=22 dest=3D=22dcdocid=22 /=3E
=3E =3E =3E=3E
=3E =3E =3E=3E Using the debugger shows that the value in question is go=
ing
=3E =3E =3E=3E through the TextMessageDigestAnalyzer and coming out as M=
D5
=3E =3E =3E=3E but it is not as MD5 in the index=2E
=3E =3E =3E=3E
=3E =3E =3E=3E I also tried a filter but no success=2E
=3E =3E =3E=3E So why is something that is analyzed (and the value has c=
hanged
=3E =3E =3E=3E due to analysis) not stored with its new value in the ind=
ex=3F
=3E =3E =3E=3E
=3E =3E =3E=3E Best regards=2C
=3E =3E =3E=3E Bernd
=3E =3E =3E=3E
=3E =3E =3E=3E
=3E =3E =3E=3E Am 25=2E11=2E2010 18=3A18=2C schrieb Erick Erickson=3A
=3E =3E =3E=3E=3E What is your evidence that =22the result never reaches=
 the index=3F=22
=3E =3E =3E=3E=3E
=3E =3E =3E=3E=3E Are you sure=3A
=3E =3E =3E=3E=3E 1=3E you commit afterwards
=3E =3E =3E=3E=3E 2=3E you reopen the underlying reader to see
=3E =3E =3E=3E=3E 3=3E if you don=27t store the value for the field=2C h=
ow are you sure=3F
=3E =3E =3E=3E=3E 4=3E If you search and don=27t find it=2C did you inde=
x it=3F
=3E =3E =3E=3E=3E
=3E =3E =3E=3E=3E First=2C I=27d be sure the value in question is in the=
 =

=3E document just before
=3E =3E =3E=3E=3E sending it to be added to your index to see if the val=
ue =

=3E you think
=3E =3E =3E=3E=3E is in there really is=2E Something like Document=2Eget=
() and =

=3E see if
=3E =3E =3E=3E=3E
=3E =3E =3E=3E=3E Best
=3E =3E =3E=3E=3E Erick
=3E =3E =3E=3E=3E
=3E =3E =3E=3E=3E On Thu=2C Nov 25=2C 2010 at 8=3A08 AM=2C Bernd Fehling=
 =3C
=3E =3E =3E=3E=3E bernd=2Efehling=40uni-bielefeld=2Ede=3E wrote=3A
=3E =3E =3E=3E=3E
=3E =3E =3E=3E=3E=3E I used KeywordAnalyzer and KeywordTokenizer as temp=
lates for
=3E =3E =3E=3E=3E=3E a new analyzer=2E
=3E =3E =3E=3E=3E=3E The analyzer works fine but the result never reache=
s the index=2E
=3E =3E =3E=3E=3E=3E
=3E =3E =3E=3E=3E=3E My analyzer is called in =22DocInverterPerField=2Ep=
rocessFields=22
=3E =3E =3E=3E=3E=3E with =22stream=2EincrementToken()=22=2E
=3E =3E =3E=3E=3E=3E =2E=2E=2E
=3E =3E =3E=3E=3E=3E try =7B
=3E =3E =3E=3E=3E=3E=A0=A0=A0 boolean hasMoreTokens =3D =

=3E stream=2EincrementToken()=3B=3E =3E=3E=3E=3E
=3E =3E =3E=3E=3E=3E=A0=A0=A0 fieldState=2EattributeSource =3D stream=3B=

=3E =3E =3E=3E=3E=3E
=3E =3E =3E=3E=3E=3E=A0=A0=A0 OffsetAttribute offsetAttribute =3D
=3E =3E =3E=3E=3E=3E fieldState=2EattributeSource=2EaddAttribute(OffsetA=
ttribute=2Eclass)=3B
=3E =3E =3E=3E=3E=3E=A0=A0=A0 PositionIncrementAttribute =

=3E posIncrAttribute =3D
=3E =3E =3E=3E=3E=3E
=3E =3E =3E=3E
=3E =3E =

=3E fieldState=2EattributeSource=2EaddAttribute(PositionIncrementAttribu=
te=2Eclass)=3B=3E =3E=3E=3E=3E
=3E =3E =3E=3E=3E=3E=A0=A0=A0 consumer=2Estart(field)=3B
=3E =3E =3E=3E=3E=3E =2E=2E=2E
=3E =3E =3E=3E=3E=3E
=3E =3E =3E=3E=3E=3E The result goes to =22fieldState=2EattributeSource=22=
 but is =

=3E not in =22field=22=2E
=3E =3E =3E=3E=3E=3E So =22field=2EfieldsData=22 still has the old conte=
nt before =

=3E calling my
=3E =3E =3E=3E=3E=3E analyzer=2E And when calling =22consumer=2Estart(fi=
eld)=22 the =

=3E old content
=3E =3E =3E=3E=3E=3E is going to the index and not the new analyzed one=2E=

=3E =3E =3E=3E=3E=3E Does the analyzer has to care about =22Fieldable =

=3E field=2EfieldsData=22=3E =3E=3E=3E=3E or who is responsible for it=3F=

=3E =3E =3E=3E=3E=3E
=3E =3E =3E=3E=3E=3E Regards
=3E =3E =3E=3E=3E=3E Bernd
=3E =3E =3E=3E=3E=3E

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47938-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Nov 27 10:34:43 2010
Return-Path: <java-user-return-47938-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98105 invoked from network); 27 Nov 2010 10:34:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 27 Nov 2010 10:34:43 -0000
Received: (qmail 32957 invoked by uid 500); 27 Nov 2010 10:34:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32821 invoked by uid 500); 27 Nov 2010 10:34:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32813 invoked by uid 99); 27 Nov 2010 10:34:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 27 Nov 2010 10:34:40 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 27 Nov 2010 10:34:33 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id CA9BCD36004
	for <java-user@lucene.apache.org>; Sat, 27 Nov 2010 11:34:12 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id CWRZ74v+vnoI for <java-user@lucene.apache.org>;
	Sat, 27 Nov 2010 11:34:07 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 752B4D36002
	for <java-user@lucene.apache.org>; Sat, 27 Nov 2010 11:34:06 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de> <006601cb8cc6$d89bbf10$89d33d30$@thetaphi.de> <27775_1290756209_ZZh0c3XiucqX9.00_4CEF6071.5080000@uni-bielefeld.de>
In-Reply-To: <27775_1290756209_ZZh0c3XiucqX9.00_4CEF6071.5080000@uni-bielefeld.de>
Subject: RE: not indexing analyzed field
Date: Sat, 27 Nov 2010 11:34:36 +0100
Message-ID: <001001cb8e1e$b074f890$115ee9b0$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQI8CDXjZiYJrRyYxcrIP4XD1s+STAJ0CYY8AburkyySgq2UoA==
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

You have to first understand the difference between "stored" and =
"indexed":

- For stored fields no analysis is done, as they are only stored (e.g. =
for
display of retrieval results). These are simply copied unchanged to the
index - and you cannot search on them.
- Analysis is done on the "index" side, so the text is split up into =
tokens.
So you won't see analysis occurring on the stored field contents (e.g. =
when
you display the results using Lucene's IndexReader.document(int) or =
Solr's
result structure). The indexed fields are used when you query the index. =
For
queries to work, the search query is also analyzed and split up into =
tokens.
These tokens are searched in the "index". This also implies, that the =
query
and index analyzer needs to be compatible. And that=92s another problem =
in
your schema, you don't have an query analyzer! So your searches would =
never
hit any result!

I'd suggest to read a book about Lucene/Solr first :-)

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Bernd Fehling [mailto:bernd.fehling@uni-bielefeld.de]
> Sent: Friday, November 26, 2010 8:23 AM
> To: java-user@lucene.apache.org
> Subject: Re: not indexing analyzed field
>=20
> Hi Uwe,
>=20
> my fieldType and fields are as follows:
>=20
> <fieldType name=3D"text_md" class=3D"solr.TextField" =
omitNorms=3D"true" >
>   <analyzer type=3D"index"
> class=3D"de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
</fieldType>
>=20
> <!-- UNIQUE ID -->
> <field name=3D"id" type=3D"string" indexed=3D"true" stored=3D"true"
required=3D"true" />
> <field name=3D"dcdocid" type=3D"text_md" indexed=3D"true" =
stored=3D"true" />
> <copyField source=3D"id" dest=3D"dcdocid" />
>=20
> So the field dcdocid has the attribute *stored* which I can also see =
in
the
> debugger.
> Why should I analyze a stored field?
> I don't know if I need to analyze it, I also tried a filter but also =
no
success.
>=20
> My understanding is to send something to a field and the field has a
processing
> chain. The processing chain analyzes, filters, ... is doing something =
to
the
> content and then stores the content to that field in the index.
>=20
> May be it is a misunderstanding on my side about the field based
processing
> because I'm normally working with FAST search engines which is =
document
> based.
>=20
> Best regards
> Bernd
>=20
>=20
>=20
> Am 25.11.2010 18:33, schrieb Uwe Schindler:
> > field.fieldsData is used for the stored field contents and so only
> > *stored* in index, of course not analyzed (why should I analyze a
> > stored field). The indexed tokens go of course through your analyzer
> > and the returned tokens are indexed as terms. Where is the problem?
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> >> -----Original Message-----
> >> From: Bernd Fehling [mailto:bernd.fehling@uni-bielefeld.de]
> >> Sent: Thursday, November 25, 2010 2:08 PM
> >> To: java-user@lucene.apache.org
> >> Subject: not indexing analyzed field
> >>
> >> I used KeywordAnalyzer and KeywordTokenizer as templates for a new
> >> analyzer.
> >> The analyzer works fine but the result never reaches the index.
> >>
> >> My analyzer is called in "DocInverterPerField.processFields"
> >> with "stream.incrementToken()".
> >> ...
> >> try {
> >>     boolean hasMoreTokens =3D stream.incrementToken();
> >>
> >>     fieldState.attributeSource =3D stream;
> >>
> >>     OffsetAttribute offsetAttribute =3D
> >> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
> >>     PositionIncrementAttribute posIncrAttribute =3D
> >> =
fieldState.attributeSource.addAttribute(PositionIncrementAttribute.cl
> >> ass);
> >>
> >>     consumer.start(field);
> >> ...
> >>
> >> The result goes to "fieldState.attributeSource" but is not in =
"field".
> >> So "field.fieldsData" still has the old content before calling my
> > analyzer. And
> >> when calling "consumer.start(field)" the old content is going to =
the
> >> index
> > and
> >> not the new analyzed one.
> >> Does the analyzer has to care about "Fieldable field.fieldsData"
> >> or who is responsible for it?
> >>
> >> Regards
> >> Bernd
> >>
> >> =
---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> >
> > =
---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>=20
> --
> *************************************************************
> Bernd Fehling                Universit=E4tsbibliothek Bielefeld
> Dipl.-Inform. (FH)                        Universit=E4tsstr. 25
> Tel. +49 521 106-4060                   Fax. +49 521 106-4052
> bernd.fehling@uni-bielefeld.de                33615 Bielefeld
>=20
> BASE - Bielefeld Academic Search Engine - www.base-search.net
> *************************************************************
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47939-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 28 18:20:31 2010
Return-Path: <java-user-return-47939-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6919 invoked from network); 28 Nov 2010 18:20:30 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Nov 2010 18:20:30 -0000
Received: (qmail 42911 invoked by uid 500); 28 Nov 2010 18:20:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42811 invoked by uid 500); 28 Nov 2010 18:20:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42803 invoked by uid 99); 28 Nov 2010 18:20:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 28 Nov 2010 18:20:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 28 Nov 2010 18:20:19 +0000
Received: by qyk7 with SMTP id 7so708221qyk.14
        for <java-user@lucene.apache.org>; Sun, 28 Nov 2010 10:19:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=FHjqagZRkjMZhRwwcb1c+Rqt50FC60OTkRPOH7nxdDs=;
        b=u9/HweazdrR1+EM8KNkA8a3aNP4Uz2Ni+xWAk/4KUApdPvR2wllalCfw+L0Z+0QWl7
         5p5KssGPjVq7hAUm/8BioBRZoKk40M/JCuvF90YIRL9KeBm+YOF0K3yRvkAGt3v2aGgu
         E4YgfNp5+nnFQOdKl1Zt1EeddCsoYaAfVSUX4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=A3XjPfjU8jjb/xnJ19t2WQyndqWB2f+6/dfIu4qC3toL2uqN42Hb8j2uR+9yZSHar9
         RPjeHvxgSTJMJDHte6eI+EVe1GOa8spn7Sg/2xzKgj7lFSrT3lvw+FhiXN47+Hqaxj8H
         mvrueBMAMsaIRp4kBsucw0APghwNkofiOa5tA=
MIME-Version: 1.0
Received: by 10.229.79.212 with SMTP id q20mr3933485qck.272.1290968398509;
 Sun, 28 Nov 2010 10:19:58 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Sun, 28 Nov 2010 10:19:58 -0800 (PST)
In-Reply-To: <53592900-5E33-48E9-A956-F1A74FCF4FBB@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com>
	<AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
	<13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com>
	<AANLkTikSVxDNX5vvJU4gzFgKV-Osni6fouLu5GpWeJAF@mail.gmail.com>
	<53592900-5E33-48E9-A956-F1A74FCF4FBB@gmail.com>
Date: Sun, 28 Nov 2010 13:19:58 -0500
Message-ID: <AANLkTi=A1gav2gT_POyFHcUu2GCRHOkZim1HxCtSzKQG@mail.gmail.com>
Subject: Re: TermRangeQuery
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636426bbfcf398f0496210096
X-Virus-Checked: Checked by ClamAV on apache.org

--001636426bbfcf398f0496210096
Content-Type: text/plain; charset=ISO-8859-1

Why won't Ian's suggestion work? You haven't really given us a clue what it
is about
your attempt that didn't work. The expected and actual output would be
useful...

But Ian's notion is the well-known issue that lexical and numeric sorting
aren't
at all the same. You'd get reasonable results if you left-padded the number
portion of the IDs with 0 out to 4 spaces, thus
aa-90   -> aa-0090
aa-123 -> aa-0123
aa-1000 > aa-1000

and your range queries should work. You might have to transform them
back when displayed. Or you could add them to your document twice.
Once in a "hidden" field, the one you searched against in your range query
and the other to display. This latter wouldn't bloat your index (much) since
you would store one and index the other....

Best
Erick

On Fri, Nov 26, 2010 at 5:01 PM, Amin Mohammed-Coleman <aminmc@gmail.com>wrote:

> Essentially I'd like to construct a query which is almost like SQL in
> clause.  The lucene document contains the id and a string value. I'd like to
> get the string value based on the id key.  The ids may range within 1000. Is
> this possible to do?
>
> Thanks
> Amin
>
> Sent from my iPhone
>
> On 26 Nov 2010, at 20:18, Ian Lea <ian.lea@gmail.com> wrote:
>
> > What sort of ranges are you trying to use?  Maybe you could store a
> > separate field, just for these queries, with some normalized form of
> > the ids, with all numbers padded out to the same length etc.
> >
> > --
> > Ian.
> >
> > On Fri, Nov 26, 2010 at 4:34 PM, Amin Mohammed-Coleman <aminmc@gmail.com>
> wrote:
> >> Hi
> >>
> >> Unfortunately my range query approach did not work.   It seems to be
> related to the ids themselves.  The list has ids that look this:
> >>
> >>
> >> ID-NYC-1234
> >> ID-LND-1234
> >> TX-NYC-1334
> >> TX-NYC-BBC-123
> >>
> >> The ids may range from 90 to 1000.  Is there another approach I could
> take?  I tried building a string with all the ids and set them against a
> field for example:
> >>
> >> dataId: ID-NYC-123 dataId: ID-NYC-1234....
> >>
> >> but that's not a great approach I know...
> >>
> >> any help would be appreciated.
> >>
> >> Thanks
> >> Amin
> >>
> >>
> >>
> >> On 26 Nov 2010, at 14:39, Ian Lea wrote:
> >>
> >>> Absolutely, as long as your ids will sort as you expect.
> >>>
> >>> I'm not clear what you mean by XDF-123 but if you've got
> >>>
> >>> AAA-123
> >>> AAA-124
> >>> ...
> >>> ABC-123
> >>> ABC-234
> >>> etc.
> >>>
> >>> then you'll be fine.  If they don't sort so neatly you can use the
> >>> TermRangeQuery constructor that takes a Collator but note the
> >>> performance warning in the javadocs.
> >>>
> >>>
> >>> --
> >>> Ian.
> >>>
> >>>
> >>> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman <
> aminmc@gmail.com> wrote:
> >>>> Hi All
> >>>>
> >>>> I was wondering whether I can use TermRangeQuery for my use case.  I
> have a collection of ids (represented as XDF-123) and I would like to do a
> search for all the ids (might be in the range of 10000) and for each
> matching id I want to get the corresponding data that is stored in the index
> (for example the document contains id and string value).  I am using a
> custom collector to collect that string value for each match.  Is it ok to
> use a TermRangeQuery for the ids rather than creating a massive query
> string?
> >>>>
> >>>>
> >>>> Thanks
> >>>> Amin
> >>>> ---------------------------------------------------------------------
> >>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>
> >>>>
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636426bbfcf398f0496210096--

From java-user-return-47940-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Nov 28 20:47:58 2010
Return-Path: <java-user-return-47940-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50284 invoked from network); 28 Nov 2010 20:47:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 28 Nov 2010 20:47:58 -0000
Received: (qmail 3954 invoked by uid 500); 28 Nov 2010 20:47:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3881 invoked by uid 500); 28 Nov 2010 20:47:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3873 invoked by uid 99); 28 Nov 2010 20:47:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 28 Nov 2010 20:47:55 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of aminmc@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 28 Nov 2010 20:47:46 +0000
Received: by wyf28 with SMTP id 28so4072478wyf.35
        for <java-user@lucene.apache.org>; Sun, 28 Nov 2010 12:47:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:content-transfer-encoding:message-id
         :references:to:x-mailer;
        bh=LmI9d5FWnVhR4W9HzEBr5Ugx7Wg1OZUOZZqZM/AWXvQ=;
        b=HpIHsTBTEHmUn/aHZoouK95Tm+NHJ5CO9q1r/SeaJe49TsqVpM3c16Wfpifa+Z7eSy
         DRzbLZd9DpPW1Iv4Lbyn7J+qYE97118RmCkane9fEEB0NzjWmGGLbxZ6yZuFm1G/zlwF
         PbgcSitlCRTpqg6XWYwWlPhxe46MbcWaofoA0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=UQ58B3LZoh26qkoOQZddXhGm80AWLYUl8vl056lGOA8XX1eX72uJ/vewhk3eIp9P9P
         6/5P9l3glh8ee88DSrpI7RbHeg+Ngx2WLCuK4xjLNnVvYgKpsZFF2L9rbpZTvnh0X/pI
         n5zM9stWeoy0578U7OhL54db69tOv9rbmRhnI=
Received: by 10.216.159.195 with SMTP id s45mr4252114wek.43.1290977245728;
        Sun, 28 Nov 2010 12:47:25 -0800 (PST)
Received: from [192.168.1.90] (host86-156-93-172.range86-156.btcentralplus.com [86.156.93.172])
        by mx.google.com with ESMTPS id p4sm2045384wej.4.2010.11.28.12.47.23
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Sun, 28 Nov 2010 12:47:24 -0800 (PST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Apple Message framework v1082)
Subject: Re: TermRangeQuery
From: Amin Mohammed-Coleman <aminmc@gmail.com>
In-Reply-To: <AANLkTi=A1gav2gT_POyFHcUu2GCRHOkZim1HxCtSzKQG@mail.gmail.com>
Date: Sun, 28 Nov 2010 20:47:22 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <027A99FD-1B9B-4933-8F39-397EF2527D4F@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com> <AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com> <13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com> <AANLkTikSVxDNX5vvJU4gzFgKV-Osni6fouLu5GpWeJAF@mail.gmail.com> <53592900-5E33-48E9-A956-F1A74FCF4FBB@gmail.com> <AANLkTi=A1gav2gT_POyFHcUu2GCRHOkZim1HxCtSzKQG@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1082)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi

I'll explain my use case more and then explain the out come of my =
implementation:

I have lucene documents that look like this:


Field name           Field Value
dataId                     TYX-CC-124
category                CATEGORY A


What I would like to do is for a given collection of dataIds I'd like to =
get it's corresponding category.  The collection of ids that will be =
passed into my method will vary.  Also the id prefix (TYX-CC) will be =
different for different groups invoking my method.  For example I may =
have ids that look like below:

TX-CC-124
AVC-FF-124

and so on.

So I tried sorting the list of ids before creating the range query based =
on the numeric part of the id. This did not work as the number of ids =
returned from the query was greater than the input ids. =20

You mentioned padding the number part of the ids but will that work in =
the case of the following:

aa-01
bb-01

If pass in aa-01 as the lower range, the query will return the result =
for bb-01 as well (unless I have mis understood the usage of the range =
query).  =20

In order to get things moving i decided to create a boolean query and =
essentially batch the queries to avoid hitting too many clause =
exception.   So for each 1000 ids I create a boolean query with the ids =
being passed in.   This may not be the best approach but I can't seem to =
get my head around how the range query can be used considering the =
numeric part of the id is essentially not unique. =20


Thanks
Amin



On 28 Nov 2010, at 18:19, Erick Erickson wrote:

> Why won't Ian's suggestion work? You haven't really given us a clue =
what it
> is about
> your attempt that didn't work. The expected and actual output would be
> useful...
>=20
> But Ian's notion is the well-known issue that lexical and numeric =
sorting
> aren't
> at all the same. You'd get reasonable results if you left-padded the =
number
> portion of the IDs with 0 out to 4 spaces, thus
> aa-90   -> aa-0090
> aa-123 -> aa-0123
> aa-1000 > aa-1000
>=20
> and your range queries should work. You might have to transform them
> back when displayed. Or you could add them to your document twice.
> Once in a "hidden" field, the one you searched against in your range =
query
> and the other to display. This latter wouldn't bloat your index (much) =
since
> you would store one and index the other....
>=20
> Best
> Erick
>=20
> On Fri, Nov 26, 2010 at 5:01 PM, Amin Mohammed-Coleman =
<aminmc@gmail.com>wrote:
>=20
>> Essentially I'd like to construct a query which is almost like SQL in
>> clause.  The lucene document contains the id and a string value. I'd =
like to
>> get the string value based on the id key.  The ids may range within =
1000. Is
>> this possible to do?
>>=20
>> Thanks
>> Amin
>>=20
>> Sent from my iPhone
>>=20
>> On 26 Nov 2010, at 20:18, Ian Lea <ian.lea@gmail.com> wrote:
>>=20
>>> What sort of ranges are you trying to use?  Maybe you could store a
>>> separate field, just for these queries, with some normalized form of
>>> the ids, with all numbers padded out to the same length etc.
>>>=20
>>> --
>>> Ian.
>>>=20
>>> On Fri, Nov 26, 2010 at 4:34 PM, Amin Mohammed-Coleman =
<aminmc@gmail.com>
>> wrote:
>>>> Hi
>>>>=20
>>>> Unfortunately my range query approach did not work.   It seems to =
be
>> related to the ids themselves.  The list has ids that look this:
>>>>=20
>>>>=20
>>>> ID-NYC-1234
>>>> ID-LND-1234
>>>> TX-NYC-1334
>>>> TX-NYC-BBC-123
>>>>=20
>>>> The ids may range from 90 to 1000.  Is there another approach I =
could
>> take?  I tried building a string with all the ids and set them =
against a
>> field for example:
>>>>=20
>>>> dataId: ID-NYC-123 dataId: ID-NYC-1234....
>>>>=20
>>>> but that's not a great approach I know...
>>>>=20
>>>> any help would be appreciated.
>>>>=20
>>>> Thanks
>>>> Amin
>>>>=20
>>>>=20
>>>>=20
>>>> On 26 Nov 2010, at 14:39, Ian Lea wrote:
>>>>=20
>>>>> Absolutely, as long as your ids will sort as you expect.
>>>>>=20
>>>>> I'm not clear what you mean by XDF-123 but if you've got
>>>>>=20
>>>>> AAA-123
>>>>> AAA-124
>>>>> ...
>>>>> ABC-123
>>>>> ABC-234
>>>>> etc.
>>>>>=20
>>>>> then you'll be fine.  If they don't sort so neatly you can use the
>>>>> TermRangeQuery constructor that takes a Collator but note the
>>>>> performance warning in the javadocs.
>>>>>=20
>>>>>=20
>>>>> --
>>>>> Ian.
>>>>>=20
>>>>>=20
>>>>> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman <
>> aminmc@gmail.com> wrote:
>>>>>> Hi All
>>>>>>=20
>>>>>> I was wondering whether I can use TermRangeQuery for my use case. =
 I
>> have a collection of ids (represented as XDF-123) and I would like to =
do a
>> search for all the ids (might be in the range of 10000) and for each
>> matching id I want to get the corresponding data that is stored in =
the index
>> (for example the document contains id and string value).  I am using =
a
>> custom collector to collect that string value for each match.  Is it =
ok to
>> use a TermRangeQuery for the ids rather than creating a massive query
>> string?
>>>>>>=20
>>>>>>=20
>>>>>> Thanks
>>>>>> Amin
>>>>>> =
---------------------------------------------------------------------
>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>=20
>>>>>>=20
>>>>>=20
>>>>> =
---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>=20
>>>>=20
>>>>=20
>>>> =
---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>=20
>>>>=20
>>>=20
>>> =
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>=20
>>=20
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>=20
>>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47941-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 03:15:07 2010
Return-Path: <java-user-return-47941-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75312 invoked from network); 29 Nov 2010 03:15:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 03:15:07 -0000
Received: (qmail 52690 invoked by uid 500); 29 Nov 2010 03:15:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52621 invoked by uid 500); 29 Nov 2010 03:15:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52613 invoked by uid 99); 29 Nov 2010 03:15:04 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 03:15:04 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jdyangchina@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 03:14:59 +0000
Received: by wwb17 with SMTP id 17so1005254wwb.5
        for <java-user@lucene.apache.org>; Sun, 28 Nov 2010 19:14:38 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=jWNz1E1mUnJPqnyvMQfJz+K0l74mpiwPEd0oxk7wwFc=;
        b=aBn+VODvjVR1qW0wsyyHr2DtuY6U7UdeAQRCai7QH6vkUjrKw9TY707bC+lmnppPIQ
         pKyj1IdGHMxpPNZUKmMDWAQpHQU0Y1MoN/Mhvc7ZjlRFKl5emDFQzb+Oo6IMJl8HbzCE
         XyU3W67XN4qah7xygEv/z+5fZ8u8PBCzR6ZEU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=r8cxztPrK28rT9yGybAuQHlf1NLWTxfCfHPN6D6VaZszjIBdFDd+bEaLE+a7q6Qx1r
         QhFfNGN9vJ3luw7NddJedN07DaOJPsL77wEdstQqv2cjG+bIU4q0bfiQ523T8LdPJO6k
         Y8wdWssx4XyaXIj6xXX+neyoKOJYgekviJcQo=
Received: by 10.216.173.79 with SMTP id u57mr4409089wel.40.1291000478139; Sun,
 28 Nov 2010 19:14:38 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.212.213 with HTTP; Sun, 28 Nov 2010 19:14:17 -0800 (PST)
In-Reply-To: <90362ECB07906C40A0297F9D5211A24323C3CBEA71@ITSEMBXCLUS.enterprise.gcal.ac.uk>
References: <90362ECB07906C40A0297F9D5211A24323C3CBEA71@ITSEMBXCLUS.enterprise.gcal.ac.uk>
From: jiandong yang <jdyangchina@gmail.com>
Date: Mon, 29 Nov 2010 11:14:17 +0800
Message-ID: <AANLkTimTuZmqCtTwK37t3fvi_dq+XMZCerDQSUcZvDqR@mail.gmail.com>
Subject: Re: IndexWriter Class
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636426893e788b704962878cb

--001636426893e788b704962878cb
Content-Type: text/plain; charset=GB2312
Content-Transfer-Encoding: quoted-printable

hello, all, here comes my question:
as far as I know,  lucene now offer the feature that ones can search some
doc while the index which contains that specific doc is modifying.
for example(pseudocode) :

while indexWriter(indexDir).add(docA)  is doing, can indexReader(indexDir)
offer the query function?

after the add is done, should the reader be reopen?

or someone show me a simple example, thx a lot!!!

--=20
=D7=A3=D2=BB=C7=D0=CB=B3=C0=FB~

Best Regards,

=D1=EE=BD=A8=B6=AB

=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D

Jiandong Yang
Mobile Phone:15921536660
email: yangjiandong@snda.com
Architect management office


Shanghai shanda networking development Co., LTD

Shanghai 201203, P. R. China

=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D

--001636426893e788b704962878cb--

From java-user-return-47942-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 03:51:12 2010
Return-Path: <java-user-return-47942-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88386 invoked from network); 29 Nov 2010 03:51:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 03:51:11 -0000
Received: (qmail 61738 invoked by uid 500); 29 Nov 2010 03:51:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61461 invoked by uid 500); 29 Nov 2010 03:51:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61449 invoked by uid 99); 29 Nov 2010 03:51:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 03:51:09 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of sariny@gmail.com designates 209.85.213.48 as permitted sender)
Received: from [209.85.213.48] (HELO mail-yw0-f48.google.com) (209.85.213.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 03:50:59 +0000
Received: by ywh1 with SMTP id 1so2125292ywh.35
        for <java-user@lucene.apache.org>; Sun, 28 Nov 2010 19:50:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:date:from:to:subject
         :message-id:x-mailer:mime-version:content-type
         :content-transfer-encoding;
        bh=tR2PO+CYxeqMaVUOclGfvA8OaF+cd/Ziq3ZX9iqsK1Q=;
        b=p8HuZC6+UBLnTwpW7+U7QudH03ZISu9Md26JER7WqA6rWHf1qzVNl6o/Djx55i9P4t
         RtCy8HGQ9TjC61PhpX4ajPGWAYTxdQWFBhxoJl8U4JPEw2HbkMgmGNNKTuDIKSI1nz1W
         8Hfe+X6JvkCz6PBHKjcKmdLTA95pQCjSSdYCI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:subject:message-id:x-mailer:mime-version:content-type
         :content-transfer-encoding;
        b=OsRQusaIeYBHYIAzfH/B+E/XrC+vTpsONFXjqS4EMNAWhWC7xWQ/Oiq/ans8bNk+xa
         +hP3t9HGW9SFJtYQXr69l2tR+FHn1cjtwL2kg8ppJXJ0FR0+alclcTOUgS+0fKluaxuD
         GMWiQR4OQTPgpX9edJq+ByWPqMgFC+4QGms4s=
Received: by 10.151.7.1 with SMTP id k1mr9327942ybi.333.1291002638960;
        Sun, 28 Nov 2010 19:50:38 -0800 (PST)
Received: from Sarin-PC ([118.67.127.167])
        by mx.google.com with ESMTPS id v12sm3019756ybk.11.2010.11.28.19.50.35
        (version=SSLv3 cipher=RC4-MD5);
        Sun, 28 Nov 2010 19:50:38 -0800 (PST)
Date: Mon, 29 Nov 2010 11:50:34 +0800
From: "Sariny" <sariny@gmail.com>
To: "java-user" <java-user@lucene.apache.org>
Subject: How to Cache Filter Results between Servers
Message-ID: <201011291150315581133@gmail.com>
X-mailer: Foxmail 6, 15, 201, 22 [cn]
Mime-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

hello everyone

	    I have this test code:

		IndexReader ir = getReader(); 
        TermQuery q = new TermQuery(new Term("sub_id",NumericUtils.intToPrefixCoded(57)));
        
        Filter f = new QueryWrapperFilter(q);
        try
        {
            DocIdSet s = f.getDocIdSet(ir);

            DocIdSetIterator i = s.iterator();
            while(i.nextDoc() != DocIdSetIterator.NO_MORE_DOCS)
            {
                System.out.println(i.docID());
            }

            System.out.println(f.hashCode());
            System.out.println(s.hashCode());
            System.out.println(ir.hashCode());
            System.out.println(ir.getFieldCacheKey().hashCode());
        }
        catch (IOException e)
        {
            e.printStackTrace();
        }


       1. getReader() returns a MultiReader may consist of  several IndexReaders, in my test case ,only consist of one IndexReader
	   2. index files won't change 

	  assuming that index files won't be updated, and my question is : 
		
 	  1. why ir.hashCode() returns different value every time I run this code?
      2. if I copy the index file to another server ,and they provide search service together,will f.getDocIdSet(ir) return the same DocIdSet? if true,how to cache filter results and share between the 2 servers?  how to form a cache key not influenced by question 1?



	  Thanks ~~

                                                                                                                                                                               



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47943-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 03:51:54 2010
Return-Path: <java-user-return-47943-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88628 invoked from network); 29 Nov 2010 03:51:54 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 03:51:54 -0000
Received: (qmail 63475 invoked by uid 500); 29 Nov 2010 03:51:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63436 invoked by uid 500); 29 Nov 2010 03:51:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63428 invoked by uid 99); 29 Nov 2010 03:51:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 03:51:52 +0000
X-ASF-Spam-Status: No, hits=4.7 required=10.0
	tests=FREEMAIL_FROM,FREEMAIL_REPLY,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 03:51:43 +0000
Received: by qyk7 with SMTP id 7so1064346qyk.14
        for <java-user@lucene.apache.org>; Sun, 28 Nov 2010 19:51:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=TlODJaYTtQlDWAvRaO4HNi8Z5aG90Z+8RirEhqhJNOI=;
        b=mI5DsAvlSYnPokfqBMx0dWk5y7mWBtwz0kzY0nM9rBvMd8ZxxEb31AFNtfpUHwAQbe
         O37ItfsTvedkZcoMTYwf956EhJ4LFLQhqE90QOqEyJ/txfm50UNc8CSEOFZiRXKXiLHF
         Fpc/RQr6NRp898Jq7vKXX1rh/q3nWjAHbQfng=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=CEObB8Ces9/Y/JZUd2ZOnhyRgTHw0d9aXCNzT5E/XUIxGT/uW8j1GJbmNLpDOOQXuh
         W3WWTsMsfI/PhuRzAqkHbt4/HU9BaV2QiyQW98MEp2L1IyTBnuGDJa6tNKr/4cKe3Swo
         XPALNI42OOJevjonqZ6apO7eisCscrO9EWAu0=
MIME-Version: 1.0
Received: by 10.229.182.11 with SMTP id ca11mr4466889qcb.44.1291002682161;
 Sun, 28 Nov 2010 19:51:22 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Sun, 28 Nov 2010 19:51:22 -0800 (PST)
In-Reply-To: <027A99FD-1B9B-4933-8F39-397EF2527D4F@gmail.com>
References: <50D99037-BFBE-4470-AD0B-40EF661530D9@gmail.com>
	<AANLkTikYCmnO_S+LOkkKhOfzqpPb3ewJFTEPGT4v3KRq@mail.gmail.com>
	<13D9053A-26BE-468C-A5CC-2327BC333D4B@gmail.com>
	<AANLkTikSVxDNX5vvJU4gzFgKV-Osni6fouLu5GpWeJAF@mail.gmail.com>
	<53592900-5E33-48E9-A956-F1A74FCF4FBB@gmail.com>
	<AANLkTi=A1gav2gT_POyFHcUu2GCRHOkZim1HxCtSzKQG@mail.gmail.com>
	<027A99FD-1B9B-4933-8F39-397EF2527D4F@gmail.com>
Date: Sun, 28 Nov 2010 22:51:22 -0500
Message-ID: <AANLkTi=vFdrWk3O=5wTeGst=9HO+5ExzojRUnHOiAmRn@mail.gmail.com>
Subject: Re: TermRangeQuery
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364ec8fe463d90049628fc0c
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364ec8fe463d90049628fc0c
Content-Type: text/plain; charset=ISO-8859-1

OK, maybe I'm catching on at last. Have you considered just skipping the
whole search thing entirely? Something like using one of the classes
implementing TermDocs to get the document for a particular term (one of
the elements of your list of dataIds in this case). That would give you the
doc number which in turn would allow you to extract the category. You'd
have to take some care that the Term you constructed went through
all the transformations you do with regular querying (i.e. say you
lower-case the dataIds or anything else like that).

You may want to explore lazy loading to prevent the overhead of reading
any extraneous information when you get the doc from the TermDocs class,
it can result in quite a time savings.

Best
Erick


On Sun, Nov 28, 2010 at 3:47 PM, Amin Mohammed-Coleman <aminmc@gmail.com>wrote:

> Hi
>
> I'll explain my use case more and then explain the out come of my
> implementation:
>
> I have lucene documents that look like this:
>
>
> Field name           Field Value
> dataId                     TYX-CC-124
> category                CATEGORY A
>
>
> What I would like to do is for a given collection of dataIds I'd like to
> get it's corresponding category.  The collection of ids that will be passed
> into my method will vary.  Also the id prefix (TYX-CC) will be different for
> different groups invoking my method.  For example I may have ids that look
> like below:
>
> TX-CC-124
> AVC-FF-124
>
> and so on.
>
> So I tried sorting the list of ids before creating the range query based on
> the numeric part of the id. This did not work as the number of ids returned
> from the query was greater than the input ids.
>
> You mentioned padding the number part of the ids but will that work in the
> case of the following:
>
> aa-01
> bb-01
>
> If pass in aa-01 as the lower range, the query will return the result for
> bb-01 as well (unless I have mis understood the usage of the range query).
>
> In order to get things moving i decided to create a boolean query and
> essentially batch the queries to avoid hitting too many clause exception.
> So for each 1000 ids I create a boolean query with the ids being passed in.
>   This may not be the best approach but I can't seem to get my head around
> how the range query can be used considering the numeric part of the id is
> essentially not unique.
>
>
> Thanks
> Amin
>
>
>
> On 28 Nov 2010, at 18:19, Erick Erickson wrote:
>
> > Why won't Ian's suggestion work? You haven't really given us a clue what
> it
> > is about
> > your attempt that didn't work. The expected and actual output would be
> > useful...
> >
> > But Ian's notion is the well-known issue that lexical and numeric sorting
> > aren't
> > at all the same. You'd get reasonable results if you left-padded the
> number
> > portion of the IDs with 0 out to 4 spaces, thus
> > aa-90   -> aa-0090
> > aa-123 -> aa-0123
> > aa-1000 > aa-1000
> >
> > and your range queries should work. You might have to transform them
> > back when displayed. Or you could add them to your document twice.
> > Once in a "hidden" field, the one you searched against in your range
> query
> > and the other to display. This latter wouldn't bloat your index (much)
> since
> > you would store one and index the other....
> >
> > Best
> > Erick
> >
> > On Fri, Nov 26, 2010 at 5:01 PM, Amin Mohammed-Coleman <aminmc@gmail.com
> >wrote:
> >
> >> Essentially I'd like to construct a query which is almost like SQL in
> >> clause.  The lucene document contains the id and a string value. I'd
> like to
> >> get the string value based on the id key.  The ids may range within
> 1000. Is
> >> this possible to do?
> >>
> >> Thanks
> >> Amin
> >>
> >> Sent from my iPhone
> >>
> >> On 26 Nov 2010, at 20:18, Ian Lea <ian.lea@gmail.com> wrote:
> >>
> >>> What sort of ranges are you trying to use?  Maybe you could store a
> >>> separate field, just for these queries, with some normalized form of
> >>> the ids, with all numbers padded out to the same length etc.
> >>>
> >>> --
> >>> Ian.
> >>>
> >>> On Fri, Nov 26, 2010 at 4:34 PM, Amin Mohammed-Coleman <
> aminmc@gmail.com>
> >> wrote:
> >>>> Hi
> >>>>
> >>>> Unfortunately my range query approach did not work.   It seems to be
> >> related to the ids themselves.  The list has ids that look this:
> >>>>
> >>>>
> >>>> ID-NYC-1234
> >>>> ID-LND-1234
> >>>> TX-NYC-1334
> >>>> TX-NYC-BBC-123
> >>>>
> >>>> The ids may range from 90 to 1000.  Is there another approach I could
> >> take?  I tried building a string with all the ids and set them against a
> >> field for example:
> >>>>
> >>>> dataId: ID-NYC-123 dataId: ID-NYC-1234....
> >>>>
> >>>> but that's not a great approach I know...
> >>>>
> >>>> any help would be appreciated.
> >>>>
> >>>> Thanks
> >>>> Amin
> >>>>
> >>>>
> >>>>
> >>>> On 26 Nov 2010, at 14:39, Ian Lea wrote:
> >>>>
> >>>>> Absolutely, as long as your ids will sort as you expect.
> >>>>>
> >>>>> I'm not clear what you mean by XDF-123 but if you've got
> >>>>>
> >>>>> AAA-123
> >>>>> AAA-124
> >>>>> ...
> >>>>> ABC-123
> >>>>> ABC-234
> >>>>> etc.
> >>>>>
> >>>>> then you'll be fine.  If they don't sort so neatly you can use the
> >>>>> TermRangeQuery constructor that takes a Collator but note the
> >>>>> performance warning in the javadocs.
> >>>>>
> >>>>>
> >>>>> --
> >>>>> Ian.
> >>>>>
> >>>>>
> >>>>> On Fri, Nov 26, 2010 at 2:18 PM, Amin Mohammed-Coleman <
> >> aminmc@gmail.com> wrote:
> >>>>>> Hi All
> >>>>>>
> >>>>>> I was wondering whether I can use TermRangeQuery for my use case.  I
> >> have a collection of ids (represented as XDF-123) and I would like to do
> a
> >> search for all the ids (might be in the range of 10000) and for each
> >> matching id I want to get the corresponding data that is stored in the
> index
> >> (for example the document contains id and string value).  I am using a
> >> custom collector to collect that string value for each match.  Is it ok
> to
> >> use a TermRangeQuery for the ids rather than creating a massive query
> >> string?
> >>>>>>
> >>>>>>
> >>>>>> Thanks
> >>>>>> Amin
> >>>>>>
> ---------------------------------------------------------------------
> >>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>>>
> >>>>>>
> >>>>>
> >>>>> ---------------------------------------------------------------------
> >>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>>
> >>>>
> >>>>
> >>>> ---------------------------------------------------------------------
> >>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>
> >>>>
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364ec8fe463d90049628fc0c--

From java-user-return-47944-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 07:03:18 2010
Return-Path: <java-user-return-47944-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62163 invoked from network); 29 Nov 2010 07:03:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 07:03:18 -0000
Received: (qmail 34590 invoked by uid 500); 29 Nov 2010 07:03:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34342 invoked by uid 500); 29 Nov 2010 07:03:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34334 invoked by uid 99); 29 Nov 2010 07:03:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 07:03:14 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bernd.fehling@uni-bielefeld.de designates 129.70.204.73 as permitted sender)
Received: from [129.70.204.73] (HELO mux2-unibi-smtp.hrz.uni-bielefeld.de) (129.70.204.73)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 07:03:07 +0000
MIME-version: 1.0
Content-transfer-encoding: 8BIT
Content-type: text/plain; charset=windows-1252
Received: from pmxchannel-daemon.mux2-unibi-smtp.hrz.uni-bielefeld.de by
 mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 id <0LCM00M00WWM4Q00@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Mon, 29 Nov 2010 08:02:46 +0100 (CET)
Received: from [129.70.11.68] ([129.70.11.68])
 by mux2-unibi-smtp.hrz.uni-bielefeld.de
 (Sun Java(tm) System Messaging Server 6.3-6.03 (built Mar 14 2008; 32bit))
 with ESMTPPSA id <0LCM00E7IWWMA530@mux2-unibi-smtp.hrz.uni-bielefeld.de> for
 java-user@lucene.apache.org; Mon, 29 Nov 2010 08:02:46 +0100 (CET)
Date: Mon, 29 Nov 2010 08:02:46 +0100
From: Bernd Fehling <bernd.fehling@uni-bielefeld.de>
Subject: Re: not indexing analyzed field
In-reply-to: <001001cb8e1e$b074f890$115ee9b0$@thetaphi.de>
To: java-user@lucene.apache.org
Message-id: <3472_1291014166_ZZh0d4b6ev5bR.00_4CF35016.6010003@uni-bielefeld.de>
X-EnvFrom: bernd.fehling@uni-bielefeld.de
X-PMX-Version: 5.5.9.395186, Antispam-Engine: 2.7.2.376379,
 Antispam-Data: 2010.11.29.65115, pmx7
X-Connecting-IP: 129.70.11.68
References:
 <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de>
 <006601cb8cc6$d89bbf10$89d33d30$@thetaphi.de>
 <27775_1290756209_ZZh0c3XiucqX9.00_4CEF6071.5080000@uni-bielefeld.de>
 <001001cb8e1e$b074f890$115ee9b0$@thetaphi.de>
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.1.15) Gecko/20101026
 SUSE/3.0.10 Thunderbird/3.0.10
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Uwe,

Erick explained it pretty well and i got it now, but generally you're right RTFM ;-)

Nevertheless I'm in the need of the functionality to change the stored
value during analysis or tokenization or filtering (what ever works).

Thats how it can be done in FAST FDS/ESP (full processing) compared
to Lucene/Solr (sparse processing).
Sure I can make a branch of the trunk and enhance the
"DocInverterPerField.processFields" class/method and change the line
"boolean hasMoreTokens = stream.incrementToken();"
but my hope is still that it is possible without touching the basic
Lucene code.

Do you have any idea, how to change the stored value during analysis or
tokenization or filtering?

Best regards,
Bernd


Am 27.11.2010 11:34, schrieb Uwe Schindler:
> You have to first understand the difference between "stored" and "indexed":
> 
> - For stored fields no analysis is done, as they are only stored (e.g. for
> display of retrieval results). These are simply copied unchanged to the
> index - and you cannot search on them.
> - Analysis is done on the "index" side, so the text is split up into tokens.
> So you won't see analysis occurring on the stored field contents (e.g. when
> you display the results using Lucene's IndexReader.document(int) or Solr's
> result structure). The indexed fields are used when you query the index. For
> queries to work, the search query is also analyzed and split up into tokens.
> These tokens are searched in the "index". This also implies, that the query
> and index analyzer needs to be compatible. And thats another problem in
> your schema, you don't have an query analyzer! So your searches would never
> hit any result!
> 
> I'd suggest to read a book about Lucene/Solr first :-)
> 
> Uwe
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
>> -----Original Message-----
>> From: Bernd Fehling [mailto:bernd.fehling@uni-bielefeld.de]
>> Sent: Friday, November 26, 2010 8:23 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: not indexing analyzed field
>>
>> Hi Uwe,
>>
>> my fieldType and fields are as follows:
>>
>> <fieldType name="text_md" class="solr.TextField" omitNorms="true" >
>>   <analyzer type="index"
>> class="de.ubbielefeld.solr.analysis.TextMessageDigestAnalyzer" />
> </fieldType>
>>
>> <!-- UNIQUE ID -->
>> <field name="id" type="string" indexed="true" stored="true"
> required="true" />
>> <field name="dcdocid" type="text_md" indexed="true" stored="true" />
>> <copyField source="id" dest="dcdocid" />
>>
>> So the field dcdocid has the attribute *stored* which I can also see in
> the
>> debugger.
>> Why should I analyze a stored field?
>> I don't know if I need to analyze it, I also tried a filter but also no
> success.
>>
>> My understanding is to send something to a field and the field has a
> processing
>> chain. The processing chain analyzes, filters, ... is doing something to
> the
>> content and then stores the content to that field in the index.
>>
>> May be it is a misunderstanding on my side about the field based
> processing
>> because I'm normally working with FAST search engines which is document
>> based.
>>
>> Best regards
>> Bernd
>>
>>
>>
>> Am 25.11.2010 18:33, schrieb Uwe Schindler:
>>> field.fieldsData is used for the stored field contents and so only
>>> *stored* in index, of course not analyzed (why should I analyze a
>>> stored field). The indexed tokens go of course through your analyzer
>>> and the returned tokens are indexed as terms. Where is the problem?
>>>
>>> -----
>>> Uwe Schindler
>>> H.-H.-Meier-Allee 63, D-28213 Bremen
>>> http://www.thetaphi.de
>>> eMail: uwe@thetaphi.de
>>>
>>>
>>>> -----Original Message-----
>>>> From: Bernd Fehling [mailto:bernd.fehling@uni-bielefeld.de]
>>>> Sent: Thursday, November 25, 2010 2:08 PM
>>>> To: java-user@lucene.apache.org
>>>> Subject: not indexing analyzed field
>>>>
>>>> I used KeywordAnalyzer and KeywordTokenizer as templates for a new
>>>> analyzer.
>>>> The analyzer works fine but the result never reaches the index.
>>>>
>>>> My analyzer is called in "DocInverterPerField.processFields"
>>>> with "stream.incrementToken()".
>>>> ...
>>>> try {
>>>>     boolean hasMoreTokens = stream.incrementToken();
>>>>
>>>>     fieldState.attributeSource = stream;
>>>>
>>>>     OffsetAttribute offsetAttribute =
>>>> fieldState.attributeSource.addAttribute(OffsetAttribute.class);
>>>>     PositionIncrementAttribute posIncrAttribute =
>>>> fieldState.attributeSource.addAttribute(PositionIncrementAttribute.cl
>>>> ass);
>>>>
>>>>     consumer.start(field);
>>>> ...
>>>>
>>>> The result goes to "fieldState.attributeSource" but is not in "field".
>>>> So "field.fieldsData" still has the old content before calling my
>>> analyzer. And
>>>> when calling "consumer.start(field)" the old content is going to the
>>>> index
>>> and
>>>> not the new analyzed one.
>>>> Does the analyzer has to care about "Fieldable field.fieldsData"
>>>> or who is responsible for it?
>>>>
>>>> Regards
>>>> Bernd
>>>>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47945-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 07:41:25 2010
Return-Path: <java-user-return-47945-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75298 invoked from network); 29 Nov 2010 07:41:24 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 07:41:24 -0000
Received: (qmail 47925 invoked by uid 500); 29 Nov 2010 07:41:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47666 invoked by uid 500); 29 Nov 2010 07:41:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47658 invoked by uid 99); 29 Nov 2010 07:41:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 07:41:21 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 07:41:12 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id CC16845F96B
	for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 08:40:52 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id bnB-N1Dvvmwy for <java-user@lucene.apache.org>;
	Mon, 29 Nov 2010 08:40:46 +0100 (CET)
Received: from VEGA (port-83-236-62-54.dynamic.qsc.de [83.236.62.54])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id C6CC945F3DE
	for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 08:40:45 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <8191_1290690499_ZZh0c2TxtFKts.00_4CEE5FC2.1060609@uni-bielefeld.de> <006601cb8cc6$d89bbf10$89d33d30$@thetaphi.de> <27775_1290756209_ZZh0c3XiucqX9.00_4CEF6071.5080000@uni-bielefeld.de> <001001cb8e1e$b074f890$115ee9b0$@thetaphi.de> <3472_1291014166_ZZh0d4b6ev5bR.00_4CF35016.6010003@uni-bielefeld.de>
In-Reply-To: <3472_1291014166_ZZh0d4b6ev5bR.00_4CF35016.6010003@uni-bielefeld.de>
Subject: RE: not indexing analyzed field
Date: Mon, 29 Nov 2010 08:41:17 +0100
Message-ID: <001501cb8f98$ceae4700$6c0ad500$@thetaphi.de>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Outlook 14.0
Thread-Index: AQI8CDXjZiYJrRyYxcrIP4XD1s+STAJ0CYY8AburkywChbIHbwE0ywiykmfNPYA=
Content-Language: de
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Bernd,


> Nevertheless I'm in the need of the functionality to change the stored
value
> during analysis or tokenization or filtering (what ever works).
> 
> Thats how it can be done in FAST FDS/ESP (full processing) compared to
> Lucene/Solr (sparse processing).
> 
> Do you have any idea, how to change the stored value during analysis or
> tokenization or filtering?

This is simply not possible or even wanted. Stored fields in Lucene are for
storing arbitrary values in the index (they don't even need to be strings).
With RTFM I mean, that you need to completely separate them in your head and
look a them differently. It's indeed not the best idea in Lucene (and Solr)
to provide them together and in one API to the user.

As stored fields are not processed at all, you can simply process then
*before* you put them into Lucene! Why do you want to do that in the
processing pipeline?

> Sure I can make a branch of the trunk and enhance the
> "DocInverterPerField.processFields" class/method and change the line
> "boolean hasMoreTokens = stream.incrementToken();"
> but my hope is still that it is possible without touching the basic Lucene
code.

I would never do this, and as noted above, its uneeded.

To e.g. store something different from what was being analyzed in Lucene,
just add the field two times with same name to o.a.l.d.Document. Once as
stored-only, once as indexed-only (internally that's exactly what Lucene is
also doing when you pass a combined stored/indexed field; stored fields and
indexed fields are completely different - and thats why you want to change
DocInverter).

If you are using Solr, there are also possibilities to do this, just
implement your own FieldType, that handles analysis and storing different.
E.g. TrieField in Solr works exactly like that (it indexes tokens as binary
terms and also stores them in a different format). Look at methods
to/fromExternal.

Uwe


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47946-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 08:02:10 2010
Return-Path: <java-user-return-47946-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81914 invoked from network); 29 Nov 2010 08:02:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 08:02:09 -0000
Received: (qmail 68081 invoked by uid 500); 29 Nov 2010 08:02:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67812 invoked by uid 500); 29 Nov 2010 08:02:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67801 invoked by uid 99); 29 Nov 2010 08:02:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 08:02:05 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of m4eclipse@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 08:01:58 +0000
Received: by qyk7 with SMTP id 7so1236232qyk.14
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 00:01:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=pi7eyRcrDQvI94f2xb5zs0rLxQdUrbP0nX66wLRaljY=;
        b=VXnsqeOlTEZKnrHqJLC75Zc28E2NFQizhftLHrWV2hfSd5EKFMs7CYPgJEZU9xMZ8x
         PFdYdAZKEtC+6tvh1t45aysrCJXxdt1Zx1PKPcYeoRDqH0hwuU3Oj1Uj76B9JUBYC+lm
         +FXZBazFQL/fwajraBR2SV2wgv0O1D6T2wR8c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=kT97qYtU6EKGEkpb044tpoX6GVgdhflHkIxZ0MWatxJe9ZTZkDUDXY1linP8sGshAT
         PjM7NbhSHPRJliGQYLxr2BkEcKS0ipufn5Nlw9B6py20tl6HzFAmNBkoZfU87y+G2HDZ
         URfJYwHJpw0EmoIl+Eur/ANIQt1ruLQVbL5Tw=
MIME-Version: 1.0
Received: by 10.224.176.197 with SMTP id bf5mr5012212qab.248.1291017697790;
 Mon, 29 Nov 2010 00:01:37 -0800 (PST)
Received: by 10.220.97.10 with HTTP; Mon, 29 Nov 2010 00:01:37 -0800 (PST)
Date: Mon, 29 Nov 2010 16:01:37 +0800
Message-ID: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com>
Subject: What is the difference between the "AND" and "+" operator?
From: yang Yang <m4eclipse@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=20cf302d4d624689c304962c7b2b

--20cf302d4d624689c304962c7b2b
Content-Type: text/plain; charset=ISO-8859-1

What is the difference between the "AND" and "+" operator?

ALso,what is the difference between a query and a filter?
For example
String[] fields={"name","address","classId"};
If I want to search the document whose classId is '4" and whose name or
address contain "Zhongzhou Road No 200",I can use two manner:
1) filter
Query q=new MKultipleFieldParser(.....).parse("Zhongzhou Road No 200");
new IndexSearcher(...).search(q,new TermFilter(new
Term("classId","4")),100);

ALso I can use:
Query q=new MKultipleFieldParser(.....).parse("Zhongzhou Road No 200");
Query classQ=new TermQuery(new Term("classId","4"));
Query all=new BooleanQuery();
all.add(q,Occur.MUST);
all.add(classQ,occur.Must);
new IndexSearcher(...).search(all,null,100);

What is the difference?

BTW,in the above exmaple,if I search "Zhongzhou Road No 200",I get no
result,however I can get some results if I search "Zhongzhou Road No
200",because there is not a term named "No" in the index.
And the search string are from client side,how to make the document contain
"Zhongzhou Road 200" can be returned when search "Zhongzhou Road No 200"?

--20cf302d4d624689c304962c7b2b--

From java-user-return-47947-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 08:24:43 2010
Return-Path: <java-user-return-47947-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93130 invoked from network); 29 Nov 2010 08:24:43 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 08:24:43 -0000
Received: (qmail 82768 invoked by uid 500); 29 Nov 2010 08:24:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82734 invoked by uid 500); 29 Nov 2010 08:24:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82726 invoked by uid 99); 29 Nov 2010 08:24:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 08:24:40 +0000
X-ASF-Spam-Status: No, hits=3.3 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,TRACKER_ID,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 08:24:35 +0000
Received: by wwb17 with SMTP id 17so1194398wwb.5
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 00:24:13 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=3BFHmLsaAolHTPSOQOrc062UzpLzki37oEgRBP0Zpb0=;
        b=TRgfXC+0VqD7Gx9qMvfwjH5TQyXdlOlhdrMeHYNOoUomik+QqMuCOsKzWsVtGzA/qg
         I8iwGdFHTIA6sGlQiD3NxoO1+9qrAz0oVbWachfGd/Vz2ytcQQtjzt5pmyeGeGpaAjoD
         Gfy7IxONOeFqjo6cz1uc5xT26KKDO6/Xcp+SY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=u3ZUMIZdZE6dy+lf/CfxW58AuHgKrgO5OIVzg24QkzYF2uNOhRcP3/cutM99XknryD
         rmsdnbgebWk3E6rblhy9kNicoHTH8ByeayBu3YnSt6dnwj2Rcry/tdxnhqMLd2TidMDE
         fCyPn2Wtf63E34ibjoPgYSGfb+ZlflAmwXjJ4=
Received: by 10.227.128.84 with SMTP id j20mr5492939wbs.206.1291019053339;
 Mon, 29 Nov 2010 00:24:13 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.149.6 with HTTP; Mon, 29 Nov 2010 00:23:52 -0800 (PST)
In-Reply-To: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com>
References: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Mon, 29 Nov 2010 13:53:52 +0530
Message-ID: <AANLkTi=QbrOy9prDWLFiL+OxzMfPasoz_RVrfW1WFj2R@mail.gmail.com>
Subject: Re: What is the difference between the "AND" and "+" operator?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364577501296fb04962ccc21

--0016364577501296fb04962ccc21
Content-Type: text/plain; charset=ISO-8859-1

Hi Yang,
About the difference between a filter and a query, the essential one is,
filter does not calculate score/relevance and so the sort would vary.
Also, having "No" to be escaped while query formation is, by using
appropriate query parser. You may also use an analyzer and search for all
terms as optional i.e. an OR query in conjunction with
setMinimumNumberShouldMatch
http://lucene.apache.org/java/3_0_1/api/core/org/apache/lucene/search/BooleanQuery.html#setMinimumNumberShouldMatch(int)
<http://lucene.apache.org/java/3_0_1/api/core/org/apache/lucene/search/BooleanQuery.html#setMinimumNumberShouldMatch(int)>Finally
all would depend on the case at hand and what you think is the
expected behavior of search.
Hope this helps.
--
Anshum Gupta
http://ai-cafe.blogspot.com


On Mon, Nov 29, 2010 at 1:31 PM, yang Yang <m4eclipse@gmail.com> wrote:

> What is the difference between the "AND" and "+" operator?
>
> ALso,what is the difference between a query and a filter?
> For example
> String[] fields={"name","address","classId"};
> If I want to search the document whose classId is '4" and whose name or
> address contain "Zhongzhou Road No 200",I can use two manner:
> 1) filter
> Query q=new MKultipleFieldParser(.....).parse("Zhongzhou Road No 200");
> new IndexSearcher(...).search(q,new TermFilter(new
> Term("classId","4")),100);
>
> ALso I can use:
> Query q=new MKultipleFieldParser(.....).parse("Zhongzhou Road No 200");
> Query classQ=new TermQuery(new Term("classId","4"));
> Query all=new BooleanQuery();
> all.add(q,Occur.MUST);
> all.add(classQ,occur.Must);
> new IndexSearcher(...).search(all,null,100);
>
> What is the difference?
>
> BTW,in the above exmaple,if I search "Zhongzhou Road No 200",I get no
> result,however I can get some results if I search "Zhongzhou Road No
> 200",because there is not a term named "No" in the index.
> And the search string are from client side,how to make the document contain
> "Zhongzhou Road 200" can be returned when search "Zhongzhou Road No 200"?
>

--0016364577501296fb04962ccc21--

From java-user-return-47948-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 09:25:39 2010
Return-Path: <java-user-return-47948-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12323 invoked from network); 29 Nov 2010 09:25:39 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 09:25:39 -0000
Received: (qmail 36970 invoked by uid 500); 29 Nov 2010 09:25:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36758 invoked by uid 500); 29 Nov 2010 09:25:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36750 invoked by uid 99); 29 Nov 2010 09:25:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 09:25:36 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,MIME_QP_LONG_LINE,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_NEUTRAL,UNPARSEABLE_RELAY
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [121.101.151.224] (HELO nm2.bullet.mail.in.yahoo.com) (121.101.151.224)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 29 Nov 2010 09:25:30 +0000
Received: from [121.101.151.236] by nm2.bullet.mail.in.yahoo.com with NNFMP; 29 Nov 2010 09:25:06 -0000
Received: from [121.101.151.233] by tm1.bullet.mail.in.yahoo.com with NNFMP; 29 Nov 2010 09:25:12 -0000
Received: from [127.0.0.1] by omp1002.mail.in.yahoo.com with NNFMP; 29 Nov 2010 09:25:05 -0000
X-Yahoo-Newman-Id: 818319.23128.bm@omp1002.mail.in.yahoo.com
Received: (qmail 54949 invoked from network); 29 Nov 2010 09:25:06 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.in;
  h=DKIM-Signature:Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE;
  b=u3TcNPJ/rD1LLgrCZ4o4UtYuRKShb77kkviI2W1QqpObdcbpS7YESsPJLfZeUg8Hc2j6EauBidiqYW58Yndq6mifmDm3xsB/JPrP3FbWjfl7oqNIAclj8yezLc4me7XumWbIb5gfcA2i0OxdJyz+rpsllnmSYE6LfOnWfZg0hq0=  ;
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.co.in; s=s1024; t=1291022706; bh=KD4dh0SAKjTYdN5aLl76lhZuU+ZEsmUIZEu3WCKOlqg=; h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE; b=oCgGFRQwbE1S7KWrLUcQCmRSEl3dtYTJrySKwfWZkcKpBrv3BeD1/fTgPnUpcnmeQZp3cK609QmG+qSoKjFOCHjp3FpltpOJfu03oTxU0rzFqKz1zMcSltq8zJTzBwOzP9LqupmqCoyXBoEdTnytcu8BbIagqq8VmkL2T1yWHkA=
Received: from GaneshM (emailgane@121.244.159.130 with login)
        by smtp102.mail.in.yahoo.com with SMTP; 29 Nov 2010 14:55:06 +0530 IST
X-Yahoo-SMTP: JObyHkuswBBrNSLZp.Ycd7Boqpr_GQ--
X-YMail-OSG: NWNJ.pwVM1lG_sYFia4QNu5iJ8NBqm3kruvig9KTL3QCpFp
 afEo_kfnGqeafg3cNpZF3Air_umlt5MmdSOqt5b3yLbuM0kd0PobMUJEWGR5
 7rQ7R2uP6BsjNJxmPZw0U8GE0HpJrWOOXdH5OceuL9wBsDc6g2d0oVrRtyPu
 hZ9TChBArLKkYHsZ9PFbliOTTxodQtzdHqNpRlCeSqp..Mz.K4VVTkBHq.IO
 P0IUm2YOzzdmS5we7NWRuJZ2cx9sKiJQ92.En6teJXo4sktk87g--
X-Yahoo-Newman-Property: ymail-3
Message-ID: <FEE5459EC7B341F39D397F10588EE960@sv.us.sonicwall.com>
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com> <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com> <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com> <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com> <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com> <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com> <010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de> <AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com> <011001cb8a6d$900de850$b029b8f0$@thetaphi.de> <AANLkTi=kxH+Dgwk1FwBjGEiMfbLXyrOWJqUspmUt6M2k@mail.gmail.com> <007f01cb8d92$50f2c460$f2d84d20$@thetaphi.de> <AANLkTik7GhNNgCFTtzQOTwffQ+hqxe0czm-4LSMJNKuK@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
Date: Mon, 29 Nov 2010 14:55:10 +0530
MIME-Version: 1.0
Content-Type: text/plain;
	charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.5931
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5931

I am using ParallelMultiSearcher and querying more than 50 shards. I get =
wrong results for query A NOT B. I am getting correct results if i query =
A -B.=20
I am also getting correct results for wildcard and fuzzy.

What is the solution? I need to use IndexSearcher with MultiReader?

Regards
Ganesh

----- Original Message -----=20
From: "Robert Muir" <rcmuir@gmail.com>
To: <java-user@lucene.apache.org>
Sent: Saturday, November 27, 2010 1:28 AM
Subject: Re: best practice: 1.4 billions documents


> On Fri, Nov 26, 2010 at 12:49 PM, Uwe Schindler <uwe@thetaphi.de> =
wrote:
>> This is the problem for Fuzzy: each searcher expands the fuzzy query =
to a
>> different Boolean Query and so the scores are not comparable - =
MultiSearcher
>> (but not Solr) tries to combine the resulting rewritten queries into =
one
>> query, so every searcher has the same query.
>=20
> The problem is not actually any issue with FuzzyQuery, it is the
> Query.combine() with any Boolean rewrite... including AUTO as i
> mentioned earlier in this thread!
>=20
> AUTO starts out building a boolean rewrite... if certain magical
> conditions are hit (exceeds certain number of terms, or certain DF),
> then it switches over to a Filter.
>=20
> So, for example AUTO proclaims it will never hit boolean maxclauses
> exceeded exception, but it can (imagine multisearcher with 5
> searchers, it expands to 250 each, but then after combine() this is >
> 1024).
>=20
> In my opinion Query.combine() is completely broken, and i don't see
> how it can really be fixed to work with arbitrary query structures
> since a query might rewrite() differently on the different searchers.
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
Send free SMS to your Friends on Mobile from your Yahoo! Messenger. Download Now! http://messenger.yahoo.com/download.php

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47949-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 09:27:07 2010
Return-Path: <java-user-return-47949-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12586 invoked from network); 29 Nov 2010 09:27:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 09:27:07 -0000
Received: (qmail 40289 invoked by uid 500); 29 Nov 2010 09:27:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40153 invoked by uid 500); 29 Nov 2010 09:27:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40145 invoked by uid 99); 29 Nov 2010 09:27:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 09:27:04 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 09:26:59 +0000
Received: by bwz9 with SMTP id 9so4156006bwz.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 01:26:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=uKZw+avzROviwyg7jDK2ZRlCoh4u+IpVneYjU0VT6As=;
        b=Su/sdAzhJc2wHcKlvngKOlCIAkXjXzeNqkWtAb0WqzaXcXfw53VbcpRvyyuiNZdRl7
         MgssnXwHnlQksDb9hizXeoj6wP/bfj0wxUeAQmnqlOzJQ83/bpKPtOa3dRFHYDhUUqNI
         qvVsg7QVtP63cXEmVouQ/vlkjnJtj6ci6Fa9U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=acHU+WnWbdvOkU6AEG8bBESUT3oELKtxBbkaYDJhFARKWK5hQRAC9P84qpBCIqXqEa
         9VF2Epue7XdsCaFGm3sbJwB/qs542bfsXegpKe+6EOd/5N+FdD5yTSDhitdC1dPervUF
         dwD7KIzwcY2tuMGe3YTQ6MajNwAdEd4JTl8Ag=
Received: by 10.204.98.15 with SMTP id o15mr4543121bkn.136.1291022796231; Mon,
 29 Nov 2010 01:26:36 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Mon, 29 Nov 2010 01:26:15 -0800 (PST)
In-Reply-To: <AANLkTi=QbrOy9prDWLFiL+OxzMfPasoz_RVrfW1WFj2R@mail.gmail.com>
References: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com> <AANLkTi=QbrOy9prDWLFiL+OxzMfPasoz_RVrfW1WFj2R@mail.gmail.com>
From: maven apache <apachemaven0@gmail.com>
Date: Mon, 29 Nov 2010 17:26:15 +0800
Message-ID: <AANLkTinZ1OUeod_dctJtauc72d_Kg2egwPB41u_5wA3_@mail.gmail.com>
Subject: Re: What is the difference between the "AND" and "+" operator?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f85aec2a94b504962dab75

--001485f85aec2a94b504962dab75
Content-Type: text/plain; charset=ISO-8859-1

2010/11/29 Anshum <anshumg@gmail.com>

> Hi Yang,
> About the difference between a filter and a query, the essential one is,
> filter does not calculate score/relevance and so the sort would vary.
>
Thanks,got it.
Is any performance between them?


> Also, having "No" to be escaped while query formation is, by using
> appropriate query parser.


In fact, I am working with the Chinese characters search.

So I am using the IKAnalyzer at http://code.google.com/p/ik-analyzer/.

And I use the built-in IKQueryParser.




> You may also use an analyzer and search for all
> terms as optional i.e. an OR query in conjunction with
> setMinimumNumberShouldMatch
>
> http://lucene.apache.org/java/3_0_1/api/core/org/apache/lucene/search/BooleanQuery.html#setMinimumNumberShouldMatch(int)<http://lucene.apache.org/java/3_0_1/api/core/org/apache/lucene/search/BooleanQuery.html#setMinimumNumberShouldMatch%28int%29>
> <
> http://lucene.apache.org/java/3_0_1/api/core/org/apache/lucene/search/BooleanQuery.html#setMinimumNumberShouldMatch(int)<http://lucene.apache.org/java/3_0_1/api/core/org/apache/lucene/search/BooleanQuery.html#setMinimumNumberShouldMatch%28int%29>
> >


:(.
Since I am using the hibernate search3.2.1,its lucene model is 2.9.3...

> Finally
> all would depend on the case at hand and what you think is the
> expected behavior of search.
> Hope this helps.
> --
> Anshum Gupta
> http://ai-cafe.blogspot.com
>
>
> On Mon, Nov 29, 2010 at 1:31 PM, yang Yang <m4eclipse@gmail.com> wrote:
>
> > What is the difference between the "AND" and "+" operator?
> >
> > ALso,what is the difference between a query and a filter?
> > For example
> > String[] fields={"name","address","classId"};
> > If I want to search the document whose classId is '4" and whose name or
> > address contain "Zhongzhou Road No 200",I can use two manner:
> > 1) filter
> > Query q=new MKultipleFieldParser(.....).parse("Zhongzhou Road No 200");
> > new IndexSearcher(...).search(q,new TermFilter(new
> > Term("classId","4")),100);
> >
> > ALso I can use:
> > Query q=new MKultipleFieldParser(.....).parse("Zhongzhou Road No 200");
> > Query classQ=new TermQuery(new Term("classId","4"));
> > Query all=new BooleanQuery();
> > all.add(q,Occur.MUST);
> > all.add(classQ,occur.Must);
> > new IndexSearcher(...).search(all,null,100);
> >
> > What is the difference?
> >
> > BTW,in the above exmaple,if I search "Zhongzhou Road No 200",I get no
> > result,however I can get some results if I search "Zhongzhou Road No
> > 200",because there is not a term named "No" in the index.
> > And the search string are from client side,how to make the document
> contain
> > "Zhongzhou Road 200" can be returned when search "Zhongzhou Road No 200"?
> >
>

--001485f85aec2a94b504962dab75--

From java-user-return-47950-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 09:32:21 2010
Return-Path: <java-user-return-47950-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13960 invoked from network); 29 Nov 2010 09:32:21 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 09:32:21 -0000
Received: (qmail 46127 invoked by uid 500); 29 Nov 2010 09:32:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45809 invoked by uid 500); 29 Nov 2010 09:32:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45801 invoked by uid 99); 29 Nov 2010 09:32:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 09:32:18 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of manjula53@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 09:32:10 +0000
Received: by qwc9 with SMTP id 9so2149423qwc.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 01:31:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=PnXtkqgZZ3h/Fg5zcsUizL7eviuaKrOEAYtOGSAXW6I=;
        b=iI4ClP1F9s5UiwL+CdWBqllBJoscwF+bJ/532ImkXcuPFRqyeszWlPaPUz02vK0wli
         SAmKeZtPUq++WZCr3zvtxlmGrYa++7uTaLhtXo8dCTbX87XKOMu+yY6Y7nMF4ijsThkn
         dgq5jk4oeUY3dgQFhTcZFo3SyX3d2l6L/9s6s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=hub0MVNP7dE+DMBI6chh6RD26bMc67bGJPpvMTjShZigcQeSSN2Z0CQT5/DViP3EXk
         u+/4GcjNq12/LVrVcbKe2lN52X2yX6vGLsR8L8THY/GUo8e5NyRyvNBuv++//k0KdZ1B
         2s7r0U0UqXC1VhduMmdDCRx2tnF35BMWGF4pk=
MIME-Version: 1.0
Received: by 10.224.28.213 with SMTP id n21mr5250231qac.64.1291023109441; Mon,
 29 Nov 2010 01:31:49 -0800 (PST)
Received: by 10.220.186.70 with HTTP; Mon, 29 Nov 2010 01:31:49 -0800 (PST)
Date: Mon, 29 Nov 2010 15:01:49 +0530
Message-ID: <AANLkTimzdzDrLyC=_83KR_Hv8GZgVBVNu-CUB63hXkxn@mail.gmail.com>
Subject: Analyzer
From: manjula wijewickrema <manjula53@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517503b26d5c81504962dbd3c
X-Virus-Checked: Checked by ClamAV on apache.org

--001517503b26d5c81504962dbd3c
Content-Type: text/plain; charset=ISO-8859-1

Hi,

In my work, I am using Lucene and two java classes. In the first one, I
index a document and in the second one, I try to search the most relevant
document for the indexed document in the first one. In the first java class,
I use the SnowballAnalyzer in the createIndex method and StandardAnalyzer in
the searchIndex method and pass the highest frequency terms into the second
Java class. In the second class, I use SnowballAnalyzer in the createIndex
method (this index is for the collection of documents to be searched, or it
is my database) and StandardAnalyser in the searchIndex method (I pass the
highest frequently occuring term of the first class as the search term
parameter to the searchIndex method of the second class). Using Analyzers in
this manner, what I am willing is to do the stemming, stop-words in both
indexes (in both classes) and to search those a few high frequency words (of
the first index) in the second index. So, if my intention is clear to you,
could you please let me know whether it is correct or not the way I have
used Analyzers? I highly appreciate any comment.

Thanx.
Manjula.

--001517503b26d5c81504962dbd3c--

From java-user-return-47951-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 10:02:13 2010
Return-Path: <java-user-return-47951-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19201 invoked from network); 29 Nov 2010 10:02:13 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 10:02:13 -0000
Received: (qmail 67374 invoked by uid 500); 29 Nov 2010 10:02:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67199 invoked by uid 500); 29 Nov 2010 10:02:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67191 invoked by uid 99); 29 Nov 2010 10:02:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 10:02:09 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 10:02:01 +0000
Received: by wwb17 with SMTP id 17so1281930wwb.5
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 02:01:40 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.175.196 with SMTP id z46mr5492242wel.9.1291024900304; Mon,
 29 Nov 2010 02:01:40 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Mon, 29 Nov 2010 02:01:40 -0800 (PST)
In-Reply-To: <201011291150315581133@gmail.com>
References: <201011291150315581133@gmail.com>
Date: Mon, 29 Nov 2010 05:01:40 -0500
Message-ID: <AANLkTimOkogwwC457ZONFZFt_LP=JTOmd2ewKzC-oeW2@mail.gmail.com>
Subject: Re: How to Cache Filter Results between Servers
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

IndexReader does not implement hashCode, so it falls back to
Object.hashCode which means even if you open an IndexReader on the
same index, each one will get a different hashCode.

Note that modern versions of Lucene do per-segment searching, which
means the toplevel MultiReader is never sent to the Filter.getDocIdSet
(each sub-reader is sent, instead).

Assuming the Filter doesn't use any "external state", then, yes, the
same index on on another server using the same Filter will get the
same docIdSet.

You could implement your own CachingWrapperFilter that hashes/equals
based only on the SegmentInfo behind the sub-reader?  Just take care
to do the right thing w/ deletions, if your app uses deletions...

Mike

On Sun, Nov 28, 2010 at 10:50 PM, Sariny <sariny@gmail.com> wrote:
> hello everyone
>
> =A0 =A0 =A0 =A0 =A0 =A0I have this test code:
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0IndexReader ir =3D getReader();
> =A0 =A0 =A0 =A0TermQuery q =3D new TermQuery(new Term("sub_id",NumericUti=
ls.intToPrefixCoded(57)));
>
> =A0 =A0 =A0 =A0Filter f =3D new QueryWrapperFilter(q);
> =A0 =A0 =A0 =A0try
> =A0 =A0 =A0 =A0{
> =A0 =A0 =A0 =A0 =A0 =A0DocIdSet s =3D f.getDocIdSet(ir);
>
> =A0 =A0 =A0 =A0 =A0 =A0DocIdSetIterator i =3D s.iterator();
> =A0 =A0 =A0 =A0 =A0 =A0while(i.nextDoc() !=3D DocIdSetIterator.NO_MORE_DO=
CS)
> =A0 =A0 =A0 =A0 =A0 =A0{
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.println(i.docID());
> =A0 =A0 =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(f.hashCode());
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(s.hashCode());
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(ir.hashCode());
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(ir.getFieldCacheKey().hashCode(=
));
> =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0catch (IOException e)
> =A0 =A0 =A0 =A0{
> =A0 =A0 =A0 =A0 =A0 =A0e.printStackTrace();
> =A0 =A0 =A0 =A0}
>
>
> =A0 =A0 =A0 1. getReader() returns a MultiReader may consist of =A0severa=
l IndexReaders, in my test case ,only consist of one IndexReader
> =A0 =A0 =A0 =A0 =A0 2. index files won't change
>
> =A0 =A0 =A0 =A0 =A0assuming that index files won't be updated, and my que=
stion is :
>
> =A0 =A0 =A0 =A0 =A01. why ir.hashCode() returns different value every tim=
e I run this code?
> =A0 =A0 =A02. if I copy the index file to another server ,and they provid=
e search service together,will f.getDocIdSet(ir) return the same DocIdSet? =
if true,how to cache filter results and share between the 2 servers? =A0how=
 to form a cache key not influenced by question 1?
>
>
>
> =A0 =A0 =A0 =A0 =A0Thanks ~~
>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47952-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 10:04:18 2010
Return-Path: <java-user-return-47952-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19477 invoked from network); 29 Nov 2010 10:04:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 10:04:18 -0000
Received: (qmail 69789 invoked by uid 500); 29 Nov 2010 10:04:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69600 invoked by uid 500); 29 Nov 2010 10:04:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69592 invoked by uid 99); 29 Nov 2010 10:04:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 10:04:13 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.215.48] (HELO mail-ew0-f48.google.com) (209.85.215.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 10:04:07 +0000
Received: by ewy9 with SMTP id 9so1893541ewy.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 02:03:46 -0800 (PST)
MIME-Version: 1.0
Received: by 10.216.0.79 with SMTP id 57mr5350619wea.39.1291025026136; Mon, 29
 Nov 2010 02:03:46 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Mon, 29 Nov 2010 02:03:46 -0800 (PST)
In-Reply-To: <AANLkTimTuZmqCtTwK37t3fvi_dq+XMZCerDQSUcZvDqR@mail.gmail.com>
References: <90362ECB07906C40A0297F9D5211A24323C3CBEA71@ITSEMBXCLUS.enterprise.gcal.ac.uk>
	<AANLkTimTuZmqCtTwK37t3fvi_dq+XMZCerDQSUcZvDqR@mail.gmail.com>
Date: Mon, 29 Nov 2010 05:03:46 -0500
Message-ID: <AANLkTikR5LgZnW0h=9PejETskymqDZ-pRh7w7OehGhD_@mail.gmail.com>
Subject: Re: IndexWriter Class
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=GB2312
Content-Transfer-Encoding: quoted-printable

Please don't hijack threads; start a new thread instead.

Mike

2010/11/28 jiandong yang <jdyangchina@gmail.com>:
> hello, all, here comes my question:
> as far as I know,  lucene now offer the feature that ones can search some
> doc while the index which contains that specific doc is modifying.
> for example(pseudocode) :
>
> while indexWriter(indexDir).add(docA)  is doing, can indexReader(indexDir=
)
> offer the query function?
>
> after the add is done, should the reader be reopen?
>
> or someone show me a simple example, thx a lot!!!
>
> --
> =D7=A3=D2=BB=C7=D0=CB=B3=C0=FB~
>
> Best Regards,
>
> =D1=EE=BD=A8=B6=AB
>
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D
>
> Jiandong Yang
> Mobile Phone:15921536660
> email: yangjiandong@snda.com
> Architect management office
>
>
> Shanghai shanda networking development Co., LTD
>
> Shanghai 201203, P. R. China
>
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47953-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 10:10:51 2010
Return-Path: <java-user-return-47953-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29009 invoked from network); 29 Nov 2010 10:10:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 10:10:51 -0000
Received: (qmail 78949 invoked by uid 500); 29 Nov 2010 10:10:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78769 invoked by uid 500); 29 Nov 2010 10:10:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78753 invoked by uid 99); 29 Nov 2010 10:10:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 10:10:47 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,RFC_ABUSE_POST,SPF_NEUTRAL,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [77.238.189.216] (HELO nm15-vm0.bullet.mail.ird.yahoo.com) (77.238.189.216)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 29 Nov 2010 10:10:36 +0000
Received: from [77.238.189.231] by nm15.bullet.mail.ird.yahoo.com with NNFMP; 29 Nov 2010 10:10:14 -0000
Received: from [212.82.108.112] by tm12.bullet.mail.ird.yahoo.com with NNFMP; 29 Nov 2010 10:10:14 -0000
Received: from [127.0.0.1] by omp1021.mail.ird.yahoo.com with NNFMP; 29 Nov 2010 10:10:14 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 705109.62100.bm@omp1021.mail.ird.yahoo.com
Received: (qmail 75567 invoked by uid 60001); 29 Nov 2010 10:10:14 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.co.uk; s=s1024; t=1291025414; bh=0WTWIegNO6pcd+LZSXWoDnSiTXdRWGAQZA4X5UKlkiE=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=30ekXtbv6fBY45k28uiO4euiKH5Ke6ep3RqT7cvouAqa+MPGotnuu0a2jT4bPGSuJ7e50CCf/FjVGpp3yR2VMxYGXAKq8q3cOGappo3otcSQn+Lh8Rogl+eJrnNYzGkpc9B0MBHHkV1aTJPWaCJysKbhxBZ6FQxhf4c1NcBN4Bo=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.uk;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=SDb1aDAf2rf9jZY8cNxDjVdSlz+CLRvyI4PxAOPgL/Qs+WiQTKZ042tOX1gu+OAYtkzoMlPkjfyUnlgBrKy0KPjh1wBLW67m0B7+b8NWbwOUtSTakvD2Uqp0hc4mIBuwtNC75hyW/Er4dcG+yMWuyt9uEbZr9ZI51MyM85kAd04=;
Message-ID: <600537.74408.qm@web29003.mail.ird.yahoo.com>
X-YMail-OSG: U3d1bpgVM1ne1cQutIySuQcVntfMHj2tiA8tjhcC0JRpsZ3
 ROhC_5j2snn1KOPTwQWjCMkggC9zygI.fW2g_TO6O0Xyi4u10oEw69v01tn2
 CxenuB2N1i.q11Vqz9cAHdGfvX8_QQk6R0s0nH2UvbZd_hu_pusY4Ckc87kP
 gm5Vsd.U.wk31LbDmKuoJ6raiyG2DwqMniFsmr.fasP5H2NNh7gRx5.6l.ey
 Mg8Okpsp3TMttoD8WjEv0wqcRSd9Klje0b8OGNkW_rj7_twtaiV.XwMDyrGX
 2weVKU0YBG3mRNmM9Zt52as.yS6l.EFlgy7YtDKF_5BpRY263wCR5bk12tGL
 O69y7mZPBM2EvDaVeSrM-
Received: from [194.116.198.179] by web29003.mail.ird.yahoo.com via HTTP; Mon, 29 Nov 2010 10:10:14 GMT
X-Mailer: YahooMailRC/553 YahooMailWebService/0.8.107.285259
References: <201011291150315581133@gmail.com>
Date: Mon, 29 Nov 2010 10:10:14 +0000 (GMT)
From: mark harwood <markharw00d@yahoo.co.uk>
Subject: Re: How to Cache Filter Results between Servers
To: java-user@lucene.apache.org
In-Reply-To: <201011291150315581133@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

>>              1. why ir.hashCode() returns different value every time I r=
un this =0A>>code?=0A=0APresumably because it is a different object instanc=
e in a different JVM? =0AIndexReader.hashCode() and IndexReader.equals() ar=
e not designed to =0Arepresent/summarise the physical contents of an index.=
=0AThey are only used to determine the same instance of a Java object e.g. =
so that =0Acached items created from one IndexReader can recognise that the=
 same =0AIndexReader instance is still in use in the JVM when the cache is =
queried with a =0Agiven reader as context.=0A=0ACheers=0AMark=0A=0A=0A-----=
 Original Message ----=0AFrom: Sariny <sariny@gmail.com>=0ATo: java-user <j=
ava-user@lucene.apache.org>=0ASent: Mon, 29 November, 2010 3:50:34=0ASubjec=
t: How to Cache Filter Results between Servers=0A=0Ahello everyone=0A=0A   =
     I have this test code:=0A=0A        IndexReader ir =3D getReader(); =
=0A        TermQuery q =3D new TermQuery(new =0ATerm("sub_id",NumericUtils.=
intToPrefixCoded(57)));=0A        =0A        Filter f =3D new QueryWrapperF=
ilter(q);=0A        try=0A        {=0A            DocIdSet s =3D f.getDocId=
Set(ir);=0A=0A            DocIdSetIterator i =3D s.iterator();=0A          =
  while(i.nextDoc() !=3D DocIdSetIterator.NO_MORE_DOCS)=0A            {=0A =
               System.out.println(i.docID());=0A            }=0A=0A        =
    System.out.println(f.hashCode());=0A            System.out.println(s.ha=
shCode());=0A            System.out.println(ir.hashCode());=0A            S=
ystem.out.println(ir.getFieldCacheKey().hashCode());=0A        }=0A        =
catch (IOException e)=0A        {=0A            e.printStackTrace();=0A    =
    }=0A=0A=0A       1. getReader() returns a MultiReader may consist of  s=
everal =0AIndexReaders, in my test case ,only consist of one IndexReader=0A=
       2. index files won't change =0A=0A      assuming that index files wo=
n't be updated, and my question is : =0A        =0A      1. why ir.hashCode=
() returns different value every time I run this code?=0A      2. if I copy=
 the index file to another server ,and they provide search =0Aservice toget=
her,will f.getDocIdSet(ir) return the same DocIdSet? if true,how to =0Acach=
e filter results and share between the 2 servers?  how to form a cache key =
=0Anot influenced by question 1?=0A=0A=0A=0A      Thanks ~~=0A=0A          =
                                                                      =0A  =
                                                                           =
   =0A              =0A=0A=0A=0A=0A----------------------------------------=
-----------------------------=0ATo unsubscribe, e-mail: java-user-unsubscri=
be@lucene.apache.org=0AFor additional commands, e-mail: java-user-help@luce=
ne.apache.org=0A=0A=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47954-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 11:06:09 2010
Return-Path: <java-user-return-47954-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50970 invoked from network); 29 Nov 2010 11:06:09 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 11:06:09 -0000
Received: (qmail 39088 invoked by uid 500); 29 Nov 2010 11:06:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38856 invoked by uid 500); 29 Nov 2010 11:06:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38848 invoked by uid 99); 29 Nov 2010 11:06:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 11:06:05 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 11:06:00 +0000
Received: by bwz9 with SMTP id 9so4232333bwz.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 03:05:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=2EY4imVLELFvywBTeVHrPbOU1BLCAg+N0LK5kl22VBI=;
        b=VcfIRyM+gJHPmoFpiAwEVKgWh8apjhlIF86Y4GjDpuynkWdflfE1TTlDS4ygseHFAS
         h7efZRc4GYsuaaFlnAV1OV7jABNMpxgm66DA92g8IJ6AcUYYyxX8hvdS8nzfAOwSXGXP
         cqI6zne3YhLguLFFRX2xSfebwdlF8zG5y8d4k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Bl5z3H3YxM6I+3k8pwV3zt/phz6v4g1hE3Px7QUfqmFMgbPwxDg25tlWO9e7F0zFxp
         ZNyLqB3koW0ZX5ZbaZ0DyHvIMFHsMMaOFGrMBTgki6QI/TnkQoXuB8TO6dqJ6hwM1ILv
         3uaZ5kBV4i0GCVGTenaJnM+V3qMbEEK3WL8zw=
Received: by 10.204.72.80 with SMTP id l16mr4636794bkj.133.1291028738918; Mon,
 29 Nov 2010 03:05:38 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Mon, 29 Nov 2010 03:05:18 -0800 (PST)
In-Reply-To: <FEE5459EC7B341F39D397F10588EE960@sv.us.sonicwall.com>
References: <AANLkTi=zbHP+pPjdCirMWFEvQ5jRt7-siH+ZfoyaNE4o@mail.gmail.com>
 <AANLkTi=BqxCW8OEFJcAGqtK3dyhROOR=nifwObAx5a9=@mail.gmail.com>
 <AANLkTik-Mag0ZHC9Y6gLKmU2ODORxfACDO6V514J1wmm@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F9424@buf-ex02.cymfony.com>
 <AANLkTi=XvkmzuEtHgYVkhF-yyt3i--BMHn2f_gZfpWgx@mail.gmail.com>
 <E5331E53F021E443B53EC78F375B3C761F943B@buf-ex02.cymfony.com>
 <00e401cb8a60$f390d5c0$dab28140$@thetaphi.de> <AANLkTinNd27F8_PTBvhmeiErNo68JqNVyGsK5ZpjmaB0@mail.gmail.com>
 <010601cb8a69$1a2e1d20$4e8a5760$@thetaphi.de> <AANLkTimFtfti0jpBrXgSBBoErwk4jkYcu-nd7hwqpGFV@mail.gmail.com>
 <011001cb8a6d$900de850$b029b8f0$@thetaphi.de> <AANLkTi=kxH+Dgwk1FwBjGEiMfbLXyrOWJqUspmUt6M2k@mail.gmail.com>
 <007f01cb8d92$50f2c460$f2d84d20$@thetaphi.de> <AANLkTik7GhNNgCFTtzQOTwffQ+hqxe0czm-4LSMJNKuK@mail.gmail.com>
 <FEE5459EC7B341F39D397F10588EE960@sv.us.sonicwall.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 29 Nov 2010 11:05:18 +0000
Message-ID: <AANLkTik4dW25tNLNSxgdKW5Lns5zLJ+5Rd+XgcGJLbXY@mail.gmail.com>
Subject: Re: best practice: 1.4 billions documents
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Yes, try a searcher on top of a MultiReader.  But I would have thought
that "A NOT B" and "A -B" were equivalent so you may other issues.  If
so, post again in a new thread - with details, after switching to
MultiReader, if the problem persists.


--
Ian.


On Mon, Nov 29, 2010 at 9:25 AM, Ganesh <emailgane@yahoo.co.in> wrote:
> I am using ParallelMultiSearcher and querying more than 50 shards. I get wrong results for query A NOT B. I am getting correct results if i query A -B.
> I am also getting correct results for wildcard and fuzzy.
>
> What is the solution? I need to use IndexSearcher with MultiReader?
>
> Regards
> Ganesh
>
> ----- Original Message -----
> From: "Robert Muir" <rcmuir@gmail.com>
> To: <java-user@lucene.apache.org>
> Sent: Saturday, November 27, 2010 1:28 AM
> Subject: Re: best practice: 1.4 billions documents
>
>
>> On Fri, Nov 26, 2010 at 12:49 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>>> This is the problem for Fuzzy: each searcher expands the fuzzy query to a
>>> different Boolean Query and so the scores are not comparable - MultiSearcher
>>> (but not Solr) tries to combine the resulting rewritten queries into one
>>> query, so every searcher has the same query.
>>
>> The problem is not actually any issue with FuzzyQuery, it is the
>> Query.combine() with any Boolean rewrite... including AUTO as i
>> mentioned earlier in this thread!
>>
>> AUTO starts out building a boolean rewrite... if certain magical
>> conditions are hit (exceeds certain number of terms, or certain DF),
>> then it switches over to a Filter.
>>
>> So, for example AUTO proclaims it will never hit boolean maxclauses
>> exceeded exception, but it can (imagine multisearcher with 5
>> searchers, it expands to 250 each, but then after combine() this is >
>> 1024).
>>
>> In my opinion Query.combine() is completely broken, and i don't see
>> how it can really be fixed to work with arbitrary query structures
>> since a query might rewrite() differently on the different searchers.
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
> Send free SMS to your Friends on Mobile from your Yahoo! Messenger. Download Now! http://messenger.yahoo.com/download.php
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47955-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 12:16:18 2010
Return-Path: <java-user-return-47955-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75381 invoked from network); 29 Nov 2010 12:16:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 12:16:18 -0000
Received: (qmail 17505 invoked by uid 500); 29 Nov 2010 12:16:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17419 invoked by uid 500); 29 Nov 2010 12:16:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17405 invoked by uid 99); 29 Nov 2010 12:16:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 12:16:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ni.thiebaud@gmail.com designates 74.125.82.42 as permitted sender)
Received: from [74.125.82.42] (HELO mail-ww0-f42.google.com) (74.125.82.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 12:16:07 +0000
Received: by wwf26 with SMTP id 26so128300wwf.5
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 04:15:47 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:content-type;
        bh=N2aqWjylS6ALQCv45qrBYV0fVK7Mf2yLhNhwoWxSwL4=;
        b=ksV/BopeSQGAISTVxQlffRkKIRw5YxghPcy0/xH0wmKNNJH7O5fEitseoZy4FUglXz
         yPjagki42ifLyWV/UA/6thf7as6/g8P6+JuZ2T+dprRb8/FwOVhDjAAlrkBsf6MX1KhD
         5ydgEMaXlNZwR3LRP3DL1yMQPvFrl6FwtOXjY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=A1wSfpL7Xwt7Vo/0OFAmTaIBIW4XvLm76T+91+7f2mIq4tkIldEOPV5d8oUVyeb2l1
         ddLj6PVzgmkoKNBm6EM9QzxB3pSPazLsAz4+FYAebt08F14k2mU/bNJliCV5sEKhhp4U
         Gzn1lDiPkJeywnWQQrj6qAcDSJSKizovRSlLU=
MIME-Version: 1.0
Received: by 10.216.50.11 with SMTP id y11mr4845857web.57.1291032946956; Mon,
 29 Nov 2010 04:15:46 -0800 (PST)
Received: by 10.216.12.83 with HTTP; Mon, 29 Nov 2010 04:15:46 -0800 (PST)
Date: Mon, 29 Nov 2010 13:15:46 +0100
Message-ID: <AANLkTikUcmqFv_rsAu4Xx+Xthg1s-z=c=rrne8ULS3qO@mail.gmail.com>
Subject: Attributes and scoring
From: =?ISO-8859-1?Q?Nicolas_Thi=E9baud?= <ni.thiebaud@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6dbe8023259de0496300882
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6dbe8023259de0496300882
Content-Type: text/plain; charset=ISO-8859-1

Hi everybody,

I'm a bit confused and didn't find a clearly stated answer in the
documentation.

While analyzing text, Token filters can add data, or custom data to token by
the means of Attributes (ex: TypeAttribute, OffsetAttribute, etc..). This
information is available to the following filters, but my question is, what
makes it to the index ? Do these attributes affect the scoring ?

My understanding is that scoring is only based on *tf-idf* criterion with *
coord(q,d) *(for which I didn't find documentation) and* normalization*. How
is term proximity influencing search results for example ?

Thanks for your help, any reading material is appreciated.

Nicolas.

--0016e6dbe8023259de0496300882--

From java-user-return-47956-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 13:01:42 2010
Return-Path: <java-user-return-47956-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92458 invoked from network); 29 Nov 2010 13:01:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 13:01:42 -0000
Received: (qmail 63475 invoked by uid 500); 29 Nov 2010 13:01:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63145 invoked by uid 500); 29 Nov 2010 13:01:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63137 invoked by uid 99); 29 Nov 2010 13:01:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 13:01:38 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [74.125.83.48] (HELO mail-gw0-f48.google.com) (74.125.83.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 13:01:33 +0000
Received: by gwj19 with SMTP id 19so2382178gwj.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 05:01:12 -0800 (PST)
MIME-Version: 1.0
Received: by 10.151.154.8 with SMTP id g8mr10242188ybo.322.1291035671346; Mon,
 29 Nov 2010 05:01:11 -0800 (PST)
Received: by 10.150.200.5 with HTTP; Mon, 29 Nov 2010 05:01:11 -0800 (PST)
Date: Mon, 29 Nov 2010 20:01:11 +0700
Message-ID: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
Subject: precision and recall in lucene
From: Yakob <jacobian@opensuse-id.org>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

hello all
I was wondering, if I want to measure precision and recall in lucene
then what's the best way for me to do it? is there any sample cource
code that I can use?

thanks though
-- 
http://jacobian.web.id

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47957-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 13:19:47 2010
Return-Path: <java-user-return-47957-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6096 invoked from network); 29 Nov 2010 13:19:46 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 13:19:46 -0000
Received: (qmail 80087 invoked by uid 500); 29 Nov 2010 13:19:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79781 invoked by uid 500); 29 Nov 2010 13:19:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79760 invoked by uid 99); 29 Nov 2010 13:19:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 13:19:43 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 13:19:36 +0000
Received: by qyk7 with SMTP id 7so1542432qyk.14
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 05:19:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=GMKS+Yvw6f5Cu8CK52Ti/KgD9Vr37FXsBO2Tzi+ajHY=;
        b=eqkS3xpae3m0amUkqLQqWSCNSgmsMsIqp9o06fzRq9MCyGuKwRGAD4hDtsz03Fb5Zz
         FLlFnUuQYuso5FyruGJ4IBvSEkVIIRiY7J8sGz3u/enlZq15FJeNWFmSA37Kj62tAtx4
         svUdJ7B5itdnrd2UBucjOlFsMN+RskZtHk6qo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=wXhB3FDouLdpcfhoJ26camWjjVZuIsbwdF0uX2knuVTtNbGfauZII7kJTkUa7oABh3
         1Bh/bqV3VoTv4aUMRyCeTWa7sp2vIJRfJR9ZcyzG9N5bOsNtJGk1TGhcJlANoOoS8SSf
         2OcN/j+5jlPn/1DySEkQGcargszSlIGwKMVv4=
MIME-Version: 1.0
Received: by 10.229.86.149 with SMTP id s21mr4771790qcl.234.1291036755248;
 Mon, 29 Nov 2010 05:19:15 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Mon, 29 Nov 2010 05:19:15 -0800 (PST)
In-Reply-To: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
References: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
Date: Mon, 29 Nov 2010 08:19:15 -0500
Message-ID: <AANLkTimOdy5fNN71Sze8eX9jrdUoBVdMf23hTPsVa9ix@mail.gmail.com>
Subject: Re: precision and recall in lucene
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364272b530457c049630eb9e
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364272b530457c049630eb9e
Content-Type: text/plain; charset=ISO-8859-1

Define precision. Define recall. Define measure <G>....

Sorry to give in to my impulses, but this question is so broad it's
unanswerable. Try looking at the Text REtrieval Conference for instance.
Lots of very bright people spend significant amounts of their careers
trying to just define what these mean. Much less how to measure them.

And what "good" precision and recall are varies
with the search space. And the users. An academic researcher may
be willing to spend days finding the one paper out there that speaks
to a very specific question. Your average web user won't click past
the 2nd page, maybe not the 1st.

So perhaps you can tell us what it is you want these measures
for and maybe we can come up with some answers that are actually
helpful...

Best
Erick

On Mon, Nov 29, 2010 at 8:01 AM, Yakob <jacobian@opensuse-id.org> wrote:

> hello all
> I was wondering, if I want to measure precision and recall in lucene
> then what's the best way for me to do it? is there any sample cource
> code that I can use?
>
> thanks though
> --
> http://jacobian.web.id
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364272b530457c049630eb9e--

From java-user-return-47958-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 13:41:05 2010
Return-Path: <java-user-return-47958-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9613 invoked from network); 29 Nov 2010 13:41:05 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 13:41:05 -0000
Received: (qmail 2960 invoked by uid 500); 29 Nov 2010 13:41:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2919 invoked by uid 500); 29 Nov 2010 13:41:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2910 invoked by uid 99); 29 Nov 2010 13:41:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 13:41:01 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 13:40:55 +0000
Received: by gyf1 with SMTP id 1so2408861gyf.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 05:40:33 -0800 (PST)
MIME-Version: 1.0
Received: by 10.151.143.10 with SMTP id v10mr1487591ybn.208.1291038032967;
 Mon, 29 Nov 2010 05:40:32 -0800 (PST)
Received: by 10.150.200.5 with HTTP; Mon, 29 Nov 2010 05:40:32 -0800 (PST)
In-Reply-To: <AANLkTimOdy5fNN71Sze8eX9jrdUoBVdMf23hTPsVa9ix@mail.gmail.com>
References: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
	<AANLkTimOdy5fNN71Sze8eX9jrdUoBVdMf23hTPsVa9ix@mail.gmail.com>
Date: Mon, 29 Nov 2010 20:40:32 +0700
Message-ID: <AANLkTi=2UWWKPcwA_KfuByi7nycpv16+=jiHcL7KRyKM@mail.gmail.com>
Subject: Re: precision and recall in lucene
From: Yakob <jacobian@opensuse-id.org>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On 11/29/10, Erick Erickson <erickerickson@gmail.com> wrote:
> Define precision. Define recall. Define measure <G>....
>
> Sorry to give in to my impulses, but this question is so broad it's
> unanswerable. Try looking at the Text REtrieval Conference for instance.
> Lots of very bright people spend significant amounts of their careers
> trying to just define what these mean. Much less how to measure them.
>
> And what "good" precision and recall are varies
> with the search space. And the users. An academic researcher may
> be willing to spend days finding the one paper out there that speaks
> to a very specific question. Your average web user won't click past
> the 2nd page, maybe not the 1st.
>
> So perhaps you can tell us what it is you want these measures
> for and maybe we can come up with some answers that are actually
> helpful...
>
> Best
> Erick

well when I read the ebook of "lucene in action" I came across this sentence.

"Searching is the process of looking up words in an index to find
documents where
they appear. The quality of a search is typically described using precision and
recall metrics. Recall measures how well the search system finds
relevant documents,
whereas precision measures how well the system filters out the irrelevant
documents."

I am just thinking of how to measure the precision and recall metrics
in lucene? I mean I just wanted to do an analysis of precision and
recall in my thesis that happened to use lucene as the framework. :-)



-- 
http://jacobian.web.id

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47959-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 14:03:11 2010
Return-Path: <java-user-return-47959-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17507 invoked from network); 29 Nov 2010 14:03:11 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 14:03:11 -0000
Received: (qmail 42935 invoked by uid 500); 29 Nov 2010 14:03:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42777 invoked by uid 500); 29 Nov 2010 14:03:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42768 invoked by uid 99); 29 Nov 2010 14:03:06 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 14:03:06 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 14:02:59 +0000
Received: from suex07-hub-01.ad.syr.edu (suex07-hub-01.ad.syr.edu [128.230.108.195])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id oATE2crt016175
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 09:02:38 -0500
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-01.ad.syr.edu ([128.230.108.195]) with mapi; Mon, 29 Nov 2010
 09:02:38 -0500
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 29 Nov 2010 09:02:53 -0500
Subject: RE: Analyzer
Thread-Topic: Analyzer
Thread-Index: AcuPqFXAPyTj+wZ/R/G9B1M2UvupSQAIoPbQ
Message-ID: <2D127F11DC79714E9B6A43AC9458147F8264B456@suex07-mbx-03.ad.syr.edu>
References: <AANLkTimzdzDrLyC=_83KR_Hv8GZgVBVNu-CUB63hXkxn@mail.gmail.com>
In-Reply-To: <AANLkTimzdzDrLyC=_83KR_Hv8GZgVBVNu-CUB63hXkxn@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=2.50.10432:5.2.15,1.0.148,0.0.0000
 definitions=2010-11-29_08:2010-11-29,2010-11-29,1970-01-01 signatures=0
X-Proofpoint-Spam-Reason: safe

SGkgTWFuanVsYSwNCg0KSXQncyBub3QgdGVycmlibHkgY2xlYXIgd2hhdCB5b3UncmUgZG9pbmcg
aGVyZSAtIEkgZ290IGxvc3QgaW4geW91ciBkZXNjcmlwdGlvbiBvZiB5b3VyICh0d28/IG9yIG1h
eWJlIGZvdXI/KSBjbGFzc2VzLiAgU29tZXRpbWVzIHRoaW5ncyBhcmUgZWFzaWVyIHRvIHVuZGVy
c3RhbmQgaWYgeW91IHByb3ZpZGUgbW9yZSBjb25jcmV0ZSBkZXRhaWwuDQoNCkkgc3VzcGVjdCB0
aGF0IHlvdSBjb3VsZCBiZW5lZml0IGZyb20gcmVhZGluZyB0aGUgYm9vayBMdWNlbmUgaW4gQWN0
aW9uLCAybmQgZWRpdGlvbjogDQoNCiAgIGh0dHA6Ly93d3cubWFubmluZy5jb20vaGF0Y2hlcjMv
DQoNCllvdSB3b3VsZCBhbHNvIGxpa2VseSBiZW5lZml0IGZyb20gdXNpbmcgTHVrZSwgdGhlIEx1
Y2VuZSBpbmRleCBicm93c2VyLCB0byBiZXR0ZXIgdW5kZXJzdGFuZCB5b3VyIGluZGV4ZXMnIGNv
bnRlbnRzIGFuZCBkZWJ1ZyBob3cgcXVlcmllcyBtYXRjaCBkb2N1bWVudHM6IA0KDQogICBodHRw
Oi8vY29kZS5nb29nbGUuY29tL3AvbHVrZS8NCg0KSSB0aGluayB5b3VyIHF1ZXN0aW9uIGlzIHdo
ZXRoZXIgeW91J3JlIHVzaW5nIEFuYWx5emVycyBjb3JyZWN0bHkuICBJdCBzb3VuZHMgbGlrZSB5
b3UgYXJlIGNyZWF0aW5nIHR3byBzZXBhcmF0ZSBpbmRleGVzIChvbmUgZm9yIGVhY2ggb2YgeW91
ciBjbGFzc2VzKSwgYW5kIHlvdSdyZSB1c2luZyBTbm93YmFsbEFuYWx5emVyIG9uIHRoZSBpbmRl
eGluZyBzaWRlIGZvciBib3RoIGluZGV4ZXMsIGFuZCBTdGFuZGFyZEFuYWx5emVyIG9uIHRoZSBx
dWVyeSBzaWRlLiAgDQoNClRoZSB1c3VhbCBhZHZpY2UgaXMgdG8gdXNlIHRoZSBzYW1lIEFuYWx5
emVyIG9uIGJvdGggdGhlIHF1ZXJ5IGFuZCB0aGUgaW5kZXggc2lkZS4gIEJ1dCBpdCBhcHBlYXJz
IHRvIGJlIHRoZSBjYXNlIHRoYXQgeW91IGFyZSB0YWtpbmcgc3RlbW1lZCBpbmRleCB0ZXJtcyBm
cm9tIHlvdXIgaW5kZXggIzEgYW5kIHRoZW4gcXVlcnlpbmcgaW5kZXggIzIgdXNpbmcgdGhlc2Ug
c3RlbW1lZCB0ZXJtcy4gIElmIHRoaXMgaXMgdHJ1ZSwgdGhlbiB5b3Ugd2FudCB0aGUgcXVlcnkt
dGltZSBhbmFseXplciBpbiB5b3VyIHNlY29uZCBpbmRleCBub3QgdG8gY2hhbmdlIHRoZSBxdWVy
eSB0ZXJtcy4gIFlvdSdsbCBsaWtlbHkgZ2V0IGJldHRlciByZXN1bHRzIHVzaW5nIFdoaXRlc3Bh
Y2VBbmFseXplciwgd2hpY2ggdG9rZW5pemVzIG9uIHdoaXRlc3BhY2UgYW5kIGRvZXMgbm8gZnVy
dGhlciBhbmFseXNpcywgcmF0aGVyIHRoYW4gU3RhbmRhcmRBbmFseXplci4NCg0KU3RldmUNCg0K
PiAtLS0tLU9yaWdpbmFsIE1lc3NhZ2UtLS0tLQ0KPiBGcm9tOiBtYW5qdWxhIHdpamV3aWNrcmVt
YSBbbWFpbHRvOm1hbmp1bGE1M0BnbWFpbC5jb21dDQo+IFNlbnQ6IE1vbmRheSwgTm92ZW1iZXIg
MjksIDIwMTAgNDozMiBBTQ0KPiBUbzogamF2YS11c2VyQGx1Y2VuZS5hcGFjaGUub3JnDQo+IFN1
YmplY3Q6IEFuYWx5emVyDQo+IA0KPiBIaSwNCj4gDQo+IEluIG15IHdvcmssIEkgYW0gdXNpbmcg
THVjZW5lIGFuZCB0d28gamF2YSBjbGFzc2VzLiBJbiB0aGUgZmlyc3Qgb25lLCBJDQo+IGluZGV4
IGEgZG9jdW1lbnQgYW5kIGluIHRoZSBzZWNvbmQgb25lLCBJIHRyeSB0byBzZWFyY2ggdGhlIG1v
c3QgcmVsZXZhbnQNCj4gZG9jdW1lbnQgZm9yIHRoZSBpbmRleGVkIGRvY3VtZW50IGluIHRoZSBm
aXJzdCBvbmUuIEluIHRoZSBmaXJzdCBqYXZhDQo+IGNsYXNzLA0KPiBJIHVzZSB0aGUgU25vd2Jh
bGxBbmFseXplciBpbiB0aGUgY3JlYXRlSW5kZXggbWV0aG9kIGFuZCBTdGFuZGFyZEFuYWx5emVy
DQo+IGluDQo+IHRoZSBzZWFyY2hJbmRleCBtZXRob2QgYW5kIHBhc3MgdGhlIGhpZ2hlc3QgZnJl
cXVlbmN5IHRlcm1zIGludG8gdGhlDQo+IHNlY29uZA0KPiBKYXZhIGNsYXNzLiBJbiB0aGUgc2Vj
b25kIGNsYXNzLCBJIHVzZSBTbm93YmFsbEFuYWx5emVyIGluIHRoZSBjcmVhdGVJbmRleA0KPiBt
ZXRob2QgKHRoaXMgaW5kZXggaXMgZm9yIHRoZSBjb2xsZWN0aW9uIG9mIGRvY3VtZW50cyB0byBi
ZSBzZWFyY2hlZCwgb3INCj4gaXQNCj4gaXMgbXkgZGF0YWJhc2UpIGFuZCBTdGFuZGFyZEFuYWx5
c2VyIGluIHRoZSBzZWFyY2hJbmRleCBtZXRob2QgKEkgcGFzcyB0aGUNCj4gaGlnaGVzdCBmcmVx
dWVudGx5IG9jY3VyaW5nIHRlcm0gb2YgdGhlIGZpcnN0IGNsYXNzIGFzIHRoZSBzZWFyY2ggdGVy
bQ0KPiBwYXJhbWV0ZXIgdG8gdGhlIHNlYXJjaEluZGV4IG1ldGhvZCBvZiB0aGUgc2Vjb25kIGNs
YXNzKS4gVXNpbmcgQW5hbHl6ZXJzDQo+IGluDQo+IHRoaXMgbWFubmVyLCB3aGF0IEkgYW0gd2ls
bGluZyBpcyB0byBkbyB0aGUgc3RlbW1pbmcsIHN0b3Atd29yZHMgaW4gYm90aA0KPiBpbmRleGVz
IChpbiBib3RoIGNsYXNzZXMpIGFuZCB0byBzZWFyY2ggdGhvc2UgYSBmZXcgaGlnaCBmcmVxdWVu
Y3kgd29yZHMNCj4gKG9mDQo+IHRoZSBmaXJzdCBpbmRleCkgaW4gdGhlIHNlY29uZCBpbmRleC4g
U28sIGlmIG15IGludGVudGlvbiBpcyBjbGVhciB0byB5b3UsDQo+IGNvdWxkIHlvdSBwbGVhc2Ug
bGV0IG1lIGtub3cgd2hldGhlciBpdCBpcyBjb3JyZWN0IG9yIG5vdCB0aGUgd2F5IEkgaGF2ZQ0K
PiB1c2VkIEFuYWx5emVycz8gSSBoaWdobHkgYXBwcmVjaWF0ZSBhbnkgY29tbWVudC4NCj4gDQo+
IFRoYW54Lg0KPiBNYW5qdWxhLg0K


From java-user-return-47960-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 15:35:40 2010
Return-Path: <java-user-return-47960-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86750 invoked from network); 29 Nov 2010 15:35:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 15:35:40 -0000
Received: (qmail 26291 invoked by uid 500); 29 Nov 2010 15:35:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26014 invoked by uid 500); 29 Nov 2010 15:35:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26001 invoked by uid 99); 29 Nov 2010 15:35:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 15:35:37 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 15:35:32 +0000
Received: by qyk10 with SMTP id 10so4907655qyk.14
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 07:35:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=99zNzOV56Rz1sUzRlc39Nz7h/UgZsBxbccxGYn3SSvo=;
        b=OHzzfWG4A/VQ2DG6iCeIWlASgOSNpPxYAR226QdpNrK+d/x3SUk6dLV3gOt7kr4grr
         L9TsPRQ/U3M4uq23NA2muowEZ1cQ7U20iBUZznE7xEJg+OHcrY3w+OMI3BhKpc67eZaL
         s6Kg6/fbnPBCV6Z5qylej+6o99Xcn9zujQeJ0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=SmEy/OTWc/aZTlGzjpkhccW1gtwi/ZMe/lF17hLTo/VImxbaxBMFr2C80AC3AnY8H4
         JH/u/0P0XjT1w6RFoIPs1hvR+OWmWOEN/G/pqKMCYp31zdly9ni1HDJqEn0yZGfs38jQ
         WXxCtmY/4jWXEEh9oQReJWprkQOXNxm3rrrxw=
MIME-Version: 1.0
Received: by 10.229.91.10 with SMTP id k10mr4928646qcm.82.1291044911928; Mon,
 29 Nov 2010 07:35:11 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Mon, 29 Nov 2010 07:35:11 -0800 (PST)
In-Reply-To: <AANLkTi=2UWWKPcwA_KfuByi7nycpv16+=jiHcL7KRyKM@mail.gmail.com>
References: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
	<AANLkTimOdy5fNN71Sze8eX9jrdUoBVdMf23hTPsVa9ix@mail.gmail.com>
	<AANLkTi=2UWWKPcwA_KfuByi7nycpv16+=jiHcL7KRyKM@mail.gmail.com>
Date: Mon, 29 Nov 2010 10:35:11 -0500
Message-ID: <AANLkTimEoxPTNkKzi3mW-PVQHW+WPGmCdKjBj0SeYMpT@mail.gmail.com>
Subject: Re: precision and recall in lucene
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e83825d56e0049632d123

--0016361e83825d56e0049632d123
Content-Type: text/plain; charset=ISO-8859-1

Well, I guess I can answer your original question with "no". There's
no Lucene method that will give you these because they aren't
defined. If you can answer the question "given a corpus and a set
of queries and the correct ordering of the relevant documents, how
close does Lucene come to that ordering?", then you could calculate
whether all the docs that should have been returned were found (recall)
and whether the documents returned contained only the documents
that should have been returned (precision).

But a lot of effort in Solr/Lucene tuning is tweaking returned results
to make precision and recall "better", where "better" is understood
relevant to a particular problem space and aren't well defined in
the abstract (and perhaps can't be).

Best
Erick

On Mon, Nov 29, 2010 at 8:40 AM, Yakob <jacobian@opensuse-id.org> wrote:

> On 11/29/10, Erick Erickson <erickerickson@gmail.com> wrote:
> > Define precision. Define recall. Define measure <G>....
> >
> > Sorry to give in to my impulses, but this question is so broad it's
> > unanswerable. Try looking at the Text REtrieval Conference for instance.
> > Lots of very bright people spend significant amounts of their careers
> > trying to just define what these mean. Much less how to measure them.
> >
> > And what "good" precision and recall are varies
> > with the search space. And the users. An academic researcher may
> > be willing to spend days finding the one paper out there that speaks
> > to a very specific question. Your average web user won't click past
> > the 2nd page, maybe not the 1st.
> >
> > So perhaps you can tell us what it is you want these measures
> > for and maybe we can come up with some answers that are actually
> > helpful...
> >
> > Best
> > Erick
>
> well when I read the ebook of "lucene in action" I came across this
> sentence.
>
> "Searching is the process of looking up words in an index to find
> documents where
> they appear. The quality of a search is typically described using precision
> and
> recall metrics. Recall measures how well the search system finds
> relevant documents,
> whereas precision measures how well the system filters out the irrelevant
> documents."
>
> I am just thinking of how to measure the precision and recall metrics
> in lucene? I mean I just wanted to do an analysis of precision and
> recall in my thesis that happened to use lucene as the framework. :-)
>
>
>
> --
> http://jacobian.web.id
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016361e83825d56e0049632d123--

From java-user-return-47961-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 19:51:01 2010
Return-Path: <java-user-return-47961-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96136 invoked from network); 29 Nov 2010 19:51:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 19:51:01 -0000
Received: (qmail 62298 invoked by uid 500); 29 Nov 2010 19:50:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62121 invoked by uid 500); 29 Nov 2010 19:50:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62112 invoked by uid 99); 29 Nov 2010 19:50:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 19:50:58 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of falha404@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 19:50:50 +0000
Received: by wwb17 with SMTP id 17so1880986wwb.5
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 11:50:30 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:received:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        bh=gTm1RrYoUoTgC65I7QIjmRON7RELlvjl6tHSppZA5DY=;
        b=jPqeezjuVQ3v+7JG1YZUnQp9kq2fXy7dMQ8dpa98HOdgX/f196NWAfMP09J1beyvdS
         ukW0sEEaCPtfvmlKId01Jq3ByWUsPCBe98tbeGKDAwbac4w3HccQ32YLElYVxinbuG7y
         vPk8ZVQETfC59DCOS9F7bxvcPMw8pH9/Y1Ti0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        b=C2UfmoOMvvANXq3Mek1nWMOj6tSDgxXn10tmpplpTp+ZwS0jziYzZxX8V6PRMncvsd
         /wE9YwIKBGOVsDZgWatsyX4QnMTXSRRxOiNVBNVFG0TroqRFO5iBZdywoeVdKa7jQZIT
         Wc22s5XBpcYFnTo2eYRQLb8la7raut0BYoIh0=
Received: by 10.216.161.130 with SMTP id w2mr5479420wek.17.1291060217228; Mon,
 29 Nov 2010 11:50:17 -0800 (PST)
MIME-Version: 1.0
Sender: falha404@gmail.com
Received: by 10.216.20.4 with HTTP; Mon, 29 Nov 2010 11:49:31 -0800 (PST)
From: Fabiano Nunes <fabiano@nunes.me>
Date: Mon, 29 Nov 2010 17:49:31 -0200
X-Google-Sender-Auth: J8bwG1xJA_nsmrX9d0zi5a05IOE
Message-ID: <AANLkTimBoFsv7-guqLtkTZzT7anJA_SQyPDV0-5RvBvh@mail.gmail.com>
Subject: Custom token attributes and payload. XML analyzing.
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364c773fa26567049636614b
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364c773fa26567049636614b
Content-Type: text/plain; charset=ISO-8859-1

Hello,

I'm trying to store some token attributes found in a XML document.
More specifically, token coordinates for future highlighting.
Example: I have a XML with this structure:

<word c="184,108,292,11">Lucene</word>
<word c="306,21,292,11">in</word>
<word c="340,74,292,11">Action</word>
<word c="428,11,292,11">2nd</word>
<word c="453,23,292,11">Edition</word>

I want to store the @c attribute from word element (coordinates
left,width,top,height) in each token. So, in the search, I'll retrieve each
token position for highlighting. There is any good approach to do this?

--0016364c773fa26567049636614b--

From java-user-return-47962-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Nov 29 21:12:17 2010
Return-Path: <java-user-return-47962-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53035 invoked from network); 29 Nov 2010 21:12:16 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 29 Nov 2010 21:12:16 -0000
Received: (qmail 83864 invoked by uid 500); 29 Nov 2010 21:12:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83809 invoked by uid 500); 29 Nov 2010 21:12:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83800 invoked by uid 99); 29 Nov 2010 21:12:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 21:12:14 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 29 Nov 2010 21:12:08 +0000
Received: by qyk7 with SMTP id 7so348993qyk.14
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 13:11:47 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=PgGHXCknEuwKQ3Bct3oZhlXC9Zq4brOroLchJWyhzCk=;
        b=jDnx8r1VWSk+Az+rv2Vd9ChvyacGm2ePb0KB77GPYqIJXbJ4mEWPwNN9/bpNRUDLLV
         +AtimMtNWVu368tYGWF+Gl+xX47Y5GpgLpW6bulkpE2T2zVit0Fl0BgBXLpFAf2q1FMj
         zHMKsDm2k8L9Ny4JpheIOTrUNcW87OpgHOVY4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=FkQVfQ6z7pp3tJhLKv+FFUIrM2cLGK2bBEDEyiQTcUAlk1yEpVGupqK9fbc5YebDon
         1RfTVhyN5ldcQG4eNjt1CDs2xtbDtj0zkw0OoAWfliwZMrIq1hU2idYpAHd8VAnBUrWK
         JLpviNVAQy2fG4p7CnWxoFHMts5qbniT2wtIg=
MIME-Version: 1.0
Received: by 10.229.182.11 with SMTP id ca11mr5344064qcb.44.1291065106870;
 Mon, 29 Nov 2010 13:11:46 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Mon, 29 Nov 2010 13:11:46 -0800 (PST)
In-Reply-To: <AANLkTimBoFsv7-guqLtkTZzT7anJA_SQyPDV0-5RvBvh@mail.gmail.com>
References: <AANLkTimBoFsv7-guqLtkTZzT7anJA_SQyPDV0-5RvBvh@mail.gmail.com>
Date: Mon, 29 Nov 2010 16:11:46 -0500
Message-ID: <AANLkTimSZKQZ8JfaB4e0vGz9hiFUUFr5e292pz+UBaHo@mail.gmail.com>
Subject: Re: Custom token attributes and payload. XML analyzing.
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364ec8fe13b35a04963785be
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364ec8fe13b35a04963785be
Content-Type: text/plain; charset=ISO-8859-1

Sounds like payloads, have you investigated them? Here's a place
to start:
http://www.lucidimagination.com/blog/2009/08/05/getting-started-with-payloads/

<http://www.lucidimagination.com/blog/2009/08/05/getting-started-with-payloads/>
Best
Erick

On Mon, Nov 29, 2010 at 2:49 PM, Fabiano Nunes <fabiano@nunes.me> wrote:

> Hello,
>
> I'm trying to store some token attributes found in a XML document.
> More specifically, token coordinates for future highlighting.
> Example: I have a XML with this structure:
>
> <word c="184,108,292,11">Lucene</word>
> <word c="306,21,292,11">in</word>
> <word c="340,74,292,11">Action</word>
> <word c="428,11,292,11">2nd</word>
> <word c="453,23,292,11">Edition</word>
>
> I want to store the @c attribute from word element (coordinates
> left,width,top,height) in each token. So, in the search, I'll retrieve each
> token position for highlighting. There is any good approach to do this?
>

--0016364ec8fe13b35a04963785be--

From java-user-return-47963-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 01:58:18 2010
Return-Path: <java-user-return-47963-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85273 invoked from network); 30 Nov 2010 01:58:18 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 01:58:18 -0000
Received: (qmail 232 invoked by uid 500); 30 Nov 2010 01:58:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 147 invoked by uid 500); 30 Nov 2010 01:58:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 139 invoked by uid 99); 30 Nov 2010 01:58:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 01:58:16 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of mark.kristensson@smartsheet.com designates 209.85.160.176 as permitted sender)
Received: from [209.85.160.176] (HELO mail-gy0-f176.google.com) (209.85.160.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 01:58:08 +0000
Received: by gyf1 with SMTP id 1so2905507gyf.35
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 17:57:47 -0800 (PST)
Received: by 10.151.109.8 with SMTP id l8mr11421353ybm.372.1291082267264;
        Mon, 29 Nov 2010 17:57:47 -0800 (PST)
Received: from [10.0.2.104] (75-145-24-62-Washington.hfc.comcastbusiness.net [75.145.24.62])
        by mx.google.com with ESMTPS id u3sm562388yba.4.2010.11.29.17.57.46
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 29 Nov 2010 17:57:46 -0800 (PST)
From: Mark Kristensson <mark.kristensson@smartsheet.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Subject: Directory objects for index
Date: Mon, 29 Nov 2010 17:57:39 -0800
Message-Id: <6E7BEC74-C3B4-4587-9D27-781684E52B8A@smartsheet.com>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1082)
X-Mailer: Apple Mail (2.1082)

While implementing a solution for keeping warmed indexReaders around for =
our various indexes (so users don't have to wait while we open an =
indexReader for our one slow index), I've run into some serious problems =
trying to track down all of the outstanding file handles to my indexes.

For a while, I thought I was not properly closing my indexReader =
handles, however, I'm confident that I'm now doing that. So, the next =
most likely culprit are the directory objects. FYI, we use FSDirectory =
with a SingleInstanceLockFactory for all of our indexes right now.

I'm trying to decipher the behavior that I'm seeing, but the behavior =
seems to differ between my box (Mac OS X 10.6) and our lab machines =
(Linux) with how they handle and close the file handles from the =
Directory objects.=20

Right now, we have several places in our code where we get a Directory =
object from the Java File object, including multiple times with each =
pass of our indexing service (which runs twice per minute). I'm =
wondering if I should instead use the static indexReader objects I'm now =
holding in a singleton and just call indexReader.directory() in each =
instance where we need a directory object (e.g. opening an indexWriter, =
checking to see if an index is locked, etc.).

A few elementary questions about the Directory (specifically =
FSDirectory) object:
1) Do I need to explicitly close directory objects?=20
2) If I need to close them, when do I do it? Just after handing to =
IndexReader.open() or new IndexWriter()? Or should I close them  at the =
same time I close the IndexReader and IndexWriter objects?
3) Has anyone seem behavior that differs radically across OSes regarding =
references to open (and unclosed) FSDirectory objects?


Thanks,
Mark=

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47964-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 05:07:06 2010
Return-Path: <java-user-return-47964-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53882 invoked from network); 30 Nov 2010 05:07:06 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 05:07:06 -0000
Received: (qmail 9452 invoked by uid 500); 30 Nov 2010 05:07:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9247 invoked by uid 500); 30 Nov 2010 05:07:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9239 invoked by uid 99); 30 Nov 2010 05:07:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 05:07:01 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of manjula53@gmail.com designates 209.85.216.176 as permitted sender)
Received: from [209.85.216.176] (HELO mail-qy0-f176.google.com) (209.85.216.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 05:06:55 +0000
Received: by qyk10 with SMTP id 10so5671553qyk.14
        for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 21:06:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=MhOzpvR614sG3+WqPxmBS4jiEqBR8XROEubgkxhw9oc=;
        b=t6zyfmngrnQm44icH2rOjjtjwCIhmNkous+/FYIvG3Sor8R/ZGHGiowPutzyk5OIX0
         mlHDyKEzVr57TnxVdtBUhpdu+ubmIWYtDvQt96qrAw8D3uSECGhyHmggGZTWc1h4NGZ2
         a3xjcxzrVqmCmjxyjPZ7jKtjM/Q2ToRFwq8wA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=tVHXjzFUaZ+dleCtFP/TeFnBuNIzl9ToR691VxySYBUyHcBAs4vre1dYSXeX+9Gvkb
         kBbQJdkTAgCB8bvKqrDFlwx/umbo/fNmt6ZsSqk9VFkX+dNGlKTdP4bLJJucxZy33VlM
         jKk4IhHPsHhE9v1NPtxd/j9ceLIVJk8zYu2ts=
MIME-Version: 1.0
Received: by 10.224.19.207 with SMTP id c15mr6245816qab.14.1291093593859; Mon,
 29 Nov 2010 21:06:33 -0800 (PST)
Received: by 10.220.186.70 with HTTP; Mon, 29 Nov 2010 21:06:33 -0800 (PST)
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F8264B456@suex07-mbx-03.ad.syr.edu>
References: <AANLkTimzdzDrLyC=_83KR_Hv8GZgVBVNu-CUB63hXkxn@mail.gmail.com>
	<2D127F11DC79714E9B6A43AC9458147F8264B456@suex07-mbx-03.ad.syr.edu>
Date: Tue, 30 Nov 2010 10:36:33 +0530
Message-ID: <AANLkTimYMVah0FV5+ZTHT17aXv39ALsiLVy_a3Bu4nNP@mail.gmail.com>
Subject: Re: Analyzer
From: manjula wijewickrema <manjula53@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151748db4c08a94904963e2733
X-Virus-Checked: Checked by ClamAV on apache.org

--00151748db4c08a94904963e2733
Content-Type: text/plain; charset=ISO-8859-1

Hi Steve,

Thanx a lot for your reply. Yes there are only two classes and it's corrcet
that the way you have realized the problem. As you have instructed, I
checked WhitespaceAnalyzer for querying (instead of StandardAnalyzer) and it
seems to me that it gives better results rather than StandardAnalyzer. So
could you please let me know what are the differences between
StandardAnalyzer and WhitespaceAnalyzer. I highly appriciate your response.
Thanx.

Manjula.


On Mon, Nov 29, 2010 at 7:32 PM, Steven A Rowe <sarowe@syr.edu> wrote:

> Hi Manjula,
>
> It's not terribly clear what you're doing here - I got lost in your
> description of your (two? or maybe four?) classes.  Sometimes things are
> easier to understand if you provide more concrete detail.
>
> I suspect that you could benefit from reading the book Lucene in Action,
> 2nd edition:
>
>   http://www.manning.com/hatcher3/
>
> You would also likely benefit from using Luke, the Lucene index browser, to
> better understand your indexes' contents and debug how queries match
> documents:
>
>   http://code.google.com/p/luke/
>
> I think your question is whether you're using Analyzers correctly.  It
> sounds like you are creating two separate indexes (one for each of your
> classes), and you're using SnowballAnalyzer on the indexing side for both
> indexes, and StandardAnalyzer on the query side.
>
> The usual advice is to use the same Analyzer on both the query and the
> index side.  But it appears to be the case that you are taking stemmed index
> terms from your index #1 and then querying index #2 using these stemmed
> terms.  If this is true, then you want the query-time analyzer in your
> second index not to change the query terms.  You'll likely get better
> results using WhitespaceAnalyzer, which tokenizes on whitespace and does no
> further analysis, rather than StandardAnalyzer.
>
> Steve
>
> > -----Original Message-----
> > From: manjula wijewickrema [mailto:manjula53@gmail.com]
> > Sent: Monday, November 29, 2010 4:32 AM
> > To: java-user@lucene.apache.org
> > Subject: Analyzer
> >
> > Hi,
> >
> > In my work, I am using Lucene and two java classes. In the first one, I
> > index a document and in the second one, I try to search the most relevant
> > document for the indexed document in the first one. In the first java
> > class,
> > I use the SnowballAnalyzer in the createIndex method and StandardAnalyzer
> > in
> > the searchIndex method and pass the highest frequency terms into the
> > second
> > Java class. In the second class, I use SnowballAnalyzer in the
> createIndex
> > method (this index is for the collection of documents to be searched, or
> > it
> > is my database) and StandardAnalyser in the searchIndex method (I pass
> the
> > highest frequently occuring term of the first class as the search term
> > parameter to the searchIndex method of the second class). Using Analyzers
> > in
> > this manner, what I am willing is to do the stemming, stop-words in both
> > indexes (in both classes) and to search those a few high frequency words
> > (of
> > the first index) in the second index. So, if my intention is clear to
> you,
> > could you please let me know whether it is correct or not the way I have
> > used Analyzers? I highly appreciate any comment.
> >
> > Thanx.
> > Manjula.
>

--00151748db4c08a94904963e2733--

From java-user-return-47965-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 06:20:21 2010
Return-Path: <java-user-return-47965-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89506 invoked from network); 30 Nov 2010 06:20:20 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 06:20:20 -0000
Received: (qmail 52953 invoked by uid 500); 30 Nov 2010 06:20:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52620 invoked by uid 500); 30 Nov 2010 06:20:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52612 invoked by uid 99); 30 Nov 2010 06:20:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 06:20:17 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of hossman_lucene@fucit.org designates 208.69.42.181 as permitted sender)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 06:20:09 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id E1E5D71C205; Mon, 29 Nov 2010 22:19:46 -0800 (PST)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 8A90871C1CA
	for <java-user@lucene.apache.org>; Mon, 29 Nov 2010 22:19:46 -0800 (PST)
Date: Mon, 29 Nov 2010 22:19:46 -0800 (PST)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: What is the difference between the "AND" and "+" operator?
In-Reply-To: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com>
Message-ID: <alpine.DEB.1.10.1011292216320.14419@radix.cryptio.net>
References: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com>
User-Agent: Alpine 1.10 (DEB 962 2008-03-14)
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: Subject: What is the difference between the "AND" and "+" operator?

In this query, "y" is mandatory, but documents that also match "x" will 
score higher then documents that only match "y"...

	x +y

In both of these queries, "x" and "y" are both mandatory; a document only 
matching one of them will not match the query...

	+x +y
	x AND y


-Hoss

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47966-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 09:34:10 2010
Return-Path: <java-user-return-47966-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76779 invoked from network); 30 Nov 2010 09:34:10 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 09:34:10 -0000
Received: (qmail 59326 invoked by uid 500); 30 Nov 2010 09:34:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59184 invoked by uid 500); 30 Nov 2010 09:34:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59176 invoked by uid 99); 30 Nov 2010 09:34:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 09:34:07 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 09:34:02 +0000
Received: by bwz9 with SMTP id 9so5349160bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 01:33:41 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=INf0hsOsMWOBMTufEFZ7NhCk13MoH9o752tMM/i7Xxc=;
        b=pgLYDazZbldkQ01PxoyGXZhwr6jRuGT+sH3qblCyw2F2EQHJgD2cLFdvv0Z40XP9MX
         50IEHptNB+fApbuhism6j/4BXs0k62oWoz57T3iuG44JIIRm0BmXlM5g15QgX7KzwY1b
         mj7B1wDhIB0fxgEdA64v3nGvnICqGF5zvVd+A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Qn07OBumVPVLfiKWWGfsX1TsAwKhlZXzSCA88AO4jvbZE0XgtR+JQLM5jaY+o0IGq+
         rUMBfbaln0jCczEtIQz+G6pwfrgDW4rnakyvX4iArWsAc9IXZRdyvxd/brrWNmoA9nYN
         JPpiwwoPHISOgy76uXC38LPuxuq3trPMJDwQo=
Received: by 10.204.120.146 with SMTP id d18mr2674495bkr.28.1291109621077;
 Tue, 30 Nov 2010 01:33:41 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Tue, 30 Nov 2010 01:33:20 -0800 (PST)
In-Reply-To: <alpine.DEB.1.10.1011292216320.14419@radix.cryptio.net>
References: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com> <alpine.DEB.1.10.1011292216320.14419@radix.cryptio.net>
From: maven apache <apachemaven0@gmail.com>
Date: Tue, 30 Nov 2010 17:33:20 +0800
Message-ID: <AANLkTim5ZiPTBZ2J0pf5H2n3M0Xy5ji3Yt=Ee1RmORky@mail.gmail.com>
Subject: Re: What is the difference between the "AND" and "+" operator?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636eefbc7549a21049641e2c2

--001636eefbc7549a21049641e2c2
Content-Type: text/plain; charset=ISO-8859-1

2010/11/30 Chris Hostetter <hossman_lucene@fucit.org>

>
> : Subject: What is the difference between the "AND" and "+" operator?
>
> In this query, "y" is mandatory, but documents that also match "x" will
> score higher then documents that only match "y"...
>
>        x +y
>
> In both of these queries, "x" and "y" are both mandatory; a document only
> matching one of them will not match the query...
>
>        +x +y
>        x AND y
>

That's to say    +x+y == x AND y ?

>
>
> -Hoss
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636eefbc7549a21049641e2c2--

From java-user-return-47967-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 09:40:01 2010
Return-Path: <java-user-return-47967-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78868 invoked from network); 30 Nov 2010 09:40:00 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 09:40:00 -0000
Received: (qmail 72528 invoked by uid 500); 30 Nov 2010 09:39:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72377 invoked by uid 500); 30 Nov 2010 09:39:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72369 invoked by uid 99); 30 Nov 2010 09:39:57 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 09:39:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 09:39:53 +0000
Received: by wyf28 with SMTP id 28so5887296wyf.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 01:39:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=X/uKMNl2QGzEjNlWKxzKc7j0oCWcxX2InIeCuxIaO0A=;
        b=ZbFCXG+IWtWHcLuSE6qpdkp0rXg0NZpFSCJUGs0zAUPfaloFUf29+qxo/5BPAtnior
         vEVvNL+eaK4eTQDLFGwvXkJDR1/Ut3/PDZUyEHP+2sDqO3W+9urecBcEvsL2gmgoQYaY
         W7AsSric6opc7v8qMdCavb4IVw/Hns8D3WIcA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=rnV/Fv55Yqh/2V69RHxWvOjwoEpvwKAgiBjeDhgWmrXHGUygKKB3zLGMiNV/7W2hdO
         VcNKVibzFNQbn8n2bJE3iCkH7U6RPIXiQsv4l3fRFZZrymo04zhNxPjuCz6yTiS1UZcr
         cee1QQMX8iYJesoMY1RQzE6jlblLOp9ogcZYM=
Received: by 10.227.128.141 with SMTP id k13mr7414761wbs.32.1291109971319;
 Tue, 30 Nov 2010 01:39:31 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.149.6 with HTTP; Tue, 30 Nov 2010 01:39:10 -0800 (PST)
In-Reply-To: <AANLkTim5ZiPTBZ2J0pf5H2n3M0Xy5ji3Yt=Ee1RmORky@mail.gmail.com>
References: <AANLkTikpEZ7MnMdN5K9W+qWYN65thQsnduuziUA5VV9Y@mail.gmail.com>
 <alpine.DEB.1.10.1011292216320.14419@radix.cryptio.net> <AANLkTim5ZiPTBZ2J0pf5H2n3M0Xy5ji3Yt=Ee1RmORky@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Tue, 30 Nov 2010 15:09:10 +0530
Message-ID: <AANLkTikd0bOvYfGPcGWvL_7QtENNrmFpcFEz0Evotd52@mail.gmail.com>
Subject: Re: What is the difference between the "AND" and "+" operator?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636831e7634dc34049641f796

--001636831e7634dc34049641f796
Content-Type: text/plain; charset=ISO-8859-1

with a single '=' :)

--
Anshum Gupta
http://ai-cafe.blogspot.com


On Tue, Nov 30, 2010 at 3:03 PM, maven apache <apachemaven0@gmail.com>wrote:

> 2010/11/30 Chris Hostetter <hossman_lucene@fucit.org>
>
> >
> > : Subject: What is the difference between the "AND" and "+" operator?
> >
> > In this query, "y" is mandatory, but documents that also match "x" will
> > score higher then documents that only match "y"...
> >
> >        x +y
> >
> > In both of these queries, "x" and "y" are both mandatory; a document only
> > matching one of them will not match the query...
> >
> >        +x +y
> >        x AND y
> >
>
> That's to say    +x+y == x AND y ?
>
> >
> >
> > -Hoss
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>

--001636831e7634dc34049641f796--

From java-user-return-47968-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 11:43:17 2010
Return-Path: <java-user-return-47968-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33218 invoked from network); 30 Nov 2010 11:43:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 11:43:17 -0000
Received: (qmail 38583 invoked by uid 500); 30 Nov 2010 11:43:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38363 invoked by uid 500); 30 Nov 2010 11:43:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38351 invoked by uid 99); 30 Nov 2010 11:43:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 11:43:13 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 11:43:05 +0000
Received: by bwz9 with SMTP id 9so5453537bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 03:42:45 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:from:date
         :message-id:subject:to:content-type;
        bh=/EFdycTzoAAqrJaWCT4bbD5cZa6U2tJwMU+Ki3HgbnM=;
        b=UJSqWz4s/q2yWQDpputz3VUwg8beZ6mo0nJq8pxntUkULKf+4zgrkPzY5MyVfbjNDZ
         3neJOzz2ppyBEEskK+vgWysr1tjKWcni97k0rT6aVn9A8xaAZvimJ29D78BtIWt/oJs7
         RK33KOni+LM/dyfn6711smjHvuYYStciHnP9U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=sGPbTYHnaM7fDzBPLRPE0xVOkY71L/AayP8y8uyo/rUQ7J0bz5hCP8JOWCy+W6dewz
         spXwOEFtUuIlG1KOOxxO9bGM7dXFhvFs7Na5lpa6g1ZBIj9RaDq8ez9xPIHilutN8+IS
         /urmum30DdSLHIi31BvZdT1b3E2Ybt16HO1fM=
Received: by 10.204.127.94 with SMTP id f30mr6431045bks.1.1291117365521; Tue,
 30 Nov 2010 03:42:45 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Tue, 30 Nov 2010 03:42:24 -0800 (PST)
From: maven apache <apachemaven0@gmail.com>
Date: Tue, 30 Nov 2010 19:42:24 +0800
Message-ID: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
Subject: field cross search in lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d96d98ef6ead049643af1b
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d96d98ef6ead049643af1b
Content-Type: text/plain; charset=ISO-8859-1

Hi: I have two documents:

title                       body
Lucene In Action            A high-performance, full-featured text search
engine library.
Lucene Practice             Use lucene in your application

Now,I search "lucene performance" using

private String[] f = { "title", "body"};
private Occur[] should = { Occur.SHOULD, Occur.SHOULD};
Query q = MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
performance", f, should,new IKAnalyzer());

Then I get two hits: "Lucene In Action" and "Lucene Practice".

However I do not want the "Lucene practice" in the search result.

That's to say,I just want the documents who own all my search terms can be
returned,the "lucene parctice" does not contain the term "performance",so it
should not be returned.

Any ideas?

BTW,I do really cautioned when asking a new question in the list,but I
really have no idea after read the documents and googling,hoping not disturb
you guys.

--0016e6d96d98ef6ead049643af1b--

From java-user-return-47969-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 12:04:13 2010
Return-Path: <java-user-return-47969-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37686 invoked from network); 30 Nov 2010 12:04:12 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 12:04:12 -0000
Received: (qmail 59402 invoked by uid 500); 30 Nov 2010 12:04:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59165 invoked by uid 500); 30 Nov 2010 12:04:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59157 invoked by uid 99); 30 Nov 2010 12:04:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:04:09 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of serera@gmail.com designates 74.125.83.176 as permitted sender)
Received: from [74.125.83.176] (HELO mail-pv0-f176.google.com) (74.125.83.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:04:01 +0000
Received: by pvb32 with SMTP id 32so1244185pvb.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 04:03:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=Esxg9K3FrHvtMd6A/D1BaJQd8S9Tw0aO61pjLqMivvs=;
        b=vv2gvD0oF5sQSJC76XKzcc3MoAkltbWysnu9+yc6hGcYqJzo0SDo+tAYvUNO8nASsW
         YEsZkXLVgc16HW9ec6gvcuwYAMzdEKYvIwdhGhTBjExgSPMP4tM26m/LdRhpI9cVBXX5
         KaAlEL38WAxMHbPK5AnmYk3D1EtKDu2lUqOpA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=p9CaFR+SMZO5hSKhAY9Q0SupvOmXt6AqRZaxVYusq/EyhVAXOcbr2xoulolOsfFDeq
         opkIoHJzUcjuTJDe93ALOuhzf3/hVHQDtqWbKasANOJg/tBVBR/GaWeorahE1yMxs9/z
         GfKTvvwdwIPPpJKXDrNwwWpIM2peGdBC+NRsQ=
MIME-Version: 1.0
Received: by 10.142.222.8 with SMTP id u8mr6892226wfg.404.1291118619760; Tue,
 30 Nov 2010 04:03:39 -0800 (PST)
Received: by 10.142.204.7 with HTTP; Tue, 30 Nov 2010 04:03:39 -0800 (PST)
In-Reply-To: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
References: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
Date: Tue, 30 Nov 2010 14:03:39 +0200
Message-ID: <AANLkTi=PR9faMeiareELVbnv+s-zmWUD1a2SRNwMUQn3@mail.gmail.com>
Subject: Re: field cross search in lucene
From: Shai Erera <serera@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd32dc4b197b5049643fa95
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd32dc4b197b5049643fa95
Content-Type: text/plain; charset=ISO-8859-1

Can you try to do:
QueryParser qp = new MultiFieldQueryParser(params);
qp.setDefaultOperator(Operator.AND);
qp.parse(query);

See if that helps -- the static parse method instantiates its own QP and
therefore you cannot tell it that the default OP is AND.

Shai

On Tue, Nov 30, 2010 at 1:42 PM, maven apache <apachemaven0@gmail.com>wrote:

> Hi: I have two documents:
>
> title                       body
> Lucene In Action            A high-performance, full-featured text search
> engine library.
> Lucene Practice             Use lucene in your application
>
> Now,I search "lucene performance" using
>
> private String[] f = { "title", "body"};
> private Occur[] should = { Occur.SHOULD, Occur.SHOULD};
> Query q = MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
> performance", f, should,new IKAnalyzer());
>
> Then I get two hits: "Lucene In Action" and "Lucene Practice".
>
> However I do not want the "Lucene practice" in the search result.
>
> That's to say,I just want the documents who own all my search terms can be
> returned,the "lucene parctice" does not contain the term "performance",so
> it
> should not be returned.
>
> Any ideas?
>
> BTW,I do really cautioned when asking a new question in the list,but I
> really have no idea after read the documents and googling,hoping not
> disturb
> you guys.
>

--000e0cd32dc4b197b5049643fa95--

From java-user-return-47970-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 12:05:53 2010
Return-Path: <java-user-return-47970-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46344 invoked from network); 30 Nov 2010 12:05:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 12:05:53 -0000
Received: (qmail 63366 invoked by uid 500); 30 Nov 2010 12:05:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63319 invoked by uid 500); 30 Nov 2010 12:05:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63311 invoked by uid 99); 30 Nov 2010 12:05:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:05:49 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:05:42 +0000
Received: by bwz9 with SMTP id 9so5473910bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 04:05:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=b2vCZyhQdgHoogkEVfOOscTblqVjoyLkYaGrYWN4X0A=;
        b=GA45clcNN4B09ZmViCvYFMAuM1v5zK4dyYohy0J5Tkp6taFsyFOA6lbcl64Rfow2sO
         CTKcjgwRKwQpTxHWwcAWLzOHjJUeA/8ly3j/PPBHmfEnKev4iR59gE/5TRyay21YAHzb
         lr79a72NGRTaw2OZZJa+cfsHRGWs9sPUG5P0E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=db63UYsv6P2xGeVXJhcT/ZHpztS7JBYmHCxvpAOzrOaWeWmOcri48Q1m2EIs+M6Ycv
         okiCsP37VBE5RoKeqZt9yrgrVnjAsXKq2N0Dwn8pnBvTea1/PW2paQC0h5EAg1DQEr2h
         HScDtI1mNw6nUcmHqdgGTVoCZNEC3ggwfzHD4=
Received: by 10.204.116.4 with SMTP id k4mr6406951bkq.187.1291118721496; Tue,
 30 Nov 2010 04:05:21 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Tue, 30 Nov 2010 04:05:01 -0800 (PST)
In-Reply-To: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
References: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 30 Nov 2010 12:05:01 +0000
Message-ID: <AANLkTi=DnjDSHBxbs3-BT-9PK7k6nHrABnL4mni_0sfZ@mail.gmail.com>
Subject: Re: field cross search in lucene
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Sounds like you need to call setDefaultOperator(AND_OPERATOR).  See
the javadocs for MultiFieldQueryParser constructors.  They give
examples.

Personally I tend to get confused with all the Should/Must/And/Or
combinations with searches on multiple terms across multiple fields
and wherever possible prefer to add a simple "keywords" or "contents"
field to docs and just dump all the generally searchable terms in
there.


--
Ian.


On Tue, Nov 30, 2010 at 11:42 AM, maven apache <apachemaven0@gmail.com> wro=
te:
> Hi: I have two documents:
>
> title =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 body
> Lucene In Action =A0 =A0 =A0 =A0 =A0 =A0A high-performance, full-featured=
 text search
> engine library.
> Lucene Practice =A0 =A0 =A0 =A0 =A0 =A0 Use lucene in your application
>
> Now,I search "lucene performance" using
>
> private String[] f =3D { "title", "body"};
> private Occur[] should =3D { Occur.SHOULD, Occur.SHOULD};
> Query q =3D MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
> performance", f, should,new IKAnalyzer());
>
> Then I get two hits: "Lucene In Action" and "Lucene Practice".
>
> However I do not want the "Lucene practice" in the search result.
>
> That's to say,I just want the documents who own all my search terms can b=
e
> returned,the "lucene parctice" does not contain the term "performance",so=
 it
> should not be returned.
>
> Any ideas?
>
> BTW,I do really cautioned when asking a new question in the list,but I
> really have no idea after read the documents and googling,hoping not dist=
urb
> you guys.
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47971-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 12:09:42 2010
Return-Path: <java-user-return-47971-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46802 invoked from network); 30 Nov 2010 12:09:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 12:09:42 -0000
Received: (qmail 66903 invoked by uid 500); 30 Nov 2010 12:09:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66772 invoked by uid 500); 30 Nov 2010 12:09:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66758 invoked by uid 99); 30 Nov 2010 12:09:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:09:38 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:09:31 +0000
Received: by bwz9 with SMTP id 9so5478143bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 04:09:10 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=nhvhECIQQkaIb8ffP4nmB5yeMyf+ylfy+xFroxn5QTw=;
        b=IHsNcHZZCIDwil5+bXmSn4xWXXVw6sN81zDViAhB+VUgK5KGPlJ0CnmTdHzJwU5giA
         5Pj2OsNTykpoDf29XSBxfNSwYBamRm17Ax3i6GVjxE54nv/plLKMiy71cyZDPmsWrvl8
         VHnR3q2EmHNU3zXA/4i4ss6nxd6jEJKDR2wjo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=e2w3OJGYs7OdUsvUA07UV2CfEC58ZTTrB4+1fNU35s83GynMdgyBfMFyop5vAkqxLh
         Mq2pke8P2t5kDFmtaWcWIDoTYkuPh1en8hKmvJ+tDual6gA4kwJFkQBAWJ1oj3wGWMx+
         3YWcSMfCmwmCD+jhHkX9U/6wV6HNrTUkT60HE=
Received: by 10.204.98.75 with SMTP id p11mr6470397bkn.55.1291118950390; Tue,
 30 Nov 2010 04:09:10 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Tue, 30 Nov 2010 04:08:50 -0800 (PST)
In-Reply-To: <AANLkTi=PR9faMeiareELVbnv+s-zmWUD1a2SRNwMUQn3@mail.gmail.com>
References: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com> <AANLkTi=PR9faMeiareELVbnv+s-zmWUD1a2SRNwMUQn3@mail.gmail.com>
From: maven apache <apachemaven0@gmail.com>
Date: Tue, 30 Nov 2010 20:08:50 +0800
Message-ID: <AANLkTimQU5t9JDE0JWwSsrxRhrD4p2p__gEy5Ai8Wdm5@mail.gmail.com>
Subject: Re: field cross search in lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b9588669acb0496440ebe

--0016363b9588669acb0496440ebe
Content-Type: text/plain; charset=ISO-8859-1

2010/11/30 Shai Erera <serera@gmail.com>

> Can you try to do:
> QueryParser qp = new MultiFieldQueryParser(params);
> qp.setDefaultOperator(Operator.AND);
> qp.parse(query);
>
> See if that helps -- the static parse method instantiates its own QP and
> therefore you cannot tell it that the default OP is AND.
>
> Thanks,I will have a try tommorrow.


> Shai
>
> On Tue, Nov 30, 2010 at 1:42 PM, maven apache <apachemaven0@gmail.com
> >wrote:
>
> > Hi: I have two documents:
> >
> > title                       body
> > Lucene In Action            A high-performance, full-featured text search
> > engine library.
> > Lucene Practice             Use lucene in your application
> >
> > Now,I search "lucene performance" using
> >
> > private String[] f = { "title", "body"};
> > private Occur[] should = { Occur.SHOULD, Occur.SHOULD};
> > Query q = MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
> > performance", f, should,new IKAnalyzer());
> >
> > Then I get two hits: "Lucene In Action" and "Lucene Practice".
> >
> > However I do not want the "Lucene practice" in the search result.
> >
> > That's to say,I just want the documents who own all my search terms can
> be
> > returned,the "lucene parctice" does not contain the term "performance",so
> > it
> > should not be returned.
> >
> > Any ideas?
> >
> > BTW,I do really cautioned when asking a new question in the list,but I
> > really have no idea after read the documents and googling,hoping not
> > disturb
> > you guys.
> >
>

--0016363b9588669acb0496440ebe--

From java-user-return-47972-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 12:09:56 2010
Return-Path: <java-user-return-47972-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46882 invoked from network); 30 Nov 2010 12:09:55 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 12:09:55 -0000
Received: (qmail 68766 invoked by uid 500); 30 Nov 2010 12:09:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68720 invoked by uid 500); 30 Nov 2010 12:09:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68712 invoked by uid 99); 30 Nov 2010 12:09:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:09:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 74.125.82.176 as permitted sender)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:09:46 +0000
Received: by wyf28 with SMTP id 28so6030195wyf.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 04:09:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=/3LKkEQcT+9ZynJ4KoKxP4IsBp+Sm1esIZRpAWQzq7A=;
        b=Irzy1krTFTmo9eaoP2Wcvf7VSh8nzctLyfDbmA0snO95zN0XZS11OWHuLZrsln1ejv
         UPNeZXYCvFIEJuZn4DbbRcPRED7oUeaEARihbCvT8ur/lw6kpgmELka3BXXCEHW7YZIm
         LY8UY89Xfim6WMGvRoroEykLRUOfV23IdipEI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=kxHBPpuUeDktjxNMOwft4z5PspCqfK+aZ45PydbO99nDTBeCI3q7D6zrvQNB3cBExK
         /bWQV3iuKyeNSHxuJCnxMYtWarsQxMl/5jM7nvWJfIBeo7BKPDMSYfyEMJc9Haan3VhP
         AYAfNBzwSn+aZOqYF8TxT4WTqtSKUpIzyWMzI=
Received: by 10.227.134.201 with SMTP id k9mr7524603wbt.177.1291118964929;
 Tue, 30 Nov 2010 04:09:24 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.149.6 with HTTP; Tue, 30 Nov 2010 04:09:02 -0800 (PST)
In-Reply-To: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
References: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Tue, 30 Nov 2010 17:39:02 +0530
Message-ID: <AANLkTinG0-H509jMMB07d8eVVPtdD8OUSDSqmVS6HUbX@mail.gmail.com>
Subject: Re: field cross search in lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016367f9fb04481e40496440f00

--0016367f9fb04481e40496440f00
Content-Type: text/plain; charset=ISO-8859-1

You could change Occur.SHOULD to Occur.MUST for both fields.
This should work for you if what I understood is what you wanted.


--
Anshum Gupta
http://ai-cafe.blogspot.com


On Tue, Nov 30, 2010 at 5:12 PM, maven apache <apachemaven0@gmail.com>wrote:

> Hi: I have two documents:
>
> title                       body
> Lucene In Action            A high-performance, full-featured text search
> engine library.
> Lucene Practice             Use lucene in your application
>
> Now,I search "lucene performance" using
>
> private String[] f = { "title", "body"};
> private Occur[] should = { Occur.SHOULD, Occur.SHOULD};
> Query q = MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
> performance", f, should,new IKAnalyzer());
>
> Then I get two hits: "Lucene In Action" and "Lucene Practice".
>
> However I do not want the "Lucene practice" in the search result.
>
> That's to say,I just want the documents who own all my search terms can be
> returned,the "lucene parctice" does not contain the term "performance",so
> it
> should not be returned.
>
> Any ideas?
>
> BTW,I do really cautioned when asking a new question in the list,but I
> really have no idea after read the documents and googling,hoping not
> disturb
> you guys.
>

--0016367f9fb04481e40496440f00--

From java-user-return-47973-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 12:10:52 2010
Return-Path: <java-user-return-47973-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47389 invoked from network); 30 Nov 2010 12:10:51 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 12:10:51 -0000
Received: (qmail 73115 invoked by uid 500); 30 Nov 2010 12:10:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72900 invoked by uid 500); 30 Nov 2010 12:10:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72888 invoked by uid 99); 30 Nov 2010 12:10:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:10:48 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:10:41 +0000
Received: by bwz9 with SMTP id 9so5479413bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 04:10:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=Nhu5AX/fWN4GWJ7OeUw5XKvTH+q/KKUKABg/KGSMe3A=;
        b=gAGzUw3Xlc5rmclwqzcOkemV+vA7EMdm4SLkoHNXLpU6wf41L3PGxUVoSuAPlN2FdX
         37B/QDQM9+J5FOzMfW7LAZ7gNOWRvsucM0JDmQ/cQeVx/MGUUdG/6ebz+JThGumnAX72
         He2TgMnCrVz1mLbihwzNk+DOGPyj1+eMWBhbM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=CgeSY6eJNS2vfWFwnvm6q+xmeA/zcL2tZNr6K5kM27Grj8aqLM3Nx4GB+YWYwrbszQ
         7rNqD9NplcKRd9okDsn7W6C4kwrzlTPodzG8+kTBxHxyvPNyhpV6NkayzED0Zvln3xU+
         yKA2LZqY3MyI4OMUtaHGT5R0ikNWzOT9WUvW4=
Received: by 10.204.119.133 with SMTP id z5mr6510880bkq.82.1291119020698; Tue,
 30 Nov 2010 04:10:20 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Tue, 30 Nov 2010 04:10:00 -0800 (PST)
In-Reply-To: <AANLkTi=DnjDSHBxbs3-BT-9PK7k6nHrABnL4mni_0sfZ@mail.gmail.com>
References: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com> <AANLkTi=DnjDSHBxbs3-BT-9PK7k6nHrABnL4mni_0sfZ@mail.gmail.com>
From: maven apache <apachemaven0@gmail.com>
Date: Tue, 30 Nov 2010 20:10:00 +0800
Message-ID: <AANLkTik-8dj1KBuL_KoH=0Vk-h2tKwXfvDY6DK-czHwt@mail.gmail.com>
Subject: Re: field cross search in lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c5a81c976ce004964412f8
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c5a81c976ce004964412f8
Content-Type: text/plain; charset=ISO-8859-1

2010/11/30 Ian Lea <ian.lea@gmail.com>

> Sounds like you need to call setDefaultOperator(AND_OPERATOR).  See
> the javadocs for MultiFieldQueryParser constructors.  They give
> examples.
>
> Personally I tend to get confused with all the Should/Must/And/Or
> combinations with searches on multiple terms across multiple fields
> and wherever possible prefer to add a simple "keywords" or "contents"
> field to docs and just dump all the generally searchable terms in
> there.
>
In fact I am using hibernate-search. All the indexing work is done by
hibernate. :)


>
>
> --
> Ian.
>
>
> On Tue, Nov 30, 2010 at 11:42 AM, maven apache <apachemaven0@gmail.com>
> wrote:
> > Hi: I have two documents:
> >
> > title                       body
> > Lucene In Action            A high-performance, full-featured text search
> > engine library.
> > Lucene Practice             Use lucene in your application
> >
> > Now,I search "lucene performance" using
> >
> > private String[] f = { "title", "body"};
> > private Occur[] should = { Occur.SHOULD, Occur.SHOULD};
> > Query q = MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
> > performance", f, should,new IKAnalyzer());
> >
> > Then I get two hits: "Lucene In Action" and "Lucene Practice".
> >
> > However I do not want the "Lucene practice" in the search result.
> >
> > That's to say,I just want the documents who own all my search terms can
> be
> > returned,the "lucene parctice" does not contain the term "performance",so
> it
> > should not be returned.
> >
> > Any ideas?
> >
> > BTW,I do really cautioned when asking a new question in the list,but I
> > really have no idea after read the documents and googling,hoping not
> disturb
> > you guys.
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636c5a81c976ce004964412f8--

From java-user-return-47974-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 12:40:02 2010
Return-Path: <java-user-return-47974-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60600 invoked from network); 30 Nov 2010 12:40:01 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 12:40:01 -0000
Received: (qmail 8581 invoked by uid 500); 30 Nov 2010 12:39:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8237 invoked by uid 500); 30 Nov 2010 12:39:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8229 invoked by uid 99); 30 Nov 2010 12:39:58 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:39:58 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 12:39:53 +0000
Received: by bwz9 with SMTP id 9so5506835bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 04:39:32 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=jSWkX76E4/331UQKkl01UCjXETL9G7YgYu/SLLtsmv0=;
        b=r5LX3UuRaxr5kV+3qJRi/vTQBGFeO3mTj35n8Q/SQSWjDtU0g4GgyUJD5FpE7NbXXi
         xJGHWdjgg7bslgC0lKIFjxcu3TW2xlK2C9qRcq77zlCZnSp/kGRIQNuK0D8W16ZyQjbZ
         vsilLIn2yniHkySfpLWUWm2DlxwmOAz5gF95g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=nu5CMQmMBtf0GyNijPmY0s9HzVtUu+sc7WJtK7YB0OTMabbGC4rqSyErr3Gh9pJq3I
         p2WWNX0jF/g1EbHWNspGU8/M6qt35BCKLA6sHwpWUiVJtFF/KoobMz2I8WDXfJChJoxt
         nip9w7zb+rsmnP/qzrEHoh1yp3KMZczHT98lY=
Received: by 10.204.113.74 with SMTP id z10mr6474372bkp.25.1291120771930; Tue,
 30 Nov 2010 04:39:31 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.77.201 with HTTP; Tue, 30 Nov 2010 04:39:11 -0800 (PST)
In-Reply-To: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
References: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Tue, 30 Nov 2010 07:39:11 -0500
Message-ID: <AANLkTi=4wFV1u1i8AZaPo=sjfhX3a8APuMncsK90p1N9@mail.gmail.com>
Subject: Re: precision and recall in lucene
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

On Mon, Nov 29, 2010 at 8:01 AM, Yakob <jacobian@opensuse-id.org> wrote:
> hello all
> I was wondering, if I want to measure precision and recall in lucene
> then what's the best way for me to do it? is there any sample cource
> code that I can use?
>

Have a look at contrib/benchmark under the
org.apache.lucene.benchmark.quality package.
There is code (for example
org.apache.lucene.benchmark.quality.trec.QueryDriver) that can run an
experiment and output what you need for trec_eval.exe
I think there is some additional documentation on how to use this in
Lucene in Action 2.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47975-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 13:08:25 2010
Return-Path: <java-user-return-47975-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77885 invoked from network); 30 Nov 2010 13:08:25 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 13:08:25 -0000
Received: (qmail 42432 invoked by uid 500); 30 Nov 2010 13:08:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42247 invoked by uid 500); 30 Nov 2010 13:08:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42239 invoked by uid 99); 30 Nov 2010 13:08:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 13:08:21 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 13:08:14 +0000
Received: by qwj9 with SMTP id 9so231433qwj.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 05:07:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=ZPgDuD3a+G8nvD13p7jDNL0IRwNIuumttQwROhrNgE4=;
        b=QxCEB3z/8+Slo7We2nmBZrPK2bmCw4bQYTnC9hHI+Zcbry6bF3F8GtIoGJH16oF/wN
         swNO9ilSD31Y8iAh4cx8TGqAoDOqX3lQ1+l5RhCQQP66zsUHBgHnGwxHHf+1ZUnlqqnn
         Tcu8eLTd6mpxhQeEKZ2paWDO281Jhzs3JKNDA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VqAc4hEzcPA8R0rGT/r2XRy80qRr6ZvoXDX/wvKK8U1WCieEDzTyHNM7+z6e/f6t4G
         /2LXXDga3OAp+ohfNQQdn8NBPTKDGmWrHIIqPf16RltkckWvUuhNArzoEtsQkcX//XxE
         mYEFs4Q96PCAtEw5TkUov3leLHCuYlmOM1t8E=
MIME-Version: 1.0
Received: by 10.229.214.76 with SMTP id gz12mr6051871qcb.196.1291122466921;
 Tue, 30 Nov 2010 05:07:46 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Tue, 30 Nov 2010 05:07:46 -0800 (PST)
In-Reply-To: <AANLkTimYMVah0FV5+ZTHT17aXv39ALsiLVy_a3Bu4nNP@mail.gmail.com>
References: <AANLkTimzdzDrLyC=_83KR_Hv8GZgVBVNu-CUB63hXkxn@mail.gmail.com>
	<2D127F11DC79714E9B6A43AC9458147F8264B456@suex07-mbx-03.ad.syr.edu>
	<AANLkTimYMVah0FV5+ZTHT17aXv39ALsiLVy_a3Bu4nNP@mail.gmail.com>
Date: Tue, 30 Nov 2010 08:07:46 -0500
Message-ID: <AANLkTikjKduGotWzNT6Zse83cVwVQUqcP1hH9Lkmronp@mail.gmail.com>
Subject: Re: Analyzer
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163628410c0196d7049644e0b9
X-Virus-Checked: Checked by ClamAV on apache.org

--00163628410c0196d7049644e0b9
Content-Type: text/plain; charset=ISO-8859-1

WhitespaceAnalyzer does just that, splits the incoming stream on
white space.

>From the javadocs for StandardAnalyzer:

A grammar-based tokenizer constructed with JFlex

This should be a good tokenizer for most European-language documents:

   - Splits words at punctuation characters, removing punctuation. However,
   a dot that's not followed by whitespace is considered part of a token.
   - Splits words at hyphens, unless there's a number in the token, in which
   case the whole token is interpreted as a product number and is not split.
   - Recognizes email addresses and internet hostnames as one token.

Many applications have specific tokenizer needs. If this tokenizer does not
suit your application, please consider copying this source code directory to
your project and maintaining your own grammar-based tokenizer.


Best

Erick

On Tue, Nov 30, 2010 at 12:06 AM, manjula wijewickrema
<manjula53@gmail.com>wrote:

> Hi Steve,
>
> Thanx a lot for your reply. Yes there are only two classes and it's corrcet
> that the way you have realized the problem. As you have instructed, I
> checked WhitespaceAnalyzer for querying (instead of StandardAnalyzer) and
> it
> seems to me that it gives better results rather than StandardAnalyzer. So
> could you please let me know what are the differences between
> StandardAnalyzer and WhitespaceAnalyzer. I highly appriciate your response.
> Thanx.
>
> Manjula.
>
>
> On Mon, Nov 29, 2010 at 7:32 PM, Steven A Rowe <sarowe@syr.edu> wrote:
>
> > Hi Manjula,
> >
> > It's not terribly clear what you're doing here - I got lost in your
> > description of your (two? or maybe four?) classes.  Sometimes things are
> > easier to understand if you provide more concrete detail.
> >
> > I suspect that you could benefit from reading the book Lucene in Action,
> > 2nd edition:
> >
> >   http://www.manning.com/hatcher3/
> >
> > You would also likely benefit from using Luke, the Lucene index browser,
> to
> > better understand your indexes' contents and debug how queries match
> > documents:
> >
> >   http://code.google.com/p/luke/
> >
> > I think your question is whether you're using Analyzers correctly.  It
> > sounds like you are creating two separate indexes (one for each of your
> > classes), and you're using SnowballAnalyzer on the indexing side for both
> > indexes, and StandardAnalyzer on the query side.
> >
> > The usual advice is to use the same Analyzer on both the query and the
> > index side.  But it appears to be the case that you are taking stemmed
> index
> > terms from your index #1 and then querying index #2 using these stemmed
> > terms.  If this is true, then you want the query-time analyzer in your
> > second index not to change the query terms.  You'll likely get better
> > results using WhitespaceAnalyzer, which tokenizes on whitespace and does
> no
> > further analysis, rather than StandardAnalyzer.
> >
> > Steve
> >
> > > -----Original Message-----
> > > From: manjula wijewickrema [mailto:manjula53@gmail.com]
> > > Sent: Monday, November 29, 2010 4:32 AM
> > > To: java-user@lucene.apache.org
> > > Subject: Analyzer
> > >
> > > Hi,
> > >
> > > In my work, I am using Lucene and two java classes. In the first one, I
> > > index a document and in the second one, I try to search the most
> relevant
> > > document for the indexed document in the first one. In the first java
> > > class,
> > > I use the SnowballAnalyzer in the createIndex method and
> StandardAnalyzer
> > > in
> > > the searchIndex method and pass the highest frequency terms into the
> > > second
> > > Java class. In the second class, I use SnowballAnalyzer in the
> > createIndex
> > > method (this index is for the collection of documents to be searched,
> or
> > > it
> > > is my database) and StandardAnalyser in the searchIndex method (I pass
> > the
> > > highest frequently occuring term of the first class as the search term
> > > parameter to the searchIndex method of the second class). Using
> Analyzers
> > > in
> > > this manner, what I am willing is to do the stemming, stop-words in
> both
> > > indexes (in both classes) and to search those a few high frequency
> words
> > > (of
> > > the first index) in the second index. So, if my intention is clear to
> > you,
> > > could you please let me know whether it is correct or not the way I
> have
> > > used Analyzers? I highly appreciate any comment.
> > >
> > > Thanx.
> > > Manjula.
> >
>

--00163628410c0196d7049644e0b9--

From java-user-return-47976-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 13:14:58 2010
Return-Path: <java-user-return-47976-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79446 invoked from network); 30 Nov 2010 13:14:57 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 13:14:57 -0000
Received: (qmail 51798 invoked by uid 500); 30 Nov 2010 13:14:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51642 invoked by uid 500); 30 Nov 2010 13:14:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51634 invoked by uid 99); 30 Nov 2010 13:14:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 13:14:55 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of apachemaven0@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 13:14:48 +0000
Received: by bwz9 with SMTP id 9so5541295bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 05:14:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=nRKnXwRIoU0XwUcg27p0+N8nGfoTFL/b/21JHSMNc5Y=;
        b=cjx9sOC2GTrGliXttBIWVGCQARrv7GvjgSPGPPJL4kmAZAINk2nHYF96DgIU5muQMt
         6FiQO/Tm+1wyMp7rkHj9gRCrr9PLJ8EJdhUuUQeZ+A/IcYCZDpeFMWxBbncUbcBlo2R3
         M/nvYON62H3BplyY3UfeaD03apSScYpkVF81E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=bjYEU0TqWxDTyBx8GPR78fod+pcCJCljE966IKmoug7UHKLgHKEaPgkusKdSJ7/Cp6
         a4qmW/jg2mnOY6ZrFI8AyXYdvIuUm35tvR9pg1AWaXwYqRZC3XQvTtZdT3+FzbAohz9/
         vx45mS9pc7vqIAev5ZMLDN5nmP7lQFBT9fRx0=
Received: by 10.204.98.75 with SMTP id p11mr6579577bkn.55.1291122863157; Tue,
 30 Nov 2010 05:14:23 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.81.145 with HTTP; Tue, 30 Nov 2010 05:14:02 -0800 (PST)
In-Reply-To: <AANLkTinG0-H509jMMB07d8eVVPtdD8OUSDSqmVS6HUbX@mail.gmail.com>
References: <AANLkTi=BPgxtUz-ePGgnOAdVkrCHitjDjJ4s3EaojW0W@mail.gmail.com> <AANLkTinG0-H509jMMB07d8eVVPtdD8OUSDSqmVS6HUbX@mail.gmail.com>
From: maven apache <apachemaven0@gmail.com>
Date: Tue, 30 Nov 2010 21:14:02 +0800
Message-ID: <AANLkTin0zWqBtLE28KUHZ+R==xVtZQnvT-gSsW70A=92@mail.gmail.com>
Subject: Re: field cross search in lucene
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b9588a01a8f049644f7a7
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b9588a01a8f049644f7a7
Content-Type: text/plain; charset=ISO-8859-1

Hi:
Sorry for later reply,I was just doing some tests.

Using the QueryParser.setDefaultOperator(..) do work ,but I found it just
for English character searching:

I have make a test,and compare three manner:
1)MultiFieldQueryParser.parse.....
2)Set the Operator of MultiFieldQueryParser..
3)Using another QueryParser:IKQueryParser (You can find it here :
http://code.google.com/p/ik-analyzer/)
The English searching:

http://dpaste.org/IEwy/ <http://dpaste.org/joOA/>

It worked as I wanted.

Then I tried to search Chinese character,I found it does not work.
http://dpaste.org/aUBF/

So,any better ideas for search Chinese characters?

2010/11/30 Anshum <anshumg@gmail.com>

> You could change Occur.SHOULD to Occur.MUST for both fields.
> This should work for you if what I understood is what you wanted.
>
>
> --
> Anshum Gupta
> http://ai-cafe.blogspot.com
>
>
> On Tue, Nov 30, 2010 at 5:12 PM, maven apache <apachemaven0@gmail.com
> >wrote:
>
> > Hi: I have two documents:
> >
> > title                       body
> > Lucene In Action            A high-performance, full-featured text search
> > engine library.
> > Lucene Practice             Use lucene in your application
> >
> > Now,I search "lucene performance" using
> >
> > private String[] f = { "title", "body"};
> > private Occur[] should = { Occur.SHOULD, Occur.SHOULD};
> > Query q = MultiFieldQueryParser.parse(Version.LUCENE_29, "lucene
> > performance", f, should,new IKAnalyzer());
> >
> > Then I get two hits: "Lucene In Action" and "Lucene Practice".
> >
> > However I do not want the "Lucene practice" in the search result.
> >
> > That's to say,I just want the documents who own all my search terms can
> be
> > returned,the "lucene parctice" does not contain the term "performance",so
> > it
> > should not be returned.
> >
> > Any ideas?
> >
> > BTW,I do really cautioned when asking a new question in the list,but I
> > really have no idea after read the documents and googling,hoping not
> > disturb
> > you guys.
> >
>

--0016363b9588a01a8f049644f7a7--

From java-user-return-47977-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 15:20:57 2010
Return-Path: <java-user-return-47977-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57086 invoked from network); 30 Nov 2010 15:20:53 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 15:20:53 -0000
Received: (qmail 81957 invoked by uid 500); 30 Nov 2010 15:20:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81662 invoked by uid 500); 30 Nov 2010 15:20:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81654 invoked by uid 99); 30 Nov 2010 15:20:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 15:20:50 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of falha404@gmail.com designates 74.125.82.48 as permitted sender)
Received: from [74.125.82.48] (HELO mail-ww0-f48.google.com) (74.125.82.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 15:20:44 +0000
Received: by wwb17 with SMTP id 17so2923299wwb.5
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 07:20:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:received:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        bh=NIUqvtcUfeRguJFJsm0kvkN3/UoyZDCevM9kU0WWIW8=;
        b=OQA4aHf9YnlhCxWK+KHXPgkakDQsnCyF9iX1+jc8jYiB2hwwYEO90fgE0tNn1HT9os
         hJOFyqMYn99nULBloKBQArNanhWHaapjNTAzWgNq9DyUv5zUueMJ4t5U89M/6+gMt3Lz
         mz9klck7zpPYtd9aIBDjC6eOX9mIqJmIw4AY8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        b=uszzhL/qx/EprRfu8T7S6h5/69xA9UmK4l40R96B9lsxYDgPmA/FDf99v3mSPLB34m
         vK4d1ZSJI5tl//GqefQ8GIPb1XusahbZxJSoTBQxZViu45o8lBwCu7joMDtJ449fDqEJ
         HBe8WoSU1tJZIYvcGOo28Pv6m0OiFbeYW/7tk=
Received: by 10.227.170.78 with SMTP id c14mr7864726wbz.49.1291130422627; Tue,
 30 Nov 2010 07:20:22 -0800 (PST)
MIME-Version: 1.0
Sender: falha404@gmail.com
Received: by 10.216.20.4 with HTTP; Tue, 30 Nov 2010 07:20:02 -0800 (PST)
From: Fabiano Nunes <fabiano@nunes.me>
Date: Tue, 30 Nov 2010 13:20:02 -0200
X-Google-Sender-Auth: cCT21nB_JA8JRd35ffezKFw9thQ
Message-ID: <AANLkTik6H5mXo9=y2ww=CJ46j2Z=ecLapE3FD_uhU9a0@mail.gmail.com>
Subject: Retrieving payload attribute in highlighter
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=90e6ba476541330cab049646ba39

--90e6ba476541330cab049646ba39
Content-Type: text/plain; charset=ISO-8859-1

Hello,
I'm trying to retrieve payloads from the highlighteds terms by Highlighter
class. In my tests, all terms returned from Highlighter has null as payload.
Example:

Highlighter h = new Highlighter(new Formatter() {
public String highlightTerm(String originalText, TokenGroup tokenGroup) {
Token token = tokenGroup.getToken(0);
 Payload payload = token.getPayload();
 assertNotNull(payload); // <---------------- payload is always null
 return originalText;
}
}, scorer);

It seems that Highlighter removes payload attribute from all terms before
creating its TokenGroup.
How can I preserve it?

Thanks.

--90e6ba476541330cab049646ba39--

From java-user-return-47978-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 15:46:58 2010
Return-Path: <java-user-return-47978-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68061 invoked from network); 30 Nov 2010 15:46:58 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 15:46:58 -0000
Received: (qmail 31165 invoked by uid 500); 30 Nov 2010 15:46:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30866 invoked by uid 500); 30 Nov 2010 15:46:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30858 invoked by uid 99); 30 Nov 2010 15:46:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 15:46:55 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.161.176] (HELO mail-gx0-f176.google.com) (209.85.161.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 15:46:50 +0000
Received: by gxk4 with SMTP id 4so3275596gxk.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 07:46:29 -0800 (PST)
MIME-Version: 1.0
Received: by 10.151.143.10 with SMTP id v10mr3957742ybn.208.1291131988880;
 Tue, 30 Nov 2010 07:46:28 -0800 (PST)
Received: by 10.150.200.5 with HTTP; Tue, 30 Nov 2010 07:46:28 -0800 (PST)
In-Reply-To: <AANLkTi=4wFV1u1i8AZaPo=sjfhX3a8APuMncsK90p1N9@mail.gmail.com>
References: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
	<AANLkTi=4wFV1u1i8AZaPo=sjfhX3a8APuMncsK90p1N9@mail.gmail.com>
Date: Tue, 30 Nov 2010 22:46:28 +0700
Message-ID: <AANLkTik7q=UsH8OPAbvpMoot+EcB3rnse1351D13siL-@mail.gmail.com>
Subject: Re: precision and recall in lucene
From: Yakob <jacobian@opensuse-id.org>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On 11/30/10, Robert Muir <rcmuir@gmail.com> wrote:

>
> Have a look at contrib/benchmark under the
> org.apache.lucene.benchmark.quality package.
> There is code (for example
> org.apache.lucene.benchmark.quality.trec.QueryDriver) that can run an
> experiment and output what you need for trec_eval.exe
> I think there is some additional documentation on how to use this in
> Lucene in Action 2.
>
> ---------------------------------------------------------------------


yes you're right.I just realize it.I did find the sample source code
of precision and recall in that ebook such as here.

public class PrecisionRecall {
        public static void main(String[] args) throws Throwable {
                File topicsFile = new
File("C:/Users/Raden/Documents/lucene/LuceneHibernate/adi/50.txt");
                File qrelsFile = new
File("C:/Users/Raden/Documents/lucene/LuceneHibernate/adi/51.txt");
                Directory dir = FSDirectory.open(new
File("C:/Users/Raden/Documents/lucene/LuceneHibernate/adi"));
                Searcher searcher = new IndexSearcher(dir, true);

                String docNameField = "filename";

                PrintWriter logger = new PrintWriter(System.out, true);

                TrecTopicsReader qReader = new TrecTopicsReader();
                QualityQuery qqs[] = qReader.readQueries(new BufferedReader(
                                new FileReader(topicsFile)));

                Judge judge = new TrecJudge(new BufferedReader(
                                new FileReader(qrelsFile)));

                judge.validateData(qqs, logger);

                QualityQueryParser qqParser = new SimpleQQParser(
                                "title", "contents");

                QualityBenchmark qrun = new QualityBenchmark(qqs,
                                qqParser, searcher, docNameField);

                SubmissionReport submitLog = null;
                QualityStats stats[] = qrun.execute(judge,
                submitLog, logger);

                QualityStats avg =
                        QualityStats.average(stats);
                        avg.log("SUMMARY",2,logger, " ");
                        dir.close();
        }

        }

or in a more friendly format you can see it in this link

http://pastebin.ca/2006780

but when I run that code in lucene,the computation of precision and
recall that I get is zero.here is the result

WARNING: 5 judgments match no query! -
   potentialities
   an
   on
   the
   and


SUMMARY
 Search Seconds:         0.000
 DocName Seconds:        0.000
 Num Points:             0.000
 Num Good Points:        0.000
 Max Good Points:        0.000
 Average Precision:      0.000
 MRR:                    0.000
 Recall:                 0.000


can you tell me what went wrong? what is the difference between
topicsFile and qrelsFile anyway?

thanks though. :-)
-- 
http://jacobian.web.id

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47979-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 16:01:42 2010
Return-Path: <java-user-return-47979-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71633 invoked from network); 30 Nov 2010 16:01:41 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 16:01:41 -0000
Received: (qmail 64054 invoked by uid 500); 30 Nov 2010 16:01:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63723 invoked by uid 500); 30 Nov 2010 16:01:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63715 invoked by uid 99); 30 Nov 2010 16:01:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 16:01:37 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.161.48 as permitted sender)
Received: from [209.85.161.48] (HELO mail-fx0-f48.google.com) (209.85.161.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 16:01:32 +0000
Received: by fxm2 with SMTP id 2so4670694fxm.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 08:01:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=PVEpdc8AAME2rYe8X9UYMp8domKfXoJEg7/ssUyffAo=;
        b=YtwaPxd5/hLXS7IvjNgGSs/kM+uA9JolcucpOaSlXBa3+iuv7RtQTspRe9kwNobjyI
         x44XkVaXGBO0DBw7sekTmovMz9ELRrmHQoAjwrkweMuGfUkYeLZdQDbWW5E0wavqoEFB
         4iUdIVTVcN0oQCvpPNSeyHm8vW4EwPcoCMdtk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=fwF3tPHrUr4wZ3JuTZQLnyVsxLYV6Rx02KneS5gsu8LACwTyMI7rSgun3rDipvU1ZA
         8lz1zCVMQKShchGKFJaFvgNFdf3nyEUS338omsYtcilg4xMvxGOs5FTnQyE4it3xTkhU
         GLcrTr8n/CKq/RbCCj8oCfT7WDYt99yteWPVk=
Received: by 10.223.79.13 with SMTP id n13mr7078407fak.139.1291132870984; Tue,
 30 Nov 2010 08:01:10 -0800 (PST)
MIME-Version: 1.0
Received: by 10.223.93.135 with HTTP; Tue, 30 Nov 2010 08:00:50 -0800 (PST)
In-Reply-To: <AANLkTik7q=UsH8OPAbvpMoot+EcB3rnse1351D13siL-@mail.gmail.com>
References: <AANLkTimyGXF+R8y1RU2nGeU4sre9S47jYdAbS2Fx-jkS@mail.gmail.com>
 <AANLkTi=4wFV1u1i8AZaPo=sjfhX3a8APuMncsK90p1N9@mail.gmail.com> <AANLkTik7q=UsH8OPAbvpMoot+EcB3rnse1351D13siL-@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Tue, 30 Nov 2010 11:00:50 -0500
Message-ID: <AANLkTimr3sPd8UJzq_4TA=7kHmv2Li+MiTJbqAEo-rhs@mail.gmail.com>
Subject: Re: precision and recall in lucene
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

On Tue, Nov 30, 2010 at 10:46 AM, Yakob <jacobian@opensuse-id.org> wrote:

> can you tell me what went wrong? what is the difference between
> topicsFile and qrelsFile anyway?
>

well its hard to tell what you are supplying as topics and qrels.
have a look at /src/lia/benchmark in the LIA2 sample code: it has an
example topic and 3 rows in qrels for it.

basically, the topicsFile contains the "queries", and the qrelsFile
contains judgements as to which documents are relevant.

P.S.: once you have an index, a topics, and a qrels file, you can just
use org.apache.lucene.benchmark.quality.trec.QueryDriver (it has a
main method)

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47980-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 16:07:07 2010
Return-Path: <java-user-return-47980-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82038 invoked from network); 30 Nov 2010 16:07:07 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 16:07:07 -0000
Received: (qmail 76495 invoked by uid 500); 30 Nov 2010 16:07:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76268 invoked by uid 500); 30 Nov 2010 16:07:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76259 invoked by uid 99); 30 Nov 2010 16:07:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 16:07:03 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of falha404@gmail.com designates 74.125.82.42 as permitted sender)
Received: from [74.125.82.42] (HELO mail-ww0-f42.google.com) (74.125.82.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 16:06:58 +0000
Received: by wwb39 with SMTP id 39so303348wwb.5
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 08:06:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:received
         :in-reply-to:references:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        bh=8djWoXbTOGJd9lDKWXhSD83yiJ0qpDupkMWBx0hksOg=;
        b=n4GZAMQV7OXSQZS4ybn2Kwo2oEk8mRL/IP90SOesQt0mVqYl6LyJa2mgkqy3By0X+T
         vqX1qDuJvAnl+N9rwSP+/OdtTYR2G2n1YN/ifYkt1VpEprdVidG6efB8jmC+buKr3jWE
         6vO5iOV0qWIpqUrZy+IzVml3X43s5McK/JSjU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        b=BrTUU36tvp08BMk0l9vBLnj380nLXY/6H2H5//PSz6dR+Hv/KRK6Xo34u1Py3omSvQ
         A7NspYmapOAdntw3ZHIhw1WdwKLhnfTMPzapwuLDWPWyGkNBqGnTOEc6loUloLFFSOOO
         NtaEYMUWKbnZBWOnOVlpFVCyGrbsDgeNvB540=
Received: by 10.227.132.206 with SMTP id c14mr7910142wbt.78.1291133190235;
 Tue, 30 Nov 2010 08:06:30 -0800 (PST)
MIME-Version: 1.0
Sender: falha404@gmail.com
Received: by 10.216.20.4 with HTTP; Tue, 30 Nov 2010 08:06:09 -0800 (PST)
In-Reply-To: <AANLkTik6H5mXo9=y2ww=CJ46j2Z=ecLapE3FD_uhU9a0@mail.gmail.com>
References: <AANLkTik6H5mXo9=y2ww=CJ46j2Z=ecLapE3FD_uhU9a0@mail.gmail.com>
From: Fabiano Nunes <fabiano@nunes.me>
Date: Tue, 30 Nov 2010 14:06:09 -0200
X-Google-Sender-Auth: lKPfadsSoPJB2lv2f7rSdNRvzBg
Message-ID: <AANLkTinKv+w+TX+8Ps4trntYStWudfm=qzi-_9ZJD84Q@mail.gmail.com>
Subject: Re: Retrieving payload attribute in highlighter
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e659f6f82a254f0496475f97

--0016e659f6f82a254f0496475f97
Content-Type: text/plain; charset=ISO-8859-1

I've figured out the PayloadSpanUtil class. It's exactly what I'm expecting.
But, I'm concerned about the warning message in API docs (indeed, I think I
dont understand it). There is any other approach? Can I have the same
results retrieving the termPositions without performance issues?

Thanks.

On Tue, Nov 30, 2010 at 1:20 PM, Fabiano Nunes <fabiano@nunes.me> wrote:

> Hello,
> I'm trying to retrieve payloads from the highlighteds terms by Highlighter
> class. In my tests, all terms returned from Highlighter has null as payload.
> Example:
>
> Highlighter h = new Highlighter(new Formatter() {
> public String highlightTerm(String originalText, TokenGroup tokenGroup) {
> Token token = tokenGroup.getToken(0);
>  Payload payload = token.getPayload();
>  assertNotNull(payload); // <---------------- payload is always null
>  return originalText;
> }
> }, scorer);
>
> It seems that Highlighter removes payload attribute from all terms before
> creating its TokenGroup.
> How can I preserve it?
>
> Thanks.
>

--0016e659f6f82a254f0496475f97--

From java-user-return-47981-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 16:32:33 2010
Return-Path: <java-user-return-47981-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92115 invoked from network); 30 Nov 2010 16:32:32 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 16:32:32 -0000
Received: (qmail 23188 invoked by uid 500); 30 Nov 2010 16:32:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22887 invoked by uid 500); 30 Nov 2010 16:32:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22878 invoked by uid 99); 30 Nov 2010 16:32:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 16:32:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.169 as permitted sender)
Received: from [209.85.216.169] (HELO mail-qy0-f169.google.com) (209.85.216.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 16:32:20 +0000
Received: by qyk7 with SMTP id 7so1388608qyk.14
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 08:31:59 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=RAjyZZ39Bleb5B6nCORrPZv0it6VPgvIElfwjl1nIvw=;
        b=inkAaLhlnQW03GAPvScmR7UMWIk/tkBoYJmq0tWcyzQiLwuCh+8WNAmt/3flMwTAik
         +znrVUHX/VF5Ja1fzU52WkcNbfVgvfz08huf9rfTU/mnEUpJMrtHciT4ridVVkwROnwF
         wzZ2nvVSMuE7S7vjQEasCT/6WvIdSUJZz7bgU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=vS2JSpPat15bfcb/wZZYdmCujaM0vhRlrosMHoMWFOyo42PBBBlafJCbdCnt4W+Xfh
         p7DsZ0vz0oTmq8qd2pCDBUO9rgxau0XC4fj8USyrGKMRsxcTGCYkChw9KepibIZRA7Ms
         4/QbzsqA5e6Bg7ktg7vmsRVXx9sM9RC7+rA0E=
MIME-Version: 1.0
Received: by 10.229.91.10 with SMTP id k10mr6198398qcm.82.1291134718979; Tue,
 30 Nov 2010 08:31:58 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Tue, 30 Nov 2010 08:31:58 -0800 (PST)
In-Reply-To: <AANLkTinKv+w+TX+8Ps4trntYStWudfm=qzi-_9ZJD84Q@mail.gmail.com>
References: <AANLkTik6H5mXo9=y2ww=CJ46j2Z=ecLapE3FD_uhU9a0@mail.gmail.com>
	<AANLkTinKv+w+TX+8Ps4trntYStWudfm=qzi-_9ZJD84Q@mail.gmail.com>
Date: Tue, 30 Nov 2010 11:31:58 -0500
Message-ID: <AANLkTimZmXOJQrt_PAt=ibgTHmR=hkham8ZVxJy95uZ8@mail.gmail.com>
Subject: Re: Retrieving payload attribute in highlighter
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e8382482d91049647baef
X-Virus-Checked: Checked by ClamAV on apache.org

--0016361e8382482d91049647baef
Content-Type: text/plain; charset=ISO-8859-1

That's the Lucene developers' way of saying "we don't guarantee backwards
compatibility".

The devs go to great lengths to honor the contract of not changing public
APIs without
going through a deprecation process, which causes quite a lot of work. But
that conflicts
with the desirable process of having real-live users get a look at new code.
So this
warning merely says "the next compilation of Lucene may have a different
API, so don't
blame us if you have to recompile against a new jar". OK, I've played pretty
loose with
the words, but that's the intent.

By and large, though, the functionality will be there in new versions, but
you may have
to change the calls you use if you get new jars.

I'd go ahead and use the class/method with confidence that something similar
will be there
in the future, but you may have to recompile if you get new jars.

Best
Erick

On Tue, Nov 30, 2010 at 11:06 AM, Fabiano Nunes <fabiano@nunes.me> wrote:

> I've figured out the PayloadSpanUtil class. It's exactly what I'm
> expecting.
> But, I'm concerned about the warning message in API docs (indeed, I think I
> dont understand it). There is any other approach? Can I have the same
> results retrieving the termPositions without performance issues?
>
> Thanks.
>
> On Tue, Nov 30, 2010 at 1:20 PM, Fabiano Nunes <fabiano@nunes.me> wrote:
>
> > Hello,
> > I'm trying to retrieve payloads from the highlighteds terms by
> Highlighter
> > class. In my tests, all terms returned from Highlighter has null as
> payload.
> > Example:
> >
> > Highlighter h = new Highlighter(new Formatter() {
> > public String highlightTerm(String originalText, TokenGroup tokenGroup) {
> > Token token = tokenGroup.getToken(0);
> >  Payload payload = token.getPayload();
> >  assertNotNull(payload); // <---------------- payload is always null
> >  return originalText;
> > }
> > }, scorer);
> >
> > It seems that Highlighter removes payload attribute from all terms before
> > creating its TokenGroup.
> > How can I preserve it?
> >
> > Thanks.
> >
>

--0016361e8382482d91049647baef--

From java-user-return-47982-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 17:09:40 2010
Return-Path: <java-user-return-47982-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12796 invoked from network); 30 Nov 2010 17:09:40 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 17:09:40 -0000
Received: (qmail 86776 invoked by uid 500); 30 Nov 2010 17:09:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86715 invoked by uid 500); 30 Nov 2010 17:09:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86707 invoked by uid 99); 30 Nov 2010 17:09:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 17:09:35 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [194.116.199.142] (HELO thb-mta-03.emailfiltering.com) (194.116.199.142)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 17:09:26 +0000
Received: from arklet.gcal.ac.uk ([193.62.224.72])
	by thb-mta-03.emailfiltering.com with emfmta (version 4.6.0.72) by TLS id 8110739600
	for java-user@lucene.apache.org;9d8b1e60cedf706a; Tue, 30 Nov 2010 17:09:06 +0000
Received: from ITSEMBXCLUS.enterprise.gcal.ac.uk
 ([fe80:0000:0000:0000:19cc:b8e3:177.173.188.238]) by
 ITSEHUB2.enterprise.gcal.ac.uk ([193.62.224.72]) with mapi; Tue, 30 Nov 2010
 17:09:04 +0000
From: "McGibbney, Lewis John" <Lewis.McGibbney@gcu.ac.uk>
To: "'java-user@lucene.apache.org'" <java-user@lucene.apache.org>
Date: Tue, 30 Nov 2010 17:09:04 +0000
Subject: Keyword extraction from pdf to text
Thread-Topic: Keyword extraction from pdf to text
Thread-Index: AcuQsUt8xODZiE/VTwmC98NAIemrUQ==
Message-ID: <90362ECB07906C40A0297F9D5211A24323C3D81F04@ITSEMBXCLUS.enterprise.gcal.ac.uk>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: multipart/alternative;
	boundary="_000_90362ECB07906C40A0297F9D5211A24323C3D81F04ITSEMBXCLUSen_"
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

--_000_90362ECB07906C40A0297F9D5211A24323C3D81F04ITSEMBXCLUSen_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

Hello list,

I am currently attempting to extract keywords from pdf documents, my aim is=
 then to begin constructing a domain ontology using the words which are ext=
racted. I do not need to index anything at this stage, but wish to extract =
and push the output as plain text into a text file. An example of input tex=
t from the pdf document would be as follows
________________________________
6.1.3 Calculating carbon dioxide emissions for the proposed dwelling
The second calculation involves establishing the carbon dioxide emissions
for the proposed dwelling (DER). To do this the values proposed for the
dwelling should be used in the methodology i.e. the U-values, air infiltrat=
ion,
heating system, etc.
The exceptions to entering the dwelling specific values are:
a. it may be assumed that all glazing is orientated east/west;
b. average overshading may be assumed if not known. 'Very little' shading
should not be entered;
c. 2 sheltered sides should be assumed if not known. More than 2 sheltered
sides should not be entered;
d. where secondary heating is proposed, if a chimney or flue is present but
no appliance installed the worst case should be assumed i.e. a decorative
fuel-effect gas appliance with 20% efficiency. If there is no gas point, an
open fire with 37% efficiency should be assumed, burning solid mineral
fuel for dwellings outwith a smokeless zone and smokeless solid mineral
fuel for those that are within such a zone.
All other values can be varied, but before entering values into the
methodology, reference should be made to:
* the back-stop U-values identified in guidance to standard 6.2; and
* guidance on systems and equipment within standards 6.3 to 6.6.
________________________________
My requirements are as follows


*         drop stop words

*         be able to pick up Bi Grams or NGrams such as the following "U-Va=
lues", "super-insulated", "air infiltration" etc,

*         lower case filter

I have currently been using Lucene 3.0.1 with a custom filter to achieve th=
e above bullet points, then using Luke to pick up phrases and entities from=
 text by looking into the generated index, however I found that this was ve=
ry time consuming. My intention is to pass the pdf document as input and re=
ceive the above as output which I can then use to manually construct my ont=
ology from entities and their relationships.

I previously posted this to the Tika list with no response, so again I apol=
ogise if this is not a problem for the Lucene java list. Can anyone suggest=
 a possible solution to the problem.

Any help would be great ;0) Thanks

Lewis


Glasgow Caledonian University is a registered Scottish charity, number SC02=
1474

Winner: Times Higher Education's Widening Participation Initiative of the Y=
ear 2009 and Herald Society's Education Initiative of the Year 2009
http://www.gcu.ac.uk/newsevents/news/bycategory/theuniversity/1/name,6219,e=
n.html

--_000_90362ECB07906C40A0297F9D5211A24323C3D81F04ITSEMBXCLUSen_--

From java-user-return-47983-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 17:45:17 2010
Return-Path: <java-user-return-47983-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23741 invoked from network); 30 Nov 2010 17:45:17 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 17:45:17 -0000
Received: (qmail 40130 invoked by uid 500); 30 Nov 2010 17:45:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40026 invoked by uid 500); 30 Nov 2010 17:45:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40017 invoked by uid 99); 30 Nov 2010 17:45:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 17:45:15 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=FREEMAIL_FROM,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.214.48 as permitted sender)
Received: from [209.85.214.48] (HELO mail-bw0-f48.google.com) (209.85.214.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 17:45:10 +0000
Received: by bwz9 with SMTP id 9so5814758bwz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 09:44:48 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:received:in-reply-to
         :references:from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=iDzccjG8FZj5yWEc1tBNEO4L/p2WmeMjWB22ZrmoH6A=;
        b=IySBF99zZUAKjBKsxQSp+SzjViH9n/lMVstyL0wF9g37GnUvwAlNXovxhVM6rO4w+j
         E46YffaMZFOkbSb7NCTkPUeOq7jwIhm+VlQUWmTWSu4CEjIQ0WKV/9HxEv7OeqPzMUgF
         v3WWs0t1t7Zm3sS22pnt77LPwFOYd+8OsqHxQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=aL063U79PIgkCOjayQ3FPW8+9dJ4uH404Zy3IYE7Ly12Ea6xS4pPDKXaalj/OMlH8f
         n9j+LCRb8vXwJdKXJaUIVF73spWQt3vHt5uy8B6WojAGVw5dVr3bH4wXms6NUkPu68ea
         f4LgPAroD78e/rSuzkVHMDWx5Yr2kGYv3052c=
Received: by 10.204.112.143 with SMTP id w15mr2685425bkp.214.1291139088561;
 Tue, 30 Nov 2010 09:44:48 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.116.212 with HTTP; Tue, 30 Nov 2010 09:44:28 -0800 (PST)
In-Reply-To: <90362ECB07906C40A0297F9D5211A24323C3D81F04@ITSEMBXCLUS.enterprise.gcal.ac.uk>
References: <90362ECB07906C40A0297F9D5211A24323C3D81F04@ITSEMBXCLUS.enterprise.gcal.ac.uk>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 30 Nov 2010 17:44:28 +0000
Message-ID: <AANLkTikE5QAeypOaqXi5aZtd=7qpE5dAZJhOBdFbjRWg@mail.gmail.com>
Subject: Re: Keyword extraction from pdf to text
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

If I've understood you correctly, you want to pump text into a lucene
Analyzer and grab the output and do something else with that.  If that
is right, you can use code based on something like this:

	for (String s : array-of-input-texts) {
	    Analyzer anl =3D new xxxAnalyzer(whatever);
	    TokenStream stream =3D anl.tokenStream("", new StringReader(s));
	    TermAttribute term =3D (TermAttribute)
stream.addAttribute(TermAttribute.class);
            while (stream.incrementToken()) {
	      System.out.println(" "+term.term());
	    }
	}

There is code in the second edition of Lucene In Action called
something like AnalyzerUtils that may have inspired the code above.
Reading a copy of that book is an excellent idea for any lucene
related topic.


--
Ian.


On Tue, Nov 30, 2010 at 5:09 PM, McGibbney, Lewis John
<Lewis.McGibbney@gcu.ac.uk> wrote:
> Hello list,
>
> I am currently attempting to extract keywords from pdf documents, my aim =
is then to begin constructing a domain ontology using the words which are e=
xtracted. I do not need to index anything at this stage, but wish to extrac=
t and push the output as plain text into a text file. An example of input t=
ext from the pdf document would be as follows
> ________________________________
> 6.1.3 Calculating carbon dioxide emissions for the proposed dwelling
> The second calculation involves establishing the carbon dioxide emissions
> for the proposed dwelling (DER). To do this the values proposed for the
> dwelling should be used in the methodology i.e. the U-values, air infiltr=
ation,
> heating system, etc.
> The exceptions to entering the dwelling specific values are:
> a. it may be assumed that all glazing is orientated east/west;
> b. average overshading may be assumed if not known. 'Very little' shading
> should not be entered;
> c. 2 sheltered sides should be assumed if not known. More than 2 sheltere=
d
> sides should not be entered;
> d. where secondary heating is proposed, if a chimney or flue is present b=
ut
> no appliance installed the worst case should be assumed i.e. a decorative
> fuel-effect gas appliance with 20% efficiency. If there is no gas point, =
an
> open fire with 37% efficiency should be assumed, burning solid mineral
> fuel for dwellings outwith a smokeless zone and smokeless solid mineral
> fuel for those that are within such a zone.
> All other values can be varied, but before entering values into the
> methodology, reference should be made to:
> * the back-stop U-values identified in guidance to standard 6.2; and
> * guidance on systems and equipment within standards 6.3 to 6.6.
> ________________________________
> My requirements are as follows
>
>
> * =A0 =A0 =A0 =A0 drop stop words
>
> * =A0 =A0 =A0 =A0 be able to pick up Bi Grams or NGrams such as the follo=
wing "U-Values", "super-insulated", "air infiltration" etc,
>
> * =A0 =A0 =A0 =A0 lower case filter
>
> I have currently been using Lucene 3.0.1 with a custom filter to achieve =
the above bullet points, then using Luke to pick up phrases and entities fr=
om text by looking into the generated index, however I found that this was =
very time consuming. My intention is to pass the pdf document as input and =
receive the above as output which I can then use to manually construct my o=
ntology from entities and their relationships.
>
> I previously posted this to the Tika list with no response, so again I ap=
ologise if this is not a problem for the Lucene java list. Can anyone sugge=
st a possible solution to the problem.
>
> Any help would be great ;0) Thanks
>
> Lewis
>
>
> Glasgow Caledonian University is a registered Scottish charity, number SC=
021474
>
> Winner: Times Higher Education's Widening Participation Initiative of the=
 Year 2009 and Herald Society's Education Initiative of the Year 2009
> http://www.gcu.ac.uk/newsevents/news/bycategory/theuniversity/1/name,6219=
,en.html
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47984-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 19:17:29 2010
Return-Path: <java-user-return-47984-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80428 invoked from network); 30 Nov 2010 19:17:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 19:17:29 -0000
Received: (qmail 75241 invoked by uid 500); 30 Nov 2010 19:17:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75118 invoked by uid 500); 30 Nov 2010 19:17:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75110 invoked by uid 99); 30 Nov 2010 19:17:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 19:17:26 +0000
X-ASF-Spam-Status: No, hits=4.4 required=10.0
	tests=FREEMAIL_ENVFROM_END_DIGIT,FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of falha404@gmail.com designates 209.85.215.176 as permitted sender)
Received: from [209.85.215.176] (HELO mail-ey0-f176.google.com) (209.85.215.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 19:17:19 +0000
Received: by eyz10 with SMTP id 10so3107107eyz.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 11:16:59 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:mime-version:sender:received
         :in-reply-to:references:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        bh=rn81Ed575ImClRmHa/8NsdMZ0bTPu6Gnh4umGZonVNI=;
        b=spVasKXDV70uEK7Xn1Kd2LLd0n3deL0AkFZz0rXe+/Q8pYImNdw1Mo0j8XuMMFPYaK
         0nL/UF2w+VrlTwaNxDsoHjB2THINB8okXcbCXJfrBD3yf1+G2Ac6SgkeSAZvDpfi60OQ
         88Ne5OMFnch7J3gGQwQjsshQ+OJ/QQCiTERU0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:in-reply-to:references:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        b=vfVIPiVEU2mkPrQSK0mzyWSbihhz7e52e0bgLY6zWnG7JwXzJ+ednVq4141NHaXp4P
         FYknLMMzUP8SEbLW1U1i62Zp7e0lmPn1WkBdlHxuTkleumuWYY0MnOdBtXjuhzIO0Dso
         JpSV4ZxpLiL9J3Bi3IvPL1nbuPH9c/Qs4tp70=
Received: by 10.216.161.130 with SMTP id w2mr6979183wek.17.1291144619210; Tue,
 30 Nov 2010 11:16:59 -0800 (PST)
MIME-Version: 1.0
Sender: falha404@gmail.com
Received: by 10.216.20.4 with HTTP; Tue, 30 Nov 2010 11:16:38 -0800 (PST)
In-Reply-To: <AANLkTimZmXOJQrt_PAt=ibgTHmR=hkham8ZVxJy95uZ8@mail.gmail.com>
References: <AANLkTik6H5mXo9=y2ww=CJ46j2Z=ecLapE3FD_uhU9a0@mail.gmail.com>
 <AANLkTinKv+w+TX+8Ps4trntYStWudfm=qzi-_9ZJD84Q@mail.gmail.com> <AANLkTimZmXOJQrt_PAt=ibgTHmR=hkham8ZVxJy95uZ8@mail.gmail.com>
From: Fabiano Nunes <fabiano@nunes.me>
Date: Tue, 30 Nov 2010 17:16:38 -0200
X-Google-Sender-Auth: 962Rpmp9OwO3NFSO2m5JJhfYH7k
Message-ID: <AANLkTi=LJvFrZ9tAyp8fb7fxXvs0aa5TgSD-9vtJ-3vx@mail.gmail.com>
Subject: Re: Retrieving payload attribute in highlighter
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364c773f61b97c04964a0845
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364c773f61b97c04964a0845
Content-Type: text/plain; charset=ISO-8859-1

Ok. I'll go ahead.
Just one more thing: the apidocs warning says "(...) IndexReader should only
contain doc of interest, best to use MemoryIndex (..)".
How can I build a reader with a subset of docs?

Thanks!

On Tue, Nov 30, 2010 at 2:31 PM, Erick Erickson <erickerickson@gmail.com>wrote:

> That's the Lucene developers' way of saying "we don't guarantee backwards
> compatibility".
>
> The devs go to great lengths to honor the contract of not changing public
> APIs without
> going through a deprecation process, which causes quite a lot of work. But
> that conflicts
> with the desirable process of having real-live users get a look at new
> code.
> So this
> warning merely says "the next compilation of Lucene may have a different
> API, so don't
> blame us if you have to recompile against a new jar". OK, I've played
> pretty
> loose with
> the words, but that's the intent.
>
> By and large, though, the functionality will be there in new versions, but
> you may have
> to change the calls you use if you get new jars.
>
> I'd go ahead and use the class/method with confidence that something
> similar
> will be there
> in the future, but you may have to recompile if you get new jars.
>
> Best
> Erick
>
> On Tue, Nov 30, 2010 at 11:06 AM, Fabiano Nunes <fabiano@nunes.me> wrote:
>
> > I've figured out the PayloadSpanUtil class. It's exactly what I'm
> > expecting.
> > But, I'm concerned about the warning message in API docs (indeed, I think
> I
> > dont understand it). There is any other approach? Can I have the same
> > results retrieving the termPositions without performance issues?
> >
> > Thanks.
> >
> > On Tue, Nov 30, 2010 at 1:20 PM, Fabiano Nunes <fabiano@nunes.me> wrote:
> >
> > > Hello,
> > > I'm trying to retrieve payloads from the highlighteds terms by
> > Highlighter
> > > class. In my tests, all terms returned from Highlighter has null as
> > payload.
> > > Example:
> > >
> > > Highlighter h = new Highlighter(new Formatter() {
> > > public String highlightTerm(String originalText, TokenGroup tokenGroup)
> {
> > > Token token = tokenGroup.getToken(0);
> > >  Payload payload = token.getPayload();
> > >  assertNotNull(payload); // <---------------- payload is always null
> > >  return originalText;
> > > }
> > > }, scorer);
> > >
> > > It seems that Highlighter removes payload attribute from all terms
> before
> > > creating its TokenGroup.
> > > How can I preserve it?
> > >
> > > Thanks.
> > >
> >
>

--0016364c773f61b97c04964a0845--

From java-user-return-47985-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 19:28:42 2010
Return-Path: <java-user-return-47985-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85681 invoked from network); 30 Nov 2010 19:28:42 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 19:28:42 -0000
Received: (qmail 92782 invoked by uid 500); 30 Nov 2010 19:28:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92747 invoked by uid 500); 30 Nov 2010 19:28:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92739 invoked by uid 99); 30 Nov 2010 19:28:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 19:28:40 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ariscris@gmail.com designates 209.85.215.48 as permitted sender)
Received: from [209.85.215.48] (HELO mail-ew0-f48.google.com) (209.85.215.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 19:28:32 +0000
Received: by ewy9 with SMTP id 9so3116665ewy.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 11:28:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:date:message-id
         :subject:from:to:cc:content-type;
        bh=QEIi3nNYesK9SY+Ix/Lf4GoJfBafSnWuiCrLrR4pJk8=;
        b=F9FAgOo/dbYYBEbGFj/8zWhtknaB/KNh++oYFLPMU4mLxa2oy7kAWf49w9AsyVZldU
         GVCFVK6d5rW15mK4yd7jV64M3gcODWNAoSJVtJ1NTpkJVR+qgtJlZbtNoxDOZkVvS6vx
         syB1NUKFdjl1WV9xyh1MnQN9H+rY2mwm4r3Dk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:cc:content-type;
        b=fp6Wk24M5w971bcxBmq1ThfZzLRwcZV00oDAfahNVMIkvkTPWSc/JMwCklL1LFavgB
         xtGFmGmSGU0d6eFOOxSHczsLaMk7sRDwHxUkN72IQVy/X1Uy1ksXaUig5G/mN+ZJ8PZp
         kwHpUrjCWWWZMYFLMpXZPeX4iDNXczcRiZNzw=
MIME-Version: 1.0
Received: by 10.204.55.2 with SMTP id s2mr7417243bkg.40.1291145291983; Tue, 30
 Nov 2010 11:28:11 -0800 (PST)
Received: by 10.204.176.210 with HTTP; Tue, 30 Nov 2010 11:28:11 -0800 (PST)
Date: Tue, 30 Nov 2010 14:28:11 -0500
Message-ID: <AANLkTikrjqJmZuQL2dGdZcOy0JaEuSbdUOMcYGLGuDFG@mail.gmail.com>
Subject: term vector - WITH_POSITIONS_OFFSETS vs YES in terms of search performance
From: Maricris Villareal <ariscris@gmail.com>
To: java-user@lucene.apache.org
Cc: Maricris Villareal <mgo@axsone.com>
Content-Type: multipart/alternative; boundary=001636c5b2df7b6c1f04964a3089
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c5b2df7b6c1f04964a3089
Content-Type: text/plain; charset=ISO-8859-1

Hi,

Could someone tell me the effect (if any) of having term vectors set to
WITH_POSITIONS_OFFSETS vs YES in terms of search performance?  I did some
testing and the results were inconclusive.  In one case,
WITH_POSITIONS_OFFSETS was searched faster than YES, in all others, it was
the reverse.  Is the performance effect only at indexing time?

Thanks.

Maricris Villareal

--001636c5b2df7b6c1f04964a3089--

From java-user-return-47986-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 19:41:29 2010
Return-Path: <java-user-return-47986-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92225 invoked from network); 30 Nov 2010 19:41:29 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 19:41:29 -0000
Received: (qmail 13388 invoked by uid 500); 30 Nov 2010 19:41:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13253 invoked by uid 500); 30 Nov 2010 19:41:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13245 invoked by uid 99); 30 Nov 2010 19:41:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 19:41:27 +0000
X-ASF-Spam-Status: No, hits=0.7 required=10.0
	tests=RCVD_IN_DNSWL_NONE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.125.82.176] (HELO mail-wy0-f176.google.com) (74.125.82.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 19:41:19 +0000
Received: by wyf28 with SMTP id 28so6478447wyf.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 11:40:59 -0800 (PST)
MIME-Version: 1.0
Received: by 10.227.134.2 with SMTP id h2mr6442165wbt.62.1291146058447; Tue,
 30 Nov 2010 11:40:58 -0800 (PST)
Received: by 10.216.93.14 with HTTP; Tue, 30 Nov 2010 11:40:58 -0800 (PST)
In-Reply-To: <AANLkTikrjqJmZuQL2dGdZcOy0JaEuSbdUOMcYGLGuDFG@mail.gmail.com>
References: <AANLkTikrjqJmZuQL2dGdZcOy0JaEuSbdUOMcYGLGuDFG@mail.gmail.com>
Date: Tue, 30 Nov 2010 14:40:58 -0500
Message-ID: <AANLkTimFVZc7vRfbDobiQ4EtNmXuaBtLXUMYfMTkJddF@mail.gmail.com>
Subject: Re: term vector - WITH_POSITIONS_OFFSETS vs YES in terms of search performance
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Cc: Maricris Villareal <mgo@axsone.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

The performance impact should only be at indexing time, unless you
actually retrieve the vectors for some number of hits at search time.

Mike

On Tue, Nov 30, 2010 at 2:28 PM, Maricris Villareal <ariscris@gmail.com> wr=
ote:
> Hi,
>
> Could someone tell me the effect (if any) of having term vectors set to
> WITH_POSITIONS_OFFSETS vs YES in terms of search performance? =A0I did so=
me
> testing and the results were inconclusive. =A0In one case,
> WITH_POSITIONS_OFFSETS was searched faster than YES, in all others, it wa=
s
> the reverse. =A0Is the performance effect only at indexing time?
>
> Thanks.
>
> Maricris Villareal
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-47987-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Nov 30 20:50:28 2010
Return-Path: <java-user-return-47987-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32480 invoked from network); 30 Nov 2010 20:50:28 -0000
Received: from unknown (HELO mail.apache.org) (140.211.11.3)
  by 140.211.11.9 with SMTP; 30 Nov 2010 20:50:27 -0000
Received: (qmail 19348 invoked by uid 500); 30 Nov 2010 20:50:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19245 invoked by uid 500); 30 Nov 2010 20:50:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19237 invoked by uid 99); 30 Nov 2010 20:50:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 20:50:25 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=FREEMAIL_FROM,HTML_MESSAGE,RCVD_IN_DNSWL_NONE,SPF_PASS,T_TO_NO_BRKTS_FREEMAIL
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.216.48 as permitted sender)
Received: from [209.85.216.48] (HELO mail-qw0-f48.google.com) (209.85.216.48)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 30 Nov 2010 20:50:18 +0000
Received: by qwj9 with SMTP id 9so691606qwj.35
        for <java-user@lucene.apache.org>; Tue, 30 Nov 2010 12:49:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=gv1aaaX+FpGwK0X+WrNRkna99TG/MxLLCp5NN/KbKZs=;
        b=Fk8l3L8O4gIuB/a8/RaOLW0tnY70d9T0iwLlYA2Ya49gGQ2yyVsCQkudZ4dDoyHNKo
         QvmyrXn2026K9S2J4JqCnkW6iZ9VEjwhCSPnPulEed+XKLUyt6RX1U5wzf+TSZGxWM/7
         HgHTpXoYVDLHkvLFWe6UFbLalrl91JNQy4VAg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=V7Vc0nUN8SAJD9JiW//9gr43U9db5xXt80bqn4SJaChjk9gVdd3M9M5bxBT80ainF3
         igG1B9RIC3BtISUhnSOk72UDcehaMkCfgBvp/0pH5U+l9xHXiU0kqY4bblINp4HsyMHk
         uVm0sm4so0jfOkJNcFhWFvkLN1nAK2xm19aSQ=
MIME-Version: 1.0
Received: by 10.229.99.84 with SMTP id t20mr6444026qcn.120.1291150197223; Tue,
 30 Nov 2010 12:49:57 -0800 (PST)
Received: by 10.229.225.142 with HTTP; Tue, 30 Nov 2010 12:49:56 -0800 (PST)
In-Reply-To: <AANLkTi=LJvFrZ9tAyp8fb7fxXvs0aa5TgSD-9vtJ-3vx@mail.gmail.com>
References: <AANLkTik6H5mXo9=y2ww=CJ46j2Z=ecLapE3FD_uhU9a0@mail.gmail.com>
	<AANLkTinKv+w+TX+8Ps4trntYStWudfm=qzi-_9ZJD84Q@mail.gmail.com>
	<AANLkTimZmXOJQrt_PAt=ibgTHmR=hkham8ZVxJy95uZ8@mail.gmail.com>
	<AANLkTi=LJvFrZ9tAyp8fb7fxXvs0aa5TgSD-9vtJ-3vx@mail.gmail.com>
Date: Tue, 30 Nov 2010 15:49:56 -0500
Message-ID: <AANLkTin592Q7t6Oy-2gu_SUsBnMyUXhM6PjV=dQbytKj@mail.gmail.com>
Subject: Re: Retrieving payload attribute in highlighter
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636285314db78f904964b5408
X-Virus-Checked: Checked by ClamAV on apache.org

--001636285314db78f904964b5408
Content-Type: text/plain; charset=ISO-8859-1

Warning, ignorance alert. I'm not all that up on the guts of this one.

But take a look at MemoryIndex, there's an example there. The gist
is that you create a MemoryIndex on the fly and index the doc in question
into it, then you can get the IndexReader from the IndexSearcher associated
with the MemoryIndex. All this is similar to how Highlighter works, and it
looks like you have access to the original input?

Now, this is largely a guess, so don't waste time if I'm really off base
with
this.

Best
Erick

On Tue, Nov 30, 2010 at 2:16 PM, Fabiano Nunes <fabiano@nunes.me> wrote:

> Ok. I'll go ahead.
> Just one more thing: the apidocs warning says "(...) IndexReader should
> only
> contain doc of interest, best to use MemoryIndex (..)".
> How can I build a reader with a subset of docs?
>
> Thanks!
>
> On Tue, Nov 30, 2010 at 2:31 PM, Erick Erickson <erickerickson@gmail.com
> >wrote:
>
> > That's the Lucene developers' way of saying "we don't guarantee backwards
> > compatibility".
> >
> > The devs go to great lengths to honor the contract of not changing public
> > APIs without
> > going through a deprecation process, which causes quite a lot of work.
> But
> > that conflicts
> > with the desirable process of having real-live users get a look at new
> > code.
> > So this
> > warning merely says "the next compilation of Lucene may have a different
> > API, so don't
> > blame us if you have to recompile against a new jar". OK, I've played
> > pretty
> > loose with
> > the words, but that's the intent.
> >
> > By and large, though, the functionality will be there in new versions,
> but
> > you may have
> > to change the calls you use if you get new jars.
> >
> > I'd go ahead and use the class/method with confidence that something
> > similar
> > will be there
> > in the future, but you may have to recompile if you get new jars.
> >
> > Best
> > Erick
> >
> > On Tue, Nov 30, 2010 at 11:06 AM, Fabiano Nunes <fabiano@nunes.me>
> wrote:
> >
> > > I've figured out the PayloadSpanUtil class. It's exactly what I'm
> > > expecting.
> > > But, I'm concerned about the warning message in API docs (indeed, I
> think
> > I
> > > dont understand it). There is any other approach? Can I have the same
> > > results retrieving the termPositions without performance issues?
> > >
> > > Thanks.
> > >
> > > On Tue, Nov 30, 2010 at 1:20 PM, Fabiano Nunes <fabiano@nunes.me>
> wrote:
> > >
> > > > Hello,
> > > > I'm trying to retrieve payloads from the highlighteds terms by
> > > Highlighter
> > > > class. In my tests, all terms returned from Highlighter has null as
> > > payload.
> > > > Example:
> > > >
> > > > Highlighter h = new Highlighter(new Formatter() {
> > > > public String highlightTerm(String originalText, TokenGroup
> tokenGroup)
> > {
> > > > Token token = tokenGroup.getToken(0);
> > > >  Payload payload = token.getPayload();
> > > >  assertNotNull(payload); // <---------------- payload is always null
> > > >  return originalText;
> > > > }
> > > > }, scorer);
> > > >
> > > > It seems that Highlighter removes payload attribute from all terms
> > before
> > > > creating its TokenGroup.
> > > > How can I preserve it?
> > > >
> > > > Thanks.
> > > >
> > >
> >
>

--001636285314db78f904964b5408--

