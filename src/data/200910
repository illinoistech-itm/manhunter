From java-user-return-42538-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 00:40:49 2009
Return-Path: <java-user-return-42538-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54012 invoked from network); 1 Oct 2009 00:40:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 00:40:49 -0000
Received: (qmail 78467 invoked by uid 500); 1 Oct 2009 00:40:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78393 invoked by uid 500); 1 Oct 2009 00:40:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78381 invoked by uid 99); 1 Oct 2009 00:40:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 00:40:47 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 00:40:37 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1Mt9iT-00043r-0s
	for java-user@lucene.apache.org; Wed, 30 Sep 2009 17:40:17 -0700
Message-ID: <25691552.post@talk.nabble.com>
Date: Wed, 30 Sep 2009 17:40:17 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Help needed ordering search results
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

I've 3 records in Lucene index.

Record 1 contains healthcare in title field. Record 2 contains healthcare
and insurance in description field but not together. Record 3 contains
healthcare insurance in company name field.

When a user searches for healthcare insurance,I want to show records in the
following order in search results...

a.Record #3---because it contains both the words of the input together(ie.as
a phrase) b.Record #1 c.Record #2

How do i achieve this in lucene?

Thanks.

-- 
View this message in context: http://www.nabble.com/Help-needed-ordering-search-results-tp25691552p25691552.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42539-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 07:51:28 2009
Return-Path: <java-user-return-42539-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57659 invoked from network); 1 Oct 2009 07:51:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 07:51:28 -0000
Received: (qmail 22475 invoked by uid 500); 1 Oct 2009 07:51:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22408 invoked by uid 500); 1 Oct 2009 07:51:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22398 invoked by uid 99); 1 Oct 2009 07:51:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 07:51:26 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 07:51:16 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MtGRD-00014A-F7
	for java-user@lucene.apache.org; Thu, 01 Oct 2009 00:50:55 -0700
Message-ID: <25693460.post@talk.nabble.com>
Date: Thu, 1 Oct 2009 00:50:55 -0700 (PDT)
From: Bon <bonbon@unipattern.com>
To: java-user@lucene.apache.org
Subject: Why it doesn't work about IndexWriter deleteDocuments
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: bonbon@unipattern.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi all,

    I've a problem about using IndexWriter#deleteDocuments to delete more
then one document at once.
    the following is my code:
    Try 1:
        StringBuffer query_values = new StringBuffer();
        query_values.append(UNIQUEID_FIELD_NAME);
        query_values.append(":(");
        boolean started = false;
        for(int i=0; i<uniqueIds.length; i++) {
    	if(started) query_values.append(" OR ");
    	else started = true;
    	query_values.append("\"");
    	query_values.append(uniqueIds[i]);
    	query_values.append("\"");
        }
        query_values.append(")");
        Query query = new QueryParser(UNIQUEID_FIELD_NAME, new
StandardAnalyzer()).parse(query_values.toString());
        IdxWriter.deleteDocuments(query);
        The Result of Try 1: fail, one document has be deleted

        Try 2:
    	Query[] querys = new Query[uniqueIds.length];
    	QueryParser qp = new QueryParser(UNIQUEID_FIELD_NAME, new
KeywordAnalyzer());
    	for(int i=0; i<querys.length; i++) {
    	    String queryStr = UNIQUEID_FIELD_NAME + ":(\"" + uniqueIds[i] +
"\")";
    	    querys[i] = qp.parse(queryStr);
    	}
        	IdxWriter.deleteDocuments(querys);
        The result of Try 2: fail, one document has be deleted.

        Try 3:
    	for(int i=0; i<uniqueIds.length; i++) {
    	    Term terms = new Term(UNIQUEID_FIELD_NAME, uniqueIds[i]);
        	    IdxWriter.deleteDocuments(terms);
   	}
         The result of Try 3: its work, I can delete all of the document.

        Try 4:
            Term[] terms = new Term[uniqueIds.length];
            for(int i=0; i<terms.length; i++) {
                terms[i] = new Term(UNIQUEID_FIELD_NAME, uniqueIds[i]);
            }
    	IdxWriter.deleteDocuments(terms);
         The result of Try 4: if the uniqueId with more then it will be
fail, no document has be deleted,
            but if the uniqueId just with one, and the document of this id
will be delete by this way!

      Why? and What is wrong in my code? how can I delete multiple documents
with IndexWriter#deleteDocuments ?

Bon

-- 
View this message in context: http://www.nabble.com/Why-it-doesn%27t-work-about-IndexWriter-deleteDocuments-tp25693460p25693460.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42540-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 08:48:29 2009
Return-Path: <java-user-return-42540-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72049 invoked from network); 1 Oct 2009 08:48:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 08:48:29 -0000
Received: (qmail 90778 invoked by uid 500); 1 Oct 2009 08:48:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90696 invoked by uid 500); 1 Oct 2009 08:48:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90686 invoked by uid 99); 1 Oct 2009 08:48:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 08:48:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 08:48:17 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MtHKO-0003PS-E8
	for java-user@lucene.apache.org; Thu, 01 Oct 2009 01:47:56 -0700
Message-ID: <25695093.post@talk.nabble.com>
Date: Thu, 1 Oct 2009 01:47:56 -0700 (PDT)
From: Marc Sturlese <marc.sturlese@gmail.com>
To: java-user@lucene.apache.org
Subject: Lucene 2.9 and performance of readers per segment.
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: marc.sturlese@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hey there,
Until now when using Lucene 2.4 I was always optimizing my index using
compound file after updating it. I was doing that because if not I could
feel a lot performance loss in search responses.
Now in Lucene 2.9 there are per segment readers and I have read something
about it performes better and maybe there's no need to optimze always the
index.
For FieldCache usage I know in Lucene 2.9 due to the per segment readers the
seed at loading time as imporved a lot if the index is not optimized. But if
it is optimized the loading time is the same.
So, is that true that with per segment reders search request perform almost
as good as an optimized index? Can anyone point me where to get more
information about the Lucene 2.9 per segments reader?
Thanks in advance
-- 
View this message in context: http://www.nabble.com/Lucene-2.9-and-performance-of-readers-per-segment.-tp25695093p25695093.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42541-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 08:57:14 2009
Return-Path: <java-user-return-42541-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73982 invoked from network); 1 Oct 2009 08:57:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 08:57:14 -0000
Received: (qmail 1576 invoked by uid 500); 1 Oct 2009 08:57:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1503 invoked by uid 500); 1 Oct 2009 08:57:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1493 invoked by uid 99); 1 Oct 2009 08:57:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 08:57:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 74.125.92.27 as permitted sender)
Received: from [74.125.92.27] (HELO qw-out-2122.google.com) (74.125.92.27)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 08:57:01 +0000
Received: by qw-out-2122.google.com with SMTP id 5so2506330qwi.53
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 01:55:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:x-mailer
         :mime-version:subject:date:references;
        bh=xIqjtxhoH8HZ3LJgDCWpoJf3yVM8jMznyU/BxZAdc9I=;
        b=N+NV0IjLGYTL0xtLoX2oxSrYI4+ukD6YDQ/zKR4lQJ5pwvURRYHsbEsbhKXsbqNPRY
         eb6zS+ixG27eD0pwLN4rnLl5Utska1KrDxzByE9Ph/AuBs6Rln4G0RzzZoNfS3IYNSOc
         ZAhGQLt2JxEhpYrQaWZu6cOVgQuOX7nl6abK0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:x-mailer:mime-version:subject:date
         :references;
        b=MUWW/8aoiLPAa4EKTkqE7+SIA/DDQNm8aCtW2aNk6tDrz1TVGUdQ9/xjNeAggGlKev
         c4DlBgiEMED3BU6zMvwWLo3HRsNSB7aPwqXv9VsU2qGUfikrK7w+/+3qfO9BetPRV80o
         uL+gJPYmoE+LnYUosh5Ow/adO34K5qTeNHLzg=
Received: by 10.229.111.77 with SMTP id r13mr718460qcp.85.1254387339697;
        Thu, 01 Oct 2009 01:55:39 -0700 (PDT)
Received: from ?10.248.67.214? (mobile-166-137-133-171.mycingular.net [166.137.133.171])
        by mx.google.com with ESMTPS id 8sm601586qwj.24.2009.10.01.01.55.38
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Oct 2009 01:55:38 -0700 (PDT)
Message-Id: <1D8230C0-B327-454E-8039-531C246FE315@gmail.com>
From: Mark Miller <markrmiller@gmail.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
In-Reply-To: <25695093.post@talk.nabble.com>
Content-Type: text/plain;
	charset=us-ascii;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: 7bit
X-Mailer: iPhone Mail (7A400)
Mime-Version: 1.0 (iPhone Mail 7A400)
Subject: Re: Lucene 2.9 and performance of readers per segment.
Date: Thu, 1 Oct 2009 04:55:32 -0400
References: <25695093.post@talk.nabble.com>
X-Virus-Checked: Checked by ClamAV on apache.org

Per segment over many segments is actually a bit faster for none sort  
cases and many sort cases -but an optimized index will still be  
fastest - the speed benifit of many segments comes when reopening - so  
say for realtime search - in that case you may want to sac the opt  
perf for a segment tail that is faster on update turnaround time. But  
for straight search speed - optimized is still the the way to go.

- Mark

http://www.lucidimagination.com (mobile)

On Oct 1, 2009, at 4:47 AM, Marc Sturlese <marc.sturlese@gmail.com>  
wrote:

>
> Hey there,
> Until now when using Lucene 2.4 I was always optimizing my index using
> compound file after updating it. I was doing that because if not I  
> could
> feel a lot performance loss in search responses.
> Now in Lucene 2.9 there are per segment readers and I have read  
> something
> about it performes better and maybe there's no need to optimze  
> always the
> index.
> For FieldCache usage I know in Lucene 2.9 due to the per segment  
> readers the
> seed at loading time as imporved a lot if the index is not  
> optimized. But if
> it is optimized the loading time is the same.
> So, is that true that with per segment reders search request perform  
> almost
> as good as an optimized index? Can anyone point me where to get more
> information about the Lucene 2.9 per segments reader?
> Thanks in advance
> -- 
> View this message in context: http://www.nabble.com/Lucene-2.9-and-performance-of-readers-per-segment.-tp25695093p25695093.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42542-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:18:44 2009
Return-Path: <java-user-return-42542-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16693 invoked from network); 1 Oct 2009 11:18:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:18:43 -0000
Received: (qmail 49759 invoked by uid 500); 1 Oct 2009 11:18:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49695 invoked by uid 500); 1 Oct 2009 11:18:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49634 invoked by uid 99); 1 Oct 2009 11:18:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:18:40 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of cr_usenet@arcor.de designates 151.189.21.51 as permitted sender)
Received: from [151.189.21.51] (HELO mail-in-11.arcor-online.net) (151.189.21.51)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:18:29 +0000
Received: from mail-in-18-z2.arcor-online.net (mail-in-18-z2.arcor-online.net [151.189.8.35])
	by mx.arcor.de (Postfix) with ESMTP id 4817CE3E3C
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:17:08 +0200 (CEST)
Received: from mail-in-01.arcor-online.net (mail-in-01.arcor-online.net [151.189.21.41])
	by mail-in-18-z2.arcor-online.net (Postfix) with ESMTP id 34D3E510223
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:17:08 +0200 (CEST)
Received: from [172.23.16.145] (unknown [194.8.222.19])
	(Authenticated sender: cr_usenet@arcor.de)
	by mail-in-01.arcor-online.net (Postfix) with ESMTPSA id 0D0D8332D34
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:17:08 +0200 (CEST)
X-DKIM: Sendmail DKIM Filter v2.8.2 mail-in-01.arcor-online.net 0D0D8332D34
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=arcor.de; s=mail-in;
	t=1254395828; bh=RimikHiEWtLN98BDibxE5YDWLVQGGPz+skphoc0py64=;
	h=Message-ID:Date:From:MIME-Version:To:Subject:Content-Type:
	 Content-Transfer-Encoding;
	b=cgAIZw/YZbhNYINjlY6omwexkWfHmKlJASei7OvxN61tTttiGLkS56JZL3BNNfZPL
	 BJSEiBrawCwlaEfymydipFSGTTWeJMIv6mAIFDFXfNUwD/x0IUG6ribLGe5jJRp9kC
	 80J4PU8eVVpxeOHNfRbkApW7jaDYJHzOuCd2f2/4=
Message-ID: <4AC48FB3.2080403@arcor.de>
Date: Thu, 01 Oct 2009 13:17:07 +0200
From: Christian Robert <cr_usenet@arcor.de>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Pagination and Sorting
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hello everybody,

I'm looking at quite an interesting challenge right now, so I
hope that somebody out there will be able to assist me.

What I'm trying to do is returning search results both sorted and
paginated. So far I haven't been able to come up with a working solution.

Pagination without sorting is no problem - simply looping through the
document identifiers and grabbing the documents within my "pagination
window".

Sorting is also no problem - create the Sort object and executing the
search.

However, when using a Sort I always get a TopDocs object in which all
the identifiers of the documents are contained. No problem when dealing
with a small index, but I've some 700.000 documents indexed and each
time I'm trying to call

  TopDocs topDocs =
    indexSearcher.search(query, null, Integer.MAX_VALUE, sort);

I'm ending up with an OutOfMemoryError.

So it seems that Lucene needs all the documents loaded into memory for
the sorting to work where in contrast I only want to load the documents
to be displayed in the current pagination window.

Am I lost here and have to find another way or is there a working
solution to combine sorting and pagination?

Thanks in advance!
Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42543-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:41:27 2009
Return-Path: <java-user-return-42543-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24142 invoked from network); 1 Oct 2009 11:41:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:41:27 -0000
Received: (qmail 91294 invoked by uid 500); 1 Oct 2009 11:41:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91218 invoked by uid 500); 1 Oct 2009 11:41:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91208 invoked by uid 99); 1 Oct 2009 11:41:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:41:24 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:41:13 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9DAAA45EDD7
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:40:22 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 4qnOeHD4vq-B for <java-user@lucene.apache.org>;
	Thu,  1 Oct 2009 13:40:12 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 5C66145ED6A
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:40:12 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AC48FB3.2080403@arcor.de>
Subject: RE: Pagination and Sorting
Date: Thu, 1 Oct 2009 13:40:10 +0200
Message-ID: <0A59C3ACD30043F7AB5754BB7C10465B@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4AC48FB3.2080403@arcor.de>
Thread-Index: AcpCiPzvjlPTPcNbRSSR/2FgldWUJQAAkweA
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Hallo Chris,

You are using TopDocs incorrectly. Normally you use *not* Integer.MAX_VALUE,
as the upper bound of your pagination window as numer of documents. So if
user wants to display documents 90 to 100, just set the number to 100 docs.
If the user then goes to docs 100 to 110, just reexecute ther query with a
larger value. This is exactly how search engines work, user gets the most
relevant docs presented first and then goes forward in pagination, but most
users will not go beyond the first 5 or 10 pages. So an initial max value of
100 is good. If somebody goes further, just raise and reexecute query.

If you want to collect all Hots, do not use TopDocs, instead use a
Collector.

This is the correct way for both sorting and not sorting, only that with
sorting, the memory usage is bigger. Internally an array of
Integer.MAX_VALUE is allocated, which leads to the OOM.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Christian Robert [mailto:cr_usenet@arcor.de]
> Sent: Thursday, October 01, 2009 1:17 PM
> To: java-user@lucene.apache.org
> Subject: Pagination and Sorting
> 
> Hello everybody,
> 
> I'm looking at quite an interesting challenge right now, so I
> hope that somebody out there will be able to assist me.
> 
> What I'm trying to do is returning search results both sorted and
> paginated. So far I haven't been able to come up with a working solution.
> 
> Pagination without sorting is no problem - simply looping through the
> document identifiers and grabbing the documents within my "pagination
> window".
> 
> Sorting is also no problem - create the Sort object and executing the
> search.
> 
> However, when using a Sort I always get a TopDocs object in which all
> the identifiers of the documents are contained. No problem when dealing
> with a small index, but I've some 700.000 documents indexed and each
> time I'm trying to call
> 
>   TopDocs topDocs =
>     indexSearcher.search(query, null, Integer.MAX_VALUE, sort);
> 
> I'm ending up with an OutOfMemoryError.
> 
> So it seems that Lucene needs all the documents loaded into memory for
> the sorting to work where in contrast I only want to load the documents
> to be displayed in the current pagination window.
> 
> Am I lost here and have to find another way or is there a working
> solution to combine sorting and pagination?
> 
> Thanks in advance!
> Chris
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42544-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:45:29 2009
Return-Path: <java-user-return-42544-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26605 invoked from network); 1 Oct 2009 11:45:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:45:29 -0000
Received: (qmail 97543 invoked by uid 500); 1 Oct 2009 11:45:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97476 invoked by uid 500); 1 Oct 2009 11:45:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97466 invoked by uid 99); 1 Oct 2009 11:45:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:45:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:45:17 +0000
Received: by pzk3 with SMTP id 3so76580pzk.20
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 04:43:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=rJyEiPvJvMVJlEqJ7Q+yqBTN6M7Od5xDn8eGV6/BqpE=;
        b=PkelOIav+pHKejFe7VAs9p9evjWhj18IU+e1azf1iEMMNHqPI0icyd4FPOYVrwPIeI
         A/G6pwRA/kMsqi5gTjcXA4MMlwxobZX5JGD0GaQ7fwCVXZjE4kuYKy4OYBXRq2/JsMOf
         PeITOlrr8eZ2WoE6oYO+Br9kF+UTuyUphBaU0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=rPDCD2MAAp7CoOouESi/jsaGma9U0QaDlsqOeGQybLIFUpbe/FpoKKhwQoGxt7oA5B
         UQBUrH8SG0Y2FZUXnN9IrIlGcI0KbArkUQMhgGarKGzBcQvdey412b80vEpXtN4ekpQv
         ugngDqIanLrUyGsCcQO5+AClYOKaXo5I4xhq4=
MIME-Version: 1.0
Received: by 10.115.39.23 with SMTP id r23mr1882720waj.2.1254397436240; Thu, 
	01 Oct 2009 04:43:56 -0700 (PDT)
In-Reply-To: <4AC48FB3.2080403@arcor.de>
References: <4AC48FB3.2080403@arcor.de>
From: Anshum <anshumg@gmail.com>
Date: Thu, 1 Oct 2009 17:13:36 +0530
Message-ID: <867513fe0910010443w5ea01c16r1341c885bde68c46@mail.gmail.com>
Subject: Re: Pagination and Sorting
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64cad3898229d0474de29c0
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64cad3898229d0474de29c0
Content-Type: text/plain; charset=ISO-8859-1

You could get the hits in a collector and pass the sort to the collector as
it would be the collect function that handles the sorting.

searcherObject.search(query,collector);

Hope that gives you some headway. :)

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Thu, Oct 1, 2009 at 4:47 PM, Christian Robert <cr_usenet@arcor.de> wrote:

> Hello everybody,
>
> I'm looking at quite an interesting challenge right now, so I
> hope that somebody out there will be able to assist me.
>
> What I'm trying to do is returning search results both sorted and
> paginated. So far I haven't been able to come up with a working solution.
>
> Pagination without sorting is no problem - simply looping through the
> document identifiers and grabbing the documents within my "pagination
> window".
>
> Sorting is also no problem - create the Sort object and executing the
> search.
>
> However, when using a Sort I always get a TopDocs object in which all
> the identifiers of the documents are contained. No problem when dealing
> with a small index, but I've some 700.000 documents indexed and each
> time I'm trying to call
>
>  TopDocs topDocs =
>    indexSearcher.search(query, null, Integer.MAX_VALUE, sort);
>
> I'm ending up with an OutOfMemoryError.
>
> So it seems that Lucene needs all the documents loaded into memory for
> the sorting to work where in contrast I only want to load the documents
> to be displayed in the current pagination window.
>
> Am I lost here and have to find another way or is there a working
> solution to combine sorting and pagination?
>
> Thanks in advance!
> Chris
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64cad3898229d0474de29c0--

From java-user-return-42545-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:53:20 2009
Return-Path: <java-user-return-42545-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28903 invoked from network); 1 Oct 2009 11:53:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:53:20 -0000
Received: (qmail 6002 invoked by uid 500); 1 Oct 2009 11:53:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5924 invoked by uid 500); 1 Oct 2009 11:53:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5913 invoked by uid 99); 1 Oct 2009 11:53:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:53:18 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.224] (HELO mail-gx0-f224.google.com) (209.85.217.224)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:53:08 +0000
Received: by gxk24 with SMTP id 24so62095gxk.5
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 04:51:47 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.209.8 with SMTP id h8mr2050256ybg.305.1254397907034; Thu, 
	01 Oct 2009 04:51:47 -0700 (PDT)
In-Reply-To: <7D5102B9-C676-4210-A2DB-3BE1A14B1D33@mac.com>
References: <7D5102B9-C676-4210-A2DB-3BE1A14B1D33@mac.com>
Date: Thu, 1 Oct 2009 07:51:47 -0400
Message-ID: <9ac0c6aa0910010451h5f33eafdx52276c078c4031d2@mail.gmail.com>
Subject: Re: Results of setting LogMergePolicy "calibrateSizeByDeletes=true"
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Can you turn on IndexWriter's infoStream and post the resulting output?

Enabling calibrateSizeByDeletes doesn't automatically mean that
segments with many deletes will be merged.  EG if your mergeFactor is
high relative to the number of segments you have at each level, then
no merging will take place.

As a workaround, you could call expungeDeletes.

Mike

On Wed, Sep 30, 2009 at 11:12 AM, Jibo John <jibojohn@mac.com> wrote:
> Hello,
>
> I am in the process of =A0trying out the lucene patch LUCENE-1634, howeve=
r I'm
> not getting the expected behavior.
> I =A0see that the segments are not getting merged even after all the docu=
ments
> are deleted from it.
>
> Because of this, the index size really grows to a huge number. The expect=
ed
> =A0index size is 50- 60 GB, however, it went past beyond 115 GB and is st=
ill
> growing.
>
> Any pointers will be helpful.
>
> Thanks,
> -Jibo
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42546-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:53:38 2009
Return-Path: <java-user-return-42546-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29220 invoked from network); 1 Oct 2009 11:53:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:53:38 -0000
Received: (qmail 8358 invoked by uid 500); 1 Oct 2009 11:53:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8304 invoked by uid 500); 1 Oct 2009 11:53:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8294 invoked by uid 99); 1 Oct 2009 11:53:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:53:36 +0000
X-ASF-Spam-Status: No, hits=2.0 required=10.0
	tests=RCVD_IN_BL_SPAMCOP_NET,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of cr_usenet@arcor.de designates 151.189.21.52 as permitted sender)
Received: from [151.189.21.52] (HELO mail-in-12.arcor-online.net) (151.189.21.52)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:53:24 +0000
Received: from mail-in-10-z2.arcor-online.net (mail-in-10-z2.arcor-online.net [151.189.8.27])
	by mx.arcor.de (Postfix) with ESMTP id 21B281B3CA5
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:53:03 +0200 (CEST)
Received: from mail-in-09.arcor-online.net (mail-in-09.arcor-online.net [151.189.21.49])
	by mail-in-10-z2.arcor-online.net (Postfix) with ESMTP id 04A3523D324
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:53:03 +0200 (CEST)
Received: from [172.23.16.145] (unknown [194.8.222.19])
	(Authenticated sender: cr_usenet@arcor.de)
	by mail-in-09.arcor-online.net (Postfix) with ESMTPSA id DAE171AF931
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 13:53:02 +0200 (CEST)
X-DKIM: Sendmail DKIM Filter v2.8.2 mail-in-09.arcor-online.net DAE171AF931
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=arcor.de; s=mail-in;
	t=1254397982; bh=FXF0OF+xJBkxcGUgdAOxox432zzrRgciV850JuYNvvc=;
	h=Message-ID:Date:From:MIME-Version:To:Subject:References:
	 In-Reply-To:Content-Type:Content-Transfer-Encoding;
	b=UYOmlXBX1tajpmIfEiMGru0/yFU5zvKS7HJS8ZoXQ+ApkuEodp7RYd5jSQ8mQWcLH
	 5OKsZ0/af+c882g66JXynwphEK58BZmwgJVOACL7ZaQuGqUArIcQK0zB074klDNbh+
	 rQo/c+QI4VdXPX2vXokG1Cp2b5FevubZfuQm6/sU=
Message-ID: <4AC4981D.3090703@arcor.de>
Date: Thu, 01 Oct 2009 13:53:01 +0200
From: Christian Robert <cr_usenet@arcor.de>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Pagination and Sorting
References: <4AC48FB3.2080403@arcor.de> <0A59C3ACD30043F7AB5754BB7C10465B@VEGA>
In-Reply-To: <0A59C3ACD30043F7AB5754BB7C10465B@VEGA>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Uwe,

> You are using TopDocs incorrectly. Normally you use *not* Integer.MAX_VALUE,
> as the upper bound of your pagination window as numer of documents. So if
> user wants to display documents 90 to 100, just set the number to 100 docs.
> If the user then goes to docs 100 to 110, just reexecute ther query with a
> larger value. [...] If somebody goes further, just raise and reexecute query.

That's what I thought of as workaround for the first pages. But at
some point the user might want to see the last page of the results,
so eventually I will have to call

  TopDocs topDocs = indexSearcher.search(query, null, 300500, sort);

and still run into an error. Right now I'd present the user with an
error message like "The search returned too many results, please further
restrict your search" but a more generic solution would sound a lot
better ;)

Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42547-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:53:54 2009
Return-Path: <java-user-return-42547-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29327 invoked from network); 1 Oct 2009 11:53:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:53:54 -0000
Received: (qmail 10319 invoked by uid 500); 1 Oct 2009 11:53:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10276 invoked by uid 500); 1 Oct 2009 11:53:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10266 invoked by uid 99); 1 Oct 2009 11:53:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:53:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:53:42 +0000
Received: by yxe30 with SMTP id 30so73517yxe.29
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 04:53:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.92.8 with SMTP id u8mr2146240ybl.101.1254398002062; Thu, 
	01 Oct 2009 04:53:22 -0700 (PDT)
In-Reply-To: <893c4af60909300329u1511b49dl44affc66024d3338@mail.gmail.com>
References: <893c4af60909300329u1511b49dl44affc66024d3338@mail.gmail.com>
Date: Thu, 1 Oct 2009 07:53:22 -0400
Message-ID: <9ac0c6aa0910010453v378c69f3r5569a0489dc6e988@mail.gmail.com>
Subject: Re: How does the term infos file (.tis) works?
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

It's better to use the TermEnum API (IndexReader.terms()) to step
through the terms, than to directly access the raw file (unless you
have some reason to do so...).

Mike

On Wed, Sep 30, 2009 at 6:29 AM, iron light <iron9light@gmail.com> wrote:
> I try to traverse all the term text in one tis files. And it failed. the
> code is below.
> Does I misunderstand something?
> The source code (especial the index namespace) is very complicated for me=
.
> Is there any more document about the design and something can help me
> understand the source?
>
> Thanks.
>
> =A0 =A0public static void main(String[] args) throws IOException {
> =A0 =A0 =A0 =A0File path =3D new File("../../wiki/index").getCanonicalFil=
e();
> =A0 =A0 =A0 =A0FSDirectory directory =3D FSDirectory.open(path);
> =A0 =A0 =A0 =A0IndexInput input =3D directory.openInput("_1ck.tis");
> =A0 =A0 =A0 =A0System.out.println(input.readInt());
> =A0 =A0 =A0 =A0System.out.println(input.readLong());
> =A0 =A0 =A0 =A0System.out.println(input.readInt());
> =A0 =A0 =A0 =A0System.out.println(input.readInt());
> =A0 =A0 =A0 =A0System.out.println(input.readInt());
>
> =A0 =A0 =A0 =A0String text =3D "";
> =A0 =A0 =A0 =A0for(int i =3D 0; i < 10; ++i){
> =A0 =A0 =A0 =A0 =A0 =A0TermInfo termInfo =3D new TermInfo(input);
> =A0 =A0 =A0 =A0 =A0 =A0text =3D text.substring(0, termInfo.term.prefixLen=
gth) +
> termInfo.term.suffix;
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(text);
> =A0 =A0 =A0 =A0}
> =A0 =A0}
>
> =A0 =A0private static class Term {
> =A0 =A0 =A0 =A0public int prefixLength;
> =A0 =A0 =A0 =A0public String suffix;
> =A0 =A0 =A0 =A0public int fieldNum;
> =A0 =A0 =A0 =A0Term(IndexInput input) throws IOException {
> =A0 =A0 =A0 =A0 =A0 =A0this.prefixLength =3D input.readVInt();
> =A0 =A0 =A0 =A0 =A0 =A0this.suffix =3D input.readString();
> =A0 =A0 =A0 =A0 =A0 =A0this.fieldNum =3D input.readVInt();
> =A0 =A0 =A0 =A0}
> =A0 =A0}
>
> =A0 =A0private static class TermInfo {
> =A0 =A0 =A0 =A0public Term term;
> =A0 =A0 =A0 =A0public int docFreq, freqDelta, proxDelta, skipDelta;
> =A0 =A0 =A0 =A0TermInfo(IndexInput input) throws IOException {
> =A0 =A0 =A0 =A0 =A0 =A0this.term =3D new Term(input);
> =A0 =A0 =A0 =A0 =A0 =A0this.docFreq =3D input.readVInt();
> =A0 =A0 =A0 =A0 =A0 =A0this.freqDelta =3D input.readVInt();
> =A0 =A0 =A0 =A0 =A0 =A0this.proxDelta =3D input.readVInt();
> =A0 =A0 =A0 =A0 =A0 =A0this.skipDelta =3D input.readVInt();
> =A0 =A0 =A0 =A0}
> =A0 =A0}
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42548-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 11:59:36 2009
Return-Path: <java-user-return-42548-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32389 invoked from network); 1 Oct 2009 11:59:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 11:59:36 -0000
Received: (qmail 22062 invoked by uid 500); 1 Oct 2009 11:59:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21982 invoked by uid 500); 1 Oct 2009 11:59:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21972 invoked by uid 99); 1 Oct 2009 11:59:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:59:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 11:59:24 +0000
Received: by pzk3 with SMTP id 3so85698pzk.20
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 04:58:03 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=fIo7LCpWXpLMESLS7ppx9GgoiwawhqQ8jhlc9ZW0FV4=;
        b=Auu5g6WCVYYMn+3dma/NwgjCOAr/FinoDRq1+pELafyeuovOYrj2A5YsWykdOXjlBe
         dX9PIcHN2buNzEzZE+MoVEd6yCrBXysAW0folxrKYBWqL9CaUgS7vvQnby9Z7llvrf5I
         OdJSawQxkapn5N4WuE2JxXhTB08Hbe08NXgBI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=RlI9dZGASp7GDxiLbkWP9VH6gsNEAWbz2Mqm+4iyOqo6UswgLJW3RtFyDy8cegHyLJ
         tbgmD4D0VHgPrOW5sxlmGFPvGLvjcK1qjsoV7U0tlP/03dEhe+ohtmNvS1WifWR4k5EK
         mNaOMk2fCdeRmPw76FnP1lGSZNk31EvIlD3U8=
MIME-Version: 1.0
Received: by 10.114.69.17 with SMTP id r17mr1897756waa.42.1254398283213; Thu, 
	01 Oct 2009 04:58:03 -0700 (PDT)
In-Reply-To: <4AC4981D.3090703@arcor.de>
References: <4AC48FB3.2080403@arcor.de> <0A59C3ACD30043F7AB5754BB7C10465B@VEGA> 
	<4AC4981D.3090703@arcor.de>
From: Anshum <anshumg@gmail.com>
Date: Thu, 1 Oct 2009 17:27:43 +0530
Message-ID: <867513fe0910010457x5a8ad409m6401d41203d2a3b4@mail.gmail.com>
Subject: Re: Pagination and Sorting
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502e43913eb950474de5c89
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502e43913eb950474de5c89
Content-Type: text/plain; charset=ISO-8859-1

Hey Christian,
Try what I wrote in the last reply. Would work absolutely fine. Have tested
that for very large datasets.
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Thu, Oct 1, 2009 at 5:23 PM, Christian Robert <cr_usenet@arcor.de> wrote:

> Uwe,
>
> > You are using TopDocs incorrectly. Normally you use *not*
> Integer.MAX_VALUE,
> > as the upper bound of your pagination window as numer of documents. So if
> > user wants to display documents 90 to 100, just set the number to 100
> docs.
> > If the user then goes to docs 100 to 110, just reexecute ther query with
> a
> > larger value. [...] If somebody goes further, just raise and reexecute
> query.
>
> That's what I thought of as workaround for the first pages. But at
> some point the user might want to see the last page of the results,
> so eventually I will have to call
>
>  TopDocs topDocs = indexSearcher.search(query, null, 300500, sort);
>
> and still run into an error. Right now I'd present the user with an
> error message like "The search returned too many results, please further
> restrict your search" but a more generic solution would sound a lot
> better ;)
>
> Chris
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502e43913eb950474de5c89--

From java-user-return-42549-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:09:16 2009
Return-Path: <java-user-return-42549-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35906 invoked from network); 1 Oct 2009 12:09:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:09:16 -0000
Received: (qmail 31931 invoked by uid 500); 1 Oct 2009 12:09:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31853 invoked by uid 500); 1 Oct 2009 12:09:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31843 invoked by uid 99); 1 Oct 2009 12:09:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:09:13 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of cr_usenet@arcor.de designates 151.189.21.42 as permitted sender)
Received: from [151.189.21.42] (HELO mail-in-02.arcor-online.net) (151.189.21.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:09:01 +0000
Received: from mail-in-17-z2.arcor-online.net (mail-in-17-z2.arcor-online.net [151.189.8.34])
	by mx.arcor.de (Postfix) with ESMTP id 781E53FE3FA
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:07:40 +0200 (CEST)
Received: from mail-in-09.arcor-online.net (mail-in-09.arcor-online.net [151.189.21.49])
	by mail-in-17-z2.arcor-online.net (Postfix) with ESMTP id 6730045CAE5
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:07:40 +0200 (CEST)
Received: from [172.23.16.145] (unknown [194.8.222.19])
	(Authenticated sender: cr_usenet@arcor.de)
	by mail-in-09.arcor-online.net (Postfix) with ESMTPSA id 4FA3C1AF95B
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:07:40 +0200 (CEST)
X-DKIM: Sendmail DKIM Filter v2.8.2 mail-in-09.arcor-online.net 4FA3C1AF95B
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=arcor.de; s=mail-in;
	t=1254398860; bh=dTuX8HLTr8lQwYrLOWDE6QeRHdaY5GHVrFZapAUAamU=;
	h=Message-ID:Date:From:MIME-Version:To:Subject:References:
	 In-Reply-To:Content-Type:Content-Transfer-Encoding;
	b=ohtZmEm0dg4lb/9m7rt5OLtlM4kEmBQ168zKfzqJUOynoSUjIeFUQnJMaVesIyWjT
	 NDxxtVLgMKKUp9k0FaApmudQvWmqpSgH3Bi2fwQfKWbwBwidRVDNcq5Yep+P9f5a+D
	 rrcp8WfYOca0zXdpmivmk1YfbCRG1/Usrgag0Y7A=
Message-ID: <4AC49B8B.200@arcor.de>
Date: Thu, 01 Oct 2009 14:07:39 +0200
From: Christian Robert <cr_usenet@arcor.de>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Pagination and Sorting
References: <4AC48FB3.2080403@arcor.de> <867513fe0910010443w5ea01c16r1341c885bde68c46@mail.gmail.com>
In-Reply-To: <867513fe0910010443w5ea01c16r1341c885bde68c46@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Anshum,

> You could get the hits in a collector and pass the sort to the 
> collector as it would be the collect function that handles the
> sorting.
> 
> searcherObject.search(query,collector);
> 
> Hope that gives you some headway. :)

Not quite (yet?) ;-)

What do you mean by passing the Sort to the collector as collect
function? Could you provide a little code snippet that describes
the procedure?

Thanks!
Chris

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42550-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:09:19 2009
Return-Path: <java-user-return-42550-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35941 invoked from network); 1 Oct 2009 12:09:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:09:19 -0000
Received: (qmail 32964 invoked by uid 500); 1 Oct 2009 12:09:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32915 invoked by uid 500); 1 Oct 2009 12:09:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32885 invoked by uid 99); 1 Oct 2009 12:09:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:09:14 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:09:03 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id BB07945EEA9
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:08:13 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 9hpR92Sup7sp for <java-user@lucene.apache.org>;
	Thu,  1 Oct 2009 14:08:03 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id B96C745EEA1
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:08:03 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AC48FB3.2080403@arcor.de> <0A59C3ACD30043F7AB5754BB7C10465B@VEGA> <4AC4981D.3090703@arcor.de> <867513fe0910010457x5a8ad409m6401d41203d2a3b4@mail.gmail.com>
Subject: RE: Pagination and Sorting
Date: Thu, 1 Oct 2009 14:08:03 +0200
Message-ID: <B3E58D06674B47DCA35C33391B9C8828@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <867513fe0910010457x5a8ad409m6401d41203d2a3b4@mail.gmail.com>
Thread-Index: AcpCjq0TW/7liiOSSxeiyJ8BDhal1gAARNgg
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

But a collector will not output the documents in sorted order...

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Anshum [mailto:anshumg@gmail.com]
> Sent: Thursday, October 01, 2009 1:58 PM
> To: java-user@lucene.apache.org
> Subject: Re: Pagination and Sorting
> 
> Hey Christian,
> Try what I wrote in the last reply. Would work absolutely fine. Have
> tested
> that for very large datasets.
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
> 
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
> 
> 
> On Thu, Oct 1, 2009 at 5:23 PM, Christian Robert <cr_usenet@arcor.de>
> wrote:
> 
> > Uwe,
> >
> > > You are using TopDocs incorrectly. Normally you use *not*
> > Integer.MAX_VALUE,
> > > as the upper bound of your pagination window as numer of documents. So
> if
> > > user wants to display documents 90 to 100, just set the number to 100
> > docs.
> > > If the user then goes to docs 100 to 110, just reexecute ther query
> with
> > a
> > > larger value. [...] If somebody goes further, just raise and reexecute
> > query.
> >
> > That's what I thought of as workaround for the first pages. But at
> > some point the user might want to see the last page of the results,
> > so eventually I will have to call
> >
> >  TopDocs topDocs = indexSearcher.search(query, null, 300500, sort);
> >
> > and still run into an error. Right now I'd present the user with an
> > error message like "The search returned too many results, please further
> > restrict your search" but a more generic solution would sound a lot
> > better ;)
> >
> > Chris
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42551-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:22:27 2009
Return-Path: <java-user-return-42551-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39156 invoked from network); 1 Oct 2009 12:22:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:22:27 -0000
Received: (qmail 47610 invoked by uid 500); 1 Oct 2009 12:22:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47560 invoked by uid 500); 1 Oct 2009 12:22:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47549 invoked by uid 99); 1 Oct 2009 12:22:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:22:24 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of iron9light@gmail.com designates 72.14.220.159 as permitted sender)
Received: from [72.14.220.159] (HELO fg-out-1718.google.com) (72.14.220.159)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:22:15 +0000
Received: by fg-out-1718.google.com with SMTP id 16so43095fgg.5
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 05:21:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=8sBjFs06vaku++O2RdYXGEma8XPioIbBzDkdQjHR4vk=;
        b=uVdbzyildtF0Qr3gwvFyeB0oATWRtrHiVwnoFswN380Pdd8pr0xRXibu+G1izOzRuf
         DisIjpqTieCx2JbFV7gijxZsDACxg8ffy+zNFs4qfmKAEYldTIaGNUAyVMCRzqU2a8+K
         uWc9Ai1uIykscR0CQr0HLkojxnpFRQhQc3e1E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Aq2+8p1IHEs1o29t/12PisDEJrazntdf9mTl4dF5SMp3MXNAbTyE944kCk9o/t+ywV
         5mbZK28qp+SVF1Mif6rgXFXGq4sxzZeL314lUpox+10n3o8sd2faoRfsos0Z39XriaOr
         heCvuVKlJA6rQf8AD6dHEWSP3FYFU05XfnWs8=
MIME-Version: 1.0
Received: by 10.239.145.148 with SMTP id s20mr97853hba.142.1254399714625; Thu, 
	01 Oct 2009 05:21:54 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910010453v378c69f3r5569a0489dc6e988@mail.gmail.com>
References: <893c4af60909300329u1511b49dl44affc66024d3338@mail.gmail.com>
	 <9ac0c6aa0910010453v378c69f3r5569a0489dc6e988@mail.gmail.com>
Date: Thu, 1 Oct 2009 21:21:54 +0900
Message-ID: <893c4af60910010521j744bcf6dxbaccfe35a405d5bf@mail.gmail.com>
Subject: Re: How does the term infos file (.tis) works?
From: iron light <iron9light@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f77260658b660474deb1d2
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f77260658b660474deb1d2
Content-Type: text/plain; charset=UTF-8

Thanks, Mike.

The reason is I wanna dig deeply.
I just read the code. And found that  the index namespace (IndexWriter!) in
so tough for me.
Is there any document, resource or blog about the code?

IL

On Thu, Oct 1, 2009 at 8:53 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> It's better to use the TermEnum API (IndexReader.terms()) to step
> through the terms, than to directly access the raw file (unless you
> have some reason to do so...).
>
> Mike
>
> On Wed, Sep 30, 2009 at 6:29 AM, iron light <iron9light@gmail.com> wrote:
> > I try to traverse all the term text in one tis files. And it failed. the
> > code is below.
> > Does I misunderstand something?
> > The source code (especial the index namespace) is very complicated for
> me.
> > Is there any more document about the design and something can help me
> > understand the source?
> >
> > Thanks.
> >
> >    public static void main(String[] args) throws IOException {
> >        File path = new File("../../wiki/index").getCanonicalFile();
> >        FSDirectory directory = FSDirectory.open(path);
> >        IndexInput input = directory.openInput("_1ck.tis");
> >        System.out.println(input.readInt());
> >        System.out.println(input.readLong());
> >        System.out.println(input.readInt());
> >        System.out.println(input.readInt());
> >        System.out.println(input.readInt());
> >
> >        String text = "";
> >        for(int i = 0; i < 10; ++i){
> >            TermInfo termInfo = new TermInfo(input);
> >            text = text.substring(0, termInfo.term.prefixLength) +
> > termInfo.term.suffix;
> >            System.out.println(text);
> >        }
> >    }
> >
> >    private static class Term {
> >        public int prefixLength;
> >        public String suffix;
> >        public int fieldNum;
> >        Term(IndexInput input) throws IOException {
> >            this.prefixLength = input.readVInt();
> >            this.suffix = input.readString();
> >            this.fieldNum = input.readVInt();
> >        }
> >    }
> >
> >    private static class TermInfo {
> >        public Term term;
> >        public int docFreq, freqDelta, proxDelta, skipDelta;
> >        TermInfo(IndexInput input) throws IOException {
> >            this.term = new Term(input);
> >            this.docFreq = input.readVInt();
> >            this.freqDelta = input.readVInt();
> >            this.proxDelta = input.readVInt();
> >            this.skipDelta = input.readVInt();
> >        }
> >    }
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f77260658b660474deb1d2--

From java-user-return-42552-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:24:13 2009
Return-Path: <java-user-return-42552-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39801 invoked from network); 1 Oct 2009 12:24:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:24:13 -0000
Received: (qmail 50437 invoked by uid 500); 1 Oct 2009 12:24:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50362 invoked by uid 500); 1 Oct 2009 12:24:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50352 invoked by uid 99); 1 Oct 2009 12:24:10 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:24:10 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:23:59 +0000
Received: by yxe30 with SMTP id 30so103267yxe.29
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 05:23:38 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.24.21 with SMTP id b21mr2109223ybj.270.1254399818606; Thu, 
	01 Oct 2009 05:23:38 -0700 (PDT)
In-Reply-To: <4AC3CFE2.6030508@gmail.com>
References: <c4e715d70909301425y61ada82byd8064bbfb503750b@mail.gmail.com>
	 <4AC3CFE2.6030508@gmail.com>
Date: Thu, 1 Oct 2009 09:23:38 -0300
Message-ID: <c4e715d70910010523p2d6121f5h897f811ddbba8c1d@mail.gmail.com>
Subject: Re: Implement SpanScorer on 2.9 lucene lib!
From: Felipe Lobo <felipe@goshme.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd297a8983dce0474deb7ba
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd297a8983dce0474deb7ba
Content-Type: text/plain; charset=ISO-8859-1

Hi, thanks for the answer but it didn't work.
I stopped rewriting the query and used the queryscorer but it don't
highlight.
The  part of the query i'm doing wildcard is the number part, like this:
"HC 100930027253"
The HC is hightlighted but the numbers aren't:
"Habeas Corpus <B>HC</B> 100930027253 ES 100930027253"
And of what lib is TermQueryScorer? I check out on lucene javadoc and didn't
see.

Thanks!

On Wed, Sep 30, 2009 at 6:38 PM, Mark Miller <markrmiller@gmail.com> wrote:

> Felipe Lobo wrote:
> > Hi, i updated my lucene lib to 2.9.0 and i'm trying to instanciate the
> > spanscorer but the constructor is protected.
> > I looked in the javadoc of lucene and saw 2 subclasses of it
> > (PayloadNearQuery.PayloadNearSpanScorer,
> > PayloadTermQuery.PayloadTermWeight.PayloadTermSpanScorer).
> > Using this classes is the best way of implementing spanscorer??
> > I was using queryscorer but after update to the new lib the highlither
> > stopped hightlithing my wildcard queries, and i'm rewriting.
> >
> > Thanks,
> >
> Checkout contrib CHANGES.
>
> The SpanScorer is now the QueryScorer - if you want to highlight
> wildcard queries, you should no longer rewrite on your own.
>
> If you want the old behavior, use TermQueryScorer instead.
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Felipe Lobo
www.jusbrasil.com.br

--000e0cd297a8983dce0474deb7ba--

From java-user-return-42553-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:26:00 2009
Return-Path: <java-user-return-42553-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41013 invoked from network); 1 Oct 2009 12:26:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:26:00 -0000
Received: (qmail 56056 invoked by uid 500); 1 Oct 2009 12:25:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55972 invoked by uid 500); 1 Oct 2009 12:25:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55962 invoked by uid 99); 1 Oct 2009 12:25:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:25:57 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:25:47 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 3F05745EEB6
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:25:27 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id KLCf9v-t4kSW for <java-user@lucene.apache.org>;
	Thu,  1 Oct 2009 14:25:24 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id A129145EEB3
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:25:24 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AC48FB3.2080403@arcor.de> <0A59C3ACD30043F7AB5754BB7C10465B@VEGA> <4AC4981D.3090703@arcor.de>
Subject: RE: Pagination and Sorting
Date: Thu, 1 Oct 2009 14:25:15 +0200
Message-ID: <486D3D3EEF3540F69F81E8FD22CE5359@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4AC4981D.3090703@arcor.de>
Thread-Index: AcpCjdhJFuC1aT9gQB6H7E7XbdUUuAABDL6Q
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Chris,

> Uwe,
> 
> > You are using TopDocs incorrectly. Normally you use *not*
> Integer.MAX_VALUE,
> > as the upper bound of your pagination window as numer of documents. So
> if
> > user wants to display documents 90 to 100, just set the number to 100
> docs.
> > If the user then goes to docs 100 to 110, just reexecute ther query with
> a
> > larger value. [...] If somebody goes further, just raise and reexecute
> query.
> 
> That's what I thought of as workaround for the first pages.

That's not a workaround, it is designed to work like this!

> But at
> some point the user might want to see the last page of the results,
> so eventually I will have to call
> 
>   TopDocs topDocs = indexSearcher.search(query, null, 300500, sort);
> 
> and still run into an error. Right now I'd present the user with an
> error message like "The search returned too many results, please further
> restrict your search" but a more generic solution would sound a lot
> better ;)

How about sorting backwards in this case (and print out the page in reverse
to get a forward-printed page again)?

Uwe


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42554-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:30:05 2009
Return-Path: <java-user-return-42554-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42671 invoked from network); 1 Oct 2009 12:30:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:30:05 -0000
Received: (qmail 64214 invoked by uid 500); 1 Oct 2009 12:30:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64154 invoked by uid 500); 1 Oct 2009 12:30:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64144 invoked by uid 99); 1 Oct 2009 12:30:02 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:30:02 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.224] (HELO mail-gx0-f224.google.com) (209.85.217.224)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:29:53 +0000
Received: by gxk24 with SMTP id 24so96317gxk.5
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 05:28:31 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.210.8 with SMTP id i8mr2221904ybg.41.1254400111644; Thu, 
	01 Oct 2009 05:28:31 -0700 (PDT)
In-Reply-To: <893c4af60910010521j744bcf6dxbaccfe35a405d5bf@mail.gmail.com>
References: <893c4af60909300329u1511b49dl44affc66024d3338@mail.gmail.com>
	 <9ac0c6aa0910010453v378c69f3r5569a0489dc6e988@mail.gmail.com>
	 <893c4af60910010521j744bcf6dxbaccfe35a405d5bf@mail.gmail.com>
Date: Thu, 1 Oct 2009 08:28:31 -0400
Message-ID: <9ac0c6aa0910010528o18f67a93v5d6ca4fd6ce316d5@mail.gmail.com>
Subject: Re: How does the term infos file (.tis) works?
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Thu, Oct 1, 2009 at 8:21 AM, iron light <iron9light@gmail.com> wrote:

> The reason is I wanna dig deeply.

OK :)  That's fun!

> I just read the code. And found that =A0the index namespace (IndexWriter!=
) in
> so tough for me.
> Is there any document, resource or blog about the code?

In general there's no separate document detailing how Lucene's source
code works; the code itself (and its comments) is all there is.  If
you are going through the code, please add comments & post a patch and
we can improve its comments over time.  Source code is a living thing
and constantly evolving :)

But, for the index file format in particular, there is this:

    http://lucene.apache.org/java/2_9_0/fileformats.html

If you want specifically to parse the terms dict/index, you should
look at SegmentTermEnum and TermInfosReader for inspiration...

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42555-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:30:29 2009
Return-Path: <java-user-return-42555-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42809 invoked from network); 1 Oct 2009 12:30:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:30:28 -0000
Received: (qmail 65987 invoked by uid 500); 1 Oct 2009 12:30:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65921 invoked by uid 500); 1 Oct 2009 12:30:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65911 invoked by uid 99); 1 Oct 2009 12:30:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:30:26 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:30:15 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 6D5CB45EEB3
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:29:55 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id bIfioRd6j10t for <java-user@lucene.apache.org>;
	Thu,  1 Oct 2009 14:29:45 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 599EA45EEB2
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:29:45 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AC48FB3.2080403@arcor.de> <0A59C3ACD30043F7AB5754BB7C10465B@VEGA> <4AC4981D.3090703@arcor.de> <486D3D3EEF3540F69F81E8FD22CE5359@VEGA>
Subject: RE: Pagination and Sorting
Date: Thu, 1 Oct 2009 14:29:44 +0200
Message-ID: <56790C1282F24862BA6C8E35038236CB@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <486D3D3EEF3540F69F81E8FD22CE5359@VEGA>
Thread-Index: AcpCjdhJFuC1aT9gQB6H7E7XbdUUuAABDL6QAAAjO8A=
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

I forgot to mention: Because of this, e.g. even Google (who do not use
Lucene :-]) does not let you go beyond a limit to a very large page number.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Thursday, October 01, 2009 2:25 PM
> To: java-user@lucene.apache.org
> Subject: RE: Pagination and Sorting
> 
> Hi Chris,
> 
> > Uwe,
> >
> > > You are using TopDocs incorrectly. Normally you use *not*
> > Integer.MAX_VALUE,
> > > as the upper bound of your pagination window as numer of documents. So
> > if
> > > user wants to display documents 90 to 100, just set the number to 100
> > docs.
> > > If the user then goes to docs 100 to 110, just reexecute ther query
> with
> > a
> > > larger value. [...] If somebody goes further, just raise and reexecute
> > query.
> >
> > That's what I thought of as workaround for the first pages.
> 
> That's not a workaround, it is designed to work like this!
> 
> > But at
> > some point the user might want to see the last page of the results,
> > so eventually I will have to call
> >
> >   TopDocs topDocs = indexSearcher.search(query, null, 300500, sort);
> >
> > and still run into an error. Right now I'd present the user with an
> > error message like "The search returned too many results, please further
> > restrict your search" but a more generic solution would sound a lot
> > better ;)
> 
> How about sorting backwards in this case (and print out the page in
> reverse
> to get a forward-printed page again)?
> 
> Uwe
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42556-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:31:41 2009
Return-Path: <java-user-return-42556-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44076 invoked from network); 1 Oct 2009 12:31:41 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:31:41 -0000
Received: (qmail 67934 invoked by uid 500); 1 Oct 2009 12:31:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67853 invoked by uid 500); 1 Oct 2009 12:31:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67843 invoked by uid 99); 1 Oct 2009 12:31:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:31:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:31:28 +0000
Received: by pzk3 with SMTP id 3so111975pzk.20
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 05:31:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=sTN9b0kSeyh8yflABk0Ph45BcJQwdcFBCkcEisQuvj0=;
        b=GphfOeG7FXdB14ZEtU81VgRUQymvIGg10FlpqPvZow2jfMe0S0Z9IBTMOH35oFtkz6
         gkULC17JFDbRMIXaccwMd1RcJcmQyIigfTAmqShBVnkVUHuwwBGK3NcpsE/uNikT7REs
         ja0M+krE3Uxkas7Sg8HHX6A5AUzW76GRyNcRg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=I3GcZllVfp7NwlYO4SJVAOi8NH1pyzLiEGtwa/ooNgoTLoGbC15afBdI2HNf+jKxzc
         1qQ0vxLxc+KkhlOFMunL5Td24Hm19C3Gi7M26hp2oJrFfA/nJLUzqsTqZRymItnMRRZ/
         Y1xq8A0XY8AjF0Wuggf6/GcTHdHx32L2VzUcg=
MIME-Version: 1.0
Received: by 10.115.24.3 with SMTP id b3mr1966727waj.23.1254400267147; Thu, 01 
	Oct 2009 05:31:07 -0700 (PDT)
In-Reply-To: <4AC49B8B.200@arcor.de>
References: <4AC48FB3.2080403@arcor.de> <867513fe0910010443w5ea01c16r1341c885bde68c46@mail.gmail.com> 
	<4AC49B8B.200@arcor.de>
From: Anshum <anshumg@gmail.com>
Date: Thu, 1 Oct 2009 18:00:47 +0530
Message-ID: <867513fe0910010530q1648626ob5bd92bb7dc3aaf8@mail.gmail.com>
Subject: Re: Pagination and Sorting
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163646b678545e3f0474ded264
X-Virus-Checked: Checked by ClamAV on apache.org

--00163646b678545e3f0474ded264
Content-Type: text/plain; charset=ISO-8859-1

@Christian : Which version of Lucene are you using?

For lucene 2.9 this would work.
*__code snippet__*
IndexReader r = IndexReader.open("/home/anshum/index/indexname", true);
IndexSearcher s = new IndexSearcher(r);
QueryParser qp = new QueryParser("testfield",new StopAnalyzer());
Query q =  qp.parse("test query");
int offset = 10000;
int limit = 100;
Sort sort = new Sort(new SortField("testfield",SortField.DOUBLE));* // You
may want to change field type to something else*
TopFieldCollector c = TopFieldCollector.create(sort, offset+limit, true,
true, true, true);
s.search(q, c);
for(int i=offset;i<offset + limit;i++)
  System.out.println("Document : "  + s.doc(c.topDocs().scoreDocs[i].doc));

*__code snippet ends__*
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Thu, Oct 1, 2009 at 5:37 PM, Christian Robert <cr_usenet@arcor.de> wrote:

> Anshum,
>
> > You could get the hits in a collector and pass the sort to the
> > collector as it would be the collect function that handles the
> > sorting.
> >
> > searcherObject.search(query,collector);
> >
> > Hope that gives you some headway. :)
>
> Not quite (yet?) ;-)
>
> What do you mean by passing the Sort to the collector as collect
> function? Could you provide a little code snippet that describes
> the procedure?
>
> Thanks!
> Chris
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00163646b678545e3f0474ded264--

From java-user-return-42557-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:37:51 2009
Return-Path: <java-user-return-42557-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45861 invoked from network); 1 Oct 2009 12:37:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:37:51 -0000
Received: (qmail 78701 invoked by uid 500); 1 Oct 2009 12:37:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78636 invoked by uid 500); 1 Oct 2009 12:37:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78626 invoked by uid 99); 1 Oct 2009 12:37:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:37:48 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:37:36 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 00AAB45EECB
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:37:16 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id fEly7FbyafQP for <java-user@lucene.apache.org>;
	Thu,  1 Oct 2009 14:37:07 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id F209845EEC4
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 14:37:06 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AC48FB3.2080403@arcor.de> <867513fe0910010443w5ea01c16r1341c885bde68c46@mail.gmail.com> <4AC49B8B.200@arcor.de> <867513fe0910010530q1648626ob5bd92bb7dc3aaf8@mail.gmail.com>
Subject: RE: Pagination and Sorting
Date: Thu, 1 Oct 2009 14:37:06 +0200
Message-ID: <D1AA1E6BE5734F2D91CDD8FDABDCFF8E@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <867513fe0910010530q1648626ob5bd92bb7dc3aaf8@mail.gmail.com>
Thread-Index: AcpCkyTj20zY/rnnQHy2P7UboQujmgAAHvtQ
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Anshum,

That is exactly the same code he is using (only that he does not instantiate
the collector;  IndexSearcher.search(query, int) does exactly that
internally :-)

His problem was, that if offset+limit is large or Integer.MAX_VALUE that he
runs out of memory.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Anshum [mailto:anshumg@gmail.com]
> Sent: Thursday, October 01, 2009 2:31 PM
> To: java-user@lucene.apache.org
> Subject: Re: Pagination and Sorting
> 
> @Christian : Which version of Lucene are you using?
> 
> For lucene 2.9 this would work.
> *__code snippet__*
> IndexReader r = IndexReader.open("/home/anshum/index/indexname", true);
> IndexSearcher s = new IndexSearcher(r);
> QueryParser qp = new QueryParser("testfield",new StopAnalyzer());
> Query q =  qp.parse("test query");
> int offset = 10000;
> int limit = 100;
> Sort sort = new Sort(new SortField("testfield",SortField.DOUBLE));* // You
> may want to change field type to something else*
> TopFieldCollector c = TopFieldCollector.create(sort, offset+limit, true,
> true, true, true);
> s.search(q, c);
> for(int i=offset;i<offset + limit;i++)
>   System.out.println("Document : "  +
> s.doc(c.topDocs().scoreDocs[i].doc));
> 
> *__code snippet ends__*
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
> 
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
> 
> 
> On Thu, Oct 1, 2009 at 5:37 PM, Christian Robert <cr_usenet@arcor.de>
> wrote:
> 
> > Anshum,
> >
> > > You could get the hits in a collector and pass the sort to the
> > > collector as it would be the collect function that handles the
> > > sorting.
> > >
> > > searcherObject.search(query,collector);
> > >
> > > Hope that gives you some headway. :)
> >
> > Not quite (yet?) ;-)
> >
> > What do you mean by passing the Sort to the collector as collect
> > function? Could you provide a little code snippet that describes
> > the procedure?
> >
> > Thanks!
> > Chris
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42558-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 12:53:52 2009
Return-Path: <java-user-return-42558-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48996 invoked from network); 1 Oct 2009 12:53:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 12:53:52 -0000
Received: (qmail 94814 invoked by uid 500); 1 Oct 2009 12:53:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94753 invoked by uid 500); 1 Oct 2009 12:53:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94743 invoked by uid 99); 1 Oct 2009 12:53:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:53:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,MISSING_MIMEOLE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of Chris.Bamford@scalix.com designates 82.111.253.243 as permitted sender)
Received: from [82.111.253.243] (HELO mail.uk.scalix.com) (82.111.253.243)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 12:53:40 +0000
Received: from mail.uk.scalix.com (localhost.localdomain [127.0.0.1])
	by mail.uk.scalix.com (8.13.8/8.13.8) with ESMTP id n91CqEw9026599
	for <java-user@lucene.apache.org>; Thu, 1 Oct 2009 13:52:14 +0100
Received: from mail.uk.scalix.com (mail.uk.scalix.com [10.11.108.216])
    by mail.uk.scalix.com (Scalix SMTP Relay 11.5.0.13338)
    via ESMTP; Thu, 01 Oct 2009 13:52:13 +0100 (BST)
Date: Thu, 1 Oct 2009 13:52:13 +0100
From: Chris Bamford <Chris.Bamford@scalix.com>
To: <java-user@lucene.apache.org>
Message-ID: <1691327499.1351254401533251.JavaMail.root@mail.uk.scalix.com>
Subject: How to test if an IndexReader is still open?
X-MSMail-Priority: medium
x-scalix-Hops: 1
X-Mailer: Scalix 11.5.0.12255
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_Part_30_1860350196.1254401533249"
X-Spam-Checker-Version: SpamAssassin 3.2.5 (2008-06-10) on mail.uk.scalix.com
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, score=-2.5 required=5.0 tests=AWL,BAYES_00,HTML_MESSAGE,
	MISSING_MIMEOLE autolearn=ham version=3.2.5

------=_Part_30_1860350196.1254401533249
Content-Type: text/plain;
	charset="us-ascii"
Content-Disposition: inline

Hi,

In an attempt to balance searching efficiency against the number of open file descriptors on my system, I cache IndexSearchers with a "last used" timestamp.  A background cache manager thread then periodically checks the cache for any that haven't been used in a while and removes them from the cache.  In so doing, it also closes their underlying IndexReaders to force the files to be released.  This works very well, but I have hit a very occasional race condition where search code grabs a searcher from the cache just as it is about to expire - causing an "AlreadyClosed" exception.  Rather than attempt to synchronize my code, I figured it might be less expensive if search() (I have extended IndexSearcher) were to check that the underlying IndexReader is still open - and reopen() if necessary.  However, I cannot find a way to detect this ...  is there a way?  Failing that, what is the cost of just issuing a reopen() anyway?

Thanks for any thoughts / ideas.

- Chris


------=_Part_30_1860350196.1254401533249--

From java-user-return-42559-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 13:46:18 2009
Return-Path: <java-user-return-42559-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77972 invoked from network); 1 Oct 2009 13:46:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 13:46:18 -0000
Received: (qmail 87039 invoked by uid 500); 1 Oct 2009 13:46:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86949 invoked by uid 500); 1 Oct 2009 13:46:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86938 invoked by uid 99); 1 Oct 2009 13:46:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 13:46:16 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 13:46:04 +0000
Received: by fxm2 with SMTP id 2so148188fxm.28
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 06:44:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=FpXA5a4N4RDsJh7NWUCD2jZOSCP8TsK6E6qVT29BDY8=;
        b=HpaSjv4TQiWgZYp1kpI2cfmmXsAz5fe5U+SQnosml0M3pUKi0RrcMs8GIUtz9uGLKq
         AKwWqhgqfudvz8/RxRiy6ASSHE/MsAnEXbzqe9qHeRD5kt4CZaUruj0/L0I66untSlOC
         CPp97Llxi4CEVX0ZQL6vaD4jG+io3IXfcMOC4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=jvA2mD21tdH8PJ44w9URP7drD/u3UcNZvEE5yez/DLNpmohmwpuupD/qDIleLH/tk1
         AQiuZUZA5INMfm+eLz4nmkAPNeBL2FwLzuB81MY0xUdlmbLfuTo8Nl8P4z8ksOpiEjgT
         b49CcRohpiWo1rP6H6Lza3aJdIsIUPReFNvBI=
Received: by 10.86.229.18 with SMTP id b18mr1177914fgh.34.1254404683988;
        Thu, 01 Oct 2009 06:44:43 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id l12sm308739fgb.5.2009.10.01.06.44.41
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 01 Oct 2009 06:44:42 -0700 (PDT)
Message-ID: <4AC4B24A.5090404@gmail.com>
Date: Thu, 01 Oct 2009 09:44:42 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Implement SpanScorer on 2.9 lucene lib!
References: <c4e715d70909301425y61ada82byd8064bbfb503750b@mail.gmail.com>	 <4AC3CFE2.6030508@gmail.com> <c4e715d70910010523p2d6121f5h897f811ddbba8c1d@mail.gmail.com>
In-Reply-To: <c4e715d70910010523p2d6121f5h897f811ddbba8c1d@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Felipe Lobo wrote:
> Hi, thanks for the answer but it didn't work.
> I stopped rewriting the query and used the queryscorer but it don't
> highlight.
> The  part of the query i'm doing wildcard is the number part, like this:
> "HC 100930027253"
> The HC is hightlighted but the numbers aren't:
> "Habeas Corpus <B>HC</B> 100930027253 ES 100930027253"
>   
Hmm ... I don't know. Should work. Can you post some code?
> And of what lib is TermQueryScorer? I check out on lucene javadoc and didn't
> see.
>   
Its in the same package as the QueryScorer, in the Highlighter contrib.
> Thanks!
>
> On Wed, Sep 30, 2009 at 6:38 PM, Mark Miller <markrmiller@gmail.com> wrote:
>
>   
>> Felipe Lobo wrote:
>>     
>>> Hi, i updated my lucene lib to 2.9.0 and i'm trying to instanciate the
>>> spanscorer but the constructor is protected.
>>> I looked in the javadoc of lucene and saw 2 subclasses of it
>>> (PayloadNearQuery.PayloadNearSpanScorer,
>>> PayloadTermQuery.PayloadTermWeight.PayloadTermSpanScorer).
>>> Using this classes is the best way of implementing spanscorer??
>>> I was using queryscorer but after update to the new lib the highlither
>>> stopped hightlithing my wildcard queries, and i'm rewriting.
>>>
>>> Thanks,
>>>
>>>       
>> Checkout contrib CHANGES.
>>
>> The SpanScorer is now the QueryScorer - if you want to highlight
>> wildcard queries, you should no longer rewrite on your own.
>>
>> If you want the old behavior, use TermQueryScorer instead.
>>
>> --
>> - Mark
>>
>> http://www.lucidimagination.com
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42560-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 14:05:20 2009
Return-Path: <java-user-return-42560-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86447 invoked from network); 1 Oct 2009 14:05:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 14:05:20 -0000
Received: (qmail 35039 invoked by uid 500); 1 Oct 2009 14:05:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34964 invoked by uid 500); 1 Oct 2009 14:05:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34954 invoked by uid 99); 1 Oct 2009 14:05:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 14:05:17 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.192] (HELO mail-yw0-f192.google.com) (209.85.211.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 14:05:06 +0000
Received: by ywh30 with SMTP id 30so219259ywh.23
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 07:03:44 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.65.10 with SMTP id n10mr2332382yba.201.1254405823115; Thu, 
	01 Oct 2009 07:03:43 -0700 (PDT)
In-Reply-To: <4AC4B24A.5090404@gmail.com>
References: <c4e715d70909301425y61ada82byd8064bbfb503750b@mail.gmail.com>
	 <4AC3CFE2.6030508@gmail.com>
	 <c4e715d70910010523p2d6121f5h897f811ddbba8c1d@mail.gmail.com>
	 <4AC4B24A.5090404@gmail.com>
Date: Thu, 1 Oct 2009 11:03:43 -0300
Message-ID: <c4e715d70910010703o135472f4y1b0036c202ad87a8@mail.gmail.com>
Subject: Re: Implement SpanScorer on 2.9 lucene lib!
From: Felipe Lobo <felipe@goshme.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd3aa2c7db20a0474e01d51
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd3aa2c7db20a0474e01d51
Content-Type: text/plain; charset=ISO-8859-1

Here's the code:
------------------------------------------------------
Highlighter highlighter = new Highlighter(new SimpleHTMLFormatter(), new
QueryScorer(query));

highlighter.setTextFragmenter(new SimpleFragmenter(999999999));

String fieldName = "Title";

String text = document.getField(fieldName).stringValue();

TokenStream tokenStream = analyzer.tokenStream(fieldName, new
StringReader(text));

String markedResult = highlighter.getBestFragments(tokenStream, text, 3,
"...");
----------------------------------------------------
and when i sysout the markedResult shows this:

"Habeas Corpus <B>HC</B> 100930027253 ES 100930027253"

when i put a shorter number, like 4 characther, it makes the highlight, but
this "100930027253" it don't.

the name is realy TermQueryScorer or is QueryTermScorer(i found that in the
package)??

Thanks.


On Thu, Oct 1, 2009 at 10:44 AM, Mark Miller <markrmiller@gmail.com> wrote:

> Felipe Lobo wrote:
> > Hi, thanks for the answer but it didn't work.
> > I stopped rewriting the query and used the queryscorer but it don't
> > highlight.
> > The  part of the query i'm doing wildcard is the number part, like this:
> > "HC 100930027253"
> > The HC is hightlighted but the numbers aren't:
> > "Habeas Corpus <B>HC</B> 100930027253 ES 100930027253"
> >
> Hmm ... I don't know. Should work. Can you post some code?
> > And of what lib is TermQueryScorer? I check out on lucene javadoc and
> didn't
> > see.
> >
> Its in the same package as the QueryScorer, in the Highlighter contrib.
> > Thanks!
> >
> > On Wed, Sep 30, 2009 at 6:38 PM, Mark Miller <markrmiller@gmail.com>
> wrote:
> >
> >
> >> Felipe Lobo wrote:
> >>
> >>> Hi, i updated my lucene lib to 2.9.0 and i'm trying to instanciate the
> >>> spanscorer but the constructor is protected.
> >>> I looked in the javadoc of lucene and saw 2 subclasses of it
> >>> (PayloadNearQuery.PayloadNearSpanScorer,
> >>> PayloadTermQuery.PayloadTermWeight.PayloadTermSpanScorer).
> >>> Using this classes is the best way of implementing spanscorer??
> >>> I was using queryscorer but after update to the new lib the highlither
> >>> stopped hightlithing my wildcard queries, and i'm rewriting.
> >>>
> >>> Thanks,
> >>>
> >>>
> >> Checkout contrib CHANGES.
> >>
> >> The SpanScorer is now the QueryScorer - if you want to highlight
> >> wildcard queries, you should no longer rewrite on your own.
> >>
> >> If you want the old behavior, use TermQueryScorer instead.
> >>
> >> --
> >> - Mark
> >>
> >> http://www.lucidimagination.com
> >>
> >>
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >>
> >
> >
> >
>
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Felipe Lobo
www.jusbrasil.com.br

--000e0cd3aa2c7db20a0474e01d51--

From java-user-return-42561-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 14:07:22 2009
Return-Path: <java-user-return-42561-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87229 invoked from network); 1 Oct 2009 14:07:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 14:07:22 -0000
Received: (qmail 41223 invoked by uid 500); 1 Oct 2009 14:07:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41185 invoked by uid 500); 1 Oct 2009 14:07:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41175 invoked by uid 99); 1 Oct 2009 14:07:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 14:07:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 72.14.220.152 as permitted sender)
Received: from [72.14.220.152] (HELO fg-out-1718.google.com) (72.14.220.152)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 14:07:08 +0000
Received: by fg-out-1718.google.com with SMTP id 16so77829fgg.5
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 07:06:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=8mB/vTsVaWwVEfcUhFeqHkXV6sHXu8bZ6jhyDcLtimw=;
        b=pV4zUws++BPPLPlMviP1kDQwP5s7FXc2sPpfOLaoYE/VClTv9SvoTiRo05Kmd9sdo/
         SeC5Xsj7J7OdVMYa56SP8q+TXVptzXq75wOQYYu6ItMQ/VERDhELv6YkVKBBGXS8QXk+
         IhSWOAtQiZPV8sgUGv2DbUAht2hEJjJlbI5M4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=WqqQLlrwgL4bw9iUs95NgOgYzNxpb9CK2BI3YNd45JhlFfT5j0Z0Da/fatTLrNT+LD
         dFsgND6MAkOPDta1l4JuMFecF4e5mYWnqRtbaK0iHU5B2/9AHOK0OjHDOXoYZMAqV6W5
         MS3zZakQAkid22v8WTMojleaEWbXE/0hvBbqk=
Received: by 10.86.231.5 with SMTP id d5mr1177754fgh.53.1254406008168;
        Thu, 01 Oct 2009 07:06:48 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id l12sm9854fgb.25.2009.10.01.07.06.46
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 01 Oct 2009 07:06:47 -0700 (PDT)
Message-ID: <4AC4B776.6040307@gmail.com>
Date: Thu, 01 Oct 2009 10:06:46 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Implement SpanScorer on 2.9 lucene lib!
References: <c4e715d70909301425y61ada82byd8064bbfb503750b@mail.gmail.com>	 <4AC3CFE2.6030508@gmail.com>	 <c4e715d70910010523p2d6121f5h897f811ddbba8c1d@mail.gmail.com>	 <4AC4B24A.5090404@gmail.com> <c4e715d70910010703o135472f4y1b0036c202ad87a8@mail.gmail.com>
In-Reply-To: <c4e715d70910010703o135472f4y1b0036c202ad87a8@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Felipe Lobo wrote:
> Here's the code:
> ------------------------------------------------------
> Highlighter highlighter = new Highlighter(new SimpleHTMLFormatter(), new
> QueryScorer(query));
>
> highlighter.setTextFragmenter(new SimpleFragmenter(999999999));
>
> String fieldName = "Title";
>
> String text = document.getField(fieldName).stringValue();
>
> TokenStream tokenStream = analyzer.tokenStream(fieldName, new
> StringReader(text));
>
> String markedResult = highlighter.getBestFragments(tokenStream, text, 3,
> "...");
> ----------------------------------------------------
> and when i sysout the markedResult shows this:
>
> "Habeas Corpus <B>HC</B> 100930027253 ES 100930027253"
>
> when i put a shorter number, like 4 characther, it makes the highlight, but
> this "100930027253" it don't.
>   
Thanks a lot - I'll check it out and get back to you.
> the name is realy TermQueryScorer or is QueryTermScorer(i found that in the
> package)??
>   
Sorry! Thats what happens when I trust my memory ;)

Its QueryTermScorer.

> Thanks.
>
>
> On Thu, Oct 1, 2009 at 10:44 AM, Mark Miller <markrmiller@gmail.com> wrote:
>
>   
>> Felipe Lobo wrote:
>>     
>>> Hi, thanks for the answer but it didn't work.
>>> I stopped rewriting the query and used the queryscorer but it don't
>>> highlight.
>>> The  part of the query i'm doing wildcard is the number part, like this:
>>> "HC 100930027253"
>>> The HC is hightlighted but the numbers aren't:
>>> "Habeas Corpus <B>HC</B> 100930027253 ES 100930027253"
>>>
>>>       
>> Hmm ... I don't know. Should work. Can you post some code?
>>     
>>> And of what lib is TermQueryScorer? I check out on lucene javadoc and
>>>       
>> didn't
>>     
>>> see.
>>>
>>>       
>> Its in the same package as the QueryScorer, in the Highlighter contrib.
>>     
>>> Thanks!
>>>
>>> On Wed, Sep 30, 2009 at 6:38 PM, Mark Miller <markrmiller@gmail.com>
>>>       
>> wrote:
>>     
>>>       
>>>> Felipe Lobo wrote:
>>>>
>>>>         
>>>>> Hi, i updated my lucene lib to 2.9.0 and i'm trying to instanciate the
>>>>> spanscorer but the constructor is protected.
>>>>> I looked in the javadoc of lucene and saw 2 subclasses of it
>>>>> (PayloadNearQuery.PayloadNearSpanScorer,
>>>>> PayloadTermQuery.PayloadTermWeight.PayloadTermSpanScorer).
>>>>> Using this classes is the best way of implementing spanscorer??
>>>>> I was using queryscorer but after update to the new lib the highlither
>>>>> stopped hightlithing my wildcard queries, and i'm rewriting.
>>>>>
>>>>> Thanks,
>>>>>
>>>>>
>>>>>           
>>>> Checkout contrib CHANGES.
>>>>
>>>> The SpanScorer is now the QueryScorer - if you want to highlight
>>>> wildcard queries, you should no longer rewrite on your own.
>>>>
>>>> If you want the old behavior, use TermQueryScorer instead.
>>>>
>>>> --
>>>> - Mark
>>>>
>>>> http://www.lucidimagination.com
>>>>
>>>>
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>>>         
>>>
>>>       
>> --
>> - Mark
>>
>> http://www.lucidimagination.com
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42562-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 15:01:54 2009
Return-Path: <java-user-return-42562-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16498 invoked from network); 1 Oct 2009 15:01:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 15:01:53 -0000
Received: (qmail 55246 invoked by uid 500); 1 Oct 2009 15:01:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55197 invoked by uid 500); 1 Oct 2009 15:01:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55187 invoked by uid 99); 1 Oct 2009 15:01:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 15:01:51 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.202] (HELO homiemail-a17.g.dreamhost.com) (208.97.132.202)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 15:01:40 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a17.g.dreamhost.com (Postfix) with ESMTPA id D1E227A8063
	for <java-user@lucene.apache.org>; Thu,  1 Oct 2009 08:01:18 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Filtering on two date fields simultaneously
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <ef921eda0909290830w462586efo782009645faf1d98@mail.gmail.com>
Date: Thu, 1 Oct 2009 11:01:17 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <01957BCE-D266-4C06-92D7-4F8B5159A136@apache.org>
References: <ef921eda0909290830w462586efo782009645faf1d98@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org


On Sep 29, 2009, at 11:30 AM, Dragan Jotanovic wrote:

> Hi, I was thinking a long time how to implement this kind of
> functionality but couldn't figure out anything appropriate.
> In my lucene document, I have two date fields: start and end date.
> As a search input I have current date (NOW).
> I need to display all documents for which current date is between
> start and end dates.
>
> I know that this could be performed by two RangeQuery-es, ie.
> startDate:{19700101 to NOW} AND endDate:{NOW to 29990101}
> but since the index could be very large, performance would not be  
> very good.
> RangeFilter is not a good idea as well, since I would have to filter
> on two fields (or maybe it would with ChainedFilter?).
>
> Does anyone know which approach would be the best in this kind of
> situation, performance wise?
>

In Lucene 2.9, there is much better performance for range queries on  
numerics, you might try that.

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42563-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 16:05:20 2009
Return-Path: <java-user-return-42563-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42668 invoked from network); 1 Oct 2009 16:05:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 16:05:20 -0000
Received: (qmail 85710 invoked by uid 500); 1 Oct 2009 16:05:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85636 invoked by uid 500); 1 Oct 2009 16:05:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85626 invoked by uid 99); 1 Oct 2009 16:05:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 16:05:17 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [64.202.165.95] (HELO smtpauth04.prod.mesa1.secureserver.net) (64.202.165.95)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 01 Oct 2009 16:05:06 +0000
Received: (qmail 24716 invoked from network); 1 Oct 2009 16:04:45 -0000
Received: from unknown (81.219.54.251)
  by smtpauth04.prod.mesa1.secureserver.net (64.202.165.95) with ESMTP; 01 Oct 2009 16:04:44 -0000
Message-ID: <4AC4D315.5050209@getopt.org>
Date: Thu, 01 Oct 2009 18:04:37 +0200
From: Andrzej Bialecki <ab@getopt.org>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: [ANN] Luke 0.9.9 release
References: <4AC22260.5010202@getopt.org>
In-Reply-To: <4AC22260.5010202@getopt.org>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Andrzej Bialecki wrote:
> Hi all,
> 
> I'm happy to announce the new release of Luke - the Lucene Index Toolbox.

There's a bug in this version in that it doesn't show TermVectors for a 
field. I'll fix it in a few days - I'm waiting for other potential bugs 
to show up. So if you find something that you think doesn't work right 
in this version, and it worked before, then please report it.


-- 
Best regards,
Andrzej Bialecki     <><
  ___. ___ ___ ___ _ _   __________________________________
[__ || __|__/|__||\/|  Information Retrieval, Semantic Web
___|||__||  \|  ||  |  Embedded Unix, System Integration
http://www.sigram.com  Contact: info at sigram dot com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42564-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 16:56:54 2009
Return-Path: <java-user-return-42564-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61488 invoked from network); 1 Oct 2009 16:56:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 16:56:54 -0000
Received: (qmail 11681 invoked by uid 500); 1 Oct 2009 16:56:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11605 invoked by uid 500); 1 Oct 2009 16:56:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11595 invoked by uid 99); 1 Oct 2009 16:56:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 16:56:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mmasters@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 16:56:42 +0000
Received: by ewy19 with SMTP id 19so392705ewy.28
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 09:56:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=W8EkpevIldgT/rY+epAlWTYkiYJZ1bH1UxBvczqG/U8=;
        b=PQEiFWb0u0uNmMZLECgNUafMXXfvKIcHYpA7RrONo104LiUHFOLprV1eyhsQKlu/Kw
         Z7YrblmtUYE9Wo69fztCHOVTKEW/JW4yFncEnbn7klxtJXjYp5OyUha86f3mODVEl4J0
         5tY+hpkR2JosaSufJCvwqSnCtLXr6qP/x60hA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=TFv2nVkbQjBprpYnbmEyeiAvK1rYV0FGqbBbEulcuory6KG/7fAqCBkYu67T8oZySC
         mx8C9Oefg/iQiBtW9DxY3piea4Op8s4NWScfhwHI0+Zj2Y3X7USBowYmszvNU2SIIIri
         H5VWV0F+uYk8Z3xqmePDQGMDkqsFhIvrX8y4I=
MIME-Version: 1.0
Received: by 10.216.11.136 with SMTP id 8mr329095wex.106.1254416181698; Thu, 
	01 Oct 2009 09:56:21 -0700 (PDT)
Date: Thu, 1 Oct 2009 10:56:21 -0600
Message-ID: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
Subject: document diversity
From: Michael Masters <mmasters@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

I was wondering if there is any way to control what kind of documents
are returned from a search. For example, lets say we have an index
built from different types of documents (pdf, txt, html, etc.). Is
there a way to have the first x results have a specified distribution
of document types? It would be nice to have an even number of results
that are from pdfs, txt files, and html files.


Any help would greatly be appreciated.


-Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42565-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 17:12:25 2009
Return-Path: <java-user-return-42565-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68198 invoked from network); 1 Oct 2009 17:12:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 17:12:25 -0000
Received: (qmail 38941 invoked by uid 500); 1 Oct 2009 17:12:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38849 invoked by uid 500); 1 Oct 2009 17:12:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38839 invoked by uid 99); 1 Oct 2009 17:12:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 17:12:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of draganj@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 17:12:12 +0000
Received: by bwz22 with SMTP id 22so254359bwz.5
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 10:10:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=bnsmFNbhOyGAMIiZwsoa8ADJzziVXdCGMg96L2Yu+t0=;
        b=DqJZbw1oDF/7FbIj3KRdc45MKh6ElkastpQm6eIIXeUafN6M7oKNj+ANopbky/IMDD
         VhqQ5sy8TK9dqWTkvQh2NgRYjb0Fk/hENW9NlCN1oezh0XzVnjW48n5swmkrTCzZ+Swk
         zLFgCSlPtzBzGkmfODtP6SLLzTWDFCAn9MQd0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=DBanBM+PngvAqxV5Djh4PzgmAlrCwmW50KqumQMl6RfnokDdPnOvgqRb6a5hnFQP+V
         weiFfDTaGDMzWm7WQKuMuAdl8gjwikRPykujgCP3Iqe5DXIT8mdbuY7/pcGPQaNUn1C3
         RwEgxNuR1P+ueln82jshk6IhFOYHkB6bcJhW4=
MIME-Version: 1.0
Received: by 10.239.190.227 with SMTP id y35mr124804hbh.61.1254417051837; Thu, 
	01 Oct 2009 10:10:51 -0700 (PDT)
In-Reply-To: <01957BCE-D266-4C06-92D7-4F8B5159A136@apache.org>
References: <ef921eda0909290830w462586efo782009645faf1d98@mail.gmail.com>
	 <01957BCE-D266-4C06-92D7-4F8B5159A136@apache.org>
Date: Thu, 1 Oct 2009 18:10:51 +0100
Message-ID: <ef921eda0910011010w64d15555lf26eefede072a64@mail.gmail.com>
Subject: Re: Filtering on two date fields simultaneously
From: Dragan Jotanovic <draganj@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks, I will try NumberRangeQuery

On Thu, Oct 1, 2009 at 4:01 PM, Grant Ingersoll <gsingers@apache.org> wrote:
>
> On Sep 29, 2009, at 11:30 AM, Dragan Jotanovic wrote:
>
>> Hi, I was thinking a long time how to implement this kind of
>> functionality but couldn't figure out anything appropriate.
>> In my lucene document, I have two date fields: start and end date.
>> As a search input I have current date (NOW).
>> I need to display all documents for which current date is between
>> start and end dates.
>>
>> I know that this could be performed by two RangeQuery-es, ie.
>> startDate:{19700101 to NOW} AND endDate:{NOW to 29990101}
>> but since the index could be very large, performance would not be very
>> good.
>> RangeFilter is not a good idea as well, since I would have to filter
>> on two fields (or maybe it would with ChainedFilter?).
>>
>> Does anyone know which approach would be the best in this kind of
>> situation, performance wise?
>>
>
> In Lucene 2.9, there is much better performance for range queries on
> numerics, you might try that.
>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
> Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42566-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 17:18:09 2009
Return-Path: <java-user-return-42566-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71621 invoked from network); 1 Oct 2009 17:18:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 17:18:08 -0000
Received: (qmail 51033 invoked by uid 500); 1 Oct 2009 17:18:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50980 invoked by uid 500); 1 Oct 2009 17:18:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50970 invoked by uid 99); 1 Oct 2009 17:18:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 17:18:06 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of phil123@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 17:17:55 +0000
Received: by gxk26 with SMTP id 26so414244gxk.11
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 10:16:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ULnpOzrfWf+smVSzpPW/12OeHqFSQ+mdY6tAB32WF3k=;
        b=L2jaa7MlTx0BKvehmngQlKmDD28+KISZb2O/XWtzvR/8tA7MvaUA55UNoOxM/fUhKF
         Du7pX26cisPAfXHu9tFD7T1qFiJATpdsSvLxdKaPvG0fZH9bdthTeh4iMxcTOYiX/7CB
         2XmGMCCLUSK3XTXwiGW4Tu5KMDp8XL7CoSTYE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=mY31mnbuomNJrgKZCa2T5p7DYNtff8aV4YH8lVi65N01ZX7IaB6rSTTPfGnuanMvcG
         uJ2iIqLXQUbPRQaysMk3vcH1hEo/QhiPckiopIxZWGB8C8MK0O4xK/BBpLvKEbngexEN
         6nJ0lDAWfFU4vZXIf8uS5gJGfTvWU9hnkd3Vw=
MIME-Version: 1.0
Received: by 10.101.65.19 with SMTP id s19mr1435843ank.3.1254417394373; Thu, 
	01 Oct 2009 10:16:34 -0700 (PDT)
In-Reply-To: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
References: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
Date: Thu, 1 Oct 2009 10:16:34 -0700
Message-ID: <9cafbc680910011016t5946ed9k9df9b4f07609024f@mail.gmail.com>
Subject: Re: document diversity
From: Phil Whelan <phil123@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Mike,

I'd simply store a field "doctype" with values "pdf", "txt", "html"
and perform a separate search for each type. Although, I'd be
interested if anyone has a cooler way of doing this.

Cheers,
Phil

On Thu, Oct 1, 2009 at 9:56 AM, Michael Masters <mmasters@gmail.com> wrote:
> I was wondering if there is any way to control what kind of documents
> are returned from a search. For example, lets say we have an index
> built from different types of documents (pdf, txt, html, etc.). Is
> there a way to have the first x results have a specified distribution
> of document types? It would be nice to have an even number of results
> that are from pdfs, txt files, and html files.
>
>
> Any help would greatly be appreciated.
>
>
> -Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



-- 
Cell : +1  778-233-4935
Skype : philwhelan76
Twitter : http://www.twitter.com/philwhln

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42567-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 17:19:11 2009
Return-Path: <java-user-return-42567-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71993 invoked from network); 1 Oct 2009 17:19:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 17:19:11 -0000
Received: (qmail 53385 invoked by uid 500); 1 Oct 2009 17:19:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53310 invoked by uid 500); 1 Oct 2009 17:19:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53300 invoked by uid 99); 1 Oct 2009 17:19:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 17:19:09 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of williams.tricia@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 17:18:58 +0000
Received: by fxm2 with SMTP id 2so357327fxm.28
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 10:17:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=mA0ehZQhTtzl3SCnYx1B1kfATjI8s0h9vQFCyt9P5lE=;
        b=NV4vywF/hNXb3PTnW2oj4Mcq+RW6AUFYkWvzp2RQXCQqyamjqZmp6LgCzL4YKWZUQE
         2cqWAl551iAQLgUN1BLrdXTKwYGdO6Utj6Aeg8UxU4mRKT6EmCeFF6/u3dNx6uNhBJ4k
         k8I1m8bYw+CYXh7RpgVK9Gwa2gFPM5um9WfVs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=FrJbPCtBSSPrRikfNO1HnmNmw7WbWRJjNUwJ3XcWP/7WBHy3GZ9Z0jrEyoUFEFx0ZS
         95nlMZ3RZyEXpJUpKQoKHAWVKJPVLQcbQxnFdTzpq1Sos+M62F01L65qhkR9GNKXFGM/
         Ofn7QKRKJhUxbUi7iT+fSstXWunDbwpDEuz4Q=
Received: by 10.204.160.73 with SMTP id m9mr159489bkx.214.1254417458413;
        Thu, 01 Oct 2009 10:17:38 -0700 (PDT)
Received: from ?192.168.1.115? ([75.159.76.130])
        by mx.google.com with ESMTPS id 18sm494714fks.40.2009.10.01.10.17.36
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 01 Oct 2009 10:17:37 -0700 (PDT)
Message-ID: <4AC4E42D.5040003@gmail.com>
Date: Thu, 01 Oct 2009 11:17:33 -0600
From: Tricia Williams <williams.tricia@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: document diversity
References: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
In-Reply-To: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Mike,

The first thing that comes to mind is to run a query for each document 
type (assuming that you have a field that stores the type) and qualify 
the document type: for example type:pdf.  Then you would have to write 
something to combine the query results drawing an equal number of hits 
from each query result.  I think that the score would still be able to 
provide you with an appropriate relevance score if you wanted to 
maintain relevance order across all the hits from all document types, 
but my logic could be faulty there.

Tricia


Michael Masters wrote:
> I was wondering if there is any way to control what kind of documents
> are returned from a search. For example, lets say we have an index
> built from different types of documents (pdf, txt, html, etc.). Is
> there a way to have the first x results have a specified distribution
> of document types? It would be nice to have an even number of results
> that are from pdfs, txt files, and html files.
>
>
> Any help would greatly be appreciated.
>
>
> -Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>   


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42568-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 19:47:15 2009
Return-Path: <java-user-return-42568-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35275 invoked from network); 1 Oct 2009 19:47:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 19:47:15 -0000
Received: (qmail 9061 invoked by uid 500); 1 Oct 2009 19:47:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8990 invoked by uid 500); 1 Oct 2009 19:47:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8980 invoked by uid 99); 1 Oct 2009 19:47:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 19:47:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 19:47:03 +0000
Received: by fxm2 with SMTP id 2so484620fxm.28
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 12:45:43 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.97.132 with SMTP id l4mr452266fan.100.1254426343117; Thu, 
	01 Oct 2009 12:45:43 -0700 (PDT)
Date: Thu, 1 Oct 2009 15:45:43 -0400
Message-ID: <6f287d1b0910011245k361649c3o3abf8671df600ed0@mail.gmail.com>
Subject: TermPositions with custom Tokenizer
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015174bdcc89415890474e4e41c
X-Virus-Checked: Checked by ClamAV on apache.org

--0015174bdcc89415890474e4e41c
Content-Type: text/plain; charset=ISO-8859-1

Hello,

I have created a custom Tokenizer and am trying to set and extract my own
positions for each Token using:

reusableToken.reinit(word.getWord(),tokenStart,tokenEnd);

later when querying my index using a SpanTermQuery the start() and end()
tags don't correspond to these values but seem to correspond to the order
the token was tokenized during the indexing process, e.g.

start: 5
end: 6

for a given token.  I realize that the these values come from TermPositions
but how can I effectively get my custom toke nstart and end offsets into
TermPositions for recovery?

thanks -

C>T>

-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--0015174bdcc89415890474e4e41c--

From java-user-return-42569-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 01 21:15:47 2009
Return-Path: <java-user-return-42569-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66461 invoked from network); 1 Oct 2009 21:15:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 1 Oct 2009 21:15:47 -0000
Received: (qmail 21070 invoked by uid 500); 1 Oct 2009 21:15:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20997 invoked by uid 500); 1 Oct 2009 21:15:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20984 invoked by uid 99); 1 Oct 2009 21:15:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 21:15:45 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nigelspleen@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 01 Oct 2009 21:15:35 +0000
Received: by bwz22 with SMTP id 22so440538bwz.5
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 14:15:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=9mnm1TURmPGKRM/6n2W2YVxSA99br6NBKoiOve9iGHo=;
        b=OdkFuYT0NOgY+kf6sP1aUvvape/OT73iQWCMHgsIJblRRIeACpcc2yy7GjsPtd7mgt
         U45jlSPoDOHnkw0ZYXuJ10DS5Ms4StjybLcaaTw5ukCUAH2HJl62cPQWYiQ16rZEhBru
         xr69vZuPnp8zvxGY1o83RRdtfmBEKUHBqQYxo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=AZgMzFQHT/iZ3fUGxOtIR7rqDzNaAQuW8F3NjUYvsc48c8mZ4zBsIHp67EUrt+UtjY
         slRA/Qi5HV2aVRKW9sE3UIRIQlkYTg6QxYnnRHkrukbdx6F+TJk58tv45NihBZ8Av0M0
         1YT5sFNquxYW+KcwCa/50fpRKhpJ3PYsliIuk=
MIME-Version: 1.0
Received: by 10.102.165.24 with SMTP id n24mr631718mue.47.1254431714821; Thu, 
	01 Oct 2009 14:15:14 -0700 (PDT)
Date: Thu, 1 Oct 2009 17:15:14 -0400
Message-ID: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
Subject: Efficiently reopening remotely-distributed indexes in 2.9?
From: Nigel <nigelspleen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364c71f7c1c77b0474e62427
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364c71f7c1c77b0474e62427
Content-Type: text/plain; charset=ISO-8859-1

I have a question about the reopen functionality in Lucene 2.9.  As I
understand it, since FieldCaches are now per-segment, it can avoid reloading
everything when the index is reopened, and instead just load the new
segments.

For background, like many people we have a distributed architecture where
indexes are created on one server and copied to multiple other servers.  The
way that copying works now is something like the following:

   1. Let's say the current index is in /indexes/a and is open
   2. An empty directory for the updated index is created, let's say
   /indexes/b
   3. Hard links for the files in /indexes/a are created in /indexes/b
   4. We rsync the current index on the server with /indexes/b, thus copying
   over new cfs files and deleting hard links to files no longer in use
   5. A new IndexReader is opened for /indexes/b and warmed up
   6. The application starts using the new reader instead of the old one
   7. The old IndexReader is closed and /indexes/a is deleted

I'm simplifying a few steps, but I think this is familiar to many people,
and it's my impression that Solr implements something similar.

The point is, the updated index lives in a new directory in this scheme, and
so we don't actually reopen the existing IndexReader; we open a new one with
a different FSDirectory.

Before Lucene 2.9, I don't think this made any difference, as (I think) the
only advantage to calling reopen vs. just creating another IndexReader was
having reopen figure out whether the index had actually changed.  (And whave
a different way to figure that out, so it was a non-issue.)

With Lucene 2.9, there's now a big difference, namely the per-segment
caching mentioned above.  So the question is how to make use of reopen with
our distribution scheme.  Is there an informal best practice for handling
this case?  For example, should step #5 above rename /indexes/b to
/indexes/a so the index can be reopened in the same physical location?  Or
should rsync operate on the existing directory in-place, updating the
segments* files last and relying on the fact that deleted files will not
really be deleted (on Linux, at least) as long as the app is still holding
them open?

I guess the answer may depend on how exactly reopen knows which files are
the "same" (e.g. does it look at filenames, or file descriptors, etc.).

Thanks,
Chris

--0016364c71f7c1c77b0474e62427--

From java-user-return-42570-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 02:58:22 2009
Return-Path: <java-user-return-42570-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70658 invoked from network); 2 Oct 2009 02:58:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 02:58:22 -0000
Received: (qmail 15679 invoked by uid 500); 2 Oct 2009 02:58:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 15612 invoked by uid 500); 2 Oct 2009 02:58:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 15602 invoked by uid 99); 2 Oct 2009 02:58:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 02:58:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 02:58:09 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MtYL6-000333-V2
	for java-user@lucene.apache.org; Thu, 01 Oct 2009 19:57:48 -0700
Message-ID: <25709909.post@talk.nabble.com>
Date: Thu, 1 Oct 2009 19:57:48 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Help needed bubbling up relevant records with most recent date
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

I've got 5 records in Lucene index.

a.Record 1 contains--tax analysis.Date field value is March 2009

b.Record 2 contains--Senior tax analyst.Date field value is Aug 2009

c.Record 3 contains--Senior tax analyst.Date field value is July 2009

d.Record 4 contains--tax analyst.Date field value is Feb 2009

e.Record 5 contains--Senior tax analyst.Date field value is Oct 2009

If the input keyword is senior tax analyst,then search results should come
up in the following order:

a.Record 5--because this record is has got the most recent date and has got
the matching phrase

b.Record 2--because this record has got second most recent date and has got
the matching phrase

c.Record 3--because this record has got third most recent date and has got
the matching phrase

d.Record 4

e.Record 1

Basically,I want to show the most relevant records grouped by date and
sorted in descending order by date.And then, I want to show remaining
records sorted by descending value of relevancy. How do i achieve this with
Lucene?

Please help.


-- 
View this message in context: http://www.nabble.com/Help-needed-bubbling-up-relevant-records-with-most-recent-date-tp25709909p25709909.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42571-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 04:08:56 2009
Return-Path: <java-user-return-42571-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85860 invoked from network); 2 Oct 2009 04:08:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 04:08:56 -0000
Received: (qmail 57692 invoked by uid 500); 2 Oct 2009 04:08:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57622 invoked by uid 500); 2 Oct 2009 04:08:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57612 invoked by uid 99); 2 Oct 2009 04:08:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 04:08:53 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 04:08:43 +0000
Received: by ewy19 with SMTP id 19so790645ewy.28
        for <java-user@lucene.apache.org>; Thu, 01 Oct 2009 21:08:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=8H1/kFKhO3dtDEJQgf3CmyFi34EvexXsyBNF23LvIGU=;
        b=IRK+TPqgxqOx6Uo0FdZSaKQMQDgI5YQJMaslqTCCRcaV2paPiLlWabYQYsn5LWJGCy
         DH0IJ9n4sIY8rYUk2KcYUg1y04LLAQpFiQ+ocgrKe607gq8HCJ4nqlSC8Pr7czq2S2YN
         UA51AonsIHljbtsr3kl+4Eg0ba0JdTn6ktJ3U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=p7as8MyozUFSQZZzrTy6kmJmt5VZscsiTsrjof29lQmiYQoe5u1Q+rbH7ylZea/o1f
         NXzRSK+N2qEVnTalZWPEnTe5rCyGnXiVsClSmhh1jVYQ+X4uIIt63YH5yOOi3FMQ226D
         aG0r6CG1vZ4Elg8Ir79W1WZNvRGoFZN/LkPKs=
Received: by 10.211.172.8 with SMTP id z8mr2374227ebo.92.1254456502725;
        Thu, 01 Oct 2009 21:08:22 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 24sm835175eyx.1.2009.10.01.21.08.21
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 01 Oct 2009 21:08:22 -0700 (PDT)
Message-Id: <EF0DC4B4-DCAB-4BCF-8F8F-34ACD023A22E@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <25691552.post@talk.nabble.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Help needed ordering search results
Date: Fri, 2 Oct 2009 06:08:21 +0200
References: <25691552.post@talk.nabble.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Not quite sure what you ask for, but I think you want to use a span  
near query (for adding boost to phrases) in a disjunction max query  
(to define weights of the different fields).


     karl

1 okt 2009 kl. 02.40 skrev mitu2009:

>
> Hi,
>
> I've 3 records in Lucene index.
>
> Record 1 contains healthcare in title field. Record 2 contains  
> healthcare
> and insurance in description field but not together. Record 3 contains
> healthcare insurance in company name field.
>
> When a user searches for healthcare insurance,I want to show records  
> in the
> following order in search results...
>
> a.Record #3---because it contains both the words of the input  
> together(ie.as
> a phrase) b.Record #1 c.Record #2
>
> How do i achieve this in lucene?
>
> Thanks.
>
> -- 
> View this message in context: http://www.nabble.com/Help-needed-ordering-search-results-tp25691552p25691552.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42572-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 07:39:21 2009
Return-Path: <java-user-return-42572-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31130 invoked from network); 2 Oct 2009 07:39:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 07:39:21 -0000
Received: (qmail 95340 invoked by uid 500); 2 Oct 2009 07:39:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95257 invoked by uid 500); 2 Oct 2009 07:39:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95247 invoked by uid 99); 2 Oct 2009 07:39:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 07:39:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 07:39:08 +0000
Received: by ewy19 with SMTP id 19so847931ewy.28
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 00:38:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=g+S4iZ0+l9UB7EaicF4KkOq9ocW1uPVdqDZAOtu+sXk=;
        b=TZhLZ7LKDoC6Ijvp8WhaGs4tfJvybVl5RPHEH9G2SDQK+GDEE3Y27G8cWU86NS/7Pb
         fIrTrmOaEprOdXmrUUysnIdNoibL2hUt24FbpVTJcJ6nIVnfJvUWDWdnPGuzI13vq7yr
         WpPSqiWICTzvjY++l9uMcH54FHnICw3QGQ9jQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=XldeqoLnYY/B+G8cFuT0v49l5fVPGAPUTBJ90zJldvwvC6Dsd3xekKlSWTypMer4HZ
         YUD5QMZkzCBtbQr5sQxsw1CuxCgCoOMa4yQvOMn58fqPq0565wysgXQJQmIAAHeWBiSw
         vo/MsG0rG9ljmo7i2/z34m8dFOmR35BFxpe5s=
Received: by 10.211.131.5 with SMTP id i5mr2576775ebn.72.1254469127881;
        Fri, 02 Oct 2009 00:38:47 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 10sm124898eyd.45.2009.10.02.00.38.46
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 02 Oct 2009 00:38:47 -0700 (PDT)
Message-Id: <4DE0F6CC-CC43-4E07-A5B3-F51BD82BB8A0@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <25709909.post@talk.nabble.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Help needed bubbling up relevant records with most recent date
Date: Fri, 2 Oct 2009 09:38:46 +0200
References: <25709909.post@talk.nabble.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Use a span near query to add boost for the phrases. If you only want  
to add boost for exact phrases (0 slop) you might want to consider  
using shingles.

In order to add greater score for a date closer in time you can choose  
between a range of solutions depending on your needs. Using a function  
query is probably the easiest way, but using payloads or field boost  
might also work.

I'm not sure about how safe it is but think the most efficient way for  
your requirements (as I understand them) is to add documents ordered  
by date, adding the closest to current date now. This will produce the  
same score for the documents matching the same phrase but will return  
the document with the lowest document number first. Or is it the other  
way around? This will however probably mean that you'll need to  
rebuild your complete index every time you add a new document. If you  
can do that nightly or your corpus is static it shouldn't be a  
problem. I never did this so please correct me if I'm wrong or confirm  
if I'm right.


     karl

2 okt 2009 kl. 04.57 skrev mitu2009:

>
> Hi,
>
> I've got 5 records in Lucene index.
>
> a.Record 1 contains--tax analysis.Date field value is March 2009
>
> b.Record 2 contains--Senior tax analyst.Date field value is Aug 2009
>
> c.Record 3 contains--Senior tax analyst.Date field value is July 2009
>
> d.Record 4 contains--tax analyst.Date field value is Feb 2009
>
> e.Record 5 contains--Senior tax analyst.Date field value is Oct 2009
>
> If the input keyword is senior tax analyst,then search results  
> should come
> up in the following order:
>
> a.Record 5--because this record is has got the most recent date and  
> has got
> the matching phrase
>
> b.Record 2--because this record has got second most recent date and  
> has got
> the matching phrase
>
> c.Record 3--because this record has got third most recent date and  
> has got
> the matching phrase
>
> d.Record 4
>
> e.Record 1
>
> Basically,I want to show the most relevant records grouped by date and
> sorted in descending order by date.And then, I want to show remaining
> records sorted by descending value of relevancy. How do i achieve  
> this with
> Lucene?
>
> Please help.
>
>
> -- 
> View this message in context: http://www.nabble.com/Help-needed-bubbling-up-relevant-records-with-most-recent-date-tp25709909p25709909.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42573-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 08:42:31 2009
Return-Path: <java-user-return-42573-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48354 invoked from network); 2 Oct 2009 08:42:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 08:42:31 -0000
Received: (qmail 88875 invoked by uid 500); 2 Oct 2009 08:42:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88836 invoked by uid 500); 2 Oct 2009 08:42:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 88826 invoked by uid 99); 2 Oct 2009 08:42:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 08:42:28 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mani.ezzat@arisem.com designates 192.93.160.42 as permitted sender)
Received: from [192.93.160.42] (HELO mail.arisem.com) (192.93.160.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 08:42:18 +0000
Message-ID: <4AC5BCCB.4010901@arisem.com>
Date: Fri, 2 Oct 2009 10:41:47 +0200
From: Mani EZZAT <mani.ezzat@arisem.com>
User-Agent: Mozilla-Thunderbird 2.0.0.22 (X11/20090707)
MIME-Version: 1.0
To: <java-user@lucene.apache.org>
Subject: TimeLimitedCollector hang on, VM process doesn't die (TOMCAT)
Content-Type: text/plain; charset="ISO-8859-1"; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hello everyone.
I'm using solrJ for an application deployed in Tomcat (6.x). It's base 
on lucene 2.9
when I use the catalina stop command, the VM doesn't die.

The problem seems to be the TimeLimitedCollector thread.
Here a jstack trace of the JVM (I get the same thing with jconsole too) :


Attaching to process ID 32430, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 1.5.0_17-b04
Thread 32430: (state = BLOCKED)


Thread 32530: (state = BLOCKED)
 - java.lang.Thread.sleep(long) @bci=0 (Interpreted frame)
 - org.apache.lucene.search.TimeLimitedCollector$TimerThread.run() 
@bci=15, line=79 (Interpreted frame)


Thread 32481: (state = BLOCKED)
 - sun.misc.Unsafe.park(boolean, long) @bci=0 (Interpreted frame)
 - java.util.concurrent.locks.LockSupport.park() @bci=5, line=118 
(Interpreted frame)
 - 
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await() 
@bci=41, line=1841 (Interpreted frame)
 - java.util.concurrent.LinkedBlockingQueue.take() @bci=29, line=359 
(Interpreted frame)
 - java.util.concurrent.ThreadPoolExecutor.getTask() @bci=47, line=470 
(Interpreted frame)
 - java.util.concurrent.ThreadPoolExecutor$Worker.run() @bci=18, 
line=674 (Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32480: (state = BLOCKED)
 - sun.misc.Unsafe.park(boolean, long) @bci=0 (Interpreted frame)
 - java.util.concurrent.locks.LockSupport.park() @bci=5, line=118 
(Interpreted frame)
 - 
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await() 
@bci=41, line=1841 (Interpreted frame)
 - java.util.concurrent.LinkedBlockingQueue.take() @bci=29, line=359 
(Interpreted frame)
 - java.util.concurrent.ThreadPoolExecutor.getTask() @bci=47, line=470 
(Interpreted frame)
 - java.util.concurrent.ThreadPoolExecutor$Worker.run() @bci=18, 
line=674 (Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32470: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.ref.ReferenceQueue.remove(long) @bci=44, line=120 
(Interpreted frame)
 - java.lang.ref.ReferenceQueue.remove() @bci=2, line=136 (Interpreted 
frame)
 - org.apache.commons.io.FileCleaner$Reaper.run() @bci=8, line=206 
(Interpreted frame)


Thread 32468: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
 - org.apache.tomcat.util.net.JIoEndpoint$Worker.await() @bci=8, 
line=416 (Interpreted frame)
 - org.apache.tomcat.util.net.JIoEndpoint$Worker.run() @bci=11, line=442 
(Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32466: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
 - org.apache.tomcat.util.net.JIoEndpoint$Worker.await() @bci=8, 
line=416 (Interpreted frame)
 - org.apache.tomcat.util.net.JIoEndpoint$Worker.run() @bci=11, line=442 
(Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32462: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
 - 
org.apache.jk.common.ChannelSocket.accept(org.apache.jk.core.MsgContext) 
@bci=20, line=300 (Interpreted frame)
 - org.apache.jk.common.ChannelSocket.acceptConnections() @bci=72, 
line=660 (Interpreted frame)
 - 
org.apache.jk.common.ChannelSocket$SocketAcceptor.runIt(java.lang.Object[]) 
@bci=4, line=870 (Interpreted frame)
 - org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run() 
@bci=167, line=690 (Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32458: (state = BLOCKED)
 - java.lang.Thread.sleep(long) @bci=0 (Interpreted frame)
 - org.apache.tomcat.util.net.JIoEndpoint$Acceptor.run() @bci=23, 
line=302 (Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32444: (state = IN_NATIVE)
 - java.net.PlainSocketImpl.socketAccept(java.net.SocketImpl) @bci=0 
(Interpreted frame)
 - java.net.PlainSocketImpl.accept(java.net.SocketImpl) @bci=7, line=384 
(Interpreted frame)
 - java.net.ServerSocket.implAccept(java.net.Socket) @bci=50, line=450 
(Interpreted frame)
 - java.net.ServerSocket.accept() @bci=48, line=421 (Interpreted frame)
 - sun.management.jmxremote.LocalRMIServerSocketFactory$1.accept() 
@bci=1, line=31 (Interpreted frame)
 - sun.rmi.transport.tcp.TCPTransport.run() @bci=59, line=340 
(Interpreted frame)
 - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)


Thread 32443: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
 - java.util.TimerThread.mainLoop() @bci=28, line=483 (Interpreted frame)
 - java.util.TimerThread.run() @bci=1, line=462 (Interpreted frame)


Thread 32438: (state = BLOCKED)


Thread 32437: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.ref.ReferenceQueue.remove(long) @bci=44, line=120 
(Interpreted frame)
 - java.lang.ref.ReferenceQueue.remove() @bci=2, line=136 (Interpreted 
frame)
 - java.lang.ref.Finalizer$FinalizerThread.run() @bci=3, line=159 
(Interpreted frame)


Thread 32436: (state = BLOCKED)
 - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
 - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
 - java.lang.ref.Reference$ReferenceHandler.run() @bci=46, line=116 
(Interpreted frame)


When I manually kill the lucene thread, the jvm exit.

I'm using java 1.5.0.17 and debian lenny.

I'm not sure if it's a Solr or Lucene problem...

Best regards.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42574-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 11:10:20 2009
Return-Path: <java-user-return-42574-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83195 invoked from network); 2 Oct 2009 11:10:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 11:10:19 -0000
Received: (qmail 49857 invoked by uid 500); 2 Oct 2009 11:10:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49780 invoked by uid 500); 2 Oct 2009 11:10:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49770 invoked by uid 99); 2 Oct 2009 11:10:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 11:10:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of r.ventaglio@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 11:10:07 +0000
Received: by fxm2 with SMTP id 2so976808fxm.28
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 04:09:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=M/YIuZaMVI/u5lhA8uPdVwkTdl9puSnadmbBr2oFQdc=;
        b=i+ZlbgijwPaxWxmk/Tv9q9do9WovHM/7KlcH9iDXdqWndA4jxGKpGLwA0NzYaF9WHW
         J4kw52YyHZ3jyc8kNcr3oMhDvObzJt7IMAPWTeUBzCX0hJy4yjXqbaia21LskidH82pi
         p09LM25t0HFfQZKch5ar0rdgr39isVREnwPDg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=aYEyYPkEnBytYwf2wKjzXupE3k21GKaPQJA6hkfLVUOKo4aVt6qUeDP3nA8FTxbMg5
         Rq8z5CdR9/6X68ka+fJ9eix70My98n+P1qiaQM2P3KBjxzcWrnCUzTYxRxwFK7xP9+kH
         dB12exPCKfuqJYXn+vEbViQfI/+zslrusYTb8=
MIME-Version: 1.0
Received: by 10.102.249.21 with SMTP id w21mr376532muh.58.1254481787040; Fri, 
	02 Oct 2009 04:09:47 -0700 (PDT)
Date: Fri, 2 Oct 2009 13:09:47 +0200
Message-ID: <70422ecc0910020409j632ac041gd66d923a3336f6ff@mail.gmail.com>
Subject: Error using multireader searcher in Lucene 2.9
From: Raf <r.ventaglio@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636417c374b34dd0474f1cd2b
X-Virus-Checked: Checked by ClamAV on apache.org

--001636417c374b34dd0474f1cd2b
Content-Type: text/plain; charset=ISO-8859-1

Hello,
I have tried to switch my application from Lucene 2.4.1 to Lucene 2.9, but I
have found a problem.
My searcher uses a MultiReader and, when I try to do a search using a custom
filter based on a bitset, it does not behave as it did in Lucene 2.4.
It looks like the new searcher does not use the "offset" when it reads the
subreaders docIds...

I have written a self-contained test to show the problem:

import static org.junit.Assert.assertEquals;
import java.io.IOException;
import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.WhitespaceAnalyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.Field;
import org.apache.lucene.index.CorruptIndexException;
import org.apache.lucene.index.IndexReader;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.MultiReader;
import org.apache.lucene.index.IndexWriter.MaxFieldLength;
import org.apache.lucene.search.DocIdSet;
import org.apache.lucene.search.DocIdSetIterator;
import org.apache.lucene.search.Filter;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.MatchAllDocsQuery;
import org.apache.lucene.search.ScoreDoc;
import org.apache.lucene.search.TopDocs;
import org.apache.lucene.store.Directory;
import org.apache.lucene.store.LockObtainFailedException;
import org.apache.lucene.store.RAMDirectory;
import org.apache.lucene.util.OpenBitSet;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

public class Lucene_2_9SearcherTest {

    private Directory dir1 = new RAMDirectory();
    private Directory dir2 = new RAMDirectory();
    private Analyzer analyzer = new WhitespaceAnalyzer();

    @Before
    public void setUp() throws Exception {
        this.createIndex1();
        this.createIndex2();
    }

    @After
    public void tearDown() throws Exception {
    }

    @Test
    public void testSearchWithMultiReader() throws CorruptIndexException,
IOException {

        IndexReader reader = this.getMultiReader();

        OpenBitSet bitSet = new OpenBitSet(10);
        bitSet.fastSet(1);
        bitSet.fastSet(2);
        bitSet.fastSet(6);

        Filter filter = new DocIdSetFilter(bitSet);

        DocIdSetIterator docIdIt = filter.getDocIdSet(reader).iterator();
        int numDocs = 0;
        System.out.println("Filter extraction:");
        while (docIdIt.next()) {
            System.out.println("Extracted: " + docIdIt.doc() + " --> " +
reader.document(docIdIt.doc()).getField("text").stringValue());
            numDocs++;
        }

        assertEquals(3, numDocs);

        IndexSearcher searcher = new IndexSearcher(reader);
        TopDocs topDocs = searcher.search(new MatchAllDocsQuery(), filter,
10);
        int totSearchDocs = topDocs.totalHits;
        // assertEquals(3, totSearchDocs);

        ScoreDoc[] hits = topDocs.scoreDocs;
        System.out.println("\nSearcher extraction:");
        for (ScoreDoc sd : hits) {
            System.out.println("Extracted: " + sd.doc + " --> " +
reader.document(sd.doc).getField("text").stringValue());
        }

    }

    private void createIndex1() throws CorruptIndexException,
LockObtainFailedException, IOException {

        IndexWriter writer = new IndexWriter(dir1, analyzer, true,
MaxFieldLength.UNLIMITED);

        Document doc = new Document();
        doc.add(new Field("text", "a", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("text", "b", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("text", "c", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("text", "d", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("text", "e", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        writer.optimize();
        writer.close();
    }

    private void createIndex2() throws CorruptIndexException,
LockObtainFailedException, IOException {

        IndexWriter writer = new IndexWriter(dir2, analyzer, true,
MaxFieldLength.UNLIMITED);

        Document doc = new Document();
        doc.add(new Field("text", "x", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("text", "y", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("text", "z", Field.Store.YES,
Field.Index.NOT_ANALYZED));
        writer.addDocument(doc);

        writer.optimize();
        writer.close();
    }

    private IndexReader getMultiReader() throws CorruptIndexException,
IOException {
        IndexReader[] subReaders = new IndexReader[] {
IndexReader.open(dir1, false), IndexReader.open(dir2, false) };
        MultiReader reader = new MultiReader(subReaders);

        return (reader);
    }

    private class DocIdSetFilter extends Filter {

        private static final long serialVersionUID = 1L;

        private DocIdSet myBitset;

        public DocIdSetFilter(DocIdSet bitset) {
            this.myBitset = bitset;
        }

        @Override
        public DocIdSet getDocIdSet(IndexReader reader) throws IOException {
            return (this.myBitset);
        }

    }

}


In Lucene 2.4.1 the output is:
Filter extraction:
Extracted: 1 --> b
Extracted: 2 --> c
Extracted: 6 --> y

Searcher extraction:
Extracted: 1 --> b
Extracted: 2 --> c
Extracted: 6 --> y

while in Lucene 2.9 I have:
Filter extraction:
Extracted: 1 --> b
Extracted: 2 --> c
Extracted: 6 --> y

Searcher extraction:
Extracted: 1 --> b
Extracted: 2 --> c
Extracted: 6 --> y
Extracted: 7 --> z


Is it a bug in the new Lucene searcher or am I missing something?
Thanks,

Bye
Raf

--001636417c374b34dd0474f1cd2b--

From java-user-return-42575-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 12:29:44 2009
Return-Path: <java-user-return-42575-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4285 invoked from network); 2 Oct 2009 12:29:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 12:29:44 -0000
Received: (qmail 35377 invoked by uid 500); 2 Oct 2009 12:29:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35297 invoked by uid 500); 2 Oct 2009 12:29:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35287 invoked by uid 99); 2 Oct 2009 12:29:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 12:29:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 12:29:30 +0000
Received: by bwz22 with SMTP id 22so910426bwz.5
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 05:29:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=oH4hibc+X8ONlGTRhSzKYLOZhJKK1h5UScQtdna2Lew=;
        b=pq3sbhAPkKYh94LBqd4IHadxaf4kHEeZZ7h8G407l69A1TxcYOjojy8ts2z54VOePh
         iXvoHDAkDCZTLWutfKyIp7D6KrXtF7Bg8tHSVzMDaXyOTApiyutHEb23QFd/Cit7shvB
         q6srdac1oVfaPlw8/T364/+B9uVIU7eVv6AXY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=OHvnF6Bx32ugn3++g66VZS2VU5XtTP6bYjI3MjJKl/F+FqwZ3GA6q3O7IQTWuqhAZG
         vuMom7K8w8vMzChzBdl32kCzWX+j76psgR3jJyf9LthlAhU/Iohlor2IgV3vxBYJxWxB
         G5eIcgTjYOSBE8QgsKbjE6WXfoCpmqU0dPhk8=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.223.2.79 with SMTP id 15mr859910fai.106.1254486550268; Fri, 02 
	Oct 2009 05:29:10 -0700 (PDT)
In-Reply-To: <70422ecc0910020409j632ac041gd66d923a3336f6ff@mail.gmail.com>
References: <70422ecc0910020409j632ac041gd66d923a3336f6ff@mail.gmail.com>
Date: Fri, 2 Oct 2009 08:29:10 -0400
X-Google-Sender-Auth: 2eb4b0796e8bd255
Message-ID: <c68e39170910020529s2c354641mecd497cdf0612b87@mail.gmail.com>
Subject: Re: Error using multireader searcher in Lucene 2.9
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Fri, Oct 2, 2009 at 7:09 AM, Raf <r.ventaglio@gmail.com> wrote:
> Hello,
> I have tried to switch my application from Lucene 2.4.1 to Lucene 2.9, bu=
t I
> have found a problem.
> My searcher uses a MultiReader and, when I try to do a search using a cus=
tom
> filter based on a bitset, it does not behave as it did in Lucene 2.4.
> It looks like the new searcher does not use the "offset" when it reads th=
e
> subreaders docIds...

Correct - the DocIdSets returned from Filter should be for the
particular reader passed in the call to
        public DocIdSet getDocIdSet(IndexReader reader) throws IOException =
{
People could ignore the reader in the past (assuming it was always the
same top-level reader), but that no longer works.

-Yonik
http://www.lucidimagination.com



> I have written a self-contained test to show the problem:
>
> import static org.junit.Assert.assertEquals;
> import java.io.IOException;
> import org.apache.lucene.analysis.Analyzer;
> import org.apache.lucene.analysis.WhitespaceAnalyzer;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.document.Field;
> import org.apache.lucene.index.CorruptIndexException;
> import org.apache.lucene.index.IndexReader;
> import org.apache.lucene.index.IndexWriter;
> import org.apache.lucene.index.MultiReader;
> import org.apache.lucene.index.IndexWriter.MaxFieldLength;
> import org.apache.lucene.search.DocIdSet;
> import org.apache.lucene.search.DocIdSetIterator;
> import org.apache.lucene.search.Filter;
> import org.apache.lucene.search.IndexSearcher;
> import org.apache.lucene.search.MatchAllDocsQuery;
> import org.apache.lucene.search.ScoreDoc;
> import org.apache.lucene.search.TopDocs;
> import org.apache.lucene.store.Directory;
> import org.apache.lucene.store.LockObtainFailedException;
> import org.apache.lucene.store.RAMDirectory;
> import org.apache.lucene.util.OpenBitSet;
> import org.junit.After;
> import org.junit.Before;
> import org.junit.Test;
>
> public class Lucene_2_9SearcherTest {
>
> =A0 =A0private Directory dir1 =3D new RAMDirectory();
> =A0 =A0private Directory dir2 =3D new RAMDirectory();
> =A0 =A0private Analyzer analyzer =3D new WhitespaceAnalyzer();
>
> =A0 =A0@Before
> =A0 =A0public void setUp() throws Exception {
> =A0 =A0 =A0 =A0this.createIndex1();
> =A0 =A0 =A0 =A0this.createIndex2();
> =A0 =A0}
>
> =A0 =A0@After
> =A0 =A0public void tearDown() throws Exception {
> =A0 =A0}
>
> =A0 =A0@Test
> =A0 =A0public void testSearchWithMultiReader() throws CorruptIndexExcepti=
on,
> IOException {
>
> =A0 =A0 =A0 =A0IndexReader reader =3D this.getMultiReader();
>
> =A0 =A0 =A0 =A0OpenBitSet bitSet =3D new OpenBitSet(10);
> =A0 =A0 =A0 =A0bitSet.fastSet(1);
> =A0 =A0 =A0 =A0bitSet.fastSet(2);
> =A0 =A0 =A0 =A0bitSet.fastSet(6);
>
> =A0 =A0 =A0 =A0Filter filter =3D new DocIdSetFilter(bitSet);
>
> =A0 =A0 =A0 =A0DocIdSetIterator docIdIt =3D filter.getDocIdSet(reader).it=
erator();
> =A0 =A0 =A0 =A0int numDocs =3D 0;
> =A0 =A0 =A0 =A0System.out.println("Filter extraction:");
> =A0 =A0 =A0 =A0while (docIdIt.next()) {
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Extracted: " + docIdIt.doc() +=
 " --> " +
> reader.document(docIdIt.doc()).getField("text").stringValue());
> =A0 =A0 =A0 =A0 =A0 =A0numDocs++;
> =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0assertEquals(3, numDocs);
>
> =A0 =A0 =A0 =A0IndexSearcher searcher =3D new IndexSearcher(reader);
> =A0 =A0 =A0 =A0TopDocs topDocs =3D searcher.search(new MatchAllDocsQuery(=
), filter,
> 10);
> =A0 =A0 =A0 =A0int totSearchDocs =3D topDocs.totalHits;
> =A0 =A0 =A0 =A0// assertEquals(3, totSearchDocs);
>
> =A0 =A0 =A0 =A0ScoreDoc[] hits =3D topDocs.scoreDocs;
> =A0 =A0 =A0 =A0System.out.println("\nSearcher extraction:");
> =A0 =A0 =A0 =A0for (ScoreDoc sd : hits) {
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println("Extracted: " + sd.doc + " --> =
" +
> reader.document(sd.doc).getField("text").stringValue());
> =A0 =A0 =A0 =A0}
>
> =A0 =A0}
>
> =A0 =A0private void createIndex1() throws CorruptIndexException,
> LockObtainFailedException, IOException {
>
> =A0 =A0 =A0 =A0IndexWriter writer =3D new IndexWriter(dir1, analyzer, tru=
e,
> MaxFieldLength.UNLIMITED);
>
> =A0 =A0 =A0 =A0Document doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "a", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "b", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "c", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "d", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "e", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0writer.optimize();
> =A0 =A0 =A0 =A0writer.close();
> =A0 =A0}
>
> =A0 =A0private void createIndex2() throws CorruptIndexException,
> LockObtainFailedException, IOException {
>
> =A0 =A0 =A0 =A0IndexWriter writer =3D new IndexWriter(dir2, analyzer, tru=
e,
> MaxFieldLength.UNLIMITED);
>
> =A0 =A0 =A0 =A0Document doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "x", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "y", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0doc =3D new Document();
> =A0 =A0 =A0 =A0doc.add(new Field("text", "z", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
> =A0 =A0 =A0 =A0writer.addDocument(doc);
>
> =A0 =A0 =A0 =A0writer.optimize();
> =A0 =A0 =A0 =A0writer.close();
> =A0 =A0}
>
> =A0 =A0private IndexReader getMultiReader() throws CorruptIndexException,
> IOException {
> =A0 =A0 =A0 =A0IndexReader[] subReaders =3D new IndexReader[] {
> IndexReader.open(dir1, false), IndexReader.open(dir2, false) };
> =A0 =A0 =A0 =A0MultiReader reader =3D new MultiReader(subReaders);
>
> =A0 =A0 =A0 =A0return (reader);
> =A0 =A0}
>
> =A0 =A0private class DocIdSetFilter extends Filter {
>
> =A0 =A0 =A0 =A0private static final long serialVersionUID =3D 1L;
>
> =A0 =A0 =A0 =A0private DocIdSet myBitset;
>
> =A0 =A0 =A0 =A0public DocIdSetFilter(DocIdSet bitset) {
> =A0 =A0 =A0 =A0 =A0 =A0this.myBitset =3D bitset;
> =A0 =A0 =A0 =A0}
>
> =A0 =A0 =A0 =A0@Override
> =A0 =A0 =A0 =A0public DocIdSet getDocIdSet(IndexReader reader) throws IOE=
xception {
> =A0 =A0 =A0 =A0 =A0 =A0return (this.myBitset);
> =A0 =A0 =A0 =A0}
>
> =A0 =A0}
>
> }
>
>
> In Lucene 2.4.1 the output is:
> Filter extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
>
> Searcher extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
>
> while in Lucene 2.9 I have:
> Filter extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
>
> Searcher extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
> Extracted: 7 --> z
>
>
> Is it a bug in the new Lucene searcher or am I missing something?
> Thanks,
>
> Bye
> Raf
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42576-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 12:31:32 2009
Return-Path: <java-user-return-42576-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6020 invoked from network); 2 Oct 2009 12:31:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 12:31:31 -0000
Received: (qmail 37337 invoked by uid 500); 2 Oct 2009 12:31:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37243 invoked by uid 500); 2 Oct 2009 12:31:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37233 invoked by uid 99); 2 Oct 2009 12:31:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 12:31:29 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 12:31:18 +0000
Received: by fxm2 with SMTP id 2so1036596fxm.28
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 05:30:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=Y9QZ2QYsYoUllZXHYp3/jU4mWbltllEinsKiDbSQXkw=;
        b=sVA092rWSA1fbI8MwiiBJLX4AVLuTirAwHh0pzURBjXDlQN21TLcfkfVwZ41uJjV3n
         bFEGubS84hZLEfjEm1FRtVFoDbovcA+ONw2Fs+G+xG0VZQfSTn334hT1UvP4iXNV+ZVc
         cg5qCX5UXaVUwa5hRvB64zh058aZNa4OadI4E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=JLSGJwWZNoL1jIF+P3PPJQ0iJMIPwlnIAMHgOdztdVEpUfLQRXEpl8CJqP6Rr6DKXJ
         5YnkkmNX8Fo0VfZc//XRndElDAgiqPIEUG/y26MvMUmFDzhDi+NouNV1CbszyYlO94xN
         IWOvLiuNdLg8BFSR459R9gNiiZ9m0Ya7PM8WI=
Received: by 10.86.169.25 with SMTP id r25mr2286203fge.17.1254486655939;
        Fri, 02 Oct 2009 05:30:55 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id d4sm746930fga.29.2009.10.02.05.30.54
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 02 Oct 2009 05:30:55 -0700 (PDT)
Message-ID: <4AC5F282.9000203@gmail.com>
Date: Fri, 02 Oct 2009 08:30:58 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Error using multireader searcher in Lucene 2.9
References: <70422ecc0910020409j632ac041gd66d923a3336f6ff@mail.gmail.com>
In-Reply-To: <70422ecc0910020409j632ac041gd66d923a3336f6ff@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Sorry Raf - technically your not allowed to use internal Lucene id's
that way. It happened to work in the past if you didn't use
MultiSearcher, but its not promised by the API, and no longer works as
you'd expect in 2.9.

You have to figure out another approach that doesn't use the internal
ids (eg assume id 0 is the first doc and that there is only one id 0
when building a filter - the filter has to just work respective to any
IndexReader given it - not make any assumptions about ids).

Raf wrote:
> Hello,
> I have tried to switch my application from Lucene 2.4.1 to Lucene 2.9, but I
> have found a problem.
> My searcher uses a MultiReader and, when I try to do a search using a custom
> filter based on a bitset, it does not behave as it did in Lucene 2.4.
> It looks like the new searcher does not use the "offset" when it reads the
> subreaders docIds...
>
> I have written a self-contained test to show the problem:
>
> import static org.junit.Assert.assertEquals;
> import java.io.IOException;
> import org.apache.lucene.analysis.Analyzer;
> import org.apache.lucene.analysis.WhitespaceAnalyzer;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.document.Field;
> import org.apache.lucene.index.CorruptIndexException;
> import org.apache.lucene.index.IndexReader;
> import org.apache.lucene.index.IndexWriter;
> import org.apache.lucene.index.MultiReader;
> import org.apache.lucene.index.IndexWriter.MaxFieldLength;
> import org.apache.lucene.search.DocIdSet;
> import org.apache.lucene.search.DocIdSetIterator;
> import org.apache.lucene.search.Filter;
> import org.apache.lucene.search.IndexSearcher;
> import org.apache.lucene.search.MatchAllDocsQuery;
> import org.apache.lucene.search.ScoreDoc;
> import org.apache.lucene.search.TopDocs;
> import org.apache.lucene.store.Directory;
> import org.apache.lucene.store.LockObtainFailedException;
> import org.apache.lucene.store.RAMDirectory;
> import org.apache.lucene.util.OpenBitSet;
> import org.junit.After;
> import org.junit.Before;
> import org.junit.Test;
>
> public class Lucene_2_9SearcherTest {
>
>     private Directory dir1 = new RAMDirectory();
>     private Directory dir2 = new RAMDirectory();
>     private Analyzer analyzer = new WhitespaceAnalyzer();
>
>     @Before
>     public void setUp() throws Exception {
>         this.createIndex1();
>         this.createIndex2();
>     }
>
>     @After
>     public void tearDown() throws Exception {
>     }
>
>     @Test
>     public void testSearchWithMultiReader() throws CorruptIndexException,
> IOException {
>
>         IndexReader reader = this.getMultiReader();
>
>         OpenBitSet bitSet = new OpenBitSet(10);
>         bitSet.fastSet(1);
>         bitSet.fastSet(2);
>         bitSet.fastSet(6);
>
>         Filter filter = new DocIdSetFilter(bitSet);
>
>         DocIdSetIterator docIdIt = filter.getDocIdSet(reader).iterator();
>         int numDocs = 0;
>         System.out.println("Filter extraction:");
>         while (docIdIt.next()) {
>             System.out.println("Extracted: " + docIdIt.doc() + " --> " +
> reader.document(docIdIt.doc()).getField("text").stringValue());
>             numDocs++;
>         }
>
>         assertEquals(3, numDocs);
>
>         IndexSearcher searcher = new IndexSearcher(reader);
>         TopDocs topDocs = searcher.search(new MatchAllDocsQuery(), filter,
> 10);
>         int totSearchDocs = topDocs.totalHits;
>         // assertEquals(3, totSearchDocs);
>
>         ScoreDoc[] hits = topDocs.scoreDocs;
>         System.out.println("\nSearcher extraction:");
>         for (ScoreDoc sd : hits) {
>             System.out.println("Extracted: " + sd.doc + " --> " +
> reader.document(sd.doc).getField("text").stringValue());
>         }
>
>     }
>
>     private void createIndex1() throws CorruptIndexException,
> LockObtainFailedException, IOException {
>
>         IndexWriter writer = new IndexWriter(dir1, analyzer, true,
> MaxFieldLength.UNLIMITED);
>
>         Document doc = new Document();
>         doc.add(new Field("text", "a", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         doc = new Document();
>         doc.add(new Field("text", "b", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         doc = new Document();
>         doc.add(new Field("text", "c", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         doc = new Document();
>         doc.add(new Field("text", "d", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         doc = new Document();
>         doc.add(new Field("text", "e", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         writer.optimize();
>         writer.close();
>     }
>
>     private void createIndex2() throws CorruptIndexException,
> LockObtainFailedException, IOException {
>
>         IndexWriter writer = new IndexWriter(dir2, analyzer, true,
> MaxFieldLength.UNLIMITED);
>
>         Document doc = new Document();
>         doc.add(new Field("text", "x", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         doc = new Document();
>         doc.add(new Field("text", "y", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         doc = new Document();
>         doc.add(new Field("text", "z", Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>         writer.addDocument(doc);
>
>         writer.optimize();
>         writer.close();
>     }
>
>     private IndexReader getMultiReader() throws CorruptIndexException,
> IOException {
>         IndexReader[] subReaders = new IndexReader[] {
> IndexReader.open(dir1, false), IndexReader.open(dir2, false) };
>         MultiReader reader = new MultiReader(subReaders);
>
>         return (reader);
>     }
>
>     private class DocIdSetFilter extends Filter {
>
>         private static final long serialVersionUID = 1L;
>
>         private DocIdSet myBitset;
>
>         public DocIdSetFilter(DocIdSet bitset) {
>             this.myBitset = bitset;
>         }
>
>         @Override
>         public DocIdSet getDocIdSet(IndexReader reader) throws IOException {
>             return (this.myBitset);
>         }
>
>     }
>
> }
>
>
> In Lucene 2.4.1 the output is:
> Filter extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
>
> Searcher extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
>
> while in Lucene 2.9 I have:
> Filter extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
>
> Searcher extraction:
> Extracted: 1 --> b
> Extracted: 2 --> c
> Extracted: 6 --> y
> Extracted: 7 --> z
>
>
> Is it a bug in the new Lucene searcher or am I missing something?
> Thanks,
>
> Bye
> Raf
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42577-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 12:59:25 2009
Return-Path: <java-user-return-42577-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21043 invoked from network); 2 Oct 2009 12:59:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 12:59:25 -0000
Received: (qmail 79464 invoked by uid 500); 2 Oct 2009 12:59:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79382 invoked by uid 500); 2 Oct 2009 12:59:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79372 invoked by uid 99); 2 Oct 2009 12:59:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 12:59:23 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 12:59:11 +0000
Received: by fxm2 with SMTP id 2so1060887fxm.28
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 05:58:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=JSs9fHUaKqXeXW1XY+wchnBEpu8/P5tjvCpm1aD8y7E=;
        b=hqGxILMr/iRiURsNvnuQ+duhIFIAQLu+ehvgc/ihpH0ICFiL0CHSjjWnmrl/bbp2US
         rAvyNC6iUSnl6hg5sqjqt6aam5fDaCFi8oZoM2E8XEclfNCbCdUaXqeErxa3s85bHiNd
         JfQIG5JkpICJq1VUQkwQEwHV+Adm+gLWWXwhQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=goCbZd6NGjM/Q4XcFGSC0uRkw6j+liwKQYAkMGxXB4BdC3F1trHfj7uPTIN5aeA3gL
         h9fbz4USe1/t4ZNsmd7vELNsGYs/+M17cmEJlMPiLZjdBzDfEJViHcE/s575Pp0hkr55
         g5nXxUKvTc35qd/6acX42uNlm8ydnH9juJwQ4=
Received: by 10.86.251.6 with SMTP id y6mr2290227fgh.24.1254488330923;
        Fri, 02 Oct 2009 05:58:50 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 3sm227414fge.27.2009.10.02.05.58.48
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 02 Oct 2009 05:58:49 -0700 (PDT)
Message-ID: <4AC5F907.307@gmail.com>
Date: Fri, 02 Oct 2009 08:58:47 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: TimeLimitedCollector hang on, VM process doesn't die (TOMCAT)
References: <4AC5BCCB.4010901@arisem.com>
In-Reply-To: <4AC5BCCB.4010901@arisem.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

That thread will only be stopped if its interrupted. So it would appear
there is a not a path that leads to it being interrupted ... why that is
would be the next question ...

-- 
- Mark

http://www.lucidimagination.com



Mani EZZAT wrote:
> Hello everyone.
> I'm using solrJ for an application deployed in Tomcat (6.x). It's base
> on lucene 2.9
> when I use the catalina stop command, the VM doesn't die.
>
> The problem seems to be the TimeLimitedCollector thread.
> Here a jstack trace of the JVM (I get the same thing with jconsole too) :
>
>
> Attaching to process ID 32430, please wait...
> Debugger attached successfully.
> Server compiler detected.
> JVM version is 1.5.0_17-b04
> Thread 32430: (state = BLOCKED)
>
>
> Thread 32530: (state = BLOCKED)
> - java.lang.Thread.sleep(long) @bci=0 (Interpreted frame)
> - org.apache.lucene.search.TimeLimitedCollector$TimerThread.run()
> @bci=15, line=79 (Interpreted frame)
>
>
> Thread 32481: (state = BLOCKED)
> - sun.misc.Unsafe.park(boolean, long) @bci=0 (Interpreted frame)
> - java.util.concurrent.locks.LockSupport.park() @bci=5, line=118
> (Interpreted frame)
> -
> java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await()
> @bci=41, line=1841 (Interpreted frame)
> - java.util.concurrent.LinkedBlockingQueue.take() @bci=29, line=359
> (Interpreted frame)
> - java.util.concurrent.ThreadPoolExecutor.getTask() @bci=47, line=470
> (Interpreted frame)
> - java.util.concurrent.ThreadPoolExecutor$Worker.run() @bci=18,
> line=674 (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32480: (state = BLOCKED)
> - sun.misc.Unsafe.park(boolean, long) @bci=0 (Interpreted frame)
> - java.util.concurrent.locks.LockSupport.park() @bci=5, line=118
> (Interpreted frame)
> -
> java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await()
> @bci=41, line=1841 (Interpreted frame)
> - java.util.concurrent.LinkedBlockingQueue.take() @bci=29, line=359
> (Interpreted frame)
> - java.util.concurrent.ThreadPoolExecutor.getTask() @bci=47, line=470
> (Interpreted frame)
> - java.util.concurrent.ThreadPoolExecutor$Worker.run() @bci=18,
> line=674 (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32470: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.ref.ReferenceQueue.remove(long) @bci=44, line=120
> (Interpreted frame)
> - java.lang.ref.ReferenceQueue.remove() @bci=2, line=136 (Interpreted
> frame)
> - org.apache.commons.io.FileCleaner$Reaper.run() @bci=8, line=206
> (Interpreted frame)
>
>
> Thread 32468: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
> - org.apache.tomcat.util.net.JIoEndpoint$Worker.await() @bci=8,
> line=416 (Interpreted frame)
> - org.apache.tomcat.util.net.JIoEndpoint$Worker.run() @bci=11,
> line=442 (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32466: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
> - org.apache.tomcat.util.net.JIoEndpoint$Worker.await() @bci=8,
> line=416 (Interpreted frame)
> - org.apache.tomcat.util.net.JIoEndpoint$Worker.run() @bci=11,
> line=442 (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32462: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
> -
> org.apache.jk.common.ChannelSocket.accept(org.apache.jk.core.MsgContext)
> @bci=20, line=300 (Interpreted frame)
> - org.apache.jk.common.ChannelSocket.acceptConnections() @bci=72,
> line=660 (Interpreted frame)
> -
> org.apache.jk.common.ChannelSocket$SocketAcceptor.runIt(java.lang.Object[])
> @bci=4, line=870 (Interpreted frame)
> - org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run()
> @bci=167, line=690 (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32458: (state = BLOCKED)
> - java.lang.Thread.sleep(long) @bci=0 (Interpreted frame)
> - org.apache.tomcat.util.net.JIoEndpoint$Acceptor.run() @bci=23,
> line=302 (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32444: (state = IN_NATIVE)
> - java.net.PlainSocketImpl.socketAccept(java.net.SocketImpl) @bci=0
> (Interpreted frame)
> - java.net.PlainSocketImpl.accept(java.net.SocketImpl) @bci=7,
> line=384 (Interpreted frame)
> - java.net.ServerSocket.implAccept(java.net.Socket) @bci=50, line=450
> (Interpreted frame)
> - java.net.ServerSocket.accept() @bci=48, line=421 (Interpreted frame)
> - sun.management.jmxremote.LocalRMIServerSocketFactory$1.accept()
> @bci=1, line=31 (Interpreted frame)
> - sun.rmi.transport.tcp.TCPTransport.run() @bci=59, line=340
> (Interpreted frame)
> - java.lang.Thread.run() @bci=11, line=595 (Interpreted frame)
>
>
> Thread 32443: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
> - java.util.TimerThread.mainLoop() @bci=28, line=483 (Interpreted frame)
> - java.util.TimerThread.run() @bci=1, line=462 (Interpreted frame)
>
>
> Thread 32438: (state = BLOCKED)
>
>
> Thread 32437: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.ref.ReferenceQueue.remove(long) @bci=44, line=120
> (Interpreted frame)
> - java.lang.ref.ReferenceQueue.remove() @bci=2, line=136 (Interpreted
> frame)
> - java.lang.ref.Finalizer$FinalizerThread.run() @bci=3, line=159
> (Interpreted frame)
>
>
> Thread 32436: (state = BLOCKED)
> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)
> - java.lang.Object.wait() @bci=2, line=474 (Interpreted frame)
> - java.lang.ref.Reference$ReferenceHandler.run() @bci=46, line=116
> (Interpreted frame)
>
>
> When I manually kill the lucene thread, the jvm exit.
>
> I'm using java 1.5.0.17 and debian lenny.
>
> I'm not sure if it's a Solr or Lucene problem...
>
> Best regards.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>





---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42578-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 13:05:22 2009
Return-Path: <java-user-return-42578-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23597 invoked from network); 2 Oct 2009 13:05:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 13:05:21 -0000
Received: (qmail 85889 invoked by uid 500); 2 Oct 2009 13:05:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85799 invoked by uid 500); 2 Oct 2009 13:05:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85789 invoked by uid 99); 2 Oct 2009 13:05:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 13:05:18 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mani.ezzat@arisem.com designates 192.93.160.42 as permitted sender)
Received: from [192.93.160.42] (HELO mail.arisem.com) (192.93.160.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 13:05:08 +0000
Message-ID: <4AC5FA61.3090104@arisem.com>
Date: Fri, 2 Oct 2009 15:04:33 +0200
From: Mani EZZAT <mani.ezzat@arisem.com>
User-Agent: Mozilla-Thunderbird 2.0.0.22 (X11/20090707)
MIME-Version: 1.0
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Subject: Re: TimeLimitedCollector hang on, VM process doesn't die (TOMCAT)
References: <4AC5BCCB.4010901@arisem.com> <4AC5F907.307@gmail.com>
In-Reply-To: <4AC5F907.307@gmail.com>
Content-Type: text/plain; charset="ISO-8859-1"; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Mark Miller wrote:
> That thread will only be stopped if its interrupted. So it would appear
> there is a not a path that leads to it being interrupted ... why that is
> would be the next question ...
>
>   
I found someone (a japanese) who had the same problem

http://d.hatena.ne.jp/knaka20blue/20090608

Do you think I should look at the SolR side ?

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42579-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 13:19:36 2009
Return-Path: <java-user-return-42579-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29060 invoked from network); 2 Oct 2009 13:19:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 13:19:36 -0000
Received: (qmail 8051 invoked by uid 500); 2 Oct 2009 13:19:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8025 invoked by uid 500); 2 Oct 2009 13:19:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8015 invoked by uid 99); 2 Oct 2009 13:19:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 13:19:33 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 72.14.220.156 as permitted sender)
Received: from [72.14.220.156] (HELO fg-out-1718.google.com) (72.14.220.156)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 13:19:22 +0000
Received: by fg-out-1718.google.com with SMTP id d23so2038326fga.5
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 06:19:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=/ey32bkhfwYIWa2aLn4IqNLYhwUPF0xJg4G9/PiHSN8=;
        b=s8y7m0+uOWk2nzO1go+QFiFBURV8RoeFHQQaku9NnZswY2YgA4qbiZVE0WOGdIXtey
         D45+UP1Jbwb5PPwMwuWP/g+sgiK8uZFvPD0HWsyGmnppDQ4sq49H9lkEAlVnUBxyjrSo
         draYdwJI3mnXh13OlhkWi7w42yn0cGkqcx16s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=mWdcq2ps7invGLR5gpqT45Vx/KO75lb34VwcpqFqfxsEyJ7tFWCxlvRYTRgzApCVtp
         7WAuCNuNao2SfTmtzs8qA7hUkKblAg41SWNPe4MzPNydIPdHFgYsRgOj74T0PIfv0dzD
         K72iVXlSl7SrC8f3rtHhTpIrZLwLPsTJPyJSg=
Received: by 10.86.13.7 with SMTP id 7mr2261988fgm.64.1254489542102;
        Fri, 02 Oct 2009 06:19:02 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id e20sm16608fga.25.2009.10.02.06.19.00
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 02 Oct 2009 06:19:00 -0700 (PDT)
Message-ID: <4AC5FDC3.80406@gmail.com>
Date: Fri, 02 Oct 2009 09:18:59 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: TimeLimitedCollector hang on, VM process doesn't die (TOMCAT)
References: <4AC5BCCB.4010901@arisem.com> <4AC5F907.307@gmail.com> <4AC5FA61.3090104@arisem.com>
In-Reply-To: <4AC5FA61.3090104@arisem.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Mani EZZAT wrote:
> Mark Miller wrote:
>> That thread will only be stopped if its interrupted. So it would appear
>> there is a not a path that leads to it being interrupted ... why that is
>> would be the next question ...
>>
>>   
> I found someone (a japanese) who had the same problem
>
> http://d.hatena.ne.jp/knaka20blue/20090608
>
> Do you think I should look at the SolR side ?
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
Actually, it may not be the TimeLimitedCollector thats keeping those
open. Since its a daemon thread, it shouldn't prevent shutdown even if
its not interrupted.

See that java.util.Timer way below? It's probably that. Know where it
comes from? By default they are not daemon threads, so its a likely
candidate ...

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42580-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 15:11:26 2009
Return-Path: <java-user-return-42580-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 66488 invoked from network); 2 Oct 2009 15:11:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 15:11:25 -0000
Received: (qmail 3254 invoked by uid 500); 2 Oct 2009 15:11:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3160 invoked by uid 500); 2 Oct 2009 15:11:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3150 invoked by uid 99); 2 Oct 2009 15:11:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 15:11:23 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ihasmax@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 15:11:14 +0000
Received: by fxm2 with SMTP id 2so1198394fxm.28
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 08:10:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=z4eEixdbVVkk5nJdF6ejvg2kLflEQHpos4E3geHeoVQ=;
        b=YEOn0/EBFEdQZIIE+JpKyuFxdKnFygBVfohDuBbayxv0kZV8o0xA4kOzElwir3ZWct
         B0lFVgPRHo6MaAGUWuudazmBpKmVBymfh1SUFoQ+TsGr1V8FElSxuQloXcwboBCPq1EV
         jsyTtu1cKPXaEbK+LsMeGUZd8Z+oP0YSjmj0g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=p9kO6/4iXDWBTE+wNRr1BNn59uGHoS4CIlidKXCCZkYy0sY3g6RL0FTHCqB9dx/BQA
         Wpo24CDwOkV2xnBHBaNHN9Rg1RN4KV3GGY9jy3hN3j/qXDNqDn2XrcDApa1z38+FVZ0D
         DJxMqzR+0wacJvYVAUbpnaZwgNZSZuT4TTugE=
MIME-Version: 1.0
Received: by 10.103.127.34 with SMTP id e34mr1017404mun.108.1254496253972; 
	Fri, 02 Oct 2009 08:10:53 -0700 (PDT)
Date: Fri, 2 Oct 2009 10:10:53 -0500
Message-ID: <3836ec640910020810t236410a0j78ccc788975a0915@mail.gmail.com>
Subject: FileNotFoundException on index
From: Max Lynch <ihasmax@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e65c7bf09710d80474f52b3f
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e65c7bf09710d80474f52b3f
Content-Type: text/plain; charset=ISO-8859-1

I'm getting this error when I try to run my searcher and my indexer:

Traceback (most recent call last):
self.searcher = lucene.IndexSearcher(self.directory)
JavaError: java.io.FileNotFoundException: /home/spider/misc/index/_275c.cfs
(No such file or directory)

I don't know anything about the format of the Lucene index, but I notice I
have several _275* files from b to j but no c.

Any ideas?

Thanks.

--0016e65c7bf09710d80474f52b3f--

From java-user-return-42581-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 15:42:40 2009
Return-Path: <java-user-return-42581-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76966 invoked from network); 2 Oct 2009 15:42:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 15:42:40 -0000
Received: (qmail 74786 invoked by uid 500); 2 Oct 2009 15:42:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74721 invoked by uid 500); 2 Oct 2009 15:42:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74711 invoked by uid 99); 2 Oct 2009 15:42:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 15:42:38 +0000
X-ASF-Spam-Status: No, hits=-1.1 required=10.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_SOFTFAIL
X-Spam-Check-By: apache.org
Received-SPF: softfail (nike.apache.org: transitioning domain of rnagalin@in.ibm.com does not designate 59.145.155.8 as permitted sender)
Received: from [59.145.155.8] (HELO e28smtp08.in.ibm.com) (59.145.155.8)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 15:42:25 +0000
Received: from d28relay01.in.ibm.com (d28relay01.in.ibm.com [9.184.220.58])
	by e28smtp08.in.ibm.com (8.14.3/8.13.1) with ESMTP id n92FXAiH020182
	for <java-user@lucene.apache.org>; Fri, 2 Oct 2009 21:03:10 +0530
Received: from d28av05.in.ibm.com (d28av05.in.ibm.com [9.184.220.67])
	by d28relay01.in.ibm.com (8.13.8/8.13.8/NCO v10.0) with ESMTP id n92Fg0ow1826920
	for <java-user@lucene.apache.org>; Fri, 2 Oct 2009 21:12:01 +0530
Received: from d28av05.in.ibm.com (loopback [127.0.0.1])
	by d28av05.in.ibm.com (8.14.3/8.13.1/NCO v10.0 AVout) with ESMTP id n92Fg06r000562
	for <java-user@lucene.apache.org>; Sat, 3 Oct 2009 01:42:00 +1000
Received: from d23ml172.in.ibm.com (d23ml172.in.ibm.com [9.124.105.37])
	by d28av05.in.ibm.com (8.14.3/8.13.1/NCO v10.0 AVin) with ESMTP id n92Fg0O2000559
	for <java-user@lucene.apache.org>; Sat, 3 Oct 2009 01:42:00 +1000
To: java-user@lucene.apache.org
MIME-Version: 1.0
Subject: lucene 2.4.1 : document in index but not returned in search
X-Mailer: Lotus Notes Release 7.0 HF277 June 21, 2006
Message-ID: <OFBBCFE1F7.65E5D603-ON65257643.00538592-65257643.00563C2F@in.ibm.com>
From: Rathinapriya Nagalingam <rnagalin@in.ibm.com>
Date: Fri, 2 Oct 2009 21:21:42 +0530
X-MIMETrack: Serialize by Router on d23ml172/23/M/IBM(Release 7.0.2FP3HF80 | July 14, 2008) at
 10/02/2009 21:21:45,
	Serialize complete at 10/02/2009 21:21:45
Content-Type: multipart/alternative; boundary="=_alternative 00563C2D65257643_="
X-Virus-Checked: Checked by ClamAV on apache.org

--=_alternative 00563C2D65257643_=
Content-Type: text/plain; charset="US-ASCII"

Hi,

I created an index of around 45000 documents. I search using Title and 
Abstract field. (Using lucene 2.4.1)
When I look in lukeall, some titles are available in index, but I dont get 
them when I search using title as keyword.
I have copied code snapshots below.

Recently we upgraded from lucene 2.0 to 2.4.1 and I am fairly new to 
lucene. Please let me know what could be the possible issue.

IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(),
                                                pCreate, 
IndexWriter.MaxFieldLength.UNLIMITED);

........................
SimpleAnalyzer cjkAnalyzer = new SimpleAnalyzer();
doc.add(new Field(LuceneDocument.TITLE_FIELD, pTitle, Field.Store.YES,
                                Field.Index.ANALYZED_NO_NORMS));

doc.add(new Field(LuceneDocument.ABSTRACT_FIELD, pDescription,
                                Field.Store.YES, Field.Index.
ANALYZED_NO_NORMS));
...............
if (localeStr.equals("zh_CN") || localeStr.equals("ko_KR")) { 
        writer.addDocument(doc, cjkAnalyzer);
} else {
        writer.addDocument(doc);
}


While searching the index, I use the analyser as below.

// construct the proper analyzer based on locale
                        if (pLocale.equals("zh_CN") || pLocale.equals(
"ko_KR")) { /* NOI18N */
                                analyzer = new SimpleAnalyzer();
                        } else {
                                analyzer = new StandardAnalyzer();
                        }
                        // analyze the keywords
                        ts = analyzer.tokenStream("abstract", 
//$NON-NLS-1$
                                        new StringReader(sb.toString()));
                        tokens = new ArrayList();
                        try {
                                while (true) {
                                        Token token = ts.next();
                                        if (token == null) {
                                                break;
                                        }
                                        tokens.add(token.termText());
                                }
                        } catch (IOException ex) {
                                Logger.logException(Logger.TYPE_ERR, this,
                                                "analyzeKeywords", ex); 
//$NON-NLS-1$ 
                        }

// Loop through the keywords
                                for (int i = 0; i < tokens.length; i++) {
                                        // Each keyword must be queried 
against the title and abstract.
                                        BooleanQuery bQuery = new 
BooleanQuery();
                                        TermQuery titleTerm = new 
TermQuery(
                                                        new Term("title", 
tokens[i])); //$NON-NLS-1$
                                        TermQuery abstractTerm = new 
TermQuery(new Term(
                                                        "abstract", 
tokens[i])); //$NON-NLS-1$
                                        if (keywordStatusListSize > i
                                                        && ((Boolean) 
keywordStatusList.get(i)).booleanValue()) {
                                                bQuery.add(titleTerm, 
BooleanClause.Occur.MUST);
                                                bQuery.add(abstractTerm, 
BooleanClause.Occur.MUST);
                                        } else {
                                                bQuery.add(titleTerm, 
BooleanClause.Occur.SHOULD);
                                                bQuery.add(abstractTerm, 
BooleanClause.Occur.SHOULD);
                                        }
                                        if (flag || ((Boolean) 
keywordStatusList.get(i)).booleanValue()) {
                                                keyQuery.add(bQuery, 
BooleanClause.Occur.MUST);
                                        } else {
                                                keyQuery.add(bQuery, 
BooleanClause.Occur.SHOULD);
                                        }
                                }

................................
CachingWrapperFilter cf;
Searcher searcher;
HitCollector collector;
................. some assignments...............
searcher.search(keyQuery, cf, collector);


Thanks & Regards,
Priya
PT-7A-012
Residency Road
Bangalore
India
Mob: 99011 22033

--=_alternative 00563C2D65257643_=--

From java-user-return-42582-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 16:53:03 2009
Return-Path: <java-user-return-42582-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92196 invoked from network); 2 Oct 2009 16:53:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 16:53:03 -0000
Received: (qmail 70401 invoked by uid 500); 2 Oct 2009 16:53:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70325 invoked by uid 500); 2 Oct 2009 16:53:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70315 invoked by uid 99); 2 Oct 2009 16:53:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 16:53:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 16:52:51 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MtlMs-0003GK-A3
	for java-user@lucene.apache.org; Fri, 02 Oct 2009 09:52:30 -0700
Message-ID: <25716741.post@talk.nabble.com>
Date: Fri, 2 Oct 2009 09:52:30 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: index reader for multiple indexes
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


hello all ,

       am merging more than one indexes to search a document , how do i use
IndexReader here to open multiple indexes? (since IndexReader will open one
directory at a time) could any1 please suggest me?


-- 
View this message in context: http://www.nabble.com/index-reader-for-multiple-indexes-tp25716741p25716741.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42583-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 17:12:47 2009
Return-Path: <java-user-return-42583-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97017 invoked from network); 2 Oct 2009 17:12:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 17:12:47 -0000
Received: (qmail 97123 invoked by uid 500); 2 Oct 2009 17:12:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97067 invoked by uid 500); 2 Oct 2009 17:12:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97057 invoked by uid 99); 2 Oct 2009 17:12:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 17:12:44 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.6.114.45] (HELO web1113.biz.mail.sk1.yahoo.com) (74.6.114.45)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 02 Oct 2009 17:12:33 +0000
Received: (qmail 37934 invoked by uid 60001); 2 Oct 2009 17:12:11 -0000
Message-ID: <479141.36605.qm@web1113.biz.mail.sk1.yahoo.com>
X-YMail-OSG: .j2yPZ8VM1ld1GP07Xf87S.jneWH1bjqOeOB4ZKIflp.w2RNqHI4D6PvDdF6Gm.1A5mvLyopLc.yWZhGLBV4JMtTGnc6CoR5SGbKAfQnCjsU.6ayEK6qzmcJQ2S.hckfj4xmXDr0yS4c.HhxQNQdyonKixcdT6_iIBxCfom14tiyS2ElcQ2tTOpSVFmyol0KwVZmaw9qBP_BD5GZeyAG8tzQ9l8FicdCwdnUzfYZnE7mXlissrKJ1XHgf9mEhdchKq1.YH4V6bwS4olMOd5jTKK2WrvNv8MUOlPs9UUHAFbP7EJjgwcILOx2hyztgFhHXiSIUp53ft10Si3rNZE8sbzwNKFSpL0LXn9CN4YS8f73sqHB0g--
Received: from [97.116.3.138] by web1113.biz.mail.sk1.yahoo.com via HTTP; Fri, 02 Oct 2009 10:12:11 PDT
X-Mailer: YahooMailRC/1358.21 YahooMailWebService/0.7.347.3
References: <OFBBCFE1F7.65E5D603-ON65257643.00538592-65257643.00563C2F@in.ibm.com>
Date: Fri, 2 Oct 2009 10:12:11 -0700 (PDT)
From: N Hira <nhira@cognocys.com>
Subject: Re: lucene 2.4.1 : document in index but not returned in search
To: java-user@lucene.apache.org
In-Reply-To: <OFBBCFE1F7.65E5D603-ON65257643.00538592-65257643.00563C2F@in.ibm.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Which analyzer do you use in luke?

The general practice is to use the same analyzer for indexing and searching.

Good luck.

-h



----- Original Message ----
From: Rathinapriya Nagalingam <rnagalin@in.ibm.com>
To: java-user@lucene.apache.org
Sent: Friday, October 2, 2009 10:51:42 AM
Subject: lucene 2.4.1 : document in index but not returned in search

Hi,

I created an index of around 45000 documents. I search using Title and 
Abstract field. (Using lucene 2.4.1)
When I look in lukeall, some titles are available in index, but I dont get 
them when I search using title as keyword.
I have copied code snapshots below.

Recently we upgraded from lucene 2.0 to 2.4.1 and I am fairly new to 
lucene. Please let me know what could be the possible issue.

IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(),
                                                pCreate, 
IndexWriter.MaxFieldLength.UNLIMITED);

........................
SimpleAnalyzer cjkAnalyzer = new SimpleAnalyzer();
doc.add(new Field(LuceneDocument.TITLE_FIELD, pTitle, Field.Store.YES,
                                Field.Index.ANALYZED_NO_NORMS));

doc.add(new Field(LuceneDocument.ABSTRACT_FIELD, pDescription,
                                Field.Store.YES, Field.Index.
ANALYZED_NO_NORMS));
...............
if (localeStr.equals("zh_CN") || localeStr.equals("ko_KR")) { 
        writer.addDocument(doc, cjkAnalyzer);
} else {
        writer.addDocument(doc);
}


While searching the index, I use the analyser as below.

// construct the proper analyzer based on locale
                        if (pLocale.equals("zh_CN") || pLocale.equals(
"ko_KR")) { /* NOI18N */
                                analyzer = new SimpleAnalyzer();
                        } else {
                                analyzer = new StandardAnalyzer();
                        }
                        // analyze the keywords
                        ts = analyzer.tokenStream("abstract", 
//$NON-NLS-1$
                                        new StringReader(sb.toString()));
                        tokens = new ArrayList();
                        try {
                                while (true) {
                                        Token token = ts.next();
                                        if (token == null) {
                                                break;
                                        }
                                        tokens.add(token.termText());
                                }
                        } catch (IOException ex) {
                                Logger.logException(Logger.TYPE_ERR, this,
                                                "analyzeKeywords", ex); 
//$NON-NLS-1$ 
                        }

// Loop through the keywords
                                for (int i = 0; i < tokens.length; i++) {
                                        // Each keyword must be queried 
against the title and abstract.
                                        BooleanQuery bQuery = new 
BooleanQuery();
                                        TermQuery titleTerm = new 
TermQuery(
                                                        new Term("title", 
tokens[i])); //$NON-NLS-1$
                                        TermQuery abstractTerm = new 
TermQuery(new Term(
                                                        "abstract", 
tokens[i])); //$NON-NLS-1$
                                        if (keywordStatusListSize > i
                                                        && ((Boolean) 
keywordStatusList.get(i)).booleanValue()) {
                                                bQuery.add(titleTerm, 
BooleanClause.Occur.MUST);
                                                bQuery.add(abstractTerm, 
BooleanClause.Occur.MUST);
                                        } else {
                                                bQuery.add(titleTerm, 
BooleanClause.Occur.SHOULD);
                                                bQuery.add(abstractTerm, 
BooleanClause.Occur.SHOULD);
                                        }
                                        if (flag || ((Boolean) 
keywordStatusList.get(i)).booleanValue()) {
                                                keyQuery.add(bQuery, 
BooleanClause.Occur.MUST);
                                        } else {
                                                keyQuery.add(bQuery, 
BooleanClause.Occur.SHOULD);
                                        }
                                }

................................
CachingWrapperFilter cf;
Searcher searcher;
HitCollector collector;
................. some assignments...............
searcher.search(keyQuery, cf, collector);


Thanks & Regards,
Priya
PT-7A-012
Residency Road
Bangalore
India
Mob: 99011 22033


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42584-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 17:13:37 2009
Return-Path: <java-user-return-42584-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97220 invoked from network); 2 Oct 2009 17:13:37 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 17:13:37 -0000
Received: (qmail 251 invoked by uid 500); 2 Oct 2009 17:13:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 179 invoked by uid 500); 2 Oct 2009 17:13:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 169 invoked by uid 99); 2 Oct 2009 17:13:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 17:13:35 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 17:13:24 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id E0CE345EE9D
	for <java-user@lucene.apache.org>; Fri,  2 Oct 2009 19:13:03 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id gsyBIxByx6ba for <java-user@lucene.apache.org>;
	Fri,  2 Oct 2009 19:12:53 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 844B945EE24
	for <java-user@lucene.apache.org>; Fri,  2 Oct 2009 19:12:53 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <25716741.post@talk.nabble.com>
Subject: RE: index reader for multiple indexes
Date: Fri, 2 Oct 2009 19:12:53 +0200
Message-ID: <DA6C7B02E59442FFB178186535E7D0FF@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcpDgNfdo8PO6uTdSGSbhMSvpXQ84QAAqhjA
In-Reply-To: <25716741.post@talk.nabble.com>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Use MultiReader which is an IndexReader on top of various Sub-IndexReaders.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: m.harig [mailto:m.harig@gmail.com]
> Sent: Friday, October 02, 2009 6:52 PM
> To: java-user@lucene.apache.org
> Subject: index reader for multiple indexes
> 
> 
> hello all ,
> 
>        am merging more than one indexes to search a document , how do i
> use
> IndexReader here to open multiple indexes? (since IndexReader will open
> one
> directory at a time) could any1 please suggest me?
> 
> 
> --
> View this message in context: http://www.nabble.com/index-reader-for-
> multiple-indexes-tp25716741p25716741.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42585-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 17:36:04 2009
Return-Path: <java-user-return-42585-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5035 invoked from network); 2 Oct 2009 17:36:04 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 17:36:04 -0000
Received: (qmail 29787 invoked by uid 500); 2 Oct 2009 17:36:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29729 invoked by uid 500); 2 Oct 2009 17:36:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29719 invoked by uid 99); 2 Oct 2009 17:36:02 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 17:36:02 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.175] (HELO mail-yw0-f175.google.com) (209.85.211.175)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 17:35:51 +0000
Received: by ywh5 with SMTP id 5so922351ywh.20
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 10:35:29 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.16.2 with SMTP id t2mr4789002ybi.176.1254504929358; Fri, 
	02 Oct 2009 10:35:29 -0700 (PDT)
In-Reply-To: <479141.36605.qm@web1113.biz.mail.sk1.yahoo.com>
References: <OFBBCFE1F7.65E5D603-ON65257643.00538592-65257643.00563C2F@in.ibm.com>
	 <479141.36605.qm@web1113.biz.mail.sk1.yahoo.com>
Date: Fri, 2 Oct 2009 14:35:29 -0300
Message-ID: <c4e715d70910021035r7e7c2923q1935e2f10d595bd0@mail.gmail.com>
Subject: Re: lucene 2.4.1 : document in index but not returned in search
From: Felipe Lobo <felipe@goshme.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd618f2aef3610474f73098
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd618f2aef3610474f73098
Content-Type: text/plain; charset=ISO-8859-1

I had similar problem, it was the score of the documents, they were 0, so
they didn't came when i searched!
Check your score docs!

On Fri, Oct 2, 2009 at 2:12 PM, N Hira <nhira@cognocys.com> wrote:

> Which analyzer do you use in luke?
>
> The general practice is to use the same analyzer for indexing and
> searching.
>
> Good luck.
>
> -h
>
>
>
> ----- Original Message ----
> From: Rathinapriya Nagalingam <rnagalin@in.ibm.com>
> To: java-user@lucene.apache.org
> Sent: Friday, October 2, 2009 10:51:42 AM
> Subject: lucene 2.4.1 : document in index but not returned in search
>
> Hi,
>
> I created an index of around 45000 documents. I search using Title and
> Abstract field. (Using lucene 2.4.1)
> When I look in lukeall, some titles are available in index, but I dont get
> them when I search using title as keyword.
> I have copied code snapshots below.
>
> Recently we upgraded from lucene 2.0 to 2.4.1 and I am fairly new to
> lucene. Please let me know what could be the possible issue.
>
> IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(),
>                                                pCreate,
> IndexWriter.MaxFieldLength.UNLIMITED);
>
> ........................
> SimpleAnalyzer cjkAnalyzer = new SimpleAnalyzer();
> doc.add(new Field(LuceneDocument.TITLE_FIELD, pTitle, Field.Store.YES,
>                                Field.Index.ANALYZED_NO_NORMS));
>
> doc.add(new Field(LuceneDocument.ABSTRACT_FIELD, pDescription,
>                                Field.Store.YES, Field.Index.
> ANALYZED_NO_NORMS));
> ...............
> if (localeStr.equals("zh_CN") || localeStr.equals("ko_KR")) {
>        writer.addDocument(doc, cjkAnalyzer);
> } else {
>        writer.addDocument(doc);
> }
>
>
> While searching the index, I use the analyser as below.
>
> // construct the proper analyzer based on locale
>                        if (pLocale.equals("zh_CN") || pLocale.equals(
> "ko_KR")) { /* NOI18N */
>                                analyzer = new SimpleAnalyzer();
>                        } else {
>                                analyzer = new StandardAnalyzer();
>                        }
>                        // analyze the keywords
>                        ts = analyzer.tokenStream("abstract",
> //$NON-NLS-1$
>                                        new StringReader(sb.toString()));
>                        tokens = new ArrayList();
>                        try {
>                                while (true) {
>                                        Token token = ts.next();
>                                        if (token == null) {
>                                                break;
>                                        }
>                                        tokens.add(token.termText());
>                                }
>                        } catch (IOException ex) {
>                                Logger.logException(Logger.TYPE_ERR, this,
>                                                "analyzeKeywords", ex);
> //$NON-NLS-1$
>                        }
>
> // Loop through the keywords
>                                for (int i = 0; i < tokens.length; i++) {
>                                        // Each keyword must be queried
> against the title and abstract.
>                                        BooleanQuery bQuery = new
> BooleanQuery();
>                                        TermQuery titleTerm = new
> TermQuery(
>                                                        new Term("title",
> tokens[i])); //$NON-NLS-1$
>                                        TermQuery abstractTerm = new
> TermQuery(new Term(
>                                                        "abstract",
> tokens[i])); //$NON-NLS-1$
>                                        if (keywordStatusListSize > i
>                                                        && ((Boolean)
> keywordStatusList.get(i)).booleanValue()) {
>                                                bQuery.add(titleTerm,
> BooleanClause.Occur.MUST);
>                                                bQuery.add(abstractTerm,
> BooleanClause.Occur.MUST);
>                                        } else {
>                                                bQuery.add(titleTerm,
> BooleanClause.Occur.SHOULD);
>                                                bQuery.add(abstractTerm,
> BooleanClause.Occur.SHOULD);
>                                        }
>                                        if (flag || ((Boolean)
> keywordStatusList.get(i)).booleanValue()) {
>                                                keyQuery.add(bQuery,
> BooleanClause.Occur.MUST);
>                                        } else {
>                                                keyQuery.add(bQuery,
> BooleanClause.Occur.SHOULD);
>                                        }
>                                }
>
> ................................
> CachingWrapperFilter cf;
> Searcher searcher;
> HitCollector collector;
> ................. some assignments...............
> searcher.search(keyQuery, cf, collector);
>
>
> Thanks & Regards,
> Priya
> PT-7A-012
> Residency Road
> Bangalore
> India
> Mob: 99011 22033
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Felipe Lobo
www.jusbrasil.com.br

--000e0cd618f2aef3610474f73098--

From java-user-return-42586-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 18:05:22 2009
Return-Path: <java-user-return-42586-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11948 invoked from network); 2 Oct 2009 18:05:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 18:05:22 -0000
Received: (qmail 78937 invoked by uid 500); 2 Oct 2009 18:05:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78860 invoked by uid 500); 2 Oct 2009 18:05:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78850 invoked by uid 99); 2 Oct 2009 18:05:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 18:05:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 18:05:09 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MtmUr-0006kX-0m
	for java-user@lucene.apache.org; Fri, 02 Oct 2009 11:04:49 -0700
Message-ID: <25719978.post@talk.nabble.com>
Date: Fri, 2 Oct 2009 11:04:49 -0700 (PDT)
From: Rajiv2 <rajiv.roopan@gmail.com>
To: java-user@lucene.apache.org
Subject: Lucene 2.9 Spatial Search Problem
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: rajiv.roopan@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hello, I was using Lucene 2.4 and locallucene in my app and upgraded to
lucene 2.9 and I'm using the new spatial contrib package. I've switched
everything from using the locallucene specific classes to using the lucene
spation classes for indexing and searching.  Everything compiles but I'm the
following error during search: 

java.lang.NumberFormatException: Invalid shift value in prefixCoded string
(is encoded value really a LONG?)
	at
org.apache.lucene.util.NumericUtils.prefixCodedToLong(NumericUtils.java:206)
	at org.apache.lucene.search.FieldCache$10.parseDouble(FieldCache.java:294)
	at
org.apache.lucene.search.FieldCacheImpl$DoubleCache.createValue(FieldCacheImpl.java:619)
	at
org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:208)
	at
org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:586)
	at
org.apache.lucene.search.FieldCacheImpl$DoubleCache.createValue(FieldCacheImpl.java:609)
	at
org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:208)
	at
org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:592)
	at
org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:580)
	at
org.apache.lucene.spatial.tier.LatLongDistanceFilter.getDocIdSet(LatLongDistanceFilter.java:68)
	at
org.apache.lucene.search.IndexSearcher.searchWithFilter(IndexSearcher.java:272)
	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:253)

Does anyone have any clue as to what the problem might be?

-- 
View this message in context: http://www.nabble.com/Lucene-2.9-Spatial-Search-Problem-tp25719978p25719978.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42587-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 18:07:57 2009
Return-Path: <java-user-return-42587-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12711 invoked from network); 2 Oct 2009 18:07:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 18:07:57 -0000
Received: (qmail 84875 invoked by uid 500); 2 Oct 2009 18:07:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84818 invoked by uid 500); 2 Oct 2009 18:07:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84808 invoked by uid 99); 2 Oct 2009 18:07:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 18:07:54 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.175] (HELO mail-yw0-f175.google.com) (209.85.211.175)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 18:07:44 +0000
Received: by ywh5 with SMTP id 5so945883ywh.20
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 11:07:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.127.36 with SMTP id z36mr4804766ybc.326.1254506842167; 
	Fri, 02 Oct 2009 11:07:22 -0700 (PDT)
In-Reply-To: <25719978.post@talk.nabble.com>
References: <25719978.post@talk.nabble.com>
Date: Fri, 2 Oct 2009 14:07:22 -0400
Message-ID: <9ac0c6aa0910021107m5ac7be89i5ca668da0730697f@mail.gmail.com>
Subject: Re: Lucene 2.9 Spatial Search Problem
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

The required format for contrib/spatial has changed to NumericField,
as of 2.9.  Are you building your index with NumericField?

Mike

On Fri, Oct 2, 2009 at 2:04 PM, Rajiv2 <rajiv.roopan@gmail.com> wrote:
>
> Hello, I was using Lucene 2.4 and locallucene in my app and upgraded to
> lucene 2.9 and I'm using the new spatial contrib package. I've switched
> everything from using the locallucene specific classes to using the lucen=
e
> spation classes for indexing and searching. =A0Everything compiles but I'=
m the
> following error during search:
>
> java.lang.NumberFormatException: Invalid shift value in prefixCoded strin=
g
> (is encoded value really a LONG?)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.util.NumericUtils.prefixCodedToLong(NumericUtils.java:2=
06)
> =A0 =A0 =A0 =A0at org.apache.lucene.search.FieldCache$10.parseDouble(Fiel=
dCache.java:294)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl$DoubleCache.createValue(FieldCach=
eImpl.java:619)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:208=
)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:58=
6)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl$DoubleCache.createValue(FieldCach=
eImpl.java:609)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:208=
)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:59=
2)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:58=
0)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.spatial.tier.LatLongDistanceFilter.getDocIdSet(LatLongD=
istanceFilter.java:68)
> =A0 =A0 =A0 =A0at
> org.apache.lucene.search.IndexSearcher.searchWithFilter(IndexSearcher.jav=
a:272)
> =A0 =A0 =A0 =A0at org.apache.lucene.search.IndexSearcher.search(IndexSear=
cher.java:253)
>
> Does anyone have any clue as to what the problem might be?
>
> --
> View this message in context: http://www.nabble.com/Lucene-2.9-Spatial-Se=
arch-Problem-tp25719978p25719978.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42588-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 19:16:19 2009
Return-Path: <java-user-return-42588-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34724 invoked from network); 2 Oct 2009 19:16:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 19:16:19 -0000
Received: (qmail 53705 invoked by uid 500); 2 Oct 2009 19:16:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53640 invoked by uid 500); 2 Oct 2009 19:16:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53630 invoked by uid 99); 2 Oct 2009 19:16:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 19:16:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.216.180 as permitted sender)
Received: from [209.85.216.180] (HELO mail-px0-f180.google.com) (209.85.216.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 19:16:05 +0000
Received: by pxi10 with SMTP id 10so1312881pxi.20
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 12:15:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=EHK35yxBgVWyctaSbJn7/2Mbm/3NgBHAaOtwxFmOjwo=;
        b=roAwLVAXM/Bf9M0TfbipqC0hFuw0FxPGoErxa2VKf6NmDn/CyP7NhWRjKX6VwJ4OYL
         KBWUlU7IhmFOYUn4CTN5YS9Nc6r7cV1ga4gFPaEtv61t3D2FBtsaGAv2VBPdGoV/4Dg+
         kZRGklp4E+dcK+lrIWX2xa6jgLix3YC8McVdE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=N+tazx5MhHuG8XJilC08g5ez/yY9MWVmkgtH8odogwaV61LU2l/DWi5G005okcVkar
         fH8f+P1Ga574MaOA2bfmD03Iyb1n2y7Nc0ymk7BaOayvTyFVtqMJVIFVfBt8c5j/10f9
         3HP2aErqW8F70h4xZRu4/HwBkldf+1WSN390c=
MIME-Version: 1.0
Received: by 10.115.133.16 with SMTP id k16mr4113842wan.151.1254510944127; 
	Fri, 02 Oct 2009 12:15:44 -0700 (PDT)
In-Reply-To: <c4e715d70910021035r7e7c2923q1935e2f10d595bd0@mail.gmail.com>
References: <OFBBCFE1F7.65E5D603-ON65257643.00538592-65257643.00563C2F@in.ibm.com> 
	<479141.36605.qm@web1113.biz.mail.sk1.yahoo.com> <c4e715d70910021035r7e7c2923q1935e2f10d595bd0@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Sat, 3 Oct 2009 00:45:24 +0530
Message-ID: <867513fe0910021215n261ba965yc45fa158ba4e9f0a@mail.gmail.com>
Subject: Re: lucene 2.4.1 : document in index but not returned in search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e648f088310c0d0474f8973a
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e648f088310c0d0474f8973a
Content-Type: text/plain; charset=ISO-8859-1

Hi Priya,
You are using different analyzers for searching and indexing in case of
CH/KR locales. Could you give the snippet of the doc you are trying to index
and search for. Also, get a print of keyQuery to get an idea of what exactly
is getting searched post (query)analysis. That might give a better picture.
@filipe : As far as my knowledge, A hit should be a non zero score anyways.
Correct me if I'm wrong :)
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Oct 2, 2009 at 11:05 PM, Felipe Lobo <felipe@goshme.com> wrote:

> I had similar problem, it was the score of the documents, they were 0, so
> they didn't came when i searched!
> Check your score docs!
>
> On Fri, Oct 2, 2009 at 2:12 PM, N Hira <nhira@cognocys.com> wrote:
>
> > Which analyzer do you use in luke?
> >
> > The general practice is to use the same analyzer for indexing and
> > searching.
> >
> > Good luck.
> >
> > -h
> >
> >
> >
> > ----- Original Message ----
> > From: Rathinapriya Nagalingam <rnagalin@in.ibm.com>
> > To: java-user@lucene.apache.org
> > Sent: Friday, October 2, 2009 10:51:42 AM
> > Subject: lucene 2.4.1 : document in index but not returned in search
> >
> > Hi,
> >
> > I created an index of around 45000 documents. I search using Title and
> > Abstract field. (Using lucene 2.4.1)
> > When I look in lukeall, some titles are available in index, but I dont
> get
> > them when I search using title as keyword.
> > I have copied code snapshots below.
> >
> > Recently we upgraded from lucene 2.0 to 2.4.1 and I am fairly new to
> > lucene. Please let me know what could be the possible issue.
> >
> > IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(),
> >                                                pCreate,
> > IndexWriter.MaxFieldLength.UNLIMITED);
> >
> > ........................
> > SimpleAnalyzer cjkAnalyzer = new SimpleAnalyzer();
> > doc.add(new Field(LuceneDocument.TITLE_FIELD, pTitle, Field.Store.YES,
> >                                Field.Index.ANALYZED_NO_NORMS));
> >
> > doc.add(new Field(LuceneDocument.ABSTRACT_FIELD, pDescription,
> >                                Field.Store.YES, Field.Index.
> > ANALYZED_NO_NORMS));
> > ...............
> > if (localeStr.equals("zh_CN") || localeStr.equals("ko_KR")) {
> >        writer.addDocument(doc, cjkAnalyzer);
> > } else {
> >        writer.addDocument(doc);
> > }
> >
> >
> > While searching the index, I use the analyser as below.
> >
> > // construct the proper analyzer based on locale
> >                        if (pLocale.equals("zh_CN") || pLocale.equals(
> > "ko_KR")) { /* NOI18N */
> >                                analyzer = new SimpleAnalyzer();
> >                        } else {
> >                                analyzer = new StandardAnalyzer();
> >                        }
> >                        // analyze the keywords
> >                        ts = analyzer.tokenStream("abstract",
> > //$NON-NLS-1$
> >                                        new StringReader(sb.toString()));
> >                        tokens = new ArrayList();
> >                        try {
> >                                while (true) {
> >                                        Token token = ts.next();
> >                                        if (token == null) {
> >                                                break;
> >                                        }
> >                                        tokens.add(token.termText());
> >                                }
> >                        } catch (IOException ex) {
> >                                Logger.logException(Logger.TYPE_ERR, this,
> >                                                "analyzeKeywords", ex);
> > //$NON-NLS-1$
> >                        }
> >
> > // Loop through the keywords
> >                                for (int i = 0; i < tokens.length; i++) {
> >                                        // Each keyword must be queried
> > against the title and abstract.
> >                                        BooleanQuery bQuery = new
> > BooleanQuery();
> >                                        TermQuery titleTerm = new
> > TermQuery(
> >                                                        new Term("title",
> > tokens[i])); //$NON-NLS-1$
> >                                        TermQuery abstractTerm = new
> > TermQuery(new Term(
> >                                                        "abstract",
> > tokens[i])); //$NON-NLS-1$
> >                                        if (keywordStatusListSize > i
> >                                                        && ((Boolean)
> > keywordStatusList.get(i)).booleanValue()) {
> >                                                bQuery.add(titleTerm,
> > BooleanClause.Occur.MUST);
> >                                                bQuery.add(abstractTerm,
> > BooleanClause.Occur.MUST);
> >                                        } else {
> >                                                bQuery.add(titleTerm,
> > BooleanClause.Occur.SHOULD);
> >                                                bQuery.add(abstractTerm,
> > BooleanClause.Occur.SHOULD);
> >                                        }
> >                                        if (flag || ((Boolean)
> > keywordStatusList.get(i)).booleanValue()) {
> >                                                keyQuery.add(bQuery,
> > BooleanClause.Occur.MUST);
> >                                        } else {
> >                                                keyQuery.add(bQuery,
> > BooleanClause.Occur.SHOULD);
> >                                        }
> >                                }
> >
> > ................................
> > CachingWrapperFilter cf;
> > Searcher searcher;
> > HitCollector collector;
> > ................. some assignments...............
> > searcher.search(keyQuery, cf, collector);
> >
> >
> > Thanks & Regards,
> > Priya
> > PT-7A-012
> > Residency Road
> > Bangalore
> > India
> > Mob: 99011 22033
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
>
> --
> Felipe Lobo
> www.jusbrasil.com.br
>

--0016e648f088310c0d0474f8973a--

From java-user-return-42589-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 19:42:52 2009
Return-Path: <java-user-return-42589-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42817 invoked from network); 2 Oct 2009 19:42:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 19:42:52 -0000
Received: (qmail 93404 invoked by uid 500); 2 Oct 2009 19:42:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93334 invoked by uid 500); 2 Oct 2009 19:42:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93324 invoked by uid 99); 2 Oct 2009 19:42:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 19:42:49 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 19:42:38 +0000
Received: by yxe30 with SMTP id 30so2130244yxe.29
        for <java-user@lucene.apache.org>; Fri, 02 Oct 2009 12:42:17 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.19.5 with SMTP id 5mr5068472ybs.103.1254512537012; Fri, 02 
	Oct 2009 12:42:17 -0700 (PDT)
In-Reply-To: <867513fe0910021215n261ba965yc45fa158ba4e9f0a@mail.gmail.com>
References: <OFBBCFE1F7.65E5D603-ON65257643.00538592-65257643.00563C2F@in.ibm.com>
	 <479141.36605.qm@web1113.biz.mail.sk1.yahoo.com>
	 <c4e715d70910021035r7e7c2923q1935e2f10d595bd0@mail.gmail.com>
	 <867513fe0910021215n261ba965yc45fa158ba4e9f0a@mail.gmail.com>
Date: Fri, 2 Oct 2009 16:42:16 -0300
Message-ID: <c4e715d70910021242o5d1fbd7au6e4849e74e3f4be2@mail.gmail.com>
Subject: Re: lucene 2.4.1 : document in index but not returned in search
From: Felipe Lobo <felipe@goshme.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd6c8b6228c490474f8f6d5
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd6c8b6228c490474f8f6d5
Content-Type: text/plain; charset=ISO-8859-1

Your are wright! The docs didn't came because the score was 0.
I had to review my boosting rules to fix it.


On Fri, Oct 2, 2009 at 4:15 PM, Anshum <anshumg@gmail.com> wrote:

> Hi Priya,
> You are using different analyzers for searching and indexing in case of
> CH/KR locales. Could you give the snippet of the doc you are trying to
> index
> and search for. Also, get a print of keyQuery to get an idea of what
> exactly
> is getting searched post (query)analysis. That might give a better picture.
> @filipe : As far as my knowledge, A hit should be a non zero score anyways.
> Correct me if I'm wrong :)
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Fri, Oct 2, 2009 at 11:05 PM, Felipe Lobo <felipe@goshme.com> wrote:
>
> > I had similar problem, it was the score of the documents, they were 0, so
> > they didn't came when i searched!
> > Check your score docs!
> >
> > On Fri, Oct 2, 2009 at 2:12 PM, N Hira <nhira@cognocys.com> wrote:
> >
> > > Which analyzer do you use in luke?
> > >
> > > The general practice is to use the same analyzer for indexing and
> > > searching.
> > >
> > > Good luck.
> > >
> > > -h
> > >
> > >
> > >
> > > ----- Original Message ----
> > > From: Rathinapriya Nagalingam <rnagalin@in.ibm.com>
> > > To: java-user@lucene.apache.org
> > > Sent: Friday, October 2, 2009 10:51:42 AM
> > > Subject: lucene 2.4.1 : document in index but not returned in search
> > >
> > > Hi,
> > >
> > > I created an index of around 45000 documents. I search using Title and
> > > Abstract field. (Using lucene 2.4.1)
> > > When I look in lukeall, some titles are available in index, but I dont
> > get
> > > them when I search using title as keyword.
> > > I have copied code snapshots below.
> > >
> > > Recently we upgraded from lucene 2.0 to 2.4.1 and I am fairly new to
> > > lucene. Please let me know what could be the possible issue.
> > >
> > > IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(),
> > >                                                pCreate,
> > > IndexWriter.MaxFieldLength.UNLIMITED);
> > >
> > > ........................
> > > SimpleAnalyzer cjkAnalyzer = new SimpleAnalyzer();
> > > doc.add(new Field(LuceneDocument.TITLE_FIELD, pTitle, Field.Store.YES,
> > >                                Field.Index.ANALYZED_NO_NORMS));
> > >
> > > doc.add(new Field(LuceneDocument.ABSTRACT_FIELD, pDescription,
> > >                                Field.Store.YES, Field.Index.
> > > ANALYZED_NO_NORMS));
> > > ...............
> > > if (localeStr.equals("zh_CN") || localeStr.equals("ko_KR")) {
> > >        writer.addDocument(doc, cjkAnalyzer);
> > > } else {
> > >        writer.addDocument(doc);
> > > }
> > >
> > >
> > > While searching the index, I use the analyser as below.
> > >
> > > // construct the proper analyzer based on locale
> > >                        if (pLocale.equals("zh_CN") || pLocale.equals(
> > > "ko_KR")) { /* NOI18N */
> > >                                analyzer = new SimpleAnalyzer();
> > >                        } else {
> > >                                analyzer = new StandardAnalyzer();
> > >                        }
> > >                        // analyze the keywords
> > >                        ts = analyzer.tokenStream("abstract",
> > > //$NON-NLS-1$
> > >                                        new
> StringReader(sb.toString()));
> > >                        tokens = new ArrayList();
> > >                        try {
> > >                                while (true) {
> > >                                        Token token = ts.next();
> > >                                        if (token == null) {
> > >                                                break;
> > >                                        }
> > >                                        tokens.add(token.termText());
> > >                                }
> > >                        } catch (IOException ex) {
> > >                                Logger.logException(Logger.TYPE_ERR,
> this,
> > >                                                "analyzeKeywords", ex);
> > > //$NON-NLS-1$
> > >                        }
> > >
> > > // Loop through the keywords
> > >                                for (int i = 0; i < tokens.length; i++)
> {
> > >                                        // Each keyword must be queried
> > > against the title and abstract.
> > >                                        BooleanQuery bQuery = new
> > > BooleanQuery();
> > >                                        TermQuery titleTerm = new
> > > TermQuery(
> > >                                                        new
> Term("title",
> > > tokens[i])); //$NON-NLS-1$
> > >                                        TermQuery abstractTerm = new
> > > TermQuery(new Term(
> > >                                                        "abstract",
> > > tokens[i])); //$NON-NLS-1$
> > >                                        if (keywordStatusListSize > i
> > >                                                        && ((Boolean)
> > > keywordStatusList.get(i)).booleanValue()) {
> > >                                                bQuery.add(titleTerm,
> > > BooleanClause.Occur.MUST);
> > >                                                bQuery.add(abstractTerm,
> > > BooleanClause.Occur.MUST);
> > >                                        } else {
> > >                                                bQuery.add(titleTerm,
> > > BooleanClause.Occur.SHOULD);
> > >                                                bQuery.add(abstractTerm,
> > > BooleanClause.Occur.SHOULD);
> > >                                        }
> > >                                        if (flag || ((Boolean)
> > > keywordStatusList.get(i)).booleanValue()) {
> > >                                                keyQuery.add(bQuery,
> > > BooleanClause.Occur.MUST);
> > >                                        } else {
> > >                                                keyQuery.add(bQuery,
> > > BooleanClause.Occur.SHOULD);
> > >                                        }
> > >                                }
> > >
> > > ................................
> > > CachingWrapperFilter cf;
> > > Searcher searcher;
> > > HitCollector collector;
> > > ................. some assignments...............
> > > searcher.search(keyQuery, cf, collector);
> > >
> > >
> > > Thanks & Regards,
> > > Priya
> > > PT-7A-012
> > > Residency Road
> > > Bangalore
> > > India
> > > Mob: 99011 22033
> > >
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
> >
> > --
> > Felipe Lobo
> > www.jusbrasil.com.br
> >
>



-- 
Felipe Lobo
www.jusbrasil.com.br

--000e0cd6c8b6228c490474f8f6d5--

From java-user-return-42590-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 02 20:07:35 2009
Return-Path: <java-user-return-42590-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54117 invoked from network); 2 Oct 2009 20:07:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 2 Oct 2009 20:07:34 -0000
Received: (qmail 49112 invoked by uid 500); 2 Oct 2009 20:07:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49047 invoked by uid 500); 2 Oct 2009 20:07:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49037 invoked by uid 99); 2 Oct 2009 20:07:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 20:07:32 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 02 Oct 2009 20:07:20 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id A4F3FD36003
	for <java-user@lucene.apache.org>; Fri,  2 Oct 2009 22:07:00 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id jwi287Ezhuxu for <java-user@lucene.apache.org>;
	Fri,  2 Oct 2009 22:06:50 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id CAFE5D36002
	for <java-user@lucene.apache.org>; Fri,  2 Oct 2009 22:06:49 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <25719978.post@talk.nabble.com>
Subject: RE: Lucene 2.9 Spatial Search Problem
Date: Fri, 2 Oct 2009 22:06:55 +0200
Message-ID: <9318745CDC8D45A497274EDBD22EEA99@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <25719978.post@talk.nabble.com>
Thread-Index: AcpDiu8hYKunaUq6RJi7+ghzL9/tqQAEK81Q
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Hallo Rajiv2,

The LocalLucene from Sourceforge is not index-compatible to the recently
added spatial contrib in Lucene. You have to reindex your spatial values
(because the index format now makes use of the new Lucene 2.9 NumericField,
which is now the standard for numeric fields).

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Rajiv2 [mailto:rajiv.roopan@gmail.com]
> Sent: Friday, October 02, 2009 8:05 PM
> To: java-user@lucene.apache.org
> Subject: Lucene 2.9 Spatial Search Problem
> 
> 
> Hello, I was using Lucene 2.4 and locallucene in my app and upgraded to
> lucene 2.9 and I'm using the new spatial contrib package. I've switched
> everything from using the locallucene specific classes to using the lucene
> spation classes for indexing and searching.  Everything compiles but I'm
> the
> following error during search:
> 
> java.lang.NumberFormatException: Invalid shift value in prefixCoded string
> (is encoded value really a LONG?)
> 	at
> org.apache.lucene.util.NumericUtils.prefixCodedToLong(NumericUtils.java:20
> 6)
> 	at
> org.apache.lucene.search.FieldCache$10.parseDouble(FieldCache.java:294)
> 	at
> org.apache.lucene.search.FieldCacheImpl$DoubleCache.createValue(FieldCache
> Impl.java:619)
> 	at
> org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:208)
> 	at
> org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:586
> )
> 	at
> org.apache.lucene.search.FieldCacheImpl$DoubleCache.createValue(FieldCache
> Impl.java:609)
> 	at
> org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:208)
> 	at
> org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:592
> )
> 	at
> org.apache.lucene.search.FieldCacheImpl.getDoubles(FieldCacheImpl.java:580
> )
> 	at
> org.apache.lucene.spatial.tier.LatLongDistanceFilter.getDocIdSet(LatLongDi
> stanceFilter.java:68)
> 	at
> org.apache.lucene.search.IndexSearcher.searchWithFilter(IndexSearcher.java
> :272)
> 	at
> org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:253)
> 
> Does anyone have any clue as to what the problem might be?
> 
> --
> View this message in context: http://www.nabble.com/Lucene-2.9-Spatial-
> Search-Problem-tp25719978p25719978.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42591-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 03 03:18:54 2009
Return-Path: <java-user-return-42591-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64440 invoked from network); 3 Oct 2009 03:18:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 3 Oct 2009 03:18:53 -0000
Received: (qmail 88701 invoked by uid 500); 3 Oct 2009 03:18:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88522 invoked by uid 500); 3 Oct 2009 03:18:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 88503 invoked by uid 99); 3 Oct 2009 03:18:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Oct 2009 03:18:49 +0000
X-ASF-Spam-Status: No, hits=1.8 required=10.0
	tests=SPF_PASS,SUBJ_ALL_CAPS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of crackeur@comcast.net designates 76.96.30.24 as permitted sender)
Received: from [76.96.30.24] (HELO QMTA02.emeryville.ca.mail.comcast.net) (76.96.30.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Oct 2009 03:18:36 +0000
Received: from OMTA12.emeryville.ca.mail.comcast.net ([76.96.30.44])
	by QMTA02.emeryville.ca.mail.comcast.net with comcast
	id o3EX1c0080x6nqcA23JGob; Sat, 03 Oct 2009 03:18:16 +0000
Received: from your55e5f9e3d2 ([98.210.220.153])
	by OMTA12.emeryville.ca.mail.comcast.net with comcast
	id o3JF1c0053KArd68Y3JFo8; Sat, 03 Oct 2009 03:18:15 +0000
Message-ID: <00a601ca43d8$2355e870$0402a8c0@your55e5f9e3d2>
From: "jimmy Zhang" <crackeur@comcast.net>
To: <java-user@lucene.apache.org>
References: <25719978.post@talk.nabble.com> <9318745CDC8D45A497274EDBD22EEA99@VEGA>
Subject: [ANN] VTD-XML 2.7
Date: Fri, 2 Oct 2009 20:18:11 -0700
MIME-Version: 1.0
Content-Type: text/plain;
	format=flowed;
	charset="iso-8859-1";
	reply-type=original
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.3598
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.3350
X-Virus-Checked: Checked by ClamAV on apache.org

VTD-XML 2.7 is released and can be downloaded at
http://sourceforge.net/projects/vtd-xml/files/

Below is a summary of what are the new features and enhancements.

Expanded VTD-XML's Core API

* VTDNav: toStringUpperCase, toStringLowerCase, contains(), endsWith(),
startsWith()
* Extended VTD added in-memory buffer support

Improved Xpath

* added the following XPath 2.0 functions: abs(), ends-with(), upper-case(),
lower-case()
* added support for variable reference
* significantly enhanced XPath syntax, checking error reporting (Special
thanks to Mark Swanson)
* Internal performance tuning

Bug fixes and Code Enhancement

* C version significantly removed warning message, fix memory leak during
Xpath expression parsing,
* Various bug fies (Special thanks to Jon Roberts, John Zhu, Matej Spiller,
Steve Polson, and Romain La Tellier) 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42592-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 03 06:40:44 2009
Return-Path: <java-user-return-42592-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27182 invoked from network); 3 Oct 2009 06:40:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 3 Oct 2009 06:40:44 -0000
Received: (qmail 61255 invoked by uid 500); 3 Oct 2009 06:40:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61194 invoked by uid 500); 3 Oct 2009 06:40:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61184 invoked by uid 99); 3 Oct 2009 06:40:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Oct 2009 06:40:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Oct 2009 06:40:30 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MtyHp-0001Jd-NA
	for java-user@lucene.apache.org; Fri, 02 Oct 2009 23:40:09 -0700
Message-ID: <25726159.post@talk.nabble.com>
Date: Fri, 2 Oct 2009 23:40:09 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: RE: index reader for multiple indexes
In-Reply-To: <DA6C7B02E59442FFB178186535E7D0FF@VEGA>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
References: <25716741.post@talk.nabble.com> <DA6C7B02E59442FFB178186535E7D0FF@VEGA>
X-Virus-Checked: Checked by ClamAV on apache.org


Thanks Uwe Schindler ,

      If i use an IndexReader[] to use MultiReader  , will it be thread
safe? because i've to reopen my IndexReader to check whether my index is
updated or not . In this case how do i handle it? please suggest me



Uwe Schindler wrote:
> 
> Use MultiReader which is an IndexReader on top of various
> Sub-IndexReaders.
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
>> -----Original Message-----
>> From: m.harig [mailto:m.harig@gmail.com]
>> Sent: Friday, October 02, 2009 6:52 PM
>> To: java-user@lucene.apache.org
>> Subject: index reader for multiple indexes
>> 
>> 
>> hello all ,
>> 
>>        am merging more than one indexes to search a document , how do i
>> use
>> IndexReader here to open multiple indexes? (since IndexReader will open
>> one
>> directory at a time) could any1 please suggest me?
>> 
>> 
>> --
>> View this message in context: http://www.nabble.com/index-reader-for-
>> multiple-indexes-tp25716741p25716741.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>> 
>> 
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/index-reader-for-multiple-indexes-tp25716741p25726159.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42593-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 03 22:25:59 2009
Return-Path: <java-user-return-42593-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33983 invoked from network); 3 Oct 2009 22:25:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 3 Oct 2009 22:25:59 -0000
Received: (qmail 66031 invoked by uid 500); 3 Oct 2009 22:25:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65953 invoked by uid 500); 3 Oct 2009 22:25:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65940 invoked by uid 99); 3 Oct 2009 22:25:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Oct 2009 22:25:56 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.66] (HELO homiemail-a15.g.dreamhost.com) (208.97.132.66)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 03 Oct 2009 22:25:45 +0000
Received: from [172.16.58.203] (unknown [70.158.103.11])
	by homiemail-a15.g.dreamhost.com (Postfix) with ESMTPA id 91D4676C065
	for <java-user@lucene.apache.org>; Sat,  3 Oct 2009 15:25:23 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: document diversity
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
Date: Sat, 3 Oct 2009 18:25:23 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <84F2545D-14D5-4CDC-A27A-F951ABAE2E74@apache.org>
References: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

I'm curious, can you elaborate more on the deeper use case for this?

Perhaps just implementing faceting on doc type would be sufficient?   
That way users can drill in on doc type.  Alternatively, I suppose you  
could implement a hit collector that accesses a field cache on the doc  
type field and promotes lesser seen doc types until they are evenly  
represented.  Could also likely write a Function query that does a  
similar thing.  I'd imagine you need to be careful to control your  
memory.

-Grant

On Oct 1, 2009, at 12:56 PM, Michael Masters wrote:

> I was wondering if there is any way to control what kind of documents
> are returned from a search. For example, lets say we have an index
> built from different types of documents (pdf, txt, html, etc.). Is
> there a way to have the first x results have a specified distribution
> of document types? It would be nice to have an even number of results
> that are from pdfs, txt files, and html files.
>
>
> Any help would greatly be appreciated.
>
>
> -Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42594-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 04 11:23:25 2009
Return-Path: <java-user-return-42594-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68675 invoked from network); 4 Oct 2009 11:23:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 4 Oct 2009 11:23:25 -0000
Received: (qmail 57397 invoked by uid 500); 4 Oct 2009 11:23:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57309 invoked by uid 500); 4 Oct 2009 11:23:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57294 invoked by uid 99); 4 Oct 2009 11:23:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 04 Oct 2009 11:23:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of shashi.mit@gmail.com designates 209.85.216.180 as permitted sender)
Received: from [209.85.216.180] (HELO mail-px0-f180.google.com) (209.85.216.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 04 Oct 2009 11:23:12 +0000
Received: by pxi10 with SMTP id 10so2162837pxi.20
        for <java-user@lucene.apache.org>; Sun, 04 Oct 2009 04:22:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:received:from:date
         :x-google-sender-auth:message-id:subject:to:content-type;
        bh=ycDJzL9O4nDLQwYJd5Ad4UuR8J9OI2lbMhlo5ggX3b0=;
        b=l/4KJbSkaWdAhdWH6OCICme06N9z+/zMJtEDtCv7uOMXCTfum1bDWwYxtPhfdI6tFm
         l0Kn5k1JaAfwFAeP6kgKl/waKLfE6FNHs51rti+nmxb0oVW9p9iERwm1yXnekfRBchaw
         NU+ypBpD/VkrUwSVkZESKIzNdnAbzM/RKBW3I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:from:date:x-google-sender-auth:message-id
         :subject:to:content-type;
        b=VHDZN3ZDcX5rRKO9JfocRCOHteCKofKYQzB1nm6wbRqFyiReGThJqFLwXwIVo3CL/c
         Tby0IW0grhRwsH2BCZke0NnXsGAO7ZkjmjaMUwlIr8zqb0HtMq1C7k1S/1SXOz65g4GJ
         n8983LLqKuMWrfjaDMFCauSb5LwGorb9YJ6rw=
MIME-Version: 1.0
Sender: shashi.mit@gmail.com
Received: by 10.114.2.19 with SMTP id 19mr7075793wab.26.1254655371180; Sun, 04 
	Oct 2009 04:22:51 -0700 (PDT)
From: Shashi Kant <skant@sloan.mit.edu>
Date: Sun, 4 Oct 2009 07:22:31 -0400
X-Google-Sender-Auth: e10974ea27facc1a
Message-ID: <4d19a3630910040422y690e1a9br3fcab77deabe002@mail.gmail.com>
Subject: NAS/SAN Devices (slightly off-topic)
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

Apologies this is not a Lucene question per se...however I am in need
of some sage advice... We anticipate our indices to be very large (on
the order of a a few TB each)., and there will be 5-10 of them. Hence
we are looking at NAS or SANs with 15-20TB storage.

My questions;

1. Any recommendations on hosting providers (US/Canada based) that
provide storage on such scale? If you are not comfortable sharing
online, please email me offline. I promise to keep it confidential.

2. Any "lessons learned" when working with such large indices? Of
course, I will do my homework, but any "Must-Do"s & "Never Do"s on
configurations that jump out, would save us all some sweat and tears.

Thanks all!
Shashi

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42595-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 04 22:43:03 2009
Return-Path: <java-user-return-42595-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93493 invoked from network); 4 Oct 2009 22:43:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 4 Oct 2009 22:43:03 -0000
Received: (qmail 83411 invoked by uid 500); 4 Oct 2009 22:43:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83349 invoked by uid 500); 4 Oct 2009 22:43:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83315 invoked by uid 99); 4 Oct 2009 22:42:46 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 04 Oct 2009 22:42:46 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 04 Oct 2009 22:42:35 +0000
Received: by ywh15 with SMTP id 15so2250212ywh.5
        for <java-user@lucene.apache.org>; Sun, 04 Oct 2009 15:41:14 -0700 (PDT)
MIME-Version: 1.0
Sender: felipe@goshme.com
Received: by 10.150.32.21 with SMTP id f21mr8667239ybf.225.1254696074279; Sun, 
	04 Oct 2009 15:41:14 -0700 (PDT)
Date: Sun, 4 Oct 2009 19:41:14 -0300
X-Google-Sender-Auth: ca190b4f4403eb34
Message-ID: <c4e715d70910041541p5fc3355ak38e7dd8d683d7a3d@mail.gmail.com>
Subject: Duplicate documents
From: Felipe Lobo <felipe@jusbrasil.com.br>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151757374acefa53047523b100
X-Virus-Checked: Checked by ClamAV on apache.org

--00151757374acefa53047523b100
Content-Type: text/plain; charset=ISO-8859-1

Hi, i'm having some problem on my search process, because my search results
are being duplicated(but is not duplicated on the index, i checked with
luke).
I checked the id of the results and one exist on the index and the other is
out of the range(like my index has 300 documents, one result has id 35[OK]
and the other has 350[?]).
I'm using ParallelMultiSearcher, because my app runs in a server where the
index is distributed(big index), but this duplication happens when i'm
running local on my machine without distributed index!

thanks,

-- 
Felipe Lobo
www.jusbrasil.com.br

--00151757374acefa53047523b100--

From java-user-return-42596-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 08:19:36 2009
Return-Path: <java-user-return-42596-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12351 invoked from network); 5 Oct 2009 08:19:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 08:19:35 -0000
Received: (qmail 27536 invoked by uid 500); 5 Oct 2009 08:19:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27431 invoked by uid 500); 5 Oct 2009 08:19:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27421 invoked by uid 99); 5 Oct 2009 08:19:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 08:19:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mani.ezzat@arisem.com designates 192.93.160.42 as permitted sender)
Received: from [192.93.160.42] (HELO mail.arisem.com) (192.93.160.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 08:19:22 +0000
Message-ID: <4AC9ABD3.5020003@arisem.com>
Date: Mon, 5 Oct 2009 10:18:27 +0200
From: Mani EZZAT <mani.ezzat@arisem.com>
User-Agent: Mozilla-Thunderbird 2.0.0.22 (X11/20090707)
MIME-Version: 1.0
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Subject: Re: TimeLimitedCollector hang on, VM process doesn't die (TOMCAT)
References: <4AC5BCCB.4010901@arisem.com> <4AC5F907.307@gmail.com> <4AC5FA61.3090104@arisem.com> <4AC5FDC3.80406@gmail.com>
In-Reply-To: <4AC5FDC3.80406@gmail.com>
Content-Type: text/plain; charset="ISO-8859-1"; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Mark Miller wrote:
> Mani EZZAT wrote:
>   
>> Mark Miller wrote:
>>     
>>> That thread will only be stopped if its interrupted. So it would appear
>>> there is a not a path that leads to it being interrupted ... why that is
>>> would be the next question ...
>>>
>>>   
>>>       
>> I found someone (a japanese) who had the same problem
>>
>> http://d.hatena.ne.jp/knaka20blue/20090608
>>
>> Do you think I should look at the SolR side ?
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>     
> Actually, it may not be the TimeLimitedCollector thats keeping those
> open. Since its a daemon thread, it shouldn't prevent shutdown even if
> its not interrupted.
>
> See that java.util.Timer way below? It's probably that. Know where it
> comes from? By default they are not daemon threads, so its a likely
> candidate ...
>
>   
This thread is also a deamon.
But I know which thread cause this and I don't think it's lucene related :)
Thank you for your time

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42597-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 08:22:54 2009
Return-Path: <java-user-return-42597-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13268 invoked from network); 5 Oct 2009 08:22:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 08:22:53 -0000
Received: (qmail 37339 invoked by uid 500); 5 Oct 2009 08:22:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37276 invoked by uid 500); 5 Oct 2009 08:22:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37266 invoked by uid 99); 5 Oct 2009 08:22:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 08:22:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of olemartin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 08:22:39 +0000
Received: by ewy19 with SMTP id 19so2603867ewy.28
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 01:21:19 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=Zo5J3oWR0elC/hHkbBZpf2uUTZ/NcjpaE3ZIhWiGB0c=;
        b=IgsHBPpPiO7ok152lXaDd3AhZFiUCznhdOoZSJjqtMZd2q4G1OHPHLreVMpBYOepWb
         MsoMDv0GowkzlCAnQTTSfybAcEovoyF/hWMptyZYcNEaU+wNi4pjEt0qqACvi30lmbQ4
         uTk6XnVNbUEBkwFUPTiYjEZ5isKrHLqNUrqqY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=KzlIyEFkX4i1FxLmwFvT+nzooJUNEMwKdw/iOMkMIfPPCDSSUpIBGszAVBAk/7lowS
         +8TIVkqa3fQhZHEpcxcdhIg31iKZ2nSngao4FeJPM9/CLmxNHaB111rQGF8bV2l4/YMS
         4o0CQ1LG1DSo4fFgbLLXA/8EIN5zxW8wgNYDM=
MIME-Version: 1.0
Received: by 10.216.22.147 with SMTP id t19mr951404wet.174.1254730879363; Mon, 
	05 Oct 2009 01:21:19 -0700 (PDT)
Date: Mon, 5 Oct 2009 10:21:19 +0200
Message-ID: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
Subject: Help understanding fieldNorm
From: =?ISO-8859-1?Q?Ole=2DMartin_M=F8rk?= <olemartin@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364d21295a6aa704752bccd6
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364d21295a6aa704752bccd6
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi. I am trying to understand Lucene's scoring algorithm. We're
getting some strange results. First we search for a given page by it's
url. We get this result:

0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), product of:
  1.0 =3D tf(phraseFreq=3D1.0)
  32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
something=3D2 something=3D44 704290075=3D1)
  4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)

When this is done, we use solrJ to read and write the document. The
only change is the title of the document (appends the number 2)

We search again and the fieldNorm is changed significantly:

9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of:
  1.0 =3D tf(phraseFreq=3D1.0)
  31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457
something=3D3 somthing=3D45 704290075=3D2)
  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)

Why does the value of fieldNorm change so much?

Looking forward to your answers.

--
Ole-Martin M=F8rk
http://twitter.com/olemartin
http://flickr.com/olemartin

--0016364d21295a6aa704752bccd6--

From java-user-return-42598-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 09:15:58 2009
Return-Path: <java-user-return-42598-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24215 invoked from network); 5 Oct 2009 09:15:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 09:15:58 -0000
Received: (qmail 94215 invoked by uid 500); 5 Oct 2009 09:15:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94132 invoked by uid 500); 5 Oct 2009 09:15:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94122 invoked by uid 99); 5 Oct 2009 09:15:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:15:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:15:43 +0000
Received: by bwz22 with SMTP id 22so2421627bwz.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 02:15:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=fQo1kHZodtj0Eha5swAQs57rZRWO+H21xxNV6GbmHqY=;
        b=G2lWAxJ6QuOUMsHCfbKEsJSpph5+6ZLodw7DMKcxqCktCtET4raeeUbw8dOfz0Y2Xp
         hNd/Ovqdc5XCUZhtVBqmEdJO6RJmuuP8eQVZf+holBczmVZmSPfXAXmza4VRs5nGMPgd
         fLqtMzc52JR2N1begKcKmGY/SaYIdPnt0OsXM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=MoA0sF1RKx3B7TGmxA+tgy21YsgyXXLjn+mwNoZ3SMq8sluvUJNcK11l+zBwzqNCIJ
         ukyNMjcTPmfgLODmFo0TKNlN4K0NrNamWXRATC14cdyNhaJVLOiR2awm85OXm7IOcn/a
         N1ASn7Q8udsBhfND4rOv/buCCwkuV+zDbC4ro=
MIME-Version: 1.0
Received: by 10.239.183.26 with SMTP id s26mr508999hbg.179.1254734122926; Mon, 
	05 Oct 2009 02:15:22 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
Date: Mon, 5 Oct 2009 11:15:22 +0200
Message-ID: <f18c9dde0910050215x49bfde2cja4636392518a0f74@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f7bf1aaf444604752c8df4
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f7bf1aaf444604752c8df4
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Did you change any boost values for URL field or document while reindexing
the document by any chance? Or do you look at different documents - one is
internal id 0 and other is internal id 22 - this could be the updated one
just curious if that might be the cause?!

simon

On Mon, Oct 5, 2009 at 10:21 AM, Ole-Martin M=C3=B8rk <olemartin@gmail.com>=
wrote:

> Hi. I am trying to understand Lucene's scoring algorithm. We're
> getting some strange results. First we search for a given page by it's
> url. We get this result:
>
> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), product o=
f:
>  1.0 =3D tf(phraseFreq=3D1.0)
>  32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
> something=3D2 something=3D44 704290075=3D1)
>  4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>
> When this is done, we use solrJ to read and write the document. The
> only change is the title of the document (appends the number 2)
>
> We search again and the fieldNorm is changed significantly:
>
> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of:
>  1.0 =3D tf(phraseFreq=3D1.0)
>  31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457
> something=3D3 somthing=3D45 704290075=3D2)
>  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>
> Why does the value of fieldNorm change so much?
>
> Looking forward to your answers.
>
> --
> Ole-Martin M=C3=B8rk
> http://twitter.com/olemartin
> http://flickr.com/olemartin
>

--001485f7bf1aaf444604752c8df4--

From java-user-return-42599-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 09:32:43 2009
Return-Path: <java-user-return-42599-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28857 invoked from network); 5 Oct 2009 09:32:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 09:32:43 -0000
Received: (qmail 10612 invoked by uid 500); 5 Oct 2009 09:32:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10521 invoked by uid 500); 5 Oct 2009 09:32:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10511 invoked by uid 99); 5 Oct 2009 09:32:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:32:41 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of olemartin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:32:28 +0000
Received: by ewy19 with SMTP id 19so2648925ewy.28
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 02:31:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=PjUowPA1nJzzk4/5kN1Qf9MB1cJhvukvLZmjup7OaP4=;
        b=bLGqYXLJfZDBFshrCPzjuyoziNKVvcn+aAh5CL84JC+7y85jnE9j9MMBQ7Tob1G1WV
         k2R+X8OJSJnGfqDDO4iAi63x9mWJAGLAzIf703AmS97Nm/mChxfVwlOjiyPzJ384a75C
         jIuqoIETRRYefA3gmjh4CDxTlRmw7YoHfwQCE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=qcJ9VIZNiZRU5hnxxuyBi7F9A9gqyQBkAOvRWKqo9AhuCWF55jq6GrQDa7V3u/fMom
         ig+vwx2/aAlfKXTX2dqoMYJXQE57977vni98bNofGaeXIgY5CmJK5mwGUS2M5hkRt2i+
         g34mcF6mt2DPr04ANBNWldrp3FgQE7N5mSo6s=
MIME-Version: 1.0
Received: by 10.216.91.15 with SMTP id g15mr1034556wef.24.1254735065743; Mon, 
	05 Oct 2009 02:31:05 -0700 (PDT)
In-Reply-To: <f18c9dde0910050215x49bfde2cja4636392518a0f74@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <f18c9dde0910050215x49bfde2cja4636392518a0f74@mail.gmail.com>
Date: Mon, 5 Oct 2009 11:31:05 +0200
Message-ID: <882a24d40910050231j5775785cx8f376e6ef69b85bb@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: =?ISO-8859-1?Q?Ole=2DMartin_M=F8rk?= <olemartin@gmail.com>
To: java-user@lucene.apache.org, simon.willnauer@gmail.com
Content-Type: multipart/alternative; boundary=0016e6d566ade180a904752cc50e
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d566ade180a904752cc50e
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I don't think I changed any boost values, at least not on purpose. I think
the reason for the changed document id is that, to my knowledge, an update
is a delete and an add.
The code for my solrj update:

public void updateDocument(SolrDocument document) {
        SolrServer server =3D new CommonsHttpSolrServer(SOLR_URL);
        SolrInputDocument input =3D new SolrInputDocument();
        Collection<String> fields =3D document.getFieldNames();
        for (String field : fields) {
            input.setField(field, document.getFieldValue(field));
        }
        input.removeField("id"); //is regenerated from the url value
        input.removeField("score");
        server.add(input);
    }
--
Ole-Martin M=F8rk


On Mon, Oct 5, 2009 at 11:15 AM, Simon Willnauer <
simon.willnauer@googlemail.com> wrote:

> Did you change any boost values for URL field or document while reindexin=
g
> the document by any chance? Or do you look at different documents - one i=
s
> internal id 0 and other is internal id 22 - this could be the updated one
> just curious if that might be the cause?!
>
> simon
>
> On Mon, Oct 5, 2009 at 10:21 AM, Ole-Martin M=F8rk <olemartin@gmail.com
> >wrote:
>
> > Hi. I am trying to understand Lucene's scoring algorithm. We're
> > getting some strange results. First we search for a given page by it's
> > url. We get this result:
> >
> > 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), product=
 of:
> >  1.0 =3D tf(phraseFreq=3D1.0)
> >  32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
> > something=3D2 something=3D44 704290075=3D1)
> >  4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
> >
> > When this is done, we use solrJ to read and write the document. The
> > only change is the title of the document (appends the number 2)
> >
> > We search again and the fieldNorm is changed significantly:
> >
> > 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of:
> >  1.0 =3D tf(phraseFreq=3D1.0)
> >  31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457
> > something=3D3 somthing=3D45 704290075=3D2)
> >  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
> >
> > Why does the value of fieldNorm change so much?
> >
> > Looking forward to your answers.
> >
> > --
> > Ole-Martin M=F8rk
> > http://twitter.com/olemartin
> > http://flickr.com/olemartin
> >
>

--0016e6d566ade180a904752cc50e--

From java-user-return-42600-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 09:50:23 2009
Return-Path: <java-user-return-42600-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31461 invoked from network); 5 Oct 2009 09:50:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 09:50:23 -0000
Received: (qmail 31593 invoked by uid 500); 5 Oct 2009 09:50:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31525 invoked by uid 500); 5 Oct 2009 09:50:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31515 invoked by uid 99); 5 Oct 2009 09:50:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:50:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of olemartin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:50:08 +0000
Received: by ewy19 with SMTP id 19so2661353ewy.28
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 02:49:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=0o2yEB/jU3rSBmLfTv/SZnv9ZJJxOiYbRFXIoBA6UYA=;
        b=HUvCFZW5g65zlDjDd1OP8j5mkdN1452q2eJKAuAuRaYT6ayn+O+4wAkAlK+vWjWWqb
         1GeZs0E6URhZhvJlI7HiMO3L1sjlQtMFHxWr5miG5EE9prm4g7wRGXkiQf7N757uonnT
         /Yj6xEaXZhbNFF40iTb0/X1v6j9EXFzrTxu7g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=kweD8mbZqxrQ/MxVvKVg3FbE8zzDzUSvTq1WjI+/i/djIq19jYl3BolQ/+pAcnVa16
         qbgFBA3x2JL2MGGVmlcfDMwr/sAmb7QVRWKeAg5BA8ZlHP2TqYId0GHbn1WqaL5kPFMa
         HIcykwRUmUATC+xRlvrImv7/ozMubLSXkUQ78=
MIME-Version: 1.0
Received: by 10.216.30.135 with SMTP id k7mr979024wea.82.1254736188039; Mon, 
	05 Oct 2009 02:49:48 -0700 (PDT)
In-Reply-To: <f18c9dde0910050239p51bda55xd89ba963f63e48e9@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <f18c9dde0910050215x49bfde2cja4636392518a0f74@mail.gmail.com>
	 <882a24d40910050231j5775785cx8f376e6ef69b85bb@mail.gmail.com>
	 <f18c9dde0910050239p51bda55xd89ba963f63e48e9@mail.gmail.com>
Date: Mon, 5 Oct 2009 11:49:47 +0200
Message-ID: <882a24d40910050249q2e7325aepa7eeec5196a461df@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: =?ISO-8859-1?Q?Ole=2DMartin_M=F8rk?= <olemartin@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6db2f20c6613604752d084f
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6db2f20c6613604752d084f
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Did another update:
9.707364 =3D fieldWeight(url:"our super secret url" in 0), product of:
  1.0 =3D tf(phraseFreq=3D1.0)
  31.063566 =3D idf(url: www=3D7329 host=3D323 com=3D7329
article=3D2458 something=3D4 something=3D46 704290075=3D3)
  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)

FieldNorm value is not changed this time. It might be that the index was
really small the first time the document was added. Could that affect the
fieldNorm value?

--
Ole-Martin M=F8rk


On Mon, Oct 5, 2009 at 11:39 AM, Simon Willnauer <
simon.willnauer@googlemail.com> wrote:

>
>
> On Mon, Oct 5, 2009 at 11:31 AM, Ole-Martin M=F8rk <olemartin@gmail.com>w=
rote:
>
>> I don't think I changed any boost values, at least not on purpose. I thi=
nk
>> the reason for the changed document id is that, to my knowledge, an upda=
te
>> is a delete and an add.
>
> That is correct it could be caused by an update I just wonder why it got
> the id 0 - it looked weird though.
> The field norm are calculated for doc boost, field boost and lengthNorm s=
o
> if you did not change any boost values compare to the last update / inser=
t
> this looks very strange though.
>
> can you repeat this more than once and see if the fieldnorm change all th=
e
> time?
>
> simon
>
>>
>> The code for my solrj update:
>>
>> public void updateDocument(SolrDocument document) {
>>         SolrServer server =3D new CommonsHttpSolrServer(SOLR_URL);
>>         SolrInputDocument input =3D new SolrInputDocument();
>>         Collection<String> fields =3D document.getFieldNames();
>>         for (String field : fields) {
>>             input.setField(field, document.getFieldValue(field));
>>         }
>>         input.removeField("id"); //is regenerated from the url value
>>         input.removeField("score");
>>         server.add(input);
>>     }
>> --
>> Ole-Martin M=F8rk
>>
>>
>>
>> On Mon, Oct 5, 2009 at 11:15 AM, Simon Willnauer <
>> simon.willnauer@googlemail.com> wrote:
>>
>>> Did you change any boost values for URL field or document while
>>> reindexing
>>> the document by any chance? Or do you look at different documents - one
>>> is
>>> internal id 0 and other is internal id 22 - this could be the updated o=
ne
>>> just curious if that might be the cause?!
>>>
>>> simon
>>>
>>> On Mon, Oct 5, 2009 at 10:21 AM, Ole-Martin M=F8rk <olemartin@gmail.com
>>> >wrote:
>>>
>>> > Hi. I am trying to understand Lucene's scoring algorithm. We're
>>> > getting some strange results. First we search for a given page by it'=
s
>>> > url. We get this result:
>>> >
>>> > 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), produ=
ct
>>> of:
>>> >  1.0 =3D tf(phraseFreq=3D1.0)
>>> >  32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D245=
6
>>> > something=3D2 something=3D44 704290075=3D1)
>>> >  4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>>> >
>>> > When this is done, we use solrJ to read and write the document. The
>>> > only change is the title of the document (appends the number 2)
>>> >
>>> > We search again and the fieldNorm is changed significantly:
>>> >
>>> > 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of=
:
>>> >  1.0 =3D tf(phraseFreq=3D1.0)
>>> >  31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D24=
57
>>> > something=3D3 somthing=3D45 704290075=3D2)
>>> >  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>>> >
>>> > Why does the value of fieldNorm change so much?
>>> >
>>> > Looking forward to your answers.
>>> >
>>> > --
>>> > Ole-Martin M=F8rk
>>> > http://twitter.com/olemartin
>>> > http://flickr.com/olemartin
>>> >
>>>
>>
>>
>

--0016e6db2f20c6613604752d084f--

From java-user-return-42601-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 09:54:33 2009
Return-Path: <java-user-return-42601-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32052 invoked from network); 5 Oct 2009 09:54:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 09:54:33 -0000
Received: (qmail 37498 invoked by uid 500); 5 Oct 2009 09:54:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37417 invoked by uid 500); 5 Oct 2009 09:54:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37407 invoked by uid 99); 5 Oct 2009 09:54:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:54:31 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 74.125.78.27 as permitted sender)
Received: from [74.125.78.27] (HELO ey-out-2122.google.com) (74.125.78.27)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:54:18 +0000
Received: by ey-out-2122.google.com with SMTP id 22so607219eye.3
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 02:52:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=gAXFDcK+kkHapK9X/IGmslKxMe/wg/U2Ml88qLWyhlY=;
        b=d+Zjz97Jv0G76JRnnLAsdd2MZVK3GLZLH4aok1b63MXItFWe3VpHfGgSBYsTG3QLDw
         4J7NeZooy5vn6SZqUoE53T8/aUXuflJO5iW6ofGa3ncUhzkQiZmLAB8YLpHjYdHPC21q
         mKGRmdN/1S1Nrz8dMKwkGbCwshZ5oyXYECyCA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=OvNczzCM+SSleDYfhoWZExWfrI0JISB9XJ2SxYB1SdaJ63dqq1NXjdqZY5i//nDoad
         TEeGeVQ0ywiiJHFMw/2a/FRfQ+x7+p2Wer/RG8UGhc0eu/y2Sdc6uYGSLxh6s1z0Tw1w
         xYk7LB+sUCiJktc/AthsFgZ7WN5iXycnj9BEU=
Received: by 10.210.160.10 with SMTP id i10mr3031583ebe.10.1254736378614;
        Mon, 05 Oct 2009 02:52:58 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 7sm1924867eyg.19.2009.10.05.02.52.57
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 05 Oct 2009 02:52:57 -0700 (PDT)
Message-Id: <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes
Content-Transfer-Encoding: quoted-printable
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Help understanding fieldNorm
Date: Mon, 5 Oct 2009 11:52:56 +0200
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Ole-Martin,

how many characters was it in the url in before and after update?


      karl

5 okt 2009 kl. 10.21 skrev Ole-Martin M=F8rk:

> Hi. I am trying to understand Lucene's scoring algorithm. We're
> getting some strange results. First we search for a given page by it's
> url. We get this result:
>
> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), =20
> product of:
>  1.0 =3D tf(phraseFreq=3D1.0)
>  32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
> something=3D2 something=3D44 704290075=3D1)
>  4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>
> When this is done, we use solrJ to read and write the document. The
> only change is the title of the document (appends the number 2)
>
> We search again and the fieldNorm is changed significantly:
>
> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of:
>  1.0 =3D tf(phraseFreq=3D1.0)
>  31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457
> something=3D3 somthing=3D45 704290075=3D2)
>  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>
> Why does the value of fieldNorm change so much?
>
> Looking forward to your answers.
>
> --
> Ole-Martin M=F8rk
> http://twitter.com/olemartin
> http://flickr.com/olemartin


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42602-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 09:58:57 2009
Return-Path: <java-user-return-42602-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32898 invoked from network); 5 Oct 2009 09:58:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 09:58:57 -0000
Received: (qmail 47457 invoked by uid 500); 5 Oct 2009 09:58:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47415 invoked by uid 500); 5 Oct 2009 09:58:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47405 invoked by uid 99); 5 Oct 2009 09:58:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:58:54 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 09:58:42 +0000
Received: by bwz22 with SMTP id 22so2445605bwz.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 02:57:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=27BqESUG+3EN8ID7zDuouhocnO2GinAVirk43vk/bYA=;
        b=KHhXbdAtPqMmy7KMoQ++lBSihLiRMqXpK6eOQSlApLyk3zB9j4tswLhsAJ4ePp84pT
         9x8hTzh/a86aHiHzYMV2wTO/N/d9torHx1Lf/Ln4I68c7hBJpgN5V9eGGq958sUtvESc
         tofCrjK9C/ZHRAPM1RWNoQeDCRvyVYEcOD6iE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=GeG8kAn7GnvPDjSp4EJIrWo2fnWk9GHk5bSEq177amhKXoT+TCZaBVMygzi3QyfIKw
         UlyzzgLX9hkZHmfIvzA7tUN8LzNd+6Waz1m52ZaUow05klIeMJVAIryMiT9vZ5uKf3+E
         5ij9XYhHN3iJJaaOESwvHvh4RAPGXgcAmkC6Q=
MIME-Version: 1.0
Received: by 10.239.145.15 with SMTP id q15mr527327hba.121.1254736641621; Mon, 
	05 Oct 2009 02:57:21 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
Date: Mon, 5 Oct 2009 11:57:21 +0200
Message-ID: <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f794cccf805d04752d2366
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f794cccf805d04752d2366
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Ole-Martin, did you mention that you did not change the URL value but the
title?

simon

On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.com> wrote:

> Hi Ole-Martin,
>
> how many characters was it in the url in before and after update?
>
>
>     karl
>
> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=C3=B8rk:
>
>
>  Hi. I am trying to understand Lucene's scoring algorithm. We're
>> getting some strange results. First we search for a given page by it's
>> url. We get this result:
>>
>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), product =
of:
>>  1.0 =3D tf(phraseFreq=3D1.0)
>>  32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
>> something=3D2 something=3D44 704290075=3D1)
>>  4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>>
>> When this is done, we use solrJ to read and write the document. The
>> only change is the title of the document (appends the number 2)
>>
>> We search again and the fieldNorm is changed significantly:
>>
>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of:
>>  1.0 =3D tf(phraseFreq=3D1.0)
>>  31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457
>> something=3D3 somthing=3D45 704290075=3D2)
>>  0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>>
>> Why does the value of fieldNorm change so much?
>>
>> Looking forward to your answers.
>>
>> --
>> Ole-Martin M=C3=B8rk
>> http://twitter.com/olemartin
>> http://flickr.com/olemartin
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f794cccf805d04752d2366--

From java-user-return-42603-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 10:40:47 2009
Return-Path: <java-user-return-42603-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43763 invoked from network); 5 Oct 2009 10:40:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 10:40:47 -0000
Received: (qmail 9108 invoked by uid 500); 5 Oct 2009 10:40:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9029 invoked by uid 500); 5 Oct 2009 10:40:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9011 invoked by uid 99); 5 Oct 2009 10:40:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 10:40:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 10:40:31 +0000
Received: by ewy19 with SMTP id 19so2694824ewy.28
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 03:39:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=Y/JBng6fH+GqH40pwwM6TUj0z/qFHky9VH6Z0SsJvik=;
        b=uSmxT2lE3uRDwAZ062KL1XWgajZGD6Kq7YuKWcd2ygei3IIXF3kBONyWunL6tE+vxk
         FoOSN9bPrz30pCXNLZqPknme8onlZBe/caNdkUryL/wUr4N8nfLd4pHp0cgf9+ntkZnn
         io6jicLHBKaUtLEt1xXOKgig4n/JZ9Yo1aGmY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=CE+gNvH5lqcNk1XI+/VVAZsJimpJTo8mrGBXGByacopCPXPLV7sWN1MPBGxcGUTC5K
         41+6oTz5x0HBFZ8PKVQJucqwcRuV1LUCgSZCSm49rsrLYOSlyPb7RCjoV0gt4tmt7qNR
         75uecoYilJLXsss+XL+vkM8rBFxY4G7S6j0ZA=
Received: by 10.211.131.5 with SMTP id i5mr6805645ebn.72.1254739151632;
        Mon, 05 Oct 2009 03:39:11 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 24sm285983eyx.33.2009.10.05.03.39.10
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 05 Oct 2009 03:39:10 -0700 (PDT)
Message-Id: <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes
Content-Transfer-Encoding: quoted-printable
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Help understanding fieldNorm
Date: Mon, 5 Oct 2009 12:39:09 +0200
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com> <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com> <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

sorry, I ment title.

5 okt 2009 kl. 11.57 skrev Simon Willnauer:

> Ole-Martin, did you mention that you did not change the URL value =20
> but the
> title?
>
> simon
>
> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.com> =20=

> wrote:
>
>> Hi Ole-Martin,
>>
>> how many characters was it in the url in before and after update?
>>
>>
>>    karl
>>
>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=F8rk:
>>
>>
>> Hi. I am trying to understand Lucene's scoring algorithm. We're
>>> getting some strange results. First we search for a given page by =20=

>>> it's
>>> url. We get this result:
>>>
>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), =20
>>> product of:
>>> 1.0 =3D tf(phraseFreq=3D1.0)
>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
>>> something=3D2 something=3D44 704290075=3D1)
>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>>>
>>> When this is done, we use solrJ to read and write the document. The
>>> only change is the title of the document (appends the number 2)
>>>
>>> We search again and the fieldNorm is changed significantly:
>>>
>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product =
of:
>>> 1.0 =3D tf(phraseFreq=3D1.0)
>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457=

>>> something=3D3 somthing=3D45 704290075=3D2)
>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>>>
>>> Why does the value of fieldNorm change so much?
>>>
>>> Looking forward to your answers.
>>>
>>> --
>>> Ole-Martin M=F8rk
>>> http://twitter.com/olemartin
>>> http://flickr.com/olemartin
>>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42604-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 10:47:06 2009
Return-Path: <java-user-return-42604-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44761 invoked from network); 5 Oct 2009 10:47:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 10:47:06 -0000
Received: (qmail 20412 invoked by uid 500); 5 Oct 2009 10:47:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20356 invoked by uid 500); 5 Oct 2009 10:47:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20346 invoked by uid 99); 5 Oct 2009 10:47:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 10:47:04 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of olemartin@gmail.com designates 74.125.78.26 as permitted sender)
Received: from [74.125.78.26] (HELO ey-out-2122.google.com) (74.125.78.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 10:46:52 +0000
Received: by ey-out-2122.google.com with SMTP id 4so383732eyf.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 03:45:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=9Hy0solD+BrdGZQz2txVPuh8l+5NuklHOJrUL5qX12w=;
        b=LJFHNainUDcFbYdiuVptBfrsNyUuRNpcPyMdSdezmmxYc4tGlRr0vVktG2bd8SnWWy
         u8boAxhs6y8856TE8H9W/6SdcQAoAdDIoPcT97vDgAWcCkVX/rOeaWL+LJdinsu3IYGE
         wqK/vq8arKU5UfuZlOcNBrqevHlZag0UNnXQo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=WIynwLIm//kwHuzbL/CS+FxE3ww9G1Cy2GX3B9ROjwZKIsqug1PMHgYUdRdMhIxBK6
         rFWaHjWoJZGPJQsMvftfU+WeXGQ5YrKgnR2vW03MYpsffosU6ARXzjPUdafTpqPidA5N
         o6EOOc1hGSJ4FUip34e3LPmpQPBH2nFZkAZ/w=
MIME-Version: 1.0
Received: by 10.216.22.147 with SMTP id t19mr978725wet.174.1254739531707; Mon, 
	05 Oct 2009 03:45:31 -0700 (PDT)
In-Reply-To: <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
	 <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
	 <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
Date: Mon, 5 Oct 2009 12:45:31 +0200
Message-ID: <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: =?ISO-8859-1?Q?Ole=2DMartin_M=F8rk?= <olemartin@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364d212912b75f04752dd019
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364d212912b75f04752dd019
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I did not change the url. The length of the title was increased by 1, from
41 to 42 characters.
--
Ole-Martin M=F8rk


On Mon, Oct 5, 2009 at 12:39 PM, Karl Wettin <karl.wettin@gmail.com> wrote:

> sorry, I ment title.
>
> 5 okt 2009 kl. 11.57 skrev Simon Willnauer:
>
>
>  Ole-Martin, did you mention that you did not change the URL value but th=
e
>> title?
>>
>> simon
>>
>> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.com>
>> wrote:
>>
>>  Hi Ole-Martin,
>>>
>>> how many characters was it in the url in before and after update?
>>>
>>>
>>>   karl
>>>
>>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=F8rk:
>>>
>>>
>>> Hi. I am trying to understand Lucene's scoring algorithm. We're
>>>
>>>> getting some strange results. First we search for a given page by it's
>>>> url. We get this result:
>>>>
>>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), produc=
t
>>>> of:
>>>> 1.0 =3D tf(phraseFreq=3D1.0)
>>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2456
>>>> something=3D2 something=3D44 704290075=3D1)
>>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>>>>
>>>> When this is done, we use solrJ to read and write the document. The
>>>> only change is the title of the document (appends the number 2)
>>>>
>>>> We search again and the fieldNorm is changed significantly:
>>>>
>>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product of:
>>>> 1.0 =3D tf(phraseFreq=3D1.0)
>>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D2457
>>>> something=3D3 somthing=3D45 704290075=3D2)
>>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>>>>
>>>> Why does the value of fieldNorm change so much?
>>>>
>>>> Looking forward to your answers.
>>>>
>>>> --
>>>> Ole-Martin M=F8rk
>>>> http://twitter.com/olemartin
>>>> http://flickr.com/olemartin
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364d212912b75f04752dd019--

From java-user-return-42605-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 12:03:24 2009
Return-Path: <java-user-return-42605-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58388 invoked from network); 5 Oct 2009 12:03:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 12:03:24 -0000
Received: (qmail 5326 invoked by uid 500); 5 Oct 2009 12:03:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5255 invoked by uid 500); 5 Oct 2009 12:03:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5245 invoked by uid 99); 5 Oct 2009 12:03:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:03:22 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 72.14.220.156 as permitted sender)
Received: from [72.14.220.156] (HELO fg-out-1718.google.com) (72.14.220.156)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:03:09 +0000
Received: by fg-out-1718.google.com with SMTP id d23so449023fga.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 05:01:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=ijYKNIgUlQSFCgkeZW6ZRjLzqNGKFWSRRCcB19UbcRI=;
        b=KKWK06OUYfO5A7u6At0AhRXXk5SV0yEw3fC+vOkdqSBK47u/PE4w7RVHyRP2efNZIw
         g6bSBdMLU+F7Z/bx0smrwQSH8NV1Q4bCAhmMIKVORxWL7vu+AgPc308wiO6a2iHlpaq/
         2N7UessL5NBGNa65Ny8LtDzo7Zjk6G8Nvw7wk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=awutMOZyznBxF+jlaUIh6dfKMoGRvb/jEmX5wSZnbMyoZXtWcVROvNyk5zI/lakSKV
         XghAIE6C20WpilnFX5hjFi3i72Z9LDvA9wqSokA2kYrpB/r8+VcbFVhMmmdo2/azOU5X
         m5Aw62k2monU0pBmXfXSAKLNFxxD04K76LpBg=
MIME-Version: 1.0
Received: by 10.239.184.159 with SMTP id y31mr516955hbg.192.1254744109004; 
	Mon, 05 Oct 2009 05:01:49 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
	 <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
	 <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
	 <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
Date: Mon, 5 Oct 2009 14:01:48 +0200
Message-ID: <f18c9dde0910050501v1556e875q419065d0970f002@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f79490e6b6c204752ee0db
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f79490e6b6c204752ee0db
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I still guess that the document has been indexed with different boost
factors the first time if you did not change the length of the URL.
Can you make sure this did not happen?

simon

On Mon, Oct 5, 2009 at 12:45 PM, Ole-Martin M=C3=B8rk <olemartin@gmail.com>=
wrote:

> I did not change the url. The length of the title was increased by 1, fro=
m
> 41 to 42 characters.
> --
> Ole-Martin M=C3=B8rk
>
>
> On Mon, Oct 5, 2009 at 12:39 PM, Karl Wettin <karl.wettin@gmail.com>
> wrote:
>
> > sorry, I ment title.
> >
> > 5 okt 2009 kl. 11.57 skrev Simon Willnauer:
> >
> >
> >  Ole-Martin, did you mention that you did not change the URL value but
> the
> >> title?
> >>
> >> simon
> >>
> >> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.com>
> >> wrote:
> >>
> >>  Hi Ole-Martin,
> >>>
> >>> how many characters was it in the url in before and after update?
> >>>
> >>>
> >>>   karl
> >>>
> >>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=C3=B8rk:
> >>>
> >>>
> >>> Hi. I am trying to understand Lucene's scoring algorithm. We're
> >>>
> >>>> getting some strange results. First we search for a given page by it=
's
> >>>> url. We get this result:
> >>>>
> >>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), prod=
uct
> >>>> of:
> >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> >>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D245=
6
> >>>> something=3D2 something=3D44 704290075=3D1)
> >>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
> >>>>
> >>>> When this is done, we use solrJ to read and write the document. The
> >>>> only change is the title of the document (appends the number 2)
> >>>>
> >>>> We search again and the fieldNorm is changed significantly:
> >>>>
> >>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product o=
f:
> >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> >>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D24=
57
> >>>> something=3D3 somthing=3D45 704290075=3D2)
> >>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
> >>>>
> >>>> Why does the value of fieldNorm change so much?
> >>>>
> >>>> Looking forward to your answers.
> >>>>
> >>>> --
> >>>> Ole-Martin M=C3=B8rk
> >>>> http://twitter.com/olemartin
> >>>> http://flickr.com/olemartin
> >>>>
> >>>>
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>>
> >>>
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>

--001485f79490e6b6c204752ee0db--

From java-user-return-42606-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 12:05:03 2009
Return-Path: <java-user-return-42606-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58602 invoked from network); 5 Oct 2009 12:05:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 12:05:03 -0000
Received: (qmail 7573 invoked by uid 500); 5 Oct 2009 12:05:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7492 invoked by uid 500); 5 Oct 2009 12:05:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7482 invoked by uid 99); 5 Oct 2009 12:05:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:05:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 74.125.78.24 as permitted sender)
Received: from [74.125.78.24] (HELO ey-out-2122.google.com) (74.125.78.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:04:48 +0000
Received: by ey-out-2122.google.com with SMTP id 22so626459eye.3
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 05:04:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=FON9WVWYWcTRSP7UmAeylR1E7dZ9gciTUOHCbmpqpIs=;
        b=MZF4lsYRpVu5E8Gu2Aia1lZuK3LevUfU7FVfc6d3/W9+wUdlCG7aX8o+kNDO6QTVTC
         adGLyY7xeBVCxmk41Oloh4c3eVoETi3bmKU1smSzqlebVxEu6KqAoAg6RKkMyLeQBzlk
         9LDxLVbaZSjoaQIgKRKgpMndMCVwQDarRxg1M=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=xYocu3yO2qVFGKkNbmcBZ3wrfMEcwdDCLKVODNCEMMcGWjEs3xT76brm8YkRbpyoAP
         qjz0Y0K0nVJddozOmgmMy6iqgPM0WkkpuxZizzMc5nL2SweXMslGkLnEAn9wvz6qUBcF
         M8Ny0g5r9QxS/t3NVRWhntW9Qt+qcxuImLYAE=
Received: by 10.210.3.3 with SMTP id 3mr3144059ebc.29.1254744268064;
        Mon, 05 Oct 2009 05:04:28 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 7sm2325758eyg.11.2009.10.05.05.04.27
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 05 Oct 2009 05:04:27 -0700 (PDT)
Message-Id: <44AF8436-7063-4E78-907A-9EA9ED7BF448@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed; delsp=yes
Content-Transfer-Encoding: quoted-printable
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Help understanding fieldNorm
Date: Mon, 5 Oct 2009 14:04:26 +0200
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com> <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com> <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com> <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com> <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Could it be that the tokenization schema for URL have changed between =20=

the times you added documents? I.e. yielding more tokens when you got =20=

the low fieldNorm value. Number of documents should not impact the =20
fieldnorm, the value is based on number of tokens in the field, field =20=

and document boost:

document boost * field boost * (1/sqrt(terms in field))

Or perhaps you were using different similarity classes where  =20
lengthNorm(String,int) differed?

If none of above I'm clueless.


        karl

5 okt 2009 kl. 12.45 skrev Ole-Martin M=F8rk:

> I did not change the url. The length of the title was increased by =20
> 1, from
> 41 to 42 characters.
> --
> Ole-Martin M=F8rk
>
>
> On Mon, Oct 5, 2009 at 12:39 PM, Karl Wettin <karl.wettin@gmail.com> =20=

> wrote:
>
>> sorry, I ment title.
>>
>> 5 okt 2009 kl. 11.57 skrev Simon Willnauer:
>>
>>
>> Ole-Martin, did you mention that you did not change the URL value =20
>> but the
>>> title?
>>>
>>> simon
>>>
>>> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.com>
>>> wrote:
>>>
>>> Hi Ole-Martin,
>>>>
>>>> how many characters was it in the url in before and after update?
>>>>
>>>>
>>>>  karl
>>>>
>>>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=F8rk:
>>>>
>>>>
>>>> Hi. I am trying to understand Lucene's scoring algorithm. We're
>>>>
>>>>> getting some strange results. First we search for a given page =20
>>>>> by it's
>>>>> url. We get this result:
>>>>>
>>>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22), =20=

>>>>> product
>>>>> of:
>>>>> 1.0 =3D tf(phraseFreq=3D1.0)
>>>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 =
article=3D2456
>>>>> something=3D2 something=3D44 704290075=3D1)
>>>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
>>>>>
>>>>> When this is done, we use solrJ to read and write the document. =20=

>>>>> The
>>>>> only change is the title of the document (appends the number 2)
>>>>>
>>>>> We search again and the fieldNorm is changed significantly:
>>>>>
>>>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product =
=20
>>>>> of:
>>>>> 1.0 =3D tf(phraseFreq=3D1.0)
>>>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 =
article=3D2457
>>>>> something=3D3 somthing=3D45 704290075=3D2)
>>>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
>>>>>
>>>>> Why does the value of fieldNorm change so much?
>>>>>
>>>>> Looking forward to your answers.
>>>>>
>>>>> --
>>>>> Ole-Martin M=F8rk
>>>>> http://twitter.com/olemartin
>>>>> http://flickr.com/olemartin
>>>>>
>>>>>
>>>>
>>>> =
---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42607-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 12:16:12 2009
Return-Path: <java-user-return-42607-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 60492 invoked from network); 5 Oct 2009 12:16:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 12:16:12 -0000
Received: (qmail 23793 invoked by uid 500); 5 Oct 2009 12:16:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23698 invoked by uid 500); 5 Oct 2009 12:16:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23688 invoked by uid 99); 5 Oct 2009 12:16:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:16:09 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of olemartin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:15:57 +0000
Received: by ewy19 with SMTP id 19so2767948ewy.28
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 05:14:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=Xv56NtpW4uFr711aFi2fK1R7T6AmKLtp6fWOOD8woq4=;
        b=krGSvsD/K7s1721YnvYgxOT5DNZvfgy3jZ72P8vBzkVx9wx59nleKfmSDuCa0UykW+
         KZbZDPq8TCXwjB4L+LwgBgkiZ9Vl/20wKf+rZKP/9LDs/dlWMRaS1pwlH7ftmPUKP085
         0fbT12B7xgSdE7sPJBKmo4TYMPp0gDN/BrLJM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Dx4HdJ8qlIoaHI+9gZAeRJ4tGkdfoghyKpZpBpIMueBslfSoiZH2485t641JJ2BX5J
         GtvoE1oIEgV0GkVvPMdxf8MTRnAsST7fi83uBauEOO3COvn9r9TT5bPF8YV2Mp8deemu
         ciEaIVtaGK2seHx9lXkeCFV7tTM3y9K3ygjAU=
MIME-Version: 1.0
Received: by 10.216.90.76 with SMTP id d54mr1039305wef.55.1254744877176; Mon, 
	05 Oct 2009 05:14:37 -0700 (PDT)
In-Reply-To: <f18c9dde0910050501v1556e875q419065d0970f002@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
	 <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
	 <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
	 <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
	 <f18c9dde0910050501v1556e875q419065d0970f002@mail.gmail.com>
Date: Mon, 5 Oct 2009 14:14:37 +0200
Message-ID: <882a24d40910050514i19510db5md0d8fd26f6a4a86c@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: =?ISO-8859-1?Q?Ole=2DMartin_M=F8rk?= <olemartin@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d778ddb0197904752f0e22
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d778ddb0197904752f0e22
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

That might be true. The document boost did not change, but maybe the field
boost changed. Is it possible to retrieve the field boost from solr?
--
Ole-Martin M=F8rk


On Mon, Oct 5, 2009 at 2:01 PM, Simon Willnauer <
simon.willnauer@googlemail.com> wrote:

> I still guess that the document has been indexed with different boost
> factors the first time if you did not change the length of the URL.
> Can you make sure this did not happen?
>
> simon
>
> On Mon, Oct 5, 2009 at 12:45 PM, Ole-Martin M=F8rk <olemartin@gmail.com
> >wrote:
>
> > I did not change the url. The length of the title was increased by 1,
> from
> > 41 to 42 characters.
> > --
> > Ole-Martin M=F8rk
> >
> >
> > On Mon, Oct 5, 2009 at 12:39 PM, Karl Wettin <karl.wettin@gmail.com>
> > wrote:
> >
> > > sorry, I ment title.
> > >
> > > 5 okt 2009 kl. 11.57 skrev Simon Willnauer:
> > >
> > >
> > >  Ole-Martin, did you mention that you did not change the URL value bu=
t
> > the
> > >> title?
> > >>
> > >> simon
> > >>
> > >> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.com>
> > >> wrote:
> > >>
> > >>  Hi Ole-Martin,
> > >>>
> > >>> how many characters was it in the url in before and after update?
> > >>>
> > >>>
> > >>>   karl
> > >>>
> > >>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=F8rk:
> > >>>
> > >>>
> > >>> Hi. I am trying to understand Lucene's scoring algorithm. We're
> > >>>
> > >>>> getting some strange results. First we search for a given page by
> it's
> > >>>> url. We get this result:
> > >>>>
> > >>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22),
> product
> > >>>> of:
> > >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> > >>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=3D2=
456
> > >>>> something=3D2 something=3D44 704290075=3D1)
> > >>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
> > >>>>
> > >>>> When this is done, we use solrJ to read and write the document. Th=
e
> > >>>> only change is the title of the document (appends the number 2)
> > >>>>
> > >>>> We search again and the fieldNorm is changed significantly:
> > >>>>
> > >>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), product=
 of:
> > >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> > >>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=3D=
2457
> > >>>> something=3D3 somthing=3D45 704290075=3D2)
> > >>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
> > >>>>
> > >>>> Why does the value of fieldNorm change so much?
> > >>>>
> > >>>> Looking forward to your answers.
> > >>>>
> > >>>> --
> > >>>> Ole-Martin M=F8rk
> > >>>> http://twitter.com/olemartin
> > >>>> http://flickr.com/olemartin
> > >>>>
> > >>>>
> > >>>
> > >>> -------------------------------------------------------------------=
--
> > >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> > >>>
> > >>>
> > >>>
> > >
> > > ---------------------------------------------------------------------
> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > >
> > >
> >
>

--0016e6d778ddb0197904752f0e22--

From java-user-return-42608-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 12:29:59 2009
Return-Path: <java-user-return-42608-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62838 invoked from network); 5 Oct 2009 12:29:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 12:29:59 -0000
Received: (qmail 38003 invoked by uid 500); 5 Oct 2009 12:29:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37924 invoked by uid 500); 5 Oct 2009 12:29:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37914 invoked by uid 99); 5 Oct 2009 12:29:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:29:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 12:29:44 +0000
Received: by fxm2 with SMTP id 2so2661997fxm.28
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 05:28:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=izo+AKTf/ENOvi7gWh28sz/ViG4+elOpUbfpHrndjoc=;
        b=b0uhZuZufs2V9cuseeswl1TyYYr85eEBDQN5LZiWJoYnmdNs4AKYyyODqQ2AxhebRB
         rfOCnXGSv4tD6CJt6nF9xt2PVb/XEU/w133gCRtiaAGHQjgF7Y48JkOIagli+1nWKgkd
         FnyLidmvBCn7AKtnJM5PqR7LV9Ak1KNPUsm8Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=egN3YyAN4b2j/9dweSVP+AecHWUPnI0Y8evaKJTpf4thLH/2s3S6XuGP+FPumnT1d/
         aJUXcFtCtmGhEkC4U12Cggv+8uIqUwjv7buXYOAHh+4Un8Be7q9wy9JRgqNboQ1Cx70G
         VLDJWcuqRJhlS77NrCaiuCYhgwDAVlBsmInBw=
MIME-Version: 1.0
Received: by 10.239.183.26 with SMTP id s26mr524322hbg.179.1254745703972; Mon, 
	05 Oct 2009 05:28:23 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <882a24d40910050514i19510db5md0d8fd26f6a4a86c@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
	 <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
	 <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
	 <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
	 <f18c9dde0910050501v1556e875q419065d0970f002@mail.gmail.com>
	 <882a24d40910050514i19510db5md0d8fd26f6a4a86c@mail.gmail.com>
Date: Mon, 5 Oct 2009 14:28:23 +0200
Message-ID: <f18c9dde0910050528p3bfc5442vbfbc129938b3c153@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f7bf1af7ffac04752f3faa
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f7bf1af7ffac04752f3faa
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Have a look at your schema definition I guess thats the place where boosts
are set if not defined in the data you send to you solr instance.

simon

On Mon, Oct 5, 2009 at 2:14 PM, Ole-Martin M=C3=B8rk <olemartin@gmail.com> =
wrote:

> That might be true. The document boost did not change, but maybe the fiel=
d
> boost changed. Is it possible to retrieve the field boost from solr?
> --
> Ole-Martin M=C3=B8rk
>
>
> On Mon, Oct 5, 2009 at 2:01 PM, Simon Willnauer <
> simon.willnauer@googlemail.com> wrote:
>
> > I still guess that the document has been indexed with different boost
> > factors the first time if you did not change the length of the URL.
> > Can you make sure this did not happen?
> >
> > simon
> >
> > On Mon, Oct 5, 2009 at 12:45 PM, Ole-Martin M=C3=B8rk <olemartin@gmail.=
com
> > >wrote:
> >
> > > I did not change the url. The length of the title was increased by 1,
> > from
> > > 41 to 42 characters.
> > > --
> > > Ole-Martin M=C3=B8rk
> > >
> > >
> > > On Mon, Oct 5, 2009 at 12:39 PM, Karl Wettin <karl.wettin@gmail.com>
> > > wrote:
> > >
> > > > sorry, I ment title.
> > > >
> > > > 5 okt 2009 kl. 11.57 skrev Simon Willnauer:
> > > >
> > > >
> > > >  Ole-Martin, did you mention that you did not change the URL value
> but
> > > the
> > > >> title?
> > > >>
> > > >> simon
> > > >>
> > > >> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <karl.wettin@gmail.co=
m
> >
> > > >> wrote:
> > > >>
> > > >>  Hi Ole-Martin,
> > > >>>
> > > >>> how many characters was it in the url in before and after update?
> > > >>>
> > > >>>
> > > >>>   karl
> > > >>>
> > > >>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=C3=B8rk:
> > > >>>
> > > >>>
> > > >>> Hi. I am trying to understand Lucene's scoring algorithm. We're
> > > >>>
> > > >>>> getting some strange results. First we search for a given page b=
y
> > it's
> > > >>>> url. We get this result:
> > > >>>>
> > > >>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22),
> > product
> > > >>>> of:
> > > >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> > > >>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=
=3D2456
> > > >>>> something=3D2 something=3D44 704290075=3D1)
> > > >>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
> > > >>>>
> > > >>>> When this is done, we use solrJ to read and write the document.
> The
> > > >>>> only change is the title of the document (appends the number 2)
> > > >>>>
> > > >>>> We search again and the fieldNorm is changed significantly:
> > > >>>>
> > > >>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), produ=
ct
> of:
> > > >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> > > >>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 article=
=3D2457
> > > >>>> something=3D3 somthing=3D45 704290075=3D2)
> > > >>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
> > > >>>>
> > > >>>> Why does the value of fieldNorm change so much?
> > > >>>>
> > > >>>> Looking forward to your answers.
> > > >>>>
> > > >>>> --
> > > >>>> Ole-Martin M=C3=B8rk
> > > >>>> http://twitter.com/olemartin
> > > >>>> http://flickr.com/olemartin
> > > >>>>
> > > >>>>
> > > >>>
> > > >>>
> ---------------------------------------------------------------------
> > > >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >>>
> > > >>>
> > > >>>
> > > >
> > > > -------------------------------------------------------------------=
--
> > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > >
> > > >
> > >
> >
>

--001485f7bf1af7ffac04752f3faa--

From java-user-return-42609-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 13:43:14 2009
Return-Path: <java-user-return-42609-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86268 invoked from network); 5 Oct 2009 13:43:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 13:43:14 -0000
Received: (qmail 38191 invoked by uid 500); 5 Oct 2009 13:43:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38122 invoked by uid 500); 5 Oct 2009 13:43:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38112 invoked by uid 99); 5 Oct 2009 13:43:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 13:43:12 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of olemartin@gmail.com designates 209.85.219.214 as permitted sender)
Received: from [209.85.219.214] (HELO mail-ew0-f214.google.com) (209.85.219.214)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 13:42:59 +0000
Received: by ewy10 with SMTP id 10so3016097ewy.9
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 06:42:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=TDdnhMaHaZCf3i7+tce798VwqsKvT8kB/nlUrbD5ZLI=;
        b=Qf74+iHPJmpm1g1AoDZWiO+4Od/5LP7Bqawoia0FRmgsRq/6dSa2W2i6cEv/30QS0M
         tNreQlN2TrNGdyI1DEGN2ywhrC1D+tUlN2Lt6qEqzzOCEK84IrkAZfsg2FSrwLMpWwOT
         tD6LO23LYPBK3iMnT8N4MI/kKKO5+HUUPVlXg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=RuvG+nF7JCZ8849PxyC0h2iTpFmzVWaojJGY71U3WjW1FrkIRr8mHxA7Jq7Zop7VNW
         u6YGXqLAbL/e7zs43hCmOVTj9KMVEJGXM39joF9WS/Q1qy218XpOet/7wCz46GBJLEIm
         il7eQP+q9Z+2sghmZjCwlrR6POLJguBFsDB18=
MIME-Version: 1.0
Received: by 10.216.51.7 with SMTP id a7mr1283wec.193.1254750159433; Mon, 05 
	Oct 2009 06:42:39 -0700 (PDT)
In-Reply-To: <f18c9dde0910050528p3bfc5442vbfbc129938b3c153@mail.gmail.com>
References: <882a24d40910050121n379dabcbw7b8d0ea29031b88b@mail.gmail.com>
	 <AC854B4C-6F8A-4A66-BBF9-B1587420114F@gmail.com>
	 <f18c9dde0910050257p527e2ba8g107c528ece3bb24f@mail.gmail.com>
	 <38E8267A-182B-4761-831F-722C1E5C80CE@gmail.com>
	 <882a24d40910050345p38c1c54ay38f483f76ee06dee@mail.gmail.com>
	 <f18c9dde0910050501v1556e875q419065d0970f002@mail.gmail.com>
	 <882a24d40910050514i19510db5md0d8fd26f6a4a86c@mail.gmail.com>
	 <f18c9dde0910050528p3bfc5442vbfbc129938b3c153@mail.gmail.com>
Date: Mon, 5 Oct 2009 15:42:39 +0200
Message-ID: <882a24d40910050642w68dd9881s58a941aaa5044bd3@mail.gmail.com>
Subject: Re: Help understanding fieldNorm
From: =?ISO-8859-1?Q?Ole=2DMartin_M=F8rk?= <olemartin@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6db5bc088efa504753049c4
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6db5bc088efa504753049c4
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Thanks. It might be that Nutch sets some values. I am not able to find
anything in the config files though.
We are using nutch' solrindex.

--
Ole-Martin M=F8rk
http://twitter.com/olemartin
http://flickr.com/olemartin


On Mon, Oct 5, 2009 at 2:28 PM, Simon Willnauer <
simon.willnauer@googlemail.com> wrote:

> Have a look at your schema definition I guess thats the place where boost=
s
> are set if not defined in the data you send to you solr instance.
>
> simon
>
> On Mon, Oct 5, 2009 at 2:14 PM, Ole-Martin M=F8rk <olemartin@gmail.com>
> wrote:
>
> > That might be true. The document boost did not change, but maybe the
> field
> > boost changed. Is it possible to retrieve the field boost from solr?
> > --
> > Ole-Martin M=F8rk
> >
> >
> > On Mon, Oct 5, 2009 at 2:01 PM, Simon Willnauer <
> > simon.willnauer@googlemail.com> wrote:
> >
> > > I still guess that the document has been indexed with different boost
> > > factors the first time if you did not change the length of the URL.
> > > Can you make sure this did not happen?
> > >
> > > simon
> > >
> > > On Mon, Oct 5, 2009 at 12:45 PM, Ole-Martin M=F8rk <olemartin@gmail.c=
om
> > > >wrote:
> > >
> > > > I did not change the url. The length of the title was increased by =
1,
> > > from
> > > > 41 to 42 characters.
> > > > --
> > > > Ole-Martin M=F8rk
> > > >
> > > >
> > > > On Mon, Oct 5, 2009 at 12:39 PM, Karl Wettin <karl.wettin@gmail.com=
>
> > > > wrote:
> > > >
> > > > > sorry, I ment title.
> > > > >
> > > > > 5 okt 2009 kl. 11.57 skrev Simon Willnauer:
> > > > >
> > > > >
> > > > >  Ole-Martin, did you mention that you did not change the URL valu=
e
> > but
> > > > the
> > > > >> title?
> > > > >>
> > > > >> simon
> > > > >>
> > > > >> On Mon, Oct 5, 2009 at 11:52 AM, Karl Wettin <
> karl.wettin@gmail.com
> > >
> > > > >> wrote:
> > > > >>
> > > > >>  Hi Ole-Martin,
> > > > >>>
> > > > >>> how many characters was it in the url in before and after updat=
e?
> > > > >>>
> > > > >>>
> > > > >>>   karl
> > > > >>>
> > > > >>> 5 okt 2009 kl. 10.21 skrev Ole-Martin M=F8rk:
> > > > >>>
> > > > >>>
> > > > >>> Hi. I am trying to understand Lucene's scoring algorithm. We're
> > > > >>>
> > > > >>>> getting some strange results. First we search for a given page
> by
> > > it's
> > > > >>>> url. We get this result:
> > > > >>>>
> > > > >>>> 0.0014793393 =3D fieldWeight(url:"our super secret url" in 22)=
,
> > > product
> > > > >>>> of:
> > > > >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> > > > >>>> 32.31666 =3D idf(url: www=3D7327 host=3D321 com=3D7327 article=
=3D2456
> > > > >>>> something=3D2 something=3D44 704290075=3D1)
> > > > >>>> 4.5776367E-5 =3D fieldNorm(field=3Durl, doc=3D22)
> > > > >>>>
> > > > >>>> When this is done, we use solrJ to read and write the document=
.
> > The
> > > > >>>> only change is the title of the document (appends the number 2=
)
> > > > >>>>
> > > > >>>> We search again and the fieldNorm is changed significantly:
> > > > >>>>
> > > > >>>> 9.874598 =3D fieldWeight(url:"our super secret url" in 0), pro=
duct
> > of:
> > > > >>>> 1.0 =3D tf(phraseFreq=3D1.0)
> > > > >>>> 31.598713 =3D idf(url: www=3D7328 host=3D322 com=3D7328 articl=
e=3D2457
> > > > >>>> something=3D3 somthing=3D45 704290075=3D2)
> > > > >>>> 0.3125 =3D fieldNorm(field=3Durl, doc=3D0)
> > > > >>>>
> > > > >>>> Why does the value of fieldNorm change so much?
> > > > >>>>
> > > > >>>> Looking forward to your answers.
> > > > >>>>
> > > > >>>> --
> > > > >>>> Ole-Martin M=F8rk
> > > > >>>> http://twitter.com/olemartin
> > > > >>>> http://flickr.com/olemartin
> > > > >>>>
> > > > >>>>
> > > > >>>
> > > > >>>
> > ---------------------------------------------------------------------
> > > > >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > >>> For additional commands, e-mail:
> java-user-help@lucene.apache.org
> > > > >>>
> > > > >>>
> > > > >>>
> > > > >
> > > > >
> ---------------------------------------------------------------------
> > > > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > > > > For additional commands, e-mail: java-user-help@lucene.apache.org
> > > > >
> > > > >
> > > >
> > >
> >
>

--0016e6db5bc088efa504753049c4--

From java-user-return-42610-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 14:11:46 2009
Return-Path: <java-user-return-42610-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92650 invoked from network); 5 Oct 2009 14:11:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 14:11:46 -0000
Received: (qmail 75848 invoked by uid 500); 5 Oct 2009 14:11:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75787 invoked by uid 500); 5 Oct 2009 14:11:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75777 invoked by uid 99); 5 Oct 2009 14:11:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 14:11:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 14:11:32 +0000
Received: (qmail 7702 invoked by uid 508); 5 Oct 2009 14:15:34 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 5 Oct 2009 14:15:34 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1MuoGR-0003AD-DV
	for java-user@lucene.apache.org; Mon, 05 Oct 2009 16:10:11 +0200
Date: Mon, 5 Oct 2009 16:10:11 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: InstantiatedIndex feedback
Message-ID: <20091005141011.GA8551@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

sometime ago I was asked some feedback about InstantiatedIndex, I lost
the identity of the person who asked this so I decided to post some info
on this list, sorry.

It is not a benchmark but just raw debug results, do not expect
scientific/usable results.

We index a small set of documents and performs few queries on the index.
We use our own query API so we do not use any Scorer nor Searcher from
lucene code. We rely only on IW and IR.

Internal indexation time : represents the time for addDocument on IW.
Optimize duration : represents the time of iterating over TermEnum for
the whole query tree.
next/exportForSort/export: (time in nano seconds)
	- next represents the time for the next() call on
	  our query tree and on leaf loop over a termPositions or a
          termDocs
	- exportForSort represents the time for the IR.document() call
	  with a single Field in the FieldSelector.
	- export represent the time for the document() call with all
	  needed field + access to TermPositionVector on one field.

We did the test with a RAMDirectory vs InstantiatedIndex.
While it is not a benchmark results vary upon calls but few trends
are revealed.
We noticed that indexation time for RAMDirectory is very stable and do
not vary between calls, we have a peak for the 10th doc.
With InstantiatedIndex indexation time vary between calls but we do not
have the peak and is globally slower (If you do not consider the peak).
On the queries InstantiatedIndex perform much better than RAMDirectory.

We use the fresh lucene 2.9 and a 1.6.0.16 32 bits Sun JVM on linux x64
system.

First the numbers for RAMDirectory (sorry it is not very readable):

3019 [main] DEBUG spotter  - Internal indexation time 11 ms
3032 [main] DEBUG spotter  - Internal indexation time 5 ms
3053 [main] DEBUG spotter  - Internal indexation time 8 ms
3081 [main] DEBUG spotter  - Internal indexation time 9 ms
3097 [main] DEBUG spotter  - Internal indexation time 4 ms
3114 [main] DEBUG spotter  - Internal indexation time 7 ms
3124 [main] WARN  spotter  - Internal indexation meta name titre has
null value, not indexing...
3136 [main] DEBUG spotter  - Internal indexation time 8 ms
3152 [main] DEBUG spotter  - Internal indexation time 7 ms
3159 [main] WARN  spotter  - Internal indexation meta name titre has
null value, not indexing...
3168 [main] DEBUG spotter  - Internal indexation time 7 ms
3273 [main] DEBUG spotter  - Internal indexation time 97 ms
3299 [main] DEBUG spotter  - Internal indexation time 9 ms
3316 [main] DEBUG spotter  - Internal indexation time 7 ms
3329 [main] DEBUG spotter  - Internal indexation time 5 ms
3343 [main] DEBUG spotter  - Internal indexation time 6 ms
3347 [main] DEBUG spotter  - Optimize duration : 3ms
3349 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 2797/424029/428340 ns, total
4905705, nb (tot/exp) 1/1
3350 [main] DEBUG spotter  - Total time spent (1 result(s)) : 7ms
3352 [main] DEBUG spotter  - Optimize duration : 1ms
3354 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 2757/402906/368173 ns, total
2249306, nb (tot/exp) 1/1
3354 [main] DEBUG spotter  - Total time spent (1 result(s)) : 3ms
3356 [main] DEBUG spotter  - Optimize duration : 0ms
3366 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 136/272985/338887 ns, total
10369422, nb (tot/exp) 14/14
3367 [main] DEBUG spotter  - Total time spent (14 result(s)) : 11ms
3368 [main] DEBUG spotter  - Optimize duration : 1ms
3377 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 186/271181/383213 ns, total 9510161,
nb (tot/exp) 12/12
3378 [main] DEBUG spotter  - Total time spent (12 result(s)) : 11ms
3379 [main] DEBUG spotter  - Optimize duration : 1ms
3381 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 3027/285701/368660 ns, total
1925851, nb (tot/exp) 1/1
3381 [main] DEBUG spotter  - Total time spent (1 result(s)) : 3ms
3383 [main] DEBUG spotter  - Optimize duration : 1ms
3396 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 131/258265/497030 ns, total
13159809, nb (tot/exp) 14/14
3396 [main] DEBUG spotter  - Total time spent (14 result(s)) : 14ms
3398 [main] DEBUG spotter  - Optimize duration : 1ms
3408 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 125/250807/348839 ns, total
10683871, nb (tot/exp) 14/14
3409 [main] DEBUG spotter  - Total time spent (14 result(s)) : 12ms
3410 [main] DEBUG spotter  - Optimize duration : 1ms
3411 [main] DEBUG spotter  - Total time spent (0 result(s)) : 1ms
3412 [main] DEBUG spotter  - Optimize duration : 1ms
3414 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 3228/399888/379086 ns, total
1942673, nb (tot/exp) 1/1
3414 [main] DEBUG spotter  - Total time spent (1 result(s)) : 3ms
3416 [main] DEBUG spotter  - Optimize duration : 1ms
3420 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 596/266276/337983 ns, total 4501430,
nb (tot/exp) 4/4
3421 [main] DEBUG spotter  - Total time spent (4 result(s)) : 6ms
3423 [main] DEBUG spotter  - Optimize duration : 1ms
3427 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 536/284111/369779 ns, total 5372017,
nb (tot/exp) 5/5
3428 [main] DEBUG spotter  - Total time spent (5 result(s)) : 7ms
3429 [main] DEBUG spotter  - Optimize duration : 0ms
3433 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 15444/371502/370394 ns, total
3297290, nb (tot/exp) 1/1
3434 [main] DEBUG spotter  - Total time spent (1 result(s)) : 4ms
3436 [main] DEBUG spotter  - Optimize duration : 0ms
3437 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 2045/395487/367612 ns, total
2375419, nb (tot/exp) 1/1
3438 [main] DEBUG spotter  - Total time spent (1 result(s)) : 3ms
3440 [main] DEBUG spotter  - Optimize duration : 0ms
3446 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 778/263756/352647 ns, total 3362914,
nb (tot/exp) 3/3
3447 [main] DEBUG spotter  - Total time spent (3 result(s)) : 8ms
3448 [main] DEBUG spotter  - Optimize duration : 0ms
3453 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 552/286027/378822 ns, total 4606819,
nb (tot/exp) 5/5
3454 [main] DEBUG spotter  - Total time spent (5 result(s)) : 5ms
3455 [main] DEBUG spotter  - Optimize duration : 1ms
3465 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 141/264997/370457 ns, total
10731665, nb (tot/exp) 14/14
3466 [main] DEBUG spotter  - Total time spent (14 result(s)) : 12ms
3467 [main] DEBUG spotter  - Optimize duration : 0ms
3482 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 175/285948/377016 ns, total
14349331, nb (tot/exp) 14/14
3482 [main] DEBUG spotter  - Total time spent (14 result(s)) : 15ms

Numbers for Instantiated Index :

3529 [main] DEBUG spotter  - Internal indexation time 23 ms
3544 [main] DEBUG spotter  - Internal indexation time 6 ms
3593 [main] DEBUG spotter  - Internal indexation time 16 ms
3639 [main] DEBUG spotter  - Internal indexation time 24 ms
3653 [main] DEBUG spotter  - Internal indexation time 6 ms
3682 [main] DEBUG spotter  - Internal indexation time 14 ms
3697 [main] WARN  spotter  - Internal indexation meta name titre has
null value, not indexing...
3718 [main] DEBUG spotter  - Internal indexation time 17 ms
3741 [main] DEBUG spotter  - Internal indexation time 11 ms
3750 [main] WARN  spotter  - Internal indexation meta name titre has
null value, not indexing...
3774 [main] DEBUG spotter  - Internal indexation time 20 ms
3797 [main] DEBUG spotter  - Internal indexation time 12 ms
3845 [main] DEBUG spotter  - Internal indexation time 27 ms
3880 [main] DEBUG spotter  - Internal indexation time 21 ms
3899 [main] DEBUG spotter  - Internal indexation time 9 ms
3917 [main] DEBUG spotter  - Internal indexation time 8 ms
3918 [main] DEBUG spotter  - Optimize duration : 0ms
3920 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 1774/93110/260321 ns, total
1171400, nb (tot/exp) 1/1
3921 [main] DEBUG spotter  - Total time spent (1 result(s)) : 2ms
3922 [main] DEBUG spotter  - Optimize duration : 1ms
3923 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 3749/111842/343275 ns, total
1370942, nb (tot/exp) 1/1
3924 [main] DEBUG spotter  - Total time spent (1 result(s)) : 3ms
3925 [main] DEBUG spotter  - Optimize duration : 0ms
3932 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 247/77550/310593 ns, total 6900255,
nb (tot/exp) 14/14
3933 [main] DEBUG spotter  - Total time spent (14 result(s)) : 8ms
3934 [main] DEBUG spotter  - Optimize duration : 0ms
3940 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 292/77183/312467 ns, total 6038818,
nb (tot/exp) 12/12
3941 [main] DEBUG spotter  - Total time spent (12 result(s)) : 7ms
3942 [main] DEBUG spotter  - Optimize duration : 0ms
3944 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 3935/108603/334062 ns, total
1397710, nb (tot/exp) 1/1
3944 [main] DEBUG spotter  - Total time spent (1 result(s)) : 2ms
3945 [main] DEBUG spotter  - Optimize duration : 0ms
3951 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 131/69608/255846 ns, total 5903471,
nb (tot/exp) 14/14
3952 [main] DEBUG spotter  - Total time spent (14 result(s)) : 7ms
3953 [main] DEBUG spotter  - Optimize duration : 0ms
3959 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 140/62788/262402 ns, total 5793178,
nb (tot/exp) 14/14
3960 [main] DEBUG spotter  - Total time spent (14 result(s)) : 6ms
3960 [main] DEBUG spotter  - Optimize duration : 0ms
3961 [main] DEBUG spotter  - Total time spent (0 result(s)) : 1ms
3962 [main] DEBUG spotter  - Optimize duration : 0ms
3963 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 1965/93425/268487 ns, total
1184984, nb (tot/exp) 1/1
3964 [main] DEBUG spotter  - Total time spent (1 result(s)) : 2ms
3965 [main] DEBUG spotter  - Optimize duration : 0ms
3967 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 491/72793/281611 ns, total 2350723,
nb (tot/exp) 4/4
3968 [main] DEBUG spotter  - Total time spent (4 result(s)) : 3ms
3969 [main] DEBUG spotter  - Optimize duration : 0ms
3977 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 401/63903/1295728 ns, total
7711169, nb (tot/exp) 5/5
3978 [main] DEBUG spotter  - Total time spent (5 result(s)) : 9ms
3979 [main] DEBUG spotter  - Optimize duration : 0ms
3981 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 14021/111567/338183 ns, total
1648622, nb (tot/exp) 1/1
3982 [main] DEBUG spotter  - Total time spent (1 result(s)) : 3ms
3983 [main] DEBUG spotter  - Optimize duration : 0ms
3984 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 3293/112318/341581 ns, total
1415179, nb (tot/exp) 1/1
3985 [main] DEBUG spotter  - Total time spent (1 result(s)) : 2ms
3986 [main] DEBUG spotter  - Optimize duration : 0ms
3989 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 1136/87271/318269 ns, total
2217341, nb (tot/exp) 3/3
3989 [main] DEBUG spotter  - Total time spent (3 result(s)) : 3ms
3991 [main] DEBUG spotter  - Optimize duration : 0ms
3994 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 630/82683/316651 ns, total 3105836,
nb (tot/exp) 5/5
3995 [main] DEBUG spotter  - Total time spent (5 result(s)) : 4ms
3996 [main] DEBUG spotter  - Optimize duration : 0ms
4001 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 115/60577/258742 ns, total 5592868,
nb (tot/exp) 14/14
4002 [main] DEBUG spotter  - Total time spent (14 result(s)) : 7ms
4003 [main] DEBUG spotter  - Optimize duration : 0ms
4009 [main] DEBUG spotter  - next/exportForSort/export
(MATCHES_WITH_OFFSET) average : 139/62011/287332 ns, total 6125691,
nb (tot/exp) 14/14
4010 [main] DEBUG spotter  - Total time spent (14 result(s)) : 7ms



-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42611-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 15:13:19 2009
Return-Path: <java-user-return-42611-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10331 invoked from network); 5 Oct 2009 15:13:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 15:13:19 -0000
Received: (qmail 75887 invoked by uid 500); 5 Oct 2009 15:13:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75819 invoked by uid 500); 5 Oct 2009 15:13:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75809 invoked by uid 99); 5 Oct 2009 15:13:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 15:13:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 15:13:05 +0000
Received: by bwz22 with SMTP id 22so2676430bwz.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 08:11:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:date:message-id
         :subject:from:to:content-type;
        bh=dJfMNJJbGav5u2UpB5uMCxvwkg16ZrYhbA63F0ySPuI=;
        b=oqhrW9YoVUnyV0CYZKEnKlIhaeSb9CMuwpufI4auBSfnupO1BdV8av3KPX0gg+3Drs
         RfOu/3VJWdbIOYhP4vJ26H//xr0BjGR7T25n+q4STC/97ZVIO/BjvT44rkUFfTfzIf4j
         x5vxnRvgykWdhc+EiBtvrZ8KqxXXpR/y3TxA8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:date:message-id:subject:from:to:content-type;
        b=CLE2OqV2X/ToagKeGwzdUaGEV/FrpiLjJGVb4E01BTGkJx+bFo9N1MPYIEIaWKaise
         1Zx9UtJKt0keOpXrj3kjH4wVAsUkajJeWvqvwmNh0PKCk+mYTJKvV4UC37kUPSxjDEwo
         oADf/WPp5OyQ6w/nZgpwCf0PC3vK1QEW3/J3g=
MIME-Version: 1.0
Received: by 10.239.163.202 with SMTP id q10mr11380hbd.129.1254755505123; Mon, 
	05 Oct 2009 08:11:45 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
Date: Mon, 5 Oct 2009 17:11:45 +0200
Message-ID: <f18c9dde0910050811p566c90c5j9419aa61539522fc@mail.gmail.com>
Subject: German article about Lucene 2.9
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f20b7a29b2c904753188f5
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f20b7a29b2c904753188f5
Content-Type: text/plain; charset=UTF-8

Hey Lucene Users,

Heise.de (
http://www.heise.de/open/artikel/Such-Engine-Lucene-in-Version-2-9-erschienen-810377.html)
has just published an article about the new 2.9 release.
Unfortunately they only published the german version while we tried to get
the english one too. Thanks to Isabel (http://blog.isabel-drost.de/) again
for all the work.

simon

--001485f20b7a29b2c904753188f5--

From java-user-return-42612-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 05 15:52:52 2009
Return-Path: <java-user-return-42612-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21324 invoked from network); 5 Oct 2009 15:52:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 5 Oct 2009 15:52:52 -0000
Received: (qmail 53462 invoked by uid 500); 5 Oct 2009 15:52:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53394 invoked by uid 500); 5 Oct 2009 15:52:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53384 invoked by uid 99); 5 Oct 2009 15:52:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 15:52:50 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 05 Oct 2009 15:52:37 +0000
Received: by bwz22 with SMTP id 22so2712481bwz.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 08:51:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=YRkSNlYmdXuvIpCmjw1MFV4txqNnV4hK5HePvoB3U9k=;
        b=RGnLjc/LD76+O2axVlADwjxxkWagPFapFpeqniDWWpvzIjdA+mhqWV4bya4sl52eyk
         DUKMBOS3HPCs3rGeTCfsVIQ+U0ayCx8tucyD4i4h3FElhuOExuYeI6EZqyZc+MB+brdV
         Iv19nMcKATw4E7pZomeY87eWsvo5oFcVIBHlE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=Hicl3aXTMHzTvgb8pBc8S9ARHmLxyw7KRwaePlCELGb342SEkfOYE/+0sK47oW4oNp
         SdP/B36wI8L5b/OBKgtng5+1wbQ9SivKV8PIigHO5/kadacFuzQvTNYiDWDGGYTRqDs+
         VWGzq1i1lrDpz61ehhl0RQWytfW60LTeep3Eg=
MIME-Version: 1.0
Received: by 10.239.138.23 with SMTP id n23mr14544hbn.154.1254757877226; Mon, 
	05 Oct 2009 08:51:17 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <f18c9dde0910050811p566c90c5j9419aa61539522fc@mail.gmail.com>
References: <f18c9dde0910050811p566c90c5j9419aa61539522fc@mail.gmail.com>
Date: Mon, 5 Oct 2009 17:51:17 +0200
Message-ID: <f18c9dde0910050851y4d6f34e9lc39b2f4349e81e7d@mail.gmail.com>
Subject: Re: German article about Lucene 2.9
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Here is the english version of the article for those who are interested.

Lucene version 2.9 released

Content-Management systems like the ones powering the channels at AOL,
social networks like LinkedIn, the cloud nebula cloud computing
platform at NASA: Nearly no application that does not need to
implement search functionality. In many cases, behind the search boxes
Lucene is at work: Initially written by Doug Cutting, the search index
is being developed by a large and diverse community as a project at
the Apache Software Foundation since eight years.

Last week on Friday version 2.9 was released. Lucene committer Uwe
Schindler gave an overview of the new features of Lucene at the Apache
Hadoop Get Together at newthinking store Berlin: Especially
interesting for current users are the many performance improvements:
The new version brings per-segment searches and caches, near real-time
search. Identification and sorting of hits will be faster due to
optimizations in the collector- and scorer APIs. First analysis
http://www.lucidimagination.com/blog/2009/09/22/contrived-fieldcache-load-test-lucene-2-4-vs-lucene-2-9/
look very good.

Most notably the refactoring towards per-segment search can yield
performance improvements for a vast number of users. Per-Segment
search takes advantage of the fact that the majority of segments don't
change when an index is modified. If necessary at all segments are
only reloaded partially which reduces the time to re-open an index,
enables the reuse of internal cache structures and prevents a large
amount of objects from being garbage collected.

Beside runtime improvements and many changes of expert APIs, Lucene
2.9 introduces a new "TokenStream" API. The new API introduces
stronger typing and enables developers to place arbitrary attributes
on a "Token" level within the analysis process. One example use case
of this API is to annotate terms with type information that can be
reused at later analysis stages or during indexing. That way one can
mark terms that represent places, names or companies with so-called
named-entity-recognition software. The former "Token"-API has been
marked as "deprecated" and will be removed in Lucenes next major
release. Custom Analyzers and TokenStreams based on older releases
should be re-factored to use the new API which represents the major
downside of this API change.

Especially geo- and product searches benefit from an improved,
trie-based range query implementation: Searches for products within a
range of prizes instead of exact prizes will be substantially faster
after the upgrade. In addition highlighting of found query terms in
large documents has been optimized.

Beside the improvements on the Lucene-Core version 2.9 introduces
several new contrib modules. Lucene-spatial formerly known as "Local
Lucene" has been donated to the Apache Lucene Project earlier this
year. This new module brings basic support for localized and distance
search as well as filter and sort capabilities of search results based
on GeoHash and Cartesien Tiers. The lucene-remote module moved Lucenes
dependency on JAVA RMI from the core into a optional contrib module
which enables the new release to run on platforms with a reduced
standard library like Android on a "as is" basis. As a further
addition a new and more flexible Query-Parser was introduced that is
fully compatibile with the existing core Query-Parser syntax.
Lucene-queryparser provides extended programmatic control for
customization and cleanly separates the syntax from its internal
representation. After all a great improvement for users aiming to
build their own query syntax for Lucene.

The new Lucene version comes with new query types, enhanced payload
queries as well as new multi term queries that allow for wild cards.
The components responsible for parsing indexed documents have been
extended to support for persian and arabic languages. Support for
Chinese document processing has been improved as well.

But the release does not only bring lots of new features and
performance improvements. In some cases the API was changed. So
instead of doing a drop in replacement of the old version it is
recommended to carefully read the release notes and changes and
recompile the code that uses Lucene to identify any incompatibilities
early on.

Version 2.9 is the last release before 3.0 that is expected in the
near future. Version 3.0 will remove any code currently marked as
deprecated. In addition this new version will be the first to have JVM
1.5 as a requirement instead of 1.4.
A detailed analysis of the changes in Lucene 2.9 is available online
as webinar at http://www.lucidimagination.com/blog/2009/09/22/lucene29_webinar/.
Early November Apache Con US http://us.apachecon.com/c/acus2009 has
lots of room for discussions with developers in trainings, two Lucene
conference tracks and several user meetups.

On Mon, Oct 5, 2009 at 5:11 PM, Simon Willnauer
<simon.willnauer@googlemail.com> wrote:
>
> Hey Lucene Users,
>
> Heise.de (http://www.heise.de/open/artikel/Such-Engine-Lucene-in-Version-2-9-erschienen-810377.html) has just published an article about the new 2.9 release.
> Unfortunately they only published the german version while we tried to get the english one too. Thanks to Isabel (http://blog.isabel-drost.de/) again for all the work.
>
> simon

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42613-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 00:32:05 2009
Return-Path: <java-user-return-42613-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9263 invoked from network); 6 Oct 2009 00:32:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 00:32:05 -0000
Received: (qmail 44516 invoked by uid 500); 6 Oct 2009 00:32:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44428 invoked by uid 500); 6 Oct 2009 00:32:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44418 invoked by uid 99); 6 Oct 2009 00:32:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 00:32:03 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nigelspleen@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 00:31:53 +0000
Received: by bwz22 with SMTP id 22so3057141bwz.5
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 17:30:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ffSVmg8vRXku70dcQDVTsInxB9ALLBY67TKKTcPrAus=;
        b=BEHva3aqOmVnLbLTEDWmZnFmLkjdA2t7s8mH6RPFcXkPYGOKqD1A0Iyqb5x6x2rvKk
         s/PTgKPQwf9QwlYwtULD2QOKM9zYO/7r+sXU5Q/r0YBiVvnMLPK7ehB/kEmglRzNYtAj
         aTjCs0CsQxGCZuUgFPo4fG9xeLBB/WhFJFNv4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=NCsXLapIIGSUzbWgmHSjfbbZ1UmLw+3HKPc+efNuLaK9UdmnpfE4R8k78f0T+gGSil
         X0WguoPmxDR6SSZ/XeWw1o0UCx1k8gIcBGYsMv0TK99zUC8tqKgcM1APIvjY38qEWtyH
         DfRyAxQ+HIUrovtqUbCK8KQ+mNOs8IYAI7CX8=
MIME-Version: 1.0
Received: by 10.103.48.26 with SMTP id a26mr349992muk.83.1254789033115; Mon, 
	05 Oct 2009 17:30:33 -0700 (PDT)
In-Reply-To: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
Date: Mon, 5 Oct 2009 20:30:33 -0400
Message-ID: <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
From: Nigel <nigelspleen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e659f6889641f204753956d4
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e659f6889641f204753956d4
Content-Type: text/plain; charset=ISO-8859-1

Anyone have any ideas here?  I imagine a lot of other people will have a
similar question when trying to take advantage of the reopen improvements in
2.9.

Thanks,
Chris

On Thu, Oct 1, 2009 at 5:15 PM, Nigel <nigelspleen@gmail.com> wrote:

> I have a question about the reopen functionality in Lucene 2.9.  As I
> understand it, since FieldCaches are now per-segment, it can avoid reloading
> everything when the index is reopened, and instead just load the new
> segments.
>
> For background, like many people we have a distributed architecture where
> indexes are created on one server and copied to multiple other servers.  The
> way that copying works now is something like the following:
>
>    1. Let's say the current index is in /indexes/a and is open
>    2. An empty directory for the updated index is created, let's say
>    /indexes/b
>    3. Hard links for the files in /indexes/a are created in /indexes/b
>    4. We rsync the current index on the server with /indexes/b, thus
>    copying over new cfs files and deleting hard links to files no longer in use
>    5. A new IndexReader is opened for /indexes/b and warmed up
>    6. The application starts using the new reader instead of the old one
>    7. The old IndexReader is closed and /indexes/a is deleted
>
> I'm simplifying a few steps, but I think this is familiar to many people,
> and it's my impression that Solr implements something similar.
>
> The point is, the updated index lives in a new directory in this scheme,
> and so we don't actually reopen the existing IndexReader; we open a new one
> with a different FSDirectory.
>
> Before Lucene 2.9, I don't think this made any difference, as (I think) the
> only advantage to calling reopen vs. just creating another IndexReader was
> having reopen figure out whether the index had actually changed.  (And whave
> a different way to figure that out, so it was a non-issue.)
>
> With Lucene 2.9, there's now a big difference, namely the per-segment
> caching mentioned above.  So the question is how to make use of reopen with
> our distribution scheme.  Is there an informal best practice for handling
> this case?  For example, should step #5 above rename /indexes/b to
> /indexes/a so the index can be reopened in the same physical location?  Or
> should rsync operate on the existing directory in-place, updating the
> segments* files last and relying on the fact that deleted files will not
> really be deleted (on Linux, at least) as long as the app is still holding
> them open?
>
> I guess the answer may depend on how exactly reopen knows which files are
> the "same" (e.g. does it look at filenames, or file descriptors, etc.).
>
> Thanks,
> Chris
>

--0016e659f6889641f204753956d4--

From java-user-return-42614-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 00:41:02 2009
Return-Path: <java-user-return-42614-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17508 invoked from network); 6 Oct 2009 00:41:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 00:41:02 -0000
Received: (qmail 58321 invoked by uid 500); 6 Oct 2009 00:41:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58249 invoked by uid 500); 6 Oct 2009 00:41:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58239 invoked by uid 99); 6 Oct 2009 00:41:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 00:41:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 74.125.92.24 as permitted sender)
Received: from [74.125.92.24] (HELO qw-out-2122.google.com) (74.125.92.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 00:40:51 +0000
Received: by qw-out-2122.google.com with SMTP id 5so1241828qwi.53
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 17:39:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=TSS/jXsy6FEq6eA0pUQcTibEnKkFqU7+LA0+JoSAlHk=;
        b=SLWtYmT7CKNKkXTEhLaQsxws7LZAHf9cldD6IWmbP/K9XEgsNUEyKjAz0AkBij5wkA
         s579D7wfqPnYmgQbRGWWm8Ly3Ju/uVUyKZFdOlLeLLOKW/ZAg+S8U/Z8DsxNfWwndNdX
         hkD/Te9WjfZL2b3loyZRoVy2kvZMML/ad/Qfs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=EWitLfUBjIsjEH72zOBxaPpoQe8udf3w4+raMHiv0dK1arII4xDy6wihoSyBjtxgap
         /6nxz9UOBcwXuqK+HwqPuMUBZMkF4xRebe2eHrn0M3BeY+1Ifcm2/wVVadIJDhPp1Ijo
         DMGart+IH8EjPSQY3zqFLUkYUaXbkneQ8yMKU=
MIME-Version: 1.0
Received: by 10.224.56.208 with SMTP id z16mr772253qag.144.1254789570017; Mon, 
	05 Oct 2009 17:39:30 -0700 (PDT)
In-Reply-To: <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
	 <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
Date: Mon, 5 Oct 2009 17:39:29 -0700
Message-ID: <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com>
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

I'm not sure I understand the question. You're trying to reopen
the segments that you're replicated and you're wondering what's
changed in Lucene?

On Mon, Oct 5, 2009 at 5:30 PM, Nigel <nigelspleen@gmail.com> wrote:
> Anyone have any ideas here? =A0I imagine a lot of other people will have =
a
> similar question when trying to take advantage of the reopen improvements=
 in
> 2.9.
>
> Thanks,
> Chris
>
> On Thu, Oct 1, 2009 at 5:15 PM, Nigel <nigelspleen@gmail.com> wrote:
>
>> I have a question about the reopen functionality in Lucene 2.9. =A0As I
>> understand it, since FieldCaches are now per-segment, it can avoid reloa=
ding
>> everything when the index is reopened, and instead just load the new
>> segments.
>>
>> For background, like many people we have a distributed architecture wher=
e
>> indexes are created on one server and copied to multiple other servers. =
=A0The
>> way that copying works now is something like the following:
>>
>> =A0 =A01. Let's say the current index is in /indexes/a and is open
>> =A0 =A02. An empty directory for the updated index is created, let's say
>> =A0 =A0/indexes/b
>> =A0 =A03. Hard links for the files in /indexes/a are created in /indexes=
/b
>> =A0 =A04. We rsync the current index on the server with /indexes/b, thus
>> =A0 =A0copying over new cfs files and deleting hard links to files no lo=
nger in use
>> =A0 =A05. A new IndexReader is opened for /indexes/b and warmed up
>> =A0 =A06. The application starts using the new reader instead of the old=
 one
>> =A0 =A07. The old IndexReader is closed and /indexes/a is deleted
>>
>> I'm simplifying a few steps, but I think this is familiar to many people=
,
>> and it's my impression that Solr implements something similar.
>>
>> The point is, the updated index lives in a new directory in this scheme,
>> and so we don't actually reopen the existing IndexReader; we open a new =
one
>> with a different FSDirectory.
>>
>> Before Lucene 2.9, I don't think this made any difference, as (I think) =
the
>> only advantage to calling reopen vs. just creating another IndexReader w=
as
>> having reopen figure out whether the index had actually changed. =A0(And=
 whave
>> a different way to figure that out, so it was a non-issue.)
>>
>> With Lucene 2.9, there's now a big difference, namely the per-segment
>> caching mentioned above. =A0So the question is how to make use of reopen=
 with
>> our distribution scheme. =A0Is there an informal best practice for handl=
ing
>> this case? =A0For example, should step #5 above rename /indexes/b to
>> /indexes/a so the index can be reopened in the same physical location? =
=A0Or
>> should rsync operate on the existing directory in-place, updating the
>> segments* files last and relying on the fact that deleted files will not
>> really be deleted (on Linux, at least) as long as the app is still holdi=
ng
>> them open?
>>
>> I guess the answer may depend on how exactly reopen knows which files ar=
e
>> the "same" (e.g. does it look at filenames, or file descriptors, etc.).
>>
>> Thanks,
>> Chris
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42615-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 01:47:17 2009
Return-Path: <java-user-return-42615-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32193 invoked from network); 6 Oct 2009 01:47:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 01:47:17 -0000
Received: (qmail 4607 invoked by uid 500); 6 Oct 2009 01:47:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4522 invoked by uid 500); 6 Oct 2009 01:47:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4512 invoked by uid 99); 6 Oct 2009 01:47:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 01:47:15 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of buschmic@gmail.com designates 209.85.219.214 as permitted sender)
Received: from [209.85.219.214] (HELO mail-ew0-f214.google.com) (209.85.219.214)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 01:47:04 +0000
Received: by ewy10 with SMTP id 10so3700036ewy.9
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 18:46:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=Rumwolx3TBx40k+Mlroy6SI8APG7r8KPxOdu7kXYnqo=;
        b=QF7ew/2M44juYIv7bblS/YMnzJlB1SBtyFKQpEXnV1gjJBBv624pVYx3mTVHhObMsY
         ZEIoE9Al7NHXfYRiVicZyJ9yYjwBBxAbYOgad9PeOGXF62MuqsAb6uHaFSCL82JROfF+
         4HFSiUmD7aMWqKuR7O2u83tnYTZt0TpiK7bXU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=toStLU9T0Mv0aWkjmdZWW4ikbKF5LXXkD9e+jxgB7yJfOHH4DRSg8WMWs0grILyXyj
         VeZjezmP1S8iEnNUhrLFH2oaNJVKyAmOkkvGmrNWw2qMSbkn1+g5uODLZBhpea/q9Jal
         rJYmJWfp4WPSq41Zkr9CoR/exDqDjD12nGOjQ=
Received: by 10.210.96.12 with SMTP id t12mr4087992ebb.71.1254793604747;
        Mon, 05 Oct 2009 18:46:44 -0700 (PDT)
Received: from michael-buschs-macbook-pro-2.local (c-98-248-34-169.hsd1.ca.comcast.net [98.248.34.169])
        by mx.google.com with ESMTPS id 28sm490570eyg.4.2009.10.05.18.46.42
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 05 Oct 2009 18:46:43 -0700 (PDT)
Message-ID: <4ACAA17F.4000709@gmail.com>
Date: Mon, 05 Oct 2009 18:46:39 -0700
From: Michael Busch <buschmic@gmail.com>
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090915 Thunderbird/3.0b4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com> <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
In-Reply-To: <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org



On 10/5/09 5:30 PM, Nigel wrote:
>> Before Lucene 2.9, I don't think this made any difference, as (I think) the
>> only advantage to calling reopen vs. just creating another IndexReader was
>> having reopen figure out whether the index had actually changed.  (And whave
>> a different way to figure that out, so it was a non-issue.)
>>
>>      

There was a big difference before too: reopen() in 2.4.x only loads 
internal data structures from new segments, like the terms dictionary 
and norms. The performance improvements were significant already (see 
https://issues.apache.org/jira/browse/LUCENE-743?focusedCommentId=12532585&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12532585). 
Now in 2.9 this also works for field caches.

  Michael

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42616-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 01:49:01 2009
Return-Path: <java-user-return-42616-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32393 invoked from network); 6 Oct 2009 01:49:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 01:49:01 -0000
Received: (qmail 6476 invoked by uid 500); 6 Oct 2009 01:48:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6386 invoked by uid 500); 6 Oct 2009 01:48:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6375 invoked by uid 99); 6 Oct 2009 01:48:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 01:48:58 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.221.189 as permitted sender)
Received: from [209.85.221.189] (HELO mail-qy0-f189.google.com) (209.85.221.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 01:48:47 +0000
Received: by qyk27 with SMTP id 27so2312635qyk.20
        for <java-user@lucene.apache.org>; Mon, 05 Oct 2009 18:47:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=WrlycW2FmYwLjy1DyinMtqsja8VohSsmLRZDwMiP8n8=;
        b=UUQIib/2xGi1pP2WSCNJIs5Y6gw24npDJwREQZCFCbXAsI7eXTwHRHsG+03xDME4Be
         6jLGfL0lw7lBNlA/+Zmt0CvGU9h/4aCV0zk6/L0PNCq+ubiR43ikUTna+FefzOt0gfDp
         obszd0JUtSY3yLVCcJjoQYZ4WuaN++VfUPm8g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=aLONxAWO4TQkgr1FRNbOb/7yVFlLKOECx2EnBSp4qHyS6WWwYaHi/dZbX2Ekp5NxAG
         Vgqc4YgpMF9GgoTZbqsCnsSG8EWtFPf2OEWhPRSRdw8MvjKqxK+i0I2pPIBCrBeBpVMm
         ji43YP7wZdLVIGCbImWO4QjZPlHGTg5uERD8A=
Received: by 10.224.44.89 with SMTP id z25mr806311qae.153.1254793646474;
        Mon, 05 Oct 2009 18:47:26 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 4sm67411qwe.38.2009.10.05.18.47.25
        (version=SSLv3 cipher=RC4-MD5);
        Mon, 05 Oct 2009 18:47:25 -0700 (PDT)
Message-ID: <4ACAA1AD.2020401@gmail.com>
Date: Mon, 05 Oct 2009 21:47:25 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com> <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
In-Reply-To: <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

I keep considering a full response too this, but I just can't get over
the hump and spend the time writing something up. Figured someone else
would get to it - perhaps they still will.

I will make a comment here though:

>Before Lucene 2.9, I don't think this made any difference, as (I think) the
>only advantage to calling reopen vs. just creating another IndexReader was
>having reopen figure out whether the index had actually changed.  (And whave
>a different way to figure that out, so it was a non-issue.)

Thats not quite right. Reopen did not just check if the index had
changed - it also only reloaded the segments that changed. The big
change allowed by per segment searching is that now only the *FieldCache
pieces that have changed* are also reloaded, rather than the whole
FieldCache. So reopen was nice and advantageous before - but now it is
more so if you are using FieldCaches.


Nigel wrote:
> Anyone have any ideas here?  I imagine a lot of other people will have a
> similar question when trying to take advantage of the reopen improvements in
> 2.9.
>
> Thanks,
> Chris
>
> On Thu, Oct 1, 2009 at 5:15 PM, Nigel <nigelspleen@gmail.com> wrote:
>
>   
>> I have a question about the reopen functionality in Lucene 2.9.  As I
>> understand it, since FieldCaches are now per-segment, it can avoid reloading
>> everything when the index is reopened, and instead just load the new
>> segments.
>>
>> For background, like many people we have a distributed architecture where
>> indexes are created on one server and copied to multiple other servers.  The
>> way that copying works now is something like the following:
>>
>>    1. Let's say the current index is in /indexes/a and is open
>>    2. An empty directory for the updated index is created, let's say
>>    /indexes/b
>>    3. Hard links for the files in /indexes/a are created in /indexes/b
>>    4. We rsync the current index on the server with /indexes/b, thus
>>    copying over new cfs files and deleting hard links to files no longer in use
>>    5. A new IndexReader is opened for /indexes/b and warmed up
>>    6. The application starts using the new reader instead of the old one
>>    7. The old IndexReader is closed and /indexes/a is deleted
>>
>> I'm simplifying a few steps, but I think this is familiar to many people,
>> and it's my impression that Solr implements something similar.
>>
>> The point is, the updated index lives in a new directory in this scheme,
>> and so we don't actually reopen the existing IndexReader; we open a new one
>> with a different FSDirectory.
>>
>> Before Lucene 2.9, I don't think this made any difference, as (I think) the
>> only advantage to calling reopen vs. just creating another IndexReader was
>> having reopen figure out whether the index had actually changed.  (And whave
>> a different way to figure that out, so it was a non-issue.)
>>
>> With Lucene 2.9, there's now a big difference, namely the per-segment
>> caching mentioned above.  So the question is how to make use of reopen with
>> our distribution scheme.  Is there an informal best practice for handling
>> this case?  For example, should step #5 above rename /indexes/b to
>> /indexes/a so the index can be reopened in the same physical location?  Or
>> should rsync operate on the existing directory in-place, updating the
>> segments* files last and relying on the fact that deleted files will not
>> really be deleted (on Linux, at least) as long as the app is still holding
>> them open?
>>
>> I guess the answer may depend on how exactly reopen knows which files are
>> the "same" (e.g. does it look at filenames, or file descriptors, etc.).
>>
>> Thanks,
>> Chris
>>
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42617-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 07:32:12 2009
Return-Path: <java-user-return-42617-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5932 invoked from network); 6 Oct 2009 07:32:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 07:32:12 -0000
Received: (qmail 23930 invoked by uid 500); 6 Oct 2009 07:32:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23878 invoked by uid 500); 6 Oct 2009 07:32:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23814 invoked by uid 99); 6 Oct 2009 07:32:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 07:32:11 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [202.238.89.67] (HELO leangen.net) (202.238.89.67)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 06 Oct 2009 07:32:00 +0000
Received: (qmail 26141 invoked from network); 6 Oct 2009 07:43:11 -0000
Received: from 115x125x17x138.ap115.ftth.ucom.ne.jp (HELO ?192.168.2.9?) (115.125.17.138)
  by leangen.net with SMTP; 6 Oct 2009 07:43:11 -0000
From: David Leangen <apache@leangen.net>
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Subject: Reverse stemmer?
Date: Tue, 6 Oct 2009 16:31:36 +0900
Message-Id: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1076)
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org


Hello,

I've been using Lucene in a very basic way for some time now, and I'm  
starting to take advantage of some of the linguistic capabilities only  
now.

I am making use of the snowball analyzer for stemming, and it works  
very well.


Question: is there any such thing as a "reverse stemmer"? In other  
words, given the stem of a word, is there any algorithm to find the  
original word? Or is this just fantasy? ;-)

Now, I understand that there is a 1:n mapping of stems:words. I can  
deal with that.


Thanks!
=David



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42618-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 11:42:56 2009
Return-Path: <java-user-return-42618-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59908 invoked from network); 6 Oct 2009 11:42:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 11:42:56 -0000
Received: (qmail 94035 invoked by uid 500); 6 Oct 2009 11:42:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93963 invoked by uid 500); 6 Oct 2009 11:42:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93953 invoked by uid 99); 6 Oct 2009 11:42:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 11:42:53 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rooseve6891@gmail.com designates 209.85.216.204 as permitted sender)
Received: from [209.85.216.204] (HELO mail-px0-f204.google.com) (209.85.216.204)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 11:42:44 +0000
Received: by pxi42 with SMTP id 42so3712774pxi.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 04:42:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=bWCN0aNE3rhoQ9mGm+CMfQ0q/coBleKJ1hzKqBuT8R0=;
        b=DRC0CP0mEykG6a5634+MNpIC3nccXjDaltrhfA2eciTcfucw5GrFf2MKD/Xwe2rz4N
         kbFOa+jd8FSw7vzni+Ocq+WK4univwsjfzzcXF2Xt7A9edqLxP/cDFWIuYVGO/NMKuso
         zBGWoa2W+/AvjvPHG8mWDofoBFeGEcx2r//bY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=V4xTRMtCRelj+SBb4YLTVXMufjEG4M2szH7raGBxRlUpVKH6MOR/ZvgjTqFSCO5v5Z
         NYjCxYlx2wj+qKhpTEiXrSjNl4Ju8u8r+2YpTLB3hsxyRsFYUv0gekPZnOmaHFOdyPVs
         K0EMQqTJfK8Xc/G9XkUycf4aif4BqD96xQhb0=
MIME-Version: 1.0
Received: by 10.115.133.39 with SMTP id k39mr2172676wan.94.1254829343024; Tue, 
	06 Oct 2009 04:42:23 -0700 (PDT)
Date: Tue, 6 Oct 2009 19:42:23 +0800
Message-ID: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
Subject: Phase Extraction, mainly for English
From: Andrew Zhang <rooseve6891@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6477a943ea6c9047542b907
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6477a943ea6c9047542b907
Content-Type: text/plain; charset=ISO-8859-1

Hi guys,

The requirement is very simple here, e.g. for this sentence, 'The NBA
formally announced its new *social media* guidelines Wednesday',  I want to
treat '*social media*' as a whole phase term. The default english analyzers
came with lucene all deal with single word, so it you want to get the most
frequent terms, *social *and *media* are separated, and each of them can't
represent a good meaning as *social media*, right?

I know there's a way built on some phase dictionary, and try to match the
phase already there, very like the way to do with chinese language, but is
there an open source solution for english, I mean I don't want to build a
phase dictionary myself, and I also want a smart way, which can "discover"
the phase automatically. I got 2 millions docs analyzered the norma way, all
single terms, which I can use as a base source, and it's possible to find
that *social media *came together frequently, but I really don't know what's
the reverse way.

I tried to find some phase analyzers, but no luck. so any advices?

Regards,
Andrew
-- 
Simple is best

--0016e6477a943ea6c9047542b907--

From java-user-return-42619-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 12:11:19 2009
Return-Path: <java-user-return-42619-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68470 invoked from network); 6 Oct 2009 12:11:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 12:11:19 -0000
Received: (qmail 30697 invoked by uid 500); 6 Oct 2009 12:11:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30631 invoked by uid 500); 6 Oct 2009 12:11:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30621 invoked by uid 99); 6 Oct 2009 12:11:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:11:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:11:07 +0000
Received: by iwn16 with SMTP id 16so1402711iwn.29
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 05:09:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=DzVioSEDupBrmR12Z9F7u0/xngIOzgIlyovVFpzNpcs=;
        b=HevR0b4XSM/NWZ9Ox1CumsBLcNKGEiGUysoJc8znA2s2e/1+L5jc1wVtjXe8k9g9Q6
         1l+JViG1T430R1YJRGLNy+iKmssWA466kE4y17fg5OhI2jFEN+KQX+gYCjZHhwAcyou2
         8L2kxQ4j5uCwoH1zyEO+y1mAYxLMFv92USl4Q=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Zk7cPReUeLS9dcUPlrA6aBxLgIp3Jz4gbiEoke4lVcWRdaKTPPAqUzf+v1sbBfnQ7r
         7UvZoM6OHxt19RakkSmP3anR9RFLiV8nVuAq+Tvb798nVc7xDdAAmBqzwCSxuk0APFvy
         DT5zLIFspJOhss7+FxWU2pWlcKk00AjbVGyXY=
MIME-Version: 1.0
Received: by 10.231.125.100 with SMTP id x36mr2411894ibr.52.1254830986860; 
	Tue, 06 Oct 2009 05:09:46 -0700 (PDT)
In-Reply-To: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
Date: Tue, 6 Oct 2009 08:09:46 -0400
Message-ID: <359a92830910060509t2d19d1c1v7554ced6116f204c@mail.gmail.com>
Subject: Re: Reverse stemmer?
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e646432c3998290475431bae
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e646432c3998290475431bae
Content-Type: text/plain; charset=ISO-8859-1

Why do you care? That is, what is the problem you want to solve with a
reversestemmer? Note that if you STORE the field, the *original* text is
available, storing
and indexing are orthogonal. So if all you want is to get the original text
back,
you can freely index with a stemming analyzer, but just fetch the stored
data back and it won't be stemmed....

Erick

On Tue, Oct 6, 2009 at 3:31 AM, David Leangen <apache@leangen.net> wrote:

>
> Hello,
>
> I've been using Lucene in a very basic way for some time now, and I'm
> starting to take advantage of some of the linguistic capabilities only now.
>
> I am making use of the snowball analyzer for stemming, and it works very
> well.
>
>
> Question: is there any such thing as a "reverse stemmer"? In other words,
> given the stem of a word, is there any algorithm to find the original word?
> Or is this just fantasy? ;-)
>
> Now, I understand that there is a 1:n mapping of stems:words. I can deal
> with that.
>
>
> Thanks!
> =David
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e646432c3998290475431bae--

From java-user-return-42620-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 12:12:27 2009
Return-Path: <java-user-return-42620-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68589 invoked from network); 6 Oct 2009 12:12:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 12:12:26 -0000
Received: (qmail 32584 invoked by uid 500); 6 Oct 2009 12:12:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32499 invoked by uid 500); 6 Oct 2009 12:12:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32489 invoked by uid 99); 6 Oct 2009 12:12:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:12:24 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of vcomandur@gmail.com designates 209.85.216.204 as permitted sender)
Received: from [209.85.216.204] (HELO mail-px0-f204.google.com) (209.85.216.204)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:12:15 +0000
Received: by pxi42 with SMTP id 42so3730318pxi.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 05:10:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=MSXMEWGl8hbmH+ScEVLcUDQdiGq275htCd9U/89irkc=;
        b=OfM40gjIkVZBKUkSETZ0k+gTniBK+qcOpRKc/at0hHXOsHCAhRzjz2Z9eFLxks2gzZ
         J6JXo4uBvFmvylddagSL4K4BS4lRdn+BydF92ucwHQk3+ZZSbYeTnQKLhD9lVOlxd05M
         Sv7PC6B8tEBrSZ13IUuLitLBV2NBojNRkw++c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Q3hO6nXCq0m6+FdpdE/s1MXKjZVWLk240c3evFOBJ0N+fEMNOVs5p81TdVg1VAlCDP
         uRWcWbk5kNNBV+7qTRb2ItigerARnTr/Ro4c/Zy13zRHj2uw975f/hGNbQRvCpQWCnhJ
         4rMSVKD4N461HLMDuTz20LARr9RHIvRl7CVa8=
MIME-Version: 1.0
Received: by 10.142.3.3 with SMTP id 3mr104396wfc.141.1254831054590; Tue, 06 
	Oct 2009 05:10:54 -0700 (PDT)
In-Reply-To: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
Date: Tue, 6 Oct 2009 17:40:54 +0530
Message-ID: <a59386fa0910060510p5f1ff643t4a36255e3127cb16@mail.gmail.com>
Subject: Re: Phase Extraction, mainly for English
From: Vasudevan Comandur <vcomandur@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368e270443160d0475431fb5
X-Virus-Checked: Checked by ClamAV on apache.org

--0016368e270443160d0475431fb5
Content-Type: text/plain; charset=ISO-8859-1

Hi,

   Take the NLP route and use modules like POS tagger and NP chunker.

   OpenNLP has a stack for English language. Try to use them.

Regards
 Vasu

On Tue, Oct 6, 2009 at 5:12 PM, Andrew Zhang <rooseve6891@gmail.com> wrote:

> Hi guys,
>
> The requirement is very simple here, e.g. for this sentence, 'The NBA
> formally announced its new *social media* guidelines Wednesday',  I want to
> treat '*social media*' as a whole phase term. The default english analyzers
> came with lucene all deal with single word, so it you want to get the most
> frequent terms, *social *and *media* are separated, and each of them can't
> represent a good meaning as *social media*, right?
>
> I know there's a way built on some phase dictionary, and try to match the
> phase already there, very like the way to do with chinese language, but is
> there an open source solution for english, I mean I don't want to build a
> phase dictionary myself, and I also want a smart way, which can "discover"
> the phase automatically. I got 2 millions docs analyzered the norma way,
> all
> single terms, which I can use as a base source, and it's possible to find
> that *social media *came together frequently, but I really don't know
> what's
> the reverse way.
>
> I tried to find some phase analyzers, but no luck. so any advices?
>
> Regards,
> Andrew
> --
> Simple is best
>

--0016368e270443160d0475431fb5--

From java-user-return-42621-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 12:12:34 2009
Return-Path: <java-user-return-42621-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68664 invoked from network); 6 Oct 2009 12:12:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 12:12:34 -0000
Received: (qmail 34288 invoked by uid 500); 6 Oct 2009 12:12:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34230 invoked by uid 500); 6 Oct 2009 12:12:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34220 invoked by uid 99); 6 Oct 2009 12:12:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:12:31 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:12:22 +0000
Received: by iwn16 with SMTP id 16so1403512iwn.29
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 05:12:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=/3MxMwyeP+vsCToYCv6R+K2cXw41cV5AEggQKiXfZIU=;
        b=QSd1URhwstwpACbgetpm+Kmw/eI4hJa/OutmsndjAxIMNeL0dCwO8URr4cEhIMf42g
         KWZLDdXpmsv1GBDpn+iJYLmE4UJsJjuxmZVJEpCjZQYXLQpsOFl1w1ICo2HdPxOwVYrw
         qyrMiAZ0uEnRgsahAWaqYBjZyx64HP3NC95KQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=iEqj/npkCnvhxx/NuPSRFk5KT74PhefV0zpfdsiBy7dYJAk+za/jiZuN5GAt4WRqMv
         AkhzuaDY0H29QCq01biihwtdDBn4EkZx8rcM59HxTplvNGkVM+Vht1gTqH6HGFSueR+A
         eqEzKVBf0ussDpr0qgD1RAeQgWvPHTiPWmgUE=
MIME-Version: 1.0
Received: by 10.231.4.75 with SMTP id 11mr2611661ibq.25.1254831121485; Tue, 06 
	Oct 2009 05:12:01 -0700 (PDT)
In-Reply-To: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
Date: Tue, 6 Oct 2009 08:12:01 -0400
Message-ID: <359a92830910060512v2aec94a0u5a55b70259d7bc11@mail.gmail.com>
Subject: Re: Phase Extraction, mainly for English
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015177404c63fd24f0475432365
X-Virus-Checked: Checked by ClamAV on apache.org

--0015177404c63fd24f0475432365
Content-Type: text/plain; charset=ISO-8859-1

Maybe I'm missing the problem entirely, but can you use phrase queries?or
one of the Span* queries with a slop of 0 when searching?

Best
Erick

On Tue, Oct 6, 2009 at 7:42 AM, Andrew Zhang <rooseve6891@gmail.com> wrote:

> Hi guys,
>
> The requirement is very simple here, e.g. for this sentence, 'The NBA
> formally announced its new *social media* guidelines Wednesday',  I want to
> treat '*social media*' as a whole phase term. The default english analyzers
> came with lucene all deal with single word, so it you want to get the most
> frequent terms, *social *and *media* are separated, and each of them can't
> represent a good meaning as *social media*, right?
>
> I know there's a way built on some phase dictionary, and try to match the
> phase already there, very like the way to do with chinese language, but is
> there an open source solution for english, I mean I don't want to build a
> phase dictionary myself, and I also want a smart way, which can "discover"
> the phase automatically. I got 2 millions docs analyzered the norma way,
> all
> single terms, which I can use as a base source, and it's possible to find
> that *social media *came together frequently, but I really don't know
> what's
> the reverse way.
>
> I tried to find some phase analyzers, but no luck. so any advices?
>
> Regards,
> Andrew
> --
> Simple is best
>

--0015177404c63fd24f0475432365--

From java-user-return-42622-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 12:39:08 2009
Return-Path: <java-user-return-42622-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75344 invoked from network); 6 Oct 2009 12:39:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 12:39:08 -0000
Received: (qmail 76701 invoked by uid 500); 6 Oct 2009 12:39:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76634 invoked by uid 500); 6 Oct 2009 12:39:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76624 invoked by uid 99); 6 Oct 2009 12:39:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:39:05 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of dragon-fly999@hotmail.com designates 65.55.111.113 as permitted sender)
Received: from [65.55.111.113] (HELO blu0-omc2-s38.blu0.hotmail.com) (65.55.111.113)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 12:38:54 +0000
Received: from BLU149-W54 ([65.55.111.73]) by blu0-omc2-s38.blu0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Tue, 6 Oct 2009 05:38:11 -0700
Message-ID: <BLU149-W54BFA6FF4AE7A61E4932E2B9CE0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_b9cd6bc3-d9ef-47e3-836b-9cd9e10ee1ca_"
X-Originating-IP: [137.103.1.90]
From: Dragon Fly <dragon-fly999@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: Document loading
Date: Tue, 6 Oct 2009 08:38:11 -0400
Importance: Normal
MIME-Version: 1.0
X-OriginalArrivalTime: 06 Oct 2009 12:38:11.0944 (UTC) FILETIME=[DDCD8680:01CA4681]
X-Virus-Checked: Checked by ClamAV on apache.org

--_b9cd6bc3-d9ef-47e3-836b-9cd9e10ee1ca_
Content-Type: text/plain; charset="Windows-1252"
Content-Transfer-Encoding: quoted-printable


Hi=2C

Which of the following method actually loads the document from disk?

(1) Document document =3D searcher.doc (docId)=3B

OR

(2) string value =3D document.get ("FirstNameField")=3B

It's probably searcher.doc but I just want to be sure.  Thank you. 		 	   	=
	  =0A=
_________________________________________________________________=0A=
Hotmail: Trusted email with Microsoft=92s powerful SPAM protection.=0A=
http://clk.atdmt.com/GBL/go/177141664/direct/01/=

--_b9cd6bc3-d9ef-47e3-836b-9cd9e10ee1ca_--

From java-user-return-42623-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 14:55:28 2009
Return-Path: <java-user-return-42623-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21686 invoked from network); 6 Oct 2009 14:55:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 14:55:28 -0000
Received: (qmail 13652 invoked by uid 500); 6 Oct 2009 14:55:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13596 invoked by uid 500); 6 Oct 2009 14:55:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13586 invoked by uid 99); 6 Oct 2009 14:55:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 14:55:25 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 14:55:15 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvBRG-0002un-PH
	for java-user@lucene.apache.org; Tue, 06 Oct 2009 07:54:54 -0700
Message-ID: <25770324.post@talk.nabble.com>
Date: Tue, 6 Oct 2009 07:54:54 -0700 (PDT)
From: ManjuNS <manjunath.ns@gmail.com>
To: java-user@lucene.apache.org
Subject: Help regarding choosing Indexing Stratergies
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: manjunath.ns@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


In my Application currently I am indexing Object with One Field[ID] to Hold
ID of the Object which is stored and attributes of Object into Another Field
[Content] to hold attribute information seperated by space and this Field is
tokenized. When I search for information related to the Object I get result
as ID and using that ID I fetech the information from backend and I show it
as search result.

Now the requirement is for some user of the application who don't have
access to attributes in Object and search on that attribute information,
then Object should not be included in the result.

The reason why I see is not possible is as I am not Storing each attribute
as Field instead Instead I am indexing many small text fields, aggregate the
text into a single "contents" field and index only that.

So is there any better approach for Indexing? Please help me out.

Code Snippet:

Document doc = new Document(..);
Field objField = new Field("ID", objId, Field..STORE.YES)
String attrValue = "";
for(Attribute att: allAttributes){
    attrValue += att.getValue() + " ";
}
Field attField = new Field("content", attrValue, Field.STORE.NO,
Field.Index.TOKENIZED)

Attributes are shown to user based on their access. 
-- 
View this message in context: http://www.nabble.com/Help-regarding-choosing-Indexing-Stratergies-tp25770324p25770324.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42624-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 15:51:09 2009
Return-Path: <java-user-return-42624-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41242 invoked from network); 6 Oct 2009 15:51:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 15:51:09 -0000
Received: (qmail 29700 invoked by uid 500); 6 Oct 2009 15:51:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29636 invoked by uid 500); 6 Oct 2009 15:51:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29626 invoked by uid 99); 6 Oct 2009 15:51:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 15:51:07 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.86.124.115] (HELO rpdz2.dailyrazor.com) (74.86.124.115)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 15:50:56 +0000
Received: from c-68-54-252-233.hsd1.md.comcast.net ([68.54.252.233]:41903 helo=[192.168.169.1])
	by rpdz2.dailyrazor.com with esmtpa (Exim 4.69)
	(envelope-from <gary@littlebunch.com>)
	id 1MvCG5-0000FT-NX
	for java-user@lucene.apache.org; Tue, 06 Oct 2009 10:47:25 -0500
Message-ID: <4ACB668D.2090408@littlebunch.com>
Date: Tue, 06 Oct 2009 11:47:25 -0400
From: Gary Moore <gary@littlebunch.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Struts2 implementation
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
X-AntiAbuse: This header was added to track abuse, please include it with any abuse report
X-AntiAbuse: Primary Hostname - rpdz2.dailyrazor.com
X-AntiAbuse: Original Domain - lucene.apache.org
X-AntiAbuse: Originator/Caller UID/GID - [47 12] / [47 12]
X-AntiAbuse: Sender Address Domain - littlebunch.com
X-Virus-Checked: Checked by ClamAV on apache.org

I'm porting one of my Struts1 Lucene search apps to Struts2.   The 
basics are working but I need to remove the Lucene search service out of 
the action classes.   I'm ready to write an interceptor but can perhaps 
also see using a plug-in like is done with Tiles.   As I'm a Struts2 
newbie, any tips/advice from anyone's experiences would be appreciated.  
Thanks
Gary


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42625-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 15:53:11 2009
Return-Path: <java-user-return-42625-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41899 invoked from network); 6 Oct 2009 15:53:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 15:53:11 -0000
Received: (qmail 36303 invoked by uid 500); 6 Oct 2009 15:53:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36245 invoked by uid 500); 6 Oct 2009 15:53:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36235 invoked by uid 99); 6 Oct 2009 15:53:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 15:53:08 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 74.125.78.25 as permitted sender)
Received: from [74.125.78.25] (HELO ey-out-2122.google.com) (74.125.78.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 15:52:58 +0000
Received: by ey-out-2122.google.com with SMTP id 22so901602eye.3
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 08:51:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=SQoNBZvlKs1Lkx6Tdb7+qeL3Z8L1fgrRilCqOM/KwUM=;
        b=oO6oikwLH99aaWwtU+LuM1tQcJNPO9retVTomypqW75U4KvVwERKXPLvCXkGSDocMf
         FiUfNzMQa6RMHHJhKvj5sXMib6Y7MF146jMh6uSXopHJDgmuS5YSGse6i9YFcH0f2TCw
         +WTuOezi6oom6S8F6WCgK/pZOmFCm8TdtsA18=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=st54T9P4/R5v+D0Kf1s3ieH+0G0Qs00biLofiYB39fP3G9fOC+mtV2BIg7UEnLFv+U
         PV261dm07pF4ozwsQnG0kzT/rU7zfUIzwb3gI9vAKTwejWeRxwGRQEbw/4MFghlAlimy
         mVOqgi07y9OznPwzGf8D7jFuxjg3PJGGPI3C4=
Received: by 10.211.131.12 with SMTP id i12mr5107101ebn.97.1254844298118;
        Tue, 06 Oct 2009 08:51:38 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 10sm295040eyz.2.2009.10.06.08.51.36
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 06 Oct 2009 08:51:36 -0700 (PDT)
Message-Id: <2D5C9E79-5FAE-488C-8E96-3535326DB158@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Phase Extraction, mainly for English
Date: Tue, 6 Oct 2009 17:51:35 +0200
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Andrew,

I think you are looking for the shingle package in contrib/analyzers.


       karl

6 okt 2009 kl. 13.42 skrev Andrew Zhang:

> Hi guys,
>
> The requirement is very simple here, e.g. for this sentence, 'The NBA
> formally announced its new *social media* guidelines Wednesday',  I  
> want to
> treat '*social media*' as a whole phase term. The default english  
> analyzers
> came with lucene all deal with single word, so it you want to get  
> the most
> frequent terms, *social *and *media* are separated, and each of them  
> can't
> represent a good meaning as *social media*, right?
>
> I know there's a way built on some phase dictionary, and try to  
> match the
> phase already there, very like the way to do with chinese language,  
> but is
> there an open source solution for english, I mean I don't want to  
> build a
> phase dictionary myself, and I also want a smart way, which can  
> "discover"
> the phase automatically. I got 2 millions docs analyzered the norma  
> way, all
> single terms, which I can use as a base source, and it's possible to  
> find
> that *social media *came together frequently, but I really don't  
> know what's
> the reverse way.
>
> I tried to find some phase analyzers, but no luck. so any advices?
>
> Regards,
> Andrew
> -- 
> Simple is best


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42626-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 16:55:39 2009
Return-Path: <java-user-return-42626-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73601 invoked from network); 6 Oct 2009 16:55:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 16:55:39 -0000
Received: (qmail 81871 invoked by uid 500); 6 Oct 2009 16:55:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81818 invoked by uid 500); 6 Oct 2009 16:55:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81807 invoked by uid 99); 6 Oct 2009 16:55:37 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 16:55:37 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 16:55:26 +0000
Received: (qmail 3836 invoked by uid 508); 6 Oct 2009 16:59:29 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 6 Oct 2009 16:59:29 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1MvDIc-0003Qs-LO
	for java-user@lucene.apache.org; Tue, 06 Oct 2009 18:54:06 +0200
Date: Tue, 6 Oct 2009 18:54:06 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: Forwarded: InstantiatedIndex questions
Message-ID: <20091006165406.GB25923@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

Karl prefer to answer on the ml so here is some informations he asked on
how we use InstantiatedIndex.

----- Forwarded message from David Causse <dcausse@spotter.com> -----

Date: Tue, 6 Oct 2009 15:45:57 +0200
From: David Causse <dcausse@spotter.com>
To: Karl Wettin <kalle@apache.org>
Subject: Re: InstatiatedIndex questions

Hi,

sorry for the delay.

We upgraded to the new Attribute API and InstantiatedIndex didn't
support it, now with 2.9 InstantiatedIndex works great with this API.
We use it cause we build volatile indexes on small doc set 1 to 200 and
apply massive complex queries. It is done in a document flow over
a messaging architecture, it's a sort of routing table.
We use only IR and IW, we have build our query system which is a bit
similar to SpanQuery cause we make intensive use of term positionning.
We do proximity searches based on standard term position but also
with some payload information like phrase id and/or paragraph id and
some generic stuff that permits to add relationships inside the index.

So what is important for us : is fast indexing time and very fast query.
Query lucene for us means 
	- termEnum iteration to do query rewrite/optimizations
	- termDocs/termPosition iteration

On the index time InstantiatedIndex is behind RAMDirectory, but the time
gained over queries make it better (for what I see it can be 2 times
faster).

InstantiatedIndex will be our default volatile mini index store for our
next production release.

The need for serialization is deprecated now, we prefer to re-index
pre-analyzed token stream and keep control of bits with Externalizable.

Whe should have other needs of this index but the lack of addIndexes
support make it impossible for us to use it in other situations. So we
continue to use RAMDirectory in such situations.

Do you think we could reach RAMDirectory index time by tweaking some initialCap
stuff inside java.util.Collections you use?

Many thanks for your excellent work.

PS. I posted some (not really usefull) debug output to the lucene-users
ml.

On Fri, Dec 12, 2008 at 04:15:56PM +0100, Karl Wettin wrote:
> Hi David,
>
> the problems you reported are now committed to the trunk. As  
> InstantiatedIndex is a new module it would be very intersting to hear  
> how InstantiatedIndex works for you and perhaps a little bit about how  
> you use it.
>
>
>     karl
>
> 19 nov 2008 kl. 15.02 skrev David Causse:
>
> > Hi Karl,
> >
> > The reset() problem is not very problematic I can adapt our  
> > TokenStreams.
> > For the Serialization : as we need to share very small indexes (200  
> > docs max) in a cluster we need to serialize something.
> > I was planning to use the Java Serialization with maybe some  
> > compression on the resulting byte[] and as InstantiatedIndex is  
> > Serializable I was hoping to use the perf gain of your implementation 
> > in our context.
> > I will fix my working copy as you suggested.
> >
> > Thank you.
> >
> > David.
> >
> > karl wettin a crit :
> >> Hi David,
> >>
> >> thanks for the report! I suppose you speak of IndexWriter vs
> >> InstantiatedIndexWriter? These are definitely considered discrepancy
> >> problems. I've created a new issue in the tracker:
> >> http://issues.apache.org/jira/browse/LUCENE-1462
> >>
> >> For what reason do you try to serialize the InstantatedIndex? Could
> >> you perhaps use FSDirectory and IndexWriter instead, and then each
> >> time you update that index you replace your InstantiatedIndex with a
> >> new one constructed using the IndexReader argumented constructor of
> >> InstantiatedIndex?
> >>
> >> I'm afraid that I'm rather busy at the moment but I'll try to fix it
> >> ASAP. It should however be rather easy to fix if you just want to
> >> solve the specific problem: reset all pre-tokenized streams before
> >> they are tokenized in InstantiatedIndexWriter#addDocument and make
> >> TermVectorOffsetInfo implement Serializable.
> >>
> >>
> >>     karl
> >>
> >> On Wed, Nov 19, 2008 at 11:00 AM, David Causse <dcausse@spotter.com> 
> >> wrote:
> >>
> >>> Hi,
> >>>
> >>> Here are some differences I noticed between InstanciatedIndex and
> >>> RAMDirectory :
> >>>
> >>> - RAMDirectory seems to do a reset on tokenStreams the first time,  
> >>> this
> >>> permits to initialise some objects before starting streaming,
> >>> InstanciatedIndex does not.
> >>> - I can Serialize a RAMDirectory but I cannot on a  
> >>> InstantiatedIndex because
> >>> of : java.io.NotSerializableException:
> >>> org.apache.lucene.index.TermVectorOffsetInfo
> >>>
> >>> Do you consider this as problems or normal features?
> >>>
> >>> Thank you.
> >>>
> >>> David.
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>>
> >>>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >>
> >>
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
>
>

-- 
David Causse
Spotter
http://www.spotter.com/

----- End forwarded message -----

-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42627-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 17:53:21 2009
Return-Path: <java-user-return-42627-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95471 invoked from network); 6 Oct 2009 17:53:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 17:53:21 -0000
Received: (qmail 90369 invoked by uid 500); 6 Oct 2009 17:53:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90318 invoked by uid 500); 6 Oct 2009 17:53:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90308 invoked by uid 99); 6 Oct 2009 17:53:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 17:53:18 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.214 as permitted sender)
Received: from [209.85.219.214] (HELO mail-ew0-f214.google.com) (209.85.219.214)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 17:53:07 +0000
Received: by ewy10 with SMTP id 10so4465883ewy.9
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 10:51:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=DKyFW/u/jA1zNn7ttDbKg1QNfOAF5QOhRDb0n5LYiYk=;
        b=aDGG+tAn7u32ux1OPU2Ead9KDA21zeeqgu+6WaBG1okc3ToXRFBKU7vGbBCZ+HpzFV
         zBDGHNooGmr0huLdG5MhKi68G8vfybhOtkugxGBlG1ziAoOza0HyAhIHf3gWcWwmZukq
         eKPOataRyOTTdGCjZ5LHIrfZsNpO+fTOZISVw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=URVnFxotIsxi1kgQ9/TDUcY+1nm+ZHxiRoU/lCRnhmVVmh4S8Pkf3Y6Oqx5CafrmsH
         28NklRQVuAk5T1M8zKxl7qZjSI9sFckhEqVA+CF6AIbfCCNPbv6V1tCijA8pXRps2kmL
         OE767aGSsM4bpQDtvLUNOnc4qeku9M/RBxgOE=
Received: by 10.210.95.26 with SMTP id s26mr5337464ebb.7.1254851507432;
        Tue, 06 Oct 2009 10:51:47 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 7sm33634eyg.43.2009.10.06.10.51.45
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 06 Oct 2009 10:51:46 -0700 (PDT)
Message-Id: <A3D280E5-3491-423F-8C88-CFB8535AEF5C@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <20091006165406.GB25923@spotter-dclnx>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re:InstantiatedIndex questions
Date: Tue, 6 Oct 2009 19:51:44 +0200
References: <20091006165406.GB25923@spotter-dclnx>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org


6 okt 2009 kl. 18.54 skrev David Causse:

David, your timing couldn't be better. Just the other day I proposed  
that we deprecate InstantiatedIndexWriter. The sum of the reasons to  
this is that I'm a bit lazy. Your mail makes me reconsider.

https://issues.apache.org/jira/browse/LUCENE-1948

> On the index time InstantiatedIndex is behind RAMDirectory, but the  
> time

Would you mind benchmarking some for me using your corpora? The issue  
suggests that people use the InstantiatedIndex(IndexReader)  
constructor to create the index rather than using  
InstantiatedIndexWriter. Is it way slower for you to produce the index  
using RAMDirectory/IndexWriter and pass an IndexReader to  
InstantiatedIndex?


This is what the package level javadocs says about  
InstantiatedIndexWriter:

"Hardly any effort has been put in to optimizing the  
InstantiatedIndexWriter, only minimizing the amount of time needed to  
write-lock the index has been considered."

I'm sure there are ways to speed it up, I just never managed to find  
the time to look in to it. I never really used IIW.


It might be worth mentioning that when InstantiatedIndex#commit  
returns it has yeilded an optimized "single segment" index. This is  
not quite how a Directory/IndexWriter acts.

> gained over queries make it better (for what I see it can be 2 times
> faster).
>
> InstantiatedIndex will be our default volatile mini index store for  
> our
> next production release.

Very cool!!

> Whe should have other needs of this index but the lack of addIndexes
> support make it impossible for us to use it in other situations. So we
> continue to use RAMDirectory in such situations.

Have you considered using multiple InstantiatedIndex and a  
MultiReader? That would pretty much be the same thing, just that the  
store wouldn't be quite as optimized. It would definitly use more RAM  
than if it was the same index. You could of course also pass this  
MultiReader to a new InstantiatedIndex. I have no real clue about the  
difference in speed and RAM consuption between these solutions so you  
should benchmark all solutions.

> Do you think we could reach RAMDirectory index time by tweaking some  
> initialCap
> stuff inside java.util.Collections you use?


Maybe. But I think it would be a relatively small gain. But don't take  
my words for granted, benchmark it.

Using the InstantiatedIndex(IndexReader) constructor will create  
rather optimal size of the collections.

As for InstantiatedIndexWriter I think it's pretty much only the  
transient collections in #commit that will help you, my guess is that  
you should expemient with the dirtyTerms and termsByText attributes.  
Count the number of terms in your complete index and see how much it  
speeds thing up by creating the collections with this size from the  
start.




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42628-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 18:36:34 2009
Return-Path: <java-user-return-42628-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21502 invoked from network); 6 Oct 2009 18:36:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 18:36:34 -0000
Received: (qmail 55987 invoked by uid 500); 6 Oct 2009 18:36:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55896 invoked by uid 500); 6 Oct 2009 18:36:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55880 invoked by uid 99); 6 Oct 2009 18:36:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 18:36:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [67.195.13.201] (HELO web110610.mail.gq1.yahoo.com) (67.195.13.201)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 06 Oct 2009 18:36:21 +0000
Received: (qmail 14759 invoked by uid 60001); 6 Oct 2009 18:34:57 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1254854097; bh=oM/j2rRkBIN+su38M7bT4eBwIFVeAy7sxNUGKq1+vs8=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=hCk7NI3zJ0P+OzRd3tp7wuh/xsH8rQBvRJ8VPPt2i31RIUicZ3pdh9E3fkR6/3YFzIumLJ01UnT9LzA8lqE35tEAlacmAA8p00nt9GviDP3isUycWtaRp/30EsL4EMAvCw7zRy8hbecM20WosKR+itzdGUyBdH7wB8jhvrJdrBs=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:References:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=gmsZlLFmP5oYq0CRIw2CdUnud+BHry8AeT/mnOSNdUbelEeHuDfFiRR1lTOhU9pbPF/F4KIFsm2+y24O9jR//1lRFRzXnXynuWuqdJq46SmsETtRVIW2of1Av+lnD7+MzQRdcIDkoz6yC4h5oH3IuTEGnEv3eQwjaRjGx+pcW2U=;
Message-ID: <412247.14448.qm@web110610.mail.gq1.yahoo.com>
X-YMail-OSG: .Y9zZSkVM1lFVJhQqB_jY1aHmAVPOQiAG.hsvfHu1gRJZf_ySpMPihJfXQL.Jd52o0XJevAV0VHHxvEb_lFhgBnZGq4L1uDQgwfLaiyetX9Blp9MR9ci_s.H.hqpcAfr39o2PvbhWFL.S2SkoTuOEdCI0PHElmeSYenvwBSWz0qzEjZmpd7XPUTdEjTBGqLUVrqFQ3qCQU1O9qrJX6Y2prVBkX0FdcAGsev3Z_O.54k_kIQwmYMxReExtrvtGvUg1bM-
Received: from [98.235.247.104] by web110610.mail.gq1.yahoo.com via HTTP; Tue, 06 Oct 2009 11:34:57 PDT
X-Mailer: YahooMailRC/157.18 YahooMailWebService/0.7.347.3
References: <4ACB668D.2090408@littlebunch.com>
Date: Tue, 6 Oct 2009 11:34:57 -0700 (PDT)
From: Dave Newton <newton.dave@yahoo.com>
Subject: Re: Struts2 implementation
To: java-user@lucene.apache.org
In-Reply-To: <4ACB668D.2090408@littlebunch.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

> I'm porting one of my Struts1 Lucene search apps to Struts2.   The basics are 

> working but I need to remove the Lucene search service out of the action 
> classes.   I'm ready to write an interceptor but can perhaps also see using a 
> plug-in like is done with Tiles.   As I'm a Struts2 newbie, any tips/advice from 
> anyone's experiences would be appreciated.  Thanks

I'm not sure why an interceptor would be a good choice (or a plugin, for that matter). If the search code is well-isolated just make it a service. Then inject it into the action via any mechanism.

Dave

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42629-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 19:00:26 2009
Return-Path: <java-user-return-42629-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28891 invoked from network); 6 Oct 2009 19:00:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 19:00:26 -0000
Received: (qmail 91018 invoked by uid 500); 6 Oct 2009 19:00:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90937 invoked by uid 500); 6 Oct 2009 19:00:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90927 invoked by uid 99); 6 Oct 2009 19:00:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 19:00:24 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 19:00:15 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 6A8BC71C393; Tue,  6 Oct 2009 11:59:54 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 67CA271C378
	for <java-user@lucene.apache.org>; Tue,  6 Oct 2009 11:59:54 -0700 (PDT)
Date: Tue, 6 Oct 2009 11:59:54 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: How to test if an IndexReader is still open?
In-Reply-To: <1691327499.1351254401533251.JavaMail.root@mail.uk.scalix.com>
Message-ID: <Pine.LNX.4.64.0910061150340.23118@radix.cryptio.net>
References: <1691327499.1351254401533251.JavaMail.root@mail.uk.scalix.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: I figured it might be less expensive if search() (I have extended 
: IndexSearcher) were to check that the underlying IndexReader is still 

if you're extending IndexSearcher anyway you can override the close() 
method to update a boolean and then add your own isClosed() method.

: open - and reopen() if necessary.  However, I cannot find a way to 

FWIW: I don't believe you can call the reopen() method on a close 
IndexReader ... but you can of course "re" open a new IndexReader 
instance.

: detect this ...  is there a way?  Failing that, what is the cost of just 
: issuing a reopen() anyway?

if the index hasn't changed, it's free.  If the index has changed 
a lot, it's as expensive as open() ... if there are minor changes then 
it's somewhere in between.



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42630-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 20:35:09 2009
Return-Path: <java-user-return-42630-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59186 invoked from network); 6 Oct 2009 20:35:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 20:35:09 -0000
Received: (qmail 78101 invoked by uid 500); 6 Oct 2009 20:35:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78043 invoked by uid 500); 6 Oct 2009 20:35:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78033 invoked by uid 99); 6 Oct 2009 20:35:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 20:35:07 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mmasters@gmail.com designates 74.125.78.26 as permitted sender)
Received: from [74.125.78.26] (HELO ey-out-2122.google.com) (74.125.78.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 20:34:56 +0000
Received: by ey-out-2122.google.com with SMTP id 22so963025eye.3
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 13:33:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=ZX47PTku+GZsKg9Y3KOO6Q/IHpi8jKeMg4LQm+MOSBA=;
        b=oHtHSYIK8eBnrZk1IgVuGsPVS9WWZ4qmLMXrJD5nJ3jyFNv8Jn+V30HYHSzMWxJhRg
         N6ql19eRU9WMR/enigZK/2FmpV+mvEJVDCU0Q1odVspIaRv1Re2u2P/ewZlwKLdlDZSx
         Q+gIXfh+D0XG11TqmLGItt8iv7YQEtMN+yrP4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=ilHK0gpR+ABsEMmsV5pkGKb2gxL/eh5bpGA9jMFEJ4/alrYoU9wZJaMbPS8QEcHsTJ
         dLZRwXtQ6q3Ur8Jf/Fetog5Z34tjSnIgp9t7N5z1b1Mp/1wXjHlsBUStxSUeDzSUTxkm
         W4ytXr8svxqYD7Y+i0tzsiF1DrbeU4G/yqr0s=
MIME-Version: 1.0
Received: by 10.216.2.19 with SMTP id 19mr420893wee.68.1254861216417; Tue, 06 
	Oct 2009 13:33:36 -0700 (PDT)
In-Reply-To: <84F2545D-14D5-4CDC-A27A-F951ABAE2E74@apache.org>
References: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
	 <84F2545D-14D5-4CDC-A27A-F951ABAE2E74@apache.org>
Date: Tue, 6 Oct 2009 14:33:36 -0600
Message-ID: <5b8626350910061333k57d9a545w7b2bed281ac4ae6c@mail.gmail.com>
Subject: Re: document diversity
From: Michael Masters <mmasters@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

My initial description may have been a little abstract. Maybe I should
explain exactly what I'm trying to do. My company has various revenue
channels, one of which is per click. If a user does a search, we would
like to show results with the greatest revenue, although we don't want
people to be able to buy all the top results. Hence, we would like to
have some way of mixing results. The mixing of results could be based
of potential revenue, relevancy, which revenue stream the result is
associated with, etc.

The previously mentioned ideas are great btw.

-Mike


On Sat, Oct 3, 2009 at 4:25 PM, Grant Ingersoll <gsingers@apache.org> wrote=
:
> I'm curious, can you elaborate more on the deeper use case for this?
>
> Perhaps just implementing faceting on doc type would be sufficient? =A0Th=
at
> way users can drill in on doc type. =A0Alternatively, I suppose you could
> implement a hit collector that accesses a field cache on the doc type fie=
ld
> and promotes lesser seen doc types until they are evenly represented. =A0=
Could
> also likely write a Function query that does a similar thing. =A0I'd imag=
ine
> you need to be careful to control your memory.
>
> -Grant
>
> On Oct 1, 2009, at 12:56 PM, Michael Masters wrote:
>
>> I was wondering if there is any way to control what kind of documents
>> are returned from a search. For example, lets say we have an index
>> built from different types of documents (pdf, txt, html, etc.). Is
>> there a way to have the first x results have a specified distribution
>> of document types? It would be nice to have an even number of results
>> that are from pdfs, txt files, and html files.
>>
>>
>> Any help would greatly be appreciated.
>>
>>
>> -Mike
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
> Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42631-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 21:00:40 2009
Return-Path: <java-user-return-42631-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68606 invoked from network); 6 Oct 2009 21:00:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 21:00:39 -0000
Received: (qmail 29810 invoked by uid 500); 6 Oct 2009 21:00:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29737 invoked by uid 500); 6 Oct 2009 21:00:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29727 invoked by uid 99); 6 Oct 2009 21:00:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 21:00:36 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 21:00:24 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id B43DF317DC
	for <java-user@lucene.apache.org>; Tue,  6 Oct 2009 23:00:02 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id A012731746
	for <java-user@lucene.apache.org>; Tue,  6 Oct 2009 23:00:02 +0200 (CEST)
Received: from [192.168.178.47] (BAH7ec6.bah.pppool.de [77.135.126.198])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id 701B2310E9
	for <java-user@lucene.apache.org>; Tue,  6 Oct 2009 23:00:02 +0200 (CEST)
Message-Id: <F659F99A-C909-4B53-AEC6-577CA93055F8@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <5b8626350910061333k57d9a545w7b2bed281ac4ae6c@mail.gmail.com>
Content-Type: multipart/signed; boundary=Apple-Mail-39--469788887; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: document diversity
Date: Tue, 6 Oct 2009 22:59:56 +0200
References: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com> <84F2545D-14D5-4CDC-A27A-F951ABAE2E74@apache.org> <5b8626350910061333k57d9a545w7b2bed281ac4ae6c@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-39--469788887
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable

Just as you can add a query that will boost better things with a =20
higher quality, you can add a query for a higher revenue.

Basically, the default operator "should" in boolean-clauses can be =20
used exactly for that: do not force this query to be matched but raise =20=

boost if there's something that matches.

The translation of the user-query, itself, is marked as "must" (and =20
inside this one is orred in all the various flavours, e.g. per =20
language, phonetic...).

paul


Le 06-oct.-09 =E0 22:33, Michael Masters a =E9crit :

> My initial description may have been a little abstract. Maybe I should
> explain exactly what I'm trying to do. My company has various revenue
> channels, one of which is per click. If a user does a search, we would
> like to show results with the greatest revenue, although we don't want
> people to be able to buy all the top results. Hence, we would like to
> have some way of mixing results. The mixing of results could be based
> of potential revenue, relevancy, which revenue stream the result is
> associated with, etc.
>
> The previously mentioned ideas are great btw.
>
> -Mike
>
>
> On Sat, Oct 3, 2009 at 4:25 PM, Grant Ingersoll =20
> <gsingers@apache.org> wrote:
>> I'm curious, can you elaborate more on the deeper use case for this?
>>
>> Perhaps just implementing faceting on doc type would be =20
>> sufficient?  That
>> way users can drill in on doc type.  Alternatively, I suppose you =20
>> could
>> implement a hit collector that accesses a field cache on the doc =20
>> type field
>> and promotes lesser seen doc types until they are evenly =20
>> represented.  Could
>> also likely write a Function query that does a similar thing.  I'd =20=

>> imagine
>> you need to be careful to control your memory.
>>
>> -Grant
>>
>> On Oct 1, 2009, at 12:56 PM, Michael Masters wrote:
>>
>>> I was wondering if there is any way to control what kind of =20
>>> documents
>>> are returned from a search. For example, lets say we have an index
>>> built from different types of documents (pdf, txt, html, etc.). Is
>>> there a way to have the first x results have a specified =20
>>> distribution
>>> of document types? It would be nice to have an even number of =20
>>> results
>>> that are from pdfs, txt files, and html files.
>>>
>>>
>>> Any help would greatly be appreciated.
>>>
>>>
>>> -Mike
>>>
>>> =
---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>> --------------------------
>> Grant Ingersoll
>> http://www.lucidimagination.com/
>>
>> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) =20=

>> using
>> Solr/Lucene:
>> http://www.lucidimagination.com/search
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


--Apple-Mail-39--469788887
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAwNjIwNTk1NlowIwYJKoZIhvcNAQkEMRYEFC63CAvAcRl8fVsQnjh6inSYKNtDMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQCV
yHRry4nlrY0OgFZc95wtzdmXoNkin0E7FYwUCI7nWv6B8FFYOSKzw/qxEQzyTQ4y8X70lXG6vtLD
ab7fJZHA3FbucbOYqmhmDQmUumpuZqs+cWRPIeIpgf6akrxKXvfG8jYpCg2WdvQAflBgQ6/9C6o0
kQ6Y7kkNFq4uXuVMK7Nv22WKYllo+pPLQcqKXXTEijdtU5kukg+eMP782Yl4Emmnbd5eYBWR/jWO
MBYY72NhoE7ZbujeOURQ7BdGjJh88thmTdT0OHUqLtw7EknCuyKMLaBRqRudtVfZnqaPHan0v1ac
hi+kSHURMFU+Fq+HrvoS9mA5BJMZHfckotMyAAAAAAAA

--Apple-Mail-39--469788887--

From java-user-return-42632-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 21:51:15 2009
Return-Path: <java-user-return-42632-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85393 invoked from network); 6 Oct 2009 21:51:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 21:51:15 -0000
Received: (qmail 25848 invoked by uid 500); 6 Oct 2009 21:51:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25800 invoked by uid 500); 6 Oct 2009 21:51:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25790 invoked by uid 99); 6 Oct 2009 21:51:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 21:51:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 21:51:01 +0000
Received: by bwz22 with SMTP id 22so3852934bwz.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 14:50:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=jQNrClZupDtxXjAIP2ZTAlHPcOlI5v+TGK0zhD5yWIk=;
        b=viJgZqWAwLeAWseNcb3tCiUWuq1s1nXSvbe/yVKfFq/R4loiVAO06QMwxo+rW+/KDi
         EhqwewMvbLM2w5ypHZWPWJiJiu+jPdK1YEq4s4MuBt/Vgea4KwZPzsnWKHeINKRuJ8Qq
         2KqJzWBEhIbTLT2CxzF8TcFnGAJwSv2Kxw0xw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        b=kZuYK78YPaDthwy7Z+DvQAUV6PhW/lMEozWYNttGH+p5WnPRmHlC/BIJ2pHhXAbK7T
         z7dTcKyZccxt89H2Nm5cR5BbcbojHBLv/TClqFjTvkUXOPRfmF6/bPTp1oLCmbpCVIXV
         hSsv76jT3XdqBrs+9MkV38kJ1LK764sgM7auk=
MIME-Version: 1.0
Received: by 10.239.168.204 with SMTP id l12mr178262hbe.36.1254865840360; Tue, 
	06 Oct 2009 14:50:40 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <5b8626350910061333k57d9a545w7b2bed281ac4ae6c@mail.gmail.com>
References: <5b8626350910010956n472f4c7ci21afaeb4501882ac@mail.gmail.com>
	 <84F2545D-14D5-4CDC-A27A-F951ABAE2E74@apache.org>
	 <5b8626350910061333k57d9a545w7b2bed281ac4ae6c@mail.gmail.com>
Date: Tue, 6 Oct 2009 23:50:40 +0200
Message-ID: <f18c9dde0910061450q44eb502awe33a7ddd533f651d@mail.gmail.com>
Subject: Re: document diversity
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Michael,
this sounds like a pretty good usecase for CustomScoreQuery
(http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/func=
tion/CustomScoreQuery.html)
The org.apache.lucene.search.function package provides flexible
programmatic control over document scores. You boost up documents with
greatest revenue or throw in some factors based on potential revenue
even if the revenue "value" for a document has changed since it was
indexed.

Another way would be to only update the norm value of a document
periodically for documents with changing revenue. This prevents you
from re-indexing. See IndexReader#setNorm (
http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/index/IndexR=
eader.html#setNorm(int,%20java.lang.String,%20byte)
)

simon


On Tue, Oct 6, 2009 at 10:33 PM, Michael Masters <mmasters@gmail.com> wrote=
:
> My initial description may have been a little abstract. Maybe I should
> explain exactly what I'm trying to do. My company has various revenue
> channels, one of which is per click. If a user does a search, we would
> like to show results with the greatest revenue, although we don't want
> people to be able to buy all the top results. Hence, we would like to
> have some way of mixing results. The mixing of results could be based
> of potential revenue, relevancy, which revenue stream the result is
> associated with, etc.
>
> The previously mentioned ideas are great btw.
>
> -Mike
>
>
> On Sat, Oct 3, 2009 at 4:25 PM, Grant Ingersoll <gsingers@apache.org> wro=
te:
>> I'm curious, can you elaborate more on the deeper use case for this?
>>
>> Perhaps just implementing faceting on doc type would be sufficient? =C2=
=A0That
>> way users can drill in on doc type. =C2=A0Alternatively, I suppose you c=
ould
>> implement a hit collector that accesses a field cache on the doc type fi=
eld
>> and promotes lesser seen doc types until they are evenly represented. =
=C2=A0Could
>> also likely write a Function query that does a similar thing. =C2=A0I'd =
imagine
>> you need to be careful to control your memory.
>>
>> -Grant
>>
>> On Oct 1, 2009, at 12:56 PM, Michael Masters wrote:
>>
>>> I was wondering if there is any way to control what kind of documents
>>> are returned from a search. For example, lets say we have an index
>>> built from different types of documents (pdf, txt, html, etc.). Is
>>> there a way to have the first x results have a specified distribution
>>> of document types? It would be nice to have an even number of results
>>> that are from pdfs, txt files, and html files.
>>>
>>>
>>> Any help would greatly be appreciated.
>>>
>>>
>>> -Mike
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>> --------------------------
>> Grant Ingersoll
>> http://www.lucidimagination.com/
>>
>> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
>> Solr/Lucene:
>> http://www.lucidimagination.com/search
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42633-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 22:07:17 2009
Return-Path: <java-user-return-42633-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90784 invoked from network); 6 Oct 2009 22:07:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 22:07:17 -0000
Received: (qmail 58014 invoked by uid 500); 6 Oct 2009 22:07:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57955 invoked by uid 500); 6 Oct 2009 22:07:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57945 invoked by uid 99); 6 Oct 2009 22:07:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 22:07:15 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 22:07:04 +0000
Received: by bwz22 with SMTP id 22so3862802bwz.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 15:05:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=CpvI7Si1NV+auPw4oAMy9Gkc0uVuVPrbrkJ55TJV2UY=;
        b=b5Oaw7hJ5p9soEM3c9e8oNOqyovLtZPtSrwrknAArrI3sDq6x27Pecjuxgm+CrfIey
         plJls4AHr4Ya2rEX7XAUjE5WuLq2dV63gS3g7KMR+eHqN/+cv7K++0GZbsGzUkDepXmn
         tpnjOA+a4Zujnrf4JKy8ZZRP8FO4k6TfbZnYY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type:content-transfer-encoding;
        b=juxsjfa9j5PsUYlJ7/62aAehj1aer6b5xr1foCI+zwZWTVb7x7VLVjw3qJmlpt2Zln
         to7ybuOvLMuw04X0cyYMjiCbqSI74WP0N4lzXWbKatclpJaDdl7+u79Rp3BSGhWHI0/u
         TTJbWqjqw7WJPc9FAlIU9cu2qDdDUv5SFtK7w=
MIME-Version: 1.0
Received: by 10.239.139.91 with SMTP id s27mr173379hbs.84.1254866743773; Tue, 
	06 Oct 2009 15:05:43 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <BLU149-W54BFA6FF4AE7A61E4932E2B9CE0@phx.gbl>
References: <BLU149-W54BFA6FF4AE7A61E4932E2B9CE0@phx.gbl>
Date: Wed, 7 Oct 2009 00:05:43 +0200
Message-ID: <f18c9dde0910061505w3f876585ya0ad7c749b2e987@mail.gmail.com>
Subject: Re: Document loading
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,
a call to IndexSearcher.doc(docId) will load the document. Internally
this call forwards to IndexReader.document(docId) which could be very
expensive because this method will load all stored document fields.

I would recommend to have a look at IndexSearcher.doc(docId,
FieldSelector). This method offers you way more control over field
loading costs. With the FieldSelector you can directly load fields, do
lazy loading or stop the loading process once a certain field was
loaded.
If you do not load a field due to the fieldSelector a call to
Document.get("fieldname") will return null.

Simon

On Tue, Oct 6, 2009 at 2:38 PM, Dragon Fly <dragon-fly999@hotmail.com> wrot=
e:
>
> Hi,
>
> Which of the following method actually loads the document from disk?
>
> (1) Document document =3D searcher.doc (docId);
>
> OR
>
> (2) string value =3D document.get ("FirstNameField");
>
> It's probably searcher.doc but I just want to be sure. =C2=A0Thank you.
> _________________________________________________________________
> Hotmail: Trusted email with Microsoft=E2=80=99s powerful SPAM protection.
> http://clk.atdmt.com/GBL/go/177141664/direct/01/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42634-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 22:57:57 2009
Return-Path: <java-user-return-42634-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4813 invoked from network); 6 Oct 2009 22:57:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 22:57:57 -0000
Received: (qmail 5183 invoked by uid 500); 6 Oct 2009 22:57:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5096 invoked by uid 500); 6 Oct 2009 22:57:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5086 invoked by uid 99); 6 Oct 2009 22:57:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 22:57:54 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.were@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 22:57:45 +0000
Received: by ywh15 with SMTP id 15so4096009ywh.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 15:57:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:from:date
         :message-id:subject:to:content-type;
        bh=j7ESoooraCqsJ/bo3HZhevCRNNJ/iwgTmk5UlsLyvZg=;
        b=cjlxd1GJwN5HFT0G7b8tVCb29wTcyztweO5e5gk7JyZxGhH8fQo2gJjbxBfJNqcplI
         7+cWtSdNFaerq2mB7iQzRZLXUh4aVcDcU+A421eR5Fw4QR3VZuR09yS0+sercMnLewdG
         s7g45RSGOlrZYyGZNog8wEZxvx/MxTnF8Ptwc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:reply-to:from:date:message-id:subject:to:content-type;
        b=w4oabdVxO5lfPI9IurfmVlr2h0vxBahWSqp0t/zmtc6y5/I3NcIkHWaDRS5xc06wte
         Se4OusfhvpTBHJd75KCdtQ+3/FD9bAFA5Psl6gvIIcgfChSh3QKw2sHdgDrXPBV+hIkP
         I3oPSflFhB3Qhal6PMzMilYWXwYSbGjULb+IU=
MIME-Version: 1.0
Received: by 10.91.50.2 with SMTP id c2mr1028973agk.5.1254869844286; Tue, 06 
	Oct 2009 15:57:24 -0700 (PDT)
Reply-To: chris@chriswere.com
From: Chris Were <chris.were@gmail.com>
Date: Wed, 7 Oct 2009 09:27:02 +1030
Message-ID: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
Subject: How to setup a scalable deployment?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f91dac4edd6a04754c2745
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f91dac4edd6a04754c2745
Content-Type: text/plain; charset=ISO-8859-1

Hi,
I've been using lucene for a project and it works great on the one dev.
machine. Next step is to investigate the best method of deploying lucene so
that multiple web servers can access the lucene directory of indexes.

I see four potential options:

1) Each web server indexes the content separately. This will potentially
cause different web servers to have slightly different indexes at any given
time and also duplicates the work load of indexing the content
2) Using rsync (or a similar tool) to regularly update a local lucene index
directory on each web server. I imagine there will be locking issues that
need to be resolved here.
3) Using a network file system that all the web servers can access. I don't
have much experience in this area, but potentially latency on searches will
be high?
4) Some alternative lucene specific solution that I haven't found in the
wiki / lucene documentation.

The indexes aim to be as real-time as possible, I currently update my
IndexReaders in a background thread every 20 seconds.

Does anyone have any recommendations on the best approach?

Cheers,
Chris

--001485f91dac4edd6a04754c2745--

From java-user-return-42635-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 22:58:43 2009
Return-Path: <java-user-return-42635-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5063 invoked from network); 6 Oct 2009 22:58:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 22:58:43 -0000
Received: (qmail 7627 invoked by uid 500); 6 Oct 2009 22:58:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7545 invoked by uid 500); 6 Oct 2009 22:58:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7535 invoked by uid 99); 6 Oct 2009 22:58:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 22:58:40 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [74.86.124.115] (HELO rpdz2.dailyrazor.com) (74.86.124.115)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 22:58:30 +0000
Received: from c-68-54-252-233.hsd1.md.comcast.net ([68.54.252.233]:37532 helo=[192.168.169.1])
	by rpdz2.dailyrazor.com with esmtpa (Exim 4.69)
	(envelope-from <gary@littlebunch.com>)
	id 1MvIyu-0002OS-Gj
	for java-user@lucene.apache.org; Tue, 06 Oct 2009 17:58:08 -0500
Message-ID: <4ACBCB7F.3030208@littlebunch.com>
Date: Tue, 06 Oct 2009 18:58:07 -0400
From: Gary Moore <gary@littlebunch.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Struts2 implementation
References: <4ACB668D.2090408@littlebunch.com> <412247.14448.qm@web110610.mail.gq1.yahoo.com>
In-Reply-To: <412247.14448.qm@web110610.mail.gq1.yahoo.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-AntiAbuse: This header was added to track abuse, please include it with any abuse report
X-AntiAbuse: Primary Hostname - rpdz2.dailyrazor.com
X-AntiAbuse: Original Domain - lucene.apache.org
X-AntiAbuse: Originator/Caller UID/GID - [47 12] / [47 12]
X-AntiAbuse: Sender Address Domain - littlebunch.com
X-Virus-Checked: Checked by ClamAV on apache.org

Yes, I'm injecting the service now and it works fine.   My head is not 
completely around struts2 yet but there would seem to be considerable 
advantage to the interceptor/plug-in approach, not the least of which is 
you wouldn't have to write an action class each time you need to drop 
search results on the ValueStack.   IOW, view programmers would only 
need to understand a results object -- homegrown, Solr response, 
whatever -- and not how to get it.

An analogous case is where each action class in my struts1 apps is 
responsible for fiddling with a session breadcrumb but in struts2 I'm 
using an interceptor and plugin to make the breadcrumb data 
automagically available to the view.   It's really quite slick and it 
would be kind of cool to expose Lucene in a similar way.   But, I've 
still got a lot to learn about struts2.
-Gary

Dave Newton wrote:
> I'm not sure why an interceptor would be a good choice (or a plugin, for that matter). If the search code is well-isolated just make it a service. Then inject it into the action via any mechanism.
>
> Dave
>
>
>   


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42636-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 23:04:54 2009
Return-Path: <java-user-return-42636-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7671 invoked from network); 6 Oct 2009 23:04:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 23:04:54 -0000
Received: (qmail 30520 invoked by uid 500); 6 Oct 2009 23:04:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30447 invoked by uid 500); 6 Oct 2009 23:04:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30433 invoked by uid 99); 6 Oct 2009 23:04:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:04:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 209.85.221.189 as permitted sender)
Received: from [209.85.221.189] (HELO mail-qy0-f189.google.com) (209.85.221.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:04:42 +0000
Received: by qyk27 with SMTP id 27so3065961qyk.20
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 16:04:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=T2PuvEW+JHnPIs8YFbNOhfujK4pLuLNVodBvyNUkqyo=;
        b=AmgGpmpMDi97v5seXOO1VG8TdqiqWPMNZ+kXdyPZhY/t3aeWvCjLOCYuPnUZpxTzhL
         SnfAhfszuf0kSoQUm/fa7yXAuEnPiK5SIHT8KRD3c2EkanMnY2GNCvn03YC4PVCvrpia
         84HLFNUs3C3xncB2vzwq2ZwCjYLWkfvxRwQow=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=E4o6/5w+xIF2jllnRSqmF7fVe5lydIFCaL4qc65jDBkUJyE5/aFUtzlVSXqFtb4y1Z
         oH/DzMcmHaWwpx6p8+VJ8x7g4CU2WhIR9v2pRZtmJqGqeAvjccI2DW5EfqjHrv/cl1Us
         gUEnHAOhualRpNeYEOJlQd9Bb7p49CcfVCsD4=
MIME-Version: 1.0
Received: by 10.224.86.199 with SMTP id t7mr1972318qal.142.1254870262072; Tue, 
	06 Oct 2009 16:04:22 -0700 (PDT)
In-Reply-To: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
Date: Tue, 6 Oct 2009 16:04:22 -0700
Message-ID: <85d3c3b60910061604y4f9e0a0evfe124903cf517532@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org, chris@chriswere.com
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Chris,

It sounds like you're on the right track. Have you looked at
Solr which uses the rsync/Java replication method you mentioned?
Replication and near realtime in Solr aren't quite there yet,
however it wouldn't be too hard to add it.

-J

On Tue, Oct 6, 2009 at 3:57 PM, Chris Were <chris.were@gmail.com> wrote:
> Hi,
> I've been using lucene for a project and it works great on the one dev.
> machine. Next step is to investigate the best method of deploying lucene so
> that multiple web servers can access the lucene directory of indexes.
>
> I see four potential options:
>
> 1) Each web server indexes the content separately. This will potentially
> cause different web servers to have slightly different indexes at any given
> time and also duplicates the work load of indexing the content
> 2) Using rsync (or a similar tool) to regularly update a local lucene index
> directory on each web server. I imagine there will be locking issues that
> need to be resolved here.
> 3) Using a network file system that all the web servers can access. I don't
> have much experience in this area, but potentially latency on searches will
> be high?
> 4) Some alternative lucene specific solution that I haven't found in the
> wiki / lucene documentation.
>
> The indexes aim to be as real-time as possible, I currently update my
> IndexReaders in a background thread every 20 seconds.
>
> Does anyone have any recommendations on the best approach?
>
> Cheers,
> Chris
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42637-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 23:39:21 2009
Return-Path: <java-user-return-42637-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17024 invoked from network); 6 Oct 2009 23:39:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 23:39:21 -0000
Received: (qmail 65954 invoked by uid 500); 6 Oct 2009 23:39:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65904 invoked by uid 500); 6 Oct 2009 23:39:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65894 invoked by uid 99); 6 Oct 2009 23:39:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:39:19 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rooseve6891@gmail.com designates 209.85.222.197 as permitted sender)
Received: from [209.85.222.197] (HELO mail-pz0-f197.google.com) (209.85.222.197)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:39:09 +0000
Received: by pzk35 with SMTP id 35so2672402pzk.29
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 16:37:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=/kYHZDrZ5KRt3mZRgU9P7rr5Jd7D4fzKA5Z6QdllqrA=;
        b=rpWEDupK/Kwy95Vmt2ug0A1ptwMFcP7Vf0Cp8tQvfgMSyRtWLN3yGoKY9KKVOSkVyS
         nhVLK3SyYF4s/TjnaNOkN7LLoeVSW3YjRCOmgUb/nrnya+wsrCsDefIQq97IfXhQQBQL
         nWmk8IdBbLiE3Mn7cn1XPVYwP8RqzvO0gZ96w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=thMqNU/8p/FUn7aglcJvcvGyVA5ijRFc6U9TUS5XkqbGq568Jf3EGbf7Zce69idzVy
         BzBgEf8Iccct+8LO8G4iXUf4NoSv+uvGnwns3D686qZZk/m3Am4xVOOrSv5fQyFR/L0z
         Vlr08z1PQpKfnEyS0y8843XT08IfaZxsdeZnk=
MIME-Version: 1.0
Received: by 10.115.113.9 with SMTP id q9mr3348218wam.224.1254872268431; Tue, 
	06 Oct 2009 16:37:48 -0700 (PDT)
In-Reply-To: <a59386fa0910060510p5f1ff643t4a36255e3127cb16@mail.gmail.com>
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
	 <a59386fa0910060510p5f1ff643t4a36255e3127cb16@mail.gmail.com>
Date: Wed, 7 Oct 2009 07:37:48 +0800
Message-ID: <8680aede0910061637s25ddc96sc64698ef955dbbef@mail.gmail.com>
Subject: Re: Phase Extraction, mainly for English
From: Andrew Zhang <rooseve6891@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64be11ecc62f604754cb703
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64be11ecc62f604754cb703
Content-Type: text/plain; charset=ISO-8859-1

Right, Vasu, I think NLP is good, I should take some time to look at that.
Thanks.

On Tue, Oct 6, 2009 at 8:10 PM, Vasudevan Comandur <vcomandur@gmail.com>wrote:

> Hi,
>
>   Take the NLP route and use modules like POS tagger and NP chunker.
>
>   OpenNLP has a stack for English language. Try to use them.
>
> Regards
>  Vasu
>
> On Tue, Oct 6, 2009 at 5:12 PM, Andrew Zhang <rooseve6891@gmail.com>
> wrote:
>
> > Hi guys,
> >
> > The requirement is very simple here, e.g. for this sentence, 'The NBA
> > formally announced its new *social media* guidelines Wednesday',  I want
> to
> > treat '*social media*' as a whole phase term. The default english
> analyzers
> > came with lucene all deal with single word, so it you want to get the
> most
> > frequent terms, *social *and *media* are separated, and each of them
> can't
> > represent a good meaning as *social media*, right?
> >
> > I know there's a way built on some phase dictionary, and try to match the
> > phase already there, very like the way to do with chinese language, but
> is
> > there an open source solution for english, I mean I don't want to build a
> > phase dictionary myself, and I also want a smart way, which can
> "discover"
> > the phase automatically. I got 2 millions docs analyzered the norma way,
> > all
> > single terms, which I can use as a base source, and it's possible to find
> > that *social media *came together frequently, but I really don't know
> > what's
> > the reverse way.
> >
> > I tried to find some phase analyzers, but no luck. so any advices?
> >
> > Regards,
> > Andrew
> > --
> > Simple is best
> >
>



-- 
Simple is best

--0016e64be11ecc62f604754cb703--

From java-user-return-42638-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 23:40:21 2009
Return-Path: <java-user-return-42638-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17095 invoked from network); 6 Oct 2009 23:40:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 23:40:20 -0000
Received: (qmail 67829 invoked by uid 500); 6 Oct 2009 23:40:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67755 invoked by uid 500); 6 Oct 2009 23:40:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67745 invoked by uid 99); 6 Oct 2009 23:40:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:40:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rooseve6891@gmail.com designates 209.85.216.180 as permitted sender)
Received: from [209.85.216.180] (HELO mail-px0-f180.google.com) (209.85.216.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:40:08 +0000
Received: by pxi10 with SMTP id 10so4067754pxi.20
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 16:39:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=lWMkH83LVlMPeZvXs1tFaR+tPapMrobCYWgXSCByrcg=;
        b=VwQxnhn4tbjiRsZn7LJ9p1wiwjkcjlLHSEzCmUKgysdjTE715LkLqkGHbkQZt7ziRE
         CCQUVDqkeXDg+b30SlU0aW8ByYRignp6HMCUslqDdTKSMbw2OwNKUgAEzuHRMmQxgXnN
         snrnmM0C4vn1Wwd5nHjCuzi5jBsMIMKfSCYxs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=exMwvmyk9ieh7xEb38jxbzcOyrA7ypDHZHtp/km7S6V8OJuuSxRRdcMXrdEHYWI+tg
         ckC4KG0K8qZqVIfgaDPZkw21Y3t7VYNyNLR0KP5BIi1uP4BMaxgpdRSWNN4JIwPXKs4P
         3o7w4s/GtkQhh0dpXk9SVoIYQiStI0RJ2YLFg=
MIME-Version: 1.0
Received: by 10.115.133.38 with SMTP id k38mr2341631wan.120.1254872387357; 
	Tue, 06 Oct 2009 16:39:47 -0700 (PDT)
In-Reply-To: <2D5C9E79-5FAE-488C-8E96-3535326DB158@gmail.com>
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
	 <2D5C9E79-5FAE-488C-8E96-3535326DB158@gmail.com>
Date: Wed, 7 Oct 2009 07:39:47 +0800
Message-ID: <8680aede0910061639h2403e84fo77f9376e70011fb1@mail.gmail.com>
Subject: Re: Phase Extraction, mainly for English
From: Andrew Zhang <rooseve6891@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e648d6a4e30aa704754cbef0
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e648d6a4e30aa704754cbef0
Content-Type: text/plain; charset=ISO-8859-1

Hi Karl,

I think shingle is designed to make the phase search faster, it'll generate
a lot of "seemed like" phase by pos only and completely disregard the
meaning, that's not good enough.

Regards,
Andrew

On Tue, Oct 6, 2009 at 11:51 PM, Karl Wettin <karl.wettin@gmail.com> wrote:

> Hi Andrew,
>
> I think you are looking for the shingle package in contrib/analyzers.
>
>
>      karl
>
> 6 okt 2009 kl. 13.42 skrev Andrew Zhang:
>
>
>  Hi guys,
>>
>> The requirement is very simple here, e.g. for this sentence, 'The NBA
>> formally announced its new *social media* guidelines Wednesday',  I want
>> to
>> treat '*social media*' as a whole phase term. The default english
>> analyzers
>> came with lucene all deal with single word, so it you want to get the most
>> frequent terms, *social *and *media* are separated, and each of them can't
>> represent a good meaning as *social media*, right?
>>
>> I know there's a way built on some phase dictionary, and try to match the
>> phase already there, very like the way to do with chinese language, but is
>> there an open source solution for english, I mean I don't want to build a
>> phase dictionary myself, and I also want a smart way, which can "discover"
>> the phase automatically. I got 2 millions docs analyzered the norma way,
>> all
>> single terms, which I can use as a base source, and it's possible to find
>> that *social media *came together frequently, but I really don't know
>> what's
>> the reverse way.
>>
>> I tried to find some phase analyzers, but no luck. so any advices?
>>
>> Regards,
>> Andrew
>> --
>> Simple is best
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Simple is best

--0016e648d6a4e30aa704754cbef0--

From java-user-return-42639-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 06 23:42:57 2009
Return-Path: <java-user-return-42639-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17656 invoked from network); 6 Oct 2009 23:42:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 6 Oct 2009 23:42:57 -0000
Received: (qmail 72616 invoked by uid 500); 6 Oct 2009 23:42:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72551 invoked by uid 500); 6 Oct 2009 23:42:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72541 invoked by uid 99); 6 Oct 2009 23:42:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:42:54 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rooseve6891@gmail.com designates 209.85.216.180 as permitted sender)
Received: from [209.85.216.180] (HELO mail-px0-f180.google.com) (209.85.216.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 06 Oct 2009 23:42:45 +0000
Received: by pxi10 with SMTP id 10so4069072pxi.20
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 16:42:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=BzwVVWDHwTUIwINnaSXKcS+FyZU/ReRvyxbyRe2ZpSI=;
        b=dAYcPYGlZJfv7rmv1dlFMhHjrB2QeB2Z6XvnLPjGplvflxq+iSTfct51dLailetaFe
         Fx7jwxcuJ8T42A/OgnWnWX8RDy2tcljK9W2LdXIaPvYI3kpywdiD6NJbw/IQdhwnUZyI
         w6XIbQgj1L8D19KxHjW7XN0jZZWRyeBO1D72c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=oVuPMBQ/GfYhsMn/R0v8XTr6Ptwa0anHxlXsCIErlY2/otEXu6LcQdhMwd4gU5X5Ub
         J27sD/4+3/ATy9KQRDS9uB/R0BV505MWvHATW8lUoH38NpwHRzeQdww0KZ6Qnm6k98Rf
         Og3tE9Dtc35Vc6y0wfCZqTQBJmirmziLA+VK8=
MIME-Version: 1.0
Received: by 10.115.86.7 with SMTP id o7mr3419713wal.50.1254872544051; Tue, 06 
	Oct 2009 16:42:24 -0700 (PDT)
In-Reply-To: <359a92830910060512v2aec94a0u5a55b70259d7bc11@mail.gmail.com>
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com>
	 <359a92830910060512v2aec94a0u5a55b70259d7bc11@mail.gmail.com>
Date: Wed, 7 Oct 2009 07:42:23 +0800
Message-ID: <8680aede0910061642y7fc8d496wd3bd185fde38f284@mail.gmail.com>
Subject: Re: Phase Extraction, mainly for English
From: Andrew Zhang <rooseve6891@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64b04483a03b904754cc829
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64b04483a03b904754cc829
Content-Type: text/plain; charset=ISO-8859-1

Hi Erick,

If you want to query, you should know the "phase" right? but I want to
discover the phase, or which words came together so often and by the natural
way, we use that as a phase.



On Tue, Oct 6, 2009 at 8:12 PM, Erick Erickson <erickerickson@gmail.com>wrote:

> Maybe I'm missing the problem entirely, but can you use phrase queries?or
> one of the Span* queries with a slop of 0 when searching?
>
> Best
> Erick
>
> On Tue, Oct 6, 2009 at 7:42 AM, Andrew Zhang <rooseve6891@gmail.com>
> wrote:
>
> > Hi guys,
> >
> > The requirement is very simple here, e.g. for this sentence, 'The NBA
> > formally announced its new *social media* guidelines Wednesday',  I want
> to
> > treat '*social media*' as a whole phase term. The default english
> analyzers
> > came with lucene all deal with single word, so it you want to get the
> most
> > frequent terms, *social *and *media* are separated, and each of them
> can't
> > represent a good meaning as *social media*, right?
> >
> > I know there's a way built on some phase dictionary, and try to match the
> > phase already there, very like the way to do with chinese language, but
> is
> > there an open source solution for english, I mean I don't want to build a
> > phase dictionary myself, and I also want a smart way, which can
> "discover"
> > the phase automatically. I got 2 millions docs analyzered the norma way,
> > all
> > single terms, which I can use as a base source, and it's possible to find
> > that *social media *came together frequently, but I really don't know
> > what's
> > the reverse way.
> >
> > I tried to find some phase analyzers, but no luck. so any advices?
> >
> > Regards,
> > Andrew
> > --
> > Simple is best
> >
>



-- 
Simple is best

--0016e64b04483a03b904754cc829--

From java-user-return-42640-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 00:24:46 2009
Return-Path: <java-user-return-42640-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28091 invoked from network); 7 Oct 2009 00:24:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 00:24:46 -0000
Received: (qmail 2154 invoked by uid 500); 7 Oct 2009 00:24:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2066 invoked by uid 500); 7 Oct 2009 00:24:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2056 invoked by uid 99); 7 Oct 2009 00:24:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 00:24:44 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.214 as permitted sender)
Received: from [209.85.219.214] (HELO mail-ew0-f214.google.com) (209.85.219.214)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 00:24:33 +0000
Received: by ewy10 with SMTP id 10so4821370ewy.9
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 17:24:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=Auj7zRJCQp4XZjQDDk4iGO4KoFrTHAs2fVk3m1DqpLU=;
        b=wmAXDeSzU+M/x7Lss4NqCWFvuRrYrSxe0clFffpT625OtYcT6N5KixfQBClkNw6s3P
         zKdwttg/f89sPRUkCICylsrZ5Gl3fLg21gBQ6gdmflOHsM7WR5zIjQAD6KjHyqBGwZdW
         bNPz+Yfly/1QVicA3feoaXn6v//cctd2axPuI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=XIAYhTq76CCOS8+HFLaQZbDzqgRNl+81fFSe+o5cNGYYeCZl5KIqMd6/gvJaNOImtn
         RZl/GWKKIDB4jcC/iCh3gD5I4T8oVy7FeopLIXcauggbvRuI7BiOUzPwCy2dOHMVUjKB
         lSKjX9nmg6E44mqnmnLrF6jXfO/MNUsIes8GQ=
Received: by 10.210.84.10 with SMTP id h10mr5684024ebb.70.1254875053417;
        Tue, 06 Oct 2009 17:24:13 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 28sm721068eyg.28.2009.10.06.17.24.12
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 06 Oct 2009 17:24:12 -0700 (PDT)
Message-Id: <AF11413E-68AC-413F-900F-C1651C9644E6@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <8680aede0910061639h2403e84fo77f9376e70011fb1@mail.gmail.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Phase Extraction, mainly for English
Date: Wed, 7 Oct 2009 02:24:11 +0200
References: <8680aede0910060442o5a0b6058rc30139af13b90265@mail.gmail.com> <2D5C9E79-5FAE-488C-8E96-3535326DB158@gmail.com> <8680aede0910061639h2403e84fo77f9376e70011fb1@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

There are many uses for shingles.

I've used them to find common phrases in text, which is my  
understanding of what you try to achieve. It works rather well, is a  
very simple solution and easy on resources compared to real semantic  
analysis.

You'll be getting a lot of shingles such as "there is" and "we are",  
but using a stop word lists to filter out any shingle contaning one or  
many of the stop words should do the trick (I did that in post  
processing, keeping all shingles in my index). It will probably  
require bit of manual work, depending on your corpora, to get a really  
clean list of common phrases that makes sense. Just create a list and  
inspect it with your eyes an try to find patterns in the phrases you  
want to get rid of. You might also want to look for punctuation in  
your text to avoid creating shingles of text that is in diffrent  
sentences. There is a pretty good sentence extraction tool in Gate you  
can use.


      karl

7 okt 2009 kl. 01.39 skrev Andrew Zhang:

> Hi Karl,
>
> I think shingle is designed to make the phase search faster, it'll  
> generate
> a lot of "seemed like" phase by pos only and completely disregard the
> meaning, that's not good enough.
>
> Regards,
> Andrew
>
> On Tue, Oct 6, 2009 at 11:51 PM, Karl Wettin <karl.wettin@gmail.com>  
> wrote:
>
>> Hi Andrew,
>>
>> I think you are looking for the shingle package in contrib/analyzers.
>>
>>
>>     karl
>>
>> 6 okt 2009 kl. 13.42 skrev Andrew Zhang:
>>
>>
>> Hi guys,
>>>
>>> The requirement is very simple here, e.g. for this sentence, 'The  
>>> NBA
>>> formally announced its new *social media* guidelines Wednesday',   
>>> I want
>>> to
>>> treat '*social media*' as a whole phase term. The default english
>>> analyzers
>>> came with lucene all deal with single word, so it you want to get  
>>> the most
>>> frequent terms, *social *and *media* are separated, and each of  
>>> them can't
>>> represent a good meaning as *social media*, right?
>>>
>>> I know there's a way built on some phase dictionary, and try to  
>>> match the
>>> phase already there, very like the way to do with chinese  
>>> language, but is
>>> there an open source solution for english, I mean I don't want to  
>>> build a
>>> phase dictionary myself, and I also want a smart way, which can  
>>> "discover"
>>> the phase automatically. I got 2 millions docs analyzered the  
>>> norma way,
>>> all
>>> single terms, which I can use as a base source, and it's possible  
>>> to find
>>> that *social media *came together frequently, but I really don't  
>>> know
>>> what's
>>> the reverse way.
>>>
>>> I tried to find some phase analyzers, but no luck. so any advices?
>>>
>>> Regards,
>>> Andrew
>>> --
>>> Simple is best
>>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> -- 
> Simple is best


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42641-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 01:50:29 2009
Return-Path: <java-user-return-42641-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53111 invoked from network); 7 Oct 2009 01:50:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 01:50:29 -0000
Received: (qmail 61140 invoked by uid 500); 7 Oct 2009 01:50:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61108 invoked by uid 500); 7 Oct 2009 01:50:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61098 invoked by uid 99); 7 Oct 2009 01:50:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 01:50:26 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mrs.nospam@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 01:50:16 +0000
Received: by bwz22 with SMTP id 22so3968045bwz.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 18:49:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=s0/7sfLgtQoZ9DibUdQOo+HgecadbenUrmeDuvd8fQY=;
        b=ncQYmsOP/71V1cnRx2pvBEtsSYlzhaoM1DGXuFERBO9hDg8kljT/EfMCUowGQCg4eg
         4Atsgkg3gebuaYLbX7Wj/pDM0j7b1oLLlyfM3M0YafzxCxVrgGT0LYT1J7zxeOp5BRRT
         Eo25YDeCqL9WqWA1LD2MvSQRiovOSxlveIUOM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=hfAOja1JHn8lyYj9CsivXHaVMAlH52nm8+lzix4He/E8siWOHb95GLk5zD/WfPtqYR
         K+3q90pp9CKq3dGD4qlA2eaIg80ErvRfQi3WZdPpkmcAqLXugc2VNjsI5x1uHd8WRXDI
         NwkOczM3TjulST7vldfqID7wGtgbN+ErZGqLg=
MIME-Version: 1.0
Received: by 10.204.25.15 with SMTP id x15mr5873083bkb.47.1254880195999; Tue, 
	06 Oct 2009 18:49:55 -0700 (PDT)
In-Reply-To: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
Date: Tue, 6 Oct 2009 21:49:55 -0400
Message-ID: <bd818c7b0910061849j54371e5ck8de4293a99b00cd2@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
From: no spam <mrs.nospam@gmail.com>
To: java-user@lucene.apache.org, chris@chriswere.com
Content-Type: multipart/alternative; boundary=00032555f2ba5179e004754e909a
X-Virus-Checked: Checked by ClamAV on apache.org

--00032555f2ba5179e004754e909a
Content-Type: text/plain; charset=ISO-8859-1

Have you investigated using Terracotta / Compass?  We need real-time updates
across the index using multiple web servers.  I recently got this up and
running and we're going to be doing some performance testing.  It's very
easy, essentially you just replace your FSDirectoryProvider with a
TerracottaDirectoryProvider that wraps the compass TerracottaDirectory.

http://relation.to/Bloggers/HibernateSearchClusteringWithTerracotta

--00032555f2ba5179e004754e909a--

From java-user-return-42642-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 02:08:01 2009
Return-Path: <java-user-return-42642-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56117 invoked from network); 7 Oct 2009 02:08:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 02:08:01 -0000
Received: (qmail 77190 invoked by uid 500); 7 Oct 2009 02:07:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77121 invoked by uid 500); 7 Oct 2009 02:07:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77109 invoked by uid 99); 7 Oct 2009 02:07:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 02:07:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 02:07:47 +0000
Received: by ywh15 with SMTP id 15so4223159ywh.5
        for <java-user@lucene.apache.org>; Tue, 06 Oct 2009 19:07:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=FyNt4+KmNMcco1n03q3Wz9kGDERdHV6ubfbKP8jI9zw=;
        b=uCjOl5E30jmWT/zDFVzLu4omjezpYueruU2GSmAg9Z6deQG9EkNNJ5AXGg2JJzhbmf
         WA2m2M/th2Rz2HFNrQm5JDDIYx+GjIi2yKS+eSRFMIwe/mPGa+wnNVta1aGwOrF2cNDK
         PU6OO4NMMVdFcpdJ+fPvZz+Bh7w+a+qcq6wZY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Uc8xtF/HMUqawiVX515BKNB0AQjWkzEjvgsx9y+8TpGcPqg2DuaH4qqsTvljLtp/UE
         n1ToYDShHAWY8ldRejZMKStwBVPjIJoWCHDM6nitWm/gXdMdOmMnbMWckAzf9WcVBhWY
         Vn5qLxaQ0QIexEd2vcGiFl2J8hJH38f5PyUNM=
MIME-Version: 1.0
Received: by 10.90.62.17 with SMTP id k17mr1118378aga.17.1254881246367; Tue, 
	06 Oct 2009 19:07:26 -0700 (PDT)
In-Reply-To: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
Date: Tue, 6 Oct 2009 19:07:26 -0700
Message-ID: <4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org, chris@chriswere.com
Content-Type: multipart/alternative; boundary=0016361e7a82ecd00b04754eced5
X-Virus-Checked: Checked by ClamAV on apache.org

--0016361e7a82ecd00b04754eced5
Content-Type: text/plain; charset=ISO-8859-1

Hi Chris,

  Answering your question depends in part whether your kind of scalability
is dependent on sharding (your index size is expected to grow to very large)
or just replication (your query load is large, and you need failover).  It
sounds like you're mostly thinking about the latter.

1) Each web server indexes the content separately. This will potentially
> cause different web servers to have slightly different indexes at any given
> time and also duplicates the work load of indexing the content
>

  If your indexing throughput is small enough, this can be a perfectly
simple
way to do this.  Just make sure you're not DOS'ing your DB if you're
indexing
via direct DB queries (ie. if you have a message queue or something else
firing off indexing events, instead of all web servers firing off
simultaneous
identical DB queries from different places.  DB caching will deal with this
pretty well, but you still need to be careful).


> 2) Using rsync (or a similar tool) to regularly update a local lucene index
> directory on each web server. I imagine there will be locking issues that
> need to be resolved here.
>

  rsync can work great, and and as Jason said, it is how Solr works and it
scales great.  Locking isn't really a worry, because in this setup, the
slaves
are read-only in this case, so they won't compete with rsync for write
access.


> 3) Using a network file system that all the web servers can access. I don't
> have much experience in this area, but potentially latency on searches will
> be high?
>

  Generally this is a really bad idea, and can lead to really hard-to-debug
performance problems.


> 4) Some alternative lucene specific solution that I haven't found in the
> wiki / lucene documentation.


> The indexes aim to be as real-time as possible, I currently update my
> IndexReaders in a background thread every 20 seconds.
>

This is where things diverge from common practice, especially if you at some
point decide to lower that to 10 or 5 seconds.

In this case, I'd say that if you have a reliable, scalable queueing system
for
getting indexing events distributed to all of your servers, then indexing on
all replicas simultaneously can be the best way to have maximally realtime
search, either using the very new feature of "near realtime search" in
Lucene 2.9, by using something home-brewed which indexes in memory
and on disk simultaneously, or using Zoie ( http://zoie.googlecode.com ),
an open-source realtime search library built on top of Lucene which we at
LinkedIn built and have been using in production for serving tens of
millions of queries a day in real time (meaning milliseconds, even under
fairly high indexing load) for the past year.

  -jake mannix

--0016361e7a82ecd00b04754eced5--

From java-user-return-42643-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 08:18:02 2009
Return-Path: <java-user-return-42643-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42673 invoked from network); 7 Oct 2009 08:18:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 08:18:02 -0000
Received: (qmail 76124 invoked by uid 500); 7 Oct 2009 08:18:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76047 invoked by uid 500); 7 Oct 2009 08:18:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76037 invoked by uid 99); 7 Oct 2009 08:18:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 08:18:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 08:17:50 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvRiD-0004eo-4B
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 01:17:29 -0700
Message-ID: <25782364.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 01:17:29 -0700 (PDT)
From: mastcheshmi <mehran.mastcheshmi@gmail.com>
To: java-user@lucene.apache.org
Subject: fa package
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: mehran.mastcheshmi@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


I download lucene 2.9.
I didnt find fa package.
I want use persianAnalyzer.
what do id do?
-- 
View this message in context: http://www.nabble.com/fa-package-tp25782364p25782364.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42644-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 08:52:03 2009
Return-Path: <java-user-return-42644-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51676 invoked from network); 7 Oct 2009 08:52:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 08:52:03 -0000
Received: (qmail 30275 invoked by uid 500); 7 Oct 2009 08:52:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30190 invoked by uid 500); 7 Oct 2009 08:52:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30180 invoked by uid 99); 7 Oct 2009 08:52:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 08:52:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 08:51:50 +0000
Received: by fxm2 with SMTP id 2so4316102fxm.28
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 01:51:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=70umaLRJWs8v5CasKjgjXpTFwOUekDe5o78/avDSwK0=;
        b=C8IFeE+YkIRi/RrdAtaSIlUeCxWX5ZzyOj/25BOi0gi+BOGV1JCJNO+cq/krVlJloL
         jdiG7BiWqLcEPE9BuMrUtGxJKYHbZ/ncyvug3Sih3qhEXzaWxzK48dVDJOiO3XGI4OYq
         bjfiBSuqO7fyB0pC+K/IPMRi5wQpS7m2p1o38=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=YOLX964fawKcffJsFipbAcOZd2l09en+xXHsnSozt1stGqqvdszI1tNtvLRiTP5KVe
         Q/wjOVNMPuTXI3CaeoBwtlr2nXo+v5FGzzP0nvRBJInwed7/925K55U8fTGzwtRBBLdt
         jb6zIh2Bszj238Vm/mx9h9m6EwAMaWTLI0L7U=
MIME-Version: 1.0
Received: by 10.239.190.216 with SMTP id y24mr211109hbh.185.1254905489252; 
	Wed, 07 Oct 2009 01:51:29 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <25782364.post@talk.nabble.com>
References: <25782364.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 10:51:29 +0200
Message-ID: <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com>
Subject: Re: fa package
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

see contrib/analyzers/

http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene/analysis/fa/PersianAnalyzer.html

simon

On Wed, Oct 7, 2009 at 10:17 AM, mastcheshmi
<mehran.mastcheshmi@gmail.com> wrote:
>
> I download lucene 2.9.
> I didnt find fa package.
> I want use persianAnalyzer.
> what do id do?
> --
> View this message in context: http://www.nabble.com/fa-package-tp25782364p25782364.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42645-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 09:48:46 2009
Return-Path: <java-user-return-42645-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67417 invoked from network); 7 Oct 2009 09:48:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 09:48:46 -0000
Received: (qmail 98036 invoked by uid 500); 7 Oct 2009 09:48:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97970 invoked by uid 500); 7 Oct 2009 09:48:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97960 invoked by uid 99); 7 Oct 2009 09:48:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 09:48:44 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 09:48:34 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvT81-0002GV-M9
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 02:48:13 -0700
Message-ID: <25783597.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 02:48:13 -0700 (PDT)
From: mastcheshmi <mehran.mastcheshmi@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: fa package
In-Reply-To: <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: mehran.mastcheshmi@gmail.com
References: <25782364.post@talk.nabble.com> <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org




Simon Willnauer wrote:
> 
> see contrib/analyzers/
> 
> http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene/analysis/fa/PersianAnalyzer.html
> 
> simon
> 
> On Wed, Oct 7, 2009 at 10:17 AM, mastcheshmi
> <mehran.mastcheshmi@gmail.com> wrote:
>>
>> I download lucene 2.9.
>> I didnt find fa package.
>> I want use persianAnalyzer.
>> what do id do?
>> --
>> View this message in context:
>> http://www.nabble.com/fa-package-tp25782364p25782364.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
thanks
i familar with link and persanAnalyzer class but this class not exist in
lucene-core-2.9.0.jar.
lucene-core-2.9.0.jar doesnt include fa package.
-- 
View this message in context: http://www.nabble.com/fa-package-tp25782364p25783597.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42646-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 09:51:58 2009
Return-Path: <java-user-return-42646-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69193 invoked from network); 7 Oct 2009 09:51:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 09:51:57 -0000
Received: (qmail 6125 invoked by uid 500); 7 Oct 2009 09:51:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6052 invoked by uid 500); 7 Oct 2009 09:51:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6041 invoked by uid 99); 7 Oct 2009 09:51:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 09:51:55 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.were@gmail.com designates 209.85.210.188 as permitted sender)
Received: from [209.85.210.188] (HELO mail-yx0-f188.google.com) (209.85.210.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 09:51:46 +0000
Received: by yxe26 with SMTP id 26so4787397yxe.20
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 02:51:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=qyWjF2W8m6oIpzzH5l38sV8KDWSwy39iKC0Z5X2HM2g=;
        b=pBB/tZ3LFY40yWv+WbFva3E4mixFQBMV5zihYM1NjdkPw5l1g4qLYkA+orHzjlg1z0
         9S4jG7CX4qvMexspwMFUZ9Naa4A1Ua4GSTzZMUc/Ko7DGrPwCAZyQ/UEcyeGcncsRKI6
         bEnBwD3zq0tKabvljyOa0KZ0eOOUGEeR3M0Bk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:from:date:message-id
         :subject:to:content-type;
        b=q6GVM2qb9nDL7A+Xq9bRwBlh7xMJaDeDFDSmkF1JM20yU9ftgcGj51fh7gl8o2Kk0+
         cDgJPQIXwWmM1NSs46l7tsB53bkyN/yLVYIHcN1IDei87oK4s7k+JsffQD/Ec9QKNFjG
         rdGKscbRcs1e7CgW8oLqZ/i/TQ17BVYCsD91U=
MIME-Version: 1.0
Received: by 10.90.198.4 with SMTP id v4mr1342624agf.79.1254909085238; Wed, 07 
	Oct 2009 02:51:25 -0700 (PDT)
Reply-To: chris@chriswere.com
In-Reply-To: <4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com> 
	<4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com>
From: Chris Were <chris.were@gmail.com>
Date: Wed, 7 Oct 2009 20:21:05 +1030
Message-ID: <35bb42690910070251u5405913eq6d13526177809b8c@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636283d9e4047f70475554a04
X-Virus-Checked: Checked by ClamAV on apache.org

--001636283d9e4047f70475554a04
Content-Type: text/plain; charset=ISO-8859-1

Thanks for all the excellent replies.
Lots of great of software mentioned that I'd never heard of -- and I thought
I'd Google'd this subject to death already!

Cheers,
Chris.

--001636283d9e4047f70475554a04--

From java-user-return-42647-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 10:11:24 2009
Return-Path: <java-user-return-42647-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74467 invoked from network); 7 Oct 2009 10:11:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 10:11:24 -0000
Received: (qmail 40301 invoked by uid 500); 7 Oct 2009 10:11:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40244 invoked by uid 500); 7 Oct 2009 10:11:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40233 invoked by uid 99); 7 Oct 2009 10:11:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:11:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:11:10 +0000
Received: by bwz22 with SMTP id 22so4188149bwz.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 03:10:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=DT2rutu6Oeg3qKWUDmOW3PqPfzJPwHZoaryhUbya5uE=;
        b=HcPMV7eKQ8MLO9St+UEOsSZ/OONQNL/JJguhzS97mhVYcWKG4w9EtcfaSnC7lGDENt
         j8NcVtnxMNo5nwQCxKOFiaqKWNwZLAmj/XBs4lkaNvb923P4T027UXIgUw2TsnyChv7G
         4gTs//MjiUjxzVjmbUMZXZJCYXdnKXXuaEUpQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=RhMtFrWoSzxoDPrb/Ce8JppwGekF/l33/URH6/8njGhyJRsdmX9ktG68c7Yt43s3oX
         ZeE4Zdfds8b5IV4nKrPJDBm1DsJRUWdIR1lFa3z371Z+/JTSCEROKKfWZyTIkpi72uAj
         WEEG6jIdoHAcDxYJo6fCPh+In18GOcI9k22sA=
MIME-Version: 1.0
Received: by 10.239.181.67 with SMTP id l3mr242440hbg.201.1254910249187; Wed, 
	07 Oct 2009 03:10:49 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <25783597.post@talk.nabble.com>
References: <25782364.post@talk.nabble.com>
	 <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com>
	 <25783597.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 12:10:49 +0200
Message-ID: <f18c9dde0910070310w19d26264j8774abcb03c0e89a@mail.gmail.com>
Subject: Re: fa package
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

if you download the lucene distribution there should be a folder
contrib. This folder contains a lot of contrib directories. Go to
contrib/analyzers/common and add the file lucene-analyzers-2.9.0.jar
to your buildpath. This jar should contain the persian analyzer.

Again this is not part of the lucene core.

simon

On Wed, Oct 7, 2009 at 11:48 AM, mastcheshmi
<mehran.mastcheshmi@gmail.com> wrote:
>
>
>
> Simon Willnauer wrote:
>>
>> see contrib/analyzers/
>>
>> http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene/analysis/fa/PersianAnalyzer.html
>>
>> simon
>>
>> On Wed, Oct 7, 2009 at 10:17 AM, mastcheshmi
>> <mehran.mastcheshmi@gmail.com> wrote:
>>>
>>> I download lucene 2.9.
>>> I didnt find fa package.
>>> I want use persianAnalyzer.
>>> what do id do?
>>> --
>>> View this message in context:
>>> http://www.nabble.com/fa-package-tp25782364p25782364.html
>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
> thanks
> i familar with link and persanAnalyzer class but this class not exist in
> lucene-core-2.9.0.jar.
> lucene-core-2.9.0.jar doesnt include fa package.
> --
> View this message in context: http://www.nabble.com/fa-package-tp25782364p25783597.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42648-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 10:36:29 2009
Return-Path: <java-user-return-42648-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79895 invoked from network); 7 Oct 2009 10:36:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 10:36:28 -0000
Received: (qmail 84277 invoked by uid 500); 7 Oct 2009 10:36:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84152 invoked by uid 500); 7 Oct 2009 10:36:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84098 invoked by uid 99); 7 Oct 2009 10:36:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:36:22 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.83] (HELO homiemail-a19.g.dreamhost.com) (208.97.132.83)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:36:10 +0000
Received: from [192.168.7.113] (host186.190-3-106.telmex.net.ar [190.3.106.186])
	by homiemail-a19.g.dreamhost.com (Postfix) with ESMTPA id AE194604061;
	Wed,  7 Oct 2009 03:35:46 -0700 (PDT)
From: Grant Ingersoll <gsingers@apache.org>
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Subject: ApacheCon US
Date: Wed, 7 Oct 2009 07:35:42 -0300
Message-Id: <EE4984D0-A622-4A17-AB89-B7FC2AD6AB65@apache.org>
To: java-user@lucene.apache.org,
 solr-user@lucene.apache.org,
 nutch-user@lucene.apache.org,
 mahout-user@lucene.apache.org,
 pylucene-dev@lucene.apache.org,
 lucene-net-dev@incubator.apache.org,
 general@lucene.apache.org,
 droids-dev@incubator.apache.org
Mime-Version: 1.0 (Apple Message framework v1076)
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

Just a friendly reminder to all about Lucene ecosystem events at  
ApacheCon US this year.  We have two days of talks on pretty much  
every project under Lucene (see http://lucene.apache.org/#14+August+2009+-+Lucene+at+US+ApacheCon 
) plus a meetup and a two day training on Lucene and a 1 day training  
on Solr.  The Lucene training will cover Lucene 2.9 and I'm sure  
Erik's Solr one will cover Solr 1.4.  I also know there will be quite  
a few Lucene, et. al. committers at ApacheCon this year, so it should  
be a good year to interact and discuss your favorite projects.

ApacheCon US is in Oakland (near San Francisco) the week of November  
2nd.  The trainings are on the 2nd and 3rd, and the main conference  
starts on the 4th.

You can register at http://www.us.apachecon.com/c/acus2009/

Hope to see you there,
Grant

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42649-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 10:39:53 2009
Return-Path: <java-user-return-42649-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80872 invoked from network); 7 Oct 2009 10:39:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 10:39:52 -0000
Received: (qmail 94559 invoked by uid 500); 7 Oct 2009 10:39:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94501 invoked by uid 500); 7 Oct 2009 10:39:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94491 invoked by uid 99); 7 Oct 2009 10:39:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:39:50 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:39:40 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvTvT-00060B-PW
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 03:39:19 -0700
Message-ID: <25783879.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 03:39:19 -0700 (PDT)
From: mastcheshmi <mehran.mastcheshmi@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: fa package
In-Reply-To: <25783597.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: mehran.mastcheshmi@gmail.com
References: <25782364.post@talk.nabble.com> <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com> <25783597.post@talk.nabble.com>
X-Virus-Checked: Checked by ClamAV on apache.org


where can I download fa package?
:confused:
-- 
View this message in context: http://www.nabble.com/fa-package-tp25782364p25783879.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42650-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 11:00:09 2009
Return-Path: <java-user-return-42650-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85674 invoked from network); 7 Oct 2009 11:00:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 11:00:09 -0000
Received: (qmail 22972 invoked by uid 500); 7 Oct 2009 11:00:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22922 invoked by uid 500); 7 Oct 2009 11:00:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22912 invoked by uid 99); 7 Oct 2009 11:00:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:00:06 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 10:59:57 +0000
Received: by ywh15 with SMTP id 15so4479798ywh.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 03:59:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=vfffQCglLeDqg2Qw68s3qkYSr2lhD4GLnREmBjThGMY=;
        b=Ab1jFL4VWZ/pvwxEl8wc6rdEt5GPb6xN7N7vNFdIMhxOezqEsApXtRR+3KT/EHTz1q
         09ejNJqEBJZEmpmrdq5g6k73CufwD8eQPp0gltbUTf/oYmuKwbL74iWqfuwfTXirGJAX
         dJ3aGoU4z1U5YognwHpsqql8gCHkbDoJEo+GA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=iMEgyi4GOdhIuiuQXd2eG7APMDxpulj662LMNockjhOal8o0U6nCz6e48vJNln6no7
         Fe93AHjcPsxbXmfnBZhxU6TnLTAzIshIg/NOpM5I4b1Tykk3nym2jen0QWgOwJznhJy8
         +CqwdgJy0kwDaBv9t56/ByemqlUTQTvYJImhs=
MIME-Version: 1.0
Received: by 10.101.17.6 with SMTP id u6mr2869592ani.78.1254913176095; Wed, 07 
	Oct 2009 03:59:36 -0700 (PDT)
In-Reply-To: <25783879.post@talk.nabble.com>
References: <25782364.post@talk.nabble.com> <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com> 
	<25783597.post@talk.nabble.com> <25783879.post@talk.nabble.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 7 Oct 2009 06:59:16 -0400
Message-ID: <8f0ad1f30910070359q1689503and521e7e43a12da1c@mail.gmail.com>
Subject: Re: fa package
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

the fa package is in lucene-2.9.0.zip, in
contrib\analyzers\common\lucene-analyzers-2.9.0.jar

On Wed, Oct 7, 2009 at 6:39 AM, mastcheshmi
<mehran.mastcheshmi@gmail.com> wrote:
>
> where can I download fa package?
> :confused:
> --
> View this message in context: http://www.nabble.com/fa-package-tp25782364p25783879.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



-- 
Robert Muir
rcmuir@gmail.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42651-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 11:28:34 2009
Return-Path: <java-user-return-42651-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91839 invoked from network); 7 Oct 2009 11:28:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 11:28:34 -0000
Received: (qmail 65757 invoked by uid 500); 7 Oct 2009 11:28:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65683 invoked by uid 500); 7 Oct 2009 11:28:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65673 invoked by uid 99); 7 Oct 2009 11:28:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:28:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:28:22 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvUgb-0000on-PR
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 04:28:01 -0700
Message-ID: <25783910.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 04:28:01 -0700 (PDT)
From: mastcheshmi <mehran.mastcheshmi@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: fa package
In-Reply-To: <25783597.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: mehran.mastcheshmi@gmail.com
References: <25782364.post@talk.nabble.com> <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com> <25783597.post@talk.nabble.com>
X-Virus-Checked: Checked by ClamAV on apache.org




mastcheshmi wrote:
> 
> 
> Simon Willnauer wrote:
>> 
>> see contrib/analyzers/
>> 
>> http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene/analysis/fa/PersianAnalyzer.html
>> 
>> simon
>> 
>> On Wed, Oct 7, 2009 at 10:17 AM, mastcheshmi
>> <mehran.mastcheshmi@gmail.com> wrote:
>>>
>>> I download lucene 2.9.
>>> I didnt find fa package.
>>> I want use persianAnalyzer.
>>> what do id do?
>>> --
>>> View this message in context:
>>> http://www.nabble.com/fa-package-tp25782364p25782364.html
>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>> 
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> 
>> 
>> 
> thanks
> i familar with that link and persanAnalyzer class but this class not exist
> in lucene-core-2.9.0.jar.
> lucene-core-2.9.0.jar doesnt include fa package.
> what should I do?
> 
where can I download fa package?
:confused:
-- 
View this message in context: http://www.nabble.com/fa-package-tp25782364p25783910.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42652-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 11:36:59 2009
Return-Path: <java-user-return-42652-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94404 invoked from network); 7 Oct 2009 11:36:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 11:36:58 -0000
Received: (qmail 76253 invoked by uid 500); 7 Oct 2009 11:36:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76180 invoked by uid 500); 7 Oct 2009 11:36:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76170 invoked by uid 99); 7 Oct 2009 11:36:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:36:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:36:45 +0000
Received: by bwz22 with SMTP id 22so4244512bwz.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 04:36:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=vqMbmyHra4vOxOp9z9lGa6ChocSDSMm0ARcO8A37daQ=;
        b=eAqzjz+p63JgQ2FxuzB0711o3JmGEjy463Q1H6BeDOBA1XN5ApzstQvOJDVXxBZNaT
         lN1KuvfrD6ozBpaR1+RlAV/NIOdt05SyFNEJsEze/M/qDzujJHzEbyOkqolrEd7D4rDK
         dmEUI3zyF/8b7N6VAVaH+coigYQHr9rvECoiI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=pXsS5wSAkxK7MEcYsIrGEUJ944CdLNzDzi9wXCiN5aQJh4tpA2ZU4XuU2tpDFovJNQ
         imSU7Dw4VQuxKX/ZtAMW5HgwVgWL2MelrDake8byVYHCao9Fdtw2T2ZO0u6ivYmxujm0
         6OVwgvySTCVUecPe9Km2U/yEpE5vi7TdO/9zA=
MIME-Version: 1.0
Received: by 10.239.138.34 with SMTP id n34mr267633hbn.64.1254915384070; Wed, 
	07 Oct 2009 04:36:24 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <25783910.post@talk.nabble.com>
References: <25782364.post@talk.nabble.com>
	 <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com>
	 <25783597.post@talk.nabble.com> <25783910.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 13:36:24 +0200
Message-ID: <f18c9dde0910070436m21266a09n75c7cc5ed595b94a@mail.gmail.com>
Subject: Re: fa package
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

download this: http://apache.autinity.de/lucene/java/lucene-2.9.0.zip
extract it into /some/path/lucene29
go to
  cd /some/path/lucene29/contrib/analyzer/common
copy jar file
  cp lucene-analyzers-2.9.0.jar /your/project/path

find the class :)

If that does not help I clueless
@robert: nice try :D

simon

On Wed, Oct 7, 2009 at 1:28 PM, mastcheshmi
<mehran.mastcheshmi@gmail.com> wrote:
>
>
>
> mastcheshmi wrote:
>>
>>
>> Simon Willnauer wrote:
>>>
>>> see contrib/analyzers/
>>>
>>> http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene/analysis/fa/PersianAnalyzer.html
>>>
>>> simon
>>>
>>> On Wed, Oct 7, 2009 at 10:17 AM, mastcheshmi
>>> <mehran.mastcheshmi@gmail.com> wrote:
>>>>
>>>> I download lucene 2.9.
>>>> I didnt find fa package.
>>>> I want use persianAnalyzer.
>>>> what do id do?
>>>> --
>>>> View this message in context:
>>>> http://www.nabble.com/fa-package-tp25782364p25782364.html
>>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>>
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>> thanks
>> i familar with that link and persanAnalyzer class but this class not exist
>> in lucene-core-2.9.0.jar.
>> lucene-core-2.9.0.jar doesnt include fa package.
>> what should I do?
>>
> where can I download fa package?
> :confused:
> --
> View this message in context: http://www.nabble.com/fa-package-tp25782364p25783910.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42653-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 11:49:54 2009
Return-Path: <java-user-return-42653-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97930 invoked from network); 7 Oct 2009 11:49:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 11:49:54 -0000
Received: (qmail 95570 invoked by uid 500); 7 Oct 2009 11:49:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95523 invoked by uid 500); 7 Oct 2009 11:49:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95493 invoked by uid 99); 7 Oct 2009 11:49:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:49:50 +0000
X-ASF-Spam-Status: No, hits=3.1 required=10.0
	tests=HTML_MESSAGE,MIME_HEADER_CTYPE_ONLY,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of dragon-fly999@hotmail.com designates 65.55.111.104 as permitted sender)
Received: from [65.55.111.104] (HELO blu0-omc2-s29.blu0.hotmail.com) (65.55.111.104)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 11:49:38 +0000
Received: from BLU149-W20 ([65.55.111.72]) by blu0-omc2-s29.blu0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Wed, 7 Oct 2009 04:49:14 -0700
Message-ID: <BLU149-W2005D736A37155979C1192B9CD0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_44fa6bb4-2ae1-40c8-8b15-15062d94f71f_"
X-Originating-IP: [137.103.1.90]
From: Dragon Fly <dragon-fly999@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: RE: Document loading
Date: Wed, 7 Oct 2009 07:49:14 -0400
Importance: Normal
In-Reply-To: <f18c9dde0910061505w3f876585ya0ad7c749b2e987@mail.gmail.com>
References: <BLU149-W54BFA6FF4AE7A61E4932E2B9CE0@phx.gbl>
X-OriginalArrivalTime: 07 Oct 2009 11:49:14.0625 (UTC) FILETIME=[316FF710:01CA4744]
X-Virus-Checked: Checked by ClamAV on apache.org

--_44fa6bb4-2ae1-40c8-8b15-15062d94f71f_
Content-Type: text/plain; charset="Windows-1252"
Content-Transfer-Encoding: quoted-printable


Thanks.

> Date: Wed=2C 7 Oct 2009 00:05:43 +0200
> Subject: Re: Document loading
> From: simon.willnauer@googlemail.com
> To: java-user@lucene.apache.org
>=20
> Hi=2C
> a call to IndexSearcher.doc(docId) will load the document. Internally
> this call forwards to IndexReader.document(docId) which could be very
> expensive because this method will load all stored document fields.
>=20
> I would recommend to have a look at IndexSearcher.doc(docId=2C
> FieldSelector). This method offers you way more control over field
> loading costs. With the FieldSelector you can directly load fields=2C do
> lazy loading or stop the loading process once a certain field was
> loaded.
> If you do not load a field due to the fieldSelector a call to
> Document.get("fieldname") will return null.
>=20
> Simon
>=20
> On Tue=2C Oct 6=2C 2009 at 2:38 PM=2C Dragon Fly <dragon-fly999@hotmail.c=
om> wrote:
> >
> > Hi=2C
> >
> > Which of the following method actually loads the document from disk?
> >
> > (1) Document document =3D searcher.doc (docId)=3B
> >
> > OR
> >
> > (2) string value =3D document.get ("FirstNameField")=3B
> >
> > It's probably searcher.doc but I just want to be sure.  Thank you.
> > _________________________________________________________________
> > Hotmail: Trusted email with Microsoft=92s powerful SPAM protection.
> > http://clk.atdmt.com/GBL/go/177141664/direct/01/
>=20
> ---------------------------------------------------------------------
> To unsubscribe=2C e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands=2C e-mail: java-user-help@lucene.apache.org
>=20
 		 	   		  =0A=
_________________________________________________________________=0A=
Hotmail: Powerful Free email with security by Microsoft.=0A=
http://clk.atdmt.com/GBL/go/171222986/direct/01/=

--_44fa6bb4-2ae1-40c8-8b15-15062d94f71f_--

From java-user-return-42654-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 12:13:07 2009
Return-Path: <java-user-return-42654-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6916 invoked from network); 7 Oct 2009 12:13:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 12:13:07 -0000
Received: (qmail 32196 invoked by uid 500); 7 Oct 2009 12:13:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32113 invoked by uid 500); 7 Oct 2009 12:13:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32103 invoked by uid 99); 7 Oct 2009 12:13:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 12:13:05 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 12:12:55 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvVNi-0003vn-Eb
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 05:12:34 -0700
Message-ID: <25783935.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 05:12:34 -0700 (PDT)
From: mastcheshmi <mehran.mastcheshmi@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: fa package
In-Reply-To: <25783597.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: mehran.mastcheshmi@gmail.com
References: <25782364.post@talk.nabble.com> <f18c9dde0910070151m511064a5kb7b93aaadb80e160@mail.gmail.com> <25783597.post@talk.nabble.com>
X-Virus-Checked: Checked by ClamAV on apache.org




mastcheshmi wrote:
> 
> 
> Simon Willnauer wrote:
>> 
>> see contrib/analyzers/
>> 
>> http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene/analysis/fa/PersianAnalyzer.html
>> 
>> simon
>> 
>> On Wed, Oct 7, 2009 at 10:17 AM, mastcheshmi
>> <mehran.mastcheshmi@gmail.com> wrote:
>>>
>>> I download lucene 2.9.
>>> I didnt find fa package.
>>> I want use persianAnalyzer.
>>> what do id do?
>>> --
>>> View this message in context:
>>> http://www.nabble.com/fa-package-tp25782364p25782364.html
>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>> 
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> 
>> 
>> 
> thanks
> i familar with that link and persanAnalyzer class but this class not exist
> in lucene-core-2.9.0.jar.
> lucene-core-2.9.0.jar doesnt include fa package.
> what should I do?
> 
i find fa package in contrib.:-D
thanks a lot simon

-- 
View this message in context: http://www.nabble.com/fa-package-tp25782364p25783935.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42655-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 18:16:25 2009
Return-Path: <java-user-return-42655-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37686 invoked from network); 7 Oct 2009 18:16:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 18:16:25 -0000
Received: (qmail 55782 invoked by uid 500); 7 Oct 2009 18:16:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55710 invoked by uid 500); 7 Oct 2009 18:16:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55700 invoked by uid 99); 7 Oct 2009 18:16:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 18:16:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 18:16:12 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1Mvb3H-0007Yy-Ds
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 11:15:51 -0700
Message-ID: <25791659.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 11:15:51 -0700 (PDT)
From: Maarten_D <maarten.dirkse@gmail.com>
To: java-user@lucene.apache.org
Subject: Best strategy for reindexing large amount of data
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: maarten.dirkse@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,
I've searched the mailinglists and documentation for a clear answer to the
following question, but haven't found one, so here goes:

We use Lucene to index and search a constant stream of messages: our index
is always growing. In the past, if we added new features to the software
that required the index to be rebuilt (adopting an accent-insensitive
analyzer for instance, or adding a field to every lucene Document), we would
build an entirely new index out of all the messages we had stored, and then
swap out the old one with the new one. Recently, we've had a couple of
clients whose message stores are so large that our strategy is no longer
viable: building a new index from scratch takes, for various reasons not
related to lucene, upwards of 48 hours, and that period will only increase
when client message stores grow bigger and bigger.

What I would like is to update the index piecemeal, starting with the most
recently added document (ie the most recent messages, since clients usually
care about those the most). Then, most of the users will see the new
functionality in their searches fairly quickly, and the older stuff, which
doesn't matter so much, will get reindexed at a later date. However, I'm
unclear as to what would be the best/most performant way to accomplish this.

There are a few strategies I've thought of, and I was wondering if anyone
could help me out as to which would be the best idea (or if there are other,
better methods that I haven't thought of). I should also say that every
message in the system has a unique identifier (guid) that can be used to see
whether two different lucene documents represent the same message.

1. Simply iterate over all message in the message store, convert them to
lucene documents, and call IndexWriter.update() for each one (using the
guid).

2. Iterate over all messages in small steps (say 1000 at a time), and the
for each batch delete the existing documents from the index, and then do
Indexwriter.insert() for all messages (this is essentially step 1, split up
into small parts and with the delete and insert part batched).

3. Iterate over all messages in small steps, and for each batch create a
separate index (lets say a RAM index), delete all the old documents from the
main index, and merge the seperate index into the main one.

4. Same as 3, except merge first, and then remove the old duplicates.

Any help on this issue would be much appreciated.

Thanks in advance,
Maarten
-- 
View this message in context: http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25791659.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42656-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 18:36:06 2009
Return-Path: <java-user-return-42656-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50160 invoked from network); 7 Oct 2009 18:36:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 18:36:06 -0000
Received: (qmail 91193 invoked by uid 500); 7 Oct 2009 18:36:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91130 invoked by uid 500); 7 Oct 2009 18:36:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91120 invoked by uid 99); 7 Oct 2009 18:36:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 18:36:04 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 74.125.92.24 as permitted sender)
Received: from [74.125.92.24] (HELO qw-out-2122.google.com) (74.125.92.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 18:35:53 +0000
Received: by qw-out-2122.google.com with SMTP id 5so1831981qwi.53
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 11:35:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=n9CsY4zyO0nD5Lu1C2AfNrvv8yCJ++hlHB+ofon34U4=;
        b=OVtQA8a253JQcFdVjAGNmhSgV6sG/mJlkOkRU0z0AyfCZhXmFsa/dtXUDmJiKIPupF
         x8YPIPFKt8t9x4oTBUGjb1PMwLV+4SsoZ2XtIaWOkN0QhCrbq+OMH0E3QD+t2fWuY2L9
         /mxuyYk8+p1lIbYDHTEIjIoOGjmq19TlIRp1M=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=PQxJLUlsF5edT/5agrdguXr2DmxMN8rws12PqqDh/BVBexUKWe227yy/FwLsa05X5r
         QGEnoYAbT+R6hTtJrE4qA9TtOTdohp+tAVxWEd9E37WuWYgEwdX4k+inVPrPdboqZOFk
         sNjwyKKKAIDIAazzyULNWM8Rk3fAW5nIzNUqM=
MIME-Version: 1.0
Received: by 10.224.93.77 with SMTP id u13mr281798qam.226.1254940532455; Wed, 
	07 Oct 2009 11:35:32 -0700 (PDT)
In-Reply-To: <25791659.post@talk.nabble.com>
References: <25791659.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 11:35:32 -0700
Message-ID: <85d3c3b60910071135o1802f859mc597d1c96c63d815@mail.gmail.com>
Subject: Re: Best strategy for reindexing large amount of data
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Maarten,

Depending on the hardware available you can use a Hadoop cluster
to reindex more quickly. With Amazon EC2 one can spin up several
nodes, reindex, then tear them down when they're no longer
needed. Also you can simply update in place the existing
documents in the index, though you'd need to be careful not to
overload the server with indexing calls such that queries would
not be responsive. Number 3 (batches) could be used to create an
index on the side (like a Solr master), record deletes into a
file, then merge the newly created index in, apply deletes, then
commit to see the changes.

There's advantages and disadvantages to each strategy.

-J

On Wed, Oct 7, 2009 at 11:15 AM, Maarten_D <maarten.dirkse@gmail.com> wrote:
>
> Hi,
> I've searched the mailinglists and documentation for a clear answer to the
> following question, but haven't found one, so here goes:
>
> We use Lucene to index and search a constant stream of messages: our index
> is always growing. In the past, if we added new features to the software
> that required the index to be rebuilt (adopting an accent-insensitive
> analyzer for instance, or adding a field to every lucene Document), we would
> build an entirely new index out of all the messages we had stored, and then
> swap out the old one with the new one. Recently, we've had a couple of
> clients whose message stores are so large that our strategy is no longer
> viable: building a new index from scratch takes, for various reasons not
> related to lucene, upwards of 48 hours, and that period will only increase
> when client message stores grow bigger and bigger.
>
> What I would like is to update the index piecemeal, starting with the most
> recently added document (ie the most recent messages, since clients usually
> care about those the most). Then, most of the users will see the new
> functionality in their searches fairly quickly, and the older stuff, which
> doesn't matter so much, will get reindexed at a later date. However, I'm
> unclear as to what would be the best/most performant way to accomplish this.
>
> There are a few strategies I've thought of, and I was wondering if anyone
> could help me out as to which would be the best idea (or if there are other,
> better methods that I haven't thought of). I should also say that every
> message in the system has a unique identifier (guid) that can be used to see
> whether two different lucene documents represent the same message.
>
> 1. Simply iterate over all message in the message store, convert them to
> lucene documents, and call IndexWriter.update() for each one (using the
> guid).
>
> 2. Iterate over all messages in small steps (say 1000 at a time), and the
> for each batch delete the existing documents from the index, and then do
> Indexwriter.insert() for all messages (this is essentially step 1, split up
> into small parts and with the delete and insert part batched).
>
> 3. Iterate over all messages in small steps, and for each batch create a
> separate index (lets say a RAM index), delete all the old documents from the
> main index, and merge the seperate index into the main one.
>
> 4. Same as 3, except merge first, and then remove the old duplicates.
>
> Any help on this issue would be much appreciated.
>
> Thanks in advance,
> Maarten
> --
> View this message in context: http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25791659.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42657-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 19:51:59 2009
Return-Path: <java-user-return-42657-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18478 invoked from network); 7 Oct 2009 19:51:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 19:51:59 -0000
Received: (qmail 26881 invoked by uid 500); 7 Oct 2009 19:51:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26843 invoked by uid 500); 7 Oct 2009 19:51:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26783 invoked by uid 99); 7 Oct 2009 19:51:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 19:51:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nigelspleen@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 19:51:46 +0000
Received: by bwz22 with SMTP id 22so4718178bwz.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 12:51:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=gHKMkbCB02sCln1It5MAafAg6q04QKbP0cIgJGumwd8=;
        b=L0C1VjB8+GLkMQBXrWu25gQiqqVqxmydeKLH3UvJ9zzOUXrDAMrZ06Q/2ba51MBny5
         7KkXLkn7BcsD9EZtVrQaHqOdvg1iLlTj4UXk1Eh4ffE6wRHJ55eKcLZlcMm2ml7Hw2Xd
         ms7/ioi4bY8PGGuFdq1za0Cfhim21jv/xysU4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=rEIvUEvVRsT3iQr65b6g8Cc3FLft4vVQ12B5/0DK4BYd+dkqlimIDrD27fGsf4dREV
         wEF6tVR7/2WiSwGnpw0sYlH3tCYKjpfh/sCKG+g3NDOAHZvLFg8TGuHmCIkwnprOJ+03
         wRjTnWduLN6ibGyHbYoRc+c2PscxVOjSJHiEk=
MIME-Version: 1.0
Received: by 10.103.127.32 with SMTP id e32mr129519mun.70.1254945086157; Wed, 
	07 Oct 2009 12:51:26 -0700 (PDT)
In-Reply-To: <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com>
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
	 <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
	 <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com>
Date: Wed, 7 Oct 2009 15:51:26 -0400
Message-ID: <843920a30910071251q2e7850b7yd15edff35fd88d87@mail.gmail.com>
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
From: Nigel <nigelspleen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364d21a712b4e904755dac46
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364d21a712b4e904755dac46
Content-Type: text/plain; charset=ISO-8859-1

Right now we logically re-open an index by making an updated copy of the
index in a new directory (using rsync etc.), opening the new copy, and
closing the old one.  We don't use IndexReader.reopen() because the updated
index is in a different directory (as opposed to being updated in-place).

(Reading about some of the 2.9 changes motivated me to look into actually
using reopen().  And Michael Busch and Mark Miller both pointed out that I
was incorrect in saying that pre-2.9 reopen() wasn't more efficient than
just opening a new index -- I've read through that code now so I have at
least a basic understanding of what's happening there.  Anyway, it seems
like reopen() is a Good Thing, so I'd like to use it. (-:)

So, my real question was whether there is a "recommended" way to update an
index in-place with files copied from a separate indexing server.

For example, do you simply rsync in the new cfs files, overwrite the
segments.gen and segments_XX files, and call reopen()?  Or create an updated
copy in a new directory, then rename new directory to the old name once
you're sure you've copied everything successfully, then call reopen()?  What
does Solr do?

Thanks,
Chris

On Mon, Oct 5, 2009 at 8:39 PM, Jason Rutherglen <jason.rutherglen@gmail.com
> wrote:

> I'm not sure I understand the question. You're trying to reopen
> the segments that you're replicated and you're wondering what's
> changed in Lucene?
>
> On Mon, Oct 5, 2009 at 5:30 PM, Nigel <nigelspleen@gmail.com> wrote:
> > Anyone have any ideas here?  I imagine a lot of other people will have a
> > similar question when trying to take advantage of the reopen improvements
> in
> > 2.9.
> >
> > Thanks,
> > Chris
> >
> > On Thu, Oct 1, 2009 at 5:15 PM, Nigel <nigelspleen@gmail.com> wrote:
> >
> >> I have a question about the reopen functionality in Lucene 2.9.  As I
> >> understand it, since FieldCaches are now per-segment, it can avoid
> reloading
> >> everything when the index is reopened, and instead just load the new
> >> segments.
> >>
> >> For background, like many people we have a distributed architecture
> where
> >> indexes are created on one server and copied to multiple other servers.
>  The
> >> way that copying works now is something like the following:
> >>
> >>    1. Let's say the current index is in /indexes/a and is open
> >>    2. An empty directory for the updated index is created, let's say
> >>    /indexes/b
> >>    3. Hard links for the files in /indexes/a are created in /indexes/b
> >>    4. We rsync the current index on the server with /indexes/b, thus
> >>    copying over new cfs files and deleting hard links to files no longer
> in use
> >>    5. A new IndexReader is opened for /indexes/b and warmed up
> >>    6. The application starts using the new reader instead of the old one
> >>    7. The old IndexReader is closed and /indexes/a is deleted
> >>
> >> I'm simplifying a few steps, but I think this is familiar to many
> people,
> >> and it's my impression that Solr implements something similar.
> >>
> >> The point is, the updated index lives in a new directory in this scheme,
> >> and so we don't actually reopen the existing IndexReader; we open a new
> one
> >> with a different FSDirectory.
> >>
> >> Before Lucene 2.9, I don't think this made any difference, as (I think)
> the
> >> only advantage to calling reopen vs. just creating another IndexReader
> was
> >> having reopen figure out whether the index had actually changed.  (And
> whave
> >> a different way to figure that out, so it was a non-issue.)
> >>
> >> With Lucene 2.9, there's now a big difference, namely the per-segment
> >> caching mentioned above.  So the question is how to make use of reopen
> with
> >> our distribution scheme.  Is there an informal best practice for
> handling
> >> this case?  For example, should step #5 above rename /indexes/b to
> >> /indexes/a so the index can be reopened in the same physical location?
>  Or
> >> should rsync operate on the existing directory in-place, updating the
> >> segments* files last and relying on the fact that deleted files will not
> >> really be deleted (on Linux, at least) as long as the app is still
> holding
> >> them open?
> >>
> >> I guess the answer may depend on how exactly reopen knows which files
> are
> >> the "same" (e.g. does it look at filenames, or file descriptors, etc.).
> >>
> >> Thanks,
> >> Chris
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364d21a712b4e904755dac46--

From java-user-return-42658-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 20:00:55 2009
Return-Path: <java-user-return-42658-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21822 invoked from network); 7 Oct 2009 20:00:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 20:00:55 -0000
Received: (qmail 45827 invoked by uid 500); 7 Oct 2009 20:00:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45774 invoked by uid 500); 7 Oct 2009 20:00:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45764 invoked by uid 99); 7 Oct 2009 20:00:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:00:53 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:00:42 +0000
Received: by ywh15 with SMTP id 15so4962743ywh.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 13:00:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=6ngssgYM25HKRQBD7Ze7/m1Fnok7QyRXE0cMdB9pPtU=;
        b=qIFmiHi1FzVHwXeNkJ+QZr8IK/FHaG10YQcjHnYVccpYtBPcYy5n3cK773ViqQzei2
         fRkOsggpz2HOdDieN4+rgJBCrIuXcTFCw7ffrrFW6xlsKWDjEIJW8BXYuusl8dFBqH9y
         OPSADHC0odo3UwqbIy0hWFra6NRRJDSyaWWH8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=H8yictmchuUs/t15SAMk034De/v0GFcYAGUoF6+RyVhdWg9LuapxExf/008NDGQR9h
         NqBbTbfEDVqisxzZqwROv0H3akDsdTNA+kRxtOnLGHAZd02B1gBGIgYWHcLHmMHrZZoC
         Eus1jYqJ9gtiDRHcjKx1hT0EQJMHKaSGy/HUE=
MIME-Version: 1.0
Received: by 10.91.189.1 with SMTP id r1mr204018agp.109.1254945621320; Wed, 07 
	Oct 2009 13:00:21 -0700 (PDT)
In-Reply-To: <85d3c3b60910071135o1802f859mc597d1c96c63d815@mail.gmail.com>
References: <25791659.post@talk.nabble.com>
	 <85d3c3b60910071135o1802f859mc597d1c96c63d815@mail.gmail.com>
Date: Wed, 7 Oct 2009 13:00:21 -0700
Message-ID: <4b124c310910071300j316e8087p13b64b70bde2fb85@mail.gmail.com>
Subject: Re: Best strategy for reindexing large amount of data
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64602d6f8b4ad04755dcb89
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64602d6f8b4ad04755dcb89
Content-Type: text/plain; charset=ISO-8859-1

I think a Hadoop cluster is maybe a bit overkill for this kind of
thing - it's pretty common to have to do "grandfathering" of an
index when you have new features, and just doing it in place
with IndexWriter.update() can work just fine as long as you
are not very frequently reopening your index.

The fact that you want to update in reverse chronological order
means good things in terms of your index: I'm assuming you
don't have a fully optimized index, in which case the newer
documents are going to live in the smallest segments, so
updating those documents in reverse order will add a lot
of deletes to those segments, and then write new segments
to disk with those updated docs in it.  As merges happen, the
newer deletes will get resolved as the younger segments
merge together, gradually working your way up to the
biggest segments - the whole time pretty much only deleting
from one segment at a time.

This should play pretty nicely with your system's IO cache,
so as long as  you're not hammering your CPU with
excessive indexing rate (and it looks like you're throttled
on some outside-of-lucene process anyways, so you're not
indexing as fast as you could: so just make sure you're not
being too bursty about it [unless the burstiness is during
off-hours at night]).

But play with it!  Try doing in place in your test / performance
cluster, and see what your query latency is like while running
at a couple of different update rates, in comparison to baseline.
You'll probably find that that even pretty fast indexing doesn't
degrade performance if a) you're not already close to being
at CPU saturation, and b) you're not reopening your disk index
too terribly frequently.

  -jake

On Wed, Oct 7, 2009 at 11:35 AM, Jason Rutherglen <
jason.rutherglen@gmail.com> wrote:

> Maarten,
>
> Depending on the hardware available you can use a Hadoop cluster
> to reindex more quickly. With Amazon EC2 one can spin up several
> nodes, reindex, then tear them down when they're no longer
> needed. Also you can simply update in place the existing
> documents in the index, though you'd need to be careful not to
> overload the server with indexing calls such that queries would
> not be responsive. Number 3 (batches) could be used to create an
> index on the side (like a Solr master), record deletes into a
> file, then merge the newly created index in, apply deletes, then
> commit to see the changes.
>
> There's advantages and disadvantages to each strategy.
>
> -J
>
> On Wed, Oct 7, 2009 at 11:15 AM, Maarten_D <maarten.dirkse@gmail.com>
> wrote:
> >
> > Hi,
> > I've searched the mailinglists and documentation for a clear answer to
> the
> > following question, but haven't found one, so here goes:
> >
> > We use Lucene to index and search a constant stream of messages: our
> index
> > is always growing. In the past, if we added new features to the software
> > that required the index to be rebuilt (adopting an accent-insensitive
> > analyzer for instance, or adding a field to every lucene Document), we
> would
> > build an entirely new index out of all the messages we had stored, and
> then
> > swap out the old one with the new one. Recently, we've had a couple of
> > clients whose message stores are so large that our strategy is no longer
> > viable: building a new index from scratch takes, for various reasons not
> > related to lucene, upwards of 48 hours, and that period will only
> increase
> > when client message stores grow bigger and bigger.
> >
> > What I would like is to update the index piecemeal, starting with the
> most
> > recently added document (ie the most recent messages, since clients
> usually
> > care about those the most). Then, most of the users will see the new
> > functionality in their searches fairly quickly, and the older stuff,
> which
> > doesn't matter so much, will get reindexed at a later date. However, I'm
> > unclear as to what would be the best/most performant way to accomplish
> this.
> >
> > There are a few strategies I've thought of, and I was wondering if anyone
> > could help me out as to which would be the best idea (or if there are
> other,
> > better methods that I haven't thought of). I should also say that every
> > message in the system has a unique identifier (guid) that can be used to
> see
> > whether two different lucene documents represent the same message.
> >
> > 1. Simply iterate over all message in the message store, convert them to
> > lucene documents, and call IndexWriter.update() for each one (using the
> > guid).
> >
> > 2. Iterate over all messages in small steps (say 1000 at a time), and the
> > for each batch delete the existing documents from the index, and then do
> > Indexwriter.insert() for all messages (this is essentially step 1, split
> up
> > into small parts and with the delete and insert part batched).
> >
> > 3. Iterate over all messages in small steps, and for each batch create a
> > separate index (lets say a RAM index), delete all the old documents from
> the
> > main index, and merge the seperate index into the main one.
> >
> > 4. Same as 3, except merge first, and then remove the old duplicates.
> >
> > Any help on this issue would be much appreciated.
> >
> > Thanks in advance,
> > Maarten
> > --
> > View this message in context:
> http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25791659.html
> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64602d6f8b4ad04755dcb89--

From java-user-return-42659-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 20:03:23 2009
Return-Path: <java-user-return-42659-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22680 invoked from network); 7 Oct 2009 20:03:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 20:03:23 -0000
Received: (qmail 51011 invoked by uid 500); 7 Oct 2009 20:03:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50934 invoked by uid 500); 7 Oct 2009 20:03:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50924 invoked by uid 99); 7 Oct 2009 20:03:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:03:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 72.14.220.153 as permitted sender)
Received: from [72.14.220.153] (HELO fg-out-1718.google.com) (72.14.220.153)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:03:10 +0000
Received: by fg-out-1718.google.com with SMTP id 16so1588697fgg.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 13:02:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=YzYuOOS8z49fLboZcrWCE3glaYnYjWJAbWHIuXzdivE=;
        b=WIH3vqLn9Bsnc1vRd0ChMrnVfCqFvRv3QA6+le+1mq9DCC+AApqTjU7SuW46daghRV
         1pjdXuPKQcLU8pWYlA+lqN7EEyQ/tZn3hvJQYsuGh7DgnIa7cxxIMr1kT60S4sGdifmc
         glVHUjl+6OfZT6rmmHIbQGSMRt0/aqVs2yhCs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=sDGd0P2w32qX8EcWbeZmt3zLa/GjPHEy5jTHZr1s5FMmToHPIcKHjUX/SvGxHgZlhN
         0+afqppiPwTFo980ao15o2S0JWZ5bTSp2qcKXiLBbg6Nt30+JGrAFMaAH1XBFDQH1UoI
         C4UeMFyEAV1lpyJzTy8T0UD4MVNgKclowJlFY=
Received: by 10.86.231.17 with SMTP id d17mr344526fgh.46.1254945769685;
        Wed, 07 Oct 2009 13:02:49 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id l12sm265601fgb.11.2009.10.07.13.02.47
        (version=SSLv3 cipher=RC4-MD5);
        Wed, 07 Oct 2009 13:02:48 -0700 (PDT)
Message-ID: <4ACCF3E7.7010500@gmail.com>
Date: Wed, 07 Oct 2009 16:02:47 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>	 <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>	 <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com> <843920a30910071251q2e7850b7yd15edff35fd88d87@mail.gmail.com>
In-Reply-To: <843920a30910071251q2e7850b7yd15edff35fd88d87@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Solr just copies them into the same directory - Lucene files are write
once, so its not much different than what happens locally.

Nigel wrote:
> Right now we logically re-open an index by making an updated copy of the
> index in a new directory (using rsync etc.), opening the new copy, and
> closing the old one.  We don't use IndexReader.reopen() because the updated
> index is in a different directory (as opposed to being updated in-place).
>
> (Reading about some of the 2.9 changes motivated me to look into actually
> using reopen().  And Michael Busch and Mark Miller both pointed out that I
> was incorrect in saying that pre-2.9 reopen() wasn't more efficient than
> just opening a new index -- I've read through that code now so I have at
> least a basic understanding of what's happening there.  Anyway, it seems
> like reopen() is a Good Thing, so I'd like to use it. (-:)
>
> So, my real question was whether there is a "recommended" way to update an
> index in-place with files copied from a separate indexing server.
>
> For example, do you simply rsync in the new cfs files, overwrite the
> segments.gen and segments_XX files, and call reopen()?  Or create an updated
> copy in a new directory, then rename new directory to the old name once
> you're sure you've copied everything successfully, then call reopen()?  What
> does Solr do?
>
> Thanks,
> Chris
>
> On Mon, Oct 5, 2009 at 8:39 PM, Jason Rutherglen <jason.rutherglen@gmail.com
>   
>> wrote:
>>     
>
>   
>> I'm not sure I understand the question. You're trying to reopen
>> the segments that you're replicated and you're wondering what's
>> changed in Lucene?
>>
>> On Mon, Oct 5, 2009 at 5:30 PM, Nigel <nigelspleen@gmail.com> wrote:
>>     
>>> Anyone have any ideas here?  I imagine a lot of other people will have a
>>> similar question when trying to take advantage of the reopen improvements
>>>       
>> in
>>     
>>> 2.9.
>>>
>>> Thanks,
>>> Chris
>>>
>>> On Thu, Oct 1, 2009 at 5:15 PM, Nigel <nigelspleen@gmail.com> wrote:
>>>
>>>       
>>>> I have a question about the reopen functionality in Lucene 2.9.  As I
>>>> understand it, since FieldCaches are now per-segment, it can avoid
>>>>         
>> reloading
>>     
>>>> everything when the index is reopened, and instead just load the new
>>>> segments.
>>>>
>>>> For background, like many people we have a distributed architecture
>>>>         
>> where
>>     
>>>> indexes are created on one server and copied to multiple other servers.
>>>>         
>>  The
>>     
>>>> way that copying works now is something like the following:
>>>>
>>>>    1. Let's say the current index is in /indexes/a and is open
>>>>    2. An empty directory for the updated index is created, let's say
>>>>    /indexes/b
>>>>    3. Hard links for the files in /indexes/a are created in /indexes/b
>>>>    4. We rsync the current index on the server with /indexes/b, thus
>>>>    copying over new cfs files and deleting hard links to files no longer
>>>>         
>> in use
>>     
>>>>    5. A new IndexReader is opened for /indexes/b and warmed up
>>>>    6. The application starts using the new reader instead of the old one
>>>>    7. The old IndexReader is closed and /indexes/a is deleted
>>>>
>>>> I'm simplifying a few steps, but I think this is familiar to many
>>>>         
>> people,
>>     
>>>> and it's my impression that Solr implements something similar.
>>>>
>>>> The point is, the updated index lives in a new directory in this scheme,
>>>> and so we don't actually reopen the existing IndexReader; we open a new
>>>>         
>> one
>>     
>>>> with a different FSDirectory.
>>>>
>>>> Before Lucene 2.9, I don't think this made any difference, as (I think)
>>>>         
>> the
>>     
>>>> only advantage to calling reopen vs. just creating another IndexReader
>>>>         
>> was
>>     
>>>> having reopen figure out whether the index had actually changed.  (And
>>>>         
>> whave
>>     
>>>> a different way to figure that out, so it was a non-issue.)
>>>>
>>>> With Lucene 2.9, there's now a big difference, namely the per-segment
>>>> caching mentioned above.  So the question is how to make use of reopen
>>>>         
>> with
>>     
>>>> our distribution scheme.  Is there an informal best practice for
>>>>         
>> handling
>>     
>>>> this case?  For example, should step #5 above rename /indexes/b to
>>>> /indexes/a so the index can be reopened in the same physical location?
>>>>         
>>  Or
>>     
>>>> should rsync operate on the existing directory in-place, updating the
>>>> segments* files last and relying on the fact that deleted files will not
>>>> really be deleted (on Linux, at least) as long as the app is still
>>>>         
>> holding
>>     
>>>> them open?
>>>>
>>>> I guess the answer may depend on how exactly reopen knows which files
>>>>         
>> are
>>     
>>>> the "same" (e.g. does it look at filenames, or file descriptors, etc.).
>>>>
>>>> Thanks,
>>>> Chris
>>>>
>>>>         
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42660-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 20:49:02 2009
Return-Path: <java-user-return-42660-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 38503 invoked from network); 7 Oct 2009 20:49:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 20:49:02 -0000
Received: (qmail 27419 invoked by uid 500); 7 Oct 2009 20:49:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27337 invoked by uid 500); 7 Oct 2009 20:49:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27327 invoked by uid 99); 7 Oct 2009 20:49:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:49:00 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:48:49 +0000
Received: by yxe3 with SMTP id 3so191554yxe.20
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 13:48:28 -0700 (PDT)
MIME-Version: 1.0
Sender: felipe@goshme.com
Received: by 10.150.254.19 with SMTP id b19mr879064ybi.6.1254948507897; Wed, 
	07 Oct 2009 13:48:27 -0700 (PDT)
Date: Wed, 7 Oct 2009 17:48:27 -0300
X-Google-Sender-Auth: 736cc01ce3fad172
Message-ID: <c4e715d70910071348h5ed1417emb134c6d0fac71e30@mail.gmail.com>
Subject: Reducing memory use!
From: Felipe Lobo <felipe@jusbrasil.com.br>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd245bc064ee704755e78af
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd245bc064ee704755e78af
Content-Type: text/plain; charset=ISO-8859-1

Hi,
i read in some places that reusing the Document e Field instances reduces
the memory use when indexing, is that true??
but looked into Field class, it can only set the name, value and the other
params on the constructor, they dont have a set method.
if reuse them really reduces memory use, how do i do that?

Thanks,

-- 
Felipe Lobo
www.jusbrasil.com.br

--000e0cd245bc064ee704755e78af--

From java-user-return-42661-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 20:50:57 2009
Return-Path: <java-user-return-42661-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39673 invoked from network); 7 Oct 2009 20:50:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 20:50:57 -0000
Received: (qmail 33586 invoked by uid 500); 7 Oct 2009 20:50:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33504 invoked by uid 500); 7 Oct 2009 20:50:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33494 invoked by uid 99); 7 Oct 2009 20:50:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:50:55 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 20:50:45 +0000
Received: by qyk26 with SMTP id 26so4658033qyk.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 13:50:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=lE4deaAFM2HluiBI/fMe1ljNhVH4clq3hoWq+6AmlL4=;
        b=xSFo2pVna3oQOtdYYp9F5ecIcdv5r206whb4W5kvNDBYg7qFy2qhGGAVrguZZNMuIN
         Zs8qMyQ523S0+SyZesIuNmZV29gyJEtpnmeL8aDfTK9H97zhmgxbFNDjZpyfNTrt0iLu
         MN6FNBZnzz3fg0C81O/8fr+BecNqx3F9Qq/kI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=RhQsXnDb13qVpPta4F5rdzFwSZpB9KCEHyOUXxm32LSgQaZVVYwinG/1dsOsjeOCmb
         wTE9a1qcAcA7PIVwC8Hv8/mHI2NRQ7H+odr1n+Fa9BjS94XX9ouQNe1hHUTUpVzv1PCp
         jo879bmqBF5fBejuzWW5etVch/LqgReuZ/GH8=
MIME-Version: 1.0
Received: by 10.224.93.77 with SMTP id u13mr457198qam.226.1254948625069; Wed, 
	07 Oct 2009 13:50:25 -0700 (PDT)
Date: Wed, 7 Oct 2009 13:50:25 -0700
Message-ID: <85d3c3b60910071350o1b684b6ch64dd8a1b022bdce4@mail.gmail.com>
Subject: Index splitter
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

We have a way to merges indexes together with IW.addIndexes,
however not the opposite, split up an index with multiple
segments. I think I can simply manufacture a new segmentinfos in
a new directory, copy over the segments files from those
segments, delete the copied segments from the source, and save
the old segmentinfos less the copied segments. It seems like a
useful tool? The use case is I've reached a limit on EC2 and the
index has slowed to a crawl, so rather than reindex 80GB in two
different places, this approach would be more efficient.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42662-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 21:04:30 2009
Return-Path: <java-user-return-42662-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44158 invoked from network); 7 Oct 2009 21:04:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 21:04:30 -0000
Received: (qmail 53494 invoked by uid 500); 7 Oct 2009 21:04:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53456 invoked by uid 500); 7 Oct 2009 21:04:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53442 invoked by uid 99); 7 Oct 2009 21:04:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 21:04:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 21:04:17 +0000
Received: by ywh15 with SMTP id 15so5020347ywh.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 14:03:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=/tec/acyO9ILfXqiU7JFHg2Wi1cGEucz4rQIxqG9VT8=;
        b=sq1nd3Z7TZwgzAUQ81/sQBUBO49hTn4inbJT0jgznvxKyJ8O1Tn9P6iV6j93Q5WFAU
         PBcBblWrtk/h6ezzBShNCCGeNDd6b4VfLaDPfEMx/pmkf+Hv+4/I9jT3iUd7RC3LbX7c
         zAgON/FWubgZAi6XTQDZ2QKlgNU03qMUKw7zc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=HhUPEcJV/NS/OVOgwQ6t11tl5C7rxQcsQ9F+OI02m7zHsyz3RZlpuH2Fs+39VrM647
         lGLZez3X/pZAGi0l0W43pJtpCjSmXrezuVyr4/AlJssdwEXWqzFfnRRj0hZmeP+HFFLC
         a6NjNnGALlAMTufoXBysRiD74L9X0C9u+zGqk=
MIME-Version: 1.0
Received: by 10.90.217.11 with SMTP id p11mr244663agg.82.1254949436559; Wed, 
	07 Oct 2009 14:03:56 -0700 (PDT)
In-Reply-To: <85d3c3b60910071350o1b684b6ch64dd8a1b022bdce4@mail.gmail.com>
References: <85d3c3b60910071350o1b684b6ch64dd8a1b022bdce4@mail.gmail.com>
Date: Wed, 7 Oct 2009 14:03:56 -0700
Message-ID: <4b124c310910071403i3d873a45o334791db727fe78d@mail.gmail.com>
Subject: Re: Index splitter
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368324b26090a504755eaf9a
X-Virus-Checked: Checked by ClamAV on apache.org

--0016368324b26090a504755eaf9a
Content-Type: text/plain; charset=ISO-8859-1

As long as you don't have to split up a fully optimized index, or
one with the wrong number of segments for the division you
want to do, that would be useful.  Of course, sometimes you
need to split up the big segments into smaller ones too, but
the only way I've done that in the past is basically:

   1. make two copies of the index
   2. delete the first half of the documents from one copy,
   3. delete the second half of the documents on the other,
   4. purge deleted docs from both,
   5. addIndexesNoOptimize() to add them both to a new index.

Having a generic IndexSplitter which took an index of any number
of segments and redistributed them into either any number of
different sized segments, and optionally, completely different
indexes, now that would indeed be a useful tool.

  -jake

On Wed, Oct 7, 2009 at 1:50 PM, Jason Rutherglen <jason.rutherglen@gmail.com
> wrote:

> We have a way to merges indexes together with IW.addIndexes,
> however not the opposite, split up an index with multiple
> segments. I think I can simply manufacture a new segmentinfos in
> a new directory, copy over the segments files from those
> segments, delete the copied segments from the source, and save
> the old segmentinfos less the copied segments. It seems like a
> useful tool? The use case is I've reached a limit on EC2 and the
> index has slowed to a crawl, so rather than reindex 80GB in two
> different places, this approach would be more efficient.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016368324b26090a504755eaf9a--

From java-user-return-42663-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 21:31:34 2009
Return-Path: <java-user-return-42663-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55155 invoked from network); 7 Oct 2009 21:31:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 21:31:34 -0000
Received: (qmail 95006 invoked by uid 500); 7 Oct 2009 21:31:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94937 invoked by uid 500); 7 Oct 2009 21:31:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94918 invoked by uid 99); 7 Oct 2009 21:31:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 21:31:29 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 21:31:19 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1Mve66-0001IP-9L
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 14:30:58 -0700
Message-ID: <25794821.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 14:30:58 -0700 (PDT)
From: Maarten_D <maarten.dirkse@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Best strategy for reindexing large amount of data
In-Reply-To: <4b124c310910071300j316e8087p13b64b70bde2fb85@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: maarten.dirkse@gmail.com
References: <25791659.post@talk.nabble.com> <85d3c3b60910071135o1802f859mc597d1c96c63d815@mail.gmail.com> <4b124c310910071300j316e8087p13b64b70bde2fb85@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org


Hi Jake,
Thanks for your answer. I hadn't realised that doing the updates in reverse
chronological order actually plays well with the IO cache and the way Lucene
writes its indices to disk. Good to hear.

One question though, if you don't mind: you say that updating can work as
long as I don't reopen my index all too often. Problem is, since we're
constantly updating the index with new info, we're also reopening it very
frequently to make the new info appear in query results. Would that
disqualify the update method? And what do you mean by "not very frequently".
Is every 5 min too much?

Thanks again,
Maarten


Jake Mannix wrote:
> 
> I think a Hadoop cluster is maybe a bit overkill for this kind of
> thing - it's pretty common to have to do "grandfathering" of an
> index when you have new features, and just doing it in place
> with IndexWriter.update() can work just fine as long as you
> are not very frequently reopening your index.
> 
> The fact that you want to update in reverse chronological order
> means good things in terms of your index: I'm assuming you
> don't have a fully optimized index, in which case the newer
> documents are going to live in the smallest segments, so
> updating those documents in reverse order will add a lot
> of deletes to those segments, and then write new segments
> to disk with those updated docs in it.  As merges happen, the
> newer deletes will get resolved as the younger segments
> merge together, gradually working your way up to the
> biggest segments - the whole time pretty much only deleting
> from one segment at a time.
> 
> This should play pretty nicely with your system's IO cache,
> so as long as  you're not hammering your CPU with
> excessive indexing rate (and it looks like you're throttled
> on some outside-of-lucene process anyways, so you're not
> indexing as fast as you could: so just make sure you're not
> being too bursty about it [unless the burstiness is during
> off-hours at night]).
> 
> But play with it!  Try doing in place in your test / performance
> cluster, and see what your query latency is like while running
> at a couple of different update rates, in comparison to baseline.
> You'll probably find that that even pretty fast indexing doesn't
> degrade performance if a) you're not already close to being
> at CPU saturation, and b) you're not reopening your disk index
> too terribly frequently.
> 
>   -jake
> 
> On Wed, Oct 7, 2009 at 11:35 AM, Jason Rutherglen <
> jason.rutherglen@gmail.com> wrote:
> 
>> Maarten,
>>
>> Depending on the hardware available you can use a Hadoop cluster
>> to reindex more quickly. With Amazon EC2 one can spin up several
>> nodes, reindex, then tear them down when they're no longer
>> needed. Also you can simply update in place the existing
>> documents in the index, though you'd need to be careful not to
>> overload the server with indexing calls such that queries would
>> not be responsive. Number 3 (batches) could be used to create an
>> index on the side (like a Solr master), record deletes into a
>> file, then merge the newly created index in, apply deletes, then
>> commit to see the changes.
>>
>> There's advantages and disadvantages to each strategy.
>>
>> -J
>>
>> On Wed, Oct 7, 2009 at 11:15 AM, Maarten_D <maarten.dirkse@gmail.com>
>> wrote:
>> >
>> > Hi,
>> > I've searched the mailinglists and documentation for a clear answer to
>> the
>> > following question, but haven't found one, so here goes:
>> >
>> > We use Lucene to index and search a constant stream of messages: our
>> index
>> > is always growing. In the past, if we added new features to the
>> software
>> > that required the index to be rebuilt (adopting an accent-insensitive
>> > analyzer for instance, or adding a field to every lucene Document), we
>> would
>> > build an entirely new index out of all the messages we had stored, and
>> then
>> > swap out the old one with the new one. Recently, we've had a couple of
>> > clients whose message stores are so large that our strategy is no
>> longer
>> > viable: building a new index from scratch takes, for various reasons
>> not
>> > related to lucene, upwards of 48 hours, and that period will only
>> increase
>> > when client message stores grow bigger and bigger.
>> >
>> > What I would like is to update the index piecemeal, starting with the
>> most
>> > recently added document (ie the most recent messages, since clients
>> usually
>> > care about those the most). Then, most of the users will see the new
>> > functionality in their searches fairly quickly, and the older stuff,
>> which
>> > doesn't matter so much, will get reindexed at a later date. However,
>> I'm
>> > unclear as to what would be the best/most performant way to accomplish
>> this.
>> >
>> > There are a few strategies I've thought of, and I was wondering if
>> anyone
>> > could help me out as to which would be the best idea (or if there are
>> other,
>> > better methods that I haven't thought of). I should also say that every
>> > message in the system has a unique identifier (guid) that can be used
>> to
>> see
>> > whether two different lucene documents represent the same message.
>> >
>> > 1. Simply iterate over all message in the message store, convert them
>> to
>> > lucene documents, and call IndexWriter.update() for each one (using the
>> > guid).
>> >
>> > 2. Iterate over all messages in small steps (say 1000 at a time), and
>> the
>> > for each batch delete the existing documents from the index, and then
>> do
>> > Indexwriter.insert() for all messages (this is essentially step 1,
>> split
>> up
>> > into small parts and with the delete and insert part batched).
>> >
>> > 3. Iterate over all messages in small steps, and for each batch create
>> a
>> > separate index (lets say a RAM index), delete all the old documents
>> from
>> the
>> > main index, and merge the seperate index into the main one.
>> >
>> > 4. Same as 3, except merge first, and then remove the old duplicates.
>> >
>> > Any help on this issue would be much appreciated.
>> >
>> > Thanks in advance,
>> > Maarten
>> > --
>> > View this message in context:
>> http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25791659.html
>> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>> >
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 
> 

-- 
View this message in context: http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25794821.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42664-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 21:40:30 2009
Return-Path: <java-user-return-42664-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58039 invoked from network); 7 Oct 2009 21:40:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 21:40:30 -0000
Received: (qmail 15730 invoked by uid 500); 7 Oct 2009 21:40:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 15660 invoked by uid 500); 7 Oct 2009 21:40:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 15648 invoked by uid 99); 7 Oct 2009 21:40:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 21:40:28 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 21:40:17 +0000
Received: by yxe3 with SMTP id 3so230514yxe.20
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 14:39:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=XTey3mFBjJlQwIJR4gcX93ZZQ6MR5PMjOeU4GhrwjCs=;
        b=GL/YOqFUM2VsAeBdL0HWJTPbO4/bgH0cxPzES/X0v+6w3nHJwlUTmNssj2N1/4Gaqw
         NF9WPTKNyci+P3YLF3+wQD7UQlPNOOP9qe1HQpMtmoOHIDwRG8vi0/usowQSDSeZfFGv
         TfdqjQwipRqwMHrc09FP4Z/RF8rCE4JgD9YQ0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=coB3sCa8oyJZ50bPvjFIR4AmCrHrZygLkH6fj4o7LtBmwjl8/slrDB8jOaZg529Nq2
         62JWujqB3O4/hGPKsV1rOHDy/6tvzqtoS+H0FFQWkgEl0X76NV0fnN7X6nZS6678uVzm
         7TmhGOpeFkb/BQC6nF1/DOvGbapKvNXUqFKn4=
MIME-Version: 1.0
Received: by 10.91.154.4 with SMTP id g4mr266812ago.60.1254951595825; Wed, 07 
	Oct 2009 14:39:55 -0700 (PDT)
In-Reply-To: <25794821.post@talk.nabble.com>
References: <25791659.post@talk.nabble.com>
	 <85d3c3b60910071135o1802f859mc597d1c96c63d815@mail.gmail.com>
	 <4b124c310910071300j316e8087p13b64b70bde2fb85@mail.gmail.com>
	 <25794821.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 14:39:55 -0700
Message-ID: <4b124c310910071439n57478554v6c5e020fc7ce0acb@mail.gmail.com>
Subject: Re: Best strategy for reindexing large amount of data
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6460854145bba04755f30b5
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6460854145bba04755f30b5
Content-Type: text/plain; charset=ISO-8859-1

Hi Maarten,

  Five minutes is not tremendously frequently, and I imagine should be
pretty
fine, but again: it depends on how big your index is, how fast your
grandfathering
events are trickling in, how fast your new events are coming in, and how
heavy
your query load is.

  All of those factors can play a role, but in general you can
accomodate them by tweaking the one of those factors you have control over:
the grandfathering rate.  If performance is bad: lower the rate!

  And if you do need to open your indexes more frequently, if you're using
IndexReader.reopen(), it should help, as it'll only reload the newer
segments
(including what's recently been deleted).

  Does that make sense?

  -jake

On Wed, Oct 7, 2009 at 2:30 PM, Maarten_D <maarten.dirkse@gmail.com> wrote:

>
> Hi Jake,
> Thanks for your answer. I hadn't realised that doing the updates in reverse
> chronological order actually plays well with the IO cache and the way
> Lucene
> writes its indices to disk. Good to hear.
>
> One question though, if you don't mind: you say that updating can work as
> long as I don't reopen my index all too often. Problem is, since we're
> constantly updating the index with new info, we're also reopening it very
> frequently to make the new info appear in query results. Would that
> disqualify the update method? And what do you mean by "not very
> frequently".
> Is every 5 min too much?
>
> Thanks again,
> Maarten
>
>
> Jake Mannix wrote:
> >
> > I think a Hadoop cluster is maybe a bit overkill for this kind of
> > thing - it's pretty common to have to do "grandfathering" of an
> > index when you have new features, and just doing it in place
> > with IndexWriter.update() can work just fine as long as you
> > are not very frequently reopening your index.
> >
> > The fact that you want to update in reverse chronological order
> > means good things in terms of your index: I'm assuming you
> > don't have a fully optimized index, in which case the newer
> > documents are going to live in the smallest segments, so
> > updating those documents in reverse order will add a lot
> > of deletes to those segments, and then write new segments
> > to disk with those updated docs in it.  As merges happen, the
> > newer deletes will get resolved as the younger segments
> > merge together, gradually working your way up to the
> > biggest segments - the whole time pretty much only deleting
> > from one segment at a time.
> >
> > This should play pretty nicely with your system's IO cache,
> > so as long as  you're not hammering your CPU with
> > excessive indexing rate (and it looks like you're throttled
> > on some outside-of-lucene process anyways, so you're not
> > indexing as fast as you could: so just make sure you're not
> > being too bursty about it [unless the burstiness is during
> > off-hours at night]).
> >
> > But play with it!  Try doing in place in your test / performance
> > cluster, and see what your query latency is like while running
> > at a couple of different update rates, in comparison to baseline.
> > You'll probably find that that even pretty fast indexing doesn't
> > degrade performance if a) you're not already close to being
> > at CPU saturation, and b) you're not reopening your disk index
> > too terribly frequently.
> >
> >   -jake
> >
> > On Wed, Oct 7, 2009 at 11:35 AM, Jason Rutherglen <
> > jason.rutherglen@gmail.com> wrote:
> >
> >> Maarten,
> >>
> >> Depending on the hardware available you can use a Hadoop cluster
> >> to reindex more quickly. With Amazon EC2 one can spin up several
> >> nodes, reindex, then tear them down when they're no longer
> >> needed. Also you can simply update in place the existing
> >> documents in the index, though you'd need to be careful not to
> >> overload the server with indexing calls such that queries would
> >> not be responsive. Number 3 (batches) could be used to create an
> >> index on the side (like a Solr master), record deletes into a
> >> file, then merge the newly created index in, apply deletes, then
> >> commit to see the changes.
> >>
> >> There's advantages and disadvantages to each strategy.
> >>
> >> -J
> >>
> >> On Wed, Oct 7, 2009 at 11:15 AM, Maarten_D <maarten.dirkse@gmail.com>
> >> wrote:
> >> >
> >> > Hi,
> >> > I've searched the mailinglists and documentation for a clear answer to
> >> the
> >> > following question, but haven't found one, so here goes:
> >> >
> >> > We use Lucene to index and search a constant stream of messages: our
> >> index
> >> > is always growing. In the past, if we added new features to the
> >> software
> >> > that required the index to be rebuilt (adopting an accent-insensitive
> >> > analyzer for instance, or adding a field to every lucene Document), we
> >> would
> >> > build an entirely new index out of all the messages we had stored, and
> >> then
> >> > swap out the old one with the new one. Recently, we've had a couple of
> >> > clients whose message stores are so large that our strategy is no
> >> longer
> >> > viable: building a new index from scratch takes, for various reasons
> >> not
> >> > related to lucene, upwards of 48 hours, and that period will only
> >> increase
> >> > when client message stores grow bigger and bigger.
> >> >
> >> > What I would like is to update the index piecemeal, starting with the
> >> most
> >> > recently added document (ie the most recent messages, since clients
> >> usually
> >> > care about those the most). Then, most of the users will see the new
> >> > functionality in their searches fairly quickly, and the older stuff,
> >> which
> >> > doesn't matter so much, will get reindexed at a later date. However,
> >> I'm
> >> > unclear as to what would be the best/most performant way to accomplish
> >> this.
> >> >
> >> > There are a few strategies I've thought of, and I was wondering if
> >> anyone
> >> > could help me out as to which would be the best idea (or if there are
> >> other,
> >> > better methods that I haven't thought of). I should also say that
> every
> >> > message in the system has a unique identifier (guid) that can be used
> >> to
> >> see
> >> > whether two different lucene documents represent the same message.
> >> >
> >> > 1. Simply iterate over all message in the message store, convert them
> >> to
> >> > lucene documents, and call IndexWriter.update() for each one (using
> the
> >> > guid).
> >> >
> >> > 2. Iterate over all messages in small steps (say 1000 at a time), and
> >> the
> >> > for each batch delete the existing documents from the index, and then
> >> do
> >> > Indexwriter.insert() for all messages (this is essentially step 1,
> >> split
> >> up
> >> > into small parts and with the delete and insert part batched).
> >> >
> >> > 3. Iterate over all messages in small steps, and for each batch create
> >> a
> >> > separate index (lets say a RAM index), delete all the old documents
> >> from
> >> the
> >> > main index, and merge the seperate index into the main one.
> >> >
> >> > 4. Same as 3, except merge first, and then remove the old duplicates.
> >> >
> >> > Any help on this issue would be much appreciated.
> >> >
> >> > Thanks in advance,
> >> > Maarten
> >> > --
> >> > View this message in context:
> >>
> http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25791659.html
> >> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> >> >
> >> >
> >> > ---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
> >
>
> --
> View this message in context:
> http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25794821.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e6460854145bba04755f30b5--

From java-user-return-42665-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 07 23:43:16 2009
Return-Path: <java-user-return-42665-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88195 invoked from network); 7 Oct 2009 23:43:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 7 Oct 2009 23:43:16 -0000
Received: (qmail 12651 invoked by uid 500); 7 Oct 2009 23:43:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12568 invoked by uid 500); 7 Oct 2009 23:43:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12557 invoked by uid 99); 7 Oct 2009 23:43:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 23:43:14 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 07 Oct 2009 23:43:04 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1Mvg9b-0008GT-H5
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 16:42:43 -0700
Message-ID: <25796342.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 16:42:43 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Help needed figuring out reason for maxClauseCount is set to 1024
 error
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

I've two sets of search indexes. TestIndex (used in our test environment)
and ProdIndex(used in PRODUCTION environment). Lucene search query:
+date:[20090410184806 TO 20091007184806] works fine for test index but gives
this error message for Prod index.

"maxClauseCount is set to 1024"

If I execute following line just before executing search query, then I do
not get this error. BooleanQuery.SetMaxClauseCount(Int16.MaxValue);
searcher.Search(myQuery, collector);

Am I missing something here?Why am not getting this error in test index?The
schema for two indexes are same.They only differ wrt to number of
records/data.PROD index has got higher number of records(around 1300) than
those in test one (around 950).

Thanks for reading.

-- 
View this message in context: http://www.nabble.com/Help-needed-figuring-out-reason-for-maxClauseCount-is-set-to-1024-error-tp25796342p25796342.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42666-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 00:32:49 2009
Return-Path: <java-user-return-42666-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4506 invoked from network); 8 Oct 2009 00:32:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 00:32:49 -0000
Received: (qmail 55292 invoked by uid 500); 8 Oct 2009 00:32:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55222 invoked by uid 500); 8 Oct 2009 00:32:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55212 invoked by uid 99); 8 Oct 2009 00:32:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 00:32:47 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of adrianocrestani@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 00:32:37 +0000
Received: by qyk26 with SMTP id 26so4809643qyk.5
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 17:32:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=7Je9OnwHNcebPEqRvWhGVyVBJFEhkCoQkCjkW/varKw=;
        b=O4NtALnDCFonPTyb+3nFxfdtHUCtVcOq3CON1yP3sEPt/4VPTJCHiHYkagerCH5S9O
         zyja8MoI+13CCBBmqGq9TeT4IR+T1jfRXvOZix5FiRZJc10mOHjS/bwP1QerpqHdf0I9
         IIFRmEcsGIwPTNRFZJuObLHuaOLkqzJuLdRks=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=P+1WmoRbCWBa/WoX44ZU6K0gfr4Tjau2ILrrtZHrhrYzKdOnWHmZy9Rk5WmBgcHMjg
         CCKL7P+OjTdDtmQ32R4n3TbQqsKPrqvUE/YLCTXsIQkiyNyayvdD+P+EJnB5XZnf9rvY
         hdQerhVq812laOFwC9nn5ffMY2bQVANLp6p04=
MIME-Version: 1.0
Received: by 10.229.59.215 with SMTP id m23mr469179qch.4.1254961489101; Wed, 
	07 Oct 2009 17:24:49 -0700 (PDT)
In-Reply-To: <25796342.post@talk.nabble.com>
References: <25796342.post@talk.nabble.com>
From: Adriano Crestani <adrianocrestani@gmail.com>
Date: Wed, 7 Oct 2009 20:24:29 -0400
Message-ID: <55e2bf7e0910071724h6d4707d0s2798568f65620ed5@mail.gmail.com>
Subject: Re: Help needed figuring out reason for maxClauseCount is set to 1024 
	error
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=002354790ac0c3c5da0475617ddd
X-Virus-Checked: Checked by ClamAV on apache.org

--002354790ac0c3c5da0475617ddd
Content-Type: text/plain; charset=ISO-8859-1

Hi,

Can you provide to us the exception stack trace?

Thanks,
Adriano Crestani

On Wed, Oct 7, 2009 at 7:42 PM, mitu2009 <musicfreaque@gmail.com> wrote:

>
> Hi,
>
> I've two sets of search indexes. TestIndex (used in our test environment)
> and ProdIndex(used in PRODUCTION environment). Lucene search query:
> +date:[20090410184806 TO 20091007184806] works fine for test index but
> gives
> this error message for Prod index.
>
> "maxClauseCount is set to 1024"
>
> If I execute following line just before executing search query, then I do
> not get this error. BooleanQuery.SetMaxClauseCount(Int16.MaxValue);
> searcher.Search(myQuery, collector);
>
> Am I missing something here?Why am not getting this error in test index?The
> schema for two indexes are same.They only differ wrt to number of
> records/data.PROD index has got higher number of records(around 1300) than
> those in test one (around 950).
>
> Thanks for reading.
>
> --
> View this message in context:
> http://www.nabble.com/Help-needed-figuring-out-reason-for-maxClauseCount-is-set-to-1024-error-tp25796342p25796342.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--002354790ac0c3c5da0475617ddd--

From java-user-return-42667-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 00:35:23 2009
Return-Path: <java-user-return-42667-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4977 invoked from network); 8 Oct 2009 00:35:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 00:35:22 -0000
Received: (qmail 57699 invoked by uid 500); 8 Oct 2009 00:35:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57617 invoked by uid 500); 8 Oct 2009 00:35:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57607 invoked by uid 99); 8 Oct 2009 00:35:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 00:35:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 00:35:11 +0000
Received: by gxk26 with SMTP id 26so6547423gxk.11
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 17:34:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=vfyhkK+InHf72pi3ZbW/xiksY1HJ+SxBYsh3/zGJKkE=;
        b=MmIhuXZmHt+dt1kL7bTnp9DURoChpsENs5pc0+MmcUk/gPiPt5Xxx6isGuICqOAMQo
         eTLVLRQUClXO3gM0idh4i4KJ5+6QFiUKCBQS9j/Bm6dZTKVY65C8WlaGLb/qqqO4GH8N
         9EZtxG0/hUp08QxOGi5uJ2imoVQMQhUgm+m9Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=mtI5+t18BsmNqJp8n9b0yB1nR2m4hARqOuOgcadKm3C2+tuH8eHA2oAabogS9/QlIb
         bmpc6T8gXBV/JalWzDzJs9OPlXXCn+3D2fkeUil5yMAg+vSZ1GEV19ZFfjcfmEBMWmcy
         Y1qfKtKgvevPe1vM1WVEmXOmoLUeH4UviQnxk=
MIME-Version: 1.0
Received: by 10.90.127.20 with SMTP id z20mr331796agc.118.1254962090166; Wed, 
	07 Oct 2009 17:34:50 -0700 (PDT)
In-Reply-To: <25796342.post@talk.nabble.com>
References: <25796342.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 17:34:50 -0700
Message-ID: <4b124c310910071734s2989091k5551e86918ccfa5a@mail.gmail.com>
Subject: Re: Help needed figuring out reason for maxClauseCount is set to 1024 
	error
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e89ec974bf2047561a1e0
X-Virus-Checked: Checked by ClamAV on apache.org

--0016361e89ec974bf2047561a1e0
Content-Type: text/plain; charset=ISO-8859-1

On Wed, Oct 7, 2009 at 4:42 PM, mitu2009 <musicfreaque@gmail.com> wrote:

>
> Hi,
>
> I've two sets of search indexes. TestIndex (used in our test environment)
> and ProdIndex(used in PRODUCTION environment). Lucene search query:
> +date:[20090410184806 TO 20091007184806] works fine for test index but
> gives
> this error message for Prod index.
>

Oooh, this date range is going to kill your performance.  You need to use
less
precision unless you really *need* accuracy down to the second.


>
> "maxClauseCount is set to 1024"
>
> If I execute following line just before executing search query, then I do
> not get this error. BooleanQuery.SetMaxClauseCount(Int16.MaxValue);
> searcher.Search(myQuery, collector);
>
> Am I missing something here?Why am not getting this error in test index?The
> schema for two indexes are same.They only differ wrt to number of
> records/data.PROD index has got higher number of records(around 1300) than
> those in test one (around 950).
>

The reason why it is different in PROD is that your production index has
more than
a 1024 different values for your date field, while in test, your index is
small enough
so that there are less than 1024 values, so when lucene turns the range
query into
a BooleanQuery, it blows up in prod, but not in test, due to the number of
terms
it must be rewritten into.

Make sense?

  -jake

--0016361e89ec974bf2047561a1e0--

From java-user-return-42668-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 02:27:45 2009
Return-Path: <java-user-return-42668-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52784 invoked from network); 8 Oct 2009 02:27:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 02:27:45 -0000
Received: (qmail 19491 invoked by uid 500); 8 Oct 2009 02:27:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19420 invoked by uid 500); 8 Oct 2009 02:27:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19410 invoked by uid 99); 8 Oct 2009 02:27:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 02:27:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 02:27:33 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 07 Oct 2009 19:27:06 -0700
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01CA47BE.CD855471"
Subject: 2.9: TopScoreDocCollector
Date: Wed, 7 Oct 2009 19:26:55 -0700
Message-ID: <DEC11051901DCC43BD47EC508118AD860891BADD@exchg04.corp.business.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: 2.9: TopScoreDocCollector
Thread-Index: AcpHvs2mN5ZOBiiBSrOshnVa+IytUw==
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

------_=_NextPart_001_01CA47BE.CD855471
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

According to the documentation for 2.9,
TopScoreDocCollector.create(numHits, boolean), the second parameter is
whether documents are scored in order by the input - How do I choose?
In other words, how would I know if the documents are scored in order or
not?

=20

Eric


------_=_NextPart_001_01CA47BE.CD855471--

From java-user-return-42669-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 04:44:51 2009
Return-Path: <java-user-return-42669-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74701 invoked from network); 8 Oct 2009 04:44:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 04:44:51 -0000
Received: (qmail 73790 invoked by uid 500); 8 Oct 2009 04:44:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73716 invoked by uid 500); 8 Oct 2009 04:44:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73706 invoked by uid 99); 8 Oct 2009 04:44:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 04:44:49 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 04:44:39 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvkrS-0006Tb-7U
	for java-user@lucene.apache.org; Wed, 07 Oct 2009 21:44:18 -0700
Message-ID: <25798292.post@talk.nabble.com>
Date: Wed, 7 Oct 2009 21:44:18 -0700 (PDT)
From: sadronmeldir <sadronmeldir@gmail.com>
To: java-user@lucene.apache.org
Subject: Search By Phrase Not Working
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: sadronmeldir@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hello all,

I'm having some difficult getting queries on phrases to work properly, and I
can't figure out why. For example, a search for ("Heart of Fire") yields no
results when it should be returning two. 

Below is a snippet of my code. I'm probably overlooking something trivial,
but any help would be appreciated!



==============START CODE SNIPET==============
String indexDir = "tmp";
StandardAnalyzer aWrapper = new StandardAnalyzer(Version.LUCENE_CURRENT);
IndexWriter writer = new IndexWriter(SimpleFSDirectory.open(new
File(indexDir)), aWrapper, true, IndexWriter.MaxFieldLength.UNLIMITED);

.
.
.

Document doc = new Document();
doc.add(new Field("year", Integer.toString(line.getYear()), Field.Store.YES,
Field.Index.ANALYZED));
doc.add(new Field("month", Integer.toString(line.getMonth()),
Field.Store.YES, Field.Index.ANALYZED));
doc.add(new Field("day", Integer.toString(line.getDay()), Field.Store.YES,
Field.Index.ANALYZED));
doc.add(new Field("hour", Integer.toString(line.getHour()), Field.Store.YES,
Field.Index.ANALYZED));
doc.add(new Field("minute", Integer.toString(line.getMinute()),
Field.Store.YES, Field.Index.NOT_ANALYZED));
doc.add(new Field("second", Integer.toString(line.getSecond()),
Field.Store.YES, Field.Index.NOT_ANALYZED));
doc.add(new Field("userID", line.getUserID(), Field.Store.YES,
Field.Index.ANALYZED));
doc.add(new Field("channelID", line.getChannelID(), Field.Store.YES,
Field.Index.ANALYZED));
doc.add(new Field("text", line.getText(), Field.Store.YES,
Field.Index.ANALYZED, Field.TermVector.WITH_POSITIONS_OFFSETS));
doc.add(new Field("detail", line.getDetail(), Field.Store.YES,
Field.Index.NOT_ANALYZED));

writer.addDocument(doc);

.
.
.

writer.optimize();
writer.close();

IndexReader ir = IndexReader.open(SimpleFSDirectory.open(new
File(indexDir)), true);
IndexSearcher is = new IndexSearcher(ir);
Analyzer analyzera = new StandardAnalyzer(Version.LUCENE_CURRENT);

QueryParser parser = new QueryParser("text", analyzera);
PhraseQuery query = (PhraseQuery) parser.parse("\"Rain of Fire\"");

System.out.println("Query: " + query.toString());

TopFieldCollector collector = TopFieldCollector.create(sort, 100000, false,
false, false, false);
is.search(query, collector);
===============END CODE SNIPET===============
-- 
View this message in context: http://www.nabble.com/Search-By-Phrase-Not-Working-tp25798292p25798292.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42670-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 05:15:59 2009
Return-Path: <java-user-return-42670-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80549 invoked from network); 8 Oct 2009 05:15:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 05:15:59 -0000
Received: (qmail 89995 invoked by uid 500); 8 Oct 2009 05:15:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89916 invoked by uid 500); 8 Oct 2009 05:15:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89905 invoked by uid 99); 8 Oct 2009 05:15:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:15:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:15:47 +0000
Received: by gxk26 with SMTP id 26so6699770gxk.11
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 22:15:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=X8y89xfwVI2NxUOXu583ulTr4Yqr+Zb5NSIwRPC4ytw=;
        b=rpsVQSTp2ffpNkLHuwpT9xZ3lUvAaon32MpLLYdin9off5V1KH1LMqon9fBTQjq5pW
         VPVv4fI13hzTkF66D2Kq+oo4A2yGfOcO+LGKWeOJX7RYN9dZytUZ3yyYaPi6cFAD4+Jq
         avvBSYSbYreaD7qOfV4pv63csuYnf7ED4Y2dU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=wmShfBbuKHLdQgaxtlueMT+fRWEsBUoDBvCntfIsj/inVMS/OIT9XsJbyAZvxOkerW
         nlsUWqhEXSVQXUup9IEBr5dKcFesY6wmi/ydQT+rrt2DJq+SP6vowf7wlt3dzyRn/Rsk
         /A31VQl1yuduVVTsAAYjXffFgawtdtW8QR18g=
MIME-Version: 1.0
Received: by 10.90.198.4 with SMTP id v4mr485561agf.79.1254978925947; Wed, 07 
	Oct 2009 22:15:25 -0700 (PDT)
In-Reply-To: <DEC11051901DCC43BD47EC508118AD860891BADD@exchg04.corp.business.com>
References: <DEC11051901DCC43BD47EC508118AD860891BADD@exchg04.corp.business.com>
Date: Wed, 7 Oct 2009 22:15:25 -0700
Message-ID: <4b124c310910072215me8ac921mf69a244b968d4841@mail.gmail.com>
Subject: Re: 2.9: TopScoreDocCollector
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636283d9e14eb050475658d9f
X-Virus-Checked: Checked by ClamAV on apache.org

--001636283d9e14eb050475658d9f
Content-Type: text/plain; charset=ISO-8859-1

Hi Eric,

  Different Query classes have different options on whether they can score
docs out of order, or if they always proceed in order, so the way to make
sure
you're choosing the right value, if you don't know which you need, is to ask
your Query (or more appropriately, it's Weight):

   Query query = myBuildQueryMethod();
   IndexSearcher searcher = myBuildSearcherMethod();
   Weight weight = query.weight(searcher);
   boolean allowOutOfOrder = weight.scoresDocsOutOfOrder();

   TopScoreDocCollector coll = TopScoreDocCollector.create(numHits,
allowOutOfOrder);
   searcher.search(weight, (Filter) null, coll);


  -jake

On Wed, Oct 7, 2009 at 7:26 PM, Angel, Eric <eangel@business.com> wrote:

> According to the documentation for 2.9,
> TopScoreDocCollector.create(numHits, boolean), the second parameter is
> whether documents are scored in order by the input - How do I choose?
> In other words, how would I know if the documents are scored in order or
> not?
>
>
>
> Eric
>
>

--001636283d9e14eb050475658d9f--

From java-user-return-42671-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 05:18:16 2009
Return-Path: <java-user-return-42671-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80814 invoked from network); 8 Oct 2009 05:18:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 05:18:16 -0000
Received: (qmail 91911 invoked by uid 500); 8 Oct 2009 05:18:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91835 invoked by uid 500); 8 Oct 2009 05:18:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91825 invoked by uid 99); 8 Oct 2009 05:18:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:18:14 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:18:03 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 97917D36004
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 07:17:42 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id b9LeK70WCFfi for <java-user@lucene.apache.org>;
	Thu,  8 Oct 2009 07:17:32 +0200 (CEST)
Received: from VEGA (unknown [85.101.98.57])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 8FD77D36003
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 07:17:32 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <25796342.post@talk.nabble.com> <4b124c310910071734s2989091k5551e86918ccfa5a@mail.gmail.com>
Subject: RE: Help needed figuring out reason for maxClauseCount is set to 1024 error
Date: Thu, 8 Oct 2009 07:17:31 +0200
Message-ID: <9E0A294862364D6086F72A68E0FB55BF@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4b124c310910071734s2989091k5551e86918ccfa5a@mail.gmail.com>
Thread-Index: AcpHr0ER55p4opR7TDSqSMvljbGligAJzx+Q
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

I would propose to use NumericRangeQuery and NumericField supplied by Lucene
2.9. This has no such limitations. You can index your dates as numeric value
(e.g. Date.getTime()) and query downto the milliseconds.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Thursday, October 08, 2009 2:35 AM
> To: java-user@lucene.apache.org
> Subject: Re: Help needed figuring out reason for maxClauseCount is set to
> 1024 error
> 
> On Wed, Oct 7, 2009 at 4:42 PM, mitu2009 <musicfreaque@gmail.com> wrote:
> 
> >
> > Hi,
> >
> > I've two sets of search indexes. TestIndex (used in our test
> environment)
> > and ProdIndex(used in PRODUCTION environment). Lucene search query:
> > +date:[20090410184806 TO 20091007184806] works fine for test index but
> > gives
> > this error message for Prod index.
> >
> 
> Oooh, this date range is going to kill your performance.  You need to use
> less
> precision unless you really *need* accuracy down to the second.
> 
> 
> >
> > "maxClauseCount is set to 1024"
> >
> > If I execute following line just before executing search query, then I
> do
> > not get this error. BooleanQuery.SetMaxClauseCount(Int16.MaxValue);
> > searcher.Search(myQuery, collector);
> >
> > Am I missing something here?Why am not getting this error in test
> index?The
> > schema for two indexes are same.They only differ wrt to number of
> > records/data.PROD index has got higher number of records(around 1300)
> than
> > those in test one (around 950).
> >
> 
> The reason why it is different in PROD is that your production index has
> more than
> a 1024 different values for your date field, while in test, your index is
> small enough
> so that there are less than 1024 values, so when lucene turns the range
> query into
> a BooleanQuery, it blows up in prod, but not in test, due to the number of
> terms
> it must be rewritten into.
> 
> Make sense?
> 
>   -jake


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42672-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 05:20:30 2009
Return-Path: <java-user-return-42672-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81151 invoked from network); 8 Oct 2009 05:20:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 05:20:29 -0000
Received: (qmail 93829 invoked by uid 500); 8 Oct 2009 05:20:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93753 invoked by uid 500); 8 Oct 2009 05:20:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93743 invoked by uid 99); 8 Oct 2009 05:20:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:20:27 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:20:16 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 436D9D36004
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 07:19:56 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id AFlSTZWxs2dq for <java-user@lucene.apache.org>;
	Thu,  8 Oct 2009 07:19:46 +0200 (CEST)
Received: from VEGA (unknown [85.101.98.57])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 2816BD36003
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 07:19:46 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <DEC11051901DCC43BD47EC508118AD860891BADD@exchg04.corp.business.com> <4b124c310910072215me8ac921mf69a244b968d4841@mail.gmail.com>
Subject: RE: 2.9: TopScoreDocCollector
Date: Thu, 8 Oct 2009 07:19:46 +0200
Message-ID: <D1FF0D2325BF4E4F88F7D6CA543A5344@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4b124c310910072215me8ac921mf69a244b968d4841@mail.gmail.com>
Thread-Index: AcpH1nQbg2Ac+igSRfebSiTiHSB6vQAAEblA
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

The simpliest is (and also recommended): Do not create such collectors for
yourself. Just use the Query methods returning TopDocs.

The developers of these classes strongly discourage direct use, as a lot of
automatism is ignored then.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Thursday, October 08, 2009 7:15 AM
> To: java-user@lucene.apache.org
> Subject: Re: 2.9: TopScoreDocCollector
> 
> Hi Eric,
> 
>   Different Query classes have different options on whether they can score
> docs out of order, or if they always proceed in order, so the way to make
> sure
> you're choosing the right value, if you don't know which you need, is to
> ask
> your Query (or more appropriately, it's Weight):
> 
>    Query query = myBuildQueryMethod();
>    IndexSearcher searcher = myBuildSearcherMethod();
>    Weight weight = query.weight(searcher);
>    boolean allowOutOfOrder = weight.scoresDocsOutOfOrder();
> 
>    TopScoreDocCollector coll = TopScoreDocCollector.create(numHits,
> allowOutOfOrder);
>    searcher.search(weight, (Filter) null, coll);
> 
> 
>   -jake
> 
> On Wed, Oct 7, 2009 at 7:26 PM, Angel, Eric <eangel@business.com> wrote:
> 
> > According to the documentation for 2.9,
> > TopScoreDocCollector.create(numHits, boolean), the second parameter is
> > whether documents are scored in order by the input - How do I choose?
> > In other words, how would I know if the documents are scored in order or
> > not?
> >
> >
> >
> > Eric
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42673-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 05:24:30 2009
Return-Path: <java-user-return-42673-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82071 invoked from network); 8 Oct 2009 05:24:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 05:24:29 -0000
Received: (qmail 98975 invoked by uid 500); 8 Oct 2009 05:24:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98894 invoked by uid 500); 8 Oct 2009 05:24:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98884 invoked by uid 99); 8 Oct 2009 05:24:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:24:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 05:24:16 +0000
Received: by gxk26 with SMTP id 26so6703037gxk.11
        for <java-user@lucene.apache.org>; Wed, 07 Oct 2009 22:23:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=4TDXToY983Qx5icParOMI61+6BAWD4IUnF3oW3tddeE=;
        b=KLeE5UFMlVGEpEk7z2mu4QQsGay2XGngZvrqOStQlb5m1J0f/xxcnbLdZGwYIylQKu
         7zK7yqxqsdPvEd9J5/UgVk2VAUpRyqA1ZusFzgP1K5f8Zm6uEhe1Bv8awTtNQnyze5V9
         WiJuKmLS29TakFxydJwUuvxim+Ob9E1eqIw/A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=GwycZCwHb3AdNvNG4A4sFLX9HothXQ1Eb9W+vlyhhDpU/SOO8j9Dx0MA59IATDdFVV
         UYnOy8CFhFy/bbE846uolsubpa0rS763nh3szlBrHA/T0RTQ5fX8xffxp3XT6qZQMTPO
         d38BL3KDOzV8YHkQ08BhHpA/xRtuhZIZuZZUU=
MIME-Version: 1.0
Received: by 10.90.5.40 with SMTP id 40mr517099age.9.1254979435332; Wed, 07 
	Oct 2009 22:23:55 -0700 (PDT)
In-Reply-To: <9E0A294862364D6086F72A68E0FB55BF@VEGA>
References: <25796342.post@talk.nabble.com>
	 <4b124c310910071734s2989091k5551e86918ccfa5a@mail.gmail.com>
	 <9E0A294862364D6086F72A68E0FB55BF@VEGA>
Date: Wed, 7 Oct 2009 22:23:55 -0700
Message-ID: <4b124c310910072223u19705e84nced00167023f6488@mail.gmail.com>
Subject: Re: Help needed figuring out reason for maxClauseCount is set to 1024 
	error
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e7e7e7183ad047565ab0c
X-Virus-Checked: Checked by ClamAV on apache.org

--0016361e7e7e7183ad047565ab0c
Content-Type: text/plain; charset=ISO-8859-1

When such precision is needed, this is a great idea.  When it's far more
than
overkill (like when only days are necessary), is there anything to gain by
doing this?

  -jake


On Wed, Oct 7, 2009 at 10:17 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> I would propose to use NumericRangeQuery and NumericField supplied by
> Lucene
> 2.9. This has no such limitations. You can index your dates as numeric
> value
> (e.g. Date.getTime()) and query downto the milliseconds.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
> > -----Original Message-----
> > From: Jake Mannix [mailto:jake.mannix@gmail.com]
> > Sent: Thursday, October 08, 2009 2:35 AM
> > To: java-user@lucene.apache.org
> > Subject: Re: Help needed figuring out reason for maxClauseCount is set to
> > 1024 error
> >
> > On Wed, Oct 7, 2009 at 4:42 PM, mitu2009 <musicfreaque@gmail.com> wrote:
> >
> > >
> > > Hi,
> > >
> > > I've two sets of search indexes. TestIndex (used in our test
> > environment)
> > > and ProdIndex(used in PRODUCTION environment). Lucene search query:
> > > +date:[20090410184806 TO 20091007184806] works fine for test index but
> > > gives
> > > this error message for Prod index.
> > >
> >
> > Oooh, this date range is going to kill your performance.  You need to use
> > less
> > precision unless you really *need* accuracy down to the second.
> >
> >
> > >
> > > "maxClauseCount is set to 1024"
> > >
> > > If I execute following line just before executing search query, then I
> > do
> > > not get this error. BooleanQuery.SetMaxClauseCount(Int16.MaxValue);
> > > searcher.Search(myQuery, collector);
> > >
> > > Am I missing something here?Why am not getting this error in test
> > index?The
> > > schema for two indexes are same.They only differ wrt to number of
> > > records/data.PROD index has got higher number of records(around 1300)
> > than
> > > those in test one (around 950).
> > >
> >
> > The reason why it is different in PROD is that your production index has
> > more than
> > a 1024 different values for your date field, while in test, your index is
> > small enough
> > so that there are less than 1024 values, so when lucene turns the range
> > query into
> > a BooleanQuery, it blows up in prod, but not in test, due to the number
> of
> > terms
> > it must be rewritten into.
> >
> > Make sense?
> >
> >   -jake
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016361e7e7e7183ad047565ab0c--

From java-user-return-42674-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 06:04:05 2009
Return-Path: <java-user-return-42674-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91875 invoked from network); 8 Oct 2009 06:04:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 06:04:05 -0000
Received: (qmail 30851 invoked by uid 500); 8 Oct 2009 06:04:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30777 invoked by uid 500); 8 Oct 2009 06:04:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30767 invoked by uid 99); 8 Oct 2009 06:04:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 06:04:03 +0000
X-ASF-Spam-Status: No, hits=4.0 required=10.0
	tests=RCVD_IN_SBL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 06:03:51 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id A1791D36005
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 08:03:31 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 4WWesv8qvEch for <java-user@lucene.apache.org>;
	Thu,  8 Oct 2009 08:03:21 +0200 (CEST)
Received: from VEGA (unknown [212.174.9.254])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 7A09AD36004
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 08:03:21 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <25796342.post@talk.nabble.com> <4b124c310910071734s2989091k5551e86918ccfa5a@mail.gmail.com> <9E0A294862364D6086F72A68E0FB55BF@VEGA> <4b124c310910072223u19705e84nced00167023f6488@mail.gmail.com>
Subject: RE: Help needed figuring out reason for maxClauseCount is set to 1024 error
Date: Thu, 8 Oct 2009 08:03:21 +0200
Message-ID: <3E4C9F23B6754324A595F177897EB679@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4b124c310910072223u19705e84nced00167023f6488@mail.gmail.com>
Thread-Index: AcpH16XgX9sXoeDcT1O1KorV/YPWkAABQG7g
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

The precision depends on how you convert you datetime to an integer value.
For NumericRangeQuery the precision doesn't really matter. Only index gets
bigger. If you want day resolution just divide Date.getTime() by e.g.
86400000L (which is milliseconds). You have to do the same conversation on
both indexing and searching, but this should be clear.

NumericRangeQuery is good for all fields, which cardinality is >100. But it
doesn't hurt for lower precisions.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Thursday, October 08, 2009 7:24 AM
> To: java-user@lucene.apache.org
> Subject: Re: Help needed figuring out reason for maxClauseCount is set to
> 1024 error
> 
> When such precision is needed, this is a great idea.  When it's far more
> than
> overkill (like when only days are necessary), is there anything to gain by
> doing this?
> 
>   -jake
> 
> 
> On Wed, Oct 7, 2009 at 10:17 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> 
> > I would propose to use NumericRangeQuery and NumericField supplied by
> > Lucene
> > 2.9. This has no such limitations. You can index your dates as numeric
> > value
> > (e.g. Date.getTime()) and query downto the milliseconds.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> >
> > > -----Original Message-----
> > > From: Jake Mannix [mailto:jake.mannix@gmail.com]
> > > Sent: Thursday, October 08, 2009 2:35 AM
> > > To: java-user@lucene.apache.org
> > > Subject: Re: Help needed figuring out reason for maxClauseCount is set
> to
> > > 1024 error
> > >
> > > On Wed, Oct 7, 2009 at 4:42 PM, mitu2009 <musicfreaque@gmail.com>
> wrote:
> > >
> > > >
> > > > Hi,
> > > >
> > > > I've two sets of search indexes. TestIndex (used in our test
> > > environment)
> > > > and ProdIndex(used in PRODUCTION environment). Lucene search query:
> > > > +date:[20090410184806 TO 20091007184806] works fine for test index
> but
> > > > gives
> > > > this error message for Prod index.
> > > >
> > >
> > > Oooh, this date range is going to kill your performance.  You need to
> use
> > > less
> > > precision unless you really *need* accuracy down to the second.
> > >
> > >
> > > >
> > > > "maxClauseCount is set to 1024"
> > > >
> > > > If I execute following line just before executing search query, then
> I
> > > do
> > > > not get this error. BooleanQuery.SetMaxClauseCount(Int16.MaxValue);
> > > > searcher.Search(myQuery, collector);
> > > >
> > > > Am I missing something here?Why am not getting this error in test
> > > index?The
> > > > schema for two indexes are same.They only differ wrt to number of
> > > > records/data.PROD index has got higher number of records(around
> 1300)
> > > than
> > > > those in test one (around 950).
> > > >
> > >
> > > The reason why it is different in PROD is that your production index
> has
> > > more than
> > > a 1024 different values for your date field, while in test, your index
> is
> > > small enough
> > > so that there are less than 1024 values, so when lucene turns the
> range
> > > query into
> > > a BooleanQuery, it blows up in prod, but not in test, due to the
> number
> > of
> > > terms
> > > it must be rewritten into.
> > >
> > > Make sense?
> > >
> > >   -jake
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42675-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 07:31:12 2009
Return-Path: <java-user-return-42675-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18704 invoked from network); 8 Oct 2009 07:31:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 07:31:11 -0000
Received: (qmail 21307 invoked by uid 500); 8 Oct 2009 07:31:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21205 invoked by uid 500); 8 Oct 2009 07:31:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21195 invoked by uid 99); 8 Oct 2009 07:31:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 07:31:09 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 07:30:59 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvnSP-0007xW-S2
	for java-user@lucene.apache.org; Thu, 08 Oct 2009 00:30:37 -0700
Message-ID: <25799577.post@talk.nabble.com>
Date: Thu, 8 Oct 2009 00:30:37 -0700 (PDT)
From: Maarten_D <maarten.dirkse@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Best strategy for reindexing large amount of data
In-Reply-To: <4b124c310910071439n57478554v6c5e020fc7ce0acb@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: maarten.dirkse@gmail.com
References: <25791659.post@talk.nabble.com> <85d3c3b60910071135o1802f859mc597d1c96c63d815@mail.gmail.com> <4b124c310910071300j316e8087p13b64b70bde2fb85@mail.gmail.com> <25794821.post@talk.nabble.com> <4b124c310910071439n57478554v6c5e020fc7ce0acb@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org


Yes it does. Thanks for the tips. I'm going to do some experimenting, and see
if I can post some results here.

Regards,
Maarten


Jake Mannix wrote:
> 
> Hi Maarten,
> 
>   Five minutes is not tremendously frequently, and I imagine should be
> pretty
> fine, but again: it depends on how big your index is, how fast your
> grandfathering
> events are trickling in, how fast your new events are coming in, and how
> heavy
> your query load is.
> 
>   All of those factors can play a role, but in general you can
> accomodate them by tweaking the one of those factors you have control
> over:
> the grandfathering rate.  If performance is bad: lower the rate!
> 
>   And if you do need to open your indexes more frequently, if you're using
> IndexReader.reopen(), it should help, as it'll only reload the newer
> segments
> (including what's recently been deleted).
> 
>   Does that make sense?
> 
>   -jake
> 
> On Wed, Oct 7, 2009 at 2:30 PM, Maarten_D <maarten.dirkse@gmail.com>
> wrote:
> 
>>
>> Hi Jake,
>> Thanks for your answer. I hadn't realised that doing the updates in
>> reverse
>> chronological order actually plays well with the IO cache and the way
>> Lucene
>> writes its indices to disk. Good to hear.
>>
>> One question though, if you don't mind: you say that updating can work as
>> long as I don't reopen my index all too often. Problem is, since we're
>> constantly updating the index with new info, we're also reopening it very
>> frequently to make the new info appear in query results. Would that
>> disqualify the update method? And what do you mean by "not very
>> frequently".
>> Is every 5 min too much?
>>
>> Thanks again,
>> Maarten
>>
>>
>> Jake Mannix wrote:
>> >
>> > I think a Hadoop cluster is maybe a bit overkill for this kind of
>> > thing - it's pretty common to have to do "grandfathering" of an
>> > index when you have new features, and just doing it in place
>> > with IndexWriter.update() can work just fine as long as you
>> > are not very frequently reopening your index.
>> >
>> > The fact that you want to update in reverse chronological order
>> > means good things in terms of your index: I'm assuming you
>> > don't have a fully optimized index, in which case the newer
>> > documents are going to live in the smallest segments, so
>> > updating those documents in reverse order will add a lot
>> > of deletes to those segments, and then write new segments
>> > to disk with those updated docs in it.  As merges happen, the
>> > newer deletes will get resolved as the younger segments
>> > merge together, gradually working your way up to the
>> > biggest segments - the whole time pretty much only deleting
>> > from one segment at a time.
>> >
>> > This should play pretty nicely with your system's IO cache,
>> > so as long as  you're not hammering your CPU with
>> > excessive indexing rate (and it looks like you're throttled
>> > on some outside-of-lucene process anyways, so you're not
>> > indexing as fast as you could: so just make sure you're not
>> > being too bursty about it [unless the burstiness is during
>> > off-hours at night]).
>> >
>> > But play with it!  Try doing in place in your test / performance
>> > cluster, and see what your query latency is like while running
>> > at a couple of different update rates, in comparison to baseline.
>> > You'll probably find that that even pretty fast indexing doesn't
>> > degrade performance if a) you're not already close to being
>> > at CPU saturation, and b) you're not reopening your disk index
>> > too terribly frequently.
>> >
>> >   -jake
>> >
>> > On Wed, Oct 7, 2009 at 11:35 AM, Jason Rutherglen <
>> > jason.rutherglen@gmail.com> wrote:
>> >
>> >> Maarten,
>> >>
>> >> Depending on the hardware available you can use a Hadoop cluster
>> >> to reindex more quickly. With Amazon EC2 one can spin up several
>> >> nodes, reindex, then tear them down when they're no longer
>> >> needed. Also you can simply update in place the existing
>> >> documents in the index, though you'd need to be careful not to
>> >> overload the server with indexing calls such that queries would
>> >> not be responsive. Number 3 (batches) could be used to create an
>> >> index on the side (like a Solr master), record deletes into a
>> >> file, then merge the newly created index in, apply deletes, then
>> >> commit to see the changes.
>> >>
>> >> There's advantages and disadvantages to each strategy.
>> >>
>> >> -J
>> >>
>> >> On Wed, Oct 7, 2009 at 11:15 AM, Maarten_D <maarten.dirkse@gmail.com>
>> >> wrote:
>> >> >
>> >> > Hi,
>> >> > I've searched the mailinglists and documentation for a clear answer
>> to
>> >> the
>> >> > following question, but haven't found one, so here goes:
>> >> >
>> >> > We use Lucene to index and search a constant stream of messages: our
>> >> index
>> >> > is always growing. In the past, if we added new features to the
>> >> software
>> >> > that required the index to be rebuilt (adopting an
>> accent-insensitive
>> >> > analyzer for instance, or adding a field to every lucene Document),
>> we
>> >> would
>> >> > build an entirely new index out of all the messages we had stored,
>> and
>> >> then
>> >> > swap out the old one with the new one. Recently, we've had a couple
>> of
>> >> > clients whose message stores are so large that our strategy is no
>> >> longer
>> >> > viable: building a new index from scratch takes, for various reasons
>> >> not
>> >> > related to lucene, upwards of 48 hours, and that period will only
>> >> increase
>> >> > when client message stores grow bigger and bigger.
>> >> >
>> >> > What I would like is to update the index piecemeal, starting with
>> the
>> >> most
>> >> > recently added document (ie the most recent messages, since clients
>> >> usually
>> >> > care about those the most). Then, most of the users will see the new
>> >> > functionality in their searches fairly quickly, and the older stuff,
>> >> which
>> >> > doesn't matter so much, will get reindexed at a later date. However,
>> >> I'm
>> >> > unclear as to what would be the best/most performant way to
>> accomplish
>> >> this.
>> >> >
>> >> > There are a few strategies I've thought of, and I was wondering if
>> >> anyone
>> >> > could help me out as to which would be the best idea (or if there
>> are
>> >> other,
>> >> > better methods that I haven't thought of). I should also say that
>> every
>> >> > message in the system has a unique identifier (guid) that can be
>> used
>> >> to
>> >> see
>> >> > whether two different lucene documents represent the same message.
>> >> >
>> >> > 1. Simply iterate over all message in the message store, convert
>> them
>> >> to
>> >> > lucene documents, and call IndexWriter.update() for each one (using
>> the
>> >> > guid).
>> >> >
>> >> > 2. Iterate over all messages in small steps (say 1000 at a time),
>> and
>> >> the
>> >> > for each batch delete the existing documents from the index, and
>> then
>> >> do
>> >> > Indexwriter.insert() for all messages (this is essentially step 1,
>> >> split
>> >> up
>> >> > into small parts and with the delete and insert part batched).
>> >> >
>> >> > 3. Iterate over all messages in small steps, and for each batch
>> create
>> >> a
>> >> > separate index (lets say a RAM index), delete all the old documents
>> >> from
>> >> the
>> >> > main index, and merge the seperate index into the main one.
>> >> >
>> >> > 4. Same as 3, except merge first, and then remove the old
>> duplicates.
>> >> >
>> >> > Any help on this issue would be much appreciated.
>> >> >
>> >> > Thanks in advance,
>> >> > Maarten
>> >> > --
>> >> > View this message in context:
>> >>
>> http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25791659.html
>> >> > Sent from the Lucene - Java Users mailing list archive at
>> Nabble.com.
>> >> >
>> >> >
>> >> >
>> ---------------------------------------------------------------------
>> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>> >
>>
>> --
>> View this message in context:
>> http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25794821.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 
> 

-- 
View this message in context: http://www.nabble.com/Best-strategy-for-reindexing-large-amount-of-data-tp25791659p25799577.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42676-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 08:02:04 2009
Return-Path: <java-user-return-42676-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28902 invoked from network); 8 Oct 2009 08:02:04 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 08:02:04 -0000
Received: (qmail 61812 invoked by uid 500); 8 Oct 2009 08:02:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61726 invoked by uid 500); 8 Oct 2009 08:02:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61716 invoked by uid 99); 8 Oct 2009 08:02:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 08:02:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bernd.fondermann@googlemail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 08:01:50 +0000
Received: by ewy26 with SMTP id 26so6162623ewy.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 01:01:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=wrJhKrWg7pvf+mmwB2DiQWTtc1uyF0Twcqhm2y1aIdM=;
        b=CCodp2kxUad7wRGpVcCv31lHQwKlDt66ZF95IuZV7OnoLScLmjvWPqAt+TlnnqhoXR
         PjGVzvDmIqD2MKXbJ07l4a43x6YJVDfUVUYIqhN3QoHyZxmV8hcKBXfk0zLRbb+Q+Doh
         vgvuy4yUO9LxWUSMgZqjV6FV+CxY0jng50OJo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n9t9nQVp9CzRzEh1mW2rWN6XZy7UIzXTwdWvxPFXAoejehPtxGgtsFSIN9odJUP4T9
         xd+JivK74kTRh7wGIWMHB29RAvUAguOkTGXoVs1vlDgBZItz0EL+46BV3cgpsfsUKpTX
         HZf5M8LqnSc7MnDPiBfUdoUXz9UDh0IBz2gk8=
MIME-Version: 1.0
Received: by 10.216.88.140 with SMTP id a12mr278594wef.157.1254988889876; Thu, 
	08 Oct 2009 01:01:29 -0700 (PDT)
In-Reply-To: <3836ec640910020810t236410a0j78ccc788975a0915@mail.gmail.com>
References: <3836ec640910020810t236410a0j78ccc788975a0915@mail.gmail.com>
Date: Thu, 8 Oct 2009 10:01:29 +0200
Message-ID: <88f6e29a0910080101m4d17c5al1e466e19badfd331@mail.gmail.com>
Subject: Re: FileNotFoundException on index
From: Bernd Fondermann <bernd.fondermann@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Max

just a guess: maybe you deleted all *.c source files in that area and
unintentionally deleted this index file, too.

  Bernd

On Fri, Oct 2, 2009 at 17:10, Max Lynch <ihasmax@gmail.com> wrote:
> I'm getting this error when I try to run my searcher and my indexer:
>
> Traceback (most recent call last):
> self.searcher = lucene.IndexSearcher(self.directory)
> JavaError: java.io.FileNotFoundException: /home/spider/misc/index/_275c.cfs
> (No such file or directory)
>
> I don't know anything about the format of the Lucene index, but I notice I
> have several _275* files from b to j but no c.
>
> Any ideas?
>
> Thanks.
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42677-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 08:11:51 2009
Return-Path: <java-user-return-42677-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31128 invoked from network); 8 Oct 2009 08:11:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 08:11:51 -0000
Received: (qmail 81253 invoked by uid 500); 8 Oct 2009 08:11:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81174 invoked by uid 500); 8 Oct 2009 08:11:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81164 invoked by uid 99); 8 Oct 2009 08:11:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 08:11:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mehdi.ben.hamida@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 08:11:39 +0000
Received: by yxe3 with SMTP id 3so548090yxe.20
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 01:11:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ekj8lkUFb4r4ruqObI+nQUMf4339zeCdR7SYYuAV42A=;
        b=ZXiI6QtH41Kq85zje9UmxPC9FcdVuPZDfJcXHhr/Ts4Ovv5ceHmmd2JqPYy3rB4gME
         coFhtNPaBEl48BQlofdbgvB5wx+XHFMv7wunVCfhroPJv+cAU4ZUIeUHZ3DMchNDcMB0
         QBzmh+pZaj+3SXIY7Drj3cnO7Rg3ZCNG6f5jg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=g/tWBOAojsDDt0EBHicVroHYrTU/pwreZfZuyPtNhXZreu7uDNF+thEUM7/rQhX7+V
         g+b8w0j3RQjnJ63o6YIZQ68uz6apuF5TFGIkTyJnxBiHKVmMdCtlHO63fUIgQOKQLQ70
         Sxzy+udvDChSz4O01asyXkRowHUxPde+WCRaA=
MIME-Version: 1.0
Received: by 10.91.3.40 with SMTP id f40mr590379agi.53.1254989478578; Thu, 08 
	Oct 2009 01:11:18 -0700 (PDT)
In-Reply-To: <5624efff0910072352w2fc62730mc2fcac52b93041e3@mail.gmail.com>
References: <5624efff0910072352w2fc62730mc2fcac52b93041e3@mail.gmail.com>
Date: Thu, 8 Oct 2009 10:11:18 +0200
Message-ID: <5624efff0910080111q5221f1c0i2c5be1fbe24a57a4@mail.gmail.com>
Subject: Review and questions about Lucene Java 2.9.0
From: Mehdi Ben Hamida <mehdi.ben.hamida@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b81a2114ab10475680269
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b81a2114ab10475680269
Content-Type: text/plain; charset=ISO-8859-1

Hello,



I'm reviewing and doing some researches on Lucene Java 2.9.0, to check if it
meets our needs.



Unfortunately I don't find answers to some of my questions, and I hope you
can answer them, and provide any references that prove your answer.



   - Do you confirm that Lucene enables load tests, and that there are no
   limitations, only hardware/server limitations?
   - Is "Fail-over", "load sharing / load balancing" taken into account?
   Does the API support it?
   - Is there any limitation in the number of users accessing the API within
   an application?
   - Is there any limitation in the number of transactions held by the API
   within an application?
   - I read that read only concurrent access is possible, but is there a
   limitation in the number of these accesses?
   - I read that security access is not supported by Lucene, is it true?
   All security aspects (data's, access, communication...) should be developed
   and held by the application and that the API does not provide any security
   classes.

Thanks a lot for your help.


 *Mehdi Ben Hamida*

--0016363b81a2114ab10475680269--

From java-user-return-42678-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 08:29:58 2009
Return-Path: <java-user-return-42678-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35993 invoked from network); 8 Oct 2009 08:29:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 08:29:58 -0000
Received: (qmail 4213 invoked by uid 500); 8 Oct 2009 08:29:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4165 invoked by uid 500); 8 Oct 2009 08:29:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4129 invoked by uid 99); 8 Oct 2009 08:29:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 08:29:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 08:29:45 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id 23A32310BE
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 10:29:22 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id D2B633164D
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 10:29:21 +0200 (CEST)
Received: from bledsoe.dfki.uni-sb.de (bledsoe.dfki.uni-sb.de [134.96.184.151])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id 832973109B
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 10:29:19 +0200 (CEST)
Message-Id: <4D218F5C-E77A-4164-BFFD-07A4D5A444B6@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <5624efff0910080111q5221f1c0i2c5be1fbe24a57a4@mail.gmail.com>
Content-Type: multipart/signed; boundary=Apple-Mail-3--342031180; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Review and questions about Lucene Java 2.9.0
Date: Thu, 8 Oct 2009 10:29:16 +0200
References: <5624efff0910072352w2fc62730mc2fcac52b93041e3@mail.gmail.com> <5624efff0910080111q5221f1c0i2c5be1fbe24a57a4@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-3--342031180
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable

Mehdi,

your requirements sound to be fulfilled mostly by Apache Solr which is =20=

a web-based packaging of Lucene.

paul.




Le 08-oct.-09 =E0 10:11, Mehdi Ben Hamida a =E9crit :

> Hello,
>
>
>
> I'm reviewing and doing some researches on Lucene Java 2.9.0, to =20
> check if it
> meets our needs.
>
>
>
> Unfortunately I don't find answers to some of my questions, and I =20
> hope you
> can answer them, and provide any references that prove your answer.
>
>
>
>   - Do you confirm that Lucene enables load tests, and that there =20
> are no
>   limitations, only hardware/server limitations?
>   - Is "Fail-over", "load sharing / load balancing" taken into =20
> account?
>   Does the API support it?
>   - Is there any limitation in the number of users accessing the API =20=

> within
>   an application?
>   - Is there any limitation in the number of transactions held by =20
> the API
>   within an application?
>   - I read that read only concurrent access is possible, but is =20
> there a
>   limitation in the number of these accesses?
>   - I read that security access is not supported by Lucene, is it =20
> true?
>   All security aspects (data's, access, communication...) should be =20=

> developed
>   and held by the application and that the API does not provide any =20=

> security
>   classes.
>
> Thanks a lot for your help.
>
>
> *Mehdi Ben Hamida*


--Apple-Mail-3--342031180
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAwODA4MjkxNlowIwYJKoZIhvcNAQkEMRYEFElhD5UJVlSp3wuK79jrP+eZPHPYMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQCn
uqItzW1VtlVYE0rCW1KkTFBm8mGND3vdSqp6foAKTURYHwNZNrAwqSn0p/yq7VdKEPmZDT7/TFcS
bHf7B41s2X00YbxUHoUAWCDDe8fzlbJOt4yYFSXReUCFKzXSJWGIRDqKJ7NFVNSj8v4OLj49FUW3
ZJuvOnVrlCSSQiibFWjAvvV3jpFwxmMAq9RX1MLB9+quAQiVr11zTWDiU0J9s4VfzAz17QnrAgBf
oWag8aPGdwD3t20ES9eJvjGV0BRP8i1jMjoQ8YZoT8DkZx3cUo7gSBvQOXQ81ShijF8SUpZbtSKH
Y9w/fENi8C8Opq4gEXEFw1nSrGkzZ0CDr8gGAAAAAAAA

--Apple-Mail-3--342031180--

From java-user-return-42679-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 09:27:48 2009
Return-Path: <java-user-return-42679-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47374 invoked from network); 8 Oct 2009 09:27:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 09:27:48 -0000
Received: (qmail 69011 invoked by uid 500); 8 Oct 2009 09:27:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68970 invoked by uid 500); 8 Oct 2009 09:27:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68960 invoked by uid 99); 8 Oct 2009 09:27:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 09:27:45 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.212.172 as permitted sender)
Received: from [209.85.212.172] (HELO mail-vw0-f172.google.com) (209.85.212.172)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 09:27:35 +0000
Received: by vws2 with SMTP id 2so3125990vws.20
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 02:27:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=UQV5z8yIjLTVB1ImXJUkZyvjMlxB8w9z7jMA6U8UEU0=;
        b=IQ01Rd8RpHvkJ05c22Zi2Z7rruly0ZEGNpzCEgr1fzH+9YsqJSteV2vuEeHhf9EWKh
         nu0eQmM7o+drRZLd5W+6yD1gQ7EuRDdsQm36yHGSuRcgLv4fdZICo2ZKSVJTsnNwPfHB
         bN1I1V3qwvvvrI/hcSPN8igmtxIfZgBjkjF/k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=HvB8WI8905vmxdVaQH1W33dQktDOfm2REX+V5WwXoaSkNN5auZvD5ylx9evJz2wkFT
         1RWpcuyPLQSYDoH9viJ8qtdbjTrVBYnzfJRxfdu+eBJK6CkN91vr9cggaeUTzDbt+JWp
         hvtJhp/5EHfpLfHYXOQN+Dh1SNZk9vISW0f4M=
MIME-Version: 1.0
Received: by 10.220.11.9 with SMTP id r9mr1604021vcr.58.1254994034166; Thu, 08 
	Oct 2009 02:27:14 -0700 (PDT)
In-Reply-To: <25798292.post@talk.nabble.com>
References: <25798292.post@talk.nabble.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 8 Oct 2009 10:26:54 +0100
Message-ID: <8c4e68610910080226r816fe54m2af337384fe3e78f@mail.gmail.com>
Subject: Re: Search By Phrase Not Working
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Could it be as simple as the fact that "Heart of Fire" != "Rain of
Fire"?  Have you checked, with Luke for example, that the phrases
really are in the index?

Can't spot anything obviously wrong with the code.  You could cut down
your example code to a minimal self contained program that
demonstrated the problem, showing docs added and search results, and
post that here.


--
Ian.


On Thu, Oct 8, 2009 at 5:44 AM, sadronmeldir <sadronmeldir@gmail.com> wrote:
>
> Hello all,
>
> I'm having some difficult getting queries on phrases to work properly, and I
> can't figure out why. For example, a search for ("Heart of Fire") yields no
> results when it should be returning two.
>
> Below is a snippet of my code. I'm probably overlooking something trivial,
> but any help would be appreciated!
>
>
>
> ==============START CODE SNIPET==============
> String indexDir = "tmp";
> StandardAnalyzer aWrapper = new StandardAnalyzer(Version.LUCENE_CURRENT);
> IndexWriter writer = new IndexWriter(SimpleFSDirectory.open(new
> File(indexDir)), aWrapper, true, IndexWriter.MaxFieldLength.UNLIMITED);
>
> .
> .
> .
>
> Document doc = new Document();
> doc.add(new Field("year", Integer.toString(line.getYear()), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("month", Integer.toString(line.getMonth()),
> Field.Store.YES, Field.Index.ANALYZED));
> doc.add(new Field("day", Integer.toString(line.getDay()), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("hour", Integer.toString(line.getHour()), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("minute", Integer.toString(line.getMinute()),
> Field.Store.YES, Field.Index.NOT_ANALYZED));
> doc.add(new Field("second", Integer.toString(line.getSecond()),
> Field.Store.YES, Field.Index.NOT_ANALYZED));
> doc.add(new Field("userID", line.getUserID(), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("channelID", line.getChannelID(), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("text", line.getText(), Field.Store.YES,
> Field.Index.ANALYZED, Field.TermVector.WITH_POSITIONS_OFFSETS));
> doc.add(new Field("detail", line.getDetail(), Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>
> writer.addDocument(doc);
>
> .
> .
> .
>
> writer.optimize();
> writer.close();
>
> IndexReader ir = IndexReader.open(SimpleFSDirectory.open(new
> File(indexDir)), true);
> IndexSearcher is = new IndexSearcher(ir);
> Analyzer analyzera = new StandardAnalyzer(Version.LUCENE_CURRENT);
>
> QueryParser parser = new QueryParser("text", analyzera);
> PhraseQuery query = (PhraseQuery) parser.parse("\"Rain of Fire\"");
>
> System.out.println("Query: " + query.toString());
>
> TopFieldCollector collector = TopFieldCollector.create(sort, 100000, false,
> false, false, false);
> is.search(query, collector);
> ===============END CODE SNIPET===============
> --
> View this message in context: http://www.nabble.com/Search-By-Phrase-Not-Working-tp25798292p25798292.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42680-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 10:12:32 2009
Return-Path: <java-user-return-42680-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59993 invoked from network); 8 Oct 2009 10:12:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 10:12:32 -0000
Received: (qmail 20645 invoked by uid 500); 8 Oct 2009 10:12:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20576 invoked by uid 500); 8 Oct 2009 10:12:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20565 invoked by uid 99); 8 Oct 2009 10:12:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 10:12:28 +0000
X-ASF-Spam-Status: No, hits=-2.8 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 131.246.120.220 is neither permitted nor denied by domain of christian.reuschling@gmail.com)
Received: from [131.246.120.220] (HELO mailgw1.uni-kl.de) (131.246.120.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 10:12:17 +0000
Received: from dfki.uni-kl.de (dfki-1002.dfki.uni-kl.de [131.246.195.2])
	by mailgw1.uni-kl.de (8.13.8/8.13.8/Debian-3) with ESMTP id n98ABvZ9021365
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 12:11:57 +0200
Received: from serv-4100.kl.dfki.de (serv-4100.kl.dfki.de [192.168.41.180])
	by dfki.uni-kl.de (8.13.8+Sun/8.11.4) with ESMTP id n98ABuEc019166
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 12:11:56 +0200 (CEST)
Received: from pc-4176.kl.dfki.de (pc-4176.kl.dfki.de [192.168.41.166])
	by serv-4100.kl.dfki.de (8.13.8+Sun/8.13.8) with ESMTP id n98ABuJR019260
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 12:11:56 +0200 (CEST)
Date: Thu, 8 Oct 2009 12:11:47 +0200
From: Christian Reuschling <christian.reuschling@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Search By Phrase Not Working
Message-ID: <20091008121147.107a8589@pc-4176.kl.dfki.de>
In-Reply-To: <25798292.post@talk.nabble.com>
References: <25798292.post@talk.nabble.com>
X-Mailer: Claws Mail 3.7.2 (GTK+ 2.14.4; i586-http://packman.links2linux.de-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; boundary="Sig_/LTgg6bnDGKC6llw9L7IK=OZ";
 protocol="application/pgp-signature"; micalg=PGP-SHA1
X-Virus-Checked: Checked by ClamAV on apache.org

--Sig_/LTgg6bnDGKC6llw9L7IK=OZ
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

Hi,

I had similar behaviour. On an self-build index on german wikipedia I searc=
hed
for the phrase "blaue blume". I've got 2 results. When I searched for +"bla=
ue
blume" "vogel" I've got 59 results...strange.
I found out that when I create a plain BooleanQuery with just the phrase "b=
laue
blume" gives different results, depending whether I specify 'SHOULD' or 'MU=
ST'
(i.e. 2 or 59 results)
Looking closer at this, I found out that Lucene takes different BooleanScor=
er
implementations (BooleanScorer/BooleanScorer2) depending on this criteria,
which implies the 'docsScoredInOrder'flag.
I started a search by specifying the collector directly:
TopScoreDocCollector collector =3D TopScoreDocCollector.create(1000, <false=
 OR
true>);

In the case docsScoredInOrder was true, I've got correct 59 results. In the
case it was false, I've got 2.

I looked into Luke now, and I found out in the search tab under 'collector'=
 the
checkbox "Allow out-of-order collecting, when supported". When I searched n=
ow
in Luke for 'blaue blume', I could reproduce this behaviour - depending on =
the
checkbox setting I recieved 2 or 59 results.

I manually created a small, new Index just by copying the 59 documents in t=
he
hope to get a testing scenario that I can post here in the mailing list, bu=
t the
new index worked correctly...I can't reproduce this behaviour.

Because of this I recognized that my wikipedia index was ~1-2 years old, and
the testing index was build with Lucene 2.9. At the end, I build a complete=
 new
index on wikipedia with 2.9, which finished this night. When I look into it
with Luke it seems everything works fine now :)


For me, it looks that there is some index version incompatibility regarding=
 the
new (at least for me) 'docsScoredInOrder' concept (currently I haven't a cl=
ear
idea what this is good for - but anyway). Maybe it is a bug, but in the cas=
e it
is not, some kind of according exception would be much better instead of si=
lent
odd behaviour.


Last but not least: I think Lucene 2.9 is a really fine release - thanks to=
 the
Lucene team!



Chris





On Wed, 7 Oct 2009 21:44:18 -0700 (PDT)
sadronmeldir <sadronmeldir@gmail.com> wrote:

>=20
> Hello all,
>=20
> I'm having some difficult getting queries on phrases to work properly, an=
d I
> can't figure out why. For example, a search for ("Heart of Fire") yields =
no
> results when it should be returning two.=20
>=20
> Below is a snippet of my code. I'm probably overlooking something trivial,
> but any help would be appreciated!
>=20
>=20
>=20
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3DSTART CODE SNIPET=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
> String indexDir =3D "tmp";
> StandardAnalyzer aWrapper =3D new StandardAnalyzer(Version.LUCENE_CURRENT=
);
> IndexWriter writer =3D new IndexWriter(SimpleFSDirectory.open(new
> File(indexDir)), aWrapper, true, IndexWriter.MaxFieldLength.UNLIMITED);
>=20
> .
> .
> .
>=20
> Document doc =3D new Document();
> doc.add(new Field("year", Integer.toString(line.getYear()), Field.Store.Y=
ES,
> Field.Index.ANALYZED));
> doc.add(new Field("month", Integer.toString(line.getMonth()),
> Field.Store.YES, Field.Index.ANALYZED));
> doc.add(new Field("day", Integer.toString(line.getDay()), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("hour", Integer.toString(line.getHour()), Field.Store.Y=
ES,
> Field.Index.ANALYZED));
> doc.add(new Field("minute", Integer.toString(line.getMinute()),
> Field.Store.YES, Field.Index.NOT_ANALYZED));
> doc.add(new Field("second", Integer.toString(line.getSecond()),
> Field.Store.YES, Field.Index.NOT_ANALYZED));
> doc.add(new Field("userID", line.getUserID(), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("channelID", line.getChannelID(), Field.Store.YES,
> Field.Index.ANALYZED));
> doc.add(new Field("text", line.getText(), Field.Store.YES,
> Field.Index.ANALYZED, Field.TermVector.WITH_POSITIONS_OFFSETS));
> doc.add(new Field("detail", line.getDetail(), Field.Store.YES,
> Field.Index.NOT_ANALYZED));
>=20
> writer.addDocument(doc);
>=20
> .
> .
> .
>=20
> writer.optimize();
> writer.close();
>=20
> IndexReader ir =3D IndexReader.open(SimpleFSDirectory.open(new
> File(indexDir)), true);
> IndexSearcher is =3D new IndexSearcher(ir);
> Analyzer analyzera =3D new StandardAnalyzer(Version.LUCENE_CURRENT);
>=20
> QueryParser parser =3D new QueryParser("text", analyzera);
> PhraseQuery query =3D (PhraseQuery) parser.parse("\"Rain of Fire\"");
>=20
> System.out.println("Query: " + query.toString());
>=20
> TopFieldCollector collector =3D TopFieldCollector.create(sort, 100000, fa=
lse,
> false, false, false);
> is.search(query, collector);
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3DEND CODE SNIPET=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D


--Sig_/LTgg6bnDGKC6llw9L7IK=OZ
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.9 (GNU/Linux)

iEYEARECAAYFAkrNuugACgkQ6EqMXq+WZg+KEQCffoeWMHpndNW4/EPnMmCXAYST
S8kAnRcSiacAzDE7VuCS7co4L+emfsQL
=PwSI
-----END PGP SIGNATURE-----

--Sig_/LTgg6bnDGKC6llw9L7IK=OZ--

From java-user-return-42681-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 12:59:45 2009
Return-Path: <java-user-return-42681-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11213 invoked from network); 8 Oct 2009 12:59:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 12:59:45 -0000
Received: (qmail 49194 invoked by uid 500); 8 Oct 2009 12:59:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49114 invoked by uid 500); 8 Oct 2009 12:59:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49104 invoked by uid 99); 8 Oct 2009 12:59:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 12:59:42 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of dawid.weiss@gmail.com designates 72.14.220.157 as permitted sender)
Received: from [72.14.220.157] (HELO fg-out-1718.google.com) (72.14.220.157)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 12:59:33 +0000
Received: by fg-out-1718.google.com with SMTP id 16so1759275fgg.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 05:59:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=lsFi1WlXzs1n7WZivEkby4J9EUlL6qkNPSyztVR0HXk=;
        b=Cv8Xu3yfcMST9HDulWnbCGVamyQx6lUBXkZWowHcqb/DgREZPsHnc2jm9JaqJKXOR4
         TRe3jQd4VI6hKzy2JgzGA/6CMi5wWwPIVOmzpWLfZ/Fp/etgID1QfwdYqGRW7DDRCwU8
         uv4pTYkHLI1/9NWRcP+qzZ7NWQa5+qUlzn3/k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=gWmwiDj9UlBpwyQNOt7SdKUMADjz6CpcJo2cot+qtdJSlnw9Gs95Hwakf8kvkjeGyM
         Lz0XwtsclXARdV2L83h2KfkyGONng7qFS8RWluIP5CLdQ1t+EM6wuRN990cbS2vmSR1N
         lKgkrfiglRVCr5cRBKADdtn2j8PRi2qOZDZw0=
MIME-Version: 1.0
Received: by 10.86.8.36 with SMTP id 36mr1099112fgh.7.1255006750523; Thu, 08 
	Oct 2009 05:59:10 -0700 (PDT)
In-Reply-To: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
Date: Thu, 8 Oct 2009 14:59:10 +0200
Message-ID: <baa8c5730910080559g20433609hc3ef5e0785cae872@mail.gmail.com>
Subject: Re: Reverse stemmer?
From: Dawid Weiss <dawid.weiss@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Stemmers are heuristic transformations aiming at reducing the
vocabulary's dimensionality (and for other purposes I don't want to
discuss here). For accurate transformations one would use a
lemmatization engine  (typically dictionary-driven) combined with
morphological analysis for ambiguity resolution. So, stemming should
be perceived as a "one-way" transformation from inflected forms to
some form of a unique identifier for a common lemma (a set of word
forms with identical meaning).

I don't know if you can call it a "reverse stemmer", but there are
tools for generating inflected forms of lemmas (let's call them "root
words") given the morphological tag or annotation. This is
particularly useful for languages with rich inflection paradigms (so
that you can construct grammatically correct sequences of words). One
example of such a project is Morfologik:

http://morfologik.blogspot.com/

Like Erick mentioned, though, this is probably far from what you
actually need...

Dawid

On Tue, Oct 6, 2009 at 9:31 AM, David Leangen <apache@leangen.net> wrote:
>
> Hello,
>
> I've been using Lucene in a very basic way for some time now, and I'm
> starting to take advantage of some of the linguistic capabilities only now.
>
> I am making use of the snowball analyzer for stemming, and it works very
> well.
>
>
> Question: is there any such thing as a "reverse stemmer"? In other words,
> given the stem of a word, is there any algorithm to find the original word?
> Or is this just fantasy? ;-)
>
> Now, I understand that there is a 1:n mapping of stems:words. I can deal
> with that.
>
>
> Thanks!
> =David
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42682-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 13:05:20 2009
Return-Path: <java-user-return-42682-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12627 invoked from network); 8 Oct 2009 13:05:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 13:05:20 -0000
Received: (qmail 53691 invoked by uid 500); 8 Oct 2009 13:05:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53607 invoked by uid 500); 8 Oct 2009 13:05:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53597 invoked by uid 99); 8 Oct 2009 13:05:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:05:18 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:05:06 +0000
Received: (qmail 16153 invoked by uid 508); 8 Oct 2009 13:10:09 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 8 Oct 2009 13:10:09 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1Mvsfm-0008SI-Er
	for java-user@lucene.apache.org; Thu, 08 Oct 2009 15:04:46 +0200
Date: Thu, 8 Oct 2009 15:04:46 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: Re: InstantiatedIndex questions
Message-ID: <20091008130446.GA30091@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
References: <20091006165406.GB25923@spotter-dclnx> <A3D280E5-3491-423F-8C88-CFB8535AEF5C@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <A3D280E5-3491-423F-8C88-CFB8535AEF5C@gmail.com>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Checked: Checked by ClamAV on apache.org

On Tue, Oct 06, 2009 at 07:51:44PM +0200, Karl Wettin wrote:
>
> 6 okt 2009 kl. 18.54 skrev David Causse:
>
> David, your timing couldn't be better. Just the other day I proposed  
> that we deprecate InstantiatedIndexWriter. The sum of the reasons to  
> this is that I'm a bit lazy. Your mail makes me reconsider.
>
> https://issues.apache.org/jira/browse/LUCENE-1948

Well, so you intended to make InstantiatedIndex impossible to use from
scratch. What is very nice with the current implementation is that it
conform to the "normal" lucene usage : index with IW and query with IR.
It make it very easy to adopt your implementation with legacy
applications.
If it is immutable it's like String, I have to deal with
StringBuffer/StringBuilder, that's nice in some ways but it has some
drawbacks, it's maybe why all efficient internal analysis API in lucene
permits the use of char[].

So in the lucene world with II, RAMDirectory will be my StringBuilder,
so I'll have to wrap InstantiatedIndex to use a RAMDirectory as a
buffer. Like this :

private IndexWriter buffer;
private readerIsValid = false;
private InstanciatedIndexReader reader;

public IIWrapper(Analyzer a) {
	buffer = new IndexWriter(new RAMDirectory(), a, MaxFieldLength.UNLIMITED);
}

public void /* writeLock */ addDocument(Document doc) {
	buffer.addDocument(doc);
	readerIsValid = false;
}

public IndexReader /* readLock */ getReader() {
	if(!readerIsValid) {
		/* writeLock */
		reader = new InstantiadedIndex(buffer.getReader()).indexReaderFactory();
		readerIsvalid = true;
	}
	return reader;
}

So I'll have best indexation time but the first query will suffer the
IIR creation. It is maybe better than use IIW. But IMHO (as a user point
of view) it's very convenient to have the choice of multiple store in
lucene, and it's pretty cool to use them in the same way. If you take a look
at MemoryIndex, description is very attractive but it's too far (again
IMHO) from the lucene API.

>
> > On the index time InstantiatedIndex is behind RAMDirectory, but the  
> > time
>
> Would you mind benchmarking some for me using your corpora? The issue  
> suggests that people use the InstantiatedIndex(IndexReader) constructor 
> to create the index rather than using InstantiatedIndexWriter. Is it way 
> slower for you to produce the index using RAMDirectory/IndexWriter and 
> pass an IndexReader to InstantiatedIndex?
>
>
> This is what the package level javadocs says about  
> InstantiatedIndexWriter:
>
> "Hardly any effort has been put in to optimizing the  
> InstantiatedIndexWriter, only minimizing the amount of time needed to  
> write-lock the index has been considered."
>
> I'm sure there are ways to speed it up, I just never managed to find the 
> time to look in to it. I never really used IIW.

We've processed huge number of documents and didn't see any problems.
But we don't use all the possibilities lucene stores have to offer.

>
>
> It might be worth mentioning that when InstantiatedIndex#commit returns 
> it has yeilded an optimized "single segment" index. This is not quite how 
> a Directory/IndexWriter acts.

When I have some times I'll try to bench our system without IIW.

>
> > gained over queries make it better (for what I see it can be 2 times
> > faster).
> >
> > InstantiatedIndex will be our default volatile mini index store for  
> > our
> > next production release.
>
> Very cool!!
>
> > Whe should have other needs of this index but the lack of addIndexes
> > support make it impossible for us to use it in other situations. So we
> > continue to use RAMDirectory in such situations.
>
> Have you considered using multiple InstantiatedIndex and a MultiReader? 
> That would pretty much be the same thing, just that the store wouldn't be 
> quite as optimized. It would definitly use more RAM than if it was the 
> same index. You could of course also pass this MultiReader to a new 
> InstantiatedIndex. I have no real clue about the difference in speed and 
> RAM consuption between these solutions so you should benchmark all 
> solutions.

Well, in fact with 2.9 there is awesome number of solutions for us.  We
might try the new getReader() on IW, we didn't use MultiReader but it
seems to be a very convenient solution also. I have to take time to think
about it.

Just a side note for other users who may think about using
InstantiadedIndex, we've seen that our process that use II can be as I
said 2 times faster. You have to consider that it is exactly if I said,
"Hey I switched from MySQL to PostgreSQL and my app is 2 times faster". 

>
> > Do you think we could reach RAMDirectory index time by tweaking some  
> > initialCap
> > stuff inside java.util.Collections you use?
>
>
> Maybe. But I think it would be a relatively small gain. But don't take  
> my words for granted, benchmark it.
>
> Using the InstantiatedIndex(IndexReader) constructor will create rather 
> optimal size of the collections.
>
> As for InstantiatedIndexWriter I think it's pretty much only the  
> transient collections in #commit that will help you, my guess is that  
> you should expemient with the dirtyTerms and termsByText attributes.  
> Count the number of terms in your complete index and see how much it  
> speeds thing up by creating the collections with this size from the  
> start.

Well I had a quick look to IIW and your collections size are already near our
average.

>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42683-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 13:33:22 2009
Return-Path: <java-user-return-42683-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20956 invoked from network); 8 Oct 2009 13:33:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 13:33:22 -0000
Received: (qmail 6178 invoked by uid 500); 8 Oct 2009 13:33:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6116 invoked by uid 500); 8 Oct 2009 13:33:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6106 invoked by uid 99); 8 Oct 2009 13:33:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:33:19 +0000
X-ASF-Spam-Status: No, hits=-2.8 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 131.246.120.220 is neither permitted nor denied by domain of christian.reuschling@gmail.com)
Received: from [131.246.120.220] (HELO mailgw1.uni-kl.de) (131.246.120.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:33:09 +0000
Received: from dfki.uni-kl.de (dfki-1002.dfki.uni-kl.de [131.246.195.2])
	by mailgw1.uni-kl.de (8.13.8/8.13.8/Debian-3) with ESMTP id n98DWmCb030418
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 15:32:48 +0200
Received: from serv-4100.kl.dfki.de (serv-4100.kl.dfki.de [192.168.41.180])
	by dfki.uni-kl.de (8.13.8+Sun/8.11.4) with ESMTP id n98DWmdS022855
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 15:32:48 +0200 (CEST)
Received: from pc-4176.kl.dfki.de (pc-4176.kl.dfki.de [192.168.41.166])
	by serv-4100.kl.dfki.de (8.13.8+Sun/8.13.8) with ESMTP id n98DWlv1016427
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 15:32:47 +0200 (CEST)
Date: Thu, 8 Oct 2009 15:32:41 +0200
From: Christian Reuschling <christian.reuschling@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Reverse stemmer?
Message-ID: <20091008153241.36f300a5@pc-4176.kl.dfki.de>
In-Reply-To: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
X-Mailer: Claws Mail 3.7.2 (GTK+ 2.14.4; i586-http://packman.links2linux.de-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; boundary="Sig_/mKVJD=5o5yQ9Mwran1IGhBv";
 protocol="application/pgp-signature"; micalg=PGP-SHA1
X-Virus-Checked: Checked by ClamAV on apache.org

--Sig_/mKVJD=5o5yQ9Mwran1IGhBv
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

Hi,

looking up the different terms with a common stem can be useful in different
scenarios - so I don't want to judge it whether someone needs it or not.

E.g., in the case you have multilingual documents in your index, it is stra=
ight
forward to determine the language of the documents in order to choose the r=
ight
stemmer. At least this is right for document with homogenous language.

Althought this is true at indexing time, the language classification for the
user query is not such trivial - and you have to do this in order to stem t=
he
query terms for searching. One possibility would be to search for the stems
given from all stemmers - but in this case you will receive many wrong
searching terms, thus much noise in the result lists.

Another possibility can be to offer all 'potential synonyms' of the query t=
erms
to the user - where he can choose whether these are right or not. In this c=
ase
you need exactly the lookup 'queryTerm->stem->terms with same stem'. This c=
an
be much more precise, the lacks are of course the interaction needed by the
user and longer queries.

To realize this, someone could write a specific Analyzer that stores this
relationship additionally e.g. into a database. I personaly don't know any
possibility to read this directly out of the Lucene index.


In the case someone has best practices or an idea how processing multilingu=
al
indices can be done better, I would be appreciated to read / hear about thi=
s.



all best

Chris


On Tue, 6 Oct 2009 16:31:36 +0900
David Leangen <apache@leangen.net> wrote:

>=20
> Hello,
>=20
> I've been using Lucene in a very basic way for some time now, and I'm =20
> starting to take advantage of some of the linguistic capabilities only =20
> now.
>=20
> I am making use of the snowball analyzer for stemming, and it works =20
> very well.
>=20
>=20
> Question: is there any such thing as a "reverse stemmer"? In other =20
> words, given the stem of a word, is there any algorithm to find the =20
> original word? Or is this just fantasy? ;-)
>=20
> Now, I understand that there is a 1:n mapping of stems:words. I can =20
> deal with that.
>=20
>=20
> Thanks!
> =3DDavid
>=20
>=20
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20


--Sig_/mKVJD=5o5yQ9Mwran1IGhBv
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.9 (GNU/Linux)

iEYEARECAAYFAkrN6f0ACgkQ6EqMXq+WZg8nfQCdF1ya6Y1RG2nuSXXMdeW5nsMJ
z8YAnjK6Ut2xuhUMV2RGj8HzSPZ9YWyM
=O/xq
-----END PGP SIGNATURE-----

--Sig_/mKVJD=5o5yQ9Mwran1IGhBv--

From java-user-return-42684-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 13:41:30 2009
Return-Path: <java-user-return-42684-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24172 invoked from network); 8 Oct 2009 13:41:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 13:41:29 -0000
Received: (qmail 19139 invoked by uid 500); 8 Oct 2009 13:41:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19096 invoked by uid 500); 8 Oct 2009 13:41:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19063 invoked by uid 99); 8 Oct 2009 13:41:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:41:25 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nseco@dei.uc.pt designates 193.137.203.253 as permitted sender)
Received: from [193.137.203.253] (HELO smtp2.dei.uc.pt) (193.137.203.253)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:41:14 +0000
Received: from aries.net (bl16-73-33.dsl.telepac.pt [188.81.73.33])
	(authenticated bits=0)
	by smtp2.dei.uc.pt (8.14.3/8.14.3) with ESMTP id n98DaE8x014573
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <java-user@lucene.apache.org>; Thu, 8 Oct 2009 14:36:25 +0100
Message-ID: <4ACDEAEA.6030400@dei.uc.pt>
Date: Thu, 08 Oct 2009 14:36:42 +0100
From: Nuno Seco <nseco@dei.uc.pt>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Reverse stemmer?
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net> <20091008153241.36f300a5@pc-4176.kl.dfki.de>
In-Reply-To: <20091008153241.36f300a5@pc-4176.kl.dfki.de>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-FCTUC-DEI-SIC-MailScanner-Information: Please contact helpdesk@dei.uc.pt for more information
X-FCTUC-DEI-SIC-MailScanner-ID: n98DaE8x014573
X-FCTUC-DEI-SIC-MailScanner: Not scanned: please contact helpdesk@dei.uc.pt for details
X-FCTUC-DEI-SIC-MailScanner-SpamCheck: not spam, SpamAssassin (not cached,
	score=-53.3, required 3.252, autolearn=not spam, ALL_TRUSTED -1.80,
	AWL -0.00, BAYES_00 -1.50, L_SMTP_AUTH -50.00)
X-FCTUC-DEI-SIC-MailScanner-From: nseco@dei.uc.pt
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No

Hi.

You may want to take a look at:
http://wordlist.sourceforge.net/


--
Nuno Seco

Christian Reuschling wrote:
> Hi,
>
> looking up the different terms with a common stem can be useful in different
> scenarios - so I don't want to judge it whether someone needs it or not.
>
> E.g., in the case you have multilingual documents in your index, it is straight
> forward to determine the language of the documents in order to choose the right
> stemmer. At least this is right for document with homogenous language.
>
> Althought this is true at indexing time, the language classification for the
> user query is not such trivial - and you have to do this in order to stem the
> query terms for searching. One possibility would be to search for the stems
> given from all stemmers - but in this case you will receive many wrong
> searching terms, thus much noise in the result lists.
>
> Another possibility can be to offer all 'potential synonyms' of the query terms
> to the user - where he can choose whether these are right or not. In this case
> you need exactly the lookup 'queryTerm->stem->terms with same stem'. This can
> be much more precise, the lacks are of course the interaction needed by the
> user and longer queries.
>
> To realize this, someone could write a specific Analyzer that stores this
> relationship additionally e.g. into a database. I personaly don't know any
> possibility to read this directly out of the Lucene index.
>
>
> In the case someone has best practices or an idea how processing multilingual
> indices can be done better, I would be appreciated to read / hear about this.
>
>
>
> all best
>
> Chris
>
>
> On Tue, 6 Oct 2009 16:31:36 +0900
> David Leangen <apache@leangen.net> wrote:
>
>   
>> Hello,
>>
>> I've been using Lucene in a very basic way for some time now, and I'm  
>> starting to take advantage of some of the linguistic capabilities only  
>> now.
>>
>> I am making use of the snowball analyzer for stemming, and it works  
>> very well.
>>
>>
>> Question: is there any such thing as a "reverse stemmer"? In other  
>> words, given the stem of a word, is there any algorithm to find the  
>> original word? Or is this just fantasy? ;-)
>>
>> Now, I understand that there is a 1:n mapping of stems:words. I can  
>> deal with that.
>>
>>
>> Thanks!
>> =David
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>     
>
>   

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42685-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 13:42:54 2009
Return-Path: <java-user-return-42685-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25327 invoked from network); 8 Oct 2009 13:42:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 13:42:54 -0000
Received: (qmail 22527 invoked by uid 500); 8 Oct 2009 13:42:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22466 invoked by uid 500); 8 Oct 2009 13:42:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22456 invoked by uid 99); 8 Oct 2009 13:42:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:42:51 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of enrico.detoma@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:42:42 +0000
Received: by fxm2 with SMTP id 2so5465786fxm.28
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 06:42:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=uc0cD3hhUv76d3/CxNCQQ8mixqGUJBdAs/UpAo6HSrE=;
        b=V9eLK09TfmhYUdyMEdujOsMP8FzpgM05KOlFxu190DWe5Yvj2WvteYbI17w4uG9gGz
         9O1izAzV55guk3kbCOO/6ZvoVulqr5O0zAarCX8sm+LYWyEF6HF76Ly8fFJ3hggAtm3S
         oTvasM5n4IJ8zki3BuTge7fMLnDCNTajZdbsY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=F7aTmnVn7En7rSg4ybn+vQQ59FXCcRwD4PUKQd1f9V/iLBu04f1rYx/yRJWdLuMkb4
         RmfHyc1PzILajKgfcdW4DAtz/lPf6zJHN+9Ev26onzvi6fFPbSYWKsA+8qIudGxwbFAi
         VGikukPPxiWzjKMzc0Yh55HH49O3U+5mSqckY=
MIME-Version: 1.0
Received: by 10.204.153.219 with SMTP id l27mr1016705bkw.141.1255009342061; 
	Thu, 08 Oct 2009 06:42:22 -0700 (PDT)
Date: Thu, 8 Oct 2009 15:42:22 +0200
Message-ID: <b18d3be30910080642x4501b26bm9ae1ae07c43aa0e1@mail.gmail.com>
Subject: Lucene 2.9.0 [PROBLEM] : TokenStream API (incrementToken / 
	captureState / restoreState), cannot implement a "stop phrases filter"
From: Enrico Detoma <enrico.detoma@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015175cf9f605fe8304756ca235
X-Virus-Checked: Checked by ClamAV on apache.org

--0015175cf9f605fe8304756ca235
Content-Type: text/plain; charset=ISO-8859-1

Hi all,

I'm trying to implement a "stop phrases filter" with the new TokenStream
API.

I would like to be able to peek into N tokens ahead, see if the current
token + N subsequent tokens match a "stop phrase" (the set of stop phrases
are saved in a HashSet), then discard all these tokens when they match a
stop phrase, or keep them all if they don't match.

For this purpose I would like to use captureState() and then restoreState()
to get back to the starting point of the stream.

I tried many combinations of these API. My last attempt is in the code
below, which doesn't work.



    static private HashSet<String> m_stop_phrases = new HashSet<String>();
    static private int m_max_stop_phrase_length = 0;
...
    public final boolean incrementToken() throws IOException {
        if (!input.incrementToken())
            return false;
        Stack<State> stateStack = new Stack<State>();
        StringBuilder match_string_builder = new StringBuilder();
        int skippedPositions = 0;
        boolean is_next_token = true;
        while (is_next_token && match_string_builder.length() <
m_max_stop_phrase_length) {
            if (match_string_builder.length() > 0)
                match_string_builder.append(" ");
            match_string_builder.append(termAtt.term());
            skippedPositions += posIncrAtt.getPositionIncrement();
            stateStack.push(captureState());
            is_next_token = input.incrementToken();
            if (m_stop_phrases.contains(match_string_builder.toString())) {
              // Stop phrase is found: skip the number of tokens
              // without restoring the state

posIncrAtt.setPositionIncrement(posIncrAtt.getPositionIncrement() +
skippedPositions);
              return is_next_token;
            }
        }
        // No stop phrase found: restore the stream
        while (!stateStack.empty())
            restoreState(stateStack.pop());
        return true;
    }


Which is the correct direction I should look into to implement my "stop
phrases" filter?

Thank you
Regards
Enrico

--0015175cf9f605fe8304756ca235--

From java-user-return-42686-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 13:53:00 2009
Return-Path: <java-user-return-42686-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27376 invoked from network); 8 Oct 2009 13:53:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 13:53:00 -0000
Received: (qmail 32137 invoked by uid 500); 8 Oct 2009 13:52:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32062 invoked by uid 500); 8 Oct 2009 13:52:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32052 invoked by uid 99); 8 Oct 2009 13:52:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:52:57 +0000
X-ASF-Spam-Status: No, hits=4.0 required=10.0
	tests=RCVD_IN_SBL,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 13:52:46 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 1C0D5D36003
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 15:52:26 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id mRLilmtgKRAw for <java-user@lucene.apache.org>;
	Thu,  8 Oct 2009 15:52:15 +0200 (CEST)
Received: from VEGA (unknown [212.174.9.254])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id BF429D36001
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 15:52:11 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <b18d3be30910080642x4501b26bm9ae1ae07c43aa0e1@mail.gmail.com>
Subject: RE: Lucene 2.9.0 [PROBLEM] : TokenStream API (incrementToken / captureState / restoreState), cannot implement a "stop phrases filter"
Date: Thu, 8 Oct 2009 16:52:04 +0300
Message-ID: <4CA47FE785CF4DE2874A962EF09951FE@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <b18d3be30910080642x4501b26bm9ae1ae07c43aa0e1@mail.gmail.com>
Thread-Index: AcpIHUFI2AYjyw6YSwWYurg5/Pl5RAAAGYeA
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

restoreState only restores the token contents, not the complete stream. So
you cannot roll back the token stream (and this was also not possible with
the old API). The while loop at the end of you code is not working as you
exspect because of this. You may use CachingTokenFilter, which can be reset
and consumed again, as a source for further work.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Enrico Detoma [mailto:enrico.detoma@gmail.com]
> Sent: Thursday, October 08, 2009 4:42 PM
> To: java-user@lucene.apache.org
> Subject: Lucene 2.9.0 [PROBLEM] : TokenStream API (incrementToken /
> captureState / restoreState), cannot implement a "stop phrases filter"
> 
> Hi all,
> 
> I'm trying to implement a "stop phrases filter" with the new TokenStream
> API.
> 
> I would like to be able to peek into N tokens ahead, see if the current
> token + N subsequent tokens match a "stop phrase" (the set of stop phrases
> are saved in a HashSet), then discard all these tokens when they match a
> stop phrase, or keep them all if they don't match.
> 
> For this purpose I would like to use captureState() and then
> restoreState()
> to get back to the starting point of the stream.
> 
> I tried many combinations of these API. My last attempt is in the code
> below, which doesn't work.
> 
> 
> 
>     static private HashSet<String> m_stop_phrases = new HashSet<String>();
>     static private int m_max_stop_phrase_length = 0;
> ...
>     public final boolean incrementToken() throws IOException {
>         if (!input.incrementToken())
>             return false;
>         Stack<State> stateStack = new Stack<State>();
>         StringBuilder match_string_builder = new StringBuilder();
>         int skippedPositions = 0;
>         boolean is_next_token = true;
>         while (is_next_token && match_string_builder.length() <
> m_max_stop_phrase_length) {
>             if (match_string_builder.length() > 0)
>                 match_string_builder.append(" ");
>             match_string_builder.append(termAtt.term());
>             skippedPositions += posIncrAtt.getPositionIncrement();
>             stateStack.push(captureState());
>             is_next_token = input.incrementToken();
>             if (m_stop_phrases.contains(match_string_builder.toString()))
> {
>               // Stop phrase is found: skip the number of tokens
>               // without restoring the state
> 
> posIncrAtt.setPositionIncrement(posIncrAtt.getPositionIncrement() +
> skippedPositions);
>               return is_next_token;
>             }
>         }
>         // No stop phrase found: restore the stream
>         while (!stateStack.empty())
>             restoreState(stateStack.pop());
>         return true;
>     }
> 
> 
> Which is the correct direction I should look into to implement my "stop
> phrases" filter?
> 
> Thank you
> Regards
> Enrico


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42687-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 14:43:50 2009
Return-Path: <java-user-return-42687-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42415 invoked from network); 8 Oct 2009 14:43:50 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 14:43:50 -0000
Received: (qmail 10894 invoked by uid 500); 8 Oct 2009 14:43:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10836 invoked by uid 500); 8 Oct 2009 14:43:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10826 invoked by uid 99); 8 Oct 2009 14:43:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 14:43:47 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 14:43:38 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MvuD7-0002jG-9f
	for java-user@lucene.apache.org; Thu, 08 Oct 2009 07:43:17 -0700
Message-ID: <25803226.post@talk.nabble.com>
Date: Thu, 8 Oct 2009 07:43:17 -0700 (PDT)
From: sadronmeldir <sadronmeldir@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Search By Phrase Not Working
In-Reply-To: <8c4e68610910080226r816fe54m2af337384fe3e78f@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: sadronmeldir@gmail.com
References: <25798292.post@talk.nabble.com> <8c4e68610910080226r816fe54m2af337384fe3e78f@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org


Hello, apologies for the typo before. I mean "Rain of Fire" but sleep
deprivation had gotten the better of me.

I've used Luke to get more details about the problem. Below, I've listed one
of the docs that I would expect to return a hit on a query of (text:"rain
fire").

stored/uncompressed,indexed,tokenized<channelID:Help>
stored/uncompressed,indexed,tokenized<day:6>
stored/uncompressed,indexed<detail:>
stored/uncompressed,indexed,tokenized<hour:22>
stored/uncompressed,indexed<minute:19>
stored/uncompressed,indexed,tokenized<month:10>
stored/uncompressed,indexed<second:59>
stored/uncompressed,indexed,tokenized,termVector,termVectorPosition<text:It'd
be "powexecname Rain of Fire$$L <song lyrics here>">
stored/uncompressed,indexed,tokenized<userID:Huntsman Jackal>
stored/uncompressed,indexed,tokenized<year:2009>

The doc text (It'd be "powexecname Rain of Fire$$L <song lyrics here>") is
being tokenized into (it'd, null_1, powexecname, rain, null_1, fire, l,
song, lyrics, here). From this, I realized that position holes were being
created due to stop words, so my phrase search needed a slop > 0. It works
just fine then.

Thanks for the help!


-- 
View this message in context: http://www.nabble.com/Search-By-Phrase-Not-Working-tp25798292p25803226.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42688-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 14:55:06 2009
Return-Path: <java-user-return-42688-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45475 invoked from network); 8 Oct 2009 14:55:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 14:55:06 -0000
Received: (qmail 29139 invoked by uid 500); 8 Oct 2009 14:55:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29068 invoked by uid 500); 8 Oct 2009 14:55:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29058 invoked by uid 99); 8 Oct 2009 14:55:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 14:55:03 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.172 as permitted sender)
Received: from [209.85.212.172] (HELO mail-vw0-f172.google.com) (209.85.212.172)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 14:54:54 +0000
Received: by vws2 with SMTP id 2so3245514vws.20
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 07:54:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=bG2tFPTmQqYMs/pUVq8/sbUSP1Y3yAF6wVUKLfq1BG4=;
        b=iM+MYmGHtf0Wxk96mevWz2z7YyxqYJpsu11VSy/MZNlJy/RnSZliPkZh13Ov4ZOFuC
         J3oc/wrCn86ADrLOj3rbCdapeSooz2SF30uWKdBCGMHl6kn7c2vwX3vH7WTgEVOiUiYH
         ugVvOMfKphaTIvwx+Z/kypgtM0m96ExAg2rL8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=LDvxMZsyc7kTX1PbmWB6tO3a9BR+sv+dPjBU8W3flns8qe1YfDpGA5r6ZCYhx7C6pS
         K4gIssrDLAUvl19qM57RkRVO2BpzCIZ71ArkcSnVaSRFGHsuY72t+qYOp5eWNnVVJ3i0
         t/x+pnjK+0zRlMwBqKwHG/AlsIkl9+amz4du4=
MIME-Version: 1.0
Received: by 10.220.47.79 with SMTP id m15mr2248927vcf.11.1255013673840; Thu, 
	08 Oct 2009 07:54:33 -0700 (PDT)
Date: Thu, 8 Oct 2009 07:54:33 -0700
Message-ID: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
Subject: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6470d0c37b14704756da45d
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6470d0c37b14704756da45d
Content-Type: text/plain; charset=ISO-8859-1

I am trying to come up with a performant query that will allow me to use a
custom score where the custom score is a sum-product over a set of query
time weights where each weight gets applied only if the query time term
exists in the document . So for example if I have a doc with three fields:
company=Microsoft, city=Redmond, and size=large, I may want to score that
document according to the following function: city==Microsoft ? .3 : 0 *
size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a subclass I have
tested that implements this with one extra component which is that it allow
the relevance score to be combined in.

The problem is this custom score is not performant at all. For example, on a
small index of 5 million documents with 10 weights passed in it does 0.01
req/sec.

Are there ways to make to compute the same custom score but in a much more
performant way?

thanks,
Scott

--0016e6470d0c37b14704756da45d--

From java-user-return-42689-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 14:57:30 2009
Return-Path: <java-user-return-42689-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45916 invoked from network); 8 Oct 2009 14:57:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 14:57:30 -0000
Received: (qmail 31683 invoked by uid 500); 8 Oct 2009 14:57:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31615 invoked by uid 500); 8 Oct 2009 14:57:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31605 invoked by uid 99); 8 Oct 2009 14:57:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 14:57:28 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.172 as permitted sender)
Received: from [209.85.212.172] (HELO mail-vw0-f172.google.com) (209.85.212.172)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 14:57:18 +0000
Received: by vws2 with SMTP id 2so3246658vws.20
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 07:56:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=9xaT7lAjpuoQkf/wtKlmd3oub3m7WsLOoeKmrRG+JRA=;
        b=wQS8Q9gyt6pOJCyXtXvnBZSloezoXlFBBSr/te4ZddG/FbZNCDgY8dzPHgDkm8M2pG
         t/GBtFfqpLth5mqFMPUhkgMNahiLomfCuNNbT9aIdcxiZ7uey05Fn9juryHDrGGMi1yA
         7pcxU94ttoIp8rCkJMqGlvG4mx9EY385iTNhs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=oGqp3L6RM4vgk1mvjXzHcKaga2IudF0fpiGuLBM1r7UcJjAR4/Xsg4ROxKv0iUNH65
         gtiQKBLmWyEtyjnLlxUCNuOoX4fgSHqTiwtvtOOMOU2QjfN3FGoDDLUKvHnqR0LVehvy
         nnB7Hvj+L2NDzHcDCJchAdmMu4a98JIWxjcb0=
MIME-Version: 1.0
Received: by 10.220.114.12 with SMTP id c12mr2098275vcq.109.1255013816228; 
	Thu, 08 Oct 2009 07:56:56 -0700 (PDT)
In-Reply-To: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
Date: Thu, 8 Oct 2009 07:56:55 -0700
Message-ID: <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485e8ad58b461f104756dac1a
X-Virus-Checked: Checked by ClamAV on apache.org

--001485e8ad58b461f104756dac1a
Content-Type: text/plain; charset=ISO-8859-1

Oops, forgot to include the class I mentioned. Here it is:

public class QueryTermBoostingQuery extends CustomScoreQuery {
  private Map<String, Float> queryTermWeights;
  private float bias;
  private IndexReader indexReader;

  public QueryTermBoostingQuery( Query q, Map<String, Float> termWeights,
IndexReader indexReader, float bias) {
    super( q );
    this.indexReader = indexReader;
    if (bias < 0 || bias > 1) {
      throw new IllegalArgumentException( "Bias must be between 0 and 1" );
    }
    this.bias = bias;
    queryTermWeights = termWeights;
  }

  @Override
  public float customScore( int doc, float subQueryScore, float valSrcScore
) {
    Document document;
    try {
      document = indexReader.document( doc );
    } catch (IOException e) {
      throw new SearchException( e );
    }
    float termWeightedScore = 0;

    for (String field : queryTermWeights.keySet()) {
      String docFieldValue = document.get( field );
      if (docFieldValue != null) {
        Float weight = queryTermWeights.get( field );
        if (weight != null) {
          termWeightedScore += weight * Float.parseFloat( docFieldValue );
        }
      }
    }
    return bias * subQueryScore + (1 - bias) * termWeightedScore;
  }
}

On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:

> I am trying to come up with a performant query that will allow me to use a
> custom score where the custom score is a sum-product over a set of query
> time weights where each weight gets applied only if the query time term
> exists in the document . So for example if I have a doc with three fields:
> company=Microsoft, city=Redmond, and size=large, I may want to score that
> document according to the following function: city==Microsoft ? .3 : 0 *
> size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a subclass I have
> tested that implements this with one extra component which is that it allow
> the relevance score to be combined in.
>
> The problem is this custom score is not performant at all. For example, on
> a small index of 5 million documents with 10 weights passed in it does 0.01
> req/sec.
>
> Are there ways to make to compute the same custom score but in a much more
> performant way?
>
> thanks,
> Scott
>

--001485e8ad58b461f104756dac1a--

From java-user-return-42690-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 15:07:18 2009
Return-Path: <java-user-return-42690-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48505 invoked from network); 8 Oct 2009 15:07:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 15:07:18 -0000
Received: (qmail 41349 invoked by uid 500); 8 Oct 2009 15:07:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41287 invoked by uid 500); 8 Oct 2009 15:07:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41277 invoked by uid 99); 8 Oct 2009 15:07:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 15:07:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 15:07:05 +0000
Received: by iwn6 with SMTP id 6so3432687iwn.20
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 08:06:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=zyfMHlM04rPX92XJVmg++M07usfsme71fKlxB5O8A5k=;
        b=QkkeW743dFWe0e8yhgvQZwLc6nTDYCzs+O25jhgip6BxchcxxIZTGkbtmBadCj9c9D
         PRtfP8Kkk39stJ9C6283NdS5v66f05kOYaKlIMowtuMzebJ5CN7eWthLrxuUDFNhLvYa
         EuQH0G/t9s5ftPI9r2RWGsrqgoizCHCGorAzg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=QUzIv+Po/8L38VjanoNPAWzsKyKvkKJByQUqVfPHizyZ5J/c4SJMSs7vJAdHxexg60
         IARa/oZ4s+WiTTk/fM5ucNA1xxze3IXCu/ZOeS9OBdmIZ1VgmhPZnTll1ne7yvqrPheb
         0vYZt7S3mhjj4m7Sjd6iLodLRVwJ8gzG+zaNk=
MIME-Version: 1.0
Received: by 10.231.24.208 with SMTP id w16mr2683628ibb.38.1255014404822; Thu, 
	08 Oct 2009 08:06:44 -0700 (PDT)
In-Reply-To: <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
Date: Thu, 8 Oct 2009 11:06:44 -0400
Message-ID: <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517740964c9951404756dcfdf
X-Virus-Checked: Checked by ClamAV on apache.org

--001517740964c9951404756dcfdf
Content-Type: text/plain; charset=ISO-8859-1

I suspect your problem here is the line:
document = indexReader.document( doc );

See the caution in the docs

You could try using lazy loading (so you don't load all
the terms of the document, just those you're interested
in). And I *think* (but it's been a while) that if the terms
you load are indexed that'll help. But this is mostly
a guess.

What version of Lucene are you using???

Good luck!
Erick

On Thu, Oct 8, 2009 at 10:56 AM, scott w <scottblanc@gmail.com> wrote:

> Oops, forgot to include the class I mentioned. Here it is:
>
> public class QueryTermBoostingQuery extends CustomScoreQuery {
>  private Map<String, Float> queryTermWeights;
>  private float bias;
>  private IndexReader indexReader;
>
>  public QueryTermBoostingQuery( Query q, Map<String, Float> termWeights,
> IndexReader indexReader, float bias) {
>    super( q );
>    this.indexReader = indexReader;
>    if (bias < 0 || bias > 1) {
>      throw new IllegalArgumentException( "Bias must be between 0 and 1" );
>    }
>    this.bias = bias;
>    queryTermWeights = termWeights;
>  }
>
>  @Override
>  public float customScore( int doc, float subQueryScore, float valSrcScore
> ) {
>    Document document;
>    try {
>      document = indexReader.document( doc );
>    } catch (IOException e) {
>      throw new SearchException( e );
>    }
>    float termWeightedScore = 0;
>
>    for (String field : queryTermWeights.keySet()) {
>      String docFieldValue = document.get( field );
>      if (docFieldValue != null) {
>        Float weight = queryTermWeights.get( field );
>        if (weight != null) {
>          termWeightedScore += weight * Float.parseFloat( docFieldValue );
>        }
>      }
>    }
>    return bias * subQueryScore + (1 - bias) * termWeightedScore;
>   }
> }
>
> On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:
>
> > I am trying to come up with a performant query that will allow me to use
> a
> > custom score where the custom score is a sum-product over a set of query
> > time weights where each weight gets applied only if the query time term
> > exists in the document . So for example if I have a doc with three
> fields:
> > company=Microsoft, city=Redmond, and size=large, I may want to score that
> > document according to the following function: city==Microsoft ? .3 : 0 *
> > size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a subclass I
> have
> > tested that implements this with one extra component which is that it
> allow
> > the relevance score to be combined in.
> >
> > The problem is this custom score is not performant at all. For example,
> on
> > a small index of 5 million documents with 10 weights passed in it does
> 0.01
> > req/sec.
> >
> > Are there ways to make to compute the same custom score but in a much
> more
> > performant way?
> >
> > thanks,
> > Scott
> >
>

--001517740964c9951404756dcfdf--

From java-user-return-42691-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 15:13:31 2009
Return-Path: <java-user-return-42691-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49884 invoked from network); 8 Oct 2009 15:13:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 15:13:31 -0000
Received: (qmail 51842 invoked by uid 500); 8 Oct 2009 15:13:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51753 invoked by uid 500); 8 Oct 2009 15:13:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51743 invoked by uid 99); 8 Oct 2009 15:13:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 15:13:29 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [64.202.165.29] (HELO smtpauth17.prod.mesa1.secureserver.net) (64.202.165.29)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 08 Oct 2009 15:13:18 +0000
Received: (qmail 15895 invoked from network); 8 Oct 2009 15:12:56 -0000
Received: from unknown (81.219.54.251)
  by smtpauth17.prod.mesa1.secureserver.net (64.202.165.29) with ESMTP; 08 Oct 2009 15:12:55 -0000
Message-ID: <4ACE016F.2000301@getopt.org>
Date: Thu, 08 Oct 2009 17:12:47 +0200
From: Andrzej Bialecki <ab@getopt.org>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Question about how to speed up custom scoring
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com> <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
In-Reply-To: <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Erick Erickson wrote:
> I suspect your problem here is the line:
> document = indexReader.document( doc );
> 
> See the caution in the docs
> 
> You could try using lazy loading (so you don't load all
> the terms of the document, just those you're interested
> in). And I *think* (but it's been a while) that if the terms
> you load are indexed that'll help. But this is mostly
> a guess.

Just to clarify: IndexReader.document(doc) and .document(doc, selector) 
load _only_ stored fields, they don't interact at all with the 
terms-related part of Lucene..


-- 
Best regards,
Andrzej Bialecki     <><
  ___. ___ ___ ___ _ _   __________________________________
[__ || __|__/|__||\/|  Information Retrieval, Semantic Web
___|||__||  \|  ||  |  Embedded Unix, System Integration
http://www.sigram.com  Contact: info at sigram dot com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42692-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 18:03:04 2009
Return-Path: <java-user-return-42692-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3516 invoked from network); 8 Oct 2009 18:03:04 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 18:03:04 -0000
Received: (qmail 18952 invoked by uid 500); 8 Oct 2009 18:03:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18900 invoked by uid 500); 8 Oct 2009 18:03:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18889 invoked by uid 99); 8 Oct 2009 18:03:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 18:03:01 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nigelspleen@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 18:02:52 +0000
Received: by bwz22 with SMTP id 22so5516688bwz.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 11:02:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=epvqQQUHWcdo1dIHYCO4qdHgrsLb4SZnsDy+ArYjnCU=;
        b=nmkVtjvVUGDjMflTMEgoKNQ3NzB74clDvUT28yFm/LEcjhu+bHqyknw8+MG3bKKrbF
         c8Vs7m61r6GyOl8Sk7DL8YvladXKmxQ6TVr3UYUUZJ8ZcnRZnwwygg676p7jLA+AFIBP
         EV2BV1DWh8+vaJoFrCj8O1vLoC+MtCbI/FYTo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=P4ISEVS/mY+SThDULCdztpqt1wfQ1UWdk5QcVjQwP5B0prCxZg1iX2GvRiw1jRB+IE
         MZ+IiLCMmEE/d78k/BGrLuYcK4ihoOd0IppoUbJTx9JM8lofVmbKCwP1qzKKxqNNULVp
         Aom846fHFJ+8ZinTR8/85hU7J9o0L26POPEwg=
MIME-Version: 1.0
Received: by 10.103.86.9 with SMTP id o9mr670968mul.4.1255024951879; Thu, 08 
	Oct 2009 11:02:31 -0700 (PDT)
In-Reply-To: <4ACCF3E7.7010500@gmail.com>
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
	 <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
	 <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com>
	 <843920a30910071251q2e7850b7yd15edff35fd88d87@mail.gmail.com>
	 <4ACCF3E7.7010500@gmail.com>
Date: Thu, 8 Oct 2009 14:02:31 -0400
Message-ID: <843920a30910081102w3f937e08rd1d78f3d80995557@mail.gmail.com>
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
From: Nigel <nigelspleen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e65c7bc670e95a0475704474
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e65c7bc670e95a0475704474
Content-Type: text/plain; charset=ISO-8859-1

Thanks, Mark.  That makes sense.  I guess if you do it in the right order,
you're guaranteed to have the files in a consistent state, since the only
thing that's actually overwritten is the segments.gen file at the end.

What about the technique of creating a copy of the directory with hard links
and rsyncing changes into that copy?  Is that only necessary if you want to
be using the old and updated versions of the index simultaneously?

Thanks,
Chris

On Wed, Oct 7, 2009 at 4:02 PM, Mark Miller <markrmiller@gmail.com> wrote:

> Solr just copies them into the same directory - Lucene files are write
> once, so its not much different than what happens locally.
>
> Nigel wrote:
> > Right now we logically re-open an index by making an updated copy of the
> > index in a new directory (using rsync etc.), opening the new copy, and
> > closing the old one.  We don't use IndexReader.reopen() because the
> updated
> > index is in a different directory (as opposed to being updated in-place).
> >
> > (Reading about some of the 2.9 changes motivated me to look into actually
> > using reopen().  And Michael Busch and Mark Miller both pointed out that
> I
> > was incorrect in saying that pre-2.9 reopen() wasn't more efficient than
> > just opening a new index -- I've read through that code now so I have at
> > least a basic understanding of what's happening there.  Anyway, it seems
> > like reopen() is a Good Thing, so I'd like to use it. (-:)
> >
> > So, my real question was whether there is a "recommended" way to update
> an
> > index in-place with files copied from a separate indexing server.
> >
> > For example, do you simply rsync in the new cfs files, overwrite the
> > segments.gen and segments_XX files, and call reopen()?  Or create an
> updated
> > copy in a new directory, then rename new directory to the old name once
> > you're sure you've copied everything successfully, then call reopen()?
>  What
> > does Solr do?
> >
> > Thanks,
> > Chris
>

--0016e65c7bc670e95a0475704474--

From java-user-return-42693-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 19:05:04 2009
Return-Path: <java-user-return-42693-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29394 invoked from network); 8 Oct 2009 19:05:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 19:05:03 -0000
Received: (qmail 12218 invoked by uid 500); 8 Oct 2009 19:05:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12140 invoked by uid 500); 8 Oct 2009 19:05:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12130 invoked by uid 99); 8 Oct 2009 19:05:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 19:05:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 72.14.220.153 as permitted sender)
Received: from [72.14.220.153] (HELO fg-out-1718.google.com) (72.14.220.153)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 19:04:50 +0000
Received: by fg-out-1718.google.com with SMTP id d23so79018fga.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 12:04:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=ztRqq5lTkj8iMmXOsRjUW6Qs6NtPGcCqD1kJMfkpaY4=;
        b=k451xYnIHK2OQ5tOkUsk4g2BrezqCji8dVQ37YyMX6LjtK35l5Sg+DsSydf219S9r3
         VrqukuQ5IdtdW7EPqvkNb2sDpiIYEy9xKhRosfIirmdHovBLAEjC5vKwn95nXWk3LhJX
         OiaAQvvUrjSpy1ugQeU7yw7Kn4JkkbvbKG5IA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=Ln/R0z8zl6QEOOf15QmtEFJxHg8Niz4TMc05lHXFLQCy798aZsJNwfdKvUGoyLCW5g
         /noNcBYK9BqpcNsJtePaaDqdd6MwMtoP1b2V1j3QXICXArGx0Y0iJiP7D3Tu+CVvULu8
         aVB1rP+KWXNnihyqxkgHc/fq2Jb3BN/toBxIw=
Received: by 10.86.220.11 with SMTP id s11mr1476664fgg.47.1255028669590;
        Thu, 08 Oct 2009 12:04:29 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id d4sm426419fga.19.2009.10.08.12.04.26
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 08 Oct 2009 12:04:27 -0700 (PDT)
Message-ID: <4ACE37B9.1050408@gmail.com>
Date: Thu, 08 Oct 2009 15:04:25 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>	 <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>	 <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com>	 <843920a30910071251q2e7850b7yd15edff35fd88d87@mail.gmail.com>	 <4ACCF3E7.7010500@gmail.com> <843920a30910081102w3f937e08rd1d78f3d80995557@mail.gmail.com>
In-Reply-To: <843920a30910081102w3f937e08rd1d78f3d80995557@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Nigel wrote:
> Thanks, Mark.  That makes sense.  I guess if you do it in the right order,
> you're guaranteed to have the files in a consistent state, since the only
> thing that's actually overwritten is the segments.gen file at the end.
>   
The main thing to do is to copy the segments_N files last - thats what a
Reader will use to see there is a new index version. The segments.gen
files is a backup resort that shouldn't likely be used unless your on
NFS from what I know.
> What about the technique of creating a copy of the directory with hard links
> and rsyncing changes into that copy?  Is that only necessary if you want to
> be using the old and updated versions of the index simultaneously?
>   
I think this was only necessary before IndexDeletionPolices - you didn't
want the IndexWriter removing the files before you were done copying
them out. You can manage that with a delete policy now though.
> Thanks,
> Chris
>
> On Wed, Oct 7, 2009 at 4:02 PM, Mark Miller <markrmiller@gmail.com> wrote:
>
>   
>> Solr just copies them into the same directory - Lucene files are write
>> once, so its not much different than what happens locally.
>>
>> Nigel wrote:
>>     
>>> Right now we logically re-open an index by making an updated copy of the
>>> index in a new directory (using rsync etc.), opening the new copy, and
>>> closing the old one.  We don't use IndexReader.reopen() because the
>>>       
>> updated
>>     
>>> index is in a different directory (as opposed to being updated in-place).
>>>
>>> (Reading about some of the 2.9 changes motivated me to look into actually
>>> using reopen().  And Michael Busch and Mark Miller both pointed out that
>>>       
>> I
>>     
>>> was incorrect in saying that pre-2.9 reopen() wasn't more efficient than
>>> just opening a new index -- I've read through that code now so I have at
>>> least a basic understanding of what's happening there.  Anyway, it seems
>>> like reopen() is a Good Thing, so I'd like to use it. (-:)
>>>
>>> So, my real question was whether there is a "recommended" way to update
>>>       
>> an
>>     
>>> index in-place with files copied from a separate indexing server.
>>>
>>> For example, do you simply rsync in the new cfs files, overwrite the
>>> segments.gen and segments_XX files, and call reopen()?  Or create an
>>>       
>> updated
>>     
>>> copy in a new directory, then rename new directory to the old name once
>>> you're sure you've copied everything successfully, then call reopen()?
>>>       
>>  What
>>     
>>> does Solr do?
>>>
>>> Thanks,
>>> Chris
>>>       
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42694-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 19:28:18 2009
Return-Path: <java-user-return-42694-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37134 invoked from network); 8 Oct 2009 19:28:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 19:28:18 -0000
Received: (qmail 47799 invoked by uid 500); 8 Oct 2009 19:28:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47732 invoked by uid 500); 8 Oct 2009 19:28:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47722 invoked by uid 99); 8 Oct 2009 19:28:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 19:28:16 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 74.125.92.26 as permitted sender)
Received: from [74.125.92.26] (HELO qw-out-2122.google.com) (74.125.92.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 19:28:07 +0000
Received: by qw-out-2122.google.com with SMTP id 5so308598qwd.53
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 12:27:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=crtgIdi3kd6YuXW+n+umVxjvB/79QbtCWllo8FBK68s=;
        b=WfzRmRSLNRip+4WinrVIafdOHfWQDRqVsJIlBuTrRN68JHlnjQiVnPazKJA8m02rLQ
         TO01L0fGjD6nzRZ1Fju17gXgxW2sa2T8/RQk2fCXxll3+fyj53pqbyx1zvp6lHeLCgh+
         w6C33DoDuAqJlCsySQ37CC1Y6cdGPtvaOIZEM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=mArn14RE9vea8Knb+bEco0hjWyU4hYRnh7SJz42AJx0v1TFAZXZMZZVskXhC+CJFtM
         rg3iJup4c1Nbd7oEi6qhvykYrTwrc/xrlMmofvPPFRe+Zo4aJRqbIeYXMZ3GVYcgE0q1
         zWKOkLTS6LJUP+RDymjN8av4rElC5+SS0lYB8=
MIME-Version: 1.0
Received: by 10.224.13.66 with SMTP id b2mr1555343qaa.370.1255029610849; Thu, 
	08 Oct 2009 12:20:10 -0700 (PDT)
In-Reply-To: <20091008153241.36f300a5@pc-4176.kl.dfki.de>
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
	 <20091008153241.36f300a5@pc-4176.kl.dfki.de>
Date: Thu, 8 Oct 2009 12:20:10 -0700
Message-ID: <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
Subject: Re: Reverse stemmer?
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Out of curiousity and perhaps for practical purposes, how does one
handle mixed language documents?  I suppose one could extract the
words of a particular language and place it in a lang specific field?
Are there libraries to perform this (yet)?

On Thu, Oct 8, 2009 at 6:32 AM, Christian Reuschling
<christian.reuschling@gmail.com> wrote:
> Hi,
>
> looking up the different terms with a common stem can be useful in different
> scenarios - so I don't want to judge it whether someone needs it or not.
>
> E.g., in the case you have multilingual documents in your index, it is straight
> forward to determine the language of the documents in order to choose the right
> stemmer. At least this is right for document with homogenous language.
>
> Althought this is true at indexing time, the language classification for the
> user query is not such trivial - and you have to do this in order to stem the
> query terms for searching. One possibility would be to search for the stems
> given from all stemmers - but in this case you will receive many wrong
> searching terms, thus much noise in the result lists.
>
> Another possibility can be to offer all 'potential synonyms' of the query terms
> to the user - where he can choose whether these are right or not. In this case
> you need exactly the lookup 'queryTerm->stem->terms with same stem'. This can
> be much more precise, the lacks are of course the interaction needed by the
> user and longer queries.
>
> To realize this, someone could write a specific Analyzer that stores this
> relationship additionally e.g. into a database. I personaly don't know any
> possibility to read this directly out of the Lucene index.
>
>
> In the case someone has best practices or an idea how processing multilingual
> indices can be done better, I would be appreciated to read / hear about this.
>
>
>
> all best
>
> Chris
>
>
> On Tue, 6 Oct 2009 16:31:36 +0900
> David Leangen <apache@leangen.net> wrote:
>
>>
>> Hello,
>>
>> I've been using Lucene in a very basic way for some time now, and I'm
>> starting to take advantage of some of the linguistic capabilities only
>> now.
>>
>> I am making use of the snowball analyzer for stemming, and it works
>> very well.
>>
>>
>> Question: is there any such thing as a "reverse stemmer"? In other
>> words, given the stem of a word, is there any algorithm to find the
>> original word? Or is this just fantasy? ;-)
>>
>> Now, I understand that there is a 1:n mapping of stems:words. I can
>> deal with that.
>>
>>
>> Thanks!
>> =David
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42695-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 21:23:53 2009
Return-Path: <java-user-return-42695-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7147 invoked from network); 8 Oct 2009 21:23:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 21:23:53 -0000
Received: (qmail 6610 invoked by uid 500); 8 Oct 2009 21:23:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6545 invoked by uid 500); 8 Oct 2009 21:23:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6535 invoked by uid 99); 8 Oct 2009 21:23:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 21:23:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.75.55.147] (HELO live.stimulussoft.com) (216.75.55.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 21:23:40 +0000
Received: (qmail 20344 invoked by uid 511); 8 Oct 2009 14:23:18 -0700
Received: from 196.210.225.74 by live.stimulussoft.com (envelope-from <jamie@stimulussoft.com>, uid 509) with qmail-scanner-1.25-st-qms 
 (clamdscan: 0.88.7/7149. spamassassin: 3.2.3. perlscan: 1.25-st-qms.  
 Clear:RC:0(196.210.225.74):SA:0(-0.6/5.0):. 
 Processed in 8.675035 secs); 08 Oct 2009 21:23:18 -0000
X-Antivirus-MYDOMAIN-Mail-From: jamie@stimulussoft.com via live.stimulussoft.com
X-Antivirus-MYDOMAIN: 1.25-st-qms (Clear:RC:0(196.210.225.74):SA:0(-0.6/5.0):. Processed in 8.675035 secs Process 20331)
Received: from unknown (HELO ?192.168.0.14?) (jamie@stimulussoft.com@196.210.225.74)
  by live.stimulussoft.com with AES256-SHA encrypted SMTP; 8 Oct 2009 14:23:09 -0700
Message-ID: <4ACE582B.5050108@stimulussoft.com>
Date: Thu, 08 Oct 2009 23:22:51 +0200
From: Jamie Band <jamie@stimulussoft.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Index.close() infinite TIME_WAITING
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>	 <20091008153241.36f300a5@pc-4176.kl.dfki.de> <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
In-Reply-To: <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, hits=-0.6 required=5.0

Hi All

I have a long running situation where our indexing thread is getting 
stuck indefinitely in IndexWriter's close method. Yourkit shows the 
thread to be stuck in TIME_WAITING. Any idea's on what could be causing 
this?
Could it be one of the streams or readers we passed to the document?

I am running Lucene 2.9.0.

Many thanks in advance

Jamie



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42696-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 21:27:02 2009
Return-Path: <java-user-return-42696-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8353 invoked from network); 8 Oct 2009 21:27:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 21:27:01 -0000
Received: (qmail 13348 invoked by uid 500); 8 Oct 2009 21:26:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13262 invoked by uid 500); 8 Oct 2009 21:26:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13252 invoked by uid 99); 8 Oct 2009 21:26:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 21:26:59 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 21:26:48 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 17070D36003
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 23:26:28 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id yO4jNE53S+IK for <java-user@lucene.apache.org>;
	Thu,  8 Oct 2009 23:26:18 +0200 (CEST)
Received: from VEGA (unknown [85.101.98.57])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id E04C8D36001
	for <java-user@lucene.apache.org>; Thu,  8 Oct 2009 23:26:17 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>	 <20091008153241.36f300a5@pc-4176.kl.dfki.de> <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com> <4ACE582B.5050108@stimulussoft.com>
Subject: RE: Index.close() infinite TIME_WAITING
Date: Fri, 9 Oct 2009 00:26:18 +0300
Message-ID: <877DA12FFA494F05B178963CC5AED061@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4ACE582B.5050108@stimulussoft.com>
Thread-Index: AcpIXapPGAegkq7kQbKjVdmiQV+ChAAABy9g
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Did you do some extra locking around IndexWriter using the IndexWriter
itsself as mutex (e.g. synchronized(writer) {...}). This is not supported
and hangs. IndexWriter itself is thread-safe.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Jamie Band [mailto:jamie@stimulussoft.com]
> Sent: Friday, October 09, 2009 12:23 AM
> To: java-user@lucene.apache.org
> Subject: Index.close() infinite TIME_WAITING
> 
> Hi All
> 
> I have a long running situation where our indexing thread is getting
> stuck indefinitely in IndexWriter's close method. Yourkit shows the
> thread to be stuck in TIME_WAITING. Any idea's on what could be causing
> this?
> Could it be one of the streams or readers we passed to the document?
> 
> I am running Lucene 2.9.0.
> 
> Many thanks in advance
> 
> Jamie
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42697-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 08 21:27:51 2009
Return-Path: <java-user-return-42697-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8579 invoked from network); 8 Oct 2009 21:27:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 8 Oct 2009 21:27:51 -0000
Received: (qmail 15182 invoked by uid 500); 8 Oct 2009 21:27:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 15109 invoked by uid 500); 8 Oct 2009 21:27:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 15099 invoked by uid 99); 8 Oct 2009 21:27:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 21:27:48 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 08 Oct 2009 21:27:39 +0000
Received: by yxe30 with SMTP id 30so8967328yxe.29
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 14:27:18 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.48.40 with SMTP id v40mr3214352ybv.142.1255037238703; Thu, 
	08 Oct 2009 14:27:18 -0700 (PDT)
In-Reply-To: <4ACE582B.5050108@stimulussoft.com>
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net>
	 <20091008153241.36f300a5@pc-4176.kl.dfki.de>
	 <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
	 <4ACE582B.5050108@stimulussoft.com>
Date: Thu, 8 Oct 2009 17:27:18 -0400
Message-ID: <9ac0c6aa0910081427p408a5f4ap550f0aa9289ea0d1@mail.gmail.com>
Subject: Re: Index.close() infinite TIME_WAITING
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Is it possible a large merge is running?  By default IW.close waits
for outstanding merges to complete.  Can you post the stacktrace?

Mike

On Thu, Oct 8, 2009 at 5:22 PM, Jamie Band <jamie@stimulussoft.com> wrote:
> Hi All
>
> I have a long running situation where our indexing thread is getting stuck
> indefinitely in IndexWriter's close method. Yourkit shows the thread to be
> stuck in TIME_WAITING. Any idea's on what could be causing this?
> Could it be one of the streams or readers we passed to the document?
>
> I am running Lucene 2.9.0.
>
> Many thanks in advance
>
> Jamie
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42698-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 00:25:24 2009
Return-Path: <java-user-return-42698-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69397 invoked from network); 9 Oct 2009 00:25:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 00:25:24 -0000
Received: (qmail 29777 invoked by uid 500); 9 Oct 2009 00:25:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 29685 invoked by uid 500); 9 Oct 2009 00:25:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 29675 invoked by uid 99); 9 Oct 2009 00:25:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 00:25:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 00:25:12 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 08 Oct 2009 17:24:46 -0700
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: 2.9: TopScoreDocCollector
Date: Thu, 8 Oct 2009 17:24:04 -0700
Message-ID: <DEC11051901DCC43BD47EC508118AD860891C121@exchg04.corp.business.com>
In-Reply-To: <4b124c310910072215me8ac921mf69a244b968d4841@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: 2.9: TopScoreDocCollector
Thread-Index: AcpH1m2LCE0JE52eToS38oiZPPLipgAoFBDw
References: <DEC11051901DCC43BD47EC508118AD860891BADD@exchg04.corp.business.com> <4b124c310910072215me8ac921mf69a244b968d4841@mail.gmail.com>
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks.  Makes sense.

-----Original Message-----
From: Jake Mannix [mailto:jake.mannix@gmail.com]=20
Sent: Wednesday, October 07, 2009 10:15 PM
To: java-user@lucene.apache.org
Subject: Re: 2.9: TopScoreDocCollector

Hi Eric,

  Different Query classes have different options on whether they can
score
docs out of order, or if they always proceed in order, so the way to
make
sure
you're choosing the right value, if you don't know which you need, is to
ask
your Query (or more appropriately, it's Weight):

   Query query =3D myBuildQueryMethod();
   IndexSearcher searcher =3D myBuildSearcherMethod();
   Weight weight =3D query.weight(searcher);
   boolean allowOutOfOrder =3D weight.scoresDocsOutOfOrder();

   TopScoreDocCollector coll =3D TopScoreDocCollector.create(numHits,
allowOutOfOrder);
   searcher.search(weight, (Filter) null, coll);


  -jake

On Wed, Oct 7, 2009 at 7:26 PM, Angel, Eric <eangel@business.com> wrote:

> According to the documentation for 2.9,
> TopScoreDocCollector.create(numHits, boolean), the second parameter is
> whether documents are scored in order by the input - How do I choose?
> In other words, how would I know if the documents are scored in order
or
> not?
>
>
>
> Eric
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42699-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 02:01:40 2009
Return-Path: <java-user-return-42699-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91412 invoked from network); 9 Oct 2009 02:01:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 02:01:40 -0000
Received: (qmail 917 invoked by uid 500); 9 Oct 2009 02:01:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 832 invoked by uid 500); 9 Oct 2009 02:01:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 821 invoked by uid 99); 9 Oct 2009 02:01:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 02:01:38 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 02:01:29 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 08 Oct 2009 19:00:55 -0700
Received: from 172.16.1.31 ([172.16.1.31]) by exchg04.corp.business.com ([10.1.0.24]) with Microsoft Exchange Server HTTP-DAV ;
 Fri,  9 Oct 2009 02:00:18 +0000
Message-ID: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>
Content-Type: text/plain;
	format=flowed;
	charset="us-ascii";
	delsp=yes
Thread-Topic: Realtime & distributed
Thread-Index: AcpIhEA2Y34L5HeTTROCN9SPGamU7A==
Content-Transfer-Encoding: 7bit
MIME-Version: 1.0 (iPhone Mail 7C144)
Subject: Realtime & distributed
Date: Thu, 8 Oct 2009 19:00:12 -0700
X-Virus-Checked: Checked by ClamAV on apache.org


Does anyone have any recommendations?  I've looked at Katta, but it  
doesn't seem to support realtime searching.  It also uses hdfs, which  
I've heard can be slow.  I'm looking to serve 40gb of indexes and  
support about 1 million updates per day.

Thx

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42700-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 02:57:26 2009
Return-Path: <java-user-return-42700-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 98930 invoked from network); 9 Oct 2009 02:57:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 02:57:26 -0000
Received: (qmail 25815 invoked by uid 500); 9 Oct 2009 02:57:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25736 invoked by uid 500); 9 Oct 2009 02:57:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25726 invoked by uid 99); 9 Oct 2009 02:57:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 02:57:23 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 74.125.92.25 as permitted sender)
Received: from [74.125.92.25] (HELO qw-out-2122.google.com) (74.125.92.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 02:57:14 +0000
Received: by qw-out-2122.google.com with SMTP id 5so419781qwd.53
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 19:56:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=rhov5WeCVM0JZrFpQfUNB6J6AR29bBhtvqieaTPIQ+M=;
        b=KFur5okwRM/IPM8lzOf0xGQgdASr/ruyXIgRQUHhMo7Ixlrso4zQXOSSLzbVTzi8o6
         NyPSrD6CF0S1txUiCMAZaPSDvzBfK495aQpnRAUuMYven/fRZFO2I8OvRSI0bgZG3SyM
         cYS/bvKsN/5+g4G4EKymqV/Nt/foNEz55+gzg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=Hj2fiLYsT3LM8qpt0dfaXnh0KYMUNXpA7Bnn+EJjCl8FZE15pzfdcTOH7dGZH/m7xt
         1V9Bewxnd7w3nJa6EPdDNV9VhLjt41psnN3Rxwrej0H3475eV4heywP4NfIzafGVMW64
         nF1hogZLrOSG+s+kSdNzDPkaPIhMwB9B3i8sI=
MIME-Version: 1.0
Received: by 10.224.96.202 with SMTP id i10mr1990455qan.311.1255057013396; 
	Thu, 08 Oct 2009 19:56:53 -0700 (PDT)
In-Reply-To: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
Date: Thu, 8 Oct 2009 19:56:53 -0700
Message-ID: <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Eric,

Katta doesn't require HDFS which would be slow to search on,
though Katta can be used to copy indexes out of HDFS onto local
servers. The best bet is hardware that uses SSDs because merges
and update latency will greatly decrease and there won't be a
synchronous IO issue as there is with hard drives. Also, IO
caches get flushed as large merges occur, which means subsequent
queries may hit the HD and slow down. With SSDs this is much
less of an issue.

Today near realtime search (with or without SSDs) comes at a
price, that is reduced indexing speed due to continued in RAM
merging. People typically hack something together where indexes
are held in a RAMDir until being flushed to disk. The problem
with this is, merging in the background becomes really tricky
unless it's performed inside of IndexWriter (see LUCENE-1313 and
IW.getReader). There is the Zoie system which uses the RAMDir
solution, however it's implemented using a customized deleted
doc set based on a bloomfilter backed by an inefficient RB tree
which slows down queries. There's always a trade off when trying
to build an NRT system, currently.

Also, there isn't a clear way to replicate segments in realtime
so people usually end up analyzing documents on each replicated
node, which is redundant. A long term solution here could be a
distributed transaction log where encoded segments are stored
and replicated to N nodes.

Deletes can pile up in segments so the
BalancedSegmentMergePolicy could be used to remove those faster
than LogMergePolicy, however I haven't tested it, and it may be
trying to not do large segment merges altogether which IMO
is less than ideal because query performance soon degrades
(similar to an unoptimized index).

Hopefully in the future we can offer searching over
IndexWriter's RAM buffer where indexing and search speed would
be roughly what it is today. That combined with a way to insure
segments don't get flushed out of the IO cache during large
segment merges would mean really efficient NRT, even on systems
with HDs. In the interim, you'd need to play around and see what
works for your requirements.

-J

On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
>
> Does anyone have any recommendations? =A0I've looked at Katta, but it doe=
sn't
> seem to support realtime searching. =A0It also uses hdfs, which I've hear=
d can
> be slow. =A0I'm looking to serve 40gb of indexes and support about 1 mill=
ion
> updates per day.
>
> Thx
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42701-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 03:07:55 2009
Return-Path: <java-user-return-42701-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4588 invoked from network); 9 Oct 2009 03:07:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 03:07:55 -0000
Received: (qmail 34777 invoked by uid 500); 9 Oct 2009 03:07:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34646 invoked by uid 500); 9 Oct 2009 03:07:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34636 invoked by uid 99); 9 Oct 2009 03:07:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:07:53 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:07:42 +0000
Received: by ewy26 with SMTP id 26so7106177ewy.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 20:07:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=eXJbpB5h8ZPS9KTBIZ4ssLiYuezw7q626/lYWvwnt54=;
        b=H+pTFo5sUfNwnS/6iUKfriRaxLdpyuHm0Ht6wd1smy7WD8S61ac6S0XRogjvylmMnh
         xXyUxCozRDk7/iZoKkJj6m9yEb/hHY9qPh7i1m5AHkBTfFcIcmp9yBkWrfypyuO9xJIO
         OsAvmo9s7iwpuf841LHjNsnLGGi4uUPxqitSw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=q/73c/rYjleuOcWY655FVd+juB0zAX2ROPXnnuNCULkKN14LDDM0N6Z8fXhtv2I50F
         a7tJ8a/JJrZf2TJfyH1KcwaMQLBK0FHOeD1NK5DhWMr8HfW58h8eTBhPMEPrGXposAOX
         39fB9IoWqQnNYwxV8GOOcC0awilD/LvRo7liM=
Received: by 10.211.139.17 with SMTP id r17mr2453047ebn.88.1255057642178;
        Thu, 08 Oct 2009 20:07:22 -0700 (PDT)
Received: from ?192.168.1.201? ([213.112.129.143])
        by mx.google.com with ESMTPS id 10sm1059191eyd.16.2009.10.08.20.07.21
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 08 Oct 2009 20:07:21 -0700 (PDT)
Message-Id: <667E85BC-8CC4-4BE6-B674-3B8E855506A4@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Reverse stemmer?
Date: Fri, 9 Oct 2009 05:07:20 +0200
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net> <20091008153241.36f300a5@pc-4176.kl.dfki.de> <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

For the case where the text contains mixed languages there are  
solutions that simutainously use morphological rules of two or more  
languages. Coveo search does this but I don't know what their solution  
looks like. I suppose one way to do it would be to stem all tokens  
with all algorithms and add the results as synonyms, both at index and  
query time. Sounds a bit expensive though. If you have enough  
resources to spend at index time you could probably end up with a more  
optimized index by using dictionaries to back language identification  
per word and power brute force stemming (way slow) that's compatible  
with algortihmic query time stemmers (way speedier). I'm just guessing  
though.


       karl

8 okt 2009 kl. 21.20 skrev Jason Rutherglen:

> Out of curiousity and perhaps for practical purposes, how does one
> handle mixed language documents?  I suppose one could extract the
> words of a particular language and place it in a lang specific field?
> Are there libraries to perform this (yet)?
>
> On Thu, Oct 8, 2009 at 6:32 AM, Christian Reuschling
> <christian.reuschling@gmail.com> wrote:
>> Hi,
>>
>> looking up the different terms with a common stem can be useful in  
>> different
>> scenarios - so I don't want to judge it whether someone needs it or  
>> not.
>>
>> E.g., in the case you have multilingual documents in your index, it  
>> is straight
>> forward to determine the language of the documents in order to  
>> choose the right
>> stemmer. At least this is right for document with homogenous  
>> language.
>>
>> Althought this is true at indexing time, the language  
>> classification for the
>> user query is not such trivial - and you have to do this in order  
>> to stem the
>> query terms for searching. One possibility would be to search for  
>> the stems
>> given from all stemmers - but in this case you will receive many  
>> wrong
>> searching terms, thus much noise in the result lists.
>>
>> Another possibility can be to offer all 'potential synonyms' of the  
>> query terms
>> to the user - where he can choose whether these are right or not.  
>> In this case
>> you need exactly the lookup 'queryTerm->stem->terms with same  
>> stem'. This can
>> be much more precise, the lacks are of course the interaction  
>> needed by the
>> user and longer queries.
>>
>> To realize this, someone could write a specific Analyzer that  
>> stores this
>> relationship additionally e.g. into a database. I personaly don't  
>> know any
>> possibility to read this directly out of the Lucene index.
>>
>>
>> In the case someone has best practices or an idea how processing  
>> multilingual
>> indices can be done better, I would be appreciated to read / hear  
>> about this.
>>
>>
>>
>> all best
>>
>> Chris
>>
>>
>> On Tue, 6 Oct 2009 16:31:36 +0900
>> David Leangen <apache@leangen.net> wrote:
>>
>>>
>>> Hello,
>>>
>>> I've been using Lucene in a very basic way for some time now, and  
>>> I'm
>>> starting to take advantage of some of the linguistic capabilities  
>>> only
>>> now.
>>>
>>> I am making use of the snowball analyzer for stemming, and it works
>>> very well.
>>>
>>>
>>> Question: is there any such thing as a "reverse stemmer"? In other
>>> words, given the stem of a word, is there any algorithm to find the
>>> original word? Or is this just fantasy? ;-)
>>>
>>> Now, I understand that there is a 1:n mapping of stems:words. I can
>>> deal with that.
>>>
>>>
>>> Thanks!
>>> =David
>>>
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42702-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 03:18:53 2009
Return-Path: <java-user-return-42702-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7306 invoked from network); 9 Oct 2009 03:18:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 03:18:53 -0000
Received: (qmail 43020 invoked by uid 500); 9 Oct 2009 03:18:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42949 invoked by uid 500); 9 Oct 2009 03:18:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42932 invoked by uid 99); 9 Oct 2009 03:18:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:18:50 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:18:41 +0000
Received: by ywh15 with SMTP id 15so6298613ywh.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 20:18:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=cfF35X+cc6BnSPzIQ2VhK76JdynfTUdAZV1RnbgMQZI=;
        b=MtcfjL51MqOvc44sf1wJzkMa8/JkbIEcLjhDFxk+fUGK/7loiEnSPZm1YZ9keuM3nM
         1ga2oToxoa0vpJRSlgIoDrPlx70UV10HzPDv8+RtjxuOGmvPGlY9G/s9bbDTjYtSZ7P3
         38ec25cxUvvv3K3coe+2Y5XeER0y4cXMECKJA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=OzvX5/sw37GajflBRnzCNfTUX9mpxV4fbgIZpM+RR9if+ou3X4TYU+5UGN0N9sUcI1
         D62lIrP6Rk5omAd9uExp4bVcIYVmXNJVNggwiXaMuyshC1wehJTVOVXfCIKbjfga3kkb
         9FLSZ+TP/NJz1Ocs+PkFSiFOggLAP0NhWxzTw=
MIME-Version: 1.0
Received: by 10.91.95.5 with SMTP id x5mr1174191agl.28.1255058300129; Thu, 08 
	Oct 2009 20:18:20 -0700 (PDT)
In-Reply-To: <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
Date: Thu, 8 Oct 2009 20:18:20 -0700
Message-ID: <4b124c310910082018q6f5ab9e0r700f5eb3eefbbc6b@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e646050426d0fd0475780817
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e646050426d0fd0475780817
Content-Type: text/plain; charset=ISO-8859-1

Jason,

On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <jason.rutherglen@gmail.com
> wrote:

> Today near realtime search (with or without SSDs) comes at a
> price, that is reduced indexing speed due to continued in RAM
> merging. People typically hack something together where indexes
> are held in a RAMDir until being flushed to disk. The problem
> with this is, merging in the background becomes really tricky
> unless it's performed inside of IndexWriter (see LUCENE-1313 and
> IW.getReader). There is the Zoie system which uses the RAMDir
> solution, however it's implemented using a customized deleted
> doc set based on a bloomfilter backed by an inefficient RB tree
> which slows down queries. There's always a trade off when trying
> to build an NRT system, currently.
>

  I'm not sure what numbers you are using to justify saying that zoie
"slows down queries" - latency at LinkedIn using zoie has a typical
median response time of 4-8ms at the searcher node level (slower
at the broker due to a lot of custom stuff that happens before
queries are actually sent to the nodex), while dealing with sustained
rapid indexing throughput, all with basically zero time between indexing
event to index visibility (ie. true real-time, not "near real time", unless
indexing events are coming in *very* fast).

  You say there's a tradeoff, but as you should remember from your
time at LinkedIn, we do distributed realtime faceted search while
maintaining extremely low latency and still indexing sometimes more
than a thousand new docs a minute per node (I should dredge up
some new numbers to verify what that is exactly these days).


Deletes can pile up in segments so the
> BalancedSegmentMergePolicy could be used to remove those faster
> than LogMergePolicy, however I haven't tested it, and it may be
> trying to not do large segment merges altogether which IMO
> is less than ideal because query performance soon degrades
> (similar to an unoptimized index).
>

Not optimizing all the way has shown in our case to actually be
*better* than the "optimal" case of a 1-segment index, at least in
the case of realtime indexing at rapid update pace.


  -jake

--0016e646050426d0fd0475780817--

From java-user-return-42703-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 03:25:19 2009
Return-Path: <java-user-return-42703-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8264 invoked from network); 9 Oct 2009 03:25:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 03:25:19 -0000
Received: (qmail 46431 invoked by uid 500); 9 Oct 2009 03:25:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46332 invoked by uid 500); 9 Oct 2009 03:25:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46322 invoked by uid 99); 9 Oct 2009 03:25:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:25:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:25:05 +0000
Received: by ywh15 with SMTP id 15so6301946ywh.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 20:24:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=xHDyRasdikr+dmWlSvNZXuQHNSfGRpHnXKEVOs3QxLk=;
        b=WZIJY6iq2TFMT2/CT9T+QaJXujL1EJ3e0JsIIsQ0jtgYBXpAJFZ0lgMjJr0ksdY0No
         Tt5FCioIqiclMEIPVfSHOMb4ml3TXqa6n/Sfqs/9IJ2MtjXsWADAsUN83NkDnfV/oRcb
         R56e7a6DqeBFgnxNlkWQde+WnzrkwINGL9BiA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=udAjhm0LSy5jU0vCDZDHHXw4GFXMehTQIN15plisYdAKQM8PKfydq/rNlPm9kqGmb7
         QBj/rG9OIGXIUufnDGa9j0aq9ZT7SAmtUV95PlrvPFShSfaA00wW8UnvaOi+FB+/85So
         RdVsckEkCOR9yqTye1HkpNDZ71koW9u8hTSCw=
MIME-Version: 1.0
Received: by 10.91.188.20 with SMTP id q20mr1161052agp.81.1255058683319; Thu, 
	08 Oct 2009 20:24:43 -0700 (PDT)
In-Reply-To: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
Date: Thu, 8 Oct 2009 20:24:43 -0700
Message-ID: <4b124c310910082024p450dbdf9x54f072d393e4cebf@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364d2ef5fdd47d0475781ef8
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364d2ef5fdd47d0475781ef8
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:

>
> Does anyone have any recommendations?  I've looked at Katta, but it doesn't
> seem to support realtime searching.  It also uses hdfs, which I've heard can
> be slow.  I'm looking to serve 40gb of indexes and support about 1 million
> updates per day.
>
>
Hi Eric,

  As I mentioned in my response to Jason, we at LinkedIn serve our roughly
50million document profile index on a real-time distributed setup (we're
serving facets in real-time also), serving tens of millions of queries a day
in the 1-10ms latency per node, based on the open source zoie project (built
here at LinkedIn) : http://zoie.googlecode.com

  Zoie doesn't handle the distributed part of the setup, it's just the
real-time side.  Distribution is done pretty straitgtforwardly in our case
though: N shards each getting a different contiguous slice of the user base,
each replicated K times, and all N*K nodes get indexing events distributed
by a message queue independently.

  If you have any questions about zoie, let me know.  The documentation
could get filled in a little further, and it doesn't touch on distributed
side of things, so feel free to ping me.

  -jake

--0016364d2ef5fdd47d0475781ef8--

From java-user-return-42704-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 03:43:17 2009
Return-Path: <java-user-return-42704-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15437 invoked from network); 9 Oct 2009 03:43:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 03:43:16 -0000
Received: (qmail 62903 invoked by uid 500); 9 Oct 2009 03:43:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62835 invoked by uid 500); 9 Oct 2009 03:43:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62822 invoked by uid 99); 9 Oct 2009 03:43:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:43:14 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 03:43:05 +0000
Received: by yxe30 with SMTP id 30so9234455yxe.29
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 20:42:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=YY11TppSsr8Qg3mPrjt/W9SxHgcyxzXKLhbORwyYnpU=;
        b=M1bhYRY4SnHGfF+uN1mkYB7eEIHpN7kNoUPXnOgD3hWW+kIs+j1y7u4qhSkPyprdt/
         Ve+/eZAgFdt3pmnEf88tZYNYxQJ9GXVmgiJLJjIti7lgHqc8KHV15FfWiRrx257uQn9z
         wietk3CCRKnLOtgPUXtYM5fFz66PCOo9Y44vM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=hB3VEg5kZNQFPjdOb2eZ7vZx6tKtTkpPi3DSmRjO85y+ct1Y1eiZ6SuOGw3sNEIug9
         dVbRLiHDnMnCSmIyuRMNOWh5ml6bly2+i0XgJr9FZrfiFkkT6GBtuWMO52r0ldAqIdz+
         hdtN9CwtDbF5oedgMCemVTn9o4Xoyofl7DnjI=
MIME-Version: 1.0
Received: by 10.91.19.4 with SMTP id w4mr1195502agi.0.1255059764168; Thu, 08 
	Oct 2009 20:42:44 -0700 (PDT)
In-Reply-To: <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
Date: Thu, 8 Oct 2009 20:42:44 -0700
Message-ID: <4b124c310910082042r5b1a09d9k31c2196a3410b7a0@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f547906a46e20475785f32
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f547906a46e20475785f32
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <jason.rutherglen@gmail.com
> wrote:

> There is the Zoie system which uses the RAMDir
> solution,
>

Also, to clarify: zoie does not index into a RAMDir and then periodically
merge that
down to disk, as for one thing, this has a bad failure mode when the system
crashes,
as you lose the entire RAMDir and have to figure out how far back to look in
your
transaction log to know how much to reindex.

Zoie instead indexes "redundantly": every incoming document is indexed into
a
RAMDir *and* the FSDirectory simultaneously, but the disk IndexReader for
the
FSDirectory is only reopened every 15 minutes or so, while the IndexReader
for
the RAMDirectory is reopened for every query to guarantee real-timeliness of
the index.

The only case where zoie *isn't* realtime, is when the speed of indexing
updates
comes in faster than can be indexed into the RAMDirectory - if this is the
case,
those updates will pile up in a queue being served by that indexing thread,
and
won't be visible until that thread has caught up.  In practice, this doesn't
happen
unless any given node is trying to index a hundred documents (depends on
size,
of course) a second.

Of course, since the IndexWriter buffers some documents in RAM before
flushing to disk, you are not totally immune to system failures, but at zoie
is
no more susceptible to that then non-realtime search, as it's writing
directly to
disk all the time as well (and yes, this is redundant, but ever since the
fantastic
indexing speed improvements of Lucene 2.3, I've yet to see indexing be the
bottleneck anymore).

  -jake

--001485f547906a46e20475785f32--

From java-user-return-42705-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 04:33:27 2009
Return-Path: <java-user-return-42705-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28843 invoked from network); 9 Oct 2009 04:33:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 04:33:26 -0000
Received: (qmail 13334 invoked by uid 500); 9 Oct 2009 04:33:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13274 invoked by uid 500); 9 Oct 2009 04:33:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13263 invoked by uid 99); 9 Oct 2009 04:33:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 04:33:22 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.were@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 04:33:11 +0000
Received: by yxe30 with SMTP id 30so9266411yxe.29
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 21:32:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:from:date:message-id:subject:to:content-type;
        bh=gTjf6Sd9S28UjwxPag2HAhTJRxge+A8M8RaRZcei/ZQ=;
        b=ce7SuoxdH/DIaBrkk3E2QvU553TTDLQgzQdYCUFs9AO34VDEU5wCrJhLhmIjlvU1sW
         ne+B3JI45s6sIhTSGoT2gJPpAhQUTyNEedafM4si30lvisb+6WFWv3LkPh5ewuLqnHzX
         oVrySZaSbOk+PxciSzUE/xeKtgIfR82dooyCM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:from:date:message-id
         :subject:to:content-type;
        b=Z8dKXrz2jURjF8QhS+sPXZmhtm8mtYtx8JHwTbpL+bUcuhteuB8Lk7sz6wezNcOZvz
         SOw4xaKXproCu1NN+SmxCcQZbGO+L71YaXFr9hhZWggq3rtnRvGSQVmUtRqqc6PoVxdv
         fIiBmuv5Wf+M6lhK6LrCrLV/3gAPT/H4U02lQ=
MIME-Version: 1.0
Received: by 10.91.28.9 with SMTP id f9mr1166334agj.89.1255062768303; Thu, 08 
	Oct 2009 21:32:48 -0700 (PDT)
Reply-To: chris@chriswere.com
In-Reply-To: <4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com> 
	<4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com>
From: Chris Were <chris.were@gmail.com>
Date: Fri, 9 Oct 2009 15:02:28 +1030
Message-ID: <35bb42690910082132v6819e759n5e686022f0660428@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f8975e79c0ba04757912cd
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f8975e79c0ba04757912cd
Content-Type: text/plain; charset=ISO-8859-1

>
> In this case, I'd say that if you have a reliable, scalable queueing system
> for
> getting indexing events distributed to all of your servers, then indexing
> on
> all replicas simultaneously can be the best way to have maximally realtime
> search, either using the very new feature of "near realtime search" in
> Lucene 2.9, by using something home-brewed which indexes in memory
> and on disk simultaneously, or using Zoie ( http://zoie.googlecode.com ),
> an open-source realtime search library built on top of Lucene which we at
> LinkedIn built and have been using in production for serving tens of
> millions of queries a day in real time (meaning milliseconds, even under
> fairly high indexing load) for the past year.


Zoie looks very close to what I'm after, however my whole app is written in
Python and uses PyLucene, so there is a non-trivial amount of work to make
things work with Zoie.

I'm currently experiencing a bottleneck when optimising my index. How is
this handled / solved with Zoie?

Cheers,
Chris

--001485f8975e79c0ba04757912cd--

From java-user-return-42706-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 04:37:43 2009
Return-Path: <java-user-return-42706-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30166 invoked from network); 9 Oct 2009 04:37:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 04:37:43 -0000
Received: (qmail 19469 invoked by uid 500); 9 Oct 2009 04:37:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19384 invoked by uid 500); 9 Oct 2009 04:37:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19374 invoked by uid 99); 9 Oct 2009 04:37:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 04:37:41 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ihasmax@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 04:37:31 +0000
Received: by fxm2 with SMTP id 2so6059254fxm.28
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 21:37:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=RxQbH5fm18aXWGtVLpR/06ETB/aienU/Gpey4oC7nKk=;
        b=Ew94kbFuK2LGewW+dlvKSuyhx6a3YnU4tapvdGpPMAe8gMjhy8eYnqmNU/rKZnkkj+
         TEqQ5ycdqbswpkyBgcm/Dje5VbHAxuFeXOifFcLN3F6257dX/m208UBpW3P8ROy5m9Ri
         0kQnAxJS2k0FUnrRHm54TqxPs5gTlQ5WHepgU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=hTDgdcEr4kdgFC3ouUIttb75rz/i3DNMNTZIFZMhqrSob7CnVoACLcgz+iqBw9rfoh
         sWa/yiD5yt2LT+a9XHwFZAxmiKkH+LlcdzQ0s0IM+3qnYTqCK1P8iEsUb/AM23huGkEK
         qwJ8hrH+bEujE5uqeYkMYMDNlG1WzXUuKoGT4=
MIME-Version: 1.0
Received: by 10.103.50.36 with SMTP id c36mr837796muk.135.1255063031449; Thu, 
	08 Oct 2009 21:37:11 -0700 (PDT)
In-Reply-To: <88f6e29a0910080101m4d17c5al1e466e19badfd331@mail.gmail.com>
References: <3836ec640910020810t236410a0j78ccc788975a0915@mail.gmail.com>
	 <88f6e29a0910080101m4d17c5al1e466e19badfd331@mail.gmail.com>
Date: Thu, 8 Oct 2009 23:37:11 -0500
Message-ID: <3836ec640910082137l465152ddv3eeff61802c9f1ff@mail.gmail.com>
Subject: Re: FileNotFoundException on index
From: Max Lynch <ihasmax@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e65c8c6e2909460475792238
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e65c8c6e2909460475792238
Content-Type: text/plain; charset=ISO-8859-1

Missed your response, thanks Bernd.

I don't think that's it, since I haven't been executing any commands like
that.  The only thing I could think of is corruption.  I've got the index
backed up in case there is a way to fix it (it won't matter in a week or so
since I cull any documents older than 25 days).

Is there a way to fix this?

Thanks.

On Thu, Oct 8, 2009 at 3:01 AM, Bernd Fondermann <
bernd.fondermann@googlemail.com> wrote:

> Hi Max
>
> just a guess: maybe you deleted all *.c source files in that area and
> unintentionally deleted this index file, too.
>
>  Bernd
>
> On Fri, Oct 2, 2009 at 17:10, Max Lynch <ihasmax@gmail.com> wrote:
> > I'm getting this error when I try to run my searcher and my indexer:
> >
> > Traceback (most recent call last):
> > self.searcher = lucene.IndexSearcher(self.directory)
> > JavaError: java.io.FileNotFoundException:
> /home/spider/misc/index/_275c.cfs
> > (No such file or directory)
> >
> > I don't know anything about the format of the Lucene index, but I notice
> I
> > have several _275* files from b to j but no c.
> >
> > Any ideas?
> >
> > Thanks.
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e65c8c6e2909460475792238--

From java-user-return-42707-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 05:11:26 2009
Return-Path: <java-user-return-42707-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35901 invoked from network); 9 Oct 2009 05:11:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 05:11:26 -0000
Received: (qmail 44695 invoked by uid 500); 9 Oct 2009 05:11:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44620 invoked by uid 500); 9 Oct 2009 05:11:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44610 invoked by uid 99); 9 Oct 2009 05:11:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 05:11:23 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.185 as permitted sender)
Received: from [209.85.211.185] (HELO mail-yw0-f185.google.com) (209.85.211.185)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 05:11:14 +0000
Received: by ywh15 with SMTP id 15so6351902ywh.5
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 22:10:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=3MS4gtdtUGbdpLqrR5fuDY89Qn9IGRDGn/mZoXlYN/c=;
        b=SX3+tkHw4AGwNeKcPSy0x0de72WI5TDnsPO+p5URvGJDwPOsfSppjxky9tNfnbpshc
         hhAOma3UT9PCuE1l/4eqNQPcgIn98D36QyP/+eXPqK+0SkueSvTcxo9m4Z17tPD+MVOo
         suDcDW3BkD8tvmvoMf6xh/0TGk9YVb1VgcBXo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ODEbyvCpsnUZmUilRB8dpz23lFcFjm9cQ+kpYH2yJxi4aNC7CIOV9CyfZdyfNhuykM
         1BuWpg/8SuwpO7nWth6ZsvcZ+CRkSKbkj+zxCHWcDcNFu7P6gUmlv5auPV9EVp53wDi9
         OGkf1V57MgcnMRmWH5PlMB4USLaVj6ZqzOvug=
MIME-Version: 1.0
Received: by 10.101.170.11 with SMTP id x11mr2497663ano.103.1255065052895; 
	Thu, 08 Oct 2009 22:10:52 -0700 (PDT)
In-Reply-To: <35bb42690910082132v6819e759n5e686022f0660428@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com>
	 <4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com>
	 <35bb42690910082132v6819e759n5e686022f0660428@mail.gmail.com>
Date: Thu, 8 Oct 2009 22:10:52 -0700
Message-ID: <4b124c310910082210o391066aw96fdafcb830092d8@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org, chris@chriswere.com
Content-Type: multipart/alternative; boundary=001636c92b01a5dbf80475799a57
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c92b01a5dbf80475799a57
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Oct 8, 2009 at 9:32 PM, Chris Were <chris.were@gmail.com> wrote:

> Zoie looks very close to what I'm after, however my whole app is written in
> Python and uses PyLucene, so there is a non-trivial amount of work to make
> things work with Zoie.
>

I've never used PyLucene before, but since it's a wrapper, plugging in zoie
should be doable - instead of accessing the raw Lucene API via PyLucene,
you could instantiate a proj.zoie.impl.indexing.ZoieSystem, then it would
take care of the IndexReader management for you, and you'd just ask it
for IndexReaders and you'd pass it indexing events.

Not sure how JVM interactions are with Python.  Whenever I use other
languages,
I try and turn that paradigm upside down - use Jython and JRuby and Scala,
and live *inside* of the JVM.  Then everything is nice and happy. :)

I'm currently experiencing a bottleneck when optimising my index. How is
> this handled / solved with Zoie?
>

In a realtime environment, optimizing your index isn't always the best thing
to do - optimize down to small number of segments (with the under-used
IndexWriter.optimize(int maxNumSegments) call) if you need to, but
optimizing down to 1 segment means you completely blow away your
OS disk cache, as all of your old files are gone and you have one huge new
ginormous one.  Keeping a balanced set of segments which only a couple
of the big ones merge together occasionally (and the small ones are
continously
being integrated into bigger ones) keeps you only blowing away parts of
the IO cache at a time.

But to answer your question more directly: with Zoie, the disk index is only

refreshed every 15 minutes or so (this is configurable), because you have
a RAMDirectory serving realtime results as well.  Any background segment
merging and optimizing can be done on the disk index during this 15 minute
interval, and typical use cases keep the target number of segments at
a fixed moderately small number (5, 10 segments or so).

The optimize() call takes progressively more time the fewer segments you
have left, and much of the time is in the final 2 to 1 segment merge, so if
you
never do that last step, things go a lot faster - you can try this without
zoie - replace your optimize() calls with optimize(2, or 5, or 10), and see
  a) how long this takes instead, and
  b) what effect on your latency this has (it will cost you something - but
how much: check and see!)

  If you end up trying zoie in PyLucene somehow, please post about it,
we'd love to hear about it used in different sorts of environments.

  -jake

--001636c92b01a5dbf80475799a57--

From java-user-return-42708-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 05:26:47 2009
Return-Path: <java-user-return-42708-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39051 invoked from network); 9 Oct 2009 05:26:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 05:26:46 -0000
Received: (qmail 54891 invoked by uid 500); 9 Oct 2009 05:26:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54817 invoked by uid 500); 9 Oct 2009 05:26:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54807 invoked by uid 99); 9 Oct 2009 05:26:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 05:26:44 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of john.wang@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 05:26:34 +0000
Received: by yxe30 with SMTP id 30so9298909yxe.29
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 22:26:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=UtfxJBP0MnrqCGmU8vD7Wfk268IRaVjc+Bbe6Pj47xI=;
        b=O6pLG+B2Hr5G9ufhdzFUM99T9cCVP+4tsUo70o7/itlhqxYYPbmU5RyFbAEfntQzKN
         u89OPcPDgM0PL143auyA8Ch1J1RBNnCg1xfw9A4E42tf+f6cpjRRZXlDsfO98WMr42sD
         SV2Q12xbBya0eZZZgesZJO7yjWJKFO+stAYM0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=oqctEllmGPluzeXC1vfhPeS+oXnCL6yCRBUOrE080rmAzCT0n2TnmbENKvZLFdIi6b
         MqDYKaSbrRP1XAb3fkeUmxMESczzSB9ogMKK0a5/xRJc3mu0gt5KckqwWYiyj4gzt0y7
         GMQfNFYEAJzqZi1Adam7esDX+81LUyEVytB/U=
MIME-Version: 1.0
Received: by 10.101.95.6 with SMTP id x6mr2452392anl.108.1255065973142; Thu, 
	08 Oct 2009 22:26:13 -0700 (PDT)
In-Reply-To: <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
Date: Thu, 8 Oct 2009 22:26:13 -0700
Message-ID: <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
Subject: Re: Realtime & distributed
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636ed6c417fb785047579d126
X-Virus-Checked: Checked by ClamAV on apache.org

--001636ed6c417fb785047579d126
Content-Type: text/plain; charset=ISO-8859-1

Jason:
        I would really appreciate it if you would stop making false
statements and misinformation. Everyone is entitled to his/her opinions on
technologies, but deliberately making misleading and false information on
such a distribution is just unethical, and you'll end up just discrediting
yourself.

        Making unsubstantiated comments while not willing to put in any
effort is the primary reason you are no longer working at Linkedin and on
Zoie.

"The problem
with this is, merging in the background becomes really tricky
unless it's performed inside of IndexWriter" - *what does this really mean?
Merging happens regardless in an incremental indexing system. Especially
with high indexing load, segments are created often, merging is crucial.*
"There is the Zoie system which uses the RAMDir
solution, however it's implemented using a customized deleted
doc set based on a bloomfilter backed by an inefficient RB tree
which slows down queries"  -* if you ever spend the time to read the code,
(even when you were working on it), it is just not true. We did have an RB
set for deleted docs, quite a few releases ago, and we changed to a special
type of bloomfilter set backed by a hash int set. You knew this and was part
of the discussion on it, and now saying such a thing is just plain
disappointing.*

        Thanks Jake for the clarification, and Eric, let me know if you to
know more in detail with how we are dealing with realtime indexing/search
with Zoie here at linkedin in a production environment powering a real
internet company with real traffic.

-John

On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <jason.rutherglen@gmail.com
> wrote:

> Eric,
>
> Katta doesn't require HDFS which would be slow to search on,
> though Katta can be used to copy indexes out of HDFS onto local
> servers. The best bet is hardware that uses SSDs because merges
> and update latency will greatly decrease and there won't be a
> synchronous IO issue as there is with hard drives. Also, IO
> caches get flushed as large merges occur, which means subsequent
> queries may hit the HD and slow down. With SSDs this is much
> less of an issue.
>
> Today near realtime search (with or without SSDs) comes at a
> price, that is reduced indexing speed due to continued in RAM
> merging. People typically hack something together where indexes
> are held in a RAMDir until being flushed to disk. The problem
> with this is, merging in the background becomes really tricky
> unless it's performed inside of IndexWriter (see LUCENE-1313 and
> IW.getReader). There is the Zoie system which uses the RAMDir
> solution, however it's implemented using a customized deleted
> doc set based on a bloomfilter backed by an inefficient RB tree
> which slows down queries. There's always a trade off when trying
> to build an NRT system, currently.
>
> Also, there isn't a clear way to replicate segments in realtime
> so people usually end up analyzing documents on each replicated
> node, which is redundant. A long term solution here could be a
> distributed transaction log where encoded segments are stored
> and replicated to N nodes.
>
> Deletes can pile up in segments so the
> BalancedSegmentMergePolicy could be used to remove those faster
> than LogMergePolicy, however I haven't tested it, and it may be
> trying to not do large segment merges altogether which IMO
> is less than ideal because query performance soon degrades
> (similar to an unoptimized index).
>
> Hopefully in the future we can offer searching over
> IndexWriter's RAM buffer where indexing and search speed would
> be roughly what it is today. That combined with a way to insure
> segments don't get flushed out of the IO cache during large
> segment merges would mean really efficient NRT, even on systems
> with HDs. In the interim, you'd need to play around and see what
> works for your requirements.
>
> -J
>
> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
> >
> > Does anyone have any recommendations?  I've looked at Katta, but it
> doesn't
> > seem to support realtime searching.  It also uses hdfs, which I've heard
> can
> > be slow.  I'm looking to serve 40gb of indexes and support about 1
> million
> > updates per day.
> >
> > Thx
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636ed6c417fb785047579d126--

From java-user-return-42709-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 06:13:04 2009
Return-Path: <java-user-return-42709-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46569 invoked from network); 9 Oct 2009 06:13:04 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 06:13:04 -0000
Received: (qmail 90576 invoked by uid 500); 9 Oct 2009 06:13:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90495 invoked by uid 500); 9 Oct 2009 06:13:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90485 invoked by uid 99); 9 Oct 2009 06:13:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 06:13:01 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.were@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 06:12:52 +0000
Received: by yxe30 with SMTP id 30so9326934yxe.29
        for <java-user@lucene.apache.org>; Thu, 08 Oct 2009 23:12:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:from:date:message-id:subject:to:cc:content-type;
        bh=vwjwZrQeut5Wv9iC5MBr2ABMOR+FMefeFWX0PIF3xh4=;
        b=ukwfsaRjD3BH/+swLkRgXJpsqkfPuYLUWX+zkZzLJMJiKZ8Af6xLRSxfO7y9TVDXWP
         BT2ELX7Ag1C7yQnoUhuTiyJYECTGnYF+KCxPTBQNI3p/GfiUO+rgZ3jcDOo8gFM+/F4w
         Vdkt3exinWpIm5uoGUugMhmeNN03hd8grod7o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:from:date:message-id
         :subject:to:cc:content-type;
        b=nZ6Bk2JG08ov21SZfFV77U/xS9Tmugf6JoQoOA0cT8nHCjVFrBz1nTpvjyfZtqMp/1
         MGvMbTKriFqclYJD67u3kh5d/sdeWGK8GX8xbs21etqJrLn8kjzCoE/u0HEPS2Yy67qN
         v7+1HxH/Wk0jVmTQJD+aVXcKi7nzZmOhRNEnY=
MIME-Version: 1.0
Received: by 10.101.5.22 with SMTP id h22mr2494465ani.186.1255068751111; Thu, 
	08 Oct 2009 23:12:31 -0700 (PDT)
Reply-To: chris@chriswere.com
In-Reply-To: <4b124c310910082210o391066aw96fdafcb830092d8@mail.gmail.com>
References: <35bb42690910061557t7e87410bt18c0c19263567e14@mail.gmail.com> 
	<4b124c310910061907k2a428311qd14a831097ac16aa@mail.gmail.com> 
	<35bb42690910082132v6819e759n5e686022f0660428@mail.gmail.com> 
	<4b124c310910082210o391066aw96fdafcb830092d8@mail.gmail.com>
From: Chris Were <chris.were@gmail.com>
Date: Fri, 9 Oct 2009 16:42:11 +1030
Message-ID: <35bb42690910082312g7c02949cs3773135edc5d7799@mail.gmail.com>
Subject: Re: How to setup a scalable deployment?
To: Jake Mannix <jake.mannix@gmail.com>
Cc: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502d8241425fd04757a7781
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502d8241425fd04757a7781
Content-Type: text/plain; charset=ISO-8859-1

Hi Jake,
Thanks for the great insight and suggestions.

I will investigate different optimize() levels and see if that helps my
particular use case -- if not I'll be considering the Zoie route and let you
know how I get on.

Cheers,
Chris

On Fri, Oct 9, 2009 at 3:40 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

>
>
> On Thu, Oct 8, 2009 at 9:32 PM, Chris Were <chris.were@gmail.com> wrote:
>
>> Zoie looks very close to what I'm after, however my whole app is written
>> in
>> Python and uses PyLucene, so there is a non-trivial amount of work to make
>> things work with Zoie.
>>
>
> I've never used PyLucene before, but since it's a wrapper, plugging in zoie
>
> should be doable - instead of accessing the raw Lucene API via PyLucene,
> you could instantiate a proj.zoie.impl.indexing.ZoieSystem, then it would
> take care of the IndexReader management for you, and you'd just ask it
> for IndexReaders and you'd pass it indexing events.
>
> Not sure how JVM interactions are with Python.  Whenever I use other
> languages,
> I try and turn that paradigm upside down - use Jython and JRuby and Scala,
> and live *inside* of the JVM.  Then everything is nice and happy. :)
>
> I'm currently experiencing a bottleneck when optimising my index. How is
>> this handled / solved with Zoie?
>>
>
> In a realtime environment, optimizing your index isn't always the best
> thing
> to do - optimize down to small number of segments (with the under-used
> IndexWriter.optimize(int maxNumSegments) call) if you need to, but
> optimizing down to 1 segment means you completely blow away your
> OS disk cache, as all of your old files are gone and you have one huge new
> ginormous one.  Keeping a balanced set of segments which only a couple
> of the big ones merge together occasionally (and the small ones are
> continously
> being integrated into bigger ones) keeps you only blowing away parts of
> the IO cache at a time.
>
> But to answer your question more directly: with Zoie, the disk index is
> only
> refreshed every 15 minutes or so (this is configurable), because you have
> a RAMDirectory serving realtime results as well.  Any background segment
> merging and optimizing can be done on the disk index during this 15 minute
> interval, and typical use cases keep the target number of segments at
> a fixed moderately small number (5, 10 segments or so).
>
> The optimize() call takes progressively more time the fewer segments you
> have left, and much of the time is in the final 2 to 1 segment merge, so if
> you
> never do that last step, things go a lot faster - you can try this without
> zoie - replace your optimize() calls with optimize(2, or 5, or 10), and see
>   a) how long this takes instead, and
>   b) what effect on your latency this has (it will cost you something - but
> how much: check and see!)
>
>   If you end up trying zoie in PyLucene somehow, please post about it,
> we'd love to hear about it used in different sorts of environments.
>
>   -jake
>

--00504502d8241425fd04757a7781--

From java-user-return-42710-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 08:22:16 2009
Return-Path: <java-user-return-42710-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 85527 invoked from network); 9 Oct 2009 08:22:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 08:22:16 -0000
Received: (qmail 34073 invoked by uid 500); 9 Oct 2009 08:22:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33994 invoked by uid 500); 9 Oct 2009 08:22:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33984 invoked by uid 99); 9 Oct 2009 08:22:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:22:13 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:22:02 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MwAjN-0001qa-VQ
	for java-user@lucene.apache.org; Fri, 09 Oct 2009 01:21:41 -0700
Message-ID: <25817293.post@talk.nabble.com>
Date: Fri, 9 Oct 2009 01:21:41 -0700 (PDT)
From: "manish@mailinator.com" <manish@mailinator.com>
To: java-user@lucene.apache.org
Subject: Unable to use jdbc store
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: manish@mailinator.com
X-Virus-Checked: Checked by ClamAV on apache.org


I am using lucene 2.9.0 ,Compass2.2.0. I have configured for jdbc store.In my
oracle db, there are 22000 users in User_ table . I am unable to index 22000
users.It stops at 13000 users. Problem is that table LUCENE_10109(my jdbc
index table) is getting populated with no of records. now I have 277215
records in LUCENE_10109. These records are not getting merged as they do
when store type is file. What i mean is that when store type is file,
merging is properly done & so final size of index on file system is 10 to 15
MB for 22000 users.This is not true with store type jdbc . Records are being
populated in LUCENE_10109 but no merging is done. So at some stage ( in my
case when 13000 users are indexed) there is no space in tablespace USERS
stopping indexing process giving following errors

Exception in thread "Thread-8"
org.apache.lucene.index.MergePolicy$MergeException:
org.apache.lucene.store.jdbc.JdbcStoreException: Failed to execute sql
[insert into LUCENE_0 (name_, value_, size_, lf_, deleted_) values ( ?, ?,
?, current_timestamp, ? )]; nested exception is java.sql.SQLException:
ORA-01691: unable to extend lob segment SCOTT.SYS_LOB0000052243C00002$$ by
1024 in tablespace USERS

	at
org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:271)
Caused by: org.apache.lucene.store.jdbc.JdbcStoreException: Failed to
execute sql [insert into LUCENE_0 (name_, value_, size_, lf_, deleted_)
values ( ?, ?, ?, current_timestamp, ? )]; nested exception is
java.sql.SQLException: ORA-01691: unable to extend lob segment
SCOTT.SYS_LOB0000052243C00002$$ by 1024 in tablespace USERS

	at
org.apache.lucene.store.jdbc.support.JdbcTemplate.executeUpdate(JdbcTemplate.java:163)
	at
org.apache.lucene.store.jdbc.index.AbstractJdbcIndexOutput.close(AbstractJdbcIndexOutput.java:47)
	at
org.apache.lucene.store.jdbc.index.RAMAndFileJdbcIndexOutput.close(RAMAndFileJdbcIndexOutput.java:81)
	at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:76)
	at
org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:330)
	at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:133)
	at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:3273)
	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:2968)
	at
org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:240)
Caused by: java.sql.SQLException: ORA-01691: unable to extend lob segment
SCOTT.SYS_LOB0000052243C00002$$ by 1024 in tablespace USERS

	at
oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:112)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:331)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:288)
	at oracle.jdbc.driver.T4C8Oall.receive(T4C8Oall.java:743)
	at
oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:216)
	at
oracle.jdbc.driver.T4CPreparedStatement.executeForRows(T4CPreparedStatement.java:955)
	at
oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1168)
	at
oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:3285)
	at
oracle.jdbc.driver.OraclePreparedStatement.executeUpdate(OraclePreparedStatement.java:3368)
	at
com.mchange.v2.c3p0.impl.NewProxyPreparedStatement.executeUpdate(NewProxyPreparedStatement.java:105)
	at
org.apache.lucene.store.jdbc.support.JdbcTemplate.executeUpdate(JdbcTemplate.java:159)
	... 8 more
09:32:27,600 INFO  [[/tunnel-web]:649] Initializing Spring FrameworkServlet
'Spring Servlet'
Exception in thread "Thread-9"
org.apache.lucene.index.MergePolicy$MergeException:
org.apache.lucene.store.jdbc.JdbcStoreException: Failed to execute sql
[insert into LUCENE_0 (name_, value_, size_, lf_, deleted_) values ( ?, ?,
?, current_timestamp, ? )]; nested exception is java.sql.SQLException:
ORA-01691: unable to extend lob segment SCOTT.SYS_LOB0000052243C00002$$ by
1024 in tablespace USERS

	at
org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:271)
Caused by: org.apache.lucene.store.jdbc.JdbcStoreException: Failed to
execute sql [insert into LUCENE_0 (name_, value_, size_, lf_, deleted_)
values ( ?, ?, ?, current_timestamp, ? )]; nested exception is
java.sql.SQLException: ORA-01691: unable to extend lob segment
SCOTT.SYS_LOB0000052243C00002$$ by 1024 in tablespace USERS

	at
org.apache.lucene.store.jdbc.support.JdbcTemplate.executeUpdate(JdbcTemplate.java:163)
	at
org.apache.lucene.store.jdbc.index.AbstractJdbcIndexOutput.close(AbstractJdbcIndexOutput.java:47)
	at
org.apache.lucene.store.jdbc.index.RAMAndFileJdbcIndexOutput.close(RAMAndFileJdbcIndexOutput.java:81)
	at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:76)
	at
org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:330)
	at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:133)
	at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:3273)
	at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:2968)
	at
org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:240)
Caused by: java.sql.SQLException: ORA-01691: unable to extend lob segment
SCOTT.SYS_LOB0000052243C00002$$ by 1024 in tablespace USERS

	at
oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:112)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:331)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:288)
	at oracle.jdbc.driver.T4C8Oall.receive(T4C8Oall.java:743)
	at
oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:216)
	at
oracle.jdbc.driver.T4CPreparedStatement.executeForRows(T4CPreparedStatement.java:955)
	at
oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1168)
	at
oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:3285)
	at
oracle.jdbc.driver.OraclePreparedStatement.executeUpdate(OraclePreparedStatement.java:3368)
	at
com.mchange.v2.c3p0.impl.NewProxyPreparedStatement.executeUpdate(NewProxyPreparedStatement.java:105)
	at
org.apache.lucene.store.jdbc.support.JdbcTemplate.executeUpdate(JdbcTemplate.java:159)
	... 8 more

I have set MergeFactor=10;

Thanks ..
Any help is highly appreciated

-- 
View this message in context: http://www.nabble.com/Unable-to-use-jdbc-store-tp25817293p25817293.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42711-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 08:38:16 2009
Return-Path: <java-user-return-42711-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92974 invoked from network); 9 Oct 2009 08:38:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 08:38:16 -0000
Received: (qmail 80270 invoked by uid 500); 9 Oct 2009 08:38:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80185 invoked by uid 500); 9 Oct 2009 08:38:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80175 invoked by uid 99); 9 Oct 2009 08:38:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:38:13 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [217.237.170.35] (HELO mzex01.healy-hudson.com) (217.237.170.35)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:38:04 +0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.3790.4325
Content-Class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Subject: AW: Reverse stemmer?
Date: Fri, 9 Oct 2009 10:37:40 +0200
Message-ID: <D7206503EB5BE94497458AF4FE4AE8AB015FDA85@owamz.healy-hudson.com>
In-Reply-To: <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Reverse stemmer?
thread-index: AcpITX4qS6ZMQ7JiRmSWxjLTJMzpkgAayfgw
References: <D85D581A-7DB3-4AD6-BA78-CA45B7324735@leangen.net> <20091008153241.36f300a5@pc-4176.kl.dfki.de> <85d3c3b60910081220w3ce7d773tccf5a9fa111a0279@mail.gmail.com>
From: "Uwe Goetzke" <uwe.goetzke@healy-hudson.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

We use a statistical approach. So we have little language dependent =
context in our search.=20
A simplified description:
Our data gets indexed with a "normal" analyzer in a data index.
In a second step we index all terms of defined search fields with a =
different analyzer which uses bigrams on the character level in a =
separate terms index.=20
If the user searches a phrase we expand each term of the phrase with the =
matching terms of the terms index and uses this to search in the data =
index. The matching terms are found by matching bigrams with a certain =
degree of tolerance.

So if we have the following data indexed:
aabcc
bbca
abbc
aacc
abcbbca

and the user searches for bbc we would search for=20
(term with boost factor)
abbc^4
bbca^3
abcbbca^2
aabcc^1 (matched based on a tolerance factor)
The interesting stuff is how to boost this expanded terms to get a =
understandable ordering of the search results regarding to the phrase =
entered by the user.

Regards

Uwe Goetzke
Healy Hudson

-----Urspr=FCngliche Nachricht-----
Von: Jason Rutherglen [mailto:jason.rutherglen@gmail.com]=20
Gesendet: Donnerstag, 8. Oktober 2009 21:20
An: java-user@lucene.apache.org
Betreff: Re: Reverse stemmer?

Out of curiousity and perhaps for practical purposes, how does one
handle mixed language documents?  I suppose one could extract the
words of a particular language and place it in a lang specific field?
Are there libraries to perform this (yet)?

On Thu, Oct 8, 2009 at 6:32 AM, Christian Reuschling
<christian.reuschling@gmail.com> wrote:
> Hi,
>
> looking up the different terms with a common stem can be useful in =
different
> scenarios - so I don't want to judge it whether someone needs it or =
not.
>
> E.g., in the case you have multilingual documents in your index, it is =
straight
> forward to determine the language of the documents in order to choose =
the right
> stemmer. At least this is right for document with homogenous language.
>
> Althought this is true at indexing time, the language classification =
for the
> user query is not such trivial - and you have to do this in order to =
stem the
> query terms for searching. One possibility would be to search for the =
stems
> given from all stemmers - but in this case you will receive many wrong
> searching terms, thus much noise in the result lists.
>
> Another possibility can be to offer all 'potential synonyms' of the =
query terms
> to the user - where he can choose whether these are right or not. In =
this case
> you need exactly the lookup 'queryTerm->stem->terms with same stem'. =
This can
> be much more precise, the lacks are of course the interaction needed =
by the
> user and longer queries.
>
> To realize this, someone could write a specific Analyzer that stores =
this
> relationship additionally e.g. into a database. I personaly don't know =
any
> possibility to read this directly out of the Lucene index.
>
>
> In the case someone has best practices or an idea how processing =
multilingual
> indices can be done better, I would be appreciated to read / hear =
about this.
>
>
>
> all best
>
> Chris
>
>
> On Tue, 6 Oct 2009 16:31:36 +0900
> David Leangen <apache@leangen.net> wrote:
>
>>
>> Hello,
>>
>> I've been using Lucene in a very basic way for some time now, and I'm
>> starting to take advantage of some of the linguistic capabilities =
only
>> now.
>>
>> I am making use of the snowball analyzer for stemming, and it works
>> very well.
>>
>>
>> Question: is there any such thing as a "reverse stemmer"? In other
>> words, given the stem of a word, is there any algorithm to find the
>> original word? Or is this just fantasy? ;-)
>>
>> Now, I understand that there is a 1:n mapping of stems:words. I can
>> deal with that.
>>
>>
>> Thanks!
>> =3DDavid
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


-----------------------------------------------------------------------
Healy Hudson GmbH - D-55252 Mainz Kastel
Gesch=E4ftsf=FChrer Christian Konh=E4user - Amtsgericht Wiesbaden HRB =
12076

Diese Email ist vertraulich. Wenn Sie nicht der beabsichtigte =
Empf=E4nger sind, d=FCrfen Sie die Informationen nicht offen legen oder =
benutzen. Wenn Sie diese Email durch einen Fehler bekommen haben, teilen =
Sie uns dies bitte umgehend mit, indem Sie diese Email an den Absender =
zur=FCckschicken. Bitte l=F6schen Sie danach diese Email.
This email is confidential. If you are not the intended recipient, you =
must not disclose or use this information contained in it. If you have =
received this email in error please tell us immediately by return email =
and delete the document.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42712-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 08:49:03 2009
Return-Path: <java-user-return-42712-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97577 invoked from network); 9 Oct 2009 08:49:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 08:49:03 -0000
Received: (qmail 94946 invoked by uid 500); 9 Oct 2009 08:49:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94862 invoked by uid 500); 9 Oct 2009 08:49:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94851 invoked by uid 99); 9 Oct 2009 08:49:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:49:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.75.55.147] (HELO live.stimulussoft.com) (216.75.55.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:48:49 +0000
Received: (qmail 26989 invoked by uid 511); 9 Oct 2009 01:48:26 -0700
Received: from 196.210.225.74 by live.stimulussoft.com (envelope-from <jamie@stimulussoft.com>, uid 509) with qmail-scanner-1.25-st-qms 
 (clamdscan: 0.88.7/7149. spamassassin: 3.2.3. perlscan: 1.25-st-qms.  
 Clear:RC:0(196.210.225.74):SA:0(0.6/5.0):. 
 Processed in 9.769155 secs); 09 Oct 2009 08:48:26 -0000
X-Antivirus-MYDOMAIN-Mail-From: jamie@stimulussoft.com via live.stimulussoft.com
X-Antivirus-MYDOMAIN: 1.25-st-qms (Clear:RC:0(196.210.225.74):SA:0(0.6/5.0):. Processed in 9.769155 secs Process 26978)
Received: from unknown (HELO ?192.168.0.14?) (jamie@stimulussoft.com@196.210.225.74)
  by live.stimulussoft.com with AES256-SHA encrypted SMTP; 9 Oct 2009 01:48:16 -0700
Message-ID: <4ACEF8B9.2030202@stimulussoft.com>
Date: Fri, 09 Oct 2009 10:47:53 +0200
From: Jamie Band <jamie@stimulussoft.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Index.close() infinite TIME_WAITING
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, hits=0.6 required=5.0

Hi Michael

Thanks for your help. Here are the stacks:

index processor [TIME_WAITING] CPU time: 33:01
java.lang.Object.wait(long)
org.apache.lucene.index.IndexWriter.doWait()
org.apache.lucene.index.IndexWriter.shouldClose()
org.apache.lucene.index.IndexWriter.close(boolean)
org.apache.lucene.index.IndexWriter.close()
com.stimulus.archiva.index.VolumeIndex.closeIndex()
com.stimulus.archiva.index.VolumeIndex$IndexProcessor.run()

The source code to our indexer is attached. As you can see, documents 
are added to a blocking queue. The index processor thread takes it out 
of the queue and processes it. After about 60k documents IndexWriter's 
close method enters TIME_WAITING indefinitely. It there any workaround 
to this problem?


package com.stimulus.archiva.index;

import java.io.File;
import java.io.IOException;
import java.io.PrintStream;
import javax.mail.MessagingException;
import org.apache.commons.logging.*;
import org.apache.lucene.document.Document;
import org.apache.lucene.index.*;
import org.apache.lucene.store.FSDirectory;
import com.stimulus.archiva.domain.Config;
import com.stimulus.archiva.domain.Email;
import com.stimulus.archiva.domain.EmailID;
import com.stimulus.archiva.domain.Indexer;
import com.stimulus.archiva.domain.Volume;
import com.stimulus.archiva.exception.*;
import com.stimulus.archiva.language.AnalyzerFactory;
import com.stimulus.archiva.search.*;
import java.util.*;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.ScheduledFuture;
import java.util.concurrent.TimeUnit;
import org.apache.lucene.store.LockObtainFailedException;
import org.apache.lucene.store.AlreadyClosedException;
import java.util.concurrent.locks.ReentrantLock;
import java.util.concurrent.*;

public class VolumeIndex extends Thread {
   
         protected ArrayBlockingQueue<IndexInfo> queue;
         protected static final Log logger = 
LogFactory.getLog(VolumeIndex.class.getName());
            IndexWriter writer = null;
            Volume volume;
            protected static ScheduledExecutorService scheduler;
         protected static ScheduledFuture<?> scheduledTask;
         protected static IndexInfo EXIT_REQ = new IndexInfo(null);
         ReentrantLock indexLock = new ReentrantLock();
         ArchivaAnalyzer analyzer     = new ArchivaAnalyzer();
         Indexer indexer = null;
         File indexLogFile;
         PrintStream indexLogOut;
         IndexProcessor indexProcessor;
       
         
            public VolumeIndex(Indexer indexer, Volume volume) {
                logger.debug("creating new volume index {"+volume+"}");
                this.volume = volume;
                this.indexer = indexer;
                this.queue = new 
ArrayBlockingQueue<IndexInfo>(Config.getConfig().getIndex().getIndexBacklog());
             
                try {
                    indexLogFile = getIndexLogFile(volume);
                    if (indexLogFile!=null) {
                        if (indexLogFile.length()>10485760)
                            indexLogFile.delete();
                        indexLogOut = new PrintStream(indexLogFile);
                    }
                    logger.debug("set index log file path 
{path='"+indexLogFile.getCanonicalPath()+"'}");
                } catch (Exception e) {
                    logger.error("failed to open index log 
file:"+e.getMessage(),e);
                }
                startup();
            }
       
          protected File getIndexLogFile(Volume volume) {
               try {
                    String indexpath = volume.getIndexPath();
                    int lio = indexpath.lastIndexOf(File.separator)+1;
                    String logfilepath = 
indexpath.substring(lio,indexpath.length()-1);
                    logfilepath += ".log";
                    logfilepath = "index_"+logfilepath;
                    logfilepath = 
Config.getFileSystem().getLogPath()+File.separator+logfilepath;
                    return new File(logfilepath);
                } catch (Exception e) {
                    logger.error("failed to open index log 
file:"+e.getMessage(),e);
                    return null;
                }
          }
         
         public void deleteMessages(List<String> ids) throws 
MessageSearchException {
              if (ids == null)
                    throw new MessageSearchException("assertion failure: 
null ids",logger);
             
              Term[] terms = new Term[ids.size()];
              int c = 0;
              StringBuffer deleteInfo = new StringBuffer();
              for (String id : ids) {
                  terms[c++] = new Term("uid",id);
                  deleteInfo.append(id);
                  deleteInfo.append(",");
              }
             
              String deleteStr = deleteInfo.toString();
              if (deleteStr.length()>0 && 
deleteStr.charAt(deleteStr.length()-1)==',')
                  deleteStr = deleteStr.substring(0,deleteStr.length()-1);
             
              logger.debug("delete messages {'"+deleteInfo+"'}");
              try {
                  indexLock.lock();
                  openIndex();
                  try {
                      writer.deleteDocuments(terms);
                      writer.expungeDeletes();
                  } catch (Exception e) {
                      throw new MessageSearchException("failed to delete 
email from index.",e,logger);
                  } finally {
                     
                  }
              } finally {
                  closeIndex();
                  indexLock.unlock();
              }
        }
       
          protected void openIndex() throws MessageSearchException {
             Exception lastError = null;
           
            if (writer==null) {
                logger.debug("openIndex() index will be opened. it is 
currently closed.");
            } else {
                logger.debug("openIndex() did not bother opening index. 
it is already open.");
                return;
            }
            logger.debug("opening index for write {"+volume+"}");
            indexer.prepareIndex(volume);
            logger.debug("opening search index for write 
{indexpath='"+volume.getIndexPath()+"'}");
            boolean writelock;
            int attempt = 0;
            int maxattempt = 10;
           
            if (Config.getConfig().getIndex().getMultipleIndexProcesses()) {
                maxattempt = 10000;
             } else {
                maxattempt = 10;
             }
           
            do {
                writelock = false;
                try {
                        FSDirectory fsDirectory = 
FSDirectory.getDirectory(volume.getIndexPath());
                        int maxIndexChars = 
Config.getConfig().getIndex().getMaxIndexPerFieldChars();
                        writer = new 
IndexWriter(fsDirectory,analyzer,new 
IndexWriter.MaxFieldLength(maxIndexChars));
                        if (logger.isDebugEnabled() && indexLogOut!=null) {
                            writer.setInfoStream(indexLogOut);
                        }
                } catch (LockObtainFailedException lobfe) {
                        logger.debug("write lock on index. will reopen 
in 50ms.");
                        try { Thread.sleep(50); } catch (Exception e) {}
                        attempt++;
                        writelock = true;
                } catch (CorruptIndexException cie) {
                    throw new MessageSearchException("index appears to 
be corrupt. please reindex the active volume."+cie.getMessage(),logger);
                } catch (IOException io) {
                    throw new MessageSearchException("failed to write 
document to index:"+io.getMessage(),logger);
                }
           } while (writelock && attempt<maxattempt);
           if (attempt>=10000)
             throw new MessageSearchException("failed to open index 
writer {location='"+volume.getIndexPath()+"'}",lastError,logger);
        }
       
        public void indexMessage(Email message) throws 
MessageSearchException  {
            logger.debug("index message {"+message+"}");
            long s = (new Date()).getTime();
            if (message == null)
                throw new MessageSearchException("assertion failure: 
null message",logger);
            Document doc = new Document();
            IndexInfo indexInfo = new IndexInfo(doc);
            try {
               DocumentIndex docIndex = new DocumentIndex(indexer);
               String language = doc.get("lang");
               if (language==null)
                   language = indexer.getIndexLanguage();
               docIndex.write(message,doc,indexInfo);
               queue.put(indexInfo);
               logger.debug("message indexed successfully 
{"+message+",language='"+language+"'}");
            } catch (MessagingException me) {
               throw new MessageSearchException("failed to decode 
message during indexing",me,logger, ChainedException.Level.DEBUG);
            } catch (IOException me) {
                throw new MessageSearchException("failed to index 
message"+me.getMessage()+" {"+message+"}",me,logger, 
ChainedException.Level.DEBUG);
            } catch (ExtractionException ee)
            {
                // we will want to continue indexing
               //throw new MessageSearchException("failed to decode 
attachments in message {"+message+"}",ee,logger, 
ChainedException.Level.DEBUG);
            } catch (AlreadyClosedException ace) {
                indexMessage(message);
            } catch (Throwable e) {
                throw new MessageSearchException("failed to index 
message:"+e.getMessage(),e,logger, ChainedException.Level.DEBUG);
            }
            logger.debug("indexing message end {"+message+"}");
            long e = (new Date()).getTime();
            logger.debug("indexing time {time='"+(e-s)+"'}");
        }
   
        public class IndexProcessor extends Thread {
           
            public IndexProcessor() {
                setName("index processor");
            }
     
            public void run() {
                boolean exit = false;
                //ExecutorService documentPool;
                // we abandoned pool as it does not seem to offer any 
major performance benefit
                IndexInfo indexInfo = null;   
                LinkedList<IndexInfo> pushbacks = new 
LinkedList<IndexInfo>();
               
                while (!exit) {
                   
                    try {
                        int maxIndexDocs = 
Config.getConfig().getIndex().getMaxSimultaneousDocs();
                        //documentPool = 
Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchiveThreads());
                        indexInfo = null;   
                        indexInfo = (IndexInfo) queue.take();
                        if (indexInfo==EXIT_REQ) {
                            logger.debug("index exit req received. 
exiting");
                            exit = true;
                            continue;
                        }
                   
                        indexLock.lock();
                        try {
                             openIndex();
                        } catch (Exception e) {
                             logger.error("failed to open 
index:"+e.getMessage(),e);
                             return;
                        }
                        if (indexInfo==null) {
                            logger.debug("index info is null");
                        }
                        int i = 0;
                        while(indexInfo!=null && i<maxIndexDocs) {
                            try {
                                writer.addDocument(indexInfo.getDocument());
                            } catch (IOException io) {
                                logger.error("failed to add document to 
index:"+io.getMessage(),io);
                            } catch (AlreadyClosedException e) {
                                pushbacks.add(indexInfo);
                            } finally {
                                indexInfo.cleanup();
                            }
                           
                              //documentPool.execute(new 
IndexDocument(indexInfo,pushbacks));
                           
                             i++;
                             
                             if (i<maxIndexDocs) {
                                 indexInfo = (IndexInfo) queue.poll();
                                 
                                 if (indexInfo==null) {
                                        logger.debug("index info is null");
                                 }
                                 
                                 if (indexInfo==EXIT_REQ) {
                                         logger.debug("index exit req 
received. exiting (2)");
                                        exit = true;
                                        break;
                                  }
                             }
                             
                        }
                       
                        for (IndexInfo pushback : pushbacks) {
                            try {
                                writer.addDocument(pushback.getDocument());
                            } catch (IOException io) {
                                logger.error("failed to add document to 
index:"+io.getMessage(),io);
                            } catch (AlreadyClosedException e) {
                                pushbacks.add(indexInfo);
                            } finally {
                                indexInfo.cleanup();
                            }
                            //documentPool.execute(new 
IndexDocument(pushback,pushbacks));
                            i++;
                        }
                        //documentPool.shutdown();
                        
//documentPool.awaitTermination(30,TimeUnit.MINUTES);
                       
                     } catch (Throwable ie) {
                         logger.error("index write 
interrupted:"+ie.getMessage());
                     } finally {
                           closeIndex();
                          indexLock.unlock();
                    }
                }   
               }
           
            public class IndexDocument extends Thread {
               
                    IndexInfo indexInfo = null;
                    List<IndexInfo> pushbacks = null;
                   
                    public IndexDocument(IndexInfo 
indexInfo,List<IndexInfo> pushbacks) {
                        this.indexInfo = indexInfo;
                        this.pushbacks = pushbacks;
                        setName("index document");
                    }
               
                    public void run() {
                        try {
                            writer.addDocument(indexInfo.getDocument());
                        } catch (IOException io) {
                            logger.error("failed to add document to 
index:"+io.getMessage(),io);
                        } catch (AlreadyClosedException e) {
                            pushbacks.add(indexInfo);
                        }
                    }};
            }
     
        protected void closeIndex() {
             try {
                     if (writer!=null) {
                        writer.close();
                        logger.debug("writer closed");
                        writer = null;
                     }
                 } catch (Exception io) {
                    logger.error("failed to close index 
writer:"+io.getMessage(),io);
                 }
        }
   
          public void deleteIndex() throws MessageSearchException {
                   logger.debug("delete index 
{indexpath='"+volume.getIndexPath()+"'}");
                   try {
                      indexLock.lock();
                     try {
                        int maxIndexChars = 
Config.getConfig().getIndex().getMaxIndexPerFieldChars();
                        writer = new 
IndexWriter(FSDirectory.getDirectory(volume.getIndexPath()),analyzer,true,new 
IndexWriter.MaxFieldLength(maxIndexChars));
                     } catch (Exception cie) {
                         logger.error("failed to delete index 
{index='"+volume.getIndexPath()+"'}",cie);
                         return;
                     }
                     MessageIndex.volumeIndexes.remove(this);
                  } finally {
                        closeIndex();
                      indexLock.unlock();
                }
          }
       
          public void startup() {
            logger.debug("volumeindex is starting up");
            File lockFile = new 
File(volume.getIndexPath()+File.separatorChar + "write.lock");
            if (lockFile.exists()) {
                logger.warn("The server lock file already exists. Either 
another indexer is running or the server was not shutdown correctly.");
                logger.warn("If it is the latter, the lock file must be 
manually deleted at "+lockFile.getAbsolutePath());
                if (indexer.getMultipleIndexProcesses()) {
                    logger.debug("index lock file detected on 
volumeindex startup.");
                } else {
                    logger.warn("index lock file detected. the server 
was shutdown incorrectly. automatically deleting lock file.");
                    logger.warn("indexer is configured to deal with only 
one indexer process.");
                    logger.warn("if you are running more than one 
indexer, your index could be subject to corruption.");
                    lockFile.delete();
                }
            }
            indexProcessor = new IndexProcessor();
            indexProcessor.start();
            Runtime.getRuntime().addShutdownHook(this);
           
          }
         
         
         
          public void shutdown() {
              logger.debug("volumeindex is shutting down");
              queue.add(EXIT_REQ);
              scheduler.shutdownNow();
            
          }
         
          @Override
          public void run() {
              queue.add(EXIT_REQ);
          }
         
     
}

   



Is it possible a large merge is running?  By default IW.close waits
for outstanding merges to complete.  Can you post the stacktrace?

Mike

On Thu, Oct 8, 2009 at 5:22 PM, Jamie Band <jamie@stimulussoft.com> wrote:
> Hi All
>
> I have a long running situation where our indexing thread is getting stuck
> indefinitely in IndexWriter's close method. Yourkit shows the thread to be
> stuck in TIME_WAITING. Any idea's on what could be causing this?
> Could it be one of the streams or readers we passed to the document?
>
> I am running Lucene 2.9.0.
>
> Many thanks in advance
>
> Jamie
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42713-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 08:54:40 2009
Return-Path: <java-user-return-42713-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 99375 invoked from network); 9 Oct 2009 08:54:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 08:54:40 -0000
Received: (qmail 6250 invoked by uid 500); 9 Oct 2009 08:54:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6199 invoked by uid 500); 9 Oct 2009 08:54:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6189 invoked by uid 99); 9 Oct 2009 08:54:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:54:38 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.75.55.147] (HELO live.stimulussoft.com) (216.75.55.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 08:54:25 +0000
Received: (qmail 27126 invoked by uid 511); 9 Oct 2009 01:54:02 -0700
Received: from 196.210.225.74 by live.stimulussoft.com (envelope-from <jamie@stimulussoft.com>, uid 509) with qmail-scanner-1.25-st-qms 
 (clamdscan: 0.88.7/7149. spamassassin: 3.2.3. perlscan: 1.25-st-qms.  
 Clear:RC:0(196.210.225.74):SA:0(-0.6/5.0):. 
 Processed in 16.880446 secs); 09 Oct 2009 08:54:02 -0000
X-Antivirus-MYDOMAIN-Mail-From: jamie@stimulussoft.com via live.stimulussoft.com
X-Antivirus-MYDOMAIN: 1.25-st-qms (Clear:RC:0(196.210.225.74):SA:0(-0.6/5.0):. Processed in 16.880446 secs Process 27085)
Received: from unknown (HELO ?192.168.0.14?) (jamie@stimulussoft.com@196.210.225.74)
  by live.stimulussoft.com with AES256-SHA encrypted SMTP; 9 Oct 2009 01:53:45 -0700
Message-ID: <4ACEFA01.4050507@stimulussoft.com>
Date: Fri, 09 Oct 2009 10:53:21 +0200
From: Jamie Band <jamie@stimulussoft.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Index.close() infinite TIME_WAITING
References: <4ACEF8B9.2030202@stimulussoft.com>
In-Reply-To: <4ACEF8B9.2030202@stimulussoft.com>
Content-Type: multipart/mixed;
 boundary="------------070603030500060905060502"
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, hits=-0.6 required=5.0

--------------070603030500060905060502
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Incidentally, there are no Lucene merge threads doing any work. See 
attached.


>



--------------070603030500060905060502
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--------------070603030500060905060502--

From java-user-return-42714-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 09:05:24 2009
Return-Path: <java-user-return-42714-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3500 invoked from network); 9 Oct 2009 09:05:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 09:05:23 -0000
Received: (qmail 28748 invoked by uid 500); 9 Oct 2009 09:05:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28707 invoked by uid 500); 9 Oct 2009 09:05:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28697 invoked by uid 99); 9 Oct 2009 09:05:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 09:05:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.75.55.147] (HELO live.stimulussoft.com) (216.75.55.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 09:05:09 +0000
Received: (qmail 27350 invoked by uid 511); 9 Oct 2009 02:04:47 -0700
Received: from 196.210.225.74 by live.stimulussoft.com (envelope-from <jamie@stimulussoft.com>, uid 509) with qmail-scanner-1.25-st-qms 
 (clamdscan: 0.88.7/7149. spamassassin: 3.2.3. perlscan: 1.25-st-qms.  
 Clear:RC:0(196.210.225.74):SA:0(0.5/5.0):. 
 Processed in 11.044836 secs); 09 Oct 2009 09:04:47 -0000
X-Antivirus-MYDOMAIN-Mail-From: jamie@stimulussoft.com via live.stimulussoft.com
X-Antivirus-MYDOMAIN: 1.25-st-qms (Clear:RC:0(196.210.225.74):SA:0(0.5/5.0):. Processed in 11.044836 secs Process 27337)
Received: from unknown (HELO ?192.168.0.14?) (jamie@stimulussoft.com@196.210.225.74)
  by live.stimulussoft.com with AES256-SHA encrypted SMTP; 9 Oct 2009 02:04:36 -0700
Message-ID: <4ACEFC8C.7010209@stimulussoft.com>
Date: Fri, 09 Oct 2009 11:04:12 +0200
From: Jamie Band <jamie@stimulussoft.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Index.close() infinite TIME_WAITING (repost)
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, hits=0.5 required=5.0

HI Michael / Uwe / others

Sorry for the repost... it just does not look like the earlier message I 
sent go through.
FYI: there are no large Lucene merges taking place.

Jamie Band wrote:
> Hi Michael
>
> Thanks for your help. Here are the stacks:
>
> index processor [TIME_WAITING] CPU time: 33:01
> java.lang.Object.wait(long)
> org.apache.lucene.index.IndexWriter.doWait()
> org.apache.lucene.index.IndexWriter.shouldClose()
> org.apache.lucene.index.IndexWriter.close(boolean)
> org.apache.lucene.index.IndexWriter.close()
> com.stimulus.archiva.index.VolumeIndex.closeIndex()
> com.stimulus.archiva.index.VolumeIndex$IndexProcessor.run()
>
> The source code to our indexer is attached. As you can see, documents 
> are added to a blocking queue. The index processor thread takes it out 
> of the queue and processes it. After about 60k documents IndexWriter's 
> close method enters TIME_WAITING indefinitely. It there any workaround 
> to this problem?
>
>
> package com.stimulus.archiva.index;
>
> import java.io.File;
> import java.io.IOException;
> import java.io.PrintStream;
> import javax.mail.MessagingException;
> import org.apache.commons.logging.*;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.index.*;
> import org.apache.lucene.store.FSDirectory;
> import com.stimulus.archiva.domain.Config;
> import com.stimulus.archiva.domain.Email;
> import com.stimulus.archiva.domain.EmailID;
> import com.stimulus.archiva.domain.Indexer;
> import com.stimulus.archiva.domain.Volume;
> import com.stimulus.archiva.exception.*;
> import com.stimulus.archiva.language.AnalyzerFactory;
> import com.stimulus.archiva.search.*;
> import java.util.*;
> import java.util.concurrent.ExecutorService;
> import java.util.concurrent.Executors;
> import java.util.concurrent.ScheduledExecutorService;
> import java.util.concurrent.ScheduledFuture;
> import java.util.concurrent.TimeUnit;
> import org.apache.lucene.store.LockObtainFailedException;
> import org.apache.lucene.store.AlreadyClosedException;
> import java.util.concurrent.locks.ReentrantLock;
> import java.util.concurrent.*;
>
> public class VolumeIndex extends Thread {
>           protected ArrayBlockingQueue<IndexInfo> queue;
>         protected static final Log logger = 
> LogFactory.getLog(VolumeIndex.class.getName());
>            IndexWriter writer = null;
>            Volume volume;
>            protected static ScheduledExecutorService scheduler;
>         protected static ScheduledFuture<?> scheduledTask;
>         protected static IndexInfo EXIT_REQ = new IndexInfo(null);
>         ReentrantLock indexLock = new ReentrantLock();
>         ArchivaAnalyzer analyzer     = new ArchivaAnalyzer();
>         Indexer indexer = null;
>         File indexLogFile;
>         PrintStream indexLogOut;
>         IndexProcessor indexProcessor;
>                          public VolumeIndex(Indexer indexer, Volume 
> volume) {
>                logger.debug("creating new volume index {"+volume+"}");
>                this.volume = volume;
>                this.indexer = indexer;
>                this.queue = new 
> ArrayBlockingQueue<IndexInfo>(Config.getConfig().getIndex().getIndexBacklog()); 
>
>                            try {
>                    indexLogFile = getIndexLogFile(volume);
>                    if (indexLogFile!=null) {
>                        if (indexLogFile.length()>10485760)
>                            indexLogFile.delete();
>                        indexLogOut = new PrintStream(indexLogFile);
>                    }
>                    logger.debug("set index log file path 
> {path='"+indexLogFile.getCanonicalPath()+"'}");
>                } catch (Exception e) {
>                    logger.error("failed to open index log 
> file:"+e.getMessage(),e);
>                }
>                startup();
>            }
>                protected File getIndexLogFile(Volume volume) {
>               try {
>                    String indexpath = volume.getIndexPath();
>                    int lio = indexpath.lastIndexOf(File.separator)+1;
>                    String logfilepath = 
> indexpath.substring(lio,indexpath.length()-1);
>                    logfilepath += ".log";
>                    logfilepath = "index_"+logfilepath;
>                    logfilepath = 
> Config.getFileSystem().getLogPath()+File.separator+logfilepath;
>                    return new File(logfilepath);
>                } catch (Exception e) {
>                    logger.error("failed to open index log 
> file:"+e.getMessage(),e);
>                    return null;
>                }
>          }
>                 public void deleteMessages(List<String> ids) throws 
> MessageSearchException {
>              if (ids == null)
>                    throw new MessageSearchException("assertion 
> failure: null ids",logger);
>                          Term[] terms = new Term[ids.size()];
>              int c = 0;
>              StringBuffer deleteInfo = new StringBuffer();
>              for (String id : ids) {
>                  terms[c++] = new Term("uid",id);
>                  deleteInfo.append(id);
>                  deleteInfo.append(",");
>              }
>                          String deleteStr = deleteInfo.toString();
>              if (deleteStr.length()>0 && 
> deleteStr.charAt(deleteStr.length()-1)==',')
>                  deleteStr = deleteStr.substring(0,deleteStr.length()-1);
>                          logger.debug("delete messages 
> {'"+deleteInfo+"'}");
>              try {
>                  indexLock.lock();
>                  openIndex();
>                  try {
>                      writer.deleteDocuments(terms);
>                      writer.expungeDeletes();
>                  } catch (Exception e) {
>                      throw new MessageSearchException("failed to 
> delete email from index.",e,logger);
>                  } finally {
>                                      }
>              } finally {
>                  closeIndex();
>                  indexLock.unlock();
>              }
>        }
>                protected void openIndex() throws MessageSearchException {
>             Exception lastError = null;
>                      if (writer==null) {
>                logger.debug("openIndex() index will be opened. it is 
> currently closed.");
>            } else {
>                logger.debug("openIndex() did not bother opening index. 
> it is already open.");
>                return;
>            }
>            logger.debug("opening index for write {"+volume+"}");
>            indexer.prepareIndex(volume);
>            logger.debug("opening search index for write 
> {indexpath='"+volume.getIndexPath()+"'}");
>            boolean writelock;
>            int attempt = 0;
>            int maxattempt = 10;
>                      if 
> (Config.getConfig().getIndex().getMultipleIndexProcesses()) {
>                maxattempt = 10000;
>             } else {
>                maxattempt = 10;
>             }
>                      do {
>                writelock = false;
>                try {
>                        FSDirectory fsDirectory = 
> FSDirectory.getDirectory(volume.getIndexPath());
>                        int maxIndexChars = 
> Config.getConfig().getIndex().getMaxIndexPerFieldChars();
>                        writer = new 
> IndexWriter(fsDirectory,analyzer,new 
> IndexWriter.MaxFieldLength(maxIndexChars));
>                        if (logger.isDebugEnabled() && 
> indexLogOut!=null) {
>                            writer.setInfoStream(indexLogOut);
>                        }
>                } catch (LockObtainFailedException lobfe) {
>                        logger.debug("write lock on index. will reopen 
> in 50ms.");
>                        try { Thread.sleep(50); } catch (Exception e) {}
>                        attempt++;
>                        writelock = true;
>                } catch (CorruptIndexException cie) {
>                    throw new MessageSearchException("index appears to 
> be corrupt. please reindex the active volume."+cie.getMessage(),logger);
>                } catch (IOException io) {
>                    throw new MessageSearchException("failed to write 
> document to index:"+io.getMessage(),logger);
>                }
>           } while (writelock && attempt<maxattempt);
>           if (attempt>=10000)
>             throw new MessageSearchException("failed to open index 
> writer {location='"+volume.getIndexPath()+"'}",lastError,logger);
>        }
>              public void indexMessage(Email message) throws 
> MessageSearchException  {
>            logger.debug("index message {"+message+"}");
>            long s = (new Date()).getTime();
>            if (message == null)
>                throw new MessageSearchException("assertion failure: 
> null message",logger);
>            Document doc = new Document();
>            IndexInfo indexInfo = new IndexInfo(doc);
>            try {
>               DocumentIndex docIndex = new DocumentIndex(indexer);
>               String language = doc.get("lang");
>               if (language==null)
>                   language = indexer.getIndexLanguage();
>               docIndex.write(message,doc,indexInfo);
>               queue.put(indexInfo);
>               logger.debug("message indexed successfully 
> {"+message+",language='"+language+"'}");
>            } catch (MessagingException me) {
>               throw new MessageSearchException("failed to decode 
> message during indexing",me,logger, ChainedException.Level.DEBUG);
>            } catch (IOException me) {
>                throw new MessageSearchException("failed to index 
> message"+me.getMessage()+" {"+message+"}",me,logger, 
> ChainedException.Level.DEBUG);
>            } catch (ExtractionException ee)
>            {
>                // we will want to continue indexing
>               //throw new MessageSearchException("failed to decode 
> attachments in message {"+message+"}",ee,logger, 
> ChainedException.Level.DEBUG);
>            } catch (AlreadyClosedException ace) {
>                indexMessage(message);
>            } catch (Throwable e) {
>                throw new MessageSearchException("failed to index 
> message:"+e.getMessage(),e,logger, ChainedException.Level.DEBUG);
>            }
>            logger.debug("indexing message end {"+message+"}");
>            long e = (new Date()).getTime();
>            logger.debug("indexing time {time='"+(e-s)+"'}");
>        }
>          public class IndexProcessor extends Thread {
>                      public IndexProcessor() {
>                setName("index processor");
>            }
>                public void run() {
>                boolean exit = false;
>                //ExecutorService documentPool;
>                // we abandoned pool as it does not seem to offer any 
> major performance benefit
>                IndexInfo indexInfo = null;                  
> LinkedList<IndexInfo> pushbacks = new LinkedList<IndexInfo>();
>                              while (!exit) {
>                                      try {
>                        int maxIndexDocs = 
> Config.getConfig().getIndex().getMaxSimultaneousDocs();
>                        //documentPool = 
> Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchiveThreads()); 
>
>                        indexInfo = null;                          
> indexInfo = (IndexInfo) queue.take();
>                        if (indexInfo==EXIT_REQ) {
>                            logger.debug("index exit req received. 
> exiting");
>                            exit = true;
>                            continue;
>                        }
>                                          indexLock.lock();
>                        try {
>                             openIndex();
>                        } catch (Exception e) {
>                             logger.error("failed to open 
> index:"+e.getMessage(),e);
>                             return;
>                        }
>                        if (indexInfo==null) {
>                            logger.debug("index info is null");
>                        }
>                        int i = 0;
>                        while(indexInfo!=null && i<maxIndexDocs) {
>                            try {
>                                
> writer.addDocument(indexInfo.getDocument());
>                            } catch (IOException io) {
>                                logger.error("failed to add document to 
> index:"+io.getMessage(),io);
>                            } catch (AlreadyClosedException e) {
>                                pushbacks.add(indexInfo);
>                            } finally {
>                                indexInfo.cleanup();
>                            }
>                                                        
> //documentPool.execute(new IndexDocument(indexInfo,pushbacks));
>                                                       i++;
>                                                         if 
> (i<maxIndexDocs) {
>                                 indexInfo = (IndexInfo) queue.poll();
>                                                                 if 
> (indexInfo==null) {
>                                        logger.debug("index info is 
> null");
>                                 }
>                                                                 if 
> (indexInfo==EXIT_REQ) {
>                                         logger.debug("index exit req 
> received. exiting (2)");
>                                        exit = true;
>                                        break;
>                                  }
>                             }
>                                                    }
>                                              for (IndexInfo pushback : 
> pushbacks) {
>                            try {
>                                
> writer.addDocument(pushback.getDocument());
>                            } catch (IOException io) {
>                                logger.error("failed to add document to 
> index:"+io.getMessage(),io);
>                            } catch (AlreadyClosedException e) {
>                                pushbacks.add(indexInfo);
>                            } finally {
>                                indexInfo.cleanup();
>                            }
>                            //documentPool.execute(new 
> IndexDocument(pushback,pushbacks));
>                            i++;
>                        }
>                        //documentPool.shutdown();
>                        
> //documentPool.awaitTermination(30,TimeUnit.MINUTES);
>                                           } catch (Throwable ie) {
>                         logger.error("index write 
> interrupted:"+ie.getMessage());
>                     } finally {
>                           closeIndex();
>                          indexLock.unlock();
>                    }
>                }                 }
>                      public class IndexDocument extends Thread {
>                                  IndexInfo indexInfo = null;
>                    List<IndexInfo> pushbacks = null;
>                                      public IndexDocument(IndexInfo 
> indexInfo,List<IndexInfo> pushbacks) {
>                        this.indexInfo = indexInfo;
>                        this.pushbacks = pushbacks;
>                        setName("index document");
>                    }
>                                  public void run() {
>                        try {
>                            writer.addDocument(indexInfo.getDocument());
>                        } catch (IOException io) {
>                            logger.error("failed to add document to 
> index:"+io.getMessage(),io);
>                        } catch (AlreadyClosedException e) {
>                            pushbacks.add(indexInfo);
>                        }
>                    }};
>            }
>            protected void closeIndex() {
>             try {
>                     if (writer!=null) {
>                        writer.close();
>                        logger.debug("writer closed");
>                        writer = null;
>                     }
>                 } catch (Exception io) {
>                    logger.error("failed to close index 
> writer:"+io.getMessage(),io);
>                 }
>        }
>            public void deleteIndex() throws MessageSearchException {
>                   logger.debug("delete index 
> {indexpath='"+volume.getIndexPath()+"'}");
>                   try {
>                      indexLock.lock();
>                     try {
>                        int maxIndexChars = 
> Config.getConfig().getIndex().getMaxIndexPerFieldChars();
>                        writer = new 
> IndexWriter(FSDirectory.getDirectory(volume.getIndexPath()),analyzer,true,new 
> IndexWriter.MaxFieldLength(maxIndexChars));
>                     } catch (Exception cie) {
>                         logger.error("failed to delete index 
> {index='"+volume.getIndexPath()+"'}",cie);
>                         return;
>                     }
>                     MessageIndex.volumeIndexes.remove(this);
>                  } finally {
>                        closeIndex();
>                      indexLock.unlock();
>                }
>          }
>                public void startup() {
>            logger.debug("volumeindex is starting up");
>            File lockFile = new 
> File(volume.getIndexPath()+File.separatorChar + "write.lock");
>            if (lockFile.exists()) {
>                logger.warn("The server lock file already exists. 
> Either another indexer is running or the server was not shutdown 
> correctly.");
>                logger.warn("If it is the latter, the lock file must be 
> manually deleted at "+lockFile.getAbsolutePath());
>                if (indexer.getMultipleIndexProcesses()) {
>                    logger.debug("index lock file detected on 
> volumeindex startup.");
>                } else {
>                    logger.warn("index lock file detected. the server 
> was shutdown incorrectly. automatically deleting lock file.");
>                    logger.warn("indexer is configured to deal with 
> only one indexer process.");
>                    logger.warn("if you are running more than one 
> indexer, your index could be subject to corruption.");
>                    lockFile.delete();
>                }
>            }
>            indexProcessor = new IndexProcessor();
>            indexProcessor.start();
>            Runtime.getRuntime().addShutdownHook(this);
>                    }
>                                  public void shutdown() {
>              logger.debug("volumeindex is shutting down");
>              queue.add(EXIT_REQ);
>              scheduler.shutdownNow();
>                     }
>                  @Override
>          public void run() {
>              queue.add(EXIT_REQ);
>          }
>             }
>
>  
>
>
> Is it possible a large merge is running?  By default IW.close waits
> for outstanding merges to complete.  Can you post the stacktrace?
>
> Mike
>
> On Thu, Oct 8, 2009 at 5:22 PM, Jamie Band <jamie@stimulussoft.com> 
> wrote:
>> Hi All
>>
>> I have a long running situation where our indexing thread is getting 
>> stuck
>> indefinitely in IndexWriter's close method. Yourkit shows the thread 
>> to be
>> stuck in TIME_WAITING. Any idea's on what could be causing this?
>> Could it be one of the streams or readers we passed to the document?
>>
>> I am running Lucene 2.9.0.
>>
>> Many thanks in advance
>>
>> Jamie


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42715-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 09:36:23 2009
Return-Path: <java-user-return-42715-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10963 invoked from network); 9 Oct 2009 09:36:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 09:36:23 -0000
Received: (qmail 60328 invoked by uid 500); 9 Oct 2009 09:36:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60259 invoked by uid 500); 9 Oct 2009 09:36:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60249 invoked by uid 99); 9 Oct 2009 09:36:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 09:36:20 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 09:36:09 +0000
Received: by yxe30 with SMTP id 30so9447233yxe.29
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 02:35:48 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.68.25 with SMTP id q25mr4308600yba.256.1255080948147; Fri, 
	09 Oct 2009 02:35:48 -0700 (PDT)
In-Reply-To: <4ACEFC8C.7010209@stimulussoft.com>
References: <4ACEFC8C.7010209@stimulussoft.com>
Date: Fri, 9 Oct 2009 05:35:48 -0400
Message-ID: <9ac0c6aa0910090235r21268094sb4fab8a93bb55cef@mail.gmail.com>
Subject: Re: Index.close() infinite TIME_WAITING (repost)
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Are there other threads involved, besides the one hung in close?  Can
you post their stack traces?

This stack trace seems to indicate that IW believes another thread is
in the process of closing.

Can you call IndexWriter.setInfoStream and post the output leading to the h=
ang?

Mike

On Fri, Oct 9, 2009 at 5:04 AM, Jamie Band <jamie@stimulussoft.com> wrote:
> HI Michael / Uwe / others
>
> Sorry for the repost... it just does not look like the earlier message I
> sent go through.
> FYI: there are no large Lucene merges taking place.
>
> Jamie Band wrote:
>>
>> Hi Michael
>>
>> Thanks for your help. Here are the stacks:
>>
>> index processor [TIME_WAITING] CPU time: 33:01
>> java.lang.Object.wait(long)
>> org.apache.lucene.index.IndexWriter.doWait()
>> org.apache.lucene.index.IndexWriter.shouldClose()
>> org.apache.lucene.index.IndexWriter.close(boolean)
>> org.apache.lucene.index.IndexWriter.close()
>> com.stimulus.archiva.index.VolumeIndex.closeIndex()
>> com.stimulus.archiva.index.VolumeIndex$IndexProcessor.run()
>>
>> The source code to our indexer is attached. As you can see, documents ar=
e
>> added to a blocking queue. The index processor thread takes it out of th=
e
>> queue and processes it. After about 60k documents IndexWriter's close me=
thod
>> enters TIME_WAITING indefinitely. It there any workaround to this proble=
m?
>>
>>
>> package com.stimulus.archiva.index;
>>
>> import java.io.File;
>> import java.io.IOException;
>> import java.io.PrintStream;
>> import javax.mail.MessagingException;
>> import org.apache.commons.logging.*;
>> import org.apache.lucene.document.Document;
>> import org.apache.lucene.index.*;
>> import org.apache.lucene.store.FSDirectory;
>> import com.stimulus.archiva.domain.Config;
>> import com.stimulus.archiva.domain.Email;
>> import com.stimulus.archiva.domain.EmailID;
>> import com.stimulus.archiva.domain.Indexer;
>> import com.stimulus.archiva.domain.Volume;
>> import com.stimulus.archiva.exception.*;
>> import com.stimulus.archiva.language.AnalyzerFactory;
>> import com.stimulus.archiva.search.*;
>> import java.util.*;
>> import java.util.concurrent.ExecutorService;
>> import java.util.concurrent.Executors;
>> import java.util.concurrent.ScheduledExecutorService;
>> import java.util.concurrent.ScheduledFuture;
>> import java.util.concurrent.TimeUnit;
>> import org.apache.lucene.store.LockObtainFailedException;
>> import org.apache.lucene.store.AlreadyClosedException;
>> import java.util.concurrent.locks.ReentrantLock;
>> import java.util.concurrent.*;
>>
>> public class VolumeIndex extends Thread {
>> =A0 =A0 =A0 =A0 =A0protected ArrayBlockingQueue<IndexInfo> queue;
>> =A0 =A0 =A0 =A0protected static final Log logger =3D
>> LogFactory.getLog(VolumeIndex.class.getName());
>> =A0 =A0 =A0 =A0 =A0 IndexWriter writer =3D null;
>> =A0 =A0 =A0 =A0 =A0 Volume volume;
>> =A0 =A0 =A0 =A0 =A0 protected static ScheduledExecutorService scheduler;
>> =A0 =A0 =A0 =A0protected static ScheduledFuture<?> scheduledTask;
>> =A0 =A0 =A0 =A0protected static IndexInfo EXIT_REQ =3D new IndexInfo(nul=
l);
>> =A0 =A0 =A0 =A0ReentrantLock indexLock =3D new ReentrantLock();
>> =A0 =A0 =A0 =A0ArchivaAnalyzer analyzer =A0 =A0 =3D new ArchivaAnalyzer(=
);
>> =A0 =A0 =A0 =A0Indexer indexer =3D null;
>> =A0 =A0 =A0 =A0File indexLogFile;
>> =A0 =A0 =A0 =A0PrintStream indexLogOut;
>> =A0 =A0 =A0 =A0IndexProcessor indexProcessor;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public VolumeIndex(Index=
er indexer, Volume volume)
>> {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("creating new volume index {"+v=
olume+"}");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.volume =3D volume;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.indexer =3D indexer;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.queue =3D new
>> ArrayBlockingQueue<IndexInfo>(Config.getConfig().getIndex().getIndexBack=
log());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLogFile =3D getIndexLogFile(vol=
ume);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexLogFile!=3Dnull) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexLogFile.length()>10=
485760)
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLogFile.delete(=
);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLogOut =3D new PrintStr=
eam(indexLogFile);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("set index log file pat=
h
>> {path=3D'"+indexLogFile.getCanonicalPath()+"'}");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to open index l=
og
>> file:"+e.getMessage(),e);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 startup();
>> =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 protected File getIndexLogFile(Volume volume=
) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String indexpath =3D volume.getIndex=
Path();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int lio =3D indexpath.lastIndexOf(Fi=
le.separator)+1;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String logfilepath =3D
>> indexpath.substring(lio,indexpath.length()-1);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logfilepath +=3D ".log";
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logfilepath =3D "index_"+logfilepath=
;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logfilepath =3D
>> Config.getFileSystem().getLogPath()+File.separator+logfilepath;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 return new File(logfilepath);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to open index l=
og
>> file:"+e.getMessage(),e);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 return null;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0public void deleteMessages(List<String> i=
ds) throws
>> MessageSearchException {
>> =A0 =A0 =A0 =A0 =A0 =A0 if (ids =3D=3D null)
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("as=
sertion failure:
>> null ids",logger);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Term[] terms =3D new Ter=
m[ids.size()];
>> =A0 =A0 =A0 =A0 =A0 =A0 int c =3D 0;
>> =A0 =A0 =A0 =A0 =A0 =A0 StringBuffer deleteInfo =3D new StringBuffer();
>> =A0 =A0 =A0 =A0 =A0 =A0 for (String id : ids) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 terms[c++] =3D new Term("uid",id);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 deleteInfo.append(id);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 deleteInfo.append(",");
>> =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String deleteStr =3D del=
eteInfo.toString();
>> =A0 =A0 =A0 =A0 =A0 =A0 if (deleteStr.length()>0 &&
>> deleteStr.charAt(deleteStr.length()-1)=3D=3D',')
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 deleteStr =3D deleteStr.substring(0,dele=
teStr.length()-1);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("delete mes=
sages
>> {'"+deleteInfo+"'}");
>> =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.lock();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 openIndex();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.deleteDocuments(terms);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.expungeDeletes();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException=
("failed to delete
>> email from index.",e,logger);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
}
>> =A0 =A0 =A0 =A0 =A0 =A0 } finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 closeIndex();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
>> =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 protected void openIndex() throws MessageSea=
rchException {
>> =A0 =A0 =A0 =A0 =A0 =A0Exception lastError =3D null;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (writer=3D=3Dnull) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("openIndex() index will be open=
ed. it is
>> currently closed.");
>> =A0 =A0 =A0 =A0 =A0 } else {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("openIndex() did not bother ope=
ning index. it
>> is already open.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 return;
>> =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 logger.debug("opening index for write {"+volume+"}")=
;
>> =A0 =A0 =A0 =A0 =A0 indexer.prepareIndex(volume);
>> =A0 =A0 =A0 =A0 =A0 logger.debug("opening search index for write
>> {indexpath=3D'"+volume.getIndexPath()+"'}");
>> =A0 =A0 =A0 =A0 =A0 boolean writelock;
>> =A0 =A0 =A0 =A0 =A0 int attempt =3D 0;
>> =A0 =A0 =A0 =A0 =A0 int maxattempt =3D 10;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if
>> (Config.getConfig().getIndex().getMultipleIndexProcesses()) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 maxattempt =3D 10000;
>> =A0 =A0 =A0 =A0 =A0 =A0} else {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 maxattempt =3D 10;
>> =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 do {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 writelock =3D false;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 FSDirectory fsDirectory =3D
>> FSDirectory.getDirectory(volume.getIndexPath());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexChars =3D
>> Config.getConfig().getIndex().getMaxIndexPerFieldChars();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer =3D new IndexWriter(f=
sDirectory,analyzer,new
>> IndexWriter.MaxFieldLength(maxIndexChars));
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (logger.isDebugEnabled() =
&& indexLogOut!=3Dnull) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.setInfoStream=
(indexLogOut);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (LockObtainFailedException lobfe) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("write lock on =
index. will reopen in
>> 50ms.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try { Thread.sleep(50); } ca=
tch (Exception e) {}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 attempt++;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writelock =3D true;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (CorruptIndexException cie) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("in=
dex appears to be
>> corrupt. please reindex the active volume."+cie.getMessage(),logger);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException io) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("fa=
iled to write
>> document to index:"+io.getMessage(),logger);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0} while (writelock && attempt<maxattempt);
>> =A0 =A0 =A0 =A0 =A0if (attempt>=3D10000)
>> =A0 =A0 =A0 =A0 =A0 =A0throw new MessageSearchException("failed to open =
index writer
>> {location=3D'"+volume.getIndexPath()+"'}",lastError,logger);
>> =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 public void indexMessage(Email message) throws
>> MessageSearchException =A0{
>> =A0 =A0 =A0 =A0 =A0 logger.debug("index message {"+message+"}");
>> =A0 =A0 =A0 =A0 =A0 long s =3D (new Date()).getTime();
>> =A0 =A0 =A0 =A0 =A0 if (message =3D=3D null)
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("assertion =
failure: null
>> message",logger);
>> =A0 =A0 =A0 =A0 =A0 Document doc =3D new Document();
>> =A0 =A0 =A0 =A0 =A0 IndexInfo indexInfo =3D new IndexInfo(doc);
>> =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0DocumentIndex docIndex =3D new DocumentIndex(=
indexer);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0String language =3D doc.get("lang");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0if (language=3D=3Dnull)
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0language =3D indexer.getIndexLanguage=
();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0docIndex.write(message,doc,indexInfo);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0queue.put(indexInfo);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.debug("message indexed successfully
>> {"+message+",language=3D'"+language+"'}");
>> =A0 =A0 =A0 =A0 =A0 } catch (MessagingException me) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0throw new MessageSearchException("failed to d=
ecode message
>> during indexing",me,logger, ChainedException.Level.DEBUG);
>> =A0 =A0 =A0 =A0 =A0 } catch (IOException me) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("failed to =
index
>> message"+me.getMessage()+" {"+message+"}",me,logger,
>> ChainedException.Level.DEBUG);
>> =A0 =A0 =A0 =A0 =A0 } catch (ExtractionException ee)
>> =A0 =A0 =A0 =A0 =A0 {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 // we will want to continue indexing
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0//throw new MessageSearchException("failed to=
 decode
>> attachments in message {"+message+"}",ee,logger,
>> ChainedException.Level.DEBUG);
>> =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClosedException ace) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexMessage(message);
>> =A0 =A0 =A0 =A0 =A0 } catch (Throwable e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("failed to =
index
>> message:"+e.getMessage(),e,logger, ChainedException.Level.DEBUG);
>> =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 logger.debug("indexing message end {"+message+"}");
>> =A0 =A0 =A0 =A0 =A0 long e =3D (new Date()).getTime();
>> =A0 =A0 =A0 =A0 =A0 logger.debug("indexing time {time=3D'"+(e-s)+"'}");
>> =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 public class IndexProcessor extends Thread {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public IndexProcessor() {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 setName("index processor");
>> =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 public void run() {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 boolean exit =3D false;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 //ExecutorService documentPool;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 // we abandoned pool as it does not seem to =
offer any major
>> performance benefit
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 IndexInfo indexInfo =3D null;
>> =A0LinkedList<IndexInfo> pushbacks =3D new LinkedList<IndexInfo>();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 while (!exit) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexDocs =3D
>> Config.getConfig().getIndex().getMaxSimultaneousDocs();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool =3D
>> Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchive=
Threads());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo =3D null; =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexInfo
>> =3D (IndexInfo) queue.take();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexInfo=3D=3DEXIT_REQ)=
 {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index =
exit req received.
>> exiting");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 exit =3D true;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 continue;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 indexLock.lock();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0openIndex();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("fai=
led to open
>> index:"+e.getMessage(),e);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0return;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexInfo=3D=3Dnull) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index =
info is null");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int i =3D 0;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 while(indexInfo!=3Dnull && i=
<maxIndexDocs) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDo=
cument(indexInfo.getDocument());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException=
 io) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error=
("failed to add document to
>> index:"+io.getMessage(),io);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClos=
edException e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.ad=
d(indexInfo);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo.cl=
eanup();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>>
>> //documentPool.execute(new IndexDocument(indexInfo,pushbacks));
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0i++;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (i<maxIndexDocs)
>> {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexInfo=
 =3D (IndexInfo) queue.poll();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if
>> (indexInfo=3D=3Dnull) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 logger.debug("index info is null");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if
>> (indexInfo=3D=3DEXIT_REQ) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0logger.debug("index exit req
>> received. exiting (2)");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 exit =3D true;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 break;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 for (IndexInfo pushback :
>> pushbacks) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDo=
cument(pushback.getDocument());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException=
 io) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error=
("failed to add document to
>> index:"+io.getMessage(),io);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClos=
edException e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.ad=
d(indexInfo);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo.cl=
eanup();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.execu=
te(new
>> IndexDocument(pushback,pushbacks));
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 i++;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.shutdown();
>>
>> //documentPool.awaitTermination(30,TimeUnit.MINUTES);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0} catch (Throwable ie) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("index write
>> interrupted:"+ie.getMessage());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0closeIndex();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public class IndexDocument exten=
ds Thread {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 IndexInf=
o indexInfo =3D null;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 List<IndexInfo> pushbacks =3D null;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
public IndexDocument(IndexInfo
>> indexInfo,List<IndexInfo> pushbacks) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.indexInfo =3D indexInfo=
;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.pushbacks =3D pushbacks=
;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 setName("index document");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public v=
oid run() {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDocument(i=
ndexInfo.getDocument());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException io) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed=
 to add document to
>> index:"+io.getMessage(),io);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClosedExcept=
ion e) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.add(indexI=
nfo);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }};
>> =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 protected void closeIndex() {
>> =A0 =A0 =A0 =A0 =A0 =A0try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (writer!=3Dnull) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.close();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("writer closed"=
);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer =3D null;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} catch (Exception io) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to close index
>> writer:"+io.getMessage(),io);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 public void deleteIndex() throws MessageSearchExcept=
ion {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.debug("delete index
>> {indexpath=3D'"+volume.getIndexPath()+"'}");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.lock();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexChars =3D
>> Config.getConfig().getIndex().getMaxIndexPerFieldChars();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer =3D new
>> IndexWriter(FSDirectory.getDirectory(volume.getIndexPath()),analyzer,tru=
e,new
>> IndexWriter.MaxFieldLength(maxIndexChars));
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} catch (Exception cie) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("failed to d=
elete index
>> {index=3D'"+volume.getIndexPath()+"'}",cie);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0return;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0MessageIndex.volumeIndexes.remove=
(this);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 closeIndex();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 public void startup() {
>> =A0 =A0 =A0 =A0 =A0 logger.debug("volumeindex is starting up");
>> =A0 =A0 =A0 =A0 =A0 File lockFile =3D new
>> File(volume.getIndexPath()+File.separatorChar + "write.lock");
>> =A0 =A0 =A0 =A0 =A0 if (lockFile.exists()) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("The server lock file already ex=
ists. Either
>> another indexer is running or the server was not shutdown correctly.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("If it is the latter, the lock f=
ile must be
>> manually deleted at "+lockFile.getAbsolutePath());
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexer.getMultipleIndexProcesses()) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index lock file detect=
ed on volumeindex
>> startup.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } else {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("index lock file detecte=
d. the server was
>> shutdown incorrectly. automatically deleting lock file.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("indexer is configured t=
o deal with only one
>> indexer process.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("if you are running more=
 than one indexer,
>> your index could be subject to corruption.");
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 lockFile.delete();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 indexProcessor =3D new IndexProcessor();
>> =A0 =A0 =A0 =A0 =A0 indexProcessor.start();
>> =A0 =A0 =A0 =A0 =A0 Runtime.getRuntime().addShutdownHook(this);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public v=
oid shutdown() {
>> =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("volumeindex is shutting down");
>> =A0 =A0 =A0 =A0 =A0 =A0 queue.add(EXIT_REQ);
>> =A0 =A0 =A0 =A0 =A0 =A0 scheduler.shutdownNow();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 @Override
>> =A0 =A0 =A0 =A0 public void run() {
>> =A0 =A0 =A0 =A0 =A0 =A0 queue.add(EXIT_REQ);
>> =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0}
>>
>>
>>
>> Is it possible a large merge is running? =A0By default IW.close waits
>> for outstanding merges to complete. =A0Can you post the stacktrace?
>>
>> Mike
>>
>> On Thu, Oct 8, 2009 at 5:22 PM, Jamie Band <jamie@stimulussoft.com> wrot=
e:
>>>
>>> Hi All
>>>
>>> I have a long running situation where our indexing thread is getting
>>> stuck
>>> indefinitely in IndexWriter's close method. Yourkit shows the thread to
>>> be
>>> stuck in TIME_WAITING. Any idea's on what could be causing this?
>>> Could it be one of the streams or readers we passed to the document?
>>>
>>> I am running Lucene 2.9.0.
>>>
>>> Many thanks in advance
>>>
>>> Jamie
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42716-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 09:44:58 2009
Return-Path: <java-user-return-42716-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12753 invoked from network); 9 Oct 2009 09:44:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 09:44:57 -0000
Received: (qmail 70205 invoked by uid 500); 9 Oct 2009 09:44:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70132 invoked by uid 500); 9 Oct 2009 09:44:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70105 invoked by uid 99); 9 Oct 2009 09:44:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 09:44:55 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 09:44:46 +0000
Received: by yxe30 with SMTP id 30so9452519yxe.29
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 02:44:24 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.59.12 with SMTP id h12mr4442881yba.39.1255081463923; Fri, 
	09 Oct 2009 02:44:23 -0700 (PDT)
In-Reply-To: <3836ec640910082137l465152ddv3eeff61802c9f1ff@mail.gmail.com>
References: <3836ec640910020810t236410a0j78ccc788975a0915@mail.gmail.com>
	 <88f6e29a0910080101m4d17c5al1e466e19badfd331@mail.gmail.com>
	 <3836ec640910082137l465152ddv3eeff61802c9f1ff@mail.gmail.com>
Date: Fri, 9 Oct 2009 05:44:23 -0400
Message-ID: <9ac0c6aa0910090244s3b70ec9bsb5168b55d4958671@mail.gmail.com>
Subject: Re: FileNotFoundException on index
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

You can use o.a.l.index.CheckIndex to fix the index.  It will remove
references to any segments that are missing or have problems during
testing.  First run it without -fix to see what problems there are.
Then take a backup of the index.  Then run it with -fix.  The index
will lose all docs in those segments that it removes.

Can you describe what led up to this?  Is it repeatable?

Mike

On Fri, Oct 9, 2009 at 12:37 AM, Max Lynch <ihasmax@gmail.com> wrote:
> Missed your response, thanks Bernd.
>
> I don't think that's it, since I haven't been executing any commands like
> that. =A0The only thing I could think of is corruption. =A0I've got the i=
ndex
> backed up in case there is a way to fix it (it won't matter in a week or =
so
> since I cull any documents older than 25 days).
>
> Is there a way to fix this?
>
> Thanks.
>
> On Thu, Oct 8, 2009 at 3:01 AM, Bernd Fondermann <
> bernd.fondermann@googlemail.com> wrote:
>
>> Hi Max
>>
>> just a guess: maybe you deleted all *.c source files in that area and
>> unintentionally deleted this index file, too.
>>
>> =A0Bernd
>>
>> On Fri, Oct 2, 2009 at 17:10, Max Lynch <ihasmax@gmail.com> wrote:
>> > I'm getting this error when I try to run my searcher and my indexer:
>> >
>> > Traceback (most recent call last):
>> > self.searcher =3D lucene.IndexSearcher(self.directory)
>> > JavaError: java.io.FileNotFoundException:
>> /home/spider/misc/index/_275c.cfs
>> > (No such file or directory)
>> >
>> > I don't know anything about the format of the Lucene index, but I noti=
ce
>> I
>> > have several _275* files from b to j but no c.
>> >
>> > Any ideas?
>> >
>> > Thanks.
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42717-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 10:06:09 2009
Return-Path: <java-user-return-42717-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19457 invoked from network); 9 Oct 2009 10:06:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 10:06:09 -0000
Received: (qmail 94476 invoked by uid 500); 9 Oct 2009 10:06:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94425 invoked by uid 500); 9 Oct 2009 10:06:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94415 invoked by uid 99); 9 Oct 2009 10:06:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 10:06:06 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.75.55.147] (HELO live.stimulussoft.com) (216.75.55.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 10:05:55 +0000
Received: (qmail 27917 invoked by uid 511); 9 Oct 2009 03:05:33 -0700
Received: from 196.210.225.74 by live.stimulussoft.com (envelope-from <jamie@stimulussoft.com>, uid 509) with qmail-scanner-1.25-st-qms 
 (clamdscan: 0.88.7/7149. spamassassin: 3.2.3. perlscan: 1.25-st-qms.  
 Clear:RC:0(196.210.225.74):SA:0(-0.7/5.0):. 
 Processed in 9.98734 secs); 09 Oct 2009 10:05:33 -0000
X-Antivirus-MYDOMAIN-Mail-From: jamie@stimulussoft.com via live.stimulussoft.com
X-Antivirus-MYDOMAIN: 1.25-st-qms (Clear:RC:0(196.210.225.74):SA:0(-0.7/5.0):. Processed in 9.98734 secs Process 27906)
Received: from unknown (HELO ?192.168.0.14?) (jamie@stimulussoft.com@196.210.225.74)
  by live.stimulussoft.com with AES256-SHA encrypted SMTP; 9 Oct 2009 03:05:23 -0700
Message-ID: <4ACF0ACB.3090305@stimulussoft.com>
Date: Fri, 09 Oct 2009 12:04:59 +0200
From: Jamie Band <jamie@stimulussoft.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Index.close() infinite TIME_WAITING (repost)
References: <4ACEFC8C.7010209@stimulussoft.com> <9ac0c6aa0910090235r21268094sb4fab8a93bb55cef@mail.gmail.com>
In-Reply-To: <9ac0c6aa0910090235r21268094sb4fab8a93bb55cef@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, hits=-0.7 required=5.0

Hi Mike

There are other threads involved but none are simultaneously modifying 
the idex.

There is one read that retrieves the total count every 2 seconds on the 
Index for GUI display:

public long getTotalMessageCount(Volume volume) throws 
MessageSearchException {
              if (volume == null)
                    throw new MessageSearchException("assertion failure: 
null volume",logger);
              int count = 0;
              File indexDir = new File(volume.getIndexPath());
              if (!indexDir.exists())
                      return 0;
              IndexReader indexReader = null;
              try {
                  indexReader = IndexReader.open(indexDir);
                  count += indexReader.numDocs();
              } catch (IOException e ) {
                  logger.error("failed to close index to calculate total 
count",e);
              } finally {
                  try { indexReader.close(); } catch (Exception e) {
                      logger.error("failed to close index to calculate 
total count",e);
                  }
              }
              return count;
}

There are also other threads for performing searches across the various 
indexes.

I will rerun the reindex and send you the log.

With the availability of Lucene 2.9.0 I changed our indexing routines, 
so perhaps its an issue with my code. One thing I've already been 
curious about is how it is possible to receive the 
AlreadyClosedException when there is no
other code writing to the index due to the indexLock. Very occasionally  
an  AlreadyClosedException is thrown while adding a document to the 
index. To ensure that nothing is list, a separate retry queue is maintained.

Any you spot anything suspect in the below? I would also be interested 
to get your thoughts on how to improve indexing speed. Using a thread 
pool to addDocuments to the index does not seem to help much.


public class IndexProcessor extends Thread {
           
            public IndexProcessor() {
                setName("index processor");
            }
     
            public void run() {
                boolean exit = false;
                //ExecutorService documentPool;
                // we abandoned pool as it does not seem to offer any 
major performance benefit
                IndexInfo indexInfo = null;   
                LinkedList<IndexInfo> pushbacks = new 
LinkedList<IndexInfo>();
               
                while (!exit) {
                   
                    try {
                        int maxIndexDocs = 
Config.getConfig().getIndex().getMaxSimultaneousDocs();
                        //documentPool = 
Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchiveThreads());
                        indexInfo = null;   
                        indexInfo = (IndexInfo) queue.take();
                        if (indexInfo==EXIT_REQ) {
                            logger.debug("index exit req received. 
exiting");
                            exit = true;
                            continue;
                        }
                   
                        indexLock.lock();
                        try {
                             openIndex();
                        } catch (Exception e) {
                             logger.error("failed to open 
index:"+e.getMessage(),e);
                             return;
                        }
                        if (indexInfo==null) {
                            logger.debug("index info is null");
                        }
                        int i = 0;
                        while(indexInfo!=null && i<maxIndexDocs) {
                            try {
                                writer.addDocument(indexInfo.getDocument());
                                indexInfo.cleanup();
                            } catch (IOException io) {
                                logger.error("failed to add document to 
index:"+io.getMessage(),io);
                                indexInfo.cleanup();
                            } catch (AlreadyClosedException e) {
                                pushbacks.add(indexInfo);
                            }
                              //documentPool.execute(new 
IndexDocument(indexInfo,pushbacks));
                           
                             i++;
                             if (i<maxIndexDocs) {
                                 indexInfo = (IndexInfo) queue.poll();
                                 
                                 if (indexInfo==null) {
                                        logger.debug("index info is null");
                                 }
                                 
                                 if (indexInfo==EXIT_REQ) {
                                         logger.debug("index exit req 
received. exiting (2)");
                                        exit = true;
                                        break;
                                  }
                             }
                             
                        }
                        if (pushbacks.size()>0) {
                              closeIndex();
                              try {
                                     openIndex();
                              } catch (Exception e) {
                                 logger.error("failed to open 
index:"+e.getMessage(),e);
                                 return;
                              }
                              for (IndexInfo pushback : pushbacks) {
                                    try {
                                        
writer.addDocument(pushback.getDocument());
                                        pushback.cleanup();
                                    } catch (IOException io) {
                                        logger.error("failed to add 
document to index:"+io.getMessage(),io);
                                        pushback.cleanup();
                                    } catch (AlreadyClosedException e) {
                                        pushbacks.add(pushback);
                                    }
                                    //documentPool.execute(new 
IndexDocument(pushback,pushbacks));
                                    i++;
                              }
                        }
                       
                        //documentPool.shutdown();
                        
//documentPool.awaitTermination(30,TimeUnit.MINUTES);
                       
                     } catch (Throwable ie) {
                         logger.error("index write 
interrupted:"+ie.getMessage());
                     } finally {
                           closeIndex();
                          indexLock.unlock();
                    }
                }   
               }

Many thanks

Jamie

Michael McCandless wrote:
> Are there other threads involved, besides the one hung in close?  Can
> you post their stack traces?
>
> This stack trace seems to indicate that IW believes another thread is
> in the process of closing.
>
> Can you call IndexWriter.setInfoStream and post the output leading to the hang?
>
> Mike
>
>   


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42718-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 10:06:58 2009
Return-Path: <java-user-return-42718-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19847 invoked from network); 9 Oct 2009 10:06:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 10:06:58 -0000
Received: (qmail 96347 invoked by uid 500); 9 Oct 2009 10:06:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96274 invoked by uid 500); 9 Oct 2009 10:06:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96264 invoked by uid 99); 9 Oct 2009 10:06:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 10:06:55 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [216.75.55.147] (HELO live.stimulussoft.com) (216.75.55.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 10:06:44 +0000
Received: (qmail 27951 invoked by uid 511); 9 Oct 2009 03:06:23 -0700
Received: from 196.210.225.74 by live.stimulussoft.com (envelope-from <jamie@stimulussoft.com>, uid 509) with qmail-scanner-1.25-st-qms 
 (clamdscan: 0.88.7/7149. spamassassin: 3.2.3. perlscan: 1.25-st-qms.  
 Clear:RC:0(196.210.225.74):SA:0(-0.7/5.0):. 
 Processed in 8.655083 secs); 09 Oct 2009 10:06:23 -0000
X-Antivirus-MYDOMAIN-Mail-From: jamie@stimulussoft.com via live.stimulussoft.com
X-Antivirus-MYDOMAIN: 1.25-st-qms (Clear:RC:0(196.210.225.74):SA:0(-0.7/5.0):. Processed in 8.655083 secs Process 27934)
Received: from unknown (HELO ?192.168.0.14?) (jamie@stimulussoft.com@196.210.225.74)
  by live.stimulussoft.com with AES256-SHA encrypted SMTP; 9 Oct 2009 03:06:14 -0700
Message-ID: <4ACF0AFE.7000403@stimulussoft.com>
Date: Fri, 09 Oct 2009 12:05:50 +0200
From: Jamie Band <jamie@stimulussoft.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Index.close() infinite TIME_WAITING (repost)
References: <4ACEFC8C.7010209@stimulussoft.com> <9ac0c6aa0910090235r21268094sb4fab8a93bb55cef@mail.gmail.com>
In-Reply-To: <9ac0c6aa0910090235r21268094sb4fab8a93bb55cef@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org
X-Old-Spam-Status: No, hits=-0.7 required=5.0

Hi Mike

There are other threads involved but none are simultaneously modifying 
the index.

There is one thread that retrieves the total count every 2 seconds on 
the index for GUI display:

public long getTotalMessageCount(Volume volume) throws 
MessageSearchException {
              if (volume == null)
                    throw new MessageSearchException("assertion failure: 
null volume",logger);
              int count = 0;
              File indexDir = new File(volume.getIndexPath());
              if (!indexDir.exists())
                      return 0;
              IndexReader indexReader = null;
              try {
                  indexReader = IndexReader.open(indexDir);
                  count += indexReader.numDocs();
              } catch (IOException e ) {
                  logger.error("failed to close index to calculate total 
count",e);
              } finally {
                  try { indexReader.close(); } catch (Exception e) {
                      logger.error("failed to close index to calculate 
total count",e);
                  }
              }
              return count;
}

There are also other threads for performing searches across the various 
indexes.

I will rerun the reindex and send you the log.

With the availability of Lucene 2.9.0 I changed our indexing routines, 
so perhaps its an issue with my code. One thing I've already been 
curious about is how it is possible to receive the 
AlreadyClosedException when there is no
other code writing to the index due to the indexLock. Very occasionally  
an  AlreadyClosedException is thrown while adding a document to the 
index. To ensure that nothing is list, a separate retry queue is maintained.

Any you spot anything suspect in the below? I would also be interested 
to get your thoughts on how to improve indexing speed. Using a thread 
pool to addDocuments to the index does not seem to help much.


public class IndexProcessor extends Thread {
           
            public IndexProcessor() {
                setName("index processor");
            }
     
            public void run() {
                boolean exit = false;
                //ExecutorService documentPool;
                // we abandoned pool as it does not seem to offer any 
major performance benefit
                IndexInfo indexInfo = null;   
                LinkedList<IndexInfo> pushbacks = new 
LinkedList<IndexInfo>();
               
                while (!exit) {
                   
                    try {
                        int maxIndexDocs = 
Config.getConfig().getIndex().getMaxSimultaneousDocs();
                        //documentPool = 
Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchiveThreads());
                        indexInfo = null;   
                        indexInfo = (IndexInfo) queue.take();
                        if (indexInfo==EXIT_REQ) {
                            logger.debug("index exit req received. 
exiting");
                            exit = true;
                            continue;
                        }
                   
                        indexLock.lock();
                        try {
                             openIndex();
                        } catch (Exception e) {
                             logger.error("failed to open 
index:"+e.getMessage(),e);
                             return;
                        }
                        if (indexInfo==null) {
                            logger.debug("index info is null");
                        }
                        int i = 0;
                        while(indexInfo!=null && i<maxIndexDocs) {
                            try {
                                writer.addDocument(indexInfo.getDocument());
                                indexInfo.cleanup();
                            } catch (IOException io) {
                                logger.error("failed to add document to 
index:"+io.getMessage(),io);
                                indexInfo.cleanup();
                            } catch (AlreadyClosedException e) {
                                pushbacks.add(indexInfo);
                            }
                              //documentPool.execute(new 
IndexDocument(indexInfo,pushbacks));
                           
                             i++;
                             if (i<maxIndexDocs) {
                                 indexInfo = (IndexInfo) queue.poll();
                                 
                                 if (indexInfo==null) {
                                        logger.debug("index info is null");
                                 }
                                 
                                 if (indexInfo==EXIT_REQ) {
                                         logger.debug("index exit req 
received. exiting (2)");
                                        exit = true;
                                        break;
                                  }
                             }
                             
                        }
                        if (pushbacks.size()>0) {
                              closeIndex();
                              try {
                                     openIndex();
                              } catch (Exception e) {
                                 logger.error("failed to open 
index:"+e.getMessage(),e);
                                 return;
                              }
                              for (IndexInfo pushback : pushbacks) {
                                    try {
                                        
writer.addDocument(pushback.getDocument());
                                        pushback.cleanup();
                                    } catch (IOException io) {
                                        logger.error("failed to add 
document to index:"+io.getMessage(),io);
                                        pushback.cleanup();
                                    } catch (AlreadyClosedException e) {
                                        pushbacks.add(pushback);
                                    }
                                    //documentPool.execute(new 
IndexDocument(pushback,pushbacks));
                                    i++;
                              }
                        }
                       
                        //documentPool.shutdown();
                        
//documentPool.awaitTermination(30,TimeUnit.MINUTES);
                       
                     } catch (Throwable ie) {
                         logger.error("index write 
interrupted:"+ie.getMessage());
                     } finally {
                           closeIndex();
                          indexLock.unlock();
                    }
                }   
               }

Many thanks

Jamie

Michael McCandless wrote:
> Are there other threads involved, besides the one hung in close?  Can
> you post their stack traces?
>
> This stack trace seems to indicate that IW believes another thread is
> in the process of closing.
>
> Can you call IndexWriter.setInfoStream and post the output leading to the hang?
>
> Mike
>
>   


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42719-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 10:16:06 2009
Return-Path: <java-user-return-42719-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23474 invoked from network); 9 Oct 2009 10:16:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 10:16:06 -0000
Received: (qmail 11338 invoked by uid 500); 9 Oct 2009 10:16:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11281 invoked by uid 500); 9 Oct 2009 10:16:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11271 invoked by uid 99); 9 Oct 2009 10:16:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 10:16:03 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 10:15:53 +0000
Received: by ywh14 with SMTP id 14so1634305ywh.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 03:15:29 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.36.5 with SMTP id j5mr4459979ybj.81.1255083329120; Fri, 09 
	Oct 2009 03:15:29 -0700 (PDT)
In-Reply-To: <4ACF0AFE.7000403@stimulussoft.com>
References: <4ACEFC8C.7010209@stimulussoft.com>
	 <9ac0c6aa0910090235r21268094sb4fab8a93bb55cef@mail.gmail.com>
	 <4ACF0AFE.7000403@stimulussoft.com>
Date: Fri, 9 Oct 2009 06:15:29 -0400
Message-ID: <9ac0c6aa0910090315o43468f44rd22d3dfee634f69c@mail.gmail.com>
Subject: Re: Index.close() infinite TIME_WAITING (repost)
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Were there any exceptions inside Lucene, before the hang?

The fact that you're hitting AlreadyClosedException is a spooky sign
-- that means IW thinks you had in fact closed the writer, but then
used it again.

For increasing indexing throughput, I'd start here:

    http://wiki.apache.org/lucene-java/ImproveIndexingSpeed

Can you whittle down your code to a smaller test that still shows the hang?

Mike

On Fri, Oct 9, 2009 at 6:05 AM, Jamie Band <jamie@stimulussoft.com> wrote:
> Hi Mike
>
> There are other threads involved but none are simultaneously modifying th=
e
> index.
>
> There is one thread that retrieves the total count every 2 seconds on the
> index for GUI display:
>
> public long getTotalMessageCount(Volume volume) throws
> MessageSearchException {
> =A0 =A0 =A0 =A0 =A0 =A0 if (volume =3D=3D null)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("ass=
ertion failure: null
> volume",logger);
> =A0 =A0 =A0 =A0 =A0 =A0 int count =3D 0;
> =A0 =A0 =A0 =A0 =A0 =A0 File indexDir =3D new File(volume.getIndexPath())=
;
> =A0 =A0 =A0 =A0 =A0 =A0 if (!indexDir.exists())
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 return 0;
> =A0 =A0 =A0 =A0 =A0 =A0 IndexReader indexReader =3D null;
> =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexReader =3D IndexReader.open(indexDir=
);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 count +=3D indexReader.numDocs();
> =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException e ) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to close index to ca=
lculate total
> count",e);
> =A0 =A0 =A0 =A0 =A0 =A0 } finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try { indexReader.close(); } catch (Excep=
tion e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to close ind=
ex to calculate total
> count",e);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 return count;
> }
>
> There are also other threads for performing searches across the various
> indexes.
>
> I will rerun the reindex and send you the log.
>
> With the availability of Lucene 2.9.0 I changed our indexing routines, so
> perhaps its an issue with my code. One thing I've already been curious ab=
out
> is how it is possible to receive the AlreadyClosedException when there is=
 no
> other code writing to the index due to the indexLock. Very occasionally =
=A0an
> =A0AlreadyClosedException is thrown while adding a document to the index.=
 To
> ensure that nothing is list, a separate retry queue is maintained.
>
> Any you spot anything suspect in the below? I would also be interested to
> get your thoughts on how to improve indexing speed. Using a thread pool t=
o
> addDocuments to the index does not seem to help much.
>
>
> public class IndexProcessor extends Thread {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public IndexProcessor() {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 setName("index processor");
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 public void run() {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 boolean exit =3D false;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 //ExecutorService documentPool;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 // we abandoned pool as it does not seem to o=
ffer any major
> performance benefit
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 IndexInfo indexInfo =3D null;
> LinkedList<IndexInfo> pushbacks =3D new LinkedList<IndexInfo>();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 while (!exit) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 t=
ry {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexDocs =3D
> Config.getConfig().getIndex().getMaxSimultaneousDocs();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool =3D
> Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchiveT=
hreads());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo =3D null; =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo =3D
> (IndexInfo) queue.take();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexInfo=3D=3DEXIT_REQ) =
{
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index e=
xit req received. exiting");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 exit =3D true;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 continue;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 indexLock.lock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0openIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("fail=
ed to open
> index:"+e.getMessage(),e);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0return;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexInfo=3D=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index i=
nfo is null");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int i =3D 0;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 while(indexInfo!=3Dnull && i<=
maxIndexDocs) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDoc=
ument(indexInfo.getDocument());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo.cle=
anup();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException =
io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error(=
"failed to add document to
> index:"+io.getMessage(),io);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo.cle=
anup();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClose=
dException e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.add=
(indexInfo);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.ex=
ecute(new
> IndexDocument(indexInfo,pushbacks));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0i++;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (i<maxIndexDocs=
) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexInfo =
=3D (IndexInfo) queue.poll();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if
> (indexInfo=3D=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 logger.debug("index info is null");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if
> (indexInfo=3D=3DEXIT_REQ) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0logger.debug("index exit req
> received. exiting (2)");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 exit =3D true;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 break;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (pushbacks.size()>0) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 closeIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0op=
enIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exceptio=
n e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.err=
or("failed to open
> index:"+e.getMessage(),e);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0return;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 for (IndexInfo pu=
shback : pushbacks) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
>
> writer.addDocument(pushback.getDocument());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 pushback.cleanup();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } cat=
ch (IOException io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 logger.error("failed to add document
> to index:"+io.getMessage(),io);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 pushback.cleanup();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } cat=
ch (AlreadyClosedException e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 pushbacks.add(pushback);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //doc=
umentPool.execute(new
> IndexDocument(pushback,pushbacks));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 i++;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 //documentPool.shutdown();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.awaitTerminati=
on(30,TimeUnit.MINUTES);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0} catch (Throwable ie) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("index write
> interrupted:"+ie.getMessage());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0closeIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
>
> Many thanks
>
> Jamie
>
> Michael McCandless wrote:
>>
>> Are there other threads involved, besides the one hung in close? =A0Can
>> you post their stack traces?
>>
>> This stack trace seems to indicate that IW believes another thread is
>> in the process of closing.
>>
>> Can you call IndexWriter.setInfoStream and post the output leading to th=
e
>> hang?
>>
>> Mike
>>
>>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42720-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 12:28:16 2009
Return-Path: <java-user-return-42720-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71927 invoked from network); 9 Oct 2009 12:28:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 12:28:16 -0000
Received: (qmail 57684 invoked by uid 500); 9 Oct 2009 12:28:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57593 invoked by uid 500); 9 Oct 2009 12:28:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57583 invoked by uid 99); 9 Oct 2009 12:28:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 12:28:14 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of enrico.detoma@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 12:28:03 +0000
Received: by bwz22 with SMTP id 22so6050471bwz.5
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 05:27:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=zrU9qs9SQZNM9GhxglQVW0muoOqJQ5NH0I6Y99vYUC4=;
        b=bXbtFWxlMtZd0QMWYE4GZqRMslNO4qK4WhNHGzwk+zOdGPhbinbJfU5qNbxFsDX6iC
         Hbk/qwgvNUlrqkT60mYP1xv+eoFDg1ojKSx5OkZGyGzh76f0ip5SZIY0+Rn5B4nT7ioF
         pMDR+Gj8Pma5QGt0YjrhUFGzQLrmf+iLXbr10=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=UmXgna6frdT4LTz5Pi8d8TonOvsIGjV19H3KgsVQsoN5BmXMMtY/AJn6l9o4nHCZy0
         WkxKL6HUry/PiLuiGy1y9w7p9AJ7/B9TneVIcQiq4CF17ro/Y05TC2uykNb4sDB5TZFk
         7VxvKPh5bChR9d9C0Qj4vJYxtIiJouTdC5K7g=
MIME-Version: 1.0
Received: by 10.204.34.65 with SMTP id k1mr847076bkd.111.1255091263387; Fri, 
	09 Oct 2009 05:27:43 -0700 (PDT)
In-Reply-To: <4CA47FE785CF4DE2874A962EF09951FE@VEGA>
References: <b18d3be30910080642x4501b26bm9ae1ae07c43aa0e1@mail.gmail.com>
	 <4CA47FE785CF4DE2874A962EF09951FE@VEGA>
Date: Fri, 9 Oct 2009 14:27:43 +0200
Message-ID: <b18d3be30910090527t3ae31546w8c5de968359d4a98@mail.gmail.com>
Subject: Re: Lucene 2.9.0 [PROBLEM] : TokenStream API (incrementToken / 
	captureState / restoreState), cannot implement a "stop phrases filter"
From: Enrico Detoma <enrico.detoma@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000325557532ea397c04757fb4bb
X-Virus-Checked: Checked by ClamAV on apache.org

--000325557532ea397c04757fb4bb
Content-Type: text/plain; charset=ISO-8859-1

Thank you.
Starting from CachingTokenFilter was indeed the correct way to proceed.

Regards
Enrico


2009/10/8 Uwe Schindler <uwe@thetaphi.de>

> restoreState only restores the token contents, not the complete stream. So
> you cannot roll back the token stream (and this was also not possible with
> the old API). The while loop at the end of you code is not working as you
> exspect because of this. You may use CachingTokenFilter, which can be reset
> and consumed again, as a source for further work.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>

--000325557532ea397c04757fb4bb--

From java-user-return-42721-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 13:40:25 2009
Return-Path: <java-user-return-42721-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6752 invoked from network); 9 Oct 2009 13:40:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 13:40:25 -0000
Received: (qmail 89376 invoked by uid 500); 9 Oct 2009 13:40:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89289 invoked by uid 500); 9 Oct 2009 13:40:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89279 invoked by uid 99); 9 Oct 2009 13:40:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 13:40:22 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of nigelspleen@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 13:40:12 +0000
Received: by fxm2 with SMTP id 2so6330864fxm.28
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 06:39:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=dpCLuRBlwI56ulfGvz42ZvJNKLeOySPbpWLjxl9rHC8=;
        b=bc3ilcdB1gw4v7wC+1QGvGRKUaZneELiGc6YnfvSgHi/ESTHlF/RRo+z33ExhEDqRQ
         dhyFhDV2YxltMirLkiBqhuPKeaGys5B8vPrZVPA1LWydHbknp2gH0E+uC22UawcdPqp8
         ho9iwr9G3ugZynW1joaQsMKngrXZJ8AfMpkng=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=lyBTn4/LYHVCHlLHfciixpxc8UhkRbFl88R7B1x61hFrTHZAJRMywCuG9QwBr3kmVK
         yZEAI8Y3Hp4vRcqxknwRKLDOHE9kTSV9GwLUiUOuBjl2czpcNvqy8Nd/FvJ/WaBQwq2r
         BqUf9gaIafZ+1cFiGCFVRBV9SI7b4pRvKz1nE=
MIME-Version: 1.0
Received: by 10.102.242.35 with SMTP id p35mr1078014muh.113.1255095591566; 
	Fri, 09 Oct 2009 06:39:51 -0700 (PDT)
In-Reply-To: <4ACE37B9.1050408@gmail.com>
References: <843920a30910011415g4d6befm58798bddfd9888d8@mail.gmail.com>
	 <843920a30910051730o19353216ue2cc35098b90137d@mail.gmail.com>
	 <85d3c3b60910051739x2c42e50yf56e098032b59b1@mail.gmail.com>
	 <843920a30910071251q2e7850b7yd15edff35fd88d87@mail.gmail.com>
	 <4ACCF3E7.7010500@gmail.com>
	 <843920a30910081102w3f937e08rd1d78f3d80995557@mail.gmail.com>
	 <4ACE37B9.1050408@gmail.com>
Date: Fri, 9 Oct 2009 09:39:51 -0400
Message-ID: <843920a30910090639n23bbf8b1p804fe575385f63a0@mail.gmail.com>
Subject: Re: Efficiently reopening remotely-distributed indexes in 2.9?
From: Nigel <nigelspleen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163641743de4ff84047580b6da
X-Virus-Checked: Checked by ClamAV on apache.org

--00163641743de4ff84047580b6da
Content-Type: text/plain; charset=ISO-8859-1

Got it -- thanks, Mark!  (Recently I read elsewhere in the archives of this
list about the value or lack thereof of segments.gen, so skipping that file
was in the back of my mind as well.)

Chris

On Thu, Oct 8, 2009 at 3:04 PM, Mark Miller <markrmiller@gmail.com> wrote:

> Nigel wrote:
> > Thanks, Mark.  That makes sense.  I guess if you do it in the right
> order,
> > you're guaranteed to have the files in a consistent state, since the only
> > thing that's actually overwritten is the segments.gen file at the end.
> >
> The main thing to do is to copy the segments_N files last - thats what a
> Reader will use to see there is a new index version. The segments.gen
> files is a backup resort that shouldn't likely be used unless your on
> NFS from what I know.
> > What about the technique of creating a copy of the directory with hard
> links
> > and rsyncing changes into that copy?  Is that only necessary if you want
> to
> > be using the old and updated versions of the index simultaneously?
> >
> I think this was only necessary before IndexDeletionPolices - you didn't
> want the IndexWriter removing the files before you were done copying
> them out. You can manage that with a delete policy now though.
> > Thanks,
> > Chris
> >
> > On Wed, Oct 7, 2009 at 4:02 PM, Mark Miller <markrmiller@gmail.com>
> wrote:
> >
> >
> >> Solr just copies them into the same directory - Lucene files are write
> >> once, so its not much different than what happens locally.
> >>
> >> Nigel wrote:
> >>
> >>> Right now we logically re-open an index by making an updated copy of
> the
> >>> index in a new directory (using rsync etc.), opening the new copy, and
> >>> closing the old one.  We don't use IndexReader.reopen() because the
> >>>
> >> updated
> >>
> >>> index is in a different directory (as opposed to being updated
> in-place).
> >>>
> >>> (Reading about some of the 2.9 changes motivated me to look into
> actually
> >>> using reopen().  And Michael Busch and Mark Miller both pointed out
> that
> >>>
> >> I
> >>
> >>> was incorrect in saying that pre-2.9 reopen() wasn't more efficient
> than
> >>> just opening a new index -- I've read through that code now so I have
> at
> >>> least a basic understanding of what's happening there.  Anyway, it
> seems
> >>> like reopen() is a Good Thing, so I'd like to use it. (-:)
> >>>
> >>> So, my real question was whether there is a "recommended" way to update
> >>>
> >> an
> >>
> >>> index in-place with files copied from a separate indexing server.
> >>>
> >>> For example, do you simply rsync in the new cfs files, overwrite the
> >>> segments.gen and segments_XX files, and call reopen()?  Or create an
> >>>
> >> updated
> >>
> >>> copy in a new directory, then rename new directory to the old name once
> >>> you're sure you've copied everything successfully, then call reopen()?
> >>>
> >>  What
> >>
> >>> does Solr do?
> >>>
> >>> Thanks,
> >>> Chris
> >>>
> >
> >
>
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00163641743de4ff84047580b6da--

From java-user-return-42722-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 16:12:07 2009
Return-Path: <java-user-return-42722-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56095 invoked from network); 9 Oct 2009 16:12:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 16:12:07 -0000
Received: (qmail 72639 invoked by uid 500); 9 Oct 2009 16:12:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72577 invoked by uid 500); 9 Oct 2009 16:12:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72567 invoked by uid 99); 9 Oct 2009 16:12:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 16:12:04 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of till.kolter@googlemail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 16:11:53 +0000
Received: by ewy26 with SMTP id 26so7648023ewy.5
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 09:11:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=G7SqNOTWZqQTuXMAk05Ulp8e2I730/JYe8Cn2GHdZSQ=;
        b=wI6b742AOdJ76JbN+RUWAj7b+hXMYFY8nsNi3W3pPWozVj0osEKnFYPpOXu93zzCnH
         M5vJ6vNq5ZVERuTrRKMllmpOvVV0zfAwnAiq8yfkHZQM4hieCGemYsw6DB+o67bMCgRq
         Zi4kfuwzr/VJbKH3FNEpXhrsDXIQ9571nX64A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=WARm4gvDOOOnjMsCBgfpN+sYux+grAJH4v0ryh5y9g8m2COIY7J05TdK0x/2SzqQ7D
         0NVxRC83hH4bbAueGjmwmQJBoldLMwszg+ETTfWKro9ANo1eKpwsFh7+yuSmGFavW2HI
         xYx6iqfTcjpdmmQUSgJxlraeOe8wGGsbKVZHo=
MIME-Version: 1.0
Received: by 10.210.94.7 with SMTP id r7mr459915ebb.36.1255104693342; Fri, 09 
	Oct 2009 09:11:33 -0700 (PDT)
Date: Fri, 9 Oct 2009 18:11:33 +0200
Message-ID: <3433bf110910090911y96d3a19ga718eeb1ff4eca08@mail.gmail.com>
Subject: Getting left and right offsets of term search results
From: Till Kolter <till.kolter@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

I am quite new to Lucene, but I have searched the FAQs and consulted
the mailinglist archive. I debugged through the source codes as well.

I have writen an Analyzer, that analyzes a stream by sending it to a
whole pipeline of linguistic processing and uses the internal
representation to construct a TokenStream, that tokenizes chunks
(semantic units). The Term-Attribute String hold the abstract
representations of those units. For further uses (for instance:
highlighting the results in text), I need access to the
OffsetAttribute, that I defined in my TokenStream implementation. Like
in StandardTokenizer I defined an OffsetAttribute to save the left and
right values of the original chunks.

Now I want to search for all documents containing an
"AdjectivePhrase", get those APs from the Documents and highlight all
APs in the found documents.

I tried to find results by getting TermPositions with
"Reader.termPositions(term)" and then iterate over the positions, but
the positions only represent the left offset.

Is there another function to get structured results from term queries
over documents, where I can get the whole set of attributes, that I
constructed in the TokenStream with addAttribute(Class)? I did not
find such a function, but I guess I dont know all retrieval methods of
Lucene, yet. For my search I used the IndexSearcher.

Thanks
Till Kolter

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42723-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 17:16:25 2009
Return-Path: <java-user-return-42723-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86067 invoked from network); 9 Oct 2009 17:16:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 17:16:24 -0000
Received: (qmail 23695 invoked by uid 500); 9 Oct 2009 17:16:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23613 invoked by uid 500); 9 Oct 2009 17:16:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23603 invoked by uid 99); 9 Oct 2009 17:16:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 17:16:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [91.121.16.47] (HELO ns23917.ovh.net) (91.121.16.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 17:16:11 +0000
Received: (qmail 28560 invoked by uid 508); 9 Oct 2009 17:21:16 -0000
Received: from unknown (HELO spotter-dclnx) (88.182.17.109)
  by ns23917.ovh.net with AES256-SHA encrypted SMTP; 9 Oct 2009 17:21:16 -0000
Received: from techno by spotter-dclnx with local (Exim 4.69)
	(envelope-from <dcausse@spotter.com>)
	id 1MwJ4S-0002Rg-Ec
	for java-user@lucene.apache.org; Fri, 09 Oct 2009 19:16:00 +0200
Date: Fri, 9 Oct 2009 19:16:00 +0200
From: David Causse <dcausse@spotter.com>
To: java-user@lucene.apache.org
Subject: Re: Getting left and right offsets of term search results
Message-ID: <20091009171600.GA21017@spotter-dclnx>
Mail-Followup-To: David Causse <dcausse@spotter.com>,
	java-user@lucene.apache.org
References: <3433bf110910090911y96d3a19ga718eeb1ff4eca08@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <3433bf110910090911y96d3a19ga718eeb1ff4eca08@mail.gmail.com>
User-Agent: Mutt/1.5.18 (2008-05-17)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

we also index linguistic data, but (someone correct me if I'm wrong) you
have to deal with what the lucene store is offering.
You can store 
usable on the search side : 
  - a term (TermAttribute)
  - the position of the term (PositionIncrementAttribute)
  - an arbitrary payload (PayloadAttribute)
usable when you found results :
  - TermVector (no attribute or OffsetAttribute and/or PositionIncrementAttribute) 
  - Any data you stored in a field (arbitrary data)

OffsetAttribute are stored in TermVector (if you specified you wanted
it) you can't search data within the TermPositionVector but you can
iterate your results and ask the reader to return the TermPositionVector
for a specific document and a field.

Lucene can't store arbitrary Attributes they are only useful in a
analyze pipe. You have to serialize (if you want to search for this
info) the data inside the term itself (eg add a char at the end of term
to describe the part of speech) and inside the Payload for position
specific info (eg a relation id, paragraph id or whatever you want :it's
a byte[]).

With those techniques you can do many things, you have to be inventive but
with payloads you can do very interesting things.
You can also store the offsets inside the payload and don't bother with
term vector!
Well there is really hundreds of solutions to deal with linguistic data
inside lucene. What is hard is when you have to deal with relations but
a triplet store should be more adapted for this.

I suggest also to store a serialized form of your internal
representation in the index, it may be more flexible to use it versus
TermPositionvector.

Hope it helps.

On Fri, Oct 09, 2009 at 06:11:33PM +0200, Till Kolter wrote:
> I am quite new to Lucene, but I have searched the FAQs and consulted
> the mailinglist archive. I debugged through the source codes as well.
> 
> I have writen an Analyzer, that analyzes a stream by sending it to a
> whole pipeline of linguistic processing and uses the internal
> representation to construct a TokenStream, that tokenizes chunks
> (semantic units). The Term-Attribute String hold the abstract
> representations of those units. For further uses (for instance:
> highlighting the results in text), I need access to the
> OffsetAttribute, that I defined in my TokenStream implementation. Like
> in StandardTokenizer I defined an OffsetAttribute to save the left and
> right values of the original chunks.
> 
> Now I want to search for all documents containing an
> "AdjectivePhrase", get those APs from the Documents and highlight all
> APs in the found documents.
> 
> I tried to find results by getting TermPositions with
> "Reader.termPositions(term)" and then iterate over the positions, but
> the positions only represent the left offset.
> 
> Is there another function to get structured results from term queries
> over documents, where I can get the whole set of attributes, that I
> constructed in the TokenStream with addAttribute(Class)? I did not
> find such a function, but I guess I dont know all retrieval methods of
> Lucene, yet. For my search I used the IndexSearcher.
> 
> Thanks
> Till Kolter
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 

-- 
David Causse
Spotter
http://www.spotter.com/

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42724-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 17:31:27 2009
Return-Path: <java-user-return-42724-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93223 invoked from network); 9 Oct 2009 17:31:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 17:31:27 -0000
Received: (qmail 49943 invoked by uid 500); 9 Oct 2009 17:31:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49881 invoked by uid 500); 9 Oct 2009 17:31:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49871 invoked by uid 99); 9 Oct 2009 17:31:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 17:31:25 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 17:31:15 +0000
Received: by vws29 with SMTP id 29so518042vws.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 10:30:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=kaXzLnMnSkDxcWZOOl1gOdOuJaWzEkmVjSFj5rhxR0U=;
        b=K87/d0g9cMSR6hbmJnzshunRbAefP809VGd9GlWSWD/jkusiBnmbuTszf30juSB0uQ
         0ckBgqDP8SSf5WDSHHGeq5IjAxC8EpAS7Bhy4K3E61iQg49yi3+FbfOzEUm2z8p19vBq
         nHTJxATiZMfTI8kLaDrSk8s6P3BenATByPvdM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=JT15eevh2Clf6rAUb/hU0p8bJ2Wcc15SXSTzvlrViLCAWgIfCL+Zmg9iJR31LA1UFR
         3yTKtxUrh7DqiHUJGFF2uo64xuDqOe5RK3bAdLhf51ikFV64/uLxC1lQcSbO69btePJP
         TN2pBXq62b0qhhlDKT6fZCx75oR6gkT0Ze5oM=
MIME-Version: 1.0
Received: by 10.220.10.133 with SMTP id p5mr4320019vcp.119.1255109453851; Fri, 
	09 Oct 2009 10:30:53 -0700 (PDT)
In-Reply-To: <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
Date: Fri, 9 Oct 2009 10:30:53 -0700
Message-ID: <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485e7c2e826aec3047583f1dd
X-Virus-Checked: Checked by ClamAV on apache.org

--001485e7c2e826aec3047583f1dd
Content-Type: text/plain; charset=ISO-8859-1

Thanks for the suggestions Erick. I am using Lucene 2.3. Terms are stored
and given Andrzej's comments in the follow up email sounds like it's not the
stored field issue. I'll keep investigating...

thanks,
Scott

On Thu, Oct 8, 2009 at 8:06 AM, Erick Erickson <erickerickson@gmail.com>wrote:

> I suspect your problem here is the line:
> document = indexReader.document( doc );
>
> See the caution in the docs
>
> You could try using lazy loading (so you don't load all
> the terms of the document, just those you're interested
> in). And I *think* (but it's been a while) that if the terms
> you load are indexed that'll help. But this is mostly
> a guess.
>
> What version of Lucene are you using???
>
> Good luck!
> Erick
>
> On Thu, Oct 8, 2009 at 10:56 AM, scott w <scottblanc@gmail.com> wrote:
>
> > Oops, forgot to include the class I mentioned. Here it is:
> >
> > public class QueryTermBoostingQuery extends CustomScoreQuery {
> >  private Map<String, Float> queryTermWeights;
> >  private float bias;
> >  private IndexReader indexReader;
> >
> >  public QueryTermBoostingQuery( Query q, Map<String, Float> termWeights,
> > IndexReader indexReader, float bias) {
> >    super( q );
> >    this.indexReader = indexReader;
> >    if (bias < 0 || bias > 1) {
> >      throw new IllegalArgumentException( "Bias must be between 0 and 1"
> );
> >    }
> >    this.bias = bias;
> >    queryTermWeights = termWeights;
> >  }
> >
> >  @Override
> >  public float customScore( int doc, float subQueryScore, float
> valSrcScore
> > ) {
> >    Document document;
> >    try {
> >      document = indexReader.document( doc );
> >    } catch (IOException e) {
> >      throw new SearchException( e );
> >    }
> >    float termWeightedScore = 0;
> >
> >    for (String field : queryTermWeights.keySet()) {
> >      String docFieldValue = document.get( field );
> >      if (docFieldValue != null) {
> >        Float weight = queryTermWeights.get( field );
> >        if (weight != null) {
> >          termWeightedScore += weight * Float.parseFloat( docFieldValue );
> >        }
> >      }
> >    }
> >    return bias * subQueryScore + (1 - bias) * termWeightedScore;
> >   }
> > }
> >
> > On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:
> >
> > > I am trying to come up with a performant query that will allow me to
> use
> > a
> > > custom score where the custom score is a sum-product over a set of
> query
> > > time weights where each weight gets applied only if the query time term
> > > exists in the document . So for example if I have a doc with three
> > fields:
> > > company=Microsoft, city=Redmond, and size=large, I may want to score
> that
> > > document according to the following function: city==Microsoft ? .3 : 0
> *
> > > size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a subclass I
> > have
> > > tested that implements this with one extra component which is that it
> > allow
> > > the relevance score to be combined in.
> > >
> > > The problem is this custom score is not performant at all. For example,
> > on
> > > a small index of 5 million documents with 10 weights passed in it does
> > 0.01
> > > req/sec.
> > >
> > > Are there ways to make to compute the same custom score but in a much
> > more
> > > performant way?
> > >
> > > thanks,
> > > Scott
> > >
> >
>

--001485e7c2e826aec3047583f1dd--

From java-user-return-42725-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 17:41:13 2009
Return-Path: <java-user-return-42725-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95271 invoked from network); 9 Oct 2009 17:41:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 17:41:13 -0000
Received: (qmail 65972 invoked by uid 500); 9 Oct 2009 17:41:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65917 invoked by uid 500); 9 Oct 2009 17:41:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65907 invoked by uid 99); 9 Oct 2009 17:41:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 17:41:11 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 17:41:01 +0000
Received: by yxe30 with SMTP id 30so9826387yxe.29
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 10:40:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=whS4F4wXwzKXXeoEBY+i20KWmJ0cJCZ4PDaWbJh71xM=;
        b=o566mT3lp99OCZCuMhWIc6ifivzWTl7S5WJzs7E5LAWN9E8attXcQ+W3sHDSPo7S5e
         rro5pK8hczAM/Hs2/fErlTdSjdg9f5Xz3cOTXlT2frShbABjIJZsLmiKFk+RKGd++CFu
         VgtPCYsYSoFnkMgZh7sGS/N1N93+zgh5yYU6o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ElPkcOKy1WkFIrnV5FNg47ND52kPkaW7vz83yFnJwy6+KXcbWcZXR8QBeCzPY/Hlh2
         j716dOshCYcjIRvK0DBZOilLjjO9+zl8BXtLDFEJSjB101WEJ9vT6NhqFj/emeLTq9PE
         5a/38HtOjMG9JkbMtZ+6y71S4XZT9aQ2KjrCw=
MIME-Version: 1.0
Received: by 10.91.189.3 with SMTP id r3mr1574731agp.48.1255110040491; Fri, 09 
	Oct 2009 10:40:40 -0700 (PDT)
In-Reply-To: <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
Date: Fri, 9 Oct 2009 10:40:40 -0700
Message-ID: <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e645b95e1e151b047584146e
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e645b95e1e151b047584146e
Content-Type: text/plain; charset=ISO-8859-1

Scott,

  To reiterate what Erick and Andrzej's said: calling
IndexReader.document(docId)
in your inner scoring loop is the source of your performance problem -
iterating
over all these stored fields is what is killing you.

  To do this a better way, can you try to explain exactly what this Scorer
is
supposed to be doing?  You're extending CustomScoreQuery and which
is usually used with ValueSourceQuery, but you don't use that part, and
ignore the valSrcScore in your computation.

  Where are the parts of your score coming from?  The termWeight map
is used how exactly?

  -jake

On Fri, Oct 9, 2009 at 10:30 AM, scott w <scottblanc@gmail.com> wrote:

> Thanks for the suggestions Erick. I am using Lucene 2.3. Terms are stored
> and given Andrzej's comments in the follow up email sounds like it's not
> the
> stored field issue. I'll keep investigating...
>
> thanks,
> Scott
>
> On Thu, Oct 8, 2009 at 8:06 AM, Erick Erickson <erickerickson@gmail.com
> >wrote:
>
> > I suspect your problem here is the line:
> > document = indexReader.document( doc );
> >
> > See the caution in the docs
> >
> > You could try using lazy loading (so you don't load all
> > the terms of the document, just those you're interested
> > in). And I *think* (but it's been a while) that if the terms
> > you load are indexed that'll help. But this is mostly
> > a guess.
> >
> > What version of Lucene are you using???
> >
> > Good luck!
> > Erick
> >
> > On Thu, Oct 8, 2009 at 10:56 AM, scott w <scottblanc@gmail.com> wrote:
> >
> > > Oops, forgot to include the class I mentioned. Here it is:
> > >
> > > public class QueryTermBoostingQuery extends CustomScoreQuery {
> > >  private Map<String, Float> queryTermWeights;
> > >  private float bias;
> > >  private IndexReader indexReader;
> > >
> > >  public QueryTermBoostingQuery( Query q, Map<String, Float>
> termWeights,
> > > IndexReader indexReader, float bias) {
> > >    super( q );
> > >    this.indexReader = indexReader;
> > >    if (bias < 0 || bias > 1) {
> > >      throw new IllegalArgumentException( "Bias must be between 0 and 1"
> > );
> > >    }
> > >    this.bias = bias;
> > >    queryTermWeights = termWeights;
> > >  }
> > >
> > >  @Override
> > >  public float customScore( int doc, float subQueryScore, float
> > valSrcScore
> > > ) {
> > >    Document document;
> > >    try {
> > >      document = indexReader.document( doc );
> > >    } catch (IOException e) {
> > >      throw new SearchException( e );
> > >    }
> > >    float termWeightedScore = 0;
> > >
> > >    for (String field : queryTermWeights.keySet()) {
> > >      String docFieldValue = document.get( field );
> > >      if (docFieldValue != null) {
> > >        Float weight = queryTermWeights.get( field );
> > >        if (weight != null) {
> > >          termWeightedScore += weight * Float.parseFloat( docFieldValue
> );
> > >        }
> > >      }
> > >    }
> > >    return bias * subQueryScore + (1 - bias) * termWeightedScore;
> > >   }
> > > }
> > >
> > > On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:
> > >
> > > > I am trying to come up with a performant query that will allow me to
> > use
> > > a
> > > > custom score where the custom score is a sum-product over a set of
> > query
> > > > time weights where each weight gets applied only if the query time
> term
> > > > exists in the document . So for example if I have a doc with three
> > > fields:
> > > > company=Microsoft, city=Redmond, and size=large, I may want to score
> > that
> > > > document according to the following function: city==Microsoft ? .3 :
> 0
> > *
> > > > size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a subclass
> I
> > > have
> > > > tested that implements this with one extra component which is that it
> > > allow
> > > > the relevance score to be combined in.
> > > >
> > > > The problem is this custom score is not performant at all. For
> example,
> > > on
> > > > a small index of 5 million documents with 10 weights passed in it
> does
> > > 0.01
> > > > req/sec.
> > > >
> > > > Are there ways to make to compute the same custom score but in a much
> > > more
> > > > performant way?
> > > >
> > > > thanks,
> > > > Scott
> > > >
> > >
> >
>

--0016e645b95e1e151b047584146e--

From java-user-return-42726-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 19:26:51 2009
Return-Path: <java-user-return-42726-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34583 invoked from network); 9 Oct 2009 19:26:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 19:26:51 -0000
Received: (qmail 42088 invoked by uid 500); 9 Oct 2009 19:26:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42008 invoked by uid 500); 9 Oct 2009 19:26:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41997 invoked by uid 99); 9 Oct 2009 19:26:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:26:48 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:26:37 +0000
Received: from compute2.internal (compute2.internal [10.202.2.42])
	by gateway1.messagingengine.com (Postfix) with ESMTP id DB0D799ABC
	for <java-user@lucene.apache.org>; Fri,  9 Oct 2009 15:26:15 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute2.internal (MEProxy); Fri, 09 Oct 2009 15:26:15 -0400
X-Sasl-enc: GjYfYbuZ4mY2cJLqrMpmgxTzfEJmPJUzaJ0W2C1UiGhh 1255116375
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id 461EE6843B
	for <java-user@lucene.apache.org>; Fri,  9 Oct 2009 15:26:15 -0400 (EDT)
Message-ID: <4ACF8E56.7040001@fastmail.fm>
Date: Fri, 09 Oct 2009 20:26:14 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: How do you properly use NumericField
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hi

I currently use NumberTools.longToString() to add integer fields to an 
index and allow range searching, then when searching I then preprocess 
the query (using regular expressions) and convert integer fields to 
NumberTools.longToString  before it is parsed by the QueryParser, then 
when I return the results I use NumberTools.stringToLong(), so my 
implementation is flaky. Now I'm using Lucene 2.9 I thought Id use 
NumericField and hoped I could remove the preprocessing instead but I'm 
really not clear what I do on the indexing and searching side. I've even 
just bought the MEAP version of Lucene Action 2nd Edition and it doesn't 
even get a mention (nor does NumberTools for that matter it just 
mentions padding numbers with zeroes).

So please anyone got a simple example of how to add a numeric field to 
an index, and what has to be done on the search side, assuming receiving 
a text string that gets parsed by the QueryParser

thanks Paul



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42727-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 19:29:56 2009
Return-Path: <java-user-return-42727-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35396 invoked from network); 9 Oct 2009 19:29:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 19:29:56 -0000
Received: (qmail 46197 invoked by uid 500); 9 Oct 2009 19:29:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46135 invoked by uid 500); 9 Oct 2009 19:29:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46125 invoked by uid 99); 9 Oct 2009 19:29:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:29:53 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:29:44 +0000
Received: by qyk26 with SMTP id 26so6348314qyk.5
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 12:29:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=aUEvr13yBNVItuUYUKxzM0RugzOBtYc0D57AsDaV8mc=;
        b=Jn22bceE7m31hYycwr+gKAaLcbX+ggwrMhVf8F+mt0ui7svsq2Dd7Eql+zlX9r6wjH
         e0KALu9i4ir/LK9mcZyGaV1eD+GrjqGvAaPRmSBEEwigWTuiwea4K/dJo9enS+GNbmcf
         glAVwth6vM57mGg1jpsBbMspJte4eCev3zbJ4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=FbOh/jO0otyEh5X9Ou4LEkL5nRKIhAsMHuhqg8uATtwzmOBIs7SxAEzxcGa4BGB4Ua
         3eUENEJqyUcP8GpGKS9uOoGOLYk4Iw5s1jF1+DyDLnbD3ikVH2GqhjSdKbMHJ2lQ+9X5
         5jzgF8NsiDkdnXLJx1tjWdz0kWLppeSPVcq2w=
MIME-Version: 1.0
Received: by 10.224.18.156 with SMTP id w28mr3022428qaa.221.1255116563150; 
	Fri, 09 Oct 2009 12:29:23 -0700 (PDT)
In-Reply-To: <4b124c310910082018q6f5ab9e0r700f5eb3eefbbc6b@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <4b124c310910082018q6f5ab9e0r700f5eb3eefbbc6b@mail.gmail.com>
Date: Fri, 9 Oct 2009 12:29:23 -0700
Message-ID: <85d3c3b60910091229v4dc9e1e8s6287ca493440773c@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Jake and John,

It would be interesting and enlightening to see NRT performance
numbers in a variety of configurations. The best way to go about
this is to post benchmarks that others may run in their
environment which can then be tweaked for their unique edge
cases. I wish I had more time to work on it.

-J

On Thu, Oct 8, 2009 at 8:18 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> Jason,
>
> On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <jason.rutherglen@gmail.=
com
>> wrote:
>
>> Today near realtime search (with or without SSDs) comes at a
>> price, that is reduced indexing speed due to continued in RAM
>> merging. People typically hack something together where indexes
>> are held in a RAMDir until being flushed to disk. The problem
>> with this is, merging in the background becomes really tricky
>> unless it's performed inside of IndexWriter (see LUCENE-1313 and
>> IW.getReader). There is the Zoie system which uses the RAMDir
>> solution, however it's implemented using a customized deleted
>> doc set based on a bloomfilter backed by an inefficient RB tree
>> which slows down queries. There's always a trade off when trying
>> to build an NRT system, currently.
>>
>
> =A0I'm not sure what numbers you are using to justify saying that zoie
> "slows down queries" - latency at LinkedIn using zoie has a typical
> median response time of 4-8ms at the searcher node level (slower
> at the broker due to a lot of custom stuff that happens before
> queries are actually sent to the nodex), while dealing with sustained
> rapid indexing throughput, all with basically zero time between indexing
> event to index visibility (ie. true real-time, not "near real time", unle=
ss
> indexing events are coming in *very* fast).
>
> =A0You say there's a tradeoff, but as you should remember from your
> time at LinkedIn, we do distributed realtime faceted search while
> maintaining extremely low latency and still indexing sometimes more
> than a thousand new docs a minute per node (I should dredge up
> some new numbers to verify what that is exactly these days).
>
>
> Deletes can pile up in segments so the
>> BalancedSegmentMergePolicy could be used to remove those faster
>> than LogMergePolicy, however I haven't tested it, and it may be
>> trying to not do large segment merges altogether which IMO
>> is less than ideal because query performance soon degrades
>> (similar to an unoptimized index).
>>
>
> Not optimizing all the way has shown in our case to actually be
> *better* than the "optimal" case of a 1-segment index, at least in
> the case of realtime indexing at rapid update pace.
>
>
> =A0-jake
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42728-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 19:38:51 2009
Return-Path: <java-user-return-42728-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37375 invoked from network); 9 Oct 2009 19:38:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 19:38:51 -0000
Received: (qmail 57820 invoked by uid 500); 9 Oct 2009 19:38:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57750 invoked by uid 500); 9 Oct 2009 19:38:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57739 invoked by uid 99); 9 Oct 2009 19:38:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:38:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:38:39 +0000
Received: by ywh14 with SMTP id 14so2010671ywh.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 12:37:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=UQHYtj0OhAiBhZZyOLrhg5Ok+BcUqSdN+0h6alhX2gM=;
        b=Rr7Xr/dnzCy7b5uynh8j5fmKlkNmHtRwPYSPqWi74mx29EcGT6Kmlek/3Qc1UoqP7O
         SMuxhUDfB21RzxD+3N5CUBs2329Wx8ZI/+mWEaKtHUDzzwFQHqnraLpCGpFLIkDDC6VS
         YMorvILAvgvBgFRXn4Y1gDgoPyW6MAnOu8iyM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=MFwU4XQ0McVSstbXgkANziyl+hee+MQ65bC52/A/Zs5AU9P1GXJWxuFpqIUTFvxi57
         soKfNON5N5Z+9I5QUCoP4iri5jkrZ+jPHGgPuw52diwDIilbXZfmgJdrsA/X/5d3lu0u
         6olD4T65IwY8D2MKE4bssu4r/JNXhMOeVNe9w=
MIME-Version: 1.0
Received: by 10.90.127.20 with SMTP id z20mr1604616agc.118.1255117038053; Fri, 
	09 Oct 2009 12:37:18 -0700 (PDT)
In-Reply-To: <85d3c3b60910091229v4dc9e1e8s6287ca493440773c@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <4b124c310910082018q6f5ab9e0r700f5eb3eefbbc6b@mail.gmail.com>
	 <85d3c3b60910091229v4dc9e1e8s6287ca493440773c@mail.gmail.com>
Date: Fri, 9 Oct 2009 12:37:18 -0700
Message-ID: <4b124c310910091237v110ee253l1836170549497786@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e89ec346997047585b531
X-Virus-Checked: Checked by ClamAV on apache.org

--0016361e89ec346997047585b531
Content-Type: text/plain; charset=ISO-8859-1

Jason,

  We've been running some perf/load/stress tests lately, but on a suggestion

from Ted Dunning, I've been trying to come up with a more "realistic" set of
stress
tests and indexing rates to see where NRT performs well and where it does
not,
instead of just indexing at maximum rate, looping over all docs in the test
set
and then doing them again and again.

  Once we've got a good test set, which hits on the variety of dimensions:
indexing
rate, document size, query rate while indexing, and delay-to-visibility of
indexed docs,
we'll certainly post that, as John did for the zoie tests on the zoie wiki.

  -jake

On Fri, Oct 9, 2009 at 12:29 PM, Jason Rutherglen <
jason.rutherglen@gmail.com> wrote:

> Jake and John,
>
> It would be interesting and enlightening to see NRT performance
> numbers in a variety of configurations. The best way to go about
> this is to post benchmarks that others may run in their
> environment which can then be tweaked for their unique edge
> cases. I wish I had more time to work on it.
>
> -J
>
> On Thu, Oct 8, 2009 at 8:18 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> > Jason,
> >
> > On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <
> jason.rutherglen@gmail.com
> >> wrote:
> >
> >> Today near realtime search (with or without SSDs) comes at a
> >> price, that is reduced indexing speed due to continued in RAM
> >> merging. People typically hack something together where indexes
> >> are held in a RAMDir until being flushed to disk. The problem
> >> with this is, merging in the background becomes really tricky
> >> unless it's performed inside of IndexWriter (see LUCENE-1313 and
> >> IW.getReader). There is the Zoie system which uses the RAMDir
> >> solution, however it's implemented using a customized deleted
> >> doc set based on a bloomfilter backed by an inefficient RB tree
> >> which slows down queries. There's always a trade off when trying
> >> to build an NRT system, currently.
> >>
> >
> >  I'm not sure what numbers you are using to justify saying that zoie
> > "slows down queries" - latency at LinkedIn using zoie has a typical
> > median response time of 4-8ms at the searcher node level (slower
> > at the broker due to a lot of custom stuff that happens before
> > queries are actually sent to the nodex), while dealing with sustained
> > rapid indexing throughput, all with basically zero time between indexing
> > event to index visibility (ie. true real-time, not "near real time",
> unless
> > indexing events are coming in *very* fast).
> >
> >  You say there's a tradeoff, but as you should remember from your
> > time at LinkedIn, we do distributed realtime faceted search while
> > maintaining extremely low latency and still indexing sometimes more
> > than a thousand new docs a minute per node (I should dredge up
> > some new numbers to verify what that is exactly these days).
> >
> >
> > Deletes can pile up in segments so the
> >> BalancedSegmentMergePolicy could be used to remove those faster
> >> than LogMergePolicy, however I haven't tested it, and it may be
> >> trying to not do large segment merges altogether which IMO
> >> is less than ideal because query performance soon degrades
> >> (similar to an unoptimized index).
> >>
> >
> > Not optimizing all the way has shown in our case to actually be
> > *better* than the "optimal" case of a 1-segment index, at least in
> > the case of realtime indexing at rapid update pace.
> >
> >
> >  -jake
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016361e89ec346997047585b531--

From java-user-return-42729-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 19:50:09 2009
Return-Path: <java-user-return-42729-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40509 invoked from network); 9 Oct 2009 19:50:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 19:50:09 -0000
Received: (qmail 73254 invoked by uid 500); 9 Oct 2009 19:50:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73184 invoked by uid 500); 9 Oct 2009 19:50:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73174 invoked by uid 99); 9 Oct 2009 19:50:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:50:07 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 19:49:57 +0000
Received: by yxe30 with SMTP id 30so9925826yxe.29
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 12:48:36 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.209.10 with SMTP id h10mr5426601ybg.141.1255117716476; 
	Fri, 09 Oct 2009 12:48:36 -0700 (PDT)
In-Reply-To: <4ACF8E56.7040001@fastmail.fm>
References: <4ACF8E56.7040001@fastmail.fm>
Date: Fri, 9 Oct 2009 15:48:36 -0400
Message-ID: <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
Subject: Re: How do you properly use NumericField
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org, paul_t100@fastmail.fm
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On Fri, Oct 9, 2009 at 3:26 PM, Paul Taylor <paul_t100@fastmail.fm> wrote:

> I currently use NumberTools.longToString() to add integer fields to
> an index and allow range searching, then when searching I then
> preprocess the query (using regular expressions) and convert integer
> fields to NumberTools.longToString before it is parsed by the
> QueryParser, then when I return the results I use
> NumberTools.stringToLong(), so my implementation is flaky. Now I'm
> using Lucene 2.9 I thought Id use NumericField and hoped I could
> remove the preprocessing instead but I'm really not clear what I do
> on the indexing and searching side. I've even just bought the MEAP
> version of Lucene Action 2nd Edition and it doesn't even get a
> mention (nor does NumberTools for that matter it just mentions
> padding numbers with zeroes).
>
> So please anyone got a simple example of how to add a numeric field
> to an index, and what has to be done on the search side, assuming
> receiving a text string that gets parsed by the QueryParser

The next LIA2 MEAP update, which should be out very soon, covers
NumericField and also shows how to extend QueryParser (by subclassing
and overriding newRangeQuery) to properly create a NumericRangeQuery,
like this:

  static class NumericRangeQueryParser extends QueryParser {
    public NumericRangeQueryParser(String field, Analyzer a) {
      super(field, a);
    }
    public Query getRangeQuery(String field,
                               String part1,
                               String part2,
                               boolean inclusive)
        throws ParseException {
      TermRangeQuery query = (TermRangeQuery)
        super.getRangeQuery(field, part1, part2,
                              inclusive);
      if ("price".equals(field)) {
        return NumericRangeQuery.newDoubleRange(
                      "price",
                      Double.parseDouble(
                           query.getLowerTerm()),
                      Double.parseDouble(
                           query.getUpperTerm()),
                      query.includesLower(),
                      query.includesUpper());
      } else {
        return query;
      }
    }
  }

It still relies on super.getRangeQuery() for non-numeric fields.  If
you don't have non-numeric fields that accept range queries you can
simply call NumericRangeQuery.newXXXRange directly.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42730-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:02:16 2009
Return-Path: <java-user-return-42730-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43820 invoked from network); 9 Oct 2009 20:02:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:02:16 -0000
Received: (qmail 87049 invoked by uid 500); 9 Oct 2009 20:02:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86994 invoked by uid 500); 9 Oct 2009 20:02:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86984 invoked by uid 99); 9 Oct 2009 20:02:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:02:13 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:02:02 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 55900D36003
	for <java-user@lucene.apache.org>; Fri,  9 Oct 2009 22:01:12 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id DTJw4d2gb7ZY for <java-user@lucene.apache.org>;
	Fri,  9 Oct 2009 22:01:01 +0200 (CEST)
Received: from VEGA (unknown [85.101.98.57])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 293FAD36001
	for <java-user@lucene.apache.org>; Fri,  9 Oct 2009 22:01:01 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4ACF8E56.7040001@fastmail.fm> <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
Subject: RE: How do you properly use NumericField
Date: Fri, 9 Oct 2009 23:01:02 +0300
Message-ID: <3CFE240DCD5E418CB42F077FA47E1DDF@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
Thread-Index: AcpJGbmUXtX+zkLxQliOsLJh9nwfqQAATsCw
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Paul,

for creating NumericFields just refer to the JavaDoc. As Mike said on the
query side you can create NumericRangeQuery directly (recommended) - see
javadocs. If you want to use QueryParser, you have to customize it, as
QueryParser does not support NumericRangeQuery natively.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Friday, October 09, 2009 10:49 PM
> To: java-user@lucene.apache.org; paul_t100@fastmail.fm
> Subject: Re: How do you properly use NumericField
> 
> On Fri, Oct 9, 2009 at 3:26 PM, Paul Taylor <paul_t100@fastmail.fm> wrote:
> 
> > I currently use NumberTools.longToString() to add integer fields to
> > an index and allow range searching, then when searching I then
> > preprocess the query (using regular expressions) and convert integer
> > fields to NumberTools.longToString before it is parsed by the
> > QueryParser, then when I return the results I use
> > NumberTools.stringToLong(), so my implementation is flaky. Now I'm
> > using Lucene 2.9 I thought Id use NumericField and hoped I could
> > remove the preprocessing instead but I'm really not clear what I do
> > on the indexing and searching side. I've even just bought the MEAP
> > version of Lucene Action 2nd Edition and it doesn't even get a
> > mention (nor does NumberTools for that matter it just mentions
> > padding numbers with zeroes).
> >
> > So please anyone got a simple example of how to add a numeric field
> > to an index, and what has to be done on the search side, assuming
> > receiving a text string that gets parsed by the QueryParser
> 
> The next LIA2 MEAP update, which should be out very soon, covers
> NumericField and also shows how to extend QueryParser (by subclassing
> and overriding newRangeQuery) to properly create a NumericRangeQuery,
> like this:
> 
>   static class NumericRangeQueryParser extends QueryParser {
>     public NumericRangeQueryParser(String field, Analyzer a) {
>       super(field, a);
>     }
>     public Query getRangeQuery(String field,
>                                String part1,
>                                String part2,
>                                boolean inclusive)
>         throws ParseException {
>       TermRangeQuery query = (TermRangeQuery)
>         super.getRangeQuery(field, part1, part2,
>                               inclusive);
>       if ("price".equals(field)) {
>         return NumericRangeQuery.newDoubleRange(
>                       "price",
>                       Double.parseDouble(
>                            query.getLowerTerm()),
>                       Double.parseDouble(
>                            query.getUpperTerm()),
>                       query.includesLower(),
>                       query.includesUpper());
>       } else {
>         return query;
>       }
>     }
>   }
> 
> It still relies on super.getRangeQuery() for non-numeric fields.  If
> you don't have non-numeric fields that accept range queries you can
> simply call NumericRangeQuery.newXXXRange directly.
> 
> Mike
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42731-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:07:04 2009
Return-Path: <java-user-return-42731-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45028 invoked from network); 9 Oct 2009 20:07:04 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:07:04 -0000
Received: (qmail 92841 invoked by uid 500); 9 Oct 2009 20:07:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92770 invoked by uid 500); 9 Oct 2009 20:07:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92760 invoked by uid 99); 9 Oct 2009 20:07:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:07:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:06:52 +0000
Received: by qyk26 with SMTP id 26so6376541qyk.5
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 13:06:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=PoDyU3opnv/Nuv0Dhr9pAJIpu8CYteMwR5QwV48RhFs=;
        b=MnHxGhNn7h2cA59wYFPa6+QYxG9ujIpuXoplLm9T1ou/g/fmob7XhvnYgnyh1f9Xvb
         XrKn1LfXe/kkwWKfeLY1LLV2H1y9BUYD+AQ1Mh05VDxzeYYymyTdNFKUBhaiglGcrOSk
         Z4sq/AAGF5dWxnzMXzc4Ha4LCQS60bmJHYVbU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=gq/MOGLTL9cutFCv2IBe2exk3EiavJ7+uAIsEHqUVNeLDSpNdXc/FI+4RX+yKmPhWH
         rV/0nfLzx+ciDIWSrseymEtwA+rizFgsk7Pp8YsNVE9c7TYLD9Ok+mPrH8ZW3hxTWmZU
         9xZTci1cdhrDHiiC/QUqT29EPFXSioM3M7tFE=
MIME-Version: 1.0
Received: by 10.224.36.103 with SMTP id s39mr3088397qad.74.1255118789124; Fri, 
	09 Oct 2009 13:06:29 -0700 (PDT)
In-Reply-To: <4b124c310910091237v110ee253l1836170549497786@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <4b124c310910082018q6f5ab9e0r700f5eb3eefbbc6b@mail.gmail.com>
	 <85d3c3b60910091229v4dc9e1e8s6287ca493440773c@mail.gmail.com>
	 <4b124c310910091237v110ee253l1836170549497786@mail.gmail.com>
Date: Fri, 9 Oct 2009 13:06:28 -0700
Message-ID: <85d3c3b60910091306h15fe0083l7917daf9ab03454e@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

The dimensions sound good.  It's unclear if you're going to post a
chart again, numbers, or code?  There's a LUCENE-1577 Jira issue for
code.

On Fri, Oct 9, 2009 at 12:37 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> Jason,
>
> =A0We've been running some perf/load/stress tests lately, but on a sugges=
tion
>
> from Ted Dunning, I've been trying to come up with a more "realistic" set=
 of
> stress
> tests and indexing rates to see where NRT performs well and where it does
> not,
> instead of just indexing at maximum rate, looping over all docs in the te=
st
> set
> and then doing them again and again.
>
> =A0Once we've got a good test set, which hits on the variety of dimension=
s:
> indexing
> rate, document size, query rate while indexing, and delay-to-visibility o=
f
> indexed docs,
> we'll certainly post that, as John did for the zoie tests on the zoie wik=
i.
>
> =A0-jake
>
> On Fri, Oct 9, 2009 at 12:29 PM, Jason Rutherglen <
> jason.rutherglen@gmail.com> wrote:
>
>> Jake and John,
>>
>> It would be interesting and enlightening to see NRT performance
>> numbers in a variety of configurations. The best way to go about
>> this is to post benchmarks that others may run in their
>> environment which can then be tweaked for their unique edge
>> cases. I wish I had more time to work on it.
>>
>> -J
>>
>> On Thu, Oct 8, 2009 at 8:18 PM, Jake Mannix <jake.mannix@gmail.com> wrot=
e:
>> > Jason,
>> >
>> > On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <
>> jason.rutherglen@gmail.com
>> >> wrote:
>> >
>> >> Today near realtime search (with or without SSDs) comes at a
>> >> price, that is reduced indexing speed due to continued in RAM
>> >> merging. People typically hack something together where indexes
>> >> are held in a RAMDir until being flushed to disk. The problem
>> >> with this is, merging in the background becomes really tricky
>> >> unless it's performed inside of IndexWriter (see LUCENE-1313 and
>> >> IW.getReader). There is the Zoie system which uses the RAMDir
>> >> solution, however it's implemented using a customized deleted
>> >> doc set based on a bloomfilter backed by an inefficient RB tree
>> >> which slows down queries. There's always a trade off when trying
>> >> to build an NRT system, currently.
>> >>
>> >
>> > =A0I'm not sure what numbers you are using to justify saying that zoie
>> > "slows down queries" - latency at LinkedIn using zoie has a typical
>> > median response time of 4-8ms at the searcher node level (slower
>> > at the broker due to a lot of custom stuff that happens before
>> > queries are actually sent to the nodex), while dealing with sustained
>> > rapid indexing throughput, all with basically zero time between indexi=
ng
>> > event to index visibility (ie. true real-time, not "near real time",
>> unless
>> > indexing events are coming in *very* fast).
>> >
>> > =A0You say there's a tradeoff, but as you should remember from your
>> > time at LinkedIn, we do distributed realtime faceted search while
>> > maintaining extremely low latency and still indexing sometimes more
>> > than a thousand new docs a minute per node (I should dredge up
>> > some new numbers to verify what that is exactly these days).
>> >
>> >
>> > Deletes can pile up in segments so the
>> >> BalancedSegmentMergePolicy could be used to remove those faster
>> >> than LogMergePolicy, however I haven't tested it, and it may be
>> >> trying to not do large segment merges altogether which IMO
>> >> is less than ideal because query performance soon degrades
>> >> (similar to an unoptimized index).
>> >>
>> >
>> > Not optimizing all the way has shown in our case to actually be
>> > *better* than the "optimal" case of a 1-segment index, at least in
>> > the case of realtime indexing at rapid update pace.
>> >
>> >
>> > =A0-jake
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42732-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:23:25 2009
Return-Path: <java-user-return-42732-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48030 invoked from network); 9 Oct 2009 20:23:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:23:25 -0000
Received: (qmail 8324 invoked by uid 500); 9 Oct 2009 20:23:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8264 invoked by uid 500); 9 Oct 2009 20:23:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8254 invoked by uid 99); 9 Oct 2009 20:23:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:23:22 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:23:11 +0000
Received: from compute2.internal (compute2.internal [10.202.2.42])
	by gateway1.messagingengine.com (Postfix) with ESMTP id 59DB98E4C7;
	Fri,  9 Oct 2009 16:19:42 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute2.internal (MEProxy); Fri, 09 Oct 2009 16:19:42 -0400
X-Sasl-enc: 0Rjw87/qvfTDmfyVfX9CJmzGFuQYJ1b3sz/AL1rQJGTa 1255119580
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id 9CD806849B;
	Fri,  9 Oct 2009 16:19:40 -0400 (EDT)
Message-ID: <4ACF9ADC.7090102@fastmail.fm>
Date: Fri, 09 Oct 2009 21:19:40 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: Michael McCandless <lucene@mikemccandless.com>
CC: java-user@lucene.apache.org
Subject: Re: How do you properly use NumericField
References: <4ACF8E56.7040001@fastmail.fm> <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
In-Reply-To: <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Michael McCandless wrote:
> On Fri, Oct 9, 2009 at 3:26 PM, Paul Taylor <paul_t100@fastmail.fm> wrote:
>
>   
>> I currently use NumberTools.longToString() to add integer fields to
>> an index and allow range searching, then when searching I then
>> preprocess the query (using regular expressions) and convert integer
>> fields to NumberTools.longToString before it is parsed by the
>> QueryParser, then when I return the results I use
>> NumberTools.stringToLong(), so my implementation is flaky. Now I'm
>> using Lucene 2.9 I thought Id use NumericField and hoped I could
>> remove the preprocessing instead but I'm really not clear what I do
>> on the indexing and searching side. I've even just bought the MEAP
>> version of Lucene Action 2nd Edition and it doesn't even get a
>> mention (nor does NumberTools for that matter it just mentions
>> padding numbers with zeroes).
>>
>> So please anyone got a simple example of how to add a numeric field
>> to an index, and what has to be done on the search side, assuming
>> receiving a text string that gets parsed by the QueryParser
>>     
>
> The next LIA2 MEAP update, which should be out very soon, covers
> NumericField and also shows how to extend QueryParser (by subclassing
> and overriding newRangeQuery) to properly create a NumericRangeQuery,
> like this:
>
>   static class NumericRangeQueryParser extends QueryParser {
>     public NumericRangeQueryParser(String field, Analyzer a) {
>       super(field, a);
>     }
>     public Query getRangeQuery(String field,
>                                String part1,
>                                String part2,
>                                boolean inclusive)
>         throws ParseException {
>       TermRangeQuery query = (TermRangeQuery)
>         super.getRangeQuery(field, part1, part2,
>                               inclusive);
>       if ("price".equals(field)) {
>         return NumericRangeQuery.newDoubleRange(
>                       "price",
>                       Double.parseDouble(
>                            query.getLowerTerm()),
>                       Double.parseDouble(
>                            query.getUpperTerm()),
>                       query.includesLower(),
>                       query.includesUpper());
>       } else {
>         return query;
>       }
>     }
>   }
>
> It still relies on super.getRangeQuery() for non-numeric fields.  If
> you don't have non-numeric fields that accept range queries you can
> simply call NumericRangeQuery.newXXXRange directly.
>
> Mike
>
>   
Ok, thanks but what do i do on the indexing side I dont understand this 
TriePart thing, and if the numeric field is not being used in a range 
query do I have to worry about that ?

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42733-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:33:13 2009
Return-Path: <java-user-return-42733-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49980 invoked from network); 9 Oct 2009 20:33:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:33:13 -0000
Received: (qmail 23440 invoked by uid 500); 9 Oct 2009 20:33:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23356 invoked by uid 500); 9 Oct 2009 20:33:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23346 invoked by uid 99); 9 Oct 2009 20:33:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:33:11 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:33:00 +0000
Received: from compute2.internal (compute2.internal [10.202.2.42])
	by gateway1.messagingengine.com (Postfix) with ESMTP id 1C09E9AA37;
	Fri,  9 Oct 2009 16:32:40 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute2.internal (MEProxy); Fri, 09 Oct 2009 16:32:40 -0400
X-Sasl-enc: QBZv49g3liy/zNvivucgCg40OffXwowt4z69YO453U3Y 1255120359
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id 62AD3679AE;
	Fri,  9 Oct 2009 16:32:39 -0400 (EDT)
Message-ID: <4ACF9DE6.5070109@fastmail.fm>
Date: Fri, 09 Oct 2009 21:32:38 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: Michael McCandless <lucene@mikemccandless.com>
CC: java-user@lucene.apache.org
Subject: Re: How do you properly use NumericField
References: <4ACF8E56.7040001@fastmail.fm> <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
In-Reply-To: <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Michael McCandless wrote:
> On Fri, Oct 9, 2009 at 3:26 PM, Paul Taylor <paul_t100@fastmail.fm> wrote
>   
> It still relies on super.getRangeQuery() for non-numeric fields.  If
> you don't have non-numeric fields that accept range queries you can
> simply call NumericRangeQuery.newXXXRange directly.
>
>
>   
For some indexes I have to use MultiFieldQueryParser, I cant see how I 
can specify for this to use my modified QueryParser rather then the 
default QueryParser, is this possible ?

thanks Paul


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42734-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:48:35 2009
Return-Path: <java-user-return-42734-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52413 invoked from network); 9 Oct 2009 20:48:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:48:35 -0000
Received: (qmail 37139 invoked by uid 500); 9 Oct 2009 20:48:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37061 invoked by uid 500); 9 Oct 2009 20:48:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37049 invoked by uid 99); 9 Oct 2009 20:48:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:48:32 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of john.wang@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:48:22 +0000
Received: by gxk26 with SMTP id 26so1176555gxk.11
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 13:47:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=CAYP+VJFW75jpRSzsnemZjhjhRg0LC3gp7jvCg2PLLo=;
        b=oOnRcu+i0FKPbmI/8lcGMNhRw2lhSlKrudbvEQDjU5eagtEYex4vqXIO3zoD0ZeexU
         nRagWWyxp2cjiuW1bTYSTLddhFCoO6QEKy6XRxLZJYpEliP5VV4CfI+VwSfu9eCBzqfc
         4JAtezG0V8aq/NrfliUCtUWcprFqg4hYwu++U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=EuEogyXUWP96ZoXq8aZsyrTasacf7yWf1lQ9P2HjA3FdahGLFVxQL4+0PE2cnNF73i
         L1+s/rEpPXaA0zhAsC5CpQMz3hDwOjrz4T+BELc4Vja+APq3RMet84ScvzZuhpeNxhuz
         s5xbQcQpWr17cYi+AChccA4rloKfBjzAg3HFA=
MIME-Version: 1.0
Received: by 10.100.27.12 with SMTP id a12mr3670245ana.110.1255121221513; Fri, 
	09 Oct 2009 13:47:01 -0700 (PDT)
In-Reply-To: <85d3c3b60910091306h15fe0083l7917daf9ab03454e@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <4b124c310910082018q6f5ab9e0r700f5eb3eefbbc6b@mail.gmail.com>
	 <85d3c3b60910091229v4dc9e1e8s6287ca493440773c@mail.gmail.com>
	 <4b124c310910091237v110ee253l1836170549497786@mail.gmail.com>
	 <85d3c3b60910091306h15fe0083l7917daf9ab03454e@mail.gmail.com>
Date: Fri, 9 Oct 2009 13:47:01 -0700
Message-ID: <8837fb770910091347q3e846cacld41370af1d5e19f6@mail.gmail.com>
Subject: Re: Realtime & distributed
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f80d6a8ef116047586ae36
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f80d6a8ef116047586ae36
Content-Type: text/plain; charset=ISO-8859-1

I can provide some preliminary numbers (we will need to do some detailed
analysis and post it somewhere):

Dataset: medline
starting index: empty.
add only, no update, for 30 min.
maximum indexing load, 1000 docs/ sec

Under stress, we take indexing events (add only) and stream into both
systems: Zoie and NRT consumer.

First dimension to track: realtime-ness:

making document available to searcher as readily as possible, so for each
batch stream we are getting, we call IndexWriter.commit for NRT:

We found the indexing speed for NRT is slow, e.g. in 30 min, zoie indexed
1.4 million docs, where as NRT indexed only 200k. This is actually expected,
because zoie is batching in memory to the disk index, the actual index is
into the small memory index. Where as NRT is always adding to the target
disk index.

We added batching to NRT, e.g. only call indexWriter.commit when the number
of requests = 1000. This made the indexing speed with NRT more comparable.
However, at this point, zoie remained to be realtime, and NRT is not.

IMHO, lucene NRT provides a good way to do stream/batch indexing without
having to make cumbersome calls to track IndexReader/Writer instances.
Furthermore, one of biggest benefit of Lucene NRT, 2.9 is the segment level
search. This is a major refactor that provided major benefits to lucene, and
it really shows off the incremental update feature for lucene.

The question of "how realtime", can lead to a very academic discussion :)

because under stress and heavy load, batching is fine, because load is
pushing the docs to be indexed, so the delay is small. It is one of those
semi-heavy load, docs are being batch until the queue size is "ripe" before
added to document, but when the load is lighter, the impact on indexing
performance becomes less significant.

To be truly realtime, IMHO, you need some sort of memory helper to handle
transient indexing requests. Doing that is where the actual challenge is.

-John

On Fri, Oct 9, 2009 at 1:06 PM, Jason Rutherglen <jason.rutherglen@gmail.com
> wrote:

> The dimensions sound good.  It's unclear if you're going to post a
> chart again, numbers, or code?  There's a LUCENE-1577 Jira issue for
> code.
>
> On Fri, Oct 9, 2009 at 12:37 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> > Jason,
> >
> >  We've been running some perf/load/stress tests lately, but on a
> suggestion
> >
> > from Ted Dunning, I've been trying to come up with a more "realistic" set
> of
> > stress
> > tests and indexing rates to see where NRT performs well and where it does
> > not,
> > instead of just indexing at maximum rate, looping over all docs in the
> test
> > set
> > and then doing them again and again.
> >
> >  Once we've got a good test set, which hits on the variety of dimensions:
> > indexing
> > rate, document size, query rate while indexing, and delay-to-visibility
> of
> > indexed docs,
> > we'll certainly post that, as John did for the zoie tests on the zoie
> wiki.
> >
> >  -jake
> >
> > On Fri, Oct 9, 2009 at 12:29 PM, Jason Rutherglen <
> > jason.rutherglen@gmail.com> wrote:
> >
> >> Jake and John,
> >>
> >> It would be interesting and enlightening to see NRT performance
> >> numbers in a variety of configurations. The best way to go about
> >> this is to post benchmarks that others may run in their
> >> environment which can then be tweaked for their unique edge
> >> cases. I wish I had more time to work on it.
> >>
> >> -J
> >>
> >> On Thu, Oct 8, 2009 at 8:18 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> >> > Jason,
> >> >
> >> > On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <
> >> jason.rutherglen@gmail.com
> >> >> wrote:
> >> >
> >> >> Today near realtime search (with or without SSDs) comes at a
> >> >> price, that is reduced indexing speed due to continued in RAM
> >> >> merging. People typically hack something together where indexes
> >> >> are held in a RAMDir until being flushed to disk. The problem
> >> >> with this is, merging in the background becomes really tricky
> >> >> unless it's performed inside of IndexWriter (see LUCENE-1313 and
> >> >> IW.getReader). There is the Zoie system which uses the RAMDir
> >> >> solution, however it's implemented using a customized deleted
> >> >> doc set based on a bloomfilter backed by an inefficient RB tree
> >> >> which slows down queries. There's always a trade off when trying
> >> >> to build an NRT system, currently.
> >> >>
> >> >
> >> >  I'm not sure what numbers you are using to justify saying that zoie
> >> > "slows down queries" - latency at LinkedIn using zoie has a typical
> >> > median response time of 4-8ms at the searcher node level (slower
> >> > at the broker due to a lot of custom stuff that happens before
> >> > queries are actually sent to the nodex), while dealing with sustained
> >> > rapid indexing throughput, all with basically zero time between
> indexing
> >> > event to index visibility (ie. true real-time, not "near real time",
> >> unless
> >> > indexing events are coming in *very* fast).
> >> >
> >> >  You say there's a tradeoff, but as you should remember from your
> >> > time at LinkedIn, we do distributed realtime faceted search while
> >> > maintaining extremely low latency and still indexing sometimes more
> >> > than a thousand new docs a minute per node (I should dredge up
> >> > some new numbers to verify what that is exactly these days).
> >> >
> >> >
> >> > Deletes can pile up in segments so the
> >> >> BalancedSegmentMergePolicy could be used to remove those faster
> >> >> than LogMergePolicy, however I haven't tested it, and it may be
> >> >> trying to not do large segment merges altogether which IMO
> >> >> is less than ideal because query performance soon degrades
> >> >> (similar to an unoptimized index).
> >> >>
> >> >
> >> > Not optimizing all the way has shown in our case to actually be
> >> > *better* than the "optimal" case of a 1-segment index, at least in
> >> > the case of realtime indexing at rapid update pace.
> >> >
> >> >
> >> >  -jake
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f80d6a8ef116047586ae36--

From java-user-return-42735-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:50:23 2009
Return-Path: <java-user-return-42735-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52724 invoked from network); 9 Oct 2009 20:50:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:50:23 -0000
Received: (qmail 41083 invoked by uid 500); 9 Oct 2009 20:50:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41002 invoked by uid 500); 9 Oct 2009 20:50:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40992 invoked by uid 99); 9 Oct 2009 20:50:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:50:20 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of siraj@jobdiva.com designates 64.147.106.2 as permitted sender)
Received: from [64.147.106.2] (HELO smtp.jobdiva.com) (64.147.106.2)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:50:11 +0000
Received: from localhost ([127.0.0.1])
	by smtp.jobdiva.com
	for java-user@lucene.apache.org;
	Fri, 9 Oct 2009 16:32:14 -0400
Message-ID: <4ACFA130.4090104@jobdiva.com>
Date: Fri, 09 Oct 2009 16:46:40 -0400
From: Siraj Haider <siraj@jobdiva.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Using Numeric Field
Content-Type: text/plain;
	charset="ISO-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi=2C
I have a Date field in my Lucene index that is currently stored as a=20
String field with format=3A YYYYMMDDHHMISS=2E  I perform RangeFilter on it=
=20
when searching and also sort the results specifying it as a String=20
field=2E  My question is=2C will converting it to a Numeric field and start=
=20
using NumericRangeFilter and sorting based on numeric field will give me=20=

some performance gain=3F or will it be insignificant=3F

thanks
-siraj


This electronic mail message and any attachments may contain information wh=
ich is privileged=2C sensitive and/or otherwise exempt from disclosure unde=
r applicable law=2E The information is intended only for the use of the ind=
ividual or entity named as the addressee above=2E If you are not the intend=
ed recipient=2C you are hereby notified that any disclosure=2C copying=2C d=
istribution =28electronic or otherwise=29 or forwarding of=2C or the taking=
 of any action in reliance on=2C the contents of this transmission is stric=
tly prohibited=2E If you have received this electronic transmission in erro=
r=2C please notify us by telephone=2C facsimile=2C or e-mail as noted above=
 to arrange for the return of any electronic mail or attachments=2E Thank Y=
ou=2E


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42736-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 20:50:36 2009
Return-Path: <java-user-return-42736-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52793 invoked from network); 9 Oct 2009 20:50:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 20:50:36 -0000
Received: (qmail 42823 invoked by uid 500); 9 Oct 2009 20:50:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42757 invoked by uid 500); 9 Oct 2009 20:50:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42747 invoked by uid 99); 9 Oct 2009 20:50:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:50:34 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.202] (HELO homiemail-a21.g.dreamhost.com) (208.97.132.202)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 20:50:23 +0000
Received: from infr-laptop7.olx.com.ar (unknown [201.216.209.201])
	by homiemail-a21.g.dreamhost.com (Postfix) with ESMTPA id A169630003C
	for <java-user@lucene.apache.org>; Fri,  9 Oct 2009 13:50:01 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Question about how to speed up custom scoring
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
Date: Fri, 9 Oct 2009 17:49:59 -0300
Content-Transfer-Encoding: 7bit
Message-Id: <85635AEF-DEBE-49CF-B04A-CC45CB4B7CF6@apache.org>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com> <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

If you are trying to add specific term weights to terms in the index  
and then incorporate them into scoring, you might benefit from  
payloads and the PayloadTermQuery option.  See http://www.lucidimagination.com/blog/2009/08/05/getting-started-with-payloads/

-Grant

On Oct 8, 2009, at 11:56 AM, scott w wrote:

> Oops, forgot to include the class I mentioned. Here it is:
>
> public class QueryTermBoostingQuery extends CustomScoreQuery {
>  private Map<String, Float> queryTermWeights;
>  private float bias;
>  private IndexReader indexReader;
>
>  public QueryTermBoostingQuery( Query q, Map<String, Float>  
> termWeights,
> IndexReader indexReader, float bias) {
>    super( q );
>    this.indexReader = indexReader;
>    if (bias < 0 || bias > 1) {
>      throw new IllegalArgumentException( "Bias must be between 0 and  
> 1" );
>    }
>    this.bias = bias;
>    queryTermWeights = termWeights;
>  }
>
>  @Override
>  public float customScore( int doc, float subQueryScore, float  
> valSrcScore
> ) {
>    Document document;
>    try {
>      document = indexReader.document( doc );
>    } catch (IOException e) {
>      throw new SearchException( e );
>    }
>    float termWeightedScore = 0;
>
>    for (String field : queryTermWeights.keySet()) {
>      String docFieldValue = document.get( field );
>      if (docFieldValue != null) {
>        Float weight = queryTermWeights.get( field );
>        if (weight != null) {
>          termWeightedScore += weight * Float.parseFloat 
> ( docFieldValue );
>        }
>      }
>    }
>    return bias * subQueryScore + (1 - bias) * termWeightedScore;
>  }
> }
>
> On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:
>
>> I am trying to come up with a performant query that will allow me  
>> to use a
>> custom score where the custom score is a sum-product over a set of  
>> query
>> time weights where each weight gets applied only if the query time  
>> term
>> exists in the document . So for example if I have a doc with three  
>> fields:
>> company=Microsoft, city=Redmond, and size=large, I may want to  
>> score that
>> document according to the following function: city==Microsoft ? . 
>> 3 : 0 *
>> size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a  
>> subclass I have
>> tested that implements this with one extra component which is that  
>> it allow
>> the relevance score to be combined in.
>>
>> The problem is this custom score is not performant at all. For  
>> example, on
>> a small index of 5 million documents with 10 weights passed in it  
>> does 0.01
>> req/sec.
>>
>> Are there ways to make to compute the same custom score but in a  
>> much more
>> performant way?
>>
>> thanks,
>> Scott
>>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42737-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 21:01:30 2009
Return-Path: <java-user-return-42737-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55203 invoked from network); 9 Oct 2009 21:01:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 21:01:30 -0000
Received: (qmail 52778 invoked by uid 500); 9 Oct 2009 21:01:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52703 invoked by uid 500); 9 Oct 2009 21:01:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52693 invoked by uid 99); 9 Oct 2009 21:01:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:01:27 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.66] (HELO homiemail-a18.g.dreamhost.com) (208.97.132.66)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:01:16 +0000
Received: from infr-laptop7.olx.com.ar (unknown [201.216.209.201])
	by homiemail-a18.g.dreamhost.com (Postfix) with ESMTPA id D0276250065
	for <java-user@lucene.apache.org>; Fri,  9 Oct 2009 14:00:24 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Question about how to speed up custom scoring
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <85635AEF-DEBE-49CF-B04A-CC45CB4B7CF6@apache.org>
Date: Fri, 9 Oct 2009 18:00:23 -0300
Content-Transfer-Encoding: 7bit
Message-Id: <D3EAEADE-DF83-4E65-BBC9-34A9D80E8B73@apache.org>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com> <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com> <85635AEF-DEBE-49CF-B04A-CC45CB4B7CF6@apache.org>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

Oops, just reread and realized you wanted query time weights.   
Payloads are an index time thing.

On Oct 9, 2009, at 5:49 PM, Grant Ingersoll wrote:

> If you are trying to add specific term weights to terms in the index  
> and then incorporate them into scoring, you might benefit from  
> payloads and the PayloadTermQuery option.  See http://www.lucidimagination.com/blog/2009/08/05/getting-started-with-payloads/
>
> -Grant
>
> On Oct 8, 2009, at 11:56 AM, scott w wrote:
>
>> Oops, forgot to include the class I mentioned. Here it is:
>>
>> public class QueryTermBoostingQuery extends CustomScoreQuery {
>> private Map<String, Float> queryTermWeights;
>> private float bias;
>> private IndexReader indexReader;
>>
>> public QueryTermBoostingQuery( Query q, Map<String, Float>  
>> termWeights,
>> IndexReader indexReader, float bias) {
>>   super( q );
>>   this.indexReader = indexReader;
>>   if (bias < 0 || bias > 1) {
>>     throw new IllegalArgumentException( "Bias must be between 0 and  
>> 1" );
>>   }
>>   this.bias = bias;
>>   queryTermWeights = termWeights;
>> }
>>
>> @Override
>> public float customScore( int doc, float subQueryScore, float  
>> valSrcScore
>> ) {
>>   Document document;
>>   try {
>>     document = indexReader.document( doc );
>>   } catch (IOException e) {
>>     throw new SearchException( e );
>>   }
>>   float termWeightedScore = 0;
>>
>>   for (String field : queryTermWeights.keySet()) {
>>     String docFieldValue = document.get( field );
>>     if (docFieldValue != null) {
>>       Float weight = queryTermWeights.get( field );
>>       if (weight != null) {
>>         termWeightedScore += weight * Float.parseFloat 
>> ( docFieldValue );
>>       }
>>     }
>>   }
>>   return bias * subQueryScore + (1 - bias) * termWeightedScore;
>> }
>> }
>>
>> On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:
>>
>>> I am trying to come up with a performant query that will allow me  
>>> to use a
>>> custom score where the custom score is a sum-product over a set of  
>>> query
>>> time weights where each weight gets applied only if the query time  
>>> term
>>> exists in the document . So for example if I have a doc with three  
>>> fields:
>>> company=Microsoft, city=Redmond, and size=large, I may want to  
>>> score that
>>> document according to the following function: city==Microsoft ? . 
>>> 3 : 0 *
>>> size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a  
>>> subclass I have
>>> tested that implements this with one extra component which is that  
>>> it allow
>>> the relevance score to be combined in.
>>>
>>> The problem is this custom score is not performant at all. For  
>>> example, on
>>> a small index of 5 million documents with 10 weights passed in it  
>>> does 0.01
>>> req/sec.
>>>
>>> Are there ways to make to compute the same custom score but in a  
>>> much more
>>> performant way?
>>>
>>> thanks,
>>> Scott
>>>
>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
> using Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42738-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 21:05:45 2009
Return-Path: <java-user-return-42738-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56788 invoked from network); 9 Oct 2009 21:05:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 21:05:45 -0000
Received: (qmail 60007 invoked by uid 500); 9 Oct 2009 21:05:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59941 invoked by uid 500); 9 Oct 2009 21:05:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59931 invoked by uid 99); 9 Oct 2009 21:05:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:05:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:05:33 +0000
Received: by ywh14 with SMTP id 14so2067650ywh.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 14:04:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=kv84VXUvHMSNop+w3L5RH1Uqnakk+nm0+5zK5MAb9a0=;
        b=KIbBXxDqwqB/jLZKNCA6bz9sAFIka4PXe5Z1yjLPHDO0T7PLz3xnVs1kTfyCjjNH0J
         ZSEepDH8Af9gJ0SFBwIU7A5HaC/JRS2AbM1Quqluq67s1plj5bSpH647DDYhQgsJBQhR
         K0pQE7TPGROvPfyB1GS4jjIO9/D/g4sE2wdiM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=umlSpvEmH2SFjqGL1F5M7XlkdbHe8JuauL4R5DLF5rdXaypFceFz8fASxOnbHhHWRf
         Ttw29c7olBmUfl6PKHJitIZ+pmZLLGtisbvJQUJKIl6afaM/Eln0MlyyRpXhAtIrr5Br
         Nf7wGtW7RKI+T4TYWde6SiG7y58/plCXLtBcg=
MIME-Version: 1.0
Received: by 10.90.222.1 with SMTP id u1mr1654553agg.103.1255122252188; Fri, 
	09 Oct 2009 14:04:12 -0700 (PDT)
In-Reply-To: <4ACFA130.4090104@jobdiva.com>
References: <4ACFA130.4090104@jobdiva.com>
Date: Fri, 9 Oct 2009 14:04:12 -0700
Message-ID: <4b124c310910091404n1f6acb6fk5475dbfea22bfef4@mail.gmail.com>
Subject: Re: Using Numeric Field
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636283e94fdce43047586eb9b
X-Virus-Checked: Checked by ClamAV on apache.org

--001636283e94fdce43047586eb9b
Content-Type: text/plain; charset=ISO-8859-1

If you are really using all of that precision (down to the second) the
short answer is YES.

If you can remove much of that precision (only keep down to the day,
for example), then you may be able to get perfectly good performance
with strings alone when the range is only over a small set of terms,
although it's possible even here you will get a performance gain with
NumericRangeFilter.

  -jake


On Fri, Oct 9, 2009 at 1:46 PM, Siraj Haider <siraj@jobdiva.com> wrote:

> Hi,
> I have a Date field in my Lucene index that is currently stored as a
> String field with format: YYYYMMDDHHMISS.  I perform RangeFilter on it
> when searching and also sort the results specifying it as a String
> field.  My question is, will converting it to a Numeric field and start
> using NumericRangeFilter and sorting based on numeric field will give me
> some performance gain? or will it be insignificant?
>
> thanks
> -siraj
>
>
> This electronic mail message and any attachments may contain information
> which is privileged, sensitive and/or otherwise exempt from disclosure under
> applicable law. The information is intended only for the use of the
> individual or entity named as the addressee above. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution (electronic or otherwise) or forwarding of, or the taking of
> any action in reliance on, the contents of this transmission is strictly
> prohibited. If you have received this electronic transmission in error,
> please notify us by telephone, facsimile, or e-mail as noted above to
> arrange for the return of any electronic mail or attachments. Thank You.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636283e94fdce43047586eb9b--

From java-user-return-42739-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 21:21:21 2009
Return-Path: <java-user-return-42739-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63395 invoked from network); 9 Oct 2009 21:21:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 21:21:21 -0000
Received: (qmail 80954 invoked by uid 500); 9 Oct 2009 21:21:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80881 invoked by uid 500); 9 Oct 2009 21:21:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80871 invoked by uid 99); 9 Oct 2009 21:21:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:21:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:21:08 +0000
Received: by vws29 with SMTP id 29so606194vws.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 14:19:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=JdUrCmV0ktQLq02qYSYyKqalWnD7Q3EmR1WoyKiAc5w=;
        b=f3XuXEYMW6wUVsSDHTnToa+lBS6wiVOWiAeZ4bB0mRZystcX04I2vn8iuDtdUbVkcs
         YRnG+e/xgMRacmfWP1lw6z03IMerc6FLaEB4Okz06phrmvaGxALXLEWENB3YKs100dXM
         YQsrTFXo++QDjlPjR3G/p+o5PUs0ZfaEZ69F4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=A0Rx324zQHsR61//Z9eedeLO5XsLRbiYbaEdTzMfpJM292wh/31C2R1wqu/gMdPOnN
         TaWHYzojEnlHccaLtFOahWu5hduKULMHoOamB58fx7RMmjFANSi4Bx1QOLNtP7Po12kc
         KSp7PO8Q62RFh+bwEp8Iv0Aa7SQjAS/+unNQM=
MIME-Version: 1.0
Received: by 10.220.114.12 with SMTP id c12mr4638106vcq.109.1255123186639; 
	Fri, 09 Oct 2009 14:19:46 -0700 (PDT)
In-Reply-To: <D3EAEADE-DF83-4E65-BBC9-34A9D80E8B73@apache.org>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <85635AEF-DEBE-49CF-B04A-CC45CB4B7CF6@apache.org>
	 <D3EAEADE-DF83-4E65-BBC9-34A9D80E8B73@apache.org>
Date: Fri, 9 Oct 2009 14:19:46 -0700
Message-ID: <401b577e0910091419pa43264bs8236bbda8daab4fa@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485e8ad58b0990a047587234e
X-Virus-Checked: Checked by ClamAV on apache.org

--001485e8ad58b0990a047587234e
Content-Type: text/plain; charset=ISO-8859-1

Right exactly. I looked into payload initially and realized it wouldn't work
for my use case.

On Fri, Oct 9, 2009 at 2:00 PM, Grant Ingersoll <gsingers@apache.org> wrote:

> Oops, just reread and realized you wanted query time weights.  Payloads are
> an index time thing.
>
>
> On Oct 9, 2009, at 5:49 PM, Grant Ingersoll wrote:
>
>  If you are trying to add specific term weights to terms in the index and
>> then incorporate them into scoring, you might benefit from payloads and the
>> PayloadTermQuery option.  See
>> http://www.lucidimagination.com/blog/2009/08/05/getting-started-with-payloads/
>>
>> -Grant
>>
>> On Oct 8, 2009, at 11:56 AM, scott w wrote:
>>
>>  Oops, forgot to include the class I mentioned. Here it is:
>>>
>>> public class QueryTermBoostingQuery extends CustomScoreQuery {
>>> private Map<String, Float> queryTermWeights;
>>> private float bias;
>>> private IndexReader indexReader;
>>>
>>> public QueryTermBoostingQuery( Query q, Map<String, Float> termWeights,
>>> IndexReader indexReader, float bias) {
>>>  super( q );
>>>  this.indexReader = indexReader;
>>>  if (bias < 0 || bias > 1) {
>>>    throw new IllegalArgumentException( "Bias must be between 0 and 1" );
>>>  }
>>>  this.bias = bias;
>>>  queryTermWeights = termWeights;
>>> }
>>>
>>> @Override
>>> public float customScore( int doc, float subQueryScore, float valSrcScore
>>> ) {
>>>  Document document;
>>>  try {
>>>    document = indexReader.document( doc );
>>>  } catch (IOException e) {
>>>    throw new SearchException( e );
>>>  }
>>>  float termWeightedScore = 0;
>>>
>>>  for (String field : queryTermWeights.keySet()) {
>>>    String docFieldValue = document.get( field );
>>>    if (docFieldValue != null) {
>>>      Float weight = queryTermWeights.get( field );
>>>      if (weight != null) {
>>>        termWeightedScore += weight * Float.parseFloat( docFieldValue );
>>>      }
>>>    }
>>>  }
>>>  return bias * subQueryScore + (1 - bias) * termWeightedScore;
>>> }
>>> }
>>>
>>> On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com> wrote:
>>>
>>>  I am trying to come up with a performant query that will allow me to use
>>>> a
>>>> custom score where the custom score is a sum-product over a set of query
>>>> time weights where each weight gets applied only if the query time term
>>>> exists in the document . So for example if I have a doc with three
>>>> fields:
>>>> company=Microsoft, city=Redmond, and size=large, I may want to score
>>>> that
>>>> document according to the following function: city==Microsoft ? .3 : 0 *
>>>> size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a subclass I
>>>> have
>>>> tested that implements this with one extra component which is that it
>>>> allow
>>>> the relevance score to be combined in.
>>>>
>>>> The problem is this custom score is not performant at all. For example,
>>>> on
>>>> a small index of 5 million documents with 10 weights passed in it does
>>>> 0.01
>>>> req/sec.
>>>>
>>>> Are there ways to make to compute the same custom score but in a much
>>>> more
>>>> performant way?
>>>>
>>>> thanks,
>>>> Scott
>>>>
>>>>
>> --------------------------
>> Grant Ingersoll
>> http://www.lucidimagination.com/
>>
>> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
>> Solr/Lucene:
>> http://www.lucidimagination.com/search
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
> Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485e8ad58b0990a047587234e--

From java-user-return-42740-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 21:23:55 2009
Return-Path: <java-user-return-42740-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63831 invoked from network); 9 Oct 2009 21:23:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 21:23:55 -0000
Received: (qmail 84659 invoked by uid 500); 9 Oct 2009 21:23:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84611 invoked by uid 500); 9 Oct 2009 21:23:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84577 invoked by uid 99); 9 Oct 2009 21:23:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:23:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:23:39 +0000
Received: by vws29 with SMTP id 29so607563vws.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 14:23:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=x1Z/atDbvFEAw06JWf7GUHj2mqs4jMnVHQs/Evos+jY=;
        b=rKiIprnImwHVH1rgMIV3UGGgoQkbSauOJoKs+SLqD5zPM7loD092/w4LMC1HbtpQ3G
         0dyrmhNLeNkoWEfqg+feL0eetfYyHgTbnQRJ6iUjX8ad+0HG3UJ/sgwotFbOdn6TEWn3
         e1VdcpzNtt5rVCL7yZvVKzeM4Ss4ocqXVxxao=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=j84tWGe1sInmf47G7AvwgN3Wu4/bMjzU9nQkPbWHFOdQZKRQuHwtF709xVQEWceqAM
         JYTKDYfzv/v3RgpMrh7E8ADMoCN+mzl/qMbdxMXwL1HPNywgyoz62FAX1JrHkVdlfGtM
         DzuqAnzC78RCy20ifeIRcD1FuwCNBv6WO4bwg=
MIME-Version: 1.0
Received: by 10.220.44.136 with SMTP id a8mr4809963vcf.47.1255123083466; Fri, 
	09 Oct 2009 14:18:03 -0700 (PDT)
In-Reply-To: <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
Date: Fri, 9 Oct 2009 14:18:03 -0700
Message-ID: <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636832cb08a17690475871d27
X-Virus-Checked: Checked by ClamAV on apache.org

--001636832cb08a17690475871d27
Content-Type: text/plain; charset=ISO-8859-1

(Apologies if this message gets sent more than once. I received an error
sending it the first two times so sent directly to Jake but reposting to
group.)
Hi Jake --

Thanks for the feedback.

What I am trying to implement is a way to custom score documents using a
scoring function that takes as input a map of fields (which may or may not
be in any given document) and weights for those fields supplied at query
time, and outputs an aggregate score that is based on taking the numeric
field weights that are already stored and indexed and then readjusting those
weights based on the map.

Another thing I would like to do is the same thing but for fields that do
not have weights associated with them in the index and so the query time
supplied weights essentially get used directly instead of adjusting the
already indexed weights.

You can think of this is as implementing a form of personalization where you
have a default set of weights and you want to adjust them on the fly
although our use case is a little different.

thanks,
Scott

On Fri, Oct 9, 2009 at 10:40 AM, Jake Mannix <jake.mannix@gmail.com> wrote:

> Scott,
>
>  To reiterate what Erick and Andrzej's said: calling
> IndexReader.document(docId)
> in your inner scoring loop is the source of your performance problem -
> iterating
> over all these stored fields is what is killing you.
>
>  To do this a better way, can you try to explain exactly what this Scorer
> is
> supposed to be doing?  You're extending CustomScoreQuery and which
> is usually used with ValueSourceQuery, but you don't use that part, and
> ignore the valSrcScore in your computation.
>
>  Where are the parts of your score coming from?  The termWeight map
> is used how exactly?
>
>  -jake
>
> On Fri, Oct 9, 2009 at 10:30 AM, scott w <scottblanc@gmail.com> wrote:
>
> > Thanks for the suggestions Erick. I am using Lucene 2.3. Terms are stored
> > and given Andrzej's comments in the follow up email sounds like it's not
> > the
> > stored field issue. I'll keep investigating...
> >
> > thanks,
> > Scott
> >
> > On Thu, Oct 8, 2009 at 8:06 AM, Erick Erickson <erickerickson@gmail.com
> > >wrote:
> >
> > > I suspect your problem here is the line:
> > > document = indexReader.document( doc );
> > >
> > > See the caution in the docs
> > >
> > > You could try using lazy loading (so you don't load all
> > > the terms of the document, just those you're interested
> > > in). And I *think* (but it's been a while) that if the terms
> > > you load are indexed that'll help. But this is mostly
> > > a guess.
> > >
> > > What version of Lucene are you using???
> > >
> > > Good luck!
> > > Erick
> > >
> > > On Thu, Oct 8, 2009 at 10:56 AM, scott w <scottblanc@gmail.com> wrote:
> > >
> > > > Oops, forgot to include the class I mentioned. Here it is:
> > > >
> > > > public class QueryTermBoostingQuery extends CustomScoreQuery {
> > > >  private Map<String, Float> queryTermWeights;
> > > >  private float bias;
> > > >  private IndexReader indexReader;
> > > >
> > > >  public QueryTermBoostingQuery( Query q, Map<String, Float>
> > termWeights,
> > > > IndexReader indexReader, float bias) {
> > > >    super( q );
> > > >    this.indexReader = indexReader;
> > > >    if (bias < 0 || bias > 1) {
> > > >      throw new IllegalArgumentException( "Bias must be between 0 and
> 1"
> > > );
> > > >    }
> > > >    this.bias = bias;
> > > >    queryTermWeights = termWeights;
> > > >  }
> > > >
> > > >  @Override
> > > >  public float customScore( int doc, float subQueryScore, float
> > > valSrcScore
> > > > ) {
> > > >    Document document;
> > > >    try {
> > > >      document = indexReader.document( doc );
> > > >    } catch (IOException e) {
> > > >      throw new SearchException( e );
> > > >    }
> > > >    float termWeightedScore = 0;
> > > >
> > > >    for (String field : queryTermWeights.keySet()) {
> > > >      String docFieldValue = document.get( field );
> > > >      if (docFieldValue != null) {
> > > >        Float weight = queryTermWeights.get( field );
> > > >        if (weight != null) {
> > > >          termWeightedScore += weight * Float.parseFloat(
> docFieldValue
> > );
> > > >        }
> > > >      }
> > > >    }
> > > >    return bias * subQueryScore + (1 - bias) * termWeightedScore;
> > > >   }
> > > > }
> > > >
> > > > On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com>
> wrote:
> > > >
> > > > > I am trying to come up with a performant query that will allow me
> to
> > > use
> > > > a
> > > > > custom score where the custom score is a sum-product over a set of
> > > query
> > > > > time weights where each weight gets applied only if the query time
> > term
> > > > > exists in the document . So for example if I have a doc with three
> > > > fields:
> > > > > company=Microsoft, city=Redmond, and size=large, I may want to
> score
> > > that
> > > > > document according to the following function: city==Microsoft ? .3
> :
> > 0
> > > *
> > > > > size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a
> subclass
> > I
> > > > have
> > > > > tested that implements this with one extra component which is that
> it
> > > > allow
> > > > > the relevance score to be combined in.
> > > > >
> > > > > The problem is this custom score is not performant at all. For
> > example,
> > > > on
> > > > > a small index of 5 million documents with 10 weights passed in it
> > does
> > > > 0.01
> > > > > req/sec.
> > > > >
> > > > > Are there ways to make to compute the same custom score but in a
> much
> > > > more
> > > > > performant way?
> > > > >
> > > > > thanks,
> > > > > Scott
> > > > >
> > > >
> > >
> >
>

--001636832cb08a17690475871d27--

From java-user-return-42741-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 21:41:28 2009
Return-Path: <java-user-return-42741-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72865 invoked from network); 9 Oct 2009 21:41:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 21:41:28 -0000
Received: (qmail 3667 invoked by uid 500); 9 Oct 2009 21:41:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3583 invoked by uid 500); 9 Oct 2009 21:41:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3573 invoked by uid 99); 9 Oct 2009 21:41:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:41:26 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 21:41:16 +0000
Received: by gxk26 with SMTP id 26so1210381gxk.11
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 14:40:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=Tg6xsz1vXyzNNrjPQkxcJDl798ufJ22v/hfCxM3cjPE=;
        b=WJb0MMuoHDocCWxOwMvgtvF/8LqM6d0C8WXA2x95kdtZ2a4VO3LEAFeu4FWibKQsBd
         l9lV7JEJxmyh8zVqxrU//mEFe9If+HGbSD9PO/8eWA7LW2Jbx6uUOaPj+91CRcfe9ZxU
         gsUj60RxGi2IDugSO5GqTbebRTL/+vDi7kEgc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=igwVscF6bgfpkiwvVyQjGLwQ2LGQ1WncFL590H/lSyJv02iWZ/RlnX3DieN+csziRF
         uclIpUkTQKhnh2J8g7GuPB7hbftnfX+dpI6vrpJZG6IncabrHz+jrzywhu7fDTAtDsuO
         gwQeUVT6BVX1HzpJtA6uZ4D/bT3SrZugPlxBA=
MIME-Version: 1.0
Received: by 10.90.211.6 with SMTP id j6mr1686714agg.86.1255124454942; Fri, 09 
	Oct 2009 14:40:54 -0700 (PDT)
In-Reply-To: <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
Date: Fri, 9 Oct 2009 14:40:54 -0700
Message-ID: <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016362840444928660475876f12
X-Virus-Checked: Checked by ClamAV on apache.org

--0016362840444928660475876f12
Content-Type: text/plain; charset=ISO-8859-1

Hey Scott,

  I'm still not sure I understand what your dynamic boosts are for: they
are the names of fields, right, not terms in the fields?  So in terms
of your example { company = microsoft, city = redmond, size = big },
the three possible choices for keys in your map are company, city,
or size, right?

  So if you passed in { company => 0.5, size => 0.3 } as your map,
how would you compute the score for the two documents

  { company: microsoft, city: redmond, size: big } and
  { company: google, city: mountain view, size: big }

Where is the Float that you have stored in the doc, that you're
accessing via Float.parseFloat( document.get(fieldName) ) ?

  So is it that you have fields in the index, which basically contain
numeric data, and then you want to multiply those indexed floats
by query-time values to make the score?

  I'm sorry if I'm not fully following how this works.  Can you restate
your example showing what you have in the index, and what comes
in in the query?

  -jake

On Fri, Oct 9, 2009 at 2:18 PM, scott w <scottblanc@gmail.com> wrote:

> (Apologies if this message gets sent more than once. I received an error
> sending it the first two times so sent directly to Jake but reposting to
> group.)
> Hi Jake --
>
> Thanks for the feedback.
>
> What I am trying to implement is a way to custom score documents using a
> scoring function that takes as input a map of fields (which may or may not
> be in any given document) and weights for those fields supplied at query
> time, and outputs an aggregate score that is based on taking the numeric
> field weights that are already stored and indexed and then readjusting
> those
> weights based on the map.
>
> Another thing I would like to do is the same thing but for fields that do
> not have weights associated with them in the index and so the query time
> supplied weights essentially get used directly instead of adjusting the
> already indexed weights.
>
> You can think of this is as implementing a form of personalization where
> you
> have a default set of weights and you want to adjust them on the fly
> although our use case is a little different.
>
> thanks,
> Scott
>
> On Fri, Oct 9, 2009 at 10:40 AM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
>
> > Scott,
> >
> >  To reiterate what Erick and Andrzej's said: calling
> > IndexReader.document(docId)
> > in your inner scoring loop is the source of your performance problem -
> > iterating
> > over all these stored fields is what is killing you.
> >
> >  To do this a better way, can you try to explain exactly what this Scorer
> > is
> > supposed to be doing?  You're extending CustomScoreQuery and which
> > is usually used with ValueSourceQuery, but you don't use that part, and
> > ignore the valSrcScore in your computation.
> >
> >  Where are the parts of your score coming from?  The termWeight map
> > is used how exactly?
> >
> >  -jake
> >
> > On Fri, Oct 9, 2009 at 10:30 AM, scott w <scottblanc@gmail.com> wrote:
> >
> > > Thanks for the suggestions Erick. I am using Lucene 2.3. Terms are
> stored
> > > and given Andrzej's comments in the follow up email sounds like it's
> not
> > > the
> > > stored field issue. I'll keep investigating...
> > >
> > > thanks,
> > > Scott
> > >
> > > On Thu, Oct 8, 2009 at 8:06 AM, Erick Erickson <
> erickerickson@gmail.com
> > > >wrote:
> > >
> > > > I suspect your problem here is the line:
> > > > document = indexReader.document( doc );
> > > >
> > > > See the caution in the docs
> > > >
> > > > You could try using lazy loading (so you don't load all
> > > > the terms of the document, just those you're interested
> > > > in). And I *think* (but it's been a while) that if the terms
> > > > you load are indexed that'll help. But this is mostly
> > > > a guess.
> > > >
> > > > What version of Lucene are you using???
> > > >
> > > > Good luck!
> > > > Erick
> > > >
> > > > On Thu, Oct 8, 2009 at 10:56 AM, scott w <scottblanc@gmail.com>
> wrote:
> > > >
> > > > > Oops, forgot to include the class I mentioned. Here it is:
> > > > >
> > > > > public class QueryTermBoostingQuery extends CustomScoreQuery {
> > > > >  private Map<String, Float> queryTermWeights;
> > > > >  private float bias;
> > > > >  private IndexReader indexReader;
> > > > >
> > > > >  public QueryTermBoostingQuery( Query q, Map<String, Float>
> > > termWeights,
> > > > > IndexReader indexReader, float bias) {
> > > > >    super( q );
> > > > >    this.indexReader = indexReader;
> > > > >    if (bias < 0 || bias > 1) {
> > > > >      throw new IllegalArgumentException( "Bias must be between 0
> and
> > 1"
> > > > );
> > > > >    }
> > > > >    this.bias = bias;
> > > > >    queryTermWeights = termWeights;
> > > > >  }
> > > > >
> > > > >  @Override
> > > > >  public float customScore( int doc, float subQueryScore, float
> > > > valSrcScore
> > > > > ) {
> > > > >    Document document;
> > > > >    try {
> > > > >      document = indexReader.document( doc );
> > > > >    } catch (IOException e) {
> > > > >      throw new SearchException( e );
> > > > >    }
> > > > >    float termWeightedScore = 0;
> > > > >
> > > > >    for (String field : queryTermWeights.keySet()) {
> > > > >      String docFieldValue = document.get( field );
> > > > >      if (docFieldValue != null) {
> > > > >        Float weight = queryTermWeights.get( field );
> > > > >        if (weight != null) {
> > > > >          termWeightedScore += weight * Float.parseFloat(
> > docFieldValue
> > > );
> > > > >        }
> > > > >      }
> > > > >    }
> > > > >    return bias * subQueryScore + (1 - bias) * termWeightedScore;
> > > > >   }
> > > > > }
> > > > >
> > > > > On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com>
> > wrote:
> > > > >
> > > > > > I am trying to come up with a performant query that will allow me
> > to
> > > > use
> > > > > a
> > > > > > custom score where the custom score is a sum-product over a set
> of
> > > > query
> > > > > > time weights where each weight gets applied only if the query
> time
> > > term
> > > > > > exists in the document . So for example if I have a doc with
> three
> > > > > fields:
> > > > > > company=Microsoft, city=Redmond, and size=large, I may want to
> > score
> > > > that
> > > > > > document according to the following function: city==Microsoft ?
> .3
> > :
> > > 0
> > > > *
> > > > > > size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a
> > subclass
> > > I
> > > > > have
> > > > > > tested that implements this with one extra component which is
> that
> > it
> > > > > allow
> > > > > > the relevance score to be combined in.
> > > > > >
> > > > > > The problem is this custom score is not performant at all. For
> > > example,
> > > > > on
> > > > > > a small index of 5 million documents with 10 weights passed in it
> > > does
> > > > > 0.01
> > > > > > req/sec.
> > > > > >
> > > > > > Are there ways to make to compute the same custom score but in a
> > much
> > > > > more
> > > > > > performant way?
> > > > > >
> > > > > > thanks,
> > > > > > Scott
> > > > > >
> > > > >
> > > >
> > >
> >
>

--0016362840444928660475876f12--

From java-user-return-42742-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 22:07:57 2009
Return-Path: <java-user-return-42742-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82255 invoked from network); 9 Oct 2009 22:07:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 22:07:57 -0000
Received: (qmail 35050 invoked by uid 500); 9 Oct 2009 22:07:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34980 invoked by uid 500); 9 Oct 2009 22:07:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34970 invoked by uid 99); 9 Oct 2009 22:07:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 22:07:55 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 22:07:45 +0000
Received: by vws29 with SMTP id 29so622867vws.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 15:07:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=4hq+u3SOG2h4P9GQ7798licmArfva645ilPcs7wFKMY=;
        b=XvYJnigEDfToBYgG2r13ZBBM2nlLhobRvenrhv6hOsyo+CkjPEx7Q/AX2cZb7mX7Ht
         /gefpgRetkk2Z+YoXvmpeESw2/rY+2bEez71tU3m9eeUqDxsu9g4EkiHO55BEXmVS9Cz
         fJlVxCIbgTmA2QrVrY2NoVg6xRC7XOkY0URjU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ifQ8enSmv49ZdF2ylRQxNEDEbIQw5PTZliO1lHXZXLloBBfxQPl7OtrNU8moXu3Mt5
         sG14XsgB6ikLJpig4Me/e0tRt7JKhSP/zrSqxAcWGfb2FsoB+3aX2EQY8LZQpIbp0JVl
         R/eMhQelktPuYjWB/LOKdrREsa040R+exyie0=
MIME-Version: 1.0
Received: by 10.220.114.12 with SMTP id c12mr4722670vcq.109.1255126043276; 
	Fri, 09 Oct 2009 15:07:23 -0700 (PDT)
In-Reply-To: <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
Date: Fri, 9 Oct 2009 15:07:23 -0700
Message-ID: <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485e8ad58f537ed047587cde1
X-Virus-Checked: Checked by ClamAV on apache.org

--001485e8ad58f537ed047587cde1
Content-Type: text/plain; charset=ISO-8859-1

Hi Jake --

Sorry for the confusion. I have two similar but slightly different use cases
in mind and the example I gave you corresponds to one use case while the
code corresponds to the other slightly more complicated one. Ignore the
original example, and let me restate the one I have in mind so it hopefully
makes more sense:

Example Document:
model_1_score = 0.9
model_2_score = 0.3
model_3_score = 0.7

I want to be able to pass in the following map at query time:
{model_1_score=0.4, model_2_score=0.7} and have that map get used as input
to a custom score function that would look like: 0.9*0.4 + 0.3*0.7, so that
it is summing over the specified fields and multipling the indexed weight by
the query time weight. For the purposes of this discussion, ignore the bit
in the code where I also factor in the relevance score and the bias that
determines how much weight to apply to the relevance score.

Hopefully that make more sense.

The other use case I had in mind is one where it doesn't care about the
indexed value and only looks at whether the field is present or not and then
uses the query supplied weight to measure the relative importance of that
field.

thanks,
Scott



On Fri, Oct 9, 2009 at 2:40 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

> Hey Scott,
>
>  I'm still not sure I understand what your dynamic boosts are for: they
> are the names of fields, right, not terms in the fields?  So in terms
> of your example { company = microsoft, city = redmond, size = big },
> the three possible choices for keys in your map are company, city,
> or size, right?
>
>  So if you passed in { company => 0.5, size => 0.3 } as your map,
> how would you compute the score for the two documents
>
>  { company: microsoft, city: redmond, size: big } and
>  { company: google, city: mountain view, size: big }
>
> Where is the Float that you have stored in the doc, that you're
> accessing via Float.parseFloat( document.get(fieldName) ) ?
>
>  So is it that you have fields in the index, which basically contain
> numeric data, and then you want to multiply those indexed floats
> by query-time values to make the score?
>
>  I'm sorry if I'm not fully following how this works.  Can you restate
> your example showing what you have in the index, and what comes
> in in the query?
>
>  -jake
>
> On Fri, Oct 9, 2009 at 2:18 PM, scott w <scottblanc@gmail.com> wrote:
>
> > (Apologies if this message gets sent more than once. I received an error
> > sending it the first two times so sent directly to Jake but reposting to
> > group.)
> > Hi Jake --
> >
> > Thanks for the feedback.
> >
> > What I am trying to implement is a way to custom score documents using a
> > scoring function that takes as input a map of fields (which may or may
> not
> > be in any given document) and weights for those fields supplied at query
> > time, and outputs an aggregate score that is based on taking the numeric
> > field weights that are already stored and indexed and then readjusting
> > those
> > weights based on the map.
> >
> > Another thing I would like to do is the same thing but for fields that do
> > not have weights associated with them in the index and so the query time
> > supplied weights essentially get used directly instead of adjusting the
> > already indexed weights.
> >
> > You can think of this is as implementing a form of personalization where
> > you
> > have a default set of weights and you want to adjust them on the fly
> > although our use case is a little different.
> >
> > thanks,
> > Scott
> >
> > On Fri, Oct 9, 2009 at 10:40 AM, Jake Mannix <jake.mannix@gmail.com>
> > wrote:
> >
> > > Scott,
> > >
> > >  To reiterate what Erick and Andrzej's said: calling
> > > IndexReader.document(docId)
> > > in your inner scoring loop is the source of your performance problem -
> > > iterating
> > > over all these stored fields is what is killing you.
> > >
> > >  To do this a better way, can you try to explain exactly what this
> Scorer
> > > is
> > > supposed to be doing?  You're extending CustomScoreQuery and which
> > > is usually used with ValueSourceQuery, but you don't use that part, and
> > > ignore the valSrcScore in your computation.
> > >
> > >  Where are the parts of your score coming from?  The termWeight map
> > > is used how exactly?
> > >
> > >  -jake
> > >
> > > On Fri, Oct 9, 2009 at 10:30 AM, scott w <scottblanc@gmail.com> wrote:
> > >
> > > > Thanks for the suggestions Erick. I am using Lucene 2.3. Terms are
> > stored
> > > > and given Andrzej's comments in the follow up email sounds like it's
> > not
> > > > the
> > > > stored field issue. I'll keep investigating...
> > > >
> > > > thanks,
> > > > Scott
> > > >
> > > > On Thu, Oct 8, 2009 at 8:06 AM, Erick Erickson <
> > erickerickson@gmail.com
> > > > >wrote:
> > > >
> > > > > I suspect your problem here is the line:
> > > > > document = indexReader.document( doc );
> > > > >
> > > > > See the caution in the docs
> > > > >
> > > > > You could try using lazy loading (so you don't load all
> > > > > the terms of the document, just those you're interested
> > > > > in). And I *think* (but it's been a while) that if the terms
> > > > > you load are indexed that'll help. But this is mostly
> > > > > a guess.
> > > > >
> > > > > What version of Lucene are you using???
> > > > >
> > > > > Good luck!
> > > > > Erick
> > > > >
> > > > > On Thu, Oct 8, 2009 at 10:56 AM, scott w <scottblanc@gmail.com>
> > wrote:
> > > > >
> > > > > > Oops, forgot to include the class I mentioned. Here it is:
> > > > > >
> > > > > > public class QueryTermBoostingQuery extends CustomScoreQuery {
> > > > > >  private Map<String, Float> queryTermWeights;
> > > > > >  private float bias;
> > > > > >  private IndexReader indexReader;
> > > > > >
> > > > > >  public QueryTermBoostingQuery( Query q, Map<String, Float>
> > > > termWeights,
> > > > > > IndexReader indexReader, float bias) {
> > > > > >    super( q );
> > > > > >    this.indexReader = indexReader;
> > > > > >    if (bias < 0 || bias > 1) {
> > > > > >      throw new IllegalArgumentException( "Bias must be between 0
> > and
> > > 1"
> > > > > );
> > > > > >    }
> > > > > >    this.bias = bias;
> > > > > >    queryTermWeights = termWeights;
> > > > > >  }
> > > > > >
> > > > > >  @Override
> > > > > >  public float customScore( int doc, float subQueryScore, float
> > > > > valSrcScore
> > > > > > ) {
> > > > > >    Document document;
> > > > > >    try {
> > > > > >      document = indexReader.document( doc );
> > > > > >    } catch (IOException e) {
> > > > > >      throw new SearchException( e );
> > > > > >    }
> > > > > >    float termWeightedScore = 0;
> > > > > >
> > > > > >    for (String field : queryTermWeights.keySet()) {
> > > > > >      String docFieldValue = document.get( field );
> > > > > >      if (docFieldValue != null) {
> > > > > >        Float weight = queryTermWeights.get( field );
> > > > > >        if (weight != null) {
> > > > > >          termWeightedScore += weight * Float.parseFloat(
> > > docFieldValue
> > > > );
> > > > > >        }
> > > > > >      }
> > > > > >    }
> > > > > >    return bias * subQueryScore + (1 - bias) * termWeightedScore;
> > > > > >   }
> > > > > > }
> > > > > >
> > > > > > On Thu, Oct 8, 2009 at 7:54 AM, scott w <scottblanc@gmail.com>
> > > wrote:
> > > > > >
> > > > > > > I am trying to come up with a performant query that will allow
> me
> > > to
> > > > > use
> > > > > > a
> > > > > > > custom score where the custom score is a sum-product over a set
> > of
> > > > > query
> > > > > > > time weights where each weight gets applied only if the query
> > time
> > > > term
> > > > > > > exists in the document . So for example if I have a doc with
> > three
> > > > > > fields:
> > > > > > > company=Microsoft, city=Redmond, and size=large, I may want to
> > > score
> > > > > that
> > > > > > > document according to the following function: city==Microsoft ?
> > .3
> > > :
> > > > 0
> > > > > *
> > > > > > > size ==large ? 0.5 : 0 to get a score of 0.8. Attached is a
> > > subclass
> > > > I
> > > > > > have
> > > > > > > tested that implements this with one extra component which is
> > that
> > > it
> > > > > > allow
> > > > > > > the relevance score to be combined in.
> > > > > > >
> > > > > > > The problem is this custom score is not performant at all. For
> > > > example,
> > > > > > on
> > > > > > > a small index of 5 million documents with 10 weights passed in
> it
> > > > does
> > > > > > 0.01
> > > > > > > req/sec.
> > > > > > >
> > > > > > > Are there ways to make to compute the same custom score but in
> a
> > > much
> > > > > > more
> > > > > > > performant way?
> > > > > > >
> > > > > > > thanks,
> > > > > > > Scott
> > > > > > >
> > > > > >
> > > > >
> > > >
> > >
> >
>

--001485e8ad58f537ed047587cde1--

From java-user-return-42743-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 22:35:17 2009
Return-Path: <java-user-return-42743-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87826 invoked from network); 9 Oct 2009 22:35:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 22:35:17 -0000
Received: (qmail 63397 invoked by uid 500); 9 Oct 2009 22:35:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63323 invoked by uid 500); 9 Oct 2009 22:35:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63313 invoked by uid 99); 9 Oct 2009 22:35:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 22:35:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 22:35:05 +0000
Received: by yxe30 with SMTP id 30so10039653yxe.29
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 15:33:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=BCH3JOBUO6b9piJve5cEYoYduL8n1wYyDHY1Pi3hpWA=;
        b=sPGixheEzP1qO64ZwqDXXtCUq4M96amDHuG7rH6WIX8nu3FgUQkkbOoMb/c0hkESM6
         gQ4jyYpamHb+Jhbdq2FG/kTPpDDZ9r4qf/93d29rLOp/1Z0ycBlF3ZaK5VBcqKBb2vK5
         Pk7KD9y012m508VH4HuhMq29SDx5qW6UT+eLY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Q+/jSflCHBQ/mMTcoQYN76Y0T/mol58CLkHb+32Keba10ceqysxV+aoo4hREOSxVoY
         s0rnAmF7nRs6Iwi7UDJKm4mvus/BBcwN3A2hjI6SOGt/38Jk8lkn7mOcr+HecnjMbJWT
         KOrTV59lCdLuka48DAqmA+IAFa3p5qBToikKY=
MIME-Version: 1.0
Received: by 10.91.189.3 with SMTP id r3mr1723339agp.48.1255127624775; Fri, 09 
	Oct 2009 15:33:44 -0700 (PDT)
In-Reply-To: <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
	 <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
Date: Fri, 9 Oct 2009 15:33:44 -0700
Message-ID: <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e645b95e38fab70475882cb1
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e645b95e38fab70475882cb1
Content-Type: text/plain; charset=ISO-8859-1

On Fri, Oct 9, 2009 at 3:07 PM, scott w <scottblanc@gmail.com> wrote:

> Example Document:
> model_1_score = 0.9
> model_2_score = 0.3
> model_3_score = 0.7
>
> I want to be able to pass in the following map at query time:
> {model_1_score=0.4, model_2_score=0.7} and have that map get used as input
> to a custom score function that would look like: 0.9*0.4 + 0.3*0.7, so that
> it is summing over the specified fields and multipling the indexed weight
> by
> the query time weight.
>

Ok, now I think I get it.  You do have some index-time floats, and
query-time
boosts.

You should be able to do a normal BooleanQuery with three OR'ed together
ValueSourceQueries boosted by input weights, it seems, as that is the way
they work - they take the values in different fields and use them as the
score,
and the normal boosting technique will use query time weigting.

To get good performance with a ValueSourceQuery, I'd suggest using a
FieldCacheSource for speedier processing:

-----------
  String field = "model_1_score";
  float runTimeBoost = 0.5;

  ValueSource model1Source = new FloatFieldSource(field,
    new FieldCache.FloatParser() {
      public float parseFloat(String s) { return Float.parseFloat(s); }
    });

  Query model1Q = new ValueSourceQuery(model1Source);

  model1Q.setBoost(runTimeBoost);

// do this for model2 and model3 as well...

  BooleanQuery bq = new BooleanQuery();
  bq.add(model1Q, Occur.SHOULD);
  bq.add(model2Q, Occur.SHOULD);
  bq.add(model3Q, Occur.SHOULD);
---------------

  I haven't tried this code, but it seems like this is what you are trying
to do...

  -jake

--0016e645b95e38fab70475882cb1--

From java-user-return-42744-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 09 22:54:11 2009
Return-Path: <java-user-return-42744-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92773 invoked from network); 9 Oct 2009 22:54:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 9 Oct 2009 22:54:10 -0000
Received: (qmail 84461 invoked by uid 500); 9 Oct 2009 22:54:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84383 invoked by uid 500); 9 Oct 2009 22:54:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84373 invoked by uid 99); 9 Oct 2009 22:54:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 22:54:08 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 09 Oct 2009 22:53:59 +0000
Received: by vws29 with SMTP id 29so635883vws.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 15:52:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=+MoRx4badYpL4wXsv3vewey+EB+/6haf4AzYik9/gOE=;
        b=CK9fI0HdQAoQZIoLYk5Lpd+pGOrfmQ3CrKLRYHCg7FSD6yUAyXHi7mMLaXwZ+Da78Z
         MDh8Y62y2mJnKAnZ1pfRBY41wgMbtry2BbWNy+xUZx+8fFlQiuVCDqlCzXMH7mH1QgKx
         6BF/GUuIcXZeVzJQmRIIJSzoZZiqYL6/VTcVo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=xujbt4HyDNYprYX4JSZjXN+wwpfHTtSbZGUGaualOPVUUhbE2Co8RXadpMwgTnmt6A
         RI8FTl6gorMs/yG+UOX2QsrDmUQGEctVK1RGCeQAXLfK7ac5Jeyn0oVtueD4Fm1tPXDw
         2M03e2X2SlaXO1r+ga8prZBJbB8sOQcSgcKb0=
MIME-Version: 1.0
Received: by 10.220.88.228 with SMTP id b36mr4970351vcm.85.1255128758053; Fri, 
	09 Oct 2009 15:52:38 -0700 (PDT)
In-Reply-To: <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
	 <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
	 <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
Date: Fri, 9 Oct 2009 15:52:38 -0700
Message-ID: <401b577e0910091552n1bec254ao8bfb31047e065a14@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163628508ec56cfe0475886fbe
X-Virus-Checked: Checked by ClamAV on apache.org

--00163628508ec56cfe0475886fbe
Content-Type: text/plain; charset=ISO-8859-1

Thanks Jake! I will test this out and report back soon in case it's helpful
to others. Definitely appreciate the help.

Scott

On Fri, Oct 9, 2009 at 3:33 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

> On Fri, Oct 9, 2009 at 3:07 PM, scott w <scottblanc@gmail.com> wrote:
>
> > Example Document:
> > model_1_score = 0.9
> > model_2_score = 0.3
> > model_3_score = 0.7
> >
> > I want to be able to pass in the following map at query time:
> > {model_1_score=0.4, model_2_score=0.7} and have that map get used as
> input
> > to a custom score function that would look like: 0.9*0.4 + 0.3*0.7, so
> that
> > it is summing over the specified fields and multipling the indexed weight
> > by
> > the query time weight.
> >
>
> Ok, now I think I get it.  You do have some index-time floats, and
> query-time
> boosts.
>
> You should be able to do a normal BooleanQuery with three OR'ed together
> ValueSourceQueries boosted by input weights, it seems, as that is the way
> they work - they take the values in different fields and use them as the
> score,
> and the normal boosting technique will use query time weigting.
>
> To get good performance with a ValueSourceQuery, I'd suggest using a
> FieldCacheSource for speedier processing:
>
> -----------
>  String field = "model_1_score";
>  float runTimeBoost = 0.5;
>
>  ValueSource model1Source = new FloatFieldSource(field,
>    new FieldCache.FloatParser() {
>      public float parseFloat(String s) { return Float.parseFloat(s); }
>    });
>
>  Query model1Q = new ValueSourceQuery(model1Source);
>
>  model1Q.setBoost(runTimeBoost);
>
> // do this for model2 and model3 as well...
>
>  BooleanQuery bq = new BooleanQuery();
>  bq.add(model1Q, Occur.SHOULD);
>  bq.add(model2Q, Occur.SHOULD);
>  bq.add(model3Q, Occur.SHOULD);
> ---------------
>
>  I haven't tried this code, but it seems like this is what you are trying
> to do...
>
>  -jake
>

--00163628508ec56cfe0475886fbe--

From java-user-return-42745-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 00:34:32 2009
Return-Path: <java-user-return-42745-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13565 invoked from network); 10 Oct 2009 00:34:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 00:34:32 -0000
Received: (qmail 51046 invoked by uid 500); 10 Oct 2009 00:34:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50974 invoked by uid 500); 10 Oct 2009 00:34:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50964 invoked by uid 99); 10 Oct 2009 00:34:30 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 00:34:30 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 00:34:20 +0000
Received: by yxe30 with SMTP id 30so10112692yxe.29
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 17:32:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=VAbrQoIjbNpBJ2tJgF5DkZcvh791bQTdAMDCzim/SPk=;
        b=u6SfZS2GLVa3CSvuAMblYxfHEopnJ+AkGWO7bPwrGeF6bZpwjJ63Zz0IITkifzhxsF
         khU9rW8rQ/m4NSEzAKpD6LtW//+cO27iZZwtkdsa1VEIfx5zoV3txyCjj+SfCxrTs2bG
         9lkSaTSIqnyG9yEKf4TU6+99bwNmuBxiwEBx8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Eq+GYXjPl+cq82FzgbHBuZPSOL2qWP2oS5d7H9Jy9e4ak/NFo6IYPUC4hleUXWRb/9
         aBgL0qBoG9UFoNzRCnWHQoZE180ARvit4MENJrAGA4jKpAjYboBEysMnurhBxelXgaVO
         RX+wPzcK6I9by3XyANg1lUtkYQSH73Xlh3o5Y=
MIME-Version: 1.0
Received: by 10.91.191.17 with SMTP id t17mr1769843agp.51.1255134779861; Fri, 
	09 Oct 2009 17:32:59 -0700 (PDT)
In-Reply-To: <401b577e0910091552n1bec254ao8bfb31047e065a14@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910080756m2f36ae8bo7c573465376d2df6@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
	 <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
	 <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
	 <401b577e0910091552n1bec254ao8bfb31047e065a14@mail.gmail.com>
Date: Fri, 9 Oct 2009 17:32:59 -0700
Message-ID: <4b124c310910091732y5a78f89cnb000e45e7614d21d@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e646182eb2ecf9047589d62d
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e646182eb2ecf9047589d62d
Content-Type: text/plain; charset=ISO-8859-1

Great Scott (hah!) - please do report back, even if it just works fine and
you have no more questions, I'd like to know whether this really is
what you were after and actually works for you.

Note that the FieldCache is kinda "magic" - it's lazy (so the first query
will
be slow and you should fire one off just to warm it up after every time
you reload an IndexReader), and kinda leaky: the entries in the FieldCache
stick around until all references to the IndexReader they're keyed on
get garbage collected (there's a WeakHashMap in the background), so
don't accidentally hang onto references to those IndexReaders past
when needed.

  -jake

On Fri, Oct 9, 2009 at 3:52 PM, scott w <scottblanc@gmail.com> wrote:

> Thanks Jake! I will test this out and report back soon in case it's helpful
> to others. Definitely appreciate the help.
>
> Scott
>
> On Fri, Oct 9, 2009 at 3:33 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
>
> > On Fri, Oct 9, 2009 at 3:07 PM, scott w <scottblanc@gmail.com> wrote:
> >
> > > Example Document:
> > > model_1_score = 0.9
> > > model_2_score = 0.3
> > > model_3_score = 0.7
> > >
> > > I want to be able to pass in the following map at query time:
> > > {model_1_score=0.4, model_2_score=0.7} and have that map get used as
> > input
> > > to a custom score function that would look like: 0.9*0.4 + 0.3*0.7, so
> > that
> > > it is summing over the specified fields and multipling the indexed
> weight
> > > by
> > > the query time weight.
> > >
> >
> > Ok, now I think I get it.  You do have some index-time floats, and
> > query-time
> > boosts.
> >
> > You should be able to do a normal BooleanQuery with three OR'ed together
> > ValueSourceQueries boosted by input weights, it seems, as that is the way
> > they work - they take the values in different fields and use them as the
> > score,
> > and the normal boosting technique will use query time weigting.
> >
> > To get good performance with a ValueSourceQuery, I'd suggest using a
> > FieldCacheSource for speedier processing:
> >
> > -----------
> >  String field = "model_1_score";
> >  float runTimeBoost = 0.5;
> >
> >  ValueSource model1Source = new FloatFieldSource(field,
> >    new FieldCache.FloatParser() {
> >      public float parseFloat(String s) { return Float.parseFloat(s); }
> >    });
> >
> >  Query model1Q = new ValueSourceQuery(model1Source);
> >
> >  model1Q.setBoost(runTimeBoost);
> >
> > // do this for model2 and model3 as well...
> >
> >  BooleanQuery bq = new BooleanQuery();
> >  bq.add(model1Q, Occur.SHOULD);
> >  bq.add(model2Q, Occur.SHOULD);
> >  bq.add(model3Q, Occur.SHOULD);
> > ---------------
> >
> >  I haven't tried this code, but it seems like this is what you are trying
> > to do...
> >
> >  -jake
> >
>

--0016e646182eb2ecf9047589d62d--

From java-user-return-42746-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 04:09:56 2009
Return-Path: <java-user-return-42746-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51750 invoked from network); 10 Oct 2009 04:09:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 04:09:56 -0000
Received: (qmail 47298 invoked by uid 500); 10 Oct 2009 04:09:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47157 invoked by uid 500); 10 Oct 2009 04:09:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47147 invoked by uid 99); 10 Oct 2009 04:09:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 04:09:54 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bradfordstephens@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 04:09:44 +0000
Received: by gxk26 with SMTP id 26so1396782gxk.11
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 21:09:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=tPs+jNBb/BfjqVIvPxgnTnkp3o2Im8prSIZIveFnNls=;
        b=D/WhNSCCx07k2dT7qyWTwHAOTb4Dls61Cn1H2PcPfcO7k5DA1MDZNQ0FeHUNjgSR9o
         /agCvYkjQdmAJG9WB7yb4LZrmuie5lHFEUy3fJFJjlfDh5UtIOhCgFVZGCfgTJxv5HC2
         AlBMoFZ5chPoqS1f+D77wUoW8ep6gfxXy/AYU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=ZILk4rjvteCFJbbpgP76JC4dNXHefr1X0Bf/pvOkesQ6lFFbeBEaZY9L+5kYymUaH/
         kF+oGPnvHrodO72V1MeiloRnXVm0lzEVJf8qNvF4ZQx1nmvg65eBAMT9sh49jDGgXPQM
         qaPWeqYM1nf0BZOHmvJI1BD3a6QXjVR2BZqQA=
MIME-Version: 1.0
Received: by 10.90.62.17 with SMTP id k17mr1890230aga.17.1255147763105; Fri, 
	09 Oct 2009 21:09:23 -0700 (PDT)
In-Reply-To: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
Date: Fri, 9 Oct 2009 21:09:23 -0700
Message-ID: <860544ed0910092109r23a461f1w230f28b86babde93@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Bradford Stephens <bradfordstephens@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hey Eric,

My consulting company specializes in scalable, real-time search with
distributed Lucene. I'm more than happy to chat, if you'd like! :)

Cheers,
Bradford

On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
>
> Does anyone have any recommendations? =A0I've looked at Katta, but it doe=
sn't
> seem to support realtime searching. =A0It also uses hdfs, which I've hear=
d can
> be slow. =A0I'm looking to serve 40gb of indexes and support about 1 mill=
ion
> updates per day.
>
> Thx
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20
http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
and Distributed Lucene Consulting

http://www.roadtofailure.com -- The Fringes of Scalability, Social
Media, and Computer Science

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42747-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 04:10:29 2009
Return-Path: <java-user-return-42747-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51834 invoked from network); 10 Oct 2009 04:10:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 04:10:29 -0000
Received: (qmail 48983 invoked by uid 500); 10 Oct 2009 04:10:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48904 invoked by uid 500); 10 Oct 2009 04:10:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48894 invoked by uid 99); 10 Oct 2009 04:10:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 04:10:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bradfordstephens@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 04:10:17 +0000
Received: by mail-gx0-f226.google.com with SMTP id 26so1396782gxk.11
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 21:09:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=v+xevmPAuEbUy5cCMIseaDEvXmqjgTMANycB0a3V+BI=;
        b=P0k5sByHlYa3Cak2REB6ZbVxSuDFME18cF1IyqtItVuSswSrrYiT8vVH4AF6Un53Th
         RfqG8D516XfH0O1Q2E5J4K432IQQtz4Gzy//MsF7djYhq8mXMVni4hdGE64FehdS0jxT
         srHlSUBexr/n501PAPAuRr9nVY/h1Ya+sJvAg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=DI5WpPDsektXPo8jCTLwKYWYvI0MRXvcD1Eop7ktenFCxuPkkAoT7rAGtqq7B3JlzC
         f6Q9QcDSCD9xACPba9dL9s1Da8Rs5n7N22gvNC/6fbHRt/dMJX6BL0KMPtjcoweUA88V
         4fIuMmFDta2NBdkY8D7oFMaSFKNP8dCZDWeGk=
MIME-Version: 1.0
Received: by 10.90.45.11 with SMTP id s11mr1867708ags.72.1255147796966; Fri, 
	09 Oct 2009 21:09:56 -0700 (PDT)
In-Reply-To: <860544ed0910092109r23a461f1w230f28b86babde93@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <860544ed0910092109r23a461f1w230f28b86babde93@mail.gmail.com>
Date: Fri, 9 Oct 2009 21:09:56 -0700
Message-ID: <860544ed0910092109x606c890asfc34915e2dfd444@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Bradford Stephens <bradfordstephens@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

My deepest apologies for the spam, everyone. I slipped on my G-mail button =
:)

On Fri, Oct 9, 2009 at 9:09 PM, Bradford Stephens
<bradfordstephens@gmail.com> wrote:
> Hey Eric,
>
> My consulting company specializes in scalable, real-time search with
> distributed Lucene. I'm more than happy to chat, if you'd like! :)
>
> Cheers,
> Bradford
>
> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
>>
>> Does anyone have any recommendations? =A0I've looked at Katta, but it do=
esn't
>> seem to support realtime searching. =A0It also uses hdfs, which I've hea=
rd can
>> be slow. =A0I'm looking to serve 40gb of indexes and support about 1 mil=
lion
>> updates per day.
>>
>> Thx
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
> --
> http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
> and Distributed Lucene Consulting
>
> http://www.roadtofailure.com -- The Fringes of Scalability, Social
> Media, and Computer Science
>



--=20
http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
and Distributed Lucene Consulting

http://www.roadtofailure.com -- The Fringes of Scalability, Social
Media, and Computer Science

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42748-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 04:10:36 2009
Return-Path: <java-user-return-42748-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51864 invoked from network); 10 Oct 2009 04:10:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 04:10:36 -0000
Received: (qmail 50694 invoked by uid 500); 10 Oct 2009 04:10:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50638 invoked by uid 500); 10 Oct 2009 04:10:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50628 invoked by uid 99); 10 Oct 2009 04:10:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 04:10:33 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mmasters@gmail.com designates 74.125.78.26 as permitted sender)
Received: from [74.125.78.26] (HELO ey-out-2122.google.com) (74.125.78.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 04:10:22 +0000
Received: by ey-out-2122.google.com with SMTP id 22so1711789eye.3
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 21:09:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=7n56ZG5IH8cqQIrosYC5mJLqrZKuOmSGy+k97PdzatM=;
        b=lsdBaJYq5DZD5QHvQNPYyBfYOGMbW3Ox7HEkgMjsekdjTtiJyNXUL4ppKXKqHGembg
         Iv2UJi+hudu/9SgajuxnzPdqz70rI/rYjJysrJDGYz8u0skPlbvYDWiHWSOtMm8s9YDq
         EfiaR1oeI3DxCqhgwdhz/rKIW7RzLjxpfh1+0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=suNSr1iAshEDNmX29YeMbuQYOAwsfTp2UTcCD7gAu5UhMOpEmOkvBbmyXRH8y8LEQ2
         gLrtk/Ll4wvk6ZoY8T1PG8a4M6MAEIr2P7ttKzoDCF9ivOovGlT4+D5cOueCwh3M0wb1
         9lYo9RKwoF2pDE8ctPzo7wLR7lxONgnTupdec=
MIME-Version: 1.0
Received: by 10.216.87.71 with SMTP id x49mr1106411wee.11.1255147742112; Fri, 
	09 Oct 2009 21:09:02 -0700 (PDT)
In-Reply-To: <4b124c310910082024p450dbdf9x54f072d393e4cebf@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <4b124c310910082024p450dbdf9x54f072d393e4cebf@mail.gmail.com>
Date: Fri, 9 Oct 2009 22:09:02 -0600
Message-ID: <5b8626350910092109hd2f0d36h77e8c1901f95daa3@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Michael Masters <mmasters@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Jake,

Zoie looks like a a really cool project. I'd like to learn more about
the distributed part of the setup. Any way you could describe that
here or on the wiki?

-Mike

On Thu, Oct 8, 2009 at 9:24 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
>
>>
>> Does anyone have any recommendations? =A0I've looked at Katta, but it do=
esn't
>> seem to support realtime searching. =A0It also uses hdfs, which I've hea=
rd can
>> be slow. =A0I'm looking to serve 40gb of indexes and support about 1 mil=
lion
>> updates per day.
>>
>>
> Hi Eric,
>
> =A0As I mentioned in my response to Jason, we at LinkedIn serve our rough=
ly
> 50million document profile index on a real-time distributed setup (we're
> serving facets in real-time also), serving tens of millions of queries a =
day
> in the 1-10ms latency per node, based on the open source zoie project (bu=
ilt
> here at LinkedIn) : http://zoie.googlecode.com
>
> =A0Zoie doesn't handle the distributed part of the setup, it's just the
> real-time side. =A0Distribution is done pretty straitgtforwardly in our c=
ase
> though: N shards each getting a different contiguous slice of the user ba=
se,
> each replicated K times, and all N*K nodes get indexing events distribute=
d
> by a message queue independently.
>
> =A0If you have any questions about zoie, let me know. =A0The documentatio=
n
> could get filled in a little further, and it doesn't touch on distributed
> side of things, so feel free to ping me.
>
> =A0-jake
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42749-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 05:36:46 2009
Return-Path: <java-user-return-42749-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63440 invoked from network); 10 Oct 2009 05:36:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 05:36:46 -0000
Received: (qmail 80898 invoked by uid 500); 10 Oct 2009 05:36:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80815 invoked by uid 500); 10 Oct 2009 05:36:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80805 invoked by uid 99); 10 Oct 2009 05:36:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 05:36:43 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 05:36:32 +0000
Received: by ywh14 with SMTP id 14so2292956ywh.20
        for <java-user@lucene.apache.org>; Fri, 09 Oct 2009 22:35:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=E+XSn0CLyTHxLk2YZWPpnPyaMhikP6ZTRPoo6cOxO+o=;
        b=Ak43BdAd2JumKabH3VI0x6VooAMYA5eJfhziHLJ/UJGW1uXpJkNLZAxQ25zNeP9oGC
         UmA0CBJQkALpxmnAyywELpC6ye4AaulRHMWN635801b5HeTo6YJmMNfErZ0ViBkyVNYg
         JzfvuhkmE0UR1Ek6naatfGybXthgOuaIPist0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Qoa/ph9WA1HiGwjpTGSOm6thsmtnfOgnWf+FFxGMC9AHsHtqyfuFiSpWE57sVgJgho
         gfQfD3HAQ974Ac86hFVXG7dINS1Ff0943PHFAme10Bml57gJsn8b+hgBlO+y3pPXkwi2
         BY2iF24MpQM11ExXnWkEBfxa5gmKob4lwWeYQ=
MIME-Version: 1.0
Received: by 10.90.127.20 with SMTP id z20mr1904930agc.118.1255152911483; Fri, 
	09 Oct 2009 22:35:11 -0700 (PDT)
In-Reply-To: <5b8626350910092109hd2f0d36h77e8c1901f95daa3@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <4b124c310910082024p450dbdf9x54f072d393e4cebf@mail.gmail.com>
	 <5b8626350910092109hd2f0d36h77e8c1901f95daa3@mail.gmail.com>
Date: Fri, 9 Oct 2009 22:35:11 -0700
Message-ID: <4b124c310910092235h45709d79ldd484a15cf5cb20b@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016361e89ec6d837404758e0fe6
X-Virus-Checked: Checked by ClamAV on apache.org

--0016361e89ec6d837404758e0fe6
Content-Type: text/plain; charset=ISO-8859-1

Hi Mike,

  Zoie itself doesn't do anything with the new with the distributed
side of things - it just plays nicely with it.   Zoie, at its core,
exposes a couple of primary interfaces (well, this is a slightly
simplified form of them) :

  interface IndexReaderFactory {  List getIndexReaders(); }, and
  interface DataConsumer{ void consume(Collection events); }

To do distributed realtime search with zoie, you just need to
make sure you get your indexing events to each of your nodes
as fast as they show up, push them in through the DataConsumer
API, and IndexReaders exposed through getIndexReaders() are
then a fresh realtime read-only view on the index on each node.

Doing distributed search with a setup like this now means just
pushing your Query to all of the nodes, returning the top n hits
from each back to a broker, sorting all n * num_nodes results
by score and taking the top n of that combined list.

Depending on your system's setup, you either push events to
the nodes, or pull events from somewhere to them, but if you do
the latter the realtimeliness will be bounded by how often you
poll, of course.

  -jake

On Fri, Oct 9, 2009 at 9:09 PM, Michael Masters <mmasters@gmail.com> wrote:

> Hi Jake,
>
> Zoie looks like a a really cool project. I'd like to learn more about
> the distributed part of the setup. Any way you could describe that
> here or on the wiki?
>
> -Mike
>
> On Thu, Oct 8, 2009 at 9:24 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> > On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
> >
> >>
> >> Does anyone have any recommendations?  I've looked at Katta, but it
> doesn't
> >> seem to support realtime searching.  It also uses hdfs, which I've heard
> can
> >> be slow.  I'm looking to serve 40gb of indexes and support about 1
> million
> >> updates per day.
> >>
> >>
> > Hi Eric,
> >
> >  As I mentioned in my response to Jason, we at LinkedIn serve our roughly
> > 50million document profile index on a real-time distributed setup (we're
> > serving facets in real-time also), serving tens of millions of queries a
> day
> > in the 1-10ms latency per node, based on the open source zoie project
> (built
> > here at LinkedIn) : http://zoie.googlecode.com
> >
> >  Zoie doesn't handle the distributed part of the setup, it's just the
> > real-time side.  Distribution is done pretty straitgtforwardly in our
> case
> > though: N shards each getting a different contiguous slice of the user
> base,
> > each replicated K times, and all N*K nodes get indexing events
> distributed
> > by a message queue independently.
> >
> >  If you have any questions about zoie, let me know.  The documentation
> > could get filled in a little further, and it doesn't touch on distributed
> > side of things, so feel free to ping me.
> >
> >  -jake
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016361e89ec6d837404758e0fe6--

From java-user-return-42750-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 19:18:24 2009
Return-Path: <java-user-return-42750-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32059 invoked from network); 10 Oct 2009 19:18:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 19:18:13 -0000
Received: (qmail 26985 invoked by uid 500); 10 Oct 2009 19:18:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26901 invoked by uid 500); 10 Oct 2009 19:18:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26891 invoked by uid 99); 10 Oct 2009 19:18:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 19:18:11 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jason.rutherglen@gmail.com designates 74.125.92.27 as permitted sender)
Received: from [74.125.92.27] (HELO qw-out-2122.google.com) (74.125.92.27)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 19:18:01 +0000
Received: by qw-out-2122.google.com with SMTP id 5so826398qwd.53
        for <java-user@lucene.apache.org>; Sat, 10 Oct 2009 12:16:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=otdabijbec31/z9TbHfiDn4+gF9t3IXKL3FeiMOKksE=;
        b=JHJuzKo8pW6kJpn+WMaViJ5hw/vp/o5d/ZnCimQHozCbah83RxvzaIMxpKVnT+qbxb
         dIP/3SKp1QXwsxJ/9u35+VOshFzSsIk+H6Ih9V+8lOWLnD1vhgpqz0pHRzmNlMSr4OWR
         Xo4e1TxMuwh7KoutDxyTPFmkhHZrKV39cWZwg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=OxFk6vzPBdtxVbsJHwQtinYKu5KiQs3/jBVLyORfXcmGE4MDDHQYZAnK9ybs0kNO5E
         PXZ6CtSHiAZsweuxLzQA9lV7YjoKLN2d2jrrS7iwQTZxHoRa20172CLZufBy04AmlfIZ
         0zmuzcnOXLqZhgOXC5w51btGZ0WlxQRuXCWCY=
MIME-Version: 1.0
Received: by 10.224.116.212 with SMTP id n20mr3702364qaq.172.1255202200886; 
	Sat, 10 Oct 2009 12:16:40 -0700 (PDT)
In-Reply-To: <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
Date: Sat, 10 Oct 2009 12:16:40 -0700
Message-ID: <85d3c3b60910101216h1676117fi2ff4652dbd3eb95e@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

John,

Actually everyone is entitled to their technical opinion and
none of the comments were misleading. Jake and yourself
validated that they are true in your comments. I'm simply trying
to create better technology as is everyone on here. The process
takes time and coordination between many parties of many
backgrounds around the globe. Sometimes there are differences of
opinion, however those are easily ironed out over time (and quite
frankly in this case benchmarks).

However I am very concerned about your ignorant disregard of some of the
most basic human rights in existence.

-J

On Thu, Oct 8, 2009 at 10:26 PM, John Wang <john.wang@gmail.com> wrote:
> Jason:
> =A0 =A0 =A0 =A0I would really appreciate it if you would stop making fals=
e
> statements and misinformation. Everyone is entitled to his/her opinions o=
n
> technologies, but deliberately making misleading and false information on
> such a distribution is just unethical, and you'll end up just discreditin=
g
> yourself.
>
> =A0 =A0 =A0 =A0Making unsubstantiated comments while not willing to put i=
n any
> effort is the primary reason you are no longer working at Linkedin and on
> Zoie.
>
> "The problem
> with this is, merging in the background becomes really tricky
> unless it's performed inside of IndexWriter" - *what does this really mea=
n?
> Merging happens regardless in an incremental indexing system. Especially
> with high indexing load, segments are created often, merging is crucial.*
> "There is the Zoie system which uses the RAMDir
> solution, however it's implemented using a customized deleted
> doc set based on a bloomfilter backed by an inefficient RB tree
> which slows down queries" =A0-* if you ever spend the time to read the co=
de,
> (even when you were working on it), it is just not true. We did have an R=
B
> set for deleted docs, quite a few releases ago, and we changed to a speci=
al
> type of bloomfilter set backed by a hash int set. You knew this and was p=
art
> of the discussion on it, and now saying such a thing is just plain
> disappointing.*
>
> =A0 =A0 =A0 =A0Thanks Jake for the clarification, and Eric, let me know i=
f you to
> know more in detail with how we are dealing with realtime indexing/search
> with Zoie here at linkedin in a production environment powering a real
> internet company with real traffic.
>
> -John
>
> On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <jason.rutherglen@gmail.=
com
>> wrote:
>
>> Eric,
>>
>> Katta doesn't require HDFS which would be slow to search on,
>> though Katta can be used to copy indexes out of HDFS onto local
>> servers. The best bet is hardware that uses SSDs because merges
>> and update latency will greatly decrease and there won't be a
>> synchronous IO issue as there is with hard drives. Also, IO
>> caches get flushed as large merges occur, which means subsequent
>> queries may hit the HD and slow down. With SSDs this is much
>> less of an issue.
>>
>> Today near realtime search (with or without SSDs) comes at a
>> price, that is reduced indexing speed due to continued in RAM
>> merging. People typically hack something together where indexes
>> are held in a RAMDir until being flushed to disk. The problem
>> with this is, merging in the background becomes really tricky
>> unless it's performed inside of IndexWriter (see LUCENE-1313 and
>> IW.getReader). There is the Zoie system which uses the RAMDir
>> solution, however it's implemented using a customized deleted
>> doc set based on a bloomfilter backed by an inefficient RB tree
>> which slows down queries. There's always a trade off when trying
>> to build an NRT system, currently.
>>
>> Also, there isn't a clear way to replicate segments in realtime
>> so people usually end up analyzing documents on each replicated
>> node, which is redundant. A long term solution here could be a
>> distributed transaction log where encoded segments are stored
>> and replicated to N nodes.
>>
>> Deletes can pile up in segments so the
>> BalancedSegmentMergePolicy could be used to remove those faster
>> than LogMergePolicy, however I haven't tested it, and it may be
>> trying to not do large segment merges altogether which IMO
>> is less than ideal because query performance soon degrades
>> (similar to an unoptimized index).
>>
>> Hopefully in the future we can offer searching over
>> IndexWriter's RAM buffer where indexing and search speed would
>> be roughly what it is today. That combined with a way to insure
>> segments don't get flushed out of the IO cache during large
>> segment merges would mean really efficient NRT, even on systems
>> with HDs. In the interim, you'd need to play around and see what
>> works for your requirements.
>>
>> -J
>>
>> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> wrote:
>> >
>> > Does anyone have any recommendations? =A0I've looked at Katta, but it
>> doesn't
>> > seem to support realtime searching. =A0It also uses hdfs, which I've h=
eard
>> can
>> > be slow. =A0I'm looking to serve 40gb of indexes and support about 1
>> million
>> > updates per day.
>> >
>> > Thx
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42751-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 20:13:09 2009
Return-Path: <java-user-return-42751-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39242 invoked from network); 10 Oct 2009 20:13:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 20:13:09 -0000
Received: (qmail 52525 invoked by uid 500); 10 Oct 2009 20:13:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52427 invoked by uid 500); 10 Oct 2009 20:13:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52417 invoked by uid 99); 10 Oct 2009 20:13:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 20:13:06 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [217.146.177.1] (HELO web27001.mail.ukl.yahoo.com) (217.146.177.1)
    by apache.org (qpsmtpd/0.29) with SMTP; Sat, 10 Oct 2009 20:12:54 +0000
Received: (qmail 31061 invoked by uid 60001); 10 Oct 2009 20:12:33 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.fr; s=s1024; t=1255205553; bh=Y6bcC0/KjUHkZFlkAadhJ0QiWWk9bXb6ULDL3V4SE5U=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=vF2UHSInb6W231tFjRbnrSsyjY9DLq8cSIBdER0CEwckJ/X080LiReUMb9kRH4FdvUuvmnre1QeHIp+Gv8P0KZTIQUf2/UShs8vXFjfFESn1mFpd2QdD4kq2ZsOr4IEYMv0Ke7ezqalP8n+T+p+JcHAZ0WxUrF1BRLAxkXe1Uuw=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.fr;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=fswa4f+zh08LjlAoV2+TzNuRvcCqWLiaEx4jI+G4ZJ32xa4gN+du9/n6AjvoljG4GEGCexbPgxpwA0s5Kgq0g1oInB096y+Jgv0Q/SQt7KBJ7+Gymth6TVus7S1gerfWYnsYVzDVcZ/XSSf8XsZRapX6C/pO/KpU/jrLUlLQj5c=;
Message-ID: <170683.30588.qm@web27001.mail.ukl.yahoo.com>
X-YMail-OSG: MosTfQUVM1noHKrsOoKrgsHyxb2DWiIRbOyLqMi7udXKigdtOGus90eg4Kp9Z1cnYpmQ6OhmLihHZbQzJE5kZWnih7heZ8Buq4egiMIH0H257y5vLH70h_mz3u3D7lJZtYogeKWNI5Pfvfj..TQA44JxfHWl98kh2KLWlQSm_GXxcQSI_DT6540QoAY_NARJDY..sLwlRQT_dfjjnB.rxYE6RCDrPTojoY2TJjJhBvOG4u_RflAE3V6yZK7l5ORbUQE-
Received: from [90.11.157.125] by web27001.mail.ukl.yahoo.com via HTTP; Sat, 10 Oct 2009 20:12:32 GMT
X-Mailer: YahooMailRC/182.10 YahooMailWebService/0.7.347.3
Date: Sat, 10 Oct 2009 20:12:32 +0000 (GMT)
From: M R <michel_faul@yahoo.fr>
Subject: Question about new TopScoreDocCollector class in Lucene 2.9
To: java-user@lucene.apache.org, java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1475005710-1255205552=:30588"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-1475005710-1255205552=:30588
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi=0A=0AThis is the example given on the deprecated Hits class about using =
the new TopScoreDocCollector class :=0A=0ATopScoreDocCollector collector =
=3D new TopScoreDocCollector(hitsPerPage);=0A   searcher.search(query, coll=
ector);=0A   ScoreDoc[] hits =3D collector.topDocs().scoreDocs;=0A   for (i=
nt i =3D 0; i < hits.length; i++) {=0A     int docId =3D hits[i].doc;=0A   =
  Document d =3D searcher.doc(docId);=0A     // do something with current h=
it=0A     ...=0AI suppose hitsPerPage is the number of documents to return =
? (TopScoreDocCollector is noted abstract with no constructor on its javado=
c).=0AThanks=0AMichel=0A=0A=0A=0A      
--0-1475005710-1255205552=:30588--

From java-user-return-42752-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 20:13:11 2009
Return-Path: <java-user-return-42752-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39304 invoked from network); 10 Oct 2009 20:13:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 20:13:11 -0000
Received: (qmail 52779 invoked by uid 500); 10 Oct 2009 20:13:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52706 invoked by uid 500); 10 Oct 2009 20:13:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52428 invoked by uid 99); 10 Oct 2009 20:13:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 20:13:06 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [217.146.177.1] (HELO web27001.mail.ukl.yahoo.com) (217.146.177.1)
    by apache.org (qpsmtpd/0.29) with SMTP; Sat, 10 Oct 2009 20:12:54 +0000
Received: (qmail 31061 invoked by uid 60001); 10 Oct 2009 20:12:33 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.fr; s=s1024; t=1255205553; bh=Y6bcC0/KjUHkZFlkAadhJ0QiWWk9bXb6ULDL3V4SE5U=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=vF2UHSInb6W231tFjRbnrSsyjY9DLq8cSIBdER0CEwckJ/X080LiReUMb9kRH4FdvUuvmnre1QeHIp+Gv8P0KZTIQUf2/UShs8vXFjfFESn1mFpd2QdD4kq2ZsOr4IEYMv0Ke7ezqalP8n+T+p+JcHAZ0WxUrF1BRLAxkXe1Uuw=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.fr;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=fswa4f+zh08LjlAoV2+TzNuRvcCqWLiaEx4jI+G4ZJ32xa4gN+du9/n6AjvoljG4GEGCexbPgxpwA0s5Kgq0g1oInB096y+Jgv0Q/SQt7KBJ7+Gymth6TVus7S1gerfWYnsYVzDVcZ/XSSf8XsZRapX6C/pO/KpU/jrLUlLQj5c=;
Message-ID: <170683.30588.qm@web27001.mail.ukl.yahoo.com>
X-YMail-OSG: MosTfQUVM1noHKrsOoKrgsHyxb2DWiIRbOyLqMi7udXKigdtOGus90eg4Kp9Z1cnYpmQ6OhmLihHZbQzJE5kZWnih7heZ8Buq4egiMIH0H257y5vLH70h_mz3u3D7lJZtYogeKWNI5Pfvfj..TQA44JxfHWl98kh2KLWlQSm_GXxcQSI_DT6540QoAY_NARJDY..sLwlRQT_dfjjnB.rxYE6RCDrPTojoY2TJjJhBvOG4u_RflAE3V6yZK7l5ORbUQE-
Received: from [90.11.157.125] by web27001.mail.ukl.yahoo.com via HTTP; Sat, 10 Oct 2009 20:12:32 GMT
X-Mailer: YahooMailRC/182.10 YahooMailWebService/0.7.347.3
Date: Sat, 10 Oct 2009 20:12:32 +0000 (GMT)
From: M R <michel_faul@yahoo.fr>
Subject: Question about new TopScoreDocCollector class in Lucene 2.9
To: java-user@lucene.apache.org, java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1475005710-1255205552=:30588"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-1475005710-1255205552=:30588
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi=0A=0AThis is the example given on the deprecated Hits class about using =
the new TopScoreDocCollector class :=0A=0ATopScoreDocCollector collector =
=3D new TopScoreDocCollector(hitsPerPage);=0A   searcher.search(query, coll=
ector);=0A   ScoreDoc[] hits =3D collector.topDocs().scoreDocs;=0A   for (i=
nt i =3D 0; i < hits.length; i++) {=0A     int docId =3D hits[i].doc;=0A   =
  Document d =3D searcher.doc(docId);=0A     // do something with current h=
it=0A     ...=0AI suppose hitsPerPage is the number of documents to return =
? (TopScoreDocCollector is noted abstract with no constructor on its javado=
c).=0AThanks=0AMichel=0A=0A=0A=0A      
--0-1475005710-1255205552=:30588--

From java-user-return-42753-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 10 21:29:40 2009
Return-Path: <java-user-return-42753-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52020 invoked from network); 10 Oct 2009 21:29:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 10 Oct 2009 21:29:40 -0000
Received: (qmail 5527 invoked by uid 500); 10 Oct 2009 21:29:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5435 invoked by uid 500); 10 Oct 2009 21:29:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5420 invoked by uid 99); 10 Oct 2009 21:29:37 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 21:29:37 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 10 Oct 2009 21:29:28 +0000
Received: by ywh14 with SMTP id 14so2639469ywh.20
        for <java-user@lucene.apache.org>; Sat, 10 Oct 2009 14:28:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=w04m6ZCkkv7BclzttdF3gBy7C7Sc/GfpeVIF1FyRnXM=;
        b=HyzDQug8PNhALLCBU/tHSYGshD7kV54WH3u/dEqMrvj0Qntz+5itcaQT2+QkQaSwaq
         TZsfbf+oaMmiSuzVDFOfYJKbjIs+rjUo9hj+X4YOvbHkhGqSx7Ex/oxfgoW+QwiU8t+E
         bZ+Y0stnqz1u4su1rGXE/WqARfPquYrK6R6eQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Eb54vn06sWA2gftoogYwTORqv6J/yspu1i/k0akqg2Ceca1qpsIgsDLhuq/5qKeiBa
         ONphP3x6lRnttELwN7Dr3kcIEseVssoLw36rI6fCdNCtg6krynaCaZvEaZCjl3kAXUQb
         aTCfPTH2O6+5GT6S+cJsoW/wKGwOagjXaOG6M=
MIME-Version: 1.0
Received: by 10.90.211.6 with SMTP id j6mr2404147agg.86.1255210087598; Sat, 10 
	Oct 2009 14:28:07 -0700 (PDT)
In-Reply-To: <170683.30588.qm@web27001.mail.ukl.yahoo.com>
References: <170683.30588.qm@web27001.mail.ukl.yahoo.com>
Date: Sat, 10 Oct 2009 14:28:07 -0700
Message-ID: <4b124c310910101428w342ee445le1a3fc79588bc7a3@mail.gmail.com>
Subject: Re: Question about new TopScoreDocCollector class in Lucene 2.9
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163628404463ca2d04759b5f70
X-Virus-Checked: Checked by ClamAV on apache.org

--00163628404463ca2d04759b5f70
Content-Type: text/plain; charset=ISO-8859-1

Hi Michael,

  If you just want the top "n" hits (the way you used to use the Hits
class), just call

  TopDocs topDocs = Searcher.search(query, n);

  Don't worry about the Collector interface unless you actually need it.

  -jake

On Sat, Oct 10, 2009 at 1:12 PM, M R <michel_faul@yahoo.fr> wrote:

> Hi
>
> This is the example given on the deprecated Hits class about using the new
> TopScoreDocCollector class :
>
> TopScoreDocCollector collector = new TopScoreDocCollector(hitsPerPage);
>   searcher.search(query, collector);
>   ScoreDoc[] hits = collector.topDocs().scoreDocs;
>   for (int i = 0; i < hits.length; i++) {
>     int docId = hits[i].doc;
>     Document d = searcher.doc(docId);
>     // do something with current hit
>     ...
> I suppose hitsPerPage is the number of documents to return ?
> (TopScoreDocCollector is noted abstract with no constructor on its javadoc).
> Thanks
> Michel
>
>
>
>

--00163628404463ca2d04759b5f70--

From java-user-return-42754-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 02:26:16 2009
Return-Path: <java-user-return-42754-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13750 invoked from network); 11 Oct 2009 02:26:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 02:26:15 -0000
Received: (qmail 65797 invoked by uid 500); 11 Oct 2009 02:26:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65709 invoked by uid 500); 11 Oct 2009 02:26:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65699 invoked by uid 99); 11 Oct 2009 02:26:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 02:26:13 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 02:26:03 +0000
Received: by vws29 with SMTP id 29so929078vws.20
        for <java-user@lucene.apache.org>; Sat, 10 Oct 2009 19:24:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=dF+HmVOoGCvMyN4pXYo8g/SrLaZdW7Pizw8MQwj33eY=;
        b=ZmEdLr8wmi/zR0AOWTcNtkm2Ruz2wIFgG2tA3qdPBhYUJPr+Gov71aKK63p6RyL+Zu
         nmsy8QJOGIAKbTlu+qVujTl/5OozHQWduXsIBSb/G1XM6VXlf5Yg0utAp/fr4SYpv4L5
         RVfUSlbNbi0+oXuIDztqdkGjuuciyWCY5Y67Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VTQQuJUG1IYJsyzx+saU5HW2tVCPcPz1Kxa6umXqUTATfLks9Ojk4HwNGyRciM8DIm
         G+USnMY2Ao/2Nd5CU9UHYWbtkdgUgq0MxVgiEq7iN2/D0RAwsjGD6KXe3Cz6/YNuYQQY
         AcLEXigXqCTfFFkdHOxWDp/sQsjurGfWa1h8s=
MIME-Version: 1.0
Received: by 10.220.88.220 with SMTP id b28mr6439014vcm.35.1255227882877; Sat, 
	10 Oct 2009 19:24:42 -0700 (PDT)
In-Reply-To: <4b124c310910091732y5a78f89cnb000e45e7614d21d@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <359a92830910080806j576b0d03n77c55c4091f3e331@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
	 <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
	 <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
	 <401b577e0910091552n1bec254ao8bfb31047e065a14@mail.gmail.com>
	 <4b124c310910091732y5a78f89cnb000e45e7614d21d@mail.gmail.com>
Date: Sat, 10 Oct 2009 19:24:42 -0700
Message-ID: <401b577e0910101924l54d65607te63ada74eb6c938a@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b8e1c1241ab04759f84aa
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b8e1c1241ab04759f84aa
Content-Type: text/plain; charset=ISO-8859-1

Haven't tried it yet but looking at it closer it looks like it's not
something I can plug in on top of my original query. I am definitely happy
using an approximation for the sake of performance but I do need to be able
to have the original results stay the same.

On Fri, Oct 9, 2009 at 5:32 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

> Great Scott (hah!) - please do report back, even if it just works fine and
> you have no more questions, I'd like to know whether this really is
> what you were after and actually works for you.
>

> Note that the FieldCache is kinda "magic" - it's lazy (so the first query
> will
> be slow and you should fire one off just to warm it up after every time
> you reload an IndexReader), and kinda leaky: the entries in the FieldCache
> stick around until all references to the IndexReader they're keyed on
> get garbage collected (there's a WeakHashMap in the background), so
> don't accidentally hang onto references to those IndexReaders past
> when needed.
>

Good to know.

>
>  -jake
>
> On Fri, Oct 9, 2009 at 3:52 PM, scott w <scottblanc@gmail.com> wrote:
>
> > Thanks Jake! I will test this out and report back soon in case it's
> helpful
> > to others. Definitely appreciate the help.
> >
> > Scott
> >
> > On Fri, Oct 9, 2009 at 3:33 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> >
> > > On Fri, Oct 9, 2009 at 3:07 PM, scott w <scottblanc@gmail.com> wrote:
> > >
> > > > Example Document:
> > > > model_1_score = 0.9
> > > > model_2_score = 0.3
> > > > model_3_score = 0.7
> > > >
> > > > I want to be able to pass in the following map at query time:
> > > > {model_1_score=0.4, model_2_score=0.7} and have that map get used as
> > > input
> > > > to a custom score function that would look like: 0.9*0.4 + 0.3*0.7,
> so
> > > that
> > > > it is summing over the specified fields and multipling the indexed
> > weight
> > > > by
> > > > the query time weight.
> > > >
> > >
> > > Ok, now I think I get it.  You do have some index-time floats, and
> > > query-time
> > > boosts.
> > >
> > > You should be able to do a normal BooleanQuery with three OR'ed
> together
> > > ValueSourceQueries boosted by input weights, it seems, as that is the
> way
> > > they work - they take the values in different fields and use them as
> the
> > > score,
> > > and the normal boosting technique will use query time weigting.
> > >
> > > To get good performance with a ValueSourceQuery, I'd suggest using a
> > > FieldCacheSource for speedier processing:
> > >
> > > -----------
> > >  String field = "model_1_score";
> > >  float runTimeBoost = 0.5;
> > >
> > >  ValueSource model1Source = new FloatFieldSource(field,
> > >    new FieldCache.FloatParser() {
> > >      public float parseFloat(String s) { return Float.parseFloat(s); }
> > >    });
> > >
> > >  Query model1Q = new ValueSourceQuery(model1Source);
> > >
> > >  model1Q.setBoost(runTimeBoost);
> > >
> > > // do this for model2 and model3 as well...
> > >
> > >  BooleanQuery bq = new BooleanQuery();
> > >  bq.add(model1Q, Occur.SHOULD);
> > >  bq.add(model2Q, Occur.SHOULD);
> > >  bq.add(model3Q, Occur.SHOULD);
> > > ---------------
> > >
> > >  I haven't tried this code, but it seems like this is what you are
> trying
> > > to do...
> > >
> > >  -jake
> > >
> >
>

--0016363b8e1c1241ab04759f84aa--

From java-user-return-42755-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 16:11:31 2009
Return-Path: <java-user-return-42755-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54786 invoked from network); 11 Oct 2009 16:11:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 16:11:31 -0000
Received: (qmail 42889 invoked by uid 500); 11 Oct 2009 16:11:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42815 invoked by uid 500); 11 Oct 2009 16:11:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42804 invoked by uid 99); 11 Oct 2009 16:11:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 16:11:29 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 16:11:19 +0000
Received: by yxe3 with SMTP id 3so2796668yxe.20
        for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 09:10:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=fS6zSqBUasPGoi+QRwQUHthEcOA+r4nvFfImlH1Utl8=;
        b=RSyrN5MbQtY5zT5PgEw30eyoZIOpIqa8V9VJX7keEEJK2Yx51Sh/a5ncoDRkfaQRN1
         5RtEsCyZJU1iRV3fEpYlszFMvSfYRxU+5o7Jb9hixb+dno+CeIPGY/y5OuHn10igN86V
         E3I8DcSL/+ZX+d5IDwQV4ogSnYR/xcEkcM1qA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=mw+hf5DcfXu74kTUVOe0s7BTAQ1M/9kyAAFmLzHCnpryYc4P+JWtkVaExRlAhraUUX
         E/OaBkc3PdwXBBiFy/30MZt2SuZoH4JPlqLRR4UR9v9JTRuvKhc4rVfTDKhjt0NJL65C
         vFxhkUu8CDuOusEaEHARQ1hV+dG5V3PthmQiw=
MIME-Version: 1.0
Received: by 10.91.189.3 with SMTP id r3mr2993224agp.48.1255277458192; Sun, 11 
	Oct 2009 09:10:58 -0700 (PDT)
In-Reply-To: <401b577e0910101924l54d65607te63ada74eb6c938a@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <401b577e0910091030u20d3a254ld4b18e8588320f86@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
	 <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
	 <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
	 <401b577e0910091552n1bec254ao8bfb31047e065a14@mail.gmail.com>
	 <4b124c310910091732y5a78f89cnb000e45e7614d21d@mail.gmail.com>
	 <401b577e0910101924l54d65607te63ada74eb6c938a@mail.gmail.com>
Date: Sun, 11 Oct 2009 09:10:58 -0700
Message-ID: <4b124c310910110910g68c7acf2n8e0c41f7719e4f5f@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e645b95efd7bd50475ab0efc
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e645b95efd7bd50475ab0efc
Content-Type: text/plain; charset=ISO-8859-1

What do you mean "not something I can plug in on top of my original query"?

Do you mean that you can't do it like the more complex example in the class
you posted earlier in the thread, where you take a linear combination of the
Map<String, Float> -based score, and the regular text score?

Another option is to just use the CustomScoreQuery like your other
attempt is:

--------
public class QueryTermBoostingQuery extends CustomScoreQuery {
  private float bias;

  public QueryTermBoostingQuery (Query q, ValueSourceQuery[] vQueries, float
bias)  {
    super(q, vQueries);
    this.bias = bias;
  }

  @Override
  public float customScore(int doc, float subQueryScore, float[]
valSrcScores)   {
    float termWeightedScore = 0;
    for(float valSrcScore : valSrcScores) termWeightedScore +=
valSrcScore;
    return bias * subQueryScore + (1 - bias) * termWeightedScore;
  }
}

And then to use it, you build up some FloatFieldSource instances like
before:

  FloatFieldSource m1 = // defined like I did in my previous message
  FloatFieldSource m2 = //...
  FloatFieldSource m3 = //...

  ValueSourceQuery vsq1 = new ValueSourceQuery(m1);
  vsq1.setBoost(model1Weight);

  // vsq2 and vsq3 also

  ValueSourceQuery[] vsq = { vsq1, vsq2, vsq3  };

  Query textQuery = QueryParser.parse("company:Microsoft");

  Query q = new QueryTermBoostingQuery(textQuery, vsq, bias);
-------

Does this work for you?

  -jake

On Sat, Oct 10, 2009 at 7:24 PM, scott w <scottblanc@gmail.com> wrote:

> Haven't tried it yet but looking at it closer it looks like it's not
> something I can plug in on top of my original query. I am definitely happy
> using an approximation for the sake of performance but I do need to be able
> to have the original results stay the same.
>
> On Fri, Oct 9, 2009 at 5:32 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
>
> > Great Scott (hah!) - please do report back, even if it just works fine
> and
> > you have no more questions, I'd like to know whether this really is
> > what you were after and actually works for you.
> >
>
> > Note that the FieldCache is kinda "magic" - it's lazy (so the first query
> > will
> > be slow and you should fire one off just to warm it up after every time
> > you reload an IndexReader), and kinda leaky: the entries in the
> FieldCache
> > stick around until all references to the IndexReader they're keyed on
> > get garbage collected (there's a WeakHashMap in the background), so
> > don't accidentally hang onto references to those IndexReaders past
> > when needed.
> >
>
> Good to know.
>
> >
> >  -jake
> >
> > On Fri, Oct 9, 2009 at 3:52 PM, scott w <scottblanc@gmail.com> wrote:
> >
> > > Thanks Jake! I will test this out and report back soon in case it's
> > helpful
> > > to others. Definitely appreciate the help.
> > >
> > > Scott
> > >
> > > On Fri, Oct 9, 2009 at 3:33 PM, Jake Mannix <jake.mannix@gmail.com>
> > wrote:
> > >
> > > > On Fri, Oct 9, 2009 at 3:07 PM, scott w <scottblanc@gmail.com>
> wrote:
> > > >
> > > > > Example Document:
> > > > > model_1_score = 0.9
> > > > > model_2_score = 0.3
> > > > > model_3_score = 0.7
> > > > >
> > > > > I want to be able to pass in the following map at query time:
> > > > > {model_1_score=0.4, model_2_score=0.7} and have that map get used
> as
> > > > input
> > > > > to a custom score function that would look like: 0.9*0.4 + 0.3*0.7,
> > so
> > > > that
> > > > > it is summing over the specified fields and multipling the indexed
> > > weight
> > > > > by
> > > > > the query time weight.
> > > > >
> > > >
> > > > Ok, now I think I get it.  You do have some index-time floats, and
> > > > query-time
> > > > boosts.
> > > >
> > > > You should be able to do a normal BooleanQuery with three OR'ed
> > together
> > > > ValueSourceQueries boosted by input weights, it seems, as that is the
> > way
> > > > they work - they take the values in different fields and use them as
> > the
> > > > score,
> > > > and the normal boosting technique will use query time weigting.
> > > >
> > > > To get good performance with a ValueSourceQuery, I'd suggest using a
> > > > FieldCacheSource for speedier processing:
> > > >
> > > > -----------
> > > >  String field = "model_1_score";
> > > >  float runTimeBoost = 0.5;
> > > >
> > > >  ValueSource model1Source = new FloatFieldSource(field,
> > > >    new FieldCache.FloatParser() {
> > > >      public float parseFloat(String s) { return Float.parseFloat(s);
> }
> > > >    });
> > > >
> > > >  Query model1Q = new ValueSourceQuery(model1Source);
> > > >
> > > >  model1Q.setBoost(runTimeBoost);
> > > >
> > > > // do this for model2 and model3 as well...
> > > >
> > > >  BooleanQuery bq = new BooleanQuery();
> > > >  bq.add(model1Q, Occur.SHOULD);
> > > >  bq.add(model2Q, Occur.SHOULD);
> > > >  bq.add(model3Q, Occur.SHOULD);
> > > > ---------------
> > > >
> > > >  I haven't tried this code, but it seems like this is what you are
> > trying
> > > > to do...
> > > >
> > > >  -jake
> > > >
> > >
> >
>

--0016e645b95efd7bd50475ab0efc--

From java-user-return-42756-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 18:02:05 2009
Return-Path: <java-user-return-42756-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77557 invoked from network); 11 Oct 2009 18:02:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 18:02:05 -0000
Received: (qmail 96365 invoked by uid 500); 11 Oct 2009 18:02:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96278 invoked by uid 500); 11 Oct 2009 18:02:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96268 invoked by uid 99); 11 Oct 2009 18:02:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:02:03 +0000
X-ASF-Spam-Status: No, hits=0.6 required=10.0
	tests=MISSING_HEADERS,RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:01:51 +0000
Received: from compute2.internal (compute2.internal [10.202.2.42])
	by gateway1.messagingengine.com (Postfix) with ESMTP id AA7EFA42D5;
	Sun, 11 Oct 2009 13:58:21 -0400 (EDT)
Received: from heartbeat2.messagingengine.com ([10.202.2.161])
  by compute2.internal (MEProxy); Sun, 11 Oct 2009 13:58:21 -0400
X-Sasl-enc: JF7MRUA2+0pfWq1m/yNNUOC6T3DrIKF3kFgJED613kb9 1255283901
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id E03E46691;
	Sun, 11 Oct 2009 13:58:20 -0400 (EDT)
Message-ID: <4AD21CBC.8070501@fastmail.fm>
Date: Sun, 11 Oct 2009 18:58:20 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
CC: Michael McCandless <lucene@mikemccandless.com>, 
 Lucene Users <java-user@lucene.apache.org>
Subject: Re: How do you properly use NumericField
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com>
In-Reply-To: <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Michael McCandless wrote:
> On the indexing side you do this:
>
>     doc.add(new NumericField("price").setDoubleValue(19.99));
>
> The NumericField is not stored by default (there's also a ctor to
> specify Store.YES or Store.NO).
>
> If the numeric field is not being used in a range query, how is it
> being used?  EG for sorting, it will just work.  If you did store the
> field, when you retrieve it, it will come back as a normal field with
> a String value (equal to the .toString of original numeric value).
>
> (You can play with precisionStep, to trade off disk space &
> performance; especially if you will do range querying and eg only
> sorting, you should set precisionStep=Integer.MAX_VALUE; but these are
> advanced optimizations).
>
> Mike
>   
Hmm, Im being dense here but even a simple non range search doesn't seem 
to work when using Numeric Fields, in the test below it matches 789 okay 
but not 123

Paul

package org.musicbrainz.search.analysis;

import junit.framework.TestCase;
import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.store.RAMDirectory;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.NumericField;
import org.apache.lucene.document.Field;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.Query;
import org.apache.lucene.queryParser.QueryParser;

public class NumericFieldTest extends TestCase {

    public void testNumericFields() throws Exception {
        Analyzer analyzer = new StandardAnalyzer();
        RAMDirectory dir = new RAMDirectory();
        IndexWriter writer = new IndexWriter(dir, analyzer, true, 
IndexWriter.MaxFieldLength.LIMITED);
        Document doc = new Document();
        NumericField nf  = new NumericField("dur");
        nf.setIntValue(123);
        doc.add(nf);
        doc.add(new Field("dur", "789", 
Field.Store.NO,Field.Index.ANALYZED ));
        writer.addDocument(doc);
        writer.close();

        IndexSearcher searcher = new IndexSearcher(dir,true);
        {
            Query q = new QueryParser("dur",analyzer).parse("789");
            assertEquals(1, searcher.search(q,10).totalHits);

            q = new QueryParser("dur",analyzer).parse("123");
            assertEquals(1, searcher.search(q,10).totalHits);


        }
    }


}


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42757-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 18:08:48 2009
Return-Path: <java-user-return-42757-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78846 invoked from network); 11 Oct 2009 18:08:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 18:08:48 -0000
Received: (qmail 3075 invoked by uid 500); 11 Oct 2009 18:08:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2996 invoked by uid 500); 11 Oct 2009 18:08:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2986 invoked by uid 99); 11 Oct 2009 18:08:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:08:45 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:08:34 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id EF8BBD36002;
	Sun, 11 Oct 2009 20:07:43 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id kphWpm3mQPAb; Sun, 11 Oct 2009 20:07:33 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 8C060D36001;
	Sun, 11 Oct 2009 20:07:33 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>,
	<paul_t100@fastmail.fm>
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm>
Subject: RE: How do you properly use NumericField
Date: Sun, 11 Oct 2009 20:07:43 +0200
Message-ID: <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4AD21CBC.8070501@fastmail.fm>
Thread-Index: AcpKnPsBGkzJfSVsQ0KOA2FKK9bcDQAAE5TQ
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

As we told you before. The default QueryParser has no support fro
NumericField (as it doesn't know the schema). To get it running, subclass it
and overwrite newRangeQuery method to create a NumericRangeQuery for field
names that are indexed using NumericField.

The recommended way is to instantiate the NumericQueries directly and not
via a query parser. You can combina a text query with query parser then
together with various numeric ranges using a BooleanQuery on top of it. If
you really need a query string range representation for numeric values,
there is no way around extending QueryParser.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Paul Taylor [mailto:paul_t100@fastmail.fm]
> Sent: Sunday, October 11, 2009 7:58 PM
> Cc: Michael McCandless; Lucene Users
> Subject: Re: How do you properly use NumericField
> 
> Michael McCandless wrote:
> > On the indexing side you do this:
> >
> >     doc.add(new NumericField("price").setDoubleValue(19.99));
> >
> > The NumericField is not stored by default (there's also a ctor to
> > specify Store.YES or Store.NO).
> >
> > If the numeric field is not being used in a range query, how is it
> > being used?  EG for sorting, it will just work.  If you did store the
> > field, when you retrieve it, it will come back as a normal field with
> > a String value (equal to the .toString of original numeric value).
> >
> > (You can play with precisionStep, to trade off disk space &
> > performance; especially if you will do range querying and eg only
> > sorting, you should set precisionStep=Integer.MAX_VALUE; but these are
> > advanced optimizations).
> >
> > Mike
> >
> Hmm, Im being dense here but even a simple non range search doesn't seem
> to work when using Numeric Fields, in the test below it matches 789 okay
> but not 123
> 
> Paul
> 
> package org.musicbrainz.search.analysis;
> 
> import junit.framework.TestCase;
> import org.apache.lucene.analysis.Analyzer;
> import org.apache.lucene.analysis.standard.StandardAnalyzer;
> import org.apache.lucene.store.RAMDirectory;
> import org.apache.lucene.index.IndexWriter;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.document.NumericField;
> import org.apache.lucene.document.Field;
> import org.apache.lucene.search.IndexSearcher;
> import org.apache.lucene.search.Query;
> import org.apache.lucene.queryParser.QueryParser;
> 
> public class NumericFieldTest extends TestCase {
> 
>     public void testNumericFields() throws Exception {
>         Analyzer analyzer = new StandardAnalyzer();
>         RAMDirectory dir = new RAMDirectory();
>         IndexWriter writer = new IndexWriter(dir, analyzer, true,
> IndexWriter.MaxFieldLength.LIMITED);
>         Document doc = new Document();
>         NumericField nf  = new NumericField("dur");
>         nf.setIntValue(123);
>         doc.add(nf);
>         doc.add(new Field("dur", "789",
> Field.Store.NO,Field.Index.ANALYZED ));
>         writer.addDocument(doc);
>         writer.close();
> 
>         IndexSearcher searcher = new IndexSearcher(dir,true);
>         {
>             Query q = new QueryParser("dur",analyzer).parse("789");
>             assertEquals(1, searcher.search(q,10).totalHits);
> 
>             q = new QueryParser("dur",analyzer).parse("123");
>             assertEquals(1, searcher.search(q,10).totalHits);
> 
> 
>         }
>     }
> 
> 
> }
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42758-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 18:14:11 2009
Return-Path: <java-user-return-42758-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81841 invoked from network); 11 Oct 2009 18:14:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 18:14:11 -0000
Received: (qmail 9956 invoked by uid 500); 11 Oct 2009 18:14:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9893 invoked by uid 500); 11 Oct 2009 18:14:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9883 invoked by uid 99); 11 Oct 2009 18:14:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:14:09 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:13:57 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9A038D36002
	for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 20:13:07 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id hDQ7q-k3JbK4 for <java-user@lucene.apache.org>;
	Sun, 11 Oct 2009 20:12:56 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 33074D36001
	for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 20:12:56 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA>
Subject: RE: How do you properly use NumericField
Date: Sun, 11 Oct 2009 20:13:06 +0200
Message-ID: <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA>
Thread-Index: AcpKnPsBGkzJfSVsQ0KOA2FKK9bcDQAAE5TQAAAxVSA=
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

I forgot: The format of numeric fields is also not plain text, because of
this a simple TermQuery as generated by your query parser will not work,
too.

If you want to hit numeric values without a NumericRangeQuery with lower and
upper bound equal, you have to use NumericUtils to translate the term text,
e.g. new TermQuery(new Term("field",
NumericUtils.intToPrefixCoded(value,precstep)))

If you want support for this in QueryParser, you have to override
QueryParser.newTermQuery as explained before for newRangeQuery. By the way,
Solr does this in exactly that way.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Sunday, October 11, 2009 8:08 PM
> To: java-user@lucene.apache.org; paul_t100@fastmail.fm
> Subject: RE: How do you properly use NumericField
> 
> As we told you before. The default QueryParser has no support fro
> NumericField (as it doesn't know the schema). To get it running, subclass
> it
> and overwrite newRangeQuery method to create a NumericRangeQuery for field
> names that are indexed using NumericField.
> 
> The recommended way is to instantiate the NumericQueries directly and not
> via a query parser. You can combina a text query with query parser then
> together with various numeric ranges using a BooleanQuery on top of it. If
> you really need a query string range representation for numeric values,
> there is no way around extending QueryParser.
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
> > -----Original Message-----
> > From: Paul Taylor [mailto:paul_t100@fastmail.fm]
> > Sent: Sunday, October 11, 2009 7:58 PM
> > Cc: Michael McCandless; Lucene Users
> > Subject: Re: How do you properly use NumericField
> >
> > Michael McCandless wrote:
> > > On the indexing side you do this:
> > >
> > >     doc.add(new NumericField("price").setDoubleValue(19.99));
> > >
> > > The NumericField is not stored by default (there's also a ctor to
> > > specify Store.YES or Store.NO).
> > >
> > > If the numeric field is not being used in a range query, how is it
> > > being used?  EG for sorting, it will just work.  If you did store the
> > > field, when you retrieve it, it will come back as a normal field with
> > > a String value (equal to the .toString of original numeric value).
> > >
> > > (You can play with precisionStep, to trade off disk space &
> > > performance; especially if you will do range querying and eg only
> > > sorting, you should set precisionStep=Integer.MAX_VALUE; but these are
> > > advanced optimizations).
> > >
> > > Mike
> > >
> > Hmm, Im being dense here but even a simple non range search doesn't seem
> > to work when using Numeric Fields, in the test below it matches 789 okay
> > but not 123
> >
> > Paul
> >
> > package org.musicbrainz.search.analysis;
> >
> > import junit.framework.TestCase;
> > import org.apache.lucene.analysis.Analyzer;
> > import org.apache.lucene.analysis.standard.StandardAnalyzer;
> > import org.apache.lucene.store.RAMDirectory;
> > import org.apache.lucene.index.IndexWriter;
> > import org.apache.lucene.document.Document;
> > import org.apache.lucene.document.NumericField;
> > import org.apache.lucene.document.Field;
> > import org.apache.lucene.search.IndexSearcher;
> > import org.apache.lucene.search.Query;
> > import org.apache.lucene.queryParser.QueryParser;
> >
> > public class NumericFieldTest extends TestCase {
> >
> >     public void testNumericFields() throws Exception {
> >         Analyzer analyzer = new StandardAnalyzer();
> >         RAMDirectory dir = new RAMDirectory();
> >         IndexWriter writer = new IndexWriter(dir, analyzer, true,
> > IndexWriter.MaxFieldLength.LIMITED);
> >         Document doc = new Document();
> >         NumericField nf  = new NumericField("dur");
> >         nf.setIntValue(123);
> >         doc.add(nf);
> >         doc.add(new Field("dur", "789",
> > Field.Store.NO,Field.Index.ANALYZED ));
> >         writer.addDocument(doc);
> >         writer.close();
> >
> >         IndexSearcher searcher = new IndexSearcher(dir,true);
> >         {
> >             Query q = new QueryParser("dur",analyzer).parse("789");
> >             assertEquals(1, searcher.search(q,10).totalHits);
> >
> >             q = new QueryParser("dur",analyzer).parse("123");
> >             assertEquals(1, searcher.search(q,10).totalHits);
> >
> >
> >         }
> >     }
> >
> >
> > }
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42759-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 18:27:48 2009
Return-Path: <java-user-return-42759-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 84644 invoked from network); 11 Oct 2009 18:27:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 18:27:48 -0000
Received: (qmail 24272 invoked by uid 500); 11 Oct 2009 18:27:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 24207 invoked by uid 500); 11 Oct 2009 18:27:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 24197 invoked by uid 99); 11 Oct 2009 18:27:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:27:45 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 18:27:34 +0000
Received: from compute1.internal (compute1.internal [10.202.2.41])
	by gateway1.messagingengine.com (Postfix) with ESMTP id 03692A42AE;
	Sun, 11 Oct 2009 14:24:04 -0400 (EDT)
Received: from heartbeat2.messagingengine.com ([10.202.2.161])
  by compute1.internal (MEProxy); Sun, 11 Oct 2009 14:24:05 -0400
DKIM-Signature: v=1; a=rsa-sha1; c=relaxed/relaxed; d=messagingengine.com; h=message-id:date:from:reply-to:mime-version:to:cc:subject:references:in-reply-to:content-type:content-transfer-encoding; s=smtpout; bh=QXPUI8bfMP8GjHIfI/k47YopYQo=; b=C3igelTRk0+XyRrblW4k0EANXOOaaRCiYy9fCmpIZR1iv8vKCAgFzajfjRIuMD8U1SV9X0gnNFSB9OmQSd/ycZYDxa0e/G5nmD98rmyWhDCuQmF/RCP0RLSFwwXFVmF4snF6ck7lgJpa4AIiZcAiozbSWqpajNYTOrilwkSaZvI=
X-Sasl-enc: 23pB9S98iM6qz0P99lyKmx/Mws495XbCyuXZH/Jh8k5O 1255285444
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id D4B8420E17;
	Sun, 11 Oct 2009 14:24:03 -0400 (EDT)
Message-ID: <4AD222C2.8030507@fastmail.fm>
Date: Sun, 11 Oct 2009 19:24:02 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: Uwe Schindler <uwe@thetaphi.de>, 
 Lucene Users <java-user@lucene.apache.org>
CC: Michael McCandless <lucene@mikemccandless.com>
Subject: Re: How do you properly use NumericField
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA>
In-Reply-To: <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Uwe Schindler wrote:
> As we told you before. The default QueryParser has no support fro
> NumericField (as it doesn't know the schema). To get it running, subclass it
> and overwrite newRangeQuery method to create a NumericRangeQuery for field
> names that are indexed using NumericField.
>   
Hi, yes I did this but it never called the getRangeQuery and from 
talking to MM it seemed it would only be used for duration queries, 
heres a full test which still fails

package org.musicbrainz.search.servlet;

import junit.framework.TestCase;
import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.store.RAMDirectory;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.NumericField;
import org.apache.lucene.document.Field;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.Query;
import org.apache.lucene.search.TermRangeQuery;
import org.apache.lucene.search.NumericRangeQuery;
import org.apache.lucene.queryParser.QueryParser;
import org.apache.lucene.queryParser.ParseException;

public class NumericFieldTest extends TestCase {

    public void testNumericFields() throws Exception {
        Analyzer analyzer = new StandardAnalyzer();
        RAMDirectory dir = new RAMDirectory();
        IndexWriter writer = new IndexWriter(dir, analyzer, true, 
IndexWriter.MaxFieldLength.LIMITED);
        Document doc = new Document();
        NumericField nf  = new NumericField("dur");
        nf.setIntValue(123);
        doc.add(nf);
        doc.add(new Field("dur", "789", 
Field.Store.NO,Field.Index.ANALYZED ));
        writer.addDocument(doc);
        writer.close();

        IndexSearcher searcher = new IndexSearcher(dir,true);
        {
            Query q = new 
MusicbrainzQueryParser("dur",analyzer).parse("789");
            assertEquals(1, searcher.search(q,10).totalHits);

            q = new MuiscbrainzQueryParser("dur",analyzer).parse("123");
            assertEquals(1, searcher.search(q,10).totalHits);


        }
    }

    static class MusicbrainzQueryParser extends QueryParser {

        public MusicbrainzQueryParser(String field, Analyzer a) {
            super(field, a);
            System.out.println("init parser");
        }

        public Query getRangeQuery(String field,
                                   String part1,
                                   String part2,
                                   boolean inclusive)
                throws ParseException {
            System.out.println("RangeQuery");
            TermRangeQuery query = (TermRangeQuery)
                    super.getRangeQuery(field, part1, part2,
                            inclusive);

            if ("dur".equals(field)) {
                System.out.println("dur");

                return NumericRangeQuery.newIntRange(
                        "dur",
                        Integer.parseInt(query.getLowerTerm()),
                        Integer.parseInt(query.getUpperTerm()),
                        query.includesLower(),
                        query.includesUpper());
            } else {
                return query;
         
        }
    }



> The recommended way is to instantiate the NumericQueries directly and not
> via a query parser. You can combina a text query with query parser then
> together with various numeric ranges using a BooleanQuery on top of it. If
> you really need a query string range representation for numeric values,
> there is no way around extending QueryParser.
>   
The UI allows the user to enter a lucene query using any valid syntax as 
required so will always need QueryParser which I have extended as you 
can see from above


thanks Paul

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42760-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 20:53:00 2009
Return-Path: <java-user-return-42760-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26662 invoked from network); 11 Oct 2009 20:53:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 20:53:00 -0000
Received: (qmail 90297 invoked by uid 500); 11 Oct 2009 20:52:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90225 invoked by uid 500); 11 Oct 2009 20:52:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90215 invoked by uid 99); 11 Oct 2009 20:52:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 20:52:57 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 20:52:48 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 11 Oct 2009 13:51:20 -0700
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
Subject: RE: Realtime & distributed
Date: Sun, 11 Oct 2009 13:51:26 -0700
Message-ID: <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Realtime & distributed
Thread-Index: AcpJ3mk/bV2kFx1OReG0afVkc6abqwA0uZyV
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com> <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com> <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com> <85d3c3b60910101216h1676117fi2ff4652dbd3eb95e@mail.gmail.com>
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>,
	<java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

Man, this thread really went south.  Anyhow, I have a few questions =
about Zoie:

* How many nodes are you using to support the speeds you desire at LI?
* Am I wrong to assume that the RAMDir holds the entire index - just as =
the FSDir?  Or does RAMDir only hold a portion of the index that hasn't =
yet been flushed to disk?
* Katta is supposed to be able to be able to run on commodity hardware - =
is that the same case for Zoie?
* Would you agree that it's a good idea to build an "offline" index =
parallel to the online index in case there is a crash on the online =
index and data is lost?
* I see that there are plans to have Zoie use Lucene 2.9.  How long =
would you say before it's available?

Thanks,

E

-----Original Message-----
From: Jason Rutherglen [mailto:jason.rutherglen@gmail.com]
Sent: Sat 10/10/2009 12:16 PM
To: java-user@lucene.apache.org
Subject: Re: Realtime & distributed
=20
John,

Actually everyone is entitled to their technical opinion and
none of the comments were misleading. Jake and yourself
validated that they are true in your comments. I'm simply trying
to create better technology as is everyone on here. The process
takes time and coordination between many parties of many
backgrounds around the globe. Sometimes there are differences of
opinion, however those are easily ironed out over time (and quite
frankly in this case benchmarks).

However I am very concerned about your ignorant disregard of some of the
most basic human rights in existence.

-J

On Thu, Oct 8, 2009 at 10:26 PM, John Wang <john.wang@gmail.com> wrote:
> Jason:
> =A0 =A0 =A0 =A0I would really appreciate it if you would stop making =
false
> statements and misinformation. Everyone is entitled to his/her =
opinions on
> technologies, but deliberately making misleading and false information =
on
> such a distribution is just unethical, and you'll end up just =
discrediting
> yourself.
>
> =A0 =A0 =A0 =A0Making unsubstantiated comments while not willing to =
put in any
> effort is the primary reason you are no longer working at Linkedin and =
on
> Zoie.
>
> "The problem
> with this is, merging in the background becomes really tricky
> unless it's performed inside of IndexWriter" - *what does this really =
mean?
> Merging happens regardless in an incremental indexing system. =
Especially
> with high indexing load, segments are created often, merging is =
crucial.*
> "There is the Zoie system which uses the RAMDir
> solution, however it's implemented using a customized deleted
> doc set based on a bloomfilter backed by an inefficient RB tree
> which slows down queries" =A0-* if you ever spend the time to read the =
code,
> (even when you were working on it), it is just not true. We did have =
an RB
> set for deleted docs, quite a few releases ago, and we changed to a =
special
> type of bloomfilter set backed by a hash int set. You knew this and =
was part
> of the discussion on it, and now saying such a thing is just plain
> disappointing.*
>
> =A0 =A0 =A0 =A0Thanks Jake for the clarification, and Eric, let me =
know if you to
> know more in detail with how we are dealing with realtime =
indexing/search
> with Zoie here at linkedin in a production environment powering a real
> internet company with real traffic.
>
> -John
>
> On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen =
<jason.rutherglen@gmail.com
>> wrote:
>
>> Eric,
>>
>> Katta doesn't require HDFS which would be slow to search on,
>> though Katta can be used to copy indexes out of HDFS onto local
>> servers. The best bet is hardware that uses SSDs because merges
>> and update latency will greatly decrease and there won't be a
>> synchronous IO issue as there is with hard drives. Also, IO
>> caches get flushed as large merges occur, which means subsequent
>> queries may hit the HD and slow down. With SSDs this is much
>> less of an issue.
>>
>> Today near realtime search (with or without SSDs) comes at a
>> price, that is reduced indexing speed due to continued in RAM
>> merging. People typically hack something together where indexes
>> are held in a RAMDir until being flushed to disk. The problem
>> with this is, merging in the background becomes really tricky
>> unless it's performed inside of IndexWriter (see LUCENE-1313 and
>> IW.getReader). There is the Zoie system which uses the RAMDir
>> solution, however it's implemented using a customized deleted
>> doc set based on a bloomfilter backed by an inefficient RB tree
>> which slows down queries. There's always a trade off when trying
>> to build an NRT system, currently.
>>
>> Also, there isn't a clear way to replicate segments in realtime
>> so people usually end up analyzing documents on each replicated
>> node, which is redundant. A long term solution here could be a
>> distributed transaction log where encoded segments are stored
>> and replicated to N nodes.
>>
>> Deletes can pile up in segments so the
>> BalancedSegmentMergePolicy could be used to remove those faster
>> than LogMergePolicy, however I haven't tested it, and it may be
>> trying to not do large segment merges altogether which IMO
>> is less than ideal because query performance soon degrades
>> (similar to an unoptimized index).
>>
>> Hopefully in the future we can offer searching over
>> IndexWriter's RAM buffer where indexing and search speed would
>> be roughly what it is today. That combined with a way to insure
>> segments don't get flushed out of the IO cache during large
>> segment merges would mean really efficient NRT, even on systems
>> with HDs. In the interim, you'd need to play around and see what
>> works for your requirements.
>>
>> -J
>>
>> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com> =
wrote:
>> >
>> > Does anyone have any recommendations? =A0I've looked at Katta, but =
it
>> doesn't
>> > seem to support realtime searching. =A0It also uses hdfs, which =
I've heard
>> can
>> > be slow. =A0I'm looking to serve 40gb of indexes and support about =
1
>> million
>> > updates per day.
>> >
>> > Thx
>> >
>> > =
---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42761-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 21:31:53 2009
Return-Path: <java-user-return-42761-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41141 invoked from network); 11 Oct 2009 21:31:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 21:31:53 -0000
Received: (qmail 22956 invoked by uid 500); 11 Oct 2009 21:31:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22876 invoked by uid 500); 11 Oct 2009 21:31:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22866 invoked by uid 99); 11 Oct 2009 21:31:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 21:31:51 +0000
X-ASF-Spam-Status: No, hits=0.0 required=5.0
	tests=HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of john.wang@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 21:31:48 +0000
Received: by ywh14 with SMTP id 14so61978ywh.20
        for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 14:31:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=cEoB+vgF25CEQ/DwT+9S0jOnn6NSNRR7tYgj0kX6Hlc=;
        b=Jbj7Q9NxUYIqTNFhmOP2IEvQ5K2JvRnewRYhd2J6VEwDlOcqbkHmFuO806LruSUiJD
         Rs4MqEA0ton0hfbEuK5FlWEGxBKW0UAPjkXDP/MhXcvCrsqAdFles+b587P6dY07XSfx
         wnSUT/IcwVd+mZcMpc0Le8dNWyteUZ19wb3qY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=u9+xxX1fWCsYZyf+NcA0qfiR49vRgXJ47yE9hAebp069CVwtdy/LymuNCPsd+ivE+N
         aDbsTa6wrOIQNNwsZPgd7AcotADneoIoGHD0Uq+lDL3COsNlagcjSg4bd2iBZV6+RnKN
         iZSCrz8/FDJxQqHMZDIIArn9qMR2Ct6jMM2fQ=
MIME-Version: 1.0
Received: by 10.101.88.12 with SMTP id q12mr4860893anl.117.1255296687177; Sun, 
	11 Oct 2009 14:31:27 -0700 (PDT)
In-Reply-To: <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
	 <85d3c3b60910101216h1676117fi2ff4652dbd3eb95e@mail.gmail.com>
	 <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
Date: Sun, 11 Oct 2009 14:31:27 -0700
Message-ID: <8837fb770910111431h51e08c0dt4cdcbe55e10148c6@mail.gmail.com>
Subject: Re: Realtime & distributed
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636ed66372080700475af89c7

--001636ed66372080700475af89c7
Content-Type: text/plain; charset=ISO-8859-1

Hi Eric:

I regret the direction the thread has taken and partly take responsibility
for it...

As to your question:

We have 2 nodes per commodity server, each holding 5 million docs (although
given the numbers we are seeing, we think we were a bit too conservative,
and may increase to 10). In terms of indexing, each partition is doing
indexing in realtime. We have total about 12 partitions, so 6 machines. With
about 4 - 5 replications.

RamDir only holds the transient index, once flushed to the disk index,
RamDir is emptied. So yes, it is the second part of your question. The trick
is the synchronization logic as well as handling of deletes and updates
between ram and disk index.

I am not sure I can disclose what HW we are using, but Zoie is designed to
run on commodity HW.

I think it is always a good idea to archive your data. Since with our setup,
we have replications that holds its own copy of the index, so there is
already redundancy. So having a set of offline nodes doing just indexing is
not necc.

Yes, we are working hard to make zoie 2.9 compatible. As Jake has previously
mentioned, Lucene 2.9 has changed alot internally

(I personally think these changes are awesome and really allows applications
the flexibility to unleash the powers of the lucene. Plus these changes are
very performance oriented for incremental indexing, which is important to
us. Much kudos to the lucene team and the contributors)

so to fully take advantage of this work while maintaining backward
compatibility is not a trivial project.

Expect to see another maintenance release of zoie before 2.9. We hope to
have 2.9 work done soon, but in terms of timing, lucene 3.0 (partiticularly
looking forward to custom indexing) is also coming out, we are deciding
whether to wait and include 3.0.

Hope this helps.

-John

On Sun, Oct 11, 2009 at 1:51 PM, Angel, Eric <eangel@business.com> wrote:

> Man, this thread really went south.  Anyhow, I have a few questions about
> Zoie:
>
> * How many nodes are you using to support the speeds you desire at LI?
> * Am I wrong to assume that the RAMDir holds the entire index - just as the
> FSDir?  Or does RAMDir only hold a portion of the index that hasn't yet been
> flushed to disk?
> * Katta is supposed to be able to be able to run on commodity hardware - is
> that the same case for Zoie?
> * Would you agree that it's a good idea to build an "offline" index
> parallel to the online index in case there is a crash on the online index
> and data is lost?
> * I see that there are plans to have Zoie use Lucene 2.9.  How long would
> you say before it's available?
>
> Thanks,
>
> E
>
> -----Original Message-----
> From: Jason Rutherglen [mailto:jason.rutherglen@gmail.com]
> Sent: Sat 10/10/2009 12:16 PM
> To: java-user@lucene.apache.org
> Subject: Re: Realtime & distributed
>
> John,
>
> Actually everyone is entitled to their technical opinion and
> none of the comments were misleading. Jake and yourself
> validated that they are true in your comments. I'm simply trying
> to create better technology as is everyone on here. The process
> takes time and coordination between many parties of many
> backgrounds around the globe. Sometimes there are differences of
> opinion, however those are easily ironed out over time (and quite
> frankly in this case benchmarks).
>
> However I am very concerned about your ignorant disregard of some of the
> most basic human rights in existence.
>
> -J
>
> On Thu, Oct 8, 2009 at 10:26 PM, John Wang <john.wang@gmail.com> wrote:
> > Jason:
> >        I would really appreciate it if you would stop making false
> > statements and misinformation. Everyone is entitled to his/her opinions
> on
> > technologies, but deliberately making misleading and false information on
> > such a distribution is just unethical, and you'll end up just
> discrediting
> > yourself.
> >
> >        Making unsubstantiated comments while not willing to put in any
> > effort is the primary reason you are no longer working at Linkedin and on
> > Zoie.
> >
> > "The problem
> > with this is, merging in the background becomes really tricky
> > unless it's performed inside of IndexWriter" - *what does this really
> mean?
> > Merging happens regardless in an incremental indexing system. Especially
> > with high indexing load, segments are created often, merging is crucial.*
> > "There is the Zoie system which uses the RAMDir
> > solution, however it's implemented using a customized deleted
> > doc set based on a bloomfilter backed by an inefficient RB tree
> > which slows down queries"  -* if you ever spend the time to read the
> code,
> > (even when you were working on it), it is just not true. We did have an
> RB
> > set for deleted docs, quite a few releases ago, and we changed to a
> special
> > type of bloomfilter set backed by a hash int set. You knew this and was
> part
> > of the discussion on it, and now saying such a thing is just plain
> > disappointing.*
> >
> >        Thanks Jake for the clarification, and Eric, let me know if you to
> > know more in detail with how we are dealing with realtime indexing/search
> > with Zoie here at linkedin in a production environment powering a real
> > internet company with real traffic.
> >
> > -John
> >
> > On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <
> jason.rutherglen@gmail.com
> >> wrote:
> >
> >> Eric,
> >>
> >> Katta doesn't require HDFS which would be slow to search on,
> >> though Katta can be used to copy indexes out of HDFS onto local
> >> servers. The best bet is hardware that uses SSDs because merges
> >> and update latency will greatly decrease and there won't be a
> >> synchronous IO issue as there is with hard drives. Also, IO
> >> caches get flushed as large merges occur, which means subsequent
> >> queries may hit the HD and slow down. With SSDs this is much
> >> less of an issue.
> >>
> >> Today near realtime search (with or without SSDs) comes at a
> >> price, that is reduced indexing speed due to continued in RAM
> >> merging. People typically hack something together where indexes
> >> are held in a RAMDir until being flushed to disk. The problem
> >> with this is, merging in the background becomes really tricky
> >> unless it's performed inside of IndexWriter (see LUCENE-1313 and
> >> IW.getReader). There is the Zoie system which uses the RAMDir
> >> solution, however it's implemented using a customized deleted
> >> doc set based on a bloomfilter backed by an inefficient RB tree
> >> which slows down queries. There's always a trade off when trying
> >> to build an NRT system, currently.
> >>
> >> Also, there isn't a clear way to replicate segments in realtime
> >> so people usually end up analyzing documents on each replicated
> >> node, which is redundant. A long term solution here could be a
> >> distributed transaction log where encoded segments are stored
> >> and replicated to N nodes.
> >>
> >> Deletes can pile up in segments so the
> >> BalancedSegmentMergePolicy could be used to remove those faster
> >> than LogMergePolicy, however I haven't tested it, and it may be
> >> trying to not do large segment merges altogether which IMO
> >> is less than ideal because query performance soon degrades
> >> (similar to an unoptimized index).
> >>
> >> Hopefully in the future we can offer searching over
> >> IndexWriter's RAM buffer where indexing and search speed would
> >> be roughly what it is today. That combined with a way to insure
> >> segments don't get flushed out of the IO cache during large
> >> segment merges would mean really efficient NRT, even on systems
> >> with HDs. In the interim, you'd need to play around and see what
> >> works for your requirements.
> >>
> >> -J
> >>
> >> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com>
> wrote:
> >> >
> >> > Does anyone have any recommendations?  I've looked at Katta, but it
> >> doesn't
> >> > seem to support realtime searching.  It also uses hdfs, which I've
> heard
> >> can
> >> > be slow.  I'm looking to serve 40gb of indexes and support about 1
> >> million
> >> > updates per day.
> >> >
> >> > Thx
> >> >
> >> > ---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636ed66372080700475af89c7--

From java-user-return-42762-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 21:33:14 2009
Return-Path: <java-user-return-42762-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41350 invoked from network); 11 Oct 2009 21:33:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 21:33:13 -0000
Received: (qmail 25917 invoked by uid 500); 11 Oct 2009 21:33:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25866 invoked by uid 500); 11 Oct 2009 21:33:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25819 invoked by uid 99); 11 Oct 2009 21:33:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 21:33:10 +0000
X-ASF-Spam-Status: No, hits=0.0 required=5.0
	tests=HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of john.wang@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 21:33:08 +0000
Received: by yxe3 with SMTP id 3so2921803yxe.20
        for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 14:32:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=VHdsuWV/4uuzrD/EQUQ9SQmlf93UkqcnF3bjYe4qBL0=;
        b=K5W+xNR4aBin6lNTyLLMErggTaQvrOEFzyTIkSy0Mc+fnuBpuVmyfCP3v3sSyT2Lid
         5MLJN1DmM9Uc8Eq3W77Coed7cqJU2USwHNbrbm2DIKkgBx6ltAxh/t9ua5dslt6FX+tr
         lZggJdkP5N+Z0TDGMpexEnsJQ60gjkSA+Akq4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=oLDfT7MkQtxoNmKEg27SNm2s4SwO8+wb6GRqnOlax6Tvu9aV6SfivWIQIhJIApTdE2
         vKJeZ3zPKeGGBwUjceO6w8dyQbOXTUWp2xQ69+DIKZThs/xOcNUa/V9dPmfVYqXajJX8
         vMUR/xTT8wKFnDGr2/mtC+6pAWugUvgqVQWho=
MIME-Version: 1.0
Received: by 10.101.5.22 with SMTP id h22mr4826830ani.186.1255296766971; Sun, 
	11 Oct 2009 14:32:46 -0700 (PDT)
In-Reply-To: <8837fb770910111431h51e08c0dt4cdcbe55e10148c6@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
	 <85d3c3b60910101216h1676117fi2ff4652dbd3eb95e@mail.gmail.com>
	 <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
	 <8837fb770910111431h51e08c0dt4cdcbe55e10148c6@mail.gmail.com>
Date: Sun, 11 Oct 2009 14:32:46 -0700
Message-ID: <8837fb770910111432r54645a2fg60a6dc58d625921@mail.gmail.com>
Subject: Re: Realtime & distributed
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502d824e210620475af8d53

--00504502d824e210620475af8d53
Content-Type: text/plain; charset=ISO-8859-1

Eric:

   For more specific Zoie questions, let's move it to the zoie discussion
group instead.

Thanks

-John

On Sun, Oct 11, 2009 at 2:31 PM, John Wang <john.wang@gmail.com> wrote:

> Hi Eric:
>
> I regret the direction the thread has taken and partly take responsibility
> for it...
>
> As to your question:
>
> We have 2 nodes per commodity server, each holding 5 million docs (although
> given the numbers we are seeing, we think we were a bit too conservative,
> and may increase to 10). In terms of indexing, each partition is doing
> indexing in realtime. We have total about 12 partitions, so 6 machines. With
> about 4 - 5 replications.
>
> RamDir only holds the transient index, once flushed to the disk index,
> RamDir is emptied. So yes, it is the second part of your question. The trick
> is the synchronization logic as well as handling of deletes and updates
> between ram and disk index.
>
> I am not sure I can disclose what HW we are using, but Zoie is designed to
> run on commodity HW.
>
> I think it is always a good idea to archive your data. Since with our
> setup, we have replications that holds its own copy of the index, so there
> is already redundancy. So having a set of offline nodes doing just indexing
> is not necc.
>
> Yes, we are working hard to make zoie 2.9 compatible. As Jake has
> previously mentioned, Lucene 2.9 has changed alot internally
>
> (I personally think these changes are awesome and really allows
> applications the flexibility to unleash the powers of the lucene. Plus these
> changes are very performance oriented for incremental indexing, which is
> important to us. Much kudos to the lucene team and the contributors)
>
> so to fully take advantage of this work while maintaining backward
> compatibility is not a trivial project.
>
> Expect to see another maintenance release of zoie before 2.9. We hope to
> have 2.9 work done soon, but in terms of timing, lucene 3.0 (partiticularly
> looking forward to custom indexing) is also coming out, we are deciding
> whether to wait and include 3.0.
>
> Hope this helps.
>
> -John
>
>
> On Sun, Oct 11, 2009 at 1:51 PM, Angel, Eric <eangel@business.com> wrote:
>
>> Man, this thread really went south.  Anyhow, I have a few questions about
>> Zoie:
>>
>> * How many nodes are you using to support the speeds you desire at LI?
>> * Am I wrong to assume that the RAMDir holds the entire index - just as
>> the FSDir?  Or does RAMDir only hold a portion of the index that hasn't yet
>> been flushed to disk?
>> * Katta is supposed to be able to be able to run on commodity hardware -
>> is that the same case for Zoie?
>> * Would you agree that it's a good idea to build an "offline" index
>> parallel to the online index in case there is a crash on the online index
>> and data is lost?
>> * I see that there are plans to have Zoie use Lucene 2.9.  How long would
>> you say before it's available?
>>
>> Thanks,
>>
>> E
>>
>> -----Original Message-----
>> From: Jason Rutherglen [mailto:jason.rutherglen@gmail.com]
>> Sent: Sat 10/10/2009 12:16 PM
>> To: java-user@lucene.apache.org
>> Subject: Re: Realtime & distributed
>>
>> John,
>>
>> Actually everyone is entitled to their technical opinion and
>> none of the comments were misleading. Jake and yourself
>> validated that they are true in your comments. I'm simply trying
>> to create better technology as is everyone on here. The process
>> takes time and coordination between many parties of many
>> backgrounds around the globe. Sometimes there are differences of
>> opinion, however those are easily ironed out over time (and quite
>> frankly in this case benchmarks).
>>
>> However I am very concerned about your ignorant disregard of some of the
>> most basic human rights in existence.
>>
>> -J
>>
>> On Thu, Oct 8, 2009 at 10:26 PM, John Wang <john.wang@gmail.com> wrote:
>> > Jason:
>> >        I would really appreciate it if you would stop making false
>> > statements and misinformation. Everyone is entitled to his/her opinions
>> on
>> > technologies, but deliberately making misleading and false information
>> on
>> > such a distribution is just unethical, and you'll end up just
>> discrediting
>> > yourself.
>> >
>> >        Making unsubstantiated comments while not willing to put in any
>> > effort is the primary reason you are no longer working at Linkedin and
>> on
>> > Zoie.
>> >
>> > "The problem
>> > with this is, merging in the background becomes really tricky
>> > unless it's performed inside of IndexWriter" - *what does this really
>> mean?
>> > Merging happens regardless in an incremental indexing system. Especially
>> > with high indexing load, segments are created often, merging is
>> crucial.*
>> > "There is the Zoie system which uses the RAMDir
>> > solution, however it's implemented using a customized deleted
>> > doc set based on a bloomfilter backed by an inefficient RB tree
>> > which slows down queries"  -* if you ever spend the time to read the
>> code,
>> > (even when you were working on it), it is just not true. We did have an
>> RB
>> > set for deleted docs, quite a few releases ago, and we changed to a
>> special
>> > type of bloomfilter set backed by a hash int set. You knew this and was
>> part
>> > of the discussion on it, and now saying such a thing is just plain
>> > disappointing.*
>> >
>> >        Thanks Jake for the clarification, and Eric, let me know if you
>> to
>> > know more in detail with how we are dealing with realtime
>> indexing/search
>> > with Zoie here at linkedin in a production environment powering a real
>> > internet company with real traffic.
>> >
>> > -John
>> >
>> > On Thu, Oct 8, 2009 at 7:56 PM, Jason Rutherglen <
>> jason.rutherglen@gmail.com
>> >> wrote:
>> >
>> >> Eric,
>> >>
>> >> Katta doesn't require HDFS which would be slow to search on,
>> >> though Katta can be used to copy indexes out of HDFS onto local
>> >> servers. The best bet is hardware that uses SSDs because merges
>> >> and update latency will greatly decrease and there won't be a
>> >> synchronous IO issue as there is with hard drives. Also, IO
>> >> caches get flushed as large merges occur, which means subsequent
>> >> queries may hit the HD and slow down. With SSDs this is much
>> >> less of an issue.
>> >>
>> >> Today near realtime search (with or without SSDs) comes at a
>> >> price, that is reduced indexing speed due to continued in RAM
>> >> merging. People typically hack something together where indexes
>> >> are held in a RAMDir until being flushed to disk. The problem
>> >> with this is, merging in the background becomes really tricky
>> >> unless it's performed inside of IndexWriter (see LUCENE-1313 and
>> >> IW.getReader). There is the Zoie system which uses the RAMDir
>> >> solution, however it's implemented using a customized deleted
>> >> doc set based on a bloomfilter backed by an inefficient RB tree
>> >> which slows down queries. There's always a trade off when trying
>> >> to build an NRT system, currently.
>> >>
>> >> Also, there isn't a clear way to replicate segments in realtime
>> >> so people usually end up analyzing documents on each replicated
>> >> node, which is redundant. A long term solution here could be a
>> >> distributed transaction log where encoded segments are stored
>> >> and replicated to N nodes.
>> >>
>> >> Deletes can pile up in segments so the
>> >> BalancedSegmentMergePolicy could be used to remove those faster
>> >> than LogMergePolicy, however I haven't tested it, and it may be
>> >> trying to not do large segment merges altogether which IMO
>> >> is less than ideal because query performance soon degrades
>> >> (similar to an unoptimized index).
>> >>
>> >> Hopefully in the future we can offer searching over
>> >> IndexWriter's RAM buffer where indexing and search speed would
>> >> be roughly what it is today. That combined with a way to insure
>> >> segments don't get flushed out of the IO cache during large
>> >> segment merges would mean really efficient NRT, even on systems
>> >> with HDs. In the interim, you'd need to play around and see what
>> >> works for your requirements.
>> >>
>> >> -J
>> >>
>> >> On Thu, Oct 8, 2009 at 7:00 PM, Angel, Eric <eangel@business.com>
>> wrote:
>> >> >
>> >> > Does anyone have any recommendations?  I've looked at Katta, but it
>> >> doesn't
>> >> > seem to support realtime searching.  It also uses hdfs, which I've
>> heard
>> >> can
>> >> > be slow.  I'm looking to serve 40gb of indexes and support about 1
>> >> million
>> >> > updates per day.
>> >> >
>> >> > Thx
>> >> >
>> >> > ---------------------------------------------------------------------
>> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--00504502d824e210620475af8d53--

From java-user-return-42763-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 22:36:38 2009
Return-Path: <java-user-return-42763-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54783 invoked from network); 11 Oct 2009 22:36:37 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 22:36:37 -0000
Received: (qmail 63459 invoked by uid 500); 11 Oct 2009 22:36:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63387 invoked by uid 500); 11 Oct 2009 22:36:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63377 invoked by uid 99); 11 Oct 2009 22:36:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 22:36:35 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 22:36:26 +0000
Received: by gxk26 with SMTP id 26so2296051gxk.11
        for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 15:36:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=AuCu4bLfxB8XmlKVYpTcLUb3z3iwFdKsvlZIyyGPQdY=;
        b=lM7a7MvE2+EJgDYPa37Bka3q5232wOMzjFlZTZKShb+7QjYIx+XsdzuXG1b9NT1Uha
         I+f9K/wALyZISv+9sP15/HRjtuf2vHaZKaNLUrJAtt+slDKQfOW0DZl9tRgCKuUIV4Mq
         Q4hadmTJiM8G6tiYDtD8gAhafaQgW6x7xm9tI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=a0AXB3YsR/wHJXX9YZU39anqwbX3FIHv468Gfz4J8oQzbAbY/japNXh4jgtFa8YFhX
         I0jgJbKEiL4hXGSJKl6LvBoSVSe6aBnDwQk6SfjHolE4l2sG94ReBmuOCoWfNcLRXAou
         kL4gWYgFiqkEBuaaQaOK58GnwaQ+YlSluZ6e8=
MIME-Version: 1.0
Received: by 10.90.211.6 with SMTP id j6mr3172977agg.86.1255300565113; Sun, 11 
	Oct 2009 15:36:05 -0700 (PDT)
In-Reply-To: <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
	 <85d3c3b60910101216h1676117fi2ff4652dbd3eb95e@mail.gmail.com>
	 <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
Date: Sun, 11 Oct 2009 15:36:05 -0700
Message-ID: <4b124c310910111536r7c324a0dsbc232758de4fb399@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636284044451c5b0475b07036
X-Virus-Checked: Checked by ClamAV on apache.org

--001636284044451c5b0475b07036
Content-Type: text/plain; charset=ISO-8859-1

Hey Eric,

  One clarification before letting the rest of this discussion sneak over to
the zoie list:

On Sun, Oct 11, 2009 at 1:51 PM, Angel, Eric <eangel@business.com> wrote:

* Am I wrong to assume that the RAMDir holds the entire index - just as the
> FSDir?  Or does RAMDir only hold a portion of the index that hasn't yet been
> flushed to disk?
>

With zoie, you index to the FSDir *and* the RAMDir simultaneously (so there
is increased CPU usage for indexing because of this),  but you only reopen()
the IndexReader on the FSDir every 15minutes (or so), so the fact that
you've been writing to it the whole while is invisible to the application in
the intervening time.  This means that a) you don't need to worry about
disaster recovery any worse than a regular non-realtime setup, and b) that
when it's time to reopen the FSDir based index, you don't need to write the
RAMDir to disk, you can just throw it away, as the disk already has the docs
that are in that RAMDir.

  -jake

--001636284044451c5b0475b07036--

From java-user-return-42764-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 11 23:23:56 2009
Return-Path: <java-user-return-42764-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63537 invoked from network); 11 Oct 2009 23:23:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 11 Oct 2009 23:23:56 -0000
Received: (qmail 96052 invoked by uid 500); 11 Oct 2009 23:23:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95976 invoked by uid 500); 11 Oct 2009 23:23:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95966 invoked by uid 99); 11 Oct 2009 23:23:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 23:23:54 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 11 Oct 2009 23:23:44 +0000
Received: by ywh14 with SMTP id 14so103114ywh.20
        for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 16:23:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=KHctzmO+FEI7aWIFu2xPMYjBjvlwnUzzneFuouFR9Jg=;
        b=ZQkk75okba3cGQ/qHGt8YNXH5/7R+7skBQG2MtBilBy3mSWOTS7cWaZ9jMf2Iz3ZZP
         /VFDrdNc82+h1MpHPuoeutzVoE27E3Bo9+447u19bRciHwXAjTY6eW82OeuFoaaiHA27
         2gb9DzYOB9O5mE54TvP9cpKaJ3sVMkjkVJVR4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=f9c6W47tixW3dCCHmUJ8e6dfoEWd8LH2qohhBUwH0frT+zqaofG6/hA7Jz/slT7hLq
         w5BoSoSNBGIdM6OsjRHO51CVYHB1oKoEiYnVlHT2IySFqxbrU/yL4y2LQHjLQLykC3O+
         ItPKN4qb6SqFSB0QXDemCE7N34neyeofceBGo=
MIME-Version: 1.0
Received: by 10.90.42.9 with SMTP id p9mr3215903agp.4.1255303403717; Sun, 11 
	Oct 2009 16:23:23 -0700 (PDT)
In-Reply-To: <4b124c310910111536r7c324a0dsbc232758de4fb399@mail.gmail.com>
References: <5699842C-6B17-418D-8755-F64A3DC66806@business.com>
	 <85d3c3b60910081956v1a767bb3va2e6d4aab61da89c@mail.gmail.com>
	 <8837fb770910082226r2b48446cwe30277e2479f8a44@mail.gmail.com>
	 <85d3c3b60910101216h1676117fi2ff4652dbd3eb95e@mail.gmail.com>
	 <DEC11051901DCC43BD47EC508118AD8604103FBA@exchg04.corp.business.com>
	 <4b124c310910111536r7c324a0dsbc232758de4fb399@mail.gmail.com>
Date: Sun, 11 Oct 2009 16:23:23 -0700
Message-ID: <4b124c310910111623h2093eae4mb1a6999ed38214e3@mail.gmail.com>
Subject: Re: Realtime & distributed
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163628391c76c4ab0475b11994
X-Virus-Checked: Checked by ClamAV on apache.org

--00163628391c76c4ab0475b11994
Content-Type: text/plain; charset=ISO-8859-1

Ok nevermind actually - the simultaneous indexing was something done in zoie
1.3,
and was changed in 1.4 to addIndexesNoOptimize() on the RAMDirectory indexes
as soon as they are big enough.

It's still true that you can throw away the RAMDirectory once the disk index
is
reopened though.

  -jake


On Sun, Oct 11, 2009 at 3:36 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

> Hey Eric,
>
>   One clarification before letting the rest of this discussion sneak over
> to the zoie list:
>
> On Sun, Oct 11, 2009 at 1:51 PM, Angel, Eric <eangel@business.com> wrote:
>
> * Am I wrong to assume that the RAMDir holds the entire index - just as the
>> FSDir?  Or does RAMDir only hold a portion of the index that hasn't yet been
>> flushed to disk?
>>
>
> With zoie, you index to the FSDir *and* the RAMDir simultaneously (so there
> is increased CPU usage for indexing because of this),  but you only reopen()
> the IndexReader on the FSDir every 15minutes (or so), so the fact that
> you've been writing to it the whole while is invisible to the application in
> the intervening time.  This means that a) you don't need to worry about
> disaster recovery any worse than a regular non-realtime setup, and b) that
> when it's time to reopen the FSDir based index, you don't need to write the
> RAMDir to disk, you can just throw it away, as the disk already has the docs
> that are in that RAMDir.
>
>   -jake
>

--00163628391c76c4ab0475b11994--

From java-user-return-42765-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 03:40:06 2009
Return-Path: <java-user-return-42765-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51912 invoked from network); 12 Oct 2009 03:40:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 03:40:06 -0000
Received: (qmail 97984 invoked by uid 500); 12 Oct 2009 03:40:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97830 invoked by uid 500); 12 Oct 2009 03:40:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97820 invoked by uid 99); 12 Oct 2009 03:40:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 03:40:03 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of scottblanc@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 03:39:53 +0000
Received: by vws29 with SMTP id 29so1173941vws.20
        for <java-user@lucene.apache.org>; Sun, 11 Oct 2009 20:39:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=uKNjC8eEr1pFNGcep/CU57gEmDjjSkLThJ2aaEjekTE=;
        b=FwyXhlpuoyoQLR6JSv4RtP2bjYV7KmIZZsGlyyF3fy1YRCm9RwONMSdCkONHbuEGEm
         SvE0l2igstQZECX9wWFDLqpRQxlEZeqpLbpE5s1Sdq2zTuvVVeUHf0KOhA/41/3ZheJV
         VT5/Iby8RFWrxszXGY5PVgIKsvEDmtXeD8JYE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=EKqAff/sWykfp1sUkI/cNaJkBrDZyyau5781UhR8YAgD84gJv6RejHPFZKeCdpQfXH
         mQN9nC70Bs3Xpx56Rc/0cRVpz4sqEI4ClAAYpE7vo4EP6oVtBRjEvtVR46n7qZW8D5rA
         vd+EoH7bXNc4+H6xHIYzeeOKbPvASS0O83seE=
MIME-Version: 1.0
Received: by 10.220.109.41 with SMTP id h41mr7557826vcp.54.1255318772601; Sun, 
	11 Oct 2009 20:39:32 -0700 (PDT)
In-Reply-To: <4b124c310910110910g68c7acf2n8e0c41f7719e4f5f@mail.gmail.com>
References: <401b577e0910080754o52c72a7kdd4fdc205753e3f2@mail.gmail.com>
	 <4b124c310910091040yccde3d4seae66d99b271a15@mail.gmail.com>
	 <401b577e0910091418w13e4b5cfyf1c0bbe0b1e19e14@mail.gmail.com>
	 <4b124c310910091440t2320b639md5f3ac9f7cd031c6@mail.gmail.com>
	 <401b577e0910091507o73d888d2u5f7a84c9670ed315@mail.gmail.com>
	 <4b124c310910091533h7563d50fy68ea09a1fceb86af@mail.gmail.com>
	 <401b577e0910091552n1bec254ao8bfb31047e065a14@mail.gmail.com>
	 <4b124c310910091732y5a78f89cnb000e45e7614d21d@mail.gmail.com>
	 <401b577e0910101924l54d65607te63ada74eb6c938a@mail.gmail.com>
	 <4b124c310910110910g68c7acf2n8e0c41f7719e4f5f@mail.gmail.com>
Date: Sun, 11 Oct 2009 20:39:32 -0700
Message-ID: <401b577e0910112039w49553158q4d8fb4d13d8bea07@mail.gmail.com>
Subject: Re: Question about how to speed up custom scoring
From: scott w <scottblanc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00c09f8fe7948556720475b4adb3
X-Virus-Checked: Checked by ClamAV on apache.org

--00c09f8fe7948556720475b4adb3
Content-Type: text/plain; charset=ISO-8859-1

On Sun, Oct 11, 2009 at 9:10 AM, Jake Mannix <jake.mannix@gmail.com> wrote:

> What do you mean "not something I can plug in on top of my original query"?
>
> Do you mean that you can't do it like the more complex example in the class
> you posted earlier in the thread, where you take a linear combination of
> the
> Map<String, Float> -based score, and the regular text score?
>

Yes exactly.


>
> Another option is to just use the CustomScoreQuery like your other
> attempt is:
>
> --------
> public class QueryTermBoostingQuery extends CustomScoreQuery {
>   private float bias;
>
>  public QueryTermBoostingQuery (Query q, ValueSourceQuery[] vQueries, float
> bias)  {
>    super(q, vQueries);
>    this.bias = bias;
>  }
>
>  @Override
>  public float customScore(int doc, float subQueryScore, float[]
> valSrcScores)   {
>    float termWeightedScore = 0;
>    for(float valSrcScore : valSrcScores) termWeightedScore +=
> valSrcScore;
>     return bias * subQueryScore + (1 - bias) * termWeightedScore;
>  }
> }
>
> And then to use it, you build up some FloatFieldSource instances like
> before:
>
>  FloatFieldSource m1 = // defined like I did in my previous message
>  FloatFieldSource m2 = //...
>  FloatFieldSource m3 = //...
>
>  ValueSourceQuery vsq1 = new ValueSourceQuery(m1);
>  vsq1.setBoost(model1Weight);
>
>  // vsq2 and vsq3 also
>
>  ValueSourceQuery[] vsq = { vsq1, vsq2, vsq3  };
>
>  Query textQuery = QueryParser.parse("company:Microsoft");
>
>  Query q = new QueryTermBoostingQuery(textQuery, vsq, bias);
> -------
>
> Does this work for you?
>

Yes I think this should work! Thanks for taking the time to clearly write up
a solution. Will report back after testing it out.

best,
Scott

--00c09f8fe7948556720475b4adb3--

From java-user-return-42766-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 05:20:00 2009
Return-Path: <java-user-return-42766-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71810 invoked from network); 12 Oct 2009 05:20:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 05:20:00 -0000
Received: (qmail 37239 invoked by uid 500); 12 Oct 2009 05:19:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37074 invoked by uid 500); 12 Oct 2009 05:19:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37011 invoked by uid 99); 12 Oct 2009 05:19:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 05:19:56 +0000
X-ASF-Spam-Status: No, hits=-1.3 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of john.wang@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 05:19:54 +0000
Received: by ywh14 with SMTP id 14so249106ywh.20
        for <multiple recipients>; Sun, 11 Oct 2009 22:19:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=TZH4lt668oV3ZC3aOhVU6h5ydX1+gbTqKuwah2tsOe0=;
        b=Tmy6WYqwZPSQq2VNpMWwuvp/cJw4Yuh8VsqMRP5Bv7+a6yl+9rth/A07TNLl9AX9nS
         IxUYSXBS5kMIPLnkJgNDbZE0GUj2hXTLe0RoZ/RGyROKmCvkYoEXxEcIJT1axDqbIG0x
         y/kpo2FrVn09SFThFb+wbB9jkcLLYHE1Z90lQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=WrfTSrURS1P7Wmw5aQtFtO8a1f50ag8BYW/vY2Yq0rzpWr3UeQWfHnrQvfjOiKS0Qp
         yQJubPVJ8LIxVdjIYjH8+MHjTS7mmGXI9MqTnz5EVnpCiPuAipsDgFYr//m18UdzJxMs
         Cake/IyAcF29SC8dyoZ88CRzC7cTR6Yz/2Qlg=
MIME-Version: 1.0
Received: by 10.101.49.19 with SMTP id b19mr5072176ank.146.1255324773085; Sun, 
	11 Oct 2009 22:19:33 -0700 (PDT)
Date: Sun, 11 Oct 2009 22:19:33 -0700
Message-ID: <8837fb770910112219s63d1ab57w41d8b2582d36c44e@mail.gmail.com>
Subject: new sorting api and some perf numbers
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org, java-dev@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636ed6dc72d735a0475b6130e

--001636ed6dc72d735a0475b6130e
Content-Type: text/plain; charset=ISO-8859-1

Hi guys:
    The new FieldComparator api looks really scary :)

    But after some perf testing with numbers I'd like to share, I guess it
is worth it:

HW: Mac Pro with 16G memory
jvm: 1.6.0_13"
jvm arg: -Xms1g -Xmx1g -server

setup

index:
1M docs even split into 8 segments (to make sure the test is fair across
segment boundaries)
each doc has 3 fields:
1) id - stored
2) val - random number, indexed, not analyzed, no norms, omit tf
3) string - "even" or "odd" of the corresponding id, not analyzed, no norms,
omit tf

built with lucene 2.4.1 to keep the same index across lucene 2.4.1 and
lucene 2.9.0 search tests

Search:
query on the term: "even" (TermQuery, minimizes the overhead of the text
search), matches 500k docs, and across segment boundary, sort by val, sort
type: string. Numhits, e.g. number of slots = 100.

ran 20 iterations of the same query for each test.

First query, includes loading

lucene 2.4.1: 4858ms, lucene 2.9.0: 816ms, gain of 595%

avg of the rest 19 queries:

lucene 2.4.1: 32ms, lucene 2.9.0: 17ms , gain of 188%

I ran this test about 5 times, the findings are similar.

The performance gain is significant!

Great job!

-John

--001636ed6dc72d735a0475b6130e--

From java-user-return-42767-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 09:25:33 2009
Return-Path: <java-user-return-42767-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32016 invoked from network); 12 Oct 2009 09:25:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 09:25:33 -0000
Received: (qmail 55182 invoked by uid 500); 12 Oct 2009 09:25:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55107 invoked by uid 500); 12 Oct 2009 09:25:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55097 invoked by uid 99); 12 Oct 2009 09:25:30 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 09:25:30 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 09:25:20 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MxH9H-0006ys-Fq
	for java-user@lucene.apache.org; Mon, 12 Oct 2009 02:24:59 -0700
Message-ID: <25852756.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 02:24:59 -0700 (PDT)
From: melix <cedric.champeau@lingway.com>
To: java-user@lucene.apache.org
Subject: Realtime search best practices
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: cedric.champeau@lingway.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

I'm going to replace an old reader/writer synchronization mechanism we had
implemented with the new near realtime search facilities in Lucene 2.9.
However, it's still a bit unclear on how to efficiently do it.

Is the following implementation the good way to do achieve it ? The context
is concurrent read/writes on an index :

1. create a Directory instance
2. create a writer on this directory
3. on each write request, add document to the writer
4. on each read request, 
 a. use writer.getReader() to obtain an up-to-date reader
 b. create an IndexSearcher with that reader
 c. perform Query
 d. close IndexSearcher
5. on application close
 a. close writer
 b. close directory

While this seems to be ok, I'm really wondering about the performance of
opening a searcher for each request. I could introduce some kind of delay
and cache a searcher for some seconds, but I'm not sure it's the best thing
to do.

Thanks,

Cedric


-- 
View this message in context: http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42768-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 10:56:07 2009
Return-Path: <java-user-return-42768-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50361 invoked from network); 12 Oct 2009 10:56:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 10:56:06 -0000
Received: (qmail 58136 invoked by uid 500); 12 Oct 2009 10:56:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58056 invoked by uid 500); 12 Oct 2009 10:56:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58046 invoked by uid 99); 12 Oct 2009 10:56:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 10:56:04 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 10:55:54 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MxIYv-0005e0-S3
	for java-user@lucene.apache.org; Mon, 12 Oct 2009 03:55:33 -0700
Message-ID: <25853791.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 03:55:33 -0700 (PDT)
From: nja <seethalrd@gmail.com>
To: java-user@lucene.apache.org
Subject: Lucene
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: seethalrd@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi ,
         I am using StandardAnalyzer for indexing as well as searching the
indexes.But my search doesn't work correctly with special characters.I am
storing some special characters in a field called TransType.ie
document.add(new Field("TransType", "db92fb60-b716-11de-8718-001a4bc7d46e",
Field.Store.YES, Field.Index.NOT_ANALYZED));

I am using the StandardAnalyser for searching also.
ie
IndexSearcher[] indxSearcher = new IndexSearcher[indexNameList.size()];
for (String indexName : indexNameList) {
					......................
}
				
String[] fields ={ "Path", "TransType"};
MultiFieldQueryParser queryParser = new MultiFieldQueryParser(fields,new
StandardAnalyzer());		
Query query = queryParser.parse(qryString);
ParallelMultiSearcher  parallelMultiSearcher = new
ParallelMultiSearcher(indxSearcher);
Hits hits = parallelMultiSearcher.search(query,new Sort(new
SortField("CreatedTicks",SortField.STRING, true)));
System.out.println(hits.length());
		
           But in my TransType search,if I give any of the special
characters it is displaying the entire list.ie if I search TransType : $ it
is showing the entire list.But I want Transtype search to work only if I
give the value which I have
stored(db92fb60-b716-11de-8718-001a4bc7d46e)....Please help me out to
resolve this issue
-- 
View this message in context: http://www.nabble.com/Lucene-tp25853791p25853791.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42769-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 11:00:51 2009
Return-Path: <java-user-return-42769-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51610 invoked from network); 12 Oct 2009 11:00:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 11:00:51 -0000
Received: (qmail 62767 invoked by uid 500); 12 Oct 2009 11:00:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62684 invoked by uid 500); 12 Oct 2009 11:00:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62674 invoked by uid 99); 12 Oct 2009 11:00:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:00:49 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:00:37 +0000
Received: from compute1.internal (compute1.internal [10.202.2.41])
	by gateway1.messagingengine.com (Postfix) with ESMTP id 96F48A3FF5
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 07:00:16 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute1.internal (MEProxy); Mon, 12 Oct 2009 07:00:16 -0400
DKIM-Signature: v=1; a=rsa-sha1; c=relaxed/relaxed; d=messagingengine.com; h=message-id:date:from:reply-to:mime-version:to:subject:references:in-reply-to:content-type:content-transfer-encoding; s=smtpout; bh=uvKZKJczRNKtfbJBGdyKKMgXkJE=; b=YiNFLK08XVnEgNP6RIlpfuvPxP6EwFGYlH/a1e3nLRMfg57bxcGNB0qu3z0wQjpSJOuUrOKXd76E+vf0eWHGJ0GzlmPNTt04U6fXRk2IwPWMMTWMPkESUtn5BsSSMvGa8YUAdrKSNg5jrnd4HRwpdFsaVXtXjnvve7xbh3cC+o8=
X-Sasl-enc: U0MwGIamvrp6UcF5fAq0ZBMYUhU1KpS85gE40DCqfj1v 1255345215
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id A50F735EF2
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 07:00:15 -0400 (EDT)
Message-ID: <4AD30C3E.6090200@fastmail.fm>
Date: Mon, 12 Oct 2009 12:00:14 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: How do you properly use NumericField
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA> <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA>
In-Reply-To: <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Uwe Schindler wrote:
> I forgot: The format of numeric fields is also not plain text, because of
> this a simple TermQuery as generated by your query parser will not work,
> too.
>
> If you want to hit numeric values without a NumericRangeQuery with lower and
> upper bound equal, you have to use NumericUtils to translate the term text,
> e.g. new TermQuery(new Term("field",
> NumericUtils.intToPrefixCoded(value,precstep)))
>
> If you want support for this in QueryParser, you have to override
> QueryParser.newTermQuery as explained before for newRangeQuery. By the way,
> Solr does this in exactly that way.
>
> Uwe
>   

Ok, Im trying my best here but still cannot get range or single term 
query searching to work.

package org.musicbrainz.search.servlet;

import junit.framework.TestCase;
import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.NumericField;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.Term;
import org.apache.lucene.queryParser.QueryParser;
import org.apache.lucene.search.*;
import org.apache.lucene.store.RAMDirectory;
import org.apache.lucene.util.NumericUtils;
import org.musicbrainz.search.index.TrackAnalyzer;

public class NumericFieldTest extends TestCase {

    public void testNumericFields() throws Exception {
        Analyzer analyzer = new TrackAnalyzer();
        RAMDirectory dir = new RAMDirectory();
        IndexWriter writer = new IndexWriter(dir, analyzer, true, 
IndexWriter.MaxFieldLength.LIMITED);
        Document doc = new Document();
        NumericField nf  = new NumericField("dur");
        nf.setIntValue(123);
        writer.addDocument(doc);
        writer.close();

        IndexSearcher searcher = new IndexSearcher(dir,true);
        {

            Query q = new 
MusicbrainzQueryParser("dur",analyzer).parse("[12 TO 124]");
            assertEquals(1, searcher.search(q,10).totalHits);


            q = new MusicbrainzQueryParser("dur",analyzer).parse("123");
            assertEquals(1, searcher.search(q,10).totalHits);


        }
    }

    static class MusicbrainzQueryParser extends QueryParser {

        public MusicbrainzQueryParser(String field, Analyzer a) {
            super(field, a);
            System.out.println("init parser");
        }

        public Query newRangeQuery(String field,
                                   String part1,
                                   String part2,
                                   boolean inclusive)
                 {
            System.out.println("RangeQuery");
            TermRangeQuery query = (TermRangeQuery)
                    super.newRangeQuery(field, part1, part2,
                            inclusive);

            if ("dur".equals(field)) {
                System.out.println("durRangeQuery");

                return NumericRangeQuery.newIntRange(
                        "dur",
                        Integer.parseInt(query.getLowerTerm()),
                        Integer.parseInt(query.getUpperTerm()),
                        query.includesLower(),
                        query.includesUpper());
            } else {
                return query;
            }
        }

        protected Query newTermQuery(Term term)
        {
            System.out.println("newTermQuery");
            if(term.field().equals("dur")) {
               System.out.println("dur,newTermQuery");
               TermQuery tq =  new TermQuery(new Term("field",
               
NumericUtils.intToPrefixCoded(Integer.parseInt(term.text()),NumericUtils.PRECISION_STEP_DEFAULT)));
               return tq;
            }
            else {
                return super.newTermQuery(term);
            }
        }
    }

}

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42770-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 11:08:36 2009
Return-Path: <java-user-return-42770-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54382 invoked from network); 12 Oct 2009 11:08:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 11:08:36 -0000
Received: (qmail 78314 invoked by uid 500); 12 Oct 2009 11:08:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78247 invoked by uid 500); 12 Oct 2009 11:08:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78237 invoked by uid 99); 12 Oct 2009 11:08:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:08:34 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.212.191 as permitted sender)
Received: from [209.85.212.191] (HELO mail-vw0-f191.google.com) (209.85.212.191)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:08:31 +0000
Received: by vws29 with SMTP id 29so1268193vws.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 04:08:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=aMk4ZXhmi2uWZm/fRa38Ho1a5o6jX7VH4hsq5LcSWDk=;
        b=Flcof7HeffBE6tGu+dNYghGqSMJbKU/CQJwIg3vuDhBmEewvhvHxjNeoiE91xBXAMH
         5h0538EqrIHjA1RyBZiDze3CyKBkgEMuGE8Svz8uZG4e37e6btAAh2UG3GRh8DPgXzT4
         hHhonC5jtEuxa7bJZn8Es50lEpFgbiGsuPUhc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=RGxFOIf9rWPZhakYUDk+QHxdr7EEjQYhxbBQ2oeA8rSR1DuvMCTf3+avvV8At4bWMq
         xf5h4gNMTMw34WaXr2aplTeF+VgsFDyLYPZqmwfa6ZYmw++Bof7cGw+zS5d6yTLAvPoG
         ht5GIIRykVlwk8wjCjhdpBNfmtqzRB5iZke60=
MIME-Version: 1.0
Received: by 10.220.108.41 with SMTP id d41mr8122513vcp.28.1255345690048; Mon, 
	12 Oct 2009 04:08:10 -0700 (PDT)
In-Reply-To: <25853791.post@talk.nabble.com>
References: <25853791.post@talk.nabble.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Mon, 12 Oct 2009 12:07:50 +0100
Message-ID: <8c4e68610910120407g6a2a9313pf56a0f3ecdd485e3@mail.gmail.com>
Subject: Re: Lucene
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

You are storing this field without analysis, correctly as you want
exact matches only, but using StandardAnalyzer at query time.  Use
PerFieldAnalyzerWrapper, specifying KeywordAnalyzer for this field.
Using MultiFieldQueryParser may not make much sense here.


--
Ian.



On Mon, Oct 12, 2009 at 11:55 AM, nja <seethalrd@gmail.com> wrote:
>
> Hi ,
> =A0 =A0 =A0 =A0 I am using StandardAnalyzer for indexing as well as searc=
hing the
> indexes.But my search doesn't work correctly with special characters.I am
> storing some special characters in a field called TransType.ie
> document.add(new Field("TransType", "db92fb60-b716-11de-8718-001a4bc7d46e=
",
> Field.Store.YES, Field.Index.NOT_ANALYZED));
>
> I am using the StandardAnalyser for searching also.
> ie
> IndexSearcher[] indxSearcher =3D new IndexSearcher[indexNameList.size()];
> for (String indexName : indexNameList) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0......................
> }
>
> String[] fields =3D{ "Path", "TransType"};
> MultiFieldQueryParser queryParser =3D new MultiFieldQueryParser(fields,ne=
w
> StandardAnalyzer());
> Query query =3D queryParser.parse(qryString);
> ParallelMultiSearcher =A0parallelMultiSearcher =3D new
> ParallelMultiSearcher(indxSearcher);
> Hits hits =3D parallelMultiSearcher.search(query,new Sort(new
> SortField("CreatedTicks",SortField.STRING, true)));
> System.out.println(hits.length());
>
> =A0 =A0 =A0 =A0 =A0 But in my TransType search,if I give any of the speci=
al
> characters it is displaying the entire list.ie if I search TransType : $ =
it
> is showing the entire list.But I want Transtype search to work only if I
> give the value which I have
> stored(db92fb60-b716-11de-8718-001a4bc7d46e)....Please help me out to
> resolve this issue
> --
> View this message in context: http://www.nabble.com/Lucene-tp25853791p258=
53791.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42771-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 11:09:52 2009
Return-Path: <java-user-return-42771-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54492 invoked from network); 12 Oct 2009 11:09:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 11:09:52 -0000
Received: (qmail 80234 invoked by uid 500); 12 Oct 2009 11:09:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80164 invoked by uid 500); 12 Oct 2009 11:09:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80154 invoked by uid 99); 12 Oct 2009 11:09:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:09:50 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:09:40 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MxImF-0006rs-Sz
	for java-user@lucene.apache.org; Mon, 12 Oct 2009 04:09:19 -0700
Message-ID: <25853966.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 04:09:19 -0700 (PDT)
From: nitingupta183 <nitingupta183@gmail.com>
To: java-user@lucene.apache.org
Subject: Usage of Lucene/Hibernate Search for Contacts Merging operation
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: nitingupta183@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi all,

I am supposed to add a feature in which my app will detect the duplicate
contacts of a user on the basis of their name, email, mobile number
etc.(i.e. Contacts Duplicate Killer kind of feature). The simplest algo i
can think of is find all the contacts on the basis of their name, email and
mobile and then run the loop to determine which all contacts have similar
entries. But i think this algo will have worst performance.

I am currently using Hibernate. I got to know about Hibernate Search/Lucene.
Can I use these solutions for this task. I am asking this on the basis that
Lucene already implements algos such as Levenshtein_distance. May be I can
harness the Lucene power to make this task efficient.

If anyone has done this or something similar with Lucene or some other also,
then please give me pointers for the same.

regards
nitin
-- 
View this message in context: http://www.nabble.com/Usage-of-Lucene-Hibernate-Search-for-Contacts-Merging-operation-tp25853966p25853966.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42772-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 11:10:31 2009
Return-Path: <java-user-return-42772-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54640 invoked from network); 12 Oct 2009 11:10:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 11:10:31 -0000
Received: (qmail 82032 invoked by uid 500); 12 Oct 2009 11:10:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81947 invoked by uid 500); 12 Oct 2009 11:10:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81937 invoked by uid 99); 12 Oct 2009 11:10:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:10:28 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 11:10:18 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MxIms-0006u8-5Q
	for java-user@lucene.apache.org; Mon, 12 Oct 2009 04:09:58 -0700
Message-ID: <25853966.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 04:09:58 -0700 (PDT)
From: nitingupta183 <nitingupta183@gmail.com>
To: java-user@lucene.apache.org
Subject: Usage of Lucene/Hibernate Search for Duplicate Contacts Detection
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: nitingupta183@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi all,

I am supposed to add a feature in which my app will detect the duplicate
contacts of a user on the basis of their name, email, mobile number
etc.(i.e. Contacts Duplicate Killer kind of feature). The simplest algo i
can think of is find all the contacts on the basis of their name, email and
mobile and then run the loop to determine which all contacts have similar
entries. But i think this algo will have worst performance.

I am currently using Hibernate. I got to know about Hibernate Search/Lucene.
Can I use these solutions for this task. I am asking this on the basis that
Lucene already implements algos such as Levenshtein_distance. May be I can
harness the Lucene power to make this task efficient.

If anyone has done this or something similar with Lucene or some other also,
then please give me pointers for the same.

regards
nitin
-- 
View this message in context: http://www.nabble.com/Usage-of-Lucene-Hibernate-Search-for-Duplicate-Contacts-Detection-tp25853966p25853966.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42773-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 12:52:33 2009
Return-Path: <java-user-return-42773-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89498 invoked from network); 12 Oct 2009 12:52:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 12:52:33 -0000
Received: (qmail 74128 invoked by uid 500); 12 Oct 2009 12:52:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74060 invoked by uid 500); 12 Oct 2009 12:52:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74050 invoked by uid 99); 12 Oct 2009 12:52:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 12:52:31 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [88.198.66.45] (HELO ox.lw-systems.net) (88.198.66.45)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 12:52:28 +0000
Received: from localhost (localhost [127.0.0.1])
	by ox.lw-systems.net (Postfix) with ESMTP id 904D8214A50;
	Mon, 12 Oct 2009 14:52:06 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail2.lw-systems.de
X-Spam-Score: -1.572
X-Spam-Level: 
Received: from ox.lw-systems.net ([127.0.0.1])
	by localhost (fermat.lw-systems.de [127.0.0.1]) (amavisd-new, port 10024)
	with LMTP id 06lvexHpDagI; Mon, 12 Oct 2009 14:51:56 +0200 (CEST)
Received: from [192.168.4.22] (xdslgq181.osnanet.de [89.166.228.181])
	by ox.lw-systems.net (Postfix) with ESMTP id C4CDC2149CF
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:51:56 +0200 (CEST)
Message-ID: <4AD326B3.30508@lw-systems.de>
Date: Mon, 12 Oct 2009 14:53:07 +0200
From: Rene Wiermer <r.wiermer@lw-systems.de>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Usage of Lucene/Hibernate Search for Contacts Merging operation
References: <25853966.post@talk.nabble.com>
In-Reply-To: <25853966.post@talk.nabble.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
X-Old-Spam-Status: No, score=-1.572 tagged_above=-100 required=4 tests=[AWL=0.122,
	BAYES_00=-2.599, RCVD_IN_PBL=0.905]

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

nitingupta183 schrieb:
> Hi all,
> 
> I am supposed to add a feature in which my app will detect the duplicate
> contacts of a user on the basis of their name, email, mobile number
> etc.(i.e. Contacts Duplicate Killer kind of feature). The simplest algo i
> can think of is find all the contacts on the basis of their name, email and
> mobile and then run the loop to determine which all contacts have similar
> entries. But i think this algo will have worst performance.

Try to prune your search space. It is reasonable to assume that there
are not too many duplicates overall.
You can use IndexReader.terms() to get a list of terms and then a
docFreq() to check the number of documents containing that term.

E.g. search for all email terms and process those, whose docFreq is >1.
Add the corresponding documents for each email term to a "possible
identical contacts" container.

Repeat the same with birth dates, phone numbers and names, preferably
with some normalization.

Then merge those "possible identical contact" containers, who share a
common document.

Example:
Container 1	Container 2			Merged Container
				--->
A, B		B,C				A,B,C

(Implementation note: try to keep track of the list of containers a
certain number is in using a look-up table:  A -> 1; B -> 1,2,3,6; C ->2
etc.  )

Then compare the documents inside these container with each other and
decide, which contacts you want to merge and which not.

> I am currently using Hibernate. I got to know about Hibernate Search/Lucene.
> Can I use these solutions for this task. I am asking this on the basis that
> Lucene already implements algos such as Levenshtein_distance. May be I can
> harness the Lucene power to make this task efficient.

Try using a Soundex or Metaphone analyzer for similarity; they map
similar sounding strings to a single value and are much easier to handle
in the Lucene framework than numeric measures like Levensthein;

there are examples in Lucene contrib.



- --
Rene Wiermer
(Softwareentwickler/Systemingenieur)


- -- LWsystems GmbH & Co. KG ++ http://www.lw-systems.de/impressum
Tel: 05455 / 932 132 ++ Fax: 05455 / 932 099 ++ Mobil: 0171 / 37 28 760
Ihr Spezialist fr Linux, Open Source & IT-Sicherheit
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
LWsystems GmbH & Co. KG Sitz der Gesellschaft: Tegelerweg 11, 49186 Bad
Iburg
Telefon +49 (0)5403 5556 Telefax +49 (0)5403 7958997
Handelsregister: Amtsgericht Osnabrck, HRA 110668 USt.-ID-Nr. DE23852211
Persnlich haftende Gesellschafterin: LWsystems Verwaltungs GmbH
Sitz der Gesellschaft: Tegelerweg 11, 49186 Bad Iburg
Handelsregister: Amtsgericht Osnabrck, HRB 111163
Geschftsfhrer: Dipl.-Ing. Ansgar H. Licher, Bad Iburg Dipl.-Ing.
Martin Werthmller, Ibbenbren
Fr weitere Firmendetails zu LWsystems siehe / For further company
details please look at: http://www.lw-systems.de/impressum
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAkrTJrAACgkQM8UTt+++8LiQogCfeMTyF9EMf2fVZtz61TnCIEII
5dMAn0YlKgiEQ8M5/Kkf2SZS/acHhe2u
=TFm+
-----END PGP SIGNATURE-----

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42774-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 12:54:19 2009
Return-Path: <java-user-return-42774-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89871 invoked from network); 12 Oct 2009 12:54:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 12:54:19 -0000
Received: (qmail 76600 invoked by uid 500); 12 Oct 2009 12:54:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76525 invoked by uid 500); 12 Oct 2009 12:54:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76515 invoked by uid 99); 12 Oct 2009 12:54:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 12:54:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of christoph.boosz@googlemail.com designates 209.85.219.180 as permitted sender)
Received: from [209.85.219.180] (HELO mail-ew0-f180.google.com) (209.85.219.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 12:54:06 +0000
Received: by ewy28 with SMTP id 28so1149801ewy.5
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 05:53:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=gLD8IbQXsVALciA/JLRynBgdlTkbU58iKTCc1XSsiek=;
        b=htO/E+flM9e9TGTazyh4f/PvyZSZG8txS0ip0fmKGz8mhc/V88FXx3XxKCQUFISNYT
         PDS4HY3UtkmxamYegJ+CUQRlmSTTWbvVtpqSjpiqwoH0SkLg0VbJbzkXhwGZ3k0F+kva
         77RW2WijlZo/BC1bGl4HnzgvfMBHCRyYtnTlo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=nz3JO3P0RGJQ7ABkv38lsAFho0BwnetEEo2n/j6rP90EOcyvaa0C1MnDzUTBTXnVH4
         EIkLpDIxgBUCclVSAacn29LC9zxhzL4fOxlF46UTkEmdZsCp+iBNl4Fc5Dpb8EcUB2Ju
         8BuNJ7T9zNJsS+fweTL6BXCj1qUvNUu4hI5kw=
MIME-Version: 1.0
Received: by 10.216.93.68 with SMTP id k46mr2008542wef.161.1255352025595; Mon, 
	12 Oct 2009 05:53:45 -0700 (PDT)
Date: Mon, 12 Oct 2009 14:53:45 +0200
Message-ID: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
Subject: faceted search performance
From: Christoph Boosz <christoph.boosz@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d644418dbde30475bc6b51
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d644418dbde30475bc6b51
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Hi,

I have a question related to faceted search. My index contains more than 1
million documents, and nearly 1 million terms. My aim is to get a DocIdSet
for each term occurring in the result of a query. I use the approach
described on
http://sujitpal.blogspot.com/2007/04/lucene-search-within-search-with.html<=
https://service.gmx.net/de/cgi/derefer?TYPE=3D3&DEST=3Dhttp%3A%2F%2Fsujitpa=
l.blogspot.com%2F2007%2F04%2Flucene-search-within-search-with.html>,
where a BitSet is built out of a QueryFilter for each term and intersected
with the BitSet representing the user query.
However, performance could be better. I guess it=92s because the term filte=
r
considers each document in the index, even if it=92s not in the result. My
attempt to use a ChainedFilter, where the first filter (cached) is for the
user query, and the second one for the term (done for all terms), didn=92t
speed things up, though.
Am I missing something? Is there a better way to get the DocIdSets for a
huge number of terms in a limited set of documents?

Thanks in advance!
Chris

--0016e6d644418dbde30475bc6b51--

From java-user-return-42775-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 15:45:54 2009
Return-Path: <java-user-return-42775-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55560 invoked from network); 12 Oct 2009 15:45:50 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 15:45:50 -0000
Received: (qmail 54212 invoked by uid 500); 12 Oct 2009 15:45:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54131 invoked by uid 500); 12 Oct 2009 15:45:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54121 invoked by uid 99); 12 Oct 2009 15:45:46 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 15:45:46 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [194.109.24.37] (HELO smtp-vbr17.xs4all.nl) (194.109.24.37)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 15:45:35 +0000
Received: from k8u.localnet (porta.xs4all.nl [83.163.165.214])
	by smtp-vbr17.xs4all.nl (8.13.8/8.13.8) with ESMTP id n9CFjFJE075660
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 17:45:15 +0200 (CEST)
	(envelope-from paul.elschot@xs4all.nl)
From: Paul Elschot <paul.elschot@xs4all.nl>
To: java-user@lucene.apache.org
Subject: Re: faceted search performance
Date: Mon, 12 Oct 2009 17:45:12 +0200
User-Agent: KMail/1.11.2 (Linux/2.6.28-15-generic; KDE/4.2.2; i686; ; )
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
In-Reply-To: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative;
  boundary="Boundary-00=_I800KF2MSG0tAkG"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200910121745.12793.paul.elschot@xs4all.nl>
X-Virus-Scanned: by XS4ALL Virus Scanner
X-Virus-Checked: Checked by ClamAV on apache.org

--Boundary-00=_I800KF2MSG0tAkG
Content-Type: text/plain;
  charset="utf-8"
Content-Transfer-Encoding: quoted-printable

On Monday 12 October 2009 14:53:45 Christoph Boosz wrote:
> Hi,
>=20
> I have a question related to faceted search. My index contains more than 1
> million documents, and nearly 1 million terms. My aim is to get a DocIdSet
> for each term occurring in the result of a query. I use the approach
> described on
> http://sujitpal.blogspot.com/2007/04/lucene-search-within-search-with.htm=
l<https://service.gmx.net/de/cgi/derefer?TYPE=3D3&DEST=3Dhttp%3A%2F%2Fsujit=
pal.blogspot.com%2F2007%2F04%2Flucene-search-within-search-with.html>,
> where a BitSet is built out of a QueryFilter for each term and intersected
> with the BitSet representing the user query.
> However, performance could be better. I guess it=E2=80=99s because the te=
rm filter
> considers each document in the index, even if it=E2=80=99s not in the res=
ult. My
> attempt to use a ChainedFilter, where the first filter (cached) is for the
> user query, and the second one for the term (done for all terms), didn=E2=
=80=99t
> speed things up, though.
> Am I missing something? Is there a better way to get the DocIdSets for a
> huge number of terms in a limited set of documents?

Assuming you only need the number of documents within the original query
that contain each term, one thing that can be saved is the allocation of the
resulting BitSet for each term. To do this, use the cached BitSet (or the
OpenBitSet in current lucene) for the original Query as a filter for a Term=
Query
per term, and then count the matching documents by using a counting
HitCollector on the IndexSearcher.

Regards,
Paul Elschot

--Boundary-00=_I800KF2MSG0tAkG--

From java-user-return-42776-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 15:50:09 2009
Return-Path: <java-user-return-42776-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56550 invoked from network); 12 Oct 2009 15:50:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 15:50:09 -0000
Received: (qmail 60756 invoked by uid 500); 12 Oct 2009 15:50:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60665 invoked by uid 500); 12 Oct 2009 15:50:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60655 invoked by uid 99); 12 Oct 2009 15:50:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 15:50:06 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 15:49:55 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id C9318D36004;
	Mon, 12 Oct 2009 17:49:34 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 3TDqTczxxGvy; Mon, 12 Oct 2009 17:49:24 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 97C1BD36003;
	Mon, 12 Oct 2009 17:49:24 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>,
	<paul_t100@fastmail.fm>
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA> <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA> <4AD30C3E.6090200@fastmail.fm>
Subject: RE: How do you properly use NumericField
Date: Mon, 12 Oct 2009 17:49:24 +0200
Message-ID: <540A292B4B674EAA831DBD04558A01EE@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="US-ASCII"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcpLK0xYS0szpdKYTSewYy0GcTf0pwAKB+cw
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
In-reply-to: <4AD30C3E.6090200@fastmail.fm>
X-Virus-Checked: Checked by ClamAV on apache.org

Can you print the upper and lower term or the term you received in
newRangeQuery and newTermQuery also to System.out? Maybe it is converted
somehow by your Analyzer, that is used for parsing the query.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Paul Taylor [mailto:paul_t100@fastmail.fm]
> Sent: Monday, October 12, 2009 1:00 PM
> To: java-user@lucene.apache.org
> Subject: Re: How do you properly use NumericField
> 
> Uwe Schindler wrote:
> > I forgot: The format of numeric fields is also not plain text, because
> of
> > this a simple TermQuery as generated by your query parser will not work,
> > too.
> >
> > If you want to hit numeric values without a NumericRangeQuery with lower
> and
> > upper bound equal, you have to use NumericUtils to translate the term
> text,
> > e.g. new TermQuery(new Term("field",
> > NumericUtils.intToPrefixCoded(value,precstep)))
> >
> > If you want support for this in QueryParser, you have to override
> > QueryParser.newTermQuery as explained before for newRangeQuery. By the
> way,
> > Solr does this in exactly that way.
> >
> > Uwe
> >
> 
> Ok, Im trying my best here but still cannot get range or single term
> query searching to work.
> 
> package org.musicbrainz.search.servlet;
> 
> import junit.framework.TestCase;
> import org.apache.lucene.analysis.Analyzer;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.document.NumericField;
> import org.apache.lucene.index.IndexWriter;
> import org.apache.lucene.index.Term;
> import org.apache.lucene.queryParser.QueryParser;
> import org.apache.lucene.search.*;
> import org.apache.lucene.store.RAMDirectory;
> import org.apache.lucene.util.NumericUtils;
> import org.musicbrainz.search.index.TrackAnalyzer;
> 
> public class NumericFieldTest extends TestCase {
> 
>     public void testNumericFields() throws Exception {
>         Analyzer analyzer = new TrackAnalyzer();
>         RAMDirectory dir = new RAMDirectory();
>         IndexWriter writer = new IndexWriter(dir, analyzer, true,
> IndexWriter.MaxFieldLength.LIMITED);
>         Document doc = new Document();
>         NumericField nf  = new NumericField("dur");
>         nf.setIntValue(123);
>         writer.addDocument(doc);
>         writer.close();
> 
>         IndexSearcher searcher = new IndexSearcher(dir,true);
>         {
> 
>             Query q = new
> MusicbrainzQueryParser("dur",analyzer).parse("[12 TO 124]");
>             assertEquals(1, searcher.search(q,10).totalHits);
> 
> 
>             q = new MusicbrainzQueryParser("dur",analyzer).parse("123");
>             assertEquals(1, searcher.search(q,10).totalHits);
> 
> 
>         }
>     }
> 
>     static class MusicbrainzQueryParser extends QueryParser {
> 
>         public MusicbrainzQueryParser(String field, Analyzer a) {
>             super(field, a);
>             System.out.println("init parser");
>         }
> 
>         public Query newRangeQuery(String field,
>                                    String part1,
>                                    String part2,
>                                    boolean inclusive)
>                  {
>             System.out.println("RangeQuery");
>             TermRangeQuery query = (TermRangeQuery)
>                     super.newRangeQuery(field, part1, part2,
>                             inclusive);
> 
>             if ("dur".equals(field)) {
>                 System.out.println("durRangeQuery");
> 
>                 return NumericRangeQuery.newIntRange(
>                         "dur",
>                         Integer.parseInt(query.getLowerTerm()),
>                         Integer.parseInt(query.getUpperTerm()),
>                         query.includesLower(),
>                         query.includesUpper());
>             } else {
>                 return query;
>             }
>         }
> 
>         protected Query newTermQuery(Term term)
>         {
>             System.out.println("newTermQuery");
>             if(term.field().equals("dur")) {
>                System.out.println("dur,newTermQuery");
>                TermQuery tq =  new TermQuery(new Term("field",
> 
> NumericUtils.intToPrefixCoded(Integer.parseInt(term.text()),NumericUtils.P
> RECISION_STEP_DEFAULT)));
>                return tq;
>             }
>             else {
>                 return super.newTermQuery(term);
>             }
>         }
>     }
> 
> }
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42777-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 16:32:56 2009
Return-Path: <java-user-return-42777-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67313 invoked from network); 12 Oct 2009 16:32:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 16:32:56 -0000
Received: (qmail 32755 invoked by uid 500); 12 Oct 2009 16:32:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32672 invoked by uid 500); 12 Oct 2009 16:32:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32662 invoked by uid 99); 12 Oct 2009 16:32:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 16:32:52 +0000
X-ASF-Spam-Status: No, hits=-3.6 required=5.0
	tests=BAYES_00,RCVD_IN_DNSWL_LOW
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.25 as permitted sender)
Received: from [66.111.4.25] (HELO out1.smtp.messagingengine.com) (66.111.4.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 16:32:50 +0000
Received: from compute1.internal (compute1.internal [10.202.2.41])
	by gateway1.messagingengine.com (Postfix) with ESMTP id F1BE4A4684;
	Mon, 12 Oct 2009 12:32:28 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute1.internal (MEProxy); Mon, 12 Oct 2009 12:32:28 -0400
DKIM-Signature: v=1; a=rsa-sha1; c=relaxed/relaxed; d=messagingengine.com; h=message-id:date:from:reply-to:mime-version:to:cc:subject:references:in-reply-to:content-type:content-transfer-encoding; s=smtpout; bh=kHb4a5cTkK+uI2POwJCP3nRUqRw=; b=JXBVIHVpm9AJWUcENAZ13q1SZSA6NGV+SkOT0LRwe5YnoEny6HoV8YoNIxblHoErVrGxS9E7g+2Fw0QIyvfFtfPBx0JrNaLzrzmcvJ1LfIRw6saZFRDL/6KejTb9e5jdg1ffwyBHmrWFU9rLE/uh3bQu8wxmJgSygPjCaTFHLKw=
X-Sasl-enc: xuRH6941xePW+4TFKy07ol40kLl2K+/GZXkcnOIy29lR 1255365148
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id 1CE6D36036;
	Mon, 12 Oct 2009 12:32:27 -0400 (EDT)
Message-ID: <4AD35A1B.7010500@fastmail.fm>
Date: Mon, 12 Oct 2009 17:32:27 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: Uwe Schindler <uwe@thetaphi.de>
CC: java-user@lucene.apache.org
Subject: Re: How do you properly use NumericField
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA> <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA> <4AD30C3E.6090200@fastmail.fm> <540A292B4B674EAA831DBD04558A01EE@VEGA>
In-Reply-To: <540A292B4B674EAA831DBD04558A01EE@VEGA>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Uwe Schindler wrote:
> Can you print the upper and lower term or the term you received in
> newRangeQuery and newTermQuery also to System.out? Maybe it is converted
> somehow by your Analyzer, that is used for parsing the query.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>   
Its okay I've given up on NumericField itself now but just use 
NumericUtils which isn't giving me the performance advantages but is 
working okay for what I want to do

So when indexing I do
doc.add(new Field(field.getName(), NumericUtils.intToPrefixCoded(val), 
Field.Store.YES, Field.Index.ANALYZED);


and my Query Parser looks like this:

public class MusicbrainzQueryParser extends QueryParser {

    public MusicbrainzQueryParser(String field, Analyzer a) {
        super(field, a);
    }

    protected Query newTermQuery(Term term) {
        if (
                (term.field() == TrackIndexField.DURATION.getName()) ||
                        (term.field() == 
TrackIndexField.QUANTIZED_DURATION.getName()) ||
                        (term.field() == 
TrackIndexField.TRACKNUM.getName()) ||
                        (term.field() == 
TrackIndexField.NUM_TRACKS.getName())
                ) {
            TermQuery tq = new TermQuery(new Term(term.field(), 
NumericUtils.intToPrefixCoded(Integer.parseInt(term.text()))));
            return tq;
        } else {
            return super.newTermQuery(term);
        }
    }

    public Query newRangeQuery(String field,
                               String part1,
                               String part2,
                               boolean inclusive) {

        if (
                (field.equals(TrackIndexField.DURATION.getName())) ||
                
(field.equals(TrackIndexField.QUANTIZED_DURATION.getName())) ||
                (field.equals(TrackIndexField.TRACKNUM.getName())) ||
                (field.equals(TrackIndexField.NUM_TRACKS.getName()))
            )
        {
            part1 = NumericUtils.intToPrefixCoded(Integer.parseInt(part1));
            part2 = NumericUtils.intToPrefixCoded(Integer.parseInt(part2));
        }
        TermRangeQuery query = (TermRangeQuery)
                super.newRangeQuery(field, part1, part2,inclusive);
        return query;
    }
}

and to display the value I use

String duration = doc.get(TrackIndexField.DURATION);
            if (duration != null) {
                
System.out.prinltn(BigInteger.valueOf(NumericUtils.prefixCodedToInt(duration)));
            }


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42778-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 16:33:00 2009
Return-Path: <java-user-return-42778-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67361 invoked from network); 12 Oct 2009 16:33:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 16:33:00 -0000
Received: (qmail 34502 invoked by uid 500); 12 Oct 2009 16:32:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34450 invoked by uid 500); 12 Oct 2009 16:32:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34440 invoked by uid 99); 12 Oct 2009 16:32:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 16:32:58 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of john.wang@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 16:32:48 +0000
Received: by ywh14 with SMTP id 14so584859ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 09:32:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=BxDSo15rpGB8h7wOXJ5ySUR3T49GnyEfHI2z5mRzK+E=;
        b=utsuunKzK/XDUO2OUelBmPMjXtzDax+yreh04UdkS8+4z4OJ4akRo/8U1dfD8jpyya
         S1BRfxm2o+xXxh5FccoFpV30G+kRxCjv8pEOf3ppHgWzFpisR+8EONQseR5Jnq0wjSeF
         DGLZ7CT5WwImJSTaFV5AbPFF95716ttgiZv5g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=oNdOQ9hW66vzqYHOu2HWKsjDV1cVfgIQB42tYkeg/sT82luOekBhD9fe8qOQ4KdqX8
         QbvJFdPUKVnAhwOK811gHRKkYpZq7Jt+ogGwoKHIkxdUBKJxvfkg2e90X1lVm0NQWhqA
         pTfsbNJJ0meiOAsw2RJP9VS0a7hHFqwXrWod0=
MIME-Version: 1.0
Received: by 10.101.167.1 with SMTP id u1mr5676889ano.166.1255365147156; Mon, 
	12 Oct 2009 09:32:27 -0700 (PDT)
In-Reply-To: <200910121745.12793.paul.elschot@xs4all.nl>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <200910121745.12793.paul.elschot@xs4all.nl>
Date: Mon, 12 Oct 2009 09:32:24 -0700
Message-ID: <8837fb770910120932r21555aa0t59e9b36db5663f70@mail.gmail.com>
Subject: Re: faceted search performance
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c5961ea8e0790475bf79cf
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c5961ea8e0790475bf79cf
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Given you have 1M docs and about 1M terms, do you see very few docs per
term?
If your DocSet per term is very sparse, BitSet is probably not a good
representation. Simple int array maybe better for memory, and faster for
iterating.

-John

On Mon, Oct 12, 2009 at 8:45 AM, Paul Elschot <paul.elschot@xs4all.nl>wrote=
:

> On Monday 12 October 2009 14:53:45 Christoph Boosz wrote:
> > Hi,
> >
> > I have a question related to faceted search. My index contains more tha=
n
> 1
> > million documents, and nearly 1 million terms. My aim is to get a
> DocIdSet
> > for each term occurring in the result of a query. I use the approach
> > described on
> >
> http://sujitpal.blogspot.com/2007/04/lucene-search-within-search-with.htm=
l
> <
> https://service.gmx.net/de/cgi/derefer?TYPE=3D3&DEST=3Dhttp%3A%2F%2Fsujit=
pal.blogspot.com%2F2007%2F04%2Flucene-search-within-search-with.html
> >,
> > where a BitSet is built out of a QueryFilter for each term and
> intersected
> > with the BitSet representing the user query.
> > However, performance could be better. I guess it=92s because the term
> filter
> > considers each document in the index, even if it=92s not in the result.=
 My
> > attempt to use a ChainedFilter, where the first filter (cached) is for
> the
> > user query, and the second one for the term (done for all terms), didn=
=92t
> > speed things up, though.
> > Am I missing something? Is there a better way to get the DocIdSets for =
a
> > huge number of terms in a limited set of documents?
>
> Assuming you only need the number of documents within the original query
> that contain each term, one thing that can be saved is the allocation of
> the
> resulting BitSet for each term. To do this, use the cached BitSet (or the
> OpenBitSet in current lucene) for the original Query as a filter for a
> TermQuery
> per term, and then count the matching documents by using a counting
> HitCollector on the IndexSearcher.
>
> Regards,
> Paul Elschot
>

--001636c5961ea8e0790475bf79cf--

From java-user-return-42779-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 16:35:38 2009
Return-Path: <java-user-return-42779-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68003 invoked from network); 12 Oct 2009 16:35:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 16:35:38 -0000
Received: (qmail 41003 invoked by uid 500); 12 Oct 2009 16:35:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40946 invoked by uid 500); 12 Oct 2009 16:35:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40936 invoked by uid 99); 12 Oct 2009 16:35:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 16:35:35 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of till.kolter@googlemail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 16:35:33 +0000
Received: by ewy26 with SMTP id 26so9613757ewy.5
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 09:35:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=zlAIfDsXMiTiwZ8ZJJ5c44ua0Mvlodrtq8PxHghmw9c=;
        b=p1ok2sYGI3hWS0tStaNeYcMUb2XNjC5pPd7XjjXe6Dfu+Bf3uqsYfsHn+QG0nh+wN6
         d1PpZLN5I7XLBqq9ea/jHV3oaHJlLTlIs0rCBVvC/06vsO9W+apzgQDy3e9Z9XqMaFH8
         zGYKjmuqPhqNUttQtD8fHkL1nVzk1rZ5qVbT4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=iOQGI6mNWi8DB5qf9TCplqBwW4NRcVFMv0Fk4P00QOcJLE6ycDLyEKqGe4v3AVGXE8
         qITNshLmk2XNJmJpvliinI4tcfDPGKuL9MBS8F9RWX/NFr4/87cXwImpSg4dCena8n7t
         EepfaA463+SJ2gyHs/jBd1Ns2BuIzI4Xth05k=
MIME-Version: 1.0
Received: by 10.210.160.12 with SMTP id i12mr4379302ebe.9.1255365310576; Mon, 
	12 Oct 2009 09:35:10 -0700 (PDT)
In-Reply-To: <20091009171600.GA21017@spotter-dclnx>
References: <3433bf110910090911y96d3a19ga718eeb1ff4eca08@mail.gmail.com>
	 <20091009171600.GA21017@spotter-dclnx>
Date: Mon, 12 Oct 2009 18:35:10 +0200
Message-ID: <3433bf110910120935n947b76emddaad1a2cfcc844e@mail.gmail.com>
Subject: Re: Getting left and right offsets of term search results
From: Till Kolter <till.kolter@googlemail.com>
To: java-user@lucene.apache.org, David Causse <dcausse@spotter.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Thanks a lot. I think TermPositionsVector will solve my problem.
Although it seems to be a little inperformant

Concerning the term representation: our data is way more complex then
just phrasal annotation, it was just an example, because I am not
allowed to talk about our internal organisation. I will inspect the
Payload class, it should help me come up with a solution.


On Fri, Oct 9, 2009 at 7:16 PM, David Causse <dcausse@spotter.com> wrote:
> Hi,
>
> we also index linguistic data, but (someone correct me if I'm wrong) you
> have to deal with what the lucene store is offering.
> You can store
> usable on the search side :
> =A0- a term (TermAttribute)
> =A0- the position of the term (PositionIncrementAttribute)
> =A0- an arbitrary payload (PayloadAttribute)
> usable when you found results :
> =A0- TermVector (no attribute or OffsetAttribute and/or PositionIncrement=
Attribute)
> =A0- Any data you stored in a field (arbitrary data)
>
> OffsetAttribute are stored in TermVector (if you specified you wanted
> it) you can't search data within the TermPositionVector but you can
> iterate your results and ask the reader to return the TermPositionVector
> for a specific document and a field.
>
> Lucene can't store arbitrary Attributes they are only useful in a
> analyze pipe. You have to serialize (if you want to search for this
> info) the data inside the term itself (eg add a char at the end of term
> to describe the part of speech) and inside the Payload for position
> specific info (eg a relation id, paragraph id or whatever you want :it's
> a byte[]).
>
> With those techniques you can do many things, you have to be inventive bu=
t
> with payloads you can do very interesting things.
> You can also store the offsets inside the payload and don't bother with
> term vector!
> Well there is really hundreds of solutions to deal with linguistic data
> inside lucene. What is hard is when you have to deal with relations but
> a triplet store should be more adapted for this.
>
> I suggest also to store a serialized form of your internal
> representation in the index, it may be more flexible to use it versus
> TermPositionvector.
>
> Hope it helps.
>
> On Fri, Oct 09, 2009 at 06:11:33PM +0200, Till Kolter wrote:
>> I am quite new to Lucene, but I have searched the FAQs and consulted
>> the mailinglist archive. I debugged through the source codes as well.
>>
>> I have writen an Analyzer, that analyzes a stream by sending it to a
>> whole pipeline of linguistic processing and uses the internal
>> representation to construct a TokenStream, that tokenizes chunks
>> (semantic units). The Term-Attribute String hold the abstract
>> representations of those units. For further uses (for instance:
>> highlighting the results in text), I need access to the
>> OffsetAttribute, that I defined in my TokenStream implementation. Like
>> in StandardTokenizer I defined an OffsetAttribute to save the left and
>> right values of the original chunks.
>>
>> Now I want to search for all documents containing an
>> "AdjectivePhrase", get those APs from the Documents and highlight all
>> APs in the found documents.
>>
>> I tried to find results by getting TermPositions with
>> "Reader.termPositions(term)" and then iterate over the positions, but
>> the positions only represent the left offset.
>>
>> Is there another function to get structured results from term queries
>> over documents, where I can get the whole set of attributes, that I
>> constructed in the TokenStream with addAttribute(Class)? I did not
>> find such a function, but I guess I dont know all retrieval methods of
>> Lucene, yet. For my search I used the IndexSearcher.
>>
>> Thanks
>> Till Kolter
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
> --
> David Causse
> Spotter
> http://www.spotter.com/
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42780-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 17:28:54 2009
Return-Path: <java-user-return-42780-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92659 invoked from network); 12 Oct 2009 17:28:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 17:28:54 -0000
Received: (qmail 54359 invoked by uid 500); 12 Oct 2009 17:28:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54298 invoked by uid 500); 12 Oct 2009 17:28:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54288 invoked by uid 99); 12 Oct 2009 17:28:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 17:28:51 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 17:28:48 +0000
Received: by ywh14 with SMTP id 14so622178ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 10:28:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=RmcxLjf8zvFAcmZk9Yot7dDxBhUQ8ttAhK50/AYzPAo=;
        b=l9riWPj8pOSVotdhDNia3kxkWIcZU6ySZnNKCdeGQWz4hqgZbkEGmRMRjTN4QuhEia
         HPogOdA2DbO28GSuSYV5hHfqWaSAS3yN1Mz6GQJyWHWkr4hMck8x3NHW4jSR0sdadn3F
         oKmo/3ScCMe+tC0PJSz26WKMgF8Pfir9F8Xwg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Zq2DavHCU/JD2OneDPgbpruR6GrT+RTyni7fYr/1VrpYbQFQEbhlVfifc5vnqFCOeL
         riXj8odJgPiY3qwH96HdOoO70nD0x2tROXtlZbz11p7AYS6JXFvnJVm6gYw+M+oCGkOO
         p3cYIF7wpIu2FiGX+PTMbxAg9X5Ink+ePhZfU=
MIME-Version: 1.0
Received: by 10.90.129.15 with SMTP id b15mr3725002agd.64.1255368507602; Mon, 
	12 Oct 2009 10:28:27 -0700 (PDT)
In-Reply-To: <25852756.post@talk.nabble.com>
References: <25852756.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 10:28:27 -0700
Message-ID: <4b124c310910121028o50f89352x3d371a2aa330da70@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163630fe43f538e10475c04129

--00163630fe43f538e10475c04129
Content-Type: text/plain; charset=ISO-8859-1

Hi Cedric,

  I don't know of anyone with a substantial throughput production system who
is doing realtime search with the 2.9 improvements yet (and in fact, no
serious performance analysis has been done on these even "in the lab" so to
speak: follow https://issues.apache.org/jira/browse/LUCENE-1577 to track
work
on this), so some experimentation will be necessary to know how well it fits
in your environment.

  Your approach has the basic components of how to do 2.9 NRT search,
but it's missing the point when you're making your commit() calls.  Your
choices
here depend on some tradeoffs, as lucene provides ACID-like transactional
semantics whereby if you decide to commit() after every add(), then yes,
getReader() will be up-to-date with the most recent commit(), but at a cost
of indexing throughput (and much more frequent segment merges), at least
in comparison to only calling commit() at a slower rate (but calling
commit()
less frequently means, of course, that you only have readers as fresh as
your most recent commit).

  Also, you have to be aware that there are no guarantees as far as
realtimeliness is concerned with 2.9 NRT - if there is an addIndexes() going

on in anther thread on your IndexWriter, this is another instance where your

getReader() call won't block, but also won't necessarily get access to the
all of these new segments if the addIndexes() hasn't completed yet.

  Please post here any results you find with this - this is a very new
feature
and seeing how it works in the wild would be very helpful to everyone else
who is interested.

  -jake

On Mon, Oct 12, 2009 at 2:24 AM, melix <cedric.champeau@lingway.com> wrote:

>
> Hi,
>
> I'm going to replace an old reader/writer synchronization mechanism we had
> implemented with the new near realtime search facilities in Lucene 2.9.
> However, it's still a bit unclear on how to efficiently do it.
>
> Is the following implementation the good way to do achieve it ? The context
> is concurrent read/writes on an index :
>
> 1. create a Directory instance
> 2. create a writer on this directory
> 3. on each write request, add document to the writer
> 4. on each read request,
>  a. use writer.getReader() to obtain an up-to-date reader
>  b. create an IndexSearcher with that reader
>  c. perform Query
>  d. close IndexSearcher
> 5. on application close
>  a. close writer
>  b. close directory
>
> While this seems to be ok, I'm really wondering about the performance of
> opening a searcher for each request. I could introduce some kind of delay
> and cache a searcher for some seconds, but I'm not sure it's the best thing
> to do.
>
> Thanks,
>
> Cedric
>
>
> --
> View this message in context:
> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00163630fe43f538e10475c04129--

From java-user-return-42781-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 17:30:47 2009
Return-Path: <java-user-return-42781-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93602 invoked from network); 12 Oct 2009 17:30:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 17:30:47 -0000
Received: (qmail 61542 invoked by uid 500); 12 Oct 2009 17:30:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61460 invoked by uid 500); 12 Oct 2009 17:30:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61450 invoked by uid 99); 12 Oct 2009 17:30:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 17:30:44 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of christoph.boosz@googlemail.com designates 209.85.219.180 as permitted sender)
Received: from [209.85.219.180] (HELO mail-ew0-f180.google.com) (209.85.219.180)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 17:30:41 +0000
Received: by ewy28 with SMTP id 28so1176242ewy.5
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 10:30:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=fQOwpEWqvYuIsMVBvfshoN4KCvzqRkIbTRfe2nyKpa0=;
        b=g+oheNr70tOY24eCASqGOcGDc0Zr0kKpd4ynQ1HjOOtzVbEgU4U4w3YPpxz+Xyl0C9
         OUf4AJRzu18yj3N5XjFIvz6D7MBebPshs/wPgV+VrYzQTETjtLU2GgxN6xd6L0g+0Yym
         ZLqkowQ05lVfHBh5UOVf3lfYKzdYJV31/rPqs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=gWhU6mqNXP7DnGjjCvqmpAN/90FtDFulp7fvYdu6zkkfYjTYnH+QmoqPPEinKKeW9p
         w59+b67RqYgZcGycDKOiIGMxz0Y8VLYZ+VR1VEdZ+OZZtG/IRsvbO+pd0Cx9GmpeW9SX
         ABkfeZqacZqdp58GWfY4gb6QF/8cRTauOJWXI=
MIME-Version: 1.0
Received: by 10.216.89.84 with SMTP id b62mr2107156wef.227.1255368619976; Mon, 
	12 Oct 2009 10:30:19 -0700 (PDT)
In-Reply-To: <8837fb770910120932r21555aa0t59e9b36db5663f70@mail.gmail.com>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <200910121745.12793.paul.elschot@xs4all.nl>
	 <8837fb770910120932r21555aa0t59e9b36db5663f70@mail.gmail.com>
Date: Mon, 12 Oct 2009 19:30:19 +0200
Message-ID: <8669da1e0910121030w5ad239d9u52b447ff89b4f87@mail.gmail.com>
Subject: Re: faceted search performance
From: Christoph Boosz <christoph.boosz@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d97102a7e7f00475c048b6

--0016e6d97102a7e7f00475c048b6
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Thanks for your reply.
Yes, it's likely that many terms occur in few documents.

If I understand you right, I should do the following:
-Write a HitCollector that simply increments a counter
-Get the filter for the user query once: new CachingWrapperFilter(new
QueryWrapperFilter(userQuery));
-Create a TermQuery for each term
-Perform the search and read the counter of the HitCollector

I did that, but it didn't get faster. Any ideas why?

Regards,
Chris

2009/10/12 John Wang <john.wang@gmail.com>

> Given you have 1M docs and about 1M terms, do you see very few docs per
> term?
> If your DocSet per term is very sparse, BitSet is probably not a good
> representation. Simple int array maybe better for memory, and faster for
> iterating.
>
> -John
>
> On Mon, Oct 12, 2009 at 8:45 AM, Paul Elschot <paul.elschot@xs4all.nl
> >wrote:
>
> > On Monday 12 October 2009 14:53:45 Christoph Boosz wrote:
> > > Hi,
> > >
> > > I have a question related to faceted search. My index contains more
> than
> > 1
> > > million documents, and nearly 1 million terms. My aim is to get a
> > DocIdSet
> > > for each term occurring in the result of a query. I use the approach
> > > described on
> > >
> >
> http://sujitpal.blogspot.com/2007/04/lucene-search-within-search-with.htm=
l
> > <
> >
> https://service.gmx.net/de/cgi/derefer?TYPE=3D3&DEST=3Dhttp%3A%2F%2Fsujit=
pal.blogspot.com%2F2007%2F04%2Flucene-search-within-search-with.html
> > >,
> > > where a BitSet is built out of a QueryFilter for each term and
> > intersected
> > > with the BitSet representing the user query.
> > > However, performance could be better. I guess it=92s because the term
> > filter
> > > considers each document in the index, even if it=92s not in the resul=
t.
> My
> > > attempt to use a ChainedFilter, where the first filter (cached) is fo=
r
> > the
> > > user query, and the second one for the term (done for all terms),
> didn=92t
> > > speed things up, though.
> > > Am I missing something? Is there a better way to get the DocIdSets fo=
r
> a
> > > huge number of terms in a limited set of documents?
> >
> > Assuming you only need the number of documents within the original quer=
y
> > that contain each term, one thing that can be saved is the allocation o=
f
> > the
> > resulting BitSet for each term. To do this, use the cached BitSet (or t=
he
> > OpenBitSet in current lucene) for the original Query as a filter for a
> > TermQuery
> > per term, and then count the matching documents by using a counting
> > HitCollector on the IndexSearcher.
> >
> > Regards,
> > Paul Elschot
> >
>

--0016e6d97102a7e7f00475c048b6--

From java-user-return-42782-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 18:02:36 2009
Return-Path: <java-user-return-42782-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4449 invoked from network); 12 Oct 2009 18:02:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 18:02:36 -0000
Received: (qmail 23535 invoked by uid 500); 12 Oct 2009 18:02:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23444 invoked by uid 500); 12 Oct 2009 18:02:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23434 invoked by uid 99); 12 Oct 2009 18:02:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 18:02:33 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 18:02:24 +0000
Received: by ywh14 with SMTP id 14so643138ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 11:02:03 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=Lu1G3LmFsQxW0S8yhlwLSKds1v1qMZbzSKOd0whznLA=;
        b=tVYfc+SLeeXaVRaLiJMKT1BuqDO56DBFJQkAmQ3xCewhNur5kND30DGji+e6pnN/Fq
         +hDbleGMmlPj+SW8erppM/8rdJj+QdtWhugim1puUk+PbONML3zJyVLhvfM/IBW7syeM
         kzOKuMYQ7oCeZGtlXMjnQGMSb+eWbM4nmvUNs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=tz/8v89vanTdMNDCd73i1f03WU/0toKzLtCwoD24xwNgzaY0stx3I5B80UkUQnfLmO
         xs7neXjwhEIcx5H5rsp6e7EuQyLqpKBZlKq07kDjF40Ya4MgKd92mQqtNwSBbZfQ2vTj
         vpRbUIjgwxBk9t7a2RhQ/p2IcaZp5VzMc1M0A=
MIME-Version: 1.0
Received: by 10.91.191.17 with SMTP id t17mr3719372agp.51.1255370522877; Mon, 
	12 Oct 2009 11:02:02 -0700 (PDT)
In-Reply-To: <8669da1e0910121030w5ad239d9u52b447ff89b4f87@mail.gmail.com>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <200910121745.12793.paul.elschot@xs4all.nl>
	 <8837fb770910120932r21555aa0t59e9b36db5663f70@mail.gmail.com>
	 <8669da1e0910121030w5ad239d9u52b447ff89b4f87@mail.gmail.com>
Date: Mon, 12 Oct 2009 11:02:02 -0700
Message-ID: <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com>
Subject: Re: faceted search performance
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e646182e13e1790475c0baa1
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e646182e13e1790475c0baa1
Content-Type: text/plain; charset=ISO-8859-1

Hey Chris,

On Mon, Oct 12, 2009 at 10:30 AM, Christoph Boosz <
christoph.boosz@googlemail.com> wrote:

> Thanks for your reply.
> Yes, it's likely that many terms occur in few documents.
>
> If I understand you right, I should do the following:
> -Write a HitCollector that simply increments a counter
> -Get the filter for the user query once: new CachingWrapperFilter(new
> QueryWrapperFilter(userQuery));
> -Create a TermQuery for each term
> -Perform the search and read the counter of the HitCollector
>
> I did that, but it didn't get faster. Any ideas why?
>

This killer is the "TermQuery for each term" part - this is huge. You need
to invert this process,
and use your query as is, but while walking in the HitCollector, on each doc
which matches
your query, increment counters for each of the terms in that document (which
means you need
an in-memory forward lookup for your documents, like a multivalued
FieldCache - and if you've
got roughly the same number of terms as documents, this cache is likely to
be as large as
your entire index - a pretty hefty RAM cost).

But a good thing to keep in mind is that doing this kind of faceting
(massively multivalued
on a huge term-set) requires a lot of computation, even if you have all the
proper structures
living in memory:

For each document you look at (which matches your query), you need to look
at all
of the terms in that document, and increment a counter for that term.  So
however much
time it would normally take for you to do the driving query, it can take as
much as that
multiplied by the average number of terms in a document in your index.  If
your documents
are big, this could be a pretty huge latency penalty.

  -jake

--0016e646182e13e1790475c0baa1--

From java-user-return-42783-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 18:10:35 2009
Return-Path: <java-user-return-42783-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6412 invoked from network); 12 Oct 2009 18:10:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 18:10:35 -0000
Received: (qmail 40104 invoked by uid 500); 12 Oct 2009 18:10:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40031 invoked by uid 500); 12 Oct 2009 18:10:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40021 invoked by uid 99); 12 Oct 2009 18:10:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 18:10:32 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 18:10:29 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id CA727D36004
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 20:10:02 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id gMnDKY+Py9ZD for <java-user@lucene.apache.org>;
	Mon, 12 Oct 2009 20:09:54 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 6B187D36003
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 20:09:54 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA> <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA> <4AD30C3E.6090200@fastmail.fm> <540A292B4B674EAA831DBD04558A01EE@VEGA>
Subject: RE: How do you properly use NumericField
Date: Mon, 12 Oct 2009 20:09:54 +0200
Message-ID: <D7EBD821CFCD4D3098C760C4C9A1E2E5@VEGA>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0009_01CA4B77.F69DD250"
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <540A292B4B674EAA831DBD04558A01EE@VEGA>
Thread-Index: AcpLK0xYS0szpdKYTSewYy0GcTf0pwAKB+cwAATtbEA=
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

------=_NextPart_000_0009_01CA4B77.F69DD250
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

Hallo Paul,

I implemented what you wanted in the applied testcase. Works without
problems. Your error was, that in the TermQuery creation you placed a
precisionStep in the shift value parameter which is incorrect.

By the way: Lucene 2.9.1 and Lucene 3.0 will be optimized for ranges like [1
TO 1], because this is now as fast as a TermQuery, but you can
NumericRangeQuery for it (and do not need to encode the terms). Just replace
the TermQuery with NumericUtils in the newTermQuery method by a
NumericRangeQuery with upper and lower bound equal (and not exclusive).

Please note: negative numbers in the query parser may lead to problems,
because of this they needed to be placed in "" ("-" is the sign for
exclusion terms). The test may fail with other Analyzers that corrupt your
numbers.

Uwe

> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Monday, October 12, 2009 5:49 PM
> To: java-user@lucene.apache.org; paul_t100@fastmail.fm
> Subject: RE: How do you properly use NumericField
> 
> Can you print the upper and lower term or the term you received in
> newRangeQuery and newTermQuery also to System.out? Maybe it is converted
> somehow by your Analyzer, that is used for parsing the query.
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
> 
> > -----Original Message-----
> > From: Paul Taylor [mailto:paul_t100@fastmail.fm]
> > Sent: Monday, October 12, 2009 1:00 PM
> > To: java-user@lucene.apache.org
> > Subject: Re: How do you properly use NumericField
> >
> > Uwe Schindler wrote:
> > > I forgot: The format of numeric fields is also not plain text, because
> > of
> > > this a simple TermQuery as generated by your query parser will not
> work,
> > > too.
> > >
> > > If you want to hit numeric values without a NumericRangeQuery with
> lower
> > and
> > > upper bound equal, you have to use NumericUtils to translate the term
> > text,
> > > e.g. new TermQuery(new Term("field",
> > > NumericUtils.intToPrefixCoded(value,precstep)))
> > >
> > > If you want support for this in QueryParser, you have to override
> > > QueryParser.newTermQuery as explained before for newRangeQuery. By the
> > way,
> > > Solr does this in exactly that way.
> > >
> > > Uwe
> > >
> >
> > Ok, Im trying my best here but still cannot get range or single term
> > query searching to work.
> >
> > package org.musicbrainz.search.servlet;
> >
> > import junit.framework.TestCase;
> > import org.apache.lucene.analysis.Analyzer;
> > import org.apache.lucene.document.Document;
> > import org.apache.lucene.document.NumericField;
> > import org.apache.lucene.index.IndexWriter;
> > import org.apache.lucene.index.Term;
> > import org.apache.lucene.queryParser.QueryParser;
> > import org.apache.lucene.search.*;
> > import org.apache.lucene.store.RAMDirectory;
> > import org.apache.lucene.util.NumericUtils;
> > import org.musicbrainz.search.index.TrackAnalyzer;
> >
> > public class NumericFieldTest extends TestCase {
> >
> >     public void testNumericFields() throws Exception {
> >         Analyzer analyzer = new TrackAnalyzer();
> >         RAMDirectory dir = new RAMDirectory();
> >         IndexWriter writer = new IndexWriter(dir, analyzer, true,
> > IndexWriter.MaxFieldLength.LIMITED);
> >         Document doc = new Document();
> >         NumericField nf  = new NumericField("dur");
> >         nf.setIntValue(123);
> >         writer.addDocument(doc);
> >         writer.close();
> >
> >         IndexSearcher searcher = new IndexSearcher(dir,true);
> >         {
> >
> >             Query q = new
> > MusicbrainzQueryParser("dur",analyzer).parse("[12 TO 124]");
> >             assertEquals(1, searcher.search(q,10).totalHits);
> >
> >
> >             q = new MusicbrainzQueryParser("dur",analyzer).parse("123");
> >             assertEquals(1, searcher.search(q,10).totalHits);
> >
> >
> >         }
> >     }
> >
> >     static class MusicbrainzQueryParser extends QueryParser {
> >
> >         public MusicbrainzQueryParser(String field, Analyzer a) {
> >             super(field, a);
> >             System.out.println("init parser");
> >         }
> >
> >         public Query newRangeQuery(String field,
> >                                    String part1,
> >                                    String part2,
> >                                    boolean inclusive)
> >                  {
> >             System.out.println("RangeQuery");
> >             TermRangeQuery query = (TermRangeQuery)
> >                     super.newRangeQuery(field, part1, part2,
> >                             inclusive);
> >
> >             if ("dur".equals(field)) {
> >                 System.out.println("durRangeQuery");
> >
> >                 return NumericRangeQuery.newIntRange(
> >                         "dur",
> >                         Integer.parseInt(query.getLowerTerm()),
> >                         Integer.parseInt(query.getUpperTerm()),
> >                         query.includesLower(),
> >                         query.includesUpper());
> >             } else {
> >                 return query;
> >             }
> >         }
> >
> >         protected Query newTermQuery(Term term)
> >         {
> >             System.out.println("newTermQuery");
> >             if(term.field().equals("dur")) {
> >                System.out.println("dur,newTermQuery");
> >                TermQuery tq =  new TermQuery(new Term("field",
> >
> >
> NumericUtils.intToPrefixCoded(Integer.parseInt(term.text()),NumericUtils.P
> > RECISION_STEP_DEFAULT)));
> >                return tq;
> >             }
> >             else {
> >                 return super.newTermQuery(term);
> >             }
> >         }
> >     }
> >
> > }
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



------=_NextPart_000_0009_01CA4B77.F69DD250
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
------=_NextPart_000_0009_01CA4B77.F69DD250--


From java-user-return-42784-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 18:12:34 2009
Return-Path: <java-user-return-42784-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7039 invoked from network); 12 Oct 2009 18:12:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 18:12:33 -0000
Received: (qmail 49293 invoked by uid 500); 12 Oct 2009 18:12:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49014 invoked by uid 500); 12 Oct 2009 18:12:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48868 invoked by uid 99); 12 Oct 2009 18:12:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 18:12:30 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 18:12:26 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9754ED36005
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 20:12:04 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id KvVDhjHGjBTk for <java-user@lucene.apache.org>;
	Mon, 12 Oct 2009 20:11:53 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 24C40D36003
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 20:11:53 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4ACF8E56.7040001@fastmail.fm>	 <9ac0c6aa0910091248v7bd0096cv1a2afa6cbac3d5b@mail.gmail.com>	 <4ACF9ADC.7090102@fastmail.fm> <9ac0c6aa0910100513h14e814f0uefdbf6c1c9013a60@mail.gmail.com> <4AD21CBC.8070501@fastmail.fm> <8C2CC3F85D1C4E4EB97E3B922669D592@VEGA> <EE4BAAB1BE5B44CB9474F7EBF6ACD0D6@VEGA> <4AD30C3E.6090200@fastmail.fm> <540A292B4B674EAA831DBD04558A01EE@VEGA> <D7EBD821CFCD4D3098C760C4C9A1E2E5@VEGA>
Subject: RE: How do you properly use NumericField
Date: Mon, 12 Oct 2009 20:11:52 +0200
Message-ID: <731257D98BDA48F4A6DF8F28F5556A82@VEGA>
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_0012_01CA4B78.3D6CCE20"
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <D7EBD821CFCD4D3098C760C4C9A1E2E5@VEGA>
Thread-Index: AcpLK0xYS0szpdKYTSewYy0GcTf0pwAKB+cwAATtbEAAABCg8A==
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

------=_NextPart_000_0012_01CA4B78.3D6CCE20
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

The source code attachment got somehow lost:

 

import org.apache.lucene.analysis.WhitespaceAnalyzer;

import org.apache.lucene.document.Document;

import org.apache.lucene.document.Field;

import org.apache.lucene.document.NumericField;

import org.apache.lucene.index.IndexWriter;

import org.apache.lucene.index.Term;

import org.apache.lucene.store.RAMDirectory;

import org.apache.lucene.search.*;

import org.apache.lucene.queryParser.QueryParser;

import org.apache.lucene.util.LuceneTestCase;

import org.apache.lucene.util.NumericUtils;

 

public class TestNRQWithQueryParser extends LuceneTestCase {

 

  public void test() throws Exception {

 

    RAMDirectory directory = new RAMDirectory();

    IndexWriter writer = new IndexWriter(directory, new
WhitespaceAnalyzer(), true, IndexWriter.MaxFieldLength.UNLIMITED);

        

    for (int l=-5000; l<=5000; l++) {

      Document doc = new Document();

      doc.add(new Field("text", "the big brown", Field.Store.NO,
Field.Index.ANALYZED));

      doc.add(new NumericField("trie", Field.Store.NO,
true).setIntValue(l));

      writer.addDocument(doc);

    }  

    writer.close();

    

    Searcher searcher=new IndexSearcher(directory, true);

    

    QueryParser parser = new QueryParser("text", new WhitespaceAnalyzer()) {

    

      @Override

      protected Query newRangeQuery(String field, String part1, String
part2, boolean inclusive) {

        if ("trie".equals(field)) {

          return NumericRangeQuery.newIntRange(field,
Integer.parseInt(part1), Integer.parseInt(part2), inclusive, inclusive);

        } else {

          return super.newRangeQuery(field, part1, part2, inclusive);

        }

      }

 

      @Override

      protected Query newTermQuery(Term term) {

        if("trie".equals(term.field())) {

          return new TermQuery(new Term(term.field(),
NumericUtils.intToPrefixCoded(Integer.parseInt(term.text()))));

        } else {

          return super.newTermQuery(term);

        }

      }

      

    };

    

    TopDocs td;

    td = searcher.search(parser.parse("+trie:[20 TO 30]"), 5000);

    assertEquals(11, td.totalHits);

    td = searcher.search(parser.parse("+trie:[-4999 TO -4000]"), 5000);

    assertEquals(1000, td.totalHits);

    td = searcher.search(parser.parse("the big brown +trie:[-4999 TO
-4000]"), 5000);

    assertEquals(1000, td.totalHits);

    td = searcher.search(parser.parse("+trie:77"), 5000);

    assertEquals(1, td.totalHits);

    td = searcher.search(parser.parse("+trie:5001"), 5000);

    assertEquals(0, td.totalHits);

    td = searcher.search(parser.parse("the big brown +trie:\"-2\""), 5000);

    assertEquals(1, td.totalHits);

    td = searcher.search(parser.parse("+trie:\"-5001\""), 5000);

    assertEquals(0, td.totalHits);

 

    searcher.close();

    directory.close();

  }

  

}

 

-----

Uwe Schindler

H.-H.-Meier-Allee 63, D-28213 Bremen

http://www.thetaphi.de

eMail: uwe@thetaphi.de

 

 

> -----Original Message-----

> From: Uwe Schindler [mailto:uwe@thetaphi.de]

> Sent: Monday, October 12, 2009 8:10 PM

> To: java-user@lucene.apache.org

> Subject: RE: How do you properly use NumericField

> 

> Hallo Paul,

> 

> I implemented what you wanted in the applied testcase. Works without

> problems. Your error was, that in the TermQuery creation you placed a

> precisionStep in the shift value parameter which is incorrect.

> 

> By the way: Lucene 2.9.1 and Lucene 3.0 will be optimized for ranges like

> [1

> TO 1], because this is now as fast as a TermQuery, but you can

> NumericRangeQuery for it (and do not need to encode the terms). Just

> replace

> the TermQuery with NumericUtils in the newTermQuery method by a

> NumericRangeQuery with upper and lower bound equal (and not exclusive).

> 

> Please note: negative numbers in the query parser may lead to problems,

> because of this they needed to be placed in "" ("-" is the sign for

> exclusion terms). The test may fail with other Analyzers that corrupt your

> numbers.

> 

> Uwe

> 

> > -----Original Message-----

> > From: Uwe Schindler [mailto:uwe@thetaphi.de]

> > Sent: Monday, October 12, 2009 5:49 PM

> > To: java-user@lucene.apache.org; paul_t100@fastmail.fm

> > Subject: RE: How do you properly use NumericField

> >

> > Can you print the upper and lower term or the term you received in

> > newRangeQuery and newTermQuery also to System.out? Maybe it is converted

> > somehow by your Analyzer, that is used for parsing the query.

> >

> > -----

> > Uwe Schindler

> > H.-H.-Meier-Allee 63, D-28213 Bremen

> > http://www.thetaphi.de

> > eMail: uwe@thetaphi.de

> >

> >

> > > -----Original Message-----

> > > From: Paul Taylor [mailto:paul_t100@fastmail.fm]

> > > Sent: Monday, October 12, 2009 1:00 PM

> > > To: java-user@lucene.apache.org

> > > Subject: Re: How do you properly use NumericField

> > >

> > > Uwe Schindler wrote:

> > > > I forgot: The format of numeric fields is also not plain text,

> because

> > > of

> > > > this a simple TermQuery as generated by your query parser will not

> > work,

> > > > too.

> > > >

> > > > If you want to hit numeric values without a NumericRangeQuery with

> > lower

> > > and

> > > > upper bound equal, you have to use NumericUtils to translate the

> term

> > > text,

> > > > e.g. new TermQuery(new Term("field",

> > > > NumericUtils.intToPrefixCoded(value,precstep)))

> > > >

> > > > If you want support for this in QueryParser, you have to override

> > > > QueryParser.newTermQuery as explained before for newRangeQuery. By

> the

> > > way,

> > > > Solr does this in exactly that way.

> > > >

> > > > Uwe

> > > >

> > >

> > > Ok, Im trying my best here but still cannot get range or single term

> > > query searching to work.

> > >

> > > package org.musicbrainz.search.servlet;

> > >

> > > import junit.framework.TestCase;

> > > import org.apache.lucene.analysis.Analyzer;

> > > import org.apache.lucene.document.Document;

> > > import org.apache.lucene.document.NumericField;

> > > import org.apache.lucene.index.IndexWriter;

> > > import org.apache.lucene.index.Term;

> > > import org.apache.lucene.queryParser.QueryParser;

> > > import org.apache.lucene.search.*;

> > > import org.apache.lucene.store.RAMDirectory;

> > > import org.apache.lucene.util.NumericUtils;

> > > import org.musicbrainz.search.index.TrackAnalyzer;

> > >

> > > public class NumericFieldTest extends TestCase {

> > >

> > >     public void testNumericFields() throws Exception {

> > >         Analyzer analyzer = new TrackAnalyzer();

> > >         RAMDirectory dir = new RAMDirectory();

> > >         IndexWriter writer = new IndexWriter(dir, analyzer, true,

> > > IndexWriter.MaxFieldLength.LIMITED);

> > >         Document doc = new Document();

> > >         NumericField nf  = new NumericField("dur");

> > >         nf.setIntValue(123);

> > >         writer.addDocument(doc);

> > >         writer.close();

> > >

> > >         IndexSearcher searcher = new IndexSearcher(dir,true);

> > >         {

> > >

> > >             Query q = new

> > > MusicbrainzQueryParser("dur",analyzer).parse("[12 TO 124]");

> > >             assertEquals(1, searcher.search(q,10).totalHits);

> > >

> > >

> > >             q = new

> MusicbrainzQueryParser("dur",analyzer).parse("123");

> > >             assertEquals(1, searcher.search(q,10).totalHits);

> > >

> > >

> > >         }

> > >     }

> > >

> > >     static class MusicbrainzQueryParser extends QueryParser {

> > >

> > >         public MusicbrainzQueryParser(String field, Analyzer a) {

> > >             super(field, a);

> > >             System.out.println("init parser");

> > >         }

> > >

> > >         public Query newRangeQuery(String field,

> > >                                    String part1,

> > >                                    String part2,

> > >                                    boolean inclusive)

> > >                  {

> > >             System.out.println("RangeQuery");

> > >             TermRangeQuery query = (TermRangeQuery)

> > >                     super.newRangeQuery(field, part1, part2,

> > >                             inclusive);

> > >

> > >             if ("dur".equals(field)) {

> > >                 System.out.println("durRangeQuery");

> > >

> > >                 return NumericRangeQuery.newIntRange(

> > >                         "dur",

> > >                         Integer.parseInt(query.getLowerTerm()),

> > >                         Integer.parseInt(query.getUpperTerm()),

> > >                         query.includesLower(),

> > >                         query.includesUpper());

> > >             } else {

> > >                 return query;

> > >             }

> > >         }

> > >

> > >         protected Query newTermQuery(Term term)

> > >         {

> > >             System.out.println("newTermQuery");

> > >             if(term.field().equals("dur")) {

> > >                System.out.println("dur,newTermQuery");

> > >                TermQuery tq =  new TermQuery(new Term("field",

> > >

> > >

> >

> NumericUtils.intToPrefixCoded(Integer.parseInt(term.text()),NumericUtils.P

> > > RECISION_STEP_DEFAULT)));

> > >                return tq;

> > >             }

> > >             else {

> > >                 return super.newTermQuery(term);

> > >             }

> > >         }

> > >     }

> > >

> > > }

> > >

> > > ---------------------------------------------------------------------

> > > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org

> > > For additional commands, e-mail: java-user-help@lucene.apache.org

> >

> >

> >

> > ---------------------------------------------------------------------

> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org

> > For additional commands, e-mail: java-user-help@lucene.apache.org

> 

 


------=_NextPart_000_0012_01CA4B78.3D6CCE20--


From java-user-return-42785-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 19:12:18 2009
Return-Path: <java-user-return-42785-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29750 invoked from network); 12 Oct 2009 19:12:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 19:12:18 -0000
Received: (qmail 31503 invoked by uid 500); 12 Oct 2009 19:12:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31371 invoked by uid 500); 12 Oct 2009 19:12:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31359 invoked by uid 99); 12 Oct 2009 19:12:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:12:12 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:12:08 +0000
Received: by gxk26 with SMTP id 26so2917498gxk.11
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 12:11:47 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.237.10 with SMTP id k10mr10802466ybh.112.1255374706907; 
	Mon, 12 Oct 2009 12:11:46 -0700 (PDT)
In-Reply-To: <25852756.post@talk.nabble.com>
References: <25852756.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 15:11:46 -0400
Message-ID: <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Just to clarify: IndexWriter.newReader returns a reader that searches
uncommitted changes as well.  Ie, you need not call IndexWriter.commit
to make the changes visible.

However, if you're opening a reader the "normal" way
(IndexReader.open) then it is necessary to first call
IndexWriter.commit.

Mike

On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com> wrote:
>
> Hi,
>
> I'm going to replace an old reader/writer synchronization mechanism we ha=
d
> implemented with the new near realtime search facilities in Lucene 2.9.
> However, it's still a bit unclear on how to efficiently do it.
>
> Is the following implementation the good way to do achieve it ? The conte=
xt
> is concurrent read/writes on an index :
>
> 1. create a Directory instance
> 2. create a writer on this directory
> 3. on each write request, add document to the writer
> 4. on each read request,
> =A0a. use writer.getReader() to obtain an up-to-date reader
> =A0b. create an IndexSearcher with that reader
> =A0c. perform Query
> =A0d. close IndexSearcher
> 5. on application close
> =A0a. close writer
> =A0b. close directory
>
> While this seems to be ok, I'm really wondering about the performance of
> opening a searcher for each request. I could introduce some kind of delay
> and cache a searcher for some seconds, but I'm not sure it's the best thi=
ng
> to do.
>
> Thanks,
>
> Cedric
>
>
> --
> View this message in context: http://www.nabble.com/Realtime-search-best-=
practices-tp25852756p25852756.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42786-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 19:17:55 2009
Return-Path: <java-user-return-42786-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30695 invoked from network); 12 Oct 2009 19:17:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 19:17:55 -0000
Received: (qmail 36893 invoked by uid 500); 12 Oct 2009 19:17:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36826 invoked by uid 500); 12 Oct 2009 19:17:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36816 invoked by uid 99); 12 Oct 2009 19:17:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:17:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:17:41 +0000
Received: by ywh14 with SMTP id 14so690880ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 12:17:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=I5qvAGdG1CRThbkCYDbcUe8nvHklHC0OktrZ/cMOjbw=;
        b=IoDN3gJ4IpaEUy+1tegLs+GofAddvDE/blohrcfhSQoou5owQC5NI2p9EN0WroXNZy
         BHfwDjz1Y0hR6RCEMYTNnV2/lf6e8chKEVayjpJTqx0P9giTgQ9wXRNr5SjJK7tkPcQQ
         7pSmNQrfLYWPDgOrALrLWBbD8Agx1fVO/Z+7Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=gsetUBe/aI5EEDzN6a+t0fkAm4nVgdZldhTQKfXd6U2Qu6C/Ctb+Vq1HFbEcOIbMK1
         duw+dsqeneBP2Mu2Wd4pGmrkkoVJNpsmG4zw01iUds0WBGOLYYWZgSz3mOh7p3MxvX1n
         KI1XcB/i8ki4oyy6SIyFudSm15n2oRA0ecgy4=
MIME-Version: 1.0
Received: by 10.90.42.9 with SMTP id p9mr3819167agp.4.1255375040698; Mon, 12 
	Oct 2009 12:17:20 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
Date: Mon, 12 Oct 2009 12:17:20 -0700
Message-ID: <4b124c310910121217j351f7f93j82688e27a16488ad@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163628391c5c5a110475c1c7d9
X-Virus-Checked: Checked by ClamAV on apache.org

--00163628391c5c5a110475c1c7d9
Content-Type: text/plain; charset=ISO-8859-1

Wait, so according to the javadocs, the IndexReader which you got from
the IndexWriter forwards calls to reopen() back to IndexWriter.getReader(),
which means that if the user has a NRT reader, and the user keeps calling
reopen() on it, they're getting uncommitted changes as well, while if they
call reopen() on a regular IndexReader, they do not?

How does this play nicely with the transactional semantics given by
commit()?

On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Just to clarify: IndexWriter.newReader returns a reader that searches
> uncommitted changes as well.  Ie, you need not call IndexWriter.commit
> to make the changes visible.
>
> However, if you're opening a reader the "normal" way
> (IndexReader.open) then it is necessary to first call
> IndexWriter.commit.
>
> Mike
>
> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
> wrote:
> >
> > Hi,
> >
> > I'm going to replace an old reader/writer synchronization mechanism we
> had
> > implemented with the new near realtime search facilities in Lucene 2.9.
> > However, it's still a bit unclear on how to efficiently do it.
> >
> > Is the following implementation the good way to do achieve it ? The
> context
> > is concurrent read/writes on an index :
> >
> > 1. create a Directory instance
> > 2. create a writer on this directory
> > 3. on each write request, add document to the writer
> > 4. on each read request,
> >  a. use writer.getReader() to obtain an up-to-date reader
> >  b. create an IndexSearcher with that reader
> >  c. perform Query
> >  d. close IndexSearcher
> > 5. on application close
> >  a. close writer
> >  b. close directory
> >
> > While this seems to be ok, I'm really wondering about the performance of
> > opening a searcher for each request. I could introduce some kind of delay
> > and cache a searcher for some seconds, but I'm not sure it's the best
> thing
> > to do.
> >
> > Thanks,
> >
> > Cedric
> >
> >
> > --
> > View this message in context:
> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00163628391c5c5a110475c1c7d9--

From java-user-return-42787-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 19:26:45 2009
Return-Path: <java-user-return-42787-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34274 invoked from network); 12 Oct 2009 19:26:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 19:26:45 -0000
Received: (qmail 46752 invoked by uid 500); 12 Oct 2009 19:26:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46642 invoked by uid 500); 12 Oct 2009 19:26:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46632 invoked by uid 99); 12 Oct 2009 19:26:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:26:41 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:26:32 +0000
Received: by gxk26 with SMTP id 26so2927150gxk.11
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 12:26:10 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.103.8 with SMTP id a8mr10811366ybc.181.1255375570387; Mon, 
	12 Oct 2009 12:26:10 -0700 (PDT)
In-Reply-To: <4b124c310910121217j351f7f93j82688e27a16488ad@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <4b124c310910121217j351f7f93j82688e27a16488ad@mail.gmail.com>
Date: Mon, 12 Oct 2009 15:26:10 -0400
Message-ID: <9ac0c6aa0910121226j12a50bb2x8049788b7bed2225@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On Mon, Oct 12, 2009 at 3:17 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

> Wait, so according to the javadocs, the IndexReader which you got from
> the IndexWriter forwards calls to reopen() back to IndexWriter.getReader(),
> which means that if the user has a NRT reader, and the user keeps calling
> reopen() on it, they're getting uncommitted changes as well, while if they
> call reopen() on a regular IndexReader, they do not?

That's right.

> How does this play nicely with the transactional semantics given by
> commit()?

The transactional semantics are still intact... it's just that an NRT
reader sees the uncommitted changes, ie, all changes done since the
last commit.

If disaster strikes (machine/os/jvm crashes, power loss, kill -9,
etc.) then on reboot/restart your index will still only show the last
successfull commit.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42788-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 19:31:15 2009
Return-Path: <java-user-return-42788-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34819 invoked from network); 12 Oct 2009 19:31:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 19:31:14 -0000
Received: (qmail 50635 invoked by uid 500); 12 Oct 2009 19:31:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50565 invoked by uid 500); 12 Oct 2009 19:31:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50555 invoked by uid 99); 12 Oct 2009 19:31:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:31:12 +0000
X-ASF-Spam-Status: No, hits=-1.7 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of christoph.boosz@googlemail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:31:10 +0000
Received: by ewy26 with SMTP id 26so9755088ewy.5
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 12:30:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=VAsF8Lsz44gowIVpSvA/n7D4X0EeaeZ0UUWr1ZzwqtE=;
        b=T3+kiPyIcc6x6aPdsDSQf5q8O4/Uail2FhXgt5RYN6k7StDCs93N4A+WgoebFdptso
         HgaydXD5qFhBpgBKyF2ewt60p+bfufO0K4h7QxpWhOONSWt2AviW0nDb3fjHU843F5bj
         uDP55Mp3ZKSwLMqIjiazt0JaCGIiTYehe3jmM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ihLD99+X5BHJtu142Gz1bK+kD4OxE0ckNOSRzK88F76Pwfm2g7WSvtcoXHMV3lPoWP
         lNnJ+VtLgD0nL9g+KZ3EXYXFiqAmMPOvMRZhDOGoU4A3mKqeF72MnXKnwaodaknA45Wj
         +I/rW8XlzuZN1lB3gtOgHFz3MfwRKg74+77dY=
MIME-Version: 1.0
Received: by 10.216.93.17 with SMTP id k17mr2041875wef.31.1255375848400; Mon, 
	12 Oct 2009 12:30:48 -0700 (PDT)
In-Reply-To: <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <200910121745.12793.paul.elschot@xs4all.nl>
	 <8837fb770910120932r21555aa0t59e9b36db5663f70@mail.gmail.com>
	 <8669da1e0910121030w5ad239d9u52b447ff89b4f87@mail.gmail.com>
	 <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com>
Date: Mon, 12 Oct 2009 21:30:48 +0200
Message-ID: <8669da1e0910121230s1a0770dfwdafae04006ef637d@mail.gmail.com>
Subject: Re: faceted search performance
From: Christoph Boosz <christoph.boosz@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d7e33a80e72b0475c1f7c5

--0016e6d7e33a80e72b0475c1f7c5
Content-Type: text/plain; charset=ISO-8859-1

Hi Jake,

Thanks for your helpful explanation.
In fact, my initial solution was to traverse each document in the result
once and count the contained terms. As you mentioned, this process took a
lot of memory.
Trying to confine the memory usage with the facet approach, I was surprised
by the decline in performance.
Now I know it's nothing abnormal, at least.

Chris


2009/10/12 Jake Mannix <jake.mannix@gmail.com>

> Hey Chris,
>
> On Mon, Oct 12, 2009 at 10:30 AM, Christoph Boosz <
> christoph.boosz@googlemail.com> wrote:
>
> > Thanks for your reply.
> > Yes, it's likely that many terms occur in few documents.
> >
> > If I understand you right, I should do the following:
> > -Write a HitCollector that simply increments a counter
> > -Get the filter for the user query once: new CachingWrapperFilter(new
> > QueryWrapperFilter(userQuery));
> > -Create a TermQuery for each term
> > -Perform the search and read the counter of the HitCollector
> >
> > I did that, but it didn't get faster. Any ideas why?
> >
>
> This killer is the "TermQuery for each term" part - this is huge. You need
> to invert this process,
> and use your query as is, but while walking in the HitCollector, on each
> doc
> which matches
> your query, increment counters for each of the terms in that document
> (which
> means you need
> an in-memory forward lookup for your documents, like a multivalued
> FieldCache - and if you've
> got roughly the same number of terms as documents, this cache is likely to
> be as large as
> your entire index - a pretty hefty RAM cost).
>
> But a good thing to keep in mind is that doing this kind of faceting
> (massively multivalued
> on a huge term-set) requires a lot of computation, even if you have all the
> proper structures
> living in memory:
>
> For each document you look at (which matches your query), you need to look
> at all
> of the terms in that document, and increment a counter for that term.  So
> however much
> time it would normally take for you to do the driving query, it can take as
> much as that
> multiplied by the average number of terms in a document in your index.  If
> your documents
> are big, this could be a pretty huge latency penalty.
>
>  -jake
>

--0016e6d7e33a80e72b0475c1f7c5--

From java-user-return-42789-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 19:39:23 2009
Return-Path: <java-user-return-42789-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36469 invoked from network); 12 Oct 2009 19:39:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 19:39:23 -0000
Received: (qmail 58743 invoked by uid 500); 12 Oct 2009 19:39:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58675 invoked by uid 500); 12 Oct 2009 19:39:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58665 invoked by uid 99); 12 Oct 2009 19:39:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:39:20 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 19:39:17 +0000
Received: by yxe3 with SMTP id 3so3564694yxe.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 12:38:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=jGHIV2z1BxVtCCXkMSOckvrfy9qR+UjleEd/m8mgRkI=;
        b=oN8Ev8fEic9C36PwLFLteK46vgjEikAE+FNENGVjjqE4oDI9bU0PWOtwtR4msC22WP
         B4g8MYaemAZfW9F6tuGySalleMUw9Ttv/lp4RW5l91BHzAZb2+HytzKyTljn3cfzBtcu
         Y/227aoC9pqpY+KlxdFHKvpGpe3zm8Dxyc5wU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=oG/TTeSY5bya9YNviCK4VQs859s053IJZjUMOb/FNcTMnZdeUIeX+z+gjFO6ZkoEsp
         zv5WAWKxZqWLC/dlvDNe+y90zsxEaZUMgQrbB4isvXWaFsfv6P9UaFRvgT8ZwM8Fn3ub
         WPyZqztSJJkuDM6FSNPDEQIiPIITCv112fDyg=
MIME-Version: 1.0
Received: by 10.91.27.6 with SMTP id e6mr3850079agj.27.1255376337098; Mon, 12 
	Oct 2009 12:38:57 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910121226j12a50bb2x8049788b7bed2225@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <4b124c310910121217j351f7f93j82688e27a16488ad@mail.gmail.com>
	 <9ac0c6aa0910121226j12a50bb2x8049788b7bed2225@mail.gmail.com>
Date: Mon, 12 Oct 2009 12:38:57 -0700
Message-ID: <4b124c310910121238t4e27403nd5236224b13bd663@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f912a8a1d7750475c21438

--001485f912a8a1d7750475c21438
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Oct 12, 2009 at 12:26 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> On Mon, Oct 12, 2009 at 3:17 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
>
> > Wait, so according to the javadocs, the IndexReader which you got from
> > the IndexWriter forwards calls to reopen() back to
> IndexWriter.getReader(),
> > which means that if the user has a NRT reader, and the user keeps calling
> > reopen() on it, they're getting uncommitted changes as well, while if
> they
> > call reopen() on a regular IndexReader, they do not?
>
> That's right.
>

So maybe since it's an "expert" feature, this is ok, but if users are used
to using
isCurrent() on their reader instances, this seems like it might get
confusing, since
now some readers are even more current than current, and in fact the NRT
readers may be current w.r.t. the most recent commit, but calling reopen()
on
them will actually still make them more current, in that they now get a view
on even more recent uncommitted changes...

  -jake

--001485f912a8a1d7750475c21438--

From java-user-return-42790-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:02:08 2009
Return-Path: <java-user-return-42790-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42563 invoked from network); 12 Oct 2009 20:02:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:02:07 -0000
Received: (qmail 80937 invoked by uid 500); 12 Oct 2009 20:02:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80815 invoked by uid 500); 12 Oct 2009 20:02:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80798 invoked by uid 99); 12 Oct 2009 20:02:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:02:04 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bradfordstephens@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:01:54 +0000
Received: by ywh14 with SMTP id 14so718818ywh.20
        for <multiple recipients>; Mon, 12 Oct 2009 13:01:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type
         :content-transfer-encoding;
        bh=wpDdy9IK9QCCYQazIYsGPsrpmwaE+XJuElTlOhV0WA4=;
        b=NknpWiLjyMSj39wfVEmnWJccuhXSCo+vXN8y7Eg/KD/5jCDgLotneLgf1B7AfEttP9
         xJZSSnVUZPt/NQOmZT6GNBRs7AGa99JTBdVlyYToNu18oAdJVG68rYpk5sNHZ9xoKBe0
         fbNC2Tlz1/6tibvH4julGqAer7mdzn0r4YCjA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type:content-transfer-encoding;
        b=UZZM14cBSU5PvXFb1jn1X/h1hgSW9nXerzMk6xh4Dihb756+3oQ2xzNZfY5olf9EFC
         uCvJqGT4ZsakZElBuUA7pT5L/GXzF2e04MgY2JyKKD61rtWuMfRiIS9r2mBI39OeNiMI
         /+dR5SfcYg1kjXfOdBjHoiF32yLNzMzjoPWM4=
MIME-Version: 1.0
Received: by 10.90.62.4 with SMTP id k4mr1844357aga.56.1255377693959; Mon, 12 
	Oct 2009 13:01:33 -0700 (PDT)
In-Reply-To: <8837fb770910112219s63d1ab57w41d8b2582d36c44e@mail.gmail.com>
References: <8837fb770910112219s63d1ab57w41d8b2582d36c44e@mail.gmail.com>
Date: Mon, 12 Oct 2009 13:01:33 -0700
Message-ID: <860544ed0910121301n17993d00p8f633edda8b4178d@mail.gmail.com>
Subject: Re: new sorting api and some perf numbers
From: Bradford Stephens <bradfordstephens@gmail.com>
To: java-user@lucene.apache.org
Cc: java-dev@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Wow! This is awesome. Can't wait to see how it plays with Bobo :)

On Sun, Oct 11, 2009 at 10:19 PM, John Wang <john.wang@gmail.com> wrote:
> Hi guys:
> =A0 =A0The new FieldComparator api looks really scary :)
>
> =A0 =A0But after some perf testing with numbers I'd like to share, I gues=
s it
> is worth it:
>
> HW: Mac Pro with 16G memory
> jvm: 1.6.0_13"
> jvm arg: -Xms1g -Xmx1g -server
>
> setup
>
> index:
> 1M docs even split into 8 segments (to make sure the test is fair across
> segment boundaries)
> each doc has 3 fields:
> 1) id - stored
> 2) val - random number, indexed, not analyzed, no norms, omit tf
> 3) string - "even" or "odd" of the corresponding id, not analyzed, no nor=
ms,
> omit tf
>
> built with lucene 2.4.1 to keep the same index across lucene 2.4.1 and
> lucene 2.9.0 search tests
>
> Search:
> query on the term: "even" (TermQuery, minimizes the overhead of the text
> search), matches 500k docs, and across segment boundary, sort by val, sor=
t
> type: string. Numhits, e.g. number of slots =3D 100.
>
> ran 20 iterations of the same query for each test.
>
> First query, includes loading
>
> lucene 2.4.1: 4858ms, lucene 2.9.0: 816ms, gain of 595%
>
> avg of the rest 19 queries:
>
> lucene 2.4.1: 32ms, lucene 2.9.0: 17ms , gain of 188%
>
> I ran this test about 5 times, the findings are similar.
>
> The performance gain is significant!
>
> Great job!
>
> -John
>



--=20
http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
and Distributed Lucene Consulting

http://www.roadtofailure.com -- The Fringes of Scalability, Social
Media, and Computer Science

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42791-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:07:02 2009
Return-Path: <java-user-return-42791-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44429 invoked from network); 12 Oct 2009 20:07:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:07:02 -0000
Received: (qmail 87019 invoked by uid 500); 12 Oct 2009 20:07:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86951 invoked by uid 500); 12 Oct 2009 20:07:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86941 invoked by uid 99); 12 Oct 2009 20:07:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:07:00 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:06:57 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 12 Oct 2009 13:06:21 -0700
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----_=_NextPart_001_01CA4B77.5F89F7F4"
Subject: querying multi-value fields
Date: Mon, 12 Oct 2009 13:05:41 -0700
Message-ID: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: querying multi-value fields
Thread-Index: AcpLd2AVx9OhobatS/WfxnkmmnIigA==
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>

------_=_NextPart_001_01CA4B77.5F89F7F4
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

I have documents that store multiple values in some fields (using the
document.add(new Field()) with the same field name).  Here's what a
typical document looks like:

=20

doc.option=3D"value1 aaa"

doc.option=3D"value2 bbb"

doc.option=3D"value3 ccc"

=20

I want my queries to only match individual values, for example, a query
for "value2 bbb" would return the above document, but a query for
"value1 ccc" should not.  Is this at all possible in lucene at query
time?  Could payloads be used for this?


------_=_NextPart_001_01CA4B77.5F89F7F4--

From java-user-return-42792-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:18:41 2009
Return-Path: <java-user-return-42792-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48975 invoked from network); 12 Oct 2009 20:18:41 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:18:41 -0000
Received: (qmail 3092 invoked by uid 500); 12 Oct 2009 20:18:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2949 invoked by uid 500); 12 Oct 2009 20:18:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2934 invoked by uid 99); 12 Oct 2009 20:18:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:18:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of john.wang@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:18:27 +0000
Received: by ywh14 with SMTP id 14so729512ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:18:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=Fk0wNtXhXarSlXcO3Nhkft++1V8DPa1AEhwXzVGDSyM=;
        b=Hfb9+9WmVITndrs5/a1AADWmD+LnzW79D02VU3i6PTnK76CMRBO9wiAykqZufLk961
         ShucbagHVBeGJ1p2hwa2Kq7X/zNQnxNbQZF2fTKpslyopzFvOJ2YTwuaKfaMuL7xuNmc
         6J5jlTkYzEu12iv0zmdFTwBAPtyyYZDCI/6G4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=C9TioysYKpB3HXi3hY/sKQX5J+qJgoqlFXHOMz/lCwyoqQ/UljF3nAx4zzTjnYKRos
         fNbMEIGazsvYcVmgigoTVJUSCFP9xrSbaZ/qSkOOu1qGS5r8QR/jYzy/ZqPOVXyl5mdx
         k1wnVM1cRH8g+EGwWd0Kqujk55hzcKn6R+mUI=
MIME-Version: 1.0
Received: by 10.100.62.1 with SMTP id k1mr5971536ana.106.1255378686859; Mon, 
	12 Oct 2009 13:18:06 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
Date: Mon, 12 Oct 2009 13:18:06 -0700
Message-ID: <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
Subject: Re: Realtime search best practices
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00c09f8fe6beb05fef0475c2a0e3
X-Virus-Checked: Checked by ClamAV on apache.org

--00c09f8fe6beb05fef0475c2a0e3
Content-Type: text/plain; charset=ISO-8859-1

Oh, that is really good to know!
Is this deterministic? e.g. as long as writer.addDocument() is called, next
getReader reflects the change? Does it work with deletes? e.g.
writer.deleteDocuments()?
Thanks Mike for clarifying!

-John

On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Just to clarify: IndexWriter.newReader returns a reader that searches
> uncommitted changes as well.  Ie, you need not call IndexWriter.commit
> to make the changes visible.
>
> However, if you're opening a reader the "normal" way
> (IndexReader.open) then it is necessary to first call
> IndexWriter.commit.
>
> Mike
>
> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
> wrote:
> >
> > Hi,
> >
> > I'm going to replace an old reader/writer synchronization mechanism we
> had
> > implemented with the new near realtime search facilities in Lucene 2.9.
> > However, it's still a bit unclear on how to efficiently do it.
> >
> > Is the following implementation the good way to do achieve it ? The
> context
> > is concurrent read/writes on an index :
> >
> > 1. create a Directory instance
> > 2. create a writer on this directory
> > 3. on each write request, add document to the writer
> > 4. on each read request,
> >  a. use writer.getReader() to obtain an up-to-date reader
> >  b. create an IndexSearcher with that reader
> >  c. perform Query
> >  d. close IndexSearcher
> > 5. on application close
> >  a. close writer
> >  b. close directory
> >
> > While this seems to be ok, I'm really wondering about the performance of
> > opening a searcher for each request. I could introduce some kind of delay
> > and cache a searcher for some seconds, but I'm not sure it's the best
> thing
> > to do.
> >
> > Thanks,
> >
> > Cedric
> >
> >
> > --
> > View this message in context:
> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00c09f8fe6beb05fef0475c2a0e3--

From java-user-return-42793-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:21:47 2009
Return-Path: <java-user-return-42793-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49989 invoked from network); 12 Oct 2009 20:21:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:21:47 -0000
Received: (qmail 6717 invoked by uid 500); 12 Oct 2009 20:21:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6648 invoked by uid 500); 12 Oct 2009 20:21:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6637 invoked by uid 99); 12 Oct 2009 20:21:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:21:44 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of adrianocrestani@gmail.com designates 74.125.92.25 as permitted sender)
Received: from [74.125.92.25] (HELO qw-out-2122.google.com) (74.125.92.25)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:21:42 +0000
Received: by qw-out-2122.google.com with SMTP id 5so1203534qwd.53
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:21:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=Q3swgGHGx5+LEGmw7UP77lLLowmUfNUxkxhjIroa2C0=;
        b=rWUbRHA+Zg5KpOAd3932AXEbMKBRgWxxqjqFBKNKXdAvtmtg8d3chNjqk6Xq3K3soT
         wbpBPVz5UYMF9K1TpYDC33kaUYJ+5z+YMbMK4vreYvzNJFG9bknTfd7ghcN4rbA1HQDX
         utBQIwtvzzONHm15ETdO0v+6dCuR9MjxfHv/k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=XDljCGUua9tjkQTIle6YqPN9QoOeoMZ0vrLGBjqYVdRDWsroE6fXWh5+x2Vpuxxb5Z
         LiMlOIwFG47kPUwbLuTAHtQRmzbs4MUhMT6ciFIJWXUs8AepXjrwjqPuMViCamOq/awv
         /YUI7+LrDjFtL+ACyhTQ+C/9hbIU4gQT3MEhg=
MIME-Version: 1.0
Received: by 10.229.92.199 with SMTP id s7mr2451003qcm.23.1255378881233; Mon, 
	12 Oct 2009 13:21:21 -0700 (PDT)
In-Reply-To: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com>
References: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com>
From: Adriano Crestani <adrianocrestani@gmail.com>
Date: Mon, 12 Oct 2009 16:21:01 -0400
Message-ID: <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com>
Subject: Re: querying multi-value fields
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd6a7ba46426e0475c2ac33

--000e0cd6a7ba46426e0475c2ac33
Content-Type: text/plain; charset=ISO-8859-1

Hi Eric,

To achieve what you want, do not tokenize the values you query/add to this
field.

On Mon, Oct 12, 2009 at 4:05 PM, Angel, Eric <eangel@business.com> wrote:

> I have documents that store multiple values in some fields (using the
> document.add(new Field()) with the same field name).  Here's what a
> typical document looks like:
>
>
>
> doc.option="value1 aaa"
>
> doc.option="value2 bbb"
>
> doc.option="value3 ccc"
>
>
>
> I want my queries to only match individual values, for example, a query
> for "value2 bbb" would return the above document, but a query for
> "value1 ccc" should not.  Is this at all possible in lucene at query
> time?  Could payloads be used for this?
>
>

--000e0cd6a7ba46426e0475c2ac33--

From java-user-return-42794-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:25:32 2009
Return-Path: <java-user-return-42794-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50908 invoked from network); 12 Oct 2009 20:25:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:25:32 -0000
Received: (qmail 10757 invoked by uid 500); 12 Oct 2009 20:25:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10683 invoked by uid 500); 12 Oct 2009 20:25:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10673 invoked by uid 99); 12 Oct 2009 20:25:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:25:30 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:25:27 +0000
Received: by gxk26 with SMTP id 26so2967306gxk.11
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:25:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=VEvtrq8ggpS6CChu+JluLvEzJCW5S5xNwYAodpOkJnE=;
        b=Qr6x4jgNFDY0BuJ7FaeAAcJ6LWBcAfEDOKWiwmrY9jLmbeAN599dVo5OPu1BLJbQ2B
         G1O2fHTjSQcJEVbioakebuZ5G2nEVGTaWK1T85WWc0phThKPJXhZDYu5d8i8uk2t1qYv
         gpwLBDIxggwKjHBJNCgHY2xxzhjepx2ZglLVY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Ubu6UKlhe1GExSzBsF8XVRqCR/MCpmwMq+LZHa/jXZqAMAFWKub8Sa8UGahv/y4FKk
         3RYPKc2mCzY5dlgNG4uDh8IG8RqZPVpPpEDGqk7NjwWL9urU0IaN8c+Ts7G9KTo8OqFf
         ej96su8r225dvpyokYCVT6JqIPevUFvZ/o6J4=
MIME-Version: 1.0
Received: by 10.90.37.8 with SMTP id k8mr3825978agk.19.1255379106736; Mon, 12 
	Oct 2009 13:25:06 -0700 (PDT)
In-Reply-To: <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com>
References: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com>
	 <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com>
Date: Mon, 12 Oct 2009 13:25:06 -0700
Message-ID: <4b124c310910121325n479d6e94vfc933a4a296ff567@mail.gmail.com>
Subject: Re: querying multi-value fields
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636164493b72b520475c2b91d

--001636164493b72b520475c2b91d
Content-Type: text/plain; charset=ISO-8859-1

Or else just make sure that you use PhraseQuery to hit this field when you
want "value1 aaa".  If you don't tokenize these pairs, then you will have to

do prefix/wildcard matching to hit just "value1" by itself (if this is
allowed
by your business logic).

  -jake

On Mon, Oct 12, 2009 at 1:21 PM, Adriano Crestani <adrianocrestani@gmail.com
> wrote:

> Hi Eric,
>
> To achieve what you want, do not tokenize the values you query/add to this
> field.
>
> On Mon, Oct 12, 2009 at 4:05 PM, Angel, Eric <eangel@business.com> wrote:
>
> > I have documents that store multiple values in some fields (using the
> > document.add(new Field()) with the same field name).  Here's what a
> > typical document looks like:
> >
> >
> >
> > doc.option="value1 aaa"
> >
> > doc.option="value2 bbb"
> >
> > doc.option="value3 ccc"
> >
> >
> >
> > I want my queries to only match individual values, for example, a query
> > for "value2 bbb" would return the above document, but a query for
> > "value1 ccc" should not.  Is this at all possible in lucene at query
> > time?  Could payloads be used for this?
> >
> >
>

--001636164493b72b520475c2b91d--

From java-user-return-42795-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:26:42 2009
Return-Path: <java-user-return-42795-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51085 invoked from network); 12 Oct 2009 20:26:42 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:26:42 -0000
Received: (qmail 14221 invoked by uid 500); 12 Oct 2009 20:26:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14141 invoked by uid 500); 12 Oct 2009 20:26:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14131 invoked by uid 99); 12 Oct 2009 20:26:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:26:40 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:26:29 +0000
Received: by ewy26 with SMTP id 26so9798313ewy.5
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:26:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=JxmpjRspF1W1eY9vmmVtM8GmAy1x5S+L5J99n6pegEo=;
        b=THxjWyRdLreK55hw58tCdp3GBacnt9hn/4zDHd92yUre0x2OiU4vMqoCVgAFRXR5fO
         4R+dPkIdEWurakbIh0nTK9TsN6wvl/ZZPDwBmjyUtOZqHkYzHqw9rZQDRUWrjK6q2AQm
         +L8EbnSL7+4dsr8+krTjNKGmmiPsjdUJJOz9I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=PiBuJ6ERQQMEDbKOG1Qn0j7JdxLq+HOcgQdaULL5552drbfY95PVpDSZop78DNyCKJ
         R1S0xJDxCDB3xAqEDyEMYRC/2a/W/xxY+EF1wuG7a9vgL3Yh1lmnsDo+xrPLeq07ARNb
         HLx8GF2PB65nhk3PXStGk1b07+W8myP/wQEt0=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.87.81 with SMTP id x59mr2042845wee.147.1255379169263; Mon, 
	12 Oct 2009 13:26:09 -0700 (PDT)
In-Reply-To: <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
Date: Mon, 12 Oct 2009 16:26:09 -0400
X-Google-Sender-Auth: 8e918f6e190f0bd0
Message-ID: <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Guys, please - you're not new at this... this is what JavaDoc is for:

  /**
   * Returns a readonly reader containing all
   * current updates.  Flush is called automatically.  This
   * provides "near real-time" searching, in that changes
   * made during an IndexWriter session can be made
   * available for searching without closing the writer.
   *
   * <p>It's near real-time because there is no hard
   * guarantee on how quickly you can get a new reader after
   * making changes with IndexWriter.  You'll have to
   * experiment in your situation to determine if it's
   * fast enough.  As this is a new and experimental
   * feature, please report back on your findings so we can
   * learn, improve and iterate.</p>
   *
   * <p>The resulting reader supports {@link
   * IndexReader#reopen}, but that call will simply forward
   * back to this method (though this may change in the
   * future).</p>
   *
   * <p>The very first time this method is called, this
   * writer instance will make every effort to pool the
   * readers that it opens for doing merges, applying
   * deletes, etc.  This means additional resources (RAM,
   * file descriptors, CPU time) will be consumed.</p>
   *
   * <p>For lower latency on reopening a reader, you should
   * call {@link #setMergedSegmentWarmer} to
   * pre-warm a newly merged segment before it's committed
   * to the index.  This is important for minimizing
   * index-to-search delay after a large merge.  </p>
   *
   * <p>If an addIndexes* call is running in another thread,
   * then this reader will only search those segments from
   * the foreign index that have been successfully copied
   * over, so far</p>.
   *
   * <p><b>NOTE</b>: Once the writer is closed, any
   * outstanding readers may continue to be used.  However,
   * if you attempt to reopen any of those readers, you'll
   * hit an {@link AlreadyClosedException}.</p>
   *
   * <p><b>NOTE:</b> This API is experimental and might
   * change in incompatible ways in the next release.</p>
   *
   * @return IndexReader that covers entire index plus all
   * changes made so far by this IndexWriter instance
   *
   * @throws IOException
   */
  public IndexReader getReader() throws IOException {


-Yonik
http://www.lucidimagination.com


On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrote:
> Oh, that is really good to know!
> Is this deterministic? e.g. as long as writer.addDocument() is called, ne=
xt
> getReader reflects the change? Does it work with deletes? e.g.
> writer.deleteDocuments()?
> Thanks Mike for clarifying!
>
> -John
>
> On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> Just to clarify: IndexWriter.newReader returns a reader that searches
>> uncommitted changes as well. =A0Ie, you need not call IndexWriter.commit
>> to make the changes visible.
>>
>> However, if you're opening a reader the "normal" way
>> (IndexReader.open) then it is necessary to first call
>> IndexWriter.commit.
>>
>> Mike
>>
>> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
>> wrote:
>> >
>> > Hi,
>> >
>> > I'm going to replace an old reader/writer synchronization mechanism we
>> had
>> > implemented with the new near realtime search facilities in Lucene 2.9=
.
>> > However, it's still a bit unclear on how to efficiently do it.
>> >
>> > Is the following implementation the good way to do achieve it ? The
>> context
>> > is concurrent read/writes on an index :
>> >
>> > 1. create a Directory instance
>> > 2. create a writer on this directory
>> > 3. on each write request, add document to the writer
>> > 4. on each read request,
>> > =A0a. use writer.getReader() to obtain an up-to-date reader
>> > =A0b. create an IndexSearcher with that reader
>> > =A0c. perform Query
>> > =A0d. close IndexSearcher
>> > 5. on application close
>> > =A0a. close writer
>> > =A0b. close directory
>> >
>> > While this seems to be ok, I'm really wondering about the performance =
of
>> > opening a searcher for each request. I could introduce some kind of de=
lay
>> > and cache a searcher for some seconds, but I'm not sure it's the best
>> thing
>> > to do.
>> >
>> > Thanks,
>> >
>> > Cedric
>> >
>> >
>> > --
>> > View this message in context:
>> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756=
.html
>> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>> >
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42796-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:32:30 2009
Return-Path: <java-user-return-42796-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53776 invoked from network); 12 Oct 2009 20:32:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:32:30 -0000
Received: (qmail 22644 invoked by uid 500); 12 Oct 2009 20:32:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22577 invoked by uid 500); 12 Oct 2009 20:32:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22567 invoked by uid 99); 12 Oct 2009 20:32:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:32:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:32:17 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 12 Oct 2009 13:31:50 -0700
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: querying multi-value fields
Date: Mon, 12 Oct 2009 13:31:24 -0700
Message-ID: <DEC11051901DCC43BD47EC508118AD86089AC21C@exchg04.corp.business.com>
In-Reply-To: <4b124c310910121325n479d6e94vfc933a4a296ff567@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: querying multi-value fields
Thread-Index: AcpLeiVG7mtt4Hu3Q4yQpeoKLcae5QAADXqA
References: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com> <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com> <4b124c310910121325n479d6e94vfc933a4a296ff567@mail.gmail.com>
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>
X-Virus-Checked: Checked by ClamAV on apache.org

I need to analyze these values since I also want the benefits
porterStemmer.  The problem with using PhraseQuery is that I don't
always know the slop.  I may have values like "value4 ddd aaa".  It's a
tricky problem because I think Lucene sees all these values as one long
value for the field "option".

-----Original Message-----
From: Jake Mannix [mailto:jake.mannix@gmail.com]=20
Sent: Monday, October 12, 2009 1:25 PM
To: java-user@lucene.apache.org
Subject: Re: querying multi-value fields

Or else just make sure that you use PhraseQuery to hit this field when
you
want "value1 aaa".  If you don't tokenize these pairs, then you will
have to

do prefix/wildcard matching to hit just "value1" by itself (if this is
allowed
by your business logic).

  -jake

On Mon, Oct 12, 2009 at 1:21 PM, Adriano Crestani
<adrianocrestani@gmail.com
> wrote:

> Hi Eric,
>
> To achieve what you want, do not tokenize the values you query/add to
this
> field.
>
> On Mon, Oct 12, 2009 at 4:05 PM, Angel, Eric <eangel@business.com>
wrote:
>
> > I have documents that store multiple values in some fields (using
the
> > document.add(new Field()) with the same field name).  Here's what a
> > typical document looks like:
> >
> >
> >
> > doc.option=3D"value1 aaa"
> >
> > doc.option=3D"value2 bbb"
> >
> > doc.option=3D"value3 ccc"
> >
> >
> >
> > I want my queries to only match individual values, for example, a
query
> > for "value2 bbb" would return the above document, but a query for
> > "value1 ccc" should not.  Is this at all possible in lucene at query
> > time?  Could payloads be used for this?
> >
> >
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42797-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:36:33 2009
Return-Path: <java-user-return-42797-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54917 invoked from network); 12 Oct 2009 20:36:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:36:33 -0000
Received: (qmail 28823 invoked by uid 500); 12 Oct 2009 20:36:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28722 invoked by uid 500); 12 Oct 2009 20:36:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28712 invoked by uid 99); 12 Oct 2009 20:36:31 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:36:31 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:36:20 +0000
Received: by yxe3 with SMTP id 3so3601812yxe.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:35:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=dYbL8Tb6Cybj5u/Zht9ypWZVqGjIyyN7Zpe8D5cbW4Q=;
        b=AczxBnZXcwXaOa0JyFkTpkdm06PLHPRscCtDySkII1jTuZU8IiWyY1h2FF9lbWmiSG
         sOLDy1GKaTh5YcfHVFwaUYrqf48u8DeEnse1B/JIqFcCVHYX6LiHa66AV++bGvoXE/TW
         /yNdAz1k5teCSJvUXakkW7TCxnbQfCv+f3b1s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=uozG5RuVMnbynPB1Z+mlh/ZKz8jmHPW4BqB5yEqxDgNfCh0qaywf8HZLBvBIZkLFMq
         RsIOFRawTBlg++nLP4Z3WcFdFZsRrIQJbYaybMg2Cn9Zsd5ztcxxiXzkjOwsZEu1gEEX
         Sg9uZzzlXmKZQgnJOKgqDYUg9c4OSNs2xD84Y=
MIME-Version: 1.0
Received: by 10.91.214.17 with SMTP id r17mr3876893agq.34.1255379758726; Mon, 
	12 Oct 2009 13:35:58 -0700 (PDT)
In-Reply-To: <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
Date: Mon, 12 Oct 2009 13:35:58 -0700
Message-ID: <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: multipart/alternative; boundary=0016364c6ccd93bd610475c2e011
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364c6ccd93bd610475c2e011
Content-Type: text/plain; charset=ISO-8859-1

Thanks Yonik,

  It may be surprising, but in fact I have read that
javadoc.  It talks about not needing to close the
writer, but doesn't specifically talk about the what
the relationship between commit() calls and
getReader() calls is.  I suppose I should have
interpreted:

"@returns a new reader which contains all
changes..."

to mean "all uncommitted changes", but why
is it so obvious that what could be happening
is that it only "returns all changes since the last
commit, but without touching disk because it
has docs in memory as well"?

  -jake

On Mon, Oct 12, 2009 at 1:26 PM, Yonik Seeley <yonik@lucidimagination.com>wrote:

> Guys, please - you're not new at this... this is what JavaDoc is for:
>
>  /**
>   * Returns a readonly reader containing all
>   * current updates.  Flush is called automatically.  This
>   * provides "near real-time" searching, in that changes
>   * made during an IndexWriter session can be made
>   * available for searching without closing the writer.
>   *
>   * <p>It's near real-time because there is no hard
>   * guarantee on how quickly you can get a new reader after
>   * making changes with IndexWriter.  You'll have to
>   * experiment in your situation to determine if it's
>   * fast enough.  As this is a new and experimental
>   * feature, please report back on your findings so we can
>   * learn, improve and iterate.</p>
>   *
>   * <p>The resulting reader supports {@link
>   * IndexReader#reopen}, but that call will simply forward
>   * back to this method (though this may change in the
>   * future).</p>
>   *
>   * <p>The very first time this method is called, this
>   * writer instance will make every effort to pool the
>   * readers that it opens for doing merges, applying
>   * deletes, etc.  This means additional resources (RAM,
>   * file descriptors, CPU time) will be consumed.</p>
>   *
>   * <p>For lower latency on reopening a reader, you should
>   * call {@link #setMergedSegmentWarmer} to
>   * pre-warm a newly merged segment before it's committed
>   * to the index.  This is important for minimizing
>   * index-to-search delay after a large merge.  </p>
>   *
>   * <p>If an addIndexes* call is running in another thread,
>   * then this reader will only search those segments from
>   * the foreign index that have been successfully copied
>   * over, so far</p>.
>   *
>   * <p><b>NOTE</b>: Once the writer is closed, any
>   * outstanding readers may continue to be used.  However,
>   * if you attempt to reopen any of those readers, you'll
>   * hit an {@link AlreadyClosedException}.</p>
>   *
>   * <p><b>NOTE:</b> This API is experimental and might
>   * change in incompatible ways in the next release.</p>
>   *
>   * @return IndexReader that covers entire index plus all
>   * changes made so far by this IndexWriter instance
>   *
>   * @throws IOException
>   */
>  public IndexReader getReader() throws IOException {
>
>
> -Yonik
> http://www.lucidimagination.com
>
>
> On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrote:
> > Oh, that is really good to know!
> > Is this deterministic? e.g. as long as writer.addDocument() is called,
> next
> > getReader reflects the change? Does it work with deletes? e.g.
> > writer.deleteDocuments()?
> > Thanks Mike for clarifying!
> >
> > -John
> >
> > On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> Just to clarify: IndexWriter.newReader returns a reader that searches
> >> uncommitted changes as well.  Ie, you need not call IndexWriter.commit
> >> to make the changes visible.
> >>
> >> However, if you're opening a reader the "normal" way
> >> (IndexReader.open) then it is necessary to first call
> >> IndexWriter.commit.
> >>
> >> Mike
> >>
> >> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
> >> wrote:
> >> >
> >> > Hi,
> >> >
> >> > I'm going to replace an old reader/writer synchronization mechanism we
> >> had
> >> > implemented with the new near realtime search facilities in Lucene
> 2.9.
> >> > However, it's still a bit unclear on how to efficiently do it.
> >> >
> >> > Is the following implementation the good way to do achieve it ? The
> >> context
> >> > is concurrent read/writes on an index :
> >> >
> >> > 1. create a Directory instance
> >> > 2. create a writer on this directory
> >> > 3. on each write request, add document to the writer
> >> > 4. on each read request,
> >> >  a. use writer.getReader() to obtain an up-to-date reader
> >> >  b. create an IndexSearcher with that reader
> >> >  c. perform Query
> >> >  d. close IndexSearcher
> >> > 5. on application close
> >> >  a. close writer
> >> >  b. close directory
> >> >
> >> > While this seems to be ok, I'm really wondering about the performance
> of
> >> > opening a searcher for each request. I could introduce some kind of
> delay
> >> > and cache a searcher for some seconds, but I'm not sure it's the best
> >> thing
> >> > to do.
> >> >
> >> > Thanks,
> >> >
> >> > Cedric
> >> >
> >> >
> >> > --
> >> > View this message in context:
> >>
> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
> >> > Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> >> >
> >> >
> >> > ---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364c6ccd93bd610475c2e011--

From java-user-return-42798-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:48:13 2009
Return-Path: <java-user-return-42798-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61789 invoked from network); 12 Oct 2009 20:48:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:48:13 -0000
Received: (qmail 47103 invoked by uid 500); 12 Oct 2009 20:48:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47012 invoked by uid 500); 12 Oct 2009 20:48:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47002 invoked by uid 99); 12 Oct 2009 20:48:10 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:48:10 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:48:01 +0000
Received: by iwn6 with SMTP id 6so5135008iwn.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:47:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=VyJCuhVKEv69m9OdrWEW4fxypO44zYJ2VTtiz94OLJE=;
        b=i3Riv3qPRa49YvJXGRe3tiA6VEMq5qGp4+Dp1smh8faW2Oc3jX8qUr5Kjo6y2Ax0IL
         Fse8xUU0mCfXDCUIVOx+pEvbTn8mqjeGfboxwjx31pNlMSGSvgnP264cO0tyJjZrb4o/
         ma1mXrUsGQLpGBmHwXl+BCuEAWqo0a5hDnuoE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VIqtmlmm4+Q9agT1lLm8peaOz5MjEuefLYZKotYel766mouPloPX1ANLZU53x1zKD7
         M5EUdvV3CQz1I6rylqZ9Xq7IHhpxU8NOWYWVU6nMzseKEkTBaPHYp/Sxol+gJCPG9wKD
         O5FcaAJFCosMkGekB/B4vqUwmDNiEOadfKmdw=
MIME-Version: 1.0
Received: by 10.231.124.166 with SMTP id u38mr7882826ibr.17.1255380460186; 
	Mon, 12 Oct 2009 13:47:40 -0700 (PDT)
In-Reply-To: <DEC11051901DCC43BD47EC508118AD86089AC21C@exchg04.corp.business.com>
References: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com>
	 <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com>
	 <4b124c310910121325n479d6e94vfc933a4a296ff567@mail.gmail.com>
	 <DEC11051901DCC43BD47EC508118AD86089AC21C@exchg04.corp.business.com>
Date: Mon, 12 Oct 2009 16:47:40 -0400
Message-ID: <359a92830910121347w6286f40dr9f0b6e4cd6cd800@mail.gmail.com>
Subject: Re: querying multi-value fields
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64b9c6e632cf00475c30aa8
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64b9c6e632cf00475c30aa8
Content-Type: text/plain; charset=ISO-8859-1

<<<I think Lucene sees all these values as one long
value for the field "option">>>
Not quite. Starting with the second add, a call will be made to
getPositionIncrementGap in your analyzer. If you return a number
larger than one, then the offsets between the last term of the preceeding
add and the first term of this add will be that number. If you do nothing
with getPositionIncrementGap, then Lucene does, indeed, see all
the terms as one long value since it returns 1.....

Here's an illusrtation in which PositionIncrementGap returns
an offset of 10 using your example adds.

Note, these numbers may be off by the infamous 1 or even 2.

term      offset
value1     0
aaa         1
value2     11
bbb         12
value3     22
ccc        23


So, you really don't care about the slop, since you can set it to less than
the
magic number you return from PositionIncrementGap. BTW, slop indicates
holes, not total terms. So with a slop of 0 all the words need to be next to
each other, regardless of whether there are two words or 20. But you still
have to do the trick with getPositionIncrementGap in order to fail to match
on something like "bbb value3", where the last term is next to the frist
term
of the next token......

HTH
Erick



On Mon, Oct 12, 2009 at 4:31 PM, Angel, Eric <eangel@business.com> wrote:

> I need to analyze these values since I also want the benefits
> porterStemmer.  The problem with using PhraseQuery is that I don't
> always know the slop.  I may have values like "value4 ddd aaa".  It's a
> tricky problem because I think Lucene sees all these values as one long
> value for the field "option".
>
> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Monday, October 12, 2009 1:25 PM
> To: java-user@lucene.apache.org
> Subject: Re: querying multi-value fields
>
> Or else just make sure that you use PhraseQuery to hit this field when
> you
> want "value1 aaa".  If you don't tokenize these pairs, then you will
> have to
>
> do prefix/wildcard matching to hit just "value1" by itself (if this is
> allowed
> by your business logic).
>
>  -jake
>
> On Mon, Oct 12, 2009 at 1:21 PM, Adriano Crestani
> <adrianocrestani@gmail.com
> > wrote:
>
> > Hi Eric,
> >
> > To achieve what you want, do not tokenize the values you query/add to
> this
> > field.
> >
> > On Mon, Oct 12, 2009 at 4:05 PM, Angel, Eric <eangel@business.com>
> wrote:
> >
> > > I have documents that store multiple values in some fields (using
> the
> > > document.add(new Field()) with the same field name).  Here's what a
> > > typical document looks like:
> > >
> > >
> > >
> > > doc.option="value1 aaa"
> > >
> > > doc.option="value2 bbb"
> > >
> > > doc.option="value3 ccc"
> > >
> > >
> > >
> > > I want my queries to only match individual values, for example, a
> query
> > > for "value2 bbb" would return the above document, but a query for
> > > "value1 ccc" should not.  Is this at all possible in lucene at query
> > > time?  Could payloads be used for this?
> > >
> > >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64b9c6e632cf00475c30aa8--

From java-user-return-42799-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:49:29 2009
Return-Path: <java-user-return-42799-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63132 invoked from network); 12 Oct 2009 20:49:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:49:29 -0000
Received: (qmail 52311 invoked by uid 500); 12 Oct 2009 20:49:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52259 invoked by uid 500); 12 Oct 2009 20:49:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52243 invoked by uid 99); 12 Oct 2009 20:49:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:49:25 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jason.rutherglen@gmail.com designates 74.125.92.24 as permitted sender)
Received: from [74.125.92.24] (HELO qw-out-2122.google.com) (74.125.92.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:49:23 +0000
Received: by qw-out-2122.google.com with SMTP id 5so1209244qwd.53
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:49:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=5TdBYyzFdgVTi2KQe4PPvA3ieiVmA3nVFhD65WKYSuw=;
        b=CqnQwWd0Q1t31Vh5uxMzjFhzvril0PXF65DjntXwXyzidNe+XlGLQGSRE4V4+WqV5a
         A32eW02/AMyo+68ffcj2mEztRCiU+IMmZIyo/hsKYSnpuQtVNW9yven4QHR2CR39bQsS
         G8WZerSgOm2MOIXx4q4sUOc5sOXapDB0VQhFw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=CWNMHDEMJ9Z5iH6HwnNPunZHsXHp49IjYrkvkgEuuDLmLGBKKFjXvtJ+i7VFBcgLGV
         O1wM4Qz06U7WtxMqS+plwyHjBe04NzkSR5T9J+LENdlgjk2vx1FM57DhdcJAuaW8j0HD
         byG3O20WCsIATgg5G/fZvcAKsSTcSkgSgaLgs=
MIME-Version: 1.0
Received: by 10.224.30.148 with SMTP id u20mr2054971qac.43.1255380542241; Mon, 
	12 Oct 2009 13:49:02 -0700 (PDT)
In-Reply-To: <25852756.post@talk.nabble.com>
References: <25852756.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 13:49:02 -0700
Message-ID: <85d3c3b60910121349ha1bdf5are0d8e90a65226bd@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jason Rutherglen <jason.rutherglen@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Cedric,

There is a wiki page on NRT at:
http://wiki.apache.org/lucene-java/NearRealtimeSearch

Feel free tp ask questions if there's not enough information.

-J

On Mon, Oct 12, 2009 at 2:24 AM, melix <cedric.champeau@lingway.com> wrote:
>
> Hi,
>
> I'm going to replace an old reader/writer synchronization mechanism we ha=
d
> implemented with the new near realtime search facilities in Lucene 2.9.
> However, it's still a bit unclear on how to efficiently do it.
>
> Is the following implementation the good way to do achieve it ? The conte=
xt
> is concurrent read/writes on an index :
>
> 1. create a Directory instance
> 2. create a writer on this directory
> 3. on each write request, add document to the writer
> 4. on each read request,
> =A0a. use writer.getReader() to obtain an up-to-date reader
> =A0b. create an IndexSearcher with that reader
> =A0c. perform Query
> =A0d. close IndexSearcher
> 5. on application close
> =A0a. close writer
> =A0b. close directory
>
> While this seems to be ok, I'm really wondering about the performance of
> opening a searcher for each request. I could introduce some kind of delay
> and cache a searcher for some seconds, but I'm not sure it's the best thi=
ng
> to do.
>
> Thanks,
>
> Cedric
>
>
> --
> View this message in context: http://www.nabble.com/Realtime-search-best-=
practices-tp25852756p25852756.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42800-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:55:03 2009
Return-Path: <java-user-return-42800-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65291 invoked from network); 12 Oct 2009 20:55:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:55:03 -0000
Received: (qmail 61803 invoked by uid 500); 12 Oct 2009 20:55:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61727 invoked by uid 500); 12 Oct 2009 20:55:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61717 invoked by uid 99); 12 Oct 2009 20:55:00 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:55:00 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [194.109.24.35] (HELO smtp-vbr15.xs4all.nl) (194.109.24.35)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:54:57 +0000
Received: from k8u.localnet (porta.xs4all.nl [83.163.165.214])
	by smtp-vbr15.xs4all.nl (8.13.8/8.13.8) with ESMTP id n9CKsZHs077574
	for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 22:54:35 +0200 (CEST)
	(envelope-from paul.elschot@xs4all.nl)
From: Paul Elschot <paul.elschot@xs4all.nl>
To: java-user@lucene.apache.org
Subject: Re: faceted search performance
Date: Mon, 12 Oct 2009 22:54:37 +0200
User-Agent: KMail/1.11.2 (Linux/2.6.28-15-generic; KDE/4.2.2; i686; ; )
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com> <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com> <8669da1e0910121230s1a0770dfwdafae04006ef637d@mail.gmail.com>
In-Reply-To: <8669da1e0910121230s1a0770dfwdafae04006ef637d@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative;
  boundary="Boundary-00=_Ne50KlE1AHpPmUf"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200910122254.37869.paul.elschot@xs4all.nl>
X-Virus-Scanned: by XS4ALL Virus Scanner

--Boundary-00=_Ne50KlE1AHpPmUf
Content-Type: text/plain;
  charset="iso-8859-15"
Content-Transfer-Encoding: 7bit

Chris,

You could also store term vectors for all docs at indexing
time, and add the termvectors for the matching docs into a
(large) map of terms in RAM.

Regards,
Paul Elschot


On Monday 12 October 2009 21:30:48 Christoph Boosz wrote:
> Hi Jake,
> 
> Thanks for your helpful explanation.
> In fact, my initial solution was to traverse each document in the result
> once and count the contained terms. As you mentioned, this process took a
> lot of memory.
> Trying to confine the memory usage with the facet approach, I was surprised
> by the decline in performance.
> Now I know it's nothing abnormal, at least.
> 
> Chris
> 
> 
> 2009/10/12 Jake Mannix <jake.mannix@gmail.com>
> 
> > Hey Chris,
> >
> > On Mon, Oct 12, 2009 at 10:30 AM, Christoph Boosz <
> > christoph.boosz@googlemail.com> wrote:
> >
> > > Thanks for your reply.
> > > Yes, it's likely that many terms occur in few documents.
> > >
> > > If I understand you right, I should do the following:
> > > -Write a HitCollector that simply increments a counter
> > > -Get the filter for the user query once: new CachingWrapperFilter(new
> > > QueryWrapperFilter(userQuery));
> > > -Create a TermQuery for each term
> > > -Perform the search and read the counter of the HitCollector
> > >
> > > I did that, but it didn't get faster. Any ideas why?
> > >
> >
> > This killer is the "TermQuery for each term" part - this is huge. You need
> > to invert this process,
> > and use your query as is, but while walking in the HitCollector, on each
> > doc
> > which matches
> > your query, increment counters for each of the terms in that document
> > (which
> > means you need
> > an in-memory forward lookup for your documents, like a multivalued
> > FieldCache - and if you've
> > got roughly the same number of terms as documents, this cache is likely to
> > be as large as
> > your entire index - a pretty hefty RAM cost).
> >
> > But a good thing to keep in mind is that doing this kind of faceting
> > (massively multivalued
> > on a huge term-set) requires a lot of computation, even if you have all the
> > proper structures
> > living in memory:
> >
> > For each document you look at (which matches your query), you need to look
> > at all
> > of the terms in that document, and increment a counter for that term.  So
> > however much
> > time it would normally take for you to do the driving query, it can take as
> > much as that
> > multiplied by the average number of terms in a document in your index.  If
> > your documents
> > are big, this could be a pretty huge latency penalty.
> >
> >  -jake
> >
> 


--Boundary-00=_Ne50KlE1AHpPmUf--

From java-user-return-42801-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:56:49 2009
Return-Path: <java-user-return-42801-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65609 invoked from network); 12 Oct 2009 20:56:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:56:49 -0000
Received: (qmail 63923 invoked by uid 500); 12 Oct 2009 20:56:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63855 invoked by uid 500); 12 Oct 2009 20:56:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63845 invoked by uid 99); 12 Oct 2009 20:56:46 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:56:46 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:56:36 +0000
Received: by ywh14 with SMTP id 14so755453ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:56:14 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.236.17 with SMTP id j17mr10887970ybh.229.1255380974843; 
	Mon, 12 Oct 2009 13:56:14 -0700 (PDT)
In-Reply-To: <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
Date: Mon, 12 Oct 2009 16:56:14 -0400
Message-ID: <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

I agree, the javadocs could be improved.  How about something like
this for the first 2 paragraphs:

   * Returns a readonly reader, covering all committed as
   * well as un-committed changes to the index.  This
   * provides "near real-time" searching, in that changes
   * made during an IndexWriter session can be quickly made
   * available for searching without closing the writer nor
   * calling {@link #commit}.
   *
   * <p>Note that this is functionally equivalent to calling
   * {#commit} and then using {@link IndexReader#open} to
   * open a new reader.  But the turarnound time of this
   * method should be faster since it avoids the potentially
   * costly {@link #commit}.<p>

Mike

On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> Thanks Yonik,
>
> =A0It may be surprising, but in fact I have read that
> javadoc. =A0It talks about not needing to close the
> writer, but doesn't specifically talk about the what
> the relationship between commit() calls and
> getReader() calls is. =A0I suppose I should have
> interpreted:
>
> "@returns a new reader which contains all
> changes..."
>
> to mean "all uncommitted changes", but why
> is it so obvious that what could be happening
> is that it only "returns all changes since the last
> commit, but without touching disk because it
> has docs in memory as well"?
>
> =A0-jake
>
> On Mon, Oct 12, 2009 at 1:26 PM, Yonik Seeley <yonik@lucidimagination.com=
>wrote:
>
>> Guys, please - you're not new at this... this is what JavaDoc is for:
>>
>> =A0/**
>> =A0 * Returns a readonly reader containing all
>> =A0 * current updates. =A0Flush is called automatically. =A0This
>> =A0 * provides "near real-time" searching, in that changes
>> =A0 * made during an IndexWriter session can be made
>> =A0 * available for searching without closing the writer.
>> =A0 *
>> =A0 * <p>It's near real-time because there is no hard
>> =A0 * guarantee on how quickly you can get a new reader after
>> =A0 * making changes with IndexWriter. =A0You'll have to
>> =A0 * experiment in your situation to determine if it's
>> =A0 * fast enough. =A0As this is a new and experimental
>> =A0 * feature, please report back on your findings so we can
>> =A0 * learn, improve and iterate.</p>
>> =A0 *
>> =A0 * <p>The resulting reader supports {@link
>> =A0 * IndexReader#reopen}, but that call will simply forward
>> =A0 * back to this method (though this may change in the
>> =A0 * future).</p>
>> =A0 *
>> =A0 * <p>The very first time this method is called, this
>> =A0 * writer instance will make every effort to pool the
>> =A0 * readers that it opens for doing merges, applying
>> =A0 * deletes, etc. =A0This means additional resources (RAM,
>> =A0 * file descriptors, CPU time) will be consumed.</p>
>> =A0 *
>> =A0 * <p>For lower latency on reopening a reader, you should
>> =A0 * call {@link #setMergedSegmentWarmer} to
>> =A0 * pre-warm a newly merged segment before it's committed
>> =A0 * to the index. =A0This is important for minimizing
>> =A0 * index-to-search delay after a large merge. =A0</p>
>> =A0 *
>> =A0 * <p>If an addIndexes* call is running in another thread,
>> =A0 * then this reader will only search those segments from
>> =A0 * the foreign index that have been successfully copied
>> =A0 * over, so far</p>.
>> =A0 *
>> =A0 * <p><b>NOTE</b>: Once the writer is closed, any
>> =A0 * outstanding readers may continue to be used. =A0However,
>> =A0 * if you attempt to reopen any of those readers, you'll
>> =A0 * hit an {@link AlreadyClosedException}.</p>
>> =A0 *
>> =A0 * <p><b>NOTE:</b> This API is experimental and might
>> =A0 * change in incompatible ways in the next release.</p>
>> =A0 *
>> =A0 * @return IndexReader that covers entire index plus all
>> =A0 * changes made so far by this IndexWriter instance
>> =A0 *
>> =A0 * @throws IOException
>> =A0 */
>> =A0public IndexReader getReader() throws IOException {
>>
>>
>> -Yonik
>> http://www.lucidimagination.com
>>
>>
>> On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrote:
>> > Oh, that is really good to know!
>> > Is this deterministic? e.g. as long as writer.addDocument() is called,
>> next
>> > getReader reflects the change? Does it work with deletes? e.g.
>> > writer.deleteDocuments()?
>> > Thanks Mike for clarifying!
>> >
>> > -John
>> >
>> > On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> Just to clarify: IndexWriter.newReader returns a reader that searches
>> >> uncommitted changes as well. =A0Ie, you need not call IndexWriter.com=
mit
>> >> to make the changes visible.
>> >>
>> >> However, if you're opening a reader the "normal" way
>> >> (IndexReader.open) then it is necessary to first call
>> >> IndexWriter.commit.
>> >>
>> >> Mike
>> >>
>> >> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
>> >> wrote:
>> >> >
>> >> > Hi,
>> >> >
>> >> > I'm going to replace an old reader/writer synchronization mechanism=
 we
>> >> had
>> >> > implemented with the new near realtime search facilities in Lucene
>> 2.9.
>> >> > However, it's still a bit unclear on how to efficiently do it.
>> >> >
>> >> > Is the following implementation the good way to do achieve it ? The
>> >> context
>> >> > is concurrent read/writes on an index :
>> >> >
>> >> > 1. create a Directory instance
>> >> > 2. create a writer on this directory
>> >> > 3. on each write request, add document to the writer
>> >> > 4. on each read request,
>> >> > =A0a. use writer.getReader() to obtain an up-to-date reader
>> >> > =A0b. create an IndexSearcher with that reader
>> >> > =A0c. perform Query
>> >> > =A0d. close IndexSearcher
>> >> > 5. on application close
>> >> > =A0a. close writer
>> >> > =A0b. close directory
>> >> >
>> >> > While this seems to be ok, I'm really wondering about the performan=
ce
>> of
>> >> > opening a searcher for each request. I could introduce some kind of
>> delay
>> >> > and cache a searcher for some seconds, but I'm not sure it's the be=
st
>> >> thing
>> >> > to do.
>> >> >
>> >> > Thanks,
>> >> >
>> >> > Cedric
>> >> >
>> >> >
>> >> > --
>> >> > View this message in context:
>> >>
>> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756=
.html
>> >> > Sent from the Lucene - Java Users mailing list archive at Nabble.co=
m.
>> >> >
>> >> >
>> >> > -------------------------------------------------------------------=
--
>> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42802-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 20:57:51 2009
Return-Path: <java-user-return-42802-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65889 invoked from network); 12 Oct 2009 20:57:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 20:57:51 -0000
Received: (qmail 67394 invoked by uid 500); 12 Oct 2009 20:57:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67339 invoked by uid 500); 12 Oct 2009 20:57:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67329 invoked by uid 99); 12 Oct 2009 20:57:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:57:49 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 74.125.78.24 as permitted sender)
Received: from [74.125.78.24] (HELO ey-out-2122.google.com) (74.125.78.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 20:57:39 +0000
Received: by ey-out-2122.google.com with SMTP id 22so2115592eye.3
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 13:57:19 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=S5qGItHUnWBOv9NWnvHJ4OBxyA8LGQC1XrXPq7bOWs0=;
        b=Fst1q3dC2103iLDx/JAO4tZfHdvcH+nPMODQ1O7dSX6hyCT3CMZau0QAM+cwpLo4B9
         7vuxxYfI1d23yE0LIB9z6EwWdRqL7rYHTtW0Wd6TpG+JcEwf4vT1M37fiereDWxr/w3P
         LLRVQfXZDuAYKIJL+WUSaMRlX6OZZNFdT3lGg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=f2OlRrzsO8tGU5oEOHw8QLRuWgcyF6QnEQRbqsCz5Te5pGENqueDsO2vYe3F6w9sge
         Bh59gIJK9j/z0F2lkFhfMal2a1335aqJL5sQ3VOjTMzs50ooPOBehFKJwxq9o/t3/+p0
         Kg+dVl2Qo7jfz2y04BY0P63Lv0fMLqkcyvgMg=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.90.18 with SMTP id d18mr2020386wef.225.1255381039148; Mon, 
	12 Oct 2009 13:57:19 -0700 (PDT)
In-Reply-To: <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
Date: Mon, 12 Oct 2009 16:57:19 -0400
X-Google-Sender-Auth: c5a9b86cb3299035
Message-ID: <c68e39170910121357p3f5dbc7l82575ce4f8f946a0@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> =A0It may be surprising, but in fact I have read that
> javadoc.

It was not your email I responded to.

> =A0It talks about not needing to close the
> writer, but doesn't specifically talk about the what
> the relationship between commit() calls and
> getReader() calls is.

Do you have a suggestion of how to update the JavaDoc?
I'm not sure I understand the relationship between commit and
getReader that you refer to.

> , but why
> is it so obvious that what could be happening
> is that it only "returns all changes since the last
> commit, but without touching disk because it
> has docs in memory as well"?

Sorry, this seems confusing - I'm not sure what you're trying to say.
Perhaps we should approach this as proposed javadoc changes?

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42803-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 21:01:28 2009
Return-Path: <java-user-return-42803-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67508 invoked from network); 12 Oct 2009 21:01:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 21:01:27 -0000
Received: (qmail 76824 invoked by uid 500); 12 Oct 2009 21:01:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76770 invoked by uid 500); 12 Oct 2009 21:01:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76760 invoked by uid 99); 12 Oct 2009 21:01:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:01:24 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:01:21 +0000
Received: by ywh14 with SMTP id 14so758609ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:01:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=JhukvfYszULyKhMxrUl0/vDryKLGz6B/UtkWBu+DbJI=;
        b=sBZToV2Ep3auCE6qf/VQTap99rrEeUL3usL16S5XVa/ZUdsh4He4aXs/T/B7ZUrOzk
         eR6yc7Nn3qpucCEebM7oj/D2OzLmZ5bfIhKlS3h6x1I3U8N8sS+DpYIeZgJ0zBcHK4TY
         ThmWDqLo5Kb3LDfzqQNswha4FTbG61wSFhqgA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=fBagITM+ZA0JzoHdK0fvNX/3+GYL/Ews4CuvVDKnRl+dn0OM1NosYjTLSLYA8fKTA1
         oDBo9o7rWR1y+ZsRgJbUgBoIqMqe7KYfRmxeMZHruDke0HklxFRBxuRQvFc07rosHsmu
         oJuX6ULp7sHMgyikASaXWmn5ZpMon3eS51Jrs=
MIME-Version: 1.0
Received: by 10.90.38.26 with SMTP id l26mr3108014agl.30.1255381260384; Mon, 
	12 Oct 2009 14:01:00 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
Date: Mon, 12 Oct 2009 14:01:00 -0700
Message-ID: <4b124c310910121401w669966cdi2b3c875dedcb364b@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636283c40153a2c0475c33abe

--001636283c40153a2c0475c33abe
Content-Type: text/plain; charset=ISO-8859-1

That seems a lot more straightforward Mike, thanks.

  -jake

On Mon, Oct 12, 2009 at 1:56 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> I agree, the javadocs could be improved.  How about something like
> this for the first 2 paragraphs:
>
>   * Returns a readonly reader, covering all committed as
>   * well as un-committed changes to the index.  This
>    * provides "near real-time" searching, in that changes
>    * made during an IndexWriter session can be quickly made
>   * available for searching without closing the writer nor
>   * calling {@link #commit}.
>   *
>   * <p>Note that this is functionally equivalent to calling
>   * {#commit} and then using {@link IndexReader#open} to
>   * open a new reader.  But the turarnound time of this
>   * method should be faster since it avoids the potentially
>   * costly {@link #commit}.<p>
>
> Mike
>
> On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> > Thanks Yonik,
> >
> >  It may be surprising, but in fact I have read that
> > javadoc.  It talks about not needing to close the
> > writer, but doesn't specifically talk about the what
> > the relationship between commit() calls and
> > getReader() calls is.  I suppose I should have
> > interpreted:
> >
> > "@returns a new reader which contains all
> > changes..."
> >
> > to mean "all uncommitted changes", but why
> > is it so obvious that what could be happening
> > is that it only "returns all changes since the last
> > commit, but without touching disk because it
> > has docs in memory as well"?
> >
> >  -jake
> >
> > On Mon, Oct 12, 2009 at 1:26 PM, Yonik Seeley <
> yonik@lucidimagination.com>wrote:
> >
> >> Guys, please - you're not new at this... this is what JavaDoc is for:
> >>
> >>  /**
> >>   * Returns a readonly reader containing all
> >>   * current updates.  Flush is called automatically.  This
> >>   * provides "near real-time" searching, in that changes
> >>   * made during an IndexWriter session can be made
> >>   * available for searching without closing the writer.
> >>   *
> >>   * <p>It's near real-time because there is no hard
> >>   * guarantee on how quickly you can get a new reader after
> >>   * making changes with IndexWriter.  You'll have to
> >>   * experiment in your situation to determine if it's
> >>   * fast enough.  As this is a new and experimental
> >>   * feature, please report back on your findings so we can
> >>   * learn, improve and iterate.</p>
> >>   *
> >>   * <p>The resulting reader supports {@link
> >>   * IndexReader#reopen}, but that call will simply forward
> >>   * back to this method (though this may change in the
> >>   * future).</p>
> >>   *
> >>   * <p>The very first time this method is called, this
> >>   * writer instance will make every effort to pool the
> >>   * readers that it opens for doing merges, applying
> >>   * deletes, etc.  This means additional resources (RAM,
> >>   * file descriptors, CPU time) will be consumed.</p>
> >>   *
> >>   * <p>For lower latency on reopening a reader, you should
> >>   * call {@link #setMergedSegmentWarmer} to
> >>   * pre-warm a newly merged segment before it's committed
> >>   * to the index.  This is important for minimizing
> >>   * index-to-search delay after a large merge.  </p>
> >>   *
> >>   * <p>If an addIndexes* call is running in another thread,
> >>   * then this reader will only search those segments from
> >>   * the foreign index that have been successfully copied
> >>   * over, so far</p>.
> >>   *
> >>   * <p><b>NOTE</b>: Once the writer is closed, any
> >>   * outstanding readers may continue to be used.  However,
> >>   * if you attempt to reopen any of those readers, you'll
> >>   * hit an {@link AlreadyClosedException}.</p>
> >>   *
> >>   * <p><b>NOTE:</b> This API is experimental and might
> >>   * change in incompatible ways in the next release.</p>
> >>   *
> >>   * @return IndexReader that covers entire index plus all
> >>   * changes made so far by this IndexWriter instance
> >>   *
> >>   * @throws IOException
> >>   */
> >>  public IndexReader getReader() throws IOException {
> >>
> >>
> >> -Yonik
> >> http://www.lucidimagination.com
> >>
> >>
> >> On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrote:
> >> > Oh, that is really good to know!
> >> > Is this deterministic? e.g. as long as writer.addDocument() is called,
> >> next
> >> > getReader reflects the change? Does it work with deletes? e.g.
> >> > writer.deleteDocuments()?
> >> > Thanks Mike for clarifying!
> >> >
> >> > -John
> >> >
> >> > On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
> >> > lucene@mikemccandless.com> wrote:
> >> >
> >> >> Just to clarify: IndexWriter.newReader returns a reader that searches
> >> >> uncommitted changes as well.  Ie, you need not call
> IndexWriter.commit
> >> >> to make the changes visible.
> >> >>
> >> >> However, if you're opening a reader the "normal" way
> >> >> (IndexReader.open) then it is necessary to first call
> >> >> IndexWriter.commit.
> >> >>
> >> >> Mike
> >> >>
> >> >> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
> >> >> wrote:
> >> >> >
> >> >> > Hi,
> >> >> >
> >> >> > I'm going to replace an old reader/writer synchronization mechanism
> we
> >> >> had
> >> >> > implemented with the new near realtime search facilities in Lucene
> >> 2.9.
> >> >> > However, it's still a bit unclear on how to efficiently do it.
> >> >> >
> >> >> > Is the following implementation the good way to do achieve it ? The
> >> >> context
> >> >> > is concurrent read/writes on an index :
> >> >> >
> >> >> > 1. create a Directory instance
> >> >> > 2. create a writer on this directory
> >> >> > 3. on each write request, add document to the writer
> >> >> > 4. on each read request,
> >> >> >  a. use writer.getReader() to obtain an up-to-date reader
> >> >> >  b. create an IndexSearcher with that reader
> >> >> >  c. perform Query
> >> >> >  d. close IndexSearcher
> >> >> > 5. on application close
> >> >> >  a. close writer
> >> >> >  b. close directory
> >> >> >
> >> >> > While this seems to be ok, I'm really wondering about the
> performance
> >> of
> >> >> > opening a searcher for each request. I could introduce some kind of
> >> delay
> >> >> > and cache a searcher for some seconds, but I'm not sure it's the
> best
> >> >> thing
> >> >> > to do.
> >> >> >
> >> >> > Thanks,
> >> >> >
> >> >> > Cedric
> >> >> >
> >> >> >
> >> >> > --
> >> >> > View this message in context:
> >> >>
> >>
> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
> >> >> > Sent from the Lucene - Java Users mailing list archive at
> Nabble.com.
> >> >> >
> >> >> >
> >> >> >
> ---------------------------------------------------------------------
> >> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >> >
> >> >> >
> >> >>
> >> >> ---------------------------------------------------------------------
> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >>
> >> >>
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636283c40153a2c0475c33abe--

From java-user-return-42804-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 21:06:54 2009
Return-Path: <java-user-return-42804-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71023 invoked from network); 12 Oct 2009 21:06:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 21:06:53 -0000
Received: (qmail 83418 invoked by uid 500); 12 Oct 2009 21:06:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83346 invoked by uid 500); 12 Oct 2009 21:06:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83336 invoked by uid 99); 12 Oct 2009 21:06:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:06:50 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:06:47 +0000
Received: by ywh14 with SMTP id 14so762348ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:06:26 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.101.1 with SMTP id y1mr10859288ybb.318.1255381585805; Mon, 
	12 Oct 2009 14:06:25 -0700 (PDT)
In-Reply-To: <4b124c310910121401w669966cdi2b3c875dedcb364b@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
	 <4b124c310910121401w669966cdi2b3c875dedcb364b@mail.gmail.com>
Date: Mon, 12 Oct 2009 17:06:25 -0400
Message-ID: <9ac0c6aa0910121406l30398dc9s8a39153a2902c78b@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

OK I just committed it -- thanks!

Mike

On Mon, Oct 12, 2009 at 5:01 PM, Jake Mannix <jake.mannix@gmail.com> wrote:
> That seems a lot more straightforward Mike, thanks.
>
> =A0-jake
>
> On Mon, Oct 12, 2009 at 1:56 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> I agree, the javadocs could be improved. =A0How about something like
>> this for the first 2 paragraphs:
>>
>> =A0 * Returns a readonly reader, covering all committed as
>> =A0 * well as un-committed changes to the index. =A0This
>> =A0 =A0* provides "near real-time" searching, in that changes
>> =A0 =A0* made during an IndexWriter session can be quickly made
>> =A0 * available for searching without closing the writer nor
>> =A0 * calling {@link #commit}.
>> =A0 *
>> =A0 * <p>Note that this is functionally equivalent to calling
>> =A0 * {#commit} and then using {@link IndexReader#open} to
>> =A0 * open a new reader. =A0But the turarnound time of this
>> =A0 * method should be faster since it avoids the potentially
>> =A0 * costly {@link #commit}.<p>
>>
>> Mike
>>
>> On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com>
>> wrote:
>> > Thanks Yonik,
>> >
>> > =A0It may be surprising, but in fact I have read that
>> > javadoc. =A0It talks about not needing to close the
>> > writer, but doesn't specifically talk about the what
>> > the relationship between commit() calls and
>> > getReader() calls is. =A0I suppose I should have
>> > interpreted:
>> >
>> > "@returns a new reader which contains all
>> > changes..."
>> >
>> > to mean "all uncommitted changes", but why
>> > is it so obvious that what could be happening
>> > is that it only "returns all changes since the last
>> > commit, but without touching disk because it
>> > has docs in memory as well"?
>> >
>> > =A0-jake
>> >
>> > On Mon, Oct 12, 2009 at 1:26 PM, Yonik Seeley <
>> yonik@lucidimagination.com>wrote:
>> >
>> >> Guys, please - you're not new at this... this is what JavaDoc is for:
>> >>
>> >> =A0/**
>> >> =A0 * Returns a readonly reader containing all
>> >> =A0 * current updates. =A0Flush is called automatically. =A0This
>> >> =A0 * provides "near real-time" searching, in that changes
>> >> =A0 * made during an IndexWriter session can be made
>> >> =A0 * available for searching without closing the writer.
>> >> =A0 *
>> >> =A0 * <p>It's near real-time because there is no hard
>> >> =A0 * guarantee on how quickly you can get a new reader after
>> >> =A0 * making changes with IndexWriter. =A0You'll have to
>> >> =A0 * experiment in your situation to determine if it's
>> >> =A0 * fast enough. =A0As this is a new and experimental
>> >> =A0 * feature, please report back on your findings so we can
>> >> =A0 * learn, improve and iterate.</p>
>> >> =A0 *
>> >> =A0 * <p>The resulting reader supports {@link
>> >> =A0 * IndexReader#reopen}, but that call will simply forward
>> >> =A0 * back to this method (though this may change in the
>> >> =A0 * future).</p>
>> >> =A0 *
>> >> =A0 * <p>The very first time this method is called, this
>> >> =A0 * writer instance will make every effort to pool the
>> >> =A0 * readers that it opens for doing merges, applying
>> >> =A0 * deletes, etc. =A0This means additional resources (RAM,
>> >> =A0 * file descriptors, CPU time) will be consumed.</p>
>> >> =A0 *
>> >> =A0 * <p>For lower latency on reopening a reader, you should
>> >> =A0 * call {@link #setMergedSegmentWarmer} to
>> >> =A0 * pre-warm a newly merged segment before it's committed
>> >> =A0 * to the index. =A0This is important for minimizing
>> >> =A0 * index-to-search delay after a large merge. =A0</p>
>> >> =A0 *
>> >> =A0 * <p>If an addIndexes* call is running in another thread,
>> >> =A0 * then this reader will only search those segments from
>> >> =A0 * the foreign index that have been successfully copied
>> >> =A0 * over, so far</p>.
>> >> =A0 *
>> >> =A0 * <p><b>NOTE</b>: Once the writer is closed, any
>> >> =A0 * outstanding readers may continue to be used. =A0However,
>> >> =A0 * if you attempt to reopen any of those readers, you'll
>> >> =A0 * hit an {@link AlreadyClosedException}.</p>
>> >> =A0 *
>> >> =A0 * <p><b>NOTE:</b> This API is experimental and might
>> >> =A0 * change in incompatible ways in the next release.</p>
>> >> =A0 *
>> >> =A0 * @return IndexReader that covers entire index plus all
>> >> =A0 * changes made so far by this IndexWriter instance
>> >> =A0 *
>> >> =A0 * @throws IOException
>> >> =A0 */
>> >> =A0public IndexReader getReader() throws IOException {
>> >>
>> >>
>> >> -Yonik
>> >> http://www.lucidimagination.com
>> >>
>> >>
>> >> On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrot=
e:
>> >> > Oh, that is really good to know!
>> >> > Is this deterministic? e.g. as long as writer.addDocument() is call=
ed,
>> >> next
>> >> > getReader reflects the change? Does it work with deletes? e.g.
>> >> > writer.deleteDocuments()?
>> >> > Thanks Mike for clarifying!
>> >> >
>> >> > -John
>> >> >
>> >> > On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
>> >> > lucene@mikemccandless.com> wrote:
>> >> >
>> >> >> Just to clarify: IndexWriter.newReader returns a reader that searc=
hes
>> >> >> uncommitted changes as well. =A0Ie, you need not call
>> IndexWriter.commit
>> >> >> to make the changes visible.
>> >> >>
>> >> >> However, if you're opening a reader the "normal" way
>> >> >> (IndexReader.open) then it is necessary to first call
>> >> >> IndexWriter.commit.
>> >> >>
>> >> >> Mike
>> >> >>
>> >> >> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.co=
m>
>> >> >> wrote:
>> >> >> >
>> >> >> > Hi,
>> >> >> >
>> >> >> > I'm going to replace an old reader/writer synchronization mechan=
ism
>> we
>> >> >> had
>> >> >> > implemented with the new near realtime search facilities in Luce=
ne
>> >> 2.9.
>> >> >> > However, it's still a bit unclear on how to efficiently do it.
>> >> >> >
>> >> >> > Is the following implementation the good way to do achieve it ? =
The
>> >> >> context
>> >> >> > is concurrent read/writes on an index :
>> >> >> >
>> >> >> > 1. create a Directory instance
>> >> >> > 2. create a writer on this directory
>> >> >> > 3. on each write request, add document to the writer
>> >> >> > 4. on each read request,
>> >> >> > =A0a. use writer.getReader() to obtain an up-to-date reader
>> >> >> > =A0b. create an IndexSearcher with that reader
>> >> >> > =A0c. perform Query
>> >> >> > =A0d. close IndexSearcher
>> >> >> > 5. on application close
>> >> >> > =A0a. close writer
>> >> >> > =A0b. close directory
>> >> >> >
>> >> >> > While this seems to be ok, I'm really wondering about the
>> performance
>> >> of
>> >> >> > opening a searcher for each request. I could introduce some kind=
 of
>> >> delay
>> >> >> > and cache a searcher for some seconds, but I'm not sure it's the
>> best
>> >> >> thing
>> >> >> > to do.
>> >> >> >
>> >> >> > Thanks,
>> >> >> >
>> >> >> > Cedric
>> >> >> >
>> >> >> >
>> >> >> > --
>> >> >> > View this message in context:
>> >> >>
>> >>
>> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756=
.html
>> >> >> > Sent from the Lucene - Java Users mailing list archive at
>> Nabble.com.
>> >> >> >
>> >> >> >
>> >> >> >
>> ---------------------------------------------------------------------
>> >> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> >> > For additional commands, e-mail: java-user-help@lucene.apache.or=
g
>> >> >> >
>> >> >> >
>> >> >>
>> >> >> ------------------------------------------------------------------=
---
>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >>
>> >> >>
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42805-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 21:09:16 2009
Return-Path: <java-user-return-42805-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71727 invoked from network); 12 Oct 2009 21:09:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 21:09:15 -0000
Received: (qmail 87781 invoked by uid 500); 12 Oct 2009 21:09:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87705 invoked by uid 500); 12 Oct 2009 21:09:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87695 invoked by uid 99); 12 Oct 2009 21:09:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:09:13 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.173 as permitted sender)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:09:11 +0000
Received: by yxe3 with SMTP id 3so3624210yxe.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:08:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=sVzgmqVZaCl2rRCNTkfrX7VskFJFss8jgBtjOdX7Dko=;
        b=srd6ApRN3PTvwD2WRH7nbfm/DArMmmOVzxFSQDh5EWSs4ZKN+/psxIiFdGUuYJGozd
         dQ/89s269SSpzRCPXKeOU/xnihRkCph5AVBWTe1rMYErjY7aM24mFVF3aFcrjdq6LMM2
         OrkEIq8+eTyKK2pXM2x0Cxs8Mhf7Qs8ynk2YU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=AEFo9wRbV+RDh13dJkRpxhK5D6jOxowTgHQvYrctAenXjBgnXAVP986Ictc1WthrXp
         QVZjoCnBi2TNiEYTnjSUHdjyNrmuNk13YUb4pv9AJOSuyXohX4hBSZtTrxjo7ZjTc/vL
         ue7njJlgMztMc4QULYRE/C+9Vxwda1ojl29iQ=
MIME-Version: 1.0
Received: by 10.90.42.9 with SMTP id p9mr3875471agp.4.1255381728989; Mon, 12 
	Oct 2009 14:08:48 -0700 (PDT)
In-Reply-To: <c68e39170910121357p3f5dbc7l82575ce4f8f946a0@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <c68e39170910121357p3f5dbc7l82575ce4f8f946a0@mail.gmail.com>
Date: Mon, 12 Oct 2009 14:08:48 -0700
Message-ID: <4b124c310910121408k5513041dqc37fa3bd9bbcabd2@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: multipart/alternative; boundary=00163628391c0398ee0475c35661

--00163628391c0398ee0475c35661
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Oct 12, 2009 at 1:57 PM, Yonik Seeley <yonik@lucidimagination.com>wrote:

> On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> >  It may be surprising, but in fact I have read that
> > javadoc.
>
> It was not your email I responded to.
>

Sorry, my bad then - you said "guys" and John and I were the last two to be
asking questions / commenting on this thread.


> >  It talks about not needing to close the
> > writer, but doesn't specifically talk about the what
> > the relationship between commit() calls and
> > getReader() calls is.
>
> Do you have a suggestion of how to update the JavaDoc?
> I'm not sure I understand the relationship between commit and
> getReader that you refer to.
>

I like Mike's clarification to the first two javadocs he just posted,
very concise.

  -jake

--00163628391c0398ee0475c35661--

From java-user-return-42806-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 21:10:43 2009
Return-Path: <java-user-return-42806-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72180 invoked from network); 12 Oct 2009 21:10:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 21:10:43 -0000
Received: (qmail 89826 invoked by uid 500); 12 Oct 2009 21:10:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89755 invoked by uid 500); 12 Oct 2009 21:10:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89742 invoked by uid 99); 12 Oct 2009 21:10:41 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:10:41 +0000
X-ASF-Spam-Status: No, hits=-1.7 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of john.wang@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:10:36 +0000
Received: by ywh14 with SMTP id 14so764826ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:10:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=NWzkPu5CkkFgvH6ZOF0x7izsu9WcIc26ASge5hUPPt4=;
        b=jezzQLc9voppnLNpyk3BggVsklDbQE+ntTVox/emuaP5RfWQESaxLAllRPNoo7zI+X
         BWBrQVDJ1mzM0D4G30IoACgaC0nTLrYkOKwYY/EerY9QsQokh2besyhkLYPpyDBhfBXA
         VKNZR+Oizdn1nFRcFqMrCHuV1FE3xaRbhlwwM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=JscPihIzp8wV30mWyyX/qK78G/88XLNrRNfszm0EM3ieCxuUOd+mYZvi/oFG6ecxvp
         iV7lYBcSPIzpnN2DqT533bT4Mf2/bF8rQIGa0nmPtfWmRroOVS1vpOpB/70WFvzSEbGe
         d8csQR+lFCr+D/K7cVBMTtfX8q8XxrmqoAWHU=
MIME-Version: 1.0
Received: by 10.101.196.13 with SMTP id y13mr5942447anp.148.1255381815180; 
	Mon, 12 Oct 2009 14:10:15 -0700 (PDT)
In-Reply-To: <c68e39170910121357p3f5dbc7l82575ce4f8f946a0@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <c68e39170910121357p3f5dbc7l82575ce4f8f946a0@mail.gmail.com>
Date: Mon, 12 Oct 2009 14:10:15 -0700
Message-ID: <8837fb770910121410x1ceb031ld10f5a9280a4d8b@mail.gmail.com>
Subject: Re: Realtime search best practices
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: multipart/alternative; boundary=0016e68ee0b526bed20475c35bd9

--0016e68ee0b526bed20475c35bd9
Content-Type: text/plain; charset=ISO-8859-1

I think it was my email Yonik responded to and he is right, I was being lazy
and didn't read the javadoc very carefully.My bad.
Thanks for the javadoc change.

-John

On Mon, Oct 12, 2009 at 1:57 PM, Yonik Seeley <yonik@lucidimagination.com>wrote:

> On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> >  It may be surprising, but in fact I have read that
> > javadoc.
>
> It was not your email I responded to.
>
> >  It talks about not needing to close the
> > writer, but doesn't specifically talk about the what
> > the relationship between commit() calls and
> > getReader() calls is.
>
> Do you have a suggestion of how to update the JavaDoc?
> I'm not sure I understand the relationship between commit and
> getReader that you refer to.
>
> > , but why
> > is it so obvious that what could be happening
> > is that it only "returns all changes since the last
> > commit, but without touching disk because it
> > has docs in memory as well"?
>
> Sorry, this seems confusing - I'm not sure what you're trying to say.
> Perhaps we should approach this as proposed javadoc changes?
>
> -Yonik
> http://www.lucidimagination.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e68ee0b526bed20475c35bd9--

From java-user-return-42807-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 21:29:35 2009
Return-Path: <java-user-return-42807-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78540 invoked from network); 12 Oct 2009 21:29:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 21:29:35 -0000
Received: (qmail 14020 invoked by uid 500); 12 Oct 2009 21:29:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13924 invoked by uid 500); 12 Oct 2009 21:29:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13914 invoked by uid 99); 12 Oct 2009 21:29:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:29:32 +0000
X-ASF-Spam-Status: No, hits=-1.9 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of christoph.boosz@googlemail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:29:29 +0000
Received: by ewy19 with SMTP id 19so9368203ewy.28
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:29:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=5j2mYi/bTeNs64jnaiOCeVcIVfghvkERl6skWXRBtVE=;
        b=ek06CHHiaFKfOGeMErBbcu5hXVmemBxEVhq4F9WJf76HSzNWlt/U23RxxQn/TJYG3b
         I8THbcUj6eQIyh8cMrLuNcIR35jRQaAEqOfYe9YQj7MITNDX9yj+d9doj76f9fLJj9+B
         15bO4zSID1CWAdDxp86crSUJsf7CSowMiwNLM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=WaWt4bJNrobQ9XpeEcSoD8R5ehkO9cvrM2NmdH8ZDDlwywQw/arMMqy2lyzrSg7yV1
         bm7kbwW8Qt/OlOT+/EF0lSq7yzvaB2dE1DX9+jSGuzyc9WBlcduEaUaDCHSEEEQ7XnUA
         Ph+k0LWogkWuIQi8AhQjkYPfI03AA0meDpK5Q=
MIME-Version: 1.0
Received: by 10.216.88.140 with SMTP id a12mr2074009wef.157.1255382947678; 
	Mon, 12 Oct 2009 14:29:07 -0700 (PDT)
In-Reply-To: <200910122254.37869.paul.elschot@xs4all.nl>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com>
	 <8669da1e0910121230s1a0770dfwdafae04006ef637d@mail.gmail.com>
	 <200910122254.37869.paul.elschot@xs4all.nl>
Date: Mon, 12 Oct 2009 23:29:07 +0200
Message-ID: <8669da1e0910121429o1e50c63u17bee88d730052ff@mail.gmail.com>
Subject: Re: faceted search performance
From: Christoph Boosz <christoph.boosz@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d7eb46a749220475c39ea3

--0016e6d7eb46a749220475c39ea3
Content-Type: text/plain; charset=ISO-8859-1

Hi Paul,

Thanks for your suggestion. I will test it within the next few days.
However, due to memory limitations, it will only work if the number of hits
is small enough, am I right?

Chris

2009/10/12 Paul Elschot <paul.elschot@xs4all.nl>

> Chris,
>
> You could also store term vectors for all docs at indexing
> time, and add the termvectors for the matching docs into a
> (large) map of terms in RAM.
>
> Regards,
> Paul Elschot
>
>
> On Monday 12 October 2009 21:30:48 Christoph Boosz wrote:
> > Hi Jake,
> >
> > Thanks for your helpful explanation.
> > In fact, my initial solution was to traverse each document in the result
> > once and count the contained terms. As you mentioned, this process took a
> > lot of memory.
> > Trying to confine the memory usage with the facet approach, I was
> surprised
> > by the decline in performance.
> > Now I know it's nothing abnormal, at least.
> >
> > Chris
> >
> >
> > 2009/10/12 Jake Mannix <jake.mannix@gmail.com>
> >
> > > Hey Chris,
> > >
> > > On Mon, Oct 12, 2009 at 10:30 AM, Christoph Boosz <
> > > christoph.boosz@googlemail.com> wrote:
> > >
> > > > Thanks for your reply.
> > > > Yes, it's likely that many terms occur in few documents.
> > > >
> > > > If I understand you right, I should do the following:
> > > > -Write a HitCollector that simply increments a counter
> > > > -Get the filter for the user query once: new CachingWrapperFilter(new
> > > > QueryWrapperFilter(userQuery));
> > > > -Create a TermQuery for each term
> > > > -Perform the search and read the counter of the HitCollector
> > > >
> > > > I did that, but it didn't get faster. Any ideas why?
> > > >
> > >
> > > This killer is the "TermQuery for each term" part - this is huge. You
> need
> > > to invert this process,
> > > and use your query as is, but while walking in the HitCollector, on
> each
> > > doc
> > > which matches
> > > your query, increment counters for each of the terms in that document
> > > (which
> > > means you need
> > > an in-memory forward lookup for your documents, like a multivalued
> > > FieldCache - and if you've
> > > got roughly the same number of terms as documents, this cache is likely
> to
> > > be as large as
> > > your entire index - a pretty hefty RAM cost).
> > >
> > > But a good thing to keep in mind is that doing this kind of faceting
> > > (massively multivalued
> > > on a huge term-set) requires a lot of computation, even if you have all
> the
> > > proper structures
> > > living in memory:
> > >
> > > For each document you look at (which matches your query), you need to
> look
> > > at all
> > > of the terms in that document, and increment a counter for that term.
>  So
> > > however much
> > > time it would normally take for you to do the driving query, it can
> take as
> > > much as that
> > > multiplied by the average number of terms in a document in your index.
>  If
> > > your documents
> > > are big, this could be a pretty huge latency penalty.
> > >
> > >  -jake
> > >
> >
>
>

--0016e6d7eb46a749220475c39ea3--

From java-user-return-42808-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 21:47:59 2009
Return-Path: <java-user-return-42808-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83597 invoked from network); 12 Oct 2009 21:47:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 21:47:59 -0000
Received: (qmail 36250 invoked by uid 500); 12 Oct 2009 21:47:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36183 invoked by uid 500); 12 Oct 2009 21:47:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36173 invoked by uid 99); 12 Oct 2009 21:47:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:47:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.184 as permitted sender)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 21:47:44 +0000
Received: by ywh14 with SMTP id 14so787876ywh.20
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 14:47:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=1ggcCF+F/2ck0gbEsLb3FMZEeOB3F82VBfWaBJyhnsA=;
        b=ubRAACiMdA5MEIu+OAUpjLY+ZccMVAiLlPD5fT58rP5bwR1dAGnKJNepSqpPn+LW6z
         wekTDi1SxZE2gRg/NBk2I0BoQ7+BjyRS6L7otPVY3fg7yarkcAwKUkS2B9gUD0wE9Mgi
         CtpYOgpSsk6xtQX49Env+258owjdsmSv32w3A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=NjQx3jcIUEUATOjON0Lfdbrg03kz+0Rplc7Kim8pQDOPC6nwBnG7OcAZVakIDJE8uk
         TCYgGRBcQvNw7ECEOtWNwTOJU0kGX+ih9o36Y59DUyb+LOz8x8Tfp3aCcpdVlK0i8kug
         D3awWy7wFONdGPKtK3mtgvNpC9HtDl0df4UdA=
MIME-Version: 1.0
Received: by 10.91.191.17 with SMTP id t17mr3829775agp.51.1255384042909; Mon, 
	12 Oct 2009 14:47:22 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
Date: Mon, 12 Oct 2009 14:47:22 -0700
Message-ID: <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e646182eef31890475c3df32
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e646182eef31890475c3df32
Content-Type: text/plain; charset=ISO-8859-1

I still see some things we might want to document or explain:

We still need to be careful what the call to "isCurrent()"
will mean in the future for IndexReaders - as now there is another
kind of "current" - "current even up to uncommitted changes".

Imagine the following set of IndexReaders floating around an
application:
------
1)  IndexReader reader = IndexReader.open(diskDir);

// this reader is certainly current.
2)  assert(reader.isCurrent());

3)  IndexWriter writer = new IndexWriter(diskDir);
4)  writer.addDocument(doc);

// this reader has access to that doc
5)  IndexReader nrtReader = writer.getReader();

6)  writer.addDocument(doc2);

// now for the isCurrent() semantics... the disk reader is
// still current, as of last commit:
7)  assert(reader.isCurrent());

// as is the nrtReader, even though it has information
// *past* the most recent commit, but not all of it!
8) assert(nrtReader.isCurrent());

// reopen the nrtReader and get access to doc2
9) nrtReader = writer.getReader();

// now nrtReader is not only current, but "maximally current"
10) assert(nrtReader.isCurrent());

// but what about now?
11)  writer.commit();

// the disk index reader follows the old ways:
12)  assert(!reader.isCurrent());

// but what does the nrtReader say?
// it does not have access to the most recent commit
// state, as there's been a commit (with documents)
// since it was opened.  But the nrtReader *has* those
// documents.

13)  assert(!nrtReader.isCurrent());
-----

The result of lines 8 and 13 especially seem to show how
one could get confused on what is meant by current - but
it maybe is just a naming issue (although line 13 seems
to be more than that: the nrtReader in that case really is
up-to-date with disk at this point, and would show exactly
the results which a freshly opened reader would).

Maybe people should be advised to not mix and match
disk readers and IndexWriter supplied ones, and if they
want NRT search with lucene 2.9+, they grab a reader from
the IndexWriter upon opening said writer, and then just
continually call reopen() on it as queries come in
throughout the life of their application (being careful not
to close() their writer and thus trigger an
AlreadyClosedException)?

  -jake


On Mon, Oct 12, 2009 at 1:56 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> I agree, the javadocs could be improved.  How about something like
> this for the first 2 paragraphs:
>
>   * Returns a readonly reader, covering all committed as
>   * well as un-committed changes to the index.  This
>    * provides "near real-time" searching, in that changes
>    * made during an IndexWriter session can be quickly made
>   * available for searching without closing the writer nor
>   * calling {@link #commit}.
>   *
>   * <p>Note that this is functionally equivalent to calling
>   * {#commit} and then using {@link IndexReader#open} to
>   * open a new reader.  But the turarnound time of this
>   * method should be faster since it avoids the potentially
>   * costly {@link #commit}.<p>
>
> Mike
>
> On Mon, Oct 12, 2009 at 4:35 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> > Thanks Yonik,
> >
> >  It may be surprising, but in fact I have read that
> > javadoc.  It talks about not needing to close the
> > writer, but doesn't specifically talk about the what
> > the relationship between commit() calls and
> > getReader() calls is.  I suppose I should have
> > interpreted:
> >
> > "@returns a new reader which contains all
> > changes..."
> >
> > to mean "all uncommitted changes", but why
> > is it so obvious that what could be happening
> > is that it only "returns all changes since the last
> > commit, but without touching disk because it
> > has docs in memory as well"?
> >
> >  -jake
> >
> > On Mon, Oct 12, 2009 at 1:26 PM, Yonik Seeley <
> yonik@lucidimagination.com>wrote:
> >
> >> Guys, please - you're not new at this... this is what JavaDoc is for:
> >>
> >>  /**
> >>   * Returns a readonly reader containing all
> >>   * current updates.  Flush is called automatically.  This
> >>   * provides "near real-time" searching, in that changes
> >>   * made during an IndexWriter session can be made
> >>   * available for searching without closing the writer.
> >>   *
> >>   * <p>It's near real-time because there is no hard
> >>   * guarantee on how quickly you can get a new reader after
> >>   * making changes with IndexWriter.  You'll have to
> >>   * experiment in your situation to determine if it's
> >>   * fast enough.  As this is a new and experimental
> >>   * feature, please report back on your findings so we can
> >>   * learn, improve and iterate.</p>
> >>   *
> >>   * <p>The resulting reader supports {@link
> >>   * IndexReader#reopen}, but that call will simply forward
> >>   * back to this method (though this may change in the
> >>   * future).</p>
> >>   *
> >>   * <p>The very first time this method is called, this
> >>   * writer instance will make every effort to pool the
> >>   * readers that it opens for doing merges, applying
> >>   * deletes, etc.  This means additional resources (RAM,
> >>   * file descriptors, CPU time) will be consumed.</p>
> >>   *
> >>   * <p>For lower latency on reopening a reader, you should
> >>   * call {@link #setMergedSegmentWarmer} to
> >>   * pre-warm a newly merged segment before it's committed
> >>   * to the index.  This is important for minimizing
> >>   * index-to-search delay after a large merge.  </p>
> >>   *
> >>   * <p>If an addIndexes* call is running in another thread,
> >>   * then this reader will only search those segments from
> >>   * the foreign index that have been successfully copied
> >>   * over, so far</p>.
> >>   *
> >>   * <p><b>NOTE</b>: Once the writer is closed, any
> >>   * outstanding readers may continue to be used.  However,
> >>   * if you attempt to reopen any of those readers, you'll
> >>   * hit an {@link AlreadyClosedException}.</p>
> >>   *
> >>   * <p><b>NOTE:</b> This API is experimental and might
> >>   * change in incompatible ways in the next release.</p>
> >>   *
> >>   * @return IndexReader that covers entire index plus all
> >>   * changes made so far by this IndexWriter instance
> >>   *
> >>   * @throws IOException
> >>   */
> >>  public IndexReader getReader() throws IOException {
> >>
> >>
> >> -Yonik
> >> http://www.lucidimagination.com
> >>
> >>
> >> On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrote:
> >> > Oh, that is really good to know!
> >> > Is this deterministic? e.g. as long as writer.addDocument() is called,
> >> next
> >> > getReader reflects the change? Does it work with deletes? e.g.
> >> > writer.deleteDocuments()?
> >> > Thanks Mike for clarifying!
> >> >
> >> > -John
> >> >
> >> > On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
> >> > lucene@mikemccandless.com> wrote:
> >> >
> >> >> Just to clarify: IndexWriter.newReader returns a reader that searches
> >> >> uncommitted changes as well.  Ie, you need not call
> IndexWriter.commit
> >> >> to make the changes visible.
> >> >>
> >> >> However, if you're opening a reader the "normal" way
> >> >> (IndexReader.open) then it is necessary to first call
> >> >> IndexWriter.commit.
> >> >>
> >> >> Mike
> >> >>
> >> >> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
> >> >> wrote:
> >> >> >
> >> >> > Hi,
> >> >> >
> >> >> > I'm going to replace an old reader/writer synchronization mechanism
> we
> >> >> had
> >> >> > implemented with the new near realtime search facilities in Lucene
> >> 2.9.
> >> >> > However, it's still a bit unclear on how to efficiently do it.
> >> >> >
> >> >> > Is the following implementation the good way to do achieve it ? The
> >> >> context
> >> >> > is concurrent read/writes on an index :
> >> >> >
> >> >> > 1. create a Directory instance
> >> >> > 2. create a writer on this directory
> >> >> > 3. on each write request, add document to the writer
> >> >> > 4. on each read request,
> >> >> >  a. use writer.getReader() to obtain an up-to-date reader
> >> >> >  b. create an IndexSearcher with that reader
> >> >> >  c. perform Query
> >> >> >  d. close IndexSearcher
> >> >> > 5. on application close
> >> >> >  a. close writer
> >> >> >  b. close directory
> >> >> >
> >> >> > While this seems to be ok, I'm really wondering about the
> performance
> >> of
> >> >> > opening a searcher for each request. I could introduce some kind of
> >> delay
> >> >> > and cache a searcher for some seconds, but I'm not sure it's the
> best
> >> >> thing
> >> >> > to do.
> >> >> >
> >> >> > Thanks,
> >> >> >
> >> >> > Cedric
> >> >> >
> >> >> >
> >> >> > --
> >> >> > View this message in context:
> >> >>
> >>
> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
> >> >> > Sent from the Lucene - Java Users mailing list archive at
> Nabble.com.
> >> >> >
> >> >> >
> >> >> >
> ---------------------------------------------------------------------
> >> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >> >
> >> >> >
> >> >>
> >> >> ---------------------------------------------------------------------
> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >>
> >> >>
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e646182eef31890475c3df32--

From java-user-return-42809-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 22:04:18 2009
Return-Path: <java-user-return-42809-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86623 invoked from network); 12 Oct 2009 22:04:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 22:04:18 -0000
Received: (qmail 56881 invoked by uid 500); 12 Oct 2009 22:04:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56797 invoked by uid 500); 12 Oct 2009 22:04:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56787 invoked by uid 99); 12 Oct 2009 22:04:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 22:04:15 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 22:04:04 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MxSzX-0002jB-S1
	for java-user@lucene.apache.org; Mon, 12 Oct 2009 15:03:43 -0700
Message-ID: <25863095.post@talk.nabble.com>
Date: Mon, 12 Oct 2009 15:03:43 -0700 (PDT)
From: melix <cedric.champeau@lingway.com>
To: java-user@lucene.apache.org
Subject: Re: Realtime search best practices
In-Reply-To: <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: cedric.champeau@lingway.com
References: <25852756.post@talk.nabble.com> <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com> <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com> <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com> <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org


Ok, thanks for the details. I see I'm not the only one finding the javadoc
hard to understand. While this is well documented, it's still not clear
enough about the exact semantics of "changes" : at first I thought it
returned an IndexReader on the *uncommited changes only*, which meant it did
not include commited ones. Well, it should have been obvious that I couldn't
do anything with such a reader but you know ;)

I'll try to implement something on that. I think it won't be so difficult as
I've got many writes and less reads. It means that the performance penalty
of creating a searcher should be acceptable. However, I'll keep you in
touch.


Jake Mannix wrote:
> 
> Thanks Yonik,
> 
>   It may be surprising, but in fact I have read that
> javadoc.  It talks about not needing to close the
> writer, but doesn't specifically talk about the what
> the relationship between commit() calls and
> getReader() calls is.  I suppose I should have
> interpreted:
> 
> "@returns a new reader which contains all
> changes..."
> 
> to mean "all uncommitted changes", but why
> is it so obvious that what could be happening
> is that it only "returns all changes since the last
> commit, but without touching disk because it
> has docs in memory as well"?
> 
>   -jake
> 
> On Mon, Oct 12, 2009 at 1:26 PM, Yonik Seeley
> <yonik@lucidimagination.com>wrote:
> 
>> Guys, please - you're not new at this... this is what JavaDoc is for:
>>
>>  /**
>>   * Returns a readonly reader containing all
>>   * current updates.  Flush is called automatically.  This
>>   * provides "near real-time" searching, in that changes
>>   * made during an IndexWriter session can be made
>>   * available for searching without closing the writer.
>>   *
>>   * <p>It's near real-time because there is no hard
>>   * guarantee on how quickly you can get a new reader after
>>   * making changes with IndexWriter.  You'll have to
>>   * experiment in your situation to determine if it's
>>   * fast enough.  As this is a new and experimental
>>   * feature, please report back on your findings so we can
>>   * learn, improve and iterate.</p>
>>   *
>>   * <p>The resulting reader supports {@link
>>   * IndexReader#reopen}, but that call will simply forward
>>   * back to this method (though this may change in the
>>   * future).</p>
>>   *
>>   * <p>The very first time this method is called, this
>>   * writer instance will make every effort to pool the
>>   * readers that it opens for doing merges, applying
>>   * deletes, etc.  This means additional resources (RAM,
>>   * file descriptors, CPU time) will be consumed.</p>
>>   *
>>   * <p>For lower latency on reopening a reader, you should
>>   * call {@link #setMergedSegmentWarmer} to
>>   * pre-warm a newly merged segment before it's committed
>>   * to the index.  This is important for minimizing
>>   * index-to-search delay after a large merge.  </p>
>>   *
>>   * <p>If an addIndexes* call is running in another thread,
>>   * then this reader will only search those segments from
>>   * the foreign index that have been successfully copied
>>   * over, so far</p>.
>>   *
>>   * <p>NOTE: Once the writer is closed, any
>>   * outstanding readers may continue to be used.  However,
>>   * if you attempt to reopen any of those readers, you'll
>>   * hit an {@link AlreadyClosedException}.</p>
>>   *
>>   * <p>NOTE: This API is experimental and might
>>   * change in incompatible ways in the next release.</p>
>>   *
>>   * @return IndexReader that covers entire index plus all
>>   * changes made so far by this IndexWriter instance
>>   *
>>   * @throws IOException
>>   */
>>  public IndexReader getReader() throws IOException {
>>
>>
>> -Yonik
>> http://www.lucidimagination.com
>>
>>
>> On Mon, Oct 12, 2009 at 4:18 PM, John Wang <john.wang@gmail.com> wrote:
>> > Oh, that is really good to know!
>> > Is this deterministic? e.g. as long as writer.addDocument() is called,
>> next
>> > getReader reflects the change? Does it work with deletes? e.g.
>> > writer.deleteDocuments()?
>> > Thanks Mike for clarifying!
>> >
>> > -John
>> >
>> > On Mon, Oct 12, 2009 at 12:11 PM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> Just to clarify: IndexWriter.newReader returns a reader that searches
>> >> uncommitted changes as well.  Ie, you need not call IndexWriter.commit
>> >> to make the changes visible.
>> >>
>> >> However, if you're opening a reader the "normal" way
>> >> (IndexReader.open) then it is necessary to first call
>> >> IndexWriter.commit.
>> >>
>> >> Mike
>> >>
>> >> On Mon, Oct 12, 2009 at 5:24 AM, melix <cedric.champeau@lingway.com>
>> >> wrote:
>> >> >
>> >> > Hi,
>> >> >
>> >> > I'm going to replace an old reader/writer synchronization mechanism
>> we
>> >> had
>> >> > implemented with the new near realtime search facilities in Lucene
>> 2.9.
>> >> > However, it's still a bit unclear on how to efficiently do it.
>> >> >
>> >> > Is the following implementation the good way to do achieve it ? The
>> >> context
>> >> > is concurrent read/writes on an index :
>> >> >
>> >> > 1. create a Directory instance
>> >> > 2. create a writer on this directory
>> >> > 3. on each write request, add document to the writer
>> >> > 4. on each read request,
>> >> >  a. use writer.getReader() to obtain an up-to-date reader
>> >> >  b. create an IndexSearcher with that reader
>> >> >  c. perform Query
>> >> >  d. close IndexSearcher
>> >> > 5. on application close
>> >> >  a. close writer
>> >> >  b. close directory
>> >> >
>> >> > While this seems to be ok, I'm really wondering about the
>> performance
>> of
>> >> > opening a searcher for each request. I could introduce some kind of
>> delay
>> >> > and cache a searcher for some seconds, but I'm not sure it's the
>> best
>> >> thing
>> >> > to do.
>> >> >
>> >> > Thanks,
>> >> >
>> >> > Cedric
>> >> >
>> >> >
>> >> > --
>> >> > View this message in context:
>> >>
>> http://www.nabble.com/Realtime-search-best-practices-tp25852756p25852756.html
>> >> > Sent from the Lucene - Java Users mailing list archive at
>> Nabble.com.
>> >> >
>> >> >
>> >> >
>> ---------------------------------------------------------------------
>> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 
> 

-- 
View this message in context: http://www.nabble.com/Realtime-search-best-practices-tp25852756p25863095.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42810-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 22:13:18 2009
Return-Path: <java-user-return-42810-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88506 invoked from network); 12 Oct 2009 22:13:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 22:13:18 -0000
Received: (qmail 64263 invoked by uid 500); 12 Oct 2009 22:13:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64198 invoked by uid 500); 12 Oct 2009 22:13:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64188 invoked by uid 99); 12 Oct 2009 22:13:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 22:13:15 +0000
X-ASF-Spam-Status: No, hits=-1.9 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 22:13:12 +0000
Received: by ewy19 with SMTP id 19so9402075ewy.28
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 15:12:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=mLOZL422YbYLbQKJuElrzfl7egYPaRAt8N8XRXES4FY=;
        b=lTaMFZzuBdY2UZgaAnybaU7uJzDKHoZVyU0HDu0hYcBnv2LTWnX9MnE02isPuUfMMT
         W7KbWWrke/i4awCIKE+EaogbRiCNnPoQdhRV4FSm0njjgr8DFTZKIC4B5jrGdKMk1fPg
         zxhrilsugp8UxVJ+9Um6kUWBjbEC+CG8xPRc4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=XAhHVN4nOujESnc2Y70SLGZqp05KJfgUDLlBD0/B5G2/hoYrgnvazrqzitQFlHOvLd
         RaVFgJsIHmROtx0LNiqouR760Mwicr/qtKXr/FOYBV6mVRY2vk2/D/bivEeMUkbwheZM
         d/OKhbepiIhVyhnk0D6x2l0icJBNivBZ3tf7M=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.88.146 with SMTP id a18mr2106951wef.56.1255385570900; Mon, 
	12 Oct 2009 15:12:50 -0700 (PDT)
In-Reply-To: <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
	 <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com>
Date: Mon, 12 Oct 2009 18:12:50 -0400
X-Google-Sender-Auth: f7e9aa95833af3e6
Message-ID: <c68e39170910121512r3cfb30c1s49c43b9e36b391bf@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Good point on isCurrent - I think it should only be with respect to
the latest index commit point? and we should clarify that in the
javadoc.

[...]
> // but what does the nrtReader say?
> // it does not have access to the most recent commit
> // state, as there's been a commit (with documents)
> // since it was opened. =A0But the nrtReader *has* those
> // documents.

I think we keep it simple - the nrtReader.isCurrent() would return
false after a commit is called.
Yes, isCurrent() is no longer such a great name.

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42811-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 12 23:33:09 2009
Return-Path: <java-user-return-42811-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8409 invoked from network); 12 Oct 2009 23:33:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 12 Oct 2009 23:33:09 -0000
Received: (qmail 64650 invoked by uid 500); 12 Oct 2009 23:33:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64565 invoked by uid 500); 12 Oct 2009 23:33:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64555 invoked by uid 99); 12 Oct 2009 23:33:06 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 23:33:06 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of eangel@business.com designates 216.52.219.147 as permitted sender)
Received: from [216.52.219.147] (HELO mx01.business.com) (216.52.219.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 Oct 2009 23:33:03 +0000
Received: from unknown (HELO exchg04.corp.business.com) ([10.1.0.24])
  by mx00.business.com with ESMTP; 12 Oct 2009 16:32:36 -0700
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
Subject: RE: querying multi-value fields
Date: Mon, 12 Oct 2009 16:32:32 -0700
Message-ID: <DEC11051901DCC43BD47EC508118AD86089AC422@exchg04.corp.business.com>
In-Reply-To: <359a92830910121347w6286f40dr9f0b6e4cd6cd800@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: querying multi-value fields
Thread-Index: AcpLfVB+11rIOJNJRyqpO1zXKftrwQAFm3+Q
References: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com> <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com> <4b124c310910121325n479d6e94vfc933a4a296ff567@mail.gmail.com> <DEC11051901DCC43BD47EC508118AD86089AC21C@exchg04.corp.business.com> <359a92830910121347w6286f40dr9f0b6e4cd6cd800@mail.gmail.com>
From: "Angel, Eric" <eangel@business.com>
To: <java-user@lucene.apache.org>

Erick,

Thank you.  This is awesome.  I got it to work by just setting slop to 1
and returning 10 in my analyzer.getPositionIncrementGap.  Here are my
tests in case anyone else is interested:


public class TestPositionIncrementGap extends TestCase {
=09
	Analyzer analyzer =3D new KeywordAnalyzer();
	RAMDirectory dir =3D null;
	IndexWriter writer =3D null;
	IndexSearcher searcher =3D null;
	@Override
	protected void setUp() throws Exception {
		super.setUp();
		dir =3D new RAMDirectory();
		writer =3D new IndexWriter(dir, analyzer,
MaxFieldLength.LIMITED);
	=09
		Document d =3D new Document();
		d.add(new Field("keyword", "aaa bbb", Field.Store.YES,
Field.Index.ANALYZED));
		d.add(new Field("keyword", "ccc ddd eee",
Field.Store.YES, Field.Index.ANALYZED));
		d.add(new Field("keyword", "fff fff", Field.Store.YES,
Field.Index.ANALYZED));
		d.add(new Field("keyword", "banks sales",
Field.Store.YES, Field.Index.ANALYZED));
		d.add(new Field("keyword", "sales mans",
Field.Store.YES, Field.Index.ANALYZED));
		writer.addDocument(d);
		writer.close();
	}
	@Override
	protected void tearDown() throws Exception {
		super.tearDown();
		dir =3D null;
		writer =3D null;
		searcher =3D null;
	}
=09
	public void testMatchOnSingleExactValue() throws Exception {
		searcher =3D new IndexSearcher(dir, true);
		PhraseQuery pq =3D new PhraseQuery();
		pq.setSlop(1);
		pq.add(new Term("keyword", "aaa"));
		pq.add(new Term("keyword", "bbb"));
	=09
		TopDocs td =3D searcher.search(pq, 100);
		searcher.close();
		assertEquals(1, td.totalHits);
	=09
	}
=09
	public void testNoMatchOnAdjacentValue() throws Exception {
		searcher =3D new IndexSearcher(dir, true);
		PhraseQuery pq =3D new PhraseQuery();
		pq.setSlop(1);
		pq.add(new Term("keyword", "bbb"));
		pq.add(new Term("keyword", "ccc"));
	=09
		TopDocs td =3D searcher.search(pq, 100);
		assertEquals(0, td.totalHits);
		searcher.close();
	}
=09
	public void testNoMatchOnSingleReveredValue() throws Exception {
		searcher =3D new IndexSearcher(dir, true);
		PhraseQuery pq =3D new PhraseQuery();
		pq.setSlop(1);
		pq.add(new Term("keyword", "bbb"));
		pq.add(new Term("keyword", "aaa"));
	=09
		TopDocs td =3D searcher.search(pq, 100);
		assertEquals(0, td.totalHits);
		searcher.close();
	}
=09
	public void testNoMatchOnSpannedValue() throws Exception {
		searcher =3D new IndexSearcher(dir, true);
		PhraseQuery pq =3D new PhraseQuery();
		pq.setSlop(1);
		pq.add(new Term("keyword", "aaa"));
		pq.add(new Term("keyword", "mans"));
	=09
		TopDocs td =3D searcher.search(pq, 100);
		assertEquals(0, td.totalHits);
		searcher.close();
	}
=09
	public void testMatchOnSingleExactValue2() throws Exception {
		searcher =3D new IndexSearcher(dir, true);
		PhraseQuery pq =3D new PhraseQuery();
		pq.setSlop(1);
		pq.add(new Term("keyword", "fff"));
		pq.add(new Term("keyword", "fff"));
	=09
		TopDocs td =3D searcher.search(pq, 100);
		searcher.close();
		assertEquals(1, td.totalHits);
	=09
	}
}

-----Original Message-----
From: Erick Erickson [mailto:erickerickson@gmail.com]=20
Sent: Monday, October 12, 2009 1:48 PM
To: java-user@lucene.apache.org
Subject: Re: querying multi-value fields

<<<I think Lucene sees all these values as one long
value for the field "option">>>
Not quite. Starting with the second add, a call will be made to
getPositionIncrementGap in your analyzer. If you return a number
larger than one, then the offsets between the last term of the
preceeding
add and the first term of this add will be that number. If you do
nothing
with getPositionIncrementGap, then Lucene does, indeed, see all
the terms as one long value since it returns 1.....

Here's an illusrtation in which PositionIncrementGap returns
an offset of 10 using your example adds.

Note, these numbers may be off by the infamous 1 or even 2.

term      offset
value1     0
aaa         1
value2     11
bbb         12
value3     22
ccc        23


So, you really don't care about the slop, since you can set it to less
than
the
magic number you return from PositionIncrementGap. BTW, slop indicates
holes, not total terms. So with a slop of 0 all the words need to be
next to
each other, regardless of whether there are two words or 20. But you
still
have to do the trick with getPositionIncrementGap in order to fail to
match
on something like "bbb value3", where the last term is next to the frist
term
of the next token......

HTH
Erick



On Mon, Oct 12, 2009 at 4:31 PM, Angel, Eric <eangel@business.com>
wrote:

> I need to analyze these values since I also want the benefits
> porterStemmer.  The problem with using PhraseQuery is that I don't
> always know the slop.  I may have values like "value4 ddd aaa".  It's
a
> tricky problem because I think Lucene sees all these values as one
long
> value for the field "option".
>
> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Monday, October 12, 2009 1:25 PM
> To: java-user@lucene.apache.org
> Subject: Re: querying multi-value fields
>
> Or else just make sure that you use PhraseQuery to hit this field when
> you
> want "value1 aaa".  If you don't tokenize these pairs, then you will
> have to
>
> do prefix/wildcard matching to hit just "value1" by itself (if this is
> allowed
> by your business logic).
>
>  -jake
>
> On Mon, Oct 12, 2009 at 1:21 PM, Adriano Crestani
> <adrianocrestani@gmail.com
> > wrote:
>
> > Hi Eric,
> >
> > To achieve what you want, do not tokenize the values you query/add
to
> this
> > field.
> >
> > On Mon, Oct 12, 2009 at 4:05 PM, Angel, Eric <eangel@business.com>
> wrote:
> >
> > > I have documents that store multiple values in some fields (using
> the
> > > document.add(new Field()) with the same field name).  Here's what
a
> > > typical document looks like:
> > >
> > >
> > >
> > > doc.option=3D"value1 aaa"
> > >
> > > doc.option=3D"value2 bbb"
> > >
> > > doc.option=3D"value3 ccc"
> > >
> > >
> > >
> > > I want my queries to only match individual values, for example, a
> query
> > > for "value2 bbb" would return the above document, but a query for
> > > "value1 ccc" should not.  Is this at all possible in lucene at
query
> > > time?  Could payloads be used for this?
> > >
> > >
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42812-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 02:47:14 2009
Return-Path: <java-user-return-42812-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94677 invoked from network); 13 Oct 2009 02:47:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 02:47:14 -0000
Received: (qmail 84951 invoked by uid 500); 13 Oct 2009 02:47:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84873 invoked by uid 500); 13 Oct 2009 02:47:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84863 invoked by uid 99); 13 Oct 2009 02:47:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 02:47:11 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of twdsilva@gmail.com designates 209.85.221.172 as permitted sender)
Received: from [209.85.221.172] (HELO mail-qy0-f172.google.com) (209.85.221.172)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 02:46:59 +0000
Received: by qyk2 with SMTP id 2so8460686qyk.21
        for <java-user@lucene.apache.org>; Mon, 12 Oct 2009 19:46:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :content-type:mime-version:subject:date:x-mailer;
        bh=XJf4gfUGEKhXzyOw0bSmw0L5VvPkPDMQxObriEJ8qh0=;
        b=UVNA9FXLTcxTwtHRwrHXbVdaDfNEY9cLzdST8ps01KFhOWw2fukIFVmRLMe7s5w7IF
         SjV5E05O02mxk9Y9Q7ne0/YfS9eJQ/C7fLcWyim2mw6YjC0PQ90luPm9oxmZHbzBNwHB
         LIhvuxPjiPfLFRhxDMQL7UFs9jOD+CpOJTLoM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:content-type:mime-version:subject:date:x-mailer;
        b=QyN6WZ6pni2xh7kj5Ja3OkehnZQbntE91zGaeA8ssLbVPC8R+E0sa92Py26vltfQoo
         E9n7J4yxpnbWtvOzcUE9oyn2Dqe+zAwWH4MVr+x6cmu1vC2fywyZ/hLxhMg9wvB+9F7T
         JqD1EIJiaO38T2odcpNW2L+2D48pNXXJkWMm0=
Received: by 10.224.94.78 with SMTP id y14mr5336479qam.216.1255401998415;
        Mon, 12 Oct 2009 19:46:38 -0700 (PDT)
Received: from ?192.168.2.51? ([99.188.123.252])
        by mx.google.com with ESMTPS id 2sm1873965qwi.29.2009.10.12.19.46.37
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 12 Oct 2009 19:46:38 -0700 (PDT)
Message-Id: <1F08B0FA-152A-4C3A-980F-8B3F49C8AD0E@gmail.com>
From: Thomas D'Silva <twdsilva@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=Apple-Mail-36-69406078
Mime-Version: 1.0 (Apple Message framework v935.3)
Subject: Using TermVectorMapper to compute term frequency across documents
Date: Mon, 12 Oct 2009 21:46:36 -0500
X-Mailer: Apple Mail (2.935.3)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-36-69406078
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: 7bit

Hi,

I am trying to compute the counts of terms of the documents returned  
by running a query using a TermVectorMapper.
I was wondering if anyone knew if there was a faster way to do this  
rather than using a HashMap with a TermVectorMapper to store the  
counts of the terms and calling getTermFreqVector().
I do not require the term frequency within a document.

Thanks,
Thomas

HashMap termDocCount = new HashMap();
TermQuery tagQuery = new TermQuery(tagTerm);
TopDocs docs = searcher.search(tagQuery, numDocs);
for (int i=0 ; i<docs.scoreDocs.length; ++i) {
	ScoreDoc sdoc=docs.scoreDocs[i];
	Document doc = ir.document(sdoc.doc);
	//iterate over a subset of index fields
	for (int j=0; j <fieldNames.length; ++j) {
		String fieldName=fieldNames[j];
		DocTermVectorMapper vMapper=new DocTermVectorMapper(termDocCount);
		ir.getTermFreqVector(sdoc.doc, fieldName,vMapper);
	}
}

  private class DocTermVectorMapper extends TermVectorMapper {
     	
     	private HashMap termDocCount;
     	private String currField;
     	
     	DocTermVectorMapper(HashMap termDocCount) {
     		this.termDocCount=termDocCount;
     	}
     	
     	public boolean isIgnoringOffsets() {
     		return true;
     	}
     	
     	public boolean isIgnoringPositions() {
     		return true;
     	}

	public void map(String term, int frequency, TermVectorOffsetInfo[]  
offsets, int[] positions) {
		Term t=new Term(currField,term);
		if (!termDocCount.containsKey(t))
			termDocCount.put(t, new Int());
		else {
			((Int)termDocCount.get(t)).x++;
		}
	}

	public void setExpectations(String field, int numTerms, boolean  
storeOffsets, boolean storePositions) {
		currField=field;
	}
  }

  private class Int {
       	int x;
         Int() {
           x = 1;
         }
}
--Apple-Mail-36-69406078--

From java-user-return-42813-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 07:29:38 2009
Return-Path: <java-user-return-42813-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73376 invoked from network); 13 Oct 2009 07:29:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 07:29:38 -0000
Received: (qmail 4947 invoked by uid 500); 13 Oct 2009 07:29:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4863 invoked by uid 500); 13 Oct 2009 07:29:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4853 invoked by uid 99); 13 Oct 2009 07:29:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 07:29:34 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [194.109.24.29] (HELO smtp-vbr9.xs4all.nl) (194.109.24.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 07:29:23 +0000
Received: from k8u.localnet (porta.xs4all.nl [83.163.165.214])
	by smtp-vbr9.xs4all.nl (8.13.8/8.13.8) with ESMTP id n9D7T3B6074622
	for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 09:29:03 +0200 (CEST)
	(envelope-from paul.elschot@xs4all.nl)
From: Paul Elschot <paul.elschot@xs4all.nl>
To: java-user@lucene.apache.org
Subject: Re: faceted search performance
Date: Tue, 13 Oct 2009 09:29:02 +0200
User-Agent: KMail/1.11.2 (Linux/2.6.28-15-generic; KDE/4.2.2; i686; ; )
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com> <200910122254.37869.paul.elschot@xs4all.nl> <8669da1e0910121429o1e50c63u17bee88d730052ff@mail.gmail.com>
In-Reply-To: <8669da1e0910121429o1e50c63u17bee88d730052ff@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative;
  boundary="Boundary-00=_+wC1KzfkuBeS2ny"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200910130929.02862.paul.elschot@xs4all.nl>
X-Virus-Scanned: by XS4ALL Virus Scanner
X-Virus-Checked: Checked by ClamAV on apache.org

--Boundary-00=_+wC1KzfkuBeS2ny
Content-Type: text/plain;
  charset="iso-8859-15"
Content-Transfer-Encoding: 7bit

On Monday 12 October 2009 23:29:07 Christoph Boosz wrote:
> Hi Paul,
> 
> Thanks for your suggestion. I will test it within the next few days.
> However, due to memory limitations, it will only work if the number of hits
> is small enough, am I right?

One can load a single term vector at a time, so in this case the memory
limitation is only in the possibly large map of doc counters per term.
For best performance try and load the term vectors in docId order,
after the original query has completed.

In any case it would be good to somehow limit the number of
documents considered, for example by using the ones with the best
query score.

Limiting the number of terms would also be good, but that less easy.

Regards,
Paul Elschot

> 
> Chris
> 
> 2009/10/12 Paul Elschot <paul.elschot@xs4all.nl>
> 
> > Chris,
> >
> > You could also store term vectors for all docs at indexing
> > time, and add the termvectors for the matching docs into a
> > (large) map of terms in RAM.
> >
> > Regards,
> > Paul Elschot
> >
> >
> > On Monday 12 October 2009 21:30:48 Christoph Boosz wrote:
> > > Hi Jake,
> > >
> > > Thanks for your helpful explanation.
> > > In fact, my initial solution was to traverse each document in the result
> > > once and count the contained terms. As you mentioned, this process took a
> > > lot of memory.
> > > Trying to confine the memory usage with the facet approach, I was
> > surprised
> > > by the decline in performance.
> > > Now I know it's nothing abnormal, at least.
> > >
> > > Chris
> > >
> > >
> > > 2009/10/12 Jake Mannix <jake.mannix@gmail.com>
> > >
> > > > Hey Chris,
> > > >
> > > > On Mon, Oct 12, 2009 at 10:30 AM, Christoph Boosz <
> > > > christoph.boosz@googlemail.com> wrote:
> > > >
> > > > > Thanks for your reply.
> > > > > Yes, it's likely that many terms occur in few documents.
> > > > >
> > > > > If I understand you right, I should do the following:
> > > > > -Write a HitCollector that simply increments a counter
> > > > > -Get the filter for the user query once: new CachingWrapperFilter(new
> > > > > QueryWrapperFilter(userQuery));
> > > > > -Create a TermQuery for each term
> > > > > -Perform the search and read the counter of the HitCollector
> > > > >
> > > > > I did that, but it didn't get faster. Any ideas why?
> > > > >
> > > >
> > > > This killer is the "TermQuery for each term" part - this is huge. You
> > need
> > > > to invert this process,
> > > > and use your query as is, but while walking in the HitCollector, on
> > each
> > > > doc
> > > > which matches
> > > > your query, increment counters for each of the terms in that document
> > > > (which
> > > > means you need
> > > > an in-memory forward lookup for your documents, like a multivalued
> > > > FieldCache - and if you've
> > > > got roughly the same number of terms as documents, this cache is likely
> > to
> > > > be as large as
> > > > your entire index - a pretty hefty RAM cost).
> > > >
> > > > But a good thing to keep in mind is that doing this kind of faceting
> > > > (massively multivalued
> > > > on a huge term-set) requires a lot of computation, even if you have all
> > the
> > > > proper structures
> > > > living in memory:
> > > >
> > > > For each document you look at (which matches your query), you need to
> > look
> > > > at all
> > > > of the terms in that document, and increment a counter for that term.
> >  So
> > > > however much
> > > > time it would normally take for you to do the driving query, it can
> > take as
> > > > much as that
> > > > multiplied by the average number of terms in a document in your index.
> >  If
> > > > your documents
> > > > are big, this could be a pretty huge latency penalty.
> > > >
> > > >  -jake
> > > >
> > >
> >
> >
> 


--Boundary-00=_+wC1KzfkuBeS2ny--

From java-user-return-42814-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 09:20:25 2009
Return-Path: <java-user-return-42814-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15954 invoked from network); 13 Oct 2009 09:20:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 09:20:25 -0000
Received: (qmail 66095 invoked by uid 500); 13 Oct 2009 09:20:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66038 invoked by uid 500); 13 Oct 2009 09:20:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66028 invoked by uid 99); 13 Oct 2009 09:20:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 09:20:22 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of christoph.boosz@googlemail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 09:20:10 +0000
Received: by ewy26 with SMTP id 26so370376ewy.5
        for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 02:19:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ZkL4yPrq2Rl3iXb2T8g7iQhR9DvrxAWpouqIaSUwMLg=;
        b=Lg9lAI8q0S1ATymOL6ftN6E4JV9wekzsLU5aYPsAf2ou1TebaQH69fE/pSaVoT93Vs
         xG82ZefppVmH3EZfMAog7lLn5yLNHGzeYyiBQhaNqKoFa5ZfJ8NA97fAvPKlgwBh9WNm
         oe7ZQ1lggKm+hUd3q691xg4ZGCUtfxdbrpCz4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Cr0ehiRFLAnSmLYlvaS03wFqOhQSdrqkGeyvUZYdUMDU3sua6jtgXjiB6RUHKC6ZsU
         0jxd9zd3aFO74EXkooftEVDtNDD9vocCkwRxuJTjTSIA1a2ntPLex11WGRg3Z3GqCGgs
         22eow+eOSHMQFH49NccYhx7V2OB4WIL95OMZ4=
MIME-Version: 1.0
Received: by 10.216.86.211 with SMTP id w61mr2251038wee.6.1255425590095; Tue, 
	13 Oct 2009 02:19:50 -0700 (PDT)
In-Reply-To: <200910130929.02862.paul.elschot@xs4all.nl>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <200910122254.37869.paul.elschot@xs4all.nl>
	 <8669da1e0910121429o1e50c63u17bee88d730052ff@mail.gmail.com>
	 <200910130929.02862.paul.elschot@xs4all.nl>
Date: Tue, 13 Oct 2009 11:19:50 +0200
Message-ID: <8669da1e0910130219s7c83f6e7o7eb34576afc55e26@mail.gmail.com>
Subject: Re: faceted search performance
From: Christoph Boosz <christoph.boosz@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d7855356ef400475cd8cb7
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e6d7855356ef400475cd8cb7
Content-Type: text/plain; charset=ISO-8859-1

Ok, I will have a shot at the ascending docId order.

Chris

2009/10/13 Paul Elschot <paul.elschot@xs4all.nl>

> On Monday 12 October 2009 23:29:07 Christoph Boosz wrote:
> > Hi Paul,
> >
> > Thanks for your suggestion. I will test it within the next few days.
> > However, due to memory limitations, it will only work if the number of
> hits
> > is small enough, am I right?
>
> One can load a single term vector at a time, so in this case the memory
> limitation is only in the possibly large map of doc counters per term.
> For best performance try and load the term vectors in docId order,
> after the original query has completed.
>
> In any case it would be good to somehow limit the number of
> documents considered, for example by using the ones with the best
> query score.
>
> Limiting the number of terms would also be good, but that less easy.
>
> Regards,
> Paul Elschot
>
> >
> > Chris
> >
> > 2009/10/12 Paul Elschot <paul.elschot@xs4all.nl>
> >
> > > Chris,
> > >
> > > You could also store term vectors for all docs at indexing
> > > time, and add the termvectors for the matching docs into a
> > > (large) map of terms in RAM.
> > >
> > > Regards,
> > > Paul Elschot
> > >
> > >
> > > On Monday 12 October 2009 21:30:48 Christoph Boosz wrote:
> > > > Hi Jake,
> > > >
> > > > Thanks for your helpful explanation.
> > > > In fact, my initial solution was to traverse each document in the
> result
> > > > once and count the contained terms. As you mentioned, this process
> took a
> > > > lot of memory.
> > > > Trying to confine the memory usage with the facet approach, I was
> > > surprised
> > > > by the decline in performance.
> > > > Now I know it's nothing abnormal, at least.
> > > >
> > > > Chris
> > > >
> > > >
> > > > 2009/10/12 Jake Mannix <jake.mannix@gmail.com>
> > > >
> > > > > Hey Chris,
> > > > >
> > > > > On Mon, Oct 12, 2009 at 10:30 AM, Christoph Boosz <
> > > > > christoph.boosz@googlemail.com> wrote:
> > > > >
> > > > > > Thanks for your reply.
> > > > > > Yes, it's likely that many terms occur in few documents.
> > > > > >
> > > > > > If I understand you right, I should do the following:
> > > > > > -Write a HitCollector that simply increments a counter
> > > > > > -Get the filter for the user query once: new
> CachingWrapperFilter(new
> > > > > > QueryWrapperFilter(userQuery));
> > > > > > -Create a TermQuery for each term
> > > > > > -Perform the search and read the counter of the HitCollector
> > > > > >
> > > > > > I did that, but it didn't get faster. Any ideas why?
> > > > > >
> > > > >
> > > > > This killer is the "TermQuery for each term" part - this is huge.
> You
> > > need
> > > > > to invert this process,
> > > > > and use your query as is, but while walking in the HitCollector, on
> > > each
> > > > > doc
> > > > > which matches
> > > > > your query, increment counters for each of the terms in that
> document
> > > > > (which
> > > > > means you need
> > > > > an in-memory forward lookup for your documents, like a multivalued
> > > > > FieldCache - and if you've
> > > > > got roughly the same number of terms as documents, this cache is
> likely
> > > to
> > > > > be as large as
> > > > > your entire index - a pretty hefty RAM cost).
> > > > >
> > > > > But a good thing to keep in mind is that doing this kind of
> faceting
> > > > > (massively multivalued
> > > > > on a huge term-set) requires a lot of computation, even if you have
> all
> > > the
> > > > > proper structures
> > > > > living in memory:
> > > > >
> > > > > For each document you look at (which matches your query), you need
> to
> > > look
> > > > > at all
> > > > > of the terms in that document, and increment a counter for that
> term.
> > >  So
> > > > > however much
> > > > > time it would normally take for you to do the driving query, it can
> > > take as
> > > > > much as that
> > > > > multiplied by the average number of terms in a document in your
> index.
> > >  If
> > > > > your documents
> > > > > are big, this could be a pretty huge latency penalty.
> > > > >
> > > > >  -jake
> > > > >
> > > >
> > >
> > >
> >
>
>

--0016e6d7855356ef400475cd8cb7--

From java-user-return-42815-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 09:24:34 2009
Return-Path: <java-user-return-42815-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16845 invoked from network); 13 Oct 2009 09:24:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 09:24:34 -0000
Received: (qmail 75040 invoked by uid 500); 13 Oct 2009 09:24:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74978 invoked by uid 500); 13 Oct 2009 09:24:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74968 invoked by uid 99); 13 Oct 2009 09:24:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 09:24:32 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [202.86.5.92] (HELO smtp105.mail.in.yahoo.com) (202.86.5.92)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 13 Oct 2009 09:24:20 +0000
Received: (qmail 87459 invoked from network); 13 Oct 2009 09:23:58 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.in;
  h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE;
  b=O50puXpbpSsCaLg9kjKAZNN1WBKSaznBUBrQPDt51OQanai1PYRZRjLWFSZfye7jryfdOr4io+aEVy/fGs2/1WRW9i/U6Vu/yHA3xYKiNPnv1EhMQt1KAvfyWKugPurdXt8O/7yRZa+u0CQanqSOxTYIbvkBgBTTD90WjPu57S8=  ;
Received: from  (emailgane@203.98.194.130 with login)
        by smtp105.mail.in.yahoo.com with SMTP; 13 Oct 2009 14:53:56 +0530 IST
X-Yahoo-SMTP: JObyHkuswBBrNSLZp.Ycd7Boqpr_GQ--
X-YMail-OSG: SHXJT7UVM1kTuYNcL6xkZ9dbo6cMZ5mLy53BIPPGYlOh97i6nD4xlk6YfFY9H9tRJ6qylmRaHb1b6zt_tSN8_PxdPTQgbasH2hkDuZ7WBT.Tya6.INr20vB55hiQ7CBQG1d5Jf6PAxiTLIZggnZs_7hrq7.V8l05pUL.l3SXsORNfSDS7b7ufDWLjQ9QzIgDBEMASmyEaOArAETRubI5v8yVWZ6HHXeHjTsOvs5VIuPHwbPjV_3JGxgWQBJ0fiuDpQlo5.iwOtxsLWvlzZdvzIUU15po
X-Yahoo-Newman-Property: ymail-3
Message-ID: <00d001ca4be6$e3bc9a30$710bc30a@sv.us.sonicwall.com>
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
References: <25852756.post@talk.nabble.com> <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com> <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com> <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com> <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com> <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com> <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com> <c68e39170910121512r3cfb30c1s49c43b9e36b391bf@mail.gmail.com>
Subject: Re: Realtime search best practices
Date: Tue, 13 Oct 2009 14:53:42 +0530
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.3138
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.3138
X-Virus-Checked: Checked by ClamAV on apache.org

Hello all,

In case of 2.4.1, the reader after reopen, will be warmed before actual =
use. In 2.9, public void =
setMergedSegmentWarmer(IndexWriter.IndexReaderWarmer warmer), does =
warming when we do getReader().=20

If we do getReader() for every request then whether it will reduce the =
search performance?=20

Does warming necessarly required in 2.9? If we do warming for the very =
first time is not enough? Do we need to do it on every request?

Regards
Ganesh

----- Original Message -----=20
From: "Yonik Seeley" <yonik@lucidimagination.com>
To: <java-user@lucene.apache.org>
Sent: Tuesday, October 13, 2009 3:42 AM
Subject: Re: Realtime search best practices


Good point on isCurrent - I think it should only be with respect to
the latest index commit point? and we should clarify that in the
javadoc.

[...]
> // but what does the nrtReader say?
> // it does not have access to the most recent commit
> // state, as there's been a commit (with documents)
> // since it was opened. But the nrtReader *has* those
> // documents.

I think we keep it simple - the nrtReader.isCurrent() would return
false after a commit is called.
Yes, isCurrent() is no longer such a great name.

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org

Send instant messages to your online friends http://in.messenger.yahoo.com 

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42816-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 10:05:57 2009
Return-Path: <java-user-return-42816-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30133 invoked from network); 13 Oct 2009 10:05:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 10:05:57 -0000
Received: (qmail 26742 invoked by uid 500); 13 Oct 2009 10:05:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26655 invoked by uid 500); 13 Oct 2009 10:05:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26645 invoked by uid 99); 13 Oct 2009 10:05:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 10:05:55 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 10:05:52 +0000
Received: by ywh14 with SMTP id 14so1124002ywh.20
        for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 03:05:31 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.248.3 with SMTP id v3mr12144310ybh.258.1255428330998; Tue, 
	13 Oct 2009 03:05:30 -0700 (PDT)
In-Reply-To: <c68e39170910121512r3cfb30c1s49c43b9e36b391bf@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
	 <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com>
	 <c68e39170910121512r3cfb30c1s49c43b9e36b391bf@mail.gmail.com>
Date: Tue, 13 Oct 2009 06:05:30 -0400
Message-ID: <9ac0c6aa0910130305o328785r241998732b7a5c13@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I agree isCurrent doesn't work right for an NRT reader.  Right now, it
will always return "true" because it's sharing the segmentInfos in use
by the writer.

Similarly, getVersion will lie.

I'll open an issue to track how to fix it.

Mike

On Mon, Oct 12, 2009 at 6:12 PM, Yonik Seeley
<yonik@lucidimagination.com> wrote:
> Good point on isCurrent - I think it should only be with respect to
> the latest index commit point? and we should clarify that in the
> javadoc.
>
> [...]
>> // but what does the nrtReader say?
>> // it does not have access to the most recent commit
>> // state, as there's been a commit (with documents)
>> // since it was opened. =A0But the nrtReader *has* those
>> // documents.
>
> I think we keep it simple - the nrtReader.isCurrent() would return
> false after a commit is called.
> Yes, isCurrent() is no longer such a great name.
>
> -Yonik
> http://www.lucidimagination.com
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42817-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 10:12:51 2009
Return-Path: <java-user-return-42817-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31528 invoked from network); 13 Oct 2009 10:12:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 10:12:51 -0000
Received: (qmail 41688 invoked by uid 500); 13 Oct 2009 10:12:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41623 invoked by uid 500); 13 Oct 2009 10:12:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41610 invoked by uid 99); 13 Oct 2009 10:12:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 10:12:49 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 10:12:39 +0000
Received: by ywh14 with SMTP id 14so1126565ywh.20
        for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 03:12:17 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.36.2 with SMTP id j2mr12202164ybj.264.1255428737477; Tue, 
	13 Oct 2009 03:12:17 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910130305o328785r241998732b7a5c13@mail.gmail.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
	 <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com>
	 <c68e39170910121512r3cfb30c1s49c43b9e36b391bf@mail.gmail.com>
	 <9ac0c6aa0910130305o328785r241998732b7a5c13@mail.gmail.com>
Date: Tue, 13 Oct 2009 06:12:17 -0400
Message-ID: <9ac0c6aa0910130312u300bac1bye0596b9a47e752b2@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

OK I opened https://issues.apache.org/jira/browse/LUCENE-1976.

Mike

On Tue, Oct 13, 2009 at 6:05 AM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> I agree isCurrent doesn't work right for an NRT reader. =A0Right now, it
> will always return "true" because it's sharing the segmentInfos in use
> by the writer.
>
> Similarly, getVersion will lie.
>
> I'll open an issue to track how to fix it.
>
> Mike
>
> On Mon, Oct 12, 2009 at 6:12 PM, Yonik Seeley
> <yonik@lucidimagination.com> wrote:
>> Good point on isCurrent - I think it should only be with respect to
>> the latest index commit point? and we should clarify that in the
>> javadoc.
>>
>> [...]
>>> // but what does the nrtReader say?
>>> // it does not have access to the most recent commit
>>> // state, as there's been a commit (with documents)
>>> // since it was opened. =A0But the nrtReader *has* those
>>> // documents.
>>
>> I think we keep it simple - the nrtReader.isCurrent() would return
>> false after a commit is called.
>> Yes, isCurrent() is no longer such a great name.
>>
>> -Yonik
>> http://www.lucidimagination.com
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42818-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 10:21:03 2009
Return-Path: <java-user-return-42818-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34380 invoked from network); 13 Oct 2009 10:21:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 10:21:03 -0000
Received: (qmail 60804 invoked by uid 500); 13 Oct 2009 10:21:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60747 invoked by uid 500); 13 Oct 2009 10:21:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60733 invoked by uid 99); 13 Oct 2009 10:21:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 10:21:01 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 10:20:57 +0000
Received: by yxe3 with SMTP id 3so3991267yxe.20
        for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 03:20:35 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.236.17 with SMTP id j17mr12158788ybh.229.1255429235462; 
	Tue, 13 Oct 2009 03:20:35 -0700 (PDT)
In-Reply-To: <00d001ca4be6$e3bc9a30$710bc30a@sv.us.sonicwall.com>
References: <25852756.post@talk.nabble.com>
	 <9ac0c6aa0910121211l17f8192dqcfaa45c3dff41a5c@mail.gmail.com>
	 <8837fb770910121318x6d9f5b06r75bc430413bce662@mail.gmail.com>
	 <c68e39170910121326l78a08e99i2ad231f6882f09eb@mail.gmail.com>
	 <4b124c310910121335j4be9ef85qe25b5bfae22ba00@mail.gmail.com>
	 <9ac0c6aa0910121356g2fd9d678ie86beee270ef3f5a@mail.gmail.com>
	 <4b124c310910121447x6ab131a1ieb726bc9f830c4c0@mail.gmail.com>
	 <c68e39170910121512r3cfb30c1s49c43b9e36b391bf@mail.gmail.com>
	 <00d001ca4be6$e3bc9a30$710bc30a@sv.us.sonicwall.com>
Date: Tue, 13 Oct 2009 06:20:35 -0400
Message-ID: <9ac0c6aa0910130320j13067f57u35abdba557041b03@mail.gmail.com>
Subject: Re: Realtime search best practices
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Oct 13, 2009 at 5:23 AM, Ganesh <emailgane@yahoo.co.in> wrote:

> In case of 2.4.1, the reader after reopen, will be warmed before actual use.

You mean you must warm it after you call reopen, before using it, right?

> In 2.9, public void setMergedSegmentWarmer(IndexWriter.IndexReaderWarmer warmer), does warming when we do getReader().

Right, and this is better that doing your own warming after calling
getReader because warming of newly merged segments won't block your
near real-time turnaround.

> If we do getReader() for every request then whether it will reduce the search performance?

For every search request?  Yes this will always reduce performance,
even worse than simply calling reopen for every search request,
because getReader() forces the writer to flush a new segment.

> Does warming necessarly required in 2.9? If we do warming for the very first time is not enough? Do we need to do it on every request?

It's not "required", but if you don't do it it means the first search
to land after a getReader will pay that warming cost.

Often this cost is negligible.  But, rarely, once a very large segment
merge has completed, the warming of that newly merged segment could be
very large.  This is heavily dependent on the size of your index,
whether your queries are using the FieldCache (doing field sorting, or
using function queries), etc.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42819-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 13 13:23:49 2009
Return-Path: <java-user-return-42819-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 87658 invoked from network); 13 Oct 2009 13:23:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 13 Oct 2009 13:23:49 -0000
Received: (qmail 92167 invoked by uid 500); 13 Oct 2009 13:23:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92060 invoked by uid 500); 13 Oct 2009 13:23:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92050 invoked by uid 99); 13 Oct 2009 13:23:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 13:23:46 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ion.barcan@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 13 Oct 2009 13:23:43 +0000
Received: by fxm2 with SMTP id 2so8819732fxm.28
        for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 06:23:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=2KnstCdLQyu5fhigbDT7+cqT4a6ISTs2Z5gYRWVrEbI=;
        b=Gjv4BwnE4/VtfE8BBThoTngLO7adqdjxoVkE+rtHhypLEd9XUHgczN5GeLjI2/VKKr
         rtmTa/YaVXoHDMOLRW2ZKwL+Fq4WeJOhDQG712PC/26LJvBh63a1YPfzsjahxkOq3FH8
         IljZw6HWisqgmgvDMidLhwv5kUNk16oa0lz+k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=s0NYa7gjQ+ER/a4WDb3smJwbm9D+eo82t0w89Tk3syflJohoBJrkDiQcqjkUh9rCmY
         p6M4Ck9LcXT63CnLLqZGBg1ZLHhat3qeD0yONR/PhOIJHqbJcBNhp+0RvlCxVswg2cHq
         wP+zyYby0gX0D8FP04PDDCqgKfGJfIZOYWjvo=
MIME-Version: 1.0
Received: by 10.204.151.208 with SMTP id d16mr6082154bkw.115.1255440202506; 
	Tue, 13 Oct 2009 06:23:22 -0700 (PDT)
Date: Tue, 13 Oct 2009 16:23:22 +0300
Message-ID: <f8ab01b40910130623xa210d65ycf9e8fc8b7d41d24@mail.gmail.com>
Subject: PhraseQuery in BooleanQuery not working properly in 2.9.0
From: Ion Barcan <ion.barcan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hello,

With the new Lucene 2.9.0 (on a newly built index of approx. 30
million documents) running BooleanQueries containing PhraseQuery does
not work properly. I've verified this on both optimized and
unoptimized index versions.

For example:

lucli> count field1:"john doe"
Searching for: field1:"john doe"
496 total documents

lucli> count +(field1:"john doe")
Searching for: +field1:"john doe"
496 total documents

lucli> count +(field1:"john doe" field1:"john doe")
Searching for: +(field1:"john doe" field1:"john doe")
5 total documents

lucli> count +(+field1:"john doe" field1:"john doe")
Searching for: +(+field1:"john doe" field1:"john doe")
496 total documents

lucli> count +(field1:"john doe" field2:UnmatchedValue)
Searching for: +(field1:"john doe" field2:UnmatchedValue)
5 total documents

lucli> count +(+field1:"john doe" field2:UnmatchedValue)
Searching for: +(+field1:"john doe" field2:UnmatchedValue)
496 total documents

This was also verifiable when I searched using TopScoreDocCollector(N,
true|false), with the call using docsScoredInOrder=false producing
incorrect results.

While debugging I've noticed that for the BooleanQuery containing at
least one MUST clause BooleanScorer2 is used and this produces the
correct number of results, while for BooleanQuery that don't contain
any MUST clause BooleanScorer.score(Collector, int, int) selects up to
a certain number of docs and then it exits prematurely.

Is this behaviour normal? This used to work in Lucene 2.4.x.

I've noticed another user mentioning a similar behaviour
(http://mail-archives.apache.org/mod_mbox/lucene-java-user/200910.mbox/%3C20091008121147.107a8589@pc-4176.kl.dfki.de%3E),
but in my case it's a newly built index, not one that was migrated
from 2.4 to 2.9.

Thanks,
Ionut

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42820-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 14 02:08:27 2009
Return-Path: <java-user-return-42820-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64732 invoked from network); 14 Oct 2009 02:08:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 14 Oct 2009 02:08:27 -0000
Received: (qmail 26315 invoked by uid 500); 14 Oct 2009 02:08:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26245 invoked by uid 500); 14 Oct 2009 02:08:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26235 invoked by uid 99); 14 Oct 2009 02:08:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 02:08:24 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 02:08:21 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 751CD71C8F6; Tue, 13 Oct 2009 19:07:31 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 7275C71C82B
	for <java-user@lucene.apache.org>; Tue, 13 Oct 2009 19:07:31 -0700 (PDT)
Date: Tue, 13 Oct 2009 19:07:31 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: PhraseQuery in BooleanQuery not working properly in 2.9.0
In-Reply-To: <f8ab01b40910130623xa210d65ycf9e8fc8b7d41d24@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0910131901230.4837@radix.cryptio.net>
References: <f8ab01b40910130623xa210d65ycf9e8fc8b7d41d24@mail.gmail.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


: With the new Lucene 2.9.0 (on a newly built index of approx. 30
: million documents) running BooleanQueries containing PhraseQuery does
: not work properly. I've verified this on both optimized and
: unoptimized index versions.

I suspect that this is the same problem as identified in LUCENE-1974, a 
fix has already been identified, and a 2.9.1 release will most likely 
happen very soon...

https://issues.apache.org/jira/browse/LUCENE-1974



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42821-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 14 09:30:12 2009
Return-Path: <java-user-return-42821-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3646 invoked from network); 14 Oct 2009 09:30:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 14 Oct 2009 09:30:11 -0000
Received: (qmail 30591 invoked by uid 500); 14 Oct 2009 09:30:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30507 invoked by uid 500); 14 Oct 2009 09:30:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30495 invoked by uid 99); 14 Oct 2009 09:30:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 09:30:08 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 09:30:00 +0000
Received: by ywh14 with SMTP id 14so2060939ywh.20
        for <java-user@lucene.apache.org>; Wed, 14 Oct 2009 02:29:39 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.76.3 with SMTP id y3mr14515416yba.48.1255512579232; Wed, 
	14 Oct 2009 02:29:39 -0700 (PDT)
In-Reply-To: <f8ab01b40910130623xa210d65ycf9e8fc8b7d41d24@mail.gmail.com>
References: <f8ab01b40910130623xa210d65ycf9e8fc8b7d41d24@mail.gmail.com>
Date: Wed, 14 Oct 2009 05:29:39 -0400
Message-ID: <9ac0c6aa0910140229o495fe9cbp460934fc3e960ffb@mail.gmail.com>
Subject: Re: PhraseQuery in BooleanQuery not working properly in 2.9.0
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

It sounds likely that this is https://issues.apache.org/jira/browse/LUCENE-1974

Is it possible for you to test that patch and verify it resolves your problem?

Mike

On Tue, Oct 13, 2009 at 9:23 AM, Ion Barcan <ion.barcan@gmail.com> wrote:
> Hello,
>
> With the new Lucene 2.9.0 (on a newly built index of approx. 30
> million documents) running BooleanQueries containing PhraseQuery does
> not work properly. I've verified this on both optimized and
> unoptimized index versions.
>
> For example:
>
> lucli> count field1:"john doe"
> Searching for: field1:"john doe"
> 496 total documents
>
> lucli> count +(field1:"john doe")
> Searching for: +field1:"john doe"
> 496 total documents
>
> lucli> count +(field1:"john doe" field1:"john doe")
> Searching for: +(field1:"john doe" field1:"john doe")
> 5 total documents
>
> lucli> count +(+field1:"john doe" field1:"john doe")
> Searching for: +(+field1:"john doe" field1:"john doe")
> 496 total documents
>
> lucli> count +(field1:"john doe" field2:UnmatchedValue)
> Searching for: +(field1:"john doe" field2:UnmatchedValue)
> 5 total documents
>
> lucli> count +(+field1:"john doe" field2:UnmatchedValue)
> Searching for: +(+field1:"john doe" field2:UnmatchedValue)
> 496 total documents
>
> This was also verifiable when I searched using TopScoreDocCollector(N,
> true|false), with the call using docsScoredInOrder=false producing
> incorrect results.
>
> While debugging I've noticed that for the BooleanQuery containing at
> least one MUST clause BooleanScorer2 is used and this produces the
> correct number of results, while for BooleanQuery that don't contain
> any MUST clause BooleanScorer.score(Collector, int, int) selects up to
> a certain number of docs and then it exits prematurely.
>
> Is this behaviour normal? This used to work in Lucene 2.4.x.
>
> I've noticed another user mentioning a similar behaviour
> (http://mail-archives.apache.org/mod_mbox/lucene-java-user/200910.mbox/%3C20091008121147.107a8589@pc-4176.kl.dfki.de%3E),
> but in my case it's a newly built index, not one that was migrated
> from 2.4 to 2.9.
>
> Thanks,
> Ionut
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42822-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 14 10:38:24 2009
Return-Path: <java-user-return-42822-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17776 invoked from network); 14 Oct 2009 10:38:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 14 Oct 2009 10:38:24 -0000
Received: (qmail 20891 invoked by uid 500); 14 Oct 2009 10:38:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20820 invoked by uid 500); 14 Oct 2009 10:38:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20810 invoked by uid 99); 14 Oct 2009 10:38:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 10:38:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ion.barcan@gmail.com designates 209.85.220.206 as permitted sender)
Received: from [209.85.220.206] (HELO mail-fx0-f206.google.com) (209.85.220.206)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 10:38:13 +0000
Received: by fxm2 with SMTP id 2so10038710fxm.28
        for <java-user@lucene.apache.org>; Wed, 14 Oct 2009 03:37:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=VXxcupdDpr4yOzcx8qH8+3Nj9CTq7nDR8D6lqrM2GDU=;
        b=WzaY4BwvNZPYeAMoz/rumKhlBzrRkvnMu8bPGopoMzOOazF3oiQavRTbn4pORXFuzE
         z4KTJ1PlGWsOWOWHaA+0IHYbQGrLYGROLOWgvF29VNZKkpmVsg+gg1Pztz53lvJvoBVk
         GDKUKLcsx5I/wixYyIG+Ic71qB8Jh/24MWjOc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=UyoQbUkq7UsUSiYwwgA7buxdRwvOXcKs425VPQ68uql73jvYZntMh0kufODawnMnpV
         Rmx1QSFB6h20Xs8HWi22JKWG2lYh0cUbFTtE4LjXJA97O6PSve4j08T25BK2kx1u7FYn
         v8dEX5pbc5Wmpw+M9A76Ihw4EDLTYveXEyGHY=
MIME-Version: 1.0
Received: by 10.204.25.207 with SMTP id a15mr621482bkc.8.1255516673533; Wed, 
	14 Oct 2009 03:37:53 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910140229o495fe9cbp460934fc3e960ffb@mail.gmail.com>
References: <f8ab01b40910130623xa210d65ycf9e8fc8b7d41d24@mail.gmail.com>
	 <9ac0c6aa0910140229o495fe9cbp460934fc3e960ffb@mail.gmail.com>
Date: Wed, 14 Oct 2009 13:37:53 +0300
Message-ID: <f8ab01b40910140337h328d13a5hc8d265d0d5f0ba1b@mail.gmail.com>
Subject: Re: PhraseQuery in BooleanQuery not working properly in 2.9.0
From: Ion Barcan <ion.barcan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Yes, the fix in src/java/org/apache/lucene/search/Scorer.java solves
my problem, i.e. the queries return the correct number of results.

On Wed, Oct 14, 2009 at 12:29 PM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> It sounds likely that this is https://issues.apache.org/jira/browse/LUCENE-1974
>
> Is it possible for you to test that patch and verify it resolves your problem?
>
> Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42823-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 14 13:00:12 2009
Return-Path: <java-user-return-42823-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62551 invoked from network); 14 Oct 2009 13:00:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 14 Oct 2009 13:00:12 -0000
Received: (qmail 18792 invoked by uid 500); 14 Oct 2009 13:00:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18749 invoked by uid 500); 14 Oct 2009 13:00:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18739 invoked by uid 99); 14 Oct 2009 13:00:10 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 13:00:10 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 13:00:02 +0000
Received: by yxe3 with SMTP id 3so5038355yxe.20
        for <java-user@lucene.apache.org>; Wed, 14 Oct 2009 05:59:40 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.101.1 with SMTP id y1mr14763333ybb.318.1255525180325; Wed, 
	14 Oct 2009 05:59:40 -0700 (PDT)
Date: Wed, 14 Oct 2009 08:59:40 -0400
Message-ID: <9ac0c6aa0910140559n567b2b31reff363a56888a9d3@mail.gmail.com>
Subject: Big Bad Bug in Lucene 2.9.0
From: Michael McCandless <lucene@mikemccandless.com>
To: Lucene Users <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Team,

There is a nasty bug in 2.9.0, whereby BooleanQuery will sometimes
silently fail to match possibly many documents that it should.
Details are here:

    https://issues.apache.org/jira/browse/LUCENE-1974

Fortunately, there is a very simple workaround: just call
BooleanQuery.setAllowDocsOutOfOrder(false).  This is a static default;
you only have to call it once, before running any searches.

We are working towards getting a 2.9.1 out to fix this bug... if you
know of issues we've fixed on Lucene's trunk that'd be good candidates
for porting back to 2.9.1, speak up!

Sorry,

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42824-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 14 13:15:33 2009
Return-Path: <java-user-return-42824-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69838 invoked from network); 14 Oct 2009 13:15:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 14 Oct 2009 13:15:33 -0000
Received: (qmail 45823 invoked by uid 500); 14 Oct 2009 13:15:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45738 invoked by uid 500); 14 Oct 2009 13:15:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45725 invoked by uid 99); 14 Oct 2009 13:15:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 13:15:30 +0000
X-ASF-Spam-Status: No, hits=-2.4 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [208.97.132.202] (HELO homiemail-a17.g.dreamhost.com) (208.97.132.202)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 14 Oct 2009 13:15:28 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a17.g.dreamhost.com (Postfix) with ESMTPA id 6CEE97A805C
	for <java-user@lucene.apache.org>; Wed, 14 Oct 2009 06:15:07 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Using TermVectorMapper to compute term frequency across documents
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <1F08B0FA-152A-4C3A-980F-8B3F49C8AD0E@gmail.com>
Date: Wed, 14 Oct 2009 09:15:06 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <60033675-941E-405E-911F-C5E859C2DFCA@apache.org>
References: <1F08B0FA-152A-4C3A-980F-8B3F49C8AD0E@gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)


On Oct 12, 2009, at 10:46 PM, Thomas D'Silva wrote:

> Hi,
>
> I am trying to compute the counts of terms of the documents returned  
> by running a query using a TermVectorMapper.
> I was wondering if anyone knew if there was a faster way to do this  
> rather than using a HashMap with a TermVectorMapper to store the  
> counts of the terms and calling getTermFreqVector().
> I do not require the term frequency within a document.
>

I think that is as fast as its going to get unless you have some other  
restrictions that would allow you to use a FieldCache.    Can you  
describe the bigger problem you are trying to solve?

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42825-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 08:15:12 2009
Return-Path: <java-user-return-42825-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26286 invoked from network); 15 Oct 2009 08:15:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 08:15:12 -0000
Received: (qmail 93955 invoked by uid 500); 15 Oct 2009 08:15:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93877 invoked by uid 500); 15 Oct 2009 08:15:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93867 invoked by uid 99); 15 Oct 2009 08:15:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 08:15:08 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ssenecal.work@gmail.com designates 74.125.92.27 as permitted sender)
Received: from [74.125.92.27] (HELO qw-out-2122.google.com) (74.125.92.27)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 08:15:06 +0000
Received: by qw-out-2122.google.com with SMTP id 5so180292qwd.53
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 01:14:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=EJy0Jz2r2FitvB9jFfDWC4BofFLm0ohw8RoD0Y5rHZM=;
        b=fuTQbvF5skW/sl6CLAYzyd5flpQw1vGD9+qAb/RbOGSwJEewF0S36usk+LSKvOClSL
         3dBdEEQdp8phtWsSxZakZnoonxfRahgquorTtVias/vzv3XlDfWJMwcZRYTZY3Wpyciu
         PZRjGhFBKErXfdE/G7ihfS41DE1cwyf3fGRt0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=Pf3q8pZbhhVna0y5XILKvV37EmBOETl03fePXczmD7et5NmSOl1f5K/PPiY4tzPs/q
         Z0aUUZiSIDNwqqFXWtr2aBTRankA5d4iyAdA7dccnhwVS78EzQIw/ozKTfTPwYU3MN4h
         DMOluBvQzdKMYqhH6Xtd5yqT7bPmudMxAG9nI=
MIME-Version: 1.0
Received: by 10.229.11.215 with SMTP id u23mr2543697qcu.91.1255594485744; Thu, 
	15 Oct 2009 01:14:45 -0700 (PDT)
Date: Thu, 15 Oct 2009 17:14:45 +0900
Message-ID: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
Subject: PrefixQueries on large indexes (4M+ Documents) using a partial Query 
	partial Filter solution
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015175766624e05fd0475f4df91

--0015175766624e05fd0475f4df91
Content-Type: text/plain; charset=ISO-8859-1

I know this has been discussed to great length, but I still have not found a
satisfactory solution and I am hoping someone on the list has some ideas...

We have a large index (4M+ Documents) with a handful of Fields.  We need to
perform PrefixQueries on multiple fields.  The problem is that when the
Query gets rewritten, certain fields expand to too many terms and we end up
with TooManyClauses (I know, I know, read the FAQ).  The solution so far has
been to extract the bits of the query which cause TooManyClauses to be
thrown and make them filters:

for every field to be searched {
    try {
        PrefixQuery(term).rewrite();

        if (resulting BooleanQuery contains at least 1 clause) // important,
otherwise 0 results can be returned when >0 should be returned
            add the rewritten query to a BooleanQuery (using SHOULD)
    catch (TMC) {
        PrefixFilter(term)
        add the filter to a BooleanFilter(using SHOULD)
    }
}


Up to Lucene 2.4, this has been working out for us.  However, in Lucene 2.9
this breaks since rewrite() now returns a ConstantScoreQuery.  I changed the
code to automatically make the entire query a filter if TooManyClauses is
ever caught, but this had massive performance implications.  It seems to
have doubled our average query execution time!

Is there a solution to this?  Is there a way I can know that a
ConstantScoreQuery will match at least 1 term (if not, I dont want to add it
to the BooleanQuery)?  Does 2.9 support new features that would aid in this
area?

--0015175766624e05fd0475f4df91--

From java-user-return-42826-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 08:57:38 2009
Return-Path: <java-user-return-42826-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35195 invoked from network); 15 Oct 2009 08:57:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 08:57:38 -0000
Received: (qmail 41211 invoked by uid 500); 15 Oct 2009 08:57:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41126 invoked by uid 500); 15 Oct 2009 08:57:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41116 invoked by uid 99); 15 Oct 2009 08:57:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 08:57:36 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ssenecal.work@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 08:57:27 +0000
Received: by qyk26 with SMTP id 26so475093qyk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 01:57:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=9mj2I3zHDtiEJT+kBHVhwcuXHmHJKA8IK+XAXcTiN3I=;
        b=AQMbc0BrxCQ7KO142DcNxqFjfF6ySp87jze/hLgxMKFe+rO9EOGacZEV6rMyjLtPYd
         d6CFabglHCILY0TyLrrU8TuK4X1iIMJ4U7yDjc06U+s6hHTXGHhsd4r+bSe6TRYg+kdv
         4KKIEqT66EpEqr4Zx6i/LCREhXGYN+p5C724k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=XE5SM28wvlfAmDhGbq4i1panqb3+4NrjifNTw/wHWaw896NpYd28/4ovbJrih0/aLn
         h+RJB4pF/M6vlJYsqSc01Cqrj+NsuEjqC956i6ZpruzVj0ejQnqHxZwBTMW0IYYI3Ft8
         +QGJ89AxjMhksAQkPd/tW9Sz93vx/X16O0Lbs=
MIME-Version: 1.0
Received: by 10.229.1.67 with SMTP id 3mr3896940qce.31.1255597026827; Thu, 15 
	Oct 2009 01:57:06 -0700 (PDT)
In-Reply-To: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
Date: Thu, 15 Oct 2009 17:57:06 +0900
Message-ID: <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364eea10c3dfb50475f576a0
X-Virus-Checked: Checked by ClamAV on apache.org

--0016364eea10c3dfb50475f576a0
Content-Type: text/plain; charset=ISO-8859-1

Sorry for the double post, but I think I can clarify the problem a little
more.

We want to execute:
    query: A | B | C | D
    filter: null

However, C and D cause TooManyClauses, so instead we execute:
    query: A | B
    filter: C | D

My understanding is that Lucene will apply the Filter (C | D) first,
limiting the result set, then apply the Query (A | B).  Is this correct?

If so, the end result is essentially the query: (A | B) & (C | D)

Is there any way I can achieve (A | B | C | D) without putting the entire
query into a filter (which is too slow)?



Shaun


On Thu, Oct 15, 2009 at 5:14 PM, Shaun Senecal <ssenecal.work@gmail.com>wrote:

> I know this has been discussed to great length, but I still have not found
> a satisfactory solution and I am hoping someone on the list has some
> ideas...
>
> We have a large index (4M+ Documents) with a handful of Fields.  We need to
> perform PrefixQueries on multiple fields.  The problem is that when the
> Query gets rewritten, certain fields expand to too many terms and we end up
> with TooManyClauses (I know, I know, read the FAQ).  The solution so far has
> been to extract the bits of the query which cause TooManyClauses to be
> thrown and make them filters:
>
> for every field to be searched {
>     try {
>         PrefixQuery(term).rewrite();
>
>         if (resulting BooleanQuery contains at least 1 clause) //
> important, otherwise 0 results can be returned when >0 should be returned
>             add the rewritten query to a BooleanQuery (using SHOULD)
>     catch (TMC) {
>         PrefixFilter(term)
>         add the filter to a BooleanFilter(using SHOULD)
>     }
> }
>
>
> Up to Lucene 2.4, this has been working out for us.  However, in Lucene 2.9
> this breaks since rewrite() now returns a ConstantScoreQuery.  I changed the
> code to automatically make the entire query a filter if TooManyClauses is
> ever caught, but this had massive performance implications.  It seems to
> have doubled our average query execution time!
>
> Is there a solution to this?  Is there a way I can know that a
> ConstantScoreQuery will match at least 1 term (if not, I dont want to add it
> to the BooleanQuery)?  Does 2.9 support new features that would aid in this
> area?
>

--0016364eea10c3dfb50475f576a0--

From java-user-return-42827-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 09:48:57 2009
Return-Path: <java-user-return-42827-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48184 invoked from network); 15 Oct 2009 09:48:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 09:48:57 -0000
Received: (qmail 7532 invoked by uid 500); 15 Oct 2009 09:48:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7453 invoked by uid 500); 15 Oct 2009 09:48:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7407 invoked by uid 99); 15 Oct 2009 09:48:54 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 09:48:54 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [140.203.201.100] (HELO mx1.nuigalway.ie) (140.203.201.100)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 09:48:51 +0000
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: ApoEAHSM1koKhJ0L/2dsb2JhbADZVIQwBIFb
X-IronPort-AV: E=Sophos;i="4.44,565,1249254000"; 
   d="scan'208";a="50134729"
Received: from unknown (HELO EVS1.ac.nuigalway.ie) ([10.132.157.11])
  by mx1.nuigalway.ie with ESMTP; 15 Oct 2009 10:48:29 +0100
Received: from EVS1.ac.nuigalway.ie ([10.132.157.14]) by EVS1.ac.nuigalway.ie with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 15 Oct 2009 10:48:28 +0100
Received: from [10.2.18.102] ([140.203.154.11]) by EVS1.ac.nuigalway.ie over TLS secured channel with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 15 Oct 2009 10:48:28 +0100
Message-ID: <4AD6EFE2.8090504@deri.org>
Date: Thu, 15 Oct 2009 10:48:18 +0100
From: Renaud Delbru <renaud.delbru@deri.org>
User-Agent: Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.5pre) Gecko/20091014 Lightning/1.0pre Shredder/3.0pre
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: querying multi-value fields
References: <DEC11051901DCC43BD47EC508118AD86089AC1C7@exchg04.corp.business.com> <55e2bf7e0910121321k1cece39bmf0c04e915ba6c114@mail.gmail.com> <4b124c310910121325n479d6e94vfc933a4a296ff567@mail.gmail.com> <DEC11051901DCC43BD47EC508118AD86089AC21C@exchg04.corp.business.com>
In-Reply-To: <DEC11051901DCC43BD47EC508118AD86089AC21C@exchg04.corp.business.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 15 Oct 2009 09:48:28.0800 (UTC) FILETIME=[A5E4D000:01CA4D7C]

Hi,

there is also the SIREn plugin [1] that allows to index multi-valued 
fields, with values of variable length, and to query them individually.

[1] http://siren.sindice.com
-- 
Renaud Delbru

On 12/10/09 21:31, Angel, Eric wrote:
> I need to analyze these values since I also want the benefits
> porterStemmer.  The problem with using PhraseQuery is that I don't
> always know the slop.  I may have values like "value4 ddd aaa".  It's a
> tricky problem because I think Lucene sees all these values as one long
> value for the field "option".
>
> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Monday, October 12, 2009 1:25 PM
> To: java-user@lucene.apache.org
> Subject: Re: querying multi-value fields
>
> Or else just make sure that you use PhraseQuery to hit this field when
> you
> want "value1 aaa".  If you don't tokenize these pairs, then you will
> have to
>
> do prefix/wildcard matching to hit just "value1" by itself (if this is
> allowed
> by your business logic).
>
>    -jake
>
> On Mon, Oct 12, 2009 at 1:21 PM, Adriano Crestani
> <adrianocrestani@gmail.com
>    
>> wrote:
>>      
>    
>> Hi Eric,
>>
>> To achieve what you want, do not tokenize the values you query/add to
>>      
> this
>    
>> field.
>>
>> On Mon, Oct 12, 2009 at 4:05 PM, Angel, Eric<eangel@business.com>
>>      
> wrote:
>    
>>      
>>> I have documents that store multiple values in some fields (using
>>>        
> the
>    
>>> document.add(new Field()) with the same field name).  Here's what a
>>> typical document looks like:
>>>
>>>
>>>
>>> doc.option="value1 aaa"
>>>
>>> doc.option="value2 bbb"
>>>
>>> doc.option="value3 ccc"
>>>
>>>
>>>
>>> I want my queries to only match individual values, for example, a
>>>        
> query
>    
>>> for "value2 bbb" would return the above document, but a query for
>>> "value1 ccc" should not.  Is this at all possible in lucene at query
>>> time?  Could payloads be used for this?
>>>
>>>
>>>        
>>      
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>    


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42828-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 09:52:38 2009
Return-Path: <java-user-return-42828-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48979 invoked from network); 15 Oct 2009 09:52:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 09:52:38 -0000
Received: (qmail 13746 invoked by uid 500); 15 Oct 2009 09:52:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13670 invoked by uid 500); 15 Oct 2009 09:52:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13656 invoked by uid 99); 15 Oct 2009 09:52:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 09:52:35 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 09:52:33 +0000
Received: by yxe30 with SMTP id 30so1072039yxe.29
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 02:52:12 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.36.5 with SMTP id j5mr16914764ybj.81.1255600332169; Thu, 
	15 Oct 2009 02:52:12 -0700 (PDT)
In-Reply-To: <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
Date: Thu, 15 Oct 2009 05:52:12 -0400
Message-ID: <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <ssenecal.work@gmail.com> wrote:

> Up to Lucene 2.4, this has been working out for us.  However, in
> Lucene 2.9 this breaks since rewrite() now returns a
> ConstantScoreQuery.

You can get back to the 2.4 behavior by calling
prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
before calling rewrite().

> Is there a way I can know that a ConstantScoreQuery will match at
> least 1 term (if not, I dont want to add it to the BooleanQuery)?

There is a new method in 2.9: MultiTermQuery.getTotalNumberOfTerms(),
which returns how many terms were visited during rewrite.  Would that
work?

> My understanding is that Lucene will apply the Filter (C | D) first,
> limiting the result set, then apply the Query (A | B).  Is this
> correct?

Actually the filter & query clauses are AND'd in a sort of leapfrog
fashion, taking turns skipping up to the other's doc ID and only
accepting a doc ID when they both skip to the same point.  But this
(the mechanics of how Lucene takes a filter into account) is an
implementation detail and is likely to change.

> If so, the end result is essentially the query: (A | B) & (C | D)

Except that C, D contribute no scoring information, if scoring
matters.  If scoring doesn't matter, entirely (even for A, B), you
should use a collector that does not call score() at all to save CPU.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42829-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 12:31:05 2009
Return-Path: <java-user-return-42829-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86853 invoked from network); 15 Oct 2009 12:31:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 12:31:05 -0000
Received: (qmail 49750 invoked by uid 500); 15 Oct 2009 12:31:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49683 invoked by uid 500); 15 Oct 2009 12:31:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49673 invoked by uid 99); 15 Oct 2009 12:31:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 12:31:03 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ssenecal.work@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 12:30:57 +0000
Received: by qyk26 with SMTP id 26so557947qyk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 05:30:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=LWB2fl1jAI42jOGndVMSjWJm3HxjM/DRgIS/ksoWu5w=;
        b=khxk51NEm2N6DXnuwl9MofDBKeOTf4eTQohoMfIf3UKY74ajr9FzeuhyYVLiFAj0/d
         0mWKmfcfVYX+lsGr4iDkk6NvkmMObIpJu4i8zUT38D5JbADowOiyAn+kJ9AkOQQmQWEE
         fhaET0H4i28d7NmfK5Rw8Q/kqR7q5y3oOPmYE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=uxd4R8suE8dEBsIlPHnV5pmCHnlzxZ87FtWLZ917cBIvRJ9+FG5+q/dIQK0tX04JZ3
         QoJUDf/q2Wlm/qhfKTW2TDDhdjtuF+4lOVFMUyq3QxUL42bng9J3d8pcYM9fQasng5FB
         9+ObgUuK7/K+K9CgrOWFl/c5Lb9ZuQHNbHHVA=
MIME-Version: 1.0
Received: by 10.229.36.195 with SMTP id u3mr4024084qcd.61.1255609836103; Thu, 
	15 Oct 2009 05:30:36 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
Date: Thu, 15 Oct 2009 21:30:36 +0900
Message-ID: <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364181d541e9c50475f872b0

--0016364181d541e9c50475f872b0
Content-Type: text/plain; charset=ISO-8859-1

Thanks for the explanation Mike.  It looks like I have no choice but to move
any queries which throw TooManyClauses to be Filters. Sadly, this means a
max query time of 6s under load unless I can find a way to rewrite the query
to span a Query and a Filter.


Thanks again



On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <ssenecal.work@gmail.com>
> wrote:
>
> > Up to Lucene 2.4, this has been working out for us.  However, in
> > Lucene 2.9 this breaks since rewrite() now returns a
> > ConstantScoreQuery.
>
> You can get back to the 2.4 behavior by calling
> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
> before calling rewrite().
>
> > Is there a way I can know that a ConstantScoreQuery will match at
> > least 1 term (if not, I dont want to add it to the BooleanQuery)?
>
> There is a new method in 2.9: MultiTermQuery.getTotalNumberOfTerms(),
> which returns how many terms were visited during rewrite.  Would that
> work?
>
> > My understanding is that Lucene will apply the Filter (C | D) first,
> > limiting the result set, then apply the Query (A | B).  Is this
> > correct?
>
> Actually the filter & query clauses are AND'd in a sort of leapfrog
> fashion, taking turns skipping up to the other's doc ID and only
> accepting a doc ID when they both skip to the same point.  But this
> (the mechanics of how Lucene takes a filter into account) is an
> implementation detail and is likely to change.
>
> > If so, the end result is essentially the query: (A | B) & (C | D)
>
> Except that C, D contribute no scoring information, if scoring
> matters.  If scoring doesn't matter, entirely (even for A, B), you
> should use a collector that does not call score() at all to save CPU.
>
> Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016364181d541e9c50475f872b0--

From java-user-return-42830-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 13:16:15 2009
Return-Path: <java-user-return-42830-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3596 invoked from network); 15 Oct 2009 13:16:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 13:16:15 -0000
Received: (qmail 93834 invoked by uid 500); 15 Oct 2009 13:16:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93792 invoked by uid 500); 15 Oct 2009 13:16:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93734 invoked by uid 99); 15 Oct 2009 13:16:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 13:16:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 13:16:03 +0000
Received: by ewy26 with SMTP id 26so876276ewy.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 06:15:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=yMCGTZspCM+Mlxgopg6pYD3MwMD21PBxy+Y0547OHZo=;
        b=umK3exQwVS9uZIIMNF81TZs3HlS2PErWh/2WgW98/MUupbBSx0EqoZBA3JTBV23/L8
         06m8ADDogy2UMM0uq2lLkrZx7MGrDJvp0dC5VKucPcOnePONYEXhyfE7rsdzM//W3jCY
         Zf2IsiogbVi/hBU1kp9sRTdktpz7dEci9eeHc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=pphma5Utif2fOvGdPBnxNt5TMGiiJaz6z+TtL1d0n1189Kswe0fZL34ueYEspGo4Nk
         dg2NDKmbFJmDQKkws9tDjpOq3fAN3qN1Ydkyyvm3lDQo1gKwIVjO3vD8mUWpHqxerPgN
         VOfs91tDVHhS/RBvCDH94uOS7/axOXD6LZ5n4=
Received: by 10.211.173.7 with SMTP id a7mr9179716ebp.31.1255612543315;
        Thu, 15 Oct 2009 06:15:43 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 10sm3466771eyd.42.2009.10.15.06.15.42
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 15 Oct 2009 06:15:42 -0700 (PDT)
Message-Id: <0598076E-774C-4E60-A123-9A193E3534E6@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <60033675-941E-405E-911F-C5E859C2DFCA@apache.org>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Using TermVectorMapper to compute term frequency across documents
Date: Thu, 15 Oct 2009 15:15:41 +0200
References: <1F08B0FA-152A-4C3A-980F-8B3F49C8AD0E@gmail.com> <60033675-941E-405E-911F-C5E859C2DFCA@apache.org>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org


14 okt 2009 kl. 15.15 skrev Grant Ingersoll:
> On Oct 12, 2009, at 10:46 PM, Thomas D'Silva wrote:
>>
>> I am trying to compute the counts of terms of the documents  
>> returned by running a query using a TermVectorMapper.
>> I was wondering if anyone knew if there was a faster way to do this  
>> rather than using a HashMap with a TermVectorMapper to store the  
>> counts of the terms and calling getTermFreqVector().
>> I do not require the term frequency within a document.
>
> I think that is as fast as its going to get unless you have some  
> other restrictions that would allow you to use a FieldCache.

Just thinking out loud here... How about extending the Query/Scorer  
and do some counting while executing the Query?


      karl

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42831-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 14:04:38 2009
Return-Path: <java-user-return-42831-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17717 invoked from network); 15 Oct 2009 14:04:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 14:04:38 -0000
Received: (qmail 60307 invoked by uid 500); 15 Oct 2009 14:04:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60222 invoked by uid 500); 15 Oct 2009 14:04:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60210 invoked by uid 99); 15 Oct 2009 14:04:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 14:04:36 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of twdsilva@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 14:04:31 +0000
Received: by qyk26 with SMTP id 26so623506qyk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 07:04:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=5d9kBHT9KEvfUoqPBrqCG6Q1whQaVGzvU3gCPhqh76E=;
        b=c0+pxfGc+gM9XEM+V0GW9npPWF6Hj2a8rnYYTjD+t/MRNks+/twKMkfgsLZPxFtXIs
         ycRY4orN9+VhAZmMsDEXfygt2JuteZ8LtxE8hYLD6nHq0pgraNQGAa6OqghZNfEgqfWI
         XC/qHxYM34HWT5EWUUMbh1+yjZuhzQo6IqfgM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=qXqCnufRBoD2SXUS18KGWHgssoXZvLQWnTWGW1P0MZkkgRPx/3XI3eE76OGSyq93xs
         gYUOfLR1ymfSnklIRahjymWNWKvE1d/2+Z3cs5quG60A+U82TwzLlrZWGkvekzqx6UB9
         YYkR4nh93RVRZnbP230kwKCLFKR+w1bSwz8vQ=
MIME-Version: 1.0
Received: by 10.229.27.19 with SMTP id g19mr17403qcc.11.1255615028907; Thu, 15 
	Oct 2009 06:57:08 -0700 (PDT)
In-Reply-To: <60033675-941E-405E-911F-C5E859C2DFCA@apache.org>
References: <1F08B0FA-152A-4C3A-980F-8B3F49C8AD0E@gmail.com>
	 <60033675-941E-405E-911F-C5E859C2DFCA@apache.org>
Date: Thu, 15 Oct 2009 08:57:08 -0500
Message-ID: <fe9b22510910150657w3d31e418uc11d49e74a353dd6@mail.gmail.com>
Subject: Re: Using TermVectorMapper to compute term frequency across documents
From: "Thomas D'Silva" <twdsilva@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Grant,

I have an index with documents that have a text field containing
document text, and a tag field containing tags associated with the
document. I am trying to calculate the probability that a document
contains a particular word and is tagged with a particular tag.
This is related to a MoreLikeThis extension I was trying to write
(http://issues.apache.org/jira/browse/LUCENE-1910)

Most of the time is spent in the loop iterating over the document
tagged with the particular tag, and computing counts of terms across
the documents. If the index contains millions of documents, it takes a
while to compute the document,tag probabilities.

Thanks,
Thomas


On Wed, Oct 14, 2009 at 8:15 AM, Grant Ingersoll <gsingers@apache.org> wrot=
e:
>
> On Oct 12, 2009, at 10:46 PM, Thomas D'Silva wrote:
>
>> Hi,
>>
>> I am trying to compute the counts of terms of the documents returned by
>> running a query using a TermVectorMapper.
>> I was wondering if anyone knew if there was a faster way to do this rath=
er
>> than using a HashMap with a TermVectorMapper to store the counts of the
>> terms and calling getTermFreqVector().
>> I do not require the term frequency within a document.
>>
>
> I think that is as fast as its going to get unless you have some other
> restrictions that would allow you to use a FieldCache. =A0 =A0Can you des=
cribe
> the bigger problem you are trying to solve?
>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
> Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42832-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 14:33:44 2009
Return-Path: <java-user-return-42832-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27309 invoked from network); 15 Oct 2009 14:33:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 14:33:44 -0000
Received: (qmail 26351 invoked by uid 500); 15 Oct 2009 14:33:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26299 invoked by uid 500); 15 Oct 2009 14:33:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26289 invoked by uid 99); 15 Oct 2009 14:33:41 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 14:33:41 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 14:33:39 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MyROI-0004jj-S5
	for java-user@lucene.apache.org; Thu, 15 Oct 2009 07:33:18 -0700
Message-ID: <25909737.post@talk.nabble.com>
Date: Thu, 15 Oct 2009 07:33:18 -0700 (PDT)
From: Chuan <shichuanwuhan@gmail.com>
To: java-user@lucene.apache.org
Subject: How to set boost for a certain term in a query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: shichuanwuhan@gmail.com


For example, I want the term 'sport' to have more impact on the final rank. 
Thanks in advance. 

Chuan
-- 
View this message in context: http://www.nabble.com/How-to-set-boost-for-a-certain-term-in-a-query-tp25909737p25909737.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42833-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 14:42:07 2009
Return-Path: <java-user-return-42833-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28826 invoked from network); 15 Oct 2009 14:42:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 14:42:07 -0000
Received: (qmail 39932 invoked by uid 500); 15 Oct 2009 14:42:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39858 invoked by uid 500); 15 Oct 2009 14:42:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39848 invoked by uid 99); 15 Oct 2009 14:42:04 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 14:42:04 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.212.190 as permitted sender)
Received: from [209.85.212.190] (HELO mail-vw0-f190.google.com) (209.85.212.190)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 14:42:02 +0000
Received: by vws28 with SMTP id 28so396177vws.6
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 07:41:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=ndpoCl9iE7ZbYrg1fmxAhoT/GCXtFCYGCIXXwBaUrm8=;
        b=W1j1ZraJI7X0kH98w98VAxQtXVTuj6eZejtObw5yYhNBCREfAkX/S0aB3mAMVOYphR
         2PO13fXqXFbr26HIcchr/YaKUN8/wGLZHISvvS6/Tt00IyZhlZWVfTxZDiIlQLQFB7dl
         3WOBu5MamsU4H7YnIgVcH/TBDCPB7mYSIWco4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=B6dCXf8nYoSEbG/spbiutlsHGFGYE4HFKcja6/XfMbCDJp969KeyXkXjhiU580zLwH
         812r6eOWINhyncwV6MvAiiJxx2V9vlqL4QpRIFKDNBvK8qK7EpjLrisjltHUsYlndlKw
         My30BN4SdYTyOZ1UpUh1Jls7+qdoDjEaw/msU=
MIME-Version: 1.0
Received: by 10.220.108.71 with SMTP id e7mr294941vcp.46.1255617696783; Thu, 
	15 Oct 2009 07:41:36 -0700 (PDT)
In-Reply-To: <25909737.post@talk.nabble.com>
References: <25909737.post@talk.nabble.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 15 Oct 2009 15:41:16 +0100
Message-ID: <8c4e68610910150741n2dff75ewbee6bcb250dcb38f@mail.gmail.com>
Subject: Re: How to set boost for a certain term in a query
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

http://lucene.apache.org/java/2_9_0/queryparsersyntax.html#Boosting%20a%20Term

--
Ian.


On Thu, Oct 15, 2009 at 3:33 PM, Chuan <shichuanwuhan@gmail.com> wrote:
>
> For example, I want the term 'sport' to have more impact on the final rank.
> Thanks in advance.
>
> Chuan

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42834-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 15:00:11 2009
Return-Path: <java-user-return-42834-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33320 invoked from network); 15 Oct 2009 15:00:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 15:00:11 -0000
Received: (qmail 62932 invoked by uid 500); 15 Oct 2009 15:00:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62865 invoked by uid 500); 15 Oct 2009 15:00:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62855 invoked by uid 99); 15 Oct 2009 15:00:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 15:00:08 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 15:00:06 +0000
Received: by ywh14 with SMTP id 14so817553ywh.20
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 07:59:45 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.109.5 with SMTP id h5mr486598ybc.240.1255618784613; Thu, 
	15 Oct 2009 07:59:44 -0700 (PDT)
In-Reply-To: <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
	 <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
Date: Thu, 15 Oct 2009 10:59:44 -0400
Message-ID: <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

You should be able to do exactly what you were doing on 2.4, right?
(By setting the rewrite method).

Mike

On Thu, Oct 15, 2009 at 8:30 AM, Shaun Senecal <ssenecal.work@gmail.com> wr=
ote:
> Thanks for the explanation Mike. =A0It looks like I have no choice but to=
 move
> any queries which throw TooManyClauses to be Filters. Sadly, this means a
> max query time of 6s under load unless I can find a way to rewrite the qu=
ery
> to span a Query and a Filter.
>
>
> Thanks again
>
>
>
> On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <ssenecal.work@gmail.com>
>> wrote:
>>
>> > Up to Lucene 2.4, this has been working out for us. =A0However, in
>> > Lucene 2.9 this breaks since rewrite() now returns a
>> > ConstantScoreQuery.
>>
>> You can get back to the 2.4 behavior by calling
>> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
>> before calling rewrite().
>>
>> > Is there a way I can know that a ConstantScoreQuery will match at
>> > least 1 term (if not, I dont want to add it to the BooleanQuery)?
>>
>> There is a new method in 2.9: MultiTermQuery.getTotalNumberOfTerms(),
>> which returns how many terms were visited during rewrite. =A0Would that
>> work?
>>
>> > My understanding is that Lucene will apply the Filter (C | D) first,
>> > limiting the result set, then apply the Query (A | B). =A0Is this
>> > correct?
>>
>> Actually the filter & query clauses are AND'd in a sort of leapfrog
>> fashion, taking turns skipping up to the other's doc ID and only
>> accepting a doc ID when they both skip to the same point. =A0But this
>> (the mechanics of how Lucene takes a filter into account) is an
>> implementation detail and is likely to change.
>>
>> > If so, the end result is essentially the query: (A | B) & (C | D)
>>
>> Except that C, D contribute no scoring information, if scoring
>> matters. =A0If scoring doesn't matter, entirely (even for A, B), you
>> should use a collector that does not call score() at all to save CPU.
>>
>> Mike
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42835-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 16:32:48 2009
Return-Path: <java-user-return-42835-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61134 invoked from network); 15 Oct 2009 16:32:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 16:32:48 -0000
Received: (qmail 45764 invoked by uid 500); 15 Oct 2009 16:32:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45686 invoked by uid 500); 15 Oct 2009 16:32:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45676 invoked by uid 99); 15 Oct 2009 16:32:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:32:46 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of eransevi@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:32:43 +0000
Received: by ewy26 with SMTP id 26so1085095ewy.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 09:32:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=nRNWWT1ogj7ejx9p+gNIRjEnu19Pa5crwa8OzQ2ReYI=;
        b=MNIuJnF5hirzBYRC+TI3ee68fn45uraiCGJvZaupXELzorMHNoTg4vWoGMN7UPadcN
         UepeJ7VHTZnbpICQDFqoFK9BHsw/iw9plk5VifwOsI/0bAOk4PHyT9qruRiTGRJFQ0qx
         2Ox38wr7Hs6fBvs2LTGSNwGpyE+UWzaesarRw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=PhelO9uk1rc1tpxvoVLt4FWfSBWGrRtfqPl7bnwLw8FWqV5nL4pmZv+36uU8UGEdRf
         RGJkjgnrshyb9/SqkxWGokwNTqR7IjXs/HzfOmuJzLJ+Syqmir+vxcplxTJd4IuLPL2M
         KHfO548EIQj4oeoKViRWHdzjgM5S81BBY1aL0=
MIME-Version: 1.0
Received: by 10.211.171.12 with SMTP id y12mr9445171ebo.51.1255624342166; Thu, 
	15 Oct 2009 09:32:22 -0700 (PDT)
In-Reply-To: <OFE3143EC4.F95E2C65-ON85257635.0079297D-85257635.007932B2@equifax.com>
References: <OFE3143EC4.F95E2C65-ON85257635.0079297D-85257635.007932B2@equifax.com>
Date: Thu, 15 Oct 2009 18:32:22 +0200
Message-ID: <74f928500910150932l38af4a7bva14c1d21c25ac059@mail.gmail.com>
Subject: Re: Invitation: Free Webinar - Apache Lucene 2.9: Technical Overview 
	of New Features (Sep 24 02:00 PM EDT)
From: Eran Sevi <eransevi@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636d34784e2dcac0475fbd20c

--001636d34784e2dcac0475fbd20c
Content-Type: text/plain; charset=ISO-8859-1

Is there a recording of the Webinars for anyone who's missed it?

On Sat, Sep 19, 2009 at 12:03 AM, <Aravind.Yarram@equifax.com> wrote:

> *Description*
>
>
>
> __________________
>
> Free Webinar: Apache Lucene 2.9: Discover the Powerful New Features
> -------------------------------------------------------------------
>
> Join us for a free and in-depth technical webinar with Grant
> Ingersoll, co-founder of Lucid Imagination and chair of the Apache
> Lucene PMC.
>
> Thursday, September 24th 2009
> 11:00AM - 12 NOON PDT / 2:00 - 3:00PM EDT
> Click on the link below to sign up
> http://www.eventsvc.com/lucidimagination/092409?trk=WR-SEP2009B-AP
>
> Lucene 2.9 offers a rich set of new features and performance
> improvements alongside plentiful fixes and optimizations. If you are a
> Java developer building search applications with the Lucene search
> library, this webinar provides the insights you need to harness this
> important update to Apache Lucene.
>
> Grant will present and discuss key technical features and innovations
> including:
> o Real time/Per segment searching and caching
> o Built in numeric range support with trie structure for speed and
> simplified programming
> o Reduced search latency and improved index efficiency
>
> Join us for a free webinar.
> Thursday, September 24th 2009
> 11:00 AM - NOON PDT / 2:00 - 3:00 PM EDT
> http://www.eventsvc.com/lucidimagination/092409?trk=WR-SEP2009B-AP
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--001636d34784e2dcac0475fbd20c--

From java-user-return-42836-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 16:42:16 2009
Return-Path: <java-user-return-42836-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63041 invoked from network); 15 Oct 2009 16:42:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 16:42:16 -0000
Received: (qmail 61289 invoked by uid 500); 15 Oct 2009 16:42:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61216 invoked by uid 500); 15 Oct 2009 16:42:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61206 invoked by uid 99); 15 Oct 2009 16:42:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:42:14 +0000
X-ASF-Spam-Status: No, hits=0.1 required=10.0
	tests=FRT_WEIGHT2,RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 131.246.120.220 is neither permitted nor denied by domain of christian.reuschling@gmail.com)
Received: from [131.246.120.220] (HELO mailgw1.uni-kl.de) (131.246.120.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:42:05 +0000
Received: from dfki.uni-kl.de (dfki-1002.dfki.uni-kl.de [131.246.195.2])
	by mailgw1.uni-kl.de (8.13.8/8.13.8/Debian-3) with ESMTP id n9FGfiGF018415
	for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 18:41:44 +0200
Received: from serv-4100.kl.dfki.de (serv-4100.kl.dfki.de [192.168.41.180])
	by dfki.uni-kl.de (8.13.8+Sun/8.11.4) with ESMTP id n9FGfiuH024570
	for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 18:41:44 +0200 (CEST)
Received: from pc-4176.kl.dfki.de (pc-4176.kl.dfki.de [192.168.41.166])
	by serv-4100.kl.dfki.de (8.13.8+Sun/8.13.8) with ESMTP id n9FGfigx002203
	for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 18:41:44 +0200 (CEST)
Date: Thu, 15 Oct 2009 18:41:35 +0200
From: Christian Reuschling <christian.reuschling@gmail.com>
To: <java-user@lucene.apache.org>
Subject: How to sort and get document scores afterwards
Message-ID: <20091015184135.1ecee096@pc-4176.kl.dfki.de>
X-Mailer: Claws Mail 3.7.2 (GTK+ 2.14.4; i586-http://packman.links2linux.de-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; boundary="Sig_/NbUQMicVNshL9h3zKK4CHOE";
 protocol="application/pgp-signature"; micalg=PGP-SHA1
X-Virus-Checked: Checked by ClamAV on apache.org

--Sig_/NbUQMicVNshL9h3zKK4CHOE
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

Hi,

our application enables sorting the result lists according to field values,
currently all represented as Strings (we plan to also migrate to the new
numeric type capabilities of Lucene 2.9 at a later time)

For this, the documents will be sorted e.g. according to the author, which
works fine with the new 2.9 sort interface


llSortFields.add(new SortField(strFieldName4Sorting, SortField.STRING, !bAs=
cending));

topDocs =3D searcher.search(wheight4Query, (Filter) null, m_iMaxTopDocs, ne=
w Sort(llSortFields.toArray(new SortField[0])));

for (ScoreDoc scoreDoc : m_luceneTopDocs.scoreDocs)
   System.out.println(scoreDoc.score);  //>>>>>> NaN


Nevertheless, we visualize the score of each document inside a birdeye view=
, to show the relevancy of each doc according to
the users query. But the scoreDoc.score  numbers have all the value 'NaN'.

This is a new behaviour in Lucene 2.9, I think a good feature to save cpu t=
ime - but how can we get the scores again?


regards


Chris


--Sig_/NbUQMicVNshL9h3zKK4CHOE
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.9 (GNU/Linux)

iEYEARECAAYFAkrXUMQACgkQ6EqMXq+WZg8U7gCgvyo6hFRfp6AOUDnIWIJXvnB8
mewAnioH3fl8+GJQSTkx6CtanZCXgvNf
=0UR7
-----END PGP SIGNATURE-----

--Sig_/NbUQMicVNshL9h3zKK4CHOE--

From java-user-return-42837-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 16:54:00 2009
Return-Path: <java-user-return-42837-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68275 invoked from network); 15 Oct 2009 16:53:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 16:53:58 -0000
Received: (qmail 90017 invoked by uid 500); 15 Oct 2009 16:53:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89945 invoked by uid 500); 15 Oct 2009 16:53:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89935 invoked by uid 99); 15 Oct 2009 16:53:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:53:55 +0000
X-ASF-Spam-Status: No, hits=4.1 required=10.0
	tests=FRT_WEIGHT2,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:53:45 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 785F445EFE0
	for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 18:53:23 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id QLWEBB2XgsHL for <java-user@lucene.apache.org>;
	Thu, 15 Oct 2009 18:53:13 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 40D7745EFAE
	for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 18:53:13 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <20091015184135.1ecee096@pc-4176.kl.dfki.de>
Subject: RE: How to sort and get document scores afterwards
Date: Thu, 15 Oct 2009 18:53:13 +0200
Message-ID: <410F54E00DD1436DAA469288ADACF14D@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
In-reply-to: <20091015184135.1ecee096@pc-4176.kl.dfki.de>
Thread-Index: AcpNtnlsnj8g7QbXQXytFmvImNkhHwAALRtg
X-Virus-Checked: Checked by ClamAV on apache.org

The default API searcher.search works like this now. If you want to control,
the retrieval of scores, create a TopFieldCollector directly:
http://lucene.apache.org/java/2_9_0/api/all/org/apache/lucene/search/TopFiel
dCollector.html

The static create methods has many possibilities to control the behaviour of
the resulting Collector. Pass this collector to the corresponding search
engine. The topDocs() method returns the resulting TopDocs instance (its in
the superclass TopDocsCollector!!!). Some hints: mostly scoreDocsInOrder can
be false, if you need the maxScore set it true, you want to have scores, so
set also to true. Mosly you will not need the sorted field values (false).

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Christian Reuschling [mailto:christian.reuschling@gmail.com]
> Sent: Thursday, October 15, 2009 6:42 PM
> To: java-user@lucene.apache.org
> Subject: How to sort and get document scores afterwards
> 
> Hi,
> 
> our application enables sorting the result lists according to field
> values,
> currently all represented as Strings (we plan to also migrate to the new
> numeric type capabilities of Lucene 2.9 at a later time)
> 
> For this, the documents will be sorted e.g. according to the author, which
> works fine with the new 2.9 sort interface
> 
> 
> llSortFields.add(new SortField(strFieldName4Sorting, SortField.STRING,
> !bAscending));
> 
> topDocs = searcher.search(wheight4Query, (Filter) null, m_iMaxTopDocs, new
> Sort(llSortFields.toArray(new SortField[0])));
> 
> for (ScoreDoc scoreDoc : m_luceneTopDocs.scoreDocs)
>    System.out.println(scoreDoc.score);  //>>>>>> NaN
> 
> 
> Nevertheless, we visualize the score of each document inside a birdeye
> view, to show the relevancy of each doc according to
> the users query. But the scoreDoc.score  numbers have all the value 'NaN'.
> 
> This is a new behaviour in Lucene 2.9, I think a good feature to save cpu
> time - but how can we get the scores again?
> 
> 
> regards
> 
> 
> Chris



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42838-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 16:56:14 2009
Return-Path: <java-user-return-42838-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70107 invoked from network); 15 Oct 2009 16:56:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 16:56:13 -0000
Received: (qmail 93952 invoked by uid 500); 15 Oct 2009 16:56:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93882 invoked by uid 500); 15 Oct 2009 16:56:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93872 invoked by uid 99); 15 Oct 2009 16:56:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:56:11 +0000
X-ASF-Spam-Status: No, hits=4.1 required=10.0
	tests=FRT_WEIGHT2,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.184] (HELO mail-yw0-f184.google.com) (209.85.211.184)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 16:56:03 +0000
Received: by ywh14 with SMTP id 14so937843ywh.20
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 09:55:42 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.35.18 with SMTP id i18mr730346ybi.153.1255625742042; Thu, 
	15 Oct 2009 09:55:42 -0700 (PDT)
In-Reply-To: <20091015184135.1ecee096@pc-4176.kl.dfki.de>
References: <20091015184135.1ecee096@pc-4176.kl.dfki.de>
Date: Thu, 15 Oct 2009 12:55:42 -0400
Message-ID: <9ac0c6aa0910150955rb2c3519g2f106d729d779ea7@mail.gmail.com>
Subject: Re: How to sort and get document scores afterwards
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Yeah this was a change in 2.9... but you can get the scores back, if
you do this:

      TopFieldCollector tfc =3D TopFieldCollector.create(sort, numHits,
fillFields,
                                                       true /*
trackDocScores */,
                                                       true /* trackMaxScor=
e */,
                                                       false /* docsInOrder=
 */);
      searcher.search(query, tfc);
      TopDocs results =3D tfc.topDocs();

Mike

On Thu, Oct 15, 2009 at 12:41 PM, Christian Reuschling
<christian.reuschling@gmail.com> wrote:
> Hi,
>
> our application enables sorting the result lists according to field value=
s,
> currently all represented as Strings (we plan to also migrate to the new
> numeric type capabilities of Lucene 2.9 at a later time)
>
> For this, the documents will be sorted e.g. according to the author, whic=
h
> works fine with the new 2.9 sort interface
>
>
> llSortFields.add(new SortField(strFieldName4Sorting, SortField.STRING, !b=
Ascending));
>
> topDocs =3D searcher.search(wheight4Query, (Filter) null, m_iMaxTopDocs, =
new Sort(llSortFields.toArray(new SortField[0])));
>
> for (ScoreDoc scoreDoc : m_luceneTopDocs.scoreDocs)
> =A0 System.out.println(scoreDoc.score); =A0//>>>>>> NaN
>
>
> Nevertheless, we visualize the score of each document inside a birdeye vi=
ew, to show the relevancy of each doc according to
> the users query. But the scoreDoc.score =A0numbers have all the value 'Na=
N'.
>
> This is a new behaviour in Lucene 2.9, I think a good feature to save cpu=
 time - but how can we get the scores again?
>
>
> regards
>
>
> Chris
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42839-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 17:18:09 2009
Return-Path: <java-user-return-42839-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80542 invoked from network); 15 Oct 2009 17:18:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 17:18:09 -0000
Received: (qmail 35535 invoked by uid 500); 15 Oct 2009 17:18:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35443 invoked by uid 500); 15 Oct 2009 17:18:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35433 invoked by uid 99); 15 Oct 2009 17:18:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:18:07 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:18:04 +0000
Received: by pzk3 with SMTP id 3so859371pzk.20
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 10:17:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=EsQO83Tv8Q2yBw58zdp+UszAhMfC9a84N4kZ9X0vpXs=;
        b=eejrkfiZ+/FSEgeo864U4613ipEt32Bc7ZZiMHvjGZ78Vu8MI+L6cJ1+lsDJjpbBgO
         2EMIT7yJtLtNqmLPn7L12BP74abcVCGrDgxyEiFiHU11h+scPEm6XHxgd6DFa4rtBnJc
         7lH+c0kIEhZBNClMAdAqrl9bd8jYDxNVOxdQw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=VzYQn63hMewr4NVsz46F/lWVIxSnALbKM4WkK2YjbtdGiZRNwVHtJO+L2V146G32cX
         7q5dGHRaIstJtpNVhDCo6i7HvRc4g8NwMUeHaxTmRQJNNOh6fS+4iL7lCdw70QOpVzBt
         Q3SWVabyzb66x0opqErEezHIr8c0LBWg4mfnw=
MIME-Version: 1.0
Received: by 10.140.208.15 with SMTP id f15mr13680rvg.164.1255627064277; Thu, 
	15 Oct 2009 10:17:44 -0700 (PDT)
Date: Thu, 15 Oct 2009 13:17:44 -0400
Message-ID: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com>
Subject: NPE in NearSpansUnordered
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=000e0cd14d4422fc760475fc7576

--000e0cd14d4422fc760475fc7576
Content-Type: text/plain; charset=ISO-8859-1

I'm using Lucene 2.9 and sometimes get a NPE in NearSpansUnordered:

 <java.lang.NullPointerException>java.lang.NullPointerException
at
org.apache.lucene.search.spans.NearSpansUnordered.start(NearSpansUnordered.java:219)
at
org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.processPayloads(PayloadNearQuery.java:201)
at
org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:180)
at
org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:183)
at
org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.setFreqCurrentDoc(PayloadNearQuery.java:214)
at org.apache.lucene.search.spans.SpanScorer.nextDoc(SpanScorer.java:64)
at org.apache.lucene.search.Scorer.score(Scorer.java:74)
at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:247)
at org.apache.lucene.search.Searcher.search(Searcher.java:152)

The CellQueue pq is empty when this occurs. Are there any conditions in
which the queue might be expected to be empty?

Peter

--000e0cd14d4422fc760475fc7576--

From java-user-return-42840-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 17:21:58 2009
Return-Path: <java-user-return-42840-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82125 invoked from network); 15 Oct 2009 17:21:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 17:21:58 -0000
Received: (qmail 41281 invoked by uid 500); 15 Oct 2009 17:21:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41199 invoked by uid 500); 15 Oct 2009 17:21:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41189 invoked by uid 99); 15 Oct 2009 17:21:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:21:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:21:46 +0000
Received: by ewy26 with SMTP id 26so1136037ewy.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 10:21:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=igHF5HB1MIyERLlcJMlIc1eva/V0CRKxYoOltHzJLNA=;
        b=nbIALRimLXW9yeTe9GkDxdOACZSrSlnJ+NMRcWsqVmRlX7Vh1IZ7/ZVX3rahAFG9sN
         fwafH+6H1lDIW8ygueZYfWGVj3Y1c6oCrfdEF3+AdbCXhP6+Y498388xaYoxY5HzPUpX
         t/3PIg9e5WZ6M7C6D+mIs8LsPGu98n5oLCQtU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=dn/l7gBQIdHIkx/aqPIP87f24I8nMZ1FqT4uE2APbQckEgMENBIklMnFYqJFlYJSSt
         oqbxHXJkstBwfqCxZFaAA1VoYO2UNDyhAYpXOltofCvsoeq0Smz5CIKBXQBc4obMb18F
         BGYqd2x3opRf/In4k2vbU8JblFGVJc8MupK5A=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.89.131 with SMTP id c3mr83943wef.197.1255627286504; Thu, 
	15 Oct 2009 10:21:26 -0700 (PDT)
In-Reply-To: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com>
References: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com>
Date: Thu, 15 Oct 2009 13:21:26 -0400
X-Google-Sender-Auth: e31f99d028914574
Message-ID: <c68e39170910151021v28acb2ebx90ba213527856036@mail.gmail.com>
Subject: Re: NPE in NearSpansUnordered
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Are you using any custom query types?  Anything to help us reproduce
(like the acutal query this happened on) would be greatly appreciated.

-Yonik
http://www.lucidimagination.com


On Thu, Oct 15, 2009 at 1:17 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
> I'm using Lucene 2.9 and sometimes get a NPE in NearSpansUnordered:
>
> =A0<java.lang.NullPointerException>java.lang.NullPointerException
> at
> org.apache.lucene.search.spans.NearSpansUnordered.start(NearSpansUnordere=
d.java:219)
> at
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.=
processPayloads(PayloadNearQuery.java:201)
> at
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.=
getPayloads(PayloadNearQuery.java:180)
> at
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.=
getPayloads(PayloadNearQuery.java:183)
> at
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.=
setFreqCurrentDoc(PayloadNearQuery.java:214)
> at org.apache.lucene.search.spans.SpanScorer.nextDoc(SpanScorer.java:64)
> at org.apache.lucene.search.Scorer.score(Scorer.java:74)
> at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:247)
> at org.apache.lucene.search.Searcher.search(Searcher.java:152)
>
> The CellQueue pq is empty when this occurs. Are there any conditions in
> which the queue might be expected to be empty?
>
> Peter
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42841-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 17:29:08 2009
Return-Path: <java-user-return-42841-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83452 invoked from network); 15 Oct 2009 17:29:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 17:29:08 -0000
Received: (qmail 56518 invoked by uid 500); 15 Oct 2009 17:29:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56473 invoked by uid 500); 15 Oct 2009 17:29:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56462 invoked by uid 99); 15 Oct 2009 17:29:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:29:06 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:28:56 +0000
Received: by pxi3 with SMTP id 3so1542580pxi.29
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 10:28:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=eORuZbM9rUaZmCcBQ9vb6p7ZuwNouebbdI+LzcNLnfM=;
        b=ux0Ui+YMuAjc+D3Rb7XvI5eKVyQY6fci6mZKf0jKOJyRqKmY3PwI+VIdCw8WC9mpFn
         v9V/rVUC5lj49YzSt2Qo3wmJ+pWJ1NwPZ2/9MzQEnsRIPfOmMM5YJVHAXVb7A/vnHICR
         G62piC6D3+i7VBED4Ux0SSLsB8x0SyBNeTWVs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Ms0g7FG0pJCs//fPxtm0Xo6D1KjVPYvD3ABbFug/CNPpR81d1I/D7IX92UZqoS4XdA
         52G/h4ieJu3FZCBeW5V6Ke+s0QKRqoS4wGEPU5q2MQhY4//Rd+heYJsGYO28jxbR+rJy
         teUbG8F/1650d8+fTSyVZ+XKR+CY2I6bnKbTo=
MIME-Version: 1.0
Received: by 10.140.207.21 with SMTP id e21mr11923rvg.280.1255627714780; Thu, 
	15 Oct 2009 10:28:34 -0700 (PDT)
In-Reply-To: <c68e39170910151021v28acb2ebx90ba213527856036@mail.gmail.com>
References: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com>
	 <c68e39170910151021v28acb2ebx90ba213527856036@mail.gmail.com>
Date: Thu, 15 Oct 2009 13:28:34 -0400
Message-ID: <e994873a0910151028n6a8f699fid450c4272c04b09c@mail.gmail.com>
Subject: Re: NPE in NearSpansUnordered
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org, yonik@lucidimagination.com
Content-Type: multipart/alternative; boundary=000e0cd2a11ee8e3840475fc9b6e
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd2a11ee8e3840475fc9b6e
Content-Type: text/plain; charset=ISO-8859-1

The query is:
+payloadNear([spanNear([contents:insurance, contents:agent], 10000, false),
spanNear([contents:winston, contents:salem], 10000, false)], 10, false)
It's using the default payload function scorer (average value)

It doesn't happen on all queries of this type, only a handful. This is
production-like index of > 1million docs. I haven't been able to reproduce
with a simple index, unfortunately.

Peter

On Thu, Oct 15, 2009 at 1:21 PM, Yonik Seeley <yonik@lucidimagination.com>wrote:

> Are you using any custom query types?  Anything to help us reproduce
> (like the acutal query this happened on) would be greatly appreciated.
>
> -Yonik
> http://www.lucidimagination.com
>
>
> On Thu, Oct 15, 2009 at 1:17 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > I'm using Lucene 2.9 and sometimes get a NPE in NearSpansUnordered:
> >
> >  <java.lang.NullPointerException>java.lang.NullPointerException
> > at
> >
> org.apache.lucene.search.spans.NearSpansUnordered.start(NearSpansUnordered.java:219)
> > at
> >
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.processPayloads(PayloadNearQuery.java:201)
> > at
> >
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:180)
> > at
> >
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:183)
> > at
> >
> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.setFreqCurrentDoc(PayloadNearQuery.java:214)
> > at org.apache.lucene.search.spans.SpanScorer.nextDoc(SpanScorer.java:64)
> > at org.apache.lucene.search.Scorer.score(Scorer.java:74)
> > at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:247)
> > at org.apache.lucene.search.Searcher.search(Searcher.java:152)
> >
> > The CellQueue pq is empty when this occurs. Are there any conditions in
> > which the queue might be expected to be empty?
> >
> > Peter
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd2a11ee8e3840475fc9b6e--

From java-user-return-42842-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 17:43:22 2009
Return-Path: <java-user-return-42842-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89804 invoked from network); 15 Oct 2009 17:43:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 17:43:21 -0000
Received: (qmail 82926 invoked by uid 500); 15 Oct 2009 17:43:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82805 invoked by uid 500); 15 Oct 2009 17:43:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82785 invoked by uid 99); 15 Oct 2009 17:43:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:43:18 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.217.219 as permitted sender)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 17:43:16 +0000
Received: by gxk19 with SMTP id 19so1194741gxk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 10:42:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=uCFI17pLJ8IlASZf3ahlcl7G+HFP2UPWm9w4yvTCG54=;
        b=sToWKok5Ej4CSkexehq3U+1iGOxOtn6/gXipR1Og33qpTJRJmUaY2L66pjX14/DrYX
         eYvFcm90sxqKJDOgyaYXZRYnrK/zFwY3lvC1YDRwg1LERZ62/2UMDP727cUUnjnvTQX2
         81BISmnSLgUX7vbjK1ET5T9ZczUVItOrO7fS8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=GfWpCKoqZwrttRyEdTTyzPypNgYYk4a+XfvLmoSLZHKIGoqHMNwJ1PVW2+/VK8BFz0
         78bUxwW5DQA7F8R82Auf4EGqwMYa2AZMIP+c5Hwsky9up1sA0wKV0zuoyWF3wVTCaJX1
         qjm+wajjvA6mwEoE0w4fHskVbpk7DkgOIAcsw=
MIME-Version: 1.0
Received: by 10.239.144.90 with SMTP id n26mr30602hba.133.1255628574504; Thu, 
	15 Oct 2009 10:42:54 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <74f928500910150932l38af4a7bva14c1d21c25ac059@mail.gmail.com>
References: <OFE3143EC4.F95E2C65-ON85257635.0079297D-85257635.007932B2@equifax.com>
	 <74f928500910150932l38af4a7bva14c1d21c25ac059@mail.gmail.com>
Date: Thu, 15 Oct 2009 19:42:54 +0200
Message-ID: <f18c9dde0910151042s17886398sae5553828514e33b@mail.gmail.com>
Subject: Re: Invitation: Free Webinar - Apache Lucene 2.9: Technical Overview 
	of New Features (Sep 24 02:00 PM EDT)
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8

http://www.lucidimagination.com/How-We-Can-Help/webinar-Lucene-29
here can you download the slides and watch the webinar.

simon

On Thu, Oct 15, 2009 at 6:32 PM, Eran Sevi <eransevi@gmail.com> wrote:
> Is there a recording of the Webinars for anyone who's missed it?
>
> On Sat, Sep 19, 2009 at 12:03 AM, <Aravind.Yarram@equifax.com> wrote:
>
>> *Description*
>>
>>
>>
>> __________________
>>
>> Free Webinar: Apache Lucene 2.9: Discover the Powerful New Features
>> -------------------------------------------------------------------
>>
>> Join us for a free and in-depth technical webinar with Grant
>> Ingersoll, co-founder of Lucid Imagination and chair of the Apache
>> Lucene PMC.
>>
>> Thursday, September 24th 2009
>> 11:00AM - 12 NOON PDT / 2:00 - 3:00PM EDT
>> Click on the link below to sign up
>> http://www.eventsvc.com/lucidimagination/092409?trk=WR-SEP2009B-AP
>>
>> Lucene 2.9 offers a rich set of new features and performance
>> improvements alongside plentiful fixes and optimizations. If you are a
>> Java developer building search applications with the Lucene search
>> library, this webinar provides the insights you need to harness this
>> important update to Apache Lucene.
>>
>> Grant will present and discuss key technical features and innovations
>> including:
>> o Real time/Per segment searching and caching
>> o Built in numeric range support with trie structure for speed and
>> simplified programming
>> o Reduced search latency and improved index efficiency
>>
>> Join us for a free webinar.
>> Thursday, September 24th 2009
>> 11:00 AM - NOON PDT / 2:00 - 3:00 PM EDT
>> http://www.eventsvc.com/lucidimagination/092409?trk=WR-SEP2009B-AP
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42843-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 19:32:46 2009
Return-Path: <java-user-return-42843-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28291 invoked from network); 15 Oct 2009 19:32:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 19:32:45 -0000
Received: (qmail 72022 invoked by uid 500); 15 Oct 2009 19:32:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71949 invoked by uid 500); 15 Oct 2009 19:32:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71938 invoked by uid 99); 15 Oct 2009 19:32:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 19:32:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [206.190.49.17] (HELO web52907.mail.re2.yahoo.com) (206.190.49.17)
    by apache.org (qpsmtpd/0.29) with SMTP; Thu, 15 Oct 2009 19:32:34 +0000
Received: (qmail 60209 invoked by uid 60001); 15 Oct 2009 19:32:12 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1255635132; bh=PPpK+wNMLfrw9x9r78VZVLGpkgarZMsFRDhSr16UCn0=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=hpyYUdzqtnAtvzcK3q7sKlKHGQIw+cDjX1xXjLwYjR6bd90F1/394qTy5XPY3Dq0hvzyOtkEE5s0N5sZCTWhwI/7t1Q50/HwOsVeObzdLTpPYnHoBlQHGLWWo5e7TokJx3+9QXl+QDGCRmcvVHoCQNu41v1JZvsn+IZwnhHq7zU=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=1FsRAIKcD5re1UmTWVsU1Rh/rW1c7ivuC4IThzcgPqzWDO0Md+eHuxLZO/loN7mZFnyfOYFvlZ8t6OKGcWOliFHm3Gb3TmX7tCTYWj/t4Ei0fwkMEceokpdvg0zjf0C79rT8U+YchQX31qXLh6+ZVkQZQX7T5VThcLDHAYoS83E=;
Message-ID: <869968.59650.qm@web52907.mail.re2.yahoo.com>
X-YMail-OSG: .XiCCgYVM1n2uyoB3k.tWSgKFNAiWz4JvyxNvatAPrAqwya1SZH2VxoSOuCJ205NbpGL2ZVXaXvIvRt.xCEKBv0JYashty_j9x4JBp0EthsYt.ErGTm30OKwShy9iHAEUza7GXRrvrTnSXHrBjvbs36P8dJpRLHDzBl06NCxyiejYbJoFvLq_BAotvG98_UFeq1VJQjQju0Pqb8meJfimJx.z9paly.9Ve7XEe1zXyD89nokhUwZvSYgQJJGNpYDXLCRCfsc9.K1.DJhDodSrdQiwvDCutcISCKPXro6yV5m4bA5bf9NOQegxz2582yGH1YS4a4kLP1DT2xWJos4UDsaW6S0.haGmZExtbb3xAGuf9bEvgFwdcbouazo2guCFJy8PhkfZiGwaUnoEfVhDH4QA8RpUyipPGYfhK9_zwVjahFA9FJalpY-
Received: from [66.245.49.189] by web52907.mail.re2.yahoo.com via HTTP; Thu, 15 Oct 2009 12:32:12 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Thu, 15 Oct 2009 12:32:12 -0700 (PDT)
From: Omar Alonso <oralonso@yahoo.com>
Subject: OpenRelevance
To: java-user@lucene.apache.org
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-Virus-Checked: Checked by ClamAV on apache.org

Hi folks,

I would like to know if people are interested in the OpenRelevance project (http://wiki.apache.org/lucene-java/OpenRelevance). 

I've done quite a few experiments on Amazon Mechanical Turk using TREC and INEX data sets, so one approach would be to use crowdsourcing for such task.

Regards,

Omar


      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42844-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 21:43:24 2009
Return-Path: <java-user-return-42844-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 76915 invoked from network); 15 Oct 2009 21:43:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 21:43:24 -0000
Received: (qmail 15050 invoked by uid 500); 15 Oct 2009 21:43:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14987 invoked by uid 500); 15 Oct 2009 21:43:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14977 invoked by uid 99); 15 Oct 2009 21:43:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 21:43:22 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ssenecal.work@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 21:43:13 +0000
Received: by qyk26 with SMTP id 26so1008045qyk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 14:42:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=rHjmCkD7IAzDgHVdkHTaQchla6BrheclfVXq8tf1frM=;
        b=Bd+ABQuc+ZgkVI1G6GLjDCbkQCW5gVJGaMwAOlYaRmPVsPY0S+KgWqb4FB7DlmVit/
         qxg6+8XIUpo8rl575AicDPY6UMXd+LCOT0FJV7hZRvsd2+BFtIdvvNkj5O95I4gzenaC
         nKim6mrtkDVvTAeVtdDDR4FTuIp3aVdFhFpuw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=B+Xvav9a0Gni0Z6/0L8N/62IcogHW8htozxoJNNN+JVVh+ze++4B93gTRsX6MAmYX9
         A1kNiCNseLv7F4VFTdNxWhsrcIFL6YeMbIzY/eaQyBPLHbk93/7mzLTZfWUjJsCTfACM
         6OVN8GyrXkhBk70zUcp1lTLwStfxPnBHsfuVA=
MIME-Version: 1.0
Received: by 10.229.38.206 with SMTP id c14mr84345qce.89.1255642972697; Thu, 
	15 Oct 2009 14:42:52 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
	 <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
	 <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
Date: Fri, 16 Oct 2009 06:42:52 +0900
Message-ID: <15060d5e0910151442w310c3a3aofe59ae8f6a986f3a@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368342a45a35130476002982
X-Virus-Checked: Checked by ClamAV on apache.org

--0016368342a45a35130476002982
Content-Type: text/plain; charset=ISO-8859-1

At first I thought so, yes, but then I realised that the query I wanted to
execute was A | B | C | D and in reality I was executing (A | B) & (C | D).
I guess my unit tests were missing some cases and don't currently catch
this.



On Thu, Oct 15, 2009 at 11:59 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> You should be able to do exactly what you were doing on 2.4, right?
> (By setting the rewrite method).
>
> Mike
>
> On Thu, Oct 15, 2009 at 8:30 AM, Shaun Senecal <ssenecal.work@gmail.com>
> wrote:
> > Thanks for the explanation Mike.  It looks like I have no choice but to
> move
> > any queries which throw TooManyClauses to be Filters. Sadly, this means a
> > max query time of 6s under load unless I can find a way to rewrite the
> query
> > to span a Query and a Filter.
> >
> >
> > Thanks again
> >
> >
> >
> > On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <ssenecal.work@gmail.com
> >
> >> wrote:
> >>
> >> > Up to Lucene 2.4, this has been working out for us.  However, in
> >> > Lucene 2.9 this breaks since rewrite() now returns a
> >> > ConstantScoreQuery.
> >>
> >> You can get back to the 2.4 behavior by calling
> >> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
> >> before calling rewrite().
> >>
> >> > Is there a way I can know that a ConstantScoreQuery will match at
> >> > least 1 term (if not, I dont want to add it to the BooleanQuery)?
> >>
> >> There is a new method in 2.9: MultiTermQuery.getTotalNumberOfTerms(),
> >> which returns how many terms were visited during rewrite.  Would that
> >> work?
> >>
> >> > My understanding is that Lucene will apply the Filter (C | D) first,
> >> > limiting the result set, then apply the Query (A | B).  Is this
> >> > correct?
> >>
> >> Actually the filter & query clauses are AND'd in a sort of leapfrog
> >> fashion, taking turns skipping up to the other's doc ID and only
> >> accepting a doc ID when they both skip to the same point.  But this
> >> (the mechanics of how Lucene takes a filter into account) is an
> >> implementation detail and is likely to change.
> >>
> >> > If so, the end result is essentially the query: (A | B) & (C | D)
> >>
> >> Except that C, D contribute no scoring information, if scoring
> >> matters.  If scoring doesn't matter, entirely (even for A, B), you
> >> should use a collector that does not call score() at all to save CPU.
> >>
> >> Mike
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016368342a45a35130476002982--

From java-user-return-42845-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 21:47:17 2009
Return-Path: <java-user-return-42845-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79222 invoked from network); 15 Oct 2009 21:47:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 21:47:16 -0000
Received: (qmail 20282 invoked by uid 500); 15 Oct 2009 21:47:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20199 invoked by uid 500); 15 Oct 2009 21:47:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20188 invoked by uid 99); 15 Oct 2009 21:47:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 21:47:14 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 21:47:09 +0000
Received: by ywh13 with SMTP id 13so2091086ywh.29
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 14:46:48 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.44.2 with SMTP id r2mr1313075ybr.77.1255643208083; Thu, 15 
	Oct 2009 14:46:48 -0700 (PDT)
In-Reply-To: <15060d5e0910151442w310c3a3aofe59ae8f6a986f3a@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
	 <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
	 <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
	 <15060d5e0910151442w310c3a3aofe59ae8f6a986f3a@mail.gmail.com>
Date: Thu, 15 Oct 2009 17:46:48 -0400
Message-ID: <9ac0c6aa0910151446hf7a6c2fk4ed4fad88b466682@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Well, you could wrap the C | D filter as a Query (using
ConstantScoreQuery), and then add that as a SHOULD clause on your
toplevel BooleanQuery?

Mike

On Thu, Oct 15, 2009 at 5:42 PM, Shaun Senecal <ssenecal.work@gmail.com> wr=
ote:
> At first I thought so, yes, but then I realised that the query I wanted t=
o
> execute was A | B | C | D and in reality I was executing (A | B) & (C | D=
).
> I guess my unit tests were missing some cases and don't currently catch
> this.
>
>
>
> On Thu, Oct 15, 2009 at 11:59 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> You should be able to do exactly what you were doing on 2.4, right?
>> (By setting the rewrite method).
>>
>> Mike
>>
>> On Thu, Oct 15, 2009 at 8:30 AM, Shaun Senecal <ssenecal.work@gmail.com>
>> wrote:
>> > Thanks for the explanation Mike. =A0It looks like I have no choice but=
 to
>> move
>> > any queries which throw TooManyClauses to be Filters. Sadly, this mean=
s a
>> > max query time of 6s under load unless I can find a way to rewrite the
>> query
>> > to span a Query and a Filter.
>> >
>> >
>> > Thanks again
>> >
>> >
>> >
>> > On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <ssenecal.work@gmail.c=
om
>> >
>> >> wrote:
>> >>
>> >> > Up to Lucene 2.4, this has been working out for us. =A0However, in
>> >> > Lucene 2.9 this breaks since rewrite() now returns a
>> >> > ConstantScoreQuery.
>> >>
>> >> You can get back to the 2.4 behavior by calling
>> >> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRIT=
E)
>> >> before calling rewrite().
>> >>
>> >> > Is there a way I can know that a ConstantScoreQuery will match at
>> >> > least 1 term (if not, I dont want to add it to the BooleanQuery)?
>> >>
>> >> There is a new method in 2.9: MultiTermQuery.getTotalNumberOfTerms(),
>> >> which returns how many terms were visited during rewrite. =A0Would th=
at
>> >> work?
>> >>
>> >> > My understanding is that Lucene will apply the Filter (C | D) first=
,
>> >> > limiting the result set, then apply the Query (A | B). =A0Is this
>> >> > correct?
>> >>
>> >> Actually the filter & query clauses are AND'd in a sort of leapfrog
>> >> fashion, taking turns skipping up to the other's doc ID and only
>> >> accepting a doc ID when they both skip to the same point. =A0But this
>> >> (the mechanics of how Lucene takes a filter into account) is an
>> >> implementation detail and is likely to change.
>> >>
>> >> > If so, the end result is essentially the query: (A | B) & (C | D)
>> >>
>> >> Except that C, D contribute no scoring information, if scoring
>> >> matters. =A0If scoring doesn't matter, entirely (even for A, B), you
>> >> should use a collector that does not call score() at all to save CPU.
>> >>
>> >> Mike
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42846-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 15 22:40:23 2009
Return-Path: <java-user-return-42846-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94838 invoked from network); 15 Oct 2009 22:40:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 15 Oct 2009 22:40:22 -0000
Received: (qmail 94805 invoked by uid 500); 15 Oct 2009 22:40:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94744 invoked by uid 500); 15 Oct 2009 22:40:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94734 invoked by uid 99); 15 Oct 2009 22:40:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 22:40:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ssenecal.work@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 15 Oct 2009 22:40:12 +0000
Received: by qyk26 with SMTP id 26so1042140qyk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 15:39:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=6d2kXHkumPli24JoRoEJysrdyhmcxm14HTgcsHUDZnE=;
        b=l8NLOhB/e9/Eztbt61UGdLs4tTERqHlA4wcn5tW+5VW1y25O0NsOkL6ZvnRaoOx8wP
         5xI2IeQh6MrexvtNI24KzgFTbyvTODrcqsa6yu1UC5cfcifu171ugHxTkVo9txKv33Z/
         tQkyGo+pbfTBXvtWAYpVIYWjl+eQvhzNPEOiM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Drwmst/81M8SHAdtlR5ZSivrF3xtu6J4qbaduoPQrsaNPHd5QdIoWMQqxJINtytTe9
         nUNDxA2HcNJm/n+9CEwcOsi9VcBBDWVVJiYs9y2DRd6QJg4hDa/oz7tExr5PGwMaaJam
         DlD/qTsTxWiYrHcO5C24in3+gcLZZEc0WSDfE=
MIME-Version: 1.0
Received: by 10.229.119.7 with SMTP id x7mr113811qcq.22.1255646390933; Thu, 15 
	Oct 2009 15:39:50 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910151446hf7a6c2fk4ed4fad88b466682@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
	 <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
	 <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
	 <15060d5e0910151442w310c3a3aofe59ae8f6a986f3a@mail.gmail.com>
	 <9ac0c6aa0910151446hf7a6c2fk4ed4fad88b466682@mail.gmail.com>
Date: Fri, 16 Oct 2009 07:39:50 +0900
Message-ID: <15060d5e0910151539s620804ecg5c4b1b955f80df74@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd5f2501859ef047600f5ed
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd5f2501859ef047600f5ed
Content-Type: text/plain; charset=ISO-8859-1

Ah!  I thought that the ConstantScoreQuery would also be rewritten into a
BooleanQuery, resulting in the same exception.  If that's the case, then
this should work.  I'll give that a try when I get into the office this
morning.


On Fri, Oct 16, 2009 at 6:46 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Well, you could wrap the C | D filter as a Query (using
> ConstantScoreQuery), and then add that as a SHOULD clause on your
> toplevel BooleanQuery?
>
> Mike
>
> On Thu, Oct 15, 2009 at 5:42 PM, Shaun Senecal <ssenecal.work@gmail.com>
> wrote:
> > At first I thought so, yes, but then I realised that the query I wanted
> to
> > execute was A | B | C | D and in reality I was executing (A | B) & (C |
> D).
> > I guess my unit tests were missing some cases and don't currently catch
> > this.
> >
> >
> >
> > On Thu, Oct 15, 2009 at 11:59 PM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> You should be able to do exactly what you were doing on 2.4, right?
> >> (By setting the rewrite method).
> >>
> >> Mike
> >>
> >> On Thu, Oct 15, 2009 at 8:30 AM, Shaun Senecal <ssenecal.work@gmail.com
> >
> >> wrote:
> >> > Thanks for the explanation Mike.  It looks like I have no choice but
> to
> >> move
> >> > any queries which throw TooManyClauses to be Filters. Sadly, this
> means a
> >> > max query time of 6s under load unless I can find a way to rewrite the
> >> query
> >> > to span a Query and a Filter.
> >> >
> >> >
> >> > Thanks again
> >> >
> >> >
> >> >
> >> > On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
> >> > lucene@mikemccandless.com> wrote:
> >> >
> >> >> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <
> ssenecal.work@gmail.com
> >> >
> >> >> wrote:
> >> >>
> >> >> > Up to Lucene 2.4, this has been working out for us.  However, in
> >> >> > Lucene 2.9 this breaks since rewrite() now returns a
> >> >> > ConstantScoreQuery.
> >> >>
> >> >> You can get back to the 2.4 behavior by calling
> >> >>
> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
> >> >> before calling rewrite().
> >> >>
> >> >> > Is there a way I can know that a ConstantScoreQuery will match at
> >> >> > least 1 term (if not, I dont want to add it to the BooleanQuery)?
> >> >>
> >> >> There is a new method in 2.9: MultiTermQuery.getTotalNumberOfTerms(),
> >> >> which returns how many terms were visited during rewrite.  Would that
> >> >> work?
> >> >>
> >> >> > My understanding is that Lucene will apply the Filter (C | D)
> first,
> >> >> > limiting the result set, then apply the Query (A | B).  Is this
> >> >> > correct?
> >> >>
> >> >> Actually the filter & query clauses are AND'd in a sort of leapfrog
> >> >> fashion, taking turns skipping up to the other's doc ID and only
> >> >> accepting a doc ID when they both skip to the same point.  But this
> >> >> (the mechanics of how Lucene takes a filter into account) is an
> >> >> implementation detail and is likely to change.
> >> >>
> >> >> > If so, the end result is essentially the query: (A | B) & (C | D)
> >> >>
> >> >> Except that C, D contribute no scoring information, if scoring
> >> >> matters.  If scoring doesn't matter, entirely (even for A, B), you
> >> >> should use a collector that does not call score() at all to save CPU.
> >> >>
> >> >> Mike
> >> >>
> >> >> ---------------------------------------------------------------------
> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >>
> >> >>
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd5f2501859ef047600f5ed--

From java-user-return-42847-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 06:58:23 2009
Return-Path: <java-user-return-42847-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5168 invoked from network); 16 Oct 2009 06:58:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 06:58:23 -0000
Received: (qmail 25695 invoked by uid 500); 16 Oct 2009 06:58:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25626 invoked by uid 500); 16 Oct 2009 06:58:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25616 invoked by uid 99); 16 Oct 2009 06:58:20 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 06:58:20 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of buschmic@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 06:58:10 +0000
Received: by qyk26 with SMTP id 26so1258027qyk.5
        for <java-user@lucene.apache.org>; Thu, 15 Oct 2009 23:57:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:content-type;
        bh=uh1ewn0aC7EDTRyoFrZKQ8zcjy2q/pAuMaXTC2FG7zo=;
        b=UM4gi959B7nHJIQltzPum4K8hIUnlFymzZyQYGG4cy3tXqblj6tnT6SWBbHBCHCyYo
         CynsIF0f0m7qKojucPO1dx0CY8P2aWbXPWrVhZJuGvmENuJqhlBNOWHvBD7jBQVFriU5
         M1aU7pTd7/hyyxi0jXKBgsNkYnHAN4nnd6UEw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject
         :content-type;
        b=BfDoaJGF/KAF3dZKLpHholnj0wE4oQ8LeqhSoSARAAO8br5DdpqU/n32e5TKEmtY1S
         wgyXM/Klu+2NRDFAEJiC+NnYuuDsip7xfdKcjKmfU+Hu2/P+Kmygc1EmfjLuaIDmirx6
         w+zrU8dhR/qKRg50exDisaP7Lrm19Ew+fSE3c=
Received: by 10.224.96.202 with SMTP id i10mr786236qan.311.1255676269716;
        Thu, 15 Oct 2009 23:57:49 -0700 (PDT)
Received: from michael-buschs-macbook-pro-2.local (c-98-248-34-169.hsd1.ca.comcast.net [98.248.34.169])
        by mx.google.com with ESMTPS id 7sm2000634qwb.42.2009.10.15.23.57.48
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 15 Oct 2009 23:57:48 -0700 (PDT)
Message-ID: <4AD81961.7090108@gmail.com>
Date: Thu, 15 Oct 2009 23:57:37 -0700
From: Michael Busch <buschmic@gmail.com>
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090915 Thunderbird/3.0b4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Proposal for changing Lucene's backwards-compatibility policy
Content-Type: multipart/alternative;
 boundary="------------070703010702020309020301"
X-Virus-Checked: Checked by ClamAV on apache.org

--------------070703010702020309020301
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hello Lucene users:

In the past we have discussed our backwards-compatibility policy
frequently on the Lucene developer mailinglist and we are thinking about
making some significant changes. In this mail I'd like to outline the
proposed changes to get some feedback from the user community.

Our current backwards-compatibility policy regarding API changes
states that we can only make changes that break
backwards-compatibility in major releases (3.0, 4.0, etc.); the next
major release is the upcoming 3.0.

Given how often we made major releases in the past in Lucene this
means that deprecated APIs need to stay in Lucene for a very long
time. E.g. if we deprecate an API in 3.1 we'll have to wait until 4.0
before we can remove it. This means that the code gets very cluttered
and adding new features gets somewhat more difficult, as attention has
to be paid to properly support the old *and* new APIs for a quite long
time.

The current policy also leads to delaying a last minor release before
a major release (e.g. 2.9), because the developers consider it as the
last chance for a long time to introduce new APIs and deprecate old ones.

The proposal now is to change this policy in a way, so that an API can
only be removed if it was deprecated in at least one release, which
can be a major *or* minor release. E.g. if we deprecate an API and
release it with 3.1, we can remove it with the 3.2 release.

The obvious downside of this proposal is that a simple jar drop-in
replacement will not be possible anymore with almost every Lucene release
(excluding bugfix releases, e.g. 2.9.0->2.9.1). However, you can be
sure that if you're using a non-deprecated API it will be in the next
release.

Note that of course these proposed changes do not affect
backwards-compatibility with old index formats. I.e. it will still be
possible to read all 3.X indexes with any Lucene 4.X version.

Our main goal is to find the right balance between
backwards-compatibility support for all the Lucene users out there and
fast and productive development of new features.

The developers haven't come to an agreement on this proposal yet.
Potentionally giving up the drop-in replacement promise that Lucene
could make in the past is the main reason for the struggle the developers
are in and why we'd like to ask the user community for feedback to
help us make a decision. After we gathered some feedback here we will
call a vote on the development mailinglist where the committers have
to officially decide whether to make these changes or not.

So please tell us which you prefer as a back compatibility policy for
Lucene:
A) best effort drop-in back compatibility for minor version numbers
(e.g. v3.5 will be compatible with v3.2)
B) best effort drop-in back compatibility for the next minor version
number only, and deprecations may be removed after one minor release
(e.g. v3.3 will be compat with v3.2, but not v3.4)

Note that in any case the changes will take affect *after* the 3.0
release.

On behalf of the Lucene developers,
  Michael Busch

--------------070703010702020309020301--

From java-user-return-42848-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 07:40:07 2009
Return-Path: <java-user-return-42848-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13550 invoked from network); 16 Oct 2009 07:40:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 07:40:07 -0000
Received: (qmail 67171 invoked by uid 500); 16 Oct 2009 07:40:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67107 invoked by uid 500); 16 Oct 2009 07:40:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67097 invoked by uid 99); 16 Oct 2009 07:40:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 07:40:05 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [194.109.24.24] (HELO smtp-vbr4.xs4all.nl) (194.109.24.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 07:40:02 +0000
Received: from k8u.localnet (porta.xs4all.nl [83.163.165.214])
	by smtp-vbr4.xs4all.nl (8.13.8/8.13.8) with ESMTP id n9G7deEg004061
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 09:39:40 +0200 (CEST)
	(envelope-from paul.elschot@xs4all.nl)
From: Paul Elschot <paul.elschot@xs4all.nl>
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
Date: Fri, 16 Oct 2009 09:39:39 +0200
User-Agent: KMail/1.11.2 (Linux/2.6.28-15-generic; KDE/4.2.2; i686; ; )
References: <4AD81961.7090108@gmail.com>
In-Reply-To: <4AD81961.7090108@gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative;
  boundary="Boundary-00=_8MC2KTDSD0QbvNY"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-Id: <200910160939.40260.paul.elschot@xs4all.nl>
X-Virus-Scanned: by XS4ALL Virus Scanner

--Boundary-00=_8MC2KTDSD0QbvNY
Content-Type: text/plain;
  charset="iso-8859-15"
Content-Transfer-Encoding: 7bit

On Friday 16 October 2009 08:57:37 Michael Busch wrote:
> Hello Lucene users:
> 
> In the past we have discussed our backwards-compatibility policy
> frequently on the Lucene developer mailinglist and we are thinking about
> making some significant changes. In this mail I'd like to outline the
> proposed changes to get some feedback from the user community.
> 
> Our current backwards-compatibility policy regarding API changes
> states that we can only make changes that break
> backwards-compatibility in major releases (3.0, 4.0, etc.); the next
> major release is the upcoming 3.0.
> 
> Given how often we made major releases in the past in Lucene this
> means that deprecated APIs need to stay in Lucene for a very long
> time. E.g. if we deprecate an API in 3.1 we'll have to wait until 4.0
> before we can remove it. This means that the code gets very cluttered
> and adding new features gets somewhat more difficult, as attention has
> to be paid to properly support the old *and* new APIs for a quite long
> time.
> 
> The current policy also leads to delaying a last minor release before
> a major release (e.g. 2.9), because the developers consider it as the
> last chance for a long time to introduce new APIs and deprecate old ones.
> 
> The proposal now is to change this policy in a way, so that an API can
> only be removed if it was deprecated in at least one release, which
> can be a major *or* minor release. E.g. if we deprecate an API and
> release it with 3.1, we can remove it with the 3.2 release.
> 
> The obvious downside of this proposal is that a simple jar drop-in
> replacement will not be possible anymore with almost every Lucene release
> (excluding bugfix releases, e.g. 2.9.0->2.9.1). However, you can be
> sure that if you're using a non-deprecated API it will be in the next
> release.
> 
> Note that of course these proposed changes do not affect
> backwards-compatibility with old index formats. I.e. it will still be
> possible to read all 3.X indexes with any Lucene 4.X version.
> 
> Our main goal is to find the right balance between
> backwards-compatibility support for all the Lucene users out there and
> fast and productive development of new features.
> 
> The developers haven't come to an agreement on this proposal yet.
> Potentionally giving up the drop-in replacement promise that Lucene
> could make in the past is the main reason for the struggle the developers
> are in and why we'd like to ask the user community for feedback to
> help us make a decision. After we gathered some feedback here we will
> call a vote on the development mailinglist where the committers have
> to officially decide whether to make these changes or not.
> 
> So please tell us which you prefer as a back compatibility policy for
> Lucene:
> A) best effort drop-in back compatibility for minor version numbers
> (e.g. v3.5 will be compatible with v3.2)
> B) best effort drop-in back compatibility for the next minor version
> number only, and deprecations may be removed after one minor release
> (e.g. v3.3 will be compat with v3.2, but not v3.4)

I'd prefer B), with a minimum period of about two months to the
next release in case it removes deprecations.

Regards,
Paul Elschot

--Boundary-00=_8MC2KTDSD0QbvNY--

From java-user-return-42849-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 08:07:03 2009
Return-Path: <java-user-return-42849-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20023 invoked from network); 16 Oct 2009 08:07:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 08:07:01 -0000
Received: (qmail 90359 invoked by uid 500); 16 Oct 2009 08:06:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90280 invoked by uid 500); 16 Oct 2009 08:06:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90250 invoked by uid 99); 16 Oct 2009 08:06:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:06:59 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ssenecal.work@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:06:50 +0000
Received: by qyk26 with SMTP id 26so1279464qyk.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 01:06:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=FZUArNxgyyxiZn7LFJZC/EkYgj7gLc1mxI5ZvtTlfno=;
        b=DT4gj9v+G6j2ZVXgTRh7hZYvRXrw3+naDQAB38RESyEmarz9VSrp9JG8BxVgf0fKiJ
         qoRiglFzJHJ/6bYRFFi8lLmvZuD4H8c270KA+5M3NBp2p6NIR1rzDrpIxCZbS/B0WSFX
         5+ekjEl7qY3MdfXTDJ9skJBkNUPGQlEJq5Wzk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ORwyEs1c9G6bQmMw7DEH8grfrq5/0X8BxqluYuYwA5K8WdqWB+ECmyhCPXgsCDuvQ+
         9XKDzJojwdvQ29NwELH7oczqtElvw25kcrYGOVdbeOYh8HhGVztMs2sESmjXJbrM4YLS
         +Db1dxWTCkaoh5hodeR96FTiWwUGrbfHFCKtQ=
MIME-Version: 1.0
Received: by 10.229.92.199 with SMTP id s7mr183875qcm.23.1255680389172; Fri, 
	16 Oct 2009 01:06:29 -0700 (PDT)
In-Reply-To: <15060d5e0910151539s620804ecg5c4b1b955f80df74@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
	 <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
	 <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
	 <15060d5e0910151442w310c3a3aofe59ae8f6a986f3a@mail.gmail.com>
	 <9ac0c6aa0910151446hf7a6c2fk4ed4fad88b466682@mail.gmail.com>
	 <15060d5e0910151539s620804ecg5c4b1b955f80df74@mail.gmail.com>
Date: Fri, 16 Oct 2009 17:06:29 +0900
Message-ID: <15060d5e0910160106u35ecdd01m2b7662eafb0c2c74@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Shaun Senecal <ssenecal.work@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd6a7ba8c4e89047608df14
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd6a7ba8c4e89047608df14
Content-Type: text/plain; charset=ISO-8859-1

Thanks Mike.  The queries are now running faster than they ever were before,
and are returning the expected results!


On Fri, Oct 16, 2009 at 7:39 AM, Shaun Senecal <ssenecal.work@gmail.com>wrote:

> Ah!  I thought that the ConstantScoreQuery would also be rewritten into a
> BooleanQuery, resulting in the same exception.  If that's the case, then
> this should work.  I'll give that a try when I get into the office this
> morning.
>
>
>
> On Fri, Oct 16, 2009 at 6:46 AM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> Well, you could wrap the C | D filter as a Query (using
>> ConstantScoreQuery), and then add that as a SHOULD clause on your
>> toplevel BooleanQuery?
>>
>> Mike
>>
>> On Thu, Oct 15, 2009 at 5:42 PM, Shaun Senecal <ssenecal.work@gmail.com>
>> wrote:
>> > At first I thought so, yes, but then I realised that the query I wanted
>> to
>> > execute was A | B | C | D and in reality I was executing (A | B) & (C |
>> D).
>> > I guess my unit tests were missing some cases and don't currently catch
>> > this.
>> >
>> >
>> >
>> > On Thu, Oct 15, 2009 at 11:59 PM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> You should be able to do exactly what you were doing on 2.4, right?
>> >> (By setting the rewrite method).
>> >>
>> >> Mike
>> >>
>> >> On Thu, Oct 15, 2009 at 8:30 AM, Shaun Senecal <
>> ssenecal.work@gmail.com>
>> >> wrote:
>> >> > Thanks for the explanation Mike.  It looks like I have no choice but
>> to
>> >> move
>> >> > any queries which throw TooManyClauses to be Filters. Sadly, this
>> means a
>> >> > max query time of 6s under load unless I can find a way to rewrite
>> the
>> >> query
>> >> > to span a Query and a Filter.
>> >> >
>> >> >
>> >> > Thanks again
>> >> >
>> >> >
>> >> >
>> >> > On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
>> >> > lucene@mikemccandless.com> wrote:
>> >> >
>> >> >> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <
>> ssenecal.work@gmail.com
>> >> >
>> >> >> wrote:
>> >> >>
>> >> >> > Up to Lucene 2.4, this has been working out for us.  However, in
>> >> >> > Lucene 2.9 this breaks since rewrite() now returns a
>> >> >> > ConstantScoreQuery.
>> >> >>
>> >> >> You can get back to the 2.4 behavior by calling
>> >> >>
>> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
>> >> >> before calling rewrite().
>> >> >>
>> >> >> > Is there a way I can know that a ConstantScoreQuery will match at
>> >> >> > least 1 term (if not, I dont want to add it to the BooleanQuery)?
>> >> >>
>> >> >> There is a new method in 2.9:
>> MultiTermQuery.getTotalNumberOfTerms(),
>> >> >> which returns how many terms were visited during rewrite.  Would
>> that
>> >> >> work?
>> >> >>
>> >> >> > My understanding is that Lucene will apply the Filter (C | D)
>> first,
>> >> >> > limiting the result set, then apply the Query (A | B).  Is this
>> >> >> > correct?
>> >> >>
>> >> >> Actually the filter & query clauses are AND'd in a sort of leapfrog
>> >> >> fashion, taking turns skipping up to the other's doc ID and only
>> >> >> accepting a doc ID when they both skip to the same point.  But this
>> >> >> (the mechanics of how Lucene takes a filter into account) is an
>> >> >> implementation detail and is likely to change.
>> >> >>
>> >> >> > If so, the end result is essentially the query: (A | B) & (C | D)
>> >> >>
>> >> >> Except that C, D contribute no scoring information, if scoring
>> >> >> matters.  If scoring doesn't matter, entirely (even for A, B), you
>> >> >> should use a collector that does not call score() at all to save
>> CPU.
>> >> >>
>> >> >> Mike
>> >> >>
>> >> >>
>> ---------------------------------------------------------------------
>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >>
>> >> >>
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--000e0cd6a7ba8c4e89047608df14--

From java-user-return-42850-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 08:24:01 2009
Return-Path: <java-user-return-42850-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22535 invoked from network); 16 Oct 2009 08:24:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 08:24:01 -0000
Received: (qmail 6026 invoked by uid 500); 16 Oct 2009 08:23:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5977 invoked by uid 500); 16 Oct 2009 08:23:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5967 invoked by uid 99); 16 Oct 2009 08:23:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:23:58 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of torindan@gmail.com designates 209.85.221.188 as permitted sender)
Received: from [209.85.221.188] (HELO mail-qy0-f188.google.com) (209.85.221.188)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:23:50 +0000
Received: by qyk26 with SMTP id 26so1284376qyk.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 01:23:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=vqwInuu8VAnwdpMC8Uh3tl+LWwlgIzrc1cg30OAC0xQ=;
        b=ms3dxhJE01tX9pMtwOmANI9dIKdrNmRBvRocRHHkzRTVTdsksa6VwBXSU/XZYBgO3z
         SOH+0wqldGGBNV6IjY1H686OwKUs8b0aFm4axrdndS1K/HCVcR+A4AGj0GvGS38/TiE0
         n3pNut90RPThPdOJ3gloPRe/rMO1esMmjUsiM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=n2vj14sTpsQJXBlPt5n3/SRAVIW3CkCeXQgQu8ORHhegbC1FSX6x/dImXmVHslSn9/
         letIDza9Mv+3ThZo9Ph8Z2AxVddkrLpjxzizRa+5p6bbru7578m/pSmMeQpUtvYZVx/w
         Hf4JuHYrkEPWG0Q3JTLyB2/jOLl9FscsJVxH4=
MIME-Version: 1.0
Received: by 10.229.118.6 with SMTP id t6mr199568qcq.39.1255681409565; Fri, 16 
	Oct 2009 01:23:29 -0700 (PDT)
In-Reply-To: <200910160939.40260.paul.elschot@xs4all.nl>
References: <4AD81961.7090108@gmail.com>
	 <200910160939.40260.paul.elschot@xs4all.nl>
Date: Fri, 16 Oct 2009 11:23:29 +0300
Message-ID: <2ffb6d060910160123w7330c087r4e8b5d958782a87e@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
From: =?UTF-8?B?RGFuaWwgxaJPUklO?= <torindan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

I'd vote A with following addition:

What about creating major version more often?

If there are incremental improvements which don't clutter the code too
much continue with 3.0 -> 3.1 -> 3.2 -> .. -> 3.X
Once there are significant changes which are hard to maintain backward
compatible start a 4.0 line.

Just as you did before, just lower the threshold on what kind of
changes force new major version release.

For example in 2.9 release cycle at least AttributeSource stuff
deserved a new major version.
Uwe's Trie/Numeric fields, LUCENE-1483 and so on are incremental so
could be minor releases.

So upcoming 3.0 with java 1.5 and massive deprecation of old stuff
would actually be at least 4.0.

On Fri, Oct 16, 2009 at 10:39, Paul Elschot <paul.elschot@xs4all.nl> wrote:
> On Friday 16 October 2009 08:57:37 Michael Busch wrote:
>> Hello Lucene users:
>>
>> In the past we have discussed our backwards-compatibility policy
>> frequently on the Lucene developer mailinglist and we are thinking about
>> making some significant changes. In this mail I'd like to outline the
>> proposed changes to get some feedback from the user community.
>>
>> Our current backwards-compatibility policy regarding API changes
>> states that we can only make changes that break
>> backwards-compatibility in major releases (3.0, 4.0, etc.); the next
>> major release is the upcoming 3.0.
>>
>> Given how often we made major releases in the past in Lucene this
>> means that deprecated APIs need to stay in Lucene for a very long
>> time. E.g. if we deprecate an API in 3.1 we'll have to wait until 4.0
>> before we can remove it. This means that the code gets very cluttered
>> and adding new features gets somewhat more difficult, as attention has
>> to be paid to properly support the old *and* new APIs for a quite long
>> time.
>>
>> The current policy also leads to delaying a last minor release before
>> a major release (e.g. 2.9), because the developers consider it as the
>> last chance for a long time to introduce new APIs and deprecate old ones.
>>
>> The proposal now is to change this policy in a way, so that an API can
>> only be removed if it was deprecated in at least one release, which
>> can be a major *or* minor release. E.g. if we deprecate an API and
>> release it with 3.1, we can remove it with the 3.2 release.
>>
>> The obvious downside of this proposal is that a simple jar drop-in
>> replacement will not be possible anymore with almost every Lucene release
>> (excluding bugfix releases, e.g. 2.9.0->2.9.1). However, you can be
>> sure that if you're using a non-deprecated API it will be in the next
>> release.
>>
>> Note that of course these proposed changes do not affect
>> backwards-compatibility with old index formats. I.e. it will still be
>> possible to read all 3.X indexes with any Lucene 4.X version.
>>
>> Our main goal is to find the right balance between
>> backwards-compatibility support for all the Lucene users out there and
>> fast and productive development of new features.
>>
>> The developers haven't come to an agreement on this proposal yet.
>> Potentionally giving up the drop-in replacement promise that Lucene
>> could make in the past is the main reason for the struggle the developers
>> are in and why we'd like to ask the user community for feedback to
>> help us make a decision. After we gathered some feedback here we will
>> call a vote on the development mailinglist where the committers have
>> to officially decide whether to make these changes or not.
>>
>> So please tell us which you prefer as a back compatibility policy for
>> Lucene:
>> A) best effort drop-in back compatibility for minor version numbers
>> (e.g. v3.5 will be compatible with v3.2)
>> B) best effort drop-in back compatibility for the next minor version
>> number only, and deprecations may be removed after one minor release
>> (e.g. v3.3 will be compat with v3.2, but not v3.4)
>
> I'd prefer B), with a minimum period of about two months to the
> next release in case it removes deprecations.
>
> Regards,
> Paul Elschot
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42851-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 08:24:29 2009
Return-Path: <java-user-return-42851-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22637 invoked from network); 16 Oct 2009 08:24:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 08:24:29 -0000
Received: (qmail 7940 invoked by uid 500); 16 Oct 2009 08:24:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7858 invoked by uid 500); 16 Oct 2009 08:24:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7848 invoked by uid 99); 16 Oct 2009 08:24:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:24:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rff.rff@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:24:19 +0000
Received: by ewy26 with SMTP id 26so1751410ewy.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 01:23:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=1qHHEvO0BWAeYlk+TSZ4Kf/R/2joUmnH6xC7PCJyjbo=;
        b=RcWrglcqzTxW1CeWwkI5HRlHZ/+mfgr27Nch8CsEYMJtSAPx6DTTxUs81oVeOyzE8E
         NM+sbp+cI53DTIpKqsRbpQuxLHki1NkAZo/wvkmtqGUp39hhRiqix//Zxa/HLqBbzC0a
         1NTCtMFEZ2jlCraaKgIGMa1lfWVDwsHGl1QFc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=tAQcOFsGyc5xmesrysutBRvJO2F+cJjx9UI5qucR0Up3PTdzxgV+Yv1zP/wdBdJR/E
         9cyGg7JBJKWL7ADGl0B9Vf3K4qs0Ksoa/gidQeC45dKtG/jH1ueAX9sHqY2rkenovyZ0
         SbyTRAJ5lELBOCRBmg67k25sWGkD3g9p1vtWQ=
MIME-Version: 1.0
Received: by 10.216.85.138 with SMTP id u10mr481629wee.185.1255681439074; Fri, 
	16 Oct 2009 01:23:59 -0700 (PDT)
In-Reply-To: <200910160939.40260.paul.elschot@xs4all.nl>
References: <4AD81961.7090108@gmail.com> <200910160939.40260.paul.elschot@xs4all.nl>
From: gabriele renzi <rff.rff@gmail.com>
Date: Fri, 16 Oct 2009 10:23:39 +0200
Message-ID: <828083e70910160123i4226acecx2b397529cc77640d@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On Fri, Oct 16, 2009 at 9:39 AM, Paul Elschot <paul.elschot@xs4all.nl> wrote:

> I'd prefer B), with a minimum period of about two months to the
> next release in case it removes deprecations.

for what my vote counts, seconded

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42852-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 08:45:09 2009
Return-Path: <java-user-return-42852-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26736 invoked from network); 16 Oct 2009 08:45:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 08:45:09 -0000
Received: (qmail 34433 invoked by uid 500); 16 Oct 2009 08:45:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34365 invoked by uid 500); 16 Oct 2009 08:45:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34354 invoked by uid 99); 16 Oct 2009 08:45:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:45:05 +0000
X-ASF-Spam-Status: No, hits=-6.6 required=5.0
	tests=BAYES_00,RCVD_IN_DNSWL_MED
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 131.246.120.220 is neither permitted nor denied by domain of christian.reuschling@gmail.com)
Received: from [131.246.120.220] (HELO mailgw1.uni-kl.de) (131.246.120.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:45:02 +0000
Received: from dfki.uni-kl.de (dfki-1002.dfki.uni-kl.de [131.246.195.2])
	by mailgw1.uni-kl.de (8.13.8/8.13.8/Debian-3) with ESMTP id n9G8ieL5023110
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:44:41 +0200
Received: from serv-4100.kl.dfki.de (serv-4100.kl.dfki.de [192.168.41.180])
	by dfki.uni-kl.de (8.13.8+Sun/8.11.4) with ESMTP id n9G8ie0e003349
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:44:40 +0200 (CEST)
Received: from pc-4176.kl.dfki.de (pc-4176.kl.dfki.de [192.168.41.166])
	by serv-4100.kl.dfki.de (8.13.8+Sun/8.13.8) with ESMTP id n9G8iemT007501
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:44:40 +0200 (CEST)
Date: Fri, 16 Oct 2009 10:44:32 +0200
From: Christian Reuschling <christian.reuschling@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
Message-ID: <20091016104432.65989ce1@pc-4176.kl.dfki.de>
In-Reply-To: <4AD81961.7090108@gmail.com>
References: <4AD81961.7090108@gmail.com>
X-Mailer: Claws Mail 3.7.2 (GTK+ 2.14.4; i586-http://packman.links2linux.de-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; boundary="Sig_/QiS/uN/Jhed7KqshLGiH/n+";
 protocol="application/pgp-signature"; micalg=PGP-SHA1

--Sig_/QiS/uN/Jhed7KqshLGiH/n+
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

Hello Michael,

I also would prefer B - it also shortens the time to have a benefit of new
Lucene features in our applications.
It forces our lazy programmers (I am of course ;) ) to deal with them - and
reduces the efford to change to a major release afterwards.
Maybe some minimum time waiting before removing a deprecated API would be n=
ice,
such as the 2 months Paul mentioned

regards

Chris



On Thu, 15 Oct 2009 23:57:37 -0700
Michael Busch <buschmic@gmail.com> wrote:

> Hello Lucene users:
>=20
> In the past we have discussed our backwards-compatibility policy
> frequently on the Lucene developer mailinglist and we are thinking about
> making some significant changes. In this mail I'd like to outline the
> proposed changes to get some feedback from the user community.
>=20
> Our current backwards-compatibility policy regarding API changes
> states that we can only make changes that break
> backwards-compatibility in major releases (3.0, 4.0, etc.); the next
> major release is the upcoming 3.0.
>=20
> Given how often we made major releases in the past in Lucene this
> means that deprecated APIs need to stay in Lucene for a very long
> time. E.g. if we deprecate an API in 3.1 we'll have to wait until 4.0
> before we can remove it. This means that the code gets very cluttered
> and adding new features gets somewhat more difficult, as attention has
> to be paid to properly support the old *and* new APIs for a quite long
> time.
>=20
> The current policy also leads to delaying a last minor release before
> a major release (e.g. 2.9), because the developers consider it as the
> last chance for a long time to introduce new APIs and deprecate old ones.
>=20
> The proposal now is to change this policy in a way, so that an API can
> only be removed if it was deprecated in at least one release, which
> can be a major *or* minor release. E.g. if we deprecate an API and
> release it with 3.1, we can remove it with the 3.2 release.
>=20
> The obvious downside of this proposal is that a simple jar drop-in
> replacement will not be possible anymore with almost every Lucene release
> (excluding bugfix releases, e.g. 2.9.0->2.9.1). However, you can be
> sure that if you're using a non-deprecated API it will be in the next
> release.
>=20
> Note that of course these proposed changes do not affect
> backwards-compatibility with old index formats. I.e. it will still be
> possible to read all 3.X indexes with any Lucene 4.X version.
>=20
> Our main goal is to find the right balance between
> backwards-compatibility support for all the Lucene users out there and
> fast and productive development of new features.
>=20
> The developers haven't come to an agreement on this proposal yet.
> Potentionally giving up the drop-in replacement promise that Lucene
> could make in the past is the main reason for the struggle the developers
> are in and why we'd like to ask the user community for feedback to
> help us make a decision. After we gathered some feedback here we will
> call a vote on the development mailinglist where the committers have
> to officially decide whether to make these changes or not.
>=20
> So please tell us which you prefer as a back compatibility policy for
> Lucene:
> A) best effort drop-in back compatibility for minor version numbers
> (e.g. v3.5 will be compatible with v3.2)
> B) best effort drop-in back compatibility for the next minor version
> number only, and deprecations may be removed after one minor release
> (e.g. v3.3 will be compat with v3.2, but not v3.4)
>=20
> Note that in any case the changes will take affect *after* the 3.0
> release.
>=20
> On behalf of the Lucene developers,
>   Michael Busch


--Sig_/QiS/uN/Jhed7KqshLGiH/n+
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.9 (GNU/Linux)

iEYEARECAAYFAkrYMnQACgkQ6EqMXq+WZg82CQCcDa3DgXda3k9wVqxesQPotIQL
4PgAniBuqoOa7JtgFTXTzgedXM+dPYPB
=HUBz
-----END PGP SIGNATURE-----

--Sig_/QiS/uN/Jhed7KqshLGiH/n+--

From java-user-return-42853-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 08:55:27 2009
Return-Path: <java-user-return-42853-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29806 invoked from network); 16 Oct 2009 08:55:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 08:55:27 -0000
Received: (qmail 56194 invoked by uid 500); 16 Oct 2009 08:55:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56128 invoked by uid 500); 16 Oct 2009 08:55:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56118 invoked by uid 99); 16 Oct 2009 08:55:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:55:25 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jukka.zitting@gmail.com designates 209.85.210.193 as permitted sender)
Received: from [209.85.210.193] (HELO mail-yx0-f193.google.com) (209.85.210.193)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 08:55:17 +0000
Received: by yxe31 with SMTP id 31so1673474yxe.21
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 01:54:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=R7+DO5b5w61H/F9smowRdBD2VT4tSwwK2mp6MlulNlU=;
        b=ZHjjRKPTh3FSSOl/0NGJtFTNJKfYjBfYPapR3MCyAaUPZq/5XeVzCs2dv7OonsUzh2
         NiaS4rm6yDScHWWOg8du8lLMcN2TariUq2FVFsNA9p2aQkqJBSqVRc8ox2Bm2GtyItOt
         LYU69mEX0XLByJp8MrXF4/AIMMP2y9icCmRNM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=Sk5h//XWU2p1vJvJ775wC8ZXvSlESfdS573lqyC8ptM3feg+gGspVdSUj2HnrK6Rq4
         fQ7fUtX50fFWn9e84xTbBYfvxxNpJbPRu4mkMFIvmIg0JufLYW8fIbtIwYg/cWT+636v
         f7JqDj4S7qbWc/2GtFTlyF5ixoDNMnvgs3yK8=
MIME-Version: 1.0
Received: by 10.101.89.5 with SMTP id r5mr1420687anl.69.1255683296445; Fri, 16 
	Oct 2009 01:54:56 -0700 (PDT)
In-Reply-To: <2ffb6d060910160123w7330c087r4e8b5d958782a87e@mail.gmail.com>
References: <4AD81961.7090108@gmail.com>
	 <200910160939.40260.paul.elschot@xs4all.nl>
	 <2ffb6d060910160123w7330c087r4e8b5d958782a87e@mail.gmail.com>
Date: Fri, 16 Oct 2009 10:54:56 +0200
Message-ID: <510143ac0910160154m27719ed8k6466372a87f6dfc9@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
From: Jukka Zitting <jukka.zitting@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

On Fri, Oct 16, 2009 at 10:23 AM, Danil =C5=A2ORIN <torindan@gmail.com> wro=
te:
> What about creating major version more often?

+1 We're not going to run out of version numbers, so I don't see a
reason not to upgrade the major version number when making
backwards-incompatible changes.

BR,

Jukka Zitting

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42854-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 09:13:42 2009
Return-Path: <java-user-return-42854-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34161 invoked from network); 16 Oct 2009 09:13:42 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 09:13:42 -0000
Received: (qmail 79518 invoked by uid 500); 16 Oct 2009 09:13:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 79441 invoked by uid 500); 16 Oct 2009 09:13:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 79431 invoked by uid 99); 16 Oct 2009 09:13:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 09:13:39 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.193] (HELO mail-yx0-f193.google.com) (209.85.210.193)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 09:13:37 +0000
Received: by yxe31 with SMTP id 31so1681486yxe.21
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 02:13:15 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.61.15 with SMTP id j15mr2219314yba.292.1255684395643; Fri, 
	16 Oct 2009 02:13:15 -0700 (PDT)
In-Reply-To: <15060d5e0910160106u35ecdd01m2b7662eafb0c2c74@mail.gmail.com>
References: <15060d5e0910150114h1a20545dr62974657679c4458@mail.gmail.com>
	 <15060d5e0910150157m478a9283mc307fd725df2a714@mail.gmail.com>
	 <9ac0c6aa0910150252q274c09e3iaef98c512bf34e2e@mail.gmail.com>
	 <15060d5e0910150530t72e1642bt625db9833f15f88f@mail.gmail.com>
	 <9ac0c6aa0910150759p2a72bf92q9a84da90bbe2a8ae@mail.gmail.com>
	 <15060d5e0910151442w310c3a3aofe59ae8f6a986f3a@mail.gmail.com>
	 <9ac0c6aa0910151446hf7a6c2fk4ed4fad88b466682@mail.gmail.com>
	 <15060d5e0910151539s620804ecg5c4b1b955f80df74@mail.gmail.com>
	 <15060d5e0910160106u35ecdd01m2b7662eafb0c2c74@mail.gmail.com>
Date: Fri, 16 Oct 2009 05:13:15 -0400
Message-ID: <9ac0c6aa0910160213l68abf546v95e938ba51fe0a28@mail.gmail.com>
Subject: Re: PrefixQueries on large indexes (4M+ Documents) using a partial 
	Query partial Filter solution
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Super!

Mike

On Fri, Oct 16, 2009 at 4:06 AM, Shaun Senecal <ssenecal.work@gmail.com> wr=
ote:
> Thanks Mike. =A0The queries are now running faster than they ever were be=
fore,
> and are returning the expected results!
>
>
> On Fri, Oct 16, 2009 at 7:39 AM, Shaun Senecal <ssenecal.work@gmail.com>w=
rote:
>
>> Ah! =A0I thought that the ConstantScoreQuery would also be rewritten int=
o a
>> BooleanQuery, resulting in the same exception. =A0If that's the case, th=
en
>> this should work. =A0I'll give that a try when I get into the office thi=
s
>> morning.
>>
>>
>>
>> On Fri, Oct 16, 2009 at 6:46 AM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> Well, you could wrap the C | D filter as a Query (using
>>> ConstantScoreQuery), and then add that as a SHOULD clause on your
>>> toplevel BooleanQuery?
>>>
>>> Mike
>>>
>>> On Thu, Oct 15, 2009 at 5:42 PM, Shaun Senecal <ssenecal.work@gmail.com=
>
>>> wrote:
>>> > At first I thought so, yes, but then I realised that the query I want=
ed
>>> to
>>> > execute was A | B | C | D and in reality I was executing (A | B) & (C=
 |
>>> D).
>>> > I guess my unit tests were missing some cases and don't currently cat=
ch
>>> > this.
>>> >
>>> >
>>> >
>>> > On Thu, Oct 15, 2009 at 11:59 PM, Michael McCandless <
>>> > lucene@mikemccandless.com> wrote:
>>> >
>>> >> You should be able to do exactly what you were doing on 2.4, right?
>>> >> (By setting the rewrite method).
>>> >>
>>> >> Mike
>>> >>
>>> >> On Thu, Oct 15, 2009 at 8:30 AM, Shaun Senecal <
>>> ssenecal.work@gmail.com>
>>> >> wrote:
>>> >> > Thanks for the explanation Mike. =A0It looks like I have no choice=
 but
>>> to
>>> >> move
>>> >> > any queries which throw TooManyClauses to be Filters. Sadly, this
>>> means a
>>> >> > max query time of 6s under load unless I can find a way to rewrite
>>> the
>>> >> query
>>> >> > to span a Query and a Filter.
>>> >> >
>>> >> >
>>> >> > Thanks again
>>> >> >
>>> >> >
>>> >> >
>>> >> > On Thu, Oct 15, 2009 at 6:52 PM, Michael McCandless <
>>> >> > lucene@mikemccandless.com> wrote:
>>> >> >
>>> >> >> On Thu, Oct 15, 2009 at 4:57 AM, Shaun Senecal <
>>> ssenecal.work@gmail.com
>>> >> >
>>> >> >> wrote:
>>> >> >>
>>> >> >> > Up to Lucene 2.4, this has been working out for us. =A0However,=
 in
>>> >> >> > Lucene 2.9 this breaks since rewrite() now returns a
>>> >> >> > ConstantScoreQuery.
>>> >> >>
>>> >> >> You can get back to the 2.4 behavior by calling
>>> >> >>
>>> prefixQuery.setRewriteMethod(prefixQuery.SCORING_BOOLEAN_QUERY_REWRITE)
>>> >> >> before calling rewrite().
>>> >> >>
>>> >> >> > Is there a way I can know that a ConstantScoreQuery will match =
at
>>> >> >> > least 1 term (if not, I dont want to add it to the BooleanQuery=
)?
>>> >> >>
>>> >> >> There is a new method in 2.9:
>>> MultiTermQuery.getTotalNumberOfTerms(),
>>> >> >> which returns how many terms were visited during rewrite. =A0Woul=
d
>>> that
>>> >> >> work?
>>> >> >>
>>> >> >> > My understanding is that Lucene will apply the Filter (C | D)
>>> first,
>>> >> >> > limiting the result set, then apply the Query (A | B). =A0Is th=
is
>>> >> >> > correct?
>>> >> >>
>>> >> >> Actually the filter & query clauses are AND'd in a sort of leapfr=
og
>>> >> >> fashion, taking turns skipping up to the other's doc ID and only
>>> >> >> accepting a doc ID when they both skip to the same point. =A0But =
this
>>> >> >> (the mechanics of how Lucene takes a filter into account) is an
>>> >> >> implementation detail and is likely to change.
>>> >> >>
>>> >> >> > If so, the end result is essentially the query: (A | B) & (C | =
D)
>>> >> >>
>>> >> >> Except that C, D contribute no scoring information, if scoring
>>> >> >> matters. =A0If scoring doesn't matter, entirely (even for A, B), =
you
>>> >> >> should use a collector that does not call score() at all to save
>>> CPU.
>>> >> >>
>>> >> >> Mike
>>> >> >>
>>> >> >>
>>> ---------------------------------------------------------------------
>>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >> >>
>>> >> >>
>>> >> >
>>> >>
>>> >> --------------------------------------------------------------------=
-
>>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >>
>>> >>
>>> >
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42855-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 09:38:54 2009
Return-Path: <java-user-return-42855-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40031 invoked from network); 16 Oct 2009 09:38:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 09:38:54 -0000
Received: (qmail 12402 invoked by uid 500); 16 Oct 2009 09:38:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12365 invoked by uid 500); 16 Oct 2009 09:38:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12350 invoked by uid 99); 16 Oct 2009 09:38:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 09:38:52 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=MSGID_RANDY,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [129.125.60.2] (HELO smtp2h.service.rug.nl) (129.125.60.2)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 09:38:42 +0000
Received: from mail3.rug.nl (f5selfip-4-60.service.rug.nl [129.125.60.248])
	by smtp2h.service.rug.nl (8.14.3/8.14.3) with ESMTP id n9G9cMdL005335
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 11:38:22 +0200
Received: from [82.73.38.192] (account p253714@rug.nl)
  by mail3.rug.nl (CommuniGate Pro WEBUSER 5.1.16)
  with HTTP id 126509778 for java-user@lucene.apache.org; Fri, 16 Oct 2009 11:38:22 +0200
From: "R.A.Ittoo" <R.A.Ittoo@rug.nl>
Subject: which version
To: java-user@lucene.apache.org
X-Mailer: CommuniGate Pro WebUser v5.1.16
Date: Fri, 16 Oct 2009 11:38:22 +0200
Message-ID: <web-126509778@mail3.rug.nl>
MIME-Version: 1.0
Content-Type: text/plain;charset=utf-8;format="flowed"
Content-Transfer-Encoding: 8bit
X-Virus-Scanned: clamav-milter 0.95.2 at smtp2h
X-Virus-Status: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

hi
i am using lucene version 2.9
When calling the StandardAnalyzer constructor with the
VErsion.LUCENE_VERSION as parameter, I get the error
"symbol not found constructor
StandardAnalyzer(org.apache.lucene.util.Version)"

this is strange, as it is supposed to be correct according to the API
doc and my jar file is called lucene-core-2.9.0.jar

However, the deprecated constructor new StandardAnalyzer() (without
any parameters) worked fine.

I am confused now as to whether i am really using version 2.9
can anybody please advise?

ashwin

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42856-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 09:59:58 2009
Return-Path: <java-user-return-42856-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47692 invoked from network); 16 Oct 2009 09:59:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 09:59:58 -0000
Received: (qmail 44543 invoked by uid 500); 16 Oct 2009 09:59:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44506 invoked by uid 500); 16 Oct 2009 09:59:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44496 invoked by uid 99); 16 Oct 2009 09:59:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 09:59:55 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [62.213.161.134] (HELO pmx.sirma.bg) (62.213.161.134)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 09:59:53 +0000
X-Virus-Scanned: Sirma Antivirus System
Received: from [192.168.128.140] (ivasilev.sirma.int [192.168.128.140])
	by pmx.sirma.bg (Sirma mail system) with ESMTP id 3F89724005
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:59:31 +0300 (EEST)
Message-ID: <4AD84400.5050802@sirma.bg>
Date: Fri, 16 Oct 2009 12:59:28 +0300
From: Ivan Vasilev <ivasilev@sirma.bg>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: LUCENE MAIL LIST <java-user@lucene.apache.org>
Subject: is Lucene 3.0 coming soon?
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Hi Lucene Guys,

I am interested what is your plan date for releasing Lucene 3.0.
I am asking because seeing on the changes in Lucene 2.9 (especially 
changes in backward compatibility) I guess that it will be difficult for 
us to adopt our app to Lucene 2.9. I see in your Jira there are not many 
issues planned for 3.0, but there are still some new deprecations 
removing. There also could come some bug fixes to 2.9. So if you plan to 
release 3.0 in some (3-4) months we prefer to adopt our app directly to 3.0.

Another question about your plans about changes in file structure. 
According to your backwards-compatibility policy Lucene 3.0 could be not 
able to read indexes created from Lucene 1.X. Will it be really so with 3.0?

Best Regards,
Ivan

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42857-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:05:53 2009
Return-Path: <java-user-return-42857-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 48951 invoked from network); 16 Oct 2009 10:05:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:05:53 -0000
Received: (qmail 53281 invoked by uid 500); 16 Oct 2009 10:05:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53199 invoked by uid 500); 16 Oct 2009 10:05:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53164 invoked by uid 99); 16 Oct 2009 10:05:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:05:49 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:05:38 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id BBF85D36006
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:05:18 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id q-ctGJZ6alp9 for <java-user@lucene.apache.org>;
	Fri, 16 Oct 2009 12:05:08 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id AC52ED36004
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:05:08 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AD84400.5050802@sirma.bg>
Subject: RE: is Lucene 3.0 coming soon?
Date: Fri, 16 Oct 2009 12:05:09 +0200
Message-ID: <A8C1B4E109E0443CB7DE8E4EF9359861@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcpOR3B3XDoetqEmQIaabpsnQJ/A9gAAHK+A
In-Reply-To: <4AD84400.5050802@sirma.bg>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

I would recommend to adopt your app to 2.9 and enable deprecation warnings.
As soon as all deprecation warning disappear during compile, you are able to
just go to 3.0 (just drop in jars when available). This is why we have 2.9.
2.9: it is just 3.0 with the deprecations not yet removed. No other changes
extensions to the API.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Ivan Vasilev [mailto:ivasilev@sirma.bg]
> Sent: Friday, October 16, 2009 11:59 AM
> To: LUCENE MAIL LIST
> Subject: is Lucene 3.0 coming soon?
> 
> Hi Lucene Guys,
> 
> I am interested what is your plan date for releasing Lucene 3.0.
> I am asking because seeing on the changes in Lucene 2.9 (especially
> changes in backward compatibility) I guess that it will be difficult for
> us to adopt our app to Lucene 2.9. I see in your Jira there are not many
> issues planned for 3.0, but there are still some new deprecations
> removing. There also could come some bug fixes to 2.9. So if you plan to
> release 3.0 in some (3-4) months we prefer to adopt our app directly to
> 3.0.
> 
> Another question about your plans about changes in file structure.
> According to your backwards-compatibility policy Lucene 3.0 could be not
> able to read indexes created from Lucene 1.X. Will it be really so with
> 3.0?
> 
> Best Regards,
> Ivan
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42858-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:09:45 2009
Return-Path: <java-user-return-42858-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 49713 invoked from network); 16 Oct 2009 10:09:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:09:45 -0000
Received: (qmail 57814 invoked by uid 500); 16 Oct 2009 10:09:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57725 invoked by uid 500); 16 Oct 2009 10:09:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57715 invoked by uid 99); 16 Oct 2009 10:09:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:09:43 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:09:41 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 910F5D36004
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:09:19 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Vp53KWfQoq9A for <java-user@lucene.apache.org>;
	Fri, 16 Oct 2009 12:09:09 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 7631045E779
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:09:09 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <web-126509778@mail3.rug.nl>
Subject: RE: which version
Date: Fri, 16 Oct 2009 12:09:10 +0200
Message-ID: <29AD83C690E945A395006001A8550193@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcpORIKjq4FELQwFT4KBvYYHT3q0YwABCEGw
In-Reply-To: <web-126509778@mail3.rug.nl>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

Are you sure, that there is no older lucene version somwhere in your
classpath? Such problems are mostly caused by this. 

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: R.A.Ittoo [mailto:R.A.Ittoo@rug.nl]
> Sent: Friday, October 16, 2009 11:38 AM
> To: java-user@lucene.apache.org
> Subject: which version
> 
> hi
> i am using lucene version 2.9
> When calling the StandardAnalyzer constructor with the
> VErsion.LUCENE_VERSION as parameter, I get the error
> "symbol not found constructor
> StandardAnalyzer(org.apache.lucene.util.Version)"
> 
> this is strange, as it is supposed to be correct according to the API
> doc and my jar file is called lucene-core-2.9.0.jar
> 
> However, the deprecated constructor new StandardAnalyzer() (without
> any parameters) worked fine.
> 
> I am confused now as to whether i am really using version 2.9
> can anybody please advise?
> 
> ashwin
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42859-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:18:08 2009
Return-Path: <java-user-return-42859-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53160 invoked from network); 16 Oct 2009 10:18:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:18:08 -0000
Received: (qmail 75398 invoked by uid 500); 16 Oct 2009 10:18:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75335 invoked by uid 500); 16 Oct 2009 10:18:06 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75325 invoked by uid 99); 16 Oct 2009 10:18:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:18:05 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.212.198 as permitted sender)
Received: from [209.85.212.198] (HELO mail-vw0-f198.google.com) (209.85.212.198)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:18:03 +0000
Received: by vws36 with SMTP id 36so1651964vws.29
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 03:17:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=+4yEQbBTuWBXd3n6mTa4UKYcPv51dcFSDBQo5pjIgHk=;
        b=IOn/vWsucEYohK1Gbv8/h/MB3rJ8Npm/odxZ5x90kB9lbJbTZ6ODVV+WPh+4iJ/o3Q
         CpCTSD3UoN01kVj3ICbWLENJtaeae3JylxttBxt1HQjb5+i3oL+56Fj3bSxWk9+u+XF6
         Ye6MzWKC384M/JW+INNoczvhYzgcFOHkfMLHY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=LuezYpaub/24aLsjW6/Jbtm7ff3WlSzXzi6F6DbNv00H38puD1Jtbl1BSKvT9RaMIJ
         OmxELZMNckLMW88z/wLd4o0VMx8HdN5M2H+90Qcxkx4/ONy3cbln1VqcLtd2hi6AfZE1
         4kDLZOKHelxjOo+bvlNbi2WoQEYnwCd0ZMjoE=
MIME-Version: 1.0
Received: by 10.220.113.71 with SMTP id z7mr2725465vcp.80.1255688262045; Fri, 
	16 Oct 2009 03:17:42 -0700 (PDT)
In-Reply-To: <29AD83C690E945A395006001A8550193@VEGA>
References: <web-126509778@mail3.rug.nl> <29AD83C690E945A395006001A8550193@VEGA>
From: Ian Lea <ian.lea@gmail.com>
Date: Fri, 16 Oct 2009 11:17:21 +0100
Message-ID: <8c4e68610910160317w572cc1f4w1b9fcd73b232a144@mail.gmail.com>
Subject: Re: which version
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

http://www.mail-archive.com/java-user@lucene.apache.org/msg27095.html
shows a way to check what version you actually are using.


--
Ian.


On Fri, Oct 16, 2009 at 11:09 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
> Are you sure, that there is no older lucene version somwhere in your
> classpath? Such problems are mostly caused by this.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>
>> -----Original Message-----
>> From: R.A.Ittoo [mailto:R.A.Ittoo@rug.nl]
>> Sent: Friday, October 16, 2009 11:38 AM
>> To: java-user@lucene.apache.org
>> Subject: which version
>>
>> hi
>> i am using lucene version 2.9
>> When calling the StandardAnalyzer constructor with the
>> VErsion.LUCENE_VERSION as parameter, I get the error
>> "symbol not found constructor
>> StandardAnalyzer(org.apache.lucene.util.Version)"
>>
>> this is strange, as it is supposed to be correct according to the API
>> doc and my jar file is called lucene-core-2.9.0.jar
>>
>> However, the deprecated constructor new StandardAnalyzer() (without
>> any parameters) worked fine.
>>
>> I am confused now as to whether i am really using version 2.9
>> can anybody please advise?
>>
>> ashwin
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42860-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:31:41 2009
Return-Path: <java-user-return-42860-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55559 invoked from network); 16 Oct 2009 10:31:41 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:31:41 -0000
Received: (qmail 90624 invoked by uid 500); 16 Oct 2009 10:31:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90549 invoked by uid 500); 16 Oct 2009 10:31:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90539 invoked by uid 99); 16 Oct 2009 10:31:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:31:39 +0000
X-ASF-Spam-Status: No, hits=-2.5 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [208.97.132.5] (HELO homiemail-a12.g.dreamhost.com) (208.97.132.5)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:31:37 +0000
Received: from [10.0.0.13] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a12.g.dreamhost.com (Postfix) with ESMTPA id C4365714060
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 03:31:16 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: is Lucene 3.0 coming soon?
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <A8C1B4E109E0443CB7DE8E4EF9359861@VEGA>
Date: Fri, 16 Oct 2009 06:31:15 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <2EDB8058-09B4-44A1-906C-55BE34A33B52@apache.org>
References: <4AD84400.5050802@sirma.bg> <A8C1B4E109E0443CB7DE8E4EF9359861@VEGA>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)


On Oct 16, 2009, at 6:05 AM, Uwe Schindler wrote:

> I would recommend to adopt your app to 2.9 and enable deprecation  
> warnings.
> As soon as all deprecation warning disappear during compile, you are  
> able to
> just go to 3.0 (just drop in jars when available). This is why we  
> have 2.9.
> 2.9: it is just 3.0 with the deprecations not yet removed. No other  
> changes
> extensions to the API.

That and we are moving to Java 1.5.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42861-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:32:53 2009
Return-Path: <java-user-return-42861-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55932 invoked from network); 16 Oct 2009 10:32:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:32:53 -0000
Received: (qmail 93246 invoked by uid 500); 16 Oct 2009 10:32:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93166 invoked by uid 500); 16 Oct 2009 10:32:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93155 invoked by uid 99); 16 Oct 2009 10:32:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:32:50 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.145] (HELO homiemail-a23.g.dreamhost.com) (208.97.132.145)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:32:40 +0000
Received: from [10.0.0.13] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a23.g.dreamhost.com (Postfix) with ESMTPA id 68E3D4B0060
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 03:32:19 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: OpenRelevance
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <869968.59650.qm@web52907.mail.re2.yahoo.com>
Date: Fri, 16 Oct 2009 06:32:18 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <5DD87AD4-41CD-427E-8467-F265AA3B13D2@apache.org>
References: <869968.59650.qm@web52907.mail.re2.yahoo.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

I definitely am, but am lacking in time at the moment.  A good place  
to ask is over on the ORP mailing lists, maybe that will help  
kickstart things over there.

-Grant

On Oct 15, 2009, at 3:32 PM, Omar Alonso wrote:

> Hi folks,
>
> I would like to know if people are interested in the OpenRelevance  
> project (http://wiki.apache.org/lucene-java/OpenRelevance).
>
> I've done quite a few experiments on Amazon Mechanical Turk using  
> TREC and INEX data sets, so one approach would be to use  
> crowdsourcing for such task.
>
> Regards,
>
> Omar
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42862-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:46:00 2009
Return-Path: <java-user-return-42862-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57548 invoked from network); 16 Oct 2009 10:46:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:46:00 -0000
Received: (qmail 874 invoked by uid 500); 16 Oct 2009 10:45:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 788 invoked by uid 500); 16 Oct 2009 10:45:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 773 invoked by uid 99); 16 Oct 2009 10:45:58 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:45:58 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=5.0
	tests=BAYES_00,MSGID_RANDY
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [129.125.60.3] (HELO smtp3.rug.nl) (129.125.60.3)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:45:55 +0000
Received: from mail3.rug.nl (f5selfip-4-60.service.rug.nl [129.125.60.248])
	by smtp3.rug.nl (8.14.2/8.14.2) with ESMTP id n9GAjWbB013936
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:45:32 +0200
Received: from [82.73.38.192] (account p253714@rug.nl)
  by mail3.rug.nl (CommuniGate Pro WEBUSER 5.1.16)
  with HTTP id 126517552 for java-user@lucene.apache.org; Fri, 16 Oct 2009 12:45:32 +0200
From: "R.A.Ittoo" <R.A.Ittoo@rug.nl>
Subject: Re: which version
To: java-user@lucene.apache.org
X-Mailer: CommuniGate Pro WebUser v5.1.16
Date: Fri, 16 Oct 2009 12:45:32 +0200
Message-ID: <web-126517552@mail3.rug.nl>
In-Reply-To: <29AD83C690E945A395006001A8550193@VEGA>
References: <web-126509778@mail3.rug.nl>
 <29AD83C690E945A395006001A8550193@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;charset=utf-8;format="flowed"
Content-Transfer-Encoding: 8bit
X-Virus-Scanned: clamav-milter 0.95.2 at smtp3
X-Virus-Status: Clean

thanks. I had an old lucene (bundled in another application called 
GATE).
I can now use the new 2.9 version.
ashwin

On Fri, 16 Oct 2009 12:09:10 +0200
  "Uwe Schindler" <uwe@thetaphi.de> wrote:
> Are you sure, that there is no older lucene version somwhere in your
> classpath? Such problems are mostly caused by this. 
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
> 
>> -----Original Message-----
>> From: R.A.Ittoo [mailto:R.A.Ittoo@rug.nl]
>> Sent: Friday, October 16, 2009 11:38 AM
>> To: java-user@lucene.apache.org
>> Subject: which version
>> 
>> hi
>> i am using lucene version 2.9
>> When calling the StandardAnalyzer constructor with the
>> VErsion.LUCENE_VERSION as parameter, I get the error
>> "symbol not found constructor
>> StandardAnalyzer(org.apache.lucene.util.Version)"
>> 
>> this is strange, as it is supposed to be correct according to the 
>>API
>> doc and my jar file is called lucene-core-2.9.0.jar
>> 
>> However, the deprecated constructor new StandardAnalyzer() (without
>> any parameters) worked fine.
>> 
>> I am confused now as to whether i am really using version 2.9
>> can anybody please advise?
>> 
>> ashwin
>> 
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>For additional commands, e-mail: java-user-help@lucene.apache.org
> 


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42863-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:47:01 2009
Return-Path: <java-user-return-42863-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57803 invoked from network); 16 Oct 2009 10:47:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:47:01 -0000
Received: (qmail 4754 invoked by uid 500); 16 Oct 2009 10:46:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4704 invoked by uid 500); 16 Oct 2009 10:46:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4665 invoked by uid 99); 16 Oct 2009 10:46:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:46:57 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:46:47 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id 028BB31623
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:46:25 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id D6A9D31113
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:46:24 +0200 (CEST)
Received: from bledsoe.dfki.uni-sb.de (bledsoe.dfki.uni-sb.de [134.96.184.151])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id C1D3B31098
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:46:24 +0200 (CEST)
Message-Id: <D963A7A4-1999-4FB1-8770-683192808A28@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <869968.59650.qm@web52907.mail.re2.yahoo.com>
Content-Type: multipart/signed; boundary=Apple-Mail-59-357394052; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: OpenRelevance
Date: Fri, 16 Oct 2009 12:46:24 +0200
References: <869968.59650.qm@web52907.mail.re2.yahoo.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-59-357394052
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable

Not something for the very soon future, but I'd be interested to base =20=

on such an infrastructure for a mathematical-formul=E6 search corpus =20
(both semantic and presentation math).

I believe the OpenRelevance infrastructure might present a best =20
practice or infrastructure to be based on for such.

paul


Le 15-oct.-09 =E0 21:32, Omar Alonso a =E9crit :
> I would like to know if people are interested in the OpenRelevance =20
> project (http://wiki.apache.org/lucene-java/OpenRelevance).
> I've done quite a few experiments on Amazon Mechanical Turk using =20
> TREC and INEX data sets, so one approach would be to use =20
> crowdsourcing for such task.


--Apple-Mail-59-357394052
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAxNjEwNDYyNFowIwYJKoZIhvcNAQkEMRYEFF+NHFAzMk4ZwxbhF8HQJYSSlJxAMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQAO
BXPNxc9wAlHaNIZY0Ve1MWBYPEDorHowDVnzw92xYfCylc5XJLIv/QtyEFn2d4DmuINrw+B3Qsqs
LwAgpHb++vtvgpIg06pJrf43tYXavlGdu57H+3zqTyv9R7N/8Gf4oxikxDs8Ltt4eKadxNbTKhvu
HLJoS/rR0uwQ6GeL9aw6AJ9TeNWEUwC/9QHpABVi1I8DpMmKx4ZZ1TGejmTzXvxVzZyGvBWUV+Tm
oirmiUD1eGJc63GjE4Ubg+5asX4cYX9hwnG2toQ34j20ciHbVo23n4tLAK2VgpxUezKXliZ/CInT
0NoRcTK59r1v4lemj+OrFYWQFG/fzkHuDwOAAAAAAAAA

--Apple-Mail-59-357394052--

From java-user-return-42864-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:51:26 2009
Return-Path: <java-user-return-42864-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58693 invoked from network); 16 Oct 2009 10:51:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:51:26 -0000
Received: (qmail 11336 invoked by uid 500); 16 Oct 2009 10:51:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11273 invoked by uid 500); 16 Oct 2009 10:51:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11263 invoked by uid 99); 16 Oct 2009 10:51:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:51:24 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [62.213.161.134] (HELO pmx.sirma.bg) (62.213.161.134)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:51:13 +0000
X-Virus-Scanned: Sirma Antivirus System
Received: from [192.168.128.140] (ivasilev.sirma.int [192.168.128.140])
	by pmx.sirma.bg (Sirma mail system) with ESMTP id 3327724001
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:50:53 +0300 (EEST)
Message-ID: <4AD8500D.4080906@sirma.bg>
Date: Fri, 16 Oct 2009 13:50:53 +0300
From: Ivan Vasilev <ivasilev@sirma.bg>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: is Lucene 3.0 coming soon?
References: <4AD84400.5050802@sirma.bg> <A8C1B4E109E0443CB7DE8E4EF9359861@VEGA> <2EDB8058-09B4-44A1-906C-55BE34A33B52@apache.org>
In-Reply-To: <2EDB8058-09B4-44A1-906C-55BE34A33B52@apache.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

OK, thanks guys!

Grant Ingersoll wrote:
>
> On Oct 16, 2009, at 6:05 AM, Uwe Schindler wrote:
>
>> I would recommend to adopt your app to 2.9 and enable deprecation 
>> warnings.
>> As soon as all deprecation warning disappear during compile, you are 
>> able to
>> just go to 3.0 (just drop in jars when available). This is why we 
>> have 2.9.
>> 2.9: it is just 3.0 with the deprecations not yet removed. No other 
>> changes
>> extensions to the API.
>
> That and we are moving to Java 1.5.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
> __________ NOD32 3990 (20090406) Information __________
>
> This message was checked by NOD32 antivirus system.
> http://www.eset.com
>
>
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42865-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 10:53:35 2009
Return-Path: <java-user-return-42865-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59952 invoked from network); 16 Oct 2009 10:53:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 10:53:35 -0000
Received: (qmail 14507 invoked by uid 500); 16 Oct 2009 10:53:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14423 invoked by uid 500); 16 Oct 2009 10:53:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14413 invoked by uid 99); 16 Oct 2009 10:53:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:53:33 +0000
X-ASF-Spam-Status: No, hits=-2.5 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [208.97.132.177] (HELO homiemail-a17.g.dreamhost.com) (208.97.132.177)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 10:53:30 +0000
Received: from [10.0.0.13] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a17.g.dreamhost.com (Postfix) with ESMTPA id 92C487A8063
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 03:53:09 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: NPE in NearSpansUnordered
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <e994873a0910151028n6a8f699fid450c4272c04b09c@mail.gmail.com>
Date: Fri, 16 Oct 2009 06:53:08 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <0B6370A3-6C21-49D3-80D7-047464CF3534@apache.org>
References: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com> <c68e39170910151021v28acb2ebx90ba213527856036@mail.gmail.com> <e994873a0910151028n6a8f699fid450c4272c04b09c@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)

And, you don't get this on 2.4.1?

Are you sure you've called next()?  Is it by chance on the first  
document it tries to score that it fails?

-Grant



On Oct 15, 2009, at 1:28 PM, Peter Keegan wrote:

> The query is:
> +payloadNear([spanNear([contents:insurance, contents:agent], 10000,  
> false),
> spanNear([contents:winston, contents:salem], 10000, false)], 10,  
> false)
> It's using the default payload function scorer (average value)
>
> It doesn't happen on all queries of this type, only a handful. This is
> production-like index of > 1million docs. I haven't been able to  
> reproduce
> with a simple index, unfortunately.
>
> Peter
>
> On Thu, Oct 15, 2009 at 1:21 PM, Yonik Seeley <yonik@lucidimagination.com 
> >wrote:
>
>> Are you using any custom query types?  Anything to help us reproduce
>> (like the acutal query this happened on) would be greatly  
>> appreciated.
>>
>> -Yonik
>> http://www.lucidimagination.com
>>
>>
>> On Thu, Oct 15, 2009 at 1:17 PM, Peter Keegan  
>> <peterlkeegan@gmail.com>
>> wrote:
>>> I'm using Lucene 2.9 and sometimes get a NPE in NearSpansUnordered:
>>>
>>> <java.lang.NullPointerException>java.lang.NullPointerException
>>> at
>>>
>> org.apache.lucene.search.spans.NearSpansUnordered.start 
>> (NearSpansUnordered.java:219)
>>> at
>>>
>> org.apache.lucene.search.payloads.PayloadNearQuery 
>> $PayloadNearSpanScorer.processPayloads(PayloadNearQuery.java:201)
>>> at
>>>
>> org.apache.lucene.search.payloads.PayloadNearQuery 
>> $PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:180)
>>> at
>>>
>> org.apache.lucene.search.payloads.PayloadNearQuery 
>> $PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:183)
>>> at
>>>
>> org.apache.lucene.search.payloads.PayloadNearQuery 
>> $PayloadNearSpanScorer.setFreqCurrentDoc(PayloadNearQuery.java:214)
>>> at org.apache.lucene.search.spans.SpanScorer.nextDoc 
>>> (SpanScorer.java:64)
>>> at org.apache.lucene.search.Scorer.score(Scorer.java:74)
>>> at org.apache.lucene.search.IndexSearcher.search 
>>> (IndexSearcher.java:247)
>>> at org.apache.lucene.search.Searcher.search(Searcher.java:152)
>>>
>>> The CellQueue pq is empty when this occurs. Are there any  
>>> conditions in
>>> which the queue might be expected to be empty?
>>>
>>> Peter
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42866-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 11:38:11 2009
Return-Path: <java-user-return-42866-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68555 invoked from network); 16 Oct 2009 11:38:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 11:38:11 -0000
Received: (qmail 46451 invoked by uid 500); 16 Oct 2009 11:38:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46392 invoked by uid 500); 16 Oct 2009 11:38:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46381 invoked by uid 99); 16 Oct 2009 11:38:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:38:08 +0000
X-ASF-Spam-Status: No, hits=-6.6 required=5.0
	tests=BAYES_00,RCVD_IN_DNSWL_MED,UNPARSEABLE_RELAY
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [85.158.139.19] (HELO mail178.messagelabs.com) (85.158.139.19)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:38:06 +0000
X-VirusChecked: Checked
X-Env-Sender: wzzelfzzel@abas.de
X-Msg-Ref: server-6.tower-178.messagelabs.com!1255693063!22444062!1
X-StarScan-Version: 6.1.3; banners=-,-,-
X-Originating-IP: [212.202.226.202]
Received: (qmail 3847 invoked from network); 16 Oct 2009 11:37:44 -0000
Received: from gate.abas.de (HELO gate.abas.de) (212.202.226.202)
  by server-6.tower-178.messagelabs.com with DHE-RSA-AES256-SHA encrypted SMTP; 16 Oct 2009 11:37:44 -0000
Received: from gate.abas.de (localhost [127.0.0.1])
	by gate.abas.de (8.14.3/8.14.3) with ESMTP id n9GBbh2a025130
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:37:43 +0200 (CEST)
Received: (from localhost) by gate.abas.de (MSCAN) id 3/gate.abas.de/smtp-gw/mscan; Fri Oct 16 13:37:43 2009
From: Stefan Trcek <wzzelfzzel@abas.de>
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
Date: Fri, 16 Oct 2009 13:37:39 +0200
User-Agent: KMail/1.9.10
References: <4AD81961.7090108@gmail.com>
In-Reply-To: <4AD81961.7090108@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain;
  charset="iso-8859-15"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Message-ID: <200910161337.39718.wzzelfzzel@abas.de>
X-ABAS-MAIL-MARK: added by mailmarker.abas.de

On Friday 16 October 2009 08:57:37 Michael Busch wrote:
>
> So please tell us which you prefer as a back compatibility policy for
> Lucene:

I don't do drop in but recompile anyway, so it doesn't matter for me.
It is only important that the documentation is clear about what has to 
be done.

> B) best effort drop-in back compatibility for the next minor version
> number only, and deprecations may be removed after one minor release
> (e.g. v3.3 will be compat with v3.2, but not v3.4)

Nevertheless I prefer B because the deprecation changes per release will 
be smaller and maybe even grouped by topic. I prefer advancing step by 
step. A bunch of deprecated API parts even hinders reading and 
understanding the API. So, the sooner they are gone, the better.

Regards, Stefan

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42867-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 11:39:13 2009
Return-Path: <java-user-return-42867-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68664 invoked from network); 16 Oct 2009 11:39:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 11:39:13 -0000
Received: (qmail 48281 invoked by uid 500); 16 Oct 2009 11:39:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48201 invoked by uid 500); 16 Oct 2009 11:39:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48191 invoked by uid 99); 16 Oct 2009 11:39:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:39:11 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 74.125.92.24 as permitted sender)
Received: from [74.125.92.24] (HELO qw-out-2122.google.com) (74.125.92.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:39:00 +0000
Received: by qw-out-2122.google.com with SMTP id 5so514088qwd.53
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 04:38:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=rDiBxPj4XdukN40qZVM739TxCVAHh9GP9e/voUiulyM=;
        b=g6YkpiasUrdbW0a/I6OzBGFwekObgLTqS9/ktSt9V9CjCTgvzQs0mBeG5HDGtiQYcy
         iQp7XaTR3fjOWLQn3jXwDAAovrXW0GeHzzzZy47+cIsRnlnc3s1XH56+xg87NOo8KQSd
         EUNjGzyG76vA299gSvdQXAU9ZYdMumo+PRQ6o=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=ocYslKBI+0+e5e6n2YQz/qIIyQ/IUsKTnDvmAMRN0QYPbgm8MjRY8wpVxZd+mZwpv3
         Hlohqs+ggjXxEnUkFoR8FeuhwVGdKBtsjmpAJC9roPQEeJsgDf5WAkZcKlrnjT/ILdk5
         ZHAfr8YMQ0lPZHFpTs9O1XxodasJv7cGrr9Tc=
Received: by 10.224.90.129 with SMTP id i1mr924622qam.201.1255693120170;
        Fri, 16 Oct 2009 04:38:40 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 26sm2111284qwa.13.2009.10.16.04.38.38
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 16 Oct 2009 04:38:39 -0700 (PDT)
Message-ID: <4AD85B3D.9020606@gmail.com>
Date: Fri, 16 Oct 2009 07:38:37 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com>	 <200910160939.40260.paul.elschot@xs4all.nl>	 <2ffb6d060910160123w7330c087r4e8b5d958782a87e@mail.gmail.com> <510143ac0910160154m27719ed8k6466372a87f6dfc9@mail.gmail.com>
In-Reply-To: <510143ac0910160154m27719ed8k6466372a87f6dfc9@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
X-Virus-Checked: Checked by ClamAV on apache.org

Jukka Zitting wrote:
> Hi,
>
> On Fri, Oct 16, 2009 at 10:23 AM, Danil ORIN <torindan@gmail.com> wrote:
>   
>> What about creating major version more often?
>>     
>
> +1 We're not going to run out of version numbers, so I don't see a
> reason not to upgrade the major version number when making
> backwards-incompatible changes.
>
> BR,
>
> Jukka Zitting
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   
For what its worth, I agree with you guys. Less confusion in upgrading :)

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42868-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 11:46:54 2009
Return-Path: <java-user-return-42868-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70154 invoked from network); 16 Oct 2009 11:46:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 11:46:54 -0000
Received: (qmail 58032 invoked by uid 500); 16 Oct 2009 11:46:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57994 invoked by uid 500); 16 Oct 2009 11:46:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57984 invoked by uid 99); 16 Oct 2009 11:46:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:46:52 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:46:49 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id B0F2FD36006
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:46:28 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id cAuW-56p4FIe for <java-user@lucene.apache.org>;
	Fri, 16 Oct 2009 13:46:26 +0200 (CEST)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 2F655D36004
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:46:26 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AD81961.7090108@gmail.com> <200910161337.39718.wzzelfzzel@abas.de>
Subject: RE: Proposal for changing Lucene's backwards-compatibility policy
Date: Fri, 16 Oct 2009 13:46:27 +0200
Message-ID: <6F724BF853BC4A0A8D9FC6B2504CE0AD@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <200910161337.39718.wzzelfzzel@abas.de>
Thread-Index: AcpOVStaOSdvjoLTS9m/KQrGDfXExwAANHFg
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

> > So please tell us which you prefer as a back compatibility policy for
> > Lucene:
> 
> I don't do drop in but recompile anyway, so it doesn't matter for me.
> It is only important that the documentation is clear about what has to
> be done.
> 
> > B) best effort drop-in back compatibility for the next minor version
> > number only, and deprecations may be removed after one minor release
> > (e.g. v3.3 will be compat with v3.2, but not v3.4)
> 
> Nevertheless I prefer B because the deprecation changes per release will
> be smaller and maybe even grouped by topic. I prefer advancing step by
> step. A bunch of deprecated API parts even hinders reading and
> understanding the API. So, the sooner they are gone, the better.

+1 Even for me as a core developer, it's always a pain to find out: Is it
TopDocsCollector, TopFieldDocCollector and other, which are the right one.
The names of these classes in 2.9 and the mix between deprecated and not
deprecated is a hell!

In my opinion, we should more often release major releases. And this always
using a short-time x.9 -> (x+1).0. So new API in .9 and then 2 month later
release the major release.

Uwe


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42869-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 11:49:31 2009
Return-Path: <java-user-return-42869-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70578 invoked from network); 16 Oct 2009 11:49:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 11:49:31 -0000
Received: (qmail 61698 invoked by uid 500); 16 Oct 2009 11:49:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61621 invoked by uid 500); 16 Oct 2009 11:49:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61611 invoked by uid 99); 16 Oct 2009 11:49:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:49:29 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erdincyilmazel@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 11:49:19 +0000
Received: by fxm12 with SMTP id 12so2442977fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 04:48:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=m/88TKzejzGxRyLvDXTgiTT4lX+6X/qJ9ODbEVBYG58=;
        b=v5mlj9SLt29vKglmU19k21eGejbVegO2CL4JdfCPqCGEkH5vaXRqb7NzrLjghLBw5+
         t0EpUxL88bcoZj0vMCk3md9Do0vvQp0hzY1/Y0RTViC0PmKPQSf+UldR24RcQ9EtORhZ
         x3dTy9q3XzeoZ7gD6K7a6DWZ0YaMOj8ygW+8w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=xYA8oELNWue/YDrTe+ZcTnmpU5w5J3m9A9Oh9pKBCGCm3irdCyA8w8J8LXaJfTGdrG
         1uWPJfFhHQ3aFLJ1gPMzlv1GKpvFRLP7INZOaOG/DlLbH2ba6R9AbNf8elOObwgrotFj
         sR8Cv91Jo70tRuTdxOG17hww2CK1YCudig1QU=
MIME-Version: 1.0
Received: by 10.223.14.83 with SMTP id f19mr210316faa.92.1255693739579; Fri, 
	16 Oct 2009 04:48:59 -0700 (PDT)
In-Reply-To: <4AD85B3D.9020606@gmail.com>
References: <4AD81961.7090108@gmail.com>
	 <200910160939.40260.paul.elschot@xs4all.nl>
	 <2ffb6d060910160123w7330c087r4e8b5d958782a87e@mail.gmail.com>
	 <510143ac0910160154m27719ed8k6466372a87f6dfc9@mail.gmail.com>
	 <4AD85B3D.9020606@gmail.com>
Date: Fri, 16 Oct 2009 12:48:59 +0100
Message-ID: <7af3bac90910160448w279ea521s36edfba2f4abcd23@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
From: Erdinc Yilmazel <erdincyilmazel@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151747befc4b59d404760bfb4b
X-Virus-Checked: Checked by ClamAV on apache.org

--00151747befc4b59d404760bfb4b
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I'd go with B. I never do drop-in replacement of a jar even if it is a mino=
r
release for any library. I always recompile. I think the major version
number shouldn't be changed unless there are lots of API changes or changes
in the index format.


On Fri, Oct 16, 2009 at 12:38 PM, Mark Miller <markrmiller@gmail.com> wrote=
:

> Jukka Zitting wrote:
> > Hi,
> >
> > On Fri, Oct 16, 2009 at 10:23 AM, Danil =C5=A2ORIN <torindan@gmail.com>
> wrote:
> >
> >> What about creating major version more often?
> >>
> >
> > +1 We're not going to run out of version numbers, so I don't see a
> > reason not to upgrade the major version number when making
> > backwards-incompatible changes.
> >
> > BR,
> >
> > Jukka Zitting
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> For what its worth, I agree with you guys. Less confusion in upgrading :)
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00151747befc4b59d404760bfb4b--

From java-user-return-42870-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 12:06:39 2009
Return-Path: <java-user-return-42870-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73174 invoked from network); 16 Oct 2009 12:06:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 12:06:39 -0000
Received: (qmail 76801 invoked by uid 500); 16 Oct 2009 12:06:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76730 invoked by uid 500); 16 Oct 2009 12:06:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76720 invoked by uid 99); 16 Oct 2009 12:06:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 12:06:37 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 12:06:33 +0000
Received: by pwi12 with SMTP id 12so289978pwi.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 05:06:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=fk+JSB4f7jcXHdoIL5XxLebb5qsqBgPQsUHFkaMJ0Q4=;
        b=UYyf+ddUZ3b8M3vro7+XI7HN3Ag58HsqH1DzNvSKJHRwNhLXg6AxmSoJwqmGrvxxKg
         7aF4inl8US07rfdRpldqxTHHcT+F2z3RLsdP1ZRPqmw/MrsDAM9koKoeffy9a4hOZFd9
         I7+8I/GnkxdF3YxDFv8CtmY6TP5RR74pwh9eE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=DtSl9ulN1bFZ6xfRt39jyx4h3dJtPvwmg4xrGZkKLHlOdGLdhQ4d2CIanIstYrtALx
         0Wo353ZW70nGozv4hO2iDeuvoxKPAVXundHzB/uhqlY4lU1rOXbNxev1kTiWXAwwD+Ll
         ezyFg2ZohWSpWo6RRpO4eP9ullkzTerCHJYQ4=
MIME-Version: 1.0
Received: by 10.141.22.10 with SMTP id z10mr62032rvi.243.1255694773684; Fri, 
	16 Oct 2009 05:06:13 -0700 (PDT)
In-Reply-To: <0B6370A3-6C21-49D3-80D7-047464CF3534@apache.org>
References: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com>
	 <c68e39170910151021v28acb2ebx90ba213527856036@mail.gmail.com>
	 <e994873a0910151028n6a8f699fid450c4272c04b09c@mail.gmail.com>
	 <0B6370A3-6C21-49D3-80D7-047464CF3534@apache.org>
Date: Fri, 16 Oct 2009 08:06:13 -0400
Message-ID: <e994873a0910160506h6de275fncbaa34078344d362@mail.gmail.com>
Subject: Re: NPE in NearSpansUnordered
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd50a04ee8a3204760c38a4

--000e0cd50a04ee8a3204760c38a4
Content-Type: text/plain; charset=ISO-8859-1

next() is called in PayloadNearQuery->setFreqCurrentDoc:
super.setFreqCurrentDoc();
But, I think it should be called before 'getPayloads'. That doesn't fix the
NPE, though.
The empty PQ occurs in the outermost span in the query, and seems to fail on
the last document it scores.
Prior to 2.9, I'd been using a patch on 2.3.2. and never saw the NPE.

Peter

On Fri, Oct 16, 2009 at 6:53 AM, Grant Ingersoll <gsingers@apache.org>wrote:

> And, you don't get this on 2.4.1?
>
> Are you sure you've called next()?  Is it by chance on the first document
> it tries to score that it fails?
>
> -Grant
>
>
>
>
> On Oct 15, 2009, at 1:28 PM, Peter Keegan wrote:
>
>  The query is:
>> +payloadNear([spanNear([contents:insurance, contents:agent], 10000,
>> false),
>> spanNear([contents:winston, contents:salem], 10000, false)], 10, false)
>> It's using the default payload function scorer (average value)
>>
>> It doesn't happen on all queries of this type, only a handful. This is
>> production-like index of > 1million docs. I haven't been able to reproduce
>> with a simple index, unfortunately.
>>
>> Peter
>>
>> On Thu, Oct 15, 2009 at 1:21 PM, Yonik Seeley <yonik@lucidimagination.com
>> >wrote:
>>
>>  Are you using any custom query types?  Anything to help us reproduce
>>> (like the acutal query this happened on) would be greatly appreciated.
>>>
>>> -Yonik
>>> http://www.lucidimagination.com
>>>
>>>
>>> On Thu, Oct 15, 2009 at 1:17 PM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>>
>>>> I'm using Lucene 2.9 and sometimes get a NPE in NearSpansUnordered:
>>>>
>>>> <java.lang.NullPointerException>java.lang.NullPointerException
>>>> at
>>>>
>>>> org.apache.lucene.search.spans.NearSpansUnordered.start(NearSpansUnordered.java:219)
>>>
>>>> at
>>>>
>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.processPayloads(PayloadNearQuery.java:201)
>>>
>>>> at
>>>>
>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:180)
>>>
>>>> at
>>>>
>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:183)
>>>
>>>> at
>>>>
>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.setFreqCurrentDoc(PayloadNearQuery.java:214)
>>>
>>>> at org.apache.lucene.search.spans.SpanScorer.nextDoc(SpanScorer.java:64)
>>>> at org.apache.lucene.search.Scorer.score(Scorer.java:74)
>>>> at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:247)
>>>> at org.apache.lucene.search.Searcher.search(Searcher.java:152)
>>>>
>>>> The CellQueue pq is empty when this occurs. Are there any conditions in
>>>> which the queue might be expected to be empty?
>>>>
>>>> Peter
>>>>
>>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
> Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd50a04ee8a3204760c38a4--

From java-user-return-42871-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 12:36:26 2009
Return-Path: <java-user-return-42871-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81138 invoked from network); 16 Oct 2009 12:36:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 12:36:26 -0000
Received: (qmail 5218 invoked by uid 500); 16 Oct 2009 12:36:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5173 invoked by uid 500); 16 Oct 2009 12:36:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5163 invoked by uid 99); 16 Oct 2009 12:36:24 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 12:36:24 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 12:36:14 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1Mym2D-0004rr-W5
	for java-user@lucene.apache.org; Fri, 16 Oct 2009 05:35:53 -0700
Message-ID: <25924689.post@talk.nabble.com>
Date: Fri, 16 Oct 2009 05:35:53 -0700 (PDT)
From: stefcl <stefatwork@gmail.com>
To: java-user@lucene.apache.org
Subject: Difference between 2.4.1 and 2.9.0 (possible regression?)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: stefatwork@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hello,

We are re currently migrating from 2.4.1 to 2.9.0. We've noticed some
changes in the results of fuzzy queries.
We have made this small test case :

********
StandardAnalyzer analyzer = new StandardAnalyzer();

Directory index = new RAMDirectory();
IndexWriter w = new IndexWriter(index, analyzer, true,
IndexWriter.MaxFieldLength.UNLIMITED);

addDoc(w, "Lucene in Action");
addDoc(w, "Lucene for Dummies");

addDoc(w, "Giga byte");

addDoc(w, "ManagingGigabytesManagingGigabyte");
addDoc(w, "ManagingGigabytesManagingGigabytes");

addDoc(w, "The Art of Computer Science");
addDoc(w, "J. K. Rowling");
addDoc(w, "JK Rowling");
addDoc(w, "Joanne K Roling");
addDoc(w, "Bruce Willis");
addDoc(w, "Willis bruce");
addDoc(w, "Brute willis");
addDoc(w, "B. willis");
w.close();
***************

Here's the problem :
We would expect the query 
Query q = new QueryParser("title", analyzer).parse( "giga~0.9" );

to match at least "Giga byte".

With lucene version 2.4.1 it returns :
1. Giga byte with score : 1.7948763

With 2.9, there's no matches, we have to go something as low as 0.7
("giga~0.7") to get some matches.

Could this be a regression?


http://www.nabble.com/file/p25924689/FirstShot.java Simple test case (1 file
here) 



 
-- 
View this message in context: http://www.nabble.com/Difference-between-2.4.1-and-2.9.0-%28possible-regression-%29-tp25924689p25924689.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42872-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 15:00:08 2009
Return-Path: <java-user-return-42872-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24171 invoked from network); 16 Oct 2009 15:00:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 15:00:08 -0000
Received: (qmail 67946 invoked by uid 500); 16 Oct 2009 15:00:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67889 invoked by uid 500); 16 Oct 2009 15:00:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67872 invoked by uid 99); 16 Oct 2009 15:00:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 15:00:05 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 14:59:56 +0000
Received: by ewy26 with SMTP id 26so2092932ewy.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 07:59:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=pk7jNle7mNXc4yLPqQvSqpkFQld828bNfGq5LejqKDo=;
        b=qveCHI9pedH5SGMF2IZSRVpuus4Wd1fJGwiJW3AAC264R/iu3sDiQ4bzwV8gOirJO6
         ++Fuaae1OcmB/Trf9+hOblHUxwmDW2rqM9gsqO6S63s725hqc2gzlTQUuPi7IEr8RyiB
         yOveidrztXaFnbG4duPjExX9SD53dwULrpMes=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=UUjk1E8KjwS0yAmiPRpAJ9EUNk7e55acvKVcGNB8oXw5Ad9RawCrjqT0LHZF7pt3Mf
         IRG48+L/Wqtja0dqGU3RPysGELWORcbC9HfDJB7O9w3R4oyEI6Uqk9Xh4rzRljifIPYw
         2uERMB+CgNJQnzTZmd7P0r/+4tOp2MC3lI4zw=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.85.147 with SMTP id u19mr616396wee.88.1255705175847; Fri, 
	16 Oct 2009 07:59:35 -0700 (PDT)
In-Reply-To: <510143ac0910160154m27719ed8k6466372a87f6dfc9@mail.gmail.com>
References: <4AD81961.7090108@gmail.com>
	 <200910160939.40260.paul.elschot@xs4all.nl>
	 <2ffb6d060910160123w7330c087r4e8b5d958782a87e@mail.gmail.com>
	 <510143ac0910160154m27719ed8k6466372a87f6dfc9@mail.gmail.com>
Date: Fri, 16 Oct 2009 10:59:35 -0400
X-Google-Sender-Auth: ddb614d5fe3f96a1
Message-ID: <c68e39170910160759j55f75937r1d18c715897bad62@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Fri, Oct 16, 2009 at 4:54 AM, Jukka Zitting <jukka.zitting@gmail.com> wr=
ote:
> Hi,
>
> On Fri, Oct 16, 2009 at 10:23 AM, Danil =C5=A2ORIN <torindan@gmail.com> w=
rote:
>> What about creating major version more often?
>
> +1 We're not going to run out of version numbers, so I don't see a
> reason not to upgrade the major version number when making
> backwards-incompatible changes.

+1
(Option A).

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42873-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 16:03:13 2009
Return-Path: <java-user-return-42873-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61399 invoked from network); 16 Oct 2009 16:03:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 16:03:13 -0000
Received: (qmail 85648 invoked by uid 500); 16 Oct 2009 16:03:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85581 invoked by uid 500); 16 Oct 2009 16:03:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85571 invoked by uid 99); 16 Oct 2009 16:03:10 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:03:10 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:03:00 +0000
Received: by gxk19 with SMTP id 19so2195730gxk.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 09:02:39 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.174.6 with SMTP id w6mr2980054ybe.329.1255708959269; Fri, 
	16 Oct 2009 09:02:39 -0700 (PDT)
In-Reply-To: <25924689.post@talk.nabble.com>
References: <25924689.post@talk.nabble.com>
Date: Fri, 16 Oct 2009 12:02:39 -0400
Message-ID: <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com>
Subject: Re: Difference between 2.4.1 and 2.9.0 (possible regression?)
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

This looks to have been caused by:

    http://issues.apache.org/jira/browse/LUCENE-1124

Which short circuits all matching if the term is too short relative to
the min similarity.  But I guess something must be wrong w/ the
formula.

I'll reopen that issue & mark fix for 2.9.1.

Mike

On Fri, Oct 16, 2009 at 8:35 AM, stefcl <stefatwork@gmail.com> wrote:
>
> Hello,
>
> We are re currently migrating from 2.4.1 to 2.9.0. We've noticed some
> changes in the results of fuzzy queries.
> We have made this small test case :
>
> ********
> StandardAnalyzer analyzer = new StandardAnalyzer();
>
> Directory index = new RAMDirectory();
> IndexWriter w = new IndexWriter(index, analyzer, true,
> IndexWriter.MaxFieldLength.UNLIMITED);
>
> addDoc(w, "Lucene in Action");
> addDoc(w, "Lucene for Dummies");
>
> addDoc(w, "Giga byte");
>
> addDoc(w, "ManagingGigabytesManagingGigabyte");
> addDoc(w, "ManagingGigabytesManagingGigabytes");
>
> addDoc(w, "The Art of Computer Science");
> addDoc(w, "J. K. Rowling");
> addDoc(w, "JK Rowling");
> addDoc(w, "Joanne K Roling");
> addDoc(w, "Bruce Willis");
> addDoc(w, "Willis bruce");
> addDoc(w, "Brute willis");
> addDoc(w, "B. willis");
> w.close();
> ***************
>
> Here's the problem :
> We would expect the query
> Query q = new QueryParser("title", analyzer).parse( "giga~0.9" );
>
> to match at least "Giga byte".
>
> With lucene version 2.4.1 it returns :
> 1. Giga byte with score : 1.7948763
>
> With 2.9, there's no matches, we have to go something as low as 0.7
> ("giga~0.7") to get some matches.
>
> Could this be a regression?
>
>
> http://www.nabble.com/file/p25924689/FirstShot.java Simple test case (1 file
> here)
>
>
>
>
> --
> View this message in context: http://www.nabble.com/Difference-between-2.4.1-and-2.9.0-%28possible-regression-%29-tp25924689p25924689.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42874-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 16:09:42 2009
Return-Path: <java-user-return-42874-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64634 invoked from network); 16 Oct 2009 16:09:42 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 16:09:42 -0000
Received: (qmail 97070 invoked by uid 500); 16 Oct 2009 16:09:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97025 invoked by uid 500); 16 Oct 2009 16:09:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97015 invoked by uid 99); 16 Oct 2009 16:09:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:09:39 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:09:29 +0000
Received: by pxi3 with SMTP id 3so2651199pxi.29
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 09:09:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=1sM/f594TfMtOwxJm8Lz2liJJNPCV41YXXGAoVKZWTw=;
        b=vhW5etySM5J2LBKH+kBJAM0bIurf+hP1ajTL/AEEgAWzBze8p5ogMBApi1cNvCj/u/
         cUD2GqhX+EkYDUv9L0jUYGNlP8Ky+shCnrn72kUY+JoEJ2DHMPF4suO7MbNH9IWx2qMO
         ipMk+J+AmO/q4nTbdYqm51RbMAEF3b3Lzn448=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=A7wA5MYIowtZAZyM54avYIzPIM1L4fha3/5kns5dx302VAaV1njNB6Xvo9A0vb/zkE
         kNoAKzkYZ2KDxF/uKc3fp0FO8JpO0lMKm2vo63sfqYtwtGS9HskCLyJNON5njyT0MAo0
         U9esdVdGQew1l7aDkMG4GZlCL666FfTOUaXC0=
MIME-Version: 1.0
Received: by 10.140.202.16 with SMTP id z16mr71337rvf.233.1255709347871; Fri, 
	16 Oct 2009 09:09:07 -0700 (PDT)
In-Reply-To: <e994873a0910160506h6de275fncbaa34078344d362@mail.gmail.com>
References: <e994873a0910151017p17065a3vce0abf574f0a65bd@mail.gmail.com>
	 <c68e39170910151021v28acb2ebx90ba213527856036@mail.gmail.com>
	 <e994873a0910151028n6a8f699fid450c4272c04b09c@mail.gmail.com>
	 <0B6370A3-6C21-49D3-80D7-047464CF3534@apache.org>
	 <e994873a0910160506h6de275fncbaa34078344d362@mail.gmail.com>
Date: Fri, 16 Oct 2009 12:09:07 -0400
Message-ID: <e994873a0910160909j54e0d30dj4c998183bc51758e@mail.gmail.com>
Subject: Re: NPE in NearSpansUnordered
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd29db49efc5204760f9d30
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd29db49efc5204760f9d30
Content-Type: text/plain; charset=ISO-8859-1

I can reproduce this with a unit test - will post to JIRA shortly.
Peter

On Fri, Oct 16, 2009 at 8:06 AM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> next() is called in PayloadNearQuery->setFreqCurrentDoc:
> super.setFreqCurrentDoc();
> But, I think it should be called before 'getPayloads'. That doesn't fix the
> NPE, though.
> The empty PQ occurs in the outermost span in the query, and seems to fail
> on the last document it scores.
> Prior to 2.9, I'd been using a patch on 2.3.2. and never saw the NPE.
>
> Peter
>
>
> On Fri, Oct 16, 2009 at 6:53 AM, Grant Ingersoll <gsingers@apache.org>wrote:
>
>> And, you don't get this on 2.4.1?
>>
>> Are you sure you've called next()?  Is it by chance on the first document
>> it tries to score that it fails?
>>
>> -Grant
>>
>>
>>
>>
>> On Oct 15, 2009, at 1:28 PM, Peter Keegan wrote:
>>
>>  The query is:
>>> +payloadNear([spanNear([contents:insurance, contents:agent], 10000,
>>> false),
>>> spanNear([contents:winston, contents:salem], 10000, false)], 10, false)
>>> It's using the default payload function scorer (average value)
>>>
>>> It doesn't happen on all queries of this type, only a handful. This is
>>> production-like index of > 1million docs. I haven't been able to
>>> reproduce
>>> with a simple index, unfortunately.
>>>
>>> Peter
>>>
>>> On Thu, Oct 15, 2009 at 1:21 PM, Yonik Seeley <
>>> yonik@lucidimagination.com>wrote:
>>>
>>>  Are you using any custom query types?  Anything to help us reproduce
>>>> (like the acutal query this happened on) would be greatly appreciated.
>>>>
>>>> -Yonik
>>>> http://www.lucidimagination.com
>>>>
>>>>
>>>> On Thu, Oct 15, 2009 at 1:17 PM, Peter Keegan <peterlkeegan@gmail.com>
>>>> wrote:
>>>>
>>>>> I'm using Lucene 2.9 and sometimes get a NPE in NearSpansUnordered:
>>>>>
>>>>> <java.lang.NullPointerException>java.lang.NullPointerException
>>>>> at
>>>>>
>>>>> org.apache.lucene.search.spans.NearSpansUnordered.start(NearSpansUnordered.java:219)
>>>>
>>>>> at
>>>>>
>>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.processPayloads(PayloadNearQuery.java:201)
>>>>
>>>>> at
>>>>>
>>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:180)
>>>>
>>>>> at
>>>>>
>>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.getPayloads(PayloadNearQuery.java:183)
>>>>
>>>>> at
>>>>>
>>>>> org.apache.lucene.search.payloads.PayloadNearQuery$PayloadNearSpanScorer.setFreqCurrentDoc(PayloadNearQuery.java:214)
>>>>
>>>>> at
>>>>> org.apache.lucene.search.spans.SpanScorer.nextDoc(SpanScorer.java:64)
>>>>> at org.apache.lucene.search.Scorer.score(Scorer.java:74)
>>>>> at
>>>>> org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:247)
>>>>> at org.apache.lucene.search.Searcher.search(Searcher.java:152)
>>>>>
>>>>> The CellQueue pq is empty when this occurs. Are there any conditions in
>>>>> which the queue might be expected to be empty?
>>>>>
>>>>> Peter
>>>>>
>>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>>
>> --------------------------
>> Grant Ingersoll
>> http://www.lucidimagination.com/
>>
>> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
>> Solr/Lucene:
>> http://www.lucidimagination.com/search
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--000e0cd29db49efc5204760f9d30--

From java-user-return-42875-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 16:44:42 2009
Return-Path: <java-user-return-42875-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78987 invoked from network); 16 Oct 2009 16:44:42 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 16:44:42 -0000
Received: (qmail 51832 invoked by uid 500); 16 Oct 2009 16:44:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51770 invoked by uid 500); 16 Oct 2009 16:44:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51760 invoked by uid 99); 16 Oct 2009 16:44:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:44:40 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [206.190.49.20] (HELO web52910.mail.re2.yahoo.com) (206.190.49.20)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 16 Oct 2009 16:44:37 +0000
Received: (qmail 97127 invoked by uid 60001); 16 Oct 2009 16:44:15 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1255711455; bh=sx5wwPXWktNO1nXtt2F2C2oMYt3bFVWznMcy7Kn26zI=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding; b=eZvRInIzib+3Wcoald+AkiPHKia67YYj10RuiCUthBEd9Ts9ISy4Avr/5R0muzyI0TaoMIz9fGS2fVCOJG2I30QkgrkCpi4HctoO441sobbdBhmrWJ5KwPQmHf5YmgWA159goB6W+n4yIaZ7dOCjS3gWtwi/UalQr/cahcSGxPM=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=x5/6Pi2puvd/YIJUWK3gsZyeDqtvqvPA0dWnAG4iJy9vYxUZ7MdLSoCXx3zbSpjqKv6MwCPmq5xSmdmOhDAHgumt4qPCkAXuHaq/D+rNNQQMGMFMp1hZZDD1SWPfqrOR4vNko1T9RlbpnsYRg6iVBwtauXJJyRYK6NQFgGLKTd0=;
Message-ID: <786734.96908.qm@web52910.mail.re2.yahoo.com>
X-YMail-OSG: DB.jywkVM1lbwkVbDLAF1.hXIAJguTv4giTlCTGioGXXxPkVaNwja9NUte609Ohn9aT8hZ6fFZIhF6e0hgn2XXC78Md30hiLVUu6PtWtCi8IU2h9C_1Sc.NHCiewOK7rDMPrPk5pOqn_oUMJoglBTJLi9OfdoB.Ak2207U1rDFLzzIIToMNKq76shHtjdSI4CYHzsyY5V1wyDWAnx1eAPk.T4VAS0fExPF4T0N3P9niOGDEyjd3sIUR.9il1bZZsbeaiT4l0RooehOZ_aqDdx99jN1XWsU7e6w4ZU4AyNdjruDWZrhjgcjzJcG_wfRHoHXRCxEPyDgMZDdjjZRziLzLDV3zLUp8rnkzmYr.3q6b98fRKUdSoYY307Yan3fj1uhmnevwvwtyuF2pc3N4DRyj0Ictxy50bMJPE_Oih
Received: from [66.245.60.165] by web52910.mail.re2.yahoo.com via HTTP; Fri, 16 Oct 2009 09:44:15 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Fri, 16 Oct 2009 09:44:15 -0700 (PDT)
From: Omar Alonso <oralonso@yahoo.com>
Subject: Re: OpenRelevance
To: java-user@lucene.apache.org
In-Reply-To: <5DD87AD4-41CD-427E-8467-F265AA3B13D2@apache.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

What's ORP?=0A=0A--- On Fri, 10/16/09, Grant Ingersoll <gsingers@apache.org=
> wrote:=0A=0A> From: Grant Ingersoll <gsingers@apache.org>=0A> Subject: Re=
: OpenRelevance=0A> To: java-user@lucene.apache.org=0A> Date: Friday, Octob=
er 16, 2009, 3:32 AM=0A> I definitely am, but am lacking in=0A> time at the=
 moment.=A0 A good place to ask is over on the=0A> ORP mailing lists, maybe=
 that will help kickstart things=0A> over there.=0A> =0A> -Grant=0A> =0A> O=
n Oct 15, 2009, at 3:32 PM, Omar Alonso wrote:=0A> =0A> > Hi folks,=0A> > =
=0A> > I would like to know if people are interested in the=0A> OpenRelevan=
ce project (http://wiki.apache.org/lucene-java/OpenRelevance).=0A> > =0A> >=
 I've done quite a few experiments on Amazon Mechanical=0A> Turk using TREC=
 and INEX data sets, so one approach would be=0A> to use crowdsourcing for =
such task.=0A> > =0A> > Regards,=0A> > =0A> > Omar=0A> > =0A> > =0A> > =0A>=
 > =0A> >=0A> -------------------------------------------------------------=
--------=0A> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.=
org=0A> > For additional commands, e-mail: java-user-help@lucene.apache.org=
=0A> > =0A> =0A> --------------------------=0A> Grant Ingersoll=0A> http://=
www.lucidimagination.com/=0A> =0A> Search the Lucene ecosystem=0A> (Lucene/=
Solr/Nutch/Mahout/Tika/Droids) using Solr/Lucene:=0A> http://www.lucidimagi=
nation.com/search=0A> =0A> =0A> -------------------------------------------=
--------------------------=0A> To unsubscribe, e-mail: java-user-unsubscrib=
e@lucene.apache.org=0A> For additional commands, e-mail: java-user-help@luc=
ene.apache.org=0A> =0A> =0A=0A=0A      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42876-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 16:50:11 2009
Return-Path: <java-user-return-42876-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 80812 invoked from network); 16 Oct 2009 16:50:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 16:50:11 -0000
Received: (qmail 63975 invoked by uid 500); 16 Oct 2009 16:50:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63886 invoked by uid 500); 16 Oct 2009 16:50:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63876 invoked by uid 99); 16 Oct 2009 16:50:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:50:09 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:50:00 +0000
Received: by fxm12 with SMTP id 12so2783169fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 09:49:40 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.25.27 with SMTP id x27mr328021fab.7.1255711780013; Fri, 16 
	Oct 2009 09:49:40 -0700 (PDT)
Date: Fri, 16 Oct 2009 12:49:39 -0400
Message-ID: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
Subject: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=0015174757429688150476102e2a
X-Virus-Checked: Checked by ClamAV on apache.org

--0015174757429688150476102e2a
Content-Type: text/plain; charset=ISO-8859-1

Hello,

I am trying to track down the cause of my code hanging on calling
IndexWriter.optimize() at its doWait() method.
It appears, thus that it is watiing on other merges to happen which is a bit
confusing to me:

My application is a simple producer consumer model where documents are added
to a queue by producers and then one consumer with one indexwriter (the only
in the application) periodically calls addDocument() on a batch of these
jobs and then calls optimize(), commit(). and then close().  There is only
one thread running the consumer so I am confused as to how the indexwriter
might be deadlocking itself.  Indeed this is the only thread active when the
deadlock occurs so it seems to be a problem of reentry.

Importantly, the deadlocking occurs only when the thread is trying to
shutdown - that is the Thread running this lucene consumer has a Future that
has had its cancel(true) interrupting method called.  Is it possible that an
internal Lucene lock is obtained during addDocument() and on interruption is
never released so the subsequent optimize() call hangs?  This doesn't appear
to be happening...

Any help appreciated.

thanks,

C>T>

what might I be missing here?

-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--0015174757429688150476102e2a--

From java-user-return-42877-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 16:52:33 2009
Return-Path: <java-user-return-42877-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81273 invoked from network); 16 Oct 2009 16:52:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 16:52:33 -0000
Received: (qmail 69246 invoked by uid 500); 16 Oct 2009 16:52:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69179 invoked by uid 500); 16 Oct 2009 16:52:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69169 invoked by uid 99); 16 Oct 2009 16:52:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:52:30 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:52:27 +0000
Received: by yxe30 with SMTP id 30so2871024yxe.29
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 09:52:05 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.174.6 with SMTP id w6mr3073158ybe.329.1255711925692; Fri, 
	16 Oct 2009 09:52:05 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com>
References: <25924689.post@talk.nabble.com>
	 <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com>
Date: Fri, 16 Oct 2009 12:52:05 -0400
Message-ID: <9ac0c6aa0910160952w4880119bp2dce4dd76cf90a6c@mail.gmail.com>
Subject: Re: Difference between 2.4.1 and 2.9.0 (possible regression?)
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

OK I've committed the fix on the 2.9.x branch, so it'll be included in
the 2.9.1 release.

Thanks for raising this!

Mike

On Fri, Oct 16, 2009 at 12:02 PM, Michael McCandless
<lucene@mikemccandless.com> wrote:
> This looks to have been caused by:
>
> =A0 =A0http://issues.apache.org/jira/browse/LUCENE-1124
>
> Which short circuits all matching if the term is too short relative to
> the min similarity. =A0But I guess something must be wrong w/ the
> formula.
>
> I'll reopen that issue & mark fix for 2.9.1.
>
> Mike
>
> On Fri, Oct 16, 2009 at 8:35 AM, stefcl <stefatwork@gmail.com> wrote:
>>
>> Hello,
>>
>> We are re currently migrating from 2.4.1 to 2.9.0. We've noticed some
>> changes in the results of fuzzy queries.
>> We have made this small test case :
>>
>> ********
>> StandardAnalyzer analyzer =3D new StandardAnalyzer();
>>
>> Directory index =3D new RAMDirectory();
>> IndexWriter w =3D new IndexWriter(index, analyzer, true,
>> IndexWriter.MaxFieldLength.UNLIMITED);
>>
>> addDoc(w, "Lucene in Action");
>> addDoc(w, "Lucene for Dummies");
>>
>> addDoc(w, "Giga byte");
>>
>> addDoc(w, "ManagingGigabytesManagingGigabyte");
>> addDoc(w, "ManagingGigabytesManagingGigabytes");
>>
>> addDoc(w, "The Art of Computer Science");
>> addDoc(w, "J. K. Rowling");
>> addDoc(w, "JK Rowling");
>> addDoc(w, "Joanne K Roling");
>> addDoc(w, "Bruce Willis");
>> addDoc(w, "Willis bruce");
>> addDoc(w, "Brute willis");
>> addDoc(w, "B. willis");
>> w.close();
>> ***************
>>
>> Here's the problem :
>> We would expect the query
>> Query q =3D new QueryParser("title", analyzer).parse( "giga~0.9" );
>>
>> to match at least "Giga byte".
>>
>> With lucene version 2.4.1 it returns :
>> 1. Giga byte with score : 1.7948763
>>
>> With 2.9, there's no matches, we have to go something as low as 0.7
>> ("giga~0.7") to get some matches.
>>
>> Could this be a regression?
>>
>>
>> http://www.nabble.com/file/p25924689/FirstShot.java Simple test case (1 =
file
>> here)
>>
>>
>>
>>
>> --
>> View this message in context: http://www.nabble.com/Difference-between-2=
.4.1-and-2.9.0-%28possible-regression-%29-tp25924689p25924689.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42878-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 16:59:13 2009
Return-Path: <java-user-return-42878-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83385 invoked from network); 16 Oct 2009 16:59:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 16:59:13 -0000
Received: (qmail 83872 invoked by uid 500); 16 Oct 2009 16:59:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83834 invoked by uid 500); 16 Oct 2009 16:59:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83814 invoked by uid 99); 16 Oct 2009 16:59:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:59:10 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 16:59:08 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id DA15CD36006
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 18:58:46 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id VphJhC-zI9WP for <java-user@lucene.apache.org>;
	Fri, 16 Oct 2009 18:58:37 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id D7B55D36004
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 18:58:36 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
Subject: RE: IndexWriter optimize() deadlock
Date: Fri, 16 Oct 2009 18:58:37 +0200
Message-ID: <016F3AEABE394A13A95BCF749F7445BC@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
Thread-Index: AcpOgL5cGsNXOKI6R/OpFcPewEQk3QAAQf1A
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

Do you use the IndexWriter as mutex in a synchronized() block? This is not
supported and may hang. Never lock on IndexWriter instances. IndexWriter
itself is thread safe.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Christopher Tignor [mailto:ctignor@thinkmap.com]
> Sent: Friday, October 16, 2009 6:50 PM
> To: java-user
> Subject: IndexWriter optimize() deadlock
> 
> Hello,
> 
> I am trying to track down the cause of my code hanging on calling
> IndexWriter.optimize() at its doWait() method.
> It appears, thus that it is watiing on other merges to happen which is a
> bit
> confusing to me:
> 
> My application is a simple producer consumer model where documents are
> added
> to a queue by producers and then one consumer with one indexwriter (the
> only
> in the application) periodically calls addDocument() on a batch of these
> jobs and then calls optimize(), commit(). and then close().  There is only
> one thread running the consumer so I am confused as to how the indexwriter
> might be deadlocking itself.  Indeed this is the only thread active when
> the
> deadlock occurs so it seems to be a problem of reentry.
> 
> Importantly, the deadlocking occurs only when the thread is trying to
> shutdown - that is the Thread running this lucene consumer has a Future
> that
> has had its cancel(true) interrupting method called.  Is it possible that
> an
> internal Lucene lock is obtained during addDocument() and on interruption
> is
> never released so the subsequent optimize() call hangs?  This doesn't
> appear
> to be happening...
> 
> Any help appreciated.
> 
> thanks,
> 
> C>T>
> 
> what might I be missing here?
> 
> --
> TH!NKMAP
> 
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42879-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:27:58 2009
Return-Path: <java-user-return-42879-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94066 invoked from network); 16 Oct 2009 17:27:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:27:57 -0000
Received: (qmail 31661 invoked by uid 500); 16 Oct 2009 17:27:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31584 invoked by uid 500); 16 Oct 2009 17:27:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31574 invoked by uid 99); 16 Oct 2009 17:27:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:27:55 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:27:52 +0000
Received: from suex07-hub-02.ad.syr.edu (suex07-hub-02.ad.syr.edu [128.230.108.196])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id n9GHRVLE031999
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:27:31 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-02.ad.syr.edu ([fe80::813b:49a2:a4d5:6367%10]) with mapi; Fri, 16
 Oct 2009 13:27:31 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 16 Oct 2009 13:27:27 -0400
Subject: RE: Proposal for changing Lucene's backwards-compatibility policy
Thread-Topic: Proposal for changing Lucene's backwards-compatibility policy
Thread-Index: AcpOLhD8sFIvymttS9y6gI72Hlo/pAAVxESA
Message-ID: <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
References: <4AD81961.7090108@gmail.com>
In-Reply-To: <4AD81961.7090108@gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2009-10-16_11:2009-09-29,2009-10-16,2009-10-16 signatures=0
X-Proofpoint-Spam-Reason: safe

On 10/16/2009 at 2:58 AM, Michael Busch wrote:
> B) best effort drop-in back compatibility for the next minor version
> number only, and deprecations may be removed after one minor release
> (e.g. v3.3 will be compat with v3.2, but not v3.4)

This is only true on a per-feature basis.  For example, if feature A is dep=
recated in v3.1, and feature B is deprecated in v3.2, then v3.3 will be "co=
mpat" with v3.2 only as far as feature B is concerned; feature A will no lo=
nger be present in v3.3.

Under these circumstances, saying "v3.3 will be compat with v3.2" with no c=
aveats sounds to me like false advertising.

Steve


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42880-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:32:36 2009
Return-Path: <java-user-return-42880-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96188 invoked from network); 16 Oct 2009 17:32:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:32:36 -0000
Received: (qmail 41586 invoked by uid 500); 16 Oct 2009 17:32:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41522 invoked by uid 500); 16 Oct 2009 17:32:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41505 invoked by uid 99); 16 Oct 2009 17:32:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:32:33 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of markrmiller@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:32:30 +0000
Received: by fxm12 with SMTP id 12so2830503fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:32:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=vXyEkkt86yPz+Wvjf1sybYIMABff4Ec/NF+nUsUgu2I=;
        b=SCG3ryZyYGt08OzA0oSXs/oo2AJGIC3QWf3Y6LmmBrBd15dQ5KSmXWut+2PneBbCnq
         nuLLekk3b7ogCnGWSm/n9jZibSsMNPHK7M0/ODS90ffl6r+bAug0zGBJ76nd3Gl4P7G0
         Pq9xNyZPTmQSOPzpSI/EIMnqCdyX8snuww7w8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=vrvFxYo8pm/v/lZucPBGBahrkTTTaV7+QLc+aUZqMyK9b59Y8Hqpiwil1ubVonalRi
         GVqdmRK2byY1tMH35ad/rnTGxFJ0C1hwVM6haUXYNp2629+Mjr+pnZZEeZv4CtqwZHiA
         PjyNaM15Jwdh5B/qEzTzCl6ZdT3cWbPICO0EM=
Received: by 10.204.156.3 with SMTP id u3mr1483289bkw.179.1255714329403;
        Fri, 16 Oct 2009 10:32:09 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 14sm228070bwz.5.2009.10.16.10.32.07
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 16 Oct 2009 10:32:07 -0700 (PDT)
Message-ID: <4AD8AE16.7040105@gmail.com>
Date: Fri, 16 Oct 2009 13:32:06 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

Steven A Rowe wrote:
> On 10/16/2009 at 2:58 AM, Michael Busch wrote:
>   
>> B) best effort drop-in back compatibility for the next minor version
>> number only, and deprecations may be removed after one minor release
>> (e.g. v3.3 will be compat with v3.2, but not v3.4)
>>     
>
> This is only true on a per-feature basis.  For example, if feature A is deprecated in v3.1, and feature B is deprecated in v3.2, then v3.3 will be "compat" with v3.2 only as far as feature B is concerned; feature A will no longer be present in v3.3.
>
> Under these circumstances, saying "v3.3 will be compat with v3.2" with no caveats sounds to me like false advertising.
>
> Steve
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>   
Right - confusing. And even if we peg deprecation removal to only given
point releases to address this, its still confusing as to which.
Solution? Major numbers :) If deprecations need to be removed faster,
instead of 4 or 5 releases within a major number, 2 or 3 could be done.

Its also a real pain for someone to skip a few releases and then upgrade
- right now you just hit the 2.9 release and get all the dep warnings to
help you go to 3.0. With this, if your late to the party, you will lose
all the dep warnings - you will have to update to every other release to
catch up.

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42881-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:34:06 2009
Return-Path: <java-user-return-42881-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97368 invoked from network); 16 Oct 2009 17:34:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:34:06 -0000
Received: (qmail 46959 invoked by uid 500); 16 Oct 2009 17:34:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46899 invoked by uid 500); 16 Oct 2009 17:34:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46889 invoked by uid 99); 16 Oct 2009 17:34:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:34:03 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:34:01 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MyqgO-0006dR-64
	for java-user@lucene.apache.org; Fri, 16 Oct 2009 10:33:40 -0700
Message-ID: <25929358.post@talk.nabble.com>
Date: Fri, 16 Oct 2009 10:33:40 -0700 (PDT)
From: stefcl <stefatwork@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Difference between 2.4.1 and 2.9.0 (possible regression?)
In-Reply-To: <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: stefatwork@gmail.com
References: <25924689.post@talk.nabble.com> <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com>


Thanks,
Even if you add to the example a document called "giga", I'm not sure that
searching  "giga~0.8" would return anything. 

It seems a bit weird because an exact search (which I guess should be more
or less equivalent to a fuzzy search with nearly ~1 similarity) would
actually return some results.

I guess it was part of an attempt to prevent unsignificant terms from having
unreasonable impact to the score, but can we still call that factor "minimum
similarity" then?

I really suspect there's something broken here, or perhaps I just fail to
understand the logic. The way it worked in 2.4.1 seemed much more
interesting, now even a 100% exact match isn't enough for the query to
succeed, in my opinion this should have been implemented as a completely
different query type.

I have no intention in making any offense here, I'm just trying to
understand...
Kind regards


Michael McCandless-2 wrote:
> 
> This looks to have been caused by:
> 
>     http://issues.apache.org/jira/browse/LUCENE-1124
> 
> Which short circuits all matching if the term is too short relative to
> the min similarity.  But I guess something must be wrong w/ the
> formula.
> 
> I'll reopen that issue & mark fix for 2.9.1.
> 
> 

-- 
View this message in context: http://www.nabble.com/Difference-between-2.4.1-and-2.9.0-%28possible-regression-%29-tp25924689p25929358.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42882-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:36:31 2009
Return-Path: <java-user-return-42882-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97999 invoked from network); 16 Oct 2009 17:36:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:36:31 -0000
Received: (qmail 50061 invoked by uid 500); 16 Oct 2009 17:36:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50000 invoked by uid 500); 16 Oct 2009 17:36:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49989 invoked by uid 99); 16 Oct 2009 17:36:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:36:29 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:36:19 +0000
Received: by fxm12 with SMTP id 12so2834743fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:35:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=adcD4bVXLUOSdd9QxQQd6Ve/Tp5E52hecrXRNwCozuw=;
        b=KPAbrQxNcLCkEJpyTvSXJnJZM04CEUCFwJYtBiFT+DEX7r7shQ/SP+WBiCQ/Cf65Lw
         4BeiXIOuWF2qKj9+L0BCL3am4qqJjZ2Cpdumg3O9yH1nE7SgfnTopjPKk54LwUgDEBPg
         kZIy0Hm74XeScIXm4+iGflU39DzRZB7ihH05k=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=bzNoCjRN/bkX9/G1XcWQwK/PI2Kzjbz94XEfPQ/iiSc/zMY3FF28nMWv4eJSo+gM9t
         hN09TfgUieaBCg1YgJ0ED6kJWoW+D1+UrXnjvHR2aJT+7l5/QGAoKiJHQJTP7lk/DyTi
         0o0aRw+56USMu2mAUhvNuaIJYOLVVeOCHlZ/U=
Received: by 10.204.174.209 with SMTP id u17mr1600978bkz.7.1255714558682;
        Fri, 16 Oct 2009 10:35:58 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 16sm227581bwz.11.2009.10.16.10.35.57
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 16 Oct 2009 10:35:58 -0700 (PDT)
Message-ID: <4AD8AEFC.4050809@gmail.com>
Date: Fri, 16 Oct 2009 13:35:56 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Difference between 2.4.1 and 2.9.0 (possible regression?)
References: <25924689.post@talk.nabble.com> <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com> <25929358.post@talk.nabble.com>
In-Reply-To: <25929358.post@talk.nabble.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

It was a bug and Mike fixed it. The bug was that exact matches where not
being returned as you state. Will be fixed in 2.9.1.

stefcl wrote:
> Thanks,
> Even if you add to the example a document called "giga", I'm not sure that
> searching  "giga~0.8" would return anything. 
>
> It seems a bit weird because an exact search (which I guess should be more
> or less equivalent to a fuzzy search with nearly ~1 similarity) would
> actually return some results.
>
> I guess it was part of an attempt to prevent unsignificant terms from having
> unreasonable impact to the score, but can we still call that factor "minimum
> similarity" then?
>
> I really suspect there's something broken here, or perhaps I just fail to
> understand the logic. The way it worked in 2.4.1 seemed much more
> interesting, now even a 100% exact match isn't enough for the query to
> succeed, in my opinion this should have been implemented as a completely
> different query type.
>
> I have no intention in making any offense here, I'm just trying to
> understand...
> Kind regards
>
>
> Michael McCandless-2 wrote:
>   
>> This looks to have been caused by:
>>
>>     http://issues.apache.org/jira/browse/LUCENE-1124
>>
>> Which short circuits all matching if the term is too short relative to
>> the min similarity.  But I guess something must be wrong w/ the
>> formula.
>>
>> I'll reopen that issue & mark fix for 2.9.1.
>>
>>
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42883-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:39:34 2009
Return-Path: <java-user-return-42883-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 99025 invoked from network); 16 Oct 2009 17:39:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:39:33 -0000
Received: (qmail 63657 invoked by uid 500); 16 Oct 2009 17:39:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63594 invoked by uid 500); 16 Oct 2009 17:39:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63581 invoked by uid 99); 16 Oct 2009 17:39:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:39:31 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:39:28 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1Myqlg-00077H-Dm
	for java-user@lucene.apache.org; Fri, 16 Oct 2009 10:39:08 -0700
Message-ID: <25929456.post@talk.nabble.com>
Date: Fri, 16 Oct 2009 10:39:08 -0700 (PDT)
From: stefcl <stefatwork@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Difference between 2.4.1 and 2.9.0 (possible regression?)
In-Reply-To: <25929358.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: stefatwork@gmail.com
References: <25924689.post@talk.nabble.com> <9ac0c6aa0910160902v42022771mbe7583dda221a998@mail.gmail.com> <25929358.post@talk.nabble.com>



Apologies, my previous message crossed yours.
Good to hear that it's not intended behavior, I was worried.

thanks for the fix!  
Kind regards


stefcl wrote:
> 
> Thanks,
> Even if you add to the example a document called "giga", I'm not sure that
> searching  "giga~0.8" would return anything. 
> 
> It seems a bit weird because an exact search (which I guess should be more
> or less equivalent to a fuzzy search with nearly ~1 similarity) would
> actually return some results.
> 
> I guess it was part of an attempt to prevent unsignificant terms from
> having unreasonable impact to the score, but can we still call that factor
> "minimum similarity" then?
> 
> I really suspect there's something broken here, or perhaps I just fail to
> understand the logic. The way it worked in 2.4.1 seemed much more
> interesting, now even a 100% exact match isn't enough for the query to
> succeed, in my opinion this should have been implemented as a completely
> different query type.
> 
> I have no intention in making any offense here, I'm just trying to
> understand...
> Kind regards
> 
> 
> Michael McCandless-2 wrote:
>> 
>> This looks to have been caused by:
>> 
>>     http://issues.apache.org/jira/browse/LUCENE-1124
>> 
>> Which short circuits all matching if the term is too short relative to
>> the min similarity.  But I guess something must be wrong w/ the
>> formula.
>> 
>> I'll reopen that issue & mark fix for 2.9.1.
>> 
>> 
> 
> 

-- 
View this message in context: http://www.nabble.com/Difference-between-2.4.1-and-2.9.0-%28possible-regression-%29-tp25924689p25929456.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42884-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:43:55 2009
Return-Path: <java-user-return-42884-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 271 invoked from network); 16 Oct 2009 17:43:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:43:54 -0000
Received: (qmail 74992 invoked by uid 500); 16 Oct 2009 17:43:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74921 invoked by uid 500); 16 Oct 2009 17:43:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74911 invoked by uid 99); 16 Oct 2009 17:43:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:43:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:43:42 +0000
Received: by fxm12 with SMTP id 12so2843050fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:43:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.19.200 with SMTP id c8mr309654fab.55.1255715001986; Fri, 
	16 Oct 2009 10:43:21 -0700 (PDT)
In-Reply-To: <016F3AEABE394A13A95BCF749F7445BC@VEGA>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
Date: Fri, 16 Oct 2009 13:43:21 -0400
Message-ID: <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151747bfe2a1ef02047610eec3
X-Virus-Checked: Checked by ClamAV on apache.org

--00151747bfe2a1ef02047610eec3
Content-Type: text/plain; charset=ISO-8859-1

thanks for getting back.

I do not lock on the IndexWriter object itself but all methods in my
consumer class that use IndexWriter are synchronized (locking my singleton
consumer object itself).
The thread is waiting at IndexWriter.doWait().  What might cuase this?

thanks -

C>T>

On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de> wrote:

> Do you use the IndexWriter as mutex in a synchronized() block? This is not
> supported and may hang. Never lock on IndexWriter instances. IndexWriter
> itself is thread safe.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
> > -----Original Message-----
> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
> > Sent: Friday, October 16, 2009 6:50 PM
> > To: java-user
> > Subject: IndexWriter optimize() deadlock
> >
> > Hello,
> >
> > I am trying to track down the cause of my code hanging on calling
> > IndexWriter.optimize() at its doWait() method.
> > It appears, thus that it is watiing on other merges to happen which is a
> > bit
> > confusing to me:
> >
> > My application is a simple producer consumer model where documents are
> > added
> > to a queue by producers and then one consumer with one indexwriter (the
> > only
> > in the application) periodically calls addDocument() on a batch of these
> > jobs and then calls optimize(), commit(). and then close().  There is
> only
> > one thread running the consumer so I am confused as to how the
> indexwriter
> > might be deadlocking itself.  Indeed this is the only thread active when
> > the
> > deadlock occurs so it seems to be a problem of reentry.
> >
> > Importantly, the deadlocking occurs only when the thread is trying to
> > shutdown - that is the Thread running this lucene consumer has a Future
> > that
> > has had its cancel(true) interrupting method called.  Is it possible that
> > an
> > internal Lucene lock is obtained during addDocument() and on interruption
> > is
> > never released so the subsequent optimize() call hangs?  This doesn't
> > appear
> > to be happening...
> >
> > Any help appreciated.
> >
> > thanks,
> >
> > C>T>
> >
> > what might I be missing here?
> >
> > --
> > TH!NKMAP
> >
> > Christopher Tignor | Senior Software Architect
> > 155 Spring Street NY, NY 10012
> > p.212-285-8600 x385 f.212-285-8999
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--00151747bfe2a1ef02047610eec3--

From java-user-return-42885-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 17:59:16 2009
Return-Path: <java-user-return-42885-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7028 invoked from network); 16 Oct 2009 17:59:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 17:59:16 -0000
Received: (qmail 7604 invoked by uid 500); 16 Oct 2009 17:59:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7540 invoked by uid 500); 16 Oct 2009 17:59:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7530 invoked by uid 99); 16 Oct 2009 17:59:13 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:59:13 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 17:59:03 +0000
Received: by gxk19 with SMTP id 19so2295665gxk.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 10:58:42 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.88.8 with SMTP id l8mr3310796ybb.38.1255715922064; Fri, 16 
	Oct 2009 10:58:42 -0700 (PDT)
In-Reply-To: <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
Date: Fri, 16 Oct 2009 13:58:42 -0400
Message-ID: <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

My guess is it's the invocation of Thread.interrupt (which
Future.cancel(true) calls if the task is running) that lead to the
deadlock.

Is it possible to get the stack trace of the thrown exception when the
thread was interrupted?  Maybe indeed something in IW isn't cleaning
up its state on being interrupted.

Mike

On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
<ctignor@thinkmap.com> wrote:
> thanks for getting back.
>
> I do not lock on the IndexWriter object itself but all methods in my
> consumer class that use IndexWriter are synchronized (locking my singleto=
n
> consumer object itself).
> The thread is waiting at IndexWriter.doWait(). =A0What might cuase this?
>
> thanks -
>
> C>T>
>
> On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
>
>> Do you use the IndexWriter as mutex in a synchronized() block? This is n=
ot
>> supported and may hang. Never lock on IndexWriter instances. IndexWriter
>> itself is thread safe.
>>
>> -----
>> Uwe Schindler
>> H.-H.-Meier-Allee 63, D-28213 Bremen
>> http://www.thetaphi.de
>> eMail: uwe@thetaphi.de
>>
>> > -----Original Message-----
>> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
>> > Sent: Friday, October 16, 2009 6:50 PM
>> > To: java-user
>> > Subject: IndexWriter optimize() deadlock
>> >
>> > Hello,
>> >
>> > I am trying to track down the cause of my code hanging on calling
>> > IndexWriter.optimize() at its doWait() method.
>> > It appears, thus that it is watiing on other merges to happen which is=
 a
>> > bit
>> > confusing to me:
>> >
>> > My application is a simple producer consumer model where documents are
>> > added
>> > to a queue by producers and then one consumer with one indexwriter (th=
e
>> > only
>> > in the application) periodically calls addDocument() on a batch of the=
se
>> > jobs and then calls optimize(), commit(). and then close(). =A0There i=
s
>> only
>> > one thread running the consumer so I am confused as to how the
>> indexwriter
>> > might be deadlocking itself. =A0Indeed this is the only thread active =
when
>> > the
>> > deadlock occurs so it seems to be a problem of reentry.
>> >
>> > Importantly, the deadlocking occurs only when the thread is trying to
>> > shutdown - that is the Thread running this lucene consumer has a Futur=
e
>> > that
>> > has had its cancel(true) interrupting method called. =A0Is it possible=
 that
>> > an
>> > internal Lucene lock is obtained during addDocument() and on interrupt=
ion
>> > is
>> > never released so the subsequent optimize() call hangs? =A0This doesn'=
t
>> > appear
>> > to be happening...
>> >
>> > Any help appreciated.
>> >
>> > thanks,
>> >
>> > C>T>
>> >
>> > what might I be missing here?
>> >
>> > --
>> > TH!NKMAP
>> >
>> > Christopher Tignor | Senior Software Architect
>> > 155 Spring Street NY, NY 10012
>> > p.212-285-8600 x385 f.212-285-8999
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42886-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 18:43:54 2009
Return-Path: <java-user-return-42886-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32268 invoked from network); 16 Oct 2009 18:43:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 18:43:54 -0000
Received: (qmail 91701 invoked by uid 500); 16 Oct 2009 18:43:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91612 invoked by uid 500); 16 Oct 2009 18:43:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91591 invoked by uid 99); 16 Oct 2009 18:43:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 18:43:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of buschmic@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 18:43:42 +0000
Received: by fxm12 with SMTP id 12so2908915fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 11:43:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=LgjW5ACGKDuL3dmE9C3f2vlFEm2H5c83Uvp3WsjZpK4=;
        b=Hp4IC1wDK0L0y7TcSSe9N0SvlHpLG7dzCSI8HPZVFfim9z2jBLg2ecGgbRGoz2CFi/
         S7Hj7FNuFgcfmoZDzN1rCGBSQDuRHjkfB9wAdV0gCA5jRgxWETfzL17iMa8b+U3S0yHc
         J0pXT4F0gCTukTePjBREn9KIDZ5wrRXAnXKWI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=Z/3OGTyGlqLz58OD081xMahfimbUKYebYTMcIbET8rs6PJKAGl1/57X+1k00FC5PVj
         p3c2RmmHucRkszu/6nFFXjbD6rghoHyfI9MaI6Hbon0T1c7wVqLXvZZmon4E5vt0DGBC
         jPzRjMa0uwsF0B9ceJS2Da0ZmPMe6m+WJ2vUA=
Received: by 10.103.127.34 with SMTP id e34mr782469mun.108.1255718601784;
        Fri, 16 Oct 2009 11:43:21 -0700 (PDT)
Received: from michael-buschs-macbook-pro-2.local (c-98-248-34-169.hsd1.ca.comcast.net [98.248.34.169])
        by mx.google.com with ESMTPS id 4sm2212738fge.7.2009.10.16.11.43.19
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Fri, 16 Oct 2009 11:43:20 -0700 (PDT)
Message-ID: <4AD8BEC4.50905@gmail.com>
Date: Fri, 16 Oct 2009 11:43:16 -0700
From: Michael Busch <buschmic@gmail.com>
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090915 Thunderbird/3.0b4
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

On 10/16/09 10:27 AM, Steven A Rowe wrote:
> On 10/16/2009 at 2:58 AM, Michael Busch wrote:
>    
>> B) best effort drop-in back compatibility for the next minor version
>> number only, and deprecations may be removed after one minor release
>> (e.g. v3.3 will be compat with v3.2, but not v3.4)
>>      
> This is only true on a per-feature basis.  For example, if feature A is deprecated in v3.1, and feature B is deprecated in v3.2, then v3.3 will be "compat" with v3.2 only as far as feature B is concerned; feature A will no longer be present in v3.3.
>
> Under these circumstances, saying "v3.3 will be compat with v3.2" with no caveats sounds to me like false advertising.
>
> Steve
>
>    

That is true. Further above in my mail I said "simple jar drop-in 
replacement will not be possible anymore with almost every Lucene 
release"and I should have made it clearer in the sentence you pointed 
out too: with option B you can only be sure that you can switch to a new 
version (e.g. v3.3) without the need to recompile if your app compiled 
against the previous version (v3.2) without deprecation warnings.

Let me point out that in any case, no matter if we pick A or B, the 
committers will try what they can to make upgrading as easy as possible. 
If you look back in Lucene's history I think we always did that, 
especially with index file format (I don't think we ever required 
reindexing to upgrade). Now in terms of API backwards-compatibility even 
with option B it doesn't mean we'll go crazy with deprecations and 
removals. We don't *have* to remove an API in 3.3 only because it was 
deprecated in 3.2.

Let me give you another example: the current TokenStream API changes 
were very big, and the TokenStream API is very central and often 
extended by users. Now with the current backwards-compatibility policy 
we decided to remove the old API entirely in 3.0. If we had policy B in 
place already, we'd be able wait until 3.1 and give users more 
transition time. But we certainly don't want to wait until 4.0 - it may 
be surprising for many how much (complicated) code is currently in 
Lucene to support compatibility for this and other features.

Even if we try to make major releases more often, how often do people 
realistically expect this will happen? Lucene 2.0 was released in May 
2006. The 2.9 release that is now available still supports every single 
public and protected API from the last 3 1/2 years. We're saying for 
about 2 years now that we should make releases more often in general. 
The committers always vote +1 if someone says "let's release more 
often". But if didn't happen so far. We could now analyze the reasons 
and how we could change that. But frankly I think partially it's just 
the nature of things: there are many different people, with different 
schedules, working on different features of different sizes and Lucene 
has different components. Getting all this aligned isn't so easy. Why 
will just saying once again "Hey, let's just release more often" work 
now if it hasn't in the last two years?

  Michael

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42887-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 18:50:25 2009
Return-Path: <java-user-return-42887-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 39560 invoked from network); 16 Oct 2009 18:50:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 18:50:25 -0000
Received: (qmail 5338 invoked by uid 500); 16 Oct 2009 18:50:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 5298 invoked by uid 500); 16 Oct 2009 18:50:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 5288 invoked by uid 99); 16 Oct 2009 18:50:22 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 18:50:22 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 18:50:12 +0000
Received: by fxm12 with SMTP id 12so2915902fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 11:49:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=7fYw4u+gz6soNDeE+dF0LfDqS0PnCwGRrpYq3r00rA0=;
        b=WUmuAEGVlfkpZ52CXq/YzYyESUH7vwBb4cCfcKWTBIGeTC1N/hP/dXfR2y9do+QbZE
         kspD7BZpzlxqbK5lOvIs8tfKaGX+W0TmQ4Sdevu7bt9afEZ5fLDJ/ZmNOttwBYe2Zum0
         ah3DRWgWWl6yKIwJEMvNPGMSG9kwpn7/BFXys=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=ZiXvDxu+/zM1rFlvrBqB8brLKJfUwz4xcrvSKcPlBosMPqD43xEySGaw79F42HKbxF
         JSCEJeKcB6OKwRkpZMBK11X/kTg+s2xwgsRgtTfvQ4DileKRbAJuTdZNw/sfTdM833Q3
         9SO+Efs17QQYDH090C0J6WUZLPQGtnHEwHkIc=
Received: by 10.204.160.73 with SMTP id m9mr1570907bkx.214.1255718991905;
        Fri, 16 Oct 2009 11:49:51 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 15sm248866bwz.0.2009.10.16.11.49.50
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 16 Oct 2009 11:49:50 -0700 (PDT)
Message-ID: <4AD8C04E.2020101@gmail.com>
Date: Fri, 16 Oct 2009 14:49:50 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu> <4AD8BEC4.50905@gmail.com>
In-Reply-To: <4AD8BEC4.50905@gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Michael Busch wrote:
>  Why will just saying once again "Hey, let's just release more often"
> work now if it hasn't in the last two years?
>
>  Mich

I don't know that we need to release more often to take advantage of
major numbers. 2.2 was released in 07 - we could have just released 2.9
right after 2.2 rather than also releasing 2.3 and 2.4. The number of
releases between major releases is self imposed.

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42888-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 18:54:06 2009
Return-Path: <java-user-return-42888-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40498 invoked from network); 16 Oct 2009 18:54:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 18:54:06 -0000
Received: (qmail 12480 invoked by uid 500); 16 Oct 2009 18:54:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12394 invoked by uid 500); 16 Oct 2009 18:54:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12383 invoked by uid 99); 16 Oct 2009 18:54:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 18:54:03 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of markrmiller@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 18:54:00 +0000
Received: by fxm12 with SMTP id 12so2919761fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 11:53:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=hQ55q90917czp/3slqpN5jQatWALygzpEEZJnD7LbZg=;
        b=FRic8GNGS9cGiMB8PL63PQF0A/h4JN7F7Q05IvQ5AoA3itAMdIrTPCAzBO1wIYhoWD
         2sFEtU0zWj8MKxrCmDd6U9qq0nUCiJcx48YWKdTLxcfMIqmrJiGFjwv4o2jBUA08CHcw
         +/3tP45rvT5rFgU7qWDm5o7GltKijzmvPSMWE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=SdV78vB0IeL9MKoRcg0Xx3Em338EMSa8eSlRVo7VIJr8DPOvy27tK69k+5kfay8fBo
         bLGrvHknS+gTOv6Q+wPdfNl/SrvC1xmtB8dQN2Lei8gkBaX/eCcyFIWVK5GHUQL+ukEU
         Qv+8WM4L7O0GnKs1vfQfvQLNOEYe8/A8L49Yk=
Received: by 10.204.21.4 with SMTP id h4mr1638734bkb.58.1255719219072;
        Fri, 16 Oct 2009 11:53:39 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 14sm245682bwz.13.2009.10.16.11.53.37
        (version=SSLv3 cipher=RC4-MD5);
        Fri, 16 Oct 2009 11:53:38 -0700 (PDT)
Message-ID: <4AD8C131.1080901@gmail.com>
Date: Fri, 16 Oct 2009 14:53:37 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu> <4AD8BEC4.50905@gmail.com> <4AD8C04E.2020101@gmail.com>
In-Reply-To: <4AD8C04E.2020101@gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

Mark Miller wrote:
> Michael Busch wrote:
>   
>>  Why will just saying once again "Hey, let's just release more often"
>> work now if it hasn't in the last two years?
>>
>>  Mich
>>     
>
> I don't know that we need to release more often to take advantage of
> major numbers. 2.2 was released in 07 - we could have just released 2.9
> right after 2.2 rather than also releasing 2.3 and 2.4. The number of
> releases between major releases is self imposed.
>
>   
And actually - even 2.9, which took so long, didn't have to. A .9
release could be very fast and only done as a stepping stone to the next
major release. The pain of how long everything took was just self
imposed. We could have moved to 3.0 years ago easily if someone has
suggested so. The truth is, all the deprecation complain stuff only
recently reached a boil - so noone suggested moving to the next major
version faster long enough ago. When they did, we jumped from 2.4 to
2.9. And the 2.9 was a huge release - but again, it didn't have to be.
It could have been a formality - Grant was arguing at one point that it
should have been.

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42889-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 19:18:33 2009
Return-Path: <java-user-return-42889-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47075 invoked from network); 16 Oct 2009 19:18:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 19:18:33 -0000
Received: (qmail 50770 invoked by uid 500); 16 Oct 2009 19:18:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50744 invoked by uid 500); 16 Oct 2009 19:18:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50733 invoked by uid 99); 16 Oct 2009 19:18:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 19:18:29 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 19:18:19 +0000
Received: by fxm12 with SMTP id 12so2946665fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:17:58 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.15.11 with SMTP id i11mr362166faa.105.1255720678674; Fri, 
	16 Oct 2009 12:17:58 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
Date: Fri, 16 Oct 2009 15:17:58 -0400
Message-ID: <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015174762a4fd52fd0476124025
X-Virus-Checked: Checked by ClamAV on apache.org

--0015174762a4fd52fd0476124025
Content-Type: text/plain; charset=ISO-8859-1

It doesn't look like my Future.cancel(true) is actually interrupting the
thread.  It only does so "if necessary" and in this case seems to be letting
the Thread finish gracefully without need for interruption.

The stack trace leading up to the hanging IndexWriter.optimize() method is
below, though not terribly useful I imagine.  Here only 5 documents are
trying to be added to an index taking up only 39.2 MB on disk.  Again this
deadlocking only happens after I use the Future for this task to cancel the
task...

Thread [pool-3-thread-5] (Suspended)
    IndexWriter.doWait() line: 4494
    IndexWriter.optimize(int, boolean) line: 2283
    IndexWriter.optimize(boolean) line: 2218
    IndexWriter.optimize() line: 2198
    LuceneResultsPersister.commit() line: 97
    PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer) line:
105
    PersistenceJobConsumer.consume() line: 46
    PersistenceJobConsumer.run() line: 67
    Executors$RunnableAdapter<T>.call() line: 441
    FutureTask$Sync.innerRun() line: 303
    FutureTask<V>.run() line: 138
    ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
    ThreadPoolExecutor$Worker.run() line: 908
    Thread.run() line: 619

thanks,

C>T>

On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> My guess is it's the invocation of Thread.interrupt (which
> Future.cancel(true) calls if the task is running) that lead to the
> deadlock.
>
> Is it possible to get the stack trace of the thrown exception when the
> thread was interrupted?  Maybe indeed something in IW isn't cleaning
> up its state on being interrupted.
>
> Mike
>
> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
> <ctignor@thinkmap.com> wrote:
> > thanks for getting back.
> >
> > I do not lock on the IndexWriter object itself but all methods in my
> > consumer class that use IndexWriter are synchronized (locking my
> singleton
> > consumer object itself).
> > The thread is waiting at IndexWriter.doWait().  What might cuase this?
> >
> > thanks -
> >
> > C>T>
> >
> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de> wrote:
> >
> >> Do you use the IndexWriter as mutex in a synchronized() block? This is
> not
> >> supported and may hang. Never lock on IndexWriter instances. IndexWriter
> >> itself is thread safe.
> >>
> >> -----
> >> Uwe Schindler
> >> H.-H.-Meier-Allee 63, D-28213 Bremen
> >> http://www.thetaphi.de
> >> eMail: uwe@thetaphi.de
> >>
> >> > -----Original Message-----
> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
> >> > Sent: Friday, October 16, 2009 6:50 PM
> >> > To: java-user
> >> > Subject: IndexWriter optimize() deadlock
> >> >
> >> > Hello,
> >> >
> >> > I am trying to track down the cause of my code hanging on calling
> >> > IndexWriter.optimize() at its doWait() method.
> >> > It appears, thus that it is watiing on other merges to happen which is
> a
> >> > bit
> >> > confusing to me:
> >> >
> >> > My application is a simple producer consumer model where documents are
> >> > added
> >> > to a queue by producers and then one consumer with one indexwriter
> (the
> >> > only
> >> > in the application) periodically calls addDocument() on a batch of
> these
> >> > jobs and then calls optimize(), commit(). and then close().  There is
> >> only
> >> > one thread running the consumer so I am confused as to how the
> >> indexwriter
> >> > might be deadlocking itself.  Indeed this is the only thread active
> when
> >> > the
> >> > deadlock occurs so it seems to be a problem of reentry.
> >> >
> >> > Importantly, the deadlocking occurs only when the thread is trying to
> >> > shutdown - that is the Thread running this lucene consumer has a
> Future
> >> > that
> >> > has had its cancel(true) interrupting method called.  Is it possible
> that
> >> > an
> >> > internal Lucene lock is obtained during addDocument() and on
> interruption
> >> > is
> >> > never released so the subsequent optimize() call hangs?  This doesn't
> >> > appear
> >> > to be happening...
> >> >
> >> > Any help appreciated.
> >> >
> >> > thanks,
> >> >
> >> > C>T>
> >> >
> >> > what might I be missing here?
> >> >
> >> > --
> >> > TH!NKMAP
> >> >
> >> > Christopher Tignor | Senior Software Architect
> >> > 155 Spring Street NY, NY 10012
> >> > p.212-285-8600 x385 f.212-285-8999
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
> >
> > --
> > TH!NKMAP
> >
> > Christopher Tignor | Senior Software Architect
> > 155 Spring Street NY, NY 10012
> > p.212-285-8600 x385 f.212-285-8999
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--0015174762a4fd52fd0476124025--

From java-user-return-42890-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 19:53:43 2009
Return-Path: <java-user-return-42890-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56050 invoked from network); 16 Oct 2009 19:53:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 19:53:43 -0000
Received: (qmail 85376 invoked by uid 500); 16 Oct 2009 19:53:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85319 invoked by uid 500); 16 Oct 2009 19:53:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85309 invoked by uid 99); 16 Oct 2009 19:53:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 19:53:40 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 19:53:30 +0000
Received: by ywh13 with SMTP id 13so3254048ywh.29
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 12:53:08 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.27.1 with SMTP id a1mr3498478yba.125.1255722787688; Fri, 
	16 Oct 2009 12:53:07 -0700 (PDT)
In-Reply-To: <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
Date: Fri, 16 Oct 2009 15:53:07 -0400
Message-ID: <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

But if the Future.cancel call turns out to be a no-op (simply waits
instead of interrupting the thread), how could it be that the deadlock
only happens when you call it?  Weird.  Are you really sure it's not
actually calling Thread.interrupt?

That stack trace looks like a normal "optimize is waiting for the
background merges to complete".  Is it possible your background merges
are hitting exceptions?  You should see them on your error console if
so...

Mike

On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
<ctignor@thinkmap.com> wrote:
> It doesn't look like my Future.cancel(true) is actually interrupting the
> thread. =A0It only does so "if necessary" and in this case seems to be le=
tting
> the Thread finish gracefully without need for interruption.
>
> The stack trace leading up to the hanging IndexWriter.optimize() method i=
s
> below, though not terribly useful I imagine. =A0Here only 5 documents are
> trying to be added to an index taking up only 39.2 MB on disk. =A0Again t=
his
> deadlocking only happens after I use the Future for this task to cancel t=
he
> task...
>
> Thread [pool-3-thread-5] (Suspended)
> =A0 =A0IndexWriter.doWait() line: 4494
> =A0 =A0IndexWriter.optimize(int, boolean) line: 2283
> =A0 =A0IndexWriter.optimize(boolean) line: 2218
> =A0 =A0IndexWriter.optimize() line: 2198
> =A0 =A0LuceneResultsPersister.commit() line: 97
> =A0 =A0PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer) =
line:
> 105
> =A0 =A0PersistenceJobConsumer.consume() line: 46
> =A0 =A0PersistenceJobConsumer.run() line: 67
> =A0 =A0Executors$RunnableAdapter<T>.call() line: 441
> =A0 =A0FutureTask$Sync.innerRun() line: 303
> =A0 =A0FutureTask<V>.run() line: 138
> =A0 =A0ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
> =A0 =A0ThreadPoolExecutor$Worker.run() line: 908
> =A0 =A0Thread.run() line: 619
>
> thanks,
>
> C>T>
>
> On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> My guess is it's the invocation of Thread.interrupt (which
>> Future.cancel(true) calls if the task is running) that lead to the
>> deadlock.
>>
>> Is it possible to get the stack trace of the thrown exception when the
>> thread was interrupted? =A0Maybe indeed something in IW isn't cleaning
>> up its state on being interrupted.
>>
>> Mike
>>
>> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
>> <ctignor@thinkmap.com> wrote:
>> > thanks for getting back.
>> >
>> > I do not lock on the IndexWriter object itself but all methods in my
>> > consumer class that use IndexWriter are synchronized (locking my
>> singleton
>> > consumer object itself).
>> > The thread is waiting at IndexWriter.doWait(). =A0What might cuase thi=
s?
>> >
>> > thanks -
>> >
>> > C>T>
>> >
>> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de> wrot=
e:
>> >
>> >> Do you use the IndexWriter as mutex in a synchronized() block? This i=
s
>> not
>> >> supported and may hang. Never lock on IndexWriter instances. IndexWri=
ter
>> >> itself is thread safe.
>> >>
>> >> -----
>> >> Uwe Schindler
>> >> H.-H.-Meier-Allee 63, D-28213 Bremen
>> >> http://www.thetaphi.de
>> >> eMail: uwe@thetaphi.de
>> >>
>> >> > -----Original Message-----
>> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
>> >> > Sent: Friday, October 16, 2009 6:50 PM
>> >> > To: java-user
>> >> > Subject: IndexWriter optimize() deadlock
>> >> >
>> >> > Hello,
>> >> >
>> >> > I am trying to track down the cause of my code hanging on calling
>> >> > IndexWriter.optimize() at its doWait() method.
>> >> > It appears, thus that it is watiing on other merges to happen which=
 is
>> a
>> >> > bit
>> >> > confusing to me:
>> >> >
>> >> > My application is a simple producer consumer model where documents =
are
>> >> > added
>> >> > to a queue by producers and then one consumer with one indexwriter
>> (the
>> >> > only
>> >> > in the application) periodically calls addDocument() on a batch of
>> these
>> >> > jobs and then calls optimize(), commit(). and then close(). =A0Ther=
e is
>> >> only
>> >> > one thread running the consumer so I am confused as to how the
>> >> indexwriter
>> >> > might be deadlocking itself. =A0Indeed this is the only thread acti=
ve
>> when
>> >> > the
>> >> > deadlock occurs so it seems to be a problem of reentry.
>> >> >
>> >> > Importantly, the deadlocking occurs only when the thread is trying =
to
>> >> > shutdown - that is the Thread running this lucene consumer has a
>> Future
>> >> > that
>> >> > has had its cancel(true) interrupting method called. =A0Is it possi=
ble
>> that
>> >> > an
>> >> > internal Lucene lock is obtained during addDocument() and on
>> interruption
>> >> > is
>> >> > never released so the subsequent optimize() call hangs? =A0This doe=
sn't
>> >> > appear
>> >> > to be happening...
>> >> >
>> >> > Any help appreciated.
>> >> >
>> >> > thanks,
>> >> >
>> >> > C>T>
>> >> >
>> >> > what might I be missing here?
>> >> >
>> >> > --
>> >> > TH!NKMAP
>> >> >
>> >> > Christopher Tignor | Senior Software Architect
>> >> > 155 Spring Street NY, NY 10012
>> >> > p.212-285-8600 x385 f.212-285-8999
>> >>
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>> >
>> > --
>> > TH!NKMAP
>> >
>> > Christopher Tignor | Senior Software Architect
>> > 155 Spring Street NY, NY 10012
>> > p.212-285-8600 x385 f.212-285-8999
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42891-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 20:12:10 2009
Return-Path: <java-user-return-42891-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63543 invoked from network); 16 Oct 2009 20:12:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 20:12:10 -0000
Received: (qmail 23875 invoked by uid 500); 16 Oct 2009 20:12:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23799 invoked by uid 500); 16 Oct 2009 20:12:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23789 invoked by uid 99); 16 Oct 2009 20:12:07 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:12:07 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:12:04 +0000
Received: by fxm12 with SMTP id 12so3004074fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:11:42 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.3.137 with SMTP id 9mr306253fan.45.1255723902353; Fri, 16 
	Oct 2009 13:11:42 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
	 <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
Date: Fri, 16 Oct 2009 16:11:42 -0400
Message-ID: <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0ce075dc22c1da0476130149

--000e0ce075dc22c1da0476130149
Content-Type: text/plain; charset=ISO-8859-1

After tracing through the lucene source more it seems that what is happening
is after I call Future.cancel(true) on my parent thread, optimize() is
called and this method launches it's own thread using a
ConcurrentMergeScheduler$MergeThread to do the actual merging.

When this Thread comes around to calling mergeInit() on my index writer - a
synchronized method - it hangs.  For some reason it seems to no long have
the mutex perhaps?  Trace of this thread's stall below...

Daemon Thread [Lucene Merge Thread #0] (Suspended)
    IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
    IndexWriter.merge(MergePolicy$OneMerge) line: 3879
    ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
    ConcurrentMergeScheduler$MergeThread.run() line: 260

thanks again,

C>T>


On Fri, Oct 16, 2009 at 3:53 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> But if the Future.cancel call turns out to be a no-op (simply waits
> instead of interrupting the thread), how could it be that the deadlock
> only happens when you call it?  Weird.  Are you really sure it's not
> actually calling Thread.interrupt?
>
> That stack trace looks like a normal "optimize is waiting for the
> background merges to complete".  Is it possible your background merges
> are hitting exceptions?  You should see them on your error console if
> so...
>
> Mike
>
> On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
> <ctignor@thinkmap.com> wrote:
> > It doesn't look like my Future.cancel(true) is actually interrupting the
> > thread.  It only does so "if necessary" and in this case seems to be
> letting
> > the Thread finish gracefully without need for interruption.
> >
> > The stack trace leading up to the hanging IndexWriter.optimize() method
> is
> > below, though not terribly useful I imagine.  Here only 5 documents are
> > trying to be added to an index taking up only 39.2 MB on disk.  Again
> this
> > deadlocking only happens after I use the Future for this task to cancel
> the
> > task...
> >
> > Thread [pool-3-thread-5] (Suspended)
> >    IndexWriter.doWait() line: 4494
> >    IndexWriter.optimize(int, boolean) line: 2283
> >    IndexWriter.optimize(boolean) line: 2218
> >    IndexWriter.optimize() line: 2198
> >    LuceneResultsPersister.commit() line: 97
> >    PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer)
> line:
> > 105
> >    PersistenceJobConsumer.consume() line: 46
> >    PersistenceJobConsumer.run() line: 67
> >    Executors$RunnableAdapter<T>.call() line: 441
> >    FutureTask$Sync.innerRun() line: 303
> >    FutureTask<V>.run() line: 138
> >    ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
> >    ThreadPoolExecutor$Worker.run() line: 908
> >    Thread.run() line: 619
> >
> > thanks,
> >
> > C>T>
> >
> > On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> My guess is it's the invocation of Thread.interrupt (which
> >> Future.cancel(true) calls if the task is running) that lead to the
> >> deadlock.
> >>
> >> Is it possible to get the stack trace of the thrown exception when the
> >> thread was interrupted?  Maybe indeed something in IW isn't cleaning
> >> up its state on being interrupted.
> >>
> >> Mike
> >>
> >> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
> >> <ctignor@thinkmap.com> wrote:
> >> > thanks for getting back.
> >> >
> >> > I do not lock on the IndexWriter object itself but all methods in my
> >> > consumer class that use IndexWriter are synchronized (locking my
> >> singleton
> >> > consumer object itself).
> >> > The thread is waiting at IndexWriter.doWait().  What might cuase this?
> >> >
> >> > thanks -
> >> >
> >> > C>T>
> >> >
> >> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de>
> wrote:
> >> >
> >> >> Do you use the IndexWriter as mutex in a synchronized() block? This
> is
> >> not
> >> >> supported and may hang. Never lock on IndexWriter instances.
> IndexWriter
> >> >> itself is thread safe.
> >> >>
> >> >> -----
> >> >> Uwe Schindler
> >> >> H.-H.-Meier-Allee 63, D-28213 Bremen
> >> >> http://www.thetaphi.de
> >> >> eMail: uwe@thetaphi.de
> >> >>
> >> >> > -----Original Message-----
> >> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
> >> >> > Sent: Friday, October 16, 2009 6:50 PM
> >> >> > To: java-user
> >> >> > Subject: IndexWriter optimize() deadlock
> >> >> >
> >> >> > Hello,
> >> >> >
> >> >> > I am trying to track down the cause of my code hanging on calling
> >> >> > IndexWriter.optimize() at its doWait() method.
> >> >> > It appears, thus that it is watiing on other merges to happen which
> is
> >> a
> >> >> > bit
> >> >> > confusing to me:
> >> >> >
> >> >> > My application is a simple producer consumer model where documents
> are
> >> >> > added
> >> >> > to a queue by producers and then one consumer with one indexwriter
> >> (the
> >> >> > only
> >> >> > in the application) periodically calls addDocument() on a batch of
> >> these
> >> >> > jobs and then calls optimize(), commit(). and then close().  There
> is
> >> >> only
> >> >> > one thread running the consumer so I am confused as to how the
> >> >> indexwriter
> >> >> > might be deadlocking itself.  Indeed this is the only thread active
> >> when
> >> >> > the
> >> >> > deadlock occurs so it seems to be a problem of reentry.
> >> >> >
> >> >> > Importantly, the deadlocking occurs only when the thread is trying
> to
> >> >> > shutdown - that is the Thread running this lucene consumer has a
> >> Future
> >> >> > that
> >> >> > has had its cancel(true) interrupting method called.  Is it
> possible
> >> that
> >> >> > an
> >> >> > internal Lucene lock is obtained during addDocument() and on
> >> interruption
> >> >> > is
> >> >> > never released so the subsequent optimize() call hangs?  This
> doesn't
> >> >> > appear
> >> >> > to be happening...
> >> >> >
> >> >> > Any help appreciated.
> >> >> >
> >> >> > thanks,
> >> >> >
> >> >> > C>T>
> >> >> >
> >> >> > what might I be missing here?
> >> >> >
> >> >> > --
> >> >> > TH!NKMAP
> >> >> >
> >> >> > Christopher Tignor | Senior Software Architect
> >> >> > 155 Spring Street NY, NY 10012
> >> >> > p.212-285-8600 x385 f.212-285-8999
> >> >>
> >> >>
> >> >> ---------------------------------------------------------------------
> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >>
> >> >>
> >> >
> >> >
> >> > --
> >> > TH!NKMAP
> >> >
> >> > Christopher Tignor | Senior Software Architect
> >> > 155 Spring Street NY, NY 10012
> >> > p.212-285-8600 x385 f.212-285-8999
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
> >
> > --
> > TH!NKMAP
> >
> > Christopher Tignor | Senior Software Architect
> > 155 Spring Street NY, NY 10012
> > p.212-285-8600 x385 f.212-285-8999
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--000e0ce075dc22c1da0476130149--

From java-user-return-42892-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 20:25:10 2009
Return-Path: <java-user-return-42892-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68128 invoked from network); 16 Oct 2009 20:25:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 20:25:10 -0000
Received: (qmail 42343 invoked by uid 500); 16 Oct 2009 20:25:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42310 invoked by uid 500); 16 Oct 2009 20:25:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42300 invoked by uid 99); 16 Oct 2009 20:25:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:25:07 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.177] (HELO homiemail-a18.g.dreamhost.com) (208.97.132.177)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:24:57 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a18.g.dreamhost.com (Postfix) with ESMTPA id BBC2525006E
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:24:35 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: OpenRelevance
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <786734.96908.qm@web52910.mail.re2.yahoo.com>
Date: Fri, 16 Oct 2009 16:24:34 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <56480E80-2193-4B67-8C50-C4CE9DBFA44F@apache.org>
References: <786734.96908.qm@web52910.mail.re2.yahoo.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

Sorry, Open Relevance Project

On Oct 16, 2009, at 12:44 PM, Omar Alonso wrote:

> What's ORP?
>
> --- On Fri, 10/16/09, Grant Ingersoll <gsingers@apache.org> wrote:
>
>> From: Grant Ingersoll <gsingers@apache.org>
>> Subject: Re: OpenRelevance
>> To: java-user@lucene.apache.org
>> Date: Friday, October 16, 2009, 3:32 AM
>> I definitely am, but am lacking in
>> time at the moment.  A good place to ask is over on the
>> ORP mailing lists, maybe that will help kickstart things
>> over there.
>>
>> -Grant
>>
>> On Oct 15, 2009, at 3:32 PM, Omar Alonso wrote:
>>
>>> Hi folks,
>>>
>>> I would like to know if people are interested in the
>> OpenRelevance project (http://wiki.apache.org/lucene-java/OpenRelevance 
>> ).
>>>
>>> I've done quite a few experiments on Amazon Mechanical
>> Turk using TREC and INEX data sets, so one approach would be
>> to use crowdsourcing for such task.
>>>
>>> Regards,
>>>
>>> Omar
>>>
>>>
>>>
>>>
>>>
>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>> --------------------------
>> Grant Ingersoll
>> http://www.lucidimagination.com/
>>
>> Search the Lucene ecosystem
>> (Lucene/Solr/Nutch/Mahout/Tika/Droids) using Solr/Lucene:
>> http://www.lucidimagination.com/search
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42893-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 20:25:46 2009
Return-Path: <java-user-return-42893-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68225 invoked from network); 16 Oct 2009 20:25:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 20:25:46 -0000
Received: (qmail 44249 invoked by uid 500); 16 Oct 2009 20:25:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44188 invoked by uid 500); 16 Oct 2009 20:25:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44178 invoked by uid 99); 16 Oct 2009 20:25:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:25:43 +0000
X-ASF-Spam-Status: No, hits=-2.8 required=10.0
	tests=RCVD_IN_DNSWL_MED,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: 131.246.120.220 is neither permitted nor denied by domain of christian.reuschling@gmail.com)
Received: from [131.246.120.220] (HELO mailgw1.uni-kl.de) (131.246.120.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:25:34 +0000
Received: from dfki.uni-kl.de (dfki-1002.dfki.uni-kl.de [131.246.195.2])
	by mailgw1.uni-kl.de (8.13.8/8.13.8/Debian-3) with ESMTP id n9GKPEY2003862
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 22:25:14 +0200
Received: from serv-4100.kl.dfki.de (serv-4100.kl.dfki.de [192.168.41.180])
	by dfki.uni-kl.de (8.13.8+Sun/8.11.4) with ESMTP id n9GKPEqw014693
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 22:25:14 +0200 (CEST)
Received: from pc-4176.kl.dfki.de (pc-4176.kl.dfki.de [192.168.41.166])
	by serv-4100.kl.dfki.de (8.13.8+Sun/8.13.8) with ESMTP id n9GKPDAm020503
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 22:25:13 +0200 (CEST)
Date: Fri, 16 Oct 2009 22:25:04 +0200
From: Christian Reuschling <christian.reuschling@gmail.com>
To: <java-user@lucene.apache.org>
Subject: Filter for searching in result lists with 2.9
Message-ID: <20091016222504.7a1e5e86@pc-4176.kl.dfki.de>
X-Mailer: Claws Mail 3.7.2 (GTK+ 2.14.4; i586-http://packman.links2linux.de-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; boundary="Sig_/Qn2iXhI0t6z/oKE.=jknWGW";
 protocol="application/pgp-signature"; micalg=PGP-SHA1
X-Virus-Checked: Checked by ClamAV on apache.org

--Sig_/Qn2iXhI0t6z/oKE.=jknWGW
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

Hi guys,

in our app we gives the possibility to search inside a set of documents, wh=
ich
is the result list of a former search. Thus, someone can shrink down a sear=
ch
according different criterias.

For this, we implemented a simple Filter that simply gets a TopDocs Object =
and
creates a bitSet out of the document numbers:

class SearchInResultsFilter extends Filter
{
        private BitSet bitSet;

        public SearchInResultsFilter(TopDocs topDocs)
        {
            bitSet =3D new BitSet(topDocs.scoreDocs.length);
            for (ScoreDoc scoreDoc : topDocs.scoreDocs)
            {
                bitSet.set(scoreDoc.doc);
            }
        }

        @Override
        public BitSet bits(IndexReader reader) throws IOException
        {
            return bitSet;
        }
}

With Lucene 2.9, the reader object given in bits(..) is not the 'big reader=
',
but some kind of subreader, i.e. a SegmentReader. Thus, the document ids of
the topDocs and this object are not compatible anymore.
I think, in the new, non-deprecated 'DocIdSet getDocIdSet(IndexReader reade=
r)'
will be the same SegmentReader.

I solved a similar scenario in our custom FieldComparator, by recognizing t=
he
reader-specific docbase given in the method
'public void setNextReader(IndexReader reader, int docBase)'

But inside Filter, I don't have such a nice method. What is the trick?


Thanks for all potential hints


Christian

--Sig_/Qn2iXhI0t6z/oKE.=jknWGW
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.9 (GNU/Linux)

iEYEARECAAYFAkrY1qYACgkQ6EqMXq+WZg8XmACgraAbOYDgKBecFV8+bVBVImgD
nKYAnjnWHdO6odKnfRN+u+HAfPtnq7qS
=sDIA
-----END PGP SIGNATURE-----

--Sig_/Qn2iXhI0t6z/oKE.=jknWGW--

From java-user-return-42894-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 20:38:02 2009
Return-Path: <java-user-return-42894-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71216 invoked from network); 16 Oct 2009 20:38:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 20:38:02 -0000
Received: (qmail 64121 invoked by uid 500); 16 Oct 2009 20:37:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64054 invoked by uid 500); 16 Oct 2009 20:37:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64044 invoked by uid 99); 16 Oct 2009 20:37:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:37:59 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:37:48 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id C1078D36007
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 22:37:28 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id Y4hhFhscBCHv for <java-user@lucene.apache.org>;
	Fri, 16 Oct 2009 22:37:20 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 80D96D36006
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 22:37:20 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <20091016222504.7a1e5e86@pc-4176.kl.dfki.de>
Subject: RE: Filter for searching in result lists with 2.9
Date: Fri, 16 Oct 2009 22:37:20 +0200
Message-ID: <82580060BD2A449F9F3BA502E1D19C3D@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <20091016222504.7a1e5e86@pc-4176.kl.dfki.de>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
Thread-Index: AcpOntugdUrqTZvZRHqGnp+281ABOwAARhyQ
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Christian,

Why not create the filter using QueryWrapperFilter using the previous Query?
Or simply combine the previous with the new query using a BooleanQuery with
Occur.MUST?

Even with the new API it is not possible what you want to do. The
IndexReader passed to getDocIdSet/bits is not the same Reader as used for
collecting hits for TopDocs before [By the way: Creating the filter would
have gone faster if you simply implemented a (Hit)Collector that marks the
hits in the BitSet]

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Christian Reuschling [mailto:christian.reuschling@gmail.com]
> Sent: Friday, October 16, 2009 10:25 PM
> To: java-user@lucene.apache.org
> Subject: Filter for searching in result lists with 2.9
> 
> Hi guys,
> 
> in our app we gives the possibility to search inside a set of documents,
> which
> is the result list of a former search. Thus, someone can shrink down a
> search
> according different criterias.
> 
> For this, we implemented a simple Filter that simply gets a TopDocs Object
> and
> creates a bitSet out of the document numbers:
> 
> class SearchInResultsFilter extends Filter
> {
>         private BitSet bitSet;
> 
>         public SearchInResultsFilter(TopDocs topDocs)
>         {
>             bitSet = new BitSet(topDocs.scoreDocs.length);
>             for (ScoreDoc scoreDoc : topDocs.scoreDocs)
>             {
>                 bitSet.set(scoreDoc.doc);
>             }
>         }
> 
>         @Override
>         public BitSet bits(IndexReader reader) throws IOException
>         {
>             return bitSet;
>         }
> }
> 
> With Lucene 2.9, the reader object given in bits(..) is not the 'big
> reader',
> but some kind of subreader, i.e. a SegmentReader. Thus, the document ids
> of
> the topDocs and this object are not compatible anymore.
> I think, in the new, non-deprecated 'DocIdSet getDocIdSet(IndexReader
> reader)'
> will be the same SegmentReader.
> 
> I solved a similar scenario in our custom FieldComparator, by recognizing
> the
> reader-specific docbase given in the method
> 'public void setNextReader(IndexReader reader, int docBase)'
> 
> But inside Filter, I don't have such a nice method. What is the trick?
> 
> 
> Thanks for all potential hints
> 
> 
> Christian


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42895-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 20:44:55 2009
Return-Path: <java-user-return-42895-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73190 invoked from network); 16 Oct 2009 20:44:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 20:44:54 -0000
Received: (qmail 78834 invoked by uid 500); 16 Oct 2009 20:44:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78790 invoked by uid 500); 16 Oct 2009 20:44:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78780 invoked by uid 99); 16 Oct 2009 20:44:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:44:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 20:44:41 +0000
Received: by fxm12 with SMTP id 12so3039357fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 13:44:20 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.22.81 with SMTP id m17mr540707fab.28.1255725860427; Fri, 
	16 Oct 2009 13:44:20 -0700 (PDT)
In-Reply-To: <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
	 <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
	 <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
Date: Fri, 16 Oct 2009 16:44:20 -0400
Message-ID: <6f287d1b0910161344v4965a3cbq7bba697af44b2106@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151747beead89a9604761375d2
X-Virus-Checked: Checked by ClamAV on apache.org

--00151747beead89a9604761375d2
Content-Type: text/plain; charset=ISO-8859-1

Indeed it looks like the thread running MergerThread started (After passing
off to ConcurentMergeScheduler) by the thread calling IndexWriter.optimize()
is indeed waiting on the mutex for the IndexWriter to be free so it can use
the object to call mergeInit().

The IndexWriter however has entered a synchronized() waiting loop, waking up
every second ( in doWait() ) and checking if there are running merges left -
which of course there are as the thread responsible for doing the merging
can't get in.  Deadlocked stack traces are below:

Thread [pool-2-thread-5] (Suspended)
    owns: IndexWriter  (id=71)
    owns: LuceneResultsPersister  (id=85)
    IndexWriter.optimize(int, boolean) line: 2283
    IndexWriter.optimize(boolean) line: 2218
    IndexWriter.optimize() line: 2198
    LuceneResultsPersister.commit() line: 97
    PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer) line:
105
    PersistenceJobConsumer.consume() line: 46
    PersistenceJobConsumer.run() line: 67
    Executors$RunnableAdapter<T>.call() line: 441
    FutureTask$Sync.innerRun() line: 303
    FutureTask<V>.run() line: 138
    ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
    ThreadPoolExecutor$Worker.run() line: 908
    Thread.run() line: 619

Daemon Thread [Lucene Merge Thread #0] (Suspended)
    waiting for: IndexWriter  (id=71)
    IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
    IndexWriter.merge(MergePolicy$OneMerge) line: 3879
    ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
    ConcurrentMergeScheduler$MergeThread.run() line: 260

I don't really understand how this code is supposed to (and has) worked
before this and what the problem thus might be here:

In IndexWriter.optimize() at line 2263 we have the synchronized block where
doWait becomes true using the parameter-less call to optimize():

if (doWait) {
      synchronized(this) {
        while(true) {
          if (mergeExceptions.size() > 0) {
            // Forward any exceptions in background merge
            // threads to the current thread:
            final int size = mergeExceptions.size();
            for(int i=0;i<size;i++) {
              final MergePolicy.OneMerge merge = (MergePolicy.OneMerge)
mergeExceptions.get(0);
              if (merge.optimize) {
                IOException err = new IOException("background merge hit
exception: " + merge.segString(directory));
                final Throwable t = merge.getException();
                if (t != null)
                  err.initCause(t);
                throw err;
              }
            }
          }

          if (optimizeMergesPending())
            doWait();
          else
            break;
        }
      }

It is holding this lock while the thread it started to do the mergin is
trying to call it's mergeInit() method.

Any thoughts?

thanks,

C>T>

On Fri, Oct 16, 2009 at 4:11 PM, Christopher Tignor <ctignor@thinkmap.com>wrote:

> After tracing through the lucene source more it seems that what is
> happening is after I call Future.cancel(true) on my parent thread,
> optimize() is called and this method launches it's own thread using a
> ConcurrentMergeScheduler$MergeThread to do the actual merging.
>
> When this Thread comes around to calling mergeInit() on my index writer - a
> synchronized method - it hangs.  For some reason it seems to no long have
> the mutex perhaps?  Trace of this thread's stall below...
>
> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>     IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>     IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>     ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
>     ConcurrentMergeScheduler$MergeThread.run() line: 260
>
> thanks again,
>
> C>T>
>
>
>
> On Fri, Oct 16, 2009 at 3:53 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> But if the Future.cancel call turns out to be a no-op (simply waits
>> instead of interrupting the thread), how could it be that the deadlock
>> only happens when you call it?  Weird.  Are you really sure it's not
>> actually calling Thread.interrupt?
>>
>> That stack trace looks like a normal "optimize is waiting for the
>> background merges to complete".  Is it possible your background merges
>> are hitting exceptions?  You should see them on your error console if
>> so...
>>
>> Mike
>>
>> On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
>> <ctignor@thinkmap.com> wrote:
>> > It doesn't look like my Future.cancel(true) is actually interrupting the
>> > thread.  It only does so "if necessary" and in this case seems to be
>> letting
>> > the Thread finish gracefully without need for interruption.
>> >
>> > The stack trace leading up to the hanging IndexWriter.optimize() method
>> is
>> > below, though not terribly useful I imagine.  Here only 5 documents are
>> > trying to be added to an index taking up only 39.2 MB on disk.  Again
>> this
>> > deadlocking only happens after I use the Future for this task to cancel
>> the
>> > task...
>> >
>> > Thread [pool-3-thread-5] (Suspended)
>> >    IndexWriter.doWait() line: 4494
>> >    IndexWriter.optimize(int, boolean) line: 2283
>> >    IndexWriter.optimize(boolean) line: 2218
>> >    IndexWriter.optimize() line: 2198
>> >    LuceneResultsPersister.commit() line: 97
>> >    PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer)
>> line:
>> > 105
>> >    PersistenceJobConsumer.consume() line: 46
>> >    PersistenceJobConsumer.run() line: 67
>> >    Executors$RunnableAdapter<T>.call() line: 441
>> >    FutureTask$Sync.innerRun() line: 303
>> >    FutureTask<V>.run() line: 138
>> >    ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>> >    ThreadPoolExecutor$Worker.run() line: 908
>> >    Thread.run() line: 619
>> >
>> > thanks,
>> >
>> > C>T>
>> >
>> > On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> My guess is it's the invocation of Thread.interrupt (which
>> >> Future.cancel(true) calls if the task is running) that lead to the
>> >> deadlock.
>> >>
>> >> Is it possible to get the stack trace of the thrown exception when the
>> >> thread was interrupted?  Maybe indeed something in IW isn't cleaning
>> >> up its state on being interrupted.
>> >>
>> >> Mike
>> >>
>> >> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
>> >> <ctignor@thinkmap.com> wrote:
>> >> > thanks for getting back.
>> >> >
>> >> > I do not lock on the IndexWriter object itself but all methods in my
>> >> > consumer class that use IndexWriter are synchronized (locking my
>> >> singleton
>> >> > consumer object itself).
>> >> > The thread is waiting at IndexWriter.doWait().  What might cuase
>> this?
>> >> >
>> >> > thanks -
>> >> >
>> >> > C>T>
>> >> >
>> >> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de>
>> wrote:
>> >> >
>> >> >> Do you use the IndexWriter as mutex in a synchronized() block? This
>> is
>> >> not
>> >> >> supported and may hang. Never lock on IndexWriter instances.
>> IndexWriter
>> >> >> itself is thread safe.
>> >> >>
>> >> >> -----
>> >> >> Uwe Schindler
>> >> >> H.-H.-Meier-Allee 63, D-28213 Bremen
>> >> >> http://www.thetaphi.de
>> >> >> eMail: uwe@thetaphi.de
>> >> >>
>> >> >> > -----Original Message-----
>> >> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
>> >> >> > Sent: Friday, October 16, 2009 6:50 PM
>> >> >> > To: java-user
>> >> >> > Subject: IndexWriter optimize() deadlock
>> >> >> >
>> >> >> > Hello,
>> >> >> >
>> >> >> > I am trying to track down the cause of my code hanging on calling
>> >> >> > IndexWriter.optimize() at its doWait() method.
>> >> >> > It appears, thus that it is watiing on other merges to happen
>> which is
>> >> a
>> >> >> > bit
>> >> >> > confusing to me:
>> >> >> >
>> >> >> > My application is a simple producer consumer model where documents
>> are
>> >> >> > added
>> >> >> > to a queue by producers and then one consumer with one indexwriter
>> >> (the
>> >> >> > only
>> >> >> > in the application) periodically calls addDocument() on a batch of
>> >> these
>> >> >> > jobs and then calls optimize(), commit(). and then close().  There
>> is
>> >> >> only
>> >> >> > one thread running the consumer so I am confused as to how the
>> >> >> indexwriter
>> >> >> > might be deadlocking itself.  Indeed this is the only thread
>> active
>> >> when
>> >> >> > the
>> >> >> > deadlock occurs so it seems to be a problem of reentry.
>> >> >> >
>> >> >> > Importantly, the deadlocking occurs only when the thread is trying
>> to
>> >> >> > shutdown - that is the Thread running this lucene consumer has a
>> >> Future
>> >> >> > that
>> >> >> > has had its cancel(true) interrupting method called.  Is it
>> possible
>> >> that
>> >> >> > an
>> >> >> > internal Lucene lock is obtained during addDocument() and on
>> >> interruption
>> >> >> > is
>> >> >> > never released so the subsequent optimize() call hangs?  This
>> doesn't
>> >> >> > appear
>> >> >> > to be happening...
>> >> >> >
>> >> >> > Any help appreciated.
>> >> >> >
>> >> >> > thanks,
>> >> >> >
>> >> >> > C>T>
>> >> >> >
>> >> >> > what might I be missing here?
>> >> >> >
>> >> >> > --
>> >> >> > TH!NKMAP
>> >> >> >
>> >> >> > Christopher Tignor | Senior Software Architect
>> >> >> > 155 Spring Street NY, NY 10012
>> >> >> > p.212-285-8600 x385 f.212-285-8999
>> >> >>
>> >> >>
>> >> >>
>> ---------------------------------------------------------------------
>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >> >>
>> >> >>
>> >> >
>> >> >
>> >> > --
>> >> > TH!NKMAP
>> >> >
>> >> > Christopher Tignor | Senior Software Architect
>> >> > 155 Spring Street NY, NY 10012
>> >> > p.212-285-8600 x385 f.212-285-8999
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>> >
>> > --
>> > TH!NKMAP
>> >
>> > Christopher Tignor | Senior Software Architect
>> > 155 Spring Street NY, NY 10012
>> > p.212-285-8600 x385 f.212-285-8999
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>



-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--00151747beead89a9604761375d2--

From java-user-return-42896-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 22:02:24 2009
Return-Path: <java-user-return-42896-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97549 invoked from network); 16 Oct 2009 22:02:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 22:02:24 -0000
Received: (qmail 67902 invoked by uid 500); 16 Oct 2009 22:02:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67823 invoked by uid 500); 16 Oct 2009 22:02:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67810 invoked by uid 99); 16 Oct 2009 22:02:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 22:02:20 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 22:02:16 +0000
Received: by fxm12 with SMTP id 12so3114039fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 15:01:54 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.127.195 with SMTP id h3mr468348fas.57.1255730513894; Fri, 
	16 Oct 2009 15:01:53 -0700 (PDT)
In-Reply-To: <6f287d1b0910161344v4965a3cbq7bba697af44b2106@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
	 <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
	 <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
	 <6f287d1b0910161344v4965a3cbq7bba697af44b2106@mail.gmail.com>
Date: Fri, 16 Oct 2009 18:01:53 -0400
Message-ID: <6f287d1b0910161501q3ed58173p7270e6f9c0e74f2f@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00235407f00636dc9d0476148b82

--00235407f00636dc9d0476148b82
Content-Type: text/plain; charset=ISO-8859-1

I discovered the problem and fixed it's effect on my code:

Using the source for Lucene version 2.4.1,
in IndexWriter.optimize() there is a call to doWait() on line 2283
this method attempts to wait for a second in order to give other threads it
has spawned a chance to acquire it's mutex and complete index merges.
It checks if there are any merges left after it wakes up.  if there aren't
int proceeds.

However, using using a Future object associated with this thread and calling
cancel(true) doesn't allow the Thread to enter into Object.wait() (or the
executorservice observing this Future immediately wakes it up or something)
so it returns immediately and the thread holding the lock on the IndexWriter
never sceeds it's lock to threads running a merge.

I re-wrote my code such that it didn't need to call the interruptible
version of Future.cancel() to solve it, i.e. Future.cancel(false)

thanks,

C>T>

On Fri, Oct 16, 2009 at 4:44 PM, Christopher Tignor <ctignor@thinkmap.com>wrote:

> Indeed it looks like the thread running MergerThread started (After passing
> off to ConcurentMergeScheduler) by the thread calling IndexWriter.optimize()
> is indeed waiting on the mutex for the IndexWriter to be free so it can use
> the object to call mergeInit().
>
> The IndexWriter however has entered a synchronized() waiting loop, waking
> up every second ( in doWait() ) and checking if there are running merges
> left - which of course there are as the thread responsible for doing the
> merging can't get in.  Deadlocked stack traces are below:
>
> Thread [pool-2-thread-5] (Suspended)
>     owns: IndexWriter  (id=71)
>     owns: LuceneResultsPersister  (id=85)
>     IndexWriter.optimize(int, boolean) line: 2283
>     IndexWriter.optimize(boolean) line: 2218
>     IndexWriter.optimize() line: 2198
>     LuceneResultsPersister.commit() line: 97
>     PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer) line:
> 105
>     PersistenceJobConsumer.consume() line: 46
>     PersistenceJobConsumer.run() line: 67
>     Executors$RunnableAdapter<T>.call() line: 441
>     FutureTask$Sync.innerRun() line: 303
>     FutureTask<V>.run() line: 138
>     ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>     ThreadPoolExecutor$Worker.run() line: 908
>     Thread.run() line: 619
>
> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>     waiting for: IndexWriter  (id=71)
>     IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>     IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>     ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
>     ConcurrentMergeScheduler$MergeThread.run() line: 260
>
> I don't really understand how this code is supposed to (and has) worked
> before this and what the problem thus might be here:
>
> In IndexWriter.optimize() at line 2263 we have the synchronized block where
> doWait becomes true using the parameter-less call to optimize():
>
> if (doWait) {
>       synchronized(this) {
>         while(true) {
>           if (mergeExceptions.size() > 0) {
>             // Forward any exceptions in background merge
>             // threads to the current thread:
>             final int size = mergeExceptions.size();
>             for(int i=0;i<size;i++) {
>               final MergePolicy.OneMerge merge = (MergePolicy.OneMerge)
> mergeExceptions.get(0);
>               if (merge.optimize) {
>                 IOException err = new IOException("background merge hit
> exception: " + merge.segString(directory));
>                 final Throwable t = merge.getException();
>                 if (t != null)
>                   err.initCause(t);
>                 throw err;
>               }
>             }
>           }
>
>           if (optimizeMergesPending())
>             doWait();
>           else
>             break;
>         }
>       }
>
> It is holding this lock while the thread it started to do the mergin is
> trying to call it's mergeInit() method.
>
> Any thoughts?
>
> thanks,
>
> C>T>
>
>
> On Fri, Oct 16, 2009 at 4:11 PM, Christopher Tignor <ctignor@thinkmap.com>wrote:
>
>> After tracing through the lucene source more it seems that what is
>> happening is after I call Future.cancel(true) on my parent thread,
>> optimize() is called and this method launches it's own thread using a
>> ConcurrentMergeScheduler$MergeThread to do the actual merging.
>>
>> When this Thread comes around to calling mergeInit() on my index writer -
>> a synchronized method - it hangs.  For some reason it seems to no long have
>> the mutex perhaps?  Trace of this thread's stall below...
>>
>> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>>     IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>>     IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>>     ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
>>     ConcurrentMergeScheduler$MergeThread.run() line: 260
>>
>> thanks again,
>>
>> C>T>
>>
>>
>>
>> On Fri, Oct 16, 2009 at 3:53 PM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> But if the Future.cancel call turns out to be a no-op (simply waits
>>> instead of interrupting the thread), how could it be that the deadlock
>>> only happens when you call it?  Weird.  Are you really sure it's not
>>> actually calling Thread.interrupt?
>>>
>>> That stack trace looks like a normal "optimize is waiting for the
>>> background merges to complete".  Is it possible your background merges
>>> are hitting exceptions?  You should see them on your error console if
>>> so...
>>>
>>> Mike
>>>
>>> On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
>>> <ctignor@thinkmap.com> wrote:
>>> > It doesn't look like my Future.cancel(true) is actually interrupting
>>> the
>>> > thread.  It only does so "if necessary" and in this case seems to be
>>> letting
>>> > the Thread finish gracefully without need for interruption.
>>> >
>>> > The stack trace leading up to the hanging IndexWriter.optimize() method
>>> is
>>> > below, though not terribly useful I imagine.  Here only 5 documents are
>>> > trying to be added to an index taking up only 39.2 MB on disk.  Again
>>> this
>>> > deadlocking only happens after I use the Future for this task to cancel
>>> the
>>> > task...
>>> >
>>> > Thread [pool-3-thread-5] (Suspended)
>>> >    IndexWriter.doWait() line: 4494
>>> >    IndexWriter.optimize(int, boolean) line: 2283
>>> >    IndexWriter.optimize(boolean) line: 2218
>>> >    IndexWriter.optimize() line: 2198
>>> >    LuceneResultsPersister.commit() line: 97
>>> >    PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer)
>>> line:
>>> > 105
>>> >    PersistenceJobConsumer.consume() line: 46
>>> >    PersistenceJobConsumer.run() line: 67
>>> >    Executors$RunnableAdapter<T>.call() line: 441
>>> >    FutureTask$Sync.innerRun() line: 303
>>> >    FutureTask<V>.run() line: 138
>>> >    ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>>> >    ThreadPoolExecutor$Worker.run() line: 908
>>> >    Thread.run() line: 619
>>> >
>>> > thanks,
>>> >
>>> > C>T>
>>> >
>>> > On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
>>> > lucene@mikemccandless.com> wrote:
>>> >
>>> >> My guess is it's the invocation of Thread.interrupt (which
>>> >> Future.cancel(true) calls if the task is running) that lead to the
>>> >> deadlock.
>>> >>
>>> >> Is it possible to get the stack trace of the thrown exception when the
>>> >> thread was interrupted?  Maybe indeed something in IW isn't cleaning
>>> >> up its state on being interrupted.
>>> >>
>>> >> Mike
>>> >>
>>> >> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
>>> >> <ctignor@thinkmap.com> wrote:
>>> >> > thanks for getting back.
>>> >> >
>>> >> > I do not lock on the IndexWriter object itself but all methods in my
>>> >> > consumer class that use IndexWriter are synchronized (locking my
>>> >> singleton
>>> >> > consumer object itself).
>>> >> > The thread is waiting at IndexWriter.doWait().  What might cuase
>>> this?
>>> >> >
>>> >> > thanks -
>>> >> >
>>> >> > C>T>
>>> >> >
>>> >> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de>
>>> wrote:
>>> >> >
>>> >> >> Do you use the IndexWriter as mutex in a synchronized() block? This
>>> is
>>> >> not
>>> >> >> supported and may hang. Never lock on IndexWriter instances.
>>> IndexWriter
>>> >> >> itself is thread safe.
>>> >> >>
>>> >> >> -----
>>> >> >> Uwe Schindler
>>> >> >> H.-H.-Meier-Allee 63, D-28213 Bremen
>>> >> >> http://www.thetaphi.de
>>> >> >> eMail: uwe@thetaphi.de
>>> >> >>
>>> >> >> > -----Original Message-----
>>> >> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
>>> >> >> > Sent: Friday, October 16, 2009 6:50 PM
>>> >> >> > To: java-user
>>> >> >> > Subject: IndexWriter optimize() deadlock
>>> >> >> >
>>> >> >> > Hello,
>>> >> >> >
>>> >> >> > I am trying to track down the cause of my code hanging on calling
>>> >> >> > IndexWriter.optimize() at its doWait() method.
>>> >> >> > It appears, thus that it is watiing on other merges to happen
>>> which is
>>> >> a
>>> >> >> > bit
>>> >> >> > confusing to me:
>>> >> >> >
>>> >> >> > My application is a simple producer consumer model where
>>> documents are
>>> >> >> > added
>>> >> >> > to a queue by producers and then one consumer with one
>>> indexwriter
>>> >> (the
>>> >> >> > only
>>> >> >> > in the application) periodically calls addDocument() on a batch
>>> of
>>> >> these
>>> >> >> > jobs and then calls optimize(), commit(). and then close().
>>>  There is
>>> >> >> only
>>> >> >> > one thread running the consumer so I am confused as to how the
>>> >> >> indexwriter
>>> >> >> > might be deadlocking itself.  Indeed this is the only thread
>>> active
>>> >> when
>>> >> >> > the
>>> >> >> > deadlock occurs so it seems to be a problem of reentry.
>>> >> >> >
>>> >> >> > Importantly, the deadlocking occurs only when the thread is
>>> trying to
>>> >> >> > shutdown - that is the Thread running this lucene consumer has a
>>> >> Future
>>> >> >> > that
>>> >> >> > has had its cancel(true) interrupting method called.  Is it
>>> possible
>>> >> that
>>> >> >> > an
>>> >> >> > internal Lucene lock is obtained during addDocument() and on
>>> >> interruption
>>> >> >> > is
>>> >> >> > never released so the subsequent optimize() call hangs?  This
>>> doesn't
>>> >> >> > appear
>>> >> >> > to be happening...
>>> >> >> >
>>> >> >> > Any help appreciated.
>>> >> >> >
>>> >> >> > thanks,
>>> >> >> >
>>> >> >> > C>T>
>>> >> >> >
>>> >> >> > what might I be missing here?
>>> >> >> >
>>> >> >> > --
>>> >> >> > TH!NKMAP
>>> >> >> >
>>> >> >> > Christopher Tignor | Senior Software Architect
>>> >> >> > 155 Spring Street NY, NY 10012
>>> >> >> > p.212-285-8600 x385 f.212-285-8999
>>> >> >>
>>> >> >>
>>> >> >>
>>> ---------------------------------------------------------------------
>>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >> >>
>>> >> >>
>>> >> >
>>> >> >
>>> >> > --
>>> >> > TH!NKMAP
>>> >> >
>>> >> > Christopher Tignor | Senior Software Architect
>>> >> > 155 Spring Street NY, NY 10012
>>> >> > p.212-285-8600 x385 f.212-285-8999
>>> >> >
>>> >>
>>> >> ---------------------------------------------------------------------
>>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >>
>>> >>
>>> >
>>> >
>>> > --
>>> > TH!NKMAP
>>> >
>>> > Christopher Tignor | Senior Software Architect
>>> > 155 Spring Street NY, NY 10012
>>> > p.212-285-8600 x385 f.212-285-8999
>>> >
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>>
>> --
>> TH!NKMAP
>>
>> Christopher Tignor | Senior Software Architect
>> 155 Spring Street NY, NY 10012
>> p.212-285-8600 x385 f.212-285-8999
>>
>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>



-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--00235407f00636dc9d0476148b82--

From java-user-return-42897-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 22:53:57 2009
Return-Path: <java-user-return-42897-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9216 invoked from network); 16 Oct 2009 22:53:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 22:53:56 -0000
Received: (qmail 12905 invoked by uid 500); 16 Oct 2009 22:53:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12820 invoked by uid 500); 16 Oct 2009 22:53:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12810 invoked by uid 99); 16 Oct 2009 22:53:54 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 22:53:54 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 22:53:51 +0000
Received: by ywh13 with SMTP id 13so3411653ywh.29
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 15:53:30 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.26.3 with SMTP id 3mr3807533ybz.69.1255733609888; Fri, 16 
	Oct 2009 15:53:29 -0700 (PDT)
In-Reply-To: <6f287d1b0910161501q3ed58173p7270e6f9c0e74f2f@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
	 <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
	 <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
	 <6f287d1b0910161344v4965a3cbq7bba697af44b2106@mail.gmail.com>
	 <6f287d1b0910161501q3ed58173p7270e6f9c0e74f2f@mail.gmail.com>
Date: Fri, 16 Oct 2009 18:53:29 -0400
Message-ID: <9ac0c6aa0910161553n759a94dfm4d15d62bd7bb2836@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I'm glad you worked around it!  But I don't fully understand the
issue.  That doWait is inside a sync(writer) block... if the Future
manages to interrupt it, then that thread will release the lock when
it exits that sync block.

Actually, if the thread was indeed interrupted, you may be hitting this:

    http://issues.apache.org/jira/browse/LUCENE-1573

(which is fixed in 2.9).

Mike

On Fri, Oct 16, 2009 at 6:01 PM, Christopher Tignor
<ctignor@thinkmap.com> wrote:
> I discovered the problem and fixed it's effect on my code:
>
> Using the source for Lucene version 2.4.1,
> in IndexWriter.optimize() there is a call to doWait() on line 2283
> this method attempts to wait for a second in order to give other threads =
it
> has spawned a chance to acquire it's mutex and complete index merges.
> It checks if there are any merges left after it wakes up. =A0if there are=
n't
> int proceeds.
>
> However, using using a Future object associated with this thread and call=
ing
> cancel(true) doesn't allow the Thread to enter into Object.wait() (or the
> executorservice observing this Future immediately wakes it up or somethin=
g)
> so it returns immediately and the thread holding the lock on the IndexWri=
ter
> never sceeds it's lock to threads running a merge.
>
> I re-wrote my code such that it didn't need to call the interruptible
> version of Future.cancel() to solve it, i.e. Future.cancel(false)
>
> thanks,
>
> C>T>
>
> On Fri, Oct 16, 2009 at 4:44 PM, Christopher Tignor <ctignor@thinkmap.com=
>wrote:
>
>> Indeed it looks like the thread running MergerThread started (After pass=
ing
>> off to ConcurentMergeScheduler) by the thread calling IndexWriter.optimi=
ze()
>> is indeed waiting on the mutex for the IndexWriter to be free so it can =
use
>> the object to call mergeInit().
>>
>> The IndexWriter however has entered a synchronized() waiting loop, wakin=
g
>> up every second ( in doWait() ) and checking if there are running merges
>> left - which of course there are as the thread responsible for doing the
>> merging can't get in. =A0Deadlocked stack traces are below:
>>
>> Thread [pool-2-thread-5] (Suspended)
>> =A0 =A0 owns: IndexWriter =A0(id=3D71)
>> =A0 =A0 owns: LuceneResultsPersister =A0(id=3D85)
>> =A0 =A0 IndexWriter.optimize(int, boolean) line: 2283
>> =A0 =A0 IndexWriter.optimize(boolean) line: 2218
>> =A0 =A0 IndexWriter.optimize() line: 2198
>> =A0 =A0 LuceneResultsPersister.commit() line: 97
>> =A0 =A0 PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer=
) line:
>> 105
>> =A0 =A0 PersistenceJobConsumer.consume() line: 46
>> =A0 =A0 PersistenceJobConsumer.run() line: 67
>> =A0 =A0 Executors$RunnableAdapter<T>.call() line: 441
>> =A0 =A0 FutureTask$Sync.innerRun() line: 303
>> =A0 =A0 FutureTask<V>.run() line: 138
>> =A0 =A0 ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>> =A0 =A0 ThreadPoolExecutor$Worker.run() line: 908
>> =A0 =A0 Thread.run() line: 619
>>
>> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>> =A0 =A0 waiting for: IndexWriter =A0(id=3D71)
>> =A0 =A0 IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>> =A0 =A0 IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>> =A0 =A0 ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
>> =A0 =A0 ConcurrentMergeScheduler$MergeThread.run() line: 260
>>
>> I don't really understand how this code is supposed to (and has) worked
>> before this and what the problem thus might be here:
>>
>> In IndexWriter.optimize() at line 2263 we have the synchronized block wh=
ere
>> doWait becomes true using the parameter-less call to optimize():
>>
>> if (doWait) {
>> =A0 =A0 =A0 synchronized(this) {
>> =A0 =A0 =A0 =A0 while(true) {
>> =A0 =A0 =A0 =A0 =A0 if (mergeExceptions.size() > 0) {
>> =A0 =A0 =A0 =A0 =A0 =A0 // Forward any exceptions in background merge
>> =A0 =A0 =A0 =A0 =A0 =A0 // threads to the current thread:
>> =A0 =A0 =A0 =A0 =A0 =A0 final int size =3D mergeExceptions.size();
>> =A0 =A0 =A0 =A0 =A0 =A0 for(int i=3D0;i<size;i++) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 final MergePolicy.OneMerge merge =3D (MergeP=
olicy.OneMerge)
>> mergeExceptions.get(0);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (merge.optimize) {
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 IOException err =3D new IOException("bac=
kground merge hit
>> exception: " + merge.segString(directory));
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 final Throwable t =3D merge.getException=
();
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (t !=3D null)
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 err.initCause(t);
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw err;
>> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 =A0 =A0 }
>>
>> =A0 =A0 =A0 =A0 =A0 if (optimizeMergesPending())
>> =A0 =A0 =A0 =A0 =A0 =A0 doWait();
>> =A0 =A0 =A0 =A0 =A0 else
>> =A0 =A0 =A0 =A0 =A0 =A0 break;
>> =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 }
>>
>> It is holding this lock while the thread it started to do the mergin is
>> trying to call it's mergeInit() method.
>>
>> Any thoughts?
>>
>> thanks,
>>
>> C>T>
>>
>>
>> On Fri, Oct 16, 2009 at 4:11 PM, Christopher Tignor <ctignor@thinkmap.co=
m>wrote:
>>
>>> After tracing through the lucene source more it seems that what is
>>> happening is after I call Future.cancel(true) on my parent thread,
>>> optimize() is called and this method launches it's own thread using a
>>> ConcurrentMergeScheduler$MergeThread to do the actual merging.
>>>
>>> When this Thread comes around to calling mergeInit() on my index writer=
 -
>>> a synchronized method - it hangs. =A0For some reason it seems to no lon=
g have
>>> the mutex perhaps? =A0Trace of this thread's stall below...
>>>
>>> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>>> =A0 =A0 IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>>> =A0 =A0 IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>>> =A0 =A0 ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 20=
5
>>> =A0 =A0 ConcurrentMergeScheduler$MergeThread.run() line: 260
>>>
>>> thanks again,
>>>
>>> C>T>
>>>
>>>
>>>
>>> On Fri, Oct 16, 2009 at 3:53 PM, Michael McCandless <
>>> lucene@mikemccandless.com> wrote:
>>>
>>>> But if the Future.cancel call turns out to be a no-op (simply waits
>>>> instead of interrupting the thread), how could it be that the deadlock
>>>> only happens when you call it? =A0Weird. =A0Are you really sure it's n=
ot
>>>> actually calling Thread.interrupt?
>>>>
>>>> That stack trace looks like a normal "optimize is waiting for the
>>>> background merges to complete". =A0Is it possible your background merg=
es
>>>> are hitting exceptions? =A0You should see them on your error console i=
f
>>>> so...
>>>>
>>>> Mike
>>>>
>>>> On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
>>>> <ctignor@thinkmap.com> wrote:
>>>> > It doesn't look like my Future.cancel(true) is actually interrupting
>>>> the
>>>> > thread. =A0It only does so "if necessary" and in this case seems to =
be
>>>> letting
>>>> > the Thread finish gracefully without need for interruption.
>>>> >
>>>> > The stack trace leading up to the hanging IndexWriter.optimize() met=
hod
>>>> is
>>>> > below, though not terribly useful I imagine. =A0Here only 5 document=
s are
>>>> > trying to be added to an index taking up only 39.2 MB on disk. =A0Ag=
ain
>>>> this
>>>> > deadlocking only happens after I use the Future for this task to can=
cel
>>>> the
>>>> > task...
>>>> >
>>>> > Thread [pool-3-thread-5] (Suspended)
>>>> > =A0 =A0IndexWriter.doWait() line: 4494
>>>> > =A0 =A0IndexWriter.optimize(int, boolean) line: 2283
>>>> > =A0 =A0IndexWriter.optimize(boolean) line: 2218
>>>> > =A0 =A0IndexWriter.optimize() line: 2198
>>>> > =A0 =A0LuceneResultsPersister.commit() line: 97
>>>> > =A0 =A0PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsu=
mer)
>>>> line:
>>>> > 105
>>>> > =A0 =A0PersistenceJobConsumer.consume() line: 46
>>>> > =A0 =A0PersistenceJobConsumer.run() line: 67
>>>> > =A0 =A0Executors$RunnableAdapter<T>.call() line: 441
>>>> > =A0 =A0FutureTask$Sync.innerRun() line: 303
>>>> > =A0 =A0FutureTask<V>.run() line: 138
>>>> > =A0 =A0ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>>>> > =A0 =A0ThreadPoolExecutor$Worker.run() line: 908
>>>> > =A0 =A0Thread.run() line: 619
>>>> >
>>>> > thanks,
>>>> >
>>>> > C>T>
>>>> >
>>>> > On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
>>>> > lucene@mikemccandless.com> wrote:
>>>> >
>>>> >> My guess is it's the invocation of Thread.interrupt (which
>>>> >> Future.cancel(true) calls if the task is running) that lead to the
>>>> >> deadlock.
>>>> >>
>>>> >> Is it possible to get the stack trace of the thrown exception when =
the
>>>> >> thread was interrupted? =A0Maybe indeed something in IW isn't clean=
ing
>>>> >> up its state on being interrupted.
>>>> >>
>>>> >> Mike
>>>> >>
>>>> >> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
>>>> >> <ctignor@thinkmap.com> wrote:
>>>> >> > thanks for getting back.
>>>> >> >
>>>> >> > I do not lock on the IndexWriter object itself but all methods in=
 my
>>>> >> > consumer class that use IndexWriter are synchronized (locking my
>>>> >> singleton
>>>> >> > consumer object itself).
>>>> >> > The thread is waiting at IndexWriter.doWait(). =A0What might cuas=
e
>>>> this?
>>>> >> >
>>>> >> > thanks -
>>>> >> >
>>>> >> > C>T>
>>>> >> >
>>>> >> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de>
>>>> wrote:
>>>> >> >
>>>> >> >> Do you use the IndexWriter as mutex in a synchronized() block? T=
his
>>>> is
>>>> >> not
>>>> >> >> supported and may hang. Never lock on IndexWriter instances.
>>>> IndexWriter
>>>> >> >> itself is thread safe.
>>>> >> >>
>>>> >> >> -----
>>>> >> >> Uwe Schindler
>>>> >> >> H.-H.-Meier-Allee 63, D-28213 Bremen
>>>> >> >> http://www.thetaphi.de
>>>> >> >> eMail: uwe@thetaphi.de
>>>> >> >>
>>>> >> >> > -----Original Message-----
>>>> >> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
>>>> >> >> > Sent: Friday, October 16, 2009 6:50 PM
>>>> >> >> > To: java-user
>>>> >> >> > Subject: IndexWriter optimize() deadlock
>>>> >> >> >
>>>> >> >> > Hello,
>>>> >> >> >
>>>> >> >> > I am trying to track down the cause of my code hanging on call=
ing
>>>> >> >> > IndexWriter.optimize() at its doWait() method.
>>>> >> >> > It appears, thus that it is watiing on other merges to happen
>>>> which is
>>>> >> a
>>>> >> >> > bit
>>>> >> >> > confusing to me:
>>>> >> >> >
>>>> >> >> > My application is a simple producer consumer model where
>>>> documents are
>>>> >> >> > added
>>>> >> >> > to a queue by producers and then one consumer with one
>>>> indexwriter
>>>> >> (the
>>>> >> >> > only
>>>> >> >> > in the application) periodically calls addDocument() on a batc=
h
>>>> of
>>>> >> these
>>>> >> >> > jobs and then calls optimize(), commit(). and then close().
>>>> =A0There is
>>>> >> >> only
>>>> >> >> > one thread running the consumer so I am confused as to how the
>>>> >> >> indexwriter
>>>> >> >> > might be deadlocking itself. =A0Indeed this is the only thread
>>>> active
>>>> >> when
>>>> >> >> > the
>>>> >> >> > deadlock occurs so it seems to be a problem of reentry.
>>>> >> >> >
>>>> >> >> > Importantly, the deadlocking occurs only when the thread is
>>>> trying to
>>>> >> >> > shutdown - that is the Thread running this lucene consumer has=
 a
>>>> >> Future
>>>> >> >> > that
>>>> >> >> > has had its cancel(true) interrupting method called. =A0Is it
>>>> possible
>>>> >> that
>>>> >> >> > an
>>>> >> >> > internal Lucene lock is obtained during addDocument() and on
>>>> >> interruption
>>>> >> >> > is
>>>> >> >> > never released so the subsequent optimize() call hangs? =A0Thi=
s
>>>> doesn't
>>>> >> >> > appear
>>>> >> >> > to be happening...
>>>> >> >> >
>>>> >> >> > Any help appreciated.
>>>> >> >> >
>>>> >> >> > thanks,
>>>> >> >> >
>>>> >> >> > C>T>
>>>> >> >> >
>>>> >> >> > what might I be missing here?
>>>> >> >> >
>>>> >> >> > --
>>>> >> >> > TH!NKMAP
>>>> >> >> >
>>>> >> >> > Christopher Tignor | Senior Software Architect
>>>> >> >> > 155 Spring Street NY, NY 10012
>>>> >> >> > p.212-285-8600 x385 f.212-285-8999
>>>> >> >>
>>>> >> >>
>>>> >> >>
>>>> ---------------------------------------------------------------------
>>>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> >> >> For additional commands, e-mail: java-user-help@lucene.apache.or=
g
>>>> >> >>
>>>> >> >>
>>>> >> >
>>>> >> >
>>>> >> > --
>>>> >> > TH!NKMAP
>>>> >> >
>>>> >> > Christopher Tignor | Senior Software Architect
>>>> >> > 155 Spring Street NY, NY 10012
>>>> >> > p.212-285-8600 x385 f.212-285-8999
>>>> >> >
>>>> >>
>>>> >> -------------------------------------------------------------------=
--
>>>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>> >>
>>>> >>
>>>> >
>>>> >
>>>> > --
>>>> > TH!NKMAP
>>>> >
>>>> > Christopher Tignor | Senior Software Architect
>>>> > 155 Spring Street NY, NY 10012
>>>> > p.212-285-8600 x385 f.212-285-8999
>>>> >
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>>
>>> --
>>> TH!NKMAP
>>>
>>> Christopher Tignor | Senior Software Architect
>>> 155 Spring Street NY, NY 10012
>>> p.212-285-8600 x385 f.212-285-8999
>>>
>>
>>
>>
>> --
>> TH!NKMAP
>>
>> Christopher Tignor | Senior Software Architect
>> 155 Spring Street NY, NY 10012
>> p.212-285-8600 x385 f.212-285-8999
>>
>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42898-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 16 23:12:21 2009
Return-Path: <java-user-return-42898-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12756 invoked from network); 16 Oct 2009 23:12:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 16 Oct 2009 23:12:21 -0000
Received: (qmail 25152 invoked by uid 500); 16 Oct 2009 23:12:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25074 invoked by uid 500); 16 Oct 2009 23:12:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25064 invoked by uid 99); 16 Oct 2009 23:12:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 23:12:19 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ctignor@thinkmap.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 16 Oct 2009 23:12:07 +0000
Received: by fxm12 with SMTP id 12so3165671fxm.5
        for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 16:11:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.223.5.77 with SMTP id 13mr429525fau.86.1255734706730; Fri, 16 
	Oct 2009 16:11:46 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910161553n759a94dfm4d15d62bd7bb2836@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <016F3AEABE394A13A95BCF749F7445BC@VEGA>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
	 <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
	 <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
	 <6f287d1b0910161344v4965a3cbq7bba697af44b2106@mail.gmail.com>
	 <6f287d1b0910161501q3ed58173p7270e6f9c0e74f2f@mail.gmail.com>
	 <9ac0c6aa0910161553n759a94dfm4d15d62bd7bb2836@mail.gmail.com>
Date: Fri, 16 Oct 2009 19:11:46 -0400
Message-ID: <6f287d1b0910161611t43cf39e2yb4d71e85c1e80bd2@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Christopher Tignor <ctignor@thinkmap.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517478d8020787704761585ab
X-Virus-Checked: Checked by ClamAV on apache.org

--001517478d8020787704761585ab
Content-Type: text/plain; charset=ISO-8859-1

the doWait() call is synchronized on IndexWriter but it is also, as you
suggest in a loop in a block synchronized on IndexWriter.

The doWait() call returns immediately, still holding the IndexWriter lock
from the loop in the synchornized block as my stack trace shows, without
blocking and giving the merger thread a chance to merge.  It keeps repeating
this doWait procedure which unfortunately never actually waits and the
MergerThread is starved....

C>T>

On Fri, Oct 16, 2009 at 6:53 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> I'm glad you worked around it!  But I don't fully understand the
> issue.  That doWait is inside a sync(writer) block... if the Future
> manages to interrupt it, then that thread will release the lock when
> it exits that sync block.
>
> Actually, if the thread was indeed interrupted, you may be hitting this:
>
>    http://issues.apache.org/jira/browse/LUCENE-1573
>
> (which is fixed in 2.9).
>
> Mike
>
> On Fri, Oct 16, 2009 at 6:01 PM, Christopher Tignor
> <ctignor@thinkmap.com> wrote:
> > I discovered the problem and fixed it's effect on my code:
> >
> > Using the source for Lucene version 2.4.1,
> > in IndexWriter.optimize() there is a call to doWait() on line 2283
> > this method attempts to wait for a second in order to give other threads
> it
> > has spawned a chance to acquire it's mutex and complete index merges.
> > It checks if there are any merges left after it wakes up.  if there
> aren't
> > int proceeds.
> >
> > However, using using a Future object associated with this thread and
> calling
> > cancel(true) doesn't allow the Thread to enter into Object.wait() (or the
> > executorservice observing this Future immediately wakes it up or
> something)
> > so it returns immediately and the thread holding the lock on the
> IndexWriter
> > never sceeds it's lock to threads running a merge.
> >
> > I re-wrote my code such that it didn't need to call the interruptible
> > version of Future.cancel() to solve it, i.e. Future.cancel(false)
> >
> > thanks,
> >
> > C>T>
> >
> > On Fri, Oct 16, 2009 at 4:44 PM, Christopher Tignor <
> ctignor@thinkmap.com>wrote:
> >
> >> Indeed it looks like the thread running MergerThread started (After
> passing
> >> off to ConcurentMergeScheduler) by the thread calling
> IndexWriter.optimize()
> >> is indeed waiting on the mutex for the IndexWriter to be free so it can
> use
> >> the object to call mergeInit().
> >>
> >> The IndexWriter however has entered a synchronized() waiting loop,
> waking
> >> up every second ( in doWait() ) and checking if there are running merges
> >> left - which of course there are as the thread responsible for doing the
> >> merging can't get in.  Deadlocked stack traces are below:
> >>
> >> Thread [pool-2-thread-5] (Suspended)
> >>     owns: IndexWriter  (id=71)
> >>     owns: LuceneResultsPersister  (id=85)
> >>     IndexWriter.optimize(int, boolean) line: 2283
> >>     IndexWriter.optimize(boolean) line: 2218
> >>     IndexWriter.optimize() line: 2198
> >>     LuceneResultsPersister.commit() line: 97
> >>     PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer)
> line:
> >> 105
> >>     PersistenceJobConsumer.consume() line: 46
> >>     PersistenceJobConsumer.run() line: 67
> >>     Executors$RunnableAdapter<T>.call() line: 441
> >>     FutureTask$Sync.innerRun() line: 303
> >>     FutureTask<V>.run() line: 138
> >>     ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
> >>     ThreadPoolExecutor$Worker.run() line: 908
> >>     Thread.run() line: 619
> >>
> >> Daemon Thread [Lucene Merge Thread #0] (Suspended)
> >>     waiting for: IndexWriter  (id=71)
> >>     IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
> >>     IndexWriter.merge(MergePolicy$OneMerge) line: 3879
> >>     ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
> >>     ConcurrentMergeScheduler$MergeThread.run() line: 260
> >>
> >> I don't really understand how this code is supposed to (and has) worked
> >> before this and what the problem thus might be here:
> >>
> >> In IndexWriter.optimize() at line 2263 we have the synchronized block
> where
> >> doWait becomes true using the parameter-less call to optimize():
> >>
> >> if (doWait) {
> >>       synchronized(this) {
> >>         while(true) {
> >>           if (mergeExceptions.size() > 0) {
> >>             // Forward any exceptions in background merge
> >>             // threads to the current thread:
> >>             final int size = mergeExceptions.size();
> >>             for(int i=0;i<size;i++) {
> >>               final MergePolicy.OneMerge merge = (MergePolicy.OneMerge)
> >> mergeExceptions.get(0);
> >>               if (merge.optimize) {
> >>                 IOException err = new IOException("background merge hit
> >> exception: " + merge.segString(directory));
> >>                 final Throwable t = merge.getException();
> >>                 if (t != null)
> >>                   err.initCause(t);
> >>                 throw err;
> >>               }
> >>             }
> >>           }
> >>
> >>           if (optimizeMergesPending())
> >>             doWait();
> >>           else
> >>             break;
> >>         }
> >>       }
> >>
> >> It is holding this lock while the thread it started to do the mergin is
> >> trying to call it's mergeInit() method.
> >>
> >> Any thoughts?
> >>
> >> thanks,
> >>
> >> C>T>
> >>
> >>
> >> On Fri, Oct 16, 2009 at 4:11 PM, Christopher Tignor <
> ctignor@thinkmap.com>wrote:
> >>
> >>> After tracing through the lucene source more it seems that what is
> >>> happening is after I call Future.cancel(true) on my parent thread,
> >>> optimize() is called and this method launches it's own thread using a
> >>> ConcurrentMergeScheduler$MergeThread to do the actual merging.
> >>>
> >>> When this Thread comes around to calling mergeInit() on my index writer
> -
> >>> a synchronized method - it hangs.  For some reason it seems to no long
> have
> >>> the mutex perhaps?  Trace of this thread's stall below...
> >>>
> >>> Daemon Thread [Lucene Merge Thread #0] (Suspended)
> >>>     IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
> >>>     IndexWriter.merge(MergePolicy$OneMerge) line: 3879
> >>>     ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: 205
> >>>     ConcurrentMergeScheduler$MergeThread.run() line: 260
> >>>
> >>> thanks again,
> >>>
> >>> C>T>
> >>>
> >>>
> >>>
> >>> On Fri, Oct 16, 2009 at 3:53 PM, Michael McCandless <
> >>> lucene@mikemccandless.com> wrote:
> >>>
> >>>> But if the Future.cancel call turns out to be a no-op (simply waits
> >>>> instead of interrupting the thread), how could it be that the deadlock
> >>>> only happens when you call it?  Weird.  Are you really sure it's not
> >>>> actually calling Thread.interrupt?
> >>>>
> >>>> That stack trace looks like a normal "optimize is waiting for the
> >>>> background merges to complete".  Is it possible your background merges
> >>>> are hitting exceptions?  You should see them on your error console if
> >>>> so...
> >>>>
> >>>> Mike
> >>>>
> >>>> On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
> >>>> <ctignor@thinkmap.com> wrote:
> >>>> > It doesn't look like my Future.cancel(true) is actually interrupting
> >>>> the
> >>>> > thread.  It only does so "if necessary" and in this case seems to be
> >>>> letting
> >>>> > the Thread finish gracefully without need for interruption.
> >>>> >
> >>>> > The stack trace leading up to the hanging IndexWriter.optimize()
> method
> >>>> is
> >>>> > below, though not terribly useful I imagine.  Here only 5 documents
> are
> >>>> > trying to be added to an index taking up only 39.2 MB on disk.
>  Again
> >>>> this
> >>>> > deadlocking only happens after I use the Future for this task to
> cancel
> >>>> the
> >>>> > task...
> >>>> >
> >>>> > Thread [pool-3-thread-5] (Suspended)
> >>>> >    IndexWriter.doWait() line: 4494
> >>>> >    IndexWriter.optimize(int, boolean) line: 2283
> >>>> >    IndexWriter.optimize(boolean) line: 2218
> >>>> >    IndexWriter.optimize() line: 2198
> >>>> >    LuceneResultsPersister.commit() line: 97
> >>>> >    PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsumer)
> >>>> line:
> >>>> > 105
> >>>> >    PersistenceJobConsumer.consume() line: 46
> >>>> >    PersistenceJobConsumer.run() line: 67
> >>>> >    Executors$RunnableAdapter<T>.call() line: 441
> >>>> >    FutureTask$Sync.innerRun() line: 303
> >>>> >    FutureTask<V>.run() line: 138
> >>>> >    ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
> >>>> >    ThreadPoolExecutor$Worker.run() line: 908
> >>>> >    Thread.run() line: 619
> >>>> >
> >>>> > thanks,
> >>>> >
> >>>> > C>T>
> >>>> >
> >>>> > On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
> >>>> > lucene@mikemccandless.com> wrote:
> >>>> >
> >>>> >> My guess is it's the invocation of Thread.interrupt (which
> >>>> >> Future.cancel(true) calls if the task is running) that lead to the
> >>>> >> deadlock.
> >>>> >>
> >>>> >> Is it possible to get the stack trace of the thrown exception when
> the
> >>>> >> thread was interrupted?  Maybe indeed something in IW isn't
> cleaning
> >>>> >> up its state on being interrupted.
> >>>> >>
> >>>> >> Mike
> >>>> >>
> >>>> >> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
> >>>> >> <ctignor@thinkmap.com> wrote:
> >>>> >> > thanks for getting back.
> >>>> >> >
> >>>> >> > I do not lock on the IndexWriter object itself but all methods in
> my
> >>>> >> > consumer class that use IndexWriter are synchronized (locking my
> >>>> >> singleton
> >>>> >> > consumer object itself).
> >>>> >> > The thread is waiting at IndexWriter.doWait().  What might cuase
> >>>> this?
> >>>> >> >
> >>>> >> > thanks -
> >>>> >> >
> >>>> >> > C>T>
> >>>> >> >
> >>>> >> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.de
> >
> >>>> wrote:
> >>>> >> >
> >>>> >> >> Do you use the IndexWriter as mutex in a synchronized() block?
> This
> >>>> is
> >>>> >> not
> >>>> >> >> supported and may hang. Never lock on IndexWriter instances.
> >>>> IndexWriter
> >>>> >> >> itself is thread safe.
> >>>> >> >>
> >>>> >> >> -----
> >>>> >> >> Uwe Schindler
> >>>> >> >> H.-H.-Meier-Allee 63, D-28213 Bremen
> >>>> >> >> http://www.thetaphi.de
> >>>> >> >> eMail: uwe@thetaphi.de
> >>>> >> >>
> >>>> >> >> > -----Original Message-----
> >>>> >> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
> >>>> >> >> > Sent: Friday, October 16, 2009 6:50 PM
> >>>> >> >> > To: java-user
> >>>> >> >> > Subject: IndexWriter optimize() deadlock
> >>>> >> >> >
> >>>> >> >> > Hello,
> >>>> >> >> >
> >>>> >> >> > I am trying to track down the cause of my code hanging on
> calling
> >>>> >> >> > IndexWriter.optimize() at its doWait() method.
> >>>> >> >> > It appears, thus that it is watiing on other merges to happen
> >>>> which is
> >>>> >> a
> >>>> >> >> > bit
> >>>> >> >> > confusing to me:
> >>>> >> >> >
> >>>> >> >> > My application is a simple producer consumer model where
> >>>> documents are
> >>>> >> >> > added
> >>>> >> >> > to a queue by producers and then one consumer with one
> >>>> indexwriter
> >>>> >> (the
> >>>> >> >> > only
> >>>> >> >> > in the application) periodically calls addDocument() on a
> batch
> >>>> of
> >>>> >> these
> >>>> >> >> > jobs and then calls optimize(), commit(). and then close().
> >>>>  There is
> >>>> >> >> only
> >>>> >> >> > one thread running the consumer so I am confused as to how the
> >>>> >> >> indexwriter
> >>>> >> >> > might be deadlocking itself.  Indeed this is the only thread
> >>>> active
> >>>> >> when
> >>>> >> >> > the
> >>>> >> >> > deadlock occurs so it seems to be a problem of reentry.
> >>>> >> >> >
> >>>> >> >> > Importantly, the deadlocking occurs only when the thread is
> >>>> trying to
> >>>> >> >> > shutdown - that is the Thread running this lucene consumer has
> a
> >>>> >> Future
> >>>> >> >> > that
> >>>> >> >> > has had its cancel(true) interrupting method called.  Is it
> >>>> possible
> >>>> >> that
> >>>> >> >> > an
> >>>> >> >> > internal Lucene lock is obtained during addDocument() and on
> >>>> >> interruption
> >>>> >> >> > is
> >>>> >> >> > never released so the subsequent optimize() call hangs?  This
> >>>> doesn't
> >>>> >> >> > appear
> >>>> >> >> > to be happening...
> >>>> >> >> >
> >>>> >> >> > Any help appreciated.
> >>>> >> >> >
> >>>> >> >> > thanks,
> >>>> >> >> >
> >>>> >> >> > C>T>
> >>>> >> >> >
> >>>> >> >> > what might I be missing here?
> >>>> >> >> >
> >>>> >> >> > --
> >>>> >> >> > TH!NKMAP
> >>>> >> >> >
> >>>> >> >> > Christopher Tignor | Senior Software Architect
> >>>> >> >> > 155 Spring Street NY, NY 10012
> >>>> >> >> > p.212-285-8600 x385 f.212-285-8999
> >>>> >> >>
> >>>> >> >>
> >>>> >> >>
> >>>> ---------------------------------------------------------------------
> >>>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>> >> >> For additional commands, e-mail:
> java-user-help@lucene.apache.org
> >>>> >> >>
> >>>> >> >>
> >>>> >> >
> >>>> >> >
> >>>> >> > --
> >>>> >> > TH!NKMAP
> >>>> >> >
> >>>> >> > Christopher Tignor | Senior Software Architect
> >>>> >> > 155 Spring Street NY, NY 10012
> >>>> >> > p.212-285-8600 x385 f.212-285-8999
> >>>> >> >
> >>>> >>
> >>>> >>
> ---------------------------------------------------------------------
> >>>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>> >>
> >>>> >>
> >>>> >
> >>>> >
> >>>> > --
> >>>> > TH!NKMAP
> >>>> >
> >>>> > Christopher Tignor | Senior Software Architect
> >>>> > 155 Spring Street NY, NY 10012
> >>>> > p.212-285-8600 x385 f.212-285-8999
> >>>> >
> >>>>
> >>>> ---------------------------------------------------------------------
> >>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>
> >>>>
> >>>
> >>>
> >>> --
> >>> TH!NKMAP
> >>>
> >>> Christopher Tignor | Senior Software Architect
> >>> 155 Spring Street NY, NY 10012
> >>> p.212-285-8600 x385 f.212-285-8999
> >>>
> >>
> >>
> >>
> >> --
> >> TH!NKMAP
> >>
> >> Christopher Tignor | Senior Software Architect
> >> 155 Spring Street NY, NY 10012
> >> p.212-285-8600 x385 f.212-285-8999
> >>
> >
> >
> >
> > --
> > TH!NKMAP
> >
> > Christopher Tignor | Senior Software Architect
> > 155 Spring Street NY, NY 10012
> > p.212-285-8600 x385 f.212-285-8999
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
TH!NKMAP

Christopher Tignor | Senior Software Architect
155 Spring Street NY, NY 10012
p.212-285-8600 x385 f.212-285-8999

--001517478d8020787704761585ab--

From java-user-return-42899-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 03:28:22 2009
Return-Path: <java-user-return-42899-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68217 invoked from network); 17 Oct 2009 03:28:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 03:28:22 -0000
Received: (qmail 31199 invoked by uid 500); 17 Oct 2009 03:28:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31076 invoked by uid 500); 17 Oct 2009 03:28:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31066 invoked by uid 99); 17 Oct 2009 03:28:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 03:28:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 03:28:11 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id C7A7971C9E4; Fri, 16 Oct 2009 20:27:50 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id C5EF771C9CC
	for <java-user@lucene.apache.org>; Fri, 16 Oct 2009 20:27:50 -0700 (PDT)
Date: Fri, 16 Oct 2009 20:27:50 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: OpenRelevance
In-Reply-To: <56480E80-2193-4B67-8C50-C4CE9DBFA44F@apache.org>
Message-ID: <Pine.LNX.4.64.0910162010500.20769@radix.cryptio.net>
References: <786734.96908.qm@web52910.mail.re2.yahoo.com>
 <56480E80-2193-4B67-8C50-C4CE9DBFA44F@apache.org>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org

: Sorry, Open Relevance Project

More specificly...
	http://lucene.apache.org/openrelevance/


Omar: I've updated the old wiki page you found to make it clear that the 
proposal has moved forward and is already a real sub-project...

: > > > I would like to know if people are interested in the
: > > OpenRelevance project (http://wiki.apache.org/lucene-java/OpenRelevance).



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42900-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 08:00:36 2009
Return-Path: <java-user-return-42900-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22831 invoked from network); 17 Oct 2009 08:00:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 08:00:36 -0000
Received: (qmail 28781 invoked by uid 500); 17 Oct 2009 08:00:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28700 invoked by uid 500); 17 Oct 2009 08:00:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28689 invoked by uid 99); 17 Oct 2009 08:00:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 08:00:33 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jukka.zitting@gmail.com designates 209.85.217.226 as permitted sender)
Received: from [209.85.217.226] (HELO mail-gx0-f226.google.com) (209.85.217.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 08:00:31 +0000
Received: by gxk26 with SMTP id 26so368410gxk.11
        for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 01:00:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=XNS/8fCiXhyPBQA4fMeB0LI5xBpozsocrR+Lw52nbLY=;
        b=e6CQn0aGNmO6zMv+C5pDAUB+H3moh1sxLbj1Pw3oJb4fU6PvHgdrvERDY1FFjGfEoP
         CLXyk5U/8E9ZBY72o8GWccsOt9OkqoxP1DC5e5RyZONaSsfPNo3bXxvXj3V71dTh7xiX
         MQLfQwTU3voebQGqqdU1kI+O+RvMrYsYgovWE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=ZXpBQsvn9tAP1ihGkoh/hMQADXHpQ+7ARdw5rAY00LsTPV2bExYyRjNp5F4uZyndTG
         SKkGBLd3s86mjs51O7CQ7bGwfMhNmYvV3T39HySXvmz5PSQdjEAkINrxdTq0vJzDPAzp
         PVNQzQTKbvorN3Ba5T8QcUnOweheMdy1/27AM=
MIME-Version: 1.0
Received: by 10.101.191.17 with SMTP id t17mr2816045anp.87.1255766410011; Sat, 
	17 Oct 2009 01:00:10 -0700 (PDT)
In-Reply-To: <D3FE8CCE-74D1-4075-A28A-EF4E1E2E8D18@apache.org>
References: <510143ac0910160054y645ef6je4e51c4104cf361c@mail.gmail.com> 
	<D3FE8CCE-74D1-4075-A28A-EF4E1E2E8D18@apache.org>
From: Jukka Zitting <jukka.zitting@gmail.com>
Date: Sat, 17 Oct 2009 09:59:49 +0200
Message-ID: <510143ac0910170059x4bd95f34ye89c81e0a349776a@mail.gmail.com>
Subject: Re: JDBC access to a Lucene index
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hi,

On Fri, Oct 16, 2009 at 9:12 PM, Grant Ingersoll <gsingers@apache.org> wrote:
> I'm not aware of any, but you might get more mileage asking on java-user.

You're right, poor original choice of list from me.

java-users@, here's my question from java-dev@:

Some while ago I implemented a simple JDBC to JCR bridge [1] that
allows one to query a JCR repository from any JDBC client, most
notably various reporting tools.

Now I'm wondering if something similar already exists for a normal
Lucene index. Something that would treat your entire index as one huge
table (or perhaps a set of tables based on some document type field)
and would allow you to use simple SQL SELECTs to query data.

Any pointers would be welcome. If this hasn't already been done, would
there be interest in such a JDBC driver for Lucene?

[1] http://dev.day.com/microsling/content/blogs/main/jdbc2jcr.html

BR,

Jukka Zitting

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42901-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 09:02:47 2009
Return-Path: <java-user-return-42901-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36979 invoked from network); 17 Oct 2009 09:02:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 09:02:47 -0000
Received: (qmail 56007 invoked by uid 500); 17 Oct 2009 09:02:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55929 invoked by uid 500); 17 Oct 2009 09:02:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55919 invoked by uid 99); 17 Oct 2009 09:02:44 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 09:02:44 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 09:02:33 +0000
Received: by gxk19 with SMTP id 19so2823284gxk.5
        for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 02:02:12 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.174.6 with SMTP id w6mr4309510ybe.329.1255770131951; Sat, 
	17 Oct 2009 02:02:11 -0700 (PDT)
In-Reply-To: <6f287d1b0910161611t43cf39e2yb4d71e85c1e80bd2@mail.gmail.com>
References: <6f287d1b0910160949te8bb4a9xaa6815c6ca936eca@mail.gmail.com>
	 <6f287d1b0910161043j2db75e83u1b12a7dfc2ddd07f@mail.gmail.com>
	 <9ac0c6aa0910161058t4d306d24m3a5c4dabe3b5b39e@mail.gmail.com>
	 <6f287d1b0910161217j7b6a2772u388edfa199da97f@mail.gmail.com>
	 <9ac0c6aa0910161253r7069f53ej23d1e514df789672@mail.gmail.com>
	 <6f287d1b0910161311h1f1c32edrafc70d20a1360ac6@mail.gmail.com>
	 <6f287d1b0910161344v4965a3cbq7bba697af44b2106@mail.gmail.com>
	 <6f287d1b0910161501q3ed58173p7270e6f9c0e74f2f@mail.gmail.com>
	 <9ac0c6aa0910161553n759a94dfm4d15d62bd7bb2836@mail.gmail.com>
	 <6f287d1b0910161611t43cf39e2yb4d71e85c1e80bd2@mail.gmail.com>
Date: Sat, 17 Oct 2009 05:02:10 -0400
Message-ID: <9ac0c6aa0910170202l3226257iebc1df7211c4dcf1@mail.gmail.com>
Subject: Re: IndexWriter optimize() deadlock
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

OK then this is exactly what was happening with LUCENE-1573 -- Lucene
was not properly handling the interrupt request, and instead of
throwing an exception, entered a spin loop that starves the merge
threads.

Can you try 2.9.0 (and turn back on your Future.cancel(true) call) and
see if it's fixed?

Mike

On Fri, Oct 16, 2009 at 7:11 PM, Christopher Tignor
<ctignor@thinkmap.com> wrote:
> the doWait() call is synchronized on IndexWriter but it is also, as you
> suggest in a loop in a block synchronized on IndexWriter.
>
> The doWait() call returns immediately, still holding the IndexWriter lock
> from the loop in the synchornized block as my stack trace shows, without
> blocking and giving the merger thread a chance to merge. =A0It keeps repe=
ating
> this doWait procedure which unfortunately never actually waits and the
> MergerThread is starved....
>
> C>T>
>
> On Fri, Oct 16, 2009 at 6:53 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> I'm glad you worked around it! =A0But I don't fully understand the
>> issue. =A0That doWait is inside a sync(writer) block... if the Future
>> manages to interrupt it, then that thread will release the lock when
>> it exits that sync block.
>>
>> Actually, if the thread was indeed interrupted, you may be hitting this:
>>
>> =A0 =A0http://issues.apache.org/jira/browse/LUCENE-1573
>>
>> (which is fixed in 2.9).
>>
>> Mike
>>
>> On Fri, Oct 16, 2009 at 6:01 PM, Christopher Tignor
>> <ctignor@thinkmap.com> wrote:
>> > I discovered the problem and fixed it's effect on my code:
>> >
>> > Using the source for Lucene version 2.4.1,
>> > in IndexWriter.optimize() there is a call to doWait() on line 2283
>> > this method attempts to wait for a second in order to give other threa=
ds
>> it
>> > has spawned a chance to acquire it's mutex and complete index merges.
>> > It checks if there are any merges left after it wakes up. =A0if there
>> aren't
>> > int proceeds.
>> >
>> > However, using using a Future object associated with this thread and
>> calling
>> > cancel(true) doesn't allow the Thread to enter into Object.wait() (or =
the
>> > executorservice observing this Future immediately wakes it up or
>> something)
>> > so it returns immediately and the thread holding the lock on the
>> IndexWriter
>> > never sceeds it's lock to threads running a merge.
>> >
>> > I re-wrote my code such that it didn't need to call the interruptible
>> > version of Future.cancel() to solve it, i.e. Future.cancel(false)
>> >
>> > thanks,
>> >
>> > C>T>
>> >
>> > On Fri, Oct 16, 2009 at 4:44 PM, Christopher Tignor <
>> ctignor@thinkmap.com>wrote:
>> >
>> >> Indeed it looks like the thread running MergerThread started (After
>> passing
>> >> off to ConcurentMergeScheduler) by the thread calling
>> IndexWriter.optimize()
>> >> is indeed waiting on the mutex for the IndexWriter to be free so it c=
an
>> use
>> >> the object to call mergeInit().
>> >>
>> >> The IndexWriter however has entered a synchronized() waiting loop,
>> waking
>> >> up every second ( in doWait() ) and checking if there are running mer=
ges
>> >> left - which of course there are as the thread responsible for doing =
the
>> >> merging can't get in. =A0Deadlocked stack traces are below:
>> >>
>> >> Thread [pool-2-thread-5] (Suspended)
>> >> =A0 =A0 owns: IndexWriter =A0(id=3D71)
>> >> =A0 =A0 owns: LuceneResultsPersister =A0(id=3D85)
>> >> =A0 =A0 IndexWriter.optimize(int, boolean) line: 2283
>> >> =A0 =A0 IndexWriter.optimize(boolean) line: 2218
>> >> =A0 =A0 IndexWriter.optimize() line: 2198
>> >> =A0 =A0 LuceneResultsPersister.commit() line: 97
>> >> =A0 =A0 PersistenceJobQueue.persistAndCommitBatch(PersistenceJobConsu=
mer)
>> line:
>> >> 105
>> >> =A0 =A0 PersistenceJobConsumer.consume() line: 46
>> >> =A0 =A0 PersistenceJobConsumer.run() line: 67
>> >> =A0 =A0 Executors$RunnableAdapter<T>.call() line: 441
>> >> =A0 =A0 FutureTask$Sync.innerRun() line: 303
>> >> =A0 =A0 FutureTask<V>.run() line: 138
>> >> =A0 =A0 ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>> >> =A0 =A0 ThreadPoolExecutor$Worker.run() line: 908
>> >> =A0 =A0 Thread.run() line: 619
>> >>
>> >> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>> >> =A0 =A0 waiting for: IndexWriter =A0(id=3D71)
>> >> =A0 =A0 IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>> >> =A0 =A0 IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>> >> =A0 =A0 ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line: =
205
>> >> =A0 =A0 ConcurrentMergeScheduler$MergeThread.run() line: 260
>> >>
>> >> I don't really understand how this code is supposed to (and has) work=
ed
>> >> before this and what the problem thus might be here:
>> >>
>> >> In IndexWriter.optimize() at line 2263 we have the synchronized block
>> where
>> >> doWait becomes true using the parameter-less call to optimize():
>> >>
>> >> if (doWait) {
>> >> =A0 =A0 =A0 synchronized(this) {
>> >> =A0 =A0 =A0 =A0 while(true) {
>> >> =A0 =A0 =A0 =A0 =A0 if (mergeExceptions.size() > 0) {
>> >> =A0 =A0 =A0 =A0 =A0 =A0 // Forward any exceptions in background merge
>> >> =A0 =A0 =A0 =A0 =A0 =A0 // threads to the current thread:
>> >> =A0 =A0 =A0 =A0 =A0 =A0 final int size =3D mergeExceptions.size();
>> >> =A0 =A0 =A0 =A0 =A0 =A0 for(int i=3D0;i<size;i++) {
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 final MergePolicy.OneMerge merge =3D (Mer=
gePolicy.OneMerge)
>> >> mergeExceptions.get(0);
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (merge.optimize) {
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 IOException err =3D new IOException("=
background merge hit
>> >> exception: " + merge.segString(directory));
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 final Throwable t =3D merge.getExcept=
ion();
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (t !=3D null)
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 err.initCause(t);
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw err;
>> >> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>> >> =A0 =A0 =A0 =A0 =A0 =A0 }
>> >> =A0 =A0 =A0 =A0 =A0 }
>> >>
>> >> =A0 =A0 =A0 =A0 =A0 if (optimizeMergesPending())
>> >> =A0 =A0 =A0 =A0 =A0 =A0 doWait();
>> >> =A0 =A0 =A0 =A0 =A0 else
>> >> =A0 =A0 =A0 =A0 =A0 =A0 break;
>> >> =A0 =A0 =A0 =A0 }
>> >> =A0 =A0 =A0 }
>> >>
>> >> It is holding this lock while the thread it started to do the mergin =
is
>> >> trying to call it's mergeInit() method.
>> >>
>> >> Any thoughts?
>> >>
>> >> thanks,
>> >>
>> >> C>T>
>> >>
>> >>
>> >> On Fri, Oct 16, 2009 at 4:11 PM, Christopher Tignor <
>> ctignor@thinkmap.com>wrote:
>> >>
>> >>> After tracing through the lucene source more it seems that what is
>> >>> happening is after I call Future.cancel(true) on my parent thread,
>> >>> optimize() is called and this method launches it's own thread using =
a
>> >>> ConcurrentMergeScheduler$MergeThread to do the actual merging.
>> >>>
>> >>> When this Thread comes around to calling mergeInit() on my index wri=
ter
>> -
>> >>> a synchronized method - it hangs. =A0For some reason it seems to no =
long
>> have
>> >>> the mutex perhaps? =A0Trace of this thread's stall below...
>> >>>
>> >>> Daemon Thread [Lucene Merge Thread #0] (Suspended)
>> >>> =A0 =A0 IndexWriter.mergeInit(MergePolicy$OneMerge) line: 3971
>> >>> =A0 =A0 IndexWriter.merge(MergePolicy$OneMerge) line: 3879
>> >>> =A0 =A0 ConcurrentMergeScheduler.doMerge(MergePolicy$OneMerge) line:=
 205
>> >>> =A0 =A0 ConcurrentMergeScheduler$MergeThread.run() line: 260
>> >>>
>> >>> thanks again,
>> >>>
>> >>> C>T>
>> >>>
>> >>>
>> >>>
>> >>> On Fri, Oct 16, 2009 at 3:53 PM, Michael McCandless <
>> >>> lucene@mikemccandless.com> wrote:
>> >>>
>> >>>> But if the Future.cancel call turns out to be a no-op (simply waits
>> >>>> instead of interrupting the thread), how could it be that the deadl=
ock
>> >>>> only happens when you call it? =A0Weird. =A0Are you really sure it'=
s not
>> >>>> actually calling Thread.interrupt?
>> >>>>
>> >>>> That stack trace looks like a normal "optimize is waiting for the
>> >>>> background merges to complete". =A0Is it possible your background m=
erges
>> >>>> are hitting exceptions? =A0You should see them on your error consol=
e if
>> >>>> so...
>> >>>>
>> >>>> Mike
>> >>>>
>> >>>> On Fri, Oct 16, 2009 at 3:17 PM, Christopher Tignor
>> >>>> <ctignor@thinkmap.com> wrote:
>> >>>> > It doesn't look like my Future.cancel(true) is actually interrupt=
ing
>> >>>> the
>> >>>> > thread. =A0It only does so "if necessary" and in this case seems =
to be
>> >>>> letting
>> >>>> > the Thread finish gracefully without need for interruption.
>> >>>> >
>> >>>> > The stack trace leading up to the hanging IndexWriter.optimize()
>> method
>> >>>> is
>> >>>> > below, though not terribly useful I imagine. =A0Here only 5 docum=
ents
>> are
>> >>>> > trying to be added to an index taking up only 39.2 MB on disk.
>> =A0Again
>> >>>> this
>> >>>> > deadlocking only happens after I use the Future for this task to
>> cancel
>> >>>> the
>> >>>> > task...
>> >>>> >
>> >>>> > Thread [pool-3-thread-5] (Suspended)
>> >>>> > =A0 =A0IndexWriter.doWait() line: 4494
>> >>>> > =A0 =A0IndexWriter.optimize(int, boolean) line: 2283
>> >>>> > =A0 =A0IndexWriter.optimize(boolean) line: 2218
>> >>>> > =A0 =A0IndexWriter.optimize() line: 2198
>> >>>> > =A0 =A0LuceneResultsPersister.commit() line: 97
>> >>>> > =A0 =A0PersistenceJobQueue.persistAndCommitBatch(PersistenceJobCo=
nsumer)
>> >>>> line:
>> >>>> > 105
>> >>>> > =A0 =A0PersistenceJobConsumer.consume() line: 46
>> >>>> > =A0 =A0PersistenceJobConsumer.run() line: 67
>> >>>> > =A0 =A0Executors$RunnableAdapter<T>.call() line: 441
>> >>>> > =A0 =A0FutureTask$Sync.innerRun() line: 303
>> >>>> > =A0 =A0FutureTask<V>.run() line: 138
>> >>>> > =A0 =A0ThreadPoolExecutor$Worker.runTask(Runnable) line: 886
>> >>>> > =A0 =A0ThreadPoolExecutor$Worker.run() line: 908
>> >>>> > =A0 =A0Thread.run() line: 619
>> >>>> >
>> >>>> > thanks,
>> >>>> >
>> >>>> > C>T>
>> >>>> >
>> >>>> > On Fri, Oct 16, 2009 at 1:58 PM, Michael McCandless <
>> >>>> > lucene@mikemccandless.com> wrote:
>> >>>> >
>> >>>> >> My guess is it's the invocation of Thread.interrupt (which
>> >>>> >> Future.cancel(true) calls if the task is running) that lead to t=
he
>> >>>> >> deadlock.
>> >>>> >>
>> >>>> >> Is it possible to get the stack trace of the thrown exception wh=
en
>> the
>> >>>> >> thread was interrupted? =A0Maybe indeed something in IW isn't
>> cleaning
>> >>>> >> up its state on being interrupted.
>> >>>> >>
>> >>>> >> Mike
>> >>>> >>
>> >>>> >> On Fri, Oct 16, 2009 at 1:43 PM, Christopher Tignor
>> >>>> >> <ctignor@thinkmap.com> wrote:
>> >>>> >> > thanks for getting back.
>> >>>> >> >
>> >>>> >> > I do not lock on the IndexWriter object itself but all methods=
 in
>> my
>> >>>> >> > consumer class that use IndexWriter are synchronized (locking =
my
>> >>>> >> singleton
>> >>>> >> > consumer object itself).
>> >>>> >> > The thread is waiting at IndexWriter.doWait(). =A0What might c=
uase
>> >>>> this?
>> >>>> >> >
>> >>>> >> > thanks -
>> >>>> >> >
>> >>>> >> > C>T>
>> >>>> >> >
>> >>>> >> > On Fri, Oct 16, 2009 at 12:58 PM, Uwe Schindler <uwe@thetaphi.=
de
>> >
>> >>>> wrote:
>> >>>> >> >
>> >>>> >> >> Do you use the IndexWriter as mutex in a synchronized() block=
?
>> This
>> >>>> is
>> >>>> >> not
>> >>>> >> >> supported and may hang. Never lock on IndexWriter instances.
>> >>>> IndexWriter
>> >>>> >> >> itself is thread safe.
>> >>>> >> >>
>> >>>> >> >> -----
>> >>>> >> >> Uwe Schindler
>> >>>> >> >> H.-H.-Meier-Allee 63, D-28213 Bremen
>> >>>> >> >> http://www.thetaphi.de
>> >>>> >> >> eMail: uwe@thetaphi.de
>> >>>> >> >>
>> >>>> >> >> > -----Original Message-----
>> >>>> >> >> > From: Christopher Tignor [mailto:ctignor@thinkmap.com]
>> >>>> >> >> > Sent: Friday, October 16, 2009 6:50 PM
>> >>>> >> >> > To: java-user
>> >>>> >> >> > Subject: IndexWriter optimize() deadlock
>> >>>> >> >> >
>> >>>> >> >> > Hello,
>> >>>> >> >> >
>> >>>> >> >> > I am trying to track down the cause of my code hanging on
>> calling
>> >>>> >> >> > IndexWriter.optimize() at its doWait() method.
>> >>>> >> >> > It appears, thus that it is watiing on other merges to happ=
en
>> >>>> which is
>> >>>> >> a
>> >>>> >> >> > bit
>> >>>> >> >> > confusing to me:
>> >>>> >> >> >
>> >>>> >> >> > My application is a simple producer consumer model where
>> >>>> documents are
>> >>>> >> >> > added
>> >>>> >> >> > to a queue by producers and then one consumer with one
>> >>>> indexwriter
>> >>>> >> (the
>> >>>> >> >> > only
>> >>>> >> >> > in the application) periodically calls addDocument() on a
>> batch
>> >>>> of
>> >>>> >> these
>> >>>> >> >> > jobs and then calls optimize(), commit(). and then close().
>> >>>> =A0There is
>> >>>> >> >> only
>> >>>> >> >> > one thread running the consumer so I am confused as to how =
the
>> >>>> >> >> indexwriter
>> >>>> >> >> > might be deadlocking itself. =A0Indeed this is the only thr=
ead
>> >>>> active
>> >>>> >> when
>> >>>> >> >> > the
>> >>>> >> >> > deadlock occurs so it seems to be a problem of reentry.
>> >>>> >> >> >
>> >>>> >> >> > Importantly, the deadlocking occurs only when the thread is
>> >>>> trying to
>> >>>> >> >> > shutdown - that is the Thread running this lucene consumer =
has
>> a
>> >>>> >> Future
>> >>>> >> >> > that
>> >>>> >> >> > has had its cancel(true) interrupting method called. =A0Is =
it
>> >>>> possible
>> >>>> >> that
>> >>>> >> >> > an
>> >>>> >> >> > internal Lucene lock is obtained during addDocument() and o=
n
>> >>>> >> interruption
>> >>>> >> >> > is
>> >>>> >> >> > never released so the subsequent optimize() call hangs? =A0=
This
>> >>>> doesn't
>> >>>> >> >> > appear
>> >>>> >> >> > to be happening...
>> >>>> >> >> >
>> >>>> >> >> > Any help appreciated.
>> >>>> >> >> >
>> >>>> >> >> > thanks,
>> >>>> >> >> >
>> >>>> >> >> > C>T>
>> >>>> >> >> >
>> >>>> >> >> > what might I be missing here?
>> >>>> >> >> >
>> >>>> >> >> > --
>> >>>> >> >> > TH!NKMAP
>> >>>> >> >> >
>> >>>> >> >> > Christopher Tignor | Senior Software Architect
>> >>>> >> >> > 155 Spring Street NY, NY 10012
>> >>>> >> >> > p.212-285-8600 x385 f.212-285-8999
>> >>>> >> >>
>> >>>> >> >>
>> >>>> >> >>
>> >>>> -------------------------------------------------------------------=
--
>> >>>> >> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.o=
rg
>> >>>> >> >> For additional commands, e-mail:
>> java-user-help@lucene.apache.org
>> >>>> >> >>
>> >>>> >> >>
>> >>>> >> >
>> >>>> >> >
>> >>>> >> > --
>> >>>> >> > TH!NKMAP
>> >>>> >> >
>> >>>> >> > Christopher Tignor | Senior Software Architect
>> >>>> >> > 155 Spring Street NY, NY 10012
>> >>>> >> > p.212-285-8600 x385 f.212-285-8999
>> >>>> >> >
>> >>>> >>
>> >>>> >>
>> ---------------------------------------------------------------------
>> >>>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>>> >> For additional commands, e-mail: java-user-help@lucene.apache.or=
g
>> >>>> >>
>> >>>> >>
>> >>>> >
>> >>>> >
>> >>>> > --
>> >>>> > TH!NKMAP
>> >>>> >
>> >>>> > Christopher Tignor | Senior Software Architect
>> >>>> > 155 Spring Street NY, NY 10012
>> >>>> > p.212-285-8600 x385 f.212-285-8999
>> >>>> >
>> >>>>
>> >>>> -------------------------------------------------------------------=
--
>> >>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>>>
>> >>>>
>> >>>
>> >>>
>> >>> --
>> >>> TH!NKMAP
>> >>>
>> >>> Christopher Tignor | Senior Software Architect
>> >>> 155 Spring Street NY, NY 10012
>> >>> p.212-285-8600 x385 f.212-285-8999
>> >>>
>> >>
>> >>
>> >>
>> >> --
>> >> TH!NKMAP
>> >>
>> >> Christopher Tignor | Senior Software Architect
>> >> 155 Spring Street NY, NY 10012
>> >> p.212-285-8600 x385 f.212-285-8999
>> >>
>> >
>> >
>> >
>> > --
>> > TH!NKMAP
>> >
>> > Christopher Tignor | Senior Software Architect
>> > 155 Spring Street NY, NY 10012
>> > p.212-285-8600 x385 f.212-285-8999
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --
> TH!NKMAP
>
> Christopher Tignor | Senior Software Architect
> 155 Spring Street NY, NY 10012
> p.212-285-8600 x385 f.212-285-8999
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42902-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 11:43:38 2009
Return-Path: <java-user-return-42902-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53903 invoked from network); 17 Oct 2009 11:43:37 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 11:43:37 -0000
Received: (qmail 23253 invoked by uid 500); 17 Oct 2009 11:43:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23166 invoked by uid 500); 17 Oct 2009 11:43:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23155 invoked by uid 99); 17 Oct 2009 11:43:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 11:43:35 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=MSGID_RANDY,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [129.125.60.1] (HELO smtp1h.service.rug.nl) (129.125.60.1)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 11:43:25 +0000
Received: from mail3.rug.nl (f5selfip-4-60.service.rug.nl [129.125.60.248])
	by smtp1h.service.rug.nl (8.14.3/8.14.3) with ESMTP id n9HBh4mo000571
	for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 13:43:04 +0200
Received: from [82.73.38.192] (account p253714@rug.nl)
  by mail3.rug.nl (CommuniGate Pro WEBUSER 5.1.16)
  with HTTP id 126566286 for java-user@lucene.apache.org; Sat, 17 Oct 2009 13:43:04 +0200
From: "R.A.Ittoo" <R.A.Ittoo@rug.nl>
Subject: gettotalhits vs totalhits
To: java-user@lucene.apache.org
X-Mailer: CommuniGate Pro WebUser v5.1.16
Date: Sat, 17 Oct 2009 13:43:04 +0200
Message-ID: <web-126566286@mail3.rug.nl>
MIME-Version: 1.0
Content-Type: text/plain;charset=utf-8;format="flowed"
Content-Transfer-Encoding: 8bit
X-Virus-Scanned: clamav-milter 0.95.2 at smtp1h
X-Virus-Status: Clean
X-Virus-Checked: Checked by ClamAV on apache.org

hi
I am wondering what is the difference between

collector.getTotalHits();//where collector is a TopScoreDocCollector
(which returns the correct value for my example = 2 docs)

and

  collector.topDocs().totalHits (which returns 0, and is wrong)

the collector was used in a search: searcher.search(query,collector);

Strangely enough, collector.topDocs().scoreDocs.length; returns the 
correct value (length = 2)

Can anyone please advise when to use what (and what are the 
differences between the objects above)

ashwin

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42903-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 12:45:48 2009
Return-Path: <java-user-return-42903-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70689 invoked from network); 17 Oct 2009 12:45:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 12:45:48 -0000
Received: (qmail 48301 invoked by uid 500); 17 Oct 2009 12:45:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48226 invoked by uid 500); 17 Oct 2009 12:45:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48216 invoked by uid 99); 17 Oct 2009 12:45:45 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 12:45:45 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rff.rff@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 12:45:43 +0000
Received: by ewy26 with SMTP id 26so2854692ewy.5
        for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 05:45:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=Dyy/9yCtKQhJ+UGxQVtLPzoluvGn8TlCaA1etQIeDKw=;
        b=kFpJilGEPgY44kkMq/CBEilIwwyYBQtWOB+LsHm7c8q32sejpsz8iwvsdf7lOzbF4v
         31nGLV4viICAG0OzWjr2C7sRlhFNm3oyrYxkNE1598m9I1aJLRgm/+1AeI0W9I+d92vi
         oGTbS6dYN9TzaZ76rrQGzPXfkpOe0MBZ81xWE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=uadEeQ/bJSX6ZZR4FIpE+4DviKVCqiF/BAWB/Hex4timMeg3ykduG0BkNu85kia9Fp
         xl//ClR/5aNyv4rL0IiHZX1LFtJJZi3xL5xj/vdXbvdqOzWdrOnOiSkyB17EUdxxdeee
         f2mjfhqJ1aQTltAMT60l37Kl1aDKHWckiBSIg=
MIME-Version: 1.0
Received: by 10.216.85.132 with SMTP id u4mr952542wee.191.1255783522222; Sat, 
	17 Oct 2009 05:45:22 -0700 (PDT)
In-Reply-To: <2EDB8058-09B4-44A1-906C-55BE34A33B52@apache.org>
References: <4AD84400.5050802@sirma.bg> <A8C1B4E109E0443CB7DE8E4EF9359861@VEGA> 
	<2EDB8058-09B4-44A1-906C-55BE34A33B52@apache.org>
From: gabriele renzi <rff.rff@gmail.com>
Date: Sat, 17 Oct 2009 14:45:02 +0200
Message-ID: <828083e70910170545s33c42761g2c828cb4d3e7b471@mail.gmail.com>
Subject: Re: is Lucene 3.0 coming soon?
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Fri, Oct 16, 2009 at 12:31 PM, Grant Ingersoll <gsingers@apache.org> wrote:
>
> On Oct 16, 2009, at 6:05 AM, Uwe Schindler wrote:
>
>> I would recommend to adopt your app to 2.9 and enable deprecation
>> warnings.
>> As soon as all deprecation warning disappear during compile, you are able
>> to
>> just go to 3.0 (just drop in jars when available). This is why we have
>> 2.9.
>> 2.9: it is just 3.0 with the deprecations not yet removed. No other
>> changes
>> extensions to the API.
>
> That and we are moving to Java 1.5.

I've been wondering about this for a while: why 1.5?
1.6 has been out for three years, is it just that the additional
advantages of it (pluggable annotations is the only thing I can think
of) are not enough to break compat more?

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42904-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 12:49:18 2009
Return-Path: <java-user-return-42904-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71140 invoked from network); 17 Oct 2009 12:49:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 12:49:17 -0000
Received: (qmail 51510 invoked by uid 500); 17 Oct 2009 12:49:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51433 invoked by uid 500); 17 Oct 2009 12:49:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51423 invoked by uid 99); 17 Oct 2009 12:49:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 12:49:15 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 12:49:12 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 70A5C45F02F
	for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 14:48:51 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id e17PBCTlidsu for <java-user@lucene.apache.org>;
	Sat, 17 Oct 2009 14:48:41 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 59B2045F033
	for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 14:48:41 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4AD84400.5050802@sirma.bg> <A8C1B4E109E0443CB7DE8E4EF9359861@VEGA> <2EDB8058-09B4-44A1-906C-55BE34A33B52@apache.org> <828083e70910170545s33c42761g2c828cb4d3e7b471@mail.gmail.com>
Subject: RE: is Lucene 3.0 coming soon?
Date: Sat, 17 Oct 2009 14:48:42 +0200
Message-ID: <F1793C0551394CB5B0EF0EEA43911632@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <828083e70910170545s33c42761g2c828cb4d3e7b471@mail.gmail.com>
Thread-Index: AcpPJ8RZcfLknhdNQPGIwrLuOZ6TKgAACqEg
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

We do not need any 1.6 language features for Lucene (we do not use
annotations at all).

And: The current 1.6 JVM has still lots of bugs, so e.g. we use still 1.5
for all Lucene related code. The most important thing for Lucene 3.0 are
things like StringBuilder and Generics, which is all covered by 1.5.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: gabriele renzi [mailto:rff.rff@gmail.com]
> Sent: Saturday, October 17, 2009 2:45 PM
> To: java-user@lucene.apache.org
> Subject: Re: is Lucene 3.0 coming soon?
> 
> On Fri, Oct 16, 2009 at 12:31 PM, Grant Ingersoll <gsingers@apache.org>
> wrote:
> >
> > On Oct 16, 2009, at 6:05 AM, Uwe Schindler wrote:
> >
> >> I would recommend to adopt your app to 2.9 and enable deprecation
> >> warnings.
> >> As soon as all deprecation warning disappear during compile, you are
> able
> >> to
> >> just go to 3.0 (just drop in jars when available). This is why we have
> >> 2.9.
> >> 2.9: it is just 3.0 with the deprecations not yet removed. No other
> >> changes
> >> extensions to the API.
> >
> > That and we are moving to Java 1.5.
> 
> I've been wondering about this for a while: why 1.5?
> 1.6 has been out for three years, is it just that the additional
> advantages of it (pluggable annotations is the only thing I can think
> of) are not enough to break compat more?
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42905-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 15:03:59 2009
Return-Path: <java-user-return-42905-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 482 invoked from network); 17 Oct 2009 15:03:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 15:03:59 -0000
Received: (qmail 35628 invoked by uid 500); 17 Oct 2009 15:03:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35550 invoked by uid 500); 17 Oct 2009 15:03:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35539 invoked by uid 99); 17 Oct 2009 15:03:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 15:03:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 15:03:47 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzAoY-0003Np-MP
	for java-user@lucene.apache.org; Sat, 17 Oct 2009 08:03:26 -0700
Message-ID: <25939035.post@talk.nabble.com>
Date: Sat, 17 Oct 2009 08:03:26 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Need to know pros and cons of using RAMDirectory
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

I need to improve performance of my Lucene search query. Can I use
RAMDirectory?Does it optimize performance?Is there any index size limit for
this? I would appreciate if someone could list pros and cons of using a
RAMDirectory.

Thanks.
-- 
View this message in context: http://www.nabble.com/Need-to-know-pros-and-cons-of-using-RAMDirectory-tp25939035p25939035.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42906-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 16:12:28 2009
Return-Path: <java-user-return-42906-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15322 invoked from network); 17 Oct 2009 16:12:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 16:12:28 -0000
Received: (qmail 93448 invoked by uid 500); 17 Oct 2009 16:12:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93368 invoked by uid 500); 17 Oct 2009 16:12:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93354 invoked by uid 99); 17 Oct 2009 16:12:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 16:12:26 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 74.125.78.24 as permitted sender)
Received: from [74.125.78.24] (HELO ey-out-2122.google.com) (74.125.78.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 16:12:16 +0000
Received: by ey-out-2122.google.com with SMTP id 22so682203eye.3
        for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 09:11:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=VAAi72AvQg2vtdUBv+XtkYTqVWPJBp5dQJdtWlmJ6sI=;
        b=kWo0mxyAZNYRXYKHphPpV5iak/KL8HTaFur7JwsNlZUa3ufcsm7cJdjScGe7SSN3K5
         VbhSeXiFt0Q9VkL7UTWYN2dfCCixwFg4+NETjghqaCPsR+wNt0zMjl8f+vGLZ1gj04vN
         lZKTfbzTuYDk5ccIgWW2eKoPFS037y8mn4Q7g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=qhCii9YEJe5hPXqwvhH1VAnQ7o2hQnS+fQBy9/6c2KcEMQKJLDPJvxmzD1CSQ2Ewac
         J8GpCqioOdCfmgkfdQnr8UlJKeVDv7Qjb1KD++SDqTg5GCou4RvQASKHJrKaxpFlRLJ+
         sHwv7m2aiwOSnIiKNsXyFBGy+h8LBSULNTlts=
Received: by 10.211.146.17 with SMTP id y17mr3286033ebn.43.1255795915912;
        Sat, 17 Oct 2009 09:11:55 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 7sm4509800eyg.4.2009.10.17.09.11.54
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Sat, 17 Oct 2009 09:11:54 -0700 (PDT)
Message-Id: <3C0B35C9-003C-4A56-A65E-4C62D778308B@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <25939035.post@talk.nabble.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Need to know pros and cons of using RAMDirectory
Date: Sat, 17 Oct 2009 18:11:53 +0200
References: <25939035.post@talk.nabble.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

you should probably ask your self why your performance is bad before  
looking at solving it by scaling hardware. I.e. what are your  
application needs, how so you solve you needs at index/query time and  
how can you replace this with something better? If you tell us a bit  
more about your corpora and your need we might be able to help you.

But in response to your query, RAMDirectory loads index to memory and  
is thus usually faster than FSDirectory. But a small (or the often  
requested parts of a large) FSDirectory will however be handled by the  
OS level file chache so you might not win anything by switching. You  
simply have to bechmark your index in RAMDirectory and comare it with  
FSDirectory. Perhaps you want to take a look at the benchmark contrib.



17 okt 2009 kl. 17.03 skrev mitu2009:

>
> Hi,
>
> I need to improve performance of my Lucene search query. Can I use
> RAMDirectory?Does it optimize performance?Is there any index size  
> limit for
> this? I would appreciate if someone could list pros and cons of  
> using a
> RAMDirectory.
>
> Thanks.
> -- 
> View this message in context: http://www.nabble.com/Need-to-know-pros-and-cons-of-using-RAMDirectory-tp25939035p25939035.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42907-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 17 20:24:54 2009
Return-Path: <java-user-return-42907-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68489 invoked from network); 17 Oct 2009 20:24:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 17 Oct 2009 20:24:54 -0000
Received: (qmail 25656 invoked by uid 500); 17 Oct 2009 20:24:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25566 invoked by uid 500); 17 Oct 2009 20:24:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25556 invoked by uid 99); 17 Oct 2009 20:24:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 20:24:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 17 Oct 2009 20:24:42 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzFp7-0007wt-5F
	for java-user@lucene.apache.org; Sat, 17 Oct 2009 13:24:21 -0700
Message-ID: <25941499.post@talk.nabble.com>
Date: Sat, 17 Oct 2009 13:24:21 -0700 (PDT)
From: Rich Livingstone <nabble@bananasoft.net>
To: java-user@lucene.apache.org
Subject: How to make each term of query appear in at least one field of
 multiple field query
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: nabble@bananasoft.net
X-Virus-Checked: Checked by ClamAV on apache.org


I am a bit stumped by how to ensure that, where there are multiple terms in
my query, that each term must appear at least once across all specified
fields of my document. I am using MultiFieldQueryParser and
BooleanClause.Occur.SHOULD in the query; I tried putting all fields into a
single giant field and prefixing each term with + but that loses the ability
to boost individual fields in the search (unless there is a way to add a
boost per term indexed at index time?) so it doesn't seem a good solution as
I need the boosting too.

Anyone any idea how to do this ? BooleanClause.Occur.MUST would force all
terms to be in all fields, I would have thought - and the ability to do
weighting is important to me.

I'm using Lucene 2.2.0.

Thanks for any help !
-- 
View this message in context: http://www.nabble.com/How-to-make-each-term-of-query-appear-in-at-least-one-field-of-multiple-field-query-tp25941499p25941499.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42908-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 00:28:48 2009
Return-Path: <java-user-return-42908-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9677 invoked from network); 18 Oct 2009 00:28:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 00:28:48 -0000
Received: (qmail 18307 invoked by uid 500); 18 Oct 2009 00:28:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18234 invoked by uid 500); 18 Oct 2009 00:28:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18224 invoked by uid 99); 18 Oct 2009 00:28:45 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 00:28:45 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of davidginzburg@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 00:28:36 +0000
Received: by pzk3 with SMTP id 3so2293974pzk.20
        for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 17:28:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:from:date:message-id
         :subject:to:content-type;
        bh=jl1igtOD+Zy+wR9keLc1COBgddcsRnJgVxSjDm1Ocm0=;
        b=fSydnOQql4sKQyjN2oyRQYmow2OgywqOSIyOmBai0BTmUCkcLiJuWiuPOdLImd/n/D
         KLpjz/FYuBT3AFUprkOoPmiYsieJ+6eNS3BTE1mffDQCTbhz4a65v6FMe+N+1bcVdAY8
         6UrWHAzhFdPnkCjdr56i5D9zzm2QeVNWNBJgc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=pGI7/mIdErVm87+uL4LX2GvGaU7KtDSrmt5i39LCdCojL3nFpQK+8UoIC15ByovIvy
         HpT9TWDALoOIMpRJpEJ6BNiEJztitmMlCDsCaFtydL77LyaYLxP6DxYf2NlWC/TooNVP
         pNvjDERkEbQzrI8+THcTRwEf5Jsao0x1ujq5M=
MIME-Version: 1.0
Received: by 10.140.208.20 with SMTP id f20mr1477443rvg.126.1255825695083; 
	Sat, 17 Oct 2009 17:28:15 -0700 (PDT)
From: David Ginzburg <davidginzburg@gmail.com>
Date: Sun, 18 Oct 2009 02:27:55 +0200
Message-ID: <8d3740db0910171727h5893a77m5504783b72442853@mail.gmail.com>
Subject: localToken contains a termBuffer with 10 empty chars ('')
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd211d4748f0b04762ab4be
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd211d4748f0b04762ab4be
Content-Type: text/plain; charset=ISO-8859-1

Hi,
I have written a my own weighted synonym filter and tried to integrate it
inside an analyzer.
The analyzer as defined in the schema.xml is:




the field type is
*<fieldType name="Company_Name" class="solr.TextField"
positionIncrementGap="100" >
      <analyzer type="index">
        <tokenizer class="solr.**WhitespaceTokenizerFactory"/>
        **
        <filter class="DTSynonymFactory"
FreskoFunction="**SimilarityProbManual.txt"
ignoreCase="true" expand="false"/>

        <!--<filter class="solr.**EnglishPorterFilterFactory"
protected="protwords.txt"/>-->
        <!--<filter class="solr.**RemoveDuplicatesTokenFilterFac**tory"/>-->
      </analyzer>
      <analyzer type="query">
        <tokenizer class="solr.**StandardTokenizerFactory"/>
        <filter class="solr.**LowerCaseFilterFactory"/>
        <filter class="solr.StopFilterFactory" ignoreCase="true"
words="stopwords.txt"/>
        <!--<filter class="solr.**EnglishPorterFilterFactory"
protected="protwords.txt"/>-->
        <!--<filter class="solr.**RemoveDuplicatesTokenFilterFac**tory"/
>-->
      </analyzer>
    </fieldType>*


The problem is that I always get in the  Token next(Token reusableToken)
method in  DTSynonymFilter  a token with a termBuffer containing  10 emty
chars.
*
*
*I have debugged and stepped into Solr code and found that *
*in class DocInverterPerField
 Token token = stream.next(localToken); line 134*
*
localToken contains a termBuffer with 10 empty chars ('')*

*What am I doing wrong ???
*
The java code:
*
import com.google.common.collect.**ArrayListMultimap;
import java.io.IOException;
import java.util.LinkedList;
import java.util.List;
import org.apache.lucene.analysis.**Token;
import org.apache.lucene.analysis.**TokenFilter;
import org.apache.lucene.analysis.**TokenStream;
import org.apache.lucene.analysis.**payloads.PayloadHelper;
import org.apache.lucene.index.**Payload;

/**
 *
 * @author david
 */
public class DTSynonymFilter extends TokenFilter {

    public DTSynonymFilter(TokenStream input, ArrayListMultimap<String,
Synonym> syns) {
        super(input);
        this.synsMap = syns;
        System.out.println("in DTSynonymFilter synsMap ");



    }
    public static final String SYNONYM = "<SYNONYM>";
    TokenFilter tf;
    private LinkedList<Token> synonymTokenQueue = new LinkedList<Token>();

    private ArrayListMultimap<String, Synonym> synsMap = null;
    private LinkedList<Token> buffer;

    private Token nextTok(Token target) throws IOException {

        if (buffer != null && !buffer.isEmpty()) {
            return buffer.removeFirst();
        } else {
            return input.next(target);
        }
    }

    private void pushTok(Token t) {
        if (buffer == null) {
            buffer = new LinkedList<Token>();

        }
        buffer.addFirst(t);
    }

    @Override
    public Token next(Token reusableToken) throws IOException {

        if (synonymTokenQueue.size() > 0) {

            return synonymTokenQueue.removeFirst(* *);

        }
        if (reusableToken == null) {
            return null;
        }

        reusableToken.setPayload(new Payload(new byte[]{(byte) 1}));

      //   System.out.println("trying to get synonyms for "+reusableToken);
      //    System.out.println(synsMap.* *get(reusableToken.term()));
        List<Synonym> syns = synsMap.get(reusableToken.**term());
       for (Synonym synonym : synsMap.get(reusableToken.**term())) {
                System.out.println(synonym);
            }
        Payload boostPayload;

        for (Synonym synonym : syns) {
            //Token(char[] startTermBuffer, int termBufferOffset, int
termBufferLength, int start, int end)
           // Token synToken = new Token(synonym.getToken().**toCharArray(),
reusableToken.startOffset(), reusableToken.endOffset(),
synonym.getToken().length(), 0);//, t.startOffset(), t.endOffset(),
SYNONYM);
            Token newTok = new Token(reusableToken.**startOffset(),
reusableToken.endOffset(), SYNONYM);
            newTok.setTermBuffer(synonym.**getToken().toCharArray(), 0,
synonym.getToken().length());
            // set the position increment to zero
            // this tells lucene the synonym is
            // in the exact same location as the originating word
            newTok.setPositionIncrement(0)**;
            boostPayload = new Payload(PayloadHelper.**
encodeFloat(synonym.getWieght(**)));
            newTok.setPayload(**boostPayload);
            synonymTokenQueue.add(newTok);

        }
        return reusableToken;








    }
}


import DTSynonymFilter;
import com.google.common.collect.**ArrayListMultimap;
import java.io.File;
import java.io.IOException;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import org.apache.lucene.analysis.**Token;
import org.apache.lucene.analysis.**TokenStream;
import org.apache.solr.analysis.**BaseTokenFilterFactory;
import org.apache.solr.analysis.**TokenizerFactory;
import org.apache.solr.common.**ResourceLoader;
import org.apache.solr.common.util.**StrUtils;
import org.apache.solr.util.plugin.**ResourceLoaderAware;

/**
 *
 * @author david
 */
public class DTSynonymFactory extends BaseTokenFilterFactory implements
ResourceLoaderAware {

    boolean informed=false;
    String synonyms=null;

    public DTSynonymFactory(){

       // this.syns= ArrayListMultimap.create();
    }

    final static Logger log = Logger.getLogger(**DTSynonymFactory.class.**
getName());

    private static TokenizerFactory loadTokenizerFactory(* *ResourceLoader
loader, String cname, Map<String, String> args) {
        TokenizerFactory tokFactory = (TokenizerFactory)
loader.newInstance(cname);
        tokFactory.init(args);
        return tokFactory;
    }
    private ArrayListMultimap<String, Synonym> syns = null;

    public DTSynonymFilter create(TokenStream input) {

        Thread.dumpStack();
        try {
            Thread.sleep(5000);
        } catch (InterruptedException ex) {
            Logger.getLogger(**DTSynonymFactory.class.**getName()).log(Level.SEVERE,
null, ex);
        }
        if(syns!=null){
            System.out.println("in create() syns is "+syns+" syns size is
"+" " );
            return new DTSynonymFilter(input,syns);
        }
        else{
            System.out.println("in create() syns is "+syns+" and informed is
"+informed);
            return new DTSynonymFilter(input,null);


        }
  }
    @Override
    public void inform(ResourceLoader loader) {

         synonyms = args.get("FreskoFunction");
        System.out.println("in DTSynonymFilter.inform() synonyms file is
"+synonyms);
        boolean ignoreCase = getBoolean("ignoreCase", false);
         System.out.println("in DTSynonymFilter.inform() ignoreCase is
"+ignoreCase);
        boolean expand = getBoolean("expand", true);
        System.out.println("in DTSynonymFilter.inform() expand is "+expand);
        //String seperator =
        String tf = args.get("tokenizerFactory");

        TokenizerFactory tokFactory = null;
        if (tf != null) {
            tokFactory = loadTokenizerFactory(loader, tf, args);
        }
        if (tf != null) {
            System.out.println("**TokenizerFactory loaded ");
        }
        if (synonyms != null) {
            List<String> wlist = null;
            try {
                File synonymFile = new File(synonyms);
                if (synonymFile.exists()) {
                    wlist = loader.getLines(synonyms);
                } else {
                    List<String> files = StrUtils.splitFileNames(**
synonyms);
                    for (String file : files) {
                        wlist = loader.getLines(file.trim());
                    }
                }
            } catch (Exception e) {
                e.printStackTrace();

                throw new RuntimeException(e);

            }
            syns = ArrayListMultimap.create();
            populateSynMap("\\|", wlist);
            if(syns==null){
                System.out.println("sysns after create and populate is
null!!!!!!");
                Thread.sleep(5000);


            }
            else{
                System.out.println("after crete the size of syns is
"+syns.size());
                informed=true;
            }

        // synMap = new SynonymMap(ignoreCase);
        // parseRules(wlist, synMap, "=>", ",", expand,tokFactory);
        }
        else{
            throw new RuntimeException("Could not find synonyms");
        }
        }catch(Exception e){
           e.printStackTrace();
           throw  new RuntimeException(e);
        }
    }


        }

    }
}

* Thanks in advance

--000e0cd211d4748f0b04762ab4be--

From java-user-return-42909-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 00:48:01 2009
Return-Path: <java-user-return-42909-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18612 invoked from network); 18 Oct 2009 00:48:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 00:48:01 -0000
Received: (qmail 27258 invoked by uid 500); 18 Oct 2009 00:47:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27179 invoked by uid 500); 18 Oct 2009 00:47:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27169 invoked by uid 99); 18 Oct 2009 00:47:58 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 00:47:58 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 00:47:56 +0000
Received: by iwn16 with SMTP id 16so1801279iwn.29
        for <java-user@lucene.apache.org>; Sat, 17 Oct 2009 17:47:35 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=2nR5NL5GRtkl+iuyBSsHThBvo5d0d3btRM2LiaxdH9g=;
        b=J4Yy4cPHklmXP/4h0w7SeI6isiJbnpE+O08gYyH6ljSYDBYKW6/IfJYhTcmvDlW3sj
         Fn7pw3IUVTFiedwgLYoRpPh7rf1a+3GLYEUEBqNn1PJdS6vClW7peGJxzB6v4ZhEYiu2
         I5KKlkZ7cHxwu0uSUU7s7jNZl8WWBINE/Y5eQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=TkZ0dnBYLJTttrU2dNMHb+gK2IbKrmjYJ5PM8ORy43Wdj2NpZCwkxM0QRfLas8dGsU
         lO0nvbYRbJkcLmb0gVdH/MoyULm5xSsih0Sa80OJh056uV3VK9Rf3eFNLQhdcIEQ6d12
         S8yvkhz7Xyfe3dcXThSqP2nQBc0Kx6eQd8zsc=
MIME-Version: 1.0
Received: by 10.231.125.28 with SMTP id w28mr9586010ibr.50.1255826855384; Sat, 
	17 Oct 2009 17:47:35 -0700 (PDT)
In-Reply-To: <25939035.post@talk.nabble.com>
References: <25939035.post@talk.nabble.com>
Date: Sat, 17 Oct 2009 20:47:35 -0400
Message-ID: <359a92830910171747h2259038bn71c1f0921a39c06c@mail.gmail.com>
Subject: Re: Need to know pros and cons of using RAMDirectory
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e645b8ca9d58a204762af9df

--0016e645b8ca9d58a204762af9df
Content-Type: text/plain; charset=ISO-8859-1

Have you looked here for ideas?

http://wiki.apache.org/lucene-java/ImproveSearchingSpeed

Best
Erick

On Sat, Oct 17, 2009 at 11:03 AM, mitu2009 <musicfreaque@gmail.com> wrote:

>
> Hi,
>
> I need to improve performance of my Lucene search query. Can I use
> RAMDirectory?Does it optimize performance?Is there any index size limit for
> this? I would appreciate if someone could list pros and cons of using a
> RAMDirectory.
>
> Thanks.
> --
> View this message in context:
> http://www.nabble.com/Need-to-know-pros-and-cons-of-using-RAMDirectory-tp25939035p25939035.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e645b8ca9d58a204762af9df--

From java-user-return-42910-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 09:38:10 2009
Return-Path: <java-user-return-42910-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90402 invoked from network); 18 Oct 2009 09:38:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 09:38:10 -0000
Received: (qmail 33769 invoked by uid 500); 18 Oct 2009 09:38:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33682 invoked by uid 500); 18 Oct 2009 09:38:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33672 invoked by uid 99); 18 Oct 2009 09:38:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 09:38:08 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 09:37:57 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id BC426D36001
	for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 11:37:36 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id nSp00fhQ1CEf for <java-user@lucene.apache.org>;
	Sun, 18 Oct 2009 11:37:26 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 5206CD36002
	for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 11:37:26 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <8d3740db0910171727h5893a77m5504783b72442853@mail.gmail.com>
Subject: RE: localToken contains a termBuffer with 10 empty chars ('')
Date: Sun, 18 Oct 2009 11:37:27 +0200
Message-ID: <411EE6F183234AB1A0013D456931F444@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <8d3740db0910171727h5893a77m5504783b72442853@mail.gmail.com>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
Thread-Index: AcpPifovhcIWwqRhTCGJEBRYEARsBgATHvIQ
X-Virus-Checked: Checked by ClamAV on apache.org

You must also respect termLength() which returns the number of "valid" chars
in the term buffer.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: David Ginzburg [mailto:davidginzburg@gmail.com]
> Sent: Sunday, October 18, 2009 2:28 AM
> To: java-user@lucene.apache.org
> Subject: localToken contains a termBuffer with 10 empty chars ('')
> 
> Hi,
> I have written a my own weighted synonym filter and tried to integrate it
> inside an analyzer.
> The analyzer as defined in the schema.xml is:
> 
> 
> 
> 
> the field type is
> *<fieldType name="Company_Name" class="solr.TextField"
> positionIncrementGap="100" >
>       <analyzer type="index">
>         <tokenizer class="solr.**WhitespaceTokenizerFactory"/>
>         **
>         <filter class="DTSynonymFactory"
> FreskoFunction="**SimilarityProbManual.txt"
> ignoreCase="true" expand="false"/>
> 
>         <!--<filter class="solr.**EnglishPorterFilterFactory"
> protected="protwords.txt"/>-->
>         <!--<filter class="solr.**RemoveDuplicatesTokenFilterFac**tory"/>-
> ->
>       </analyzer>
>       <analyzer type="query">
>         <tokenizer class="solr.**StandardTokenizerFactory"/>
>         <filter class="solr.**LowerCaseFilterFactory"/>
>         <filter class="solr.StopFilterFactory" ignoreCase="true"
> words="stopwords.txt"/>
>         <!--<filter class="solr.**EnglishPorterFilterFactory"
> protected="protwords.txt"/>-->
>         <!--<filter class="solr.**RemoveDuplicatesTokenFilterFac**tory"/
> >-->
>       </analyzer>
>     </fieldType>*
> 
> 
> The problem is that I always get in the  Token next(Token reusableToken)
> method in  DTSynonymFilter  a token with a termBuffer containing  10 emty
> chars.
> *
> *
> *I have debugged and stepped into Solr code and found that *
> *in class DocInverterPerField
>  Token token = stream.next(localToken); line 134*
> *
> localToken contains a termBuffer with 10 empty chars ('')*
> 
> *What am I doing wrong ???
> *
> The java code:
> *
> import com.google.common.collect.**ArrayListMultimap;
> import java.io.IOException;
> import java.util.LinkedList;
> import java.util.List;
> import org.apache.lucene.analysis.**Token;
> import org.apache.lucene.analysis.**TokenFilter;
> import org.apache.lucene.analysis.**TokenStream;
> import org.apache.lucene.analysis.**payloads.PayloadHelper;
> import org.apache.lucene.index.**Payload;
> 
> /**
>  *
>  * @author david
>  */
> public class DTSynonymFilter extends TokenFilter {
> 
>     public DTSynonymFilter(TokenStream input, ArrayListMultimap<String,
> Synonym> syns) {
>         super(input);
>         this.synsMap = syns;
>         System.out.println("in DTSynonymFilter synsMap ");
> 
> 
> 
>     }
>     public static final String SYNONYM = "<SYNONYM>";
>     TokenFilter tf;
>     private LinkedList<Token> synonymTokenQueue = new LinkedList<Token>();
> 
>     private ArrayListMultimap<String, Synonym> synsMap = null;
>     private LinkedList<Token> buffer;
> 
>     private Token nextTok(Token target) throws IOException {
> 
>         if (buffer != null && !buffer.isEmpty()) {
>             return buffer.removeFirst();
>         } else {
>             return input.next(target);
>         }
>     }
> 
>     private void pushTok(Token t) {
>         if (buffer == null) {
>             buffer = new LinkedList<Token>();
> 
>         }
>         buffer.addFirst(t);
>     }
> 
>     @Override
>     public Token next(Token reusableToken) throws IOException {
> 
>         if (synonymTokenQueue.size() > 0) {
> 
>             return synonymTokenQueue.removeFirst(* *);
> 
>         }
>         if (reusableToken == null) {
>             return null;
>         }
> 
>         reusableToken.setPayload(new Payload(new byte[]{(byte) 1}));
> 
>       //   System.out.println("trying to get synonyms for
> "+reusableToken);
>       //    System.out.println(synsMap.* *get(reusableToken.term()));
>         List<Synonym> syns = synsMap.get(reusableToken.**term());
>        for (Synonym synonym : synsMap.get(reusableToken.**term())) {
>                 System.out.println(synonym);
>             }
>         Payload boostPayload;
> 
>         for (Synonym synonym : syns) {
>             //Token(char[] startTermBuffer, int termBufferOffset, int
> termBufferLength, int start, int end)
>            // Token synToken = new
> Token(synonym.getToken().**toCharArray(),
> reusableToken.startOffset(), reusableToken.endOffset(),
> synonym.getToken().length(), 0);//, t.startOffset(), t.endOffset(),
> SYNONYM);
>             Token newTok = new Token(reusableToken.**startOffset(),
> reusableToken.endOffset(), SYNONYM);
>             newTok.setTermBuffer(synonym.**getToken().toCharArray(), 0,
> synonym.getToken().length());
>             // set the position increment to zero
>             // this tells lucene the synonym is
>             // in the exact same location as the originating word
>             newTok.setPositionIncrement(0)**;
>             boostPayload = new Payload(PayloadHelper.**
> encodeFloat(synonym.getWieght(**)));
>             newTok.setPayload(**boostPayload);
>             synonymTokenQueue.add(newTok);
> 
>         }
>         return reusableToken;
> 
> 
> 
> 
> 
> 
> 
> 
>     }
> }
> 
> 
> import DTSynonymFilter;
> import com.google.common.collect.**ArrayListMultimap;
> import java.io.File;
> import java.io.IOException;
> import java.util.List;
> import java.util.Map;
> import java.util.logging.Level;
> import java.util.logging.Logger;
> import org.apache.lucene.analysis.**Token;
> import org.apache.lucene.analysis.**TokenStream;
> import org.apache.solr.analysis.**BaseTokenFilterFactory;
> import org.apache.solr.analysis.**TokenizerFactory;
> import org.apache.solr.common.**ResourceLoader;
> import org.apache.solr.common.util.**StrUtils;
> import org.apache.solr.util.plugin.**ResourceLoaderAware;
> 
> /**
>  *
>  * @author david
>  */
> public class DTSynonymFactory extends BaseTokenFilterFactory implements
> ResourceLoaderAware {
> 
>     boolean informed=false;
>     String synonyms=null;
> 
>     public DTSynonymFactory(){
> 
>        // this.syns= ArrayListMultimap.create();
>     }
> 
>     final static Logger log = Logger.getLogger(**DTSynonymFactory.class.**
> getName());
> 
>     private static TokenizerFactory loadTokenizerFactory(* *ResourceLoader
> loader, String cname, Map<String, String> args) {
>         TokenizerFactory tokFactory = (TokenizerFactory)
> loader.newInstance(cname);
>         tokFactory.init(args);
>         return tokFactory;
>     }
>     private ArrayListMultimap<String, Synonym> syns = null;
> 
>     public DTSynonymFilter create(TokenStream input) {
> 
>         Thread.dumpStack();
>         try {
>             Thread.sleep(5000);
>         } catch (InterruptedException ex) {
> 
> Logger.getLogger(**DTSynonymFactory.class.**getName()).log(Level.SEVERE,
> null, ex);
>         }
>         if(syns!=null){
>             System.out.println("in create() syns is "+syns+" syns size is
> "+" " );
>             return new DTSynonymFilter(input,syns);
>         }
>         else{
>             System.out.println("in create() syns is "+syns+" and informed
> is
> "+informed);
>             return new DTSynonymFilter(input,null);
> 
> 
>         }
>   }
>     @Override
>     public void inform(ResourceLoader loader) {
> 
>          synonyms = args.get("FreskoFunction");
>         System.out.println("in DTSynonymFilter.inform() synonyms file is
> "+synonyms);
>         boolean ignoreCase = getBoolean("ignoreCase", false);
>          System.out.println("in DTSynonymFilter.inform() ignoreCase is
> "+ignoreCase);
>         boolean expand = getBoolean("expand", true);
>         System.out.println("in DTSynonymFilter.inform() expand is
> "+expand);
>         //String seperator =
>         String tf = args.get("tokenizerFactory");
> 
>         TokenizerFactory tokFactory = null;
>         if (tf != null) {
>             tokFactory = loadTokenizerFactory(loader, tf, args);
>         }
>         if (tf != null) {
>             System.out.println("**TokenizerFactory loaded ");
>         }
>         if (synonyms != null) {
>             List<String> wlist = null;
>             try {
>                 File synonymFile = new File(synonyms);
>                 if (synonymFile.exists()) {
>                     wlist = loader.getLines(synonyms);
>                 } else {
>                     List<String> files = StrUtils.splitFileNames(**
> synonyms);
>                     for (String file : files) {
>                         wlist = loader.getLines(file.trim());
>                     }
>                 }
>             } catch (Exception e) {
>                 e.printStackTrace();
> 
>                 throw new RuntimeException(e);
> 
>             }
>             syns = ArrayListMultimap.create();
>             populateSynMap("\\|", wlist);
>             if(syns==null){
>                 System.out.println("sysns after create and populate is
> null!!!!!!");
>                 Thread.sleep(5000);
> 
> 
>             }
>             else{
>                 System.out.println("after crete the size of syns is
> "+syns.size());
>                 informed=true;
>             }
> 
>         // synMap = new SynonymMap(ignoreCase);
>         // parseRules(wlist, synMap, "=>", ",", expand,tokFactory);
>         }
>         else{
>             throw new RuntimeException("Could not find synonyms");
>         }
>         }catch(Exception e){
>            e.printStackTrace();
>            throw  new RuntimeException(e);
>         }
>     }
> 
> 
>         }
> 
>     }
> }
> 
> * Thanks in advance


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42911-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 09:41:35 2009
Return-Path: <java-user-return-42911-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90616 invoked from network); 18 Oct 2009 09:41:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 09:41:35 -0000
Received: (qmail 36142 invoked by uid 500); 18 Oct 2009 09:41:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 36062 invoked by uid 500); 18 Oct 2009 09:41:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 36052 invoked by uid 99); 18 Oct 2009 09:41:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 09:41:32 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of davidginzburg@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 09:41:29 +0000
Received: by pwi12 with SMTP id 12so455251pwi.5
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 02:41:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=DfwfhSDvxXkaaOaTWNAS0o3WXko4gq0umZi6Mz8FyN8=;
        b=KiOyVHKV+ktWU3deR83GN6ftOxr334ITGbq1ho498PqlDaZFNwnVrsJY6EnTDgQ/P6
         xl9BMjxtxx6WJBnwU9eOM4bz8d02QBSJB5ybCyOWQQplWURFYa2x/xxJkxCP+jugUeYb
         JoQGPaLJMDn7/ckqGYh6AlZCS1PwzYfkwswDs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=XC0f8/etU5cl5FqJxmFO2y/LHREWo3rXQB5x0Qva+xWXqsErt2VcFSXKd9UcO7Y2Ky
         mwImliSGVYijwMj81kqtyjgTztdNIQsBxT4a9i0Mky7goAWvlgg2tdW25MBI8AFc4lYB
         QrHYV1yKoiCjDfS+RZYWOVYdE2Z+ErbtGcgk0=
MIME-Version: 1.0
Received: by 10.140.208.20 with SMTP id f20mr1492160rvg.126.1255858869085; 
	Sun, 18 Oct 2009 02:41:09 -0700 (PDT)
In-Reply-To: <411EE6F183234AB1A0013D456931F444@VEGA>
References: <8d3740db0910171727h5893a77m5504783b72442853@mail.gmail.com> 
	<411EE6F183234AB1A0013D456931F444@VEGA>
From: David Ginzburg <davidginzburg@gmail.com>
Date: Sun, 18 Oct 2009 11:40:49 +0200
Message-ID: <8d3740db0910180240l35dc721dg496f1ce7c482cde4@mail.gmail.com>
Subject: Re: localToken contains a termBuffer with 10 empty chars ('')
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd211d4c7a7610476326d8c

--000e0cd211d4c7a7610476326d8c
Content-Type: text/plain; charset=ISO-8859-1

Sorry,What does it mean, to respect the termLength() ?

On Sun, Oct 18, 2009 at 11:37 AM, Uwe Schindler <uwe@thetaphi.de> wrote:

> You must also respect termLength() which returns the number of "valid"
> chars
> in the term buffer.
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
> > -----Original Message-----
> > From: David Ginzburg [mailto:davidginzburg@gmail.com]
> > Sent: Sunday, October 18, 2009 2:28 AM
> > To: java-user@lucene.apache.org
> > Subject: localToken contains a termBuffer with 10 empty chars ('')
> >
> > Hi,
> > I have written a my own weighted synonym filter and tried to integrate it
> > inside an analyzer.
> > The analyzer as defined in the schema.xml is:
> >
> >
> >
> >
> > the field type is
> > *<fieldType name="Company_Name" class="solr.TextField"
> > positionIncrementGap="100" >
> >       <analyzer type="index">
> >         <tokenizer class="solr.**WhitespaceTokenizerFactory"/>
> >         **
> >         <filter class="DTSynonymFactory"
> > FreskoFunction="**SimilarityProbManual.txt"
> > ignoreCase="true" expand="false"/>
> >
> >         <!--<filter class="solr.**EnglishPorterFilterFactory"
> > protected="protwords.txt"/>-->
> >         <!--<filter
> class="solr.**RemoveDuplicatesTokenFilterFac**tory"/>-
> > ->
> >       </analyzer>
> >       <analyzer type="query">
> >         <tokenizer class="solr.**StandardTokenizerFactory"/>
> >         <filter class="solr.**LowerCaseFilterFactory"/>
> >         <filter class="solr.StopFilterFactory" ignoreCase="true"
> > words="stopwords.txt"/>
> >         <!--<filter class="solr.**EnglishPorterFilterFactory"
> > protected="protwords.txt"/>-->
> >         <!--<filter class="solr.**RemoveDuplicatesTokenFilterFac**tory"/
> > >-->
> >       </analyzer>
> >     </fieldType>*
> >
> >
> > The problem is that I always get in the  Token next(Token reusableToken)
> > method in  DTSynonymFilter  a token with a termBuffer containing  10 emty
> > chars.
> > *
> > *
> > *I have debugged and stepped into Solr code and found that *
> > *in class DocInverterPerField
> >  Token token = stream.next(localToken); line 134*
> > *
> > localToken contains a termBuffer with 10 empty chars ('')*
> >
> > *What am I doing wrong ???
> > *
> > The java code:
> > *
> > import com.google.common.collect.**ArrayListMultimap;
> > import java.io.IOException;
> > import java.util.LinkedList;
> > import java.util.List;
> > import org.apache.lucene.analysis.**Token;
> > import org.apache.lucene.analysis.**TokenFilter;
> > import org.apache.lucene.analysis.**TokenStream;
> > import org.apache.lucene.analysis.**payloads.PayloadHelper;
> > import org.apache.lucene.index.**Payload;
> >
> > /**
> >  *
> >  * @author david
> >  */
> > public class DTSynonymFilter extends TokenFilter {
> >
> >     public DTSynonymFilter(TokenStream input, ArrayListMultimap<String,
> > Synonym> syns) {
> >         super(input);
> >         this.synsMap = syns;
> >         System.out.println("in DTSynonymFilter synsMap ");
> >
> >
> >
> >     }
> >     public static final String SYNONYM = "<SYNONYM>";
> >     TokenFilter tf;
> >     private LinkedList<Token> synonymTokenQueue = new
> LinkedList<Token>();
> >
> >     private ArrayListMultimap<String, Synonym> synsMap = null;
> >     private LinkedList<Token> buffer;
> >
> >     private Token nextTok(Token target) throws IOException {
> >
> >         if (buffer != null && !buffer.isEmpty()) {
> >             return buffer.removeFirst();
> >         } else {
> >             return input.next(target);
> >         }
> >     }
> >
> >     private void pushTok(Token t) {
> >         if (buffer == null) {
> >             buffer = new LinkedList<Token>();
> >
> >         }
> >         buffer.addFirst(t);
> >     }
> >
> >     @Override
> >     public Token next(Token reusableToken) throws IOException {
> >
> >         if (synonymTokenQueue.size() > 0) {
> >
> >             return synonymTokenQueue.removeFirst(* *);
> >
> >         }
> >         if (reusableToken == null) {
> >             return null;
> >         }
> >
> >         reusableToken.setPayload(new Payload(new byte[]{(byte) 1}));
> >
> >       //   System.out.println("trying to get synonyms for
> > "+reusableToken);
> >       //    System.out.println(synsMap.* *get(reusableToken.term()));
> >         List<Synonym> syns = synsMap.get(reusableToken.**term());
> >        for (Synonym synonym : synsMap.get(reusableToken.**term())) {
> >                 System.out.println(synonym);
> >             }
> >         Payload boostPayload;
> >
> >         for (Synonym synonym : syns) {
> >             //Token(char[] startTermBuffer, int termBufferOffset, int
> > termBufferLength, int start, int end)
> >            // Token synToken = new
> > Token(synonym.getToken().**toCharArray(),
> > reusableToken.startOffset(), reusableToken.endOffset(),
> > synonym.getToken().length(), 0);//, t.startOffset(), t.endOffset(),
> > SYNONYM);
> >             Token newTok = new Token(reusableToken.**startOffset(),
> > reusableToken.endOffset(), SYNONYM);
> >             newTok.setTermBuffer(synonym.**getToken().toCharArray(), 0,
> > synonym.getToken().length());
> >             // set the position increment to zero
> >             // this tells lucene the synonym is
> >             // in the exact same location as the originating word
> >             newTok.setPositionIncrement(0)**;
> >             boostPayload = new Payload(PayloadHelper.**
> > encodeFloat(synonym.getWieght(**)));
> >             newTok.setPayload(**boostPayload);
> >             synonymTokenQueue.add(newTok);
> >
> >         }
> >         return reusableToken;
> >
> >
> >
> >
> >
> >
> >
> >
> >     }
> > }
> >
> >
> > import DTSynonymFilter;
> > import com.google.common.collect.**ArrayListMultimap;
> > import java.io.File;
> > import java.io.IOException;
> > import java.util.List;
> > import java.util.Map;
> > import java.util.logging.Level;
> > import java.util.logging.Logger;
> > import org.apache.lucene.analysis.**Token;
> > import org.apache.lucene.analysis.**TokenStream;
> > import org.apache.solr.analysis.**BaseTokenFilterFactory;
> > import org.apache.solr.analysis.**TokenizerFactory;
> > import org.apache.solr.common.**ResourceLoader;
> > import org.apache.solr.common.util.**StrUtils;
> > import org.apache.solr.util.plugin.**ResourceLoaderAware;
> >
> > /**
> >  *
> >  * @author david
> >  */
> > public class DTSynonymFactory extends BaseTokenFilterFactory implements
> > ResourceLoaderAware {
> >
> >     boolean informed=false;
> >     String synonyms=null;
> >
> >     public DTSynonymFactory(){
> >
> >        // this.syns= ArrayListMultimap.create();
> >     }
> >
> >     final static Logger log =
> Logger.getLogger(**DTSynonymFactory.class.**
> > getName());
> >
> >     private static TokenizerFactory loadTokenizerFactory(*
> *ResourceLoader
> > loader, String cname, Map<String, String> args) {
> >         TokenizerFactory tokFactory = (TokenizerFactory)
> > loader.newInstance(cname);
> >         tokFactory.init(args);
> >         return tokFactory;
> >     }
> >     private ArrayListMultimap<String, Synonym> syns = null;
> >
> >     public DTSynonymFilter create(TokenStream input) {
> >
> >         Thread.dumpStack();
> >         try {
> >             Thread.sleep(5000);
> >         } catch (InterruptedException ex) {
> >
> > Logger.getLogger(**DTSynonymFactory.class.**getName()).log(Level.SEVERE,
> > null, ex);
> >         }
> >         if(syns!=null){
> >             System.out.println("in create() syns is "+syns+" syns size is
> > "+" " );
> >             return new DTSynonymFilter(input,syns);
> >         }
> >         else{
> >             System.out.println("in create() syns is "+syns+" and informed
> > is
> > "+informed);
> >             return new DTSynonymFilter(input,null);
> >
> >
> >         }
> >   }
> >     @Override
> >     public void inform(ResourceLoader loader) {
> >
> >          synonyms = args.get("FreskoFunction");
> >         System.out.println("in DTSynonymFilter.inform() synonyms file is
> > "+synonyms);
> >         boolean ignoreCase = getBoolean("ignoreCase", false);
> >          System.out.println("in DTSynonymFilter.inform() ignoreCase is
> > "+ignoreCase);
> >         boolean expand = getBoolean("expand", true);
> >         System.out.println("in DTSynonymFilter.inform() expand is
> > "+expand);
> >         //String seperator =
> >         String tf = args.get("tokenizerFactory");
> >
> >         TokenizerFactory tokFactory = null;
> >         if (tf != null) {
> >             tokFactory = loadTokenizerFactory(loader, tf, args);
> >         }
> >         if (tf != null) {
> >             System.out.println("**TokenizerFactory loaded ");
> >         }
> >         if (synonyms != null) {
> >             List<String> wlist = null;
> >             try {
> >                 File synonymFile = new File(synonyms);
> >                 if (synonymFile.exists()) {
> >                     wlist = loader.getLines(synonyms);
> >                 } else {
> >                     List<String> files = StrUtils.splitFileNames(**
> > synonyms);
> >                     for (String file : files) {
> >                         wlist = loader.getLines(file.trim());
> >                     }
> >                 }
> >             } catch (Exception e) {
> >                 e.printStackTrace();
> >
> >                 throw new RuntimeException(e);
> >
> >             }
> >             syns = ArrayListMultimap.create();
> >             populateSynMap("\\|", wlist);
> >             if(syns==null){
> >                 System.out.println("sysns after create and populate is
> > null!!!!!!");
> >                 Thread.sleep(5000);
> >
> >
> >             }
> >             else{
> >                 System.out.println("after crete the size of syns is
> > "+syns.size());
> >                 informed=true;
> >             }
> >
> >         // synMap = new SynonymMap(ignoreCase);
> >         // parseRules(wlist, synMap, "=>", ",", expand,tokFactory);
> >         }
> >         else{
> >             throw new RuntimeException("Could not find synonyms");
> >         }
> >         }catch(Exception e){
> >            e.printStackTrace();
> >            throw  new RuntimeException(e);
> >         }
> >     }
> >
> >
> >         }
> >
> >     }
> > }
> >
> > * Thanks in advance
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
All that is necessary for evil to triumph is for good men to do nothing

--000e0cd211d4c7a7610476326d8c--

From java-user-return-42912-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 09:47:07 2009
Return-Path: <java-user-return-42912-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91413 invoked from network); 18 Oct 2009 09:47:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 09:47:07 -0000
Received: (qmail 40920 invoked by uid 500); 18 Oct 2009 09:47:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40841 invoked by uid 500); 18 Oct 2009 09:47:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40831 invoked by uid 99); 18 Oct 2009 09:47:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 09:47:05 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 09:47:02 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id BE85E45F15C
	for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 11:46:38 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id iRbezOilEQsX for <java-user@lucene.apache.org>;
	Sun, 18 Oct 2009 11:46:30 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 1699345F15A
	for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 11:46:30 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <8d3740db0910171727h5893a77m5504783b72442853@mail.gmail.com> <411EE6F183234AB1A0013D456931F444@VEGA> <8d3740db0910180240l35dc721dg496f1ce7c482cde4@mail.gmail.com>
Subject: RE: localToken contains a termBuffer with 10 empty chars ('')
Date: Sun, 18 Oct 2009 11:46:31 +0200
Message-ID: <6C956E70E6E54913AC0AA070FAF23B57@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <8d3740db0910180240l35dc721dg496f1ce7c482cde4@mail.gmail.com>
Thread-Index: AcpP1zduxpauB1AsTpeqFtu2NP4TDQAACSoQ
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

The termBuffer is just a buffer of a arbitrary length (the length is
over-allocated with some additional chars, that a new buffer does not need
to be allocated whenever a new char is added (it woks the same like
stringbuffer). The termLength() contains the number of "valid" chars in the
buffer. If you have an empty Token, the termLength()==0 and it is irrelevant
what the buffer contains and how long it is. If there is 5 chars in, the
size of the buffer is 10, but termLength() returns 5, so you know, that 5
chars are valid. The rest of 5 chars at the end of the buffer is just
garbage.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: David Ginzburg [mailto:davidginzburg@gmail.com]
> Sent: Sunday, October 18, 2009 11:41 AM
> To: java-user@lucene.apache.org
> Subject: Re: localToken contains a termBuffer with 10 empty chars ('')
> 
> Sorry,What does it mean, to respect the termLength() ?
> 
> On Sun, Oct 18, 2009 at 11:37 AM, Uwe Schindler <uwe@thetaphi.de> wrote:
> 
> > You must also respect termLength() which returns the number of "valid"
> > chars
> > in the term buffer.
> >
> > -----
> > Uwe Schindler
> > H.-H.-Meier-Allee 63, D-28213 Bremen
> > http://www.thetaphi.de
> > eMail: uwe@thetaphi.de
> >
> > > -----Original Message-----
> > > From: David Ginzburg [mailto:davidginzburg@gmail.com]
> > > Sent: Sunday, October 18, 2009 2:28 AM
> > > To: java-user@lucene.apache.org
> > > Subject: localToken contains a termBuffer with 10 empty chars ('')
> > >
> > > Hi,
> > > I have written a my own weighted synonym filter and tried to integrate
> it
> > > inside an analyzer.
> > > The analyzer as defined in the schema.xml is:
> > >
> > >
> > >
> > >
> > > the field type is
> > > *<fieldType name="Company_Name" class="solr.TextField"
> > > positionIncrementGap="100" >
> > >       <analyzer type="index">
> > >         <tokenizer class="solr.**WhitespaceTokenizerFactory"/>
> > >         **
> > >         <filter class="DTSynonymFactory"
> > > FreskoFunction="**SimilarityProbManual.txt"
> > > ignoreCase="true" expand="false"/>
> > >
> > >         <!--<filter class="solr.**EnglishPorterFilterFactory"
> > > protected="protwords.txt"/>-->
> > >         <!--<filter
> > class="solr.**RemoveDuplicatesTokenFilterFac**tory"/>-
> > > ->
> > >       </analyzer>
> > >       <analyzer type="query">
> > >         <tokenizer class="solr.**StandardTokenizerFactory"/>
> > >         <filter class="solr.**LowerCaseFilterFactory"/>
> > >         <filter class="solr.StopFilterFactory" ignoreCase="true"
> > > words="stopwords.txt"/>
> > >         <!--<filter class="solr.**EnglishPorterFilterFactory"
> > > protected="protwords.txt"/>-->
> > >         <!--<filter
> class="solr.**RemoveDuplicatesTokenFilterFac**tory"/
> > > >-->
> > >       </analyzer>
> > >     </fieldType>*
> > >
> > >
> > > The problem is that I always get in the  Token next(Token
> reusableToken)
> > > method in  DTSynonymFilter  a token with a termBuffer containing  10
> emty
> > > chars.
> > > *
> > > *
> > > *I have debugged and stepped into Solr code and found that *
> > > *in class DocInverterPerField
> > >  Token token = stream.next(localToken); line 134*
> > > *
> > > localToken contains a termBuffer with 10 empty chars ('')*
> > >
> > > *What am I doing wrong ???
> > > *
> > > The java code:
> > > *
> > > import com.google.common.collect.**ArrayListMultimap;
> > > import java.io.IOException;
> > > import java.util.LinkedList;
> > > import java.util.List;
> > > import org.apache.lucene.analysis.**Token;
> > > import org.apache.lucene.analysis.**TokenFilter;
> > > import org.apache.lucene.analysis.**TokenStream;
> > > import org.apache.lucene.analysis.**payloads.PayloadHelper;
> > > import org.apache.lucene.index.**Payload;
> > >
> > > /**
> > >  *
> > >  * @author david
> > >  */
> > > public class DTSynonymFilter extends TokenFilter {
> > >
> > >     public DTSynonymFilter(TokenStream input,
> ArrayListMultimap<String,
> > > Synonym> syns) {
> > >         super(input);
> > >         this.synsMap = syns;
> > >         System.out.println("in DTSynonymFilter synsMap ");
> > >
> > >
> > >
> > >     }
> > >     public static final String SYNONYM = "<SYNONYM>";
> > >     TokenFilter tf;
> > >     private LinkedList<Token> synonymTokenQueue = new
> > LinkedList<Token>();
> > >
> > >     private ArrayListMultimap<String, Synonym> synsMap = null;
> > >     private LinkedList<Token> buffer;
> > >
> > >     private Token nextTok(Token target) throws IOException {
> > >
> > >         if (buffer != null && !buffer.isEmpty()) {
> > >             return buffer.removeFirst();
> > >         } else {
> > >             return input.next(target);
> > >         }
> > >     }
> > >
> > >     private void pushTok(Token t) {
> > >         if (buffer == null) {
> > >             buffer = new LinkedList<Token>();
> > >
> > >         }
> > >         buffer.addFirst(t);
> > >     }
> > >
> > >     @Override
> > >     public Token next(Token reusableToken) throws IOException {
> > >
> > >         if (synonymTokenQueue.size() > 0) {
> > >
> > >             return synonymTokenQueue.removeFirst(* *);
> > >
> > >         }
> > >         if (reusableToken == null) {
> > >             return null;
> > >         }
> > >
> > >         reusableToken.setPayload(new Payload(new byte[]{(byte) 1}));
> > >
> > >       //   System.out.println("trying to get synonyms for
> > > "+reusableToken);
> > >       //    System.out.println(synsMap.* *get(reusableToken.term()));
> > >         List<Synonym> syns = synsMap.get(reusableToken.**term());
> > >        for (Synonym synonym : synsMap.get(reusableToken.**term())) {
> > >                 System.out.println(synonym);
> > >             }
> > >         Payload boostPayload;
> > >
> > >         for (Synonym synonym : syns) {
> > >             //Token(char[] startTermBuffer, int termBufferOffset, int
> > > termBufferLength, int start, int end)
> > >            // Token synToken = new
> > > Token(synonym.getToken().**toCharArray(),
> > > reusableToken.startOffset(), reusableToken.endOffset(),
> > > synonym.getToken().length(), 0);//, t.startOffset(), t.endOffset(),
> > > SYNONYM);
> > >             Token newTok = new Token(reusableToken.**startOffset(),
> > > reusableToken.endOffset(), SYNONYM);
> > >             newTok.setTermBuffer(synonym.**getToken().toCharArray(),
> 0,
> > > synonym.getToken().length());
> > >             // set the position increment to zero
> > >             // this tells lucene the synonym is
> > >             // in the exact same location as the originating word
> > >             newTok.setPositionIncrement(0)**;
> > >             boostPayload = new Payload(PayloadHelper.**
> > > encodeFloat(synonym.getWieght(**)));
> > >             newTok.setPayload(**boostPayload);
> > >             synonymTokenQueue.add(newTok);
> > >
> > >         }
> > >         return reusableToken;
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >     }
> > > }
> > >
> > >
> > > import DTSynonymFilter;
> > > import com.google.common.collect.**ArrayListMultimap;
> > > import java.io.File;
> > > import java.io.IOException;
> > > import java.util.List;
> > > import java.util.Map;
> > > import java.util.logging.Level;
> > > import java.util.logging.Logger;
> > > import org.apache.lucene.analysis.**Token;
> > > import org.apache.lucene.analysis.**TokenStream;
> > > import org.apache.solr.analysis.**BaseTokenFilterFactory;
> > > import org.apache.solr.analysis.**TokenizerFactory;
> > > import org.apache.solr.common.**ResourceLoader;
> > > import org.apache.solr.common.util.**StrUtils;
> > > import org.apache.solr.util.plugin.**ResourceLoaderAware;
> > >
> > > /**
> > >  *
> > >  * @author david
> > >  */
> > > public class DTSynonymFactory extends BaseTokenFilterFactory
> implements
> > > ResourceLoaderAware {
> > >
> > >     boolean informed=false;
> > >     String synonyms=null;
> > >
> > >     public DTSynonymFactory(){
> > >
> > >        // this.syns= ArrayListMultimap.create();
> > >     }
> > >
> > >     final static Logger log =
> > Logger.getLogger(**DTSynonymFactory.class.**
> > > getName());
> > >
> > >     private static TokenizerFactory loadTokenizerFactory(*
> > *ResourceLoader
> > > loader, String cname, Map<String, String> args) {
> > >         TokenizerFactory tokFactory = (TokenizerFactory)
> > > loader.newInstance(cname);
> > >         tokFactory.init(args);
> > >         return tokFactory;
> > >     }
> > >     private ArrayListMultimap<String, Synonym> syns = null;
> > >
> > >     public DTSynonymFilter create(TokenStream input) {
> > >
> > >         Thread.dumpStack();
> > >         try {
> > >             Thread.sleep(5000);
> > >         } catch (InterruptedException ex) {
> > >
> > >
> Logger.getLogger(**DTSynonymFactory.class.**getName()).log(Level.SEVERE,
> > > null, ex);
> > >         }
> > >         if(syns!=null){
> > >             System.out.println("in create() syns is "+syns+" syns size
> is
> > > "+" " );
> > >             return new DTSynonymFilter(input,syns);
> > >         }
> > >         else{
> > >             System.out.println("in create() syns is "+syns+" and
> informed
> > > is
> > > "+informed);
> > >             return new DTSynonymFilter(input,null);
> > >
> > >
> > >         }
> > >   }
> > >     @Override
> > >     public void inform(ResourceLoader loader) {
> > >
> > >          synonyms = args.get("FreskoFunction");
> > >         System.out.println("in DTSynonymFilter.inform() synonyms file
> is
> > > "+synonyms);
> > >         boolean ignoreCase = getBoolean("ignoreCase", false);
> > >          System.out.println("in DTSynonymFilter.inform() ignoreCase is
> > > "+ignoreCase);
> > >         boolean expand = getBoolean("expand", true);
> > >         System.out.println("in DTSynonymFilter.inform() expand is
> > > "+expand);
> > >         //String seperator =
> > >         String tf = args.get("tokenizerFactory");
> > >
> > >         TokenizerFactory tokFactory = null;
> > >         if (tf != null) {
> > >             tokFactory = loadTokenizerFactory(loader, tf, args);
> > >         }
> > >         if (tf != null) {
> > >             System.out.println("**TokenizerFactory loaded ");
> > >         }
> > >         if (synonyms != null) {
> > >             List<String> wlist = null;
> > >             try {
> > >                 File synonymFile = new File(synonyms);
> > >                 if (synonymFile.exists()) {
> > >                     wlist = loader.getLines(synonyms);
> > >                 } else {
> > >                     List<String> files = StrUtils.splitFileNames(**
> > > synonyms);
> > >                     for (String file : files) {
> > >                         wlist = loader.getLines(file.trim());
> > >                     }
> > >                 }
> > >             } catch (Exception e) {
> > >                 e.printStackTrace();
> > >
> > >                 throw new RuntimeException(e);
> > >
> > >             }
> > >             syns = ArrayListMultimap.create();
> > >             populateSynMap("\\|", wlist);
> > >             if(syns==null){
> > >                 System.out.println("sysns after create and populate is
> > > null!!!!!!");
> > >                 Thread.sleep(5000);
> > >
> > >
> > >             }
> > >             else{
> > >                 System.out.println("after crete the size of syns is
> > > "+syns.size());
> > >                 informed=true;
> > >             }
> > >
> > >         // synMap = new SynonymMap(ignoreCase);
> > >         // parseRules(wlist, synMap, "=>", ",", expand,tokFactory);
> > >         }
> > >         else{
> > >             throw new RuntimeException("Could not find synonyms");
> > >         }
> > >         }catch(Exception e){
> > >            e.printStackTrace();
> > >            throw  new RuntimeException(e);
> > >         }
> > >     }
> > >
> > >
> > >         }
> > >
> > >     }
> > > }
> > >
> > > * Thanks in advance
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> 
> 
> --
> All that is necessary for evil to triumph is for good men to do nothing


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42913-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 13:11:12 2009
Return-Path: <java-user-return-42913-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25693 invoked from network); 18 Oct 2009 13:11:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 13:11:11 -0000
Received: (qmail 21463 invoked by uid 500); 18 Oct 2009 13:11:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21385 invoked by uid 500); 18 Oct 2009 13:11:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21375 invoked by uid 99); 18 Oct 2009 13:11:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 13:11:09 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 13:11:00 +0000
Received: by gxk19 with SMTP id 19so3617420gxk.5
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 06:10:38 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.233.2 with SMTP id f2mr6045472ybh.259.1255871438070; Sun, 
	18 Oct 2009 06:10:38 -0700 (PDT)
In-Reply-To: <4ACEF8B9.2030202@stimulussoft.com>
References: <4ACEF8B9.2030202@stimulussoft.com>
Date: Sun, 18 Oct 2009 09:10:38 -0400
Message-ID: <9ac0c6aa0910180610n77832f52x45c4e0befc6fe5c4@mail.gmail.com>
Subject: Re: Index.close() infinite TIME_WAITING
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Jamie did you ever get to the bottom of this?

Can you reduce this code down to a smaller example that shows the hang?

Also, can you post a thread stack dump when you hit the hang?

Is it possible you are adding documents from one thread while calling
IndexWriter.close in another?  I see you have "catch
AlreadyClosedException" when adding docs -- do you ever actually hit
that?

Mike

On Fri, Oct 9, 2009 at 4:47 AM, Jamie Band <jamie@stimulussoft.com> wrote:
> Hi Michael
>
> Thanks for your help. Here are the stacks:
>
> index processor [TIME_WAITING] CPU time: 33:01
> java.lang.Object.wait(long)
> org.apache.lucene.index.IndexWriter.doWait()
> org.apache.lucene.index.IndexWriter.shouldClose()
> org.apache.lucene.index.IndexWriter.close(boolean)
> org.apache.lucene.index.IndexWriter.close()
> com.stimulus.archiva.index.VolumeIndex.closeIndex()
> com.stimulus.archiva.index.VolumeIndex$IndexProcessor.run()
>
> The source code to our indexer is attached. As you can see, documents are
> added to a blocking queue. The index processor thread takes it out of the
> queue and processes it. After about 60k documents IndexWriter's close met=
hod
> enters TIME_WAITING indefinitely. It there any workaround to this problem=
?
>
>
> package com.stimulus.archiva.index;
>
> import java.io.File;
> import java.io.IOException;
> import java.io.PrintStream;
> import javax.mail.MessagingException;
> import org.apache.commons.logging.*;
> import org.apache.lucene.document.Document;
> import org.apache.lucene.index.*;
> import org.apache.lucene.store.FSDirectory;
> import com.stimulus.archiva.domain.Config;
> import com.stimulus.archiva.domain.Email;
> import com.stimulus.archiva.domain.EmailID;
> import com.stimulus.archiva.domain.Indexer;
> import com.stimulus.archiva.domain.Volume;
> import com.stimulus.archiva.exception.*;
> import com.stimulus.archiva.language.AnalyzerFactory;
> import com.stimulus.archiva.search.*;
> import java.util.*;
> import java.util.concurrent.ExecutorService;
> import java.util.concurrent.Executors;
> import java.util.concurrent.ScheduledExecutorService;
> import java.util.concurrent.ScheduledFuture;
> import java.util.concurrent.TimeUnit;
> import org.apache.lucene.store.LockObtainFailedException;
> import org.apache.lucene.store.AlreadyClosedException;
> import java.util.concurrent.locks.ReentrantLock;
> import java.util.concurrent.*;
>
> public class VolumeIndex extends Thread {
> =A0 =A0 =A0 =A0 =A0protected ArrayBlockingQueue<IndexInfo> queue;
> =A0 =A0 =A0 =A0protected static final Log logger =3D
> LogFactory.getLog(VolumeIndex.class.getName());
> =A0 =A0 =A0 =A0 =A0 IndexWriter writer =3D null;
> =A0 =A0 =A0 =A0 =A0 Volume volume;
> =A0 =A0 =A0 =A0 =A0 protected static ScheduledExecutorService scheduler;
> =A0 =A0 =A0 =A0protected static ScheduledFuture<?> scheduledTask;
> =A0 =A0 =A0 =A0protected static IndexInfo EXIT_REQ =3D new IndexInfo(null=
);
> =A0 =A0 =A0 =A0ReentrantLock indexLock =3D new ReentrantLock();
> =A0 =A0 =A0 =A0ArchivaAnalyzer analyzer =A0 =A0 =3D new ArchivaAnalyzer()=
;
> =A0 =A0 =A0 =A0Indexer indexer =3D null;
> =A0 =A0 =A0 =A0File indexLogFile;
> =A0 =A0 =A0 =A0PrintStream indexLogOut;
> =A0 =A0 =A0 =A0IndexProcessor indexProcessor;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public VolumeIndex(Indexe=
r indexer, Volume volume) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("creating new volume index {"+vo=
lume+"}");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.volume =3D volume;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.indexer =3D indexer;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.queue =3D new
> ArrayBlockingQueue<IndexInfo>(Config.getConfig().getIndex().getIndexBackl=
og());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLogFile =3D getIndexLogFile(volu=
me);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexLogFile!=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexLogFile.length()>104=
85760)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLogFile.delete()=
;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLogOut =3D new PrintStre=
am(indexLogFile);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("set index log file path
> {path=3D'"+indexLogFile.getCanonicalPath()+"'}");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to open index lo=
g
> file:"+e.getMessage(),e);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 startup();
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 protected File getIndexLogFile(Volume volume)=
 {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String indexpath =3D volume.getIndexP=
ath();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int lio =3D indexpath.lastIndexOf(Fil=
e.separator)+1;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String logfilepath =3D
> indexpath.substring(lio,indexpath.length()-1);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logfilepath +=3D ".log";
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logfilepath =3D "index_"+logfilepath;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logfilepath =3D
> Config.getFileSystem().getLogPath()+File.separator+logfilepath;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 return new File(logfilepath);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to open index lo=
g
> file:"+e.getMessage(),e);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 return null;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0public void deleteMessages(List<String> id=
s) throws
> MessageSearchException {
> =A0 =A0 =A0 =A0 =A0 =A0 if (ids =3D=3D null)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("ass=
ertion failure: null
> ids",logger);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Term[] terms =3D new Term=
[ids.size()];
> =A0 =A0 =A0 =A0 =A0 =A0 int c =3D 0;
> =A0 =A0 =A0 =A0 =A0 =A0 StringBuffer deleteInfo =3D new StringBuffer();
> =A0 =A0 =A0 =A0 =A0 =A0 for (String id : ids) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 terms[c++] =3D new Term("uid",id);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 deleteInfo.append(id);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 deleteInfo.append(",");
> =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String deleteStr =3D dele=
teInfo.toString();
> =A0 =A0 =A0 =A0 =A0 =A0 if (deleteStr.length()>0 &&
> deleteStr.charAt(deleteStr.length()-1)=3D=3D',')
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 deleteStr =3D deleteStr.substring(0,delet=
eStr.length()-1);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("delete mess=
ages {'"+deleteInfo+"'}");
> =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.lock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 openIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.deleteDocuments(terms);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.expungeDeletes();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException(=
"failed to delete email
> from index.",e,logger);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 } finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 closeIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
> =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 protected void openIndex() throws MessageSear=
chException {
> =A0 =A0 =A0 =A0 =A0 =A0Exception lastError =3D null;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (writer=3D=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("openIndex() index will be opene=
d. it is
> currently closed.");
> =A0 =A0 =A0 =A0 =A0 } else {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("openIndex() did not bother open=
ing index. it is
> already open.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 return;
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 logger.debug("opening index for write {"+volume+"}");
> =A0 =A0 =A0 =A0 =A0 indexer.prepareIndex(volume);
> =A0 =A0 =A0 =A0 =A0 logger.debug("opening search index for write
> {indexpath=3D'"+volume.getIndexPath()+"'}");
> =A0 =A0 =A0 =A0 =A0 boolean writelock;
> =A0 =A0 =A0 =A0 =A0 int attempt =3D 0;
> =A0 =A0 =A0 =A0 =A0 int maxattempt =3D 10;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if
> (Config.getConfig().getIndex().getMultipleIndexProcesses()) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 maxattempt =3D 10000;
> =A0 =A0 =A0 =A0 =A0 =A0} else {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 maxattempt =3D 10;
> =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 do {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 writelock =3D false;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 FSDirectory fsDirectory =3D
> FSDirectory.getDirectory(volume.getIndexPath());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexChars =3D
> Config.getConfig().getIndex().getMaxIndexPerFieldChars();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer =3D new IndexWriter(fs=
Directory,analyzer,new
> IndexWriter.MaxFieldLength(maxIndexChars));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (logger.isDebugEnabled() &=
& indexLogOut!=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.setInfoStream(=
indexLogOut);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (LockObtainFailedException lobfe) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("write lock on i=
ndex. will reopen in
> 50ms.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try { Thread.sleep(50); } cat=
ch (Exception e) {}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 attempt++;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writelock =3D true;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (CorruptIndexException cie) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("ind=
ex appears to be
> corrupt. please reindex the active volume."+cie.getMessage(),logger);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("fai=
led to write document
> to index:"+io.getMessage(),logger);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0} while (writelock && attempt<maxattempt);
> =A0 =A0 =A0 =A0 =A0if (attempt>=3D10000)
> =A0 =A0 =A0 =A0 =A0 =A0throw new MessageSearchException("failed to open i=
ndex writer
> {location=3D'"+volume.getIndexPath()+"'}",lastError,logger);
> =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 public void indexMessage(Email message) throws
> MessageSearchException =A0{
> =A0 =A0 =A0 =A0 =A0 logger.debug("index message {"+message+"}");
> =A0 =A0 =A0 =A0 =A0 long s =3D (new Date()).getTime();
> =A0 =A0 =A0 =A0 =A0 if (message =3D=3D null)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("assertion f=
ailure: null
> message",logger);
> =A0 =A0 =A0 =A0 =A0 Document doc =3D new Document();
> =A0 =A0 =A0 =A0 =A0 IndexInfo indexInfo =3D new IndexInfo(doc);
> =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0DocumentIndex docIndex =3D new DocumentIndex(i=
ndexer);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0String language =3D doc.get("lang");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0if (language=3D=3Dnull)
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0language =3D indexer.getIndexLanguage(=
);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0docIndex.write(message,doc,indexInfo);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0queue.put(indexInfo);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.debug("message indexed successfully
> {"+message+",language=3D'"+language+"'}");
> =A0 =A0 =A0 =A0 =A0 } catch (MessagingException me) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0throw new MessageSearchException("failed to de=
code message
> during indexing",me,logger, ChainedException.Level.DEBUG);
> =A0 =A0 =A0 =A0 =A0 } catch (IOException me) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("failed to i=
ndex
> message"+me.getMessage()+" {"+message+"}",me,logger,
> ChainedException.Level.DEBUG);
> =A0 =A0 =A0 =A0 =A0 } catch (ExtractionException ee)
> =A0 =A0 =A0 =A0 =A0 {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 // we will want to continue indexing
> =A0 =A0 =A0 =A0 =A0 =A0 =A0//throw new MessageSearchException("failed to =
decode
> attachments in message {"+message+"}",ee,logger,
> ChainedException.Level.DEBUG);
> =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClosedException ace) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexMessage(message);
> =A0 =A0 =A0 =A0 =A0 } catch (Throwable e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 throw new MessageSearchException("failed to i=
ndex
> message:"+e.getMessage(),e,logger, ChainedException.Level.DEBUG);
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 logger.debug("indexing message end {"+message+"}");
> =A0 =A0 =A0 =A0 =A0 long e =3D (new Date()).getTime();
> =A0 =A0 =A0 =A0 =A0 logger.debug("indexing time {time=3D'"+(e-s)+"'}");
> =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 public class IndexProcessor extends Thread {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public IndexProcessor() {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 setName("index processor");
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 public void run() {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 boolean exit =3D false;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 //ExecutorService documentPool;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 // we abandoned pool as it does not seem to o=
ffer any major
> performance benefit
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 IndexInfo indexInfo =3D null;
> LinkedList<IndexInfo> pushbacks =3D new LinkedList<IndexInfo>();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 while (!exit) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 t=
ry {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexDocs =3D
> Config.getConfig().getIndex().getMaxSimultaneousDocs();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool =3D
> Executors.newFixedThreadPool(Config.getConfig().getArchiver().getArchiveT=
hreads());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo =3D null; =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo =3D
> (IndexInfo) queue.take();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexInfo=3D=3DEXIT_REQ) =
{
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index e=
xit req received. exiting");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 exit =3D true;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 continue;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 indexLock.lock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0openIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (Exception e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("fail=
ed to open
> index:"+e.getMessage(),e);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0return;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexInfo=3D=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index i=
nfo is null");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int i =3D 0;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 while(indexInfo!=3Dnull && i<=
maxIndexDocs) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDoc=
ument(indexInfo.getDocument());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException =
io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error(=
"failed to add document to
> index:"+io.getMessage(),io);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClose=
dException e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.add=
(indexInfo);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo.cle=
anup();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
>
> //documentPool.execute(new IndexDocument(indexInfo,pushbacks));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0i++;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (i<maxIndexDocs) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0indexInfo =
=3D (IndexInfo) queue.poll();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if
> (indexInfo=3D=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 logger.debug("index info is null");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if
> (indexInfo=3D=3DEXIT_REQ) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0logger.debug("index exit req
> received. exiting (2)");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 exit =3D true;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 break;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 for (IndexInfo pushback :
> pushbacks) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDoc=
ument(pushback.getDocument());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException =
io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error(=
"failed to add document to
> index:"+io.getMessage(),io);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClose=
dException e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.add=
(indexInfo);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexInfo.cle=
anup();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.execut=
e(new
> IndexDocument(pushback,pushbacks));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 i++;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.shutdown();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 //documentPool.awaitTerminati=
on(30,TimeUnit.MINUTES);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0} catch (Throwable ie) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("index write
> interrupted:"+ie.getMessage());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0closeIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public class IndexDocument extend=
s Thread {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 IndexInfo=
 indexInfo =3D null;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 List<IndexInfo> pushbacks =3D null;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 p=
ublic IndexDocument(IndexInfo
> indexInfo,List<IndexInfo> pushbacks) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.indexInfo =3D indexInfo;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 this.pushbacks =3D pushbacks;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 setName("index document");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public vo=
id run() {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.addDocument(in=
dexInfo.getDocument());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (IOException io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed =
to add document to
> index:"+io.getMessage(),io);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } catch (AlreadyClosedExcepti=
on e) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 pushbacks.add(indexIn=
fo);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }};
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 protected void closeIndex() {
> =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0if (writer!=3Dnull) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer.close();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("writer closed")=
;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer =3D null;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} catch (Exception io) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.error("failed to close index
> writer:"+io.getMessage(),io);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 public void deleteIndex() throws MessageSearchExcepti=
on {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.debug("delete index
> {indexpath=3D'"+volume.getIndexPath()+"'}");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.lock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 int maxIndexChars =3D
> Config.getConfig().getIndex().getMaxIndexPerFieldChars();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 writer =3D new
> IndexWriter(FSDirectory.getDirectory(volume.getIndexPath()),analyzer,true=
,new
> IndexWriter.MaxFieldLength(maxIndexChars));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0} catch (Exception cie) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0logger.error("failed to de=
lete index
> {index=3D'"+volume.getIndexPath()+"'}",cie);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0return;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0MessageIndex.volumeIndexes.remove(=
this);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 } finally {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 closeIndex();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 indexLock.unlock();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 public void startup() {
> =A0 =A0 =A0 =A0 =A0 logger.debug("volumeindex is starting up");
> =A0 =A0 =A0 =A0 =A0 File lockFile =3D new File(volume.getIndexPath()+File=
.separatorChar
> + "write.lock");
> =A0 =A0 =A0 =A0 =A0 if (lockFile.exists()) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("The server lock file already exi=
sts. Either
> another indexer is running or the server was not shutdown correctly.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("If it is the latter, the lock fi=
le must be
> manually deleted at "+lockFile.getAbsolutePath());
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 if (indexer.getMultipleIndexProcesses()) {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("index lock file detecte=
d on volumeindex
> startup.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 } else {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("index lock file detected=
. the server was
> shutdown incorrectly. automatically deleting lock file.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("indexer is configured to=
 deal with only one
> indexer process.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 logger.warn("if you are running more =
than one indexer,
> your index could be subject to corruption.");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 lockFile.delete();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 indexProcessor =3D new IndexProcessor();
> =A0 =A0 =A0 =A0 =A0 indexProcessor.start();
> =A0 =A0 =A0 =A0 =A0 Runtime.getRuntime().addShutdownHook(this);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 public vo=
id shutdown() {
> =A0 =A0 =A0 =A0 =A0 =A0 logger.debug("volumeindex is shutting down");
> =A0 =A0 =A0 =A0 =A0 =A0 queue.add(EXIT_REQ);
> =A0 =A0 =A0 =A0 =A0 =A0 scheduler.shutdownNow();
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 @Override
> =A0 =A0 =A0 =A0 public void run() {
> =A0 =A0 =A0 =A0 =A0 =A0 queue.add(EXIT_REQ);
> =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 =A0 =A0 =A0}
>
>
>
>
> Is it possible a large merge is running? =A0By default IW.close waits
> for outstanding merges to complete. =A0Can you post the stacktrace?
>
> Mike
>
> On Thu, Oct 8, 2009 at 5:22 PM, Jamie Band <jamie@stimulussoft.com> wrote=
:
>>
>> Hi All
>>
>> I have a long running situation where our indexing thread is getting stu=
ck
>> indefinitely in IndexWriter's close method. Yourkit shows the thread to =
be
>> stuck in TIME_WAITING. Any idea's on what could be causing this?
>> Could it be one of the streams or readers we passed to the document?
>>
>> I am running Lucene 2.9.0.
>>
>> Many thanks in advance
>>
>> Jamie
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42914-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 15:14:44 2009
Return-Path: <java-user-return-42914-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44015 invoked from network); 18 Oct 2009 15:14:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 15:14:44 -0000
Received: (qmail 90474 invoked by uid 500); 18 Oct 2009 15:14:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90390 invoked by uid 500); 18 Oct 2009 15:14:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90380 invoked by uid 99); 18 Oct 2009 15:14:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 15:14:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 15:14:32 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzXSV-0002Cx-DL
	for java-user@lucene.apache.org; Sun, 18 Oct 2009 08:14:11 -0700
Message-ID: <25947462.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 08:14:11 -0700 (PDT)
From: GlenAbbeyDrive <wende.long@gmail.com>
To: java-user@lucene.apache.org
Subject: Lucene 2.9.0 leaves too many .cfs files open, causing too many
 files open java error.
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: wende.long@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too many
files open within a few hours from my indexing process.  Our indexing Java
process adds about 2000 documents/minute. 
The IndexWriter (iw) has the following settings:

            iw.setMaxFieldLength(1024*1024*1024); // 1G as maximum terms.
            iw.setMergeFactor(10);
            iw.setMaxMergeDocs(100000);
            iw.setMaxBufferedDocs(1000);
            iw.setRAMBufferSizeMB(128);
            iw.setUseCompoundFile(true);



The 'lsof' result shows rapidly growing number of open files in 'deleted'
state. Counting the number of these:

[server-1]#date
Sun Oct 18 11:02:37 EDT 2009
[server-1]# lsof -p 19606 |grep deleted  |wc -l
3187
[server-1]# date
Sun Oct 18 11:07:29 EDT 2009
[server-1]# lsof -p 19606 |grep deleted  |wc -l
3912

Here is a sample of those open files left behind in 'deleted' state:

java    19606 root 1861r   REG       8,17    273561 368673054
/archive/index/_5fq.cfs (deleted)
java    19606 root 1862r   REG       8,17      9428 368673053
/archive/index/_5fp.cfs (deleted)
java    19606 root 1863r   REG       8,17    363690 368673052
/archive/index/_5fo.cfs (deleted)
java    19606 root 1864r   REG       8,17     47732 368673051
/archive/index/_5fn.cfs (deleted)
java    19606 root 1865r   REG       8,17    417453 368673050
/archive/index/_5fm.cfs (deleted)
java    19606 root 1866r   REG       8,17   1518126 368673049
/archive/index/_5fl.cfs (deleted)
java    19606 root 1871r   REG       8,17   1236023 368673057
/archive/index/_5ft.cfs (deleted)
java    19606 root 1872r   REG       8,17     29743 368673055
/archive/index/_5fr.cfs (deleted)
java    19606 root 1873r   REG       8,17    273561 368673054
/archive/index/_5fq.cfs (deleted)
java    19606 root 1874r   REG       8,17      9428 368673053
/archive/index/_5fp.cfs (deleted)
java    19606 root 1875r   REG       8,17    363690 368673052
/archive/index/_5fo.cfs (deleted)
java    19606 root 1876r   REG       8,17     47732 368673051
/archive/index/_5fn.cfs (deleted)
java    19606 root 1877r   REG       8,17    417453 368673050
/archive/index/_5fm.cfs (deleted)
java    19606 root 1878r   REG       8,17   1518126 368673049
/archive/index/_5fl.cfs (deleted)
java    19606 root 1883r   REG       8,17   1389856 368673056
/archive/index/_5fs.cfs (deleted)
java    19606 root 1884r   REG       8,17     29743 368673055
/archive/index/_5fr.cfs (deleted)
java    19606 root 1885r   REG       8,17    273561 368673054
/archive/index/_5fq.cfs (deleted)
java    19606 root 1886r   REG       8,17      9428 368673053
/archive/index/_5fp.cfs (deleted)
java    19606 root 1887r   REG       8,17    363690 368673052
/archive/index/_5fo.cfs (deleted)
java    19606 root 1888r   REG       8,17     47732 368673051
/archive/index/_5fn.cfs (deleted)
java    19606 root 1889r   REG       8,17    417453 368673050
/archive/index/_5fm.cfs (deleted)
java    19606 root 1890r   REG       8,17   1518126 368673049
/archive/index/_5fl.cfs (deleted)
java    19606 root 1895r   REG       8,17   1389856 368673056
/archive/index/_5fs.cfs (deleted)
java    19606 root 1896r   REG       8,17     29743 368673055
/archive/index/_5fr.cfs (deleted)
java    19606 root 1897r   REG       8,17    273561 368673054
/archive/index/_5fq.cfs (deleted)
java    19606 root 1898r   REG       8,17      9428 368673053
/archive/index/_5fp.cfs (deleted)
java    19606 root 1899r   REG       8,17    363690 368673052
/archive/index/_5fo.cfs (deleted)
java    19606 root 1900r   REG       8,17     47732 368673051
/archive/index/_5fn.cfs (deleted)
java    19606 root 1901r   REG       8,17    417453 368673050
/archive/index/_5fm.cfs (deleted)
java    19606 root 1902r   REG       8,17   1518126 368673049
/archive/index/_5fl.cfs (deleted)
java    19606 root 1910r   REG       8,17    403610 368673058
/archive/index/_5fu.cfs (deleted)
java    19606 root 1911r   REG       8,17   1236023 368673057
/archive/index/_5ft.cfs (deleted)
java    19606 root 1912r   REG       8,17   1389856 368673056
/archive/index/_5fs.cfs (deleted)
java    19606 root 1913r   REG       8,17     29743 368673055
/archive/index/_5fr.cfs (deleted)
java    19606 root 1914r   REG       8,17    273561 368673054
/archive/index/_5fq.cfs (deleted)
java    19606 root 1915r   REG       8,17      9428 368673053
/archive/index/_5fp.cfs (deleted)
java    19606 root 1916r   REG       8,17    363690 368673052
/archive/index/_5fo.cfs (deleted)
java    19606 root 1917r   REG       8,17     47732 368673051
/archive/index/_5fn.cfs (deleted)
java    19606 root 1918r   REG       8,17    417453 368673050
/archive/index/_5fm.cfs (deleted)
java    19606 root 1919r   REG       8,17   1518126 368673049
/archive/index/_5fl.cfs (deleted)


-- 
View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25947462.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42915-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 15:27:08 2009
Return-Path: <java-user-return-42915-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 45400 invoked from network); 18 Oct 2009 15:27:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 15:27:07 -0000
Received: (qmail 96066 invoked by uid 500); 18 Oct 2009 15:27:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95995 invoked by uid 500); 18 Oct 2009 15:27:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95985 invoked by uid 99); 18 Oct 2009 15:27:05 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 15:27:05 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of amccurry.lucene@gmail.com designates 209.85.221.189 as permitted sender)
Received: from [209.85.221.189] (HELO mail-qy0-f189.google.com) (209.85.221.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 15:27:02 +0000
Received: by qyk27 with SMTP id 27so2459998qyk.20
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 08:26:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:content-transfer-encoding:message-id
         :references:to:x-mailer;
        bh=1pswOdSdHDQyUGfOqkWmb3wC59YC+tdfqph4Y+wMSOg=;
        b=vfWUajyo9b8tUkwe9agc+uYBEyrHle8gmkSIrzkwtk3sdq7/4x6HyafMeBJzBOyZR8
         E8vkQF3w7KWjvpi5Eu49DnUp+I+ZxLGnX7kIseYPXQG/PotopCEz1i+uJKMxB+29s6nO
         LirOuNfI06n7mps4WN9Y24JoU7ubeiaModbxc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=mctnD5QHH8IU41VXSBeTNICtRLbd6v5fNuMs7xwaTAaQYo/CvjYfDTLynOoqa72l1l
         Z0KU0JMR633m9uXLTrHlDLEov4YBH4RmRvw48D26A98/tcfETzpQhHx3GnCoGj9Xz7wc
         vdilnmr8KkjXa/P1ggRGi43lEbrl9GVq4El1Q=
Received: by 10.224.93.77 with SMTP id u13mr2115446qam.226.1255879602043;
        Sun, 18 Oct 2009 08:26:42 -0700 (PDT)
Received: from nic-amccurry.home (pool-72-66-5-106.washdc.fios.verizon.net [72.66.5.106])
        by mx.google.com with ESMTPS id 21sm2769978qyk.12.2009.10.18.08.26.40
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Sun, 18 Oct 2009 08:26:40 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many files open java error.
From: Aaron McCurry <amccurry.lucene@gmail.com>
In-Reply-To: <25947462.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 11:26:38 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <C41C9139-5F9B-469F-9015-62AA5E2096BB@gmail.com>
References: <25947462.post@talk.nabble.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)

I also have seen this problem recently.  I had to make a patch to our  
production system to at least relief the system of the deleted files  
handles.  I did it by capturing all of the Descriptors that the  
FileInputIndex object creates and monitoring if the file it references  
still exists or not.  If it doesn't I then try and close the  
Descriptors.  I know that this is a hack, but it was needed ASAP, and  
I couldn't find in my code anywhere where I wasn't closing the opened  
indexreaders or indexwriters.

Aaron


On Oct 18, 2009, at 11:14 AM, GlenAbbeyDrive wrote:

>
> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too  
> many
> files open within a few hours from my indexing process.  Our  
> indexing Java
> process adds about 2000 documents/minute.
> The IndexWriter (iw) has the following settings:
>
>            iw.setMaxFieldLength(1024*1024*1024); // 1G as maximum  
> terms.
>            iw.setMergeFactor(10);
>            iw.setMaxMergeDocs(100000);
>            iw.setMaxBufferedDocs(1000);
>            iw.setRAMBufferSizeMB(128);
>            iw.setUseCompoundFile(true);
>
>
>
> The 'lsof' result shows rapidly growing number of open files in  
> 'deleted'
> state. Counting the number of these:
>
> [server-1]#date
> Sun Oct 18 11:02:37 EDT 2009
> [server-1]# lsof -p 19606 |grep deleted  |wc -l
> 3187
> [server-1]# date
> Sun Oct 18 11:07:29 EDT 2009
> [server-1]# lsof -p 19606 |grep deleted  |wc -l
> 3912
>
> Here is a sample of those open files left behind in 'deleted' state:
>
> java    19606 root 1861r   REG       8,17    273561 368673054
> /archive/index/_5fq.cfs (deleted)
> java    19606 root 1862r   REG       8,17      9428 368673053
> /archive/index/_5fp.cfs (deleted)
> java    19606 root 1863r   REG       8,17    363690 368673052
> /archive/index/_5fo.cfs (deleted)
> java    19606 root 1864r   REG       8,17     47732 368673051
> /archive/index/_5fn.cfs (deleted)
> java    19606 root 1865r   REG       8,17    417453 368673050
> /archive/index/_5fm.cfs (deleted)
> java    19606 root 1866r   REG       8,17   1518126 368673049
> /archive/index/_5fl.cfs (deleted)
> java    19606 root 1871r   REG       8,17   1236023 368673057
> /archive/index/_5ft.cfs (deleted)
> java    19606 root 1872r   REG       8,17     29743 368673055
> /archive/index/_5fr.cfs (deleted)
> java    19606 root 1873r   REG       8,17    273561 368673054
> /archive/index/_5fq.cfs (deleted)
> java    19606 root 1874r   REG       8,17      9428 368673053
> /archive/index/_5fp.cfs (deleted)
> java    19606 root 1875r   REG       8,17    363690 368673052
> /archive/index/_5fo.cfs (deleted)
> java    19606 root 1876r   REG       8,17     47732 368673051
> /archive/index/_5fn.cfs (deleted)
> java    19606 root 1877r   REG       8,17    417453 368673050
> /archive/index/_5fm.cfs (deleted)
> java    19606 root 1878r   REG       8,17   1518126 368673049
> /archive/index/_5fl.cfs (deleted)
> java    19606 root 1883r   REG       8,17   1389856 368673056
> /archive/index/_5fs.cfs (deleted)
> java    19606 root 1884r   REG       8,17     29743 368673055
> /archive/index/_5fr.cfs (deleted)
> java    19606 root 1885r   REG       8,17    273561 368673054
> /archive/index/_5fq.cfs (deleted)
> java    19606 root 1886r   REG       8,17      9428 368673053
> /archive/index/_5fp.cfs (deleted)
> java    19606 root 1887r   REG       8,17    363690 368673052
> /archive/index/_5fo.cfs (deleted)
> java    19606 root 1888r   REG       8,17     47732 368673051
> /archive/index/_5fn.cfs (deleted)
> java    19606 root 1889r   REG       8,17    417453 368673050
> /archive/index/_5fm.cfs (deleted)
> java    19606 root 1890r   REG       8,17   1518126 368673049
> /archive/index/_5fl.cfs (deleted)
> java    19606 root 1895r   REG       8,17   1389856 368673056
> /archive/index/_5fs.cfs (deleted)
> java    19606 root 1896r   REG       8,17     29743 368673055
> /archive/index/_5fr.cfs (deleted)
> java    19606 root 1897r   REG       8,17    273561 368673054
> /archive/index/_5fq.cfs (deleted)
> java    19606 root 1898r   REG       8,17      9428 368673053
> /archive/index/_5fp.cfs (deleted)
> java    19606 root 1899r   REG       8,17    363690 368673052
> /archive/index/_5fo.cfs (deleted)
> java    19606 root 1900r   REG       8,17     47732 368673051
> /archive/index/_5fn.cfs (deleted)
> java    19606 root 1901r   REG       8,17    417453 368673050
> /archive/index/_5fm.cfs (deleted)
> java    19606 root 1902r   REG       8,17   1518126 368673049
> /archive/index/_5fl.cfs (deleted)
> java    19606 root 1910r   REG       8,17    403610 368673058
> /archive/index/_5fu.cfs (deleted)
> java    19606 root 1911r   REG       8,17   1236023 368673057
> /archive/index/_5ft.cfs (deleted)
> java    19606 root 1912r   REG       8,17   1389856 368673056
> /archive/index/_5fs.cfs (deleted)
> java    19606 root 1913r   REG       8,17     29743 368673055
> /archive/index/_5fr.cfs (deleted)
> java    19606 root 1914r   REG       8,17    273561 368673054
> /archive/index/_5fq.cfs (deleted)
> java    19606 root 1915r   REG       8,17      9428 368673053
> /archive/index/_5fp.cfs (deleted)
> java    19606 root 1916r   REG       8,17    363690 368673052
> /archive/index/_5fo.cfs (deleted)
> java    19606 root 1917r   REG       8,17     47732 368673051
> /archive/index/_5fn.cfs (deleted)
> java    19606 root 1918r   REG       8,17    417453 368673050
> /archive/index/_5fm.cfs (deleted)
> java    19606 root 1919r   REG       8,17   1518126 368673049
> /archive/index/_5fl.cfs (deleted)
>
>
> -- 
> View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25947462.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42916-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 17:05:16 2009
Return-Path: <java-user-return-42916-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 58199 invoked from network); 18 Oct 2009 17:05:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 17:05:16 -0000
Received: (qmail 41941 invoked by uid 500); 18 Oct 2009 17:05:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41888 invoked by uid 500); 18 Oct 2009 17:05:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41878 invoked by uid 99); 18 Oct 2009 17:05:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:05:14 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:05:11 +0000
Received: by ywh13 with SMTP id 13so5115305ywh.29
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 10:04:49 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.27.1 with SMTP id a1mr6399334yba.125.1255885487984; Sun, 
	18 Oct 2009 10:04:47 -0700 (PDT)
In-Reply-To: <25947462.post@talk.nabble.com>
References: <25947462.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 13:04:47 -0400
Message-ID: <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many 
	files open java error.
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hmm, not good.  Can you share more details about how your app is using Luce=
ne?

Do you also have an IndexReader that's open on this directory?  Do you
reopen it after indexing documents?  If so, using IndexReader.reopen
or by closing and opening a new IndexReader?  Or, by getting a near
real-time reader?

Are you closing the IndexWriter after each batch, or calling commit?

Mike

On Sun, Oct 18, 2009 at 11:14 AM, GlenAbbeyDrive <wende.long@gmail.com> wro=
te:
>
> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too many
> files open within a few hours from my indexing process. =A0Our indexing J=
ava
> process adds about 2000 documents/minute.
> The IndexWriter (iw) has the following settings:
>
> =A0 =A0 =A0 =A0 =A0 =A0iw.setMaxFieldLength(1024*1024*1024); // 1G as max=
imum terms.
> =A0 =A0 =A0 =A0 =A0 =A0iw.setMergeFactor(10);
> =A0 =A0 =A0 =A0 =A0 =A0iw.setMaxMergeDocs(100000);
> =A0 =A0 =A0 =A0 =A0 =A0iw.setMaxBufferedDocs(1000);
> =A0 =A0 =A0 =A0 =A0 =A0iw.setRAMBufferSizeMB(128);
> =A0 =A0 =A0 =A0 =A0 =A0iw.setUseCompoundFile(true);
>
>
>
> The 'lsof' result shows rapidly growing number of open files in 'deleted'
> state. Counting the number of these:
>
> [server-1]#date
> Sun Oct 18 11:02:37 EDT 2009
> [server-1]# lsof -p 19606 |grep deleted =A0|wc -l
> 3187
> [server-1]# date
> Sun Oct 18 11:07:29 EDT 2009
> [server-1]# lsof -p 19606 |grep deleted =A0|wc -l
> 3912
>
> Here is a sample of those open files left behind in 'deleted' state:
>
> java =A0 =A019606 root 1861r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 36867=
3054
> /archive/index/_5fq.cfs (deleted)
> java =A0 =A019606 root 1862r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 368=
673053
> /archive/index/_5fp.cfs (deleted)
> java =A0 =A019606 root 1863r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 36867=
3052
> /archive/index/_5fo.cfs (deleted)
> java =A0 =A019606 root 1864r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 36867=
3051
> /archive/index/_5fn.cfs (deleted)
> java =A0 =A019606 root 1865r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 36867=
3050
> /archive/index/_5fm.cfs (deleted)
> java =A0 =A019606 root 1866r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 3686730=
49
> /archive/index/_5fl.cfs (deleted)
> java =A0 =A019606 root 1871r =A0 REG =A0 =A0 =A0 8,17 =A0 1236023 3686730=
57
> /archive/index/_5ft.cfs (deleted)
> java =A0 =A019606 root 1872r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 36867=
3055
> /archive/index/_5fr.cfs (deleted)
> java =A0 =A019606 root 1873r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 36867=
3054
> /archive/index/_5fq.cfs (deleted)
> java =A0 =A019606 root 1874r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 368=
673053
> /archive/index/_5fp.cfs (deleted)
> java =A0 =A019606 root 1875r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 36867=
3052
> /archive/index/_5fo.cfs (deleted)
> java =A0 =A019606 root 1876r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 36867=
3051
> /archive/index/_5fn.cfs (deleted)
> java =A0 =A019606 root 1877r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 36867=
3050
> /archive/index/_5fm.cfs (deleted)
> java =A0 =A019606 root 1878r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 3686730=
49
> /archive/index/_5fl.cfs (deleted)
> java =A0 =A019606 root 1883r =A0 REG =A0 =A0 =A0 8,17 =A0 1389856 3686730=
56
> /archive/index/_5fs.cfs (deleted)
> java =A0 =A019606 root 1884r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 36867=
3055
> /archive/index/_5fr.cfs (deleted)
> java =A0 =A019606 root 1885r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 36867=
3054
> /archive/index/_5fq.cfs (deleted)
> java =A0 =A019606 root 1886r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 368=
673053
> /archive/index/_5fp.cfs (deleted)
> java =A0 =A019606 root 1887r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 36867=
3052
> /archive/index/_5fo.cfs (deleted)
> java =A0 =A019606 root 1888r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 36867=
3051
> /archive/index/_5fn.cfs (deleted)
> java =A0 =A019606 root 1889r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 36867=
3050
> /archive/index/_5fm.cfs (deleted)
> java =A0 =A019606 root 1890r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 3686730=
49
> /archive/index/_5fl.cfs (deleted)
> java =A0 =A019606 root 1895r =A0 REG =A0 =A0 =A0 8,17 =A0 1389856 3686730=
56
> /archive/index/_5fs.cfs (deleted)
> java =A0 =A019606 root 1896r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 36867=
3055
> /archive/index/_5fr.cfs (deleted)
> java =A0 =A019606 root 1897r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 36867=
3054
> /archive/index/_5fq.cfs (deleted)
> java =A0 =A019606 root 1898r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 368=
673053
> /archive/index/_5fp.cfs (deleted)
> java =A0 =A019606 root 1899r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 36867=
3052
> /archive/index/_5fo.cfs (deleted)
> java =A0 =A019606 root 1900r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 36867=
3051
> /archive/index/_5fn.cfs (deleted)
> java =A0 =A019606 root 1901r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 36867=
3050
> /archive/index/_5fm.cfs (deleted)
> java =A0 =A019606 root 1902r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 3686730=
49
> /archive/index/_5fl.cfs (deleted)
> java =A0 =A019606 root 1910r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0403610 36867=
3058
> /archive/index/_5fu.cfs (deleted)
> java =A0 =A019606 root 1911r =A0 REG =A0 =A0 =A0 8,17 =A0 1236023 3686730=
57
> /archive/index/_5ft.cfs (deleted)
> java =A0 =A019606 root 1912r =A0 REG =A0 =A0 =A0 8,17 =A0 1389856 3686730=
56
> /archive/index/_5fs.cfs (deleted)
> java =A0 =A019606 root 1913r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 36867=
3055
> /archive/index/_5fr.cfs (deleted)
> java =A0 =A019606 root 1914r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 36867=
3054
> /archive/index/_5fq.cfs (deleted)
> java =A0 =A019606 root 1915r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 368=
673053
> /archive/index/_5fp.cfs (deleted)
> java =A0 =A019606 root 1916r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 36867=
3052
> /archive/index/_5fo.cfs (deleted)
> java =A0 =A019606 root 1917r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 36867=
3051
> /archive/index/_5fn.cfs (deleted)
> java =A0 =A019606 root 1918r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 36867=
3050
> /archive/index/_5fm.cfs (deleted)
> java =A0 =A019606 root 1919r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 3686730=
49
> /archive/index/_5fl.cfs (deleted)
>
>
> --
> View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-t=
oo-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp259474=
62p25947462.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42917-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 17:47:32 2009
Return-Path: <java-user-return-42917-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65566 invoked from network); 18 Oct 2009 17:47:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 17:47:32 -0000
Received: (qmail 66924 invoked by uid 500); 18 Oct 2009 17:47:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66834 invoked by uid 500); 18 Oct 2009 17:47:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66824 invoked by uid 99); 18 Oct 2009 17:47:29 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:47:29 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:47:27 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzZqT-0003x9-Mc
	for java-user@lucene.apache.org; Sun, 18 Oct 2009 10:47:05 -0700
Message-ID: <25948812.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 10:47:05 -0700 (PDT)
From: GlenAbbeyDrive <wende.long@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many
  files open java error.
In-Reply-To: <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Nabble-From: wende.long@gmail.com
References: <25947462.post@talk.nabble.com> <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>


I commit the IndexWriter every 200 documents in a batch as follows and you
can see that I reopened the reader after the commit.

private void commit(IndexWriter writer) throws CorruptIndexException,
IOException, SQLException  {
=09=09writer.commit();
=09=09if(indexReader!=3Dnull)
=09=09=09indexReader.reopen();
}

What do you mean by real-time reader?

Thanks.


Michael McCandless-2 wrote:
>=20
> Hmm, not good.  Can you share more details about how your app is using
> Lucene?
>=20
> Do you also have an IndexReader that's open on this directory?  Do you
> reopen it after indexing documents?  If so, using IndexReader.reopen
> or by closing and opening a new IndexReader?  Or, by getting a near
> real-time reader?
>=20
> Are you closing the IndexWriter after each batch, or calling commit?
>=20
> Mike
>=20
> On Sun, Oct 18, 2009 at 11:14 AM, GlenAbbeyDrive <wende.long@gmail.com>
> wrote:
>>
>> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too man=
y
>> files open within a few hours from my indexing process. =C2=A0Our indexi=
ng
>> Java
>> process adds about 2000 documents/minute.
>> The IndexWriter (iw) has the following settings:
>>
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxFieldLength(1024*1024*=
1024); // 1G as maximum terms.
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMergeFactor(10);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxMergeDocs(100000);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxBufferedDocs(1000);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setRAMBufferSizeMB(128);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setUseCompoundFile(true);
>>
>>
>>
>> The 'lsof' result shows rapidly growing number of open files in 'deleted=
'
>> state. Counting the number of these:
>>
>> [server-1]#date
>> Sun Oct 18 11:02:37 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted =C2=A0|wc -l
>> 3187
>> [server-1]# date
>> Sun Oct 18 11:07:29 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted =C2=A0|wc -l
>> 3912
>>
>> Here is a sample of those open files left behind in 'deleted' state:
>>
>> java =C2=A0 =C2=A019606 root 1861r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1862r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1863r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1864r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1865r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1866r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1871r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1872r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1873r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1874r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1875r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1876r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1877r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1878r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1883r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1884r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1885r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1886r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1887r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1888r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1889r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1890r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1895r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1896r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1897r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1898r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1899r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1900r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1901r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1902r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1910r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0403610 368673058
>> /archive/index/_5fu.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1911r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1912r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1913r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1914r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1915r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1916r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1917r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1918r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1919r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>>
>>
>> --
>> View this message in context:
>> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-ca=
using-too-many-files-open-java-error.-tp25947462p25947462.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20

--=20
View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too=
-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462=
p25948812.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42918-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 17:48:02 2009
Return-Path: <java-user-return-42918-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65627 invoked from network); 18 Oct 2009 17:48:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 17:48:02 -0000
Received: (qmail 68657 invoked by uid 500); 18 Oct 2009 17:48:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68589 invoked by uid 500); 18 Oct 2009 17:47:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68579 invoked by uid 99); 18 Oct 2009 17:47:59 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:47:59 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:47:56 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzZqy-0003zE-7p
	for java-user@lucene.apache.org; Sun, 18 Oct 2009 10:47:36 -0700
Message-ID: <25948812.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 10:47:36 -0700 (PDT)
From: GlenAbbeyDrive <wende.long@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many
  files open java error.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Nabble-From: wende.long@gmail.com


I commit the IndexWriter every 200 documents in a batch as follows and you
can see that I reopened the reader after the commit.

private void commit(IndexWriter writer) throws CorruptIndexException {
=09=09writer.commit();
=09=09if(indexReader!=3Dnull)
=09=09=09indexReader.reopen();
}

What do you mean by real-time reader?

Thanks.


Michael McCandless-2 wrote:
>=20
> Hmm, not good.  Can you share more details about how your app is using
> Lucene?
>=20
> Do you also have an IndexReader that's open on this directory?  Do you
> reopen it after indexing documents?  If so, using IndexReader.reopen
> or by closing and opening a new IndexReader?  Or, by getting a near
> real-time reader?
>=20
> Are you closing the IndexWriter after each batch, or calling commit?
>=20
> Mike
>=20
> On Sun, Oct 18, 2009 at 11:14 AM, GlenAbbeyDrive <wende.long@gmail.com>
> wrote:
>>
>> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too man=
y
>> files open within a few hours from my indexing process. =C2=A0Our indexi=
ng
>> Java
>> process adds about 2000 documents/minute.
>> The IndexWriter (iw) has the following settings:
>>
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxFieldLength(1024*1024*=
1024); // 1G as maximum terms.
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMergeFactor(10);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxMergeDocs(100000);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxBufferedDocs(1000);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setRAMBufferSizeMB(128);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setUseCompoundFile(true);
>>
>>
>>
>> The 'lsof' result shows rapidly growing number of open files in 'deleted=
'
>> state. Counting the number of these:
>>
>> [server-1]#date
>> Sun Oct 18 11:02:37 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted =C2=A0|wc -l
>> 3187
>> [server-1]# date
>> Sun Oct 18 11:07:29 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted =C2=A0|wc -l
>> 3912
>>
>> Here is a sample of those open files left behind in 'deleted' state:
>>
>> java =C2=A0 =C2=A019606 root 1861r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1862r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1863r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1864r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1865r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1866r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1871r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1872r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1873r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1874r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1875r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1876r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1877r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1878r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1883r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1884r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1885r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1886r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1887r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1888r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1889r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1890r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1895r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1896r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1897r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1898r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1899r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1900r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1901r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1902r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1910r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0403610 368673058
>> /archive/index/_5fu.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1911r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1912r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1913r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1914r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1915r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1916r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1917r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1918r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1919r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>>
>>
>> --
>> View this message in context:
>> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-ca=
using-too-many-files-open-java-error.-tp25947462p25947462.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20

--=20
View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too=
-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462=
p25948812.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42919-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 17:49:41 2009
Return-Path: <java-user-return-42919-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65956 invoked from network); 18 Oct 2009 17:49:41 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 17:49:41 -0000
Received: (qmail 73218 invoked by uid 500); 18 Oct 2009 17:49:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73149 invoked by uid 500); 18 Oct 2009 17:49:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73139 invoked by uid 99); 18 Oct 2009 17:49:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:49:38 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 17:49:36 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzZsZ-00045K-Mm
	for java-user@lucene.apache.org; Sun, 18 Oct 2009 10:49:15 -0700
Message-ID: <25948828.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 10:49:15 -0700 (PDT)
From: GlenAbbeyDrive <wende.long@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many
 files open java error.
In-Reply-To: <C41C9139-5F9B-469F-9015-62AA5E2096BB@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: wende.long@gmail.com
References: <25947462.post@talk.nabble.com> <C41C9139-5F9B-469F-9015-62AA5E2096BB@gmail.com>


Are you using 2.9.0 or 2.4?



Aaron McCurry wrote:
> 
> I also have seen this problem recently.  I had to make a patch to our  
> production system to at least relief the system of the deleted files  
> handles.  I did it by capturing all of the Descriptors that the  
> FileInputIndex object creates and monitoring if the file it references  
> still exists or not.  If it doesn't I then try and close the  
> Descriptors.  I know that this is a hack, but it was needed ASAP, and  
> I couldn't find in my code anywhere where I wasn't closing the opened  
> indexreaders or indexwriters.
> 
> Aaron
> 
> 
> On Oct 18, 2009, at 11:14 AM, GlenAbbeyDrive wrote:
> 
>>
>> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too  
>> many
>> files open within a few hours from my indexing process.  Our  
>> indexing Java
>> process adds about 2000 documents/minute.
>> The IndexWriter (iw) has the following settings:
>>
>>            iw.setMaxFieldLength(1024*1024*1024); // 1G as maximum  
>> terms.
>>            iw.setMergeFactor(10);
>>            iw.setMaxMergeDocs(100000);
>>            iw.setMaxBufferedDocs(1000);
>>            iw.setRAMBufferSizeMB(128);
>>            iw.setUseCompoundFile(true);
>>
>>
>>
>> The 'lsof' result shows rapidly growing number of open files in  
>> 'deleted'
>> state. Counting the number of these:
>>
>> [server-1]#date
>> Sun Oct 18 11:02:37 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted  |wc -l
>> 3187
>> [server-1]# date
>> Sun Oct 18 11:07:29 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted  |wc -l
>> 3912
>>
>> Here is a sample of those open files left behind in 'deleted' state:
>>
>> java    19606 root 1861r   REG       8,17    273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java    19606 root 1862r   REG       8,17      9428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java    19606 root 1863r   REG       8,17    363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java    19606 root 1864r   REG       8,17     47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java    19606 root 1865r   REG       8,17    417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java    19606 root 1866r   REG       8,17   1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java    19606 root 1871r   REG       8,17   1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java    19606 root 1872r   REG       8,17     29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java    19606 root 1873r   REG       8,17    273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java    19606 root 1874r   REG       8,17      9428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java    19606 root 1875r   REG       8,17    363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java    19606 root 1876r   REG       8,17     47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java    19606 root 1877r   REG       8,17    417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java    19606 root 1878r   REG       8,17   1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java    19606 root 1883r   REG       8,17   1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java    19606 root 1884r   REG       8,17     29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java    19606 root 1885r   REG       8,17    273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java    19606 root 1886r   REG       8,17      9428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java    19606 root 1887r   REG       8,17    363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java    19606 root 1888r   REG       8,17     47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java    19606 root 1889r   REG       8,17    417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java    19606 root 1890r   REG       8,17   1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java    19606 root 1895r   REG       8,17   1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java    19606 root 1896r   REG       8,17     29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java    19606 root 1897r   REG       8,17    273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java    19606 root 1898r   REG       8,17      9428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java    19606 root 1899r   REG       8,17    363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java    19606 root 1900r   REG       8,17     47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java    19606 root 1901r   REG       8,17    417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java    19606 root 1902r   REG       8,17   1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java    19606 root 1910r   REG       8,17    403610 368673058
>> /archive/index/_5fu.cfs (deleted)
>> java    19606 root 1911r   REG       8,17   1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java    19606 root 1912r   REG       8,17   1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java    19606 root 1913r   REG       8,17     29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java    19606 root 1914r   REG       8,17    273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java    19606 root 1915r   REG       8,17      9428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java    19606 root 1916r   REG       8,17    363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java    19606 root 1917r   REG       8,17     47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java    19606 root 1918r   REG       8,17    417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java    19606 root 1919r   REG       8,17   1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>>
>>
>> -- 
>> View this message in context:
>> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25947462.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25948828.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42920-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 18:12:20 2009
Return-Path: <java-user-return-42920-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69113 invoked from network); 18 Oct 2009 18:12:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 18:12:20 -0000
Received: (qmail 84882 invoked by uid 500); 18 Oct 2009 18:12:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84788 invoked by uid 500); 18 Oct 2009 18:12:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84778 invoked by uid 99); 18 Oct 2009 18:12:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 18:12:18 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of amccurry.lucene@gmail.com designates 209.85.221.189 as permitted sender)
Received: from [209.85.221.189] (HELO mail-qy0-f189.google.com) (209.85.221.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 18:12:07 +0000
Received: by qyk27 with SMTP id 27so2514568qyk.20
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 11:11:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:content-type:mime-version
         :subject:from:in-reply-to:date:content-transfer-encoding:message-id
         :references:to:x-mailer;
        bh=yxMt6UkTjSG346swPTIAQrSvSzi028OLlPWHevopfxY=;
        b=Wt23LSKjbg65jBlcVumYdmHFrF/rfHMseE4yS7ZdE3bq1j8Wr09dNoaxKTN62//69Q
         jJJPkCgBmhksc6N/DTNzWfRwVSlXgpiOEgZnYe5jmNcunELDL0Jj2JJ0mBR006XXAWz5
         Z9ZnigZvn6a+QIscEvQg92evSo3aH2joCKtC4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=content-type:mime-version:subject:from:in-reply-to:date
         :content-transfer-encoding:message-id:references:to:x-mailer;
        b=KWfmH18ZRQzlVwRyH3uyY6NaklKgAkqCG22zUz9+3t5jSwfQMzOXIjAOhFV7PXRIl0
         HMfZFnKMN+hHzo2LAEIq32yycDiJoBF9D9sCsvanASlcIOK3EvaGKYughvNzTMwWjbRh
         zfYpsOePHmKE+FbieInS33xwbYlIEWoCXbeUE=
Received: by 10.224.10.17 with SMTP id n17mr377894qan.170.1255889506364;
        Sun, 18 Oct 2009 11:11:46 -0700 (PDT)
Received: from nic-amccurry.home (pool-72-66-5-106.washdc.fios.verizon.net [72.66.5.106])
        by mx.google.com with ESMTPS id 20sm2865815qyk.13.2009.10.18.11.11.44
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Sun, 18 Oct 2009 11:11:45 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many files open java error.
From: Aaron McCurry <amccurry.lucene@gmail.com>
In-Reply-To: <25948828.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 14:11:43 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <96A85CFA-EA12-4F2A-BA58-57617D766763@gmail.com>
References: <25947462.post@talk.nabble.com> <C41C9139-5F9B-469F-9015-62AA5E2096BB@gmail.com> <25948828.post@talk.nabble.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

I actually have seen the problem in both, with our app.  Not sure if  
it's how we are using lucene or if the problem is internal.  We  
actually only saw the problem recently because we starting using a new  
linux machine that had it's open file handle settings too low.  And  
with our volume it only took about 10 hours for the machine to start  
having problems.  Hence the need for the hack patch.

Aaron

On Oct 18, 2009, at 1:49 PM, GlenAbbeyDrive wrote:

>
> Are you using 2.9.0 or 2.4?
>
>
>
> Aaron McCurry wrote:
>>
>> I also have seen this problem recently.  I had to make a patch to our
>> production system to at least relief the system of the deleted files
>> handles.  I did it by capturing all of the Descriptors that the
>> FileInputIndex object creates and monitoring if the file it  
>> references
>> still exists or not.  If it doesn't I then try and close the
>> Descriptors.  I know that this is a hack, but it was needed ASAP, and
>> I couldn't find in my code anywhere where I wasn't closing the opened
>> indexreaders or indexwriters.
>>
>> Aaron
>>
>>
>> On Oct 18, 2009, at 11:14 AM, GlenAbbeyDrive wrote:
>>
>>>
>>> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too
>>> many
>>> files open within a few hours from my indexing process.  Our
>>> indexing Java
>>> process adds about 2000 documents/minute.
>>> The IndexWriter (iw) has the following settings:
>>>
>>>           iw.setMaxFieldLength(1024*1024*1024); // 1G as maximum
>>> terms.
>>>           iw.setMergeFactor(10);
>>>           iw.setMaxMergeDocs(100000);
>>>           iw.setMaxBufferedDocs(1000);
>>>           iw.setRAMBufferSizeMB(128);
>>>           iw.setUseCompoundFile(true);
>>>
>>>
>>>
>>> The 'lsof' result shows rapidly growing number of open files in
>>> 'deleted'
>>> state. Counting the number of these:
>>>
>>> [server-1]#date
>>> Sun Oct 18 11:02:37 EDT 2009
>>> [server-1]# lsof -p 19606 |grep deleted  |wc -l
>>> 3187
>>> [server-1]# date
>>> Sun Oct 18 11:07:29 EDT 2009
>>> [server-1]# lsof -p 19606 |grep deleted  |wc -l
>>> 3912
>>>
>>> Here is a sample of those open files left behind in 'deleted' state:
>>>
>>> java    19606 root 1861r   REG       8,17    273561 368673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java    19606 root 1862r   REG       8,17      9428 368673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java    19606 root 1863r   REG       8,17    363690 368673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java    19606 root 1864r   REG       8,17     47732 368673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java    19606 root 1865r   REG       8,17    417453 368673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java    19606 root 1866r   REG       8,17   1518126 368673049
>>> /archive/index/_5fl.cfs (deleted)
>>> java    19606 root 1871r   REG       8,17   1236023 368673057
>>> /archive/index/_5ft.cfs (deleted)
>>> java    19606 root 1872r   REG       8,17     29743 368673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java    19606 root 1873r   REG       8,17    273561 368673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java    19606 root 1874r   REG       8,17      9428 368673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java    19606 root 1875r   REG       8,17    363690 368673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java    19606 root 1876r   REG       8,17     47732 368673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java    19606 root 1877r   REG       8,17    417453 368673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java    19606 root 1878r   REG       8,17   1518126 368673049
>>> /archive/index/_5fl.cfs (deleted)
>>> java    19606 root 1883r   REG       8,17   1389856 368673056
>>> /archive/index/_5fs.cfs (deleted)
>>> java    19606 root 1884r   REG       8,17     29743 368673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java    19606 root 1885r   REG       8,17    273561 368673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java    19606 root 1886r   REG       8,17      9428 368673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java    19606 root 1887r   REG       8,17    363690 368673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java    19606 root 1888r   REG       8,17     47732 368673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java    19606 root 1889r   REG       8,17    417453 368673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java    19606 root 1890r   REG       8,17   1518126 368673049
>>> /archive/index/_5fl.cfs (deleted)
>>> java    19606 root 1895r   REG       8,17   1389856 368673056
>>> /archive/index/_5fs.cfs (deleted)
>>> java    19606 root 1896r   REG       8,17     29743 368673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java    19606 root 1897r   REG       8,17    273561 368673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java    19606 root 1898r   REG       8,17      9428 368673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java    19606 root 1899r   REG       8,17    363690 368673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java    19606 root 1900r   REG       8,17     47732 368673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java    19606 root 1901r   REG       8,17    417453 368673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java    19606 root 1902r   REG       8,17   1518126 368673049
>>> /archive/index/_5fl.cfs (deleted)
>>> java    19606 root 1910r   REG       8,17    403610 368673058
>>> /archive/index/_5fu.cfs (deleted)
>>> java    19606 root 1911r   REG       8,17   1236023 368673057
>>> /archive/index/_5ft.cfs (deleted)
>>> java    19606 root 1912r   REG       8,17   1389856 368673056
>>> /archive/index/_5fs.cfs (deleted)
>>> java    19606 root 1913r   REG       8,17     29743 368673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java    19606 root 1914r   REG       8,17    273561 368673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java    19606 root 1915r   REG       8,17      9428 368673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java    19606 root 1916r   REG       8,17    363690 368673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java    19606 root 1917r   REG       8,17     47732 368673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java    19606 root 1918r   REG       8,17    417453 368673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java    19606 root 1919r   REG       8,17   1518126 368673049
>>> /archive/index/_5fl.cfs (deleted)
>>>
>>>
>>> -- 
>>> View this message in context:
>>> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25947462.html
>>> Sent from the Lucene - Java Users mailing list archive at  
>>> Nabble.com.
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>
> -- 
> View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25948828.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42921-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 18:23:17 2009
Return-Path: <java-user-return-42921-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73045 invoked from network); 18 Oct 2009 18:23:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 18:23:17 -0000
Received: (qmail 93432 invoked by uid 500); 18 Oct 2009 18:23:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93353 invoked by uid 500); 18 Oct 2009 18:23:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93343 invoked by uid 99); 18 Oct 2009 18:23:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 18:23:15 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of john.wang@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 18:23:04 +0000
Received: by yxe30 with SMTP id 30so4959469yxe.29
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 11:22:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=Xyv43JtO3510a7UXkd2VcEb4zYtfU5zgVhFSgUfW2jk=;
        b=gmE0mQdtxuW/Kx3MA/QeKsDWgZ+M2tg0xa/jPFyNtKUdKyHUyqTumAm5mHSg2AFQJk
         Y7mniOw6Qmcfjl1fmkdTALAccO7AxMLbvA7thncJybg95AULtQWQoSjFC3nOr/5NHqGV
         fUHI8hfTBRBpwXYPwwS/biVUdnXr4XZMYXy1E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=dMM16J+ZDXLyS/Fo3vtSctttASTF+5dXa3Ri6cpR+GTmqC5ygv7jMQ81oo8ocMQqvi
         bdLLJAZIppQ8ERAtReK7eyw52AwNDcFkSQUHbOaVBzmcU88YSpCpKtwqsrAwoc9R73bq
         xJ8cW8QMExQotK/BWjHNbD7fI9sTRCkX1Kuk0=
MIME-Version: 1.0
Received: by 10.100.233.19 with SMTP id f19mr2995084anh.72.1255890163803; Sun, 
	18 Oct 2009 11:22:43 -0700 (PDT)
In-Reply-To: <25948812.post@talk.nabble.com>
References: <25947462.post@talk.nabble.com>
	 <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>
	 <25948812.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 11:22:43 -0700
Message-ID: <8837fb770910181122x6c4d83bicebdcecb9fcba5d2@mail.gmail.com>
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many 
	files open java error.
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636b2b48e172623047639b75c
X-Virus-Checked: Checked by ClamAV on apache.org

--001636b2b48e172623047639b75c
Content-Type: text/plain; charset=ISO-8859-1

Hi Glen:
     I think it is in your application code:

The indexReader returned is not closed if the underlying index has changed.
If your update rate is high, you will run into this issue because GC may not
have caught up with the FH leak.

THe code should instead be:

if (indexReader!=null){
   IndexReader newReader = indexReader.reopen();
   if (newReader!=indexReader){
      indexReader.close();    // close the old reader
   }
}

However, with Lucene 2.9, you can also use:

IndexReader r = writer.getReader();, which is a much simpler API. You still
need to close the reader when you are done with them however.

-John

On Sun, Oct 18, 2009 at 10:47 AM, GlenAbbeyDrive <wende.long@gmail.com>wrote:

>
> I commit the IndexWriter every 200 documents in a batch as follows and you
> can see that I reopened the reader after the commit.
>
> private void commit(IndexWriter writer) throws CorruptIndexException,
> IOException, SQLException  {
>                writer.commit();
>                if(indexReader!=null)
>                        indexReader.reopen();
> }
>
> What do you mean by real-time reader?
>
> Thanks.
>
>
> Michael McCandless-2 wrote:
> >
> > Hmm, not good.  Can you share more details about how your app is using
> > Lucene?
> >
> > Do you also have an IndexReader that's open on this directory?  Do you
> > reopen it after indexing documents?  If so, using IndexReader.reopen
> > or by closing and opening a new IndexReader?  Or, by getting a near
> > real-time reader?
> >
> > Are you closing the IndexWriter after each batch, or calling commit?
> >
> > Mike
> >
> > On Sun, Oct 18, 2009 at 11:14 AM, GlenAbbeyDrive <wende.long@gmail.com>
> > wrote:
> >>
> >> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too
> many
> >> files open within a few hours from my indexing process.  Our indexing
> >> Java
> >> process adds about 2000 documents/minute.
> >> The IndexWriter (iw) has the following settings:
> >>
> >>            iw.setMaxFieldLength(1024*1024*1024); // 1G as maximum terms.
> >>            iw.setMergeFactor(10);
> >>            iw.setMaxMergeDocs(100000);
> >>            iw.setMaxBufferedDocs(1000);
> >>            iw.setRAMBufferSizeMB(128);
> >>            iw.setUseCompoundFile(true);
> >>
> >>
> >>
> >> The 'lsof' result shows rapidly growing number of open files in
> 'deleted'
> >> state. Counting the number of these:
> >>
> >> [server-1]#date
> >> Sun Oct 18 11:02:37 EDT 2009
> >> [server-1]# lsof -p 19606 |grep deleted  |wc -l
> >> 3187
> >> [server-1]# date
> >> Sun Oct 18 11:07:29 EDT 2009
> >> [server-1]# lsof -p 19606 |grep deleted  |wc -l
> >> 3912
> >>
> >> Here is a sample of those open files left behind in 'deleted' state:
> >>
> >> java    19606 root 1861r   REG       8,17    273561 368673054
> >> /archive/index/_5fq.cfs (deleted)
> >> java    19606 root 1862r   REG       8,17      9428 368673053
> >> /archive/index/_5fp.cfs (deleted)
> >> java    19606 root 1863r   REG       8,17    363690 368673052
> >> /archive/index/_5fo.cfs (deleted)
> >> java    19606 root 1864r   REG       8,17     47732 368673051
> >> /archive/index/_5fn.cfs (deleted)
> >> java    19606 root 1865r   REG       8,17    417453 368673050
> >> /archive/index/_5fm.cfs (deleted)
> >> java    19606 root 1866r   REG       8,17   1518126 368673049
> >> /archive/index/_5fl.cfs (deleted)
> >> java    19606 root 1871r   REG       8,17   1236023 368673057
> >> /archive/index/_5ft.cfs (deleted)
> >> java    19606 root 1872r   REG       8,17     29743 368673055
> >> /archive/index/_5fr.cfs (deleted)
> >> java    19606 root 1873r   REG       8,17    273561 368673054
> >> /archive/index/_5fq.cfs (deleted)
> >> java    19606 root 1874r   REG       8,17      9428 368673053
> >> /archive/index/_5fp.cfs (deleted)
> >> java    19606 root 1875r   REG       8,17    363690 368673052
> >> /archive/index/_5fo.cfs (deleted)
> >> java    19606 root 1876r   REG       8,17     47732 368673051
> >> /archive/index/_5fn.cfs (deleted)
> >> java    19606 root 1877r   REG       8,17    417453 368673050
> >> /archive/index/_5fm.cfs (deleted)
> >> java    19606 root 1878r   REG       8,17   1518126 368673049
> >> /archive/index/_5fl.cfs (deleted)
> >> java    19606 root 1883r   REG       8,17   1389856 368673056
> >> /archive/index/_5fs.cfs (deleted)
> >> java    19606 root 1884r   REG       8,17     29743 368673055
> >> /archive/index/_5fr.cfs (deleted)
> >> java    19606 root 1885r   REG       8,17    273561 368673054
> >> /archive/index/_5fq.cfs (deleted)
> >> java    19606 root 1886r   REG       8,17      9428 368673053
> >> /archive/index/_5fp.cfs (deleted)
> >> java    19606 root 1887r   REG       8,17    363690 368673052
> >> /archive/index/_5fo.cfs (deleted)
> >> java    19606 root 1888r   REG       8,17     47732 368673051
> >> /archive/index/_5fn.cfs (deleted)
> >> java    19606 root 1889r   REG       8,17    417453 368673050
> >> /archive/index/_5fm.cfs (deleted)
> >> java    19606 root 1890r   REG       8,17   1518126 368673049
> >> /archive/index/_5fl.cfs (deleted)
> >> java    19606 root 1895r   REG       8,17   1389856 368673056
> >> /archive/index/_5fs.cfs (deleted)
> >> java    19606 root 1896r   REG       8,17     29743 368673055
> >> /archive/index/_5fr.cfs (deleted)
> >> java    19606 root 1897r   REG       8,17    273561 368673054
> >> /archive/index/_5fq.cfs (deleted)
> >> java    19606 root 1898r   REG       8,17      9428 368673053
> >> /archive/index/_5fp.cfs (deleted)
> >> java    19606 root 1899r   REG       8,17    363690 368673052
> >> /archive/index/_5fo.cfs (deleted)
> >> java    19606 root 1900r   REG       8,17     47732 368673051
> >> /archive/index/_5fn.cfs (deleted)
> >> java    19606 root 1901r   REG       8,17    417453 368673050
> >> /archive/index/_5fm.cfs (deleted)
> >> java    19606 root 1902r   REG       8,17   1518126 368673049
> >> /archive/index/_5fl.cfs (deleted)
> >> java    19606 root 1910r   REG       8,17    403610 368673058
> >> /archive/index/_5fu.cfs (deleted)
> >> java    19606 root 1911r   REG       8,17   1236023 368673057
> >> /archive/index/_5ft.cfs (deleted)
> >> java    19606 root 1912r   REG       8,17   1389856 368673056
> >> /archive/index/_5fs.cfs (deleted)
> >> java    19606 root 1913r   REG       8,17     29743 368673055
> >> /archive/index/_5fr.cfs (deleted)
> >> java    19606 root 1914r   REG       8,17    273561 368673054
> >> /archive/index/_5fq.cfs (deleted)
> >> java    19606 root 1915r   REG       8,17      9428 368673053
> >> /archive/index/_5fp.cfs (deleted)
> >> java    19606 root 1916r   REG       8,17    363690 368673052
> >> /archive/index/_5fo.cfs (deleted)
> >> java    19606 root 1917r   REG       8,17     47732 368673051
> >> /archive/index/_5fn.cfs (deleted)
> >> java    19606 root 1918r   REG       8,17    417453 368673050
> >> /archive/index/_5fm.cfs (deleted)
> >> java    19606 root 1919r   REG       8,17   1518126 368673049
> >> /archive/index/_5fl.cfs (deleted)
> >>
> >>
> >> --
> >> View this message in context:
> >>
> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25947462.html
> >> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
> >
>
> --
> View this message in context:
> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462p25948812.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636b2b48e172623047639b75c--

From java-user-return-42922-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 18:31:53 2009
Return-Path: <java-user-return-42922-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74870 invoked from network); 18 Oct 2009 18:31:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 18:31:53 -0000
Received: (qmail 99232 invoked by uid 500); 18 Oct 2009 18:31:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99146 invoked by uid 500); 18 Oct 2009 18:31:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99136 invoked by uid 99); 18 Oct 2009 18:31:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 18:31:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 18:31:41 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1MzaXI-0006uB-C0
	for java-user@lucene.apache.org; Sun, 18 Oct 2009 11:31:20 -0700
Message-ID: <25949130.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 11:31:20 -0700 (PDT)
From: GlenAbbeyDrive <wende.long@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many
  files open java error.
In-Reply-To: <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Nabble-From: wende.long@gmail.com
References: <25947462.post@talk.nabble.com> <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>
X-Virus-Checked: Checked by ClamAV on apache.org


Using a 'realtime' reader off the IndexWriter (writer.getReader()) instead =
of
indexReader.reopen() seems fixed this problem.


Michael McCandless-2 wrote:
>=20
> Hmm, not good.  Can you share more details about how your app is using
> Lucene?
>=20
> Do you also have an IndexReader that's open on this directory?  Do you
> reopen it after indexing documents?  If so, using IndexReader.reopen
> or by closing and opening a new IndexReader?  Or, by getting a near
> real-time reader?
>=20
> Are you closing the IndexWriter after each batch, or calling commit?
>=20
> Mike
>=20
> On Sun, Oct 18, 2009 at 11:14 AM, GlenAbbeyDrive <wende.long@gmail.com>
> wrote:
>>
>> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too man=
y
>> files open within a few hours from my indexing process. =C2=A0Our indexi=
ng
>> Java
>> process adds about 2000 documents/minute.
>> The IndexWriter (iw) has the following settings:
>>
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxFieldLength(1024*1024*=
1024); // 1G as maximum terms.
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMergeFactor(10);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxMergeDocs(100000);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setMaxBufferedDocs(1000);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setRAMBufferSizeMB(128);
>> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0iw.setUseCompoundFile(true);
>>
>>
>>
>> The 'lsof' result shows rapidly growing number of open files in 'deleted=
'
>> state. Counting the number of these:
>>
>> [server-1]#date
>> Sun Oct 18 11:02:37 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted =C2=A0|wc -l
>> 3187
>> [server-1]# date
>> Sun Oct 18 11:07:29 EDT 2009
>> [server-1]# lsof -p 19606 |grep deleted =C2=A0|wc -l
>> 3912
>>
>> Here is a sample of those open files left behind in 'deleted' state:
>>
>> java =C2=A0 =C2=A019606 root 1861r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1862r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1863r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1864r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1865r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1866r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1871r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1872r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1873r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1874r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1875r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1876r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1877r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1878r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1883r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1884r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1885r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1886r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1887r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1888r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1889r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1890r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1895r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1896r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1897r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1898r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1899r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1900r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1901r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1902r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1910r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0403610 368673058
>> /archive/index/_5fu.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1911r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1236023 368673057
>> /archive/index/_5ft.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1912r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1389856 368673056
>> /archive/index/_5fs.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1913r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 29743 368673055
>> /archive/index/_5fr.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1914r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0273561 368673054
>> /archive/index/_5fq.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1915r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 =C2=A09428 368673053
>> /archive/index/_5fp.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1916r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0363690 368673052
>> /archive/index/_5fo.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1917r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0 47732 368673051
>> /archive/index/_5fn.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1918r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 =C2=A0417453 368673050
>> /archive/index/_5fm.cfs (deleted)
>> java =C2=A0 =C2=A019606 root 1919r =C2=A0 REG =C2=A0 =C2=A0 =C2=A0 8,17 =
=C2=A0 1518126 368673049
>> /archive/index/_5fl.cfs (deleted)
>>
>>
>> --
>> View this message in context:
>> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-ca=
using-too-many-files-open-java-error.-tp25947462p25947462.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>=20
>=20
>=20

--=20
View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-too=
-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp25947462=
p25949130.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42923-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 18 20:35:17 2009
Return-Path: <java-user-return-42923-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7224 invoked from network); 18 Oct 2009 20:35:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 18 Oct 2009 20:35:17 -0000
Received: (qmail 68293 invoked by uid 500); 18 Oct 2009 20:35:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68198 invoked by uid 500); 18 Oct 2009 20:35:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68188 invoked by uid 99); 18 Oct 2009 20:35:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 20:35:15 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 18 Oct 2009 20:35:05 +0000
Received: by ywh13 with SMTP id 13so5275519ywh.29
        for <java-user@lucene.apache.org>; Sun, 18 Oct 2009 13:34:44 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.88.8 with SMTP id l8mr6696312ybb.38.1255898084174; Sun, 18 
	Oct 2009 13:34:44 -0700 (PDT)
In-Reply-To: <25949130.post@talk.nabble.com>
References: <25947462.post@talk.nabble.com>
	 <9ac0c6aa0910181004hda4abdckd6d77ef2a532ecd8@mail.gmail.com>
	 <25949130.post@talk.nabble.com>
Date: Sun, 18 Oct 2009 16:34:44 -0400
Message-ID: <9ac0c6aa0910181334k7da8b02fo81df8ef0413b995b@mail.gmail.com>
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many 
	files open java error.
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Super!  Thanks for bringing closure.

Mike

On Sun, Oct 18, 2009 at 2:31 PM, GlenAbbeyDrive <wende.long@gmail.com> wrot=
e:
>
> Using a 'realtime' reader off the IndexWriter (writer.getReader()) instea=
d of
> indexReader.reopen() seems fixed this problem.
>
>
> Michael McCandless-2 wrote:
>>
>> Hmm, not good. =A0Can you share more details about how your app is using
>> Lucene?
>>
>> Do you also have an IndexReader that's open on this directory? =A0Do you
>> reopen it after indexing documents? =A0If so, using IndexReader.reopen
>> or by closing and opening a new IndexReader? =A0Or, by getting a near
>> real-time reader?
>>
>> Are you closing the IndexWriter after each batch, or calling commit?
>>
>> Mike
>>
>> On Sun, Oct 18, 2009 at 11:14 AM, GlenAbbeyDrive <wende.long@gmail.com>
>> wrote:
>>>
>>> I switched from Lucene 2.4.0 to the latest 2.9.0 version and got too ma=
ny
>>> files open within a few hours from my indexing process. =A0Our indexing
>>> Java
>>> process adds about 2000 documents/minute.
>>> The IndexWriter (iw) has the following settings:
>>>
>>> =A0 =A0 =A0 =A0 =A0 =A0iw.setMaxFieldLength(1024*1024*1024); // 1G as m=
aximum terms.
>>> =A0 =A0 =A0 =A0 =A0 =A0iw.setMergeFactor(10);
>>> =A0 =A0 =A0 =A0 =A0 =A0iw.setMaxMergeDocs(100000);
>>> =A0 =A0 =A0 =A0 =A0 =A0iw.setMaxBufferedDocs(1000);
>>> =A0 =A0 =A0 =A0 =A0 =A0iw.setRAMBufferSizeMB(128);
>>> =A0 =A0 =A0 =A0 =A0 =A0iw.setUseCompoundFile(true);
>>>
>>>
>>>
>>> The 'lsof' result shows rapidly growing number of open files in 'delete=
d'
>>> state. Counting the number of these:
>>>
>>> [server-1]#date
>>> Sun Oct 18 11:02:37 EDT 2009
>>> [server-1]# lsof -p 19606 |grep deleted =A0|wc -l
>>> 3187
>>> [server-1]# date
>>> Sun Oct 18 11:07:29 EDT 2009
>>> [server-1]# lsof -p 19606 |grep deleted =A0|wc -l
>>> 3912
>>>
>>> Here is a sample of those open files left behind in 'deleted' state:
>>>
>>> java =A0 =A019606 root 1861r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 368=
673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java =A0 =A019606 root 1862r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 3=
68673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java =A0 =A019606 root 1863r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 368=
673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java =A0 =A019606 root 1864r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 368=
673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java =A0 =A019606 root 1865r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 368=
673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java =A0 =A019606 root 1866r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 36867=
3049
>>> /archive/index/_5fl.cfs (deleted)
>>> java =A0 =A019606 root 1871r =A0 REG =A0 =A0 =A0 8,17 =A0 1236023 36867=
3057
>>> /archive/index/_5ft.cfs (deleted)
>>> java =A0 =A019606 root 1872r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 368=
673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java =A0 =A019606 root 1873r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 368=
673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java =A0 =A019606 root 1874r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 3=
68673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java =A0 =A019606 root 1875r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 368=
673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java =A0 =A019606 root 1876r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 368=
673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java =A0 =A019606 root 1877r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 368=
673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java =A0 =A019606 root 1878r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 36867=
3049
>>> /archive/index/_5fl.cfs (deleted)
>>> java =A0 =A019606 root 1883r =A0 REG =A0 =A0 =A0 8,17 =A0 1389856 36867=
3056
>>> /archive/index/_5fs.cfs (deleted)
>>> java =A0 =A019606 root 1884r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 368=
673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java =A0 =A019606 root 1885r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 368=
673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java =A0 =A019606 root 1886r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 3=
68673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java =A0 =A019606 root 1887r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 368=
673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java =A0 =A019606 root 1888r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 368=
673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java =A0 =A019606 root 1889r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 368=
673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java =A0 =A019606 root 1890r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 36867=
3049
>>> /archive/index/_5fl.cfs (deleted)
>>> java =A0 =A019606 root 1895r =A0 REG =A0 =A0 =A0 8,17 =A0 1389856 36867=
3056
>>> /archive/index/_5fs.cfs (deleted)
>>> java =A0 =A019606 root 1896r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 368=
673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java =A0 =A019606 root 1897r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 368=
673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java =A0 =A019606 root 1898r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 3=
68673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java =A0 =A019606 root 1899r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 368=
673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java =A0 =A019606 root 1900r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 368=
673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java =A0 =A019606 root 1901r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 368=
673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java =A0 =A019606 root 1902r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 36867=
3049
>>> /archive/index/_5fl.cfs (deleted)
>>> java =A0 =A019606 root 1910r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0403610 368=
673058
>>> /archive/index/_5fu.cfs (deleted)
>>> java =A0 =A019606 root 1911r =A0 REG =A0 =A0 =A0 8,17 =A0 1236023 36867=
3057
>>> /archive/index/_5ft.cfs (deleted)
>>> java =A0 =A019606 root 1912r =A0 REG =A0 =A0 =A0 8,17 =A0 1389856 36867=
3056
>>> /archive/index/_5fs.cfs (deleted)
>>> java =A0 =A019606 root 1913r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 29743 368=
673055
>>> /archive/index/_5fr.cfs (deleted)
>>> java =A0 =A019606 root 1914r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0273561 368=
673054
>>> /archive/index/_5fq.cfs (deleted)
>>> java =A0 =A019606 root 1915r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 =A09428 3=
68673053
>>> /archive/index/_5fp.cfs (deleted)
>>> java =A0 =A019606 root 1916r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0363690 368=
673052
>>> /archive/index/_5fo.cfs (deleted)
>>> java =A0 =A019606 root 1917r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0 47732 368=
673051
>>> /archive/index/_5fn.cfs (deleted)
>>> java =A0 =A019606 root 1918r =A0 REG =A0 =A0 =A0 8,17 =A0 =A0417453 368=
673050
>>> /archive/index/_5fm.cfs (deleted)
>>> java =A0 =A019606 root 1919r =A0 REG =A0 =A0 =A0 8,17 =A0 1518126 36867=
3049
>>> /archive/index/_5fl.cfs (deleted)
>>>
>>>
>>> --
>>> View this message in context:
>>> http://www.nabble.com/Lucene-2.9.0-leaves-too-many-.cfs-files-open%2C-c=
ausing-too-many-files-open-java-error.-tp25947462p25947462.html
>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>
>
> --
> View this message in context: http://www.nabble.com/Lucene-2.9.0-leaves-t=
oo-many-.cfs-files-open%2C-causing-too-many-files-open-java-error.-tp259474=
62p25949130.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42924-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 19 00:11:25 2009
Return-Path: <java-user-return-42924-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42387 invoked from network); 19 Oct 2009 00:11:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 19 Oct 2009 00:11:25 -0000
Received: (qmail 99374 invoked by uid 500); 19 Oct 2009 00:11:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99257 invoked by uid 500); 19 Oct 2009 00:11:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99209 invoked by uid 99); 19 Oct 2009 00:11:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 00:11:14 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HS_INDEX_PARAM
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of bradfordstephens@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 00:11:10 +0000
Received: by ywh13 with SMTP id 13so5437422ywh.29
        for <multiple recipients>; Sun, 18 Oct 2009 17:10:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=T61Lb3hrniHe0y7lpgs9bvlS7xDWP/RZG1QDYdbOyGk=;
        b=dHGPlEokAqQzbMZQ55tQHg768x0FeyYu3i5gyFp45NTkULE7hAJc/izoKeJJjECuqr
         tIQdFrgMsk+Wp89Ho7JN3C8r9Wkw3l93k7ounEa0F0na9Rv4i11/JONcPzU/NVoAm6z8
         8iaqMeORqK+G/M5Fgwgx4TIbKMObbc5t6EEPo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=VL4sf9bragwtWjqYqiMaA980h+9bx6Sm8fcep5cqJvleE+u4uudNBmPXqhnOcJLXXr
         q7bOFGgNExDkRBOTcVkblBtOoyLJBa/qVcq2ar8SPAHYYXQt681cFbTndJ51e6sflESa
         tc22SFYbAKMMJ1M6dWscgfrsLLdsxlKsjExqg=
MIME-Version: 1.0
Received: by 10.90.37.8 with SMTP id k8mr3953534agk.19.1255911049900; Sun, 18 
	Oct 2009 17:10:49 -0700 (PDT)
Date: Sun, 18 Oct 2009 17:10:49 -0700
Message-ID: <860544ed0910181710r1851f7e2vf3966e22dc3cc8a9@mail.gmail.com>
Subject: Seattle / NW Hadoop, Lucene, Apache "Cloud Stack" Meetup, Wed Oct 28 
	6:45pm
From: Bradford Stephens <bradfordstephens@gmail.com>
To: core-user@hadoop.apache.org, java-user@lucene.apache.org, 
	solr-user@lucene.apache.org, hbase-user@hadoop.apache.org, 
	pig-user@hadoop.apache.org, katta-developer@lists.sourceforge.net
Content-Type: text/plain; charset=ISO-8859-1

Greetings,

(You're receiving this e-mail because you're on a DL or I think you'd
be interested)

It's time for another Hadoop/Lucene/Apache "Cloud" stack meetup! This
month it'll be on Wednesday, the 28th, at 6:45 pm.

A *huge* thanks for everyone who showed up last month, and to Facebook
for sending someone awesome to speak about Hive. We learned quite a
bit!

For October, we will have someone speaking about Cascading, and how it
helps workflow abstraction with MapReduce. Very useful stuff to know.

We've had great attendance in the past few months, let's keep it up!
I'm always amazed by the things I learn from everyone.

We're at the University of Washington, Allen Computer Science Center
(not Electrical Engineering)

Map: http://www.washington.edu/home/maps/?CSE

Room: 303 -or- the Entry level. If there are changes, signs will be posted.

More Info:

The meetup is about 2 hours (and there's usually food): we'll have two
in-depth talks, and then several "lightning talks" of 5 minutes. We'll
then have discussion and 'social time'. Let me know if you're
interested in speaking or attending. We'd like to focus on education,
so feel free to ask questions.

Contact: Bradford Stephens, 904-415-3009, bradfordstephens@gmail.com

-- 
http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
and Distributed Lucene Consulting

http://www.roadtofailure.com -- The Fringes of Scalability, Social
Media, and Computer Science

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42925-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 19 13:39:45 2009
Return-Path: <java-user-return-42925-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59679 invoked from network); 19 Oct 2009 13:39:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 19 Oct 2009 13:39:45 -0000
Received: (qmail 42535 invoked by uid 500); 19 Oct 2009 13:39:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42488 invoked by uid 500); 19 Oct 2009 13:39:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42477 invoked by uid 99); 19 Oct 2009 13:39:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 13:39:42 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.207] (HELO homiemail-a17.g.dreamhost.com) (208.97.132.207)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 13:39:32 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a17.g.dreamhost.com (Postfix) with ESMTPA id 7C7767A805C
	for <java-user@lucene.apache.org>; Mon, 19 Oct 2009 06:39:11 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Lucene 2.9.0 leaves too many .cfs files open, causing too many files open java error.
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <25948812.post@talk.nabble.com>
Date: Mon, 19 Oct 2009 09:39:10 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <5C1BDD25-28DC-4BE3-A582-B56B4C04D960@apache.org>
References: <25948812.post@talk.nabble.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org


On Oct 18, 2009, at 1:47 PM, GlenAbbeyDrive wrote:

>
> I commit the IndexWriter every 200 documents in a batch as follows  
> and you
> can see that I reopened the reader after the commit.
>
> private void commit(IndexWriter writer) throws CorruptIndexException {
> 		writer.commit();
> 		if(indexReader!=null)
> 			indexReader.reopen();
> }

You should be checking if the reader returned by reopen() is different  
than the one you have and then if it is, you need to close the old one  
at the appropriate time.

-Grant


--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42926-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 19 16:47:15 2009
Return-Path: <java-user-return-42926-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31400 invoked from network); 19 Oct 2009 16:47:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 19 Oct 2009 16:47:15 -0000
Received: (qmail 83267 invoked by uid 500); 19 Oct 2009 16:47:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 83193 invoked by uid 500); 19 Oct 2009 16:47:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 83183 invoked by uid 99); 19 Oct 2009 16:47:12 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 16:47:12 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 16:47:02 +0000
Received: from suex07-hub-02.ad.syr.edu (suex07-hub-02.ad.syr.edu [128.230.108.196])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id n9JGkXGG008158
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Mon, 19 Oct 2009 12:46:41 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-02.ad.syr.edu ([fe80::813b:49a2:a4d5:6367%10]) with mapi; Mon, 19
 Oct 2009 12:46:30 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Mon, 19 Oct 2009 12:46:27 -0400
Subject: RE: How to make each term of query appear in at least one field of
 multiple field query
Thread-Topic: How to make each term of query appear in at least one field of
 multiple field query
Thread-Index: AcpPZ+b+Bb3mQrakTsCwYBrNIwpsAwBcv9nA
Message-ID: <2D127F11DC79714E9B6A43AC9458147F2F8EFAFE@suex07-mbx-03.ad.syr.edu>
References: <25941499.post@talk.nabble.com>
In-Reply-To: <25941499.post@talk.nabble.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2009-10-19_12:2009-09-29,2009-10-19,2009-10-19 signatures=0
X-Proofpoint-Spam-Reason: safe
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Rich,

On 10/17/2009 at 4:24 PM, Rich Livingstone wrote:
> I am a bit stumped by how to ensure that, where there are multiple
> terms in my query, that each term must appear at least once across
> all specified fields of my document.

You can create a MUST clause for each term, with a boosted SHOULD term quer=
y for each field, e.g.:

+(field1:term1^field1boost field2:term1^field2boost ...)
+(field1:term2^field1boost field2:term2^field2boost ...)
...

Steve


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42927-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 19 20:43:28 2009
Return-Path: <java-user-return-42927-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35941 invoked from network); 19 Oct 2009 20:43:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 19 Oct 2009 20:43:28 -0000
Received: (qmail 63962 invoked by uid 500); 19 Oct 2009 20:43:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63901 invoked by uid 500); 19 Oct 2009 20:43:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63891 invoked by uid 99); 19 Oct 2009 20:43:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 20:43:25 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of marcelo.ochoa@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 19 Oct 2009 20:43:23 +0000
Received: by pwi12 with SMTP id 12so691083pwi.5
        for <java-user@lucene.apache.org>; Mon, 19 Oct 2009 13:43:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=qZl8HFwMXwZRDNFKfnDqSKdTNTjVF2hZqFY9/oa7c18=;
        b=GBttancewc7d39w7cCsAgCbK26A5fZqVzJ6c3oQRti0Su1YVDKN0MoCKCNWCBZIP2u
         umB6E+neLmqRueIxziVz/Dr769vUN/0wH7s3uxB5xYMDxqPRtXuo80c2C8h7RuRLg+v5
         UzB8r5bPkTaDIyI/p3VGSVl2rgS0ODNoXJMX8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ON2EDVBtHpo9Ex9woIO6EgPBn+RI9Md5VPJAsJgk+S/r+ar0rYHpzOqEEJSpNWtHQK
         NCBPtVYcX2NUSoc2DsKc2NIcG7AuxGpLDfXNzheqyh3p3GGofAs8LmsjPFgjHBojxRsO
         QdsxUmXEemPZICDUOAw+foP+MldK5HQNmIk1c=
MIME-Version: 1.0
Received: by 10.114.214.24 with SMTP id m24mr7257814wag.93.1255984982691; Mon, 
	19 Oct 2009 13:43:02 -0700 (PDT)
In-Reply-To: <510143ac0910170059x4bd95f34ye89c81e0a349776a@mail.gmail.com>
References: <510143ac0910160054y645ef6je4e51c4104cf361c@mail.gmail.com>
	 <D3FE8CCE-74D1-4075-A28A-EF4E1E2E8D18@apache.org>
	 <510143ac0910170059x4bd95f34ye89c81e0a349776a@mail.gmail.com>
Date: Mon, 19 Oct 2009 17:43:02 -0300
Message-ID: <126142c0910191343sd763fcet623e632b4ae5d8e1@mail.gmail.com>
Subject: Re: JDBC access to a Lucene index
From: Marcelo Ochoa <marcelo.ochoa@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hi Zukka:
   This is similar approach to Lucene Domain Index:
http://docs.google.com/Doc?id=ddgw7sjp_54fgj9kg
    But Lucene Domain Index is an specific implementation for Oracle
Databases 10g/11g which is integrated through the ODCI API and
replacing the Lucene file system storage by a BLOB storage.
    Basically you defines Index on table columns and then query Lucene
Index by using a new operator:
       lcontains(col,lucene-query,op)
    two new ancillary operators:
       lscore(op)
       lhighlight(op)
    and some pipeline functions which provides highlighting, facets, and so on.
    But isn't a new JDBC driver implementation, you query Lucene
Domain Index using default Oracle's JDBC drivers.
    Best regards, Marcelo.
On Sat, Oct 17, 2009 at 4:59 AM, Jukka Zitting <jukka.zitting@gmail.com> wrote:
> Hi,
>
> On Fri, Oct 16, 2009 at 9:12 PM, Grant Ingersoll <gsingers@apache.org> wrote:
>> I'm not aware of any, but you might get more mileage asking on java-user.
>
> You're right, poor original choice of list from me.
>
> java-users@, here's my question from java-dev@:
>
> Some while ago I implemented a simple JDBC to JCR bridge [1] that
> allows one to query a JCR repository from any JDBC client, most
> notably various reporting tools.
>
> Now I'm wondering if something similar already exists for a normal
> Lucene index. Something that would treat your entire index as one huge
> table (or perhaps a set of tables based on some document type field)
> and would allow you to use simple SQL SELECTs to query data.
>
> Any pointers would be welcome. If this hasn't already been done, would
> there be interest in such a JDBC driver for Lucene?
>
> [1] http://dev.day.com/microsling/content/blogs/main/jdbc2jcr.html
>
> BR,
>
> Jukka Zitting
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



-- 
Marcelo F. Ochoa
http://marceloochoa.blogspot.com/
http://marcelo.ochoa.googlepages.com/home
______________
Want to integrate Lucene and Oracle?
http://marceloochoa.blogspot.com/2007/09/running-lucene-inside-your-oracle-jvm.html
Is Oracle 11g REST ready?
http://marceloochoa.blogspot.com/2008/02/is-oracle-11g-rest-ready.html

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42928-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 06:52:10 2009
Return-Path: <java-user-return-42928-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32252 invoked from network); 20 Oct 2009 06:52:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 06:52:10 -0000
Received: (qmail 64721 invoked by uid 500); 20 Oct 2009 06:52:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64638 invoked by uid 500); 20 Oct 2009 06:52:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64628 invoked by uid 99); 20 Oct 2009 06:52:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 06:52:06 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 06:51:57 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N08ZF-0002Nh-35
	for java-user@lucene.apache.org; Mon, 19 Oct 2009 23:51:37 -0700
Message-ID: <25970508.post@talk.nabble.com>
Date: Mon, 19 Oct 2009 23:51:37 -0700 (PDT)
From: Rich Livingstone <nabble@bananasoft.net>
To: java-user@lucene.apache.org
Subject: RE: How to make each term of query appear in at least one field of
 multiple field query
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F2F8EFAFE@suex07-mbx-03.ad.syr.edu>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: nabble@bananasoft.net
References: <25941499.post@talk.nabble.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAFE@suex07-mbx-03.ad.syr.edu>
X-Virus-Checked: Checked by ClamAV on apache.org


Good idea, Steve, thanks for that. It could end up being a very large query,
though, and my search is even more complicated by the fact I have to do
synonym expansion on the search too so

+(field1:term1^field1boost field2:term1^field2boost ...)
+(field1:term2^field1boost field2:term2^field2boost ...)

could turn into

+(field1:term1^field1boost field1:term1synonym1^field1boost
term1synonym2^field1boost  field2:term1^field2boost ...)
...

I thought about doing the expansion at indexing time but that makes it less
dynamic as changes require a reindexing and this is driving an ecommerce
website which might not take kindly to search downtime too often.

The javadocs for MultiFieldQueryParser also suggest that using this class by
creating an object & then calling parse, rather than using
MultiFieldQueryParser.parse which is what I do, could achieve the same
effect. At the moment I'm sort of working round this by doing 2 queries, one
on a concatenated field which determines the valid set of hits and doing a
union of that with a search that actually takes into account weightings
properly. Seems to work but 2 searches is obviously not so good !

I'll give it a whirl and post my results.


Steven A Rowe wrote:
> 
> Hi Rich,
> 
> On 10/17/2009 at 4:24 PM, Rich Livingstone wrote:
>> I am a bit stumped by how to ensure that, where there are multiple
>> terms in my query, that each term must appear at least once across
>> all specified fields of my document.
> 
> You can create a MUST clause for each term, with a boosted SHOULD term
> query for each field, e.g.:
> 
> +(field1:term1^field1boost field2:term1^field2boost ...)
> +(field1:term2^field1boost field2:term2^field2boost ...)
> ...
> 
> Steve
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/How-to-make-each-term-of-query-appear-in-at-least-one-field-of-multiple-field-query-tp25941499p25970508.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42929-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 15:47:58 2009
Return-Path: <java-user-return-42929-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2723 invoked from network); 20 Oct 2009 15:47:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 15:47:58 -0000
Received: (qmail 66067 invoked by uid 500); 20 Oct 2009 15:47:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65992 invoked by uid 500); 20 Oct 2009 15:47:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65982 invoked by uid 99); 20 Oct 2009 15:47:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 15:47:55 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of siraj@jobdiva.com designates 64.147.106.2 as permitted sender)
Received: from [64.147.106.2] (HELO smtp.jobdiva.com) (64.147.106.2)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 15:47:47 +0000
Received: from localhost ([127.0.0.1])
	by smtp.jobdiva.com
	for java-user@lucene.apache.org;
	Tue, 20 Oct 2009 11:31:00 -0400
Message-ID: <4ADDDB8C.9090505@jobdiva.com>
Date: Tue, 20 Oct 2009 11:47:24 -0400
From: Siraj Haider <siraj@jobdiva.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Using NumericField
Content-Type: text/plain;
	charset="ISO-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

We have an index with a number field indexed as String field=2E  We do=20=

range searches as well as sorting on this field=2E  Now we want to take=20=

advantage of the NumericField=2E  The question is=2C will I have to re-inde=
x=20
all the documents or just adding a new document with NumericField will=20=

be enough to convert the field type=3F  If a re-index is needed=2C is there=
=20
a way to re-index just one field in a document instead of re-indexing=20
the whole document=3F

thanks



This electronic mail message and any attachments may contain information wh=
ich is privileged=2C sensitive and/or otherwise exempt from disclosure unde=
r applicable law=2E The information is intended only for the use of the ind=
ividual or entity named as the addressee above=2E If you are not the intend=
ed recipient=2C you are hereby notified that any disclosure=2C copying=2C d=
istribution =28electronic or otherwise=29 or forwarding of=2C or the taking=
 of any action in reliance on=2C the contents of this transmission is stric=
tly prohibited=2E If you have received this electronic transmission in erro=
r=2C please notify us by telephone=2C facsimile=2C or e-mail as noted above=
 to arrange for the return of any electronic mail or attachments=2E Thank Y=
ou=2E


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42930-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 15:57:02 2009
Return-Path: <java-user-return-42930-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5210 invoked from network); 20 Oct 2009 15:57:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 15:57:02 -0000
Received: (qmail 86042 invoked by uid 500); 20 Oct 2009 15:57:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85996 invoked by uid 500); 20 Oct 2009 15:57:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85986 invoked by uid 99); 20 Oct 2009 15:57:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 15:57:00 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 15:56:49 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9D3B3D36006
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 17:56:29 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 9RcUO5+Ainjx for <java-user@lucene.apache.org>;
	Tue, 20 Oct 2009 17:56:19 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 6611AD36003
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 17:56:19 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <4ADDDB8C.9090505@jobdiva.com>
Subject: RE: Using NumericField
Date: Tue, 20 Oct 2009 17:56:20 +0200
Message-ID: <2280B9C7EAFF46F981EE04F970BD26F8@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <4ADDDB8C.9090505@jobdiva.com>
Thread-Index: AcpRnLZgSHl8O4qvSTSVs+ckjLl7ogAANxdA
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

You have to reindex everything, the field cannot be converted. Updating
single fields is not possible (maybe in future, see wiki).

If you use the field cache (sorting against numeric fields) it is very
important to not have any legacy terms in the index, so the best is to start
with an empty index. If you do not sort, NumericRangeQuery will simply not
hit any documents using another encoding.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Siraj Haider [mailto:siraj@jobdiva.com]
> Sent: Tuesday, October 20, 2009 5:47 PM
> To: java-user@lucene.apache.org
> Subject: Using NumericField
> 
> We have an index with a number field indexed as String field.  We do
> range searches as well as sorting on this field.  Now we want to take
> advantage of the NumericField.  The question is, will I have to re-index
> all the documents or just adding a new document with NumericField will
> be enough to convert the field type?  If a re-index is needed, is there
> a way to re-index just one field in a document instead of re-indexing
> the whole document?
> 
> thanks
> 
> 
> 
> This electronic mail message and any attachments may contain information
> which is privileged, sensitive and/or otherwise exempt from disclosure
> under applicable law. The information is intended only for the use of the
> individual or entity named as the addressee above. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution (electronic or otherwise) or forwarding of, or the taking of
> any action in reliance on, the contents of this transmission is strictly
> prohibited. If you have received this electronic transmission in error,
> please notify us by telephone, facsimile, or e-mail as noted above to
> arrange for the return of any electronic mail or attachments. Thank You.
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42931-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 17:42:49 2009
Return-Path: <java-user-return-42931-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40874 invoked from network); 20 Oct 2009 17:42:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 17:42:49 -0000
Received: (qmail 72181 invoked by uid 500); 20 Oct 2009 17:42:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72103 invoked by uid 500); 20 Oct 2009 17:42:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72093 invoked by uid 99); 20 Oct 2009 17:42:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 17:42:47 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 17:42:39 +0000
X-ASG-Debug-ID: 1256060493-160f00820000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id 3751414353
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 10:41:33 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM (rw-ex2003.broadvision.com [10.10.160.33]) by mail-fw.broadvision.com with ESMTP id wdeZ5q5u16Pln0Yh for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 10:41:33 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: Lucene 1.4.3 "Already closed" IOException
Subject: Lucene 1.4.3 "Already closed" IOException
Date: Tue, 20 Oct 2009 10:41:32 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FEFF@rw-ex2003.BROADVISION.COM>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene 1.4.3 "Already closed" IOException
Thread-Index: AcpRrJA60mSpxa2fSq6y0HXVMutWng==
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: rw-ex2003.broadvision.com[10.10.160.33]
X-Barracuda-Start-Time: 1256060493
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

We are using lucene 1.4.3, sometimes we encounter an error when creating
Searcher object with IOException: "Already closed".

I searched lucene message archive but did not see conclusive answer, any
help would be very appreciated.

Best regards, Lisheng

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42932-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 19:27:36 2009
Return-Path: <java-user-return-42932-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77389 invoked from network); 20 Oct 2009 19:27:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 19:27:36 -0000
Received: (qmail 60488 invoked by uid 500); 20 Oct 2009 19:27:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60135 invoked by uid 500); 20 Oct 2009 19:27:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60053 invoked by uid 99); 20 Oct 2009 19:27:34 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 19:27:34 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of Kuro@basistech.com designates 199.88.205.136 as permitted sender)
Received: from [199.88.205.136] (HELO mailer.basistech.com) (199.88.205.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 19:27:25 +0000
Received: from mail.basistech.com (internal.basistech.net [10.1.250.1])
	by mailer.basistech.com (Postfix) with ESMTP id 455DD368C1
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 15:27:03 -0400 (EDT)
X-DKIM: Sendmail DKIM Filter v2.8.3 mailer.basistech.com 455DD368C1
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=basistech.com;
	s=basis09aug; t=1256066823;
	bh=afCMojoku8+d/eZAV2O/II9MjGqEbVxPnRzMerVEXSA=;
	h=From:To:Date:Subject:Message-ID:Content-Type:
	 Content-Transfer-Encoding:MIME-Version;
	b=SXMK1qIxq2YqpcejHStIYFMXOgycEM2b92poJqPlLkzzyU8GYN/b25cH1UHO1urRf
	 20YW13liRsNtPzPgZgyrYNstZaz61ziptin0ewa+0gUTOx5ULxBz8ScM6oxMKfKE6B
	 9WTCfqyzjF8uNLURwtpkhvJ5MmhoCnEEPI7pLCpU=
Received: from MSG-BOX.basistech.net ([::1]) by MSG-BOX.basistech.net ([::1])
 with mapi; Tue, 20 Oct 2009 15:27:04 -0400
From: Teruhiko Kurosaka <Kuro@basistech.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 20 Oct 2009 15:27:02 -0400
Subject: Clarification on TokenStream.close() needed
Thread-Topic: Clarification on TokenStream.close() needed
Thread-Index: AcpRu0zCwxLmeI5WRXqLFaFdfqAGvA==
Message-ID: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C64C@MSG-BOX.basistech.net>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-2022-jp"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,
My Tokenizer started showing an error when I switched
to Solr 1.4 dev version.  I am not too confident but
it seems that Solr 1.4 calls close() on my Tokenizer=20
before calling reset(Reader) in order to reuse=20
the Tokenizer.  That is, close() is called more than
once.

The API doc of close() reads:
Releases resources associated with this stream.=20

So I thought close() shold be called only once,
and the Tokenizer objects cannot be reused after
close() is called.  Is my interpretation correct?

If my interpretation is wrong and it is legal to=20
call close() more than once, where is the best place=20
to free per-instance resources?

T. "Kuro" Kurosaka


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42933-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 19:48:35 2009
Return-Path: <java-user-return-42933-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82247 invoked from network); 20 Oct 2009 19:48:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 19:48:34 -0000
Received: (qmail 93954 invoked by uid 500); 20 Oct 2009 19:48:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93898 invoked by uid 500); 20 Oct 2009 19:48:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93888 invoked by uid 99); 20 Oct 2009 19:48:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 19:48:31 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 74.125.78.26 as permitted sender)
Received: from [74.125.78.26] (HELO ey-out-2122.google.com) (74.125.78.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 19:48:28 +0000
Received: by ey-out-2122.google.com with SMTP id 22so1317983eye.3
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 12:48:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=T+ylRzlydb1utfcwKxaVXh6RRtr2HoRzye0F8xiXUxI=;
        b=xq93rlHgE5VMj23e6xDXMzOi0VJR9EFDk+MwibBTrSyZ5Op7rYfTbGbQMTnPTdlQac
         qrJ3RuEoZd+GsWCIaUjCAZVrvTiEqud5JxSR0KW/YcabJouIz/9muiD9xQGR0HgwmFTi
         BqvmD7QGZl3LRX0TxCNwvM9HtTMJFbOJqaVXk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=Xcc4bpxg0qJamLjHKhPpfZ1kqKKuiWeqqgQp5B0zRKMASLycoOZY3rHMHMM7Lo4JA7
         BbDvyY4ryEaosufvTJHXdVIo0o/GtOfF2PcidX6iTq2o4WYHrYLIM/8xU2otIC0qKanb
         oq6NSlsFZ7DFsMOHIuOGhsyMwzWOaMWBr7CBc=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.91.66 with SMTP id g44mr2360775wef.121.1256068087171; Tue, 
	20 Oct 2009 12:48:07 -0700 (PDT)
In-Reply-To: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C64C@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C64C@MSG-BOX.basistech.net>
Date: Tue, 20 Oct 2009 15:48:07 -0400
X-Google-Sender-Auth: ad03d53155104cdd
Message-ID: <c68e39170910201248q4ba481f7h9f89a66a045c85a@mail.gmail.com>
Subject: Re: Clarification on TokenStream.close() needed
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

2009/10/20 Teruhiko Kurosaka <Kuro@basistech.com>:
> My Tokenizer started showing an error when I switched
> to Solr 1.4 dev version. =A0I am not too confident but
> it seems that Solr 1.4 calls close() on my Tokenizer
> before calling reset(Reader) in order to reuse
> the Tokenizer. =A0That is, close() is called more than
> once.

Is this when indexing a document, or querying a document.
close() should only be called once.

If indexing, it would be closed in Lucene at DocInverterPerField.java:197

-Yonik
http://www.lucidimagination.com



> The API doc of close() reads:
> Releases resources associated with this stream.
>
> So I thought close() shold be called only once,
> and the Tokenizer objects cannot be reused after
> close() is called. =A0Is my interpretation correct?
>
> If my interpretation is wrong and it is legal to
> call close() more than once, where is the best place
> to free per-instance resources?
>
> T. "Kuro" Kurosaka
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42934-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 19:49:20 2009
Return-Path: <java-user-return-42934-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82995 invoked from network); 20 Oct 2009 19:49:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 19:49:19 -0000
Received: (qmail 96260 invoked by uid 500); 20 Oct 2009 19:49:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 96190 invoked by uid 500); 20 Oct 2009 19:49:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 96180 invoked by uid 99); 20 Oct 2009 19:49:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 19:49:17 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 19:49:06 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 9A2BED36007
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 21:48:46 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id brSOAy329AoK for <java-user@lucene.apache.org>;
	Tue, 20 Oct 2009 21:48:32 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 4FCF9D36003
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 21:48:32 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C64C@MSG-BOX.basistech.net>
Subject: RE: Clarification on TokenStream.close() needed
Date: Tue, 20 Oct 2009 21:48:33 +0200
Message-ID: <1939AB8CBD6B429D8DF0FA2DFC3DE548@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcpRu0zCwxLmeI5WRXqLFaFdfqAGvAAAoOpQ
In-Reply-To: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C64C@MSG-BOX.basistech.net>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

TokenStream.close() is called (and was everytime called before, too), when
the tokenization is done to close the Reader. The call to reset(Reader) is
the same like creating a new instance (only that the cost of creating a new
instance is not needed).

The change in Solr 1.4 is that now TokenStreams are reused, if the Analyzer
supports it. You should release all resources in close and recreate on
reset(). If this is too costly, they should not be released in close() but
then there is no way to release them (only in finalize() which is called by
GC).

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Teruhiko Kurosaka [mailto:Kuro@basistech.com]
> Sent: Tuesday, October 20, 2009 9:27 PM
> To: java-user@lucene.apache.org
> Subject: Clarification on TokenStream.close() needed
> 
> Hi,
> My Tokenizer started showing an error when I switched
> to Solr 1.4 dev version.  I am not too confident but
> it seems that Solr 1.4 calls close() on my Tokenizer
> before calling reset(Reader) in order to reuse
> the Tokenizer.  That is, close() is called more than
> once.
> 
> The API doc of close() reads:
> Releases resources associated with this stream.
> 
> So I thought close() shold be called only once,
> and the Tokenizer objects cannot be reused after
> close() is called.  Is my interpretation correct?
> 
> If my interpretation is wrong and it is legal to
> call close() more than once, where is the best place
> to free per-instance resources?
> 
> T. "Kuro" Kurosaka
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42935-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 21:03:54 2009
Return-Path: <java-user-return-42935-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11008 invoked from network); 20 Oct 2009 21:03:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 21:03:54 -0000
Received: (qmail 28458 invoked by uid 500); 20 Oct 2009 21:03:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28381 invoked by uid 500); 20 Oct 2009 21:03:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28371 invoked by uid 99); 20 Oct 2009 21:03:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:03:52 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of natehoward1@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:03:49 +0000
Received: by pwi12 with SMTP id 12so867065pwi.5
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 14:03:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=GeZdwDJ5teK4lx/Yv8A5EWfjjfb/xMStvyxIYPiyVRI=;
        b=jlIsarXJUrGdDiQwNgCEmk9uyBNrJ3jBCHHnJgAOvl0d4H/NVenJN5I9bfAASn3aL1
         G5rpE+OxgKcwJ980NOfgjFNVhdBFp1E9F9kRmRR+OsXx/I6t7oIlqh95fHCCHlOsMoCH
         fh9Yq1qUdmcLknV3Cu05CDdrVjk63RyEBpLSk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=skLgBuvpIWUWQExnw2aNwxLB3hf7c7g8/j3qbz2qr9Pua/i3O70usUIpdYHkpNrqaa
         LUkHlSywXa8WzAgnkPJFY3rp3x5fWm/+zMI3zg9klSu3zIxjY92aaZ9jAR4oWCiNIm4O
         dn0iS86x1syMVdvRSVEGhf+bYXjv4fDT6mWws=
MIME-Version: 1.0
Received: by 10.115.61.16 with SMTP id o16mr10226270wak.15.1256072609715; Tue, 
	20 Oct 2009 14:03:29 -0700 (PDT)
Date: Tue, 20 Oct 2009 14:03:29 -0700
Message-ID: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
Subject: Hits and TopDoc
From: Nathan Howard <natehoward1@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64beb02b6d513047664314f

--0016e64beb02b6d513047664314f
Content-Type: text/plain; charset=ISO-8859-1

This is sort of related to the above question, but I'm trying to update some
(now depricated) Java/Lucene code that I've become aware of once we started
using 2.4.1 (we were previously using 2.3.2):

Hits results = MultiSearcher.search(Query));

int start = currentPage * resultsPerPage;
int stop = (currentPage + 1) * resultsPerPage();

for(int x = start; (x < searchResults.length()) && (x < stop); x++)
{
    Document doc = searchResults.doc(x);
    // do search post-processing with the Document
}

Results per page is normally small (10ish or so).

I'm having difficulty figuring out how to get TopDocs to replicate this
paging functionality (which the application must maintain).

Thanks in advance!

Nathan

--0016e64beb02b6d513047664314f--

From java-user-return-42936-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 21:22:39 2009
Return-Path: <java-user-return-42936-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20067 invoked from network); 20 Oct 2009 21:22:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 21:22:39 -0000
Received: (qmail 51348 invoked by uid 500); 20 Oct 2009 21:22:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51277 invoked by uid 500); 20 Oct 2009 21:22:37 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51267 invoked by uid 99); 20 Oct 2009 21:22:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:22:37 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 74.125.78.24 as permitted sender)
Received: from [74.125.78.24] (HELO ey-out-2122.google.com) (74.125.78.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:22:34 +0000
Received: by ey-out-2122.google.com with SMTP id 22so1339357eye.3
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 14:22:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=RDQ2KRHTjUBObs81dkrlEmz9NK0TjN99peO9qMXYHL8=;
        b=jAGPh1kAlV20OSkXBWZMkalvj+AkrYknGgNwWSlZxwHWFyxMotHy5VunGNyGdk5Qj9
         XzAZWA7VTzg7ADoGaKBs+PL2Enu2Xhjaqjybgl+Ij6N1923l647tLUSfh2wiHsS3y1/q
         6cX0oPggEUM1MfVveRdGnaJYj0rlNUBIpuysw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=MFJcY7OLow6RylCqMVFOkvj3lXDEL1fBzVO9+4BvZcAHdC/1xjaxX7wkzL6pJPZ40u
         DAGJ4+nlMiVRpls6hWo6yKu9b7OqWZUfvy08lmaE2cSflepjJOQaXXjwzxgF0UDV0Tc5
         FnIF9VTJcDOw6h3DPMSbxm4IRMHEca60oaPcM=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.85.210 with SMTP id u60mr2482787wee.226.1256073732843; 
	Tue, 20 Oct 2009 14:22:12 -0700 (PDT)
In-Reply-To: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
References: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
Date: Tue, 20 Oct 2009 17:22:12 -0400
X-Google-Sender-Auth: 8a8149204e412312
Message-ID: <c68e39170910201422s69e29cf4wb430cc685af6349@mail.gmail.com>
Subject: Re: Hits and TopDoc
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Tue, Oct 20, 2009 at 5:03 PM, Nathan Howard <natehoward1@gmail.com> wrot=
e:
> This is sort of related to the above question, but I'm trying to update s=
ome
> (now depricated) Java/Lucene code that I've become aware of once we start=
ed
> using 2.4.1 (we were previously using 2.3.2):
>
> Hits results =3D MultiSearcher.search(Query));
>
> int start =3D currentPage * resultsPerPage;
> int stop =3D (currentPage + 1) * resultsPerPage();
>
> for(int x =3D start; (x < searchResults.length()) && (x < stop); x++)
> {
> =A0 =A0Document doc =3D searchResults.doc(x);
> =A0 =A0// do search post-processing with the Document
> }
>
> Results per page is normally small (10ish or so).
>
> I'm having difficulty figuring out how to get TopDocs to replicate this
> paging functionality (which the application must maintain).

You do it tthe same way basically... calculate the biggest doc you
need ("stop"-1 in your code), ask for that many TopDocs, and then
iterate over the page you want, calling
searcher.doc(topDocs.scoreDocs[x].doc)

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42937-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 21:28:19 2009
Return-Path: <java-user-return-42937-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22121 invoked from network); 20 Oct 2009 21:28:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 21:28:19 -0000
Received: (qmail 64517 invoked by uid 500); 20 Oct 2009 21:28:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64446 invoked by uid 500); 20 Oct 2009 21:28:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64421 invoked by uid 99); 20 Oct 2009 21:28:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:28:17 +0000
X-ASF-Spam-Status: No, hits=-4.6 required=5.0
	tests=AWL,BAYES_00,RCVD_IN_DNSWL_MED
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [128.230.18.82] (HELO smtp1.syr.edu) (128.230.18.82)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:28:14 +0000
Received: from suex07-hub-01.ad.syr.edu (suex07-hub-01.ad.syr.edu [128.230.108.195])
	by smtp1.syr.edu (8.14.3/8.14.3) with ESMTP id n9KLRrsl023854
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 17:27:53 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-01.ad.syr.edu ([2002:80e6:6cc3::80e6:6cc3]) with mapi; Tue, 20 Oct
 2009 17:27:53 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 20 Oct 2009 17:27:51 -0400
Subject: RE: Hits and TopDoc
Thread-Topic: Hits and TopDoc
Thread-Index: AcpRyNjiJeVHvSiPR4OPbPsSpdnbVQAAXvyQ
Message-ID: <2D127F11DC79714E9B6A43AC9458147F2F8EFB28@suex07-mbx-03.ad.syr.edu>
References: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
In-Reply-To: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2009-10-20_13:2009-09-29,2009-10-20,2009-10-20 signatures=0
X-Proofpoint-Spam-Reason: safe

Hi Nathan,

On 10/20/2009 at 5:03 PM, Nathan Howard wrote:
> This is sort of related to the above question, but I'm trying to update
> some (now depricated) Java/Lucene code that I've become aware of once we
> started using 2.4.1 (we were previously using 2.3.2):
>=20
> Hits results =3D MultiSearcher.search(Query));
>=20
> int start =3D currentPage * resultsPerPage;
> int stop =3D (currentPage + 1) * resultsPerPage();
>=20
> for(int x =3D start; (x < searchResults.length()) && (x < stop); x++)
> {
>     Document doc =3D searchResults.doc(x);
>     // do search post-processing with the Document
> }
>=20
> Results per page is normally small (10ish or so).
>=20
> I'm having difficulty figuring out how to get TopDocs to replicate this
> paging functionality (which the application must maintain).

>From <http://lucene.apache.org/java/2_4_1/api/core/org/apache/lucene/search=
/Hits.html>:
=3D=3D=3D=3D=3D
Deprecated. Hits will be removed in Lucene 3.0.

Instead e. g. TopDocCollector and TopDocs can be used:

   TopDocCollector collector =3D new TopDocCollector(hitsPerPage);
   searcher.search(query, collector);
   ScoreDoc[] hits =3D collector.topDocs().scoreDocs;
   for (int i =3D 0; i < hits.length; i++) {
     int docId =3D hits[i].doc;
     Document d =3D searcher.doc(docId);
     // do something with current hit
     ...
=3D=3D=3D=3D=3D

Construct the TopDocCollector with your "stop" variable instead of "hitsPer=
Page", initialize the loop control variable with the value of your "start" =
variable instead of 0, and you should be good to go.

Steve


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42938-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 21:43:52 2009
Return-Path: <java-user-return-42938-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29796 invoked from network); 20 Oct 2009 21:43:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 21:43:52 -0000
Received: (qmail 90726 invoked by uid 500); 20 Oct 2009 21:43:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90648 invoked by uid 500); 20 Oct 2009 21:43:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90638 invoked by uid 99); 20 Oct 2009 21:43:50 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:43:50 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of yseeley@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 21:43:40 +0000
Received: by ewy19 with SMTP id 19so5839623ewy.28
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 14:43:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=pnxEjIzcwuPLv0YUIOf3sXl6fSL5ArV9Xevd2z83iXQ=;
        b=RciqQ7jPFKfE8VBAoW1tgOP1KO0ToLYx2ooipIV0L1ymA75YZcq/IVlYW+b5FMMQ+O
         OO+py+KTE+eB+XdcTnkWlYYfY9fV15PALRpz6FYOqCilBWG3CXeKSFirM0dEBrb38hRw
         ct1DwsTDiokZFhzfLvNUEklSPw++E/33ZF5KA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=E+BuvHpyxHxKrg7UJOha+9ClxMHB/CDrivLYFFtRz/h7stCd64fNVLqXPw5vTFemK6
         Zz2TEbBujDKlyTZ9NFRLwu94+xCpx9rmfdgC4CNEH/AhA2FPiR8Hysj4fogB2bsTkDmg
         qNrDFLDgBc55r33dLePONTiY/C4J2cJyXZYrI=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.85.210 with SMTP id u60mr2489641wee.226.1256074999970; 
	Tue, 20 Oct 2009 14:43:19 -0700 (PDT)
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F2F8EFB28@suex07-mbx-03.ad.syr.edu>
References: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFB28@suex07-mbx-03.ad.syr.edu>
Date: Tue, 20 Oct 2009 17:43:19 -0400
X-Google-Sender-Auth: 118f9842caa94333
Message-ID: <c68e39170910201443u20db39ch4dc0c4a61ef17dd5@mail.gmail.com>
Subject: Re: Hits and TopDoc
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hmm, yes, I should have thought of quoting the havadoc :-)
The Hits javadoc has been udpated though... we shouldn't be pushing
people toward collectors unless they really need them:

 *   TopDocs topDocs =3D searcher.search(query, numHits);
 *   ScoreDoc[] hits =3D topDocs.scoreDocs;
 *   for (int i =3D 0; i < hits.length; i++) {
 *     int docId =3D hits[i].doc;
 *     Document d =3D searcher.doc(docId);
 *     // do something with current hit


-Yonik
http://www.lucidimagination.com



On Tue, Oct 20, 2009 at 5:27 PM, Steven A Rowe <sarowe@syr.edu> wrote:
> Hi Nathan,
>
> On 10/20/2009 at 5:03 PM, Nathan Howard wrote:
>> This is sort of related to the above question, but I'm trying to update
>> some (now depricated) Java/Lucene code that I've become aware of once we
>> started using 2.4.1 (we were previously using 2.3.2):
>>
>> Hits results =3D MultiSearcher.search(Query));
>>
>> int start =3D currentPage * resultsPerPage;
>> int stop =3D (currentPage + 1) * resultsPerPage();
>>
>> for(int x =3D start; (x < searchResults.length()) && (x < stop); x++)
>> {
>> =A0 =A0 Document doc =3D searchResults.doc(x);
>> =A0 =A0 // do search post-processing with the Document
>> }
>>
>> Results per page is normally small (10ish or so).
>>
>> I'm having difficulty figuring out how to get TopDocs to replicate this
>> paging functionality (which the application must maintain).
>
> From <http://lucene.apache.org/java/2_4_1/api/core/org/apache/lucene/sear=
ch/Hits.html>:
> =3D=3D=3D=3D=3D
> Deprecated. Hits will be removed in Lucene 3.0.
>
> Instead e. g. TopDocCollector and TopDocs can be used:
>
> =A0 TopDocCollector collector =3D new TopDocCollector(hitsPerPage);
> =A0 searcher.search(query, collector);
> =A0 ScoreDoc[] hits =3D collector.topDocs().scoreDocs;
> =A0 for (int i =3D 0; i < hits.length; i++) {
> =A0 =A0 int docId =3D hits[i].doc;
> =A0 =A0 Document d =3D searcher.doc(docId);
> =A0 =A0 // do something with current hit
> =A0 =A0 ...
> =3D=3D=3D=3D=3D
>
> Construct the TopDocCollector with your "stop" variable instead of "hitsP=
erPage", initialize the loop control variable with the value of your "start=
" variable instead of 0, and you should be good to go.
>
> Steve
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42939-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 22:01:12 2009
Return-Path: <java-user-return-42939-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37052 invoked from network); 20 Oct 2009 22:01:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 22:01:12 -0000
Received: (qmail 7697 invoked by uid 500); 20 Oct 2009 22:01:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7626 invoked by uid 500); 20 Oct 2009 22:01:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7616 invoked by uid 99); 20 Oct 2009 22:01:10 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 22:01:10 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 22:00:58 +0000
Received: from suex07-hub-02.ad.syr.edu (suex07-hub-02.ad.syr.edu [128.230.108.196])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id n9KM0bvL031666
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 18:00:37 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-02.ad.syr.edu ([fe80::813b:49a2:a4d5:6367%10]) with mapi; Tue, 20
 Oct 2009 18:00:37 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 20 Oct 2009 18:00:35 -0400
Subject: RE: Hits and TopDoc
Thread-Topic: Hits and TopDoc
Thread-Index: AcpRzm42gnf4GsAbS+ajRCffVCL22AAAHZGQ
Message-ID: <2D127F11DC79714E9B6A43AC9458147F2F8EFB29@suex07-mbx-03.ad.syr.edu>
References: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFB28@suex07-mbx-03.ad.syr.edu>
 <c68e39170910201443u20db39ch4dc0c4a61ef17dd5@mail.gmail.com>
In-Reply-To: <c68e39170910201443u20db39ch4dc0c4a61ef17dd5@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2009-10-20_13:2009-09-29,2009-10-20,2009-10-20 signatures=0
X-Proofpoint-Spam-Reason: safe
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Yonik,

Hmm, in what version of Hits do you see this updated javadoc?  In the 2.9.0=
 version, the only change in the Hits javadoc from the 2.4.1 version in thi=
s section is that it refers to TopScoreDocCollector instead of TopDocCollec=
tor:

http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/Hits.=
html

And, of course, Hits has now been removed from trunk as part of the depreca=
tion cleansing ritual.

Steve

On 10/20/2009 at 5:43 PM, Yonik Seeley wrote:
> Hmm, yes, I should have thought of quoting the havadoc :-)
> The Hits javadoc has been udpated though... we shouldn't be pushing
> people toward collectors unless they really need them:
>=20
>  *   TopDocs topDocs =3D searcher.search(query, numHits);
>  *   ScoreDoc[] hits =3D topDocs.scoreDocs;
>  *   for (int i =3D 0; i < hits.length; i++) {
>  *     int docId =3D hits[i].doc;
>  *     Document d =3D searcher.doc(docId);
>  *     // do something with current hit
>=20
>=20
> -Yonik
> http://www.lucidimagination.com
>=20
>=20
>=20
> On Tue, Oct 20, 2009 at 5:27 PM, Steven A Rowe <sarowe@syr.edu> wrote:
> > Hi Nathan,
> >
> > On 10/20/2009 at 5:03 PM, Nathan Howard wrote:
> >> This is sort of related to the above question, but I'm trying to
> update
> >> some (now depricated) Java/Lucene code that I've become aware of
> once we
> >> started using 2.4.1 (we were previously using 2.3.2):
> >>
> >> Hits results =3D MultiSearcher.search(Query));
> >>
> >> int start =3D currentPage * resultsPerPage;
> >> int stop =3D (currentPage + 1) * resultsPerPage();
> >>
> >> for(int x =3D start; (x < searchResults.length()) && (x < stop); x++)
> >> {
> >> =A0 =A0 Document doc =3D searchResults.doc(x);
> >> =A0 =A0 // do search post-processing with the Document
> >> }
> >>
> >> Results per page is normally small (10ish or so).
> >>
> >> I'm having difficulty figuring out how to get TopDocs to replicate
> this
> >> paging functionality (which the application must maintain).
> >
> > From
> <http://lucene.apache.org/java/2_4_1/api/core/org/apache/lucene/search/
> Hits.html>:
> > =3D=3D=3D=3D=3D
> > Deprecated. Hits will be removed in Lucene 3.0.
> >
> > Instead e. g. TopDocCollector and TopDocs can be used:
> >
> > =A0 TopDocCollector collector =3D new TopDocCollector(hitsPerPage);
> > =A0 searcher.search(query, collector);
> > =A0 ScoreDoc[] hits =3D collector.topDocs().scoreDocs;
> > =A0 for (int i =3D 0; i < hits.length; i++) {
> > =A0 =A0 int docId =3D hits[i].doc;
> > =A0 =A0 Document d =3D searcher.doc(docId);
> > =A0 =A0 // do something with current hit
> > =A0 =A0 ...
> > =3D=3D=3D=3D=3D
> >
> > Construct the TopDocCollector with your "stop" variable instead of
> "hitsPerPage", initialize the loop control variable with the value of
> your "start" variable instead of 0, and you should be good to go.
> >
> > Steve


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42940-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 22:20:56 2009
Return-Path: <java-user-return-42940-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 46043 invoked from network); 20 Oct 2009 22:20:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 22:20:56 -0000
Received: (qmail 41464 invoked by uid 500); 20 Oct 2009 22:20:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41393 invoked by uid 500); 20 Oct 2009 22:20:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41383 invoked by uid 99); 20 Oct 2009 22:20:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 22:20:54 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.173] (HELO mail-yx0-f173.google.com) (209.85.210.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 22:20:44 +0000
Received: by yxe3 with SMTP id 3so5165299yxe.20
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 15:20:22 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.27.1 with SMTP id a1mr11619903yba.125.1256077222291; Tue, 
	20 Oct 2009 15:20:22 -0700 (PDT)
In-Reply-To: <2D127F11DC79714E9B6A43AC9458147F2F8EFB29@suex07-mbx-03.ad.syr.edu>
References: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFB28@suex07-mbx-03.ad.syr.edu>
	 <c68e39170910201443u20db39ch4dc0c4a61ef17dd5@mail.gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFB29@suex07-mbx-03.ad.syr.edu>
Date: Tue, 20 Oct 2009 18:20:22 -0400
Message-ID: <9ac0c6aa0910201520x5fa37090g1c965c142051327c@mail.gmail.com>
Subject: Re: Hits and TopDoc
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

That update to the Hits javadoc didn't make 2.9.0, but will be in
2.9.1 (it's committed to the 2.9.x branch now).

Mike

On Tue, Oct 20, 2009 at 6:00 PM, Steven A Rowe <sarowe@syr.edu> wrote:
> Hi Yonik,
>
> Hmm, in what version of Hits do you see this updated javadoc? =A0In the 2=
.9.0 version, the only change in the Hits javadoc from the 2.4.1 version in=
 this section is that it refers to TopScoreDocCollector instead of TopDocCo=
llector:
>
> http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/Hit=
s.html
>
> And, of course, Hits has now been removed from trunk as part of the depre=
cation cleansing ritual.
>
> Steve
>
> On 10/20/2009 at 5:43 PM, Yonik Seeley wrote:
>> Hmm, yes, I should have thought of quoting the havadoc :-)
>> The Hits javadoc has been udpated though... we shouldn't be pushing
>> people toward collectors unless they really need them:
>>
>> =A0* =A0 TopDocs topDocs =3D searcher.search(query, numHits);
>> =A0* =A0 ScoreDoc[] hits =3D topDocs.scoreDocs;
>> =A0* =A0 for (int i =3D 0; i < hits.length; i++) {
>> =A0* =A0 =A0 int docId =3D hits[i].doc;
>> =A0* =A0 =A0 Document d =3D searcher.doc(docId);
>> =A0* =A0 =A0 // do something with current hit
>>
>>
>> -Yonik
>> http://www.lucidimagination.com
>>
>>
>>
>> On Tue, Oct 20, 2009 at 5:27 PM, Steven A Rowe <sarowe@syr.edu> wrote:
>> > Hi Nathan,
>> >
>> > On 10/20/2009 at 5:03 PM, Nathan Howard wrote:
>> >> This is sort of related to the above question, but I'm trying to
>> update
>> >> some (now depricated) Java/Lucene code that I've become aware of
>> once we
>> >> started using 2.4.1 (we were previously using 2.3.2):
>> >>
>> >> Hits results =3D MultiSearcher.search(Query));
>> >>
>> >> int start =3D currentPage * resultsPerPage;
>> >> int stop =3D (currentPage + 1) * resultsPerPage();
>> >>
>> >> for(int x =3D start; (x < searchResults.length()) && (x < stop); x++)
>> >> {
>> >> =A0 =A0 Document doc =3D searchResults.doc(x);
>> >> =A0 =A0 // do search post-processing with the Document
>> >> }
>> >>
>> >> Results per page is normally small (10ish or so).
>> >>
>> >> I'm having difficulty figuring out how to get TopDocs to replicate
>> this
>> >> paging functionality (which the application must maintain).
>> >
>> > From
>> <http://lucene.apache.org/java/2_4_1/api/core/org/apache/lucene/search/
>> Hits.html>:
>> > =3D=3D=3D=3D=3D
>> > Deprecated. Hits will be removed in Lucene 3.0.
>> >
>> > Instead e. g. TopDocCollector and TopDocs can be used:
>> >
>> > =A0 TopDocCollector collector =3D new TopDocCollector(hitsPerPage);
>> > =A0 searcher.search(query, collector);
>> > =A0 ScoreDoc[] hits =3D collector.topDocs().scoreDocs;
>> > =A0 for (int i =3D 0; i < hits.length; i++) {
>> > =A0 =A0 int docId =3D hits[i].doc;
>> > =A0 =A0 Document d =3D searcher.doc(docId);
>> > =A0 =A0 // do something with current hit
>> > =A0 =A0 ...
>> > =3D=3D=3D=3D=3D
>> >
>> > Construct the TopDocCollector with your "stop" variable instead of
>> "hitsPerPage", initialize the loop control variable with the value of
>> your "start" variable instead of 0, and you should be good to go.
>> >
>> > Steve
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42941-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 22:29:58 2009
Return-Path: <java-user-return-42941-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 47963 invoked from network); 20 Oct 2009 22:29:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 22:29:58 -0000
Received: (qmail 53471 invoked by uid 500); 20 Oct 2009 22:29:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53391 invoked by uid 500); 20 Oct 2009 22:29:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53381 invoked by uid 99); 20 Oct 2009 22:29:55 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 22:29:55 +0000
X-ASF-Spam-Status: No, hits=-3.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 22:29:51 +0000
Received: from suex07-hub-02.ad.syr.edu (suex07-hub-02.ad.syr.edu [128.230.108.196])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id n9KMTUai022581
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 18:29:30 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-02.ad.syr.edu ([fe80::813b:49a2:a4d5:6367%10]) with mapi; Tue, 20
 Oct 2009 18:29:30 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 20 Oct 2009 18:29:28 -0400
Subject: RE: Hits and TopDoc
Thread-Topic: Hits and TopDoc
Thread-Index: AcpR05xLjtNcAqtjRI2xfX9tWz54twAACq6Q
Message-ID: <2D127F11DC79714E9B6A43AC9458147F2F8EFB2A@suex07-mbx-03.ad.syr.edu>
References: <4ad1ca1b0910201403h1397c647yb43f11d0e3d51684@mail.gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFB28@suex07-mbx-03.ad.syr.edu>
	 <c68e39170910201443u20db39ch4dc0c4a61ef17dd5@mail.gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFB29@suex07-mbx-03.ad.syr.edu>
 <9ac0c6aa0910201520x5fa37090g1c965c142051327c@mail.gmail.com>
In-Reply-To: <9ac0c6aa0910201520x5fa37090g1c965c142051327c@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2009-10-21_01:2009-09-29,2009-10-20,2009-10-20 signatures=0
X-Proofpoint-Spam-Reason: safe

Aha, my bad - I looked on ViewVC at the 2.9.0 *tag*, not the 2.9 *branch*, =
and LUCENE-1955 emails went in one speaker and out the other.

Steve

> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Tuesday, October 20, 2009 6:20 PM
> To: java-user@lucene.apache.org
> Subject: Re: Hits and TopDoc
>=20
> That update to the Hits javadoc didn't make 2.9.0, but will be in
> 2.9.1 (it's committed to the 2.9.x branch now).
>=20
> Mike
>=20
> On Tue, Oct 20, 2009 at 6:00 PM, Steven A Rowe <sarowe@syr.edu> wrote:
> > Hi Yonik,
> >
> > Hmm, in what version of Hits do you see this updated javadoc? =A0In the
> 2.9.0 version, the only change in the Hits javadoc from the 2.4.1
> version in this section is that it refers to TopScoreDocCollector
> instead of TopDocCollector:
> >
> >
> http://lucene.apache.org/java/2_9_0/api/core/org/apache/lucene/search/H
> its.html
> >
> > And, of course, Hits has now been removed from trunk as part of the
> deprecation cleansing ritual.
> >
> > Steve
> >
> > On 10/20/2009 at 5:43 PM, Yonik Seeley wrote:
> >> Hmm, yes, I should have thought of quoting the havadoc :-)
> >> The Hits javadoc has been udpated though... we shouldn't be pushing
> >> people toward collectors unless they really need them:
> >>
> >> =A0* =A0 TopDocs topDocs =3D searcher.search(query, numHits);
> >> =A0* =A0 ScoreDoc[] hits =3D topDocs.scoreDocs;
> >> =A0* =A0 for (int i =3D 0; i < hits.length; i++) {
> >> =A0* =A0 =A0 int docId =3D hits[i].doc;
> >> =A0* =A0 =A0 Document d =3D searcher.doc(docId);
> >> =A0* =A0 =A0 // do something with current hit
> >>
> >>
> >> -Yonik
> >> http://www.lucidimagination.com
> >>
> >>
> >>
> >> On Tue, Oct 20, 2009 at 5:27 PM, Steven A Rowe <sarowe@syr.edu>
> wrote:
> >> > Hi Nathan,
> >> >
> >> > On 10/20/2009 at 5:03 PM, Nathan Howard wrote:
> >> >> This is sort of related to the above question, but I'm trying to
> >> update
> >> >> some (now depricated) Java/Lucene code that I've become aware of
> >> once we
> >> >> started using 2.4.1 (we were previously using 2.3.2):
> >> >>
> >> >> Hits results =3D MultiSearcher.search(Query));
> >> >>
> >> >> int start =3D currentPage * resultsPerPage;
> >> >> int stop =3D (currentPage + 1) * resultsPerPage();
> >> >>
> >> >> for(int x =3D start; (x < searchResults.length()) && (x < stop);
> x++)
> >> >> {
> >> >> =A0 =A0 Document doc =3D searchResults.doc(x);
> >> >> =A0 =A0 // do search post-processing with the Document
> >> >> }
> >> >>
> >> >> Results per page is normally small (10ish or so).
> >> >>
> >> >> I'm having difficulty figuring out how to get TopDocs to
> replicate
> >> this
> >> >> paging functionality (which the application must maintain).
> >> >
> >> > From
> >>
> <http://lucene.apache.org/java/2_4_1/api/core/org/apache/lucene/search/
> >> Hits.html>:
> >> > =3D=3D=3D=3D=3D
> >> > Deprecated. Hits will be removed in Lucene 3.0.
> >> >
> >> > Instead e. g. TopDocCollector and TopDocs can be used:
> >> >
> >> > =A0 TopDocCollector collector =3D new TopDocCollector(hitsPerPage);
> >> > =A0 searcher.search(query, collector);
> >> > =A0 ScoreDoc[] hits =3D collector.topDocs().scoreDocs;
> >> > =A0 for (int i =3D 0; i < hits.length; i++) {
> >> > =A0 =A0 int docId =3D hits[i].doc;
> >> > =A0 =A0 Document d =3D searcher.doc(docId);
> >> > =A0 =A0 // do something with current hit
> >> > =A0 =A0 ...
> >> > =3D=3D=3D=3D=3D
> >> >
> >> > Construct the TopDocCollector with your "stop" variable instead of
> >> "hitsPerPage", initialize the loop control variable with the value
> of
> >> your "start" variable instead of 0, and you should be good to go.
> >> >
> >> > Steve
> >
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42942-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 20 23:47:55 2009
Return-Path: <java-user-return-42942-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64639 invoked from network); 20 Oct 2009 23:47:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 20 Oct 2009 23:47:55 -0000
Received: (qmail 45834 invoked by uid 500); 20 Oct 2009 23:47:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45765 invoked by uid 500); 20 Oct 2009 23:47:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45755 invoked by uid 99); 20 Oct 2009 23:47:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 23:47:53 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of Kuro@basistech.com designates 199.88.205.136 as permitted sender)
Received: from [199.88.205.136] (HELO mailer.basistech.com) (199.88.205.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 20 Oct 2009 23:47:50 +0000
Received: from mail.basistech.com (internal.basistech.net [10.1.250.1])
	by mailer.basistech.com (Postfix) with ESMTP id 1491F368C1
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 19:47:28 -0400 (EDT)
X-DKIM: Sendmail DKIM Filter v2.8.3 mailer.basistech.com 1491F368C1
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=basistech.com;
	s=basis09aug; t=1256082448;
	bh=rcwQ8Z1u5Qzw+4dU/zzMBTZ9g5841qcwP0FLZSMoJ3o=;
	h=From:To:Date:Subject:Message-ID:References:In-Reply-To:
	 Content-Type:Content-Transfer-Encoding:MIME-Version;
	b=ZnYiVOs6OuYgm2bUrI+9f775q9H0qp+UpGT+BTmB2CBiEME6JKJm9PWMOI6ZXZXIV
	 vv4deNvp9SiQJ8Ih6dzY/Y/PEFx3JS/3Spz8C4BYIlRg5iH/A7f3e0bu6kmtKsEujq
	 ZNsuBEbVubnDjYgk5JgZ8o8yKZykpidRa3mHfdYo=
Received: from MSG-BOX.basistech.net ([::1]) by MSG-BOX.basistech.net ([::1])
 with mapi; Tue, 20 Oct 2009 19:47:29 -0400
From: Teruhiko Kurosaka <Kuro@basistech.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 20 Oct 2009 19:47:27 -0400
Subject: RE: Clarification on TokenStream.close() needed
Thread-Topic: Clarification on TokenStream.close() needed
Thread-Index: AcpRu0zCwxLmeI5WRXqLFaFdfqAGvAAAoOpQAAgrGRA=
Message-ID: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67A@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C64C@MSG-BOX.basistech.net>
 <1939AB8CBD6B429D8DF0FA2DFC3DE548@VEGA>
In-Reply-To: <1939AB8CBD6B429D8DF0FA2DFC3DE548@VEGA>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0

> From: Uwe Schindler [mailto:uwe@thetaphi.de]=20

> TokenStream.close() is called (and was everytime called=20
> before, too), when the tokenization is done to close the=20
> Reader. The call to reset(Reader) is the same like creating a=20
> new instance (only that the cost of creating a new instance=20
> is not needed).

Shouldn't that be done in end()? If not, what is
the difference in purpose between end() and close()?
What is the purpose of end()?

In any event, if close() is meant to close the Reader,
I think the current description of TokenStream.close()=20
in the javadoc is a bit confusing.  Instead of saying
"Releases resources associated with this stream.", perhaps
it should say something like "Release resources associated with
the current input source.".

-kuro
  =

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42943-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 00:35:55 2009
Return-Path: <java-user-return-42943-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 77974 invoked from network); 21 Oct 2009 00:35:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 00:35:55 -0000
Received: (qmail 84287 invoked by uid 500); 21 Oct 2009 00:35:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84212 invoked by uid 500); 21 Oct 2009 00:35:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84202 invoked by uid 99); 21 Oct 2009 00:35:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 00:35:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bbdouglas@basistech.com designates 199.88.205.136 as permitted sender)
Received: from [199.88.205.136] (HELO mailer.basistech.com) (199.88.205.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 00:35:43 +0000
Received: from mail.basistech.com (internal.basistech.net [10.1.250.1])
	by mailer.basistech.com (Postfix) with ESMTP id B8FEB368BE
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 20:35:20 -0400 (EDT)
X-DKIM: Sendmail DKIM Filter v2.8.3 mailer.basistech.com B8FEB368BE
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=basistech.com;
	s=basis09aug; t=1256085320;
	bh=MvYf1MqSW58hQ3sLDBXpZSZhEYe9dkuApLX+adLNc3g=;
	h=From:To:Date:Subject:Message-ID:Content-Type:
	 Content-Transfer-Encoding:MIME-Version;
	b=GLukGZdo7p1ce5YS/5dyNrZ9icnUnMKAwynq2atQVQ9Jjmlx+qJv2H0zs3F2bMyY2
	 dH1JF+n+aEt4iaVqMD7HOFSN3MqOZPopkc9GkuL24rVPju39Bjo0YzDZvK8l3RNz+C
	 jDpiWgjDldNZVhkU4j1Kbk66PYYUeViAHpfWibBs=
Received: from MSG-BOX.basistech.net ([::1]) by MSG-BOX.basistech.net ([::1])
 with mapi; Tue, 20 Oct 2009 20:35:22 -0400
From: Benjamin Douglas <bbdouglas@basistech.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Tue, 20 Oct 2009 20:35:19 -0400
Subject: Using org.apache.lucene.analysis.compound
Thread-Topic: Using org.apache.lucene.analysis.compound
Thread-Index: AcpR5l3guCyo85dvR76ZJShUdFbUrg==
Message-ID: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

Hello,

I've found a number of posts in different places talking about how to perfo=
rm decompounding, but I haven't found too many discussing how to use the re=
sults of decompounding. If anyone can answer this question or point me to a=
n existing discussion it would be very helpful.

In the description of the org.apache.lucene.analysis.compound package, it g=
ives the following example:

	Rindfleisch=FCberwachungsgesetz, 0, 29
	Rind, 0, 4, posIncr=3D0
	fleisch, 4, 11, posIncr=3D0
	=FCberwachung, 11, 22, posIncr=3D0
	gesetz, 23, 29, posIncr=3D0

And I see how this allows me to find single components such as "gesetz" or =
"Rind". But what if I want to find combinations of components such as "Rind=
fleisch" or "=FCberwachungsgesetz"? It seems that the pattern of using posI=
ncr=3D0 for all components excludes the possibility of finding sub-strings =
that are made up of multiple components.

Any comments or thoughts would be appreciated.

Ben Douglas

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42944-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 01:52:16 2009
Return-Path: <java-user-return-42944-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95057 invoked from network); 21 Oct 2009 01:52:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 01:52:16 -0000
Received: (qmail 31164 invoked by uid 500); 21 Oct 2009 01:52:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31090 invoked by uid 500); 21 Oct 2009 01:52:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31080 invoked by uid 99); 21 Oct 2009 01:52:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 01:52:14 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 01:52:11 +0000
X-ASG-Debug-ID: 1256089910-551100460000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id ED80C936F9
	for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 18:51:50 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM (rw-ex2003.broadvision.com [10.10.160.33]) by mail-fw.broadvision.com with ESMTP id h7p1Eb0nCsKGUf1R for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 18:51:50 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Lucene 1.4.3 "Already closed" IOException
Subject: RE: Lucene 1.4.3 "Already closed" IOException
Date: Tue, 20 Oct 2009 18:51:50 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FF07@rw-ex2003.BROADVISION.COM>
In-Reply-To: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FEFF@rw-ex2003.BROADVISION.COM>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene 1.4.3 "Already closed" IOException
Thread-Index: AcpRrJA60mSpxa2fSq6y0HXVMutWngARHMJg
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: rw-ex2003.broadvision.com[10.10.160.33]
X-Barracuda-Start-Time: 1256089910
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com


Hi,

We are using lucene 1.4.3, sometimes we encounter an error when creating
Searcher object with IOException: "Already closed".

I searched lucene message archive but did not see conclusive answer, any
help would be very appreciated.

Best regards, Lisheng

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42945-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 02:00:51 2009
Return-Path: <java-user-return-42945-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96762 invoked from network); 21 Oct 2009 02:00:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 02:00:51 -0000
Received: (qmail 34476 invoked by uid 500); 21 Oct 2009 02:00:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 34388 invoked by uid 500); 21 Oct 2009 02:00:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 34378 invoked by uid 99); 21 Oct 2009 02:00:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 02:00:49 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 02:00:46 +0000
Received: by pzk3 with SMTP id 3so4409341pzk.20
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 19:00:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=BIH6mYotlQcp3sL0Rov4LDbqFILwM2Rv1XsXlPp+1HU=;
        b=oNbN/sIEryvln1uM8XvsE4EzEGJT8eP8TMs4GbWabuzFXU22acy+qumcieeqvKu4ND
         JVegNEFNDcjHcWOBw22gLmTSt7xjK4wEvTrMnC5XqTN3u2xKqDtbitkrlBv7NPpNMc+7
         f6blqrcsQeow8tc54k/Y9Pcrs8RzTYH4LYq4A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=kQ0YDpl2rmovzysfBMbDEAYWqCZ7qxUOW3L5eDqEOW907C3CkE2X7RU2wyfyGY3xW1
         IT+Y3DZgbYVlxXJi8q5u2HhIXaqude4sx0uOMQMr856asHu90bNB/aoLqEUnFxNIVSb4
         BX91ex8QT9PnywFs3pw08Qcpzr83dbtL/HY4g=
MIME-Version: 1.0
Received: by 10.115.113.4 with SMTP id q4mr10806787wam.54.1256090426244; Tue, 
	20 Oct 2009 19:00:26 -0700 (PDT)
In-Reply-To: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net>
From: Robert Muir <rcmuir@gmail.com>
Date: Tue, 20 Oct 2009 22:00:06 -0400
Message-ID: <8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com>
Subject: Re: Using org.apache.lucene.analysis.compound
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64be862a97d2104766857f7

--0016e64be862a97d2104766857f7
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

hi, it will work because it will also decompound "Rindfleish" into Rind and
fleish, with posIncr=3D0

so if you index Rindfleisch=C3=BCberwachungsgesetz, then query with "Rindfl=
eish",
its matching because Rindfleish also gets decompounded into Rind and fleish=
.

On Tue, Oct 20, 2009 at 8:35 PM, Benjamin Douglas
<bbdouglas@basistech.com>wrote:

> Hello,
>
> I've found a number of posts in different places talking about how to
> perform decompounding, but I haven't found too many discussing how to use
> the results of decompounding. If anyone can answer this question or point=
 me
> to an existing discussion it would be very helpful.
>
> In the description of the org.apache.lucene.analysis.compound package, it
> gives the following example:
>
>        Rindfleisch=C3=BCberwachungsgesetz, 0, 29
>        Rind, 0, 4, posIncr=3D0
>        fleisch, 4, 11, posIncr=3D0
>        =C3=BCberwachung, 11, 22, posIncr=3D0
>        gesetz, 23, 29, posIncr=3D0
>
> And I see how this allows me to find single components such as "gesetz" o=
r
> "Rind". But what if I want to find combinations of components such as
> "Rindfleisch" or "=C3=BCberwachungsgesetz"? It seems that the pattern of =
using
> posIncr=3D0 for all components excludes the possibility of finding sub-st=
rings
> that are made up of multiple components.
>
> Any comments or thoughts would be appreciated.
>
> Ben Douglas
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


--=20
Robert Muir
rcmuir@gmail.com

--0016e64be862a97d2104766857f7--

From java-user-return-42946-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 06:05:52 2009
Return-Path: <java-user-return-42946-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42295 invoked from network); 21 Oct 2009 06:05:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 06:05:52 -0000
Received: (qmail 69931 invoked by uid 500); 21 Oct 2009 06:05:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69853 invoked by uid 500); 21 Oct 2009 06:05:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69843 invoked by uid 99); 21 Oct 2009 06:05:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 06:05:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of phdaveofficial@gmail.com designates 209.85.221.189 as permitted sender)
Received: from [209.85.221.189] (HELO mail-qy0-f189.google.com) (209.85.221.189)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 06:05:41 +0000
Received: by qyk27 with SMTP id 27so4364296qyk.20
        for <java-user@lucene.apache.org>; Tue, 20 Oct 2009 23:05:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=8j4CQuRDPfQFa+A+gwWdSpidv+yTbY5Uy5qhXNuUS3s=;
        b=IYDICS3leORy1IwemiPTvci6d1dGbiBd0Ww+9B/QvG2e0Z9l7wgtVazLOStHIAxAqQ
         9SRDnfUQ8MHGpgevQN0y4/5bTst5GZi8DBNRBy29WfSUUl8PsUtwWlPGjucY7olsPvkJ
         pXgSn9MXvH7QsphFskNMsqRaYpZHutyN3FADU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=r6NyRBk+lQYqBaydt+l+r/A/kU1rZf8UvW6q8Oggsa5Zdk9zo4f1v+uEGlcDKQ2r0O
         Ob5xYRzMnioLyk8poxRM/HP18NxMfXjWj15Uw3DxXy8c3HLN6F0/+jkHsjHNhSrLTKM7
         7wD8sJcMqg/niN8XOuiwFMzmknfCDsuGJjESo=
MIME-Version: 1.0
Received: by 10.229.27.19 with SMTP id g19mr1136847qcc.11.1256105120894; Tue, 
	20 Oct 2009 23:05:20 -0700 (PDT)
Date: Wed, 21 Oct 2009 11:35:20 +0530
Message-ID: <5a68f0000910202305g25719c10qd622352d91316c71@mail.gmail.com>
Subject: Parsing Error while indexing in Lucene WordNet package
From: parag dave <phdaveofficial@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163646d444880dbe04766bc331
X-Virus-Checked: Checked by ClamAV on apache.org

--00163646d444880dbe04766bc331
Content-Type: text/plain; charset=ISO-8859-1

While using the Lucene WordNet package, we found that the Syns2Index program
indexes the Synsets wrongly. For example, looking up the synsets for the
word "king", we get:

java SynLookup wnindex king
baron
magnate
mogul
power
queen
rex
scrofula
struma
tycoon

Here, "scrofula" and "struma" are extraneous. This happens because, the line
parser code in Syns2Index.java interpretes the two consecutive single quotes
in entry s(114144247,3,'king''s evil',n,1,1) in  wn_s.pl file, as
termination
of the string and separates into "king". This entry concerns
synset of words "scrofula" and "struma", and thus they get inserted in the
synset of "king". *There 1382 such entries, in wn_s.pl* and more in other
WordNet
Prolog data-base files, where such use of two consecutive single quotes
appears.

We have resolved this by adding a statement in the line parsing portion of
Syns2Index.java, as follows:

            // parse line
            line = line.substring(2);
           * line = line.replaceAll("\'\'", "`"); // added statement*
            int comma = line.indexOf(',');
            String num = line.substring(0, comma);  ... ... etc.
In short we replace "''" by "`" (a back-quote). Then on recreating the
index, we get:

java SynLookup zwnindex king
baron
magnate
mogul
power
queen
rex
tycoon

*Recently lucene-2.9.0 has been released, but wordnet package included in it
still has the same problem given above.*

-- Parag H. Dave

--00163646d444880dbe04766bc331--

From java-user-return-42947-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 09:27:56 2009
Return-Path: <java-user-return-42947-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94950 invoked from network); 21 Oct 2009 09:27:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 09:27:56 -0000
Received: (qmail 9941 invoked by uid 500); 21 Oct 2009 09:27:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9858 invoked by uid 500); 21 Oct 2009 09:27:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9848 invoked by uid 99); 21 Oct 2009 09:27:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 09:27:53 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 09:27:51 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id 1E9E53187A
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 11:27:26 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id 1305331873
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 11:27:26 +0200 (CEST)
Received: from [192.168.178.47] (BAH61c2.bah.pppool.de [77.135.97.194])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id D804D310CB
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 11:27:25 +0200 (CEST)
Message-Id: <B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com>
Content-Type: multipart/signed; boundary=Apple-Mail-14-784654687; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Using org.apache.lucene.analysis.compound
Date: Wed, 21 Oct 2009 11:27:25 +0200
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> <8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com>
X-Mailer: Apple Mail (2.936)

--Apple-Mail-14-784654687
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable


I'm interested to this analyzer.. it had escaped me and solves an old =20=

problem!
Could you report about its usage:
- did you have to feed words in a dictionary?
- does anyone have user-measures already?
... and the last question for the research fun: is there any approach =20=

towards preferring =DCberwachunggesetz as a concept than, say, =20
Fleisch=FCberwachung? (again, that could be based on a dictionary =20
probably).

thanks in advance

paul


Le 21-oct.-09 =E0 04:00, Robert Muir a =E9crit :

> hi, it will work because it will also decompound "Rindfleish" into =20
> Rind and
> fleish, with posIncr=3D0
>
> so if you index Rindfleisch=FCberwachungsgesetz, then query with =20
> "Rindfleish",
> its matching because Rindfleish also gets decompounded into Rind and =20=

> fleish.
>
> On Tue, Oct 20, 2009 at 8:35 PM, Benjamin Douglas
> <bbdouglas@basistech.com>wrote:
>
>> Hello,
>>
>> I've found a number of posts in different places talking about how to
>> perform decompounding, but I haven't found too many discussing how =20=

>> to use
>> the results of decompounding. If anyone can answer this question or =20=

>> point me
>> to an existing discussion it would be very helpful.
>>
>> In the description of the org.apache.lucene.analysis.compound =20
>> package, it
>> gives the following example:
>>
>>       Rindfleisch=FCberwachungsgesetz, 0, 29
>>       Rind, 0, 4, posIncr=3D0
>>       fleisch, 4, 11, posIncr=3D0
>>       =FCberwachung, 11, 22, posIncr=3D0
>>       gesetz, 23, 29, posIncr=3D0
>>
>> And I see how this allows me to find single components such as =20
>> "gesetz" or
>> "Rind". But what if I want to find combinations of components such as
>> "Rindfleisch" or "=FCberwachungsgesetz"? It seems that the pattern of =
=20
>> using
>> posIncr=3D0 for all components excludes the possibility of finding =20=

>> sub-strings
>> that are made up of multiple components.
>>
>> Any comments or thoughts would be appreciated.
>>
>> Ben Douglas
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
> --=20
> Robert Muir
> rcmuir@gmail.com


--Apple-Mail-14-784654687
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAyMTA5MjcyNVowIwYJKoZIhvcNAQkEMRYEFDugmYRSYKXmOn0OWE5BIYpkuwrrMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQBm
xBi95Fvt4nVLJpxVKOWUxgAM05YSu+OVEjOzKT0zgJnCzOhovWIcV8PUQi6rzF38Z04FOkeSwKh3
bv5snFBX5kld2hwZedWdB5eRbkyfKHv5lVmLYMRtZj1QoYN0yaSaen7NUkHpqgppZ46+Pd7mMyIW
lY/Zi3y06/BxpFa5OHa/3Ki0VW1t+x9OZfc6qqLZDn8O4XO6EJUq+4NMgbhXEwOn6ZklLOuWnh5v
gpoKcfDTURK2lTl+BNbadooB14/NYLcQXGBcPgwhnkyMyhpFOwKZpoOcn1nmLjS6FQGLsOLJQtoU
H493KOy5WvJmiDZP/WR48HaEvAyXMFTRz76JAAAAAAAA

--Apple-Mail-14-784654687--

From java-user-return-42948-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 09:40:19 2009
Return-Path: <java-user-return-42948-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97839 invoked from network); 21 Oct 2009 09:40:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 09:40:19 -0000
Received: (qmail 26219 invoked by uid 500); 21 Oct 2009 09:40:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26167 invoked by uid 500); 21 Oct 2009 09:40:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26157 invoked by uid 99); 21 Oct 2009 09:40:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 09:40:17 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.212.198 as permitted sender)
Received: from [209.85.212.198] (HELO mail-vw0-f198.google.com) (209.85.212.198)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 09:40:09 +0000
Received: by vws36 with SMTP id 36so4728762vws.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 02:39:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=BPBXkZh4QWL1rzrujX5kZ/9gTxAFtBFvb+NjcLE6YyY=;
        b=sSzvbYor9qvEYudFPjM6GeUGbUm2MTEqLHfaqSGWBTOqnhLSNg/ICY+q7YU0FsxEJ3
         sZekMBCFgVfEDFjs169ke56H8jdGgmCnzxZeK+l+R8hrjTJrPWYXMaEKCEHNpiwqJKvO
         J0Hm/ysyfZ/VvDohzr8cB6XzKaTK2g5br2Gwo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=rgBWAEchBic1+h3f6XdtroapmN3WWNovf935zjKJm3uFg5PD5KEUkBCkdXMShYZ8/S
         dbKpdKdU4djlgS+yL4cFuwgI55BizFRAyjSk3+wcG4EHDkqADDftuPjHZyqpRW182V0q
         8EgFNDXAzoW5uQP0juq5t0Z/oEnzyZM7uI08Q=
MIME-Version: 1.0
Received: by 10.220.123.105 with SMTP id o41mr2064696vcr.28.1256117988131; 
	Wed, 21 Oct 2009 02:39:48 -0700 (PDT)
In-Reply-To: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FEFF@rw-ex2003.BROADVISION.COM>
References: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FEFF@rw-ex2003.BROADVISION.COM>
From: Ian Lea <ian.lea@gmail.com>
Date: Wed, 21 Oct 2009 10:39:28 +0100
Message-ID: <8c4e68610910210239r760f567ci9c0d8ce5cba01169@mail.gmail.com>
Subject: Re: Lucene 1.4.3 "Already closed" IOException
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

1.4.3?  How old is that?  Maybe time to consider an upgrade.

Anyway, if you're getting that exception when creating a searcher I
guess you are using a constructor that takes an IndexReader and a
further guess would be that something has closed it.

--
Ian.


On Tue, Oct 20, 2009 at 6:41 PM, Zhang, Lisheng
<Lisheng.Zhang@broadvision.com> wrote:
> Hi,
>
> We are using lucene 1.4.3, sometimes we encounter an error when creating
> Searcher object with IOException: "Already closed".
>
> I searched lucene message archive but did not see conclusive answer, any
> help would be very appreciated.
>
> Best regards, Lisheng
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42949-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 10:12:59 2009
Return-Path: <java-user-return-42949-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12487 invoked from network); 21 Oct 2009 10:12:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 10:12:59 -0000
Received: (qmail 72102 invoked by uid 500); 21 Oct 2009 10:12:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72002 invoked by uid 500); 21 Oct 2009 10:12:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71992 invoked by uid 99); 21 Oct 2009 10:12:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 10:12:56 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 10:12:54 +0000
Received: by yxe30 with SMTP id 30so8607151yxe.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 03:12:33 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.27.1 with SMTP id a1mr12714507yba.125.1256119953288; Wed, 
	21 Oct 2009 03:12:33 -0700 (PDT)
In-Reply-To: <8c4e68610910210239r760f567ci9c0d8ce5cba01169@mail.gmail.com>
References: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FEFF@rw-ex2003.BROADVISION.COM>
	 <8c4e68610910210239r760f567ci9c0d8ce5cba01169@mail.gmail.com>
Date: Wed, 21 Oct 2009 06:12:33 -0400
Message-ID: <9ac0c6aa0910210312u477d1539idd5e81c8fa57fa7f@mail.gmail.com>
Subject: Re: Lucene 1.4.3 "Already closed" IOException
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Make sure you are not closing the IndexSearcher while still using a
Hits object obtained from it in the past.  Hits goes back and re-runs
the search if you iterate deep enough...

Mike

On Wed, Oct 21, 2009 at 5:39 AM, Ian Lea <ian.lea@gmail.com> wrote:
> 1.4.3? =A0How old is that? =A0Maybe time to consider an upgrade.
>
> Anyway, if you're getting that exception when creating a searcher I
> guess you are using a constructor that takes an IndexReader and a
> further guess would be that something has closed it.
>
> --
> Ian.
>
>
> On Tue, Oct 20, 2009 at 6:41 PM, Zhang, Lisheng
> <Lisheng.Zhang@broadvision.com> wrote:
>> Hi,
>>
>> We are using lucene 1.4.3, sometimes we encounter an error when creating
>> Searcher object with IOException: "Already closed".
>>
>> I searched lucene message archive but did not see conclusive answer, any
>> help would be very appreciated.
>>
>> Best regards, Lisheng
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42950-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 11:23:17 2009
Return-Path: <java-user-return-42950-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31122 invoked from network); 21 Oct 2009 11:23:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 11:23:17 -0000
Received: (qmail 35180 invoked by uid 500); 21 Oct 2009 11:23:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35126 invoked by uid 500); 21 Oct 2009 11:23:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35116 invoked by uid 99); 21 Oct 2009 11:23:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 11:23:15 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 11:23:06 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0ZHB-0006xT-AK
	for java-user@lucene.apache.org; Wed, 21 Oct 2009 04:22:45 -0700
Message-ID: <25990682.post@talk.nabble.com>
Date: Wed, 21 Oct 2009 04:22:45 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: singular and plural search
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


hello all

        i've a doubt in plural & singular word searching , i've got code
snippet from nabble forum , 

private static Analyzer createEnglishAnalyzer() {
return new Analyzer() {
        public TokenStream tokenStream(String fieldName, Reader reader)
{
                TokenStream result = new StandardTokenizer(reader);
                result = new StandardFilter(result);
                result = new LowerCaseFilter(result);
                result = new StopFilter(result,
StandardAnalyzer.STOP_WORDS);
                result = new SnowballFilter(result, "English");
                return result;
        }
};
} 

to do my above , but when i search for a keyword "loans" , this code turns
my keyword to "loan" and gives me the results for "loan" keyword , but when
i search for "loan" it should return the results for "loans" keyword.

please anyone suggest me.
-- 
View this message in context: http://www.nabble.com/singular-and-plural-search-tp25990682p25990682.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42951-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 11:30:52 2009
Return-Path: <java-user-return-42951-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32395 invoked from network); 21 Oct 2009 11:30:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 11:30:52 -0000
Received: (qmail 41960 invoked by uid 500); 21 Oct 2009 11:30:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41868 invoked by uid 500); 21 Oct 2009 11:30:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41858 invoked by uid 99); 21 Oct 2009 11:30:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 11:30:49 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 11:30:47 +0000
Received: by pxi3 with SMTP id 3so6793722pxi.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 04:30:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=hfChX22R+AMIVQzMm56NW/VN3LoWT0cNNlSTLf2yx70=;
        b=EH61ZYK+xw4ZLjr4VxIS4LkbxLwiyLfiTgkoey6V/yT2RGWvnBhz6CjRCaH+AZpCT1
         EydttMwhz6k6/UJsX6q2wWbCRhS6mXaUUM+meFyg+OHNLdmraQhNULU0RPtCHLVbvKDL
         fsEHktD0ilG3JXhW/Xq6HvgiSnH4TuC5EhDME=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=CVivJ3Xqjl3W9lpRRUP80bGgG3aq0VmlPVkqyak6YCL5py65aIJnocOFF75fka2NXZ
         OZaSIH4ThnUcFNq0gtFf18hA6PB+9dQObO+eWkiXxyeGYjxX5/F5WaFauUikQrlMj1mW
         IgNmgym5TT3x0PqlKwpsZ/paJYvYibj23wKjU=
MIME-Version: 1.0
Received: by 10.115.135.23 with SMTP id m23mr11957868wan.136.1256124627097; 
	Wed, 21 Oct 2009 04:30:27 -0700 (PDT)
In-Reply-To: <5a68f0000910202305g25719c10qd622352d91316c71@mail.gmail.com>
References: <5a68f0000910202305g25719c10qd622352d91316c71@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 07:30:07 -0400
Message-ID: <8f0ad1f30910210430va957dbctd76a60fff59d7d43@mail.gmail.com>
Subject: Re: Parsing Error while indexing in Lucene WordNet package
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64b04fe311a6a0476704e84

--0016e64b04fe311a6a0476704e84
Content-Type: text/plain; charset=UTF-8

thanks, this sounds like a bug, I'll play with this today.

On Wed, Oct 21, 2009 at 2:05 AM, parag dave <phdaveofficial@gmail.com>wrote:

> While using the Lucene WordNet package, we found that the Syns2Index
> program
> indexes the Synsets wrongly. For example, looking up the synsets for the
> word "king", we get:
>
> java SynLookup wnindex king
> baron
> magnate
> mogul
> power
> queen
> rex
> scrofula
> struma
> tycoon
>
> Here, "scrofula" and "struma" are extraneous. This happens because, the
> line
> parser code in Syns2Index.java interpretes the two consecutive single
> quotes
> in entry s(114144247,3,'king''s evil',n,1,1) in  wn_s.pl file, as
> termination
> of the string and separates into "king". This entry concerns
> synset of words "scrofula" and "struma", and thus they get inserted in the
> synset of "king". *There 1382 such entries, in wn_s.pl* and more in other
> WordNet
> Prolog data-base files, where such use of two consecutive single quotes
> appears.
>
> We have resolved this by adding a statement in the line parsing portion of
> Syns2Index.java, as follows:
>
>            // parse line
>            line = line.substring(2);
>           * line = line.replaceAll("\'\'", "`"); // added statement*
>            int comma = line.indexOf(',');
>            String num = line.substring(0, comma);  ... ... etc.
> In short we replace "''" by "`" (a back-quote). Then on recreating the
> index, we get:
>
> java SynLookup zwnindex king
> baron
> magnate
> mogul
> power
> queen
> rex
> tycoon
>
> *Recently lucene-2.9.0 has been released, but wordnet package included in
> it
> still has the same problem given above.*
>
> -- Parag H. Dave
>



-- 
Robert Muir
rcmuir@gmail.com

--0016e64b04fe311a6a0476704e84--

From java-user-return-42952-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 12:13:00 2009
Return-Path: <java-user-return-42952-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43660 invoked from network); 21 Oct 2009 12:13:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 12:12:59 -0000
Received: (qmail 85440 invoked by uid 500); 21 Oct 2009 12:12:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85326 invoked by uid 500); 21 Oct 2009 12:12:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85306 invoked by uid 99); 21 Oct 2009 12:12:57 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 12:12:57 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.222.176 as permitted sender)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 12:12:54 +0000
Received: by pzk6 with SMTP id 6so8493384pzk.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 05:12:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=9EzcJSuc0FTfhdfNKOU7JZaVWtYBI8XXYYyCZenPSec=;
        b=B4SWcdv5I12ho6/ep0j/2/bwMD2Lj5XN1IVV2nI7VnmqgzIIob7BeeZAWpVMpl3i+8
         +CVLpYRxfWRU2Hs3njRb9+afGRBWWCF+PQdYJAMqQ1Rq16fiuAzZCWlV1BiJSogXSAsR
         QUSkmtJ+hPP1yrrbkMnfVKXgn9n4rQulpaVkk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=tdMg/LsanOiTRNaPdfITc8WUZ2ZRGaTFTZ1C0UMc6h7kmyQLo66wf9sCeA2IX6RgBB
         NndW6qR+QKxekHGWTZU/tgRPuctoUcPdWU3YBU/pvjKKjbK/LVrALrzeVHgvOVB+KDhl
         RVRTz+yP6DjyWPBy8F+Wt3ZgrzW+FeH0QS+dY=
MIME-Version: 1.0
Received: by 10.114.7.10 with SMTP id 10mr12043673wag.90.1256127154552; Wed, 
	21 Oct 2009 05:12:34 -0700 (PDT)
In-Reply-To: <B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> 
	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com> 
	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 08:12:14 -0400
Message-ID: <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com>
Subject: Re: Using org.apache.lucene.analysis.compound
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e648afbad700cd047670e4c8

--0016e648afbad700cd047670e4c8
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Paul, there are two implementations in compounds, one is dictionary-based,
the other is hyphenation-grammar + dictionary (it restricts the
decompounding based on hyphenation rules). You could also subclass the
compound base class and implement your own.

I haven't seen any user-measures (relevance, etc), would be a cool thing to
see though.

I'm not sure I understand your last question, can you elaborate?
it might be that to improve some cases, you want to use the onlyLongestMatc=
h
parameter:
@param onlyLongestMatch Add only the longest matching subword to the stream

for scoring, I think lucene's scoring might help too, because the original
word, without decompounding, is left as a token so if you search on an exac=
t
match it should be ranked higher. (not sure if this is answering your
question)

On Wed, Oct 21, 2009 at 5:27 AM, Paul Libbrecht <paul@activemath.org> wrote=
:

>
> I'm interested to this analyzer.. it had escaped me and solves an old
> problem!
> Could you report about its usage:
> - did you have to feed words in a dictionary?
> - does anyone have user-measures already?
> ... and the last question for the research fun: is there any approach
> towards preferring =C3=9Cberwachunggesetz as a concept than, say,
> Fleisch=C3=BCberwachung? (again, that could be based on a dictionary prob=
ably).
>
> thanks in advance
>
> paul
>
>
> Le 21-oct.-09 =C3=A0 04:00, Robert Muir a =C3=A9crit :
>
>
>  hi, it will work because it will also decompound "Rindfleish" into Rind
>> and
>> fleish, with posIncr=3D0
>>
>> so if you index Rindfleisch=C3=BCberwachungsgesetz, then query with
>> "Rindfleish",
>> its matching because Rindfleish also gets decompounded into Rind and
>> fleish.
>>
>> On Tue, Oct 20, 2009 at 8:35 PM, Benjamin Douglas
>> <bbdouglas@basistech.com>wrote:
>>
>>  Hello,
>>>
>>> I've found a number of posts in different places talking about how to
>>> perform decompounding, but I haven't found too many discussing how to u=
se
>>> the results of decompounding. If anyone can answer this question or poi=
nt
>>> me
>>> to an existing discussion it would be very helpful.
>>>
>>> In the description of the org.apache.lucene.analysis.compound package, =
it
>>> gives the following example:
>>>
>>>      Rindfleisch=C3=BCberwachungsgesetz, 0, 29
>>>      Rind, 0, 4, posIncr=3D0
>>>      fleisch, 4, 11, posIncr=3D0
>>>      =C3=BCberwachung, 11, 22, posIncr=3D0
>>>      gesetz, 23, 29, posIncr=3D0
>>>
>>> And I see how this allows me to find single components such as "gesetz"
>>> or
>>> "Rind". But what if I want to find combinations of components such as
>>> "Rindfleisch" or "=C3=BCberwachungsgesetz"? It seems that the pattern o=
f using
>>> posIncr=3D0 for all components excludes the possibility of finding
>>> sub-strings
>>> that are made up of multiple components.
>>>
>>> Any comments or thoughts would be appreciated.
>>>
>>> Ben Douglas
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>>
>>
>> --
>> Robert Muir
>> rcmuir@gmail.com
>>
>
>


--=20
Robert Muir
rcmuir@gmail.com

--0016e648afbad700cd047670e4c8--

From java-user-return-42953-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 12:41:09 2009
Return-Path: <java-user-return-42953-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52804 invoked from network); 21 Oct 2009 12:41:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 12:41:09 -0000
Received: (qmail 39698 invoked by uid 500); 21 Oct 2009 12:41:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 39618 invoked by uid 500); 21 Oct 2009 12:41:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 39608 invoked by uid 99); 21 Oct 2009 12:41:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 12:41:07 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 12:40:57 +0000
Received: by iwn16 with SMTP id 16so3731002iwn.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 05:40:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=lfNPgFVdkhkXfE0uD0mLHMa3utVmjDXl2cidmD2Wiv0=;
        b=IULekgukivH870baD2DAVJgGRyPCCVz+y6bNf3pEr/m+BPn8aKg5lSTBVlgH7YBvUX
         Ocyraxs1qpkhDDko5Q4I5hqlLaDF+AkQwJowsNVZypvqV/S9bIqUwDWgxzfcxZRWGEMj
         YlLwbnplaXVnLLV4mSLE2bcmsbTGdFiMaSeik=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ZS37r9IcH5SwQLYGcO4hyxJ9lAxaon9fS4080Xor4nSinZ7b3upnkUQI8jTzhJgU5E
         GOhZKrfzmwvrsKb8iJI0gM1lj/358/V6oyCARqPChNLzdfHFq6Xlsy3P+m+m63vvSOjp
         yHFvdf3z+LP04vnJPVaN5WKBUlT6CIK+Znblw=
MIME-Version: 1.0
Received: by 10.231.120.84 with SMTP id c20mr11857966ibr.47.1256128822975; 
	Wed, 21 Oct 2009 05:40:22 -0700 (PDT)
In-Reply-To: <25990682.post@talk.nabble.com>
References: <25990682.post@talk.nabble.com>
Date: Wed, 21 Oct 2009 08:40:22 -0400
Message-ID: <359a92830910210540n17729dcbuafa43dd1103e685c@mail.gmail.com>
Subject: Re: singular and plural search
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016363b79844a51a50476714823
X-Virus-Checked: Checked by ClamAV on apache.org

--0016363b79844a51a50476714823
Content-Type: text/plain; charset=ISO-8859-1

A little more information would help here.1> Are you using the same analyzer
at both index and query time?
2> Assuming <1> is "yes", did you re-index your data after you created this
analyzer?
3> What are the results of query.toString()? Looking at that might help you
pinpoint what's going on.
4> Have you examined your index using Luke to see if it has what you *think*
it should?
5> If all of the above doesn't do you any good, I've usually found that
writing a small, self-contained test case to illustrate the problem is a
great help. Usually, during the course of writing the test case I find the
problem. And it's usually in my code <G>. And if it's *not* in my code, a
test case provides the Lucene folks with something to work with.

The analyzer itself looks like it should do what you want on a cursory
inspection.....

Best
Erick

On Wed, Oct 21, 2009 at 7:22 AM, m.harig <m.harig@gmail.com> wrote:

>
> hello all
>
>        i've a doubt in plural & singular word searching , i've got code
> snippet from nabble forum ,
>
> private static Analyzer createEnglishAnalyzer() {
> return new Analyzer() {
>        public TokenStream tokenStream(String fieldName, Reader reader)
> {
>                TokenStream result = new StandardTokenizer(reader);
>                result = new StandardFilter(result);
>                result = new LowerCaseFilter(result);
>                result = new StopFilter(result,
> StandardAnalyzer.STOP_WORDS);
>                result = new SnowballFilter(result, "English");
>                return result;
>        }
> };
> }
>
> to do my above , but when i search for a keyword "loans" , this code turns
> my keyword to "loan" and gives me the results for "loan" keyword , but when
> i search for "loan" it should return the results for "loans" keyword.
>
> please anyone suggest me.
> --
> View this message in context:
> http://www.nabble.com/singular-and-plural-search-tp25990682p25990682.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016363b79844a51a50476714823--

From java-user-return-42954-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 13:06:48 2009
Return-Path: <java-user-return-42954-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67765 invoked from network); 21 Oct 2009 13:06:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 13:06:47 -0000
Received: (qmail 76112 invoked by uid 500); 21 Oct 2009 13:06:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76041 invoked by uid 500); 21 Oct 2009 13:06:45 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76031 invoked by uid 99); 21 Oct 2009 13:06:45 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 13:06:45 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 13:06:43 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0atS-0005op-OX
	for java-user@lucene.apache.org; Wed, 21 Oct 2009 06:06:22 -0700
Message-ID: <25992140.post@talk.nabble.com>
Date: Wed, 21 Oct 2009 06:06:22 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: singular and plural search
In-Reply-To: <359a92830910210540n17729dcbuafa43dd1103e685c@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
References: <25990682.post@talk.nabble.com> <359a92830910210540n17729dcbuafa43dd1103e685c@mail.gmail.com>


thanks erick ,

A little more information would help here.1> Are you using the same analyzer
at both index and query time?

 no . sorry , am using StandardAnalyzer at the index time , during querying
am using the code snippet found from nabble.

2> Assuming <1> is "yes", did you re-index your data after you created this
analyzer?

no.

3> What are the results of query.toString()? Looking at that might help you
pinpoint what's going on.

am getting singular word for all field.

4> Have you examined your index using Luke to see if it has what you *think*
it should?

yes , i did it , it also returns the same

5> If all of the above doesn't do you any good, I've usually found that
writing a small, self-contained test case to illustrate the problem is a
great help. Usually, during the course of writing the test case I find the
problem. And it's usually in my code <G>. And if it's *not* in my code, a
test case provides the Lucene folks with something to work with.

sorry , am not clear with this.

The analyzer itself looks like it should do what you want on a cursory
inspection.....

Best
Erick

-- 
View this message in context: http://www.nabble.com/singular-and-plural-search-tp25990682p25992140.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42955-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 13:22:31 2009
Return-Path: <java-user-return-42955-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71628 invoked from network); 21 Oct 2009 13:22:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 13:22:31 -0000
Received: (qmail 97275 invoked by uid 500); 21 Oct 2009 13:22:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97220 invoked by uid 500); 21 Oct 2009 13:22:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97200 invoked by uid 99); 21 Oct 2009 13:22:29 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 13:22:29 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 13:22:23 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0b8d-00073E-9T
	for java-user@lucene.apache.org; Wed, 21 Oct 2009 06:22:03 -0700
Message-ID: <25992428.post@talk.nabble.com>
Date: Wed, 21 Oct 2009 06:22:03 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: singular and plural search
In-Reply-To: <25990682.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
References: <25990682.post@talk.nabble.com>


Thanks erick ,

    It works fine , if i use the (code snippet found from nabble) same
analyzer for both indexing & querying .

But the highlighter has gone for plural words. Hope i need to search more ,
i'll come back to you once if i can't find out.  Thanks again erick.
-- 
View this message in context: http://www.nabble.com/singular-and-plural-search-tp25990682p25992428.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42956-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 14:53:15 2009
Return-Path: <java-user-return-42956-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 459 invoked from network); 21 Oct 2009 14:53:15 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 14:53:15 -0000
Received: (qmail 32439 invoked by uid 500); 21 Oct 2009 14:52:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 32387 invoked by uid 500); 21 Oct 2009 14:52:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 32352 invoked by uid 99); 21 Oct 2009 14:52:51 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 14:52:51 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.222.209.11] (HELO mirkwood.informatics.jax.org) (209.222.209.11)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 14:52:48 +0000
Received: from [127.0.0.1] (corona [209.222.209.245])
	by mirkwood.informatics.jax.org (8.14.2/8.14.2) with ESMTP id n9LEqOv2003254
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 10:52:26 -0400 (EDT)
	(envelope-from mhall@informatics.jax.org)
Message-ID: <4ADF2028.6040309@informatics.jax.org>
Date: Wed, 21 Oct 2009 10:52:24 -0400
From: Matthew Hall <mhall@informatics.jax.org>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: singular and plural search
References: <25990682.post@talk.nabble.com> <25992428.post@talk.nabble.com>
In-Reply-To: <25992428.post@talk.nabble.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-PMX-Version: 5.5.7.378829, Antispam-Engine: 2.7.2.376379, Antispam-Data: 2009.10.21.143927
X-PerlMx-Spam: Gauge=IIIIIIII, Probability=8%, Report='
 BODY_SIZE_1000_LESS 0, BODY_SIZE_2000_LESS 0, BODY_SIZE_400_499 0, BODY_SIZE_5000_LESS 0, BODY_SIZE_7000_LESS 0, TO_NO_NAME 0, __BOUNCE_CHALLENGE_SUBJ 0, __CT 0, __CTE 0, __CT_TEXT_PLAIN 0, __HAS_MSGID 0, __MIME_TEXT_ONLY 0, __MIME_VERSION 0, __MOZILLA_MSGID 0, __SANE_MSGID 0, __TO_MALFORMED_2 0, __USER_AGENT 0'

If I recall correctly the highlighter also has an analyzer passed to 
it.  Ensure that this is the same one as well.

Matt

m.harig wrote:
> Thanks erick ,
>
>     It works fine , if i use the (code snippet found from nabble) same
> analyzer for both indexing & querying .
>
> But the highlighter has gone for plural words. Hope i need to search more ,
> i'll come back to you once if i can't find out.  Thanks again erick.
>   



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42957-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 15:59:14 2009
Return-Path: <java-user-return-42957-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21321 invoked from network); 21 Oct 2009 15:59:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 15:59:14 -0000
Received: (qmail 25574 invoked by uid 500); 21 Oct 2009 15:53:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25548 invoked by uid 500); 21 Oct 2009 15:53:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25537 invoked by uid 99); 21 Oct 2009 15:53:18 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 15:53:18 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.216.187 as permitted sender)
Received: from [209.85.216.187] (HELO mail-px0-f187.google.com) (209.85.216.187)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 15:53:10 +0000
Received: by pxi17 with SMTP id 17so4728050pxi.21
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 08:52:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=1xRoSruh9WaEZbJTOq5Dp7sFIEv9loqxnw1aPGAP1lc=;
        b=UwtbOuf3YWN6A4Oym7T8w8H3YX6K5f5SwkSKq48EtFsTFPnIu7+a1mgoq8cD2T+DlM
         QW0bx0OqQh3SijjuytS1Ktk1X8tJk5FXo/YXvfa3FyVUTvnyn9mveUwcX3tO22d1MlSt
         tTogazqyXY6zz4YEeyYjMPFjiKzIR8e2SgIyo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=CNdlFmg/O3LihVpaQjGQJ71Ti1o0yUxUYkEIt2F4QSuGuIWCgUGEyTRdnBqEmKZab4
         EzRGYMjbsH1v5dIHVy2UerXyzjuRPF/G6OZ+xYyS/HL9s9Ss12iIFiGZN1+2krGJWdzQ
         8hMTBCDxfB9ly56wI1wriSn9H+/497LscnNlY=
MIME-Version: 1.0
Received: by 10.115.135.6 with SMTP id m6mr12374989wan.22.1256140369252; Wed, 
	21 Oct 2009 08:52:49 -0700 (PDT)
In-Reply-To: <5a68f0000910202305g25719c10qd622352d91316c71@mail.gmail.com>
References: <5a68f0000910202305g25719c10qd622352d91316c71@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 11:52:25 -0400
Message-ID: <8f0ad1f30910210852n3030fd8cvedf94ef05d1c59d9@mail.gmail.com>
Subject: Re: Parsing Error while indexing in Lucene WordNet package
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64b02027f52ed047673f873
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64b02027f52ed047673f873
Content-Type: text/plain; charset=UTF-8

Hi, thanks again for reporting this.

I created an issue here: http://issues.apache.org/jira/browse/LUCENE-2001

On Wed, Oct 21, 2009 at 2:05 AM, parag dave <phdaveofficial@gmail.com>wrote:

> While using the Lucene WordNet package, we found that the Syns2Index
> program
> indexes the Synsets wrongly. For example, looking up the synsets for the
> word "king", we get:
>
> java SynLookup wnindex king
> baron
> magnate
> mogul
> power
> queen
> rex
> scrofula
> struma
> tycoon
>
> Here, "scrofula" and "struma" are extraneous. This happens because, the
> line
> parser code in Syns2Index.java interpretes the two consecutive single
> quotes
> in entry s(114144247,3,'king''s evil',n,1,1) in  wn_s.pl file, as
> termination
> of the string and separates into "king". This entry concerns
> synset of words "scrofula" and "struma", and thus they get inserted in the
> synset of "king". *There 1382 such entries, in wn_s.pl* and more in other
> WordNet
> Prolog data-base files, where such use of two consecutive single quotes
> appears.
>
> We have resolved this by adding a statement in the line parsing portion of
> Syns2Index.java, as follows:
>
>            // parse line
>            line = line.substring(2);
>           * line = line.replaceAll("\'\'", "`"); // added statement*
>            int comma = line.indexOf(',');
>            String num = line.substring(0, comma);  ... ... etc.
> In short we replace "''" by "`" (a back-quote). Then on recreating the
> index, we get:
>
> java SynLookup zwnindex king
> baron
> magnate
> mogul
> power
> queen
> rex
> tycoon
>
> *Recently lucene-2.9.0 has been released, but wordnet package included in
> it
> still has the same problem given above.*
>
> -- Parag H. Dave
>



-- 
Robert Muir
rcmuir@gmail.com

--0016e64b02027f52ed047673f873--

From java-user-return-42958-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 18:28:14 2009
Return-Path: <java-user-return-42958-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53731 invoked from network); 21 Oct 2009 18:27:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 18:27:20 -0000
Received: (qmail 95552 invoked by uid 500); 21 Oct 2009 17:48:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 88787 invoked by uid 500); 21 Oct 2009 17:46:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65717 invoked by uid 99); 21 Oct 2009 17:41:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 17:41:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bbdouglas@basistech.com designates 199.88.205.136 as permitted sender)
Received: from [199.88.205.136] (HELO mailer.basistech.com) (199.88.205.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 17:40:50 +0000
Received: from mail.basistech.com (internal.basistech.net [10.1.250.1])
	by mailer.basistech.com (Postfix) with ESMTP id 843FF368BE
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 13:40:26 -0400 (EDT)
X-DKIM: Sendmail DKIM Filter v2.8.3 mailer.basistech.com 843FF368BE
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=basistech.com;
	s=basis09aug; t=1256146826;
	bh=7m/3OhXpFYJw2rwMRwVjlEWu/+iTKyx9mg2fOPjpJgQ=;
	h=From:To:Date:Subject:Message-ID:References:In-Reply-To:
	 Content-Type:Content-Transfer-Encoding:MIME-Version;
	b=p8wPrbgaXdk2tATfWe6bSHdNKE4h6ODMnjR6lqc+dzJdsJWcDZ92DRi1suqkfXzRp
	 cEGZtf1L8jemUpPWwbzJ/ucLwE47IX08GkJyZ5jo4OnL2H+DRSxkVBqD2MU4MyzWF9
	 IycAWLu6QcQbJicWYTRmGzIy8HCOfl5243seol+Q=
Received: from MSG-BOX.basistech.net ([::1]) by MSG-BOX.basistech.net ([::1])
 with mapi; Wed, 21 Oct 2009 13:40:29 -0400
From: Benjamin Douglas <bbdouglas@basistech.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Wed, 21 Oct 2009 13:40:27 -0400
Subject: RE: Using org.apache.lucene.analysis.compound
Thread-Topic: Using org.apache.lucene.analysis.compound
Thread-Index: AcpSR9dZi++3aarWT+uYe44dvuEpLwALGVvQ
Message-ID: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net>
 	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com>
 	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org>
 <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com>
In-Reply-To: <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-Virus-Checked: Checked by ClamAV on apache.org

VGhhbmtzIGZvciBhbGwgb2YgdGhlIGFuc3dlcnMgc28gZmFyIQ0KDQpQYXVsJ3MgcXVlc3Rpb24g
aXMgc2ltaWxhciB0byBhbm90aGVyIGFzcGVjdCBJIGFtIGN1cmlvdXMgYWJvdXQ6DQoNCkdpdmVu
IHRoZSB3YXkgdGhlIHNhbXBsZSB3b3JkIGlzIGFuYWx5emVkLCBpcyB0aGVyZSBhbnl0aGluZyBp
biB0aGUgc2NvcmluZyBtZWNoYW5pc20gdGhhdCB3b3VsZCByYW5rICLDvGJlcndhY2h1bmdzZ2Vz
ZXR6IiBoaWdoZXIgdGhhbiAiZ2VzZXR6w7xiZXJ3YWNodW5nIiBvciAiZmxlaXNjaGdlc2V0eiI/
DQoNCi0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQpGcm9tOiBSb2JlcnQgTXVpciBbbWFpbHRv
OnJjbXVpckBnbWFpbC5jb21dIA0KU2VudDogV2VkbmVzZGF5LCBPY3RvYmVyIDIxLCAyMDA5IDU6
MTIgQU0NClRvOiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNClN1YmplY3Q6IFJlOiBVc2lu
ZyBvcmcuYXBhY2hlLmx1Y2VuZS5hbmFseXNpcy5jb21wb3VuZA0KDQpQYXVsLCB0aGVyZSBhcmUg
dHdvIGltcGxlbWVudGF0aW9ucyBpbiBjb21wb3VuZHMsIG9uZSBpcyBkaWN0aW9uYXJ5LWJhc2Vk
LA0KdGhlIG90aGVyIGlzIGh5cGhlbmF0aW9uLWdyYW1tYXIgKyBkaWN0aW9uYXJ5IChpdCByZXN0
cmljdHMgdGhlDQpkZWNvbXBvdW5kaW5nIGJhc2VkIG9uIGh5cGhlbmF0aW9uIHJ1bGVzKS4gWW91
IGNvdWxkIGFsc28gc3ViY2xhc3MgdGhlDQpjb21wb3VuZCBiYXNlIGNsYXNzIGFuZCBpbXBsZW1l
bnQgeW91ciBvd24uDQoNCkkgaGF2ZW4ndCBzZWVuIGFueSB1c2VyLW1lYXN1cmVzIChyZWxldmFu
Y2UsIGV0YyksIHdvdWxkIGJlIGEgY29vbCB0aGluZyB0bw0Kc2VlIHRob3VnaC4NCg0KSSdtIG5v
dCBzdXJlIEkgdW5kZXJzdGFuZCB5b3VyIGxhc3QgcXVlc3Rpb24sIGNhbiB5b3UgZWxhYm9yYXRl
Pw0KaXQgbWlnaHQgYmUgdGhhdCB0byBpbXByb3ZlIHNvbWUgY2FzZXMsIHlvdSB3YW50IHRvIHVz
ZSB0aGUgb25seUxvbmdlc3RNYXRjaA0KcGFyYW1ldGVyOg0KQHBhcmFtIG9ubHlMb25nZXN0TWF0
Y2ggQWRkIG9ubHkgdGhlIGxvbmdlc3QgbWF0Y2hpbmcgc3Vid29yZCB0byB0aGUgc3RyZWFtDQoN
CmZvciBzY29yaW5nLCBJIHRoaW5rIGx1Y2VuZSdzIHNjb3JpbmcgbWlnaHQgaGVscCB0b28sIGJl
Y2F1c2UgdGhlIG9yaWdpbmFsDQp3b3JkLCB3aXRob3V0IGRlY29tcG91bmRpbmcsIGlzIGxlZnQg
YXMgYSB0b2tlbiBzbyBpZiB5b3Ugc2VhcmNoIG9uIGFuIGV4YWN0DQptYXRjaCBpdCBzaG91bGQg
YmUgcmFua2VkIGhpZ2hlci4gKG5vdCBzdXJlIGlmIHRoaXMgaXMgYW5zd2VyaW5nIHlvdXINCnF1
ZXN0aW9uKQ0KDQpPbiBXZWQsIE9jdCAyMSwgMjAwOSBhdCA1OjI3IEFNLCBQYXVsIExpYmJyZWNo
dCA8cGF1bEBhY3RpdmVtYXRoLm9yZz4gd3JvdGU6DQoNCj4NCj4gSSdtIGludGVyZXN0ZWQgdG8g
dGhpcyBhbmFseXplci4uIGl0IGhhZCBlc2NhcGVkIG1lIGFuZCBzb2x2ZXMgYW4gb2xkDQo+IHBy
b2JsZW0hDQo+IENvdWxkIHlvdSByZXBvcnQgYWJvdXQgaXRzIHVzYWdlOg0KPiAtIGRpZCB5b3Ug
aGF2ZSB0byBmZWVkIHdvcmRzIGluIGEgZGljdGlvbmFyeT8NCj4gLSBkb2VzIGFueW9uZSBoYXZl
IHVzZXItbWVhc3VyZXMgYWxyZWFkeT8NCj4gLi4uIGFuZCB0aGUgbGFzdCBxdWVzdGlvbiBmb3Ig
dGhlIHJlc2VhcmNoIGZ1bjogaXMgdGhlcmUgYW55IGFwcHJvYWNoDQo+IHRvd2FyZHMgcHJlZmVy
cmluZyDDnGJlcndhY2h1bmdnZXNldHogYXMgYSBjb25jZXB0IHRoYW4sIHNheSwNCj4gRmxlaXNj
aMO8YmVyd2FjaHVuZz8gKGFnYWluLCB0aGF0IGNvdWxkIGJlIGJhc2VkIG9uIGEgZGljdGlvbmFy
eSBwcm9iYWJseSkuDQo+DQo+IHRoYW5rcyBpbiBhZHZhbmNlDQo+DQo+IHBhdWwNCj4NCj4NCj4g
TGUgMjEtb2N0Li0wOSDDoCAwNDowMCwgUm9iZXJ0IE11aXIgYSDDqWNyaXQgOg0KPg0KPg0KPiAg
aGksIGl0IHdpbGwgd29yayBiZWNhdXNlIGl0IHdpbGwgYWxzbyBkZWNvbXBvdW5kICJSaW5kZmxl
aXNoIiBpbnRvIFJpbmQNCj4+IGFuZA0KPj4gZmxlaXNoLCB3aXRoIHBvc0luY3I9MA0KPj4NCj4+
IHNvIGlmIHlvdSBpbmRleCBSaW5kZmxlaXNjaMO8YmVyd2FjaHVuZ3NnZXNldHosIHRoZW4gcXVl
cnkgd2l0aA0KPj4gIlJpbmRmbGVpc2giLA0KPj4gaXRzIG1hdGNoaW5nIGJlY2F1c2UgUmluZGZs
ZWlzaCBhbHNvIGdldHMgZGVjb21wb3VuZGVkIGludG8gUmluZCBhbmQNCj4+IGZsZWlzaC4NCj4+
DQo+PiBPbiBUdWUsIE9jdCAyMCwgMjAwOSBhdCA4OjM1IFBNLCBCZW5qYW1pbiBEb3VnbGFzDQo+
PiA8YmJkb3VnbGFzQGJhc2lzdGVjaC5jb20+d3JvdGU6DQo+Pg0KPj4gIEhlbGxvLA0KPj4+DQo+
Pj4gSSd2ZSBmb3VuZCBhIG51bWJlciBvZiBwb3N0cyBpbiBkaWZmZXJlbnQgcGxhY2VzIHRhbGtp
bmcgYWJvdXQgaG93IHRvDQo+Pj4gcGVyZm9ybSBkZWNvbXBvdW5kaW5nLCBidXQgSSBoYXZlbid0
IGZvdW5kIHRvbyBtYW55IGRpc2N1c3NpbmcgaG93IHRvIHVzZQ0KPj4+IHRoZSByZXN1bHRzIG9m
IGRlY29tcG91bmRpbmcuIElmIGFueW9uZSBjYW4gYW5zd2VyIHRoaXMgcXVlc3Rpb24gb3IgcG9p
bnQNCj4+PiBtZQ0KPj4+IHRvIGFuIGV4aXN0aW5nIGRpc2N1c3Npb24gaXQgd291bGQgYmUgdmVy
eSBoZWxwZnVsLg0KPj4+DQo+Pj4gSW4gdGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBvcmcuYXBhY2hl
Lmx1Y2VuZS5hbmFseXNpcy5jb21wb3VuZCBwYWNrYWdlLCBpdA0KPj4+IGdpdmVzIHRoZSBmb2xs
b3dpbmcgZXhhbXBsZToNCj4+Pg0KPj4+ICAgICAgUmluZGZsZWlzY2jDvGJlcndhY2h1bmdzZ2Vz
ZXR6LCAwLCAyOQ0KPj4+ICAgICAgUmluZCwgMCwgNCwgcG9zSW5jcj0wDQo+Pj4gICAgICBmbGVp
c2NoLCA0LCAxMSwgcG9zSW5jcj0wDQo+Pj4gICAgICDDvGJlcndhY2h1bmcsIDExLCAyMiwgcG9z
SW5jcj0wDQo+Pj4gICAgICBnZXNldHosIDIzLCAyOSwgcG9zSW5jcj0wDQo+Pj4NCj4+PiBBbmQg
SSBzZWUgaG93IHRoaXMgYWxsb3dzIG1lIHRvIGZpbmQgc2luZ2xlIGNvbXBvbmVudHMgc3VjaCBh
cyAiZ2VzZXR6Ig0KPj4+IG9yDQo+Pj4gIlJpbmQiLiBCdXQgd2hhdCBpZiBJIHdhbnQgdG8gZmlu
ZCBjb21iaW5hdGlvbnMgb2YgY29tcG9uZW50cyBzdWNoIGFzDQo+Pj4gIlJpbmRmbGVpc2NoIiBv
ciAiw7xiZXJ3YWNodW5nc2dlc2V0eiI/IEl0IHNlZW1zIHRoYXQgdGhlIHBhdHRlcm4gb2YgdXNp
bmcNCj4+PiBwb3NJbmNyPTAgZm9yIGFsbCBjb21wb25lbnRzIGV4Y2x1ZGVzIHRoZSBwb3NzaWJp
bGl0eSBvZiBmaW5kaW5nDQo+Pj4gc3ViLXN0cmluZ3MNCj4+PiB0aGF0IGFyZSBtYWRlIHVwIG9m
IG11bHRpcGxlIGNvbXBvbmVudHMuDQo+Pj4NCj4+PiBBbnkgY29tbWVudHMgb3IgdGhvdWdodHMg
d291bGQgYmUgYXBwcmVjaWF0ZWQuDQo+Pj4NCj4+PiBCZW4gRG91Z2xhcw0KPj4+DQo+Pj4gLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tDQo+Pj4gVG8gdW5zdWJzY3JpYmUsIGUtbWFpbDogamF2YS11c2VyLXVuc3Vic2Ny
aWJlQGx1Y2VuZS5hcGFjaGUub3JnDQo+Pj4gRm9yIGFkZGl0aW9uYWwgY29tbWFuZHMsIGUtbWFp
bDogamF2YS11c2VyLWhlbHBAbHVjZW5lLmFwYWNoZS5vcmcNCj4+Pg0KPj4+DQo+Pj4NCj4+DQo+
PiAtLQ0KPj4gUm9iZXJ0IE11aXINCj4+IHJjbXVpckBnbWFpbC5jb20NCj4+DQo+DQo+DQoNCg0K
LS0gDQpSb2JlcnQgTXVpcg0KcmNtdWlyQGdtYWlsLmNvbQ0K


From java-user-return-42959-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 18:49:43 2009
Return-Path: <java-user-return-42959-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75715 invoked from network); 21 Oct 2009 18:49:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 18:49:43 -0000
Received: (qmail 67955 invoked by uid 500); 21 Oct 2009 18:49:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 67916 invoked by uid 500); 21 Oct 2009 18:49:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 67906 invoked by uid 99); 21 Oct 2009 18:49:39 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 18:49:39 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.222.176 as permitted sender)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 18:49:37 +0000
Received: by pzk6 with SMTP id 6so8838061pzk.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 11:49:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=3iefIsjXNrlS+LDwHblutiFnIUVYurGuNtJ/Edd9lhM=;
        b=VS+u+HyjUQuzKPRu2s/UF1ZUwxCceXsfbKdMZ6tZ0ozlnf8jJXX0RbXwp6w+LeV9D0
         WJ+WZ4ORop5sQR+qYQIKTp8qC4NaftZoygZV9kpBBJzcaj64tynVVbHu8snDlbczU0Dy
         JNoQUmVwxYP7wWzLjgPQ+LcMw5+D0Uz8nfZe8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=jyJXgAHfomNO1MM4xAJRsu8n/zgqJtmRaT5d1aKgIw/E9thLU/zVx6rf8PVNLlNxc8
         jhDFe2HP9Q7pyfuM017PM/qNOf8yPwYVYGFNzVpdXttHA1A9jYdbiU7QjLrsyg9W6kyB
         gUvFGL3Wk22QchY6mFvR7iKQEFDamFYl2Pq/U=
MIME-Version: 1.0
Received: by 10.115.135.23 with SMTP id m23mr12657174wan.136.1256150957117; 
	Wed, 21 Oct 2009 11:49:17 -0700 (PDT)
In-Reply-To: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> 
	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com> 
	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org> <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 14:48:57 -0400
Message-ID: <8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com>
Subject: Re: Using org.apache.lucene.analysis.compound
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64b04fe9552520476766fc5

--0016e64b04fe9552520476766fc5
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

yes, your dictionary :)

if =C3=BCberwachungsgesetz is a real word, add it to your dictionary.

for example, if your dictionary is { "Rind", "Fleisch", "Draht", "Schere",
"Gesetz", "Aufgabe", "=C3=9Cberwachung" }, and you index
Rindfleisch=C3=BCberwachungsgesetz, then all 3 queries will have the same s=
core.
but if you expand the dictionary to { "Rind", "Fleisch", "Draht", "Schere",
"Gesetz", "Aufgabe", "=C3=9Cberwachung", "=C3=9Cberwachungsgesetz" }, then =
this makes
a big difference.

all 3 queries will still match, but =C3=BCberwachungsgesetz will have a hig=
her
score. this is because now things are analyzed differently:
Rindfleisch=C3=BCberwachungsgesetz will be decompounded as before, but with=
 an
additional token: =C3=9Cberwachungsgesetz.
so back to your original question, these 'concatenations' of multiple
components, yes compounds will do that, if they are real words. but it won'=
t
just make them up.

"=C3=BCberwachungsgesetz"
0.23013961 =3D (MATCH) sum of:
  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), produ=
ct of:
    0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0),=
 product
of:
      1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of:
    0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produc=
t of:
      1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), produ=
ct of:
    0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0),=
 product
of:
      1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.057534903 =3D (MATCH) weight(field:gesetz in 0), product of:
    0.5 =3D queryWeight(field:gesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
      1.0 =3D tf(termFreq(field:gesetz)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)

"gesetz=C3=BCberwachung"
0.064782135 =3D (MATCH) sum of:
  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
    0.2814906 =3D queryWeight(field:gesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.9173473 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
      1.0 =3D tf(termFreq(field:gesetz)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.032391068 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of:
    0.2814906 =3D queryWeight(field:=C3=BCberwachung), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.9173473 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produc=
t of:
      1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)

"fleischgesetz"
0.064782135 =3D (MATCH) sum of:
  0.032391068 =3D (MATCH) weight(field:fleisch in 0), product of:
    0.2814906 =3D queryWeight(field:fleisch), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.9173473 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:fleisch in 0), product of:
      1.0 =3D tf(termFreq(field:fleisch)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
    0.2814906 =3D queryWeight(field:gesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.9173473 =3D queryNorm
    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
      1.0 =3D tf(termFreq(field:gesetz)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)




On Wed, Oct 21, 2009 at 1:40 PM, Benjamin Douglas
<bbdouglas@basistech.com>wrote:

> Thanks for all of the answers so far!
>
> Paul's question is similar to another aspect I am curious about:
>
> Given the way the sample word is analyzed, is there anything in the scori=
ng
> mechanism that would rank "=C3=BCberwachungsgesetz" higher than
> "gesetz=C3=BCberwachung" or "fleischgesetz"?
>
>

--=20
Robert Muir
rcmuir@gmail.com

--0016e64b04fe9552520476766fc5--

From java-user-return-42960-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 19:10:29 2009
Return-Path: <java-user-return-42960-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91652 invoked from network); 21 Oct 2009 19:10:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 19:10:29 -0000
Received: (qmail 2518 invoked by uid 500); 21 Oct 2009 19:10:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 2462 invoked by uid 500); 21 Oct 2009 19:10:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 2452 invoked by uid 99); 21 Oct 2009 19:10:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:10:25 +0000
X-ASF-Spam-Status: No, hits=0.1 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of bbdouglas@basistech.com designates 199.88.205.136 as permitted sender)
Received: from [199.88.205.136] (HELO mailer.basistech.com) (199.88.205.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:10:21 +0000
Received: from mail.basistech.com (internal.basistech.net [10.1.250.1])
	by mailer.basistech.com (Postfix) with ESMTP id C7EED368C1
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 15:09:57 -0400 (EDT)
X-DKIM: Sendmail DKIM Filter v2.8.3 mailer.basistech.com C7EED368C1
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=basistech.com;
	s=basis09aug; t=1256152197;
	bh=oL2GL7VnPSgA0RZcTypoetx9rqPYcpKyjTAQdnSNDBo=;
	h=From:To:Date:Subject:Message-ID:References:In-Reply-To:
	 Content-Type:Content-Transfer-Encoding:MIME-Version;
	b=LCHjOGLCZyT9Pe1UXAuMVlb4z00l61eVgn4o2ab0AejNiD8syeTV89ClLwfA3Bky/
	 Q++WR6DTB2OZUZrXFEOYA6fyJ5y1YIxaHcn+nDux8rfv85TKXO8C4IxQDkLslnuqEd
	 zDSdkmqOoNyEJs+kCfqba6gVfwRE6oJRbuGGpnOQ=
Received: from MSG-BOX.basistech.net ([::1]) by MSG-BOX.basistech.net ([::1])
 with mapi; Wed, 21 Oct 2009 15:10:00 -0400
From: Benjamin Douglas <bbdouglas@basistech.com>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Wed, 21 Oct 2009 15:09:58 -0400
Subject: RE: Using org.apache.lucene.analysis.compound
Thread-Topic: Using org.apache.lucene.analysis.compound
Thread-Index: AcpSf0Xrzc324slaRZqEROj6/n2rAQAAfXQw
Message-ID: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net>
 	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com>
 	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org>
 <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com>
 	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net>
 <8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com>
In-Reply-To: <8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0

T0ssIHRoYXQgbWFrZXMgc2Vuc2UuIFNvIEkganVzdCBuZWVkIHRvIGFkZCBhbGwgb2YgdGhlIHN1
Yi1jb21wb3VuZHMgdGhhdCBhcmUgcmVhbCB3b3JkcyBhdCBwb3NJbmNyPTAsIGV2ZW4gaWYgdGhl
eSBhcmUgY29tYmluYXRpb25zIG9mIG90aGVyIHN1Yi1jb21wb3VuZHMuDQoNClRoYW5rcyENCg0K
LS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCkZyb206IFJvYmVydCBNdWlyIFttYWlsdG86cmNt
dWlyQGdtYWlsLmNvbV0gDQpTZW50OiBXZWRuZXNkYXksIE9jdG9iZXIgMjEsIDIwMDkgMTE6NDkg
QU0NClRvOiBqYXZhLXVzZXJAbHVjZW5lLmFwYWNoZS5vcmcNClN1YmplY3Q6IFJlOiBVc2luZyBv
cmcuYXBhY2hlLmx1Y2VuZS5hbmFseXNpcy5jb21wb3VuZA0KDQp5ZXMsIHlvdXIgZGljdGlvbmFy
eSA6KQ0KDQppZiDDvGJlcndhY2h1bmdzZ2VzZXR6IGlzIGEgcmVhbCB3b3JkLCBhZGQgaXQgdG8g
eW91ciBkaWN0aW9uYXJ5Lg0KDQpmb3IgZXhhbXBsZSwgaWYgeW91ciBkaWN0aW9uYXJ5IGlzIHsg
IlJpbmQiLCAiRmxlaXNjaCIsICJEcmFodCIsICJTY2hlcmUiLA0KIkdlc2V0eiIsICJBdWZnYWJl
IiwgIsOcYmVyd2FjaHVuZyIgfSwgYW5kIHlvdSBpbmRleA0KUmluZGZsZWlzY2jDvGJlcndhY2h1
bmdzZ2VzZXR6LCB0aGVuIGFsbCAzIHF1ZXJpZXMgd2lsbCBoYXZlIHRoZSBzYW1lIHNjb3JlLg0K
YnV0IGlmIHlvdSBleHBhbmQgdGhlIGRpY3Rpb25hcnkgdG8geyAiUmluZCIsICJGbGVpc2NoIiwg
IkRyYWh0IiwgIlNjaGVyZSIsDQoiR2VzZXR6IiwgIkF1ZmdhYmUiLCAiw5xiZXJ3YWNodW5nIiwg
IsOcYmVyd2FjaHVuZ3NnZXNldHoiIH0sIHRoZW4gdGhpcyBtYWtlcw0KYSBiaWcgZGlmZmVyZW5j
ZS4NCg0KYWxsIDMgcXVlcmllcyB3aWxsIHN0aWxsIG1hdGNoLCBidXQgw7xiZXJ3YWNodW5nc2dl
c2V0eiB3aWxsIGhhdmUgYSBoaWdoZXINCnNjb3JlLiB0aGlzIGlzIGJlY2F1c2Ugbm93IHRoaW5n
cyBhcmUgYW5hbHl6ZWQgZGlmZmVyZW50bHk6DQpSaW5kZmxlaXNjaMO8YmVyd2FjaHVuZ3NnZXNl
dHogd2lsbCBiZSBkZWNvbXBvdW5kZWQgYXMgYmVmb3JlLCBidXQgd2l0aCBhbg0KYWRkaXRpb25h
bCB0b2tlbjogw5xiZXJ3YWNodW5nc2dlc2V0ei4NCnNvIGJhY2sgdG8geW91ciBvcmlnaW5hbCBx
dWVzdGlvbiwgdGhlc2UgJ2NvbmNhdGVuYXRpb25zJyBvZiBtdWx0aXBsZQ0KY29tcG9uZW50cywg
eWVzIGNvbXBvdW5kcyB3aWxsIGRvIHRoYXQsIGlmIHRoZXkgYXJlIHJlYWwgd29yZHMuIGJ1dCBp
dCB3b24ndA0KanVzdCBtYWtlIHRoZW0gdXAuDQoNCiLDvGJlcndhY2h1bmdzZ2VzZXR6Ig0KMC4y
MzAxMzk2MSA9IChNQVRDSCkgc3VtIG9mOg0KICAwLjA1NzUzNDkwMyA9IChNQVRDSCkgd2VpZ2h0
KGZpZWxkOsO8YmVyd2FjaHVuZ3NnZXNldHogaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAgMC41ID0g
cXVlcnlXZWlnaHQoZmllbGQ6w7xiZXJ3YWNodW5nc2dlc2V0eiksIHByb2R1Y3Qgb2Y6DQogICAg
ICAwLjMwNjg1MjgyID0gaWRmKGRvY0ZyZXE9MSwgbWF4RG9jcz0xKQ0KICAgICAgMS42Mjk0NDU3
ID0gcXVlcnlOb3JtDQogICAgMC4xMTUwNjk4MSA9IChNQVRDSCkgZmllbGRXZWlnaHQoZmllbGQ6
w7xiZXJ3YWNodW5nc2dlc2V0eiBpbiAwKSwgcHJvZHVjdA0Kb2Y6DQogICAgICAxLjAgPSB0Zih0
ZXJtRnJlcShmaWVsZDrDvGJlcndhY2h1bmdzZ2VzZXR6KT0xKQ0KICAgICAgMC4zMDY4NTI4MiA9
IGlkZihkb2NGcmVxPTEsIG1heERvY3M9MSkNCiAgICAgIDAuMzc1ID0gZmllbGROb3JtKGZpZWxk
PWZpZWxkLCBkb2M9MCkNCiAgMC4wNTc1MzQ5MDMgPSAoTUFUQ0gpIHdlaWdodChmaWVsZDrDvGJl
cndhY2h1bmcgaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAgMC41ID0gcXVlcnlXZWlnaHQoZmllbGQ6
w7xiZXJ3YWNodW5nKSwgcHJvZHVjdCBvZjoNCiAgICAgIDAuMzA2ODUyODIgPSBpZGYoZG9jRnJl
cT0xLCBtYXhEb2NzPTEpDQogICAgICAxLjYyOTQ0NTcgPSBxdWVyeU5vcm0NCiAgICAwLjExNTA2
OTgxID0gKE1BVENIKSBmaWVsZFdlaWdodChmaWVsZDrDvGJlcndhY2h1bmcgaW4gMCksIHByb2R1
Y3Qgb2Y6DQogICAgICAxLjAgPSB0Zih0ZXJtRnJlcShmaWVsZDrDvGJlcndhY2h1bmcpPTEpDQog
ICAgICAwLjMwNjg1MjgyID0gaWRmKGRvY0ZyZXE9MSwgbWF4RG9jcz0xKQ0KICAgICAgMC4zNzUg
PSBmaWVsZE5vcm0oZmllbGQ9ZmllbGQsIGRvYz0wKQ0KICAwLjA1NzUzNDkwMyA9IChNQVRDSCkg
d2VpZ2h0KGZpZWxkOsO8YmVyd2FjaHVuZ3NnZXNldHogaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAg
MC41ID0gcXVlcnlXZWlnaHQoZmllbGQ6w7xiZXJ3YWNodW5nc2dlc2V0eiksIHByb2R1Y3Qgb2Y6
DQogICAgICAwLjMwNjg1MjgyID0gaWRmKGRvY0ZyZXE9MSwgbWF4RG9jcz0xKQ0KICAgICAgMS42
Mjk0NDU3ID0gcXVlcnlOb3JtDQogICAgMC4xMTUwNjk4MSA9IChNQVRDSCkgZmllbGRXZWlnaHQo
ZmllbGQ6w7xiZXJ3YWNodW5nc2dlc2V0eiBpbiAwKSwgcHJvZHVjdA0Kb2Y6DQogICAgICAxLjAg
PSB0Zih0ZXJtRnJlcShmaWVsZDrDvGJlcndhY2h1bmdzZ2VzZXR6KT0xKQ0KICAgICAgMC4zMDY4
NTI4MiA9IGlkZihkb2NGcmVxPTEsIG1heERvY3M9MSkNCiAgICAgIDAuMzc1ID0gZmllbGROb3Jt
KGZpZWxkPWZpZWxkLCBkb2M9MCkNCiAgMC4wNTc1MzQ5MDMgPSAoTUFUQ0gpIHdlaWdodChmaWVs
ZDpnZXNldHogaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAgMC41ID0gcXVlcnlXZWlnaHQoZmllbGQ6
Z2VzZXR6KSwgcHJvZHVjdCBvZjoNCiAgICAgIDAuMzA2ODUyODIgPSBpZGYoZG9jRnJlcT0xLCBt
YXhEb2NzPTEpDQogICAgICAxLjYyOTQ0NTcgPSBxdWVyeU5vcm0NCiAgICAwLjExNTA2OTgxID0g
KE1BVENIKSBmaWVsZFdlaWdodChmaWVsZDpnZXNldHogaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAg
ICAxLjAgPSB0Zih0ZXJtRnJlcShmaWVsZDpnZXNldHopPTEpDQogICAgICAwLjMwNjg1MjgyID0g
aWRmKGRvY0ZyZXE9MSwgbWF4RG9jcz0xKQ0KICAgICAgMC4zNzUgPSBmaWVsZE5vcm0oZmllbGQ9
ZmllbGQsIGRvYz0wKQ0KDQoiZ2VzZXR6w7xiZXJ3YWNodW5nIg0KMC4wNjQ3ODIxMzUgPSAoTUFU
Q0gpIHN1bSBvZjoNCiAgMC4wMzIzOTEwNjggPSAoTUFUQ0gpIHdlaWdodChmaWVsZDpnZXNldHog
aW4gMCksIHByb2R1Y3Qgb2Y6DQogICAgMC4yODE0OTA2ID0gcXVlcnlXZWlnaHQoZmllbGQ6Z2Vz
ZXR6KSwgcHJvZHVjdCBvZjoNCiAgICAgIDAuMzA2ODUyODIgPSBpZGYoZG9jRnJlcT0xLCBtYXhE
b2NzPTEpDQogICAgICAwLjkxNzM0NzMgPSBxdWVyeU5vcm0NCiAgICAwLjExNTA2OTgxID0gKE1B
VENIKSBmaWVsZFdlaWdodChmaWVsZDpnZXNldHogaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAgICAx
LjAgPSB0Zih0ZXJtRnJlcShmaWVsZDpnZXNldHopPTEpDQogICAgICAwLjMwNjg1MjgyID0gaWRm
KGRvY0ZyZXE9MSwgbWF4RG9jcz0xKQ0KICAgICAgMC4zNzUgPSBmaWVsZE5vcm0oZmllbGQ9Zmll
bGQsIGRvYz0wKQ0KICAwLjAzMjM5MTA2OCA9IChNQVRDSCkgd2VpZ2h0KGZpZWxkOsO8YmVyd2Fj
aHVuZyBpbiAwKSwgcHJvZHVjdCBvZjoNCiAgICAwLjI4MTQ5MDYgPSBxdWVyeVdlaWdodChmaWVs
ZDrDvGJlcndhY2h1bmcpLCBwcm9kdWN0IG9mOg0KICAgICAgMC4zMDY4NTI4MiA9IGlkZihkb2NG
cmVxPTEsIG1heERvY3M9MSkNCiAgICAgIDAuOTE3MzQ3MyA9IHF1ZXJ5Tm9ybQ0KICAgIDAuMTE1
MDY5ODEgPSAoTUFUQ0gpIGZpZWxkV2VpZ2h0KGZpZWxkOsO8YmVyd2FjaHVuZyBpbiAwKSwgcHJv
ZHVjdCBvZjoNCiAgICAgIDEuMCA9IHRmKHRlcm1GcmVxKGZpZWxkOsO8YmVyd2FjaHVuZyk9MSkN
CiAgICAgIDAuMzA2ODUyODIgPSBpZGYoZG9jRnJlcT0xLCBtYXhEb2NzPTEpDQogICAgICAwLjM3
NSA9IGZpZWxkTm9ybShmaWVsZD1maWVsZCwgZG9jPTApDQoNCiJmbGVpc2NoZ2VzZXR6Ig0KMC4w
NjQ3ODIxMzUgPSAoTUFUQ0gpIHN1bSBvZjoNCiAgMC4wMzIzOTEwNjggPSAoTUFUQ0gpIHdlaWdo
dChmaWVsZDpmbGVpc2NoIGluIDApLCBwcm9kdWN0IG9mOg0KICAgIDAuMjgxNDkwNiA9IHF1ZXJ5
V2VpZ2h0KGZpZWxkOmZsZWlzY2gpLCBwcm9kdWN0IG9mOg0KICAgICAgMC4zMDY4NTI4MiA9IGlk
Zihkb2NGcmVxPTEsIG1heERvY3M9MSkNCiAgICAgIDAuOTE3MzQ3MyA9IHF1ZXJ5Tm9ybQ0KICAg
IDAuMTE1MDY5ODEgPSAoTUFUQ0gpIGZpZWxkV2VpZ2h0KGZpZWxkOmZsZWlzY2ggaW4gMCksIHBy
b2R1Y3Qgb2Y6DQogICAgICAxLjAgPSB0Zih0ZXJtRnJlcShmaWVsZDpmbGVpc2NoKT0xKQ0KICAg
ICAgMC4zMDY4NTI4MiA9IGlkZihkb2NGcmVxPTEsIG1heERvY3M9MSkNCiAgICAgIDAuMzc1ID0g
ZmllbGROb3JtKGZpZWxkPWZpZWxkLCBkb2M9MCkNCiAgMC4wMzIzOTEwNjggPSAoTUFUQ0gpIHdl
aWdodChmaWVsZDpnZXNldHogaW4gMCksIHByb2R1Y3Qgb2Y6DQogICAgMC4yODE0OTA2ID0gcXVl
cnlXZWlnaHQoZmllbGQ6Z2VzZXR6KSwgcHJvZHVjdCBvZjoNCiAgICAgIDAuMzA2ODUyODIgPSBp
ZGYoZG9jRnJlcT0xLCBtYXhEb2NzPTEpDQogICAgICAwLjkxNzM0NzMgPSBxdWVyeU5vcm0NCiAg
ICAwLjExNTA2OTgxID0gKE1BVENIKSBmaWVsZFdlaWdodChmaWVsZDpnZXNldHogaW4gMCksIHBy
b2R1Y3Qgb2Y6DQogICAgICAxLjAgPSB0Zih0ZXJtRnJlcShmaWVsZDpnZXNldHopPTEpDQogICAg
ICAwLjMwNjg1MjgyID0gaWRmKGRvY0ZyZXE9MSwgbWF4RG9jcz0xKQ0KICAgICAgMC4zNzUgPSBm
aWVsZE5vcm0oZmllbGQ9ZmllbGQsIGRvYz0wKQ0KDQoNCg0KDQpPbiBXZWQsIE9jdCAyMSwgMjAw
OSBhdCAxOjQwIFBNLCBCZW5qYW1pbiBEb3VnbGFzDQo8YmJkb3VnbGFzQGJhc2lzdGVjaC5jb20+
d3JvdGU6DQoNCj4gVGhhbmtzIGZvciBhbGwgb2YgdGhlIGFuc3dlcnMgc28gZmFyIQ0KPg0KPiBQ
YXVsJ3MgcXVlc3Rpb24gaXMgc2ltaWxhciB0byBhbm90aGVyIGFzcGVjdCBJIGFtIGN1cmlvdXMg
YWJvdXQ6DQo+DQo+IEdpdmVuIHRoZSB3YXkgdGhlIHNhbXBsZSB3b3JkIGlzIGFuYWx5emVkLCBp
cyB0aGVyZSBhbnl0aGluZyBpbiB0aGUgc2NvcmluZw0KPiBtZWNoYW5pc20gdGhhdCB3b3VsZCBy
YW5rICLDvGJlcndhY2h1bmdzZ2VzZXR6IiBoaWdoZXIgdGhhbg0KPiAiZ2VzZXR6w7xiZXJ3YWNo
dW5nIiBvciAiZmxlaXNjaGdlc2V0eiI/DQo+DQo+DQoNCi0tIA0KUm9iZXJ0IE11aXINCnJjbXVp
ckBnbWFpbC5jb20NCg==


From java-user-return-42961-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 19:16:50 2009
Return-Path: <java-user-return-42961-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93167 invoked from network); 21 Oct 2009 19:16:50 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 19:16:50 -0000
Received: (qmail 10463 invoked by uid 500); 21 Oct 2009 19:16:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10433 invoked by uid 500); 21 Oct 2009 19:16:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10423 invoked by uid 99); 21 Oct 2009 19:16:48 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:16:48 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:16:37 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id F0ADB316D6
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 21:16:14 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id D54273145C
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 21:16:14 +0200 (CEST)
Received: from [192.168.178.47] (BAH61c2.bah.pppool.de [77.135.97.194])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id 5921C310CB
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 21:16:14 +0200 (CEST)
Message-Id: <C28E0A25-8E9B-463C-9F6C-328626B97CEA@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net>
Content-Type: multipart/signed; boundary=Apple-Mail-26-819982139; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Using org.apache.lucene.analysis.compound
Date: Wed, 21 Oct 2009 21:16:12 +0200
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> <8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com> <B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org> <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com> <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net> <8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com> <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-26-819982139
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable

Can the dictionary have weights?

=FCberwachungsgesetz alone probably needs a higher rank than =FCberwachung=
 =20
and gesetzt or?

paul


Le 21-oct.-09 =E0 21:09, Benjamin Douglas a =E9crit :

> OK, that makes sense. So I just need to add all of the sub-compounds =20=

> that are real words at posIncr=3D0, even if they are combinations of =20=

> other sub-compounds.
>
> Thanks!
>
> -----Original Message-----
> From: Robert Muir [mailto:rcmuir@gmail.com]
> Sent: Wednesday, October 21, 2009 11:49 AM
> To: java-user@lucene.apache.org
> Subject: Re: Using org.apache.lucene.analysis.compound
>
> yes, your dictionary :)
>
> if =FCberwachungsgesetz is a real word, add it to your dictionary.
>
> for example, if your dictionary is { "Rind", "Fleisch", "Draht", =20
> "Schere",
> "Gesetz", "Aufgabe", "=DCberwachung" }, and you index
> Rindfleisch=FCberwachungsgesetz, then all 3 queries will have the same =
=20
> score.
> but if you expand the dictionary to { "Rind", "Fleisch", "Draht", =20
> "Schere",
> "Gesetz", "Aufgabe", "=DCberwachung", "=DCberwachungsgesetz" }, then =20=

> this makes
> a big difference.
>
> all 3 queries will still match, but =FCberwachungsgesetz will have a =20=

> higher
> score. this is because now things are analyzed differently:
> Rindfleisch=FCberwachungsgesetz will be decompounded as before, but =20=

> with an
> additional token: =DCberwachungsgesetz.
> so back to your original question, these 'concatenations' of multiple
> components, yes compounds will do that, if they are real words. but =20=

> it won't
> just make them up.
>
> "=FCberwachungsgesetz"
> 0.23013961 =3D (MATCH) sum of:
>  0.057534903 =3D (MATCH) weight(field:=FCberwachungsgesetz in 0), =20
> product of:
>    0.5 =3D queryWeight(field:=FCberwachungsgesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachungsgesetz in =
0), =20
> product
> of:
>      1.0 =3D tf(termFreq(field:=FCberwachungsgesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.057534903 =3D (MATCH) weight(field:=FCberwachung in 0), product of:
>    0.5 =3D queryWeight(field:=FCberwachung), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =
product =20
> of:
>      1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.057534903 =3D (MATCH) weight(field:=FCberwachungsgesetz in 0), =20
> product of:
>    0.5 =3D queryWeight(field:=FCberwachungsgesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachungsgesetz in =
0), =20
> product
> of:
>      1.0 =3D tf(termFreq(field:=FCberwachungsgesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.057534903 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.5 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>
> "gesetz=FCberwachung"
> 0.064782135 =3D (MATCH) sum of:
>  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.2814906 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.032391068 =3D (MATCH) weight(field:=FCberwachung in 0), product of:
>    0.2814906 =3D queryWeight(field:=FCberwachung), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =
product =20
> of:
>      1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>
> "fleischgesetz"
> 0.064782135 =3D (MATCH) sum of:
>  0.032391068 =3D (MATCH) weight(field:fleisch in 0), product of:
>    0.2814906 =3D queryWeight(field:fleisch), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:fleisch in 0), product of:
>      1.0 =3D tf(termFreq(field:fleisch)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.2814906 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>
>
>
>
> On Wed, Oct 21, 2009 at 1:40 PM, Benjamin Douglas
> <bbdouglas@basistech.com>wrote:
>
>> Thanks for all of the answers so far!
>>
>> Paul's question is similar to another aspect I am curious about:
>>
>> Given the way the sample word is analyzed, is there anything in the =20=

>> scoring
>> mechanism that would rank "=FCberwachungsgesetz" higher than
>> "gesetz=FCberwachung" or "fleischgesetz"?
>>
>>
>
> --=20
> Robert Muir
> rcmuir@gmail.com


--Apple-Mail-26-819982139
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAyMTE5MTYxM1owIwYJKoZIhvcNAQkEMRYEFGkjJRd7jnjVpne6wMOgkWk9XdbpMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQCg
EiVn0G2ZFdWD2t6BC88w61hgcDgKq7hBmK3ZuMVK5bc63unlyuMo/sLN9j0yRyHNLpXY+DIQ9eld
7NO7GXQgx/cvdHR5rJAKC6AVOAy8z1cADxgDWp9Znocne5OvjB2OnqNjH14T8dCphNmG299cplLn
C0V9HcdznYffbIvHuUbAwCzNbi/1VouPXPPlH0tsYWiniiOktCBOt7s6OODVt8WhPxdNOmnqS8JR
mYZQhTtEjhYN08qeNX2TkB/7VBj5v4e49bhPBFjmLNrYFLjxoZKX6YvsQDRaaTKb0aTp0m+PPoJr
KPvCRsUj9Sqa5sesXVLF8lhErLMmT0gEGQCqAAAAAAAA

--Apple-Mail-26-819982139--

From java-user-return-42962-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 19:18:26 2009
Return-Path: <java-user-return-42962-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93566 invoked from network); 21 Oct 2009 19:18:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 19:18:25 -0000
Received: (qmail 13139 invoked by uid 500); 21 Oct 2009 19:18:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13079 invoked by uid 500); 21 Oct 2009 19:18:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13069 invoked by uid 99); 21 Oct 2009 19:18:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:18:23 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.216.193 as permitted sender)
Received: from [209.85.216.193] (HELO mail-px0-f193.google.com) (209.85.216.193)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:18:14 +0000
Received: by pxi31 with SMTP id 31so812734pxi.20
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 12:17:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=mJfG44K2wGBOfwT86BDwELVxxNdQc1XXHaI+QEHVKE4=;
        b=Fi6qBQpKyQMYyxvhV6di17T3qjZ+VkYkfaSy8a+opVHo1bUI+sOC7g1kvm1oQriXxQ
         ReXHDRGvBkfrV7rhH8UirKwmslK92Sf7BrNeGQTfpRGtvF4LLBrk4zJQpJWjec/t4JUM
         3YFIbSGPTx3Am7NX4jR6i7sH4Qr2j0dWjQrQQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=Mz1NM37ljOVTvyRxwJNaNHRetW/V0ilZcofu68X1SN2rV1XlXxKtS02icacvZTJhdD
         Oc63LjA05rTAivEo6a3piZKC3uW9Dnn6Aw0PO6+9dUj5VEGPBURaUyPsoDBnCYMxS0/e
         sdwMOh1lctwmd8FWxP/LbsFfSKD1n9YliDkhc=
MIME-Version: 1.0
Received: by 10.114.250.37 with SMTP id x37mr12368815wah.110.1256152673143; 
	Wed, 21 Oct 2009 12:17:53 -0700 (PDT)
In-Reply-To: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> 
	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com> 
	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org> <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net> 
	<8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 15:17:33 -0400
Message-ID: <8f0ad1f30910211217j3c1c1cd1k9414bec1d0d865ae@mail.gmail.com>
Subject: Re: Using org.apache.lucene.analysis.compound
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636b14888dddc3a047676d50a
X-Virus-Checked: Checked by ClamAV on apache.org

--001636b14888dddc3a047676d50a
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

just add them to the dictionary, the compound filter will do this
automatically.

if you want to tweak it even further, you can also tell compounds to NOT
emit the subwords if they form a bigger compound with the onlyLongestMatch
parameter i spoke of earlier.
I haven't played with this option much but I think this is what its suppose=
d
to do:

if the dictionary is
soft
ball
softball

then "softball" (or compounds containing it) won't emit "soft" and "ball",
because "softball" is in the dictionary and its a longest match.
with the option off, you'd get softball, ball, soft

On Wed, Oct 21, 2009 at 3:09 PM, Benjamin Douglas
<bbdouglas@basistech.com>wrote:

> OK, that makes sense. So I just need to add all of the sub-compounds that
> are real words at posIncr=3D0, even if they are combinations of other
> sub-compounds.
>
> Thanks!
>
> -----Original Message-----
> From: Robert Muir [mailto:rcmuir@gmail.com]
> Sent: Wednesday, October 21, 2009 11:49 AM
> To: java-user@lucene.apache.org
> Subject: Re: Using org.apache.lucene.analysis.compound
>
> yes, your dictionary :)
>
> if =C3=BCberwachungsgesetz is a real word, add it to your dictionary.
>
> for example, if your dictionary is { "Rind", "Fleisch", "Draht", "Schere"=
,
> "Gesetz", "Aufgabe", "=C3=9Cberwachung" }, and you index
> Rindfleisch=C3=BCberwachungsgesetz, then all 3 queries will have the same=
 score.
> but if you expand the dictionary to { "Rind", "Fleisch", "Draht", "Schere=
",
> "Gesetz", "Aufgabe", "=C3=9Cberwachung", "=C3=9Cberwachungsgesetz" }, the=
n this makes
> a big difference.
>
> all 3 queries will still match, but =C3=BCberwachungsgesetz will have a h=
igher
> score. this is because now things are analyzed differently:
> Rindfleisch=C3=BCberwachungsgesetz will be decompounded as before, but wi=
th an
> additional token: =C3=9Cberwachungsgesetz.
> so back to your original question, these 'concatenations' of multiple
> components, yes compounds will do that, if they are real words. but it
> won't
> just make them up.
>
> "=C3=BCberwachungsgesetz"
> 0.23013961 =3D (MATCH) sum of:
>  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), prod=
uct of:
>    0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0)=
, product
> of:
>      1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of:
>    0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produ=
ct of:
>      1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), prod=
uct of:
>    0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0)=
, product
> of:
>      1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.057534903 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.5 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>
> "gesetz=C3=BCberwachung"
> 0.064782135 =3D (MATCH) sum of:
>  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.2814906 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.032391068 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of:
>    0.2814906 =3D queryWeight(field:=C3=BCberwachung), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produ=
ct of:
>      1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>
> "fleischgesetz"
> 0.064782135 =3D (MATCH) sum of:
>  0.032391068 =3D (MATCH) weight(field:fleisch in 0), product of:
>    0.2814906 =3D queryWeight(field:fleisch), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:fleisch in 0), product of:
>      1.0 =3D tf(termFreq(field:fleisch)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.2814906 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.9173473 =3D queryNorm
>    0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>
>
>
>
> On Wed, Oct 21, 2009 at 1:40 PM, Benjamin Douglas
> <bbdouglas@basistech.com>wrote:
>
> > Thanks for all of the answers so far!
> >
> > Paul's question is similar to another aspect I am curious about:
> >
> > Given the way the sample word is analyzed, is there anything in the
> scoring
> > mechanism that would rank "=C3=BCberwachungsgesetz" higher than
> > "gesetz=C3=BCberwachung" or "fleischgesetz"?
> >
> >
>
> --
> Robert Muir
> rcmuir@gmail.com
>



--=20
Robert Muir
rcmuir@gmail.com

--001636b14888dddc3a047676d50a--

From java-user-return-42963-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 19:24:37 2009
Return-Path: <java-user-return-42963-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95614 invoked from network); 21 Oct 2009 19:24:37 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 19:24:37 -0000
Received: (qmail 21934 invoked by uid 500); 21 Oct 2009 19:24:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 21866 invoked by uid 500); 21 Oct 2009 19:24:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 21856 invoked by uid 99); 21 Oct 2009 19:24:35 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:24:35 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.222.176 as permitted sender)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:24:32 +0000
Received: by pzk6 with SMTP id 6so8865240pzk.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 12:24:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=7LVX57gVbTjxpLG3SXBv8agzZmu4oPPKTQfkC+/YQzk=;
        b=si0DaQWWkO9PgNwxrZ2BbApAz8H07wjnKg64fHonNaBQvEYDsFIZ3xIGbQID2+k723
         PaH6R7X2lIu2jduiaJxKcRHTn8UxQOACagIneBR0qmBgKS/f6ARYbZHwv3rFOqbWh6Z+
         qeuWgaJrCGp/s746c0RL4xBWDIB/jCzTFgH8E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=H+2jJyAFulejKhSd1n3PxyMAjW2nqfFpKjDG+X54lYFykiWNV9uQbmvgtyPTEgLCeW
         0dWZc7TrqM67vTMvGozML2UcNnnjdquGnM/ZdlmkEI3dFSEF6L50pHn3r7chqARgH+cU
         iwuhX+36WtltqQfAkns0vKwpbSXbhV0eRTFOI=
MIME-Version: 1.0
Received: by 10.114.138.2 with SMTP id l2mr12736211wad.163.1256153052109; Wed, 
	21 Oct 2009 12:24:12 -0700 (PDT)
In-Reply-To: <C28E0A25-8E9B-463C-9F6C-328626B97CEA@activemath.org>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> 
	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com> 
	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org> <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net> 
	<8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net> 
	<C28E0A25-8E9B-463C-9F6C-328626B97CEA@activemath.org>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 15:23:52 -0400
Message-ID: <8f0ad1f30910211223s34cd86d7w4163e64c07c76e53@mail.gmail.com>
Subject: Re: Using org.apache.lucene.analysis.compound
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502d635745d64047676ec97

--00504502d635745d64047676ec97
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Paul, i think in general scoring should take care of this too, its all abou=
t
your dictionary, same as the previous example.
this is because =C3=BCberwachungsgesetz matches 3 tokens: =C3=BCberwachungs=
gesetz,
=C3=BCberwachung, gesetz
but =C3=BCberwachung gesetz only matches 2.

=C3=BCberwachungsgesetz
0.37040412 =3D (MATCH) sum of:
  0.10848885 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), produc=
t of:
    0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.2169777 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0), =
product
of:
      1.4142135 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D2)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.076713204 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of:
    0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.15342641 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produc=
t of:
      1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.10848885 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), produc=
t of:
    0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.2169777 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0), =
product
of:
      1.4142135 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D2)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
    0.5 =3D queryWeight(field:gesetz), product of:
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      1.6294457 =3D queryNorm
    0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
      1.0 =3D tf(termFreq(field:gesetz)=3D1)
      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)

=C3=BCberwachung gesetz
0.30685282 =3D (MATCH) sum of:
  0.15342641 =3D (MATCH) sum of:
    0.076713204 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of=
:
      0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        1.6294457 =3D queryNorm
      0.15342641 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), prod=
uct of:
        1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
    0.076713204 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of=
:
      0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        1.6294457 =3D queryNorm
      0.15342641 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), prod=
uct of:
        1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
  0.15342641 =3D (MATCH) sum of:
    0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
      0.5 =3D queryWeight(field:gesetz), product of:
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        1.6294457 =3D queryNorm
      0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
        1.0 =3D tf(termFreq(field:gesetz)=3D1)
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
    0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
      0.5 =3D queryWeight(field:gesetz), product of:
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        1.6294457 =3D queryNorm
      0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
        1.0 =3D tf(termFreq(field:gesetz)=3D1)
        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)

On Wed, Oct 21, 2009 at 3:16 PM, Paul Libbrecht <paul@activemath.org> wrote=
:

> Can the dictionary have weights?
>
> =C3=BCberwachungsgesetz alone probably needs a higher rank than =C3=BCber=
wachung and
> gesetzt or?
>
> paul
>
>
> Le 21-oct.-09 =C3=A0 21:09, Benjamin Douglas a =C3=A9crit :
>
>
>  OK, that makes sense. So I just need to add all of the sub-compounds tha=
t
>> are real words at posIncr=3D0, even if they are combinations of other
>> sub-compounds.
>>
>> Thanks!
>>
>> -----Original Message-----
>> From: Robert Muir [mailto:rcmuir@gmail.com]
>> Sent: Wednesday, October 21, 2009 11:49 AM
>> To: java-user@lucene.apache.org
>> Subject: Re: Using org.apache.lucene.analysis.compound
>>
>> yes, your dictionary :)
>>
>> if =C3=BCberwachungsgesetz is a real word, add it to your dictionary.
>>
>> for example, if your dictionary is { "Rind", "Fleisch", "Draht", "Schere=
",
>> "Gesetz", "Aufgabe", "=C3=9Cberwachung" }, and you index
>> Rindfleisch=C3=BCberwachungsgesetz, then all 3 queries will have the sam=
e
>> score.
>> but if you expand the dictionary to { "Rind", "Fleisch", "Draht",
>> "Schere",
>> "Gesetz", "Aufgabe", "=C3=9Cberwachung", "=C3=9Cberwachungsgesetz" }, th=
en this
>> makes
>> a big difference.
>>
>> all 3 queries will still match, but =C3=BCberwachungsgesetz will have a =
higher
>> score. this is because now things are analyzed differently:
>> Rindfleisch=C3=BCberwachungsgesetz will be decompounded as before, but w=
ith an
>> additional token: =C3=9Cberwachungsgesetz.
>> so back to your original question, these 'concatenations' of multiple
>> components, yes compounds will do that, if they are real words. but it
>> won't
>> just make them up.
>>
>> "=C3=BCberwachungsgesetz"
>> 0.23013961 =3D (MATCH) sum of:
>>  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), pro=
duct of:
>>   0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0)=
, product
>> of:
>>     1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of=
:
>>   0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produ=
ct of:
>>     1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), pro=
duct of:
>>   0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0)=
, product
>> of:
>>     1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.057534903 =3D (MATCH) weight(field:gesetz in 0), product of:
>>   0.5 =3D queryWeight(field:gesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>     1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>
>> "gesetz=C3=BCberwachung"
>> 0.064782135 =3D (MATCH) sum of:
>>  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>>   0.2814906 =3D queryWeight(field:gesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.9173473 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>     1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.032391068 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of=
:
>>   0.2814906 =3D queryWeight(field:=C3=BCberwachung), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.9173473 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produ=
ct of:
>>     1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>
>> "fleischgesetz"
>> 0.064782135 =3D (MATCH) sum of:
>>  0.032391068 =3D (MATCH) weight(field:fleisch in 0), product of:
>>   0.2814906 =3D queryWeight(field:fleisch), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.9173473 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:fleisch in 0), product of:
>>     1.0 =3D tf(termFreq(field:fleisch)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>>   0.2814906 =3D queryWeight(field:gesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.9173473 =3D queryNorm
>>   0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>     1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>
>>
>>
>>
>> On Wed, Oct 21, 2009 at 1:40 PM, Benjamin Douglas
>> <bbdouglas@basistech.com>wrote:
>>
>>  Thanks for all of the answers so far!
>>>
>>> Paul's question is similar to another aspect I am curious about:
>>>
>>> Given the way the sample word is analyzed, is there anything in the
>>> scoring
>>> mechanism that would rank "=C3=BCberwachungsgesetz" higher than
>>> "gesetz=C3=BCberwachung" or "fleischgesetz"?
>>>
>>>
>>>
>> --
>> Robert Muir
>> rcmuir@gmail.com
>>
>
>


--=20
Robert Muir
rcmuir@gmail.com

--00504502d635745d64047676ec97--

From java-user-return-42964-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 19:59:12 2009
Return-Path: <java-user-return-42964-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5993 invoked from network); 21 Oct 2009 19:59:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 19:59:12 -0000
Received: (qmail 72103 invoked by uid 500); 21 Oct 2009 19:59:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 72067 invoked by uid 500); 21 Oct 2009 19:59:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 72049 invoked by uid 99); 21 Oct 2009 19:59:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:59:08 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 19:58:59 +0000
Received: by ewy19 with SMTP id 19so6959522ewy.28
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 12:58:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :content-type:content-transfer-encoding:mime-version:subject:date
         :x-mailer;
        bh=SZTE72LtZvXKd/lA4S2oGi94xTScKRz66ij64Gl0APA=;
        b=sTC95neCuDOkd+6ZnnRGvtjRgvYMbClJtle7rCx9giaEJkD449IHIa4xfVBY3VFyaP
         FmMPa5LgPgC2YDOKd2YLHpImsJ4PHzVyTpKOeG1wZxO2sV37TBgvx84SYvUlXcTRazSQ
         Wj9mR3NTr2fETWlJlRcXEUJwBBjen6/BKApfo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:content-type:content-transfer-encoding
         :mime-version:subject:date:x-mailer;
        b=f556XhhH7nPTFlc/C13vTXZH90OmqyfOWHSqYDZu1/MDGo9mxDBLH06o5BhisQtIQK
         iaGvuFwKaEimbuKamiXSEs53nv2z5Yrn3ix7fQrQiFxUHkaOG9T6I+E2+lH4TVqHKRjf
         mbaPSXgK0QLG+D2D9raUoauuGOlPUEMPSWLxg=
Received: by 10.216.90.70 with SMTP id d48mr1790179wef.159.1256155119145;
        Wed, 21 Oct 2009 12:58:39 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 10sm868693eyd.6.2009.10.21.12.58.37
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 21 Oct 2009 12:58:38 -0700 (PDT)
Message-Id: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: XorReader?
Date: Wed, 21 Oct 2009 21:58:36 +0200
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

Hi people,

I have an application in which the users are allowed to make changes  
to the database, changes visible only to that user. I.e. they don't  
modify the original data, they create a clone of the original. When  
the user request the instance I retrieve the modified clone rather  
than the original.

Now I'd like to make the user changes instantly available when  
searching too. What might be a good solution to that problem?

I'm thinking a decorator with deletions on top of the original reader,  
merged with the clone reader using a MultiReader. But this would still  
require a new Searcher per user that added modifications to the  
database. Worth mentioning is that my index is rather small, some 50  
000 documents with ~15 numeric and text fields of various size and  
resolution. A user would typically have made 20 changes, but could in  
a few instances be several hundred or even thousands of changes.

So far I haven't done anything but considering wether it's doable or  
not.


        karl


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42965-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 20:20:10 2009
Return-Path: <java-user-return-42965-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14499 invoked from network); 21 Oct 2009 20:20:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 20:20:10 -0000
Received: (qmail 17313 invoked by uid 500); 21 Oct 2009 20:20:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17243 invoked by uid 500); 21 Oct 2009 20:20:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17233 invoked by uid 99); 21 Oct 2009 20:20:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 20:20:07 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 20:19:56 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id 6604431502
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 22:19:35 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id 390673145F
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 22:19:35 +0200 (CEST)
Received: from [192.168.178.47] (BAH61c2.bah.pppool.de [77.135.97.194])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id DC4C9310CB
	for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 22:19:34 +0200 (CEST)
Message-Id: <E7093B5B-8CA7-400A-B118-1EB8012FE3EA@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <8f0ad1f30910211223s34cd86d7w4163e64c07c76e53@mail.gmail.com>
Content-Type: multipart/signed; boundary=Apple-Mail-33-823783804; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: Using org.apache.lucene.analysis.compound
Date: Wed, 21 Oct 2009 22:19:34 +0200
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net>  <8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com>  <B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org> <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com>  <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net>  <8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com>  <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net>  <C28E0A25-8E9B-463C-9F6C-328626B97CEA@activemath.org> <8f0ad1f30910211223s34cd86d7w4163e64c07c76e53@mail.gmail.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-33-823783804
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable

Great,

now the next question: which dictionary to do you guys use? How big =20
can it be?
Is 50000 words acceptable?

paul


Le 21-oct.-09 =E0 21:23, Robert Muir a =E9crit :

> Paul, i think in general scoring should take care of this too, its =20
> all about
> your dictionary, same as the previous example.
> this is because =FCberwachungsgesetz matches 3 tokens: =20
> =FCberwachungsgesetz,
> =FCberwachung, gesetz
> but =FCberwachung gesetz only matches 2.
>
> =FCberwachungsgesetz
> 0.37040412 =3D (MATCH) sum of:
>  0.10848885 =3D (MATCH) weight(field:=FCberwachungsgesetz in 0), =
product =20
> of:
>    0.5 =3D queryWeight(field:=FCberwachungsgesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.2169777 =3D (MATCH) fieldWeight(field:=FCberwachungsgesetz in 0), =
=20
> product
> of:
>      1.4142135 =3D tf(termFreq(field:=FCberwachungsgesetz)=3D2)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.076713204 =3D (MATCH) weight(field:=FCberwachung in 0), product of:
>    0.5 =3D queryWeight(field:=FCberwachung), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.15342641 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =
product =20
> of:
>      1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.10848885 =3D (MATCH) weight(field:=FCberwachungsgesetz in 0), =
product =20
> of:
>    0.5 =3D queryWeight(field:=FCberwachungsgesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.2169777 =3D (MATCH) fieldWeight(field:=FCberwachungsgesetz in 0), =
=20
> product
> of:
>      1.4142135 =3D tf(termFreq(field:=FCberwachungsgesetz)=3D2)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
>    0.5 =3D queryWeight(field:gesetz), product of:
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      1.6294457 =3D queryNorm
>    0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>      1.0 =3D tf(termFreq(field:gesetz)=3D1)
>      0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>      0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>
> =FCberwachung gesetz
> 0.30685282 =3D (MATCH) sum of:
>  0.15342641 =3D (MATCH) sum of:
>    0.076713204 =3D (MATCH) weight(field:=FCberwachung in 0), product =
of:
>      0.5 =3D queryWeight(field:=FCberwachung), product of:
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        1.6294457 =3D queryNorm
>      0.15342641 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =20
> product of:
>        1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>    0.076713204 =3D (MATCH) weight(field:=FCberwachung in 0), product =
of:
>      0.5 =3D queryWeight(field:=FCberwachung), product of:
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        1.6294457 =3D queryNorm
>      0.15342641 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =20
> product of:
>        1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>  0.15342641 =3D (MATCH) sum of:
>    0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
>      0.5 =3D queryWeight(field:gesetz), product of:
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        1.6294457 =3D queryNorm
>      0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product =
of:
>        1.0 =3D tf(termFreq(field:gesetz)=3D1)
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>    0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
>      0.5 =3D queryWeight(field:gesetz), product of:
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        1.6294457 =3D queryNorm
>      0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product =
of:
>        1.0 =3D tf(termFreq(field:gesetz)=3D1)
>        0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>        0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>
> On Wed, Oct 21, 2009 at 3:16 PM, Paul Libbrecht =20
> <paul@activemath.org> wrote:
>
>> Can the dictionary have weights?
>>
>> =FCberwachungsgesetz alone probably needs a higher rank than =20
>> =FCberwachung and
>> gesetzt or?
>>
>> paul
>>
>>
>> Le 21-oct.-09 =E0 21:09, Benjamin Douglas a =E9crit :
>>
>>
>> OK, that makes sense. So I just need to add all of the sub-=20
>> compounds that
>>> are real words at posIncr=3D0, even if they are combinations of =
other
>>> sub-compounds.
>>>
>>> Thanks!
>>>
>>> -----Original Message-----
>>> From: Robert Muir [mailto:rcmuir@gmail.com]
>>> Sent: Wednesday, October 21, 2009 11:49 AM
>>> To: java-user@lucene.apache.org
>>> Subject: Re: Using org.apache.lucene.analysis.compound
>>>
>>> yes, your dictionary :)
>>>
>>> if =FCberwachungsgesetz is a real word, add it to your dictionary.
>>>
>>> for example, if your dictionary is { "Rind", "Fleisch", "Draht", =20
>>> "Schere",
>>> "Gesetz", "Aufgabe", "=DCberwachung" }, and you index
>>> Rindfleisch=FCberwachungsgesetz, then all 3 queries will have the =
same
>>> score.
>>> but if you expand the dictionary to { "Rind", "Fleisch", "Draht",
>>> "Schere",
>>> "Gesetz", "Aufgabe", "=DCberwachung", "=DCberwachungsgesetz" }, then =
=20
>>> this
>>> makes
>>> a big difference.
>>>
>>> all 3 queries will still match, but =FCberwachungsgesetz will have a =
=20
>>> higher
>>> score. this is because now things are analyzed differently:
>>> Rindfleisch=FCberwachungsgesetz will be decompounded as before, but =20=

>>> with an
>>> additional token: =DCberwachungsgesetz.
>>> so back to your original question, these 'concatenations' of =20
>>> multiple
>>> components, yes compounds will do that, if they are real words. =20
>>> but it
>>> won't
>>> just make them up.
>>>
>>> "=FCberwachungsgesetz"
>>> 0.23013961 =3D (MATCH) sum of:
>>> 0.057534903 =3D (MATCH) weight(field:=FCberwachungsgesetz in 0), =20
>>> product of:
>>>  0.5 =3D queryWeight(field:=FCberwachungsgesetz), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    1.6294457 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachungsgesetz in =
0), =20
>>> product
>>> of:
>>>    1.0 =3D tf(termFreq(field:=FCberwachungsgesetz)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>> 0.057534903 =3D (MATCH) weight(field:=FCberwachung in 0), product =
of:
>>>  0.5 =3D queryWeight(field:=FCberwachung), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    1.6294457 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =
product =20
>>> of:
>>>    1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>> 0.057534903 =3D (MATCH) weight(field:=FCberwachungsgesetz in 0), =20
>>> product of:
>>>  0.5 =3D queryWeight(field:=FCberwachungsgesetz), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    1.6294457 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachungsgesetz in =
0), =20
>>> product
>>> of:
>>>    1.0 =3D tf(termFreq(field:=FCberwachungsgesetz)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>> 0.057534903 =3D (MATCH) weight(field:gesetz in 0), product of:
>>>  0.5 =3D queryWeight(field:gesetz), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    1.6294457 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>>    1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>
>>> "gesetz=FCberwachung"
>>> 0.064782135 =3D (MATCH) sum of:
>>> 0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>>>  0.2814906 =3D queryWeight(field:gesetz), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.9173473 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>>    1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>> 0.032391068 =3D (MATCH) weight(field:=FCberwachung in 0), product =
of:
>>>  0.2814906 =3D queryWeight(field:=FCberwachung), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.9173473 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:=FCberwachung in 0), =
product =20
>>> of:
>>>    1.0 =3D tf(termFreq(field:=FCberwachung)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>
>>> "fleischgesetz"
>>> 0.064782135 =3D (MATCH) sum of:
>>> 0.032391068 =3D (MATCH) weight(field:fleisch in 0), product of:
>>>  0.2814906 =3D queryWeight(field:fleisch), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.9173473 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:fleisch in 0), product of:
>>>    1.0 =3D tf(termFreq(field:fleisch)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>> 0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>>>  0.2814906 =3D queryWeight(field:gesetz), product of:
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.9173473 =3D queryNorm
>>>  0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>>    1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>>    0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>    0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>
>>>
>>>
>>>
>>> On Wed, Oct 21, 2009 at 1:40 PM, Benjamin Douglas
>>> <bbdouglas@basistech.com>wrote:
>>>
>>> Thanks for all of the answers so far!
>>>>
>>>> Paul's question is similar to another aspect I am curious about:
>>>>
>>>> Given the way the sample word is analyzed, is there anything in the
>>>> scoring
>>>> mechanism that would rank "=FCberwachungsgesetz" higher than
>>>> "gesetz=FCberwachung" or "fleischgesetz"?
>>>>
>>>>
>>>>
>>> --
>>> Robert Muir
>>> rcmuir@gmail.com
>>>
>>
>>
>
>
> --=20
> Robert Muir
> rcmuir@gmail.com


--Apple-Mail-33-823783804
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAyMTIwMTkzNFowIwYJKoZIhvcNAQkEMRYEFKdc8fIYtJcXDWABbht61WFmvCPGMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQB6
wzz6VXqZDtTb4cgRNERzNHsPNfmvYWtCp/SVO41ZbH8NxpXCYseOQz8Ia14UbAzFOjyvoLaTkek6
xKlvhOJ5E08chIEb0JA4SXktiPyZJ9nUAnINH+PFokwrjJ0gU2sR7p7Q6oHcIIm78qRfAMIzmd1W
EYGr4r6zE71wS20f0TAgeaHFqtqs3e/JsuI+nDxTGPubKWagYUMt93Nd+759yCJqfTLFrVIQ+Gqr
NCXkLUgMcz89uPLqaeilUpo3IEOgw9VVQpQhRrQGfLZ4d5fkJKV81l5Aasmq6Vuw73WSNEtfir65
ZDb65zzXLi+Y+kniz/uGuCRu3K884tGVS+pOAAAAAAAA

--Apple-Mail-33-823783804--

From java-user-return-42966-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 20:33:20 2009
Return-Path: <java-user-return-42966-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17907 invoked from network); 21 Oct 2009 20:33:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 20:33:19 -0000
Received: (qmail 50601 invoked by uid 500); 21 Oct 2009 20:33:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50528 invoked by uid 500); 21 Oct 2009 20:33:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50518 invoked by uid 99); 21 Oct 2009 20:33:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 20:33:17 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.222.176 as permitted sender)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 20:33:14 +0000
Received: by pzk6 with SMTP id 6so8915553pzk.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 13:32:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=4Eu20wlVVZTFmi67kFgkZeJBjoDJFOuPSpthr0QhpXU=;
        b=Jmt3xs9Yx63o+9fH52u3J23NRm5lXsBUBsTnrC+DIm4SILHOyl/ZMCJOHjyPSJ2/G4
         1KEWIDbS9kE0wOrGJiJYR+uDMmCxZUAY6jTZl+4Ks1ltel2gHJRHqqJgD0LLlwR0Fx5M
         zhix5tJR33eEi3gjWt5gXGGjvvnLyqSJuqF2U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=mZ5YZNlYU+qG4M/A3fW3vTZGxZfww3LCLc7allS7mh/orqHAmpMV8Jo8j7n10UcfHb
         /8wJ7JRaM1ckYiQPm3KoZ8fCwI3c3NHs763zJFm7YhPABc6h4KdehdbYkLhm+MJKzYwA
         RTvucTpXoQSgCto9D8J1GA73rkpYSsF2nzeDA=
MIME-Version: 1.0
Received: by 10.115.134.17 with SMTP id l17mr12866631wan.44.1256157174244; 
	Wed, 21 Oct 2009 13:32:54 -0700 (PDT)
In-Reply-To: <E7093B5B-8CA7-400A-B118-1EB8012FE3EA@activemath.org>
References: <CAE8639A6FAB3D4AA7973D5897B325185C7ED8C67B@MSG-BOX.basistech.net> 
	<8f0ad1f30910201900t294f64c2v6d10b2ef504666b8@mail.gmail.com> 
	<B607F3A6-5E02-4C6B-A8B2-BC4124802AE3@activemath.org> <8f0ad1f30910210512m5b0e3359yd161a569de67b191@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6C1@MSG-BOX.basistech.net> 
	<8f0ad1f30910211148v3d4ab1b6u6b7dadcecc95ab86@mail.gmail.com> 
	<CAE8639A6FAB3D4AA7973D5897B325185C7ED8C6E0@MSG-BOX.basistech.net> 
	<C28E0A25-8E9B-463C-9F6C-328626B97CEA@activemath.org> <8f0ad1f30910211223s34cd86d7w4163e64c07c76e53@mail.gmail.com> 
	<E7093B5B-8CA7-400A-B118-1EB8012FE3EA@activemath.org>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 21 Oct 2009 16:32:34 -0400
Message-ID: <8f0ad1f30910211332v31e41af4r5cc89f812b190e0a@mail.gmail.com>
Subject: Re: Using org.apache.lucene.analysis.compound
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64be14c272412047677e27e

--0016e64be14c272412047677e27e
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

there is some information on this topic in the pkg summary:

http://lucene.apache.org/java/2_9_0/api/contrib-analyzers/org/apache/lucene=
/analysis/compound/package-summary.html

in short, for a large list (there is no limit in the code), you will want t=
o
make use of a hyphenation grammar as well:
HyphenationCompoundWordTokenFilter instead of the brute-force dictionary
approach, for better speed.

there is also a pointer to some dictionaries at openoffice, i'd also look
around at spellcheckers and stuff too elsewhere if you cant find one that
fits your needs.

On Wed, Oct 21, 2009 at 4:19 PM, Paul Libbrecht <paul@activemath.org> wrote=
:

> Great,
>
> now the next question: which dictionary to do you guys use? How big can i=
t
> be?
> Is 50000 words acceptable?
>
> paul
>
>
> Le 21-oct.-09 =C3=A0 21:23, Robert Muir a =C3=A9crit :
>
>
>  Paul, i think in general scoring should take care of this too, its all
>> about
>> your dictionary, same as the previous example.
>> this is because =C3=BCberwachungsgesetz matches 3 tokens: =C3=BCberwachu=
ngsgesetz,
>> =C3=BCberwachung, gesetz
>> but =C3=BCberwachung gesetz only matches 2.
>>
>> =C3=BCberwachungsgesetz
>> 0.37040412 =3D (MATCH) sum of:
>>  0.10848885 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), prod=
uct of:
>>   0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.2169777 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0),=
 product
>> of:
>>     1.4142135 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D2)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.076713204 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product of=
:
>>   0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.15342641 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), produ=
ct of:
>>     1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.10848885 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), prod=
uct of:
>>   0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.2169777 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0),=
 product
>> of:
>>     1.4142135 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D2)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
>>   0.5 =3D queryWeight(field:gesetz), product of:
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     1.6294457 =3D queryNorm
>>   0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>     1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>     0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>     0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>
>> =C3=BCberwachung gesetz
>> 0.30685282 =3D (MATCH) sum of:
>>  0.15342641 =3D (MATCH) sum of:
>>   0.076713204 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product o=
f:
>>     0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       1.6294457 =3D queryNorm
>>     0.15342641 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), pro=
duct of:
>>       1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>   0.076713204 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product o=
f:
>>     0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       1.6294457 =3D queryNorm
>>     0.15342641 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), pro=
duct of:
>>       1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>  0.15342641 =3D (MATCH) sum of:
>>   0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
>>     0.5 =3D queryWeight(field:gesetz), product of:
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       1.6294457 =3D queryNorm
>>     0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>       1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>   0.076713204 =3D (MATCH) weight(field:gesetz in 0), product of:
>>     0.5 =3D queryWeight(field:gesetz), product of:
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       1.6294457 =3D queryNorm
>>     0.15342641 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>       1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>       0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>       0.5 =3D fieldNorm(field=3Dfield, doc=3D0)
>>
>> On Wed, Oct 21, 2009 at 3:16 PM, Paul Libbrecht <paul@activemath.org>
>> wrote:
>>
>>  Can the dictionary have weights?
>>>
>>> =C3=BCberwachungsgesetz alone probably needs a higher rank than =C3=BCb=
erwachung
>>> and
>>> gesetzt or?
>>>
>>> paul
>>>
>>>
>>> Le 21-oct.-09 =C3=A0 21:09, Benjamin Douglas a =C3=A9crit :
>>>
>>>
>>> OK, that makes sense. So I just need to add all of the sub-compounds th=
at
>>>
>>>> are real words at posIncr=3D0, even if they are combinations of other
>>>> sub-compounds.
>>>>
>>>> Thanks!
>>>>
>>>> -----Original Message-----
>>>> From: Robert Muir [mailto:rcmuir@gmail.com]
>>>> Sent: Wednesday, October 21, 2009 11:49 AM
>>>> To: java-user@lucene.apache.org
>>>> Subject: Re: Using org.apache.lucene.analysis.compound
>>>>
>>>> yes, your dictionary :)
>>>>
>>>> if =C3=BCberwachungsgesetz is a real word, add it to your dictionary.
>>>>
>>>> for example, if your dictionary is { "Rind", "Fleisch", "Draht",
>>>> "Schere",
>>>> "Gesetz", "Aufgabe", "=C3=9Cberwachung" }, and you index
>>>> Rindfleisch=C3=BCberwachungsgesetz, then all 3 queries will have the s=
ame
>>>> score.
>>>> but if you expand the dictionary to { "Rind", "Fleisch", "Draht",
>>>> "Schere",
>>>> "Gesetz", "Aufgabe", "=C3=9Cberwachung", "=C3=9Cberwachungsgesetz" }, =
then this
>>>> makes
>>>> a big difference.
>>>>
>>>> all 3 queries will still match, but =C3=BCberwachungsgesetz will have =
a
>>>> higher
>>>> score. this is because now things are analyzed differently:
>>>> Rindfleisch=C3=BCberwachungsgesetz will be decompounded as before, but=
 with
>>>> an
>>>> additional token: =C3=9Cberwachungsgesetz.
>>>> so back to your original question, these 'concatenations' of multiple
>>>> components, yes compounds will do that, if they are real words. but it
>>>> won't
>>>> just make them up.
>>>>
>>>> "=C3=BCberwachungsgesetz"
>>>> 0.23013961 =3D (MATCH) sum of:
>>>> 0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), pr=
oduct of:
>>>>  0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   1.6294457 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0=
),
>>>> product
>>>> of:
>>>>   1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>> 0.057534903 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product o=
f:
>>>>  0.5 =3D queryWeight(field:=C3=BCberwachung), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   1.6294457 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), prod=
uct of:
>>>>   1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>> 0.057534903 =3D (MATCH) weight(field:=C3=BCberwachungsgesetz in 0), pr=
oduct of:
>>>>  0.5 =3D queryWeight(field:=C3=BCberwachungsgesetz), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   1.6294457 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachungsgesetz in 0=
),
>>>> product
>>>> of:
>>>>   1.0 =3D tf(termFreq(field:=C3=BCberwachungsgesetz)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>> 0.057534903 =3D (MATCH) weight(field:gesetz in 0), product of:
>>>>  0.5 =3D queryWeight(field:gesetz), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   1.6294457 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>>>   1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>>
>>>> "gesetz=C3=BCberwachung"
>>>> 0.064782135 =3D (MATCH) sum of:
>>>> 0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>>>>  0.2814906 =3D queryWeight(field:gesetz), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.9173473 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>>>   1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>> 0.032391068 =3D (MATCH) weight(field:=C3=BCberwachung in 0), product o=
f:
>>>>  0.2814906 =3D queryWeight(field:=C3=BCberwachung), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.9173473 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:=C3=BCberwachung in 0), prod=
uct of:
>>>>   1.0 =3D tf(termFreq(field:=C3=BCberwachung)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>>
>>>> "fleischgesetz"
>>>> 0.064782135 =3D (MATCH) sum of:
>>>> 0.032391068 =3D (MATCH) weight(field:fleisch in 0), product of:
>>>>  0.2814906 =3D queryWeight(field:fleisch), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.9173473 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:fleisch in 0), product of:
>>>>   1.0 =3D tf(termFreq(field:fleisch)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>> 0.032391068 =3D (MATCH) weight(field:gesetz in 0), product of:
>>>>  0.2814906 =3D queryWeight(field:gesetz), product of:
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.9173473 =3D queryNorm
>>>>  0.11506981 =3D (MATCH) fieldWeight(field:gesetz in 0), product of:
>>>>   1.0 =3D tf(termFreq(field:gesetz)=3D1)
>>>>   0.30685282 =3D idf(docFreq=3D1, maxDocs=3D1)
>>>>   0.375 =3D fieldNorm(field=3Dfield, doc=3D0)
>>>>
>>>>
>>>>
>>>>
>>>> On Wed, Oct 21, 2009 at 1:40 PM, Benjamin Douglas
>>>> <bbdouglas@basistech.com>wrote:
>>>>
>>>> Thanks for all of the answers so far!
>>>>
>>>>>
>>>>> Paul's question is similar to another aspect I am curious about:
>>>>>
>>>>> Given the way the sample word is analyzed, is there anything in the
>>>>> scoring
>>>>> mechanism that would rank "=C3=BCberwachungsgesetz" higher than
>>>>> "gesetz=C3=BCberwachung" or "fleischgesetz"?
>>>>>
>>>>>
>>>>>
>>>>>  --
>>>> Robert Muir
>>>> rcmuir@gmail.com
>>>>
>>>>
>>>
>>>
>>
>> --
>> Robert Muir
>> rcmuir@gmail.com
>>
>
>


--=20
Robert Muir
rcmuir@gmail.com

--0016e64be14c272412047677e27e--

From java-user-return-42967-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 21 22:27:22 2009
Return-Path: <java-user-return-42967-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56137 invoked from network); 21 Oct 2009 22:27:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 21 Oct 2009 22:27:22 -0000
Received: (qmail 3499 invoked by uid 500); 21 Oct 2009 22:27:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3456 invoked by uid 500); 21 Oct 2009 22:27:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3446 invoked by uid 99); 21 Oct 2009 22:27:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 22:27:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jukka.zitting@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 21 Oct 2009 22:27:12 +0000
Received: by ywh13 with SMTP id 13so9922073ywh.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 15:26:51 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=jkncVd6w7s7mFG2Y/Dki8+kvzxyQ0FNpglwv8u/fYsA=;
        b=SSnNKVJSkALj9wAuCfriiTMUkdn4a0a4+myvYo+XJhxG+CQrdwucjic4WpZVCsj6Nj
         MAqeVt7Dm2OrL6bNtXSFnb3q4IDedr8CvlHjdDQ6wH+KXbzvvy6C8oz0oLQrYSKSriG4
         tAr0rdwZ5UFRf/GaSW5zyAyd5O2U+XLxfFdrY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=vdXIIeerGyr69OrwLqPoIBKj1+4UAjTNkLWE9grMs/u1BafviFzgsj4yjDgZTn4Tl4
         yTVY2xpr2vf+U4zwzO9SvzQrXj6jrCHBY/RHf0MuNacCIDDwlP6n10yaPLWeWvYyoQht
         XdiOKc6+MMDMeq3TjAwk+E5kBPxRVr+GKaXHs=
MIME-Version: 1.0
Received: by 10.101.213.5 with SMTP id p5mr5318996anq.1.1256164011107; Wed, 21 
	Oct 2009 15:26:51 -0700 (PDT)
In-Reply-To: <126142c0910191343sd763fcet623e632b4ae5d8e1@mail.gmail.com>
References: <510143ac0910160054y645ef6je4e51c4104cf361c@mail.gmail.com> 
	<D3FE8CCE-74D1-4075-A28A-EF4E1E2E8D18@apache.org> <510143ac0910170059x4bd95f34ye89c81e0a349776a@mail.gmail.com> 
	<126142c0910191343sd763fcet623e632b4ae5d8e1@mail.gmail.com>
From: Jukka Zitting <jukka.zitting@gmail.com>
Date: Thu, 22 Oct 2009 00:26:31 +0200
Message-ID: <510143ac0910211526p11fe93e3gdf8b3539b868eac5@mail.gmail.com>
Subject: Re: JDBC access to a Lucene index
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

On Mon, Oct 19, 2009 at 10:43 PM, Marcelo Ochoa <marcelo.ochoa@gmail.com> w=
rote:
> =A0 This is similar approach to Lucene Domain Index:
> http://docs.google.com/Doc?id=3Dddgw7sjp_54fgj9kg
> =A0 =A0But Lucene Domain Index is an specific implementation for Oracle
> Databases 10g/11g which is integrated through the ODCI API and
> replacing the Lucene file system storage by a BLOB storage.

Thanks for the pointer! Lucene Domain Index is not exactly what I'm
looking for, but it's seems close enough for me to at least borrow
some ideas from it.

BR,

Jukka Zitting

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42968-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 01:41:08 2009
Return-Path: <java-user-return-42968-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11985 invoked from network); 22 Oct 2009 01:41:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 01:41:08 -0000
Received: (qmail 50092 invoked by uid 500); 22 Oct 2009 01:41:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50022 invoked by uid 500); 22 Oct 2009 01:41:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50012 invoked by uid 99); 22 Oct 2009 01:41:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 01:41:05 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 01:40:56 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0mfL-0000Xj-UU
	for java-user@lucene.apache.org; Wed, 21 Oct 2009 18:40:35 -0700
Message-ID: <26002815.post@talk.nabble.com>
Date: Wed, 21 Oct 2009 18:40:35 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Handling + as a special character in Lucene search
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

How do i make sure lucene gives me back relevant search results when my
input string contains terms like c++? Lucene seems to ignore ++ characters.

Thanks

-- 
View this message in context: http://www.nabble.com/Handling-%2B-as-a-special-character-in-Lucene-search-tp26002815p26002815.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42969-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 01:51:17 2009
Return-Path: <java-user-return-42969-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13817 invoked from network); 22 Oct 2009 01:51:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 01:51:16 -0000
Received: (qmail 66810 invoked by uid 500); 22 Oct 2009 01:51:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66736 invoked by uid 500); 22 Oct 2009 01:51:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66726 invoked by uid 99); 22 Oct 2009 01:51:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 01:51:14 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 01:51:05 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0mpA-000177-G1
	for java-user@lucene.apache.org; Wed, 21 Oct 2009 18:50:44 -0700
Message-ID: <26002849.post@talk.nabble.com>
Date: Wed, 21 Oct 2009 18:50:44 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Resolving Lucene Index error
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

Why do I get error like this in Lucene and how to resolve it?

Could not find file 'C:\Indexes_z3_1.del'.

Thanks.

-- 
View this message in context: http://www.nabble.com/Resolving-Lucene-Index-error-tp26002849p26002849.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42970-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 03:31:47 2009
Return-Path: <java-user-return-42970-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35710 invoked from network); 22 Oct 2009 03:31:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 03:31:47 -0000
Received: (qmail 48602 invoked by uid 500); 22 Oct 2009 03:31:45 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48496 invoked by uid 500); 22 Oct 2009 03:31:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48484 invoked by uid 99); 22 Oct 2009 03:31:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 03:31:44 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of bill.w.au@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 03:31:40 +0000
Received: by iwn16 with SMTP id 16so4217464iwn.29
        for <java-user@lucene.apache.org>; Wed, 21 Oct 2009 20:31:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=nlwjka5kSjBtlX0heYYrhuTGwEHOOX8mXuMO2y7eQhs=;
        b=Ux7JFfJO6SiNI339uYUOxVgCPopamvYfXZWf6rpk3yrkH7MOhx1g88NgnrwEaZoHWq
         MiKTViJBHZwN4x19q+azU+Kk7OfEUfTOQzFnM4e4A7KggV9Gh7qwaEpALiqgVgw2Z+P1
         i1KEwltQCD5F/wMlshTiG0QBj6c+qER5rXrdU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=pviHgpnv0fEpRL4p4KRAQXrwNVHv/7xC7bS8pa55eGa+xM+0mBgl1iIzzyMTht3sd0
         eUaj9XFYQ71erWKcARAd77O68xDqCOp/y/OOBdez8Cph5YlG1wimxf8fHsVZxV6qgkN6
         D1hyRkdfHVYm+durbJo0pQXfFqZiN1vVtz8Hw=
MIME-Version: 1.0
Received: by 10.231.5.143 with SMTP id 15mr4309794ibv.40.1256182280197; Wed, 
	21 Oct 2009 20:31:20 -0700 (PDT)
Date: Wed, 21 Oct 2009 23:31:19 -0400
Message-ID: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
Subject: 2.9 per segment searching/caching
From: Bill Au <bill.w.au@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517741ab29595ae04767dbaf4

--001517741ab29595ae04767dbaf4
Content-Type: text/plain; charset=ISO-8859-1

Since Lucene 2.9 has per segment searching/caching, does query performance
degrade less than before (2.9) as more segments are added to the index?
Bill

--001517741ab29595ae04767dbaf4--

From java-user-return-42971-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 07:03:11 2009
Return-Path: <java-user-return-42971-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8897 invoked from network); 22 Oct 2009 07:03:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 07:03:11 -0000
Received: (qmail 4074 invoked by uid 500); 22 Oct 2009 07:03:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4006 invoked by uid 500); 22 Oct 2009 07:03:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3996 invoked by uid 99); 22 Oct 2009 07:03:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 07:03:08 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of simon.willnauer@googlemail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 07:02:58 +0000
Received: by fxm12 with SMTP id 12so9013842fxm.5
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 00:02:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=domainkey-signature:mime-version:received:reply-to:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=9zI3Knhy+SvL5Nmx6yhD93XqU4NtJ9NCXbG4yXJq+/M=;
        b=SMvB9NEYPvQYQ75g1nEAMPsBKB+H8fr03N2M0q0w0EkR8oZh+2ERCQ0WItyspVHQCM
         ovLzIYrg4Pmz/RZTVHJd6Jc/EC2ZfEXu1r8Tbhp4vcjUgaUeVfiF3tqnT1llJWB2lWy1
         QNS1TU/hWuXjQZOiJeDyIn3S2bOcjGsUAjcx4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=googlemail.com; s=gamma;
        h=mime-version:reply-to:in-reply-to:references:date:message-id
         :subject:from:to:content-type;
        b=MxN0rJ/T0k0kSEfgtehnXRgwTDtSWOZnI6CDAt300ij/W1lhHHs5n3WI9rz3zQjBZR
         yzZzHtcSi9aCgMjHZXs4P9POrvNy9g3+6FVCzIGSJvu9POWJuoYKm6HU8BkoERvOlvZz
         cfrp5Nub1Bn7XsnZLGP83RMQijtsBJls8P//w=
MIME-Version: 1.0
Received: by 10.239.183.141 with SMTP id u13mr830261hbg.10.1256194957923; Thu, 
	22 Oct 2009 00:02:37 -0700 (PDT)
Reply-To: simon.willnauer@gmail.com
In-Reply-To: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
References: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
Date: Thu, 22 Oct 2009 09:02:37 +0200
Message-ID: <f18c9dde0910220002v6e7334favf4d22e7b052a1bc1@mail.gmail.com>
Subject: Re: 2.9 per segment searching/caching
From: Simon Willnauer <simon.willnauer@googlemail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Bill,
per segments search does not replace index optimisation neither it
prevents the performance degrade if your number of segments is
increasing. Depending on how your index changes it can give you a
performance improvement when reopening the index and it will certainly
prevent one or another GC if a segment did not change since last
opened. This will improve the overall performance but the general
query performance will not be improved by per seg. search.

simon

On Thu, Oct 22, 2009 at 5:31 AM, Bill Au <bill.w.au@gmail.com> wrote:
> Since Lucene 2.9 has per segment searching/caching, does query performance
> degrade less than before (2.9) as more segments are added to the index?
> Bill
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42972-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 08:50:48 2009
Return-Path: <java-user-return-42972-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31958 invoked from network); 22 Oct 2009 08:50:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 08:50:48 -0000
Received: (qmail 11945 invoked by uid 500); 22 Oct 2009 08:50:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11899 invoked by uid 500); 22 Oct 2009 08:50:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11889 invoked by uid 99); 22 Oct 2009 08:50:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 08:50:46 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.212.198 as permitted sender)
Received: from [209.85.212.198] (HELO mail-vw0-f198.google.com) (209.85.212.198)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 08:50:44 +0000
Received: by vws36 with SMTP id 36so5252026vws.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 01:50:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=rcRo6B9nSs0Oh6Dakycr/333VOmcSEze6LHhXQCQOd0=;
        b=d/o2C+g3jXxFTqHHyDwNchotOxSRGaeMaQXCX8Zz+1SBZls/H2W2ZwmcFLD6LkrbQQ
         XX0/i+Gqb229iXZpOFMT457Cu/WBvnNDETOBsk1D7Nocb9GKIaoBLguDZ0Bgub/fkeRR
         wiWU915H/XU6vHMlm8+8utEEDE4AiSzcuU3yA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=KwaBzNsytpR1IpuXZ9bHkpa2QQohxrosdvRqshgCtb08taPMwrXuN0WQDeJPIYNGHs
         qB78c3ijBErstQqSthFqq+q6S+e3IKVekgsXmykxZLB7QRcCi4MsyKKb+cjHUcfPdcAx
         Jdz1Id8PnMbk6CZySC8uNx/tp5V5N6mlZWGnk=
MIME-Version: 1.0
Received: by 10.220.122.100 with SMTP id k36mr3927410vcr.38.1256201423101; 
	Thu, 22 Oct 2009 01:50:23 -0700 (PDT)
In-Reply-To: <26002815.post@talk.nabble.com>
References: <26002815.post@talk.nabble.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 22 Oct 2009 09:50:03 +0100
Message-ID: <8c4e68610910220150m537ecccdyb45e43424bb5cace@mail.gmail.com>
Subject: Re: Handling + as a special character in Lucene search
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

You need to make sure that these terms are getting indexed, by using
an analyzer that won't drop them and using Luke to check.  Then, if
you are using QueryParser, you'll need to escape the special
characters e.g. c\+\+.  See
http://lucene.apache.org/java/2_9_0/queryparsersyntax.html#Escaping%20Special%20Characters.
 And use the same analyzer at query time.

Google for something like lucene special characters for more info.


--
Ian.




On Thu, Oct 22, 2009 at 2:40 AM, mitu2009 <musicfreaque@gmail.com> wrote:
>
> Hi,
>
> How do i make sure lucene gives me back relevant search results when my
> input string contains terms like c++? Lucene seems to ignore ++ characters.
>
> Thanks
>
> --
> View this message in context: http://www.nabble.com/Handling-%2B-as-a-special-character-in-Lucene-search-tp26002815p26002815.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42973-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 09:26:23 2009
Return-Path: <java-user-return-42973-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41818 invoked from network); 22 Oct 2009 09:26:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 09:26:23 -0000
Received: (qmail 57765 invoked by uid 500); 22 Oct 2009 09:26:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57683 invoked by uid 500); 22 Oct 2009 09:26:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57672 invoked by uid 99); 22 Oct 2009 09:26:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 09:26:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 09:26:11 +0000
Received: by yxe30 with SMTP id 30so10131468yxe.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 02:25:50 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.4.5 with SMTP id g5mr15177513ybi.159.1256203546984; Thu, 
	22 Oct 2009 02:25:46 -0700 (PDT)
In-Reply-To: <26002849.post@talk.nabble.com>
References: <26002849.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 05:25:46 -0400
Message-ID: <9ac0c6aa0910220225i31ee001fyc957ae97e7ffcd55@mail.gmail.com>
Subject: Re: Resolving Lucene Index error
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Can you provide more details?  Which version of Lucene, Java, OS are
you using?  Is there a small test case?

Hideously, it looks like somehow your path was supposed to be
c:\Indexes\_z3_1.del, but somehow the \ was lost.

Mike

On Wed, Oct 21, 2009 at 9:50 PM, mitu2009 <musicfreaque@gmail.com> wrote:
>
> Hi,
>
> Why do I get error like this in Lucene and how to resolve it?
>
> Could not find file 'C:\Indexes_z3_1.del'.
>
> Thanks.
>
> --
> View this message in context: http://www.nabble.com/Resolving-Lucene-Index-error-tp26002849p26002849.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42974-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 11:17:43 2009
Return-Path: <java-user-return-42974-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69679 invoked from network); 22 Oct 2009 11:17:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 11:17:43 -0000
Received: (qmail 82022 invoked by uid 500); 22 Oct 2009 11:17:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81941 invoked by uid 500); 22 Oct 2009 11:17:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81931 invoked by uid 99); 22 Oct 2009 11:17:40 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 11:17:40 +0000
X-ASF-Spam-Status: No, hits=1.1 required=10.0
	tests=FORGED_HOTMAIL_RCVD2,SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 11:17:30 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0vfJ-0003mz-JA
	for java-user@lucene.apache.org; Thu, 22 Oct 2009 04:17:09 -0700
Message-ID: <26008208.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 04:17:09 -0700 (PDT)
From: ShibbyUK <lewis_r_j@hotmail.com>
To: java-user@lucene.apache.org
Subject: Searching slow *after* an optimize (lucene.net 2.3.2)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: lewis_r_j@hotmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


Hi,

We're having some odd performance problems. Recently, searching our index is
becoming slow *after* performing an optimize. This is counter intuitive as
usually the optimize has the opposite effect!

We're using lucene.net 2.3.2 and have an index of 250,000 documents and
about 500 queries per minute at peak times.

Performance is good (even after much indexing) until the optimize runs.
Then, queries are slow (2-5 seconds) for about 15 minutes until eventually
settling down a bit. But in this time, many query threads time out (as we
queue when we have to). We are not using any explicit caching methods.

Any help/suggestions on what to do would be much appreciated! I'm about to
rebuild the index from scratch to see if this temporarily resolves the
problem...

Thanks
-- 
View this message in context: http://www.nabble.com/Searching-slow-*after*-an-optimize-%28lucene.net-2.3.2%29-tp26008208p26008208.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42975-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 11:22:49 2009
Return-Path: <java-user-return-42975-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70785 invoked from network); 22 Oct 2009 11:22:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 11:22:49 -0000
Received: (qmail 90843 invoked by uid 500); 22 Oct 2009 11:22:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90772 invoked by uid 500); 22 Oct 2009 11:22:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90762 invoked by uid 99); 22 Oct 2009 11:22:47 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 11:22:47 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=5.0
	tests=AWL,BAYES_00,MIME_QP_LONG_LINE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of hrishikesh_agashe@persistent.co.in designates 202.54.11.87 as permitted sender)
Received: from [202.54.11.87] (HELO bmapps.persistent.co.in) (202.54.11.87)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 11:22:41 +0000
X-AuditID: 0a4e0006-b7c7eae000004705-d0-4ae04068b193
Received: from puneexchange.persistent.co.in ( [10.78.0.1])
	(using TLS with cipher AES128-SHA (AES128-SHA/128 bits))
	(Client did not present a certificate)
	by  (Symantec Mail Security) with SMTP id D1.16.18181.86040EA4; Thu, 22 Oct 2009 16:52:16 +0530 (IST)
Received: from Exchange.persistent.co.in ([fe80::ad8a:d553:ef93:bfdd]) by CAS1
 ([10.77.224.46]) with mapi; Thu, 22 Oct 2009 16:52:16 +0530
From: Hrishikesh Agashe <hrishikesh_agashe@persistent.co.in>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Thu, 22 Oct 2009 16:52:15 +0530
Subject: Maximum index file size
Thread-Topic: Maximum index file size
Thread-Index: AcpSiPaje6SDbuc/TnGZm1RmgS85wQAfo7ng
Message-ID: <E3137F97B0A0804194F369F4E7C3B71929AE7C85E9@EXCHANGE.persistent.co.in>
References: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
In-Reply-To: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
Accept-Language: en-US, en-IN
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US, en-IN
Content-Type: text/plain; charset="us-ascii"
content-transfer-encoding: quoted-printable
MIME-Version: 1.0
X-Brightmail-Tracker: AAAAAQAAAZE=

Hi,

I am running Ubuntu 9.04 on 64 bit machine with NAS of 100 TB capacity. JVM=
 is running with 2.5 GB Xmx.

Can I create an index file with very large size, like 1 TB or so? Is there a=
ny limit on how large index file one can create? Also, will I be able to sea=
rch on this 1 TB index file at all?

TIA,
--Hrishi

DISCLAIMER=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
This e-mail may contain privileged and confidential information which is the=
 property of Persistent Systems Ltd. It is intended only for the use of the=
 individual or entity to which it is addressed. If you are not the intended=
 recipient, you are not authorized to read, retain, copy, print, distribute=
 or use this message. If you have received this communication in error, plea=
se notify the sender and delete all copies of this message. Persistent Syste=
ms Ltd. does not accept any liability for virus infected mails.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42976-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:03:41 2009
Return-Path: <java-user-return-42976-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 82485 invoked from network); 22 Oct 2009 12:03:41 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:03:41 -0000
Received: (qmail 52747 invoked by uid 500); 22 Oct 2009 12:03:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52681 invoked by uid 500); 22 Oct 2009 12:03:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52671 invoked by uid 99); 22 Oct 2009 12:03:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:03:38 +0000
X-ASF-Spam-Status: No, hits=-2.3 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [64.6.227.49] (HELO aroush.net) (64.6.227.49)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:03:35 +0000
Received: (qmail 21880 invoked from network); 22 Oct 2009 08:03:14 -0400
Received: from pool-74-104-163-57.bstnma.fios.verizon.net (HELO aroushlt) (74.104.163.57)
  by aroush.net with SMTP; 22 Oct 2009 08:03:14 -0400
From: "George Aroush" <george@aroush.net>
To: <java-user@lucene.apache.org>
References: <26008208.post@talk.nabble.com>
In-Reply-To: <26008208.post@talk.nabble.com>
Subject: RE: Searching slow *after* an optimize (lucene.net 2.3.2)
Date: Thu, 22 Oct 2009 08:03:15 -0400
Message-ID: <215201ca530f$a31ca9e0$e955fda0$@net>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 12.0
Thread-Index: AcpTCUYj6zsRiVf1RcC757zKD7FmUAABdhSw
Content-Language: en-us

Please post your question to: lucene-net-user[AT]incubator.apache.org for
Lucene.Net related topics.  See http://incubator.apache.org/lucene.net/ for
subscription info.

-- George

-----Original Message-----
From: ShibbyUK [mailto:lewis_r_j@hotmail.com] 
Sent: Thursday, October 22, 2009 7:17 AM
To: java-user@lucene.apache.org
Subject: Searching slow *after* an optimize (lucene.net 2.3.2)


Hi,

We're having some odd performance problems. Recently, searching our index is
becoming slow *after* performing an optimize. This is counter intuitive as
usually the optimize has the opposite effect!

We're using lucene.net 2.3.2 and have an index of 250,000 documents and
about 500 queries per minute at peak times.

Performance is good (even after much indexing) until the optimize runs.
Then, queries are slow (2-5 seconds) for about 15 minutes until eventually
settling down a bit. But in this time, many query threads time out (as we
queue when we have to). We are not using any explicit caching methods.

Any help/suggestions on what to do would be much appreciated! I'm about to
rebuild the index from scratch to see if this temporarily resolves the
problem...

Thanks
-- 
View this message in context:
http://www.nabble.com/Searching-slow-*after*-an-optimize-%28lucene.net-2.3.2
%29-tp26008208p26008208.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42977-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:08:38 2009
Return-Path: <java-user-return-42977-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83324 invoked from network); 22 Oct 2009 12:08:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:08:38 -0000
Received: (qmail 62121 invoked by uid 500); 22 Oct 2009 12:08:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62060 invoked by uid 500); 22 Oct 2009 12:08:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62050 invoked by uid 99); 22 Oct 2009 12:08:35 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:08:35 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.222.176 as permitted sender)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:08:25 +0000
Received: by pzk6 with SMTP id 6so9602715pzk.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 05:08:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=eCcf1ez+7prNKAouRSLGpW4Ff92C8bGjNTO9bbO89Oc=;
        b=o3diIDC0DMt+ynk6SRLtK2wHDFPhyB2JoqN27SyWMNm0MvEHqMCii14OhdcJQD+DEo
         66ReKYhKUvDvF9dMmK8nK0ymtNf7NQNA5uoWOr0DZZuBBEc4EWJPn/e762xt1AlMeKpT
         cMo8Ll7DYWIPCEcm3fp94lgZ2avRCz4wu6Tbk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=K/7SM44+oQGC2Hwk1ceoJXuFkHsP3x9xMJn9aNHBDCEaHlVqkFUmelvSwIw34arAjr
         WjAV6IF5XDOCRucSzrnYtRRI3O3HYc/c/P6zI6I5Ib24KFbq9gaF+LA7a4YcavMD8MLO
         +k//eVpB7rizPWRCRE/X+HInBO7icbXs90poI=
Received: by 10.114.187.37 with SMTP id k37mr3785847waf.49.1256213284404;
        Thu, 22 Oct 2009 05:08:04 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 23sm1276159pxi.13.2009.10.22.05.08.00
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 22 Oct 2009 05:08:01 -0700 (PDT)
Message-ID: <4AE04B1E.4060809@gmail.com>
Date: Thu, 22 Oct 2009 08:07:58 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: 2.9 per segment searching/caching
References: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
In-Reply-To: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Bill Au wrote:
> Since Lucene 2.9 has per segment searching/caching, does query performance
> degrade less than before (2.9) as more segments are added to the index?
> Bill
>
>   
I think non sorting cases are actually faster now over multiple segments
- though you will still see performance degrade pretty signif. over a
single segment (I've measured even 5 segments as being 15-20% slower).
Doesn't really help the degrade, but should be faster at each point.

Sorting is a bit different - you have to convert the p-queue as you go
from segment to segment - so the more segments (which also generally
means more larger segments), the more conversion you have to do. This
didn't appear to be to bad unless you got up to quite a few segments .
Worse degradation though.

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42978-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:20:12 2009
Return-Path: <java-user-return-42978-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86144 invoked from network); 22 Oct 2009 12:20:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:20:12 -0000
Received: (qmail 77712 invoked by uid 500); 22 Oct 2009 12:20:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77641 invoked by uid 500); 22 Oct 2009 12:20:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77631 invoked by uid 99); 22 Oct 2009 12:20:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:20:09 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of aminmc@gmail.com designates 209.85.219.219 as permitted sender)
Received: from [209.85.219.219] (HELO mail-ew0-f219.google.com) (209.85.219.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:20:07 +0000
Received: by ewy19 with SMTP id 19so7720103ewy.28
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 05:19:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=mgnTb3CYGVJpqWe4yh0ygcHDDKtXi/mgfsCQOR0tMCE=;
        b=NAl+Vp8qG4YQHdaPJ6H8a8rGQGBEgaC1AKERUoV0snjDHm97RaZBt5255a7qI1rE3/
         vOgOD6gmtpeUn0n/jawImDY4U8O0ZEU7fdv1qTTqyBJSSs+y2B2b4hX9JsdQhVsimVyb
         5NuYUBxgRv7OHypQd3RETqf8qEqNwFF00gagA=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=EcKa1wvzjTMTIUr0r2avGnfvJiSCzNoNFqhOfe6K+gkKaNlWKkgD7UKujv5a5+faiF
         YFYkvFC44htSCd2UyG7sej+3sKxlEhLt9TmwuL74OYd23MkScdrUL0NIeOp6Xe65NFoR
         /fqmy+6ygoAqVHd2KXj56PMM33/zdotUMDVgo=
MIME-Version: 1.0
Received: by 10.216.88.136 with SMTP id a8mr1057401wef.77.1256213985618; Thu, 
	22 Oct 2009 05:19:45 -0700 (PDT)
Date: Thu, 22 Oct 2009 13:19:45 +0100
Message-ID: <6f4104d80910220519y5923d246xa70054b976392129@mail.gmail.com>
Subject: Special Characters and QueryParser
From: Amin Mohammed-Coleman <aminmc@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d64c235fef360476851ccd

--0016e6d64c235fef360476851ccd
Content-Type: text/plain; charset=ISO-8859-1

Hi

I am looking at handling special characters in the query as using certain
characters cause an exception.  I looked at QueryParser.escape(..) to handle
this. It works to a certain extent for example using '!' doesn't cause an
exception. However when I use a wildcard then the wildcard is ignored.  For
example ref* is converted to ref.  I know that the escape method looks for
particular special characters and one of them is '*'.  Is there a way to
handle special characters and not remove certain characters for example
'?'.  I'm guessing I would need to do something programmatically and add \
to the character and not apply it to * or ? or - or +.

Any help would be appreciated.


cheers
Amin

--0016e6d64c235fef360476851ccd--

From java-user-return-42979-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:36:56 2009
Return-Path: <java-user-return-42979-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93131 invoked from network); 22 Oct 2009 12:36:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:36:56 -0000
Received: (qmail 394 invoked by uid 500); 22 Oct 2009 12:36:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 339 invoked by uid 500); 22 Oct 2009 12:36:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 329 invoked by uid 99); 22 Oct 2009 12:36:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:36:53 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: 59.106.19.174 is neither permitted nor denied by domain of koji@r.email.ne.jp)
Received: from [59.106.19.174] (HELO www724.sakura.ne.jp) (59.106.19.174)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:36:48 +0000
Received: from koji-sekiguchi-no-macbook.local (w244069.ppp.asahi-net.or.jp [121.1.244.69])
	(authenticated bits=0)
	by www724.sakura.ne.jp (8.14.3/8.14.3) with ESMTP id n9MCaQvG080125
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 21:36:26 +0900 (JST)
	(envelope-from koji@r.email.ne.jp)
Message-ID: <4AE051CA.1010002@r.email.ne.jp>
Date: Thu, 22 Oct 2009 21:36:26 +0900
From: Koji Sekiguchi <koji@r.email.ne.jp>
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Handling + as a special character in Lucene search
References: <26002815.post@talk.nabble.com> <8c4e68610910220150m537ecccdyb45e43424bb5cace@mail.gmail.com>
In-Reply-To: <8c4e68610910220150m537ecccdyb45e43424bb5cace@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Or you can use MappingCharFilter if you are using Lucene 2.9.
You can convert "c++" into "cplusplus" prior to running Tokenizer.

Koji

-- 
http://www.rondhuit.com/en/



Ian Lea wrote:
> You need to make sure that these terms are getting indexed, by using
> an analyzer that won't drop them and using Luke to check.  Then, if
> you are using QueryParser, you'll need to escape the special
> characters e.g. c\+\+.  See
> http://lucene.apache.org/java/2_9_0/queryparsersyntax.html#Escaping%20Special%20Characters.
>  And use the same analyzer at query time.
>
> Google for something like lucene special characters for more info.
>
>
> --
> Ian.
>
>
>
>
> On Thu, Oct 22, 2009 at 2:40 AM, mitu2009 <musicfreaque@gmail.com> wrote:
>   
>> Hi,
>>
>> How do i make sure lucene gives me back relevant search results when my
>> input string contains terms like c++? Lucene seems to ignore ++ characters.
>>
>> Thanks
>>
>> --
>> View this message in context: http://www.nabble.com/Handling-%2B-as-a-special-character-in-Lucene-search-tp26002815p26002815.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>   



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42980-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:42:26 2009
Return-Path: <java-user-return-42980-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97738 invoked from network); 22 Oct 2009 12:42:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:42:26 -0000
Received: (qmail 6260 invoked by uid 500); 22 Oct 2009 12:42:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6177 invoked by uid 500); 22 Oct 2009 12:42:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6167 invoked by uid 99); 22 Oct 2009 12:42:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:42:24 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:42:21 +0000
Received: by iwn16 with SMTP id 16so4425391iwn.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 05:42:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=OIBotzdBDkVq+Az46qW9T1TsOvGf0aBaG6yNJnMZAwk=;
        b=VptEFxdWC55lHO9eMH+C8BQBCXZT2myr4yYb5YhBWUf4wNHvl4eMRc0FseG3IlE75Q
         dxE+REZbrgKr+Q8A9XAT/G3+gPbhvAbvID9fpBpYPmFiJ0Ke3+8kDQZs1MvElW7WZxgj
         kCr6w19kUNhuwE8KLyyjyyoZufwISG01cEwVU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=SAJY92K3g8BNuwUTMGCZLH9wFnS/99G/bLse8od7II8osjiNIlCk4WhZu6w9SCH87p
         1JB3nFnZxSirYfH/k/GL4rxKxnsaYW/cJkwpiOMjTVjkBjO+VfzhKteKl2wiz5O3kiNZ
         QJ8XmGP302PtYbtEbkFpfKHddq7NTnZomcKf0=
MIME-Version: 1.0
Received: by 10.231.120.90 with SMTP id c26mr2582880ibr.1.1256215320494; Thu, 
	22 Oct 2009 05:42:00 -0700 (PDT)
In-Reply-To: <26008208.post@talk.nabble.com>
References: <26008208.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 08:42:00 -0400
Message-ID: <359a92830910220542u3a3f7109rea2f57b08d82fdfe@mail.gmail.com>
Subject: Re: Searching slow *after* an optimize (lucene.net 2.3.2)
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6480e08f081fe0476856b75

--0016e6480e08f081fe0476856b75
Content-Type: text/plain; charset=ISO-8859-1

Check this out with the .net port folks, but in the Java world, whenyou open
an IndexReader (which I presume you do after optimizing),
the first few queries fill various caches etc. and do run slowly. One
solution is to fire a few warmup queries at the newly opened reader
before letting your main application start using that same reader.

I'm surprised that it takes 15 minutes for things to settle down.
When you post on the .net forum, you should include the amount
of memory you're allocating to the process as well as other
details, like what *else* is running on your searcher.

Best
Erick

On Thu, Oct 22, 2009 at 7:17 AM, ShibbyUK <lewis_r_j@hotmail.com> wrote:

>
> Hi,
>
> We're having some odd performance problems. Recently, searching our index
> is
> becoming slow *after* performing an optimize. This is counter intuitive as
> usually the optimize has the opposite effect!
>
> We're using lucene.net 2.3.2 and have an index of 250,000 documents and
> about 500 queries per minute at peak times.
>
> Performance is good (even after much indexing) until the optimize runs.
> Then, queries are slow (2-5 seconds) for about 15 minutes until eventually
> settling down a bit. But in this time, many query threads time out (as we
> queue when we have to). We are not using any explicit caching methods.
>
> Any help/suggestions on what to do would be much appreciated! I'm about to
> rebuild the index from scratch to see if this temporarily resolves the
> problem...
>
> Thanks
> --
> View this message in context:
> http://www.nabble.com/Searching-slow-*after*-an-optimize-%28lucene.net-2.3.2%29-tp26008208p26008208.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e6480e08f081fe0476856b75--

From java-user-return-42981-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:46:17 2009
Return-Path: <java-user-return-42981-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 2157 invoked from network); 22 Oct 2009 12:46:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:46:17 -0000
Received: (qmail 12763 invoked by uid 500); 22 Oct 2009 12:46:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12678 invoked by uid 500); 22 Oct 2009 12:46:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12668 invoked by uid 99); 22 Oct 2009 12:46:14 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:46:14 +0000
X-ASF-Spam-Status: No, hits=-1.0 required=10.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.26 as permitted sender)
Received: from [66.111.4.26] (HELO out2.smtp.messagingengine.com) (66.111.4.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:46:05 +0000
Received: from compute2.internal (compute2.internal [10.202.2.42])
	by gateway1.messagingengine.com (Postfix) with ESMTP id C38E5B4E3A
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 08:45:44 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute2.internal (MEProxy); Thu, 22 Oct 2009 08:45:45 -0400
X-Sasl-enc: j9O8eeF+5ovpIDNhv1yq0ATgtEefkfvD6irdlgBlWk72 1256215544
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id 2E9AA6E2B5
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 08:45:44 -0400 (EDT)
Message-ID: <4AE053F7.60708@fastmail.fm>
Date: Thu, 22 Oct 2009 13:45:43 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Performance tips when creating a large index from database.
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

I'm building a lucene index from a database, creating 1 about 1 million 
documents, unsuprisingly this takes quite a long time.
I do this by sending a query  to the db over a range of ids , (10,000) 
records
Add these results in Lucene
Then get next 10,0000 and so on.
When completed indexing I then call optimize()
I also set  indexWriter.setMaxBufferedDocs(1000) and  
indexWriter.setMergeFactor(3000) but don't fully understand these values.
Each document contains about 10 small fields

I'm looking for some ways to improve performance.

This index writing is single threaded, is there a way I can multi-thread 
writing to the indexing ?
I only call optimize() once at the end, is the best way to do it.
I'm going to run a profiler over the code, but are there any rules of 
thumbs on the best values to set for MaxBufferedDocs and Mergefactor()

thanks Paul

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42982-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 12:53:06 2009
Return-Path: <java-user-return-42982-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 5009 invoked from network); 22 Oct 2009 12:53:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 12:53:06 -0000
Received: (qmail 20208 invoked by uid 500); 22 Oct 2009 12:53:02 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20129 invoked by uid 500); 22 Oct 2009 12:53:02 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20109 invoked by uid 99); 22 Oct 2009 12:53:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:53:01 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of glen.newton@gmail.com designates 209.85.217.219 as permitted sender)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 12:52:51 +0000
Received: by gxk19 with SMTP id 19so4284857gxk.5
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 05:52:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=epe7fKqU4j38MiwpB9lYU1V4mkKRyo8YYy5DvOrBfHA=;
        b=pKWTEORAz2FXJ2u/jEYQpcjpOxU92BdzvEHbLfsgQLl2oPnDWOl+1PiG8Q7tgnC4vX
         xjMkGPNlNTRAVtDfk9WvgknLSQccAVf5in8VF6VTOos50/cXYo/hTX++/7dEMf+oijkF
         e9pDKJZvT1ZF08VtkokJYVDFqrlb8Z0nfeYmg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=jzCCA9vVP4qpR/b8yS32sDNQ+R6KXIf81cew9kkqQ+BrTSpXOLZ0742g5t8E+BraH9
         mh9hUPAnxXkMHJnwbsv/BNa82+1m6WWwK9ixD1cGSpSci8L+OEmpNBv5maLWdaNjAMIg
         W/t6jGip/zbiykxOttlQVpB9H/gdZeHMZNMOo=
MIME-Version: 1.0
Received: by 10.101.144.1 with SMTP id w1mr5385359ann.81.1256215948879; Thu, 
	22 Oct 2009 05:52:28 -0700 (PDT)
In-Reply-To: <4AE053F7.60708@fastmail.fm>
References: <4AE053F7.60708@fastmail.fm>
Date: Thu, 22 Oct 2009 08:52:28 -0400
Message-ID: <5e76f3840910220552u87efffaj3dcff252ebf4fe9c@mail.gmail.com>
Subject: Re: Performance tips when creating a large index from database.
From: Glen Newton <glen.newton@gmail.com>
To: java-user@lucene.apache.org, paul_t100@fastmail.fm
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

You might want to consider using LuSql, which is a high performance,
multithreaded, well documented tool designed specifically for moving
data from a JDBC database into Lucene (you didn't say if it was a
JDBC-accessible db...)
 http://lab.cisti-icist.nrc-cnrc.gc.ca/cistilabswiki/index.php/LuSql

Disclosure: I am the author of LuSql.

-Glen Newton
 http://zzzoot.blogspot.com/
 http://lab.cisti-icist.nrc-cnrc.gc.ca/cistilabswiki/index.php/Glen_Newton


2009/10/22 Paul Taylor <paul_t100@fastmail.fm>:
> I'm building a lucene index from a database, creating 1 about 1 million
> documents, unsuprisingly this takes quite a long time.
> I do this by sending a query =C2=A0to the db over a range of ids , (10,00=
0)
> records
> Add these results in Lucene
> Then get next 10,0000 and so on.
> When completed indexing I then call optimize()
> I also set =C2=A0indexWriter.setMaxBufferedDocs(1000) and
> =C2=A0indexWriter.setMergeFactor(3000) but don't fully understand these v=
alues.
> Each document contains about 10 small fields
>
> I'm looking for some ways to improve performance.
>
> This index writing is single threaded, is there a way I can multi-thread
> writing to the indexing ?
> I only call optimize() once at the end, is the best way to do it.
> I'm going to run a profiler over the code, but are there any rules of thu=
mbs
> on the best values to set for MaxBufferedDocs and Mergefactor()
>
> thanks Paul
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20

-

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42983-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 13:09:18 2009
Return-Path: <java-user-return-42983-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11048 invoked from network); 22 Oct 2009 13:09:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 13:09:18 -0000
Received: (qmail 40191 invoked by uid 500); 22 Oct 2009 13:09:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40096 invoked by uid 500); 22 Oct 2009 13:09:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40086 invoked by uid 99); 22 Oct 2009 13:09:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:09:15 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of ian.lea@gmail.com designates 209.85.212.198 as permitted sender)
Received: from [209.85.212.198] (HELO mail-vw0-f198.google.com) (209.85.212.198)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:09:05 +0000
Received: by vws36 with SMTP id 36so5341951vws.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 06:08:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=pucpOhb80+5E6bernAE7t2+K7ik3XNwiRJ5fjfNHOjU=;
        b=q9TzHPkGqYbo9CBODV6dgxJEB0xBsZRysaVqy/PsH0xetTX0jk3KsFHX601HBNDKrq
         O2nRk+stgOcJyL8wCOkd9n9NcM7+L8Xb6v5oZjilH4GrPgcYqjAJvpBjtQ0/BZEk6gIp
         AKJ9nc0FHaS32GoO3D6uzMTYDNV+mqD/1Xw8A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=fVM5fjFgkt6hEoH3xogI2CGXhX9NF25IFUGtJTCM2S2AaeoekcMl/Or7wTuYmw3oGG
         v7ayliryku3GbjLC8LOJDbM63AMfHf/BkbbxBgJvUpIBVfJXw/pK+zkvUZ2vhxRbKMJf
         Ah9vJId8XjxrEoY5siRO3LG9KxA35A/gm4e9E=
MIME-Version: 1.0
Received: by 10.220.88.220 with SMTP id b28mr4175213vcm.95.1256216924089; Thu, 
	22 Oct 2009 06:08:44 -0700 (PDT)
In-Reply-To: <5e76f3840910220552u87efffaj3dcff252ebf4fe9c@mail.gmail.com>
References: <4AE053F7.60708@fastmail.fm> <5e76f3840910220552u87efffaj3dcff252ebf4fe9c@mail.gmail.com>
From: Ian Lea <ian.lea@gmail.com>
Date: Thu, 22 Oct 2009 14:08:24 +0100
Message-ID: <8c4e68610910220608n1ac28684je3cf8e2841febb24@mail.gmail.com>
Subject: Re: Performance tips when creating a large index from database.
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

See also http://wiki.apache.org/lucene-java/ImproveIndexingSpeed.
That includes some info on merge and buffer factors, and recommends
multiple threads.  When I've done this sort of thing in the past it
has tended to be the database that is the problem, but maybe your
database is faster than mine.  Only calling optimize at the end is
correct.  You don't need to call it at all.


--
Ian.


On Thu, Oct 22, 2009 at 1:52 PM, Glen Newton <glen.newton@gmail.com> wrote:
> You might want to consider using LuSql, which is a high performance,
> multithreaded, well documented tool designed specifically for moving
> data from a JDBC database into Lucene (you didn't say if it was a
> JDBC-accessible db...)
> =A0http://lab.cisti-icist.nrc-cnrc.gc.ca/cistilabswiki/index.php/LuSql
>
> Disclosure: I am the author of LuSql.
>
> -Glen Newton
> =A0http://zzzoot.blogspot.com/
> =A0http://lab.cisti-icist.nrc-cnrc.gc.ca/cistilabswiki/index.php/Glen_New=
ton
>
>
> 2009/10/22 Paul Taylor <paul_t100@fastmail.fm>:
>> I'm building a lucene index from a database, creating 1 about 1 million
>> documents, unsuprisingly this takes quite a long time.
>> I do this by sending a query =A0to the db over a range of ids , (10,000)
>> records
>> Add these results in Lucene
>> Then get next 10,0000 and so on.
>> When completed indexing I then call optimize()
>> I also set =A0indexWriter.setMaxBufferedDocs(1000) and
>> =A0indexWriter.setMergeFactor(3000) but don't fully understand these val=
ues.
>> Each document contains about 10 small fields
>>
>> I'm looking for some ways to improve performance.
>>
>> This index writing is single threaded, is there a way I can multi-thread
>> writing to the indexing ?
>> I only call optimize() once at the end, is the best way to do it.
>> I'm going to run a profiler over the code, but are there any rules of th=
umbs
>> on the best values to set for MaxBufferedDocs and Mergefactor()
>>
>> thanks Paul
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
>
>
> --
>
> -
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42984-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 13:15:19 2009
Return-Path: <java-user-return-42984-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 12696 invoked from network); 22 Oct 2009 13:15:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 13:15:19 -0000
Received: (qmail 46756 invoked by uid 500); 22 Oct 2009 13:15:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46683 invoked by uid 500); 22 Oct 2009 13:15:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46673 invoked by uid 99); 22 Oct 2009 13:15:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:15:17 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:15:14 +0000
Received: by iwn16 with SMTP id 16so4443560iwn.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 06:14:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=IVaB+1fExL97wIuzpahr6G9zUSDVnwfOz+1IR3JmFi4=;
        b=nqPR/yS23l0XXjnWC+BeaoHnWQ2RdUB+T40zj3OuspGrfJma7fPSHZwghzBoRGarSj
         BhIQ3/XZcRlpgQdk2XfhDrdQ8YFc5PUzFJ/p8X8cEuqtbjYSATEYf7zCg6KrgwFUpJrS
         8mpm7TBXGwxy7nvJd8xxVmhGV44Jz002bj7Ik=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=TitDBdG1sM/A//FArmdTp4HHY+oxFRogKzU1zpVDhNmv+ByGnbp0eQvrQkF/KNIiwO
         EMXzox9cxWC9x9k34z0n1aqY7tTlPdG0FGkJiTYc3K4pmVfpWOt9qd9ddkA8zZ+9Xad6
         eqWISFC5A004ZVhXnsuENtSYO/YwmATODZ4Eo=
MIME-Version: 1.0
Received: by 10.231.6.153 with SMTP id 25mr7120344ibz.54.1256217293659; Thu, 
	22 Oct 2009 06:14:53 -0700 (PDT)
In-Reply-To: <4AE053F7.60708@fastmail.fm>
References: <4AE053F7.60708@fastmail.fm>
Date: Thu, 22 Oct 2009 09:14:53 -0400
Message-ID: <359a92830910220614k4a072f6bs110629c14e280af3@mail.gmail.com>
Subject: Re: Performance tips when creating a large index from database.
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org, paul_t100@fastmail.fm
Content-Type: multipart/alternative; boundary=0015176f03e08ca1de047685e1b3

--0015176f03e08ca1de047685e1b3
Content-Type: text/plain; charset=ISO-8859-1

Besides the other suggestions, I'd really, really, really put
some instrumentationin the code and see where you're spending your time. For
a fast hint, put
a cumulative timer around your indexing part only. This will indicate
whether
the time is consumed in querying your database or indexing......

I'd also just use the default merge factor etc. until you answer
this question. They weren't just chosen at random <G>.

Something like this.
long elapsed = 0;
while (more database records) {
    get database record
    long temp = get time
    index Lucene doc
    elapsed += (get time) - temp
}
print time


It's unclear from your message whether you're calling optimize after
every 10,000 docs or not, but don't.

But I really suspect you're spending time interacting with the DB.

If these responses aren't all that helpful, some code samples
would help...

Best
Erick


On Thu, Oct 22, 2009 at 8:45 AM, Paul Taylor <paul_t100@fastmail.fm> wrote:

> I'm building a lucene index from a database, creating 1 about 1 million
> documents, unsuprisingly this takes quite a long time.
> I do this by sending a query  to the db over a range of ids , (10,000)
> records
> Add these results in Lucene
> Then get next 10,0000 and so on.
> When completed indexing I then call optimize()
> I also set  indexWriter.setMaxBufferedDocs(1000) and
>  indexWriter.setMergeFactor(3000) but don't fully understand these values.
> Each document contains about 10 small fields
>
> I'm looking for some ways to improve performance.
>
> This index writing is single threaded, is there a way I can multi-thread
> writing to the indexing ?
> I only call optimize() once at the end, is the best way to do it.
> I'm going to run a profiler over the code, but are there any rules of
> thumbs on the best values to set for MaxBufferedDocs and Mergefactor()
>
> thanks Paul
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0015176f03e08ca1de047685e1b3--

From java-user-return-42985-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 13:28:16 2009
Return-Path: <java-user-return-42985-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15373 invoked from network); 22 Oct 2009 13:28:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 13:28:16 -0000
Received: (qmail 75085 invoked by uid 500); 22 Oct 2009 13:28:13 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75040 invoked by uid 500); 22 Oct 2009 13:28:13 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75030 invoked by uid 99); 22 Oct 2009 13:28:13 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:28:13 +0000
X-ASF-Spam-Status: No, hits=-3.6 required=5.0
	tests=BAYES_00,RCVD_IN_DNSWL_LOW
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of paul_t100@fastmail.fm designates 66.111.4.26 as permitted sender)
Received: from [66.111.4.26] (HELO out2.smtp.messagingengine.com) (66.111.4.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:28:07 +0000
Received: from compute1.internal (compute1.internal [10.202.2.41])
	by gateway1.messagingengine.com (Postfix) with ESMTP id 02B56B4934;
	Thu, 22 Oct 2009 09:27:46 -0400 (EDT)
Received: from heartbeat1.messagingengine.com ([10.202.2.160])
  by compute1.internal (MEProxy); Thu, 22 Oct 2009 09:27:44 -0400
X-Sasl-enc: OLlCyd41u/SjjJI6nQFvj4PpEXn41WsMwDjjBl0BuR4E 1256218065
Received: from macbook.lan (unknown [217.155.98.246])
	by mail.messagingengine.com (Postfix) with ESMTPA id 4FA5E6E39F;
	Thu, 22 Oct 2009 09:27:45 -0400 (EDT)
Message-ID: <4AE05DD0.6050902@fastmail.fm>
Date: Thu, 22 Oct 2009 14:27:44 +0100
From: Paul Taylor <paul_t100@fastmail.fm>
Reply-To: paul_t100@fastmail.fm
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: Glen Newton <glen.newton@gmail.com>
CC: java-user@lucene.apache.org
Subject: Re: Performance tips when creating a large index from database.
References: <4AE053F7.60708@fastmail.fm> <5e76f3840910220552u87efffaj3dcff252ebf4fe9c@mail.gmail.com>
In-Reply-To: <5e76f3840910220552u87efffaj3dcff252ebf4fe9c@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

Glen Newton wrote:
> You might want to consider using LuSql, which is a high performance,
> multithreaded, well documented tool designed specifically for moving
> data from a JDBC database into Lucene (you didn't say if it was a
> JDBC-accessible db...)
>  http://lab.cisti-icist.nrc-cnrc.gc.ca/cistilabswiki/index.php/LuSql
>
> Disclosure: I am the author of LuSql.
>
> -Glen Newton
>  http://zzzoot.blogspot.com/
>  http://lab.cisti-icist.nrc-cnrc.gc.ca/cistilabswiki/index.php/Glen_Newton
>   

Thanks Glen

I have already written all the code for sending queries to the database, 
deciding what fields I want to use ectera, so I wouldn't want to redo 
that to use another tool especially when you offer only a command line 
interface not an api. But I
would be interested in how you use multithreading to best advantage for 
this , would you care to share the basics ?

Paul

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42986-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 14:00:06 2009
Return-Path: <java-user-return-42986-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25227 invoked from network); 22 Oct 2009 14:00:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 14:00:05 -0000
Received: (qmail 31646 invoked by uid 500); 22 Oct 2009 14:00:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31566 invoked by uid 500); 22 Oct 2009 14:00:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31556 invoked by uid 99); 22 Oct 2009 14:00:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 14:00:03 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of marcelo.ochoa@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 13:59:58 +0000
Received: by pwi12 with SMTP id 12so1530067pwi.5
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 06:59:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=zaCkhTp2skuRE6Jo93/BNcP5bP9Xs8N7ODdtmnJiHrA=;
        b=TAwdUUZXrwQ6aw2iFNwT1bQK7cCyCi4bV1IwbXte5mR5dBOr1jdRU39i5p2Ha4C6uq
         LdFQNQNJolWQZiPgBtWMwlM6GG2BT2vqpAEAz0qambMfsJn9oSqEfiX3h9/kzz6SN/of
         lI/K7KWOf36N+MvKvRHoUQr7N7AUYy9U3LvW4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=WNRNeVUblfSIuKf6KAOsraWpMb/jbn++++GB43N4RJgQqByptr/qyYO8Reku+lKpz2
         ijQsdfIpL0Eb3b37G8XunlgbmjcAo46iStNtC/ZSfPEeUvdhYwTC0SLnFSBA2r8m/+eP
         GUxQ7K4GXP1rYIEptNl82LtlqVNy+uo0/+9eI=
MIME-Version: 1.0
Received: by 10.115.117.13 with SMTP id u13mr5589301wam.150.1256219978558; 
	Thu, 22 Oct 2009 06:59:38 -0700 (PDT)
In-Reply-To: <4AE053F7.60708@fastmail.fm>
References: <4AE053F7.60708@fastmail.fm>
Date: Thu, 22 Oct 2009 10:59:38 -0300
Message-ID: <126142c0910220659r7bb78e53r354c84515849e62e@mail.gmail.com>
Subject: Re: Performance tips when creating a large index from database.
From: Marcelo Ochoa <marcelo.ochoa@gmail.com>
To: java-user@lucene.apache.org, paul_t100@fastmail.fm
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Paul:
   Mostly of the time indexing big tables is spent on the table full
scan and network data transfer.
   Please take a quick look at my OOW08 presentation about Oracle
Lucene integration:
          http://docs.google.com/present/view?id=3Dddgw7sjp_156gf9hczxv
    specially slides 13 and 14 which shows time involved during a
WikiPedia dump indexing inside an Oracle database.
    Best regards, Marcelo.
On Thu, Oct 22, 2009 at 9:45 AM, Paul Taylor <paul_t100@fastmail.fm> wrote:
> I'm building a lucene index from a database, creating 1 about 1 million
> documents, unsuprisingly this takes quite a long time.
> I do this by sending a query =A0to the db over a range of ids , (10,000)
> records
> Add these results in Lucene
> Then get next 10,0000 and so on.
> When completed indexing I then call optimize()
> I also set =A0indexWriter.setMaxBufferedDocs(1000) and
> =A0indexWriter.setMergeFactor(3000) but don't fully understand these valu=
es.
> Each document contains about 10 small fields
>
> I'm looking for some ways to improve performance.
>
> This index writing is single threaded, is there a way I can multi-thread
> writing to the indexing ?
> I only call optimize() once at the end, is the best way to do it.
> I'm going to run a profiler over the code, but are there any rules of thu=
mbs
> on the best values to set for MaxBufferedDocs and Mergefactor()
>
> thanks Paul
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20
Marcelo F. Ochoa
http://marceloochoa.blogspot.com/
http://marcelo.ochoa.googlepages.com/home
______________
Want to integrate Lucene and Oracle?
http://marceloochoa.blogspot.com/2007/09/running-lucene-inside-your-oracle-=
jvm.html
Is Oracle 11g REST ready?
http://marceloochoa.blogspot.com/2008/02/is-oracle-11g-rest-ready.html

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42987-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 14:51:22 2009
Return-Path: <java-user-return-42987-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41084 invoked from network); 22 Oct 2009 14:51:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 14:51:22 -0000
Received: (qmail 87795 invoked by uid 500); 22 Oct 2009 14:51:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87717 invoked by uid 500); 22 Oct 2009 14:51:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87707 invoked by uid 99); 22 Oct 2009 14:51:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 14:51:19 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of thomas.becker@net-m.de designates 62.214.145.243 as permitted sender)
Received: from [62.214.145.243] (HELO mx1.net-m.de) (62.214.145.243)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 14:51:16 +0000
Received: from tbeckers-MacBook.local (office-out.net-m.de [62.214.145.252])
	(authenticated bits=0)
	by mx1.net-m.de (8.13.8/8.13.8) with ESMTP id n9MEoobf030527
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NO)
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 16:50:50 +0200
Message-ID: <4AE0714A.8000800@net-m.de>
Date: Thu, 22 Oct 2009 16:50:50 +0200
From: Thomas Becker <thomas.becker@net-m.de>
User-Agent: Thunderbird 2.0.0.23 (Macintosh/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Performance tips when creating a large index from database.
References: <4AE053F7.60708@fastmail.fm>
In-Reply-To: <4AE053F7.60708@fastmail.fm>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 8bit
X-Greylist: Sender succeeded SMTP AUTH, not delayed by milter-greylist-4.0 (mx1.net-m.de [192.168.4.13]); Thu, 22 Oct 2009 16:50:50 +0200 (CEST)
X-Virus-Scanned: ClamAV 0.93.3/9926/Thu Oct 22 11:10:50 2009 on nereus.d4.net-m.de
X-Virus-Status: Clean
X-Spam-Level: _TESTSCORES(,)_
X-Spam-Checker-Version: SpamAssassin 3.2.4-netm20061016 on extranet1.net-m.de
X-Old-Spam-Status: No, hits=-102.6 required=5.0 version=3.2.4-netm20061016

Profile your application first hand and find out where the bottlenecks really
are during indexing.

For me it was clearly the database calls which took most of the time. Due to a
very complex SQL Query.
I applied the Producer - Consumer pattern and put a blocking queue in between. I
have a threadpool running x producers which are sending SQL Queries to the
database. Each returned row is put into the blockingQueue and another threadpool
running x (currently only 1) consumers is taking Objects from the row, converts
them to lucene documents and adds them to the index.
If the last row is put into the queue I add a Poison Pill to tell the consumer
to break.
Using a blockingQueue limited to 10.000 entries together with jdbc fetchSize
avoids high memory consumptions if too many producer threads return from the db.

This way I could reduce indexing time from around 8h to 30 min. (really). But be
careful. Load on the DB Server will surely increase.

Hope that helps.

Cheers,
Thomas

Paul Taylor wrote:
> I'm building a lucene index from a database, creating 1 about 1 million
> documents, unsuprisingly this takes quite a long time.
> I do this by sending a query  to the db over a range of ids , (10,000)
> records
> Add these results in Lucene
> Then get next 10,0000 and so on.
> When completed indexing I then call optimize()
> I also set  indexWriter.setMaxBufferedDocs(1000) and 
> indexWriter.setMergeFactor(3000) but don't fully understand these values.
> Each document contains about 10 small fields
> 
> I'm looking for some ways to improve performance.
> 
> This index writing is single threaded, is there a way I can multi-thread
> writing to the indexing ?
> I only call optimize() once at the end, is the best way to do it.
> I'm going to run a profiler over the code, but are there any rules of
> thumbs on the best values to set for MaxBufferedDocs and Mergefactor()
> 
> thanks Paul
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
> 

-- 
Thomas Becker
Senior JEE Developer

net mobile AG
Zollhof 17
40221 Dsseldorf
GERMANY

Phone:    +49 211 97020-195
Fax:      +49 211 97020-949
Mobile:   +49 173 5146567 (private)
E-Mail:   mailto:thomas.becker@net-m.de
Internet: http://www.net-m.de

Registergericht:  Amtsgericht Dsseldorf, HRB 48022
Vorstand:         Theodor Niehues (Vorsitzender), Frank Hartmann,
                 Kai Markus Kulas, Dieter Plassmann
Vorsitzender des
Aufsichtsrates:   Dr. Michael Briem

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42988-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 14:59:32 2009
Return-Path: <java-user-return-42988-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43532 invoked from network); 22 Oct 2009 14:59:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 14:59:32 -0000
Received: (qmail 4203 invoked by uid 500); 22 Oct 2009 14:59:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4117 invoked by uid 500); 22 Oct 2009 14:59:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4106 invoked by uid 99); 22 Oct 2009 14:59:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 14:59:30 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of glen.newton@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 14:59:27 +0000
Received: by ywh13 with SMTP id 13so10889686ywh.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 07:59:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=+lOHPh4YOsLi4/sn6YW2igztGiA9/aR6f3HdP7HMqug=;
        b=CH36IuqZ5XxSef9IDoJCH4MhnVbC6ht3TtFi1owuwZQ783WLOd+TlVo4oXUc/xfWND
         yv/c+RwwFP0JbACjMsZ26M5YFyUclBDqB0iV+nSkjMgcLpDpKLK4OMbNLq+KxNCNC20C
         fmUs03XHmjGZhg9Xdio8d5gM6hJFhO+u9/CUU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=P+Io77Tv3KgNpzhxAQ9nOWzt5WcAJbyXxahY3sJ/PRoO1bKVjkZBRGMLqTdtRxHncW
         vn73cvyutYNDrdH0YDcCq+8pYyBlCK7W1LUD0wkbtk4ec/PLFd14iXgBhAH+Q8HEPJgP
         waz9BpICvaXB0yBKmHE/8BTD/XT7ujXls/0SQ=
MIME-Version: 1.0
Received: by 10.101.56.19 with SMTP id i19mr5747578ank.134.1256223541486; Thu, 
	22 Oct 2009 07:59:01 -0700 (PDT)
In-Reply-To: <4AE0714A.8000800@net-m.de>
References: <4AE053F7.60708@fastmail.fm> <4AE0714A.8000800@net-m.de>
Date: Thu, 22 Oct 2009 10:59:01 -0400
Message-ID: <5e76f3840910220759l6c439e10l6099dcda350a0fb@mail.gmail.com>
Subject: Re: Performance tips when creating a large index from database.
From: Glen Newton <glen.newton@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

This is basically what LuSql does. The time increases ("8h to 30 min")
are similar. Usually on the order of an order of magnitude.

Oh, the comments suggesting most of the interaction is with the
database? The answer is: it depends.
With large Lucene documents: Lucene is the limiting factor (worsened
by going single threaded).
With small documents: it can be the DB.

Other issues include waiting for complex queries on the DB to be ready
(avoid sorting in the SQL!!).
LuSql supports out-of-band joins (don't do the join in the SQL, but do
the join from the client (with an additional- but low cost as it is
usually on the primary key - query for each record); sometimes this is
better; sometimes this is worse, depending on your DB design, queries,
etc.)

-Glen

2009/10/22 Thomas Becker <thomas.becker@net-m.de>:
> Profile your application first hand and find out where the bottlenecks re=
ally
> are during indexing.
>
> For me it was clearly the database calls which took most of the time. Due=
 to a
> very complex SQL Query.
> I applied the Producer - Consumer pattern and put a blocking queue in bet=
ween. I
> have a threadpool running x producers which are sending SQL Queries to th=
e
> database. Each returned row is put into the blockingQueue and another thr=
eadpool
> running x (currently only 1) consumers is taking Objects from the row, co=
nverts
> them to lucene documents and adds them to the index.
> If the last row is put into the queue I add a Poison Pill to tell the con=
sumer
> to break.
> Using a blockingQueue limited to 10.000 entries together with jdbc fetchS=
ize
> avoids high memory consumptions if too many producer threads return from =
the db.
>
> This way I could reduce indexing time from around 8h to 30 min. (really).=
 But be
> careful. Load on the DB Server will surely increase.
>
> Hope that helps.
>
> Cheers,
> Thomas
>
> Paul Taylor wrote:
>> I'm building a lucene index from a database, creating 1 about 1 million
>> documents, unsuprisingly this takes quite a long time.
>> I do this by sending a query =C2=A0to the db over a range of ids , (10,0=
00)
>> records
>> Add these results in Lucene
>> Then get next 10,0000 and so on.
>> When completed indexing I then call optimize()
>> I also set =C2=A0indexWriter.setMaxBufferedDocs(1000) and
>> indexWriter.setMergeFactor(3000) but don't fully understand these values=
.
>> Each document contains about 10 small fields
>>
>> I'm looking for some ways to improve performance.
>>
>> This index writing is single threaded, is there a way I can multi-thread
>> writing to the indexing ?
>> I only call optimize() once at the end, is the best way to do it.
>> I'm going to run a profiler over the code, but are there any rules of
>> thumbs on the best values to set for MaxBufferedDocs and Mergefactor()
>>
>> thanks Paul
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
> --
> Thomas Becker
> Senior JEE Developer
>
> net mobile AG
> Zollhof 17
> 40221 D=C3=BCsseldorf
> GERMANY
>
> Phone: =C2=A0 =C2=A0+49 211 97020-195
> Fax: =C2=A0 =C2=A0 =C2=A0+49 211 97020-949
> Mobile: =C2=A0 +49 173 5146567 (private)
> E-Mail: =C2=A0 mailto:thomas.becker@net-m.de
> Internet: http://www.net-m.de
>
> Registergericht: =C2=A0Amtsgericht D=C3=BCsseldorf, HRB 48022
> Vorstand: =C2=A0 =C2=A0 =C2=A0 =C2=A0 Theodor Niehues (Vorsitzender), Fra=
nk Hartmann,
> =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Kai Markus Kulas,=
 Dieter Plassmann
> Vorsitzender des
> Aufsichtsrates: =C2=A0 Dr. Michael Briem
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20

-

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42989-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 15:53:27 2009
Return-Path: <java-user-return-42989-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61687 invoked from network); 22 Oct 2009 15:53:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 15:53:27 -0000
Received: (qmail 19098 invoked by uid 500); 22 Oct 2009 15:53:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19024 invoked by uid 500); 22 Oct 2009 15:53:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19014 invoked by uid 99); 22 Oct 2009 15:53:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 15:53:25 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 15:53:20 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N0zyF-0006ut-VN
	for java-user@lucene.apache.org; Thu, 22 Oct 2009 08:52:59 -0700
Message-ID: <26012512.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 08:52:59 -0700 (PDT)
From: adviner <eric.advincula@gmail.com>
To: java-user@lucene.apache.org
Subject: How to loop through all the entries for a field
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: eric.advincula@gmail.com


I have a field in called BookTitle.  I want to loop through all the entries
without doing a search.  I just want to get the list of BookTitle's that is
in this field:

I tried IndexReader but MaxDocs() doesnt work because it returns everything
and I have other fields in their which is allot bigger.  


Sorry i originally posted to the developer site which is wrong place so i
moved it here
-- 
View this message in context: http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26012512.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42990-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 17:55:53 2009
Return-Path: <java-user-return-42990-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11621 invoked from network); 22 Oct 2009 17:55:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 17:55:53 -0000
Received: (qmail 14703 invoked by uid 500); 22 Oct 2009 17:55:51 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14646 invoked by uid 500); 22 Oct 2009 17:55:51 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14636 invoked by uid 99); 22 Oct 2009 17:55:51 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 17:55:51 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 17:55:41 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id F221271C952; Thu, 22 Oct 2009 10:55:19 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id ED9F871C8DD
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 10:55:19 -0700 (PDT)
Date: Thu, 22 Oct 2009 10:55:19 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Subject: Re: Maximum index file size
In-Reply-To: <E3137F97B0A0804194F369F4E7C3B71929AE7C85E9@EXCHANGE.persistent.co.in>
Message-ID: <Pine.LNX.4.64.0910221053370.21780@radix.cryptio.net>
References: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
 <E3137F97B0A0804194F369F4E7C3B71929AE7C85E9@EXCHANGE.persistent.co.in>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org

: Subject: Maximum index file size
: References: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
: In-Reply-To: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>


http://people.apache.org/~hossman/#threadhijack
Thread Hijacking on Mailing Lists

When starting a new discussion on a mailing list, please do not reply to 
an existing message, instead start a fresh email.  Even if you change the 
subject line of your email, other mail headers still track which thread 
you replied to and your question is "hidden" in that thread and gets less 
attention.   It makes following discussions in the mailing list archives 
particularly difficult.
See Also:  http://en.wikipedia.org/wiki/Thread_hijacking



-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42991-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 18:01:29 2009
Return-Path: <java-user-return-42991-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14043 invoked from network); 22 Oct 2009 18:01:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 18:01:29 -0000
Received: (qmail 22994 invoked by uid 500); 22 Oct 2009 18:01:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22908 invoked by uid 500); 22 Oct 2009 18:01:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22897 invoked by uid 99); 22 Oct 2009 18:01:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 18:01:27 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 18:01:19 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id DE22A71C8F2; Thu, 22 Oct 2009 11:00:58 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id DC1F871C8F1
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 11:00:58 -0700 (PDT)
Date: Thu, 22 Oct 2009 11:00:58 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: XorReader?
In-Reply-To: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
Message-ID: <Pine.LNX.4.64.0910221058410.21780@radix.cryptio.net>
References: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: I'm thinking a decorator with deletions on top of the original reader, merged
: with the clone reader using a MultiReader. But this would still require a new

you don't really mean a clone do you? ... you should just need a very 
small index containing the new versions of the docs, in a MultiReader with 
another reader that wraps the orriginal but overlays some deleted docs 
metadata.

: So far I haven't done anything but considering wether it's doable or not.

it sounds feasible .. but the real question is how many users you'll be 
dealing with.  if it's a really small number you might be better off just 
haveing one complete index per user, if it's really big then the number of 
indexes you're managing could get problematic.




-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42992-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 19:02:51 2009
Return-Path: <java-user-return-42992-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40795 invoked from network); 22 Oct 2009 19:02:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 19:02:51 -0000
Received: (qmail 6245 invoked by uid 500); 22 Oct 2009 19:02:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 6177 invoked by uid 500); 22 Oct 2009 19:02:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 6167 invoked by uid 99); 22 Oct 2009 19:02:48 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 19:02:48 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.186 as permitted sender)
Received: from [209.85.223.186] (HELO mail-iw0-f186.google.com) (209.85.223.186)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 19:02:46 +0000
Received: by iwn16 with SMTP id 16so4683273iwn.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 12:02:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=h40ZowMTqdB9pvgNwNZOcFMbjs6OjYbLeJQhRk3dhsc=;
        b=F2bR4ixexJbePw6PR+oYIlFnAJXiSKmwSQ4PL4HYfyV4bxzYWxwyfd0uG5WqaWvuvb
         mInoNshIfxkDl1rJHchwxD3gSaq5hlV9Z/nor0pLaqHWJ00DguUYuuIYxndC0dUqmWMI
         QktsT6NCFAF5Rr+D2qVsjtsc65JYH1pY/eWB4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=a4bnzuqWdpKKt2Mm3hBDxlYs2BnPsjtj/bCO8cuEE3XFaPCtH8lL8fgsq+d10jvQOr
         gU1nwIJYvIKbJF5O5wCfXVE5I2x620d7ThgLwmfa2ZQGOzTKdSBQ/nDDZdySsi2lBv3C
         CJ+FvjITMBfxZvuBXYSXkIlXfKiQccbjAAsCI=
MIME-Version: 1.0
Received: by 10.231.1.22 with SMTP id 22mr11046483ibd.56.1256238144552; Thu, 
	22 Oct 2009 12:02:24 -0700 (PDT)
In-Reply-To: <26012512.post@talk.nabble.com>
References: <26012512.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 15:02:24 -0400
Message-ID: <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com>
Subject: Re: How to loop through all the entries for a field
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00151773eaa05c019904768abc36

--00151773eaa05c019904768abc36
Content-Type: text/plain; charset=ISO-8859-1

Try something like
TermEnum te = IndexReader.terms(new Term("BookTitle", ""));
do {
    Term term = te.term();
    if (! term.field().equals("BookTitle")) break;
    System.out.println(term.text());
} while (te.next());


Note that next() will merrily continue beyond the last term for
the field "BookTitle", so you have to check that you're still
where you want to be.


Best
Erick

On Thu, Oct 22, 2009 at 11:52 AM, adviner <eric.advincula@gmail.com> wrote:

>
> I have a field in called BookTitle.  I want to loop through all the entries
> without doing a search.  I just want to get the list of BookTitle's that is
> in this field:
>
> I tried IndexReader but MaxDocs() doesnt work because it returns everything
> and I have other fields in their which is allot bigger.
>
>
> Sorry i originally posted to the developer site which is wrong place so i
> moved it here
> --
> View this message in context:
> http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26012512.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00151773eaa05c019904768abc36--

From java-user-return-42993-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 21:20:56 2009
Return-Path: <java-user-return-42993-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3777 invoked from network); 22 Oct 2009 21:20:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 21:20:55 -0000
Received: (qmail 64756 invoked by uid 500); 22 Oct 2009 21:20:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64693 invoked by uid 500); 22 Oct 2009 21:20:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64683 invoked by uid 99); 22 Oct 2009 21:20:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:20:53 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:20:49 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N155A-0006Ha-FO
	for java-user@lucene.apache.org; Thu, 22 Oct 2009 14:20:28 -0700
Message-ID: <26017418.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 14:20:28 -0700 (PDT)
From: adviner <eric.advincula@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: How to loop through all the entries for a field
In-Reply-To: <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: eric.advincula@gmail.com
References: <26012512.post@talk.nabble.com> <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com>


How do you know if your on your last term?  I tried it and it does work but
continues.  How do you know to check if its the last entry?

Thanks


Erick Erickson wrote:
> 
> Try something like
> TermEnum te = IndexReader.terms(new Term("BookTitle", ""));
> do {
>     Term term = te.term();
>     if (! term.field().equals("BookTitle")) break;
>     System.out.println(term.text());
> } while (te.next());
> 
> 
> Note that next() will merrily continue beyond the last term for
> the field "BookTitle", so you have to check that you're still
> where you want to be.
> 
> 
> Best
> Erick
> 
> On Thu, Oct 22, 2009 at 11:52 AM, adviner <eric.advincula@gmail.com>
> wrote:
> 
>>
>> I have a field in called BookTitle.  I want to loop through all the
>> entries
>> without doing a search.  I just want to get the list of BookTitle's that
>> is
>> in this field:
>>
>> I tried IndexReader but MaxDocs() doesnt work because it returns
>> everything
>> and I have other fields in their which is allot bigger.
>>
>>
>> Sorry i originally posted to the developer site which is wrong place so i
>> moved it here
>> --
>> View this message in context:
>> http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26012512.html
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
> 
> 

-- 
View this message in context: http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26017418.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42994-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 21:25:20 2009
Return-Path: <java-user-return-42994-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6335 invoked from network); 22 Oct 2009 21:25:20 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 21:25:20 -0000
Received: (qmail 76470 invoked by uid 500); 22 Oct 2009 21:25:18 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76411 invoked by uid 500); 22 Oct 2009 21:25:18 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76401 invoked by uid 99); 22 Oct 2009 21:25:18 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:25:18 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:25:15 +0000
Received: by ewy26 with SMTP id 26so8590452ewy.5
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 14:24:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=2mYNlTC3PQeazB2fuvEpArMaTdmXTiR/aLeEBZwKa7Y=;
        b=ICRceDysz/ukqBfb2BbN9owKJAGkKTO4LFgGUoeqmo9r0qt/hrzwdQEa+jXlcSF9oU
         TZUPErE4DtfzTGeTo8YIXdbkm/du5D9sUjZgNDvd+yv5azeQvDFvnd42WqTEecMi9jHv
         tuCZ8vh2ITpOCYM+nsWirACjumBPn4C720b+0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=BQ/RvwBuEdkBK7JktKBU1Tqa6k/bjSYakbp977RBt7blxX7un45YSCpncDlTOV8bEU
         da2NyGLw9RfpoCnwHmpepymXVIcbSwUxhWputmNxDCU4qUNssbYcUJRM0hFCL1Jo+lfr
         HnhiK1/BXiOixbI9ZV/vHpPKkis3zMqjcrphc=
Received: by 10.210.60.19 with SMTP id i19mr5077269eba.61.1256246693932;
        Thu, 22 Oct 2009 14:24:53 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 28sm1457987eyg.6.2009.10.22.14.24.47
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 22 Oct 2009 14:24:53 -0700 (PDT)
Message-Id: <72A0653C-9417-4F35-AB8B-448483BECAC3@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <Pine.LNX.4.64.0910221058410.21780@radix.cryptio.net>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: XorReader?
Date: Thu, 22 Oct 2009 23:24:46 +0200
References: <A7448D0F-4882-4B0E-A9E8-03DC16BD3EB7@gmail.com> <Pine.LNX.4.64.0910221058410.21780@radix.cryptio.net>
X-Mailer: Apple Mail (2.936)


22 okt 2009 kl. 20.00 skrev Chris Hostetter:

>
> : I'm thinking a decorator with deletions on top of the original  
> reader, merged
> : with the clone reader using a MultiReader. But this would still  
> require a new
>
> you don't really mean a clone do you? ... you should just need a very
> small index containing the new versions of the docs, in a  
> MultiReader with
> another reader that wraps the orriginal but overlays some deleted docs
> metadata.

Sorry, bad terminology. What I ment with "clone reader" is the reader  
of an index containing only the "by a user cloned and modified entries  
from the original database".

> : So far I haven't done anything but considering wether it's doable  
> or not.
>
> it sounds feasible .. but the real question is how many users you'll  
> be
> dealing with.  if it's a really small number you might be better off  
> just
> haveing one complete index per user, if it's really big then the  
> number of
> indexes you're managing could get problematic.

Lots of users at the same time. It should at least scale to handle a  
hundred of them at the same time. Cloning the original index and add  
the modifications sounds too expensive, but I might be wrong. I'm as  
worried about the effect it would have on query response time as the  
resources it would consume.

I know to little about the Searcher. What resources am I wasting by  
creating multiple Searchers on the same IndexReader? (Not really the  
same instance of IndexReader, there would be the deleted-decorator and  
the MultiReader too.) Can I expect some sort of latency (except for  
when retrieving data from the "per user index with modifications"- 
reader)? Or is this stuff associated with the IndexReader rather than  
the Searcher?


       karl

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42995-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 21:28:32 2009
Return-Path: <java-user-return-42995-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7275 invoked from network); 22 Oct 2009 21:28:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 21:28:32 -0000
Received: (qmail 84515 invoked by uid 500); 22 Oct 2009 21:28:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84454 invoked by uid 500); 22 Oct 2009 21:28:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84444 invoked by uid 99); 22 Oct 2009 21:28:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:28:29 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:28:20 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N15CR-0006rj-IW
	for java-user@lucene.apache.org; Thu, 22 Oct 2009 14:27:59 -0700
Message-ID: <26017525.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 14:27:59 -0700 (PDT)
From: adviner <eric.advincula@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: How to loop through all the entries for a field
In-Reply-To: <26017418.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: eric.advincula@gmail.com
References: <26012512.post@talk.nabble.com> <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com> <26017418.post@talk.nabble.com>
X-Virus-Checked: Checked by ClamAV on apache.org


nevermind I figured it out.  I did this:

                while ((term = termEnum.Term()) != null)
                {
                    if (!term.Field().Equals("BookTitle"))
                        break;

                    map = new SearchResultMap();
                    map.Title = term.Text();

                    control.Items.Add(map);

                    termEnum.Next();
                }

thanks for all the help

adviner wrote:
> 
> How do you know if your on your last term?  I tried it and it does work
> but continues.  How do you know to check if its the last entry?
> 
> Thanks
> 
> 
> Erick Erickson wrote:
>> 
>> Try something like
>> TermEnum te = IndexReader.terms(new Term("BookTitle", ""));
>> do {
>>     Term term = te.term();
>>     if (! term.field().equals("BookTitle")) break;
>>     System.out.println(term.text());
>> } while (te.next());
>> 
>> 
>> Note that next() will merrily continue beyond the last term for
>> the field "BookTitle", so you have to check that you're still
>> where you want to be.
>> 
>> 
>> Best
>> Erick
>> 
>> On Thu, Oct 22, 2009 at 11:52 AM, adviner <eric.advincula@gmail.com>
>> wrote:
>> 
>>>
>>> I have a field in called BookTitle.  I want to loop through all the
>>> entries
>>> without doing a search.  I just want to get the list of BookTitle's that
>>> is
>>> in this field:
>>>
>>> I tried IndexReader but MaxDocs() doesnt work because it returns
>>> everything
>>> and I have other fields in their which is allot bigger.
>>>
>>>
>>> Sorry i originally posted to the developer site which is wrong place so
>>> i
>>> moved it here
>>> --
>>> View this message in context:
>>> http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26012512.html
>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>> 
>> 
> 
> 

-- 
View this message in context: http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26017525.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42996-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 21:29:31 2009
Return-Path: <java-user-return-42996-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7878 invoked from network); 22 Oct 2009 21:29:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 21:29:31 -0000
Received: (qmail 87241 invoked by uid 500); 22 Oct 2009 21:29:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87151 invoked by uid 500); 22 Oct 2009 21:29:29 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87141 invoked by uid 99); 22 Oct 2009 21:29:29 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:29:29 +0000
X-ASF-Spam-Status: No, hits=3.4 required=10.0
	tests=HTML_MESSAGE,SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:29:17 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 3196AD36008
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 23:28:57 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 6t9G+rK4xkLx for <java-user@lucene.apache.org>;
	Thu, 22 Oct 2009 23:28:46 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 61227D36006
	for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 23:28:46 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <26012512.post@talk.nabble.com> <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com> <26017418.post@talk.nabble.com>
Subject: RE: How to loop through all the entries for a field
Date: Thu, 22 Oct 2009 23:28:47 +0200
Message-ID: <B7C4D4E3819142C3B6629AA66C80803D@VEGA>
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=_NextPart_000_0000_01CA536F.67AFCC10"
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <26017418.post@talk.nabble.com>
Thread-Index: AcpTXZRifbPz4LrTQSupqzXg63nxxAAAKzrg
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

------=_NextPart_000_0000_01CA536F.67AFCC10
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

Use this one:

 

String fieldname="BookTitle";

 

fieldname = fieldname.intern(); // because of this we need no
String.equals()

TermEnum te = IndexReader.terms(new Term(fieldname, ""));

do {

      Term term = te.term();

      if (term == null || term.field() != fieldname) break;

      System.out.println(term.text());

} while (te.next());

te.close();

 

-----

Uwe Schindler

H.-H.-Meier-Allee 63, D-28213 Bremen

http://www.thetaphi.de

eMail: uwe@thetaphi.de

 

> -----Original Message-----

> From: adviner [mailto:eric.advincula@gmail.com]

> Sent: Thursday, October 22, 2009 11:20 PM

> To: java-user@lucene.apache.org

> Subject: Re: How to loop through all the entries for a field

> 

> 

> How do you know if your on your last term?  I tried it and it does work

> but

> continues.  How do you know to check if its the last entry?

> 

> Thanks

> 

> 

> Erick Erickson wrote:

> >

> > Try something like

> > TermEnum te = IndexReader.terms(new Term("BookTitle", ""));

> > do {

> >     Term term = te.term();

> >     if (! term.field().equals("BookTitle")) break;

> >     System.out.println(term.text());

> > } while (te.next());

> >

> >

> > Note that next() will merrily continue beyond the last term for

> > the field "BookTitle", so you have to check that you're still

> > where you want to be.

> >

> >

> > Best

> > Erick

> >

> > On Thu, Oct 22, 2009 at 11:52 AM, adviner <eric.advincula@gmail.com>

> > wrote:

> >

> >>

> >> I have a field in called BookTitle.  I want to loop through all the

> >> entries

> >> without doing a search.  I just want to get the list of BookTitle's

> that

> >> is

> >> in this field:

> >>

> >> I tried IndexReader but MaxDocs() doesnt work because it returns

> >> everything

> >> and I have other fields in their which is allot bigger.

> >>

> >>

> >> Sorry i originally posted to the developer site which is wrong place so

> i

> >> moved it here

> >> --

> >> View this message in context:

> >> http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-

> tp26012512p26012512.html

> >> Sent from the Lucene - Java Users mailing list archive at Nabble.com.

> >>

> >>

> >> ---------------------------------------------------------------------

> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org

> >> For additional commands, e-mail: java-user-help@lucene.apache.org

> >>

> >>

> >

> >

> 

> --

> View this message in context: http://www.nabble.com/How-to-loop-through-

> all-the-entries-for-a-field-tp26012512p26017418.html

> Sent from the Lucene - Java Users mailing list archive at Nabble.com.

> 

> 

> ---------------------------------------------------------------------

> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org

> For additional commands, e-mail: java-user-help@lucene.apache.org

 


------=_NextPart_000_0000_01CA536F.67AFCC10--


From java-user-return-42997-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 21:33:10 2009
Return-Path: <java-user-return-42997-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10103 invoked from network); 22 Oct 2009 21:33:10 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 21:33:10 -0000
Received: (qmail 92072 invoked by uid 500); 22 Oct 2009 21:33:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91992 invoked by uid 500); 22 Oct 2009 21:33:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91981 invoked by uid 99); 22 Oct 2009 21:33:07 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:33:07 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:32:57 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N15Gu-0007Bb-FW
	for java-user@lucene.apache.org; Thu, 22 Oct 2009 14:32:36 -0700
Message-ID: <26017581.post@talk.nabble.com>
Date: Thu, 22 Oct 2009 14:32:36 -0700 (PDT)
From: adviner <eric.advincula@gmail.com>
To: java-user@lucene.apache.org
Subject: RE: How to loop through all the entries for a field
In-Reply-To: <B7C4D4E3819142C3B6629AA66C80803D@VEGA>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: eric.advincula@gmail.com
References: <26012512.post@talk.nabble.com> <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com> <26017418.post@talk.nabble.com> <B7C4D4E3819142C3B6629AA66C80803D@VEGA>
X-Virus-Checked: Checked by ClamAV on apache.org


Thank you


Uwe Schindler wrote:
> 
> Use this one:
> 
>  
> 
> String fieldname="BookTitle";
> 
>  
> 
> fieldname = fieldname.intern(); // because of this we need no
> String.equals()
> 
> TermEnum te = IndexReader.terms(new Term(fieldname, ""));
> 
> do {
> 
>       Term term = te.term();
> 
>       if (term == null || term.field() != fieldname) break;
> 
>       System.out.println(term.text());
> 
> } while (te.next());
> 
> te.close();
> 
>  
> 
> -----
> 
> Uwe Schindler
> 
> H.-H.-Meier-Allee 63, D-28213 Bremen
> 
> http://www.thetaphi.de
> 
> eMail: uwe@thetaphi.de
> 
>  
> 
>> -----Original Message-----
> 
>> From: adviner [mailto:eric.advincula@gmail.com]
> 
>> Sent: Thursday, October 22, 2009 11:20 PM
> 
>> To: java-user@lucene.apache.org
> 
>> Subject: Re: How to loop through all the entries for a field
> 
>> 
> 
>> 
> 
>> How do you know if your on your last term?  I tried it and it does work
> 
>> but
> 
>> continues.  How do you know to check if its the last entry?
> 
>> 
> 
>> Thanks
> 
>> 
> 
>> 
> 
>> Erick Erickson wrote:
> 
>> >
> 
>> > Try something like
> 
>> > TermEnum te = IndexReader.terms(new Term("BookTitle", ""));
> 
>> > do {
> 
>> >     Term term = te.term();
> 
>> >     if (! term.field().equals("BookTitle")) break;
> 
>> >     System.out.println(term.text());
> 
>> > } while (te.next());
> 
>> >
> 
>> >
> 
>> > Note that next() will merrily continue beyond the last term for
> 
>> > the field "BookTitle", so you have to check that you're still
> 
>> > where you want to be.
> 
>> >
> 
>> >
> 
>> > Best
> 
>> > Erick
> 
>> >
> 
>> > On Thu, Oct 22, 2009 at 11:52 AM, adviner <eric.advincula@gmail.com>
> 
>> > wrote:
> 
>> >
> 
>> >>
> 
>> >> I have a field in called BookTitle.  I want to loop through all the
> 
>> >> entries
> 
>> >> without doing a search.  I just want to get the list of BookTitle's
> 
>> that
> 
>> >> is
> 
>> >> in this field:
> 
>> >>
> 
>> >> I tried IndexReader but MaxDocs() doesnt work because it returns
> 
>> >> everything
> 
>> >> and I have other fields in their which is allot bigger.
> 
>> >>
> 
>> >>
> 
>> >> Sorry i originally posted to the developer site which is wrong place
>> so
> 
>> i
> 
>> >> moved it here
> 
>> >> --
> 
>> >> View this message in context:
> 
>> >> http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-
> 
>> tp26012512p26012512.html
> 
>> >> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> 
>> >>
> 
>> >>
> 
>> >> ---------------------------------------------------------------------
> 
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> 
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
>> >>
> 
>> >>
> 
>> >
> 
>> >
> 
>> 
> 
>> --
> 
>> View this message in context: http://www.nabble.com/How-to-loop-through-
> 
>> all-the-entries-for-a-field-tp26012512p26017418.html
> 
>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
> 
>> 
> 
>> 
> 
>> ---------------------------------------------------------------------
> 
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> 
>> For additional commands, e-mail: java-user-help@lucene.apache.org
> 
>  
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-tp26012512p26017581.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-42998-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 21:56:58 2009
Return-Path: <java-user-return-42998-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 16566 invoked from network); 22 Oct 2009 21:56:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 21:56:58 -0000
Received: (qmail 28035 invoked by uid 500); 22 Oct 2009 21:56:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27968 invoked by uid 500); 22 Oct 2009 21:56:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27958 invoked by uid 99); 22 Oct 2009 21:56:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:56:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of java8964@hotmail.com designates 65.55.111.104 as permitted sender)
Received: from [65.55.111.104] (HELO blu0-omc2-s29.blu0.hotmail.com) (65.55.111.104)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 21:56:45 +0000
Received: from BLU140-W22 ([65.55.111.72]) by blu0-omc2-s29.blu0.hotmail.com with Microsoft SMTPSVC(6.0.3790.3959);
	 Thu, 22 Oct 2009 14:56:24 -0700
Message-ID: <BLU140-W22F12E1C9AC650580E9852D0BE0@phx.gbl>
Content-Type: multipart/alternative;
	boundary="_3f0e6f02-011c-454f-8cbc-19445b4cdbbb_"
X-Originating-IP: [192.100.104.17]
From: java8964 java8964 <java8964@hotmail.com>
To: <java-user@lucene.apache.org>
Subject: Question about the extends the query parser to support NumericField
 on Lucene 2.9.0
Date: Thu, 22 Oct 2009 17:56:24 -0400
Importance: Normal
MIME-Version: 1.0
X-OriginalArrivalTime: 22 Oct 2009 21:56:24.0315 (UTC) FILETIME=[7F6BC4B0:01CA5362]
X-Virus-Checked: Checked by ClamAV on apache.org

--_3f0e6f02-011c-454f-8cbc-19445b4cdbbb_
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


Hi=2C  I have a problem to work support the NumericField in query parser.

My environment is like this:

Windows XP with=20
C:\work\> java -version
java version "1.6.0_10"
Java(TM) SE Runtime Environment (build 1.6.0_10-b33)
Java HotSpot(TM) Client VM (build 11.0-b15=2C mixed mode=2C sharing)

I am using the lucene 2.9.0 releases.

I write my query parser class to support this numeric field=2C here is copy=
 of the override methods:

    /**
     * Create a new range query of query parser.
     *=20
     * If the filed is a numeric field=2C return NumericRangeQuery=3B
     * otherwise=2C let super class handle it
     *=20
     * @param fieldName The file name
     * @param part1 The lower bound
     * @param part2 The high bound
     * @throws IllegalArgumentExceptoin if the field type is not supported
     * @throws NumberFormatException if the query data does not match with =
the field type
     */
    @Override
    protected Query newRangeQuery(String fieldName=2C String part1=2C Strin=
g part2=2C boolean inclusive)
    {
        fieldName =3D fieldName.toLowerCase()=3B
        if (LogUtil.getInstance().isDebugEnabled(DcQueryParser.class))
        {
            LogUtil.getInstance().debug(DcQueryParser.class=2C
                    "Create a new range query for: " + fieldName)=3B
        }

        mFieldNames.add(fieldName)=3B
        IFieldDefinition fieldDef =3D mIndexDef.getFieldDefinition(fieldNam=
e)=3B
        if (part1.trim().startsWith("+"))
        {
            part1 =3D part1.substring(1)=3B
        }
        if (part2.trim().startsWith("+"))
        {
            part2 =3D part2.substring(1)=3B
        }
        if (fieldDef !=3D null && fieldDef.isNumericField())
        {
            if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldType.I=
NT)
            {
                return NumericRangeQuery.newIntRange(fieldDef.getName()=2C =
Integer.parseInt(part1)=2C Integer.parseInt(part2)=2C inclusive=2C inclusiv=
e)=3B
            }=20
            else if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldT=
ype.LONG)
            {
                  return NumericRangeQuery.newLongRange(fieldDef.getName()=
=2C Long.parseLong(part1)=2C Long.parseLong(part2)=2C inclusive=2C inclusiv=
e)=3B
            }
            else if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldT=
ype.FLOAT)
            {
                   return NumericRangeQuery.newFloatRange(fieldDef.getName(=
)=2C Float.parseFloat(part1)=2C Float.parseFloat(part2)=2C inclusive=2C inc=
lusive)=3B
            }
            else if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldT=
ype.DOUBLE)
            {
                   return NumericRangeQuery.newDoubleRange(fieldDef.getName=
()=2C Double.parseDouble(part1)=2C Double.parseDouble(part2)=2C inclusive=
=2C inclusive)=3B
            }
            else
            {
                throw new IllegalArgumentException("Unsupported new Numeric=
 field type=2C as the type is: " + fieldDef.getFieldType().name())=3B
            }
        }
        else
        {
            return super.newRangeQuery(fieldName=2C part1=2C part2=2C inclu=
sive)=3B
        }
    }
   =20
    /**
     * Create a new term query of query parser.
     * If the filed is a numeric field=2C use xxxPrefixCoded
     * otherwise=2C let super class handle it
     *=20
     * @param term The term object
     * @return The query object
     * @throws IllegalArgumentExceptoin if the field type is not supported
     * @throws NumberFormatException if the query data does not match with =
the field type
     */
    @Override
    protected Query newTermQuery(Term term)
    {
        System.out.println("......................1")=3B
        String fieldName =3D term.field()=3B
        if (LogUtil.getInstance().isDebugEnabled(DcQueryParser.class))
        {
            LogUtil.getInstance().debug(DcQueryParser.class=2C
                    "Create a new term query for: " + fieldName)=3B
        }

        mFieldNames.add(fieldName)=3B
        IFieldDefinition fieldDef =3D mIndexDef.getFieldDefinition(fieldNam=
e)=3B
        if (fieldDef !=3D null && fieldDef.isNumericField())
        {
            System.out.println("......................2")=3B
            String queryString =3D term.text().trim()=3B
            if (queryString.startsWith("+"))
            {
                queryString.substring(1)=3B
            }
            if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldType.I=
NT)
            {
                return new TermQuery(new Term(term.field()=2C    NumericUti=
ls.intToPrefixCoded(Integer.parseInt(queryString))))=3B
            }=20
            else if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldT=
ype.LONG)
            {
                return new TermQuery(new Term(term.field()=2C    NumericUti=
ls.longToPrefixCoded(Long.parseLong(queryString))))=3B
            }
            else if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldT=
ype.FLOAT)
            {
                   return new TermQuery(new Term(term.field()=2C    Numeric=
Utils.floatToPrefixCoded(Float.parseFloat(queryString))))=3B
            }
            else if (fieldDef.getFieldType() =3D=3D IFieldDefinition.FieldT=
ype.DOUBLE)
            {
                   return new TermQuery(new Term(term.field()=2C    Numeric=
Utils.doubleToPrefixCoded(Double.parseDouble(queryString))))=3B
            }
            else
            {
                throw new IllegalArgumentException("Unsupported new Numeric=
 field type=2C as the type is: " + fieldDef.getFieldType().name())=3B
            }
        }
        else
        {
            return super.newTermQuery(term)=3B
        }
    }

For my case=2C range query works as expected. The problem I met now is for =
the Field query.

Here is my unit test:

I indexed one line data as following:
operation=2Cuser_id=2Ccity=2Cprovince=2Ccountry=2Cage=2Cisbn=2Ctitle=2Cauth=
or=2Cpub_year=2Cpub_name=2Crating
A=2C56=2Ccheyenne=2Cwyoming=2Cusa=2C-32=2C671623249=2CLONESOME DOVE=2CLarry=
 McMurtry=2C1986=2CPocket=2C7.0

To make my case simple=2C I only set the age as type int.
Right before I add the field into the document=2C I have to following state=
ment to check as the output:

            if (fieldDef.isNumericField())
            {
                System.out.println("Add the numeric field for name: " + fie=
ldDef.getName() + " and value is " + docFieldValue)=3B
                NumericField numField =3D new NumericField(fieldDef.getName=
()=2C Field.Store.YES=2C true)=3B
                numField.setLongValue(Long.parseLong(docFieldValue))=3B
                doc.add(numField)=3B
            }

which output the following message in my console:
------------------->  Add the numeric field for name: age and value is -32

which proves that I add one numeric field object into the document=2C the n=
ame is 'age'=2C and the value is '-32'.

here is my junit test case:
        IndexSearcher searcher =3D new IndexSearcher(new SimpleFSDirectory(=
indexDir)=2C true)=3B
        MyQueryParser queryParser =3D new MyQueryParser("age"=2C defaultAna=
lyzer)=3B --The default analyzer is the stand analyzer in this case.
        TopDocs docs =3D searcher.search(queryParser.parse("age:-32")=2C 10=
)=3B
        Assert.assertTrue(docs.totalHits =3D=3D 1)=3B

I expect it will pass=2C but it gives me back the following error message:

    [junit] Testcase: testBuildIndex took 9.516 sec
    [junit]     Caused an ERROR
    [junit] Cannot parse 'age:-32': Encountered " "-" "- "" at line 1=2C co=
lumn 4.
    [junit] Was expecting one of:
    [junit]     "(" ...
    [junit]     "*" ...
    [junit]     <QUOTED> ...
    [junit]     <TERM> ...
    [junit]     <PREFIXTERM> ...
    [junit]     <WILDTERM> ...
    [junit]     "[" ...
    [junit]     "{" ...
    [junit]     <NUMBER> ...
    [junit]
    [junit] org.apache.lucene.queryParser.ParseException: Cannot parse 'age=
:-32': Encountered " "-" "- "" at line 1=2C column 4.
    [junit] Was expecting one of:
    [junit]     "(" ...
    [junit]     "*" ...
    [junit]     <QUOTED> ...
    [junit]     <TERM> ...
    [junit]     <PREFIXTERM> ...
    [junit]     <WILDTERM> ...
    [junit]     "[" ...
    [junit]     "{" ...
    [junit]     <NUMBER> ...
    [junit]
    [junit]     at org.apache.lucene.queryParser.QueryParser.parse(QueryPar=
ser.java:181)
    [junit]     at nokia.dc.server.build.index.IndexBuilderTest.testBuildIn=
dex(IndexBuilderTest.java:236)
    [junit] Caused by: org.apache.lucene.queryParser.ParseException: Encoun=
tered " "-" "- "" at line 1=2C column 4.
    [junit] Was expecting one of:
    [junit]     "(" ...
    [junit]     "*" ...
    [junit]     <QUOTED> ...
    [junit]     <TERM> ...
    [junit]     <PREFIXTERM> ...
    [junit]     <WILDTERM> ...
    [junit]     "[" ...
    [junit]     "{" ...
    [junit]     <NUMBER> ...
    [junit]
    [junit]     at org.apache.lucene.queryParser.QueryParser.generateParseE=
xception(QueryParser.java:1822)
    [junit]     at org.apache.lucene.queryParser.QueryParser.jj_consume_tok=
en(QueryParser.java:1704)
    [junit]     at org.apache.lucene.queryParser.QueryParser.Clause(QueryPa=
rser.java:1331)
    [junit]     at org.apache.lucene.queryParser.QueryParser.Query(QueryPar=
ser.java:1241)
    [junit]     at org.apache.lucene.queryParser.QueryParser.TopLevelQuery(=
QueryParser.java:1230)
    [junit]     at org.apache.lucene.queryParser.QueryParser.parse(QueryPar=
ser.java:176)

My question is about to support the FieldQuery in this case. As I said=2C t=
he RangeQuery works as I expect.

The question is:

1) The above prove that I set the field name to 'age'=2C which matched the =
query field name I put in the query parser. Why I got the above error?
2) I override the newTermQuery method. I am thinking that it sould be invok=
ed in this case. As you can see=2C I system.out a line in the first stateme=
nt. But before the above error show up=2C I didn't see that line output=2C =
which menas the execution is not reach to newTermQuery method when the erro=
r happened.
3) I did as above is I saw a few days ago=2C there is a discussion about th=
e same topic. So I just basically copy the idea from "Uwe Schindler" code.=
=20
My more general question is that when should we override the newXXX method(=
)=2C or when should we override getXXXX method? What is the difference betw=
een them?
4) As you can see my above example=2C we want to support the query string f=
or numerice field with '+' in it. Even java won't support it and throw Numb=
erFormat Exception=2C but my case need to support it. So I will remove it f=
rom the query string and then send to the super class. I would like to know=
 it won't cause ParseException before it reaches my override methods.
5) As these numeric field features=2C The query parser class methods did NO=
T throw ParserException in the method signature. But if I want to catch Num=
berFormatException=2C then rethrow ParserException=2C so my client only nee=
d to worry the ParseException. But the ParseException is a regular exceptio=
n=2C and I can NOT add it into the override method signture. Any work aroun=
d?

Thanks for your kind help.



 		 	   		 =20
_________________________________________________________________
Windows 7: It helps you do more. Explore Windows 7.
http://www.microsoft.com/Windows/windows-7/default.aspx?ocid=3DPID24727::T:=
WLMTAGL:ON:WL:en-US:WWL_WIN_evergreen3:102009=

--_3f0e6f02-011c-454f-8cbc-19445b4cdbbb_--

From java-user-return-42999-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 22:11:06 2009
Return-Path: <java-user-return-42999-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19922 invoked from network); 22 Oct 2009 22:11:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 22:11:06 -0000
Received: (qmail 47215 invoked by uid 500); 22 Oct 2009 22:11:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47132 invoked by uid 500); 22 Oct 2009 22:11:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47122 invoked by uid 99); 22 Oct 2009 22:11:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 22:11:03 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 22:10:53 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id A6A5CD36008
	for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 00:10:33 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id EUJz-bQm5dsa for <java-user@lucene.apache.org>;
	Fri, 23 Oct 2009 00:10:23 +0200 (CEST)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 494B1D36006
	for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 00:10:23 +0200 (CEST)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <BLU140-W22F12E1C9AC650580E9852D0BE0@phx.gbl>
Subject: RE: Question about the extends the query parser to support NumericField on Lucene 2.9.0
Date: Fri, 23 Oct 2009 00:10:24 +0200
Message-ID: <0942717AA3F14C8AA0B2D8DC996B8DD5@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
Thread-Index: AcpTYphESFT+GhGyRxipWQNKTDIxqQAASjgQ
In-Reply-To: <BLU140-W22F12E1C9AC650580E9852D0BE0@phx.gbl>
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

If you look into the testcase I provided with my QueryParser example, you
will see, that the negative numbers have a problem in newTermQuery.

"-" is a control character in QueryParser, which means to do a "NOT" on this
term. Because of this the syntax of the query is wrong. To hit the negative
number there is no way around putting the number in quotes: age:"-32":

http://www.lucidimagination.com/search/document/ef7a9dc1444c9d28/how_do_you_
properly_use_numericfield#de054d728e252174

Sorry, I see no other solution without changing the query parser JavaCC
syntax. Maybe the new Contrib QueryParser will handle this better in future
(there is an open issue about that).

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: java8964 java8964 [mailto:java8964@hotmail.com]
> Sent: Thursday, October 22, 2009 11:56 PM
> To: java-user@lucene.apache.org
> Subject: Question about the extends the query parser to support
> NumericField on Lucene 2.9.0
> 
> 
> Hi,  I have a problem to work support the NumericField in query parser.
> 
> My environment is like this:
> 
> Windows XP with
> C:\work\> java -version
> java version "1.6.0_10"
> Java(TM) SE Runtime Environment (build 1.6.0_10-b33)
> Java HotSpot(TM) Client VM (build 11.0-b15, mixed mode, sharing)
> 
> I am using the lucene 2.9.0 releases.
> 
> I write my query parser class to support this numeric field, here is copy
> of the override methods:
> 
>     /**
>      * Create a new range query of query parser.
>      *
>      * If the filed is a numeric field, return NumericRangeQuery;
>      * otherwise, let super class handle it
>      *
>      * @param fieldName The file name
>      * @param part1 The lower bound
>      * @param part2 The high bound
>      * @throws IllegalArgumentExceptoin if the field type is not supported
>      * @throws NumberFormatException if the query data does not match with
> the field type
>      */
>     @Override
>     protected Query newRangeQuery(String fieldName, String part1, String
> part2, boolean inclusive)
>     {
>         fieldName = fieldName.toLowerCase();
>         if (LogUtil.getInstance().isDebugEnabled(DcQueryParser.class))
>         {
>             LogUtil.getInstance().debug(DcQueryParser.class,
>                     "Create a new range query for: " + fieldName);
>         }
> 
>         mFieldNames.add(fieldName);
>         IFieldDefinition fieldDef =
> mIndexDef.getFieldDefinition(fieldName);
>         if (part1.trim().startsWith("+"))
>         {
>             part1 = part1.substring(1);
>         }
>         if (part2.trim().startsWith("+"))
>         {
>             part2 = part2.substring(1);
>         }
>         if (fieldDef != null && fieldDef.isNumericField())
>         {
>             if (fieldDef.getFieldType() == IFieldDefinition.FieldType.INT)
>             {
>                 return NumericRangeQuery.newIntRange(fieldDef.getName(),
> Integer.parseInt(part1), Integer.parseInt(part2), inclusive, inclusive);
>             }
>             else if (fieldDef.getFieldType() ==
> IFieldDefinition.FieldType.LONG)
>             {
>                   return
> NumericRangeQuery.newLongRange(fieldDef.getName(), Long.parseLong(part1),
> Long.parseLong(part2), inclusive, inclusive);
>             }
>             else if (fieldDef.getFieldType() ==
> IFieldDefinition.FieldType.FLOAT)
>             {
>                    return
> NumericRangeQuery.newFloatRange(fieldDef.getName(),
> Float.parseFloat(part1), Float.parseFloat(part2), inclusive, inclusive);
>             }
>             else if (fieldDef.getFieldType() ==
> IFieldDefinition.FieldType.DOUBLE)
>             {
>                    return
> NumericRangeQuery.newDoubleRange(fieldDef.getName(),
> Double.parseDouble(part1), Double.parseDouble(part2), inclusive,
> inclusive);
>             }
>             else
>             {
>                 throw new IllegalArgumentException("Unsupported new
> Numeric field type, as the type is: " + fieldDef.getFieldType().name());
>             }
>         }
>         else
>         {
>             return super.newRangeQuery(fieldName, part1, part2,
> inclusive);
>         }
>     }
> 
>     /**
>      * Create a new term query of query parser.
>      * If the filed is a numeric field, use xxxPrefixCoded
>      * otherwise, let super class handle it
>      *
>      * @param term The term object
>      * @return The query object
>      * @throws IllegalArgumentExceptoin if the field type is not supported
>      * @throws NumberFormatException if the query data does not match with
> the field type
>      */
>     @Override
>     protected Query newTermQuery(Term term)
>     {
>         System.out.println("......................1");
>         String fieldName = term.field();
>         if (LogUtil.getInstance().isDebugEnabled(DcQueryParser.class))
>         {
>             LogUtil.getInstance().debug(DcQueryParser.class,
>                     "Create a new term query for: " + fieldName);
>         }
> 
>         mFieldNames.add(fieldName);
>         IFieldDefinition fieldDef =
> mIndexDef.getFieldDefinition(fieldName);
>         if (fieldDef != null && fieldDef.isNumericField())
>         {
>             System.out.println("......................2");
>             String queryString = term.text().trim();
>             if (queryString.startsWith("+"))
>             {
>                 queryString.substring(1);
>             }
>             if (fieldDef.getFieldType() == IFieldDefinition.FieldType.INT)
>             {
>                 return new TermQuery(new Term(term.field(),
> NumericUtils.intToPrefixCoded(Integer.parseInt(queryString))));
>             }
>             else if (fieldDef.getFieldType() ==
> IFieldDefinition.FieldType.LONG)
>             {
>                 return new TermQuery(new Term(term.field(),
> NumericUtils.longToPrefixCoded(Long.parseLong(queryString))));
>             }
>             else if (fieldDef.getFieldType() ==
> IFieldDefinition.FieldType.FLOAT)
>             {
>                    return new TermQuery(new Term(term.field(),
> NumericUtils.floatToPrefixCoded(Float.parseFloat(queryString))));
>             }
>             else if (fieldDef.getFieldType() ==
> IFieldDefinition.FieldType.DOUBLE)
>             {
>                    return new TermQuery(new Term(term.field(),
> NumericUtils.doubleToPrefixCoded(Double.parseDouble(queryString))));
>             }
>             else
>             {
>                 throw new IllegalArgumentException("Unsupported new
> Numeric field type, as the type is: " + fieldDef.getFieldType().name());
>             }
>         }
>         else
>         {
>             return super.newTermQuery(term);
>         }
>     }
> 
> For my case, range query works as expected. The problem I met now is for
> the Field query.
> 
> Here is my unit test:
> 
> I indexed one line data as following:
> operation,user_id,city,province,country,age,isbn,title,author,pub_year,pub
> _name,rating
> A,56,cheyenne,wyoming,usa,-32,671623249,LONESOME DOVE,Larry
> McMurtry,1986,Pocket,7.0
> 
> To make my case simple, I only set the age as type int.
> Right before I add the field into the document, I have to following
> statement to check as the output:
> 
>             if (fieldDef.isNumericField())
>             {
>                 System.out.println("Add the numeric field for name: " +
> fieldDef.getName() + " and value is " + docFieldValue);
>                 NumericField numField = new
> NumericField(fieldDef.getName(), Field.Store.YES, true);
>                 numField.setLongValue(Long.parseLong(docFieldValue));
>                 doc.add(numField);
>             }
> 
> which output the following message in my console:
> ------------------->  Add the numeric field for name: age and value is -32
> 
> which proves that I add one numeric field object into the document, the
> name is 'age', and the value is '-32'.
> 
> here is my junit test case:
>         IndexSearcher searcher = new IndexSearcher(new
> SimpleFSDirectory(indexDir), true);
>         MyQueryParser queryParser = new MyQueryParser("age",
> defaultAnalyzer); --The default analyzer is the stand analyzer in this
> case.
>         TopDocs docs = searcher.search(queryParser.parse("age:-32"), 10);
>         Assert.assertTrue(docs.totalHits == 1);
> 
> I expect it will pass, but it gives me back the following error message:
> 
>     [junit] Testcase: testBuildIndex took 9.516 sec
>     [junit]     Caused an ERROR
>     [junit] Cannot parse 'age:-32': Encountered " "-" "- "" at line 1,
> column 4.
>     [junit] Was expecting one of:
>     [junit]     "(" ...
>     [junit]     "*" ...
>     [junit]     <QUOTED> ...
>     [junit]     <TERM> ...
>     [junit]     <PREFIXTERM> ...
>     [junit]     <WILDTERM> ...
>     [junit]     "[" ...
>     [junit]     "{" ...
>     [junit]     <NUMBER> ...
>     [junit]
>     [junit] org.apache.lucene.queryParser.ParseException: Cannot parse
> 'age:-32': Encountered " "-" "- "" at line 1, column 4.
>     [junit] Was expecting one of:
>     [junit]     "(" ...
>     [junit]     "*" ...
>     [junit]     <QUOTED> ...
>     [junit]     <TERM> ...
>     [junit]     <PREFIXTERM> ...
>     [junit]     <WILDTERM> ...
>     [junit]     "[" ...
>     [junit]     "{" ...
>     [junit]     <NUMBER> ...
>     [junit]
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:181)
>     [junit]     at
> nokia.dc.server.build.index.IndexBuilderTest.testBuildIndex(IndexBuilderTe
> st.java:236)
>     [junit] Caused by: org.apache.lucene.queryParser.ParseException:
> Encountered " "-" "- "" at line 1, column 4.
>     [junit] Was expecting one of:
>     [junit]     "(" ...
>     [junit]     "*" ...
>     [junit]     <QUOTED> ...
>     [junit]     <TERM> ...
>     [junit]     <PREFIXTERM> ...
>     [junit]     <WILDTERM> ...
>     [junit]     "[" ...
>     [junit]     "{" ...
>     [junit]     <NUMBER> ...
>     [junit]
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.generateParseException(QueryPars
> er.java:1822)
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.jj_consume_token(QueryParser.jav
> a:1704)
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.Clause(QueryParser.java:1331)
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.Query(QueryParser.java:1241)
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.TopLevelQuery(QueryParser.java:1
> 230)
>     [junit]     at
> org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:176)
> 
> My question is about to support the FieldQuery in this case. As I said,
> the RangeQuery works as I expect.
> 
> The question is:
> 
> 1) The above prove that I set the field name to 'age', which matched the
> query field name I put in the query parser. Why I got the above error?
> 2) I override the newTermQuery method. I am thinking that it sould be
> invoked in this case. As you can see, I system.out a line in the first
> statement. But before the above error show up, I didn't see that line
> output, which menas the execution is not reach to newTermQuery method when
> the error happened.
> 3) I did as above is I saw a few days ago, there is a discussion about the
> same topic. So I just basically copy the idea from "Uwe Schindler" code.
> My more general question is that when should we override the newXXX
> method(), or when should we override getXXXX method? What is the
> difference between them?
> 4) As you can see my above example, we want to support the query string
> for numerice field with '+' in it. Even java won't support it and throw
> NumberFormat Exception, but my case need to support it. So I will remove
> it from the query string and then send to the super class. I would like to
> know it won't cause ParseException before it reaches my override methods.
> 5) As these numeric field features, The query parser class methods did NOT
> throw ParserException in the method signature. But if I want to catch
> NumberFormatException, then rethrow ParserException, so my client only
> need to worry the ParseException. But the ParseException is a regular
> exception, and I can NOT add it into the override method signture. Any
> work around?
> 
> Thanks for your kind help.
> 
> 
> 
> 
> _________________________________________________________________
> Windows 7: It helps you do more. Explore Windows 7.
> http://www.microsoft.com/Windows/windows-
> 7/default.aspx?ocid=PID24727::T:WLMTAGL:ON:WL:en-
> US:WWL_WIN_evergreen3:102009


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43000-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 22:43:45 2009
Return-Path: <java-user-return-43000-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30044 invoked from network); 22 Oct 2009 22:43:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 22:43:45 -0000
Received: (qmail 83049 invoked by uid 500); 22 Oct 2009 22:43:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82960 invoked by uid 500); 22 Oct 2009 22:43:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82950 invoked by uid 99); 22 Oct 2009 22:43:43 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 22:43:43 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of markrmiller@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 22:43:39 +0000
Received: by ewy26 with SMTP id 26so8652461ewy.5
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 15:43:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=neuHwOkyYq5WiQSlx3YtyILRPYg/dQjAnyt37IKe1O4=;
        b=aau1UB1qSKGMds+fYSGFuxXdOU8b54SpVGLip3pnZy+e+ahNn7Z56Lgo1d1+7joEB+
         qVxWv3Si3RcLbR+WkO+i6pwmsrEL68GP4Yb9bHhMVob+EilnmEMkZJC1gwu/An3c7a0z
         YMWBiY9BuPLVCmZE3ydmD/10WV9GQGQNXwTnw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=FcEIUU4i/v9TScr/HNMlfiu/Rbt3q7ubIh/xTRZJQoZF3JoIMJ9g31yBi/T/4L0xsg
         mEQZdhgecKahJHBqTu5CVfYwJjpc6n6g9rrGe9gZa6bUUjITXrOCAMQ+7VugJ2teo8d+
         jcd2IyOKZMhP2P8xqZDgaSKslh+XXaPZbZBbk=
Received: by 10.216.89.138 with SMTP id c10mr3661437wef.47.1256251397443;
        Thu, 22 Oct 2009 15:43:17 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id q9sm4004746gve.15.2009.10.22.15.43.15
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 22 Oct 2009 15:43:16 -0700 (PDT)
Message-ID: <4AE0E003.3070204@gmail.com>
Date: Thu, 22 Oct 2009 18:43:15 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: How to loop through all the entries for a field
References: <26012512.post@talk.nabble.com> <359a92830910221202h4fe030efrdabc3d469659067c@mail.gmail.com> <26017418.post@talk.nabble.com> <B7C4D4E3819142C3B6629AA66C80803D@VEGA> <26017581.post@talk.nabble.com>
In-Reply-To: <26017581.post@talk.nabble.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

But with Lucene 2.9 you would want to use StringHelper.intern right?

adviner wrote:
> Thank you
>
>
> Uwe Schindler wrote:
>   
>> Use this one:
>>
>>  
>>
>> String fieldname="BookTitle";
>>
>>  
>>
>> fieldname = fieldname.intern(); // because of this we need no
>> String.equals()
>>
>> TermEnum te = IndexReader.terms(new Term(fieldname, ""));
>>
>> do {
>>
>>       Term term = te.term();
>>
>>       if (term == null || term.field() != fieldname) break;
>>
>>       System.out.println(term.text());
>>
>> } while (te.next());
>>
>> te.close();
>>
>>  
>>
>> -----
>>
>> Uwe Schindler
>>
>> H.-H.-Meier-Allee 63, D-28213 Bremen
>>
>> http://www.thetaphi.de
>>
>> eMail: uwe@thetaphi.de
>>
>>  
>>
>>     
>>> -----Original Message-----
>>>       
>>> From: adviner [mailto:eric.advincula@gmail.com]
>>>       
>>> Sent: Thursday, October 22, 2009 11:20 PM
>>>       
>>> To: java-user@lucene.apache.org
>>>       
>>> Subject: Re: How to loop through all the entries for a field
>>>       
>>> How do you know if your on your last term?  I tried it and it does work
>>>       
>>> but
>>>       
>>> continues.  How do you know to check if its the last entry?
>>>       
>>> Thanks
>>>       
>>> Erick Erickson wrote:
>>>       
>>>> Try something like
>>>>         
>>>> TermEnum te = IndexReader.terms(new Term("BookTitle", ""));
>>>>         
>>>> do {
>>>>         
>>>>     Term term = te.term();
>>>>         
>>>>     if (! term.field().equals("BookTitle")) break;
>>>>         
>>>>     System.out.println(term.text());
>>>>         
>>>> } while (te.next());
>>>>         
>>>> Note that next() will merrily continue beyond the last term for
>>>>         
>>>> the field "BookTitle", so you have to check that you're still
>>>>         
>>>> where you want to be.
>>>>         
>>>> Best
>>>>         
>>>> Erick
>>>>         
>>>> On Thu, Oct 22, 2009 at 11:52 AM, adviner <eric.advincula@gmail.com>
>>>>         
>>>> wrote:
>>>>         
>>>>> I have a field in called BookTitle.  I want to loop through all the
>>>>>           
>>>>> entries
>>>>>           
>>>>> without doing a search.  I just want to get the list of BookTitle's
>>>>>           
>>> that
>>>       
>>>>> is
>>>>>           
>>>>> in this field:
>>>>>           
>>>>> I tried IndexReader but MaxDocs() doesnt work because it returns
>>>>>           
>>>>> everything
>>>>>           
>>>>> and I have other fields in their which is allot bigger.
>>>>>           
>>>>> Sorry i originally posted to the developer site which is wrong place
>>>>>           
>>> so
>>>       
>>> i
>>>       
>>>>> moved it here
>>>>>           
>>>>> --
>>>>>           
>>>>> View this message in context:
>>>>>           
>>>>> http://www.nabble.com/How-to-loop-through-all-the-entries-for-a-field-
>>>>>           
>>> tp26012512p26012512.html
>>>       
>>>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>>>           
>>>>> ---------------------------------------------------------------------
>>>>>           
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>           
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>           
>>> --
>>>       
>>> View this message in context: http://www.nabble.com/How-to-loop-through-
>>>       
>>> all-the-entries-for-a-field-tp26012512p26017418.html
>>>       
>>> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>>>       
>>> ---------------------------------------------------------------------
>>>       
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>       
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>       
>>  
>>
>>
>>
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43001-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 22 23:04:07 2009
Return-Path: <java-user-return-43001-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34413 invoked from network); 22 Oct 2009 23:04:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 22 Oct 2009 23:04:07 -0000
Received: (qmail 3097 invoked by uid 500); 22 Oct 2009 23:04:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3022 invoked by uid 500); 22 Oct 2009 23:04:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3012 invoked by uid 99); 22 Oct 2009 23:04:04 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 23:04:04 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of chris.lu@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 22 Oct 2009 23:04:02 +0000
Received: by bwz22 with SMTP id 22so776926bwz.5
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 16:03:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type;
        bh=HGdaihxV5/ZEA6RIUVRWFX4QmkhSS73RhFdbgSVGL80=;
        b=gFcmCWiP2OEAY1v8SBOvJXHrxAzpP5UgtIEyTmB9s2kdPfk1kX+M4ZPqZG9GaSUQCG
         fjO9cs68mNp0K34d1EOiTnusTGfRWbAq48znXzNqepRUQ32MnB3/JNtwASJT5Qm3tklg
         D04zvUlFSIpH8sZium8FpSVX2Dpehq1EqATns=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type;
        b=X560XfvHfRMx+nuRGG4pAjEdqvHMgPazUnhn3XhzPoKDA8p9UpUwj3AqicCtR7UYx9
         KvhnTg0Hpq3X8Ay5pqM/bsAuzF6pAcP9aWGr5o9cXCFML1aujMVPPJFnZWAUjQL/rqwC
         8YTwz5Yao+lOKvBEj17jyQk5MvyRX5gzZnZvY=
Received: by 10.102.165.24 with SMTP id n24mr4364273mue.47.1256252619143;
        Thu, 22 Oct 2009 16:03:39 -0700 (PDT)
Received: from ?10.1.1.122? (hq.compositesw.com [209.237.61.131])
        by mx.google.com with ESMTPS id e8sm1267925muf.29.2009.10.22.16.03.36
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 22 Oct 2009 16:03:37 -0700 (PDT)
Message-ID: <4AE0E4C4.3040107@gmail.com>
Date: Thu, 22 Oct 2009 16:03:32 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Performance tips when creating a large index from database.
References: <4AE053F7.60708@fastmail.fm> <4AE0714A.8000800@net-m.de> <5e76f3840910220759l6c439e10l6099dcda350a0fb@mail.gmail.com>
In-Reply-To: <5e76f3840910220759l6c439e10l6099dcda350a0fb@mail.gmail.com>
Content-Type: multipart/alternative;
 boundary="------------020703020903010203040309"

--------------020703020903010203040309
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit

All previous suggestions are very good.

It's usually just the database. Lucene itself are faster enough.
Previously when I used Pentium III years ago, the indexing speed matters.
But upgrading the CPU to Xeon etc, the indexing bottle neck is on 
database side.

Basically use the simplest SQL as you can, and maybe do some caching to 
save a trip to database.
Sometimes, you can use your way to batch a set of ids. But if you set 
the batch size to a big number, like your 10000 ids, it could causing 
database memory page swapping and slow down your database. The other 
extreme is to just use 1 id, but many threads.
I think you can find something in middle, which set batch size to a 
lower number, and use more threads, to pull may speed things up.

You can also use the community version of DBSight to try this. You can 
tell how much time spend on querying and indexing respectively, and you 
can adjust the number of threads for database queries and also for 
indexing to find out your optimal data pulling configuration.

--

Chris Lu

-------------------------

Instant Scalable Full-Text Search On Any Database/Application

site: http://www.dbsight.net

demo: http://search.dbsight.com

Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes

DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!



Glen Newton wrote:
> This is basically what LuSql does. The time increases ("8h to 30 min")
> are similar. Usually on the order of an order of magnitude.
>
> Oh, the comments suggesting most of the interaction is with the
> database? The answer is: it depends.
> With large Lucene documents: Lucene is the limiting factor (worsened
> by going single threaded).
> With small documents: it can be the DB.
>
> Other issues include waiting for complex queries on the DB to be ready
> (avoid sorting in the SQL!!).
> LuSql supports out-of-band joins (don't do the join in the SQL, but do
> the join from the client (with an additional- but low cost as it is
> usually on the primary key - query for each record); sometimes this is
> better; sometimes this is worse, depending on your DB design, queries,
> etc.)
>
> -Glen
>
> 2009/10/22 Thomas Becker <thomas.becker@net-m.de>:
>   
>> Profile your application first hand and find out where the bottlenecks really
>> are during indexing.
>>
>> For me it was clearly the database calls which took most of the time. Due to a
>> very complex SQL Query.
>> I applied the Producer - Consumer pattern and put a blocking queue in between. I
>> have a threadpool running x producers which are sending SQL Queries to the
>> database. Each returned row is put into the blockingQueue and another threadpool
>> running x (currently only 1) consumers is taking Objects from the row, converts
>> them to lucene documents and adds them to the index.
>> If the last row is put into the queue I add a Poison Pill to tell the consumer
>> to break.
>> Using a blockingQueue limited to 10.000 entries together with jdbc fetchSize
>> avoids high memory consumptions if too many producer threads return from the db.
>>
>> This way I could reduce indexing time from around 8h to 30 min. (really). But be
>> careful. Load on the DB Server will surely increase.
>>
>> Hope that helps.
>>
>> Cheers,
>> Thomas
>>
>> Paul Taylor wrote:
>>     
>>> I'm building a lucene index from a database, creating 1 about 1 million
>>> documents, unsuprisingly this takes quite a long time.
>>> I do this by sending a query  to the db over a range of ids , (10,000)
>>> records
>>> Add these results in Lucene
>>> Then get next 10,0000 and so on.
>>> When completed indexing I then call optimize()
>>> I also set  indexWriter.setMaxBufferedDocs(1000) and
>>> indexWriter.setMergeFactor(3000) but don't fully understand these values.
>>> Each document contains about 10 small fields
>>>
>>> I'm looking for some ways to improve performance.
>>>
>>> This index writing is single threaded, is there a way I can multi-thread
>>> writing to the indexing ?
>>> I only call optimize() once at the end, is the best way to do it.
>>> I'm going to run a profiler over the code, but are there any rules of
>>> thumbs on the best values to set for MaxBufferedDocs and Mergefactor()
>>>
>>> thanks Paul
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>       
>> --
>> Thomas Becker
>> Senior JEE Developer
>>
>> net mobile AG
>> Zollhof 17
>> 40221 Dsseldorf
>> GERMANY
>>
>> Phone:    +49 211 97020-195
>> Fax:      +49 211 97020-949
>> Mobile:   +49 173 5146567 (private)
>> E-Mail:   mailto:thomas.becker@net-m.de
>> Internet: http://www.net-m.de
>>
>> Registergericht:  Amtsgericht Dsseldorf, HRB 48022
>> Vorstand:         Theodor Niehues (Vorsitzender), Frank Hartmann,
>>                 Kai Markus Kulas, Dieter Plassmann
>> Vorsitzender des
>> Aufsichtsrates:   Dr. Michael Briem
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>
>
>   

--------------020703020903010203040309--

From java-user-return-43002-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 01:41:28 2009
Return-Path: <java-user-return-43002-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 83051 invoked from network); 23 Oct 2009 01:41:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 01:41:28 -0000
Received: (qmail 55121 invoked by uid 500); 23 Oct 2009 01:41:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 55046 invoked by uid 500); 23 Oct 2009 01:41:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 55036 invoked by uid 99); 23 Oct 2009 01:41:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 01:41:25 +0000
X-ASF-Spam-Status: No, hits=-2.4 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of john.wang@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 01:41:23 +0000
Received: by ywh13 with SMTP id 13so11654487ywh.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 18:41:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=PGUMoDsmr+AhQwiCcYm3hsqMND3CYox95ur5I0SgRFA=;
        b=pSFpNPfHZC1KgJL0P5Ssqtp+W53yhs7XVfrdQ/1NhiPrK6AZtK3A0l9AHtDP2EdXys
         CXfVgle2a58e5iC484a9iYOLQiWTYvwdEV3U1F1ejVyPCM3rXMDBUJsGDoApHXe8CYOR
         c+cvI65A/k8Tw+BwfUCiRQeUXB4dRg2+MET38=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=mhL/G5jbyTf8som2zziAy2C8DZ6QbzkQRiZiHjZO4uQskWPfNOYxd3dpn8pNra2xjm
         6la1EPoCjda/zBxQddkSXG+uUiOkXkavqQBv2/LRrcdfuhiRqrBPcs1x+ZnWLPTMAGbx
         0q+JGpvp7jrcxfZtgkr1IWIx1U/iRxjdnonWA=
MIME-Version: 1.0
Received: by 10.101.75.20 with SMTP id c20mr3437972anl.42.1256262062229; Thu, 
	22 Oct 2009 18:41:02 -0700 (PDT)
In-Reply-To: <4AE04B1E.4060809@gmail.com>
References: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
	 <4AE04B1E.4060809@gmail.com>
Date: Thu, 22 Oct 2009 18:41:02 -0700
Message-ID: <8837fb770910221841n254cacd9rdf126aaab5469869@mail.gmail.com>
Subject: Re: 2.9 per segment searching/caching
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368e1e37f6c92e0476904d46

--0016368e1e37f6c92e0476904d46
Content-Type: text/plain; charset=ISO-8859-1

With many other coding that happened in 2.9, e.g. the PQ api etc., sorting
is actually faster than 2.4.
-John

On Thu, Oct 22, 2009 at 5:07 AM, Mark Miller <markrmiller@gmail.com> wrote:

> Bill Au wrote:
> > Since Lucene 2.9 has per segment searching/caching, does query
> performance
> > degrade less than before (2.9) as more segments are added to the index?
> > Bill
> >
> >
> I think non sorting cases are actually faster now over multiple segments
> - though you will still see performance degrade pretty signif. over a
> single segment (I've measured even 5 segments as being 15-20% slower).
> Doesn't really help the degrade, but should be faster at each point.
>
> Sorting is a bit different - you have to convert the p-queue as you go
> from segment to segment - so the more segments (which also generally
> means more larger segments), the more conversion you have to do. This
> didn't appear to be to bad unless you got up to quite a few segments .
> Worse degradation though.
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016368e1e37f6c92e0476904d46--

From java-user-return-43003-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 02:10:02 2009
Return-Path: <java-user-return-43003-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 88812 invoked from network); 23 Oct 2009 02:10:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 02:10:02 -0000
Received: (qmail 77818 invoked by uid 500); 23 Oct 2009 02:10:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 77727 invoked by uid 500); 23 Oct 2009 02:10:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 77717 invoked by uid 99); 23 Oct 2009 02:10:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 02:10:00 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 02:09:49 +0000
Received: by qyk41 with SMTP id 41so42674qyk.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 19:09:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=OGQCx7PRLG5SKreif3hW1IK+EhOUnddjvpWaRl60z4w=;
        b=HqPUSA/twoRwqpX29M6f5FT6sOgbridW3sOwEVrQdxAXKT8IE5fVs+BSUWTsUXnzUl
         fqVWN24eTmeMgkn5LLjIkhKdZ5qzb8uui0zhi0ursfmwgy9wBSi/gdJNw6wTc4sFXymD
         4+07uuqFotXCHJcsi7A7kIlVTQe0gxbDSxbRc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=f5lpEcGZp0lVwKx2LOrKXvZ+x9vU5ag/Bz/TQKCro8FggIyS6z29xWT5D3234tthk0
         5bQ+MVYPUbO4ENPDPoW9e0MwgE9SOTEObJNrkRMOAZurVKDwsdbmcM7omjz2Eppu+QqT
         pTCqCbAjV10a8d0RSBsXQ9CqBZSF+hUa2V9rE=
Received: by 10.224.114.149 with SMTP id e21mr5073971qaq.215.1256263768886;
        Thu, 22 Oct 2009 19:09:28 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 6sm946858qwk.44.2009.10.22.19.09.27
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 22 Oct 2009 19:09:27 -0700 (PDT)
Message-ID: <4AE11057.4080108@gmail.com>
Date: Thu, 22 Oct 2009 22:09:27 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: 2.9 per segment searching/caching
References: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>	 <4AE04B1E.4060809@gmail.com> <8837fb770910221841n254cacd9rdf126aaab5469869@mail.gmail.com>
In-Reply-To: <8837fb770910221841n254cacd9rdf126aaab5469869@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Yes - in many cases, the other wins outweigh the queue transition cost -
in some cases it does not.

But we are talking degradation as you add more segments, not pure speed.
Degradation is worse now in the sort case.

John Wang wrote:
> With many other coding that happened in 2.9, e.g. the PQ api etc., sorting
> is actually faster than 2.4.
> -John
>
> On Thu, Oct 22, 2009 at 5:07 AM, Mark Miller <markrmiller@gmail.com> wrote:
>
>   
>> Bill Au wrote:
>>     
>>> Since Lucene 2.9 has per segment searching/caching, does query
>>>       
>> performance
>>     
>>> degrade less than before (2.9) as more segments are added to the index?
>>> Bill
>>>
>>>
>>>       
>> I think non sorting cases are actually faster now over multiple segments
>> - though you will still see performance degrade pretty signif. over a
>> single segment (I've measured even 5 segments as being 15-20% slower).
>> Doesn't really help the degrade, but should be faster at each point.
>>
>> Sorting is a bit different - you have to convert the p-queue as you go
>> from segment to segment - so the more segments (which also generally
>> means more larger segments), the more conversion you have to do. This
>> didn't appear to be to bad unless you got up to quite a few segments .
>> Worse degradation though.
>>
>> --
>> - Mark
>>
>> http://www.lucidimagination.com
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43004-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 02:31:06 2009
Return-Path: <java-user-return-43004-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91719 invoked from network); 23 Oct 2009 02:31:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 02:31:06 -0000
Received: (qmail 91473 invoked by uid 500); 23 Oct 2009 02:31:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91389 invoked by uid 500); 23 Oct 2009 02:31:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91379 invoked by uid 99); 23 Oct 2009 02:31:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 02:31:04 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of john.wang@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 02:30:53 +0000
Received: by ywh13 with SMTP id 13so11700481ywh.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 19:30:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=4u29aL/Yio/1iFvgJoyCzHrBoTBOuXLx/fubF4rtVcM=;
        b=nfWHH0trh7GUoX5rk24l4JSA/YHhNWrsECi5hcDH4gS5/Wvf4nPJxvF7pdsfMAaeYi
         KtKxb54MYzUJwdci+eP+K0PYWE2dZHHg+GhrF2DRyji0NfiHgtZAXWfTuQSOwezv8vVD
         EbPzuc9gbl+mO5XlbrrK28eQAMeO9LXbxFPo8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=SaUfLXadctTnhqRFLkTO2ps3Bu2DLViugpFKrDSCBns2ceAL0/6Z7pHZXr+A+FPkMl
         jqyXf9jc9bXGgN11zu++9Excg5FBSXQaDWDAZbvv4OQi1D5HWPk7lyPVpdluknb+nr8B
         y2OjL8uR7U83kNzyn4mU+Y1Zrm8fBHM2g14DA=
MIME-Version: 1.0
Received: by 10.100.55.17 with SMTP id d17mr6633181ana.118.1256265032743; Thu, 
	22 Oct 2009 19:30:32 -0700 (PDT)
In-Reply-To: <4AE11057.4080108@gmail.com>
References: <3b5f72030910212031p6afac6abr6ac3a813bbc7de30@mail.gmail.com>
	 <4AE04B1E.4060809@gmail.com>
	 <8837fb770910221841n254cacd9rdf126aaab5469869@mail.gmail.com>
	 <4AE11057.4080108@gmail.com>
Date: Thu, 22 Oct 2009 19:30:32 -0700
Message-ID: <8837fb770910221930y42b42963r81892d7b3b2301d4@mail.gmail.com>
Subject: Re: 2.9 per segment searching/caching
From: John Wang <john.wang@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f4b2ca0539fc047690ffc2
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f4b2ca0539fc047690ffc2
Content-Type: text/plain; charset=ISO-8859-1

HI Michael:
     I understand exactly what you mean.

     I have done some experiments with the multiQ approach by carrying over
the bottom to next segment. (which would need to extend the
ScoreDocComparator api to support the same type of "convert", the difference
here is that it is optional, support for this convert would be an
opportunity for performance improvements)

     By doing this, I see the insert count drop by almost 50% and the
overall time much better. However, this approach still would imply more
inserts than the singleQ approach because like you said, the PQ contains top
N from each segment, and bottom is much better selected. Here is the time I
have running on 1.5:

||Seg size||Query||Tot hits||Sort||Top N||QPS old||QPS new||Pct change||
|log|<all>|1000000|rand string|10|91.76|108.63|{color:green}18.4%{color}|
|log|<all>|1000000|rand string|25|92.39|106.79|{color:green}15.6%{color}|
|log|<all>|1000000|rand string|50|91.30|104.02|{color:green}13.9%{color}|
|log|<all>|1000000|rand string|500|86.16|63.27|{color:red}-26.6%{color}|
|log|<all>|1000000|rand string|1000|76.92|64.85|{color:red}-15.7%{color}|
|log|<all>|1000000|country|10|92.42|108.78|{color:green}17.7%{color}|
|log|<all>|1000000|country|25|92.60|106.26|{color:green}14.8%{color}|
|log|<all>|1000000|country|50|92.64|103.76|{color:green}12.0%{color}|
|log|<all>|1000000|country|500|83.92|50.30|{color:red}-40.1%{color}|
|log|<all>|1000000|country|1000|74.78|46.59|{color:red}-37.7%{color}|
|log|<all>|1000000|rand int|10|114.03|114.85|{color:green}0.7%{color}|
|log|<all>|1000000|rand int|25|113.77|112.92|{color:red}-0.7%{color}|
|log|<all>|1000000|rand int|50|113.36|109.56|{color:red}-3.4%{color}|
|log|<all>|1000000|rand int|500|103.90|66.29|{color:red}-36.2%{color}|
|log|<all>|1000000|rand int|1000|89.52|70.67|{color:red}-21.1%{color}|

Usually multiQ is better with smaller queue sizes. But like you said, and
supported by these numbers, more segments would cause degradation.

On jdk1.6, the win on small queues with multiQ are very very slight. This
puzzles me alot, I am guessing jdk1.5 String comparison cost is much lower.

this is also consistent with the first set of numbers I gave you, which was
run on jdk1.6, with small queue sizes, and there was very very slight
difference  with multiQ faster by a tinu bit.

Thanks

-John

On Thu, Oct 22, 2009 at 7:09 PM, Mark Miller <markrmiller@gmail.com> wrote:

> Yes - in many cases, the other wins outweigh the queue transition cost -
> in some cases it does not.
>
> But we are talking degradation as you add more segments, not pure speed.
> Degradation is worse now in the sort case.
>
> John Wang wrote:
> > With many other coding that happened in 2.9, e.g. the PQ api etc.,
> sorting
> > is actually faster than 2.4.
> > -John
> >
> > On Thu, Oct 22, 2009 at 5:07 AM, Mark Miller <markrmiller@gmail.com>
> wrote:
> >
> >
> >> Bill Au wrote:
> >>
> >>> Since Lucene 2.9 has per segment searching/caching, does query
> >>>
> >> performance
> >>
> >>> degrade less than before (2.9) as more segments are added to the index?
> >>> Bill
> >>>
> >>>
> >>>
> >> I think non sorting cases are actually faster now over multiple segments
> >> - though you will still see performance degrade pretty signif. over a
> >> single segment (I've measured even 5 segments as being 15-20% slower).
> >> Doesn't really help the degrade, but should be faster at each point.
> >>
> >> Sorting is a bit different - you have to convert the p-queue as you go
> >> from segment to segment - so the more segments (which also generally
> >> means more larger segments), the more conversion you have to do. This
> >> didn't appear to be to bad unless you got up to quite a few segments .
> >> Worse degradation though.
> >>
> >> --
> >> - Mark
> >>
> >> http://www.lucidimagination.com
> >>
> >>
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >>
> >
> >
>
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001485f4b2ca0539fc047690ffc2--

From java-user-return-43005-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 05:29:59 2009
Return-Path: <java-user-return-43005-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 25633 invoked from network); 23 Oct 2009 05:29:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 05:29:59 -0000
Received: (qmail 15646 invoked by uid 500); 23 Oct 2009 05:29:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 15569 invoked by uid 500); 23 Oct 2009 05:29:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 15559 invoked by uid 99); 23 Oct 2009 05:29:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 05:29:56 +0000
X-ASF-Spam-Status: No, hits=4.0 required=10.0
	tests=HTML_MESSAGE,MIME_QP_LONG_LINE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of hrishikesh_agashe@persistent.co.in designates 202.54.11.87 as permitted sender)
Received: from [202.54.11.87] (HELO bmapps.persistent.co.in) (202.54.11.87)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 05:29:48 +0000
X-AuditID: 0a4e0006-b7c7eae000004705-bc-4ae13f3447bd
Received: from puneexchange.persistent.co.in ( [10.78.0.1])
	(using TLS with cipher AES128-SHA (AES128-SHA/128 bits))
	(Client did not present a certificate)
	by  (Symantec Mail Security) with SMTP id F0.D8.18181.43F31EA4; Fri, 23 Oct 2009 10:59:24 +0530 (IST)
Received: from Exchange.persistent.co.in ([fe80::ad8a:d553:ef93:bfdd]) by CAS1
 ([10.77.224.46]) with mapi; Fri, 23 Oct 2009 10:59:23 +0530
From: Hrishikesh Agashe <hrishikesh_agashe@persistent.co.in>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 23 Oct 2009 10:59:22 +0530
Subject: Maximum index file size
Thread-Topic: Maximum index file size
Thread-Index: AcpToca6UsN7J35gRemqEzzFw66JQw==
Message-ID: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
Accept-Language: en-US, en-IN
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US, en-IN
Content-Type: multipart/alternative;
	boundary="_000_E3137F97B0A0804194F369F4E7C3B71929AE7C8F75EXCHANGEpersi_"
MIME-Version: 1.0
X-Brightmail-Tracker: AAAAAQAAAZE=
X-Virus-Checked: Checked by ClamAV on apache.org

--_000_E3137F97B0A0804194F369F4E7C3B71929AE7C8F75EXCHANGEpersi_
Content-Type: text/plain; charset="us-ascii"
content-transfer-encoding: quoted-printable



I am running Ubuntu 9.04 on 64 bit machine with NAS of 100 TB capacity. JVM=
 is running with 2.5 GB Xmx.



Can I create an index file with very large size, like 1 TB or so? Is there a=
ny limit on how large index file one can create? Also, will I be able to sea=
rch on this 1 TB index file at all?



TIA,

--Hrishi




DISCLAIMER=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
This e-mail may contain privileged and confidential information which is the=
 property of Persistent Systems Ltd. It is intended only for the use of the=
 individual or entity to which it is addressed. If you are not the intended=
 recipient, you are not authorized to read, retain, copy, print, distribute=
 or use this message. If you have received this communication in error, plea=
se notify the sender and delete all copies of this message. Persistent Syste=
ms Ltd. does not accept any liability for virus infected mails.

--_000_E3137F97B0A0804194F369F4E7C3B71929AE7C8F75EXCHANGEpersi_--

From java-user-return-43006-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 05:39:40 2009
Return-Path: <java-user-return-43006-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 26729 invoked from network); 23 Oct 2009 05:39:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 05:39:40 -0000
Received: (qmail 25408 invoked by uid 500); 23 Oct 2009 05:39:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 25323 invoked by uid 500); 23 Oct 2009 05:39:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 25313 invoked by uid 99); 23 Oct 2009 05:39:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 05:39:38 +0000
X-ASF-Spam-Status: No, hits=-2.5 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 05:39:35 +0000
Received: by ywh13 with SMTP id 13so11855954ywh.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 22:39:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=3hp66Rye8r90j2T2SMdt5GH+/kW0C9VD+j0IWwM6Sn4=;
        b=pEh3jk3Pw8sZ+Th0r0VY1uoKM02KWqFdCDo8BMxBSd5LApNpkl5BuFGJF5u7LGWmGL
         UX11XgAzzQxoglSF7sPBUVEdKqYogRvUNYgSDCoEWUsOYTIWaxSVpyIURbb5eEnXV4FN
         +Tz2HqkiE3FumOOmGf7nK3wgSsnenXXntw+u0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Sl6wPmYPNaC7kDxlY/TWaEmYE5ZHnnvkyak8CEUPie0RJn/3GsaSTe+2r21Io91BM7
         IforXwkG/gDKIfNjS9aMOcofRp4/8YL8/SnRJEgYgm0onbFhe0GGbdMKyG8+nhtZHl4m
         4mIQoCpzn+HhXuyRgJXaC33okIvkc1GmIdbqM=
MIME-Version: 1.0
Received: by 10.90.143.16 with SMTP id q16mr13353457agd.26.1256276354992; Thu, 
	22 Oct 2009 22:39:14 -0700 (PDT)
In-Reply-To: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
References: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
Date: Thu, 22 Oct 2009 22:39:14 -0700
Message-ID: <4b124c310910222239k7d1de1c1q8cb7c54165ad2f89@mail.gmail.com>
Subject: Re: Maximum index file size
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00163630f949e1096c047693a142

--00163630f949e1096c047693a142
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Oct 22, 2009 at 10:29 PM, Hrishikesh Agashe <
hrishikesh_agashe@persistent.co.in> wrote:

> Can I create an index file with very large size, like 1 TB or so? Is there
> any limit on how large index file one can create? Also, will I be able to
> search on this 1 TB index file at all?
>

Leaving aside the question of hardware or JVM limits on monstrous files,
this question (can you search this file) is easier: if you've got say, a ten
billion documents in one index, and you have a query which is going to hit
maybe even just 0.1% of the documents, you'll need to do scoring of 10
million hits in the course of that query.  To do this in under a second
means you only have 100 nanoseconds to look at each document.  If your query
hits 1% of your documents, you're down to 10 ns per document.  I've never
tried searching a 1TB index, but I'd say that's pushing it.

Is there a reason you can't shard your index, and instead put maybe 20
shards of 50GB (or better - 100 shards of 10GB) each on a variety of
machines, and just merge results?

  -jake

--00163630f949e1096c047693a142--

From java-user-return-43007-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 06:18:34 2009
Return-Path: <java-user-return-43007-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 33673 invoked from network); 23 Oct 2009 06:18:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 06:18:34 -0000
Received: (qmail 54138 invoked by uid 500); 23 Oct 2009 06:18:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54065 invoked by uid 500); 23 Oct 2009 06:18:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54055 invoked by uid 99); 23 Oct 2009 06:18:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 06:18:31 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=5.0
	tests=AWL,BAYES_00,DEAR_FRIEND
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of songzi0206@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 06:18:29 +0000
Received: by yxe30 with SMTP id 30so11511925yxe.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 23:18:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=cyZJO2MVMaF041Px4q6fZhZeGNK/okM/4J3QtNjqmSM=;
        b=MV6wLL7kj8pnZdIcfOYxDFO7+IIX+LvOESbEpFAWS3cm3iRY9GFKwNEoZgWbjzcCrH
         PAkfKMN+cLgCU7U72D75T75GpV4piGInfe6JeodjTDoLYzT2LJwHXt0lzbfJo7UfxbdS
         3wF94OPORpOR4hXKjLRJaLYhdkVLxA2xpXRyM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=VSSbpDUtASj0L7gMiUEFgxJ7vf9ntDLL7yqLUuFt6OLB6zAVSxug4ZP03o7nlQO3oP
         y2Uqd90mgx7hNMZ/Vx+SZ3mgHXqRbVZhRRnGkFDzG3VbjlcmktReFeB2UJ4KOhYa0Arz
         3qYS9Ve10C7fzxu4pUNeA/HE+NS3kTWIO4DnU=
MIME-Version: 1.0
Received: by 10.150.130.39 with SMTP id c39mr17266579ybd.338.1256278688483; 
	Thu, 22 Oct 2009 23:18:08 -0700 (PDT)
Date: Fri, 23 Oct 2009 14:18:08 +0800
Message-ID: <20df37d0910222318t1da20521l5844ad17656856e8@mail.gmail.com>
Subject: help needed improving lucene concurret search performance
From: Wilson Wu <songzi0206@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Dear Friend,
     I have encountered some performance problems recently in lucene
search 2.9. I use a single IndexSearcher in the whole system, It seems
perfect when there is less than 10 threads doing search concurrenty.
Bu if there is more than 100 threads doing concurrent search,the
average response time is becoming bigger(>1s),and the max response
time reaches 299s. I really don't know how to improve,can you help me?
   Thanks a lot !

                                                              Wilson
                                                              2009.10.23
    The profiling result about 400 concurret search is at:
http://i3.6.cn/cvbnm/aa/f5/00/63521d982a469f5063b82268eee91d08.gif
it seems a lot of time consumed by TermScorer.score.
    Follewing is my servlet class which is reponse to search request:
public final class DispatchServlet extends
javax.servlet.http.HttpServlet implements javax.servlet.Servlet
{
      private static final long serialVersionUID = -5547647006004900451L;
      protected final Log log = LogFactory.getLog(getClass());
      protected Searcher searcher;
      protected Directory dir;
      protected RAMDirectory ram;

    public DispatchServlet() {
        super();
     }

    public void init() throws ServletException {
        super.init();
        try {

               dir = FSDirectory.open(new
File("/usr/bestv/search_engin_index/index/program"));
                ram = new RAMDirectory(dir);
                searcher = new IndexSearcher(ram,true);
                int h = searcher.search(tq,null,1).totalHits;
                System.out.println("the searcher has warmed and
searched " + h + " docs" );
            }
        } catch (IOException e) {
            log.error(e);
        }
  }

protected void doPost(HttpServletRequest request, HttpServletResponse
response) throws ServletException, IOException {
               response.setContentType("text/html");
               doExecute(request.getParameter("q"),response);
       }

protected void doGet(HttpServletRequest request, HttpServletResponse
response) throws ServletException, IOException {
               response.setContentType("text/html");
               try{
                       String schCon =
URLDecoder.decode(request.getParameter("q"),"UTF-8");
                       doExecute(schCon,response);
               }catch(Exception e){
                       response.getWriter().write("Parameter
Error,please send param 'q'");
               }
       }

    public void doExecute(String schCon,HttpServletResponse response)
throws ServletException,IOException{
               response.getWriter().write(new SearchCommand().search(searcher));
  }

}

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43008-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 06:29:33 2009
Return-Path: <java-user-return-43008-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35562 invoked from network); 23 Oct 2009 06:29:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 06:29:33 -0000
Received: (qmail 58381 invoked by uid 500); 23 Oct 2009 06:29:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58302 invoked by uid 500); 23 Oct 2009 06:29:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58292 invoked by uid 99); 23 Oct 2009 06:29:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 06:29:31 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=5.0
	tests=AWL,BAYES_00,MIME_QP_LONG_LINE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of hrishikesh_agashe@persistent.co.in designates 202.54.11.87 as permitted sender)
Received: from [202.54.11.87] (HELO bmapps.persistent.co.in) (202.54.11.87)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 06:29:28 +0000
X-AuditID: 0a4e0006-b7c7eae000004705-7d-4ae14d315e33
Received: from puneexchange.persistent.co.in ( [10.78.0.1])
	(using TLS with cipher AES128-SHA (AES128-SHA/128 bits))
	(Client did not present a certificate)
	by  (Symantec Mail Security) with SMTP id EE.2A.18181.13D41EA4; Fri, 23 Oct 2009 11:59:05 +0530 (IST)
Received: from Exchange.persistent.co.in ([fe80::ad8a:d553:ef93:bfdd]) by CAS2
 ([10.77.224.47]) with mapi; Fri, 23 Oct 2009 11:59:05 +0530
From: Hrishikesh Agashe <hrishikesh_agashe@persistent.co.in>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 23 Oct 2009 11:59:04 +0530
Subject: RE: Maximum index file size
Thread-Topic: Maximum index file size
Thread-Index: AcpToziNwF4zYsXESY6yWniBE0Z3tAABg79w
Message-ID: <E3137F97B0A0804194F369F4E7C3B71929AE7C91E6@EXCHANGE.persistent.co.in>
References: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
 <4b124c310910222239k7d1de1c1q8cb7c54165ad2f89@mail.gmail.com>
In-Reply-To: <4b124c310910222239k7d1de1c1q8cb7c54165ad2f89@mail.gmail.com>
Accept-Language: en-US, en-IN
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US, en-IN
Content-Type: text/plain; charset="us-ascii"
content-transfer-encoding: quoted-printable
MIME-Version: 1.0
X-Brightmail-Tracker: AAAAAQAAAZE=

Thanks Jake. 

I have around 75 TB data to be indexed. So even though I do the sharding, in=
dividual index file size might still be pretty high. And that's why I wanted=
 to find out whether there is any limit as such. And obviously whether such=
 a huge index files can be searched at all.

>From your response it appears that 1 TB of 1 index file is too much. Is ther=
e any guideline to what kind of hardware will be required to handle (10GB, 5=
0GB, 100GB, 500GB etc) size of index file (with sensible search times)

--Hrishi

-----Original Message-----
From: Jake Mannix [mailto:jake.mannix@gmail.com] 
Sent: Friday, October 23, 2009 11:09 AM
To: java-user@lucene.apache.org
Subject: Re: Maximum index file size

On Thu, Oct 22, 2009 at 10:29 PM, Hrishikesh Agashe <
hrishikesh_agashe@persistent.co.in> wrote:

> Can I create an index file with very large size, like 1 TB or so? Is there
> any limit on how large index file one can create? Also, will I be able to
> search on this 1 TB index file at all?
>

Leaving aside the question of hardware or JVM limits on monstrous files,
this question (can you search this file) is easier: if you've got say, a ten
billion documents in one index, and you have a query which is going to hit
maybe even just 0.1% of the documents, you'll need to do scoring of 10
million hits in the course of that query.  To do this in under a second
means you only have 100 nanoseconds to look at each document.  If your query
hits 1% of your documents, you're down to 10 ns per document.  I've never
tried searching a 1TB index, but I'd say that's pushing it.

Is there a reason you can't shard your index, and instead put maybe 20
shards of 50GB (or better - 100 shards of 10GB) each on a variety of
machines, and just merge results?

  -jake

DISCLAIMER=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
This e-mail may contain privileged and confidential information which is the=
 property of Persistent Systems Ltd. It is intended only for the use of the=
 individual or entity to which it is addressed. If you are not the intended=
 recipient, you are not authorized to read, retain, copy, print, distribute=
 or use this message. If you have received this communication in error, plea=
se notify the sender and delete all copies of this message. Persistent Syste=
ms Ltd. does not accept any liability for virus infected mails.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43009-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 06:49:32 2009
Return-Path: <java-user-return-43009-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41872 invoked from network); 23 Oct 2009 06:49:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 06:49:32 -0000
Received: (qmail 71640 invoked by uid 500); 23 Oct 2009 06:49:30 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 71555 invoked by uid 500); 23 Oct 2009 06:49:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 71544 invoked by uid 99); 23 Oct 2009 06:49:30 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 06:49:30 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 06:49:21 +0000
Received: by ywh13 with SMTP id 13so11908099ywh.29
        for <java-user@lucene.apache.org>; Thu, 22 Oct 2009 23:49:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=qTakHPDbvIVQTt5LtcTgHdwCwV6qqOhF/QIhJ8gVM7M=;
        b=BCT2P6B+o4tNER4BCEAuCIXvEkx1KUOhVSmvCvq0An/vIbQsEkMKzFTWzU0E+ypy8R
         9xpAXg4znWxnLn9VX3I3IOGx2GegiQvarsFVODxDjgpDZWoL7YuR3pd3ZVpS6unqeE/G
         nJxtVklLhwtLbHd04KWCKJSIKUVAKXjthIzAM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=TsN0um4OceHnPxX7wGX4VemBgkWidLiULhYkVEVA8gnktdmXlwM5pzuLVhseVkcMy8
         Iri/yEhrFDArH3de2bFpyAKUvn9eM+wmU/RYiVdcWGRagF+KJ0q6zNFp1vgWND/4lQhF
         mOGMx8O8cRFkhaiKqyGX56mlfVBUzcur0GyZk=
MIME-Version: 1.0
Received: by 10.91.102.6 with SMTP id e6mr1052084agm.99.1256280540579; Thu, 22 
	Oct 2009 23:49:00 -0700 (PDT)
In-Reply-To: <E3137F97B0A0804194F369F4E7C3B71929AE7C91E6@EXCHANGE.persistent.co.in>
References: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
	 <4b124c310910222239k7d1de1c1q8cb7c54165ad2f89@mail.gmail.com>
	 <E3137F97B0A0804194F369F4E7C3B71929AE7C91E6@EXCHANGE.persistent.co.in>
Date: Thu, 22 Oct 2009 23:49:00 -0700
Message-ID: <4b124c310910222349n6906f9dcw4491949caf4d26c7@mail.gmail.com>
Subject: Re: Maximum index file size
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e645b7a05c06690476949b7d
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e645b7a05c06690476949b7d
Content-Type: text/plain; charset=ISO-8859-1

Hi Hrishi,

  The only way you'll know is to try it with some subset of your data - some
queries can be very expensive, some are really easy.  It'll depend on your
document size, the vocabulary (total number and distribution of terms), and
kinds of queries, as well as of course your hardware.  I would start out
indexing the sizes you mention (10-1000GB), and run queries like those you
expect to be running in production against it, and measure your TPS after
it's been running for a while under load.

  To index even 1TB you should probably do this in parallel and then merge
afterwards if you want to build up this test index in any reasonable time,
but that final merge of the last two segments in your 1TB index is gonna be
a killer.

  One of the big problems you'll run into with this index size is that
you'll never have enough RAM to give your OS's IO cache enough room to keep
much of this index in memory, so you're going to be seeking in this monster
file a lot.  I'm not saying that you need to keep your index in RAM for good
performance, but I've always tried to keep the individual indexes I use at
least within a (binary) order of magnitude of the RAM available - if I'm on
a box with 16GB of memory, then an index bigger than 32GB is getting
dangerously big for my preferences.  This may be mitigated by using really
fast disks, possibly, which is yet another reason why you'll need to do some
performance profiling on a variety of sizes with similar-to-production data
sets.

  I wish I could be of more help - but I think on this size, you'll need to
play with it to see what works.  We here on the list would be *very*
interested to hear what you find, because I'll bet that the reason why
you're not getting very many responses to this question is not because
nobody cares, but because most of us don't really know if you can ever
really search multi-TB *single* indexes, or what kind of cluster
configuration works best for searching a 75 TB distributed lucene index!

  -jake

On Thu, Oct 22, 2009 at 11:29 PM, Hrishikesh Agashe <
hrishikesh_agashe@persistent.co.in> wrote:

> Thanks Jake.
>
> I have around 75 TB data to be indexed. So even though I do the sharding,
> individual index file size might still be pretty high. And that's why I
> wanted to find out whether there is any limit as such. And obviously whether
> such a huge index files can be searched at all.
>
> From your response it appears that 1 TB of 1 index file is too much. Is
> there any guideline to what kind of hardware will be required to handle
> (10GB, 50GB, 100GB, 500GB etc) size of index file (with sensible search
> times)
>
> --Hrishi
>
> -----Original Message-----
> From: Jake Mannix [mailto:jake.mannix@gmail.com]
> Sent: Friday, October 23, 2009 11:09 AM
> To: java-user@lucene.apache.org
> Subject: Re: Maximum index file size
>
> On Thu, Oct 22, 2009 at 10:29 PM, Hrishikesh Agashe <
> hrishikesh_agashe@persistent.co.in> wrote:
>
> > Can I create an index file with very large size, like 1 TB or so? Is
> there
> > any limit on how large index file one can create? Also, will I be able to
> > search on this 1 TB index file at all?
> >
>
> Leaving aside the question of hardware or JVM limits on monstrous files,
> this question (can you search this file) is easier: if you've got say, a
> ten
> billion documents in one index, and you have a query which is going to hit
> maybe even just 0.1% of the documents, you'll need to do scoring of 10
> million hits in the course of that query.  To do this in under a second
> means you only have 100 nanoseconds to look at each document.  If your
> query
> hits 1% of your documents, you're down to 10 ns per document.  I've never
> tried searching a 1TB index, but I'd say that's pushing it.
>
> Is there a reason you can't shard your index, and instead put maybe 20
> shards of 50GB (or better - 100 shards of 10GB) each on a variety of
> machines, and just merge results?
>
>  -jake
>
> DISCLAIMER
> ==========
> This e-mail may contain privileged and confidential information which is
> the property of Persistent Systems Ltd. It is intended only for the use of
> the individual or entity to which it is addressed. If you are not the
> intended recipient, you are not authorized to read, retain, copy, print,
> distribute or use this message. If you have received this communication in
> error, please notify the sender and delete all copies of this message.
> Persistent Systems Ltd. does not accept any liability for virus infected
> mails.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e645b7a05c06690476949b7d--

From java-user-return-43010-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 08:54:54 2009
Return-Path: <java-user-return-43010-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71222 invoked from network); 23 Oct 2009 08:54:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 08:54:54 -0000
Received: (qmail 82125 invoked by uid 500); 23 Oct 2009 08:54:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82091 invoked by uid 500); 23 Oct 2009 08:54:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82081 invoked by uid 99); 23 Oct 2009 08:54:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 08:54:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [134.96.191.147] (HELO smtp.dfki.de) (134.96.191.147)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 08:54:40 +0000
Received: from smtp.dfki.de (localhost [127.0.0.1])
	by imss.7 (Postfix) with ESMTP id D162A312E9
	for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 10:54:18 +0200 (CEST)
Received: from mail.dfki.de (lnv-104.sb.dfki.de [134.96.191.146])
	by smtp.dfki.de (Postfix) with ESMTP id B650B312E0
	for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 10:54:18 +0200 (CEST)
Received: from bledsoe.dfki.uni-sb.de (bledsoe.dfki.uni-sb.de [134.96.184.151])
	(using TLSv1 with cipher AES128-SHA (128/128 bits))
	(No client certificate requested)
	by mail.dfki.de (Postfix) with ESMTPSA id C4EDD310AE
	for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 10:54:13 +0200 (CEST)
Message-Id: <0E8FC135-BBC8-42D0-9B8D-FD61ECE15697@activemath.org>
From: Paul Libbrecht <paul@activemath.org>
To: java-user@lucene.apache.org
In-Reply-To: <4AC22260.5010202@getopt.org>
Content-Type: multipart/signed; boundary=Apple-Mail-66-955462890; micalg=sha1; protocol="application/pkcs7-signature"
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: [ANN] Luke 0.9.9 release
Date: Fri, 23 Oct 2009 10:54:07 +0200
References: <4AC22260.5010202@getopt.org>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org

--Apple-Mail-66-955462890
Content-Type: text/plain;
	charset=ISO-8859-1;
	format=flowed;
	delsp=yes
Content-Transfer-Encoding: quoted-printable

Because I like to have Luke always sitting at hand, I have packed this =20=

release as a MacOSX disk-image and applcation.

	http://www.activemath.org/~paul/tmp/Luke-0.9.9.dmg

The icon could be better (I need a hires of Lucene's icon, haven't =20
found it yet).
Potentially the packaging should be automated as well... I'm there yet.
More importantly, I'd wish Luke to have a MacOS look-and-feel and thus =20=

far I didn't find it... (especially keyboard shortcuts)

paul


Le 29-sept.-09 =E0 17:06, Andrzej Bialecki a =E9crit :

> Hi all,
>
> I'm happy to announce the new release of Luke - the Lucene Index =20
> Toolbox.
>
> Binaries and sources are available for download at the usual place:
>
> 	http://www.getopt.org/luke/
> 	http://www.getopt.org/luke/lukeall-0.9.9.jar
> 	http://www.getopt.org/luke/luke-0.9.9/luke-src-0.9.9.tgz
> 	http://www.getopt.org/luke/luke-0.9.9/luke-src-0.9.9.zip
>
> I decided to at least partially synchronize the release numbers with =20=

> Lucene release numbers. Next version of Luke, which will include =20
> Lucene 3.0, will become a 1.0 release! :)
>
> Changes in v. 0.9.9:
> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>
> This release upgrades to Lucene 2.9.0 jars.
>
> New features and improvements:
> ------------------------------
> * Luke can now open multiple indexes found in subdirectories one =20
> level below the selected directory.
>
> * Added Hadoop Plugin for working with indexes on Hadoop file =20
> systems. This uses Hadoop 0.19.2 and dependencies released with this =20=

> release of Hadoop. The plugin uses partial local caching to speed up =20=

> some operations.
>
> * Term counts and percentages are calculated in a background thread, =20=

> so the opening of large indexes should be a little faster. Also, =20
> this operation is skipped for indexes accessed over slow IO (such as =20=

> HDFS).
>
> * Added More Like This query builder from current document (or its =20
> selected fields).
>
> * Search time is now monitored using System.nanoTime, and the last =20
> search time is preserved in the UI.
>
> * Search can be now repeated N times to get a better estimate of =20
> average search time. Note: the measured time involves only the =20
> search(), not the retrieval of documents.
>
> * AnalyzerTool plugin now uses and illustrates the new token =20
> Attribute API.
>
> * Nearly all uses of deprecated Lucene API are replaced with the new =20=

> API.
>
> Bug fixes:
> ----------
> * Fix a counter-intuitive behavior where in the Open dialog Luke =20
> chops off the last path element from previously used index path.
>
> * Fix XMLExporter entity escaping, and add a missing quote in term =20
> vector size.
>
> * Fix a long-standing Thinlet bug related to tabbedpane with many =20
> tabs - now tabs don't "overflow" the tabbedpane area thus corrupting =20=

> the display of surrounding components.
>
> I'd like to thank people who reported problems and suggested =20
> improvements: Craig Stires, Phil Whelan, Andrea Habringer, Benjamin =20=

> Beckmann, George Herson, Daniel Noll, Mike McCandless, Chris Pimlott =20=

> and others.
>
> Enjoy! :)
>
> --=20
> Best regards,
> Andrzej Bialecki     <><
> ___. ___ ___ ___ _ _   __________________________________
> [__ || __|__/|__||\/|  Information Retrieval, Semantic Web
> ___|||__||  \|  ||  |  Embedded Unix, System Integration
> http://www.sigram.com  Contact: info at sigram dot com
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


--Apple-Mail-66-955462890
Content-Disposition: attachment;
	filename=smime.p7s
Content-Type: application/pkcs7-signature;
	name=smime.p7s
Content-Transfer-Encoding: base64

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAoIIDDzCCAwsw
ggJ0oAMCAQICECfgYPDm3JFN4mPGdyWyyVgwDQYJKoZIhvcNAQEFBQAwYjELMAkGA1UEBhMCWkEx
JTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMTI1RoYXd0ZSBQ
ZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBMB4XDTA5MDUyNjA3MzIzNloXDTEwMDUyNjA3MzIz
NlowcDEaMBgGA1UEBBMRTGliYnJlY2h0IEdvdXJkZXQxDTALBgNVBCoTBFBhdWwxHzAdBgNVBAMT
FlBhdWwgTGliYnJlY2h0IEdvdXJkZXQxIjAgBgkqhkiG9w0BCQEWE3BhdWxAYWN0aXZlbWF0aC5v
cmcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDeZiQTdNavFBrVY7WMNWscajCzBRZF
cWhrkQyh2V0CCrwx7ElHEM0asrD/FbmK+eor0aeav4u/3RKj3qOsV/HV8VRiM2zHaaErrp+/boPw
FapmxhPk0TXLceFJAgL5ZA1RsfpcIxGzE/AQ5ic+MqZXp2tZkH6RNeOwoUTURZb2bOZWX5fA1G+L
G+IVs20vAN6i/Kdud3JUe9ElfHWfJTl2eO42Hea5MVLnk2IkmCqzxC3CcEchOgOzIrnEjaj/JLPB
ZZkDv6sTyEouG4qQHr4trSZCe5anTM2HoPVtmAoaz+Acyt2+0cwIUIPGDjk1K0mvrnCbVIOUNlUe
FVJu0svnAgMBAAGjMDAuMB4GA1UdEQQXMBWBE3BhdWxAYWN0aXZlbWF0aC5vcmcwDAYDVR0TAQH/
BAIwADANBgkqhkiG9w0BAQUFAAOBgQDC0P6qlhvM4E2XepLgrDWLj7yp9obwKr2tZBvM3lXGCIyx
edzPOMRQABPH3eBbvhKyMb64AoCttJ0vt+QcBLLtc9TkBxPyHyaRHmi4NUMlJJyy1z6pLNc0Ipec
U+qv5ck7Cl2SUs7ZQps9ZSW++s4LKKrcdsEs9HD4myt1YusWKTGCAxAwggMMAgEBMHYwYjELMAkG
A1UEBhMCWkExJTAjBgNVBAoTHFRoYXd0ZSBDb25zdWx0aW5nIChQdHkpIEx0ZC4xLDAqBgNVBAMT
I1RoYXd0ZSBQZXJzb25hbCBGcmVlbWFpbCBJc3N1aW5nIENBAhAn4GDw5tyRTeJjxnclsslYMAkG
BSsOAwIaBQCgggFvMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA5
MTAyMzA4NTQwOFowIwYJKoZIhvcNAQkEMRYEFOO0U217doCFEos7ZzkjwFmbvrXKMIGFBgkrBgEE
AYI3EAQxeDB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQKExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5
KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwgRnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg
8ObckU3iY8Z3JbLJWDCBhwYLKoZIhvcNAQkQAgsxeKB2MGIxCzAJBgNVBAYTAlpBMSUwIwYDVQQK
ExxUaGF3dGUgQ29uc3VsdGluZyAoUHR5KSBMdGQuMSwwKgYDVQQDEyNUaGF3dGUgUGVyc29uYWwg
RnJlZW1haWwgSXNzdWluZyBDQQIQJ+Bg8ObckU3iY8Z3JbLJWDANBgkqhkiG9w0BAQEFAASCAQCp
3Ag7Uvwr3ODCqVAXplKa4HvPcSn6u3puxV5dttbmSrBa6LB6I9zQT32MQMUycAxI60qlgxQjQCoM
yURfzvKj041ym+OGWwGl6RQYwCpmPnjSuUdyFKM3MyA2p68NVb5y4aAaQNkPNzvp/93HaKOsUDGd
oCmc2qE912bNd0QPRKB2M2SbgmIyOBVDjPTCUZhwgEiGL57XyFXW3SfjQXNQJdVmDNHCVXAEB7r1
UiFDw1plIcqKmNmtx/+rr5xECKsxAkh96BAVjDJmZ2X06YnxCjfIITtoQ5R+Z+/lBJ0sKcVWxNp5
XahTQ86rBE5f/YJX4t1aU/j0ElUGYGJpKVclAAAAAAAA

--Apple-Mail-66-955462890--

From java-user-return-43011-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 09:26:39 2009
Return-Path: <java-user-return-43011-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 78272 invoked from network); 23 Oct 2009 09:26:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 09:26:39 -0000
Received: (qmail 11795 invoked by uid 500); 23 Oct 2009 09:26:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11724 invoked by uid 500); 23 Oct 2009 09:26:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11714 invoked by uid 99); 23 Oct 2009 09:26:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 09:26:36 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [72.167.82.82] (HELO p3plsmtpa01-02.prod.phx3.secureserver.net) (72.167.82.82)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 23 Oct 2009 09:26:33 +0000
Received: (qmail 14912 invoked from network); 23 Oct 2009 09:26:11 -0000
Received: from unknown (81.219.54.251)
  by p3plsmtpa01-02.prod.phx3.secureserver.net (72.167.82.82) with ESMTP; 23 Oct 2009 09:25:40 -0000
Message-ID: <4AE1768D.5010309@getopt.org>
Date: Fri, 23 Oct 2009 11:25:33 +0200
From: Andrzej Bialecki <ab@getopt.org>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: [ANN] Luke 0.9.9 release
References: <4AC22260.5010202@getopt.org> <0E8FC135-BBC8-42D0-9B8D-FD61ECE15697@activemath.org>
In-Reply-To: <0E8FC135-BBC8-42D0-9B8D-FD61ECE15697@activemath.org>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

Paul Libbrecht wrote:
> Because I like to have Luke always sitting at hand, I have packed this 
> release as a MacOSX disk-image and applcation.
> 
>     http://www.activemath.org/~paul/tmp/Luke-0.9.9.dmg
> 
> The icon could be better (I need a hires of Lucene's icon, haven't found 
> it yet).
> Potentially the packaging should be automated as well... I'm there yet.
> More importantly, I'd wish Luke to have a MacOS look-and-feel and thus 
> far I didn't find it... (especially keyboard shortcuts)

Paul,

I'm in the process of moving Luke to Google Code, to give others a 
better chance of providing patches and new features. The project should 
be already up, with the issue tracker etc.

	http://code.google.com/p/luke

The Thinlet L&F is poor, I know - but my Swing skills are poor too, so 
either you have to bear with it, or do the port from Thinlet to Swing 
yourself ;) Keyboard shortcuts are hardcoded somewhere deep in Thinlet, 
but likely they could be made configurable.

You can find an EPS version of the Lucene logo here: 
http://lucene.apache.org/images/logo.eps

-- 
Best regards,
Andrzej Bialecki     <><
  ___. ___ ___ ___ _ _   __________________________________
[__ || __|__/|__||\/|  Information Retrieval, Semantic Web
___|||__||  \|  ||  |  Embedded Unix, System Integration
http://www.sigram.com  Contact: info at sigram dot com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43012-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 12:34:14 2009
Return-Path: <java-user-return-43012-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22652 invoked from network); 23 Oct 2009 12:34:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 12:34:14 -0000
Received: (qmail 31894 invoked by uid 500); 23 Oct 2009 12:34:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31816 invoked by uid 500); 23 Oct 2009 12:34:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31806 invoked by uid 99); 23 Oct 2009 12:34:11 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 12:34:11 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [130.225.24.68] (HELO sbexch03.sb.statsbiblioteket.dk) (130.225.24.68)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 12:34:02 +0000
Received: from [172.18.253.199] (172.18.253.199) by
 sbexch03.sb.statsbiblioteket.dk (130.225.24.68) with Microsoft SMTP Server id
 8.1.393.1; Fri, 23 Oct 2009 14:33:41 +0200
Subject: Re: Maximum index file size
From: Toke Eskildsen <te@statsbiblioteket.dk>
Reply-To: te@statsbiblioteket.dk
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
In-Reply-To: <4b124c310910222349n6906f9dcw4491949caf4d26c7@mail.gmail.com>
References: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
	 <4b124c310910222239k7d1de1c1q8cb7c54165ad2f89@mail.gmail.com>
	 <E3137F97B0A0804194F369F4E7C3B71929AE7C91E6@EXCHANGE.persistent.co.in>
	 <4b124c310910222349n6906f9dcw4491949caf4d26c7@mail.gmail.com>
Content-Type: text/plain
Organization: Statsbiblioteket
Date: Fri, 23 Oct 2009 14:33:40 +0200
Message-ID: <1256301220.7373.1164.camel@pc286>
MIME-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

On Fri, 2009-10-23 at 08:49 +0200, Jake Mannix wrote:
>   One of the big problems you'll run into with this index size is that
> you'll never have enough RAM to give your OS's IO cache enough room to keep
> much of this index in memory, so you're going to be seeking in this monster
> file a lot. [...]

Solid State Drives helps a lot in this aspect. We've done experiments
with a 40GB index and adjustments of the amount of RAM available for
file cache. We observed that search-speed using SSD's weren't near as
susceptible to cache-size as conventional harddisks.

Some quick and fairly unstructured notes on our observations:
http://wiki.statsbiblioteket.dk/summa/Hardware

> [...]
> This may be mitigated by using really fast disks, possibly, which is yet
> another reason why you'll need to do some performance profiling on a 
> variety of sizes with similar-to-production data sets.

For our setup, a switch from conventional harddisks to SSDs moved the
bottleneck from I/O to CPU/RAM.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43013-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 14:35:55 2009
Return-Path: <java-user-return-43013-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71513 invoked from network); 23 Oct 2009 14:35:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 14:35:55 -0000
Received: (qmail 78644 invoked by uid 500); 23 Oct 2009 14:35:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78598 invoked by uid 500); 23 Oct 2009 14:35:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78588 invoked by uid 99); 23 Oct 2009 14:35:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 14:35:52 +0000
X-ASF-Spam-Status: No, hits=-2.5 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 14:35:49 +0000
Received: by ewy26 with SMTP id 26so9262967ewy.5
        for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 07:35:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=JtFFKDVJDnN7fHOTP7RIHWryHNlwJHqhxHehqiejQLo=;
        b=mW4DC5gR9Ae6kQ5igGeCivLIKmi4LR6IOHbkAXeDPsPvkVQiefVFUFEzr+lE2KgMfm
         Ep8q/B49HK0wcte0uL6vED00W1RImezkxPEU9NqBWBVL8hoqe4kQYcqfBl9o4dlmp5Yx
         yagL1wgal2BI22Aei4IEjtMgzDv0kaYMrBuTk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=nejHRckFGdDFsdl/tAx7zsJQbfuYekKJGl3YlfXhP1gKewm6zYxrFtejV9g5M6FbiX
         Jc7Ehmxn7T+K4DJxQ03GbHl7QW3kbSe4UIbXItCzutWSaAeoeymCaqdwf0kU/gL+1tKE
         k+1wTsDSdzScfFhd7+IQw1xzerlAB59Id//kM=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.89.195 with SMTP id c45mr3949951wef.38.1256308527825; Fri, 
	23 Oct 2009 07:35:27 -0700 (PDT)
In-Reply-To: <20df37d0910222318t1da20521l5844ad17656856e8@mail.gmail.com>
References: <20df37d0910222318t1da20521l5844ad17656856e8@mail.gmail.com>
Date: Fri, 23 Oct 2009 10:35:27 -0400
X-Google-Sender-Auth: a4f41daa42ca8da7
Message-ID: <c68e39170910230735l549a7367y4941f25b45d3e95f@mail.gmail.com>
Subject: Re: help needed improving lucene concurret search performance
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

How many processors do you have on this system?
If you are CPU bound, 100 threads is going to be 10 times slower (at a
minimum) than 10 threads (unless you have more than 10 CPUs).

-Yonik
http://www.lucidimagination.com

On Fri, Oct 23, 2009 at 2:18 AM, Wilson Wu <songzi0206@gmail.com> wrote:
> Dear Friend,
> =A0 =A0 I have encountered some performance problems recently in lucene
> search 2.9. I use a single IndexSearcher in the whole system, It seems
> perfect when there is less than 10 threads doing search concurrenty.
> Bu if there is more than 100 threads doing concurrent search,the
> average response time is becoming bigger(>1s),and the max response
> time reaches 299s. I really don't know how to improve,can you help me?
> =A0 Thanks a lot !
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Wilson
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A02009.10.23
> =A0 =A0The profiling result about 400 concurret search is at:
> http://i3.6.cn/cvbnm/aa/f5/00/63521d982a469f5063b82268eee91d08.gif
> it seems a lot of time consumed by TermScorer.score.
> =A0 =A0Follewing is my servlet class which is reponse to search request:
> public final class DispatchServlet extends
> javax.servlet.http.HttpServlet implements javax.servlet.Servlet
> {
> =A0 =A0 =A0private static final long serialVersionUID =3D -55476470060049=
00451L;
> =A0 =A0 =A0protected final Log log =3D LogFactory.getLog(getClass());
> =A0 =A0 =A0protected Searcher searcher;
> =A0 =A0 =A0protected Directory dir;
> =A0 =A0 =A0protected RAMDirectory ram;
>
> =A0 =A0public DispatchServlet() {
> =A0 =A0 =A0 =A0super();
> =A0 =A0 }
>
> =A0 =A0public void init() throws ServletException {
> =A0 =A0 =A0 =A0super.init();
> =A0 =A0 =A0 =A0try {
>
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 dir =3D FSDirectory.open(new
> File("/usr/bestv/search_engin_index/index/program"));
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0ram =3D new RAMDirectory(dir);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0searcher =3D new IndexSearcher(ram,true);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0int h =3D searcher.search(tq,null,1).total=
Hits;
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0System.out.println("the searcher has warme=
d and
> searched " + h + " docs" );
> =A0 =A0 =A0 =A0 =A0 =A0}
> =A0 =A0 =A0 =A0} catch (IOException e) {
> =A0 =A0 =A0 =A0 =A0 =A0log.error(e);
> =A0 =A0 =A0 =A0}
> =A0}
>
> protected void doPost(HttpServletRequest request, HttpServletResponse
> response) throws ServletException, IOException {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 response.setContentType("text/html");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 doExecute(request.getParameter("q"),response)=
;
> =A0 =A0 =A0 }
>
> protected void doGet(HttpServletRequest request, HttpServletResponse
> response) throws ServletException, IOException {
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 response.setContentType("text/html");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 try{
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 String schCon =3D
> URLDecoder.decode(request.getParameter("q"),"UTF-8");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 doExecute(schCon,response);
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }catch(Exception e){
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 response.getWriter().write("P=
arameter
> Error,please send param 'q'");
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 }
> =A0 =A0 =A0 }
>
> =A0 =A0public void doExecute(String schCon,HttpServletResponse response)
> throws ServletException,IOException{
> =A0 =A0 =A0 =A0 =A0 =A0 =A0 response.getWriter().write(new SearchCommand(=
).search(searcher));
> =A0}
>
> }
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43014-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 16:28:30 2009
Return-Path: <java-user-return-43014-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10626 invoked from network); 23 Oct 2009 16:28:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 16:28:30 -0000
Received: (qmail 73271 invoked by uid 500); 23 Oct 2009 16:28:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73229 invoked by uid 500); 23 Oct 2009 16:28:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73179 invoked by uid 99); 23 Oct 2009 16:28:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 16:28:25 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [139.56.8.26] (HELO mail-fw.broadvision.com) (139.56.8.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 16:28:17 +0000
X-ASG-Debug-ID: 1256315275-6b8c00a50000-H1Y1KX
X-Barracuda-URL: http://mail-fw.broadvision.com:8000/cgi-bin/mark.cgi
Received: from RW-EX2003.BROADVISION.COM (localhost [127.0.0.1])
	by mail-fw.broadvision.com (Spam Firewall) with ESMTP id 01F5595C0B
	for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 09:27:56 -0700 (PDT)
Received: from RW-EX2003.BROADVISION.COM (rw-ex2003.broadvision.com [10.10.160.33]) by mail-fw.broadvision.com with ESMTP id SmxYV7Plkx2wurrB for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 09:27:56 -0700 (PDT)
X-ASG-Whitelist: Client
X-MimeOLE: Produced By Microsoft Exchange V6.5
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-ASG-Orig-Subj: RE: Lucene 1.4.3 "Already closed" IOException
Subject: RE: Lucene 1.4.3 "Already closed" IOException
Date: Fri, 23 Oct 2009 09:27:55 -0700
Message-ID: <ED081AC9AEEE0248BBCCDE9989AAE3FC0151FF21@rw-ex2003.BROADVISION.COM>
In-Reply-To: <9ac0c6aa0910210312u477d1539idd5e81c8fa57fa7f@mail.gmail.com>
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: Lucene 1.4.3 "Already closed" IOException
Thread-Index: AcpSNxEPdcjPZ3FRTRGHbhNwiQACyQBxAlsQ
From: "Zhang, Lisheng" <Lisheng.Zhang@BroadVision.com>
To: <java-user@lucene.apache.org>
X-Barracuda-Connect: rw-ex2003.broadvision.com[10.10.160.33]
X-Barracuda-Start-Time: 1256315276
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at broadvision.com
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Michael and Ian,

Thanks very much for helps, I will investigate and test more.

Best regards, Lisheng

-----Original Message-----
From: Michael McCandless [mailto:lucene@mikemccandless.com]
Sent: Wednesday, October 21, 2009 3:13 AM
To: java-user@lucene.apache.org
Subject: Re: Lucene 1.4.3 "Already closed" IOException


Make sure you are not closing the IndexSearcher while still using a
Hits object obtained from it in the past.  Hits goes back and re-runs
the search if you iterate deep enough...

Mike

On Wed, Oct 21, 2009 at 5:39 AM, Ian Lea <ian.lea@gmail.com> wrote:
> 1.4.3? =A0How old is that? =A0Maybe time to consider an upgrade.
>
> Anyway, if you're getting that exception when creating a searcher I
> guess you are using a constructor that takes an IndexReader and a
> further guess would be that something has closed it.
>
> --
> Ian.
>
>
> On Tue, Oct 20, 2009 at 6:41 PM, Zhang, Lisheng
> <Lisheng.Zhang@broadvision.com> wrote:
>> Hi,
>>
>> We are using lucene 1.4.3, sometimes we encounter an error when =
creating
>> Searcher object with IOException: "Already closed".
>>
>> I searched lucene message archive but did not see conclusive answer, =
any
>> help would be very appreciated.
>>
>> Best regards, Lisheng
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43015-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 16:38:08 2009
Return-Path: <java-user-return-43015-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13358 invoked from network); 23 Oct 2009 16:38:08 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 16:38:08 -0000
Received: (qmail 95973 invoked by uid 500); 23 Oct 2009 16:38:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 95933 invoked by uid 500); 23 Oct 2009 16:38:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 95921 invoked by uid 99); 23 Oct 2009 16:38:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 16:38:05 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 16:37:53 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N1N8u-0006lg-Hm
	for java-user@lucene.apache.org; Fri, 23 Oct 2009 09:37:32 -0700
Message-ID: <26029632.post@talk.nabble.com>
Date: Fri, 23 Oct 2009 09:37:32 -0700 (PDT)
From: mitu2009 <musicfreaque@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: Handling + as a special character in Lucene search
In-Reply-To: <26002815.post@talk.nabble.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: musicfreaque@gmail.com
References: <26002815.post@talk.nabble.com>
X-Virus-Checked: Checked by ClamAV on apache.org


Code details: When I execute this line,I get a blank search query.

queryField =
multiFieldQueryParser.Parse(inpKeywords);keywordsQuery.Add(queryField,
BooleanClause.Occur.SHOULD);And here is my custom analyzer:

public class CustomAnalyzer : Analyzer    {        private static readonly
WhitespaceAnalyzer whitespaceAnalyzer = new WhitespaceAnalyzer();    public
override TokenStream TokenStream(String fieldName, System.IO.TextReader
reader)        {            TokenStream result =
whitespaceAnalyzer.TokenStream(fieldName, reader);            result = new
StandardTokenizer(reader);            result = new LowerCaseFilter(result);           
result = new StopFilter(result, stop_words);            return result;       
}}And I'm executing search query this way:

indexSearcher.Search(searchQuery, collector);QueryParser has Escape(string
s) method but MultiFieldQueryParser does not seem to have one.Am using
Lucene.net version 2.1.0.3


Thanks for reading.



mitu2009 wrote:
> 
> How do i make sure lucene gives me back relevant search results when my
> input string contains terms like c++? Lucene seems to ignore ++
> characters.
> 
> Code details: When I execute this line,I get a blank search query.
> 
> queryField =
> multiFieldQueryParser.Parse(inpKeywords);keywordsQuery.Add(queryField,
> BooleanClause.Occur.SHOULD);And here is my custom analyzer:
> 
> public class CustomAnalyzer : Analyzer    {        private static readonly
> WhitespaceAnalyzer whitespaceAnalyzer = new WhitespaceAnalyzer();   
> public override TokenStream TokenStream(String fieldName,
> System.IO.TextReader reader)        {            TokenStream result =
> whitespaceAnalyzer.TokenStream(fieldName, reader);            result = new
> StandardTokenizer(reader);            result = new
> LowerCaseFilter(result);            result = new StopFilter(result,
> stop_words);            return result;        }}And I'm executing search
> query this way:
> 
> indexSearcher.Search(searchQuery, collector);
> 
> QueryParser has Escape(string s) method but MultiFieldQueryParser does not
> seem to have one.Am using Lucene.net version 2.1.0.3
> 
> 
> 

-- 
View this message in context: http://www.nabble.com/Handling-%2B-as-a-special-character-in-Lucene-search-tp26002815p26029632.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43016-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 18:13:22 2009
Return-Path: <java-user-return-43016-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40245 invoked from network); 23 Oct 2009 18:13:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 18:13:22 -0000
Received: (qmail 30517 invoked by uid 500); 23 Oct 2009 18:13:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 30444 invoked by uid 500); 23 Oct 2009 18:13:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 30434 invoked by uid 99); 23 Oct 2009 18:13:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 18:13:19 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 18:13:16 +0000
Received: by yxe30 with SMTP id 30so12302520yxe.29
        for <java-user@lucene.apache.org>; Fri, 23 Oct 2009 11:12:55 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.87.28 with SMTP id k28mr18748608ybb.275.1256321574771; 
	Fri, 23 Oct 2009 11:12:54 -0700 (PDT)
In-Reply-To: <1256301220.7373.1164.camel@pc286>
References: <E3137F97B0A0804194F369F4E7C3B71929AE7C8F75@EXCHANGE.persistent.co.in>
	 <4b124c310910222239k7d1de1c1q8cb7c54165ad2f89@mail.gmail.com>
	 <E3137F97B0A0804194F369F4E7C3B71929AE7C91E6@EXCHANGE.persistent.co.in>
	 <4b124c310910222349n6906f9dcw4491949caf4d26c7@mail.gmail.com>
	 <1256301220.7373.1164.camel@pc286>
Date: Fri, 23 Oct 2009 15:12:54 -0300
Message-ID: <c4e715d70910231112y5c6e2ceex97cedec4dad91493@mail.gmail.com>
Subject: Re: Maximum index file size
From: Felipe Lobo <felipe@goshme.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd5f15c301e2204769e2980

--000e0cd5f15c301e2204769e2980
Content-Type: text/plain; charset=ISO-8859-1

Hi, interesting discussion.
Supose my index now has 1 TB. I splitted into 16 hds (65GB per hd) in the
same machine with 16 cores.
Use parallelmultisearch it's a good idea for this structure?? Results wil be
fast?? Is there a better solution for this structure?

thanks,

On Fri, Oct 23, 2009 at 9:33 AM, Toke Eskildsen <te@statsbiblioteket.dk>wrote:

> On Fri, 2009-10-23 at 08:49 +0200, Jake Mannix wrote:
> >   One of the big problems you'll run into with this index size is that
> > you'll never have enough RAM to give your OS's IO cache enough room to
> keep
> > much of this index in memory, so you're going to be seeking in this
> monster
> > file a lot. [...]
>
> Solid State Drives helps a lot in this aspect. We've done experiments
> with a 40GB index and adjustments of the amount of RAM available for
> file cache. We observed that search-speed using SSD's weren't near as
> susceptible to cache-size as conventional harddisks.
>
> Some quick and fairly unstructured notes on our observations:
> http://wiki.statsbiblioteket.dk/summa/Hardware
>
> > [...]
> > This may be mitigated by using really fast disks, possibly, which is yet
> > another reason why you'll need to do some performance profiling on a
> > variety of sizes with similar-to-production data sets.
>
> For our setup, a switch from conventional harddisks to SSDs moved the
> bottleneck from I/O to CPU/RAM.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Felipe Lobo
www.jusbrasil.com.br

--000e0cd5f15c301e2204769e2980--

From java-user-return-43017-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 23 21:20:39 2009
Return-Path: <java-user-return-43017-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 1380 invoked from network); 23 Oct 2009 21:20:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 23 Oct 2009 21:20:39 -0000
Received: (qmail 3927 invoked by uid 500); 23 Oct 2009 21:20:35 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 3838 invoked by uid 500); 23 Oct 2009 21:20:35 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 3819 invoked by uid 99); 23 Oct 2009 21:20:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 21:20:34 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 23 Oct 2009 21:20:32 +0000
Received: by pzk6 with SMTP id 6so1029104pzk.29
        for <multiple recipients>; Fri, 23 Oct 2009 14:20:11 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.115.102.16 with SMTP id e16mr16332606wam.202.1256332811623; 
	Fri, 23 Oct 2009 14:20:11 -0700 (PDT)
Date: Fri, 23 Oct 2009 14:20:11 -0700
Message-ID: <660086cb0910231420i1dae40dfh5b54648046660ad9@mail.gmail.com>
Subject: New Technical White Papers on Apache Lucene 2.9 and Solr 1.4 from 
	Lucid Imagination
From: Tom Alt <solr-list@worldware.com>
To: solr-user@lucene.apache.org, java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64c2608f4dcc00476a0c641

--0016e64c2608f4dcc00476a0c641
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Hi -

FYI, Lucid's just put out a two white papers, one on Apache Lucene 2.9 and
one on Apache Solr 1.4:
- "What's New in Lucene 2.9" covers range of performance improvements and
new features (per segment indexing, trierange numeric analysis, and more),
along with recommendations for upgrading your Lucene application to the 2.9
release. Download (reg required) at
http://www.lucidimagination.com/whitepaper/whats-new-in-lucene-2-9?sc=3DAP.

- =93What=92s New in Solr 1.4.=94 also covers its performance and feature
improvements (such as improved Data Import Handler, java-based replication,
rich document acquisition and more) . Download (reg required) at
http://www.lucidimagination.com/whitepaper/whats-new-in-solr-1-4?sc=3DAP

Tom
www.lucidimagination.com

--0016e64c2608f4dcc00476a0c641--

From java-user-return-43018-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 24 13:50:19 2009
Return-Path: <java-user-return-43018-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71576 invoked from network); 24 Oct 2009 13:50:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 24 Oct 2009 13:50:19 -0000
Received: (qmail 24081 invoked by uid 500); 24 Oct 2009 13:50:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23988 invoked by uid 500); 24 Oct 2009 13:50:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23978 invoked by uid 99); 24 Oct 2009 13:50:17 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 13:50:17 +0000
X-ASF-Spam-Status: No, hits=-1.9 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of songzi0206@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 13:50:15 +0000
Received: by ywh13 with SMTP id 13so13628584ywh.29
        for <java-user@lucene.apache.org>; Sat, 24 Oct 2009 06:49:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=MYltRfh+9z0Btj0wYRtWuOsaiEWoxV4377WJZ89n5SQ=;
        b=wvtGjjxtaR2SpVqh8CJEUJGUG7cgHWAc9ae5/r+SOqj+EqiqUNtcNsq0ss1uA5qdp+
         gkf4lFMy47e6NV8VkcvkXTQuucespQS+QKODMIyXieESQhVneIoMV6iajJ0uBvOF+XcZ
         Pv2vCoMRlgsTKBDIZL7ulo/Jrtq6QilQSRc/I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=CrZiIf8AzdOJCUcr2rXS5JHzx0gYWqMwdRxxn4g3mLncrMbiRG993crxEPY8wRzndG
         e9zaxHaPYZcYMQuIsoH1ioWk71jEr3od3TYnehP4pQuBOgOoeV0xNJ6CiNNW+uvls+iB
         sJnkq6fDk2AtCFwhSxmyVNwFg3efQyTvUsw/4=
MIME-Version: 1.0
Received: by 10.150.44.3 with SMTP id r3mr20207915ybr.241.1256392194246; Sat, 
	24 Oct 2009 06:49:54 -0700 (PDT)
Date: Sat, 24 Oct 2009 21:49:54 +0800
Message-ID: <20df37d0910240649m4ba6d627v6bfa658b2ba3c79e@mail.gmail.com>
Subject: Re: help needed improving lucene concurret search performance
From: Wilson Wu <songzi0206@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hi,
      Thanks a lot for your reply. There are 4 processors in my system.
      I am not sure that 100 threads is going to be 10 times slower
than 10 threads .Because all the threads don't run serial but
parallel. I think when there are 100 customers accessing my system,100
http connections will be builded and all the http threads will be
responsed by the Servlet at the same time. My question is :
 when 100 threads do search concurrently, are there any resources
shared by differenet threads and these resources caused thread
waiting/blocking in lucene IndexSearcher? If it dose, how can I avoid.
Thanks again.

                                                       wilson

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43019-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 24 14:03:41 2009
Return-Path: <java-user-return-43019-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73395 invoked from network); 24 Oct 2009 14:03:41 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 24 Oct 2009 14:03:41 -0000
Received: (qmail 31317 invoked by uid 500); 24 Oct 2009 14:03:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31238 invoked by uid 500); 24 Oct 2009 14:03:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31227 invoked by uid 99); 24 Oct 2009 14:03:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 14:03:39 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of songzi0206@gmail.com designates 209.85.217.219 as permitted sender)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 14:03:31 +0000
Received: by gxk19 with SMTP id 19so6596906gxk.5
        for <java-user@lucene.apache.org>; Sat, 24 Oct 2009 07:03:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=R7zo1Ab/x93YHUezHN1Vj1tyPGw685RdggwEK4Je8hw=;
        b=RniSaC0t2OoUJVW2pnuhnwRuSeZglDlt6E7ZIXVMAMJLvUnakr7eKZwtP/VlIeUs3d
         XY4PE46Z3C8LMIyr/J3wgkNvhCmpheOap6GpQ+tIDrRv/xnfSJ6zICQlv1/FDlUDxQ/w
         yjQfedXH3+zJogEc+Zh3opSRg1+8U0vDdVX6U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=uznJkACk7413IycP4zsGXhgTd85IDQzB2V+K5tTOuddemBKIiQvPHAWd+jqJ21uNS2
         Y1TH2rqZW704evT5bgHfMQZ2LBoA9c3eH53WvJjFJ2gbnPD1TZvOk+ayfYJ4vPMOQpx4
         xDXMkJscdeoZiEXHWcEpIsGGWziF7LgG0/8JI=
MIME-Version: 1.0
Received: by 10.151.5.21 with SMTP id h21mr20260338ybi.26.1256392990198; Sat, 
	24 Oct 2009 07:03:10 -0700 (PDT)
In-Reply-To: <20df37d0910240649m4ba6d627v6bfa658b2ba3c79e@mail.gmail.com>
References: <20df37d0910240649m4ba6d627v6bfa658b2ba3c79e@mail.gmail.com>
Date: Sat, 24 Oct 2009 22:03:10 +0800
Message-ID: <20df37d0910240703v9a54fe5j556c823716c8c51b@mail.gmail.com>
Subject: Re: help needed improving lucene concurret search performance
From: Wilson Wu <songzi0206@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

---------- Forwarded message ----------
From: Wilson Wu <songzi0206@gmail.com>
Date: 2009/10/24
Subject: Re: help needed improving lucene concurret search performance
To: java-user@lucene.apache.org


Hi,
=A0 =A0 =A0Thanks a lot for your reply. There are 4 processors in my system=
.
=A0 =A0 =A0I am not sure that 100 threads is going to be 10 times slower
than 10 threads .Because all the threads don't run serial but
parallel. I think when there are 100 customers accessing my system,100
http connections will be builded and all the http threads will be
responsed by the Servlet at the same time. My question is :
=A0when 100 threads do search concurrently, are there any resources
shared by differenet threads and these resources caused thread
waiting/blocking in lucene IndexSearcher? If it dose, how can I avoid.
Thanks again.

=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0=
 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 wilson

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43020-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 24 21:20:33 2009
Return-Path: <java-user-return-43020-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56206 invoked from network); 24 Oct 2009 21:20:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 24 Oct 2009 21:20:33 -0000
Received: (qmail 48891 invoked by uid 500); 24 Oct 2009 21:20:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48795 invoked by uid 500); 24 Oct 2009 21:20:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48785 invoked by uid 99); 24 Oct 2009 21:20:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 21:20:30 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.204 as permitted sender)
Received: from [209.85.216.204] (HELO mail-px0-f204.google.com) (209.85.216.204)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 21:20:28 +0000
Received: by pxi42 with SMTP id 42so1988179pxi.5
        for <java-user@lucene.apache.org>; Sat, 24 Oct 2009 14:20:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=mi2EyBAO7LjfHI8CXI3zXZz6idhFc0uwMx5gJV3l68c=;
        b=QxhAwBOSW9eqUZwKE1FaHqbX1uknXAH9wgt2LIDxXLE+xVY2BmWnw0ROWrDrSEpiFx
         3NcPt2fY2Q9vKC+LBw2R6CdBvT3xNF5SYW5IQhH+YTrMDy1O6JvchKoiZLPpy05sRbMR
         cTT+9pzMy0lhZRgT85nV5AtriOtoEqwKNlcJY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=Y0gMn9DjHo4XxRNGCPwia6msP7f2DTjmCRRiVYDHA8fN/xYp52vTjAn4XsuUKTtb7h
         aN+RPUkZon+yB3hoxXmBZOnfklNAwcw36jbIrKAU+45+Us8dMOsCQ5OKLER1VrM4lI6D
         8A3nV2d254uwfeNYou0+UzmWCOjh+w2WRtupo=
MIME-Version: 1.0
Received: by 10.141.29.11 with SMTP id g11mr1941884rvj.99.1256419208326; Sat, 
	24 Oct 2009 14:20:08 -0700 (PDT)
Date: Sat, 24 Oct 2009 17:20:08 -0400
Message-ID: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
Subject: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=000e0cd1799c99f0ee0476b4e4ba

--000e0cd1799c99f0ee0476b4e4ba
Content-Type: text/plain; charset=ISO-8859-1

I'm sometimes seeing the following exception from an operation that does a
merge and optimize:
 java.io.IOException: background merge hit exception: _0:C1082866 _1:C79
into _2 [optimize] [mergeDocStores]
I'm pretty sure that it's caused by a temporary low disk space condition,
but I'd like to be able to confirm this. It would be nice to have the java
exception included in the Lucene exception. Any way to get this?

Peter

--000e0cd1799c99f0ee0476b4e4ba--

From java-user-return-43021-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 24 21:21:51 2009
Return-Path: <java-user-return-43021-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56318 invoked from network); 24 Oct 2009 21:21:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 24 Oct 2009 21:21:51 -0000
Received: (qmail 50713 invoked by uid 500); 24 Oct 2009 21:21:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 50645 invoked by uid 500); 24 Oct 2009 21:21:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 50635 invoked by uid 99); 24 Oct 2009 21:21:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 21:21:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.204 as permitted sender)
Received: from [209.85.216.204] (HELO mail-px0-f204.google.com) (209.85.216.204)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 Oct 2009 21:21:41 +0000
Received: by pxi42 with SMTP id 42so1988470pxi.5
        for <java-user@lucene.apache.org>; Sat, 24 Oct 2009 14:21:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=JSnSwW15m1gQkRpLSPTHHA4YKCjtb+a5A9LAUKVFCKI=;
        b=QvLIr461ME1k1JntovITa1pmg3Oqb9wEfMpVjjY9HZW75f7DoQNykBM0owskiLDyzX
         eezDvRlf0/IwoEJNq6ICYHW56FumD9sSXq0H6+6vT2gPTIpussLVmKixZCm6Fd40H0Y3
         wbAa/Wo5339y0KsdndO0wuYeq2i3Q1H7/MWJ8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=twhD5iclwst6rKrShbdHaSEtvIQmczB16pxdR5X9192fLRm5pIE5H9WVFyl+jqPHhQ
         38vpN6Le4t7XQzZIi8G38c0U7x9PW/K7dYT912Uh3lTaIPpgAPtlnqnH2dDBhCEa9b1k
         cBxyhCb0B9SCTp9DdNpv8nMp3Slg54pygitLg=
MIME-Version: 1.0
Received: by 10.141.3.15 with SMTP id f15mr107433rvi.2.1256419280106; Sat, 24 
	Oct 2009 14:21:20 -0700 (PDT)
In-Reply-To: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
Date: Sat, 24 Oct 2009 17:21:19 -0400
Message-ID: <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user <java-user@lucene.apache.org>
Content-Type: multipart/alternative; boundary=000e0cd11360e137950476b4e8d7
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd11360e137950476b4e8d7
Content-Type: text/plain; charset=ISO-8859-1

btw, this is with Lucene 2.9

On Sat, Oct 24, 2009 at 5:20 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> I'm sometimes seeing the following exception from an operation that does a
> merge and optimize:
>  java.io.IOException: background merge hit exception: _0:C1082866 _1:C79
> into _2 [optimize] [mergeDocStores]
> I'm pretty sure that it's caused by a temporary low disk space condition,
> but I'd like to be able to confirm this. It would be nice to have the java
> exception included in the Lucene exception. Any way to get this?
>
> Peter
>
>

--000e0cd11360e137950476b4e8d7--

From java-user-return-43022-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 25 12:48:00 2009
Return-Path: <java-user-return-43022-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97759 invoked from network); 25 Oct 2009 12:48:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 25 Oct 2009 12:48:00 -0000
Received: (qmail 19285 invoked by uid 500); 25 Oct 2009 12:47:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19188 invoked by uid 500); 25 Oct 2009 12:47:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19178 invoked by uid 99); 25 Oct 2009 12:47:58 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 25 Oct 2009 12:47:58 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 25 Oct 2009 12:47:55 +0000
Received: by ywh13 with SMTP id 13so14379741ywh.29
        for <java-user@lucene.apache.org>; Sun, 25 Oct 2009 05:47:34 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.15.15 with SMTP id 15mr21737174ybo.150.1256474854381; Sun, 
	25 Oct 2009 05:47:34 -0700 (PDT)
In-Reply-To: <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
Date: Sun, 25 Oct 2009 08:47:34 -0400
Message-ID: <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hmm... Lucene tries to catch the original cause (from the BG thread
doing the merge) and forward it to the main thread waiting for
optimize to complete.

Did you get any traceback printed at all?  It should include one
traceback into Lucene's optimized method, and then another (under
"caused by") showing the exception from the BG merge thread.

Did you see any BG thread exceptions on wherever your System.err is directe=
d to?

Mike

On Sat, Oct 24, 2009 at 5:21 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
> btw, this is with Lucene 2.9
>
> On Sat, Oct 24, 2009 at 5:20 PM, Peter Keegan <peterlkeegan@gmail.com>wro=
te:
>
>> I'm sometimes seeing the following exception from an operation that does=
 a
>> merge and optimize:
>> =A0java.io.IOException: background merge hit exception: _0:C1082866 _1:C=
79
>> into _2 [optimize] [mergeDocStores]
>> I'm pretty sure that it's caused by a temporary low disk space condition=
,
>> but I'd like to be able to confirm this. It would be nice to have the ja=
va
>> exception included in the Lucene exception. Any way to get this?
>>
>> Peter
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43023-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sun Oct 25 23:36:21 2009
Return-Path: <java-user-return-43023-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27374 invoked from network); 25 Oct 2009 23:36:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 25 Oct 2009 23:36:21 -0000
Received: (qmail 63925 invoked by uid 500); 25 Oct 2009 23:36:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63851 invoked by uid 500); 25 Oct 2009 23:36:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63841 invoked by uid 99); 25 Oct 2009 23:36:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 25 Oct 2009 23:36:19 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.222.176 as permitted sender)
Received: from [209.85.222.176] (HELO mail-pz0-f176.google.com) (209.85.222.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sun, 25 Oct 2009 23:36:11 +0000
Received: by pzk6 with SMTP id 6so1866353pzk.29
        for <java-user@lucene.apache.org>; Sun, 25 Oct 2009 16:35:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=WFf5zv2j32jvGSJiQWaHDMw51AswB/ozlCQ19TN1oMc=;
        b=uViuGaRak3RfcsQLQRqn/g5Ms3ARIzs0kduPS42lZqvbok2cdxq1EhC0PGCoda6nnt
         97efDsaLJPRVnOavtjMx39nG9M3Tu4lF3UrS9xIrOiwtC0A1KcvA5YkIwTAlekzT1jWf
         ys8zO13l9wRif5x/jmx+JqShY074kz9HPVAKQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=eJgp1XDx7y44taABCY4CaJ7xiMrN8kwlRtFbiENcl7J/+XBsRCuWeU+jZK5mJPU5y0
         ul4vE+5jLZ7jyLywu0w45+76XG1r+47cr350lTtGxRQl2H0/AUn/PooSaYwVKTH4X411
         xjiqw8f13UMnhgcKnfHYu4WlB/z/7fqjIqTDA=
MIME-Version: 1.0
Received: by 10.140.177.20 with SMTP id z20mr1967275rve.100.1256513749668; 
	Sun, 25 Oct 2009 16:35:49 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
Date: Sun, 25 Oct 2009 19:35:49 -0400
Message-ID: <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd21410b454dd0476cae715
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd21410b454dd0476cae715
Content-Type: text/plain; charset=ISO-8859-1

>Did you get any traceback printed at all?
no, only what I reported.

>Did you see any BG thread exceptions on wherever your System.err is
directed to?
The jvm was running as a windows service, so output to System.err may have
gone to the bit bucket.
That's an interesting point, though.

Peter


On Sun, Oct 25, 2009 at 8:47 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Hmm... Lucene tries to catch the original cause (from the BG thread
> doing the merge) and forward it to the main thread waiting for
> optimize to complete.
>
> Did you get any traceback printed at all?  It should include one
> traceback into Lucene's optimized method, and then another (under
> "caused by") showing the exception from the BG merge thread.
>
> Did you see any BG thread exceptions on wherever your System.err is
> directed to?
>
> Mike
>
> On Sat, Oct 24, 2009 at 5:21 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > btw, this is with Lucene 2.9
> >
> > On Sat, Oct 24, 2009 at 5:20 PM, Peter Keegan <peterlkeegan@gmail.com
> >wrote:
> >
> >> I'm sometimes seeing the following exception from an operation that does
> a
> >> merge and optimize:
> >>  java.io.IOException: background merge hit exception: _0:C1082866 _1:C79
> >> into _2 [optimize] [mergeDocStores]
> >> I'm pretty sure that it's caused by a temporary low disk space
> condition,
> >> but I'd like to be able to confirm this. It would be nice to have the
> java
> >> exception included in the Lucene exception. Any way to get this?
> >>
> >> Peter
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd21410b454dd0476cae715--

From java-user-return-43024-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 00:40:45 2009
Return-Path: <java-user-return-43024-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36036 invoked from network); 26 Oct 2009 00:40:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 00:40:45 -0000
Received: (qmail 81343 invoked by uid 500); 26 Oct 2009 00:40:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81255 invoked by uid 500); 26 Oct 2009 00:40:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81245 invoked by uid 99); 26 Oct 2009 00:40:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 00:40:43 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 00:40:35 +0000
Received: by yxe30 with SMTP id 30so14399618yxe.29
        for <java-user@lucene.apache.org>; Sun, 25 Oct 2009 17:40:13 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.44.24 with SMTP id r24mr6157609ybr.249.1256517613578; Sun, 
	25 Oct 2009 17:40:13 -0700 (PDT)
In-Reply-To: <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
Date: Sun, 25 Oct 2009 20:40:13 -0400
Message-ID: <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hmm, if you got no exception whatsoever, something more fundamental
seems to be wrong w/ the error reporting when running as a windows
service.  Maybe make a simple Java test program that throws an
exception and try to get that working?

Mike

On Sun, Oct 25, 2009 at 7:35 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
>>Did you get any traceback printed at all?
> no, only what I reported.
>
>>Did you see any BG thread exceptions on wherever your System.err is
> directed to?
> The jvm was running as a windows service, so output to System.err may hav=
e
> gone to the bit bucket.
> That's an interesting point, though.
>
> Peter
>
>
> On Sun, Oct 25, 2009 at 8:47 AM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> Hmm... Lucene tries to catch the original cause (from the BG thread
>> doing the merge) and forward it to the main thread waiting for
>> optimize to complete.
>>
>> Did you get any traceback printed at all? =A0It should include one
>> traceback into Lucene's optimized method, and then another (under
>> "caused by") showing the exception from the BG merge thread.
>>
>> Did you see any BG thread exceptions on wherever your System.err is
>> directed to?
>>
>> Mike
>>
>> On Sat, Oct 24, 2009 at 5:21 PM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > btw, this is with Lucene 2.9
>> >
>> > On Sat, Oct 24, 2009 at 5:20 PM, Peter Keegan <peterlkeegan@gmail.com
>> >wrote:
>> >
>> >> I'm sometimes seeing the following exception from an operation that d=
oes
>> a
>> >> merge and optimize:
>> >> =A0java.io.IOException: background merge hit exception: _0:C1082866 _=
1:C79
>> >> into _2 [optimize] [mergeDocStores]
>> >> I'm pretty sure that it's caused by a temporary low disk space
>> condition,
>> >> but I'd like to be able to confirm this. It would be nice to have the
>> java
>> >> exception included in the Lucene exception. Any way to get this?
>> >>
>> >> Peter
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43025-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 00:54:34 2009
Return-Path: <java-user-return-43025-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43930 invoked from network); 26 Oct 2009 00:54:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 00:54:33 -0000
Received: (qmail 89411 invoked by uid 500); 26 Oct 2009 00:54:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 89370 invoked by uid 500); 26 Oct 2009 00:54:31 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 89360 invoked by uid 99); 26 Oct 2009 00:54:31 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 00:54:31 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.193 as permitted sender)
Received: from [209.85.216.193] (HELO mail-px0-f193.google.com) (209.85.216.193)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 00:54:29 +0000
Received: by pxi31 with SMTP id 31so3009147pxi.20
        for <java-user@lucene.apache.org>; Sun, 25 Oct 2009 17:54:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=3OZh1Si863hw+66OMlq6TaQKH0GTb7/g3dCTBhxdJ2o=;
        b=AKyl/RXLsbesIx6jGVUF5tNPMteFyB70RqnHHiNEp9xTcR7S2Y+o97Haux3iG0xqJP
         dDtEJMoPjgNCagugCudza9U+uR8tfzyWrW+tr5f9rV0xymmgMa2C9rweqsYq6Qs5+LwU
         IuaR8ClK/IlL6GL8vRDc+KQA14vIohW/S5p1Q=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=KmvsZsjBIZotFLNpvzw6YXq1WjHgH417VjXd1qBW9l+xvt7P0IG+Mjjd8xa9nQWEyJ
         qfVGNCTZ4mi5JNuNJ6kNjtICiAkSsACH1F4t1JtAbHHxGnvRu8973+ZEkT1kqgZZdPTk
         ZEs7kjOM6dcYER6Bpnnd8ZDjUNPnCy27ehdNI=
MIME-Version: 1.0
Received: by 10.140.136.9 with SMTP id j9mr1960875rvd.136.1256518448726; Sun, 
	25 Oct 2009 17:54:08 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
Date: Sun, 25 Oct 2009 20:54:08 -0400
Message-ID: <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd2908aca439b0476cbff2a

--000e0cd2908aca439b0476cbff2a
Content-Type: text/plain; charset=ISO-8859-1

The environment involves a lot of I/O from merge/optimize operations on
multiple indexes (shards) on one server.
I will try running the indexers in console mode, where I would expect to see
all errors and exceptions.

Peter


On Sun, Oct 25, 2009 at 8:40 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Hmm, if you got no exception whatsoever, something more fundamental
> seems to be wrong w/ the error reporting when running as a windows
> service.  Maybe make a simple Java test program that throws an
> exception and try to get that working?
>
> Mike
>
> On Sun, Oct 25, 2009 at 7:35 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> >>Did you get any traceback printed at all?
> > no, only what I reported.
> >
> >>Did you see any BG thread exceptions on wherever your System.err is
> > directed to?
> > The jvm was running as a windows service, so output to System.err may
> have
> > gone to the bit bucket.
> > That's an interesting point, though.
> >
> > Peter
> >
> >
> > On Sun, Oct 25, 2009 at 8:47 AM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> Hmm... Lucene tries to catch the original cause (from the BG thread
> >> doing the merge) and forward it to the main thread waiting for
> >> optimize to complete.
> >>
> >> Did you get any traceback printed at all?  It should include one
> >> traceback into Lucene's optimized method, and then another (under
> >> "caused by") showing the exception from the BG merge thread.
> >>
> >> Did you see any BG thread exceptions on wherever your System.err is
> >> directed to?
> >>
> >> Mike
> >>
> >> On Sat, Oct 24, 2009 at 5:21 PM, Peter Keegan <peterlkeegan@gmail.com>
> >> wrote:
> >> > btw, this is with Lucene 2.9
> >> >
> >> > On Sat, Oct 24, 2009 at 5:20 PM, Peter Keegan <peterlkeegan@gmail.com
> >> >wrote:
> >> >
> >> >> I'm sometimes seeing the following exception from an operation that
> does
> >> a
> >> >> merge and optimize:
> >> >>  java.io.IOException: background merge hit exception: _0:C1082866
> _1:C79
> >> >> into _2 [optimize] [mergeDocStores]
> >> >> I'm pretty sure that it's caused by a temporary low disk space
> >> condition,
> >> >> but I'd like to be able to confirm this. It would be nice to have the
> >> java
> >> >> exception included in the Lucene exception. Any way to get this?
> >> >>
> >> >> Peter
> >> >>
> >> >>
> >> >
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd2908aca439b0476cbff2a--

From java-user-return-43026-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 06:37:16 2009
Return-Path: <java-user-return-43026-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17877 invoked from network); 26 Oct 2009 06:37:16 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 06:37:16 -0000
Received: (qmail 10120 invoked by uid 500); 26 Oct 2009 06:37:14 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10030 invoked by uid 500); 26 Oct 2009 06:37:14 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10019 invoked by uid 99); 26 Oct 2009 06:37:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 06:37:14 +0000
X-ASF-Spam-Status: No, hits=-1.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [76.13.12.136] (HELO web59601.mail.ac4.yahoo.com) (76.13.12.136)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 26 Oct 2009 06:37:11 +0000
Received: (qmail 4235 invoked by uid 60001); 26 Oct 2009 06:36:50 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256539010; bh=JhnquqExFnQoYY0Q9hiu5l+J2axvllkC0is1prdTyDA=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=mr9xL8fGteWMYD+EhX6Bd1csXH3Q67VD6JLjBrnluRwDgRI7+KdFQxvY8poUYk5g/g2kH2l7Dcsm2O2/DeY9ICSNXf+wxAwrOQvEG6k+MeQg7haGwHEElRNgf4fDsN1rINT6f6S7DfSWSA0pXdjrN794jsMXkXC6uSglD2O0ygU=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=Zq5lVaGzSlXg21dgAwsEUHj8r/IPQy0qdgkC7fVhifu7mS2cGEYwo8fG9EldcBcmVqvFf+upfDte+kH7mssweIs40EodAhV6buKHyfNQBNOC5ngjkYcSxIs3CI5d0l1TFFGHOrjrD7PLBwSTTkI+DxSTXtiOGeqED+nrZHZfBzE=;
Message-ID: <325546.4166.qm@web59601.mail.ac4.yahoo.com>
X-YMail-OSG: 4JLJKAYVM1lxvZ7vq8DzGICkMUJ7SEQ2gxIv.am7hHk8cIKHa5bQFvZ6FbBTjyuUn4sSvfte9sxQ4NaSJPP1hfXerA.qmnr8C6NoDClsvTyXjkA06Wc43wBNLpgFTBXtNIKYVAVE_.230GKfF_hfh.XO5Ztj0FRk9O2tuahSOk17AuYxD_uSuVAv96pP3DQHIswnKgeJSagUZyqzAbR99NQeCcsZTDY7nCV52sf1XL_E93n5_blv0KPaL_oQv70YEc3rKBdPHNrTNfUHaPEDWnVAE5QFwgsRePUAGA--
Received: from [59.90.244.83] by web59601.mail.ac4.yahoo.com via HTTP; Sun, 25 Oct 2009 23:36:50 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Sun, 25 Oct 2009 23:36:50 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Exception in thread main - error
To: java user <java-user@lucene.apache.org>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-210314347-1256539010=:4166"

--0-210314347-1256539010=:4166
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Sir/Mam,
=A0
Am M.Dhivya, learning about apache lucene [Java].
=A0
I have installed JDK-6 update 4 and NetBeans-6.5.1
=A0
I downloaded the lucene-1.9-final.zip file and followed the steps given in =
docs to run the demo.
=A0
The extracted=A0lucene-1.9-final folder from the downloaded zip file is in =
D:\=20
and the lucene-core-1.9-final.jar , lucene-demos-1.9-final.jar and=A0src is=
 in
=A0
D:\lucene-1.9-final\
=A0
As said i have=A0set the classpath in environment variable PATH in System p=
roperties as,
D:\lucene-1.9-final\lucene-core-1.9-final.jar; D:\lucene-1.9-final\lucene-d=
emos-1.9-final.jar;
=A0
Then in the command prompt i gave the command,
D:\lucene-1.9-final>java org.apache.lucene.demo.IndexFiles d:\lucene-1.9-fi=
nal\src
=A0
But got the following error:

Exception in thread "main" java.lang.NoClassDefFoundError: org/apache/lucen=
e/dem
o/IndexFiles
Caused by: java.lang.ClassNotFoundException: org.apache.lucene.demo.IndexFi=
les
=A0=A0=A0=A0=A0=A0=A0 at java.net.URLClassLoader$1.run(Unknown Source)
=A0=A0=A0=A0=A0=A0=A0 at java.security.AccessController.doPrivileged(Native=
 Method)
=A0=A0=A0=A0=A0=A0=A0 at java.net.URLClassLoader.findClass(Unknown Source)
=A0=A0=A0=A0=A0=A0=A0 at java.lang.ClassLoader.loadClass(Unknown Source)
=A0=A0=A0=A0=A0=A0=A0 at sun.misc.Launcher$AppClassLoader.loadClass(Unknown=
 Source)
=A0=A0=A0=A0=A0=A0=A0 at java.lang.ClassLoader.loadClass(Unknown Source)
=A0=A0=A0=A0=A0=A0=A0 at java.lang.ClassLoader.loadClassInternal(Unknown So=
urce)

Am=A0 a beginner just started to learn about lucene by my own interest afte=
r knowing about its value. But now am scared as the things are totally blin=
d for me. I went in through all the forums but couldnt find the solution. I=
 couldnt find out where am missing or my procedure to run lucene demo is wr=
ong. Kindly let me know a solution for which am struggling for past one wee=
k.
=A0
Thanks in advance
=A0M.Dhivya=0A=0A=0A      
--0-210314347-1256539010=:4166--

From java-user-return-43027-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 06:46:14 2009
Return-Path: <java-user-return-43027-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19050 invoked from network); 26 Oct 2009 06:46:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 06:46:14 -0000
Received: (qmail 17826 invoked by uid 500); 26 Oct 2009 06:46:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17755 invoked by uid 500); 26 Oct 2009 06:46:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17745 invoked by uid 99); 26 Oct 2009 06:46:11 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 06:46:11 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 06:46:09 +0000
Received: by pzk3 with SMTP id 3so7292889pzk.20
        for <java-user@lucene.apache.org>; Sun, 25 Oct 2009 23:45:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=MksjO9bbzwd1xWr5ZnJlIiVNhlopYMJHjN1IqMhy7ZI=;
        b=WqVieB0PFyXqBCBKSaWsxwseXRROzxW1IQyerfaKrjhPoeJYFiPHsB3xAmRNk61o79
         s1vT/KsOxFYbECLQrSvGQ0QAt4qCyO9Rn1dXlCaqZl+DgOjGlmnLkFhgIL8adSNLLoJd
         ZmqJOTzbNdatwLBrH1dneEoKntXr6UVXlhz3w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=wfpeu/pHISdXSAEYJiNmzmV8Hm9+UMFEAOqRfMffQM7YoZMcP8/9Vzjk45bEPbqDMW
         zSqu1SspBUIhECDKRCz7/zRj8qg/sMoZ3s1Kh6z3MyYcCw/DfiCeMnf3IokFSz8tWWoQ
         LRD31zJY9CoQO4paE00bKz0KD4mSd0BDkAISg=
MIME-Version: 1.0
Received: by 10.115.117.4 with SMTP id u4mr22204354wam.43.1256539549085; Sun, 
	25 Oct 2009 23:45:49 -0700 (PDT)
In-Reply-To: <325546.4166.qm@web59601.mail.ac4.yahoo.com>
References: <325546.4166.qm@web59601.mail.ac4.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Mon, 26 Oct 2009 12:15:29 +0530
Message-ID: <867513fe0910252345r38d0063evb0bfcb9dd09d8a7b@mail.gmail.com>
Subject: Re: Exception in thread main - error
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64e90987832160476d0e9ff

--0016e64e90987832160476d0e9ff
Content-Type: text/plain; charset=ISO-8859-1

Hi Dhivya,
It'd be a wise step to upgrade to a more recent lucene release. 2.9 (though
that does not mean that the issue you encountered was because of that) would
be ideal I'd say, but could also try 2.4.


--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Mon, Oct 26, 2009 at 12:06 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Sir/Mam,
>
> Am M.Dhivya, learning about apache lucene [Java].
>
> I have installed JDK-6 update 4 and NetBeans-6.5.1
>
> I downloaded the lucene-1.9-final.zip file and followed the steps given in
> docs to run the demo.
>
> The extracted lucene-1.9-final folder from the downloaded zip file is in
> D:\
> and the lucene-core-1.9-final.jar , lucene-demos-1.9-final.jar and src is
> in
>
> D:\lucene-1.9-final\
>
> As said i have set the classpath in environment variable PATH in System
> properties as,
> D:\lucene-1.9-final\lucene-core-1.9-final.jar;
> D:\lucene-1.9-final\lucene-demos-1.9-final.jar;
>
> Then in the command prompt i gave the command,
> D:\lucene-1.9-final>java org.apache.lucene.demo.IndexFiles
> d:\lucene-1.9-final\src
>
> But got the following error:
>
> Exception in thread "main" java.lang.NoClassDefFoundError:
> org/apache/lucene/dem
> o/IndexFiles
> Caused by: java.lang.ClassNotFoundException:
> org.apache.lucene.demo.IndexFiles
>         at java.net.URLClassLoader$1.run(Unknown Source)
>         at java.security.AccessController.doPrivileged(Native Method)
>         at java.net.URLClassLoader.findClass(Unknown Source)
>         at java.lang.ClassLoader.loadClass(Unknown Source)
>         at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
>         at java.lang.ClassLoader.loadClass(Unknown Source)
>         at java.lang.ClassLoader.loadClassInternal(Unknown Source)
>
> Am  a beginner just started to learn about lucene by my own interest after
> knowing about its value. But now am scared as the things are totally blind
> for me. I went in through all the forums but couldnt find the solution. I
> couldnt find out where am missing or my procedure to run lucene demo is
> wrong. Kindly let me know a solution for which am struggling for past one
> week.
>
> Thanks in advance
>  M.Dhivya
>
>
>

--0016e64e90987832160476d0e9ff--

From java-user-return-43028-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 07:13:43 2009
Return-Path: <java-user-return-43028-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30076 invoked from network); 26 Oct 2009 07:13:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 07:13:43 -0000
Received: (qmail 35666 invoked by uid 500); 26 Oct 2009 07:13:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35590 invoked by uid 500); 26 Oct 2009 07:13:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35580 invoked by uid 99); 26 Oct 2009 07:13:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 07:13:41 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [76.13.12.202] (HELO web59612.mail.ac4.yahoo.com) (76.13.12.202)
    by apache.org (qpsmtpd/0.29) with SMTP; Mon, 26 Oct 2009 07:13:31 +0000
Received: (qmail 98351 invoked by uid 60001); 26 Oct 2009 07:13:09 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256541189; bh=vctT5sCUKZJX4UkOb+8Qd4BTazjp1QZZtfvDOnT3XVs=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=lNup8Si5hx9S96hUQYxelsIhQxeYh8vYTf+IbCGc5fB+EbxBCrLrjnXDfgiUp0uVoTTK1VLC3arcA4RxXFCbk3zo6fdSb2oS/SxiUBfmsaJtB/AEVkvgEo/gWAXqOOH6yG5uRAxSUU7KAoRnEk3MrrzvAv5qUeBuZiZeQ66acAs=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=vsEaNUHgObjBreooMMqRNcTPeFfEcE0hbDZfQsIvDw6iWgn/5Y3qeU459i+YBSFgr80t6So4cn+md9twVNMwWSjCW+Q83coFkZ7tPHsJMfygv4pVsad3pw3tJjMQ4PRvlkwklo6Ct468wrWRgXyrQXq2Vo7llpCbbpKEdKOaC80=;
Message-ID: <890422.97621.qm@web59612.mail.ac4.yahoo.com>
X-YMail-OSG: 766ClSIVM1lNQGd7it2QsDPF6dxx5wbYfydQ3R9xSDelBuQw1xpbwNo_3cZzon10CbaRh_xLFKCdbSvXKCr3EVtcnkxfoiuUBkJt7tRhUrMdyHE_YFaQVwVvr3aDVZEH1mQc7MoKuEkGFh3DIlj9Kyxj7e3.wsDVpFc0fDy_XqP8SCaVxxA.yfkYwRx1CKM5a6u3nnYbPWki55PPQ_B7rq5f.53IcNVxfrrafol3d9OWfeK1qKgeKnv0ynKix5tksxCEWVvlezN7gLCsR0.DtfXRc5UiezCKymF9Sm_hLqB4veIPTEzmb849UUYcABaGgZdaB3uYsBM-
Received: from [59.90.244.83] by web59612.mail.ac4.yahoo.com via HTTP; Mon, 26 Oct 2009 00:13:09 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Mon, 26 Oct 2009 00:13:09 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: Exception in thread main - error
To: java-user@lucene.apache.org
In-Reply-To: <867513fe0910252345r38d0063evb0bfcb9dd09d8a7b@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-13989547-1256541189=:97621"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-13989547-1256541189=:97621
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi anshum,
=A0
But am getting the same error for lucene 2.4 even. My actual intention was =
to take up the earlier version so that it might be easier with less complex=
ity.

--- On Mon, 10/26/09, Anshum <anshumg@gmail.com> wrote:


From: Anshum <anshumg@gmail.com>
Subject: Re: Exception in thread main - error
To: java-user@lucene.apache.org
Date: Monday, October 26, 2009, 6:45 AM


Hi Dhivya,
It'd be a wise step to upgrade to a more recent lucene release. 2.9 (though
that does not mean that the issue you encountered was because of that) woul=
d
be ideal I'd say, but could also try 2.4.


--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Mon, Oct 26, 2009 at 12:06 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrot=
e:

> Sir/Mam,
>
> Am M.Dhivya, learning about apache lucene [Java].
>
> I have installed JDK-6 update 4 and NetBeans-6.5.1
>
> I downloaded the lucene-1.9-final.zip file and followed the steps given i=
n
> docs to run the demo.
>
> The extracted lucene-1.9-final folder from the downloaded zip file is in
> D:\
> and the lucene-core-1.9-final.jar , lucene-demos-1.9-final.jar and src is
> in
>
> D:\lucene-1.9-final\
>
> As said i have set the classpath in environment variable PATH in System
> properties as,
> D:\lucene-1.9-final\lucene-core-1.9-final.jar;
> D:\lucene-1.9-final\lucene-demos-1.9-final.jar;
>
> Then in the command prompt i gave the command,
> D:\lucene-1.9-final>java org.apache.lucene.demo.IndexFiles
> d:\lucene-1.9-final\src
>
> But got the following error:
>
> Exception in thread "main" java.lang.NoClassDefFoundError:
> org/apache/lucene/dem
> o/IndexFiles
> Caused by: java.lang.ClassNotFoundException:
> org.apache.lucene.demo.IndexFiles
>=A0 =A0 =A0 =A0=A0=A0at java.net.URLClassLoader$1.run(Unknown Source)
>=A0 =A0 =A0 =A0=A0=A0at java.security.AccessController.doPrivileged(Native=
 Method)
>=A0 =A0 =A0 =A0=A0=A0at java.net.URLClassLoader.findClass(Unknown Source)
>=A0 =A0 =A0 =A0=A0=A0at java.lang.ClassLoader.loadClass(Unknown Source)
>=A0 =A0 =A0 =A0=A0=A0at sun.misc.Launcher$AppClassLoader.loadClass(Unknown=
 Source)
>=A0 =A0 =A0 =A0=A0=A0at java.lang.ClassLoader.loadClass(Unknown Source)
>=A0 =A0 =A0 =A0=A0=A0at java.lang.ClassLoader.loadClassInternal(Unknown So=
urce)
>
> Am=A0 a beginner just started to learn about lucene by my own interest af=
ter
> knowing about its value. But now am scared as the things are totally blin=
d
> for me. I went in through all the forums but couldnt find the solution. I
> couldnt find out where am missing or my procedure to run lucene demo is
> wrong. Kindly let me know a solution for which am struggling for past one
> week.
>
> Thanks in advance
>=A0 M.Dhivya
>
>
>
=0A=0A=0A      
--0-13989547-1256541189=:97621--

From java-user-return-43029-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 07:54:03 2009
Return-Path: <java-user-return-43029-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36531 invoked from network); 26 Oct 2009 07:54:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 07:54:03 -0000
Received: (qmail 65405 invoked by uid 500); 26 Oct 2009 07:54:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 65338 invoked by uid 500); 26 Oct 2009 07:54:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 65325 invoked by uid 99); 26 Oct 2009 07:54:01 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 07:54:01 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of anshumg@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 07:53:52 +0000
Received: by pwi12 with SMTP id 12so3325383pwi.5
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 00:53:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=oKy8XOh6OSdYUFEkjicyZwcBBmPtaYO7i/daCakxzbM=;
        b=MI06APmIz3mRirg22mb1kyoa/TeiXxzNTlNXt41gB3zTC1kI9Zx4eL3qfr0hNQonpy
         U4sRfJUkKo1w7/R7CNUy86fEwk5E61xUJ5j871P9sl3QlxR8fvifRo9ElMd0GDWPiyPj
         0XL5XoMeoEZ241qt4fRpZ2ZpbYQ8YVyueyFH4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=YJvs1GR8TfS9z35VUOcga1l4go5D7IGpif1Bbt6QHmZAYuQAaXuM5X+XRIVhh01plD
         5LnCO1kGPBWA0ZxpqIW7QWc543lCsrvU6Dv4Of1gbVVMAUkcyv0i6svwMSnzhVVoki1T
         VutEeMIy+pforqaHSCmK27WnNOXe3Rjijk6rc=
MIME-Version: 1.0
Received: by 10.115.133.7 with SMTP id k7mr9712817wan.96.1256543611128; Mon, 
	26 Oct 2009 00:53:31 -0700 (PDT)
In-Reply-To: <890422.97621.qm@web59612.mail.ac4.yahoo.com>
References: <867513fe0910252345r38d0063evb0bfcb9dd09d8a7b@mail.gmail.com> 
	<890422.97621.qm@web59612.mail.ac4.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Mon, 26 Oct 2009 13:23:11 +0530
Message-ID: <867513fe0910260053i6d9f9e1al9388771433f037be@mail.gmail.com>
Subject: Re: Exception in thread main - error
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e648f67e960bbc0476d1db65
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e648f67e960bbc0476d1db65
Content-Type: text/plain; charset=ISO-8859-1

Hi Dhivya,
The complexity is not related to the version of lucene. Also, considering
you are now almost at the same plane with everyone else here, it'd be easier
for us to help you with figuring out and resolving the issues.
Now talking about your issue, its a  java classpath setting issue. Try
mentioning the cp @ the command line and running the program. also try
mentioning <complete-path-for-jar-directory>/* as the class path.
Its the JVM which can't figure out the class file. You might also want to
extract the class files [from the jar] and check if the jar is ok and
contains the class file.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Mon, Oct 26, 2009 at 12:43 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Hi anshum,
>
> But am getting the same error for lucene 2.4 even. My actual intention was
> to take up the earlier version so that it might be easier with less
> complexity.
>
> --- On Mon, 10/26/09, Anshum <anshumg@gmail.com> wrote:
>
>
> From: Anshum <anshumg@gmail.com>
> Subject: Re: Exception in thread main - error
> To: java-user@lucene.apache.org
> Date: Monday, October 26, 2009, 6:45 AM
>
>
> Hi Dhivya,
> It'd be a wise step to upgrade to a more recent lucene release. 2.9 (though
> that does not mean that the issue you encountered was because of that)
> would
> be ideal I'd say, but could also try 2.4.
>
>
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Mon, Oct 26, 2009 at 12:06 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> >wrote:
>
> > Sir/Mam,
> >
> > Am M.Dhivya, learning about apache lucene [Java].
> >
> > I have installed JDK-6 update 4 and NetBeans-6.5.1
> >
> > I downloaded the lucene-1.9-final.zip file and followed the steps given
> in
> > docs to run the demo.
> >
> > The extracted lucene-1.9-final folder from the downloaded zip file is in
> > D:\
> > and the lucene-core-1.9-final.jar , lucene-demos-1.9-final.jar and src is
> > in
> >
> > D:\lucene-1.9-final\
> >
> > As said i have set the classpath in environment variable PATH in System
> > properties as,
> > D:\lucene-1.9-final\lucene-core-1.9-final.jar;
> > D:\lucene-1.9-final\lucene-demos-1.9-final.jar;
> >
> > Then in the command prompt i gave the command,
> > D:\lucene-1.9-final>java org.apache.lucene.demo.IndexFiles
> > d:\lucene-1.9-final\src
> >
> > But got the following error:
> >
> > Exception in thread "main" java.lang.NoClassDefFoundError:
> > org/apache/lucene/dem
> > o/IndexFiles
> > Caused by: java.lang.ClassNotFoundException:
> > org.apache.lucene.demo.IndexFiles
> >         at java.net.URLClassLoader$1.run(Unknown Source)
> >         at java.security.AccessController.doPrivileged(Native Method)
> >         at java.net.URLClassLoader.findClass(Unknown Source)
> >         at java.lang.ClassLoader.loadClass(Unknown Source)
> >         at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
> >         at java.lang.ClassLoader.loadClass(Unknown Source)
> >         at java.lang.ClassLoader.loadClassInternal(Unknown Source)
> >
> > Am  a beginner just started to learn about lucene by my own interest
> after
> > knowing about its value. But now am scared as the things are totally
> blind
> > for me. I went in through all the forums but couldnt find the solution. I
> > couldnt find out where am missing or my procedure to run lucene demo is
> > wrong. Kindly let me know a solution for which am struggling for past one
> > week.
> >
> > Thanks in advance
> >  M.Dhivya
> >
> >
> >
>
>
>
>
>

--0016e648f67e960bbc0476d1db65--

From java-user-return-43030-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 09:23:44 2009
Return-Path: <java-user-return-43030-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63232 invoked from network); 26 Oct 2009 09:23:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 09:23:44 -0000
Received: (qmail 86277 invoked by uid 500); 26 Oct 2009 09:23:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 86210 invoked by uid 500); 26 Oct 2009 09:23:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 86200 invoked by uid 99); 26 Oct 2009 09:23:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 09:23:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 09:23:31 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N2LnD-0005an-2o
	for java-user@lucene.apache.org; Mon, 26 Oct 2009 02:23:11 -0700
Message-ID: <26056543.post@talk.nabble.com>
Date: Mon, 26 Oct 2009 02:23:11 -0700 (PDT)
From: vsevel <v.sevel@lombardodier.com>
To: java-user@lucene.apache.org
Subject: RE: Distinct terms values? (like in Luke)
In-Reply-To: <16DFAC638276409D8EDAD84AF0C48951@VEGA>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: v.sevel@lombardodier.com
References: <5d53d5770905100803q40ecd7faq15e0d3f3f421e8ef@mail.gmail.com> <16DFAC638276409D8EDAD84AF0C48951@VEGA>
X-Virus-Checked: Checked by ClamAV on apache.org


Does it work for numeric fields too? I am working with 2.9.0 and the
following code gives extra values:

    @Test
    public void distinct() throws Exception {
        RAMDirectory directory = new RAMDirectory();
        IndexWriter writer = new IndexWriter(directory, new
WhitespaceAnalyzer(), true, IndexWriter.MaxFieldLength.UNLIMITED);

        for (int l = -2; l <= 2; l++) {
            Document doc = new Document();
            doc.add(new Field("text", "the big brown", Field.Store.NO,
Field.Index.ANALYZED));
            doc.add(new NumericField("trie", Field.Store.NO,
true).setIntValue(l));
            writer.addDocument(doc);
        }

        writer.close();

        IndexReader reader = IndexReader.open(directory, true);
        TermEnum termEnum = reader.terms(new Term("trie", ""));
        Term next = termEnum.term();
        List<Integer> ints = new ArrayList<Integer>();

        while (next != null && next.field().equals("trie")) {
            ints.add(NumericUtils.prefixCodedToInt(next.text()));
            next = termEnum.next() ? termEnum.term() : null;
        }

       reader.close();

        log.info(ints.toString());
    }

==> [-2, -1, 0, 1, 2, -16, 0, -256, 0, -4096, 0, -65536, 0, -1048576, 0,
-16777216, 0, -268435456, 0]

Is there a way to make this work?


Uwe Schindler wrote:
> 
> You can get this list using IndexReader.terms(new Term(fieldname,"")).
> This
> returns an enumeration of all terms starting with the given one (the field
> name). Just iterate over the TermEnum util the field name of the iterated
> term changes.
> 
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
> 
-- 
View this message in context: http://www.nabble.com/Distinct-terms-values--%28like-in-Luke%29-tp23470919p26056543.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43031-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 09:43:26 2009
Return-Path: <java-user-return-43031-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 67343 invoked from network); 26 Oct 2009 09:43:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 09:43:26 -0000
Received: (qmail 8668 invoked by uid 500); 26 Oct 2009 09:43:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 8597 invoked by uid 500); 26 Oct 2009 09:43:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 8587 invoked by uid 99); 26 Oct 2009 09:43:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 09:43:23 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 09:43:13 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 6874545E25E
	for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 10:42:53 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id 5nBHc0wNQWBp for <java-user@lucene.apache.org>;
	Mon, 26 Oct 2009 10:42:44 +0100 (CET)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id CE03545E252
	for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 10:42:43 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <5d53d5770905100803q40ecd7faq15e0d3f3f421e8ef@mail.gmail.com> <16DFAC638276409D8EDAD84AF0C48951@VEGA> <26056543.post@talk.nabble.com>
Subject: RE: Distinct terms values? (like in Luke)
Date: Mon, 26 Oct 2009 10:42:42 +0100
Message-ID: <CA33AF2F55A544D7ABB797609D7FB834@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
In-Reply-To: <26056543.post@talk.nabble.com>
Thread-Index: AcpWHgz2A28FuuFhSNew81EFYUOt8QAAgaiA
X-Virus-Checked: Checked by ClamAV on apache.org

>     @Test
>     public void distinct() throws Exception {
>         RAMDirectory directory = new RAMDirectory();
>         IndexWriter writer = new IndexWriter(directory, new
> WhitespaceAnalyzer(), true, IndexWriter.MaxFieldLength.UNLIMITED);
> 
>         for (int l = -2; l <= 2; l++) {
>             Document doc = new Document();
>             doc.add(new Field("text", "the big brown", Field.Store.NO,
> Field.Index.ANALYZED));
>             doc.add(new NumericField("trie", Field.Store.NO,
> true).setIntValue(l));
>             writer.addDocument(doc);
>         }
> 
>         writer.close();
> 
>         IndexReader reader = IndexReader.open(directory, true);
>         TermEnum termEnum = reader.terms(new Term("trie", ""));
>         Term next = termEnum.term();
>         List<Integer> ints = new ArrayList<Integer>();
> 
>         while (next != null && next.field().equals("trie")) {
>             ints.add(NumericUtils.prefixCodedToInt(next.text()));
>             next = termEnum.next() ? termEnum.term() : null;
>         }
> 
>        reader.close();
> 
>         log.info(ints.toString());
>     }
> 
> ==> [-2, -1, 0, 1, 2, -16, 0, -256, 0, -4096, 0, -65536, 0, -1048576, 0,
> -16777216, 0, -268435456, 0]

You can add a check in your while statement to break iteration, if the next
lower precision is used:

while (next != null && next.field().equals("trie") && next.term().charAt(0)
== NumericUtils.SHIFT_START_INT)...

use the same constant for float, and SHIFT_START_LONG for long and double.

This should work. Maybe we add a method to NumericUtils that checks this and
returns true/false if the term is not of highest precision.

Uwe


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43032-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 09:49:29 2009
Return-Path: <java-user-return-43032-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 68282 invoked from network); 26 Oct 2009 09:49:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 09:49:28 -0000
Received: (qmail 16180 invoked by uid 500); 26 Oct 2009 09:49:26 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16086 invoked by uid 500); 26 Oct 2009 09:49:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16075 invoked by uid 99); 26 Oct 2009 09:49:26 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 09:49:26 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 09:49:15 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id 1638BD36009
	for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 10:48:56 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id ONwfaah1Mk5q for <java-user@lucene.apache.org>;
	Mon, 26 Oct 2009 10:48:45 +0100 (CET)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 3DEDED36003
	for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 10:48:45 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <5d53d5770905100803q40ecd7faq15e0d3f3f421e8ef@mail.gmail.com> <16DFAC638276409D8EDAD84AF0C48951@VEGA> <26056543.post@talk.nabble.com> <CA33AF2F55A544D7ABB797609D7FB834@VEGA>
Subject: RE: Distinct terms values? (like in Luke)
Date: Mon, 26 Oct 2009 10:48:44 +0100
Message-ID: <1F19E6E965FC41ADB162EA5E7193DDE5@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
In-Reply-To: <CA33AF2F55A544D7ABB797609D7FB834@VEGA>
Thread-Index: AcpWHgz2A28FuuFhSNew81EFYUOt8QAAgaiAAAAynpA=
X-Virus-Checked: Checked by ClamAV on apache.org

I forgot, an alternative to this is to use the FieldCache parsers, which
automatically throw an RuntimeException, if a lower precision value is in
term to stop iteration in the FieldCache uninversion:

 try {
   while (next != null && next.field().equals("trie")) {
     ints.add(FieldCache.NUMERIC_UTILS_INT_PARSER.parseInt(next.text()));
     next = termEnum.next() ? termEnum.term() : null;
   }
 } catch (RuntimeException e) {}

See the code of FieldCacheImpl that does exactly that.

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de


> -----Original Message-----
> From: Uwe Schindler [mailto:uwe@thetaphi.de]
> Sent: Monday, October 26, 2009 10:43 AM
> To: java-user@lucene.apache.org
> Subject: RE: Distinct terms values? (like in Luke)
> 
> >     @Test
> >     public void distinct() throws Exception {
> >         RAMDirectory directory = new RAMDirectory();
> >         IndexWriter writer = new IndexWriter(directory, new
> > WhitespaceAnalyzer(), true, IndexWriter.MaxFieldLength.UNLIMITED);
> >
> >         for (int l = -2; l <= 2; l++) {
> >             Document doc = new Document();
> >             doc.add(new Field("text", "the big brown", Field.Store.NO,
> > Field.Index.ANALYZED));
> >             doc.add(new NumericField("trie", Field.Store.NO,
> > true).setIntValue(l));
> >             writer.addDocument(doc);
> >         }
> >
> >         writer.close();
> >
> >         IndexReader reader = IndexReader.open(directory, true);
> >         TermEnum termEnum = reader.terms(new Term("trie", ""));
> >         Term next = termEnum.term();
> >         List<Integer> ints = new ArrayList<Integer>();
> >
> >         while (next != null && next.field().equals("trie")) {
> >             ints.add(NumericUtils.prefixCodedToInt(next.text()));
> >             next = termEnum.next() ? termEnum.term() : null;
> >         }
> >
> >        reader.close();
> >
> >         log.info(ints.toString());
> >     }
> >
> > ==> [-2, -1, 0, 1, 2, -16, 0, -256, 0, -4096, 0, -65536, 0, -1048576, 0,
> > -16777216, 0, -268435456, 0]
> 
> You can add a check in your while statement to break iteration, if the
> next
> lower precision is used:
> 
> while (next != null && next.field().equals("trie") &&
> next.term().charAt(0)
> == NumericUtils.SHIFT_START_INT)...
> 
> use the same constant for float, and SHIFT_START_LONG for long and double.
> 
> This should work. Maybe we add a method to NumericUtils that checks this
> and
> returns true/false if the term is not of highest precision.
> 
> Uwe
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43033-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 14:25:58 2009
Return-Path: <java-user-return-43033-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55472 invoked from network); 26 Oct 2009 14:25:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 14:25:58 -0000
Received: (qmail 84792 invoked by uid 500); 26 Oct 2009 14:25:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84705 invoked by uid 500); 26 Oct 2009 14:25:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84695 invoked by uid 99); 26 Oct 2009 14:25:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 14:25:56 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of maurodragoni@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 14:25:47 +0000
Received: by fxm12 with SMTP id 12so12436427fxm.5
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 07:25:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type:content-transfer-encoding;
        bh=L1zy+jUI98Ahc9mSbYrwtAWMT/qHSEMgsyQpScYq/80=;
        b=v2BsUVMuqArhJSia5n9cWsRe+Spk8PS7NyoIlcWqXsMmy+1HtDhJB+4SRSQkGAYUNp
         wslP3lAsqW7A2hx+skAyIYM2uhZhibuIqUjBiPdpfojsp9BH77bkd/Z/yIO1AAI4wDO2
         +4LBj2KX25xbyiZc/xUujpVpnDBkbO0z7dohQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        b=wJWmofNTFZNeSqtBSNoauXk+T70g83d8kDpW6A49jT8tgZwIP74VJaZsdMFWcpmJxk
         k3T1Y+tPgjAhyrq6RrqEVTIcflwt7i0QQIyuvD+mGl+2g2NOA+MCRV80WJDHoU5m6x0E
         PEwOoDvq54G7giSH8K/yDXj5x8tSk5JKDje+E=
MIME-Version: 1.0
Received: by 10.204.20.138 with SMTP id f10mr1978957bkb.212.1256567126530; 
	Mon, 26 Oct 2009 07:25:26 -0700 (PDT)
Date: Mon, 26 Oct 2009 15:25:26 +0100
Message-ID: <20d4cf890910260725v6cdc0179g6c905d65348b8381@mail.gmail.com>
Subject: Multiterms query and payloads
From: Mauro Dragoni <maurodragoni@gmail.com>
To: Lucene Mailing List <java-user@lucene.apache.org>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Hi to everyone,
I started to use payloads in my indexes.
However, I didn't find a class that permits to perform queries using
more than one term.
The only way that works is to use the BoostingTermQuery class, but by
using this class, I can search only one term a time.

Does exist a way to do a multiterms search or I have to implement a
workaround that aggregates the results of single term searches?
Any other suggestions are accepted.

Thanks to everyone.

--=20
Dott. Mauro Dragoni
Ph.D. Student Universit=E0 di Milano, Italy

My Business Site: http://www.dragotechpro.com
My Research Site: http://www.genalgo.com


Confidentially Notice. This electronic mail transmission may contain
legally privileged and/or confidential information. Do not read this,
if you are not the person named to.
Any use, distribution, copying or disclosure by any other person is
strictly prohibited.
If you received this transmission in error, please notify the sender
and delete the original transmission and its attachments without
reading or saving it in any manner.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43034-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 14:35:45 2009
Return-Path: <java-user-return-43034-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59854 invoked from network); 26 Oct 2009 14:35:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 14:35:45 -0000
Received: (qmail 7293 invoked by uid 500); 26 Oct 2009 14:35:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7235 invoked by uid 500); 26 Oct 2009 14:35:43 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7225 invoked by uid 99); 26 Oct 2009 14:35:43 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 14:35:43 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [208.97.132.119] (HELO homiemail-a21.g.dreamhost.com) (208.97.132.119)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 14:35:33 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a21.g.dreamhost.com (Postfix) with ESMTPA id E8E2C300059
	for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 07:35:11 -0700 (PDT)
Content-Type: text/plain; charset=iso-8859-1; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Multiterms query and payloads
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <20d4cf890910260725v6cdc0179g6c905d65348b8381@mail.gmail.com>
Date: Mon, 26 Oct 2009 10:35:11 -0400
Content-Transfer-Encoding: quoted-printable
Message-Id: <D7332105-F707-44A2-9BC0-88108D7F50EE@apache.org>
References: <20d4cf890910260725v6cdc0179g6c905d65348b8381@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)
X-Virus-Checked: Checked by ClamAV on apache.org

In 2.9, there is now the PayloadNearQuery, which might help you.  =20
Otherwise, the PayloadTermQuery is still a Query and can be used in a =20=

BooleanQuery.  Beyond that, you may need to write what you need, since =20=

it doesn't exist yet.


On Oct 26, 2009, at 10:25 AM, Mauro Dragoni wrote:

> Hi to everyone,
> I started to use payloads in my indexes.
> However, I didn't find a class that permits to perform queries using
> more than one term.
> The only way that works is to use the BoostingTermQuery class, but by
> using this class, I can search only one term a time.
>
> Does exist a way to do a multiterms search or I have to implement a
> workaround that aggregates the results of single term searches?
> Any other suggestions are accepted.
>
> Thanks to everyone.
>
> --=20
> Dott. Mauro Dragoni
> Ph.D. Student Universit=E0 di Milano, Italy
>
> My Business Site: http://www.dragotechpro.com
> My Research Site: http://www.genalgo.com
>
>
> Confidentially Notice. This electronic mail transmission may contain
> legally privileged and/or confidential information. Do not read this,
> if you are not the person named to.
> Any use, distribution, copying or disclosure by any other person is
> strictly prohibited.
> If you received this transmission in error, please notify the sender
> and delete the original transmission and its attachments without
> reading or saving it in any manner.
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) =20
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43035-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 14:44:57 2009
Return-Path: <java-user-return-43035-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65428 invoked from network); 26 Oct 2009 14:44:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 14:44:57 -0000
Received: (qmail 23185 invoked by uid 500); 26 Oct 2009 14:44:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23106 invoked by uid 500); 26 Oct 2009 14:44:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23096 invoked by uid 99); 26 Oct 2009 14:44:55 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 14:44:55 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 14:44:46 +0000
Received: by pzk3 with SMTP id 3so7474000pzk.20
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 07:44:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=zOTjJdIrf2vBbbPviH0BD70m5T45WAJbsdt1O51BM2g=;
        b=g2aDZN0BJv9ICMMZo7TvPCfVBzWqalxt+eiauqu61YMPzlN3Ga5PiIUflE6chkYFyU
         Fuy0/1v2mfkVtVdBIRowjaeaUOc9SYGfdQsWo6F3U7snrjNd/PL9v9bLotF1yFdp26j+
         rgRlT9idCIpvm1T6XbeMh1X7Fue5T2ZFJnZ5I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=nkUsAa7xGqAUtVmmuKUKZzwoqjbVjzV4cmrcrMD1WO1EeXcInX08z5EjeB6GFJ/ccI
         KBb+FmbiLSV/EakqqYiFfGWzO5TFF9mWK3PY9K8iNtDDbrPQOx46uNqQxJr0hD2OPTu9
         D0PiVl30gBvbVgAaI1QbdOvXvsurstZ+vPR3g=
MIME-Version: 1.0
Received: by 10.141.41.21 with SMTP id t21mr2073816rvj.93.1256568264591; Mon, 
	26 Oct 2009 07:44:24 -0700 (PDT)
In-Reply-To: <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
Date: Mon, 26 Oct 2009 10:44:24 -0400
Message-ID: <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd50a860c0abf0476d7990f
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd50a860c0abf0476d7990f
Content-Type: text/plain; charset=ISO-8859-1

Even running in console mode, the exception is difficult to interpret.
Here's an exception that I think occurred during an add document, commit or
close:
doc counts differ for segment _g: field Reader shows 137 but segmentInfo
shows 5777
I ensured that the disk space was low before updating the index.

On another occasion, the exception was:
background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107 _4:C126
_5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
And the accompanying stack trace was:
java.io.IOException: read past EOF
        at
org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:151)
        at
org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:38)
        at org.apache.lucene.store.IndexInput.readInt(IndexInput.java:70)
        at
org.apache.lucene.index.FieldsReader.<init>(FieldsReader.java:110)
        at
org.apache.lucene.index.SegmentReader$CoreReaders.openDocStores(SegmentReader.java:277)
        at org.apache.lucene.index.SegmentReader.get(SegmentReader.java:640)
        at org.apache.lucene.index.SegmentReader.get(SegmentReader.java:608)
        at
org.apache.lucene.index.IndexWriter$ReaderPool.get(IndexWriter.java:679)
        at
org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4961)
        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
        at
org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
        at
org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)

I guess this is just the nature of a low disk space condition on Windows. I
expected to see a 'no space left on device' IO exception.

Peter

On Sun, Oct 25, 2009 at 8:54 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> The environment involves a lot of I/O from merge/optimize operations on
> multiple indexes (shards) on one server.
> I will try running the indexers in console mode, where I would expect to
> see all errors and exceptions.
>
> Peter
>
>
>
> On Sun, Oct 25, 2009 at 8:40 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> Hmm, if you got no exception whatsoever, something more fundamental
>> seems to be wrong w/ the error reporting when running as a windows
>> service.  Maybe make a simple Java test program that throws an
>> exception and try to get that working?
>>
>> Mike
>>
>> On Sun, Oct 25, 2009 at 7:35 PM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> >>Did you get any traceback printed at all?
>> > no, only what I reported.
>> >
>> >>Did you see any BG thread exceptions on wherever your System.err is
>> > directed to?
>> > The jvm was running as a windows service, so output to System.err may
>> have
>> > gone to the bit bucket.
>> > That's an interesting point, though.
>> >
>> > Peter
>> >
>> >
>> > On Sun, Oct 25, 2009 at 8:47 AM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> Hmm... Lucene tries to catch the original cause (from the BG thread
>> >> doing the merge) and forward it to the main thread waiting for
>> >> optimize to complete.
>> >>
>> >> Did you get any traceback printed at all?  It should include one
>> >> traceback into Lucene's optimized method, and then another (under
>> >> "caused by") showing the exception from the BG merge thread.
>> >>
>> >> Did you see any BG thread exceptions on wherever your System.err is
>> >> directed to?
>> >>
>> >> Mike
>> >>
>> >> On Sat, Oct 24, 2009 at 5:21 PM, Peter Keegan <peterlkeegan@gmail.com>
>> >> wrote:
>> >> > btw, this is with Lucene 2.9
>> >> >
>> >> > On Sat, Oct 24, 2009 at 5:20 PM, Peter Keegan <
>> peterlkeegan@gmail.com
>> >> >wrote:
>> >> >
>> >> >> I'm sometimes seeing the following exception from an operation that
>> does
>> >> a
>> >> >> merge and optimize:
>> >> >>  java.io.IOException: background merge hit exception: _0:C1082866
>> _1:C79
>> >> >> into _2 [optimize] [mergeDocStores]
>> >> >> I'm pretty sure that it's caused by a temporary low disk space
>> >> condition,
>> >> >> but I'd like to be able to confirm this. It would be nice to have
>> the
>> >> java
>> >> >> exception included in the Lucene exception. Any way to get this?
>> >> >>
>> >> >> Peter
>> >> >>
>> >> >>
>> >> >
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--000e0cd50a860c0abf0476d7990f--

From java-user-return-43036-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 18:40:07 2009
Return-Path: <java-user-return-43036-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59579 invoked from network); 26 Oct 2009 18:40:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 18:40:07 -0000
Received: (qmail 54876 invoked by uid 500); 26 Oct 2009 18:40:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54809 invoked by uid 500); 26 Oct 2009 18:40:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54799 invoked by uid 99); 26 Oct 2009 18:40:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 18:40:05 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 18:39:57 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 5546971C329; Mon, 26 Oct 2009 11:39:36 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 4C93471C1FC
	for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 11:39:36 -0700 (PDT)
Date: Mon, 26 Oct 2009 11:39:36 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java user <java-user@lucene.apache.org>
Subject: Re: Exception in thread main - error
In-Reply-To: <325546.4166.qm@web59601.mail.ac4.yahoo.com>
Message-ID: <Pine.LNX.4.64.0910261135360.18660@radix.cryptio.net>
References: <325546.4166.qm@web59601.mail.ac4.yahoo.com>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="1171305770-1337457185-1256582376=:18660"
X-Virus-Checked: Checked by ClamAV on apache.org

--1171305770-1337457185-1256582376=:18660
Content-Type: TEXT/PLAIN; charset=UTF-8
Content-Transfer-Encoding: QUOTED-PRINTABLE


: As said i have=A0set the classpath in environment variable PATH in System=
 properties as,
: D:\lucene-1.9-final\lucene-core-1.9-final.jar; D:\lucene-1.9-final\lucene=
-demos-1.9-final.jar;

"PATH" is not "the classpath in environment" for any JVM that i know of,=20
reading this document may be helpful...

http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/classpath.html


-Hoss


--1171305770-1337457185-1256582376=:18660
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--1171305770-1337457185-1256582376=:18660--

From java-user-return-43037-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 18:50:29 2009
Return-Path: <java-user-return-43037-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61479 invoked from network); 26 Oct 2009 18:50:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 18:50:29 -0000
Received: (qmail 61104 invoked by uid 500); 26 Oct 2009 18:50:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 61019 invoked by uid 500); 26 Oct 2009 18:50:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 61009 invoked by uid 99); 26 Oct 2009 18:50:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 18:50:27 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 18:50:24 +0000
Received: by yxe30 with SMTP id 30so15186933yxe.29
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 11:50:03 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.243.5 with SMTP id q5mr24647664ybh.13.1256583003143; Mon, 
	26 Oct 2009 11:50:03 -0700 (PDT)
In-Reply-To: <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
Date: Mon, 26 Oct 2009 14:50:03 -0400
Message-ID: <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com> wrote:
> Even running in console mode, the exception is difficult to interpret.
> Here's an exception that I think occurred during an add document, commit or
> close:
> doc counts differ for segment _g: field Reader shows 137 but segmentInfo
> shows 5777

That's spooky.  Do you have the full exception for this one?  What IO
system are you running on?  (Is it just a local drive on your windows
computer?) It's almost as if the IO system is not generating an
IOException to Java when disk fills up.

> I ensured that the disk space was low before updating the index.

You mean, to intentionally test the disk-full case?

> On another occasion, the exception was:
> background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107 _4:C126
> _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]

In this case, the SegmentMerger was trying to open this segment, but
on attempting to read the first int from the fdx (fields index) file
for one of the segments, it hit EOF.

This is also spooky -- this looks like index corruption, which should
never happen on hitting disk full.

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43038-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 18:55:44 2009
Return-Path: <java-user-return-43038-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62543 invoked from network); 26 Oct 2009 18:55:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 18:55:44 -0000
Received: (qmail 70547 invoked by uid 500); 26 Oct 2009 18:55:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70472 invoked by uid 500); 26 Oct 2009 18:55:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70462 invoked by uid 99); 26 Oct 2009 18:55:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 18:55:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 18:55:33 +0000
Received: by pwi12 with SMTP id 12so3631885pwi.5
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 11:55:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=K47FrWAmCuqUWdhseH3dAmM2TONVRkUS7NRCiT3uTV4=;
        b=Go7P0YmB48ENkuJelBAQhKk7zwmJR7rc/xOh7s86YTwqxlnFOKCckPP3UFQDTuDjlx
         90bvSYBuj3CwAT+BQrN4LYswPEKH9i1ORIfd4b8NPii/mI7HZdTbjXpH6JErPO9MeldU
         gJQ4XwaH+c+88GfbNwO/AXj/A95CFCzHP5Vb0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=eOE+SiiaMxR2N8BKY+X2LTHo7vTneR8YHw6dyT/tnNjelwvQMxUxkylDI6KK6wSuS3
         RHZWzjW2zFn79q8QP0DyWe+PgDqPlQHjnFcHIEjY/fpCe1gk2G7yqRJfygEAcoAp6EO9
         ChSlC4dFNaCbPcdOrYspf2p++cR0b20JMgqlc=
MIME-Version: 1.0
Received: by 10.142.249.40 with SMTP id w40mr1163580wfh.344.1256583312291; 
	Mon, 26 Oct 2009 11:55:12 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
Date: Mon, 26 Oct 2009 14:55:12 -0400
Message-ID: <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636ed68acf5b6d70476db19c7
X-Virus-Checked: Checked by ClamAV on apache.org

--001636ed68acf5b6d70476db19c7
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > Even running in console mode, the exception is difficult to interpret.
> > Here's an exception that I think occurred during an add document, commit
> or
> > close:
> > doc counts differ for segment _g: field Reader shows 137 but segmentInfo
> > shows 5777
>
> That's spooky.  Do you have the full exception for this one?  What IO
> system are you running on?  (Is it just a local drive on your windows
> computer?) It's almost as if the IO system is not generating an
> IOException to Java when disk fills up.
>

Index and code are all on a local drive. There is no other exception coming
back - just what I reported.

>
> > I ensured that the disk space was low before updating the index.
>
> You mean, to intentionally test the disk-full case?
>

Yes, that's right.


>
> > On another occasion, the exception was:
> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107
> _4:C126
> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
>
> In this case, the SegmentMerger was trying to open this segment, but
> on attempting to read the first int from the fdx (fields index) file
> for one of the segments, it hit EOF.
>
> This is also spooky -- this looks like index corruption, which should
> never happen on hitting disk full.
>

That's what I thought, too. Could Lucene be catching the IOException and
turning it into a different exception?


>
> Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636ed68acf5b6d70476db19c7--

From java-user-return-43039-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 19:00:47 2009
Return-Path: <java-user-return-43039-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69779 invoked from network); 26 Oct 2009 19:00:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 19:00:47 -0000
Received: (qmail 76751 invoked by uid 500); 26 Oct 2009 19:00:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 76697 invoked by uid 500); 26 Oct 2009 19:00:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 76687 invoked by uid 99); 26 Oct 2009 19:00:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 19:00:44 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 19:00:41 +0000
Received: by gxk19 with SMTP id 19so15038gxk.5
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 12:00:20 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.235.17 with SMTP id i17mr13200117ybh.200.1256583620395; 
	Mon, 26 Oct 2009 12:00:20 -0700 (PDT)
In-Reply-To: <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
Date: Mon, 26 Oct 2009 15:00:20 -0400
Message-ID: <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
> On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > Even running in console mode, the exception is difficult to interpret.
>> > Here's an exception that I think occurred during an add document, comm=
it
>> or
>> > close:
>> > doc counts differ for segment _g: field Reader shows 137 but segmentIn=
fo
>> > shows 5777
>>
>> That's spooky. =A0Do you have the full exception for this one? =A0What I=
O
>> system are you running on? =A0(Is it just a local drive on your windows
>> computer?) It's almost as if the IO system is not generating an
>> IOException to Java when disk fills up.
>>
>
> Index and code are all on a local drive. There is no other exception comi=
ng
> back - just what I reported.

But, you didn't report a traceback for this first one?

>> > I ensured that the disk space was low before updating the index.
>>
>> You mean, to intentionally test the disk-full case?
>>
>
> Yes, that's right.

OK.  Can you turn on IndexWriter's infoStream, get this disk full /
corruption to happen again, and post back the resulting output?  Make
sure your index first passes CheckIndex before starting (so we don't
begin the test w/ any pre-existing index corruption).

>> > On another occasion, the exception was:
>> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107
>> _4:C126
>> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
>>
>> In this case, the SegmentMerger was trying to open this segment, but
>> on attempting to read the first int from the fdx (fields index) file
>> for one of the segments, it hit EOF.
>>
>> This is also spooky -- this looks like index corruption, which should
>> never happen on hitting disk full.
>>
>
> That's what I thought, too. Could Lucene be catching the IOException and
> turning it into a different exception?

I think that's unlikely, but I guess possible.  We have "disk full"
tests in the unit tests, that throw an IOException at different times.

What exact windows version are you using?  The local drive is NTFS?

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43040-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 19:32:11 2009
Return-Path: <java-user-return-43040-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79132 invoked from network); 26 Oct 2009 19:32:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 19:32:11 -0000
Received: (qmail 12105 invoked by uid 500); 26 Oct 2009 19:32:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 12044 invoked by uid 500); 26 Oct 2009 19:32:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 12034 invoked by uid 99); 26 Oct 2009 19:32:09 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 19:32:09 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of kyliemccormick@gmail.com designates 209.85.220.216 as permitted sender)
Received: from [209.85.220.216] (HELO mail-fx0-f216.google.com) (209.85.220.216)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 19:31:59 +0000
Received: by fxm12 with SMTP id 12so12727887fxm.5
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 12:31:39 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=eKVSKTKxImISm3RL7li5FAftppBCQBwaXZvaeb3MkOw=;
        b=XwXDyPr/7mwc06pup1+AeyAFqnwO35SE0kpEKkEnXdwWKQQ2wyVoh7vLOLrk/LN28y
         M2Dnr5VDqnmMiJpMbaIxNgGhZY8yREcwFS8nTqlawxUXl4EqjLzYkcltfIUXhTo55QPd
         xzSpEwQu4Mh13dLMS8BBOsHJvVVtsW0cCOSUQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=vfXwT59xb+bE04DudrEZWfNpzZwnfOoIrRhNTt3jayAtUJCmQtNLa+8QV+avqVHdSk
         w1iKUoPzstKk2pkHSl0ktoXuS3Ej7sv2fUpD5UseSt4GoqeJHfx6EiHzoqmuySuxNVEC
         gGw+vyA1GMBNwDDV6lVBjwPXkLb06xIEETwHs=
MIME-Version: 1.0
Received: by 10.239.139.226 with SMTP id u34mr1296177hbu.80.1256585498448; 
	Mon, 26 Oct 2009 12:31:38 -0700 (PDT)
Date: Mon, 26 Oct 2009 11:31:38 -0800
Message-ID: <3b61738b0910261231m7d9fbcd2v75febc36dcb273e0@mail.gmail.com>
Subject: Merging Indexes
From: "K. M. McCormick" <kyliemccormick@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001485f19f1243d3f60476db9cc3
X-Virus-Checked: Checked by ClamAV on apache.org

--001485f19f1243d3f60476db9cc3
Content-Type: text/plain; charset=ISO-8859-1

Hello:

Currently, I have a large index being build in sections. The indexing
program has multiple threads which it uses to optimize time; each thread
makes its own, separate index to avoid threads fighting over resources. At
the end of the program, the indexes are merged into a single index.

...I've read both that merging deletes and does not delete the indexes
merged. It looks like they're not being deleted, since when I check on the
sizes of each index, I see the following:

SIZE------INDEX NAME/DIRECTORY
361M    term2gm/WorkerThread0
357M    term2gm/WorkerThread1
449M    term2gm/WorkerThread2
404M    term2gm/WorkerThread3
359M    term2gm/WorkerThread4
274M    term2gm/WorkerThread5
428M    term2gm/WorkerThread6
306M    term2gm/WorkerThread7
317M    term2gm/WorkerThread8
309M    term2gm/WorkerThread9

2.8G    term2gm/finalindex_term2gm

The final index is the merged index at the end of the program. Is it safe
for me to delete the WorkerThread# indexes, or do I need to keep them so
that my final, merged index is maintained?

Also, if I merge indexes later, will the original indexes be kept, or
deleted, after the merge? Like I said, I've read it both ways, and I want to
be sure of how it is with Lucene 2.4.1 / Lucene 2.9

Thanks!
Kylie

-- 
The Circle of the Dragon -- dragon history and mystery
http://www.blackdrago.com/index.html

Online Resume and Portfolio
http://www.kyliemccormick.com/

"Light, seeking light, doth the light of light beguile!"
-- William Shakespeare's Love's Labor's Lost

--001485f19f1243d3f60476db9cc3--

From java-user-return-43041-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 19:59:49 2009
Return-Path: <java-user-return-43041-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 92328 invoked from network); 26 Oct 2009 19:59:49 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 19:59:49 -0000
Received: (qmail 46116 invoked by uid 500); 26 Oct 2009 19:59:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 46030 invoked by uid 500); 26 Oct 2009 19:59:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 46020 invoked by uid 99); 26 Oct 2009 19:59:47 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 19:59:47 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 19:59:44 +0000
Received: by pxi3 with SMTP id 3so2713305pxi.29
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 12:59:24 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=eBM5oPj7oAz45T1x9NCQK9c7IEqzD662XeH4Lj1Wy90=;
        b=LtdB0t+2LBJULLqJ41HjmJkUiAlZPnkKN/4jDsxd8bkC73qRBCN/ZmIVQNmJpYOeB0
         jfl9gjozpPNLBSQ95LBnlX/D4V19a2xvkSXP7FhZRLr/Gb5IoDFqAnje/zIxP8izn9m7
         EJzTMY3euzJsanTih5YvabPtF5GTthkI1Kk3U=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=IEhyOhrfScZZnBpdqWApxKpROrTDWG5+G98EfVO8TYEMccHms+NQV7weD8SqDU9sTE
         clNI+V0igzrxzeYDsL8IgMqSw9xkKOi/xN2bsNiycwSTJGQ+yRjB3xJg+cM3IaGRocun
         oJHy6r7nEZKUUTP4RnqgQ+iz85jHk7FZxYkJg=
MIME-Version: 1.0
Received: by 10.142.5.31 with SMTP id 31mr1146551wfe.78.1256587164500; Mon, 26 
	Oct 2009 12:59:24 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910241421g65e9a429y8a2b42e4b8819e90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
Date: Mon, 26 Oct 2009 15:59:24 -0400
Message-ID: <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502b19991c3020476dbff91

--00504502b19991c3020476dbff91
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com>
> >> wrote:
> >> > Even running in console mode, the exception is difficult to interpret.
> >> > Here's an exception that I think occurred during an add document,
> commit
> >> or
> >> > close:
> >> > doc counts differ for segment _g: field Reader shows 137 but
> segmentInfo
> >> > shows 5777
> >>
> >> That's spooky.  Do you have the full exception for this one?  What IO
> >> system are you running on?  (Is it just a local drive on your windows
> >> computer?) It's almost as if the IO system is not generating an
> >> IOException to Java when disk fills up.
> >>
> >
> > Index and code are all on a local drive. There is no other exception
> coming
> > back - just what I reported.
>
> But, you didn't report a traceback for this first one?
>

Yes, I need to add some more printStackTrace calls.


>
> >> > I ensured that the disk space was low before updating the index.
> >>
> >> You mean, to intentionally test the disk-full case?
> >>
> >
> > Yes, that's right.
>
> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
> corruption to happen again, and post back the resulting output?  Make
> sure your index first passes CheckIndex before starting (so we don't
> begin the test w/ any pre-existing index corruption).
>

Good point about CheckIndex.  I've already found 2 bad ones. I will build
new indexes from scratch. This will take a while.


> >> > On another occasion, the exception was:
> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107
> >> _4:C126
> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
> >>
> >> In this case, the SegmentMerger was trying to open this segment, but
> >> on attempting to read the first int from the fdx (fields index) file
> >> for one of the segments, it hit EOF.
> >>
> >> This is also spooky -- this looks like index corruption, which should
> >> never happen on hitting disk full.
> >>
> >
> > That's what I thought, too. Could Lucene be catching the IOException and
> > turning it into a different exception?
>
> I think that's unlikely, but I guess possible.  We have "disk full"
> tests in the unit tests, that throw an IOException at different times.
>
> What exact windows version are you using?  The local drive is NTFS?
>

Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS


>
> Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502b19991c3020476dbff91--

From java-user-return-43042-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Mon Oct 26 23:52:55 2009
Return-Path: <java-user-return-43042-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 74838 invoked from network); 26 Oct 2009 23:52:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 26 Oct 2009 23:52:55 -0000
Received: (qmail 41764 invoked by uid 500); 26 Oct 2009 23:52:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41674 invoked by uid 500); 26 Oct 2009 23:52:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41664 invoked by uid 99); 26 Oct 2009 23:52:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 23:52:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of chris.lu@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 26 Oct 2009 23:52:43 +0000
Received: by ewy26 with SMTP id 26so11860462ewy.5
        for <java-user@lucene.apache.org>; Mon, 26 Oct 2009 16:52:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=+5Gx1Jmqtb0Um/j8cqhWaRVwOwNMW2D55Pe6itspgeY=;
        b=KbWiu3Hsf8xS9MkTJ5kxwSBMFowJQpKpEbWf9wzZX9JH0j4gDRRHdUOXmsgabwVdbg
         KTURnnqNi6aUr9I9cRzpJJ6AV2bNnUGwbdzJ7emHA+dw/KhU07o7jpWRfVhTF0cxZ3ce
         UMKPo4F8+6rTCCv8Iue32ya8jMQAziXbTzBp8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=w0W592LdhdoXnac/FzlNsQkrpPM95RqP6JMSkA+LsSBvn3jfcUhQ5CTVV7Ii6QHtE9
         rnP0Febob6FP9DuBc2JOzlhDyl+L0yLWAPiFevvvgUC3vCJGl01LCvFXcewLo4QwLh/Z
         oA1MBsb92Lp3aTUhcBp6HrCgjn45/UKXfMD/A=
Received: by 10.216.89.12 with SMTP id b12mr1999614wef.93.1256601142258;
        Mon, 26 Oct 2009 16:52:22 -0700 (PDT)
Received: from ?10.1.1.122? (hq.compositesw.com [209.237.61.131])
        by mx.google.com with ESMTPS id j8sm1688429gvb.4.2009.10.26.16.52.19
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Mon, 26 Oct 2009 16:52:21 -0700 (PDT)
Message-ID: <4AE63628.7070000@gmail.com>
Date: Mon, 26 Oct 2009 16:52:08 -0700
From: Chris Lu <chris.lu@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Merging Indexes
References: <3b61738b0910261231m7d9fbcd2v75febc36dcb273e0@mail.gmail.com>
In-Reply-To: <3b61738b0910261231m7d9fbcd2v75febc36dcb273e0@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Pretty sure you can delete the small indexes after the merge.

BTW: How long does your indexing and merging take respectively?

-- 

--
Chris Lu
-------------------------
Instant Scalable Full-Text Search On Any Database/Application
site: http://www.dbsight.net
demo: http://search.dbsight.com
Lucene Database Search in 3 minutes: http://wiki.dbsight.com/index.php?title=Create_Lucene_Database_Search_in_3_minutes
DBSight customer, a shopping comparison site, (anonymous per request) got 2.6 Million Euro funding!



K. M. McCormick wrote:
> Hello:
>
> Currently, I have a large index being build in sections. The indexing
> program has multiple threads which it uses to optimize time; each thread
> makes its own, separate index to avoid threads fighting over resources. At
> the end of the program, the indexes are merged into a single index.
>
> ...I've read both that merging deletes and does not delete the indexes
> merged. It looks like they're not being deleted, since when I check on the
> sizes of each index, I see the following:
>
> SIZE------INDEX NAME/DIRECTORY
> 361M    term2gm/WorkerThread0
> 357M    term2gm/WorkerThread1
> 449M    term2gm/WorkerThread2
> 404M    term2gm/WorkerThread3
> 359M    term2gm/WorkerThread4
> 274M    term2gm/WorkerThread5
> 428M    term2gm/WorkerThread6
> 306M    term2gm/WorkerThread7
> 317M    term2gm/WorkerThread8
> 309M    term2gm/WorkerThread9
>
> 2.8G    term2gm/finalindex_term2gm
>
> The final index is the merged index at the end of the program. Is it safe
> for me to delete the WorkerThread# indexes, or do I need to keep them so
> that my final, merged index is maintained?
>
> Also, if I merge indexes later, will the original indexes be kept, or
> deleted, after the merge? Like I said, I've read it both ways, and I want to
> be sure of how it is with Lucene 2.4.1 / Lucene 2.9
>
> Thanks!
> Kylie
>
>   

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43043-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 03:11:09 2009
Return-Path: <java-user-return-43043-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 42135 invoked from network); 27 Oct 2009 03:11:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 03:11:09 -0000
Received: (qmail 93302 invoked by uid 500); 27 Oct 2009 03:11:07 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93155 invoked by uid 500); 27 Oct 2009 03:11:07 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93143 invoked by uid 99); 27 Oct 2009 03:11:06 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 03:11:06 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of SRS0=JbDMYv=GQ=lucasmail.org=paul@yourhostingaccount.com designates 65.254.253.122 as permitted sender)
Received: from [65.254.253.122] (HELO mailout15.yourhostingaccount.com) (65.254.253.122)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 03:10:57 +0000
Received: from mailscan06.yourhostingaccount.com ([10.1.15.6] helo=mailscan06.yourhostingaccount.com)
	by mailout15.yourhostingaccount.com with esmtp (Exim)
	id 1N2cSC-0007hC-Ew
	for java-user@lucene.apache.org; Mon, 26 Oct 2009 23:10:36 -0400
Received: from impout03.yourhostingaccount.com ([10.1.55.3] helo=impout03.yourhostingaccount.com)
	by mailscan06.yourhostingaccount.com with esmtp (Exim)
	id 1N2cSC-0006j8-F2
	for java-user@lucene.apache.org; Mon, 26 Oct 2009 23:10:36 -0400
Received: from authsmtp02.yourhostingaccount.com ([10.1.18.2])
	by impout03.yourhostingaccount.com with NO UCE
	id xfAc1c00202goRm0000000; Mon, 26 Oct 2009 23:10:36 -0400
X-EN-OrigOutIP: 10.1.18.2
X-EN-IMPSID: xfAc1c00202goRm0000000
Received: from ool-457a3c06.dyn.optonline.net ([69.122.60.6] helo=[192.168.1.112])
	by authsmtp02.yourhostingaccount.com with esmtpsa (TLSv1:AES128-SHA:128)
	(Exim)
	id 1N2cSC-0000n4-Ck
	for java-user@lucene.apache.org; Mon, 26 Oct 2009 23:10:36 -0400
From: "Paul J. Lucas" <paul@lucasmail.org>
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Subject: Deleting documents using "starts with"
Date: Mon, 26 Oct 2009 20:10:34 -0700
Message-Id: <6B8A45E4-B643-4522-9DFA-875AC7E60A0B@lucasmail.org>
To: java-user@lucene.apache.org
Mime-Version: 1.0 (Apple Message framework v1076)
X-Mailer: Apple Mail (2.1076)
X-EN-UserInfo: 19b3ee6e8bc35660ab25150f3ce1009e:104eb4694f5dc54e252b420fd863a3b6
X-EN-AuthUser: paul@pauljlucas.org
Sender:  "Paul J. Lucas" <paul@lucasmail.org>
X-EN-OrigIP: 69.122.60.6
X-EN-OrigHost: ool-457a3c06.dyn.optonline.net
X-Virus-Checked: Checked by ClamAV on apache.org

I currently have code that looks like:

     Term[] terms = new Term[]{
         new Term( key1, value1 ),
         new Term( key2, value2 )
     };
     writer.deleteDocuments( terms );

I want to change things such that it will delete all documents having  
key2's value start with value2, i.e., if value2 were "foo" then I want  
all documents to be deleted where key2's value starts with  
"foo" (i.e., "foo*").

I still want key1's value to match value1 exactly, however.

What's the simplest way to do do what I want?  Thanks.

- Paul

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43044-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 08:17:26 2009
Return-Path: <java-user-return-43044-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 6736 invoked from network); 27 Oct 2009 08:17:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 08:17:26 -0000
Received: (qmail 66743 invoked by uid 500); 27 Oct 2009 08:17:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66655 invoked by uid 500); 27 Oct 2009 08:17:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66645 invoked by uid 99); 27 Oct 2009 08:17:23 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 08:17:23 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [76.13.12.142] (HELO web59602.mail.ac4.yahoo.com) (76.13.12.142)
    by apache.org (qpsmtpd/0.29) with SMTP; Tue, 27 Oct 2009 08:17:14 +0000
Received: (qmail 92286 invoked by uid 60001); 27 Oct 2009 08:16:52 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256631412; bh=uJ5d4lFstR9Dh1f1AVdtO4oWjRaksU/7S5hIahW9YcU=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=xz0LlYZNhVPw8x5huHAdjSrwTKqO5/l+6cYJV/qYKak/CxO96jtjwVxyqLdzrvGugPwUUE6x/Q6C6+uyxCEsLBMTqBwcuJGQm3zr0NA6EDly7+ZwW0clKO1o2c+ifbhLQU6eZropM1vA5peGCeN06/e9fhi7JntSWv4BWHlNx8Y=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=r5S7ntjoEuTMoQ5awiLQxtTpIL+LAY2RlcR4lzvvYZjuw/bfT2oeQEvFjhwvWJ6fcqW0XjQiA7QkHYEmN839iulew4JHBZM1c/hyGzHnkjWrFcAHtmGEh8SgAvRlHLFNEMT79f3ewamnVi0kwHZNaT08wSsm3BZhA6PYbMugdn0=;
Message-ID: <834890.92265.qm@web59602.mail.ac4.yahoo.com>
X-YMail-OSG: ggJYB18VM1lxSU9RvBP9e7V5WRD9gnVgkRPOatF2WJ5WapR7ZjT34bQW.aXAKivAWR3agrMUv0.zDpjleekpFLDU22yPMHAw0LES7VZQTsvHYcdfbPXi7cQALa_p6jSreecq9wLOHATXZfPFo00SEYgij3TpAf3QXqorSedk2aGQedNmi6PXUDEro.GvAh6Jqt3qOzyGzIj2bUxcsqe9U6PFwbr2qd4Gjmnl2nG.J.yQOhkBM1clzanOIUjag5G0VhIjz0Qb3Uaq6FrhtHnq3ff7AJyDXsRoJJQGhLAab.jLt8SaTpn_m_ImCU4_iDvbYB8O4kBsRLlG9pQOZqtvqbgOC5XoSw--
Received: from [59.90.244.83] by web59602.mail.ac4.yahoo.com via HTTP; Tue, 27 Oct 2009 01:16:52 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Tue, 27 Oct 2009 01:16:52 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: Exception in thread main - error
To: java-user@lucene.apache.org
In-Reply-To: <Pine.LNX.4.64.0910261135360.18660@radix.cryptio.net>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-251850041-1256631412=:92265"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-251850041-1256631412=:92265
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Thanx for the info. Now i understood what exactly the classpath is.

--- On Mon, 10/26/09, Chris Hostetter <hossman_lucene@fucit.org> wrote:


From: Chris Hostetter <hossman_lucene@fucit.org>
Subject: Re: Exception in thread main - error
To: "java user" <java-user@lucene.apache.org>
Date: Monday, October 26, 2009, 6:39 PM



: As said i have=A0set the classpath in environment variable PATH in System=
 properties as,
: D:\lucene-1.9-final\lucene-core-1.9-final.jar; D:\lucene-1.9-final\lucene=
-demos-1.9-final.jar;

"PATH" is not "the classpath in environment" for any JVM that i know of,=20
reading this document may be helpful...

http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/classpath.html


-Hoss



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org=0A=0A=0A =
     
--0-251850041-1256631412=:92265--

From java-user-return-43045-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 09:46:25 2009
Return-Path: <java-user-return-43045-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29676 invoked from network); 27 Oct 2009 09:46:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 09:46:25 -0000
Received: (qmail 68497 invoked by uid 500); 27 Oct 2009 09:46:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68445 invoked by uid 500); 27 Oct 2009 09:46:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68299 invoked by uid 99); 27 Oct 2009 09:46:22 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 09:46:22 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of ian.lea@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 09:46:20 +0000
Received: by qyk41 with SMTP id 41so1734741qyk.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 02:45:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type
         :content-transfer-encoding;
        bh=qnerL/FNrnFPFJbwuIOrE71LYIAS8S5mrxP5JZbTkEY=;
        b=m5KsP2oKQaPEsQ2innCULtNjGxVEOsH3ZDomTNzGX1AJz1k216X/OCkHQ8Ol1p29Yw
         xqbAYwYzsUfKZ2f8dlAUtYrhratOJpmDw/yK7epa4RThK6nXNWDZd4aJCD8/TYNuSCmi
         Iq19uEuduQi6TN9TkhkOd8hXuGrhpgEszCEpY=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type:content-transfer-encoding;
        b=hQP+3jBMe0jRxL+WweOgMWcCcrVKaWuqew45NHAwKNexmSbHhp2LgsomOj44ex1Wck
         FiLriKwK2yi2k2DZRfHcTvN6sEODeFyL+0uUuGZ1cxZ/Jz545akCnlOphddIuLjmem48
         5DlkN2Y1XU3/CJHqj9XafEx2TT1IVCRRgQMSs=
MIME-Version: 1.0
Received: by 10.220.126.224 with SMTP id d32mr9222747vcs.57.1256636759156; 
	Tue, 27 Oct 2009 02:45:59 -0700 (PDT)
In-Reply-To: <6B8A45E4-B643-4522-9DFA-875AC7E60A0B@lucasmail.org>
References: <6B8A45E4-B643-4522-9DFA-875AC7E60A0B@lucasmail.org>
From: Ian Lea <ian.lea@gmail.com>
Date: Tue, 27 Oct 2009 09:45:39 +0000
Message-ID: <8c4e68610910270245o3f1ae4bfy5b01cbaf887f7774@mail.gmail.com>
Subject: Re: Deleting documents using "starts with"
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

There are IndexWriter.deleteDocuments methods that take queries.
Passing a TermQuery and a WildcardQuery to
writer.deleteDocuments(Query[]) should do the trick.


--
Ian.


On Tue, Oct 27, 2009 at 3:10 AM, Paul J. Lucas <paul@lucasmail.org> wrote:
> I currently have code that looks like:
>
> =A0 =A0Term[] terms =3D new Term[]{
> =A0 =A0 =A0 =A0new Term( key1, value1 ),
> =A0 =A0 =A0 =A0new Term( key2, value2 )
> =A0 =A0};
> =A0 =A0writer.deleteDocuments( terms );
>
> I want to change things such that it will delete all documents having key=
2's
> value start with value2, i.e., if value2 were "foo" then I want all
> documents to be deleted where key2's value starts with "foo" (i.e., "foo*=
").
>
> I still want key1's value to match value1 exactly, however.
>
> What's the simplest way to do do what I want? =A0Thanks.
>
> - Paul
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43046-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 10:52:52 2009
Return-Path: <java-user-return-43046-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44880 invoked from network); 27 Oct 2009 10:52:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 10:52:52 -0000
Received: (qmail 59959 invoked by uid 500); 27 Oct 2009 10:52:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59902 invoked by uid 500); 27 Oct 2009 10:52:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59811 invoked by uid 99); 27 Oct 2009 10:52:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 10:52:49 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [130.225.24.68] (HELO sbexch03.sb.statsbiblioteket.dk) (130.225.24.68)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 10:52:36 +0000
Received: from [172.18.253.199] (172.18.253.199) by
 sbexch03.sb.statsbiblioteket.dk (130.225.24.68) with Microsoft SMTP Server id
 8.1.393.1; Tue, 27 Oct 2009 11:52:16 +0100
Subject: Re: Performance tips when creating a large index from database.
From: Toke Eskildsen <te@statsbiblioteket.dk>
Reply-To: te@statsbiblioteket.dk
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
In-Reply-To: <359a92830910220614k4a072f6bs110629c14e280af3@mail.gmail.com>
References: <4AE053F7.60708@fastmail.fm>
	 <359a92830910220614k4a072f6bs110629c14e280af3@mail.gmail.com>
Content-Type: text/plain
Organization: Statsbiblioteket
Date: Tue, 27 Oct 2009 11:52:15 +0100
Message-ID: <1256640735.7373.1231.camel@pc286>
MIME-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

On Thu, 2009-10-22 at 15:14 +0200, Erick Erickson wrote:
> Besides the other suggestions, I'd really, really, really put
> some instrumentationin the code and see where you're spending your time. For
> a fast hint, put
> a cumulative timer around your indexing part only. This will indicate
> whether
> the time is consumed in querying your database or indexing......

I'll second that. We use this in most of our outer methods and log the
time used on DEBUG level (and INFO in a few select cases).

For pinpointing bottlenecks I'll also recommend VisualVM. It ships with
Java, but the newest version can be found at
https://visualvm.dev.java.net/ 

The beauty of this tool is that it requires no preparation. Just start
is and connect to a running Java program. It provides detailed CPU-usage
and RAM-allocation statistics.

- Toke


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43047-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 12:29:35 2009
Return-Path: <java-user-return-43047-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 73188 invoked from network); 27 Oct 2009 12:29:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 12:29:35 -0000
Received: (qmail 78141 invoked by uid 500); 27 Oct 2009 12:29:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78072 invoked by uid 500); 27 Oct 2009 12:29:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78062 invoked by uid 99); 27 Oct 2009 12:29:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 12:29:32 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [130.225.24.68] (HELO sbexch03.sb.statsbiblioteket.dk) (130.225.24.68)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 12:29:30 +0000
Received: from [172.18.253.199] (172.18.253.199) by
 sbexch03.sb.statsbiblioteket.dk (130.225.24.68) with Microsoft SMTP Server id
 8.1.393.1; Tue, 27 Oct 2009 13:29:08 +0100
Subject: Re: faceted search performance
From: Toke Eskildsen <te@statsbiblioteket.dk>
Reply-To: te@statsbiblioteket.dk
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
In-Reply-To: <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com>
References: <8669da1e0910120553t28efc634t9f808c3675021e53@mail.gmail.com>
	 <200910121745.12793.paul.elschot@xs4all.nl>
	 <8837fb770910120932r21555aa0t59e9b36db5663f70@mail.gmail.com>
	 <8669da1e0910121030w5ad239d9u52b447ff89b4f87@mail.gmail.com>
	 <4b124c310910121102k5fe69191r5a3ac0c5c4838bbd@mail.gmail.com>
Content-Type: text/plain
Organization: Statsbiblioteket
Date: Tue, 27 Oct 2009 13:29:07 +0100
Message-ID: <1256646547.7373.1290.camel@pc286>
MIME-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit

On Mon, 2009-10-12 at 20:02 +0200, Jake Mannix wrote:
> This killer is the "TermQuery for each term" part - this is huge. You need
> to invert this process, and use your query as is, but while walking in the 
> HitCollector, on each doc which matches your query, increment counters for
> each of the terms in that document (which means you need an in-memory 
> forward lookup for your documents, like a multivalued FieldCache - and if
> you've got roughly the same number of terms as documents, this cache is 
> likely to be as large as your entire index - a pretty hefty RAM cost).

We use something a lot like this, with some tricks to reduce memory
usage, primarily by storing the terms as a file:

A docID-array (#docs * 4 bytes) has an entry for each document that
specifies where in the field/term list to start reading. The number of
field/term entries to read is inferred by looking at the offset for the
next docID.

The field/term array (#terms * 4 bytes) consists of packed pairs, where
the field is specified by 5 bits (giving a max of 32 fields) and the
term by 27 bits (giving a maximum of 134 million unique terms/field).

For each field, a file is stored with the concatenated terms. An
in-memory array (#terms * 8 bytes) of offsets in the file for the terms
provides fast lookup. It should be possible to store this array as a
file, which would significantly reduce memory usage.

Total memory usage: (#docs * 4 bytes) + (#terms * 12 bytes).

[...]

> For each document you look at (which matches your query), you need to look
> at all of the terms in that document, and increment a counter for that term.

This can be done surprisingly fast as you do not need to look at the
terms (Strings) themselves. The pseudo-code for our counting is
something like

for (int id: docIDs) {
  for (int pos = docID-array[id] ; pos < docID-array[id+1] ; pos++) {
    counters[field_terms >> 27][field_terms & TERM_MASK]++
  )
)

In order to provide the result, we iterate the counters, extracting the
top-10 (or whatever amount of terms we want). After that we can retrieve
the actual Strings for the terms, as we can get the offset of the terms
by using the position from the counters.

Total memory-usage thus jumped to
(#docs * 4 bytes) + (#terms * 12 bytes) + 
((#terms * 4 bytes) * #concurrent searches)

To recap, our faceted search is thus

 - The search itself, providing a bitset with all matching docIDs
 - Counting (very tight loop with no conditionals)
 - Extracting top-x term-IDs for each field (heapsort or such)
 - Retrieving only the relevant terms from file
 - Clearing the counters for next usage

The last step is obviously somewhat critical, as requesting a facet
model with 10 fields of 20 terms each means a worst-case of 200 seeks.
In real world usage, caching helps a lot and SSDs help even more.

We did some tests on this and got the following, where #references is
the number of facet-search-relevant terms in the documents (in the first
example, this means that each document had an average of 10
facet-relevant terms).

* 10M docs, 10M unique facet-relevant terms, 100M refs, 1 machine
     A few 1000 hits < 100 ms
     A few 100.000 hits < 200 ms
     10M hits ~3 sec

* 100M docs, 1G unique facet-relevant terms, 1G refs, 3 machines
     A few 1000 hits ~1 sec (ouch)
     A few 100.000 hits ~1 sec
     10M hits < 3 sec
     100M hits ~15 sec

Lots of room for improvement for small numbers of hits and as always,
YMMW, but faceted search with a large number of terms in a large number
of documents is feasible.

Regards,
Toke Eskildsen


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43048-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 14:00:45 2009
Return-Path: <java-user-return-43048-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17663 invoked from network); 27 Oct 2009 14:00:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 14:00:45 -0000
Received: (qmail 63789 invoked by uid 500); 27 Oct 2009 14:00:43 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 63724 invoked by uid 500); 27 Oct 2009 14:00:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 63714 invoked by uid 99); 27 Oct 2009 14:00:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:00:42 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:00:33 +0000
Received: by pxi3 with SMTP id 3so110647pxi.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 07:00:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=izn+yRC9w+10RU/bve9MUOenGD4aG9DZ7ZUAxQzb4fE=;
        b=xzywIPWFS0vmLICMtG8hqo0aS5J6QzXSUWf077orWYOAottWc+ztdcumYXxq2jPxKW
         hu2D1AXTi7cVbR8JPl0J6DTCvb2uzEv4x+YrTqxOXNRz7SVqcFB4DOVgXirXXkt4ya25
         ODoKokOCFMj7yLDe+n4XZfF1y/190Hypd/V+s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=PPPz4nQXcaggIWWdXrX3IkdUXKfwnHP3b33VjK+gKw1gT4byTxxzsUdHmbzVZBtdXy
         pU8ha5jMckU3jH/rjkjoLmO6Zd+WKcN9Bek4ST7o9nalivLbVmYVreFwmhpD299Dgwjp
         vSRBvcKZzV2cS5LQjXFKYSK9oryBKLQfP0QGk=
MIME-Version: 1.0
Received: by 10.142.209.21 with SMTP id h21mr1237887wfg.162.1256652012274; 
	Tue, 27 Oct 2009 07:00:12 -0700 (PDT)
In-Reply-To: <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910250547o4d87432at29bc72c928f40797@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
Date: Tue, 27 Oct 2009 10:00:12 -0400
Message-ID: <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd32e86cc45720476eb18aa
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd32e86cc45720476eb18aa
Content-Type: text/plain; charset=ISO-8859-1

After rebuilding the corrupted indexes, the low disk space exception is now
occurring as expected. Sorry for the distraction.

fyi, here are the details:

 java.io.IOException: There is not enough space on the disk
    at java.io.RandomAccessFile.writeBytes(Native Method)
    at java.io.RandomAccessFile.write(Unknown Source)
    at
org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
    at
org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
    at
org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
    at
org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
    at
org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
    at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
    at
org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
    at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
    at
org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
    at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
    at
org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
    at
org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)


And the corresponding index info log:

IFD [Indexer]: setInfoStream
deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
IW 1 [Indexer]: setInfoStream:
dir=org.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
autoCommit=false
mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler=org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB=16.0
maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
maxFieldLength=2147483647 index=
IW 1 [Indexer]: flush at addIndexesNoOptimize
IW 1 [Indexer]:   flush: segment=null docStoreSegment=null docStoreOffset=0
flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
numBufDelTerms=0
IW 1 [Indexer]:   index before flush
IW 1 [Indexer]: now start transaction
IW 1 [Indexer]: LMP: findMerges: 2 segments
IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
IW 1 [Indexer]: CMS: now merge
IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
IW 1 [Indexer]: CMS:   no more merges pending; now return
IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
pending]
IW 1 [Indexer]: now merge
  merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
  merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
  index=_7:Cx1075533->_0** _8:Cx2795**
IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
IW 1 [Indexer]: merge: total 1074388 docs
IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores]
index=_7:Cx1075533->_0** _8:Cx2795**
IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0 [mergeDocStores]
IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit = false]
IW 1 [Indexer]: LMP: findMerges: 2 segments
IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pending]
IW 1 [Indexer]: now merge
  merge=_8:Cx2795 into _1 [mergeDocStores]
  merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
  index=_0:C1074388 _8:Cx2795**
IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
IW 1 [Indexer]: merge: total 2795 docs
IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
[mergeDocStores] exc=java.io.IOException: There is not enough space on the
disk
IW 1 [Indexer]: hit exception during merge
IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced file
"_1.fdt"
IFD [Indexer]: delete "_1.fdt"
IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced file
"_1.fdx"
IFD [Indexer]: delete "_1.fdx"
IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced file
"_1.fnm"
IFD [Indexer]: delete "_1.fnm"
IW 1 [Indexer]: now rollback transaction
IW 1 [Indexer]: all running merges have aborted
IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit = false]
IFD [Indexer]: delete "_0.nrm"
IFD [Indexer]: delete "_0.tis"
IFD [Indexer]: delete "_0.fnm"
IFD [Indexer]: delete "_0.tii"
IFD [Indexer]: delete "_0.frq"
IFD [Indexer]: delete "_0.fdx"
IFD [Indexer]: delete "_0.prx"
IFD [Indexer]: delete "_0.fdt"


Peter

On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:

>
>
> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com
>> >
>> >> wrote:
>> >> > Even running in console mode, the exception is difficult to
>> interpret.
>> >> > Here's an exception that I think occurred during an add document,
>> commit
>> >> or
>> >> > close:
>> >> > doc counts differ for segment _g: field Reader shows 137 but
>> segmentInfo
>> >> > shows 5777
>> >>
>> >> That's spooky.  Do you have the full exception for this one?  What IO
>> >> system are you running on?  (Is it just a local drive on your windows
>> >> computer?) It's almost as if the IO system is not generating an
>> >> IOException to Java when disk fills up.
>> >>
>> >
>> > Index and code are all on a local drive. There is no other exception
>> coming
>> > back - just what I reported.
>>
>> But, you didn't report a traceback for this first one?
>>
>
> Yes, I need to add some more printStackTrace calls.
>
>
>>
>> >> > I ensured that the disk space was low before updating the index.
>> >>
>> >> You mean, to intentionally test the disk-full case?
>> >>
>> >
>> > Yes, that's right.
>>
>> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
>> corruption to happen again, and post back the resulting output?  Make
>> sure your index first passes CheckIndex before starting (so we don't
>> begin the test w/ any pre-existing index corruption).
>>
>
> Good point about CheckIndex.  I've already found 2 bad ones. I will build
> new indexes from scratch. This will take a while.
>
>
>> >> > On another occasion, the exception was:
>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107
>> >> _4:C126
>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
>> >>
>> >> In this case, the SegmentMerger was trying to open this segment, but
>> >> on attempting to read the first int from the fdx (fields index) file
>> >> for one of the segments, it hit EOF.
>> >>
>> >> This is also spooky -- this looks like index corruption, which should
>> >> never happen on hitting disk full.
>> >>
>> >
>> > That's what I thought, too. Could Lucene be catching the IOException and
>> > turning it into a different exception?
>>
>> I think that's unlikely, but I guess possible.  We have "disk full"
>> tests in the unit tests, that throw an IOException at different times.
>>
>> What exact windows version are you using?  The local drive is NTFS?
>>
>
> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>
>
>>
>> Mike
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--000e0cd32e86cc45720476eb18aa--

From java-user-return-43049-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 14:08:00 2009
Return-Path: <java-user-return-43049-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19288 invoked from network); 27 Oct 2009 14:08:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 14:08:00 -0000
Received: (qmail 75213 invoked by uid 500); 27 Oct 2009 14:07:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75139 invoked by uid 500); 27 Oct 2009 14:07:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75129 invoked by uid 99); 27 Oct 2009 14:07:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:07:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:07:48 +0000
Received: by pxi3 with SMTP id 3so116436pxi.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 07:07:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=i+4D+FD3JeJx2r6g1NRg7TaPET7j1YutmK7BgDVanyM=;
        b=B5i79cWLgAgn92G23ZynH/vH43hQ8PXdFpR3WzzMuaMgjpUXBmLSpd5IPT9LmExGd+
         xdLnmIkHv37ypva77TjMI8GgxOWV/swRgKPNRppMcimpok2AmpY69oAD+mv85tuTvtBD
         Zy3NNi9lzLOXtJ7ZFJdg+0ytYSrhnBejYJ0pI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=SrzgjqceJAPN5PoJsdMDHCErpg4Ys6j4+mJOpWhqbVf42HIpMQxM+/TKoyIUxqd+60
         c/oTQXXSmrjbuqVbRS788pl+x2DUk1/iLd9y93VMvEm53hjKtMKI+pVx1JcEd8ovk3Ou
         XzvewXGWySNHp//tSU2FRGB2rhwpLXaMeVnsQ=
MIME-Version: 1.0
Received: by 10.143.154.33 with SMTP id g33mr1249507wfo.300.1256652447294; 
	Tue, 27 Oct 2009 07:07:27 -0700 (PDT)
In-Reply-To: <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
Date: Tue, 27 Oct 2009 10:07:27 -0400
Message-ID: <e994873a0910270707k18f01accjb68b665cb2c73adf@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636e0b6eeba24c60476eb32bc
X-Virus-Checked: Checked by ClamAV on apache.org

--001636e0b6eeba24c60476eb32bc
Content-Type: text/plain; charset=ISO-8859-1

Running CheckIndex after the IOException did produce an error in a term
frequency:

Opening index @ D:\mnsavs\lresumes3\lresumes3.luc\lresumes3.search.main.3

Segments file=segments_4 numSegments=2 version=FORMAT_DIAGNOSTICS [Lucene
2.9]
  1 of 2: name=_7 docCount=1075533
    compound=false
    hasProx=true
    numFiles=9
    size (MB)=3,190.933
    diagnostics = {optimize=true, mergeFactor=7, os.version=5.2, os=Windows
2003
, mergeDocStores=false, lucene.version=2.9 exported - 2009-10-26 07:58:55,
sourc
e=merge, os.arch=amd64, java.version=1.6.0_03, java.vendor=Sun Microsystems
Inc.
}
    docStoreOffset=0
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    has deletions [delFileName=_7_1.del]
    test: open reader.........OK [1145 deleted docs]
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid129$ docFreq=1 != num
doc
s seen 95 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid129$ docFreq=1 != num docs
seen 95
 + num docs deleted 0
        at
org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)

        at
org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
        at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [3223164 total field count; avg 3 fields
per do
c]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector f
ields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
        at
org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
        at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  2 of 2: name=_8 docCount=2795
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=10.636
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported
- 2009-10-26 07:58:55, source=flush, os.arch=amd64, java.version=1.6.0_03,
java.
vendor=Sun Microsystems Inc.}
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [228791 terms; 1139340 terms/docs pairs;
220927
3 tokens]
    test: stored fields.......OK [8385 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector f
ields per doc]

WARNING: 1 broken segments (containing 1074388 documents) detected
WARNING: 1074388 documents will be lost

NOTE: will write new segments file in 5 seconds; this will remove 1074388
docs f
rom the index. THIS IS YOUR LAST CHANCE TO CTRL+C!
  5...
  4...
  3...
  2...
  1...
Writing...
OK
Wrote new segments file "segments_5"

Peter


On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> After rebuilding the corrupted indexes, the low disk space exception is now
> occurring as expected. Sorry for the distraction.
>
> fyi, here are the details:
>
>  java.io.IOException: There is not enough space on the disk
>     at java.io.RandomAccessFile.writeBytes(Native Method)
>     at java.io.RandomAccessFile.write(Unknown Source)
>     at
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
>     at
> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
>     at
> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
>     at
> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
>     at
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
>     at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
>     at
> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
>     at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
>     at
> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
>
>     at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
>     at
> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
>     at
> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
>
>
> And the corresponding index info log:
>
> IFD [Indexer]: setInfoStream
> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
> IW 1 [Indexer]: setInfoStream:
> dir=org.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
> autoCommit=false
> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler=org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB=16.0 maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
> maxFieldLength=2147483647 index=
> IW 1 [Indexer]: flush at addIndexesNoOptimize
> IW 1 [Indexer]:   flush: segment=null docStoreSegment=null docStoreOffset=0
> flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> numBufDelTerms=0
> IW 1 [Indexer]:   index before flush
> IW 1 [Indexer]: now start transaction
> IW 1 [Indexer]: LMP: findMerges: 2 segments
> IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
> IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> IW 1 [Indexer]: CMS: now merge
> IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
> IW 1 [Indexer]: CMS:   no more merges pending; now return
> IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
> pending]
> IW 1 [Indexer]: now merge
>   merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
>   merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
>   index=_7:Cx1075533->_0** _8:Cx2795**
> IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
> IW 1 [Indexer]: merge: total 1074388 docs
> IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores]
> index=_7:Cx1075533->_0** _8:Cx2795**
> IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
> [mergeDocStores]
> IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit = false]
> IW 1 [Indexer]: LMP: findMerges: 2 segments
> IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
> IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pending]
> IW 1 [Indexer]: now merge
>   merge=_8:Cx2795 into _1 [mergeDocStores]
>   merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
>   index=_0:C1074388 _8:Cx2795**
> IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
> IW 1 [Indexer]: merge: total 2795 docs
> IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
> [mergeDocStores] exc=java.io.IOException: There is not enough space on the
> disk
> IW 1 [Indexer]: hit exception during merge
> IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
> file "_1.fdt"
> IFD [Indexer]: delete "_1.fdt"
> IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
> file "_1.fdx"
> IFD [Indexer]: delete "_1.fdx"
> IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
> file "_1.fnm"
> IFD [Indexer]: delete "_1.fnm"
> IW 1 [Indexer]: now rollback transaction
> IW 1 [Indexer]: all running merges have aborted
> IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit = false]
> IFD [Indexer]: delete "_0.nrm"
> IFD [Indexer]: delete "_0.tis"
> IFD [Indexer]: delete "_0.fnm"
> IFD [Indexer]: delete "_0.tii"
> IFD [Indexer]: delete "_0.frq"
> IFD [Indexer]: delete "_0.fdx"
> IFD [Indexer]: delete "_0.prx"
> IFD [Indexer]: delete "_0.fdt"
>
>
> Peter
>
>
> On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:
>
>>
>>
>> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>>> > lucene@mikemccandless.com> wrote:
>>> >
>>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
>>> peterlkeegan@gmail.com>
>>> >> wrote:
>>> >> > Even running in console mode, the exception is difficult to
>>> interpret.
>>> >> > Here's an exception that I think occurred during an add document,
>>> commit
>>> >> or
>>> >> > close:
>>> >> > doc counts differ for segment _g: field Reader shows 137 but
>>> segmentInfo
>>> >> > shows 5777
>>> >>
>>> >> That's spooky.  Do you have the full exception for this one?  What IO
>>> >> system are you running on?  (Is it just a local drive on your windows
>>> >> computer?) It's almost as if the IO system is not generating an
>>> >> IOException to Java when disk fills up.
>>> >>
>>> >
>>> > Index and code are all on a local drive. There is no other exception
>>> coming
>>> > back - just what I reported.
>>>
>>> But, you didn't report a traceback for this first one?
>>>
>>
>> Yes, I need to add some more printStackTrace calls.
>>
>>
>>>
>>> >> > I ensured that the disk space was low before updating the index.
>>> >>
>>> >> You mean, to intentionally test the disk-full case?
>>> >>
>>> >
>>> > Yes, that's right.
>>>
>>> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
>>> corruption to happen again, and post back the resulting output?  Make
>>> sure your index first passes CheckIndex before starting (so we don't
>>> begin the test w/ any pre-existing index corruption).
>>>
>>
>> Good point about CheckIndex.  I've already found 2 bad ones. I will build
>> new indexes from scratch. This will take a while.
>>
>>
>>> >> > On another occasion, the exception was:
>>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107
>>> >> _4:C126
>>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
>>> >>
>>> >> In this case, the SegmentMerger was trying to open this segment, but
>>> >> on attempting to read the first int from the fdx (fields index) file
>>> >> for one of the segments, it hit EOF.
>>> >>
>>> >> This is also spooky -- this looks like index corruption, which should
>>> >> never happen on hitting disk full.
>>> >>
>>> >
>>> > That's what I thought, too. Could Lucene be catching the IOException
>>> and
>>> > turning it into a different exception?
>>>
>>> I think that's unlikely, but I guess possible.  We have "disk full"
>>> tests in the unit tests, that throw an IOException at different times.
>>>
>>> What exact windows version are you using?  The local drive is NTFS?
>>>
>>
>> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>>
>>
>>>
>>> Mike
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>

--001636e0b6eeba24c60476eb32bc--

From java-user-return-43050-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 14:10:30 2009
Return-Path: <java-user-return-43050-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20081 invoked from network); 27 Oct 2009 14:10:30 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 14:10:30 -0000
Received: (qmail 81203 invoked by uid 500); 27 Oct 2009 14:10:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 81142 invoked by uid 500); 27 Oct 2009 14:10:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 81132 invoked by uid 99); 27 Oct 2009 14:10:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:10:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:10:18 +0000
Received: by pxi3 with SMTP id 3so118193pxi.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 07:09:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=KhHlbSOYOIJf2LnwD8E4272Ozm5MGXAHFhPiqYGJZo8=;
        b=t46uutzY3PAHKZ/zfrgCTQAbIkF/VREEX+tuvM4bCNTJ00oBtG6b05aPW1nusqYqAI
         tyYGyNOfMWp7Ieetg7lEsj5IzwaK7Zoh6bSK5UFA3ouLuhU31VJQljQz5osx/DZHr/d+
         vdgnepML4hYP/mEEIKm7IK12ZnEs+R2NwAgyw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=TsjYzuJ1hAIz7ZWH+/JaO8/cRtBQFFz0LGZKIc8KSnRIElvmK6eA2q8HnU2SDTImG0
         rkJ+c93ikZkb/fF1ZwaImoHpNolOJ1yMQZUKOFkoWZ2dCJRkNx8MGhEciH9+s1EK0+Y/
         CMA7IDzWB73J2tnXs9OivcS0fxeeh56BCjRfM=
MIME-Version: 1.0
Received: by 10.143.21.30 with SMTP id y30mr1305575wfi.229.1256652596919; Tue, 
	27 Oct 2009 07:09:56 -0700 (PDT)
In-Reply-To: <e994873a0910270707k18f01accjb68b665cb2c73adf@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <e994873a0910270707k18f01accjb68b665cb2c73adf@mail.gmail.com>
Date: Tue, 27 Oct 2009 10:09:56 -0400
Message-ID: <e994873a0910270709t6e74416btf5ccafa6f55faaef@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502ce03a53d0b0476eb3b70
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502ce03a53d0b0476eb3b70
Content-Type: text/plain; charset=ISO-8859-1

Clarification: this CheckIndex is on the index from which the merge/optimize
failed.
Peter

On Tue, Oct 27, 2009 at 10:07 AM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> Running CheckIndex after the IOException did produce an error in a term
> frequency:
>
> Opening index @ D:\mnsavs\lresumes3\lresumes3.luc\lresumes3.search.main.3
>
> Segments file=segments_4 numSegments=2 version=FORMAT_DIAGNOSTICS [Lucene
> 2.9]
>   1 of 2: name=_7 docCount=1075533
>     compound=false
>     hasProx=true
>     numFiles=9
>     size (MB)=3,190.933
>     diagnostics = {optimize=true, mergeFactor=7, os.version=5.2, os=Windows
> 2003
> , mergeDocStores=false, lucene.version=2.9 exported - 2009-10-26 07:58:55,
> sourc
> e=merge, os.arch=amd64, java.version=1.6.0_03, java.vendor=Sun Microsystems
> Inc.
> }
>     docStoreOffset=0
>     docStoreSegment=_0
>     docStoreIsCompoundFile=false
>     has deletions [delFileName=_7_1.del]
>     test: open reader.........OK [1145 deleted docs]
>     test: fields..............OK [33 fields]
>     test: field norms.........OK [33 fields]
>     test: terms, freq, prox...ERROR [term literals:cfid129$ docFreq=1 !=
> num doc
> s seen 95 + num docs deleted 0]
> java.lang.RuntimeException: term literals:cfid129$ docFreq=1 != num docs
> seen 95
>  + num docs deleted 0
>         at
> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
>
>         at
> org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
>         at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>     test: stored fields.......OK [3223164 total field count; avg 3 fields
> per do
> c]
>     test: term vectors........OK [0 total vector count; avg 0 term/freq
> vector f
> ields per doc]
> FAILED
>     WARNING: fixIndex() would remove reference to this segment; full
> exception:
> java.lang.RuntimeException: Term Index test failed
>         at
> org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
>         at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>
>   2 of 2: name=_8 docCount=2795
>     compound=false
>     hasProx=true
>     numFiles=8
>     size (MB)=10.636
>     diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
> exported
> - 2009-10-26 07:58:55, source=flush, os.arch=amd64, java.version=1.6.0_03,
> java.
> vendor=Sun Microsystems Inc.}
>     no deletions
>     test: open reader.........OK
>     test: fields..............OK [33 fields]
>     test: field norms.........OK [33 fields]
>     test: terms, freq, prox...OK [228791 terms; 1139340 terms/docs pairs;
> 220927
> 3 tokens]
>     test: stored fields.......OK [8385 total field count; avg 3 fields per
> doc]
>     test: term vectors........OK [0 total vector count; avg 0 term/freq
> vector f
> ields per doc]
>
> WARNING: 1 broken segments (containing 1074388 documents) detected
> WARNING: 1074388 documents will be lost
>
> NOTE: will write new segments file in 5 seconds; this will remove 1074388
> docs f
> rom the index. THIS IS YOUR LAST CHANCE TO CTRL+C!
>   5...
>   4...
>   3...
>   2...
>   1...
> Writing...
> OK
> Wrote new segments file "segments_5"
>
> Peter
>
>
>
> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com>wrote:
>
>> After rebuilding the corrupted indexes, the low disk space exception is
>> now occurring as expected. Sorry for the distraction.
>>
>> fyi, here are the details:
>>
>>  java.io.IOException: There is not enough space on the disk
>>     at java.io.RandomAccessFile.writeBytes(Native Method)
>>     at java.io.RandomAccessFile.write(Unknown Source)
>>     at
>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
>>     at
>> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
>>     at
>> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
>>     at
>> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
>>     at
>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
>>     at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
>>     at
>> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
>>     at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
>>     at
>> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
>>
>>     at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
>>     at
>> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
>>     at
>> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
>>
>>
>> And the corresponding index info log:
>>
>> IFD [Indexer]: setInfoStream
>> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
>> IW 1 [Indexer]: setInfoStream:
>> dir=org.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
>> autoCommit=false
>> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler=org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB=16.0 maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
>> maxFieldLength=2147483647 index=
>> IW 1 [Indexer]: flush at addIndexesNoOptimize
>> IW 1 [Indexer]:   flush: segment=null docStoreSegment=null
>> docStoreOffset=0 flushDocs=false flushDeletes=true flushDocStores=false
>> numDocs=0 numBufDelTerms=0
>> IW 1 [Indexer]:   index before flush
>> IW 1 [Indexer]: now start transaction
>> IW 1 [Indexer]: LMP: findMerges: 2 segments
>> IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
>> IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
>> IW 1 [Indexer]: CMS: now merge
>> IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
>> IW 1 [Indexer]: CMS:   no more merges pending; now return
>> IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
>> pending]
>> IW 1 [Indexer]: now merge
>>   merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
>>   merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
>>   index=_7:Cx1075533->_0** _8:Cx2795**
>> IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
>> IW 1 [Indexer]: merge: total 1074388 docs
>> IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores]
>> index=_7:Cx1075533->_0** _8:Cx2795**
>> IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
>> [mergeDocStores]
>> IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit = false]
>> IW 1 [Indexer]: LMP: findMerges: 2 segments
>> IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
>> IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
>> IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pending]
>> IW 1 [Indexer]: now merge
>>   merge=_8:Cx2795 into _1 [mergeDocStores]
>>   merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
>>   index=_0:C1074388 _8:Cx2795**
>> IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
>> IW 1 [Indexer]: merge: total 2795 docs
>> IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
>> [mergeDocStores] exc=java.io.IOException: There is not enough space on the
>> disk
>> IW 1 [Indexer]: hit exception during merge
>> IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
>> file "_1.fdt"
>> IFD [Indexer]: delete "_1.fdt"
>> IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
>> file "_1.fdx"
>> IFD [Indexer]: delete "_1.fdx"
>> IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
>> file "_1.fnm"
>> IFD [Indexer]: delete "_1.fnm"
>> IW 1 [Indexer]: now rollback transaction
>> IW 1 [Indexer]: all running merges have aborted
>> IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit = false]
>> IFD [Indexer]: delete "_0.nrm"
>> IFD [Indexer]: delete "_0.tis"
>> IFD [Indexer]: delete "_0.fnm"
>> IFD [Indexer]: delete "_0.tii"
>> IFD [Indexer]: delete "_0.frq"
>> IFD [Indexer]: delete "_0.fdx"
>> IFD [Indexer]: delete "_0.prx"
>> IFD [Indexer]: delete "_0.fdt"
>>
>>
>> Peter
>>
>>
>> On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:
>>
>>>
>>>
>>> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>>> lucene@mikemccandless.com> wrote:
>>>
>>>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com>
>>>> wrote:
>>>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>>>> > lucene@mikemccandless.com> wrote:
>>>> >
>>>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
>>>> peterlkeegan@gmail.com>
>>>> >> wrote:
>>>> >> > Even running in console mode, the exception is difficult to
>>>> interpret.
>>>> >> > Here's an exception that I think occurred during an add document,
>>>> commit
>>>> >> or
>>>> >> > close:
>>>> >> > doc counts differ for segment _g: field Reader shows 137 but
>>>> segmentInfo
>>>> >> > shows 5777
>>>> >>
>>>> >> That's spooky.  Do you have the full exception for this one?  What IO
>>>> >> system are you running on?  (Is it just a local drive on your windows
>>>> >> computer?) It's almost as if the IO system is not generating an
>>>> >> IOException to Java when disk fills up.
>>>> >>
>>>> >
>>>> > Index and code are all on a local drive. There is no other exception
>>>> coming
>>>> > back - just what I reported.
>>>>
>>>> But, you didn't report a traceback for this first one?
>>>>
>>>
>>> Yes, I need to add some more printStackTrace calls.
>>>
>>>
>>>>
>>>> >> > I ensured that the disk space was low before updating the index.
>>>> >>
>>>> >> You mean, to intentionally test the disk-full case?
>>>> >>
>>>> >
>>>> > Yes, that's right.
>>>>
>>>> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
>>>> corruption to happen again, and post back the resulting output?  Make
>>>> sure your index first passes CheckIndex before starting (so we don't
>>>> begin the test w/ any pre-existing index corruption).
>>>>
>>>
>>> Good point about CheckIndex.  I've already found 2 bad ones. I will build
>>> new indexes from scratch. This will take a while.
>>>
>>>
>>>> >> > On another occasion, the exception was:
>>>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C107
>>>> >> _4:C126
>>>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores]
>>>> >>
>>>> >> In this case, the SegmentMerger was trying to open this segment, but
>>>> >> on attempting to read the first int from the fdx (fields index) file
>>>> >> for one of the segments, it hit EOF.
>>>> >>
>>>> >> This is also spooky -- this looks like index corruption, which should
>>>> >> never happen on hitting disk full.
>>>> >>
>>>> >
>>>> > That's what I thought, too. Could Lucene be catching the IOException
>>>> and
>>>> > turning it into a different exception?
>>>>
>>>> I think that's unlikely, but I guess possible.  We have "disk full"
>>>> tests in the unit tests, that throw an IOException at different times.
>>>>
>>>> What exact windows version are you using?  The local drive is NTFS?
>>>>
>>>
>>> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>>>
>>>
>>>>
>>>> Mike
>>>>
>>>> ---------------------------------------------------------------------
>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>
>>>>
>>>
>>
>

--00504502ce03a53d0b0476eb3b70--

From java-user-return-43051-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 14:19:44 2009
Return-Path: <java-user-return-43051-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 22811 invoked from network); 27 Oct 2009 14:19:44 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 14:19:44 -0000
Received: (qmail 1753 invoked by uid 500); 27 Oct 2009 14:19:42 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1688 invoked by uid 500); 27 Oct 2009 14:19:42 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 1678 invoked by uid 99); 27 Oct 2009 14:19:42 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:19:42 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of maurodragoni@gmail.com designates 209.85.218.214 as permitted sender)
Received: from [209.85.218.214] (HELO mail-bw0-f214.google.com) (209.85.218.214)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:19:32 +0000
Received: by bwz6 with SMTP id 6so235244bwz.11
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 07:19:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=2EpOzi5U2HPitt0dhlY5T9I1z8AwlSIYJhP74FhB+lU=;
        b=CXkOeG1qLUOfCap5GVaAHP2BwjbL4wxMER2p9IxOnvw23ivzeKkoUSMRJuRZ9icndN
         TOv9d1miLVcJkQXmP3hz2FtptZBhO2QH2ZeZPthS7H8DIvZVZ1ym6YCnrzkwca+8jq8o
         z5kg+gb9a2PfKRyoQwPLmCAaE0CYBI+NJYj5Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=TrWT4Ud2yrr+2uTzUfsVb6eq92rmD1D9NR2jqTIZXwc6SsQvT0E71f6si9tcD9A563
         k2Hxw0JCNRKFOZF9PmgdsNPopQDTltS+mqNL/zyFMOrBQ3wY97JfQLdR3wobevTBssrL
         gvORrfvM2PeOcfTuyVO5Wnn+QMoCWwtYW71Oo=
MIME-Version: 1.0
Received: by 10.204.141.21 with SMTP id k21mr5693343bku.124.1256653151488; 
	Tue, 27 Oct 2009 07:19:11 -0700 (PDT)
In-Reply-To: <D7332105-F707-44A2-9BC0-88108D7F50EE@apache.org>
References: <20d4cf890910260725v6cdc0179g6c905d65348b8381@mail.gmail.com>
	 <D7332105-F707-44A2-9BC0-88108D7F50EE@apache.org>
Date: Tue, 27 Oct 2009 15:19:11 +0100
Message-ID: <20d4cf890910270719x53e0788k28010438124f9e57@mail.gmail.com>
Subject: Re: Multiterms query and payloads
From: Mauro Dragoni <maurodragoni@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Thanks for the advice...
I watch in the documentation, but I saw that the PayloadTermQuery
accept only one term a time... however, samething might be done with
the PayloadNearQuery.


On Mon, Oct 26, 2009 at 3:35 PM, Grant Ingersoll <gsingers@apache.org> wrot=
e:
> In 2.9, there is now the PayloadNearQuery, which might help you. =A0Other=
wise,
> the PayloadTermQuery is still a Query and can be used in a BooleanQuery.
> =A0Beyond that, you may need to write what you need, since it doesn't exi=
st
> yet.
>
>
> On Oct 26, 2009, at 10:25 AM, Mauro Dragoni wrote:
>
>> Hi to everyone,
>> I started to use payloads in my indexes.
>> However, I didn't find a class that permits to perform queries using
>> more than one term.
>> The only way that works is to use the BoostingTermQuery class, but by
>> using this class, I can search only one term a time.
>>
>> Does exist a way to do a multiterms search or I have to implement a
>> workaround that aggregates the results of single term searches?
>> Any other suggestions are accepted.
>>
>> Thanks to everyone.
>>
>> --
>> Dott. Mauro Dragoni
>> Ph.D. Student Universit=E0 di Milano, Italy
>>
>> My Business Site: http://www.dragotechpro.com
>> My Research Site: http://www.genalgo.com
>>
>>
>> Confidentially Notice. This electronic mail transmission may contain
>> legally privileged and/or confidential information. Do not read this,
>> if you are not the person named to.
>> Any use, distribution, copying or disclosure by any other person is
>> strictly prohibited.
>> If you received this transmission in error, please notify the sender
>> and delete the original transmission and its attachments without
>> reading or saving it in any manner.
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>
> --------------------------
> Grant Ingersoll
> http://www.lucidimagination.com/
>
> Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids) using
> Solr/Lucene:
> http://www.lucidimagination.com/search
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>



--=20
Dott. Mauro Dragoni
Ph.D. Student at Universit=E0 di Milano, Italy

My Business Site: http://www.dragotechpro.com
My Research Site: http://www.genalgo.com


Confidentially Notice. This electronic mail transmission may contain
legally privileged and/or confidential information. Do not read this,
if you are not the person named to.
Any use, distribution, copying or disclosure by any other person is
strictly prohibited.
If you received this transmission in error, please notify the sender
and delete the original transmission and its attachments without
reading or saving it in any manner.

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43052-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 14:37:35 2009
Return-Path: <java-user-return-43052-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29556 invoked from network); 27 Oct 2009 14:37:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 14:37:35 -0000
Received: (qmail 47592 invoked by uid 500); 27 Oct 2009 14:37:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 47523 invoked by uid 500); 27 Oct 2009 14:37:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 47513 invoked by uid 99); 27 Oct 2009 14:37:33 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:37:33 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:37:30 +0000
Received: by yxe30 with SMTP id 30so201874yxe.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 07:37:08 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.45.18 with SMTP id s18mr4059958ybs.20.1256654225846; Tue, 
	27 Oct 2009 07:37:05 -0700 (PDT)
In-Reply-To: <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910251635m75b3c84eidf0ca9b098b96e76@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
Date: Tue, 27 Oct 2009 10:37:05 -0400
Message-ID: <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

OK that exception looks more reasonable, for a disk full event.

But, I can't tell from your followon emails: did this lead to index corrupt=
ion?

Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- you
really should upgrade that to the latest 1.6.0 -- there's at least one
known problem with Lucene and early 1.6.0 JREs.

Mike

On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com> wro=
te:
> After rebuilding the corrupted indexes, the low disk space exception is n=
ow
> occurring as expected. Sorry for the distraction.
>
> fyi, here are the details:
>
> =A0java.io.IOException: There is not enough space on the disk
> =A0 =A0at java.io.RandomAccessFile.writeBytes(Native Method)
> =A0 =A0at java.io.RandomAccessFile.write(Unknown Source)
> =A0 =A0at
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer=
(SimpleFSDirectory.java:192)
> =A0 =A0at
> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutp=
ut.java:96)
> =A0 =A0at
> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.jav=
a:85)
> =A0 =A0at
> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.jav=
a:109)
> =A0 =A0at
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(Simpl=
eFSDirectory.java:199)
> =A0 =A0at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:14=
4)
> =A0 =A0at
> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
> =A0 =A0at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:=
153)
> =A0 =A0at
> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
> =A0 =A0at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596=
)
> =A0 =A0at
> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.j=
ava:3786)
> =A0 =A0at
> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java=
:3695)
>
>
> And the corresponding index info log:
>
> IFD [Indexer]: setInfoStream
> deletionPolicy=3Dorg.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy=
@256ef705
> IW 1 [Indexer]: setInfoStream:
> dir=3Dorg.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes3\lresu=
mes3.luc\lresumes3.update.main.4
> autoCommit=3Dfalse
> mergePolicy=3Dorg.apache.lucene.index.LogByteSizeMergePolicy@181b7c76merg=
eScheduler=3Dorg.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBu=
fferSizeMB=3D16.0
> maxBufferedDocs=3D-1 maxBuffereDeleteTerms=3D-1
> maxFieldLength=3D2147483647 index=3D
> IW 1 [Indexer]: flush at addIndexesNoOptimize
> IW 1 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3Dnull docStore=
Offset=3D0
> flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numDocs=3D0
> numBufDelTerms=3D0
> IW 1 [Indexer]: =A0 index before flush
> IW 1 [Indexer]: now start transaction
> IW 1 [Indexer]: LMP: findMerges: 2 segments
> IW 1 [Indexer]: LMP: =A0 level 8.774518 to 9.524518: 1 segments
> IW 1 [Indexer]: LMP: =A0 level 6.2973914 to 7.0473914: 1 segments
> IW 1 [Indexer]: CMS: now merge
> IW 1 [Indexer]: CMS: =A0 index: _7:Cx1075533->_0** _8:Cx2795**
> IW 1 [Indexer]: CMS: =A0 no more merges pending; now return
> IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
> pending]
> IW 1 [Indexer]: now merge
> =A0merge=3D_7:Cx1075533->_0 into _0 [mergeDocStores]
> =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@4d480ea
> =A0index=3D_7:Cx1075533->_0** _8:Cx2795**
> IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
> IW 1 [Indexer]: merge: total 1074388 docs
> IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores]
> index=3D_7:Cx1075533->_0** _8:Cx2795**
> IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0 [mergeDocStor=
es]
> IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit =3D fal=
se]
> IW 1 [Indexer]: LMP: findMerges: 2 segments
> IW 1 [Indexer]: LMP: =A0 level 8.864886 to 9.614886: 1 segments
> IW 1 [Indexer]: LMP: =A0 level 6.2973914 to 7.0473914: 1 segments
> IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pending]
> IW 1 [Indexer]: now merge
> =A0merge=3D_8:Cx2795 into _1 [mergeDocStores]
> =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
> =A0index=3D_0:C1074388 _8:Cx2795**
> IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
> IW 1 [Indexer]: merge: total 2795 docs
> IW 1 [Indexer]: handleMergeException: merge=3D_8:Cx2795 into _1
> [mergeDocStores] exc=3Djava.io.IOException: There is not enough space on =
the
> disk
> IW 1 [Indexer]: hit exception during merge
> IFD [Indexer]: refresh [prefix=3D_1]: removing newly created unreferenced=
 file
> "_1.fdt"
> IFD [Indexer]: delete "_1.fdt"
> IFD [Indexer]: refresh [prefix=3D_1]: removing newly created unreferenced=
 file
> "_1.fdx"
> IFD [Indexer]: delete "_1.fdx"
> IFD [Indexer]: refresh [prefix=3D_1]: removing newly created unreferenced=
 file
> "_1.fnm"
> IFD [Indexer]: delete "_1.fnm"
> IW 1 [Indexer]: now rollback transaction
> IW 1 [Indexer]: all running merges have aborted
> IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit =3D fal=
se]
> IFD [Indexer]: delete "_0.nrm"
> IFD [Indexer]: delete "_0.tis"
> IFD [Indexer]: delete "_0.fnm"
> IFD [Indexer]: delete "_0.tii"
> IFD [Indexer]: delete "_0.frq"
> IFD [Indexer]: delete "_0.fdx"
> IFD [Indexer]: delete "_0.prx"
> IFD [Indexer]: delete "_0.fdt"
>
>
> Peter
>
> On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com>wro=
te:
>
>>
>>
>> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>>> > lucene@mikemccandless.com> wrote:
>>> >
>>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.c=
om
>>> >
>>> >> wrote:
>>> >> > Even running in console mode, the exception is difficult to
>>> interpret.
>>> >> > Here's an exception that I think occurred during an add document,
>>> commit
>>> >> or
>>> >> > close:
>>> >> > doc counts differ for segment _g: field Reader shows 137 but
>>> segmentInfo
>>> >> > shows 5777
>>> >>
>>> >> That's spooky. =A0Do you have the full exception for this one? =A0Wh=
at IO
>>> >> system are you running on? =A0(Is it just a local drive on your wind=
ows
>>> >> computer?) It's almost as if the IO system is not generating an
>>> >> IOException to Java when disk fills up.
>>> >>
>>> >
>>> > Index and code are all on a local drive. There is no other exception
>>> coming
>>> > back - just what I reported.
>>>
>>> But, you didn't report a traceback for this first one?
>>>
>>
>> Yes, I need to add some more printStackTrace calls.
>>
>>
>>>
>>> >> > I ensured that the disk space was low before updating the index.
>>> >>
>>> >> You mean, to intentionally test the disk-full case?
>>> >>
>>> >
>>> > Yes, that's right.
>>>
>>> OK. =A0Can you turn on IndexWriter's infoStream, get this disk full /
>>> corruption to happen again, and post back the resulting output? =A0Make
>>> sure your index first passes CheckIndex before starting (so we don't
>>> begin the test w/ any pre-existing index corruption).
>>>
>>
>> Good point about CheckIndex. =A0I've already found 2 bad ones. I will bu=
ild
>> new indexes from scratch. This will take a while.
>>
>>
>>> >> > On another occasion, the exception was:
>>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123 _3:C10=
7
>>> >> _4:C126
>>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize] [mergeDocStores=
]
>>> >>
>>> >> In this case, the SegmentMerger was trying to open this segment, but
>>> >> on attempting to read the first int from the fdx (fields index) file
>>> >> for one of the segments, it hit EOF.
>>> >>
>>> >> This is also spooky -- this looks like index corruption, which shoul=
d
>>> >> never happen on hitting disk full.
>>> >>
>>> >
>>> > That's what I thought, too. Could Lucene be catching the IOException =
and
>>> > turning it into a different exception?
>>>
>>> I think that's unlikely, but I guess possible. =A0We have "disk full"
>>> tests in the unit tests, that throw an IOException at different times.
>>>
>>> What exact windows version are you using? =A0The local drive is NTFS?
>>>
>>
>> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>>
>>
>>>
>>> Mike
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43053-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 14:45:25 2009
Return-Path: <java-user-return-43053-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 32096 invoked from network); 27 Oct 2009 14:45:25 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 14:45:25 -0000
Received: (qmail 62763 invoked by uid 500); 27 Oct 2009 14:45:23 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 62685 invoked by uid 500); 27 Oct 2009 14:45:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 62675 invoked by uid 99); 27 Oct 2009 14:45:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:45:23 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 14:45:20 +0000
Received: by pzk3 with SMTP id 3so140095pzk.20
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 07:45:00 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=e0Yn/H1rsAQeYnzEBflZ7/LvUpA3x3VDYHxfW405jGE=;
        b=lsWefNa6F/9YXYZ6mZr4VDWu6r2MiJjC5vjtWyRK3wq59xGFWIn85SA5zKueE3JcHT
         qvZTrd7h+Ikf8e+dl73S9zXycBl2ZyY6eunTGlRHCw7jVk6OrzBLXBDqBXxSlVLThSWE
         j+r/hDh9XY8BOAu1tMVWk0orDBakh5c0/qB6Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Xnf8YeURckcQY0htTXdaQvwU1EvdawGdcJoH3JxFAQWnkAZ02R419xVqmPiVU1/Lux
         K9UMSGk6cHEuaNQcoS/VbXKwSNVcOf0h1cNNY4XG4XAadljHCFQ5RRGeVV62kaAyNG4X
         kDTe5Rb4oCrebP3rbfhoBN44LgKcZS6l7lFng=
MIME-Version: 1.0
Received: by 10.142.249.40 with SMTP id w40mr1281443wfh.344.1256654700000; 
	Tue, 27 Oct 2009 07:45:00 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910251740x2e87ff1dr3b4b3f405b158432@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
Date: Tue, 27 Oct 2009 10:44:59 -0400
Message-ID: <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636ed68acffb84a0476ebb86e

--001636ed68acffb84a0476ebb86e
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> OK that exception looks more reasonable, for a disk full event.
>
> But, I can't tell from your followon emails: did this lead to index
> corruption?
>

Yes, but this may be caused by the application ignoring a Lucene exception
somewhere else. I will chase this down.

>
> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- you
> really should upgrade that to the latest 1.6.0 -- there's at least one
> known problem with Lucene and early 1.6.0 JREs.
>

Yes, I remember this problem - that's why we stayed at _03
Thanks.

>
> Mike
>
> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > After rebuilding the corrupted indexes, the low disk space exception is
> now
> > occurring as expected. Sorry for the distraction.
> >
> > fyi, here are the details:
> >
> >  java.io.IOException: There is not enough space on the disk
> >    at java.io.RandomAccessFile.writeBytes(Native Method)
> >    at java.io.RandomAccessFile.write(Unknown Source)
> >    at
> >
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
> >    at
> >
> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
> >    at
> >
> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
> >    at
> >
> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
> >    at
> >
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
> >    at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
> >    at
> > org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
> >    at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
> >    at
> > org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
> >    at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
> >    at
> >
> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
> >    at
> >
> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
> >
> >
> > And the corresponding index info log:
> >
> > IFD [Indexer]: setInfoStream
> >
> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
> > IW 1 [Indexer]: setInfoStream:
> > dir=org.apache.lucene.store.SimpleFSDirectory@D
> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
> > autoCommit=false
> >
> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler
> =org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB
> =16.0
> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
> > maxFieldLength=2147483647 index=
> > IW 1 [Indexer]: flush at addIndexesNoOptimize
> > IW 1 [Indexer]:   flush: segment=null docStoreSegment=null
> docStoreOffset=0
> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> > numBufDelTerms=0
> > IW 1 [Indexer]:   index before flush
> > IW 1 [Indexer]: now start transaction
> > IW 1 [Indexer]: LMP: findMerges: 2 segments
> > IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> > IW 1 [Indexer]: CMS: now merge
> > IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
> > IW 1 [Indexer]: CMS:   no more merges pending; now return
> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
> > pending]
> > IW 1 [Indexer]: now merge
> >  merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
> >  index=_7:Cx1075533->_0** _8:Cx2795**
> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
> > IW 1 [Indexer]: merge: total 1074388 docs
> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores]
> > index=_7:Cx1075533->_0** _8:Cx2795**
> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
> [mergeDocStores]
> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit =
> false]
> > IW 1 [Indexer]: LMP: findMerges: 2 segments
> > IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pending]
> > IW 1 [Indexer]: now merge
> >  merge=_8:Cx2795 into _1 [mergeDocStores]
> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
> >  index=_0:C1074388 _8:Cx2795**
> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
> > IW 1 [Indexer]: merge: total 2795 docs
> > IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
> > [mergeDocStores] exc=java.io.IOException: There is not enough space on
> the
> > disk
> > IW 1 [Indexer]: hit exception during merge
> > IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
> file
> > "_1.fdt"
> > IFD [Indexer]: delete "_1.fdt"
> > IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
> file
> > "_1.fdx"
> > IFD [Indexer]: delete "_1.fdx"
> > IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
> file
> > "_1.fnm"
> > IFD [Indexer]: delete "_1.fnm"
> > IW 1 [Indexer]: now rollback transaction
> > IW 1 [Indexer]: all running merges have aborted
> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit =
> false]
> > IFD [Indexer]: delete "_0.nrm"
> > IFD [Indexer]: delete "_0.tis"
> > IFD [Indexer]: delete "_0.fnm"
> > IFD [Indexer]: delete "_0.tii"
> > IFD [Indexer]: delete "_0.frq"
> > IFD [Indexer]: delete "_0.fdx"
> > IFD [Indexer]: delete "_0.prx"
> > IFD [Indexer]: delete "_0.fdt"
> >
> >
> > Peter
> >
> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com
> >wrote:
> >
> >>
> >>
> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
> >> lucene@mikemccandless.com> wrote:
> >>
> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com>
> >>> wrote:
> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
> >>> > lucene@mikemccandless.com> wrote:
> >>> >
> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
> peterlkeegan@gmail.com
> >>> >
> >>> >> wrote:
> >>> >> > Even running in console mode, the exception is difficult to
> >>> interpret.
> >>> >> > Here's an exception that I think occurred during an add document,
> >>> commit
> >>> >> or
> >>> >> > close:
> >>> >> > doc counts differ for segment _g: field Reader shows 137 but
> >>> segmentInfo
> >>> >> > shows 5777
> >>> >>
> >>> >> That's spooky.  Do you have the full exception for this one?  What
> IO
> >>> >> system are you running on?  (Is it just a local drive on your
> windows
> >>> >> computer?) It's almost as if the IO system is not generating an
> >>> >> IOException to Java when disk fills up.
> >>> >>
> >>> >
> >>> > Index and code are all on a local drive. There is no other exception
> >>> coming
> >>> > back - just what I reported.
> >>>
> >>> But, you didn't report a traceback for this first one?
> >>>
> >>
> >> Yes, I need to add some more printStackTrace calls.
> >>
> >>
> >>>
> >>> >> > I ensured that the disk space was low before updating the index.
> >>> >>
> >>> >> You mean, to intentionally test the disk-full case?
> >>> >>
> >>> >
> >>> > Yes, that's right.
> >>>
> >>> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
> >>> corruption to happen again, and post back the resulting output?  Make
> >>> sure your index first passes CheckIndex before starting (so we don't
> >>> begin the test w/ any pre-existing index corruption).
> >>>
> >>
> >> Good point about CheckIndex.  I've already found 2 bad ones. I will
> build
> >> new indexes from scratch. This will take a while.
> >>
> >>
> >>> >> > On another occasion, the exception was:
> >>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123
> _3:C107
> >>> >> _4:C126
> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
> [mergeDocStores]
> >>> >>
> >>> >> In this case, the SegmentMerger was trying to open this segment, but
> >>> >> on attempting to read the first int from the fdx (fields index) file
> >>> >> for one of the segments, it hit EOF.
> >>> >>
> >>> >> This is also spooky -- this looks like index corruption, which
> should
> >>> >> never happen on hitting disk full.
> >>> >>
> >>> >
> >>> > That's what I thought, too. Could Lucene be catching the IOException
> and
> >>> > turning it into a different exception?
> >>>
> >>> I think that's unlikely, but I guess possible.  We have "disk full"
> >>> tests in the unit tests, that throw an IOException at different times.
> >>>
> >>> What exact windows version are you using?  The local drive is NTFS?
> >>>
> >>
> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
> >>
> >>
> >>>
> >>> Mike
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001636ed68acffb84a0476ebb86e--

From java-user-return-43054-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 17:40:53 2009
Return-Path: <java-user-return-43054-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 632 invoked from network); 27 Oct 2009 17:40:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 17:40:52 -0000
Received: (qmail 13360 invoked by uid 500); 27 Oct 2009 17:40:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13268 invoked by uid 500); 27 Oct 2009 17:40:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13258 invoked by uid 99); 27 Oct 2009 17:40:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 17:40:50 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 17:40:45 +0000
Received: by pxi3 with SMTP id 3so276962pxi.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 10:40:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=FITRax7I9U3yArmj9f++rLhIFfF7LiXxXqbLbQ4APbQ=;
        b=Uuy6KV1agga+/R/9TybBtyYnvWN60437uHmSZE59o53D5bOfNzKpN0tZ6mOFF/jy7U
         aEJxHge6M7nkKRQKxNdxgSuVyPuifBfnFL9ICj3KxTVFxWwrGFmGvAEEYvL8sHQ3FHqK
         IN55ZsjkqEvaDyQ5AD+Sa7BsbZ3JJZBbqWHRI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=HIKWOarIJXaNDE95uHvMmUbnRpQBbaNY+0o5l3hR4kTXnwWaRWLKPnsW0UfcF/RVZD
         QmptelFWbiaM3ei46oqEJh7TMtKnX7DYjbMPwtSjguDuruWHDWO/C/iRoVG2hKxFIj8A
         1CybnQY1C0oBcYYYlGXV8l1kD24aHiqky/4Po=
MIME-Version: 1.0
Received: by 10.142.202.5 with SMTP id z5mr1356146wff.170.1256665225707; Tue, 
	27 Oct 2009 10:40:25 -0700 (PDT)
In-Reply-To: <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910251754u405e06dcudc3dfd5054595f79@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
Date: Tue, 27 Oct 2009 13:40:25 -0400
Message-ID: <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd2df3a6140620476ee2c0e

--000e0cd2df3a6140620476ee2c0e
Content-Type: text/plain; charset=ISO-8859-1

It seems the index is corrupted immediately after the initial build (ample
disk space was provided):

Output from CheckIndex:

Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2

Segments file=segments_3 numSegments=1 version=FORMAT_DIAGNOSTICS [Lucene
2.9]
  1 of 1: name=_7 docCount=1077025
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=3,201.196
    diagnostics = {optimize=true, mergeFactor=7, os.version=5.2, os=Windows
2003, mergeDocStores=false, lucene.version=2.9 exported - 2009-10-26
07:58:55, source=merge, os.arch=amd64, java.version=1.6.0_03,
java.vendor=Sun Microsystems Inc.}
    docStoreOffset=0
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num docs
seen 482 + num docs deleted 0]
java.lang.RuntimeException: term contents:? docFreq=1 != num docs seen 482 +
num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [3231075 total field count; avg 3 fields
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

WARNING: 1 broken segments (containing 1077025 documents) detected
WARNING: would write new segments file, and 1077025 documents would be lost,
if -fix were specified

Searching on this index seems to be fine, though.

Here is the IndexWriter log from the build:

IFD [Indexer]: setInfoStream
deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@2a9cfec1
IW 0 [Indexer]: setInfoStream:
dir=org.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.update.main.2
autoCommit=false
mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@291946c2mergeScheduler=org.apache.lucene.index.ConcurrentMergeScheduler@3a747fa2ramBufferSizeMB=16.0
maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
maxFieldLength=2147483647 index=
IW 0 [Indexer]: setRAMBufferSizeMB 910.25
IW 0 [Indexer]: setMaxBufferedDocs 1000000
IW 0 [Indexer]: flush at getReader
IW 0 [Indexer]:   flush: segment=null docStoreSegment=null docStoreOffset=0
flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
numBufDelTerms=0
IW 0 [Indexer]:   index before flush
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=886.463 allocMB=886.463
deletesMB=23.803 triggerMB=910.25
IW 0 [UpdWriterBuild]:   flush: segment=_0 docStoreSegment=_0
docStoreOffset=0 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=171638 numBufDelTerms=171638
IW 0 [UpdWriterBuild]:   index before flush
IW 0 [UpdWriterBuild]: DW: flush postings as segment _0 numDocs=171638
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=929523712 newFlushedSize=573198529
docs/MB=313.985 new/old=61.666%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 1 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=857.977 allocMB=901.32
deletesMB=52.274 triggerMB=910.25
IW 0 [UpdWriterBuild]:   flush: segment=_1 docStoreSegment=_0
docStoreOffset=171638 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=204995 numBufDelTerms=204995
IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _1 numDocs=204995
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=899653632 newFlushedSize=544283851
docs/MB=394.928 new/old=60.499%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 2 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=834.645 vs
trigger=910.25 allocMB=901.32 deletesMB=75.627 vs trigger=955.762
byteBlockFree=35.938 charBlockFree=8.938
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=66.613 usedMB=910.272
allocMB=834.707
IW 0 [UpdWriterBuild]:   flush: segment=_2 docStoreSegment=_0
docStoreOffset=376633 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=168236 numBufDelTerms=168236
IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _2 numDocs=168236
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=875188224 newFlushedSize=530720464
docs/MB=332.394 new/old=60.641%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 3 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
_2:C168236->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=814.282 allocMB=835.832
deletesMB=95.997 triggerMB=910.25
IW 0 [UpdWriterBuild]:   flush: segment=_3 docStoreSegment=_0
docStoreOffset=544869 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=146894 numBufDelTerms=146894
IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
_2:C168236->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _3 numDocs=146894
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=853836800 newFlushedSize=522388771
docs/MB=294.856 new/old=61.181%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 4 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=791.724 allocMB=835.832
deletesMB=118.535 triggerMB=910.25
IW 0 [UpdWriterBuild]:   flush: segment=_4 docStoreSegment=_0
docStoreOffset=691763 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=162034 numBufDelTerms=162034
IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _4 numDocs=162034
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=830182400 newFlushedSize=498741034
docs/MB=340.668 new/old=60.076%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 5 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=771.396 vs
trigger=910.25 allocMB=835.832 deletesMB=138.875 vs trigger=955.762
byteBlockFree=39.688 charBlockFree=7.188
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=64.374 usedMB=910.271
allocMB=771.458
IW 0 [UpdWriterBuild]:   flush: segment=_5 docStoreSegment=_0
docStoreOffset=853797 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=146250 numBufDelTerms=146250
IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _5 numDocs=146250
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=808866816 newFlushedSize=485212402
docs/MB=316.056 new/old=59.987%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 6 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [Indexer]: commit: start
IW 0 [Indexer]: commit: now prepare
IW 0 [Indexer]: prepareCommit: flush
IW 0 [Indexer]:   flush: segment=_6 docStoreSegment=_0
docStoreOffset=1000047 flushDocs=true flushDeletes=true flushDocStores=true
numDocs=76978 numBufDelTerms=76978
IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
IW 0 [Indexer]:   flush shared docStore segment _0
IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
numDocs=1077025
IW 0 [Indexer]: DW: flush postings as segment _6 numDocs=76978
IW 0 [Indexer]: DW:   oldRAMSize=486968320 newFlushedSize=273168136
docs/MB=295.486 new/old=56.096%
IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit = false]
IW 0 [Indexer]: DW: apply 1077025 buffered deleted terms and 0 deleted
docIDs and 0 deleted queries on 7 segments.
IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit = false]
IW 0 [Indexer]: LMP: findMerges: 7 segments
IW 0 [Indexer]: LMP:   level 8.008305 to 8.758305: 7 segments
IW 0 [Indexer]: CMS: now merge
IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0 _2:C168236->_0
_3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
IW 0 [Indexer]: CMS:   no more merges pending; now return
IW 0 [Indexer]: startCommit(): start sizeInBytes=0
IW 0 [Indexer]: startCommit index=_0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
changeCount=21
IW 0 [Indexer]: now sync _0.tis
IW 0 [Indexer]: now sync _5.prx
IW 0 [Indexer]: now sync _3.frq
IW 0 [Indexer]: now sync _3.tii
IW 0 [Indexer]: now sync _1.frq
IW 0 [Indexer]: now sync _6.frq
IW 0 [Indexer]: now sync _4.prx
IW 0 [Indexer]: now sync _4.fnm
IW 0 [Indexer]: now sync _2.tii
IW 0 [Indexer]: now sync _3.fnm
IW 0 [Indexer]: now sync _1.fnm
IW 0 [Indexer]: now sync _6.tis
IW 0 [Indexer]: now sync _4.frq
IW 0 [Indexer]: now sync _5.nrm
IW 0 [Indexer]: now sync _5.tis
IW 0 [Indexer]: now sync _1.tii
IW 0 [Indexer]: now sync _4.tis
IW 0 [Indexer]: now sync _0.prx
IW 0 [Indexer]: now sync _3.nrm
IW 0 [Indexer]: now sync _4.tii
IW 0 [Indexer]: now sync _0.nrm
IW 0 [Indexer]: now sync _5.fnm
IW 0 [Indexer]: now sync _1.tis
IW 0 [Indexer]: now sync _0.fnm
IW 0 [Indexer]: now sync _2.prx
IW 0 [Indexer]: now sync _6.tii
IW 0 [Indexer]: now sync _4.nrm
IW 0 [Indexer]: now sync _2.frq
IW 0 [Indexer]: now sync _5.frq
IW 0 [Indexer]: now sync _3.prx
IW 0 [Indexer]: now sync _5.tii
IW 0 [Indexer]: now sync _2.fnm
IW 0 [Indexer]: now sync _1.prx
IW 0 [Indexer]: now sync _2.tis
IW 0 [Indexer]: now sync _0.tii
IW 0 [Indexer]: now sync _6.prx
IW 0 [Indexer]: now sync _0.frq
IW 0 [Indexer]: now sync _6.fnm
IW 0 [Indexer]: now sync _0.fdx
IW 0 [Indexer]: now sync _6.nrm
IW 0 [Indexer]: now sync _0.fdt
IW 0 [Indexer]: now sync _1.nrm
IW 0 [Indexer]: now sync _2.nrm
IW 0 [Indexer]: now sync _3.tis
IW 0 [Indexer]: done all syncs
IW 0 [Indexer]: commit: pendingCommit != null
IW 0 [Indexer]: commit: wrote segments file "segments_2"
IFD [Indexer]: now checkpoint "segments_2" [7 segments ; isCommit = true]
IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
IFD [Indexer]: delete "segments_1"
IW 0 [Indexer]: commit: done
IW 0 [Indexer]: optimize: index now _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6 docStoreOffset=0
flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
numBufDelTerms=0
IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
IW 0 [Indexer]: add merge to pendingMerges: _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
[optimize] [total 1 pending]
IW 0 [Indexer]: CMS: now merge
IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0 _2:C168236->_0
_3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
IW 0 [Indexer]: CMS:   consider merge _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
into _7 [optimize]
IW 0 [Indexer]: CMS:     launch new thread [Lucene Merge Thread #0]
IW 0 [Indexer]: CMS:   no more merges pending; now return
IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: start
IW 0 [Lucene Merge Thread #0]: now merge
  merge=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
_4:C162034->_0 _5:C146250->_0 _6:C76978->_0 into _7 [optimize]
  merge=org.apache.lucene.index.MergePolicy$OneMerge@78688954
  index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
_4:C162034->_0 _5:C146250->_0 _6:C76978->_0
IW 0 [Lucene Merge Thread #0]: merging _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
into _7 [optimize]
IW 0 [Lucene Merge Thread #0]: merge: total 1077025 docs
IW 0 [Lucene Merge Thread #0]: commitMerge: _0:C171638->_0 _1:C204995->_0
_2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
into _7 [optimize] index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0
_3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
IW 0 [Lucene Merge Thread #0]: commitMergeDeletes _0:C171638->_0
_1:C204995->_0 _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
_6:C76978->_0 into _7 [optimize]
IFD [Lucene Merge Thread #0]: now checkpoint "segments_2" [1 segments ;
isCommit = false]
IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: done
IW 0 [Indexer]: now flush at close
IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6 docStoreOffset=0
flushDocs=false flushDeletes=true flushDocStores=true numDocs=0
numBufDelTerms=0
IW 0 [Indexer]:   index before flush _7:C1077025->_0
IW 0 [Indexer]:   flush shared docStore segment _6
IW 0 [Indexer]: DW: closeDocStore: 0 files to flush to segment _6 numDocs=0
IW 0 [Indexer]: CMS: now merge
IW 0 [Indexer]: CMS:   index: _7:C1077025->_0
IW 0 [Indexer]: CMS:   no more merges pending; now return
IW 0 [Indexer]: now call final commit()
IW 0 [Indexer]: startCommit(): start sizeInBytes=0
IW 0 [Indexer]: startCommit index=_7:C1077025->_0 changeCount=23
IW 0 [Indexer]: now sync _7.prx
IW 0 [Indexer]: now sync _7.fnm
IW 0 [Indexer]: now sync _7.tis
IW 0 [Indexer]: now sync _7.nrm
IW 0 [Indexer]: now sync _7.tii
IW 0 [Indexer]: now sync _7.frq
IW 0 [Indexer]: done all syncs
IW 0 [Indexer]: commit: pendingCommit != null
IW 0 [Indexer]: commit: wrote segments file "segments_3"
IFD [Indexer]: now checkpoint "segments_3" [1 segments ; isCommit = true]
IFD [Indexer]: deleteCommits: now decRef commit "segments_2"
IFD [Indexer]: delete "_0.tis"
IFD [Indexer]: delete "_5.prx"
IFD [Indexer]: delete "_3.tii"
IFD [Indexer]: delete "_3.frq"
IFD [Indexer]: delete "_1.frq"
IFD [Indexer]: delete "_6.frq"
IFD [Indexer]: delete "_4.prx"
IFD [Indexer]: delete "_4.fnm"
IFD [Indexer]: delete "_2.tii"
IFD [Indexer]: delete "_3.fnm"
IFD [Indexer]: delete "_1.fnm"
IFD [Indexer]: delete "_6.tis"
IFD [Indexer]: delete "_4.frq"
IFD [Indexer]: delete "_5.nrm"
IFD [Indexer]: delete "_5.tis"
IFD [Indexer]: delete "_1.tii"
IFD [Indexer]: delete "_4.tis"
IFD [Indexer]: delete "_0.prx"
IFD [Indexer]: delete "_3.nrm"
IFD [Indexer]: delete "_4.tii"
IFD [Indexer]: delete "_0.nrm"
IFD [Indexer]: delete "_5.fnm"
IFD [Indexer]: delete "_1.tis"
IFD [Indexer]: delete "_0.fnm"
IFD [Indexer]: delete "_2.prx"
IFD [Indexer]: delete "_6.tii"
IFD [Indexer]: delete "_4.nrm"
IFD [Indexer]: delete "_2.frq"
IFD [Indexer]: delete "_5.frq"
IFD [Indexer]: delete "_3.prx"
IFD [Indexer]: delete "_5.tii"
IFD [Indexer]: delete "_2.fnm"
IFD [Indexer]: delete "_1.prx"
IFD [Indexer]: delete "_2.tis"
IFD [Indexer]: delete "_0.tii"
IFD [Indexer]: delete "_6.prx"
IFD [Indexer]: delete "_0.frq"
IFD [Indexer]: delete "segments_2"
IFD [Indexer]: delete "_6.fnm"
IFD [Indexer]: delete "_6.nrm"
IFD [Indexer]: delete "_1.nrm"
IFD [Indexer]: delete "_2.nrm"
IFD [Indexer]: delete "_3.tis"
IW 0 [Indexer]: commit: done
IW 0 [Indexer]: at close: _7:C1077025->_0

I see no errors.
Peter


On Tue, Oct 27, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com>wrote:

>
>
> On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> OK that exception looks more reasonable, for a disk full event.
>>
>> But, I can't tell from your followon emails: did this lead to index
>> corruption?
>>
>
> Yes, but this may be caused by the application ignoring a Lucene exception
> somewhere else. I will chase this down.
>
>>
>> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- you
>> really should upgrade that to the latest 1.6.0 -- there's at least one
>> known problem with Lucene and early 1.6.0 JREs.
>>
>
> Yes, I remember this problem - that's why we stayed at _03
> Thanks.
>
>>
>> Mike
>>
>> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > After rebuilding the corrupted indexes, the low disk space exception is
>> now
>> > occurring as expected. Sorry for the distraction.
>> >
>> > fyi, here are the details:
>> >
>> >  java.io.IOException: There is not enough space on the disk
>> >    at java.io.RandomAccessFile.writeBytes(Native Method)
>> >    at java.io.RandomAccessFile.write(Unknown Source)
>> >    at
>> >
>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
>> >    at
>> >
>> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
>> >    at
>> >
>> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
>> >    at
>> >
>> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
>> >    at
>> >
>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
>> >    at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
>> >    at
>> >
>> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
>> >    at
>> org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
>> >    at
>> > org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
>> >    at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
>> >    at
>> >
>> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
>> >    at
>> >
>> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
>> >
>> >
>> > And the corresponding index info log:
>> >
>> > IFD [Indexer]: setInfoStream
>> >
>> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
>> > IW 1 [Indexer]: setInfoStream:
>> > dir=org.apache.lucene.store.SimpleFSDirectory@D
>> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
>> > autoCommit=false
>> >
>> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler
>> =org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB
>> =16.0
>> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
>> > maxFieldLength=2147483647 index=
>> > IW 1 [Indexer]: flush at addIndexesNoOptimize
>> > IW 1 [Indexer]:   flush: segment=null docStoreSegment=null
>> docStoreOffset=0
>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
>> > numBufDelTerms=0
>> > IW 1 [Indexer]:   index before flush
>> > IW 1 [Indexer]: now start transaction
>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>> > IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
>> > IW 1 [Indexer]: CMS: now merge
>> > IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
>> > IW 1 [Indexer]: CMS:   no more merges pending; now return
>> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
>> > pending]
>> > IW 1 [Indexer]: now merge
>> >  merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
>> >  index=_7:Cx1075533->_0** _8:Cx2795**
>> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
>> > IW 1 [Indexer]: merge: total 1074388 docs
>> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores]
>> > index=_7:Cx1075533->_0** _8:Cx2795**
>> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
>> [mergeDocStores]
>> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit =
>> false]
>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>> > IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
>> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pending]
>> > IW 1 [Indexer]: now merge
>> >  merge=_8:Cx2795 into _1 [mergeDocStores]
>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
>> >  index=_0:C1074388 _8:Cx2795**
>> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
>> > IW 1 [Indexer]: merge: total 2795 docs
>> > IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
>> > [mergeDocStores] exc=java.io.IOException: There is not enough space on
>> the
>> > disk
>> > IW 1 [Indexer]: hit exception during merge
>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
>> file
>> > "_1.fdt"
>> > IFD [Indexer]: delete "_1.fdt"
>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
>> file
>> > "_1.fdx"
>> > IFD [Indexer]: delete "_1.fdx"
>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created unreferenced
>> file
>> > "_1.fnm"
>> > IFD [Indexer]: delete "_1.fnm"
>> > IW 1 [Indexer]: now rollback transaction
>> > IW 1 [Indexer]: all running merges have aborted
>> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit =
>> false]
>> > IFD [Indexer]: delete "_0.nrm"
>> > IFD [Indexer]: delete "_0.tis"
>> > IFD [Indexer]: delete "_0.fnm"
>> > IFD [Indexer]: delete "_0.tii"
>> > IFD [Indexer]: delete "_0.frq"
>> > IFD [Indexer]: delete "_0.fdx"
>> > IFD [Indexer]: delete "_0.prx"
>> > IFD [Indexer]: delete "_0.fdt"
>> >
>> >
>> > Peter
>> >
>> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com
>> >wrote:
>> >
>> >>
>> >>
>> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>> >> lucene@mikemccandless.com> wrote:
>> >>
>> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.com
>> >
>> >>> wrote:
>> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>> >>> > lucene@mikemccandless.com> wrote:
>> >>> >
>> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
>> peterlkeegan@gmail.com
>> >>> >
>> >>> >> wrote:
>> >>> >> > Even running in console mode, the exception is difficult to
>> >>> interpret.
>> >>> >> > Here's an exception that I think occurred during an add document,
>> >>> commit
>> >>> >> or
>> >>> >> > close:
>> >>> >> > doc counts differ for segment _g: field Reader shows 137 but
>> >>> segmentInfo
>> >>> >> > shows 5777
>> >>> >>
>> >>> >> That's spooky.  Do you have the full exception for this one?  What
>> IO
>> >>> >> system are you running on?  (Is it just a local drive on your
>> windows
>> >>> >> computer?) It's almost as if the IO system is not generating an
>> >>> >> IOException to Java when disk fills up.
>> >>> >>
>> >>> >
>> >>> > Index and code are all on a local drive. There is no other exception
>> >>> coming
>> >>> > back - just what I reported.
>> >>>
>> >>> But, you didn't report a traceback for this first one?
>> >>>
>> >>
>> >> Yes, I need to add some more printStackTrace calls.
>> >>
>> >>
>> >>>
>> >>> >> > I ensured that the disk space was low before updating the index.
>> >>> >>
>> >>> >> You mean, to intentionally test the disk-full case?
>> >>> >>
>> >>> >
>> >>> > Yes, that's right.
>> >>>
>> >>> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
>> >>> corruption to happen again, and post back the resulting output?  Make
>> >>> sure your index first passes CheckIndex before starting (so we don't
>> >>> begin the test w/ any pre-existing index corruption).
>> >>>
>> >>
>> >> Good point about CheckIndex.  I've already found 2 bad ones. I will
>> build
>> >> new indexes from scratch. This will take a while.
>> >>
>> >>
>> >>> >> > On another occasion, the exception was:
>> >>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123
>> _3:C107
>> >>> >> _4:C126
>> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
>> [mergeDocStores]
>> >>> >>
>> >>> >> In this case, the SegmentMerger was trying to open this segment,
>> but
>> >>> >> on attempting to read the first int from the fdx (fields index)
>> file
>> >>> >> for one of the segments, it hit EOF.
>> >>> >>
>> >>> >> This is also spooky -- this looks like index corruption, which
>> should
>> >>> >> never happen on hitting disk full.
>> >>> >>
>> >>> >
>> >>> > That's what I thought, too. Could Lucene be catching the IOException
>> and
>> >>> > turning it into a different exception?
>> >>>
>> >>> I think that's unlikely, but I guess possible.  We have "disk full"
>> >>> tests in the unit tests, that throw an IOException at different times.
>> >>>
>> >>> What exact windows version are you using?  The local drive is NTFS?
>> >>>
>> >>
>> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>> >>
>> >>
>> >>>
>> >>> Mike
>> >>>
>> >>> ---------------------------------------------------------------------
>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>>
>> >>>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--000e0cd2df3a6140620476ee2c0e--

From java-user-return-43055-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 18:57:42 2009
Return-Path: <java-user-return-43055-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 37801 invoked from network); 27 Oct 2009 18:57:42 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 18:57:42 -0000
Received: (qmail 27774 invoked by uid 500); 27 Oct 2009 18:57:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27739 invoked by uid 500); 27 Oct 2009 18:57:39 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27729 invoked by uid 99); 27 Oct 2009 18:57:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 18:57:39 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 18:57:30 +0000
Received: by ywh13 with SMTP id 13so15047ywh.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 11:57:08 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.241.5 with SMTP id o5mr15580764ybh.173.1256669828120; Tue, 
	27 Oct 2009 11:57:08 -0700 (PDT)
In-Reply-To: <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910260744u478fb363sea1b057d2779f980@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
Date: Tue, 27 Oct 2009 14:57:07 -0400
Message-ID: <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

This is odd -- is it reproducible?

Can you narrow it down to a small set of docs that when indexed
produce a corrupted index?

If you attempt to optimize the index, does it fail?

Mike

On Tue, Oct 27, 2009 at 1:40 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
> It seems the index is corrupted immediately after the initial build (ampl=
e
> disk space was provided):
>
> Output from CheckIndex:
>
> Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
>
> Segments file=3Dsegments_3 numSegments=3D1 version=3DFORMAT_DIAGNOSTICS [=
Lucene
> 2.9]
> =A01 of 1: name=3D_7 docCount=3D1077025
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D3,201.196
> =A0 =A0diagnostics =3D {optimize=3Dtrue, mergeFactor=3D7, os.version=3D5.=
2, os=3DWindows
> 2003, mergeDocStores=3Dfalse, lucene.version=3D2.9 exported - 2009-10-26
> 07:58:55, source=3Dmerge, os.arch=3Damd64, java.version=3D1.6.0_03,
> java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D0
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...ERROR [term contents:? docFreq=3D1 !=3D =
num docs
> seen 482 + num docs deleted 0]
> java.lang.RuntimeException: term contents:? docFreq=3D1 !=3D num docs see=
n 482 +
> num docs deleted 0
> =A0 =A0at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.jav=
a:675)
> =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:5=
30)
> =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> =A0 =A0test: stored fields.......OK [3231075 total field count; avg 3 fie=
lds
> per doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
> FAILED
> =A0 =A0WARNING: fixIndex() would remove reference to this segment; full
> exception:
> java.lang.RuntimeException: Term Index test failed
> =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:5=
43)
> =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>
> WARNING: 1 broken segments (containing 1077025 documents) detected
> WARNING: would write new segments file, and 1077025 documents would be lo=
st,
> if -fix were specified
>
> Searching on this index seems to be fine, though.
>
> Here is the IndexWriter log from the build:
>
> IFD [Indexer]: setInfoStream
> deletionPolicy=3Dorg.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy=
@2a9cfec1
> IW 0 [Indexer]: setInfoStream:
> dir=3Dorg.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes1\lresu=
mes1.luc\lresumes1.update.main.2
> autoCommit=3Dfalse
> mergePolicy=3Dorg.apache.lucene.index.LogByteSizeMergePolicy@291946c2merg=
eScheduler=3Dorg.apache.lucene.index.ConcurrentMergeScheduler@3a747fa2ramBu=
fferSizeMB=3D16.0
> maxBufferedDocs=3D-1 maxBuffereDeleteTerms=3D-1
> maxFieldLength=3D2147483647 index=3D
> IW 0 [Indexer]: setRAMBufferSizeMB 910.25
> IW 0 [Indexer]: setMaxBufferedDocs 1000000
> IW 0 [Indexer]: flush at getReader
> IW 0 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3Dnull docStore=
Offset=3D0
> flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numDocs=3D0
> numBufDelTerms=3D0
> IW 0 [Indexer]: =A0 index before flush
> IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D886.463 allocMB=
=3D886.463
> deletesMB=3D23.803 triggerMB=3D910.25
> IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_0 docStoreSegment=3D_0
> docStoreOffset=3D0 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocStores=
=3Dfalse
> numDocs=3D171638 numBufDelTerms=3D171638
> IW 0 [UpdWriterBuild]: =A0 index before flush
> IW 0 [UpdWriterBuild]: DW: flush postings as segment _0 numDocs=3D171638
> IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D929523712 newFlushedSize=3D57=
3198529
> docs/MB=3D313.985 new/old=3D61.666%
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit =
=3D
> false]
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit =
=3D
> false]
> IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
> IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 1 segments
> IW 0 [UpdWriterBuild]: CMS: now merge
> IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0
> IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
> IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D857.977 allocMB=
=3D901.32
> deletesMB=3D52.274 triggerMB=3D910.25
> IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_1 docStoreSegment=3D_0
> docStoreOffset=3D171638 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocSto=
res=3Dfalse
> numDocs=3D204995 numBufDelTerms=3D204995
> IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0
> IW 0 [UpdWriterBuild]: DW: flush postings as segment _1 numDocs=3D204995
> IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D899653632 newFlushedSize=3D54=
4283851
> docs/MB=3D394.928 new/old=3D60.499%
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit =
=3D
> false]
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit =
=3D
> false]
> IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
> IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 2 segments
> IW 0 [UpdWriterBuild]: CMS: now merge
> IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
> IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
> IW 0 [UpdWriterBuild]: DW: =A0 RAM: now balance allocations: usedMB=3D834=
.645 vs
> trigger=3D910.25 allocMB=3D901.32 deletesMB=3D75.627 vs trigger=3D955.762
> byteBlockFree=3D35.938 charBlockFree=3D8.938
> IW 0 [UpdWriterBuild]: DW: =A0 =A0 nothing to free
> IW 0 [UpdWriterBuild]: DW: =A0 =A0 after free: freedMB=3D66.613 usedMB=3D=
910.272
> allocMB=3D834.707
> IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_2 docStoreSegment=3D_0
> docStoreOffset=3D376633 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocSto=
res=3Dfalse
> numDocs=3D168236 numBufDelTerms=3D168236
> IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0 _1:C204995->=
_0
> IW 0 [UpdWriterBuild]: DW: flush postings as segment _2 numDocs=3D168236
> IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D875188224 newFlushedSize=3D53=
0720464
> docs/MB=3D332.394 new/old=3D60.641%
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit =
=3D
> false]
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit =
=3D
> false]
> IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
> IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 3 segments
> IW 0 [UpdWriterBuild]: CMS: now merge
> IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0
> IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
> IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D814.282 allocMB=
=3D835.832
> deletesMB=3D95.997 triggerMB=3D910.25
> IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_3 docStoreSegment=3D_0
> docStoreOffset=3D544869 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocSto=
res=3Dfalse
> numDocs=3D146894 numBufDelTerms=3D146894
> IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0 _1:C204995->=
_0
> _2:C168236->_0
> IW 0 [UpdWriterBuild]: DW: flush postings as segment _3 numDocs=3D146894
> IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D853836800 newFlushedSize=3D52=
2388771
> docs/MB=3D294.856 new/old=3D61.181%
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit =
=3D
> false]
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit =
=3D
> false]
> IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
> IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 4 segments
> IW 0 [UpdWriterBuild]: CMS: now merge
> IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0
> IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
> IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D791.724 allocMB=
=3D835.832
> deletesMB=3D118.535 triggerMB=3D910.25
> IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_4 docStoreSegment=3D_0
> docStoreOffset=3D691763 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocSto=
res=3Dfalse
> numDocs=3D162034 numBufDelTerms=3D162034
> IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0 _1:C204995->=
_0
> _2:C168236->_0 _3:C146894->_0
> IW 0 [UpdWriterBuild]: DW: flush postings as segment _4 numDocs=3D162034
> IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D830182400 newFlushedSize=3D49=
8741034
> docs/MB=3D340.668 new/old=3D60.076%
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit =
=3D
> false]
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit =
=3D
> false]
> IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
> IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 5 segments
> IW 0 [UpdWriterBuild]: CMS: now merge
> IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
> IW 0 [UpdWriterBuild]: DW: =A0 RAM: now balance allocations: usedMB=3D771=
.396 vs
> trigger=3D910.25 allocMB=3D835.832 deletesMB=3D138.875 vs trigger=3D955.7=
62
> byteBlockFree=3D39.688 charBlockFree=3D7.188
> IW 0 [UpdWriterBuild]: DW: =A0 =A0 nothing to free
> IW 0 [UpdWriterBuild]: DW: =A0 =A0 after free: freedMB=3D64.374 usedMB=3D=
910.271
> allocMB=3D771.458
> IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_5 docStoreSegment=3D_0
> docStoreOffset=3D853797 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocSto=
res=3Dfalse
> numDocs=3D146250 numBufDelTerms=3D146250
> IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0 _1:C204995->=
_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> IW 0 [UpdWriterBuild]: DW: flush postings as segment _5 numDocs=3D146250
> IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D808866816 newFlushedSize=3D48=
5212402
> docs/MB=3D316.056 new/old=3D59.987%
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit =
=3D
> false]
> IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit =
=3D
> false]
> IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
> IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 6 segments
> IW 0 [UpdWriterBuild]: CMS: now merge
> IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
> IW 0 [Indexer]: commit: start
> IW 0 [Indexer]: commit: now prepare
> IW 0 [Indexer]: prepareCommit: flush
> IW 0 [Indexer]: =A0 flush: segment=3D_6 docStoreSegment=3D_0
> docStoreOffset=3D1000047 flushDocs=3Dtrue flushDeletes=3Dtrue flushDocSto=
res=3Dtrue
> numDocs=3D76978 numBufDelTerms=3D76978
> IW 0 [Indexer]: =A0 index before flush _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> IW 0 [Indexer]: =A0 flush shared docStore segment _0
> IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
> numDocs=3D1077025
> IW 0 [Indexer]: DW: flush postings as segment _6 numDocs=3D76978
> IW 0 [Indexer]: DW: =A0 oldRAMSize=3D486968320 newFlushedSize=3D273168136
> docs/MB=3D295.486 new/old=3D56.096%
> IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =3D fal=
se]
> IW 0 [Indexer]: DW: apply 1077025 buffered deleted terms and 0 deleted
> docIDs and 0 deleted queries on 7 segments.
> IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =3D fal=
se]
> IW 0 [Indexer]: LMP: findMerges: 7 segments
> IW 0 [Indexer]: LMP: =A0 level 8.008305 to 8.758305: 7 segments
> IW 0 [Indexer]: CMS: now merge
> IW 0 [Indexer]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0 _2:C168236-=
>_0
> _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> IW 0 [Indexer]: CMS: =A0 no more merges pending; now return
> IW 0 [Indexer]: startCommit(): start sizeInBytes=3D0
> IW 0 [Indexer]: startCommit index=3D_0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> changeCount=3D21
> IW 0 [Indexer]: now sync _0.tis
> IW 0 [Indexer]: now sync _5.prx
> IW 0 [Indexer]: now sync _3.frq
> IW 0 [Indexer]: now sync _3.tii
> IW 0 [Indexer]: now sync _1.frq
> IW 0 [Indexer]: now sync _6.frq
> IW 0 [Indexer]: now sync _4.prx
> IW 0 [Indexer]: now sync _4.fnm
> IW 0 [Indexer]: now sync _2.tii
> IW 0 [Indexer]: now sync _3.fnm
> IW 0 [Indexer]: now sync _1.fnm
> IW 0 [Indexer]: now sync _6.tis
> IW 0 [Indexer]: now sync _4.frq
> IW 0 [Indexer]: now sync _5.nrm
> IW 0 [Indexer]: now sync _5.tis
> IW 0 [Indexer]: now sync _1.tii
> IW 0 [Indexer]: now sync _4.tis
> IW 0 [Indexer]: now sync _0.prx
> IW 0 [Indexer]: now sync _3.nrm
> IW 0 [Indexer]: now sync _4.tii
> IW 0 [Indexer]: now sync _0.nrm
> IW 0 [Indexer]: now sync _5.fnm
> IW 0 [Indexer]: now sync _1.tis
> IW 0 [Indexer]: now sync _0.fnm
> IW 0 [Indexer]: now sync _2.prx
> IW 0 [Indexer]: now sync _6.tii
> IW 0 [Indexer]: now sync _4.nrm
> IW 0 [Indexer]: now sync _2.frq
> IW 0 [Indexer]: now sync _5.frq
> IW 0 [Indexer]: now sync _3.prx
> IW 0 [Indexer]: now sync _5.tii
> IW 0 [Indexer]: now sync _2.fnm
> IW 0 [Indexer]: now sync _1.prx
> IW 0 [Indexer]: now sync _2.tis
> IW 0 [Indexer]: now sync _0.tii
> IW 0 [Indexer]: now sync _6.prx
> IW 0 [Indexer]: now sync _0.frq
> IW 0 [Indexer]: now sync _6.fnm
> IW 0 [Indexer]: now sync _0.fdx
> IW 0 [Indexer]: now sync _6.nrm
> IW 0 [Indexer]: now sync _0.fdt
> IW 0 [Indexer]: now sync _1.nrm
> IW 0 [Indexer]: now sync _2.nrm
> IW 0 [Indexer]: now sync _3.tis
> IW 0 [Indexer]: done all syncs
> IW 0 [Indexer]: commit: pendingCommit !=3D null
> IW 0 [Indexer]: commit: wrote segments file "segments_2"
> IFD [Indexer]: now checkpoint "segments_2" [7 segments ; isCommit =3D tru=
e]
> IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
> IFD [Indexer]: delete "segments_1"
> IW 0 [Indexer]: commit: done
> IW 0 [Indexer]: optimize: index now _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> IW 0 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3D_6 docStoreOf=
fset=3D0
> flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numDocs=3D0
> numBufDelTerms=3D0
> IW 0 [Indexer]: =A0 index before flush _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> IW 0 [Indexer]: add merge to pendingMerges: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> [optimize] [total 1 pending]
> IW 0 [Indexer]: CMS: now merge
> IW 0 [Indexer]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0 _2:C168236-=
>_0
> _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> IW 0 [Indexer]: CMS: =A0 consider merge _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> into _7 [optimize]
> IW 0 [Indexer]: CMS: =A0 =A0 launch new thread [Lucene Merge Thread #0]
> IW 0 [Indexer]: CMS: =A0 no more merges pending; now return
> IW 0 [Lucene Merge Thread #0]: CMS: =A0 merge thread: start
> IW 0 [Lucene Merge Thread #0]: now merge
> =A0merge=3D_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
> _4:C162034->_0 _5:C146250->_0 _6:C76978->_0 into _7 [optimize]
> =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@78688954
> =A0index=3D_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
> _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> IW 0 [Lucene Merge Thread #0]: merging _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> into _7 [optimize]
> IW 0 [Lucene Merge Thread #0]: merge: total 1077025 docs
> IW 0 [Lucene Merge Thread #0]: commitMerge: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> into _7 [optimize] index=3D_0:C171638->_0 _1:C204995->_0 _2:C168236->_0
> _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> IW 0 [Lucene Merge Thread #0]: commitMergeDeletes _0:C171638->_0
> _1:C204995->_0 _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_=
0
> _6:C76978->_0 into _7 [optimize]
> IFD [Lucene Merge Thread #0]: now checkpoint "segments_2" [1 segments ;
> isCommit =3D false]
> IW 0 [Lucene Merge Thread #0]: CMS: =A0 merge thread: done
> IW 0 [Indexer]: now flush at close
> IW 0 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3D_6 docStoreOf=
fset=3D0
> flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dtrue numDocs=3D0
> numBufDelTerms=3D0
> IW 0 [Indexer]: =A0 index before flush _7:C1077025->_0
> IW 0 [Indexer]: =A0 flush shared docStore segment _6
> IW 0 [Indexer]: DW: closeDocStore: 0 files to flush to segment _6 numDocs=
=3D0
> IW 0 [Indexer]: CMS: now merge
> IW 0 [Indexer]: CMS: =A0 index: _7:C1077025->_0
> IW 0 [Indexer]: CMS: =A0 no more merges pending; now return
> IW 0 [Indexer]: now call final commit()
> IW 0 [Indexer]: startCommit(): start sizeInBytes=3D0
> IW 0 [Indexer]: startCommit index=3D_7:C1077025->_0 changeCount=3D23
> IW 0 [Indexer]: now sync _7.prx
> IW 0 [Indexer]: now sync _7.fnm
> IW 0 [Indexer]: now sync _7.tis
> IW 0 [Indexer]: now sync _7.nrm
> IW 0 [Indexer]: now sync _7.tii
> IW 0 [Indexer]: now sync _7.frq
> IW 0 [Indexer]: done all syncs
> IW 0 [Indexer]: commit: pendingCommit !=3D null
> IW 0 [Indexer]: commit: wrote segments file "segments_3"
> IFD [Indexer]: now checkpoint "segments_3" [1 segments ; isCommit =3D tru=
e]
> IFD [Indexer]: deleteCommits: now decRef commit "segments_2"
> IFD [Indexer]: delete "_0.tis"
> IFD [Indexer]: delete "_5.prx"
> IFD [Indexer]: delete "_3.tii"
> IFD [Indexer]: delete "_3.frq"
> IFD [Indexer]: delete "_1.frq"
> IFD [Indexer]: delete "_6.frq"
> IFD [Indexer]: delete "_4.prx"
> IFD [Indexer]: delete "_4.fnm"
> IFD [Indexer]: delete "_2.tii"
> IFD [Indexer]: delete "_3.fnm"
> IFD [Indexer]: delete "_1.fnm"
> IFD [Indexer]: delete "_6.tis"
> IFD [Indexer]: delete "_4.frq"
> IFD [Indexer]: delete "_5.nrm"
> IFD [Indexer]: delete "_5.tis"
> IFD [Indexer]: delete "_1.tii"
> IFD [Indexer]: delete "_4.tis"
> IFD [Indexer]: delete "_0.prx"
> IFD [Indexer]: delete "_3.nrm"
> IFD [Indexer]: delete "_4.tii"
> IFD [Indexer]: delete "_0.nrm"
> IFD [Indexer]: delete "_5.fnm"
> IFD [Indexer]: delete "_1.tis"
> IFD [Indexer]: delete "_0.fnm"
> IFD [Indexer]: delete "_2.prx"
> IFD [Indexer]: delete "_6.tii"
> IFD [Indexer]: delete "_4.nrm"
> IFD [Indexer]: delete "_2.frq"
> IFD [Indexer]: delete "_5.frq"
> IFD [Indexer]: delete "_3.prx"
> IFD [Indexer]: delete "_5.tii"
> IFD [Indexer]: delete "_2.fnm"
> IFD [Indexer]: delete "_1.prx"
> IFD [Indexer]: delete "_2.tis"
> IFD [Indexer]: delete "_0.tii"
> IFD [Indexer]: delete "_6.prx"
> IFD [Indexer]: delete "_0.frq"
> IFD [Indexer]: delete "segments_2"
> IFD [Indexer]: delete "_6.fnm"
> IFD [Indexer]: delete "_6.nrm"
> IFD [Indexer]: delete "_1.nrm"
> IFD [Indexer]: delete "_2.nrm"
> IFD [Indexer]: delete "_3.tis"
> IW 0 [Indexer]: commit: done
> IW 0 [Indexer]: at close: _7:C1077025->_0
>
> I see no errors.
> Peter
>
>
> On Tue, Oct 27, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com>wr=
ote:
>
>>
>>
>> On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> OK that exception looks more reasonable, for a disk full event.
>>>
>>> But, I can't tell from your followon emails: did this lead to index
>>> corruption?
>>>
>>
>> Yes, but this may be caused by the application ignoring a Lucene excepti=
on
>> somewhere else. I will chase this down.
>>
>>>
>>> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- you
>>> really should upgrade that to the latest 1.6.0 -- there's at least one
>>> known problem with Lucene and early 1.6.0 JREs.
>>>
>>
>> Yes, I remember this problem - that's why we stayed at _03
>> Thanks.
>>
>>>
>>> Mike
>>>
>>> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>> > After rebuilding the corrupted indexes, the low disk space exception =
is
>>> now
>>> > occurring as expected. Sorry for the distraction.
>>> >
>>> > fyi, here are the details:
>>> >
>>> > =A0java.io.IOException: There is not enough space on the disk
>>> > =A0 =A0at java.io.RandomAccessFile.writeBytes(Native Method)
>>> > =A0 =A0at java.io.RandomAccessFile.write(Unknown Source)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuff=
er(SimpleFSDirectory.java:192)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOu=
tput.java:96)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.j=
ava:85)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.j=
ava:109)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(Sim=
pleFSDirectory.java:199)
>>> > =A0 =A0at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.jav=
a:144)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:35=
7)
>>> > =A0 =A0at
>>> org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
>>> > =A0 =A0at
>>> > org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011=
)
>>> > =A0 =A0at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:=
4596)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter=
.java:3786)
>>> > =A0 =A0at
>>> >
>>> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.ja=
va:3695)
>>> >
>>> >
>>> > And the corresponding index info log:
>>> >
>>> > IFD [Indexer]: setInfoStream
>>> >
>>> deletionPolicy=3Dorg.apache.lucene.index.KeepOnlyLastCommitDeletionPoli=
cy@256ef705
>>> > IW 1 [Indexer]: setInfoStream:
>>> > dir=3Dorg.apache.lucene.store.SimpleFSDirectory@D
>>> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
>>> > autoCommit=3Dfalse
>>> >
>>> mergePolicy=3Dorg.apache.lucene.index.LogByteSizeMergePolicy@181b7c76me=
rgeScheduler
>>> =3Dorg.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSi=
zeMB
>>> =3D16.0
>>> > maxBufferedDocs=3D-1 maxBuffereDeleteTerms=3D-1
>>> > maxFieldLength=3D2147483647 index=3D
>>> > IW 1 [Indexer]: flush at addIndexesNoOptimize
>>> > IW 1 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3Dnull
>>> docStoreOffset=3D0
>>> > flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numDocs=
=3D0
>>> > numBufDelTerms=3D0
>>> > IW 1 [Indexer]: =A0 index before flush
>>> > IW 1 [Indexer]: now start transaction
>>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>>> > IW 1 [Indexer]: LMP: =A0 level 8.774518 to 9.524518: 1 segments
>>> > IW 1 [Indexer]: LMP: =A0 level 6.2973914 to 7.0473914: 1 segments
>>> > IW 1 [Indexer]: CMS: now merge
>>> > IW 1 [Indexer]: CMS: =A0 index: _7:Cx1075533->_0** _8:Cx2795**
>>> > IW 1 [Indexer]: CMS: =A0 no more merges pending; now return
>>> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
>>> > pending]
>>> > IW 1 [Indexer]: now merge
>>> > =A0merge=3D_7:Cx1075533->_0 into _0 [mergeDocStores]
>>> > =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@4d480ea
>>> > =A0index=3D_7:Cx1075533->_0** _8:Cx2795**
>>> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
>>> > IW 1 [Indexer]: merge: total 1074388 docs
>>> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0 [mergeDocStores=
]
>>> > index=3D_7:Cx1075533->_0** _8:Cx2795**
>>> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
>>> [mergeDocStores]
>>> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit =3D
>>> false]
>>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>>> > IW 1 [Indexer]: LMP: =A0 level 8.864886 to 9.614886: 1 segments
>>> > IW 1 [Indexer]: LMP: =A0 level 6.2973914 to 7.0473914: 1 segments
>>> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1 pendin=
g]
>>> > IW 1 [Indexer]: now merge
>>> > =A0merge=3D_8:Cx2795 into _1 [mergeDocStores]
>>> > =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
>>> > =A0index=3D_0:C1074388 _8:Cx2795**
>>> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
>>> > IW 1 [Indexer]: merge: total 2795 docs
>>> > IW 1 [Indexer]: handleMergeException: merge=3D_8:Cx2795 into _1
>>> > [mergeDocStores] exc=3Djava.io.IOException: There is not enough space=
 on
>>> the
>>> > disk
>>> > IW 1 [Indexer]: hit exception during merge
>>> > IFD [Indexer]: refresh [prefix=3D_1]: removing newly created unrefere=
nced
>>> file
>>> > "_1.fdt"
>>> > IFD [Indexer]: delete "_1.fdt"
>>> > IFD [Indexer]: refresh [prefix=3D_1]: removing newly created unrefere=
nced
>>> file
>>> > "_1.fdx"
>>> > IFD [Indexer]: delete "_1.fdx"
>>> > IFD [Indexer]: refresh [prefix=3D_1]: removing newly created unrefere=
nced
>>> file
>>> > "_1.fnm"
>>> > IFD [Indexer]: delete "_1.fnm"
>>> > IW 1 [Indexer]: now rollback transaction
>>> > IW 1 [Indexer]: all running merges have aborted
>>> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit =3D
>>> false]
>>> > IFD [Indexer]: delete "_0.nrm"
>>> > IFD [Indexer]: delete "_0.tis"
>>> > IFD [Indexer]: delete "_0.fnm"
>>> > IFD [Indexer]: delete "_0.tii"
>>> > IFD [Indexer]: delete "_0.frq"
>>> > IFD [Indexer]: delete "_0.fdx"
>>> > IFD [Indexer]: delete "_0.prx"
>>> > IFD [Indexer]: delete "_0.fdt"
>>> >
>>> >
>>> > Peter
>>> >
>>> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <peterlkeegan@gmail.com
>>> >wrote:
>>> >
>>> >>
>>> >>
>>> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>>> >> lucene@mikemccandless.com> wrote:
>>> >>
>>> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <peterlkeegan@gmail.c=
om
>>> >
>>> >>> wrote:
>>> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>>> >>> > lucene@mikemccandless.com> wrote:
>>> >>> >
>>> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
>>> peterlkeegan@gmail.com
>>> >>> >
>>> >>> >> wrote:
>>> >>> >> > Even running in console mode, the exception is difficult to
>>> >>> interpret.
>>> >>> >> > Here's an exception that I think occurred during an add docume=
nt,
>>> >>> commit
>>> >>> >> or
>>> >>> >> > close:
>>> >>> >> > doc counts differ for segment _g: field Reader shows 137 but
>>> >>> segmentInfo
>>> >>> >> > shows 5777
>>> >>> >>
>>> >>> >> That's spooky. =A0Do you have the full exception for this one? =
=A0What
>>> IO
>>> >>> >> system are you running on? =A0(Is it just a local drive on your
>>> windows
>>> >>> >> computer?) It's almost as if the IO system is not generating an
>>> >>> >> IOException to Java when disk fills up.
>>> >>> >>
>>> >>> >
>>> >>> > Index and code are all on a local drive. There is no other except=
ion
>>> >>> coming
>>> >>> > back - just what I reported.
>>> >>>
>>> >>> But, you didn't report a traceback for this first one?
>>> >>>
>>> >>
>>> >> Yes, I need to add some more printStackTrace calls.
>>> >>
>>> >>
>>> >>>
>>> >>> >> > I ensured that the disk space was low before updating the inde=
x.
>>> >>> >>
>>> >>> >> You mean, to intentionally test the disk-full case?
>>> >>> >>
>>> >>> >
>>> >>> > Yes, that's right.
>>> >>>
>>> >>> OK. =A0Can you turn on IndexWriter's infoStream, get this disk full=
 /
>>> >>> corruption to happen again, and post back the resulting output? =A0=
Make
>>> >>> sure your index first passes CheckIndex before starting (so we don'=
t
>>> >>> begin the test w/ any pre-existing index corruption).
>>> >>>
>>> >>
>>> >> Good point about CheckIndex. =A0I've already found 2 bad ones. I wil=
l
>>> build
>>> >> new indexes from scratch. This will take a while.
>>> >>
>>> >>
>>> >>> >> > On another occasion, the exception was:
>>> >>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123
>>> _3:C107
>>> >>> >> _4:C126
>>> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
>>> [mergeDocStores]
>>> >>> >>
>>> >>> >> In this case, the SegmentMerger was trying to open this segment,
>>> but
>>> >>> >> on attempting to read the first int from the fdx (fields index)
>>> file
>>> >>> >> for one of the segments, it hit EOF.
>>> >>> >>
>>> >>> >> This is also spooky -- this looks like index corruption, which
>>> should
>>> >>> >> never happen on hitting disk full.
>>> >>> >>
>>> >>> >
>>> >>> > That's what I thought, too. Could Lucene be catching the IOExcept=
ion
>>> and
>>> >>> > turning it into a different exception?
>>> >>>
>>> >>> I think that's unlikely, but I guess possible. =A0We have "disk ful=
l"
>>> >>> tests in the unit tests, that throw an IOException at different tim=
es.
>>> >>>
>>> >>> What exact windows version are you using? =A0The local drive is NTF=
S?
>>> >>>
>>> >>
>>> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>>> >>
>>> >>
>>> >>>
>>> >>> Mike
>>> >>>
>>> >>> -------------------------------------------------------------------=
--
>>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >>>
>>> >>>
>>> >>
>>> >
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43056-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 19:08:54 2009
Return-Path: <java-user-return-43056-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41499 invoked from network); 27 Oct 2009 19:08:54 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 19:08:54 -0000
Received: (qmail 52519 invoked by uid 500); 27 Oct 2009 19:08:52 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52431 invoked by uid 500); 27 Oct 2009 19:08:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52421 invoked by uid 99); 27 Oct 2009 19:08:52 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 19:08:52 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 19:08:47 +0000
Received: by pwi12 with SMTP id 12so319945pwi.5
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 12:08:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=pQN2g7ZDsv0BA8g0Z9xD1AqQ39XwKd3icoC6zyQ0cUQ=;
        b=GopBhoNPmBIKvb9R5QYACZnGZEkOlaIqTk/r9NmdIJW8ZS9TW6Z+KofsCBxnGbj4yv
         1czg9L8u17qlIA6KT6weCPpyZxxh35WTei6MebVDng9Ky/97FE6Yy3tO11H3+jtDM3/n
         IDhjw8kcOMlG+VyWdXFByKmm3BgcZpDyVc2vw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=RzaGGNo3KRF0poMpyVrs06NAv7bTKo/hoQ6/QtM5AhxXXGKEfwv0FPFATsF8AsWCD7
         4qUDR5tM+hEmB59Th0Wofokvdsn2w7VBCbF9N0R2VLyFm54A8MhnyA5+YrSqrHRu72wU
         2EpJmwqgPqT+SeAgDUaBHW2xkpdTCZSsRVL3o=
MIME-Version: 1.0
Received: by 10.142.4.11 with SMTP id 11mr1416492wfd.86.1256670507270; Tue, 27 
	Oct 2009 12:08:27 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910261150o509ab052j2e948f3c66da9753@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
Date: Tue, 27 Oct 2009 15:08:27 -0400
Message-ID: <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502b8692f82c30476ef67ea

--00504502b8692f82c30476ef67ea
Content-Type: text/plain; charset=ISO-8859-1

It's reproducible with a large no. of docs (>1 million), but not with 100K
docs.
I got same error with jvm 1.6.0_16.
The index was optimized after all docs are added. I'll try removing the
optimize.

Peter

On Tue, Oct 27, 2009 at 2:57 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> This is odd -- is it reproducible?
>
> Can you narrow it down to a small set of docs that when indexed
> produce a corrupted index?
>
> If you attempt to optimize the index, does it fail?
>
> Mike
>
> On Tue, Oct 27, 2009 at 1:40 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > It seems the index is corrupted immediately after the initial build
> (ample
> > disk space was provided):
> >
> > Output from CheckIndex:
> >
> > Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
> >
> > Segments file=segments_3 numSegments=1 version=FORMAT_DIAGNOSTICS [Lucene
> > 2.9]
> >  1 of 1: name=_7 docCount=1077025
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=3,201.196
> >    diagnostics = {optimize=true, mergeFactor=7, os.version=5.2,
> os=Windows
> > 2003, mergeDocStores=false, lucene.version=2.9 exported - 2009-10-26
> > 07:58:55, source=merge, os.arch=amd64, java.version=1.6.0_03,
> > java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=0
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num docs
> > seen 482 + num docs deleted 0]
> > java.lang.RuntimeException: term contents:? docFreq=1 != num docs seen
> 482 +
> > num docs deleted 0
> >    at
> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >    test: stored fields.......OK [3231075 total field count; avg 3 fields
> > per doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> > FAILED
> >    WARNING: fixIndex() would remove reference to this segment; full
> > exception:
> > java.lang.RuntimeException: Term Index test failed
> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >
> > WARNING: 1 broken segments (containing 1077025 documents) detected
> > WARNING: would write new segments file, and 1077025 documents would be
> lost,
> > if -fix were specified
> >
> > Searching on this index seems to be fine, though.
> >
> > Here is the IndexWriter log from the build:
> >
> > IFD [Indexer]: setInfoStream
> >
> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@2a9cfec1
> > IW 0 [Indexer]: setInfoStream:
> > dir=org.apache.lucene.store.SimpleFSDirectory@D
> :\mnsavs\lresumes1\lresumes1.luc\lresumes1.update.main.2
> > autoCommit=false
> >
> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@291946c2mergeScheduler
> =org.apache.lucene.index.ConcurrentMergeScheduler@3a747fa2ramBufferSizeMB
> =16.0
> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
> > maxFieldLength=2147483647 index=
> > IW 0 [Indexer]: setRAMBufferSizeMB 910.25
> > IW 0 [Indexer]: setMaxBufferedDocs 1000000
> > IW 0 [Indexer]: flush at getReader
> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=null
> docStoreOffset=0
> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> > numBufDelTerms=0
> > IW 0 [Indexer]:   index before flush
> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=886.463
> allocMB=886.463
> > deletesMB=23.803 triggerMB=910.25
> > IW 0 [UpdWriterBuild]:   flush: segment=_0 docStoreSegment=_0
> > docStoreOffset=0 flushDocs=true flushDeletes=false flushDocStores=false
> > numDocs=171638 numBufDelTerms=171638
> > IW 0 [UpdWriterBuild]:   index before flush
> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _0 numDocs=171638
> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=929523712
> newFlushedSize=573198529
> > docs/MB=313.985 new/old=61.666%
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit
> =
> > false]
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit
> =
> > false]
> > IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 1 segments
> > IW 0 [UpdWriterBuild]: CMS: now merge
> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0
> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=857.977
> allocMB=901.32
> > deletesMB=52.274 triggerMB=910.25
> > IW 0 [UpdWriterBuild]:   flush: segment=_1 docStoreSegment=_0
> > docStoreOffset=171638 flushDocs=true flushDeletes=false
> flushDocStores=false
> > numDocs=204995 numBufDelTerms=204995
> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _1 numDocs=204995
> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=899653632
> newFlushedSize=544283851
> > docs/MB=394.928 new/old=60.499%
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit
> =
> > false]
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit
> =
> > false]
> > IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 2 segments
> > IW 0 [UpdWriterBuild]: CMS: now merge
> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> > IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=834.645
> vs
> > trigger=910.25 allocMB=901.32 deletesMB=75.627 vs trigger=955.762
> > byteBlockFree=35.938 charBlockFree=8.938
> > IW 0 [UpdWriterBuild]: DW:     nothing to free
> > IW 0 [UpdWriterBuild]: DW:     after free: freedMB=66.613 usedMB=910.272
> > allocMB=834.707
> > IW 0 [UpdWriterBuild]:   flush: segment=_2 docStoreSegment=_0
> > docStoreOffset=376633 flushDocs=true flushDeletes=false
> flushDocStores=false
> > numDocs=168236 numBufDelTerms=168236
> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _2 numDocs=168236
> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=875188224
> newFlushedSize=530720464
> > docs/MB=332.394 new/old=60.641%
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit
> =
> > false]
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit
> =
> > false]
> > IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 3 segments
> > IW 0 [UpdWriterBuild]: CMS: now merge
> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0
> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=814.282
> allocMB=835.832
> > deletesMB=95.997 triggerMB=910.25
> > IW 0 [UpdWriterBuild]:   flush: segment=_3 docStoreSegment=_0
> > docStoreOffset=544869 flushDocs=true flushDeletes=false
> flushDocStores=false
> > numDocs=146894 numBufDelTerms=146894
> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0
> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _3 numDocs=146894
> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=853836800
> newFlushedSize=522388771
> > docs/MB=294.856 new/old=61.181%
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit
> =
> > false]
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit
> =
> > false]
> > IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 4 segments
> > IW 0 [UpdWriterBuild]: CMS: now merge
> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0
> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=791.724
> allocMB=835.832
> > deletesMB=118.535 triggerMB=910.25
> > IW 0 [UpdWriterBuild]:   flush: segment=_4 docStoreSegment=_0
> > docStoreOffset=691763 flushDocs=true flushDeletes=false
> flushDocStores=false
> > numDocs=162034 numBufDelTerms=162034
> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0
> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _4 numDocs=162034
> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=830182400
> newFlushedSize=498741034
> > docs/MB=340.668 new/old=60.076%
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit
> =
> > false]
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit
> =
> > false]
> > IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 5 segments
> > IW 0 [UpdWriterBuild]: CMS: now merge
> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> > IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=771.396
> vs
> > trigger=910.25 allocMB=835.832 deletesMB=138.875 vs trigger=955.762
> > byteBlockFree=39.688 charBlockFree=7.188
> > IW 0 [UpdWriterBuild]: DW:     nothing to free
> > IW 0 [UpdWriterBuild]: DW:     after free: freedMB=64.374 usedMB=910.271
> > allocMB=771.458
> > IW 0 [UpdWriterBuild]:   flush: segment=_5 docStoreSegment=_0
> > docStoreOffset=853797 flushDocs=true flushDeletes=false
> flushDocStores=false
> > numDocs=146250 numBufDelTerms=146250
> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _5 numDocs=146250
> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=808866816
> newFlushedSize=485212402
> > docs/MB=316.056 new/old=59.987%
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit
> =
> > false]
> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit
> =
> > false]
> > IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 6 segments
> > IW 0 [UpdWriterBuild]: CMS: now merge
> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> > IW 0 [Indexer]: commit: start
> > IW 0 [Indexer]: commit: now prepare
> > IW 0 [Indexer]: prepareCommit: flush
> > IW 0 [Indexer]:   flush: segment=_6 docStoreSegment=_0
> > docStoreOffset=1000047 flushDocs=true flushDeletes=true
> flushDocStores=true
> > numDocs=76978 numBufDelTerms=76978
> > IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> > IW 0 [Indexer]:   flush shared docStore segment _0
> > IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
> > numDocs=1077025
> > IW 0 [Indexer]: DW: flush postings as segment _6 numDocs=76978
> > IW 0 [Indexer]: DW:   oldRAMSize=486968320 newFlushedSize=273168136
> > docs/MB=295.486 new/old=56.096%
> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =
> false]
> > IW 0 [Indexer]: DW: apply 1077025 buffered deleted terms and 0 deleted
> > docIDs and 0 deleted queries on 7 segments.
> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =
> false]
> > IW 0 [Indexer]: LMP: findMerges: 7 segments
> > IW 0 [Indexer]: LMP:   level 8.008305 to 8.758305: 7 segments
> > IW 0 [Indexer]: CMS: now merge
> > IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0
> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > IW 0 [Indexer]: CMS:   no more merges pending; now return
> > IW 0 [Indexer]: startCommit(): start sizeInBytes=0
> > IW 0 [Indexer]: startCommit index=_0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > changeCount=21
> > IW 0 [Indexer]: now sync _0.tis
> > IW 0 [Indexer]: now sync _5.prx
> > IW 0 [Indexer]: now sync _3.frq
> > IW 0 [Indexer]: now sync _3.tii
> > IW 0 [Indexer]: now sync _1.frq
> > IW 0 [Indexer]: now sync _6.frq
> > IW 0 [Indexer]: now sync _4.prx
> > IW 0 [Indexer]: now sync _4.fnm
> > IW 0 [Indexer]: now sync _2.tii
> > IW 0 [Indexer]: now sync _3.fnm
> > IW 0 [Indexer]: now sync _1.fnm
> > IW 0 [Indexer]: now sync _6.tis
> > IW 0 [Indexer]: now sync _4.frq
> > IW 0 [Indexer]: now sync _5.nrm
> > IW 0 [Indexer]: now sync _5.tis
> > IW 0 [Indexer]: now sync _1.tii
> > IW 0 [Indexer]: now sync _4.tis
> > IW 0 [Indexer]: now sync _0.prx
> > IW 0 [Indexer]: now sync _3.nrm
> > IW 0 [Indexer]: now sync _4.tii
> > IW 0 [Indexer]: now sync _0.nrm
> > IW 0 [Indexer]: now sync _5.fnm
> > IW 0 [Indexer]: now sync _1.tis
> > IW 0 [Indexer]: now sync _0.fnm
> > IW 0 [Indexer]: now sync _2.prx
> > IW 0 [Indexer]: now sync _6.tii
> > IW 0 [Indexer]: now sync _4.nrm
> > IW 0 [Indexer]: now sync _2.frq
> > IW 0 [Indexer]: now sync _5.frq
> > IW 0 [Indexer]: now sync _3.prx
> > IW 0 [Indexer]: now sync _5.tii
> > IW 0 [Indexer]: now sync _2.fnm
> > IW 0 [Indexer]: now sync _1.prx
> > IW 0 [Indexer]: now sync _2.tis
> > IW 0 [Indexer]: now sync _0.tii
> > IW 0 [Indexer]: now sync _6.prx
> > IW 0 [Indexer]: now sync _0.frq
> > IW 0 [Indexer]: now sync _6.fnm
> > IW 0 [Indexer]: now sync _0.fdx
> > IW 0 [Indexer]: now sync _6.nrm
> > IW 0 [Indexer]: now sync _0.fdt
> > IW 0 [Indexer]: now sync _1.nrm
> > IW 0 [Indexer]: now sync _2.nrm
> > IW 0 [Indexer]: now sync _3.tis
> > IW 0 [Indexer]: done all syncs
> > IW 0 [Indexer]: commit: pendingCommit != null
> > IW 0 [Indexer]: commit: wrote segments file "segments_2"
> > IFD [Indexer]: now checkpoint "segments_2" [7 segments ; isCommit = true]
> > IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
> > IFD [Indexer]: delete "segments_1"
> > IW 0 [Indexer]: commit: done
> > IW 0 [Indexer]: optimize: index now _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6 docStoreOffset=0
> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> > numBufDelTerms=0
> > IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > IW 0 [Indexer]: add merge to pendingMerges: _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > [optimize] [total 1 pending]
> > IW 0 [Indexer]: CMS: now merge
> > IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> _2:C168236->_0
> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > IW 0 [Indexer]: CMS:   consider merge _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > into _7 [optimize]
> > IW 0 [Indexer]: CMS:     launch new thread [Lucene Merge Thread #0]
> > IW 0 [Indexer]: CMS:   no more merges pending; now return
> > IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: start
> > IW 0 [Lucene Merge Thread #0]: now merge
> >  merge=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0 into _7 [optimize]
> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@78688954
> >  index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > IW 0 [Lucene Merge Thread #0]: merging _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > into _7 [optimize]
> > IW 0 [Lucene Merge Thread #0]: merge: total 1077025 docs
> > IW 0 [Lucene Merge Thread #0]: commitMerge: _0:C171638->_0 _1:C204995->_0
> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > into _7 [optimize] index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0
> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> > IW 0 [Lucene Merge Thread #0]: commitMergeDeletes _0:C171638->_0
> > _1:C204995->_0 _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> _5:C146250->_0
> > _6:C76978->_0 into _7 [optimize]
> > IFD [Lucene Merge Thread #0]: now checkpoint "segments_2" [1 segments ;
> > isCommit = false]
> > IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: done
> > IW 0 [Indexer]: now flush at close
> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6 docStoreOffset=0
> > flushDocs=false flushDeletes=true flushDocStores=true numDocs=0
> > numBufDelTerms=0
> > IW 0 [Indexer]:   index before flush _7:C1077025->_0
> > IW 0 [Indexer]:   flush shared docStore segment _6
> > IW 0 [Indexer]: DW: closeDocStore: 0 files to flush to segment _6
> numDocs=0
> > IW 0 [Indexer]: CMS: now merge
> > IW 0 [Indexer]: CMS:   index: _7:C1077025->_0
> > IW 0 [Indexer]: CMS:   no more merges pending; now return
> > IW 0 [Indexer]: now call final commit()
> > IW 0 [Indexer]: startCommit(): start sizeInBytes=0
> > IW 0 [Indexer]: startCommit index=_7:C1077025->_0 changeCount=23
> > IW 0 [Indexer]: now sync _7.prx
> > IW 0 [Indexer]: now sync _7.fnm
> > IW 0 [Indexer]: now sync _7.tis
> > IW 0 [Indexer]: now sync _7.nrm
> > IW 0 [Indexer]: now sync _7.tii
> > IW 0 [Indexer]: now sync _7.frq
> > IW 0 [Indexer]: done all syncs
> > IW 0 [Indexer]: commit: pendingCommit != null
> > IW 0 [Indexer]: commit: wrote segments file "segments_3"
> > IFD [Indexer]: now checkpoint "segments_3" [1 segments ; isCommit = true]
> > IFD [Indexer]: deleteCommits: now decRef commit "segments_2"
> > IFD [Indexer]: delete "_0.tis"
> > IFD [Indexer]: delete "_5.prx"
> > IFD [Indexer]: delete "_3.tii"
> > IFD [Indexer]: delete "_3.frq"
> > IFD [Indexer]: delete "_1.frq"
> > IFD [Indexer]: delete "_6.frq"
> > IFD [Indexer]: delete "_4.prx"
> > IFD [Indexer]: delete "_4.fnm"
> > IFD [Indexer]: delete "_2.tii"
> > IFD [Indexer]: delete "_3.fnm"
> > IFD [Indexer]: delete "_1.fnm"
> > IFD [Indexer]: delete "_6.tis"
> > IFD [Indexer]: delete "_4.frq"
> > IFD [Indexer]: delete "_5.nrm"
> > IFD [Indexer]: delete "_5.tis"
> > IFD [Indexer]: delete "_1.tii"
> > IFD [Indexer]: delete "_4.tis"
> > IFD [Indexer]: delete "_0.prx"
> > IFD [Indexer]: delete "_3.nrm"
> > IFD [Indexer]: delete "_4.tii"
> > IFD [Indexer]: delete "_0.nrm"
> > IFD [Indexer]: delete "_5.fnm"
> > IFD [Indexer]: delete "_1.tis"
> > IFD [Indexer]: delete "_0.fnm"
> > IFD [Indexer]: delete "_2.prx"
> > IFD [Indexer]: delete "_6.tii"
> > IFD [Indexer]: delete "_4.nrm"
> > IFD [Indexer]: delete "_2.frq"
> > IFD [Indexer]: delete "_5.frq"
> > IFD [Indexer]: delete "_3.prx"
> > IFD [Indexer]: delete "_5.tii"
> > IFD [Indexer]: delete "_2.fnm"
> > IFD [Indexer]: delete "_1.prx"
> > IFD [Indexer]: delete "_2.tis"
> > IFD [Indexer]: delete "_0.tii"
> > IFD [Indexer]: delete "_6.prx"
> > IFD [Indexer]: delete "_0.frq"
> > IFD [Indexer]: delete "segments_2"
> > IFD [Indexer]: delete "_6.fnm"
> > IFD [Indexer]: delete "_6.nrm"
> > IFD [Indexer]: delete "_1.nrm"
> > IFD [Indexer]: delete "_2.nrm"
> > IFD [Indexer]: delete "_3.tis"
> > IW 0 [Indexer]: commit: done
> > IW 0 [Indexer]: at close: _7:C1077025->_0
> >
> > I see no errors.
> > Peter
> >
> >
> > On Tue, Oct 27, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com
> >wrote:
> >
> >>
> >>
> >> On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
> >> lucene@mikemccandless.com> wrote:
> >>
> >>> OK that exception looks more reasonable, for a disk full event.
> >>>
> >>> But, I can't tell from your followon emails: did this lead to index
> >>> corruption?
> >>>
> >>
> >> Yes, but this may be caused by the application ignoring a Lucene
> exception
> >> somewhere else. I will chase this down.
> >>
> >>>
> >>> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- you
> >>> really should upgrade that to the latest 1.6.0 -- there's at least one
> >>> known problem with Lucene and early 1.6.0 JREs.
> >>>
> >>
> >> Yes, I remember this problem - that's why we stayed at _03
> >> Thanks.
> >>
> >>>
> >>> Mike
> >>>
> >>> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <peterlkeegan@gmail.com
> >
> >>> wrote:
> >>> > After rebuilding the corrupted indexes, the low disk space exception
> is
> >>> now
> >>> > occurring as expected. Sorry for the distraction.
> >>> >
> >>> > fyi, here are the details:
> >>> >
> >>> >  java.io.IOException: There is not enough space on the disk
> >>> >    at java.io.RandomAccessFile.writeBytes(Native Method)
> >>> >    at java.io.RandomAccessFile.write(Unknown Source)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
> >>> >    at
> org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
> >>> >    at
> >>> org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
> >>> >    at
> >>> >
> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
> >>> >    at
> org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
> >>> >    at
> >>> >
> >>>
> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
> >>> >
> >>> >
> >>> > And the corresponding index info log:
> >>> >
> >>> > IFD [Indexer]: setInfoStream
> >>> >
> >>>
> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
> >>> > IW 1 [Indexer]: setInfoStream:
> >>> > dir=org.apache.lucene.store.SimpleFSDirectory@D
> >>> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
> >>> > autoCommit=false
> >>> >
> >>>
> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler
> >>>
> =org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB
> >>> =16.0
> >>> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
> >>> > maxFieldLength=2147483647 index=
> >>> > IW 1 [Indexer]: flush at addIndexesNoOptimize
> >>> > IW 1 [Indexer]:   flush: segment=null docStoreSegment=null
> >>> docStoreOffset=0
> >>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> >>> > numBufDelTerms=0
> >>> > IW 1 [Indexer]:   index before flush
> >>> > IW 1 [Indexer]: now start transaction
> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
> >>> > IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
> >>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> >>> > IW 1 [Indexer]: CMS: now merge
> >>> > IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
> >>> > IW 1 [Indexer]: CMS:   no more merges pending; now return
> >>> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total 1
> >>> > pending]
> >>> > IW 1 [Indexer]: now merge
> >>> >  merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
> >>> >  index=_7:Cx1075533->_0** _8:Cx2795**
> >>> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
> >>> > IW 1 [Indexer]: merge: total 1074388 docs
> >>> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0
> [mergeDocStores]
> >>> > index=_7:Cx1075533->_0** _8:Cx2795**
> >>> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
> >>> [mergeDocStores]
> >>> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit =
> >>> false]
> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
> >>> > IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
> >>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> >>> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1
> pending]
> >>> > IW 1 [Indexer]: now merge
> >>> >  merge=_8:Cx2795 into _1 [mergeDocStores]
> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
> >>> >  index=_0:C1074388 _8:Cx2795**
> >>> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
> >>> > IW 1 [Indexer]: merge: total 2795 docs
> >>> > IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
> >>> > [mergeDocStores] exc=java.io.IOException: There is not enough space
> on
> >>> the
> >>> > disk
> >>> > IW 1 [Indexer]: hit exception during merge
> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
> unreferenced
> >>> file
> >>> > "_1.fdt"
> >>> > IFD [Indexer]: delete "_1.fdt"
> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
> unreferenced
> >>> file
> >>> > "_1.fdx"
> >>> > IFD [Indexer]: delete "_1.fdx"
> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
> unreferenced
> >>> file
> >>> > "_1.fnm"
> >>> > IFD [Indexer]: delete "_1.fnm"
> >>> > IW 1 [Indexer]: now rollback transaction
> >>> > IW 1 [Indexer]: all running merges have aborted
> >>> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit =
> >>> false]
> >>> > IFD [Indexer]: delete "_0.nrm"
> >>> > IFD [Indexer]: delete "_0.tis"
> >>> > IFD [Indexer]: delete "_0.fnm"
> >>> > IFD [Indexer]: delete "_0.tii"
> >>> > IFD [Indexer]: delete "_0.frq"
> >>> > IFD [Indexer]: delete "_0.fdx"
> >>> > IFD [Indexer]: delete "_0.prx"
> >>> > IFD [Indexer]: delete "_0.fdt"
> >>> >
> >>> >
> >>> > Peter
> >>> >
> >>> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <
> peterlkeegan@gmail.com
> >>> >wrote:
> >>> >
> >>> >>
> >>> >>
> >>> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
> >>> >> lucene@mikemccandless.com> wrote:
> >>> >>
> >>> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <
> peterlkeegan@gmail.com
> >>> >
> >>> >>> wrote:
> >>> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
> >>> >>> > lucene@mikemccandless.com> wrote:
> >>> >>> >
> >>> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
> >>> peterlkeegan@gmail.com
> >>> >>> >
> >>> >>> >> wrote:
> >>> >>> >> > Even running in console mode, the exception is difficult to
> >>> >>> interpret.
> >>> >>> >> > Here's an exception that I think occurred during an add
> document,
> >>> >>> commit
> >>> >>> >> or
> >>> >>> >> > close:
> >>> >>> >> > doc counts differ for segment _g: field Reader shows 137 but
> >>> >>> segmentInfo
> >>> >>> >> > shows 5777
> >>> >>> >>
> >>> >>> >> That's spooky.  Do you have the full exception for this one?
>  What
> >>> IO
> >>> >>> >> system are you running on?  (Is it just a local drive on your
> >>> windows
> >>> >>> >> computer?) It's almost as if the IO system is not generating an
> >>> >>> >> IOException to Java when disk fills up.
> >>> >>> >>
> >>> >>> >
> >>> >>> > Index and code are all on a local drive. There is no other
> exception
> >>> >>> coming
> >>> >>> > back - just what I reported.
> >>> >>>
> >>> >>> But, you didn't report a traceback for this first one?
> >>> >>>
> >>> >>
> >>> >> Yes, I need to add some more printStackTrace calls.
> >>> >>
> >>> >>
> >>> >>>
> >>> >>> >> > I ensured that the disk space was low before updating the
> index.
> >>> >>> >>
> >>> >>> >> You mean, to intentionally test the disk-full case?
> >>> >>> >>
> >>> >>> >
> >>> >>> > Yes, that's right.
> >>> >>>
> >>> >>> OK.  Can you turn on IndexWriter's infoStream, get this disk full /
> >>> >>> corruption to happen again, and post back the resulting output?
>  Make
> >>> >>> sure your index first passes CheckIndex before starting (so we
> don't
> >>> >>> begin the test w/ any pre-existing index corruption).
> >>> >>>
> >>> >>
> >>> >> Good point about CheckIndex.  I've already found 2 bad ones. I will
> >>> build
> >>> >> new indexes from scratch. This will take a while.
> >>> >>
> >>> >>
> >>> >>> >> > On another occasion, the exception was:
> >>> >>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123
> >>> _3:C107
> >>> >>> >> _4:C126
> >>> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
> >>> [mergeDocStores]
> >>> >>> >>
> >>> >>> >> In this case, the SegmentMerger was trying to open this segment,
> >>> but
> >>> >>> >> on attempting to read the first int from the fdx (fields index)
> >>> file
> >>> >>> >> for one of the segments, it hit EOF.
> >>> >>> >>
> >>> >>> >> This is also spooky -- this looks like index corruption, which
> >>> should
> >>> >>> >> never happen on hitting disk full.
> >>> >>> >>
> >>> >>> >
> >>> >>> > That's what I thought, too. Could Lucene be catching the
> IOException
> >>> and
> >>> >>> > turning it into a different exception?
> >>> >>>
> >>> >>> I think that's unlikely, but I guess possible.  We have "disk full"
> >>> >>> tests in the unit tests, that throw an IOException at different
> times.
> >>> >>>
> >>> >>> What exact windows version are you using?  The local drive is NTFS?
> >>> >>>
> >>> >>
> >>> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
> >>> >>
> >>> >>
> >>> >>>
> >>> >>> Mike
> >>> >>>
> >>> >>>
> ---------------------------------------------------------------------
> >>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>> >>>
> >>> >>>
> >>> >>
> >>> >
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502b8692f82c30476ef67ea--

From java-user-return-43062-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 22:51:16 2009
Return-Path: <java-user-return-43062-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 19245 invoked from network); 27 Oct 2009 22:51:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 22:51:10 -0000
Received: (qmail 91119 invoked by uid 500); 27 Oct 2009 22:51:08 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91070 invoked by uid 500); 27 Oct 2009 22:51:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91035 invoked by uid 99); 27 Oct 2009 22:51:08 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 22:51:08 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of will.murnane@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 22:51:06 +0000
Received: by qyk41 with SMTP id 41so153985qyk.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 15:50:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=H+O8JJD786F6aF1OVn0+xNjodtp3dT3JH4bMDsPJB5c=;
        b=iK+FsSsYkrEIQ1fR0uBnBXljATk68FLy/0eheAlhyQ/67XKVcM18knFqXV6VjDJAL3
         9oSDXBCBFAq3SUuUIg7dCVF1Ze5AA/MDkERDT7N3HDkosWRTNPiRq+wJq0//fp4j6UcA
         5p1BM/rYzwWhbA1GN7Q0m88YbzWaZux2xnItw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=ucSIdInV6GxARvvkHCTNJv6VNuhNfGUByy+beGAg58YRjxYblTFt4vqS1XLIVQCyxB
         uGNxIPJAA9oWAz0AxSKxjBnL7aIbLzPN9mvEE8s5o1jCfNDu17M/6y0Uw3PBp3igx6uf
         4ZIG79GYu/myb96HEFW5tbFdUJYskSkqbpE84=
MIME-Version: 1.0
Received: by 10.224.101.74 with SMTP id b10mr5455856qao.297.1256683844909; 
	Tue, 27 Oct 2009 15:50:44 -0700 (PDT)
Date: Tue, 27 Oct 2009 18:50:44 -0400
Message-ID: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
Subject: Split single string into several fields?
From: Will Murnane <will.murnane@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

Hello list,
  I have some semi-structured text that has some markup elements, and
I want to put those elements into a separate field so I can search by
them.  For example (using HTML syntax):
---- 8< ---- document
<h1>Section title</h1>
Body content
---- >8 ----
I can find that the things inside <h1>s are "Section" and "title", and
"Body" and "content" are outside.  I want to create two fields for
this document:
insideh1 -> "Section", "title"
alltext -> "Section", "title", "Body", "content"

What's the best way to approach this?  My initial thought is to make
some kind of MultiAnalyzer that consumes the text and produces several
token streams, which are added to the document one at a time.  Is that
a reasonable strategy?

Thanks!
Will

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43061-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 22:51:46 2009
Return-Path: <java-user-return-43061-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 20078 invoked from network); 27 Oct 2009 22:51:45 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 22:51:45 -0000
Received: (qmail 80949 invoked by uid 500); 27 Oct 2009 22:44:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80868 invoked by uid 500); 27 Oct 2009 22:44:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80858 invoked by uid 99); 27 Oct 2009 22:44:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 22:44:24 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lafadev@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 22:44:22 +0000
Received: by qyk41 with SMTP id 41so151197qyk.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 15:44:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=RluO99U5a743iSieRVPI2StYTwoJKFOOF0PO6xoN3E8=;
        b=YuZH0zI7jPSUXfUP2rQZnv4tcpI3J3nc+6wSmqwl8C6uXRsewlLnm4BlS2ZenwLNLA
         0NsHyWyKaWbPmAadkpyMTclQPb36UCopciNMuCoASxqyHwc3+OC7o/OHuokal6tyMhT8
         dITRhk1HniJ1LvrnRSqiBMwc+atuySjtuaC/E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=J3JGr37ZRrY6taVnF9ye/NrGIrYBl70Jk07pZfz+NzpukK/hB9C5bzooa7b0qdKkun
         168o/wlgHOpQ76xAN2A+/8RI1CDXb9nTNf/NftXegyi3PaPmgCSVVVxEccq9PcPzk1EB
         jvKh5NiCzyU9aI6uMv23afEHdAwgukDflsDjE=
Received: by 10.224.54.206 with SMTP id r14mr8823072qag.204.1256683441628;
        Tue, 27 Oct 2009 15:44:01 -0700 (PDT)
Received: from ?9.30.38.122? ([32.97.110.56])
        by mx.google.com with ESMTPS id 22sm192496qyk.10.2009.10.27.15.43.59
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 27 Oct 2009 15:44:00 -0700 (PDT)
Message-ID: <4AE777AD.7000000@gmail.com>
Date: Tue, 27 Oct 2009 15:43:57 -0700
From: Luis Alves <lafadev@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu> <4AD8BEC4.50905@gmail.com> <4AD8C04E.2020101@gmail.com> <4AD8C131.1080901@gmail.com>
In-Reply-To: <4AD8C131.1080901@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

Mark Miller wrote:
> Mark Miller wrote:
>   
>> Michael Busch wrote:
>>   
>>     
>>>  Why will just saying once again "Hey, let's just release more often"
>>> work now if it hasn't in the last two years?
>>>
>>>  Mich
>>>     
>>>       
>> I don't know that we need to release more often to take advantage of
>> major numbers. 2.2 was released in 07 - we could have just released 2.9
>> right after 2.2 rather than also releasing 2.3 and 2.4. The number of
>> releases between major releases is self imposed.
>>
>>   
>>     
> And actually - even 2.9, which took so long, didn't have to. A .9
> release could be very fast and only done as a stepping stone to the next
> major release. The pain of how long everything took was just self
> imposed. We could have moved to 3.0 years ago easily if someone has
> suggested so. The truth is, all the deprecation complain stuff only
> recently reached a boil - so noone suggested moving to the next major
> version faster long enough ago. When they did, we jumped from 2.4 to
> 2.9. And the 2.9 was a huge release - but again, it didn't have to be.
> It could have been a formality - Grant was arguing at one point that it
> should have been.
>
>   
I don't see much difference in have frequent major releases or frequent 
minor releases,
if they share same backwards-compatibility policy.

If you have 4 major releases per year 4.0 , 5.0, 6.0 and 7.0, or four 
minor release
3.2, 3.3, 3.4, 3.5.
 From the user perspective is not going to help that much since, since 
moving from 4.0 to 6.0
will have the same cost of moving from 3.2 to 3.4, if the 
backwards-compatibility is similar in
major releases and minor-releases and the time between release is the same.

What I like in Michael proposal is that it gives the user a chance to 
move between sequential minor releases
without breaking the code, if you follow the process of cleaning your 
code from deprecated calls.
I would hope this rule would also apply to 3.9 to 4.0 if these are 
sequential releases.

If you see what lucene community is doing with 2.4->2.9->3.0 this is 
actually Michael proposal
but now will be the rule instead of the exception that was done just for 
3.0 major release.

Lucene could have gone from 2.4 to 3.0, without having any releases in 
between, since it was a major
release and there was no need to be backward-compatible, but that would 
have created major code migration
headaches.

Option B) allows developers to remove old code more quickly and does not 
force the lucene community to create
major releases for code clean up. It gives flexibility and guarantees 
the users with a clean upgrade path.

I also propose that we should also apply this rule between the last 
minor release of previous major release
and next major release, just as it was done for 2.4->2.9->3.0.



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43057-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 23:00:34 2009
Return-Path: <java-user-return-43057-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 31206 invoked from network); 27 Oct 2009 23:00:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 23:00:33 -0000
Received: (qmail 73330 invoked by uid 500); 27 Oct 2009 20:10:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73266 invoked by uid 500); 27 Oct 2009 20:10:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73256 invoked by uid 99); 27 Oct 2009 20:10:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 20:10:32 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 20:10:27 +0000
Received: by pzk3 with SMTP id 3so55516pzk.20
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 13:10:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=enT8Whdawcbz5sO2HaSUJ0mmJSZcy/xuLHLT5lgq24w=;
        b=XgijT2JcsTzpvn6lZMXCGbpGzevBxImf9frxEDlx+sddoUd3fdxCPy7eiOQZgc6IG2
         inL4kVp1wOgkWXNWmjT6kBAv3VdWC7qbBNMOszmH4BMxVsMecM0Ac6erUDTSpRia6SRS
         Rvws5SIeiqT2EHVUEViQF8cQo+UumemLzLnx4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Wx5cauyKbaaflOc3RVDz09USlBYs9IBsI50BINITl86zek1krLE59/lTFmNlwdkV/o
         gs9E/UGuBTGy3ge04A2xmDg8QegyZ9MwVDew4pKHZwkC3GWl5e9bL9Jzkk4HNvPh9SXQ
         nBT3qIHNtJpqqRvf1ANs2neEuAVfpgzwQlt18=
MIME-Version: 1.0
Received: by 10.143.154.33 with SMTP id g33mr1299761wfo.300.1256674206800; 
	Tue, 27 Oct 2009 13:10:06 -0700 (PDT)
In-Reply-To: <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910261155i4bf54bcco4f8beb1d29144b29@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
Date: Tue, 27 Oct 2009 16:10:06 -0400
Message-ID: <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636e0b6eeb1ddb10476f0430f

--001636e0b6eeb1ddb10476f0430f
Content-Type: text/plain; charset=ISO-8859-1

Without the optimize, it looks like there are errors on all segments except
the first:

Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2

Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS [Lucene
2.9]
  1 of 3: name=_0 docCount=413557
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=1,148.795
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-27 15:31:52, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=0
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [7704599 terms; 180318249 terms/docs pairs;
340258711 tokens]
    test: stored fields.......OK [1240671 total field count; avg 3 fields
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  2 of 3: name=_1 docCount=359203
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=1,125.103
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-27 15:31:52, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=413557
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=43 !=
num docs seen 4 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=43 != num docs
seen 4 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [1077609 total field count; avg 3 fields
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  3 of 3: name=_2 docCount=304659
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=961.764
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-27 15:31:52, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=772760
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num docs
seen 245 + num docs deleted 0]
java.lang.RuntimeException: term contents:? docFreq=1 != num docs seen 245 +
num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [913977 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

WARNING: 2 broken segments (containing 663862 documents) detected
WARNING: would write new segments file, and 663862 documents would be lost,
if -fix were specified


Do the unit tests create multi-segment indexes?

Peter

On Tue, Oct 27, 2009 at 3:08 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> It's reproducible with a large no. of docs (>1 million), but not with 100K
> docs.
> I got same error with jvm 1.6.0_16.
> The index was optimized after all docs are added. I'll try removing the
> optimize.
>
> Peter
>
>
> On Tue, Oct 27, 2009 at 2:57 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> This is odd -- is it reproducible?
>>
>> Can you narrow it down to a small set of docs that when indexed
>> produce a corrupted index?
>>
>> If you attempt to optimize the index, does it fail?
>>
>> Mike
>>
>> On Tue, Oct 27, 2009 at 1:40 PM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > It seems the index is corrupted immediately after the initial build
>> (ample
>> > disk space was provided):
>> >
>> > Output from CheckIndex:
>> >
>> > Opening index @
>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
>> >
>> > Segments file=segments_3 numSegments=1 version=FORMAT_DIAGNOSTICS
>> [Lucene
>> > 2.9]
>> >  1 of 1: name=_7 docCount=1077025
>> >    compound=false
>> >    hasProx=true
>> >    numFiles=8
>> >    size (MB)=3,201.196
>> >    diagnostics = {optimize=true, mergeFactor=7, os.version=5.2,
>> os=Windows
>> > 2003, mergeDocStores=false, lucene.version=2.9 exported - 2009-10-26
>> > 07:58:55, source=merge, os.arch=amd64, java.version=1.6.0_03,
>> > java.vendor=Sun Microsystems Inc.}
>> >    docStoreOffset=0
>> >    docStoreSegment=_0
>> >    docStoreIsCompoundFile=false
>> >    no deletions
>> >    test: open reader.........OK
>> >    test: fields..............OK [33 fields]
>> >    test: field norms.........OK [33 fields]
>> >    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num
>> docs
>> > seen 482 + num docs deleted 0]
>> > java.lang.RuntimeException: term contents:? docFreq=1 != num docs seen
>> 482 +
>> > num docs deleted 0
>> >    at
>> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
>> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
>> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>> >    test: stored fields.......OK [3231075 total field count; avg 3 fields
>> > per doc]
>> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
>> > vector fields per doc]
>> > FAILED
>> >    WARNING: fixIndex() would remove reference to this segment; full
>> > exception:
>> > java.lang.RuntimeException: Term Index test failed
>> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
>> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>> >
>> > WARNING: 1 broken segments (containing 1077025 documents) detected
>> > WARNING: would write new segments file, and 1077025 documents would be
>> lost,
>> > if -fix were specified
>> >
>> > Searching on this index seems to be fine, though.
>> >
>> > Here is the IndexWriter log from the build:
>> >
>> > IFD [Indexer]: setInfoStream
>> >
>> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@2a9cfec1
>> > IW 0 [Indexer]: setInfoStream:
>> > dir=org.apache.lucene.store.SimpleFSDirectory@D
>> :\mnsavs\lresumes1\lresumes1.luc\lresumes1.update.main.2
>> > autoCommit=false
>> >
>> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@291946c2mergeScheduler
>> =org.apache.lucene.index.ConcurrentMergeScheduler@3a747fa2ramBufferSizeMB
>> =16.0
>> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
>> > maxFieldLength=2147483647 index=
>> > IW 0 [Indexer]: setRAMBufferSizeMB 910.25
>> > IW 0 [Indexer]: setMaxBufferedDocs 1000000
>> > IW 0 [Indexer]: flush at getReader
>> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=null
>> docStoreOffset=0
>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
>> > numBufDelTerms=0
>> > IW 0 [Indexer]:   index before flush
>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=886.463
>> allocMB=886.463
>> > deletesMB=23.803 triggerMB=910.25
>> > IW 0 [UpdWriterBuild]:   flush: segment=_0 docStoreSegment=_0
>> > docStoreOffset=0 flushDocs=true flushDeletes=false flushDocStores=false
>> > numDocs=171638 numBufDelTerms=171638
>> > IW 0 [UpdWriterBuild]:   index before flush
>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _0 numDocs=171638
>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=929523712
>> newFlushedSize=573198529
>> > docs/MB=313.985 new/old=61.666%
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit
>> =
>> > false]
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit
>> =
>> > false]
>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 1 segments
>> > IW 0 [UpdWriterBuild]: CMS: now merge
>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0
>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=857.977
>> allocMB=901.32
>> > deletesMB=52.274 triggerMB=910.25
>> > IW 0 [UpdWriterBuild]:   flush: segment=_1 docStoreSegment=_0
>> > docStoreOffset=171638 flushDocs=true flushDeletes=false
>> flushDocStores=false
>> > numDocs=204995 numBufDelTerms=204995
>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _1 numDocs=204995
>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=899653632
>> newFlushedSize=544283851
>> > docs/MB=394.928 new/old=60.499%
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit
>> =
>> > false]
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit
>> =
>> > false]
>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 2 segments
>> > IW 0 [UpdWriterBuild]: CMS: now merge
>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
>> > IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations:
>> usedMB=834.645 vs
>> > trigger=910.25 allocMB=901.32 deletesMB=75.627 vs trigger=955.762
>> > byteBlockFree=35.938 charBlockFree=8.938
>> > IW 0 [UpdWriterBuild]: DW:     nothing to free
>> > IW 0 [UpdWriterBuild]: DW:     after free: freedMB=66.613 usedMB=910.272
>> > allocMB=834.707
>> > IW 0 [UpdWriterBuild]:   flush: segment=_2 docStoreSegment=_0
>> > docStoreOffset=376633 flushDocs=true flushDeletes=false
>> flushDocStores=false
>> > numDocs=168236 numBufDelTerms=168236
>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
>> _1:C204995->_0
>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _2 numDocs=168236
>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=875188224
>> newFlushedSize=530720464
>> > docs/MB=332.394 new/old=60.641%
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit
>> =
>> > false]
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit
>> =
>> > false]
>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 3 segments
>> > IW 0 [UpdWriterBuild]: CMS: now merge
>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0
>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=814.282
>> allocMB=835.832
>> > deletesMB=95.997 triggerMB=910.25
>> > IW 0 [UpdWriterBuild]:   flush: segment=_3 docStoreSegment=_0
>> > docStoreOffset=544869 flushDocs=true flushDeletes=false
>> flushDocStores=false
>> > numDocs=146894 numBufDelTerms=146894
>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
>> _1:C204995->_0
>> > _2:C168236->_0
>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _3 numDocs=146894
>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=853836800
>> newFlushedSize=522388771
>> > docs/MB=294.856 new/old=61.181%
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit
>> =
>> > false]
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit
>> =
>> > false]
>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 4 segments
>> > IW 0 [UpdWriterBuild]: CMS: now merge
>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0
>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=791.724
>> allocMB=835.832
>> > deletesMB=118.535 triggerMB=910.25
>> > IW 0 [UpdWriterBuild]:   flush: segment=_4 docStoreSegment=_0
>> > docStoreOffset=691763 flushDocs=true flushDeletes=false
>> flushDocStores=false
>> > numDocs=162034 numBufDelTerms=162034
>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
>> _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0
>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _4 numDocs=162034
>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=830182400
>> newFlushedSize=498741034
>> > docs/MB=340.668 new/old=60.076%
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit
>> =
>> > false]
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit
>> =
>> > false]
>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 5 segments
>> > IW 0 [UpdWriterBuild]: CMS: now merge
>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
>> > IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations:
>> usedMB=771.396 vs
>> > trigger=910.25 allocMB=835.832 deletesMB=138.875 vs trigger=955.762
>> > byteBlockFree=39.688 charBlockFree=7.188
>> > IW 0 [UpdWriterBuild]: DW:     nothing to free
>> > IW 0 [UpdWriterBuild]: DW:     after free: freedMB=64.374 usedMB=910.271
>> > allocMB=771.458
>> > IW 0 [UpdWriterBuild]:   flush: segment=_5 docStoreSegment=_0
>> > docStoreOffset=853797 flushDocs=true flushDeletes=false
>> flushDocStores=false
>> > numDocs=146250 numBufDelTerms=146250
>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
>> _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _5 numDocs=146250
>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=808866816
>> newFlushedSize=485212402
>> > docs/MB=316.056 new/old=59.987%
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit
>> =
>> > false]
>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit
>> =
>> > false]
>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 6 segments
>> > IW 0 [UpdWriterBuild]: CMS: now merge
>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
>> > IW 0 [Indexer]: commit: start
>> > IW 0 [Indexer]: commit: now prepare
>> > IW 0 [Indexer]: prepareCommit: flush
>> > IW 0 [Indexer]:   flush: segment=_6 docStoreSegment=_0
>> > docStoreOffset=1000047 flushDocs=true flushDeletes=true
>> flushDocStores=true
>> > numDocs=76978 numBufDelTerms=76978
>> > IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> > IW 0 [Indexer]:   flush shared docStore segment _0
>> > IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
>> > numDocs=1077025
>> > IW 0 [Indexer]: DW: flush postings as segment _6 numDocs=76978
>> > IW 0 [Indexer]: DW:   oldRAMSize=486968320 newFlushedSize=273168136
>> > docs/MB=295.486 new/old=56.096%
>> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =
>> false]
>> > IW 0 [Indexer]: DW: apply 1077025 buffered deleted terms and 0 deleted
>> > docIDs and 0 deleted queries on 7 segments.
>> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =
>> false]
>> > IW 0 [Indexer]: LMP: findMerges: 7 segments
>> > IW 0 [Indexer]: LMP:   level 8.008305 to 8.758305: 7 segments
>> > IW 0 [Indexer]: CMS: now merge
>> > IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> _2:C168236->_0
>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>> > IW 0 [Indexer]: CMS:   no more merges pending; now return
>> > IW 0 [Indexer]: startCommit(): start sizeInBytes=0
>> > IW 0 [Indexer]: startCommit index=_0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > changeCount=21
>> > IW 0 [Indexer]: now sync _0.tis
>> > IW 0 [Indexer]: now sync _5.prx
>> > IW 0 [Indexer]: now sync _3.frq
>> > IW 0 [Indexer]: now sync _3.tii
>> > IW 0 [Indexer]: now sync _1.frq
>> > IW 0 [Indexer]: now sync _6.frq
>> > IW 0 [Indexer]: now sync _4.prx
>> > IW 0 [Indexer]: now sync _4.fnm
>> > IW 0 [Indexer]: now sync _2.tii
>> > IW 0 [Indexer]: now sync _3.fnm
>> > IW 0 [Indexer]: now sync _1.fnm
>> > IW 0 [Indexer]: now sync _6.tis
>> > IW 0 [Indexer]: now sync _4.frq
>> > IW 0 [Indexer]: now sync _5.nrm
>> > IW 0 [Indexer]: now sync _5.tis
>> > IW 0 [Indexer]: now sync _1.tii
>> > IW 0 [Indexer]: now sync _4.tis
>> > IW 0 [Indexer]: now sync _0.prx
>> > IW 0 [Indexer]: now sync _3.nrm
>> > IW 0 [Indexer]: now sync _4.tii
>> > IW 0 [Indexer]: now sync _0.nrm
>> > IW 0 [Indexer]: now sync _5.fnm
>> > IW 0 [Indexer]: now sync _1.tis
>> > IW 0 [Indexer]: now sync _0.fnm
>> > IW 0 [Indexer]: now sync _2.prx
>> > IW 0 [Indexer]: now sync _6.tii
>> > IW 0 [Indexer]: now sync _4.nrm
>> > IW 0 [Indexer]: now sync _2.frq
>> > IW 0 [Indexer]: now sync _5.frq
>> > IW 0 [Indexer]: now sync _3.prx
>> > IW 0 [Indexer]: now sync _5.tii
>> > IW 0 [Indexer]: now sync _2.fnm
>> > IW 0 [Indexer]: now sync _1.prx
>> > IW 0 [Indexer]: now sync _2.tis
>> > IW 0 [Indexer]: now sync _0.tii
>> > IW 0 [Indexer]: now sync _6.prx
>> > IW 0 [Indexer]: now sync _0.frq
>> > IW 0 [Indexer]: now sync _6.fnm
>> > IW 0 [Indexer]: now sync _0.fdx
>> > IW 0 [Indexer]: now sync _6.nrm
>> > IW 0 [Indexer]: now sync _0.fdt
>> > IW 0 [Indexer]: now sync _1.nrm
>> > IW 0 [Indexer]: now sync _2.nrm
>> > IW 0 [Indexer]: now sync _3.tis
>> > IW 0 [Indexer]: done all syncs
>> > IW 0 [Indexer]: commit: pendingCommit != null
>> > IW 0 [Indexer]: commit: wrote segments file "segments_2"
>> > IFD [Indexer]: now checkpoint "segments_2" [7 segments ; isCommit =
>> true]
>> > IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
>> > IFD [Indexer]: delete "segments_1"
>> > IW 0 [Indexer]: commit: done
>> > IW 0 [Indexer]: optimize: index now _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6
>> docStoreOffset=0
>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
>> > numBufDelTerms=0
>> > IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > IW 0 [Indexer]: add merge to pendingMerges: _0:C171638->_0
>> _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > [optimize] [total 1 pending]
>> > IW 0 [Indexer]: CMS: now merge
>> > IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0
>> _2:C168236->_0
>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>> > IW 0 [Indexer]: CMS:   consider merge _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > into _7 [optimize]
>> > IW 0 [Indexer]: CMS:     launch new thread [Lucene Merge Thread #0]
>> > IW 0 [Indexer]: CMS:   no more merges pending; now return
>> > IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: start
>> > IW 0 [Lucene Merge Thread #0]: now merge
>> >  merge=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
>> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0 into _7 [optimize]
>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@78688954
>> >  index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
>> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>> > IW 0 [Lucene Merge Thread #0]: merging _0:C171638->_0 _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > into _7 [optimize]
>> > IW 0 [Lucene Merge Thread #0]: merge: total 1077025 docs
>> > IW 0 [Lucene Merge Thread #0]: commitMerge: _0:C171638->_0
>> _1:C204995->_0
>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>> _6:C76978->_0
>> > into _7 [optimize] index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0
>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>> > IW 0 [Lucene Merge Thread #0]: commitMergeDeletes _0:C171638->_0
>> > _1:C204995->_0 _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
>> _5:C146250->_0
>> > _6:C76978->_0 into _7 [optimize]
>> > IFD [Lucene Merge Thread #0]: now checkpoint "segments_2" [1 segments ;
>> > isCommit = false]
>> > IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: done
>> > IW 0 [Indexer]: now flush at close
>> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6
>> docStoreOffset=0
>> > flushDocs=false flushDeletes=true flushDocStores=true numDocs=0
>> > numBufDelTerms=0
>> > IW 0 [Indexer]:   index before flush _7:C1077025->_0
>> > IW 0 [Indexer]:   flush shared docStore segment _6
>> > IW 0 [Indexer]: DW: closeDocStore: 0 files to flush to segment _6
>> numDocs=0
>> > IW 0 [Indexer]: CMS: now merge
>> > IW 0 [Indexer]: CMS:   index: _7:C1077025->_0
>> > IW 0 [Indexer]: CMS:   no more merges pending; now return
>> > IW 0 [Indexer]: now call final commit()
>> > IW 0 [Indexer]: startCommit(): start sizeInBytes=0
>> > IW 0 [Indexer]: startCommit index=_7:C1077025->_0 changeCount=23
>> > IW 0 [Indexer]: now sync _7.prx
>> > IW 0 [Indexer]: now sync _7.fnm
>> > IW 0 [Indexer]: now sync _7.tis
>> > IW 0 [Indexer]: now sync _7.nrm
>> > IW 0 [Indexer]: now sync _7.tii
>> > IW 0 [Indexer]: now sync _7.frq
>> > IW 0 [Indexer]: done all syncs
>> > IW 0 [Indexer]: commit: pendingCommit != null
>> > IW 0 [Indexer]: commit: wrote segments file "segments_3"
>> > IFD [Indexer]: now checkpoint "segments_3" [1 segments ; isCommit =
>> true]
>> > IFD [Indexer]: deleteCommits: now decRef commit "segments_2"
>> > IFD [Indexer]: delete "_0.tis"
>> > IFD [Indexer]: delete "_5.prx"
>> > IFD [Indexer]: delete "_3.tii"
>> > IFD [Indexer]: delete "_3.frq"
>> > IFD [Indexer]: delete "_1.frq"
>> > IFD [Indexer]: delete "_6.frq"
>> > IFD [Indexer]: delete "_4.prx"
>> > IFD [Indexer]: delete "_4.fnm"
>> > IFD [Indexer]: delete "_2.tii"
>> > IFD [Indexer]: delete "_3.fnm"
>> > IFD [Indexer]: delete "_1.fnm"
>> > IFD [Indexer]: delete "_6.tis"
>> > IFD [Indexer]: delete "_4.frq"
>> > IFD [Indexer]: delete "_5.nrm"
>> > IFD [Indexer]: delete "_5.tis"
>> > IFD [Indexer]: delete "_1.tii"
>> > IFD [Indexer]: delete "_4.tis"
>> > IFD [Indexer]: delete "_0.prx"
>> > IFD [Indexer]: delete "_3.nrm"
>> > IFD [Indexer]: delete "_4.tii"
>> > IFD [Indexer]: delete "_0.nrm"
>> > IFD [Indexer]: delete "_5.fnm"
>> > IFD [Indexer]: delete "_1.tis"
>> > IFD [Indexer]: delete "_0.fnm"
>> > IFD [Indexer]: delete "_2.prx"
>> > IFD [Indexer]: delete "_6.tii"
>> > IFD [Indexer]: delete "_4.nrm"
>> > IFD [Indexer]: delete "_2.frq"
>> > IFD [Indexer]: delete "_5.frq"
>> > IFD [Indexer]: delete "_3.prx"
>> > IFD [Indexer]: delete "_5.tii"
>> > IFD [Indexer]: delete "_2.fnm"
>> > IFD [Indexer]: delete "_1.prx"
>> > IFD [Indexer]: delete "_2.tis"
>> > IFD [Indexer]: delete "_0.tii"
>> > IFD [Indexer]: delete "_6.prx"
>> > IFD [Indexer]: delete "_0.frq"
>> > IFD [Indexer]: delete "segments_2"
>> > IFD [Indexer]: delete "_6.fnm"
>> > IFD [Indexer]: delete "_6.nrm"
>> > IFD [Indexer]: delete "_1.nrm"
>> > IFD [Indexer]: delete "_2.nrm"
>> > IFD [Indexer]: delete "_3.tis"
>> > IW 0 [Indexer]: commit: done
>> > IW 0 [Indexer]: at close: _7:C1077025->_0
>> >
>> > I see no errors.
>> > Peter
>> >
>> >
>> > On Tue, Oct 27, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.com
>> >wrote:
>> >
>> >>
>> >>
>> >> On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
>> >> lucene@mikemccandless.com> wrote:
>> >>
>> >>> OK that exception looks more reasonable, for a disk full event.
>> >>>
>> >>> But, I can't tell from your followon emails: did this lead to index
>> >>> corruption?
>> >>>
>> >>
>> >> Yes, but this may be caused by the application ignoring a Lucene
>> exception
>> >> somewhere else. I will chase this down.
>> >>
>> >>>
>> >>> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- you
>> >>> really should upgrade that to the latest 1.6.0 -- there's at least one
>> >>> known problem with Lucene and early 1.6.0 JREs.
>> >>>
>> >>
>> >> Yes, I remember this problem - that's why we stayed at _03
>> >> Thanks.
>> >>
>> >>>
>> >>> Mike
>> >>>
>> >>> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <
>> peterlkeegan@gmail.com>
>> >>> wrote:
>> >>> > After rebuilding the corrupted indexes, the low disk space exception
>> is
>> >>> now
>> >>> > occurring as expected. Sorry for the distraction.
>> >>> >
>> >>> > fyi, here are the details:
>> >>> >
>> >>> >  java.io.IOException: There is not enough space on the disk
>> >>> >    at java.io.RandomAccessFile.writeBytes(Native Method)
>> >>> >    at java.io.RandomAccessFile.write(Unknown Source)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
>> >>> >    at
>> org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
>> >>> >    at
>> >>> org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
>> >>> >    at
>> >>> >
>> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
>> >>> >    at
>> org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
>> >>> >    at
>> >>> >
>> >>>
>> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
>> >>> >
>> >>> >
>> >>> > And the corresponding index info log:
>> >>> >
>> >>> > IFD [Indexer]: setInfoStream
>> >>> >
>> >>>
>> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
>> >>> > IW 1 [Indexer]: setInfoStream:
>> >>> > dir=org.apache.lucene.store.SimpleFSDirectory@D
>> >>> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
>> >>> > autoCommit=false
>> >>> >
>> >>>
>> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler
>> >>>
>> =org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB
>> >>> =16.0
>> >>> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
>> >>> > maxFieldLength=2147483647 index=
>> >>> > IW 1 [Indexer]: flush at addIndexesNoOptimize
>> >>> > IW 1 [Indexer]:   flush: segment=null docStoreSegment=null
>> >>> docStoreOffset=0
>> >>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
>> >>> > numBufDelTerms=0
>> >>> > IW 1 [Indexer]:   index before flush
>> >>> > IW 1 [Indexer]: now start transaction
>> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>> >>> > IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
>> >>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
>> >>> > IW 1 [Indexer]: CMS: now merge
>> >>> > IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
>> >>> > IW 1 [Indexer]: CMS:   no more merges pending; now return
>> >>> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [total
>> 1
>> >>> > pending]
>> >>> > IW 1 [Indexer]: now merge
>> >>> >  merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
>> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
>> >>> >  index=_7:Cx1075533->_0** _8:Cx2795**
>> >>> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
>> >>> > IW 1 [Indexer]: merge: total 1074388 docs
>> >>> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0
>> [mergeDocStores]
>> >>> > index=_7:Cx1075533->_0** _8:Cx2795**
>> >>> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
>> >>> [mergeDocStores]
>> >>> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit =
>> >>> false]
>> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>> >>> > IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
>> >>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
>> >>> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1
>> pending]
>> >>> > IW 1 [Indexer]: now merge
>> >>> >  merge=_8:Cx2795 into _1 [mergeDocStores]
>> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
>> >>> >  index=_0:C1074388 _8:Cx2795**
>> >>> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
>> >>> > IW 1 [Indexer]: merge: total 2795 docs
>> >>> > IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
>> >>> > [mergeDocStores] exc=java.io.IOException: There is not enough space
>> on
>> >>> the
>> >>> > disk
>> >>> > IW 1 [Indexer]: hit exception during merge
>> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
>> unreferenced
>> >>> file
>> >>> > "_1.fdt"
>> >>> > IFD [Indexer]: delete "_1.fdt"
>> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
>> unreferenced
>> >>> file
>> >>> > "_1.fdx"
>> >>> > IFD [Indexer]: delete "_1.fdx"
>> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
>> unreferenced
>> >>> file
>> >>> > "_1.fnm"
>> >>> > IFD [Indexer]: delete "_1.fnm"
>> >>> > IW 1 [Indexer]: now rollback transaction
>> >>> > IW 1 [Indexer]: all running merges have aborted
>> >>> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit =
>> >>> false]
>> >>> > IFD [Indexer]: delete "_0.nrm"
>> >>> > IFD [Indexer]: delete "_0.tis"
>> >>> > IFD [Indexer]: delete "_0.fnm"
>> >>> > IFD [Indexer]: delete "_0.tii"
>> >>> > IFD [Indexer]: delete "_0.frq"
>> >>> > IFD [Indexer]: delete "_0.fdx"
>> >>> > IFD [Indexer]: delete "_0.prx"
>> >>> > IFD [Indexer]: delete "_0.fdt"
>> >>> >
>> >>> >
>> >>> > Peter
>> >>> >
>> >>> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <
>> peterlkeegan@gmail.com
>> >>> >wrote:
>> >>> >
>> >>> >>
>> >>> >>
>> >>> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>> >>> >> lucene@mikemccandless.com> wrote:
>> >>> >>
>> >>> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <
>> peterlkeegan@gmail.com
>> >>> >
>> >>> >>> wrote:
>> >>> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>> >>> >>> > lucene@mikemccandless.com> wrote:
>> >>> >>> >
>> >>> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
>> >>> peterlkeegan@gmail.com
>> >>> >>> >
>> >>> >>> >> wrote:
>> >>> >>> >> > Even running in console mode, the exception is difficult to
>> >>> >>> interpret.
>> >>> >>> >> > Here's an exception that I think occurred during an add
>> document,
>> >>> >>> commit
>> >>> >>> >> or
>> >>> >>> >> > close:
>> >>> >>> >> > doc counts differ for segment _g: field Reader shows 137 but
>> >>> >>> segmentInfo
>> >>> >>> >> > shows 5777
>> >>> >>> >>
>> >>> >>> >> That's spooky.  Do you have the full exception for this one?
>>  What
>> >>> IO
>> >>> >>> >> system are you running on?  (Is it just a local drive on your
>> >>> windows
>> >>> >>> >> computer?) It's almost as if the IO system is not generating an
>> >>> >>> >> IOException to Java when disk fills up.
>> >>> >>> >>
>> >>> >>> >
>> >>> >>> > Index and code are all on a local drive. There is no other
>> exception
>> >>> >>> coming
>> >>> >>> > back - just what I reported.
>> >>> >>>
>> >>> >>> But, you didn't report a traceback for this first one?
>> >>> >>>
>> >>> >>
>> >>> >> Yes, I need to add some more printStackTrace calls.
>> >>> >>
>> >>> >>
>> >>> >>>
>> >>> >>> >> > I ensured that the disk space was low before updating the
>> index.
>> >>> >>> >>
>> >>> >>> >> You mean, to intentionally test the disk-full case?
>> >>> >>> >>
>> >>> >>> >
>> >>> >>> > Yes, that's right.
>> >>> >>>
>> >>> >>> OK.  Can you turn on IndexWriter's infoStream, get this disk full
>> /
>> >>> >>> corruption to happen again, and post back the resulting output?
>>  Make
>> >>> >>> sure your index first passes CheckIndex before starting (so we
>> don't
>> >>> >>> begin the test w/ any pre-existing index corruption).
>> >>> >>>
>> >>> >>
>> >>> >> Good point about CheckIndex.  I've already found 2 bad ones. I will
>> >>> build
>> >>> >> new indexes from scratch. This will take a while.
>> >>> >>
>> >>> >>
>> >>> >>> >> > On another occasion, the exception was:
>> >>> >>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C123
>> >>> _3:C107
>> >>> >>> >> _4:C126
>> >>> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
>> >>> [mergeDocStores]
>> >>> >>> >>
>> >>> >>> >> In this case, the SegmentMerger was trying to open this
>> segment,
>> >>> but
>> >>> >>> >> on attempting to read the first int from the fdx (fields index)
>> >>> file
>> >>> >>> >> for one of the segments, it hit EOF.
>> >>> >>> >>
>> >>> >>> >> This is also spooky -- this looks like index corruption, which
>> >>> should
>> >>> >>> >> never happen on hitting disk full.
>> >>> >>> >>
>> >>> >>> >
>> >>> >>> > That's what I thought, too. Could Lucene be catching the
>> IOException
>> >>> and
>> >>> >>> > turning it into a different exception?
>> >>> >>>
>> >>> >>> I think that's unlikely, but I guess possible.  We have "disk
>> full"
>> >>> >>> tests in the unit tests, that throw an IOException at different
>> times.
>> >>> >>>
>> >>> >>> What exact windows version are you using?  The local drive is
>> NTFS?
>> >>> >>>
>> >>> >>
>> >>> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>> >>> >>
>> >>> >>
>> >>> >>>
>> >>> >>> Mike
>> >>> >>>
>> >>> >>>
>> ---------------------------------------------------------------------
>> >>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>> >>>
>> >>> >>>
>> >>> >>
>> >>> >
>> >>>
>> >>> ---------------------------------------------------------------------
>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>>
>> >>>
>> >>
>> >
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

--001636e0b6eeb1ddb10476f0430f--

From java-user-return-43063-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 23:04:08 2009
Return-Path: <java-user-return-43063-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34540 invoked from network); 27 Oct 2009 23:03:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 23:03:06 -0000
Received: (qmail 9490 invoked by uid 500); 27 Oct 2009 23:03:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 9410 invoked by uid 500); 27 Oct 2009 23:03:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 9400 invoked by uid 99); 27 Oct 2009 23:03:04 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 23:03:04 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 23:02:54 +0000
Received: by ywh13 with SMTP id 13so210524ywh.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 16:02:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=qvl3sQ8TWziN8hp0ag6OEbSFCIyI4ESg16PlIR4U0kA=;
        b=IZY6TOmykEntvwkP1lUfFvDynViesQRnpCaBAn/AZ6hMGeSqjdeBBlYGnadsWwPaLl
         4MXMp8bmVa5htI6de77kJn6fPqwE0ygO5AzJzG8kKZN/b2xd27fS0kHunSHrJ5DqrGXB
         4CAnmDryLG/rAKFSvn+do6L2Yzs4Kh4sJhsYM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=azCMm7AGj6+6IZYI4phgDYkV8F+RD0iqVG2hmUYpWqW0W9mWygGJQ9Im/wQ5G516yk
         ByyVOL/rzvJQvOv6u48K5iQh1uiWEnIJiWQB/C2VoOV9hPbMhJctXpxc+oHwb9y+wg/k
         embaIaCAAIl+dHKG3Q6gtE4xrom5wcxIiKXLE=
Received: by 10.150.115.8 with SMTP id n8mr13997307ybc.64.1256684553063;
        Tue, 27 Oct 2009 16:02:33 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 15sm175840gxk.12.2009.10.27.16.02.31
        (version=SSLv3 cipher=RC4-MD5);
        Tue, 27 Oct 2009 16:02:32 -0700 (PDT)
Message-ID: <4AE77C06.3080600@gmail.com>
Date: Tue, 27 Oct 2009 19:02:30 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu> <4AD8BEC4.50905@gmail.com> <4AD8C04E.2020101@gmail.com> <4AD8C131.1080901@gmail.com> <4AE777AD.7000000@gmail.com>
In-Reply-To: <4AE777AD.7000000@gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Luis Alves wrote:
> Mark Miller wrote:
>> Mark Miller wrote:
>>  
>>> Michael Busch wrote:
>>>      
>>>>  Why will just saying once again "Hey, let's just release more often"
>>>> work now if it hasn't in the last two years?
>>>>
>>>>  Mich
>>>>           
>>> I don't know that we need to release more often to take advantage of
>>> major numbers. 2.2 was released in 07 - we could have just released 2.9
>>> right after 2.2 rather than also releasing 2.3 and 2.4. The number of
>>> releases between major releases is self imposed.
>>>
>>>       
>> And actually - even 2.9, which took so long, didn't have to. A .9
>> release could be very fast and only done as a stepping stone to the next
>> major release. The pain of how long everything took was just self
>> imposed. We could have moved to 3.0 years ago easily if someone has
>> suggested so. The truth is, all the deprecation complain stuff only
>> recently reached a boil - so noone suggested moving to the next major
>> version faster long enough ago. When they did, we jumped from 2.4 to
>> 2.9. And the 2.9 was a huge release - but again, it didn't have to be.
>> It could have been a formality - Grant was arguing at one point that it
>> should have been.
>>
>>   
> I don't see much difference in have frequent major releases or
> frequent minor releases,
> if they share same backwards-compatibility policy.
>
> If you have 4 major releases per year 4.0 , 5.0, 6.0 and 7.0, or four
> minor release
> 3.2, 3.3, 3.4, 3.5.
> From the user perspective is not going to help that much since, since
> moving from 4.0 to 6.0
> will have the same cost of moving from 3.2 to 3.4, if the
> backwards-compatibility is similar in
> major releases and minor-releases and the time between release is the
> same.
>
> What I like in Michael proposal is that it gives the user a chance to
> move between sequential minor releases
> without breaking the code, if you follow the process of cleaning your
> code from deprecated calls.
> I would hope this rule would also apply to 3.9 to 4.0 if these are
> sequential releases.
This is already the case. Except it easier to follow because you know it
happens on the .9 to .0 release.
>
> If you see what lucene community is doing with 2.4->2.9->3.0 this is
> actually Michael proposal
> but now will be the rule instead of the exception that was done just
> for 3.0 major release.
No - its a rule now. Its happens every time we go from .9 -> .0
>
> Lucene could have gone from 2.4 to 3.0, without having any releases in
> between, since it was a major
> release and there was no need to be backward-compatible, but that
> would have created major code migration
> headaches.
No it couldn't have. Thats would have been against the current back
compat policy. There isn't much difference between the two options -
except that one is clearer about the when and where - it happens on the
.9 -> .0 move - with the this proposed way, it happens on some minor
release -
to know which, you have to follow along. And possibly different
deprecations would be removed on different minor releases - making the
whole thing a
mess of a lot harder than using major number points.
>
> Option B) allows developers to remove old code more quickly and does
> not force the lucene community to create
> major releases for code clean up. It gives flexibility and guarantees
> the users with a clean upgrade path.
Thats the only reason we create major releases now. It has nothing to do
with features. So doing it more often doesn't hurt anything.
>
> I also propose that we should also apply this rule between the last
> minor release of previous major release
> and next major release, just as it was done for 2.4->2.9->3.0.
That rule already exists.
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43060-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 23:11:40 2009
Return-Path: <java-user-return-43060-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 38674 invoked from network); 27 Oct 2009 23:06:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 23:06:38 -0000
Received: (qmail 10808 invoked by uid 500); 27 Oct 2009 22:02:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10651 invoked by uid 500); 27 Oct 2009 22:02:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10629 invoked by uid 99); 27 Oct 2009 22:02:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 22:02:32 +0000
X-ASF-Spam-Status: No, hits=0.0 required=10.0
	tests=HS_INDEX_PARAM,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of bradfordstephens@gmail.com designates 209.85.217.219 as permitted sender)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 22:02:22 +0000
Received: by gxk19 with SMTP id 19so172448gxk.5
        for <multiple recipients>; Tue, 27 Oct 2009 15:02:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=JjrN+4LebffNkSODuEiCl15f7sG4uk6DiJZWk7VnPcg=;
        b=UP3ByKiBFCCBJtVYGpCZoz6gHr9woF8UbtW8ngvAZNkjLIED65hnEaWsQiwQQR2YPO
         1hAJmKt2CpeUmCAfdhV6LhsLgCazvFgkD08mYHD4w9E5iy+wI6e3sV3jW50V68U1iZw5
         GQlnkN8uibhTjBw6hrbO3dOq7ks2dh6+OfOYg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ZRvwHht8V8A9vdmDZROPcG3e53jIK2COcQuX/gD0yFw8GtI9hXivZyAWpznLpQMO6P
         kidfYrzFyKM681Zx0f5qhwgYj6ilrP2zjpW1Ymk9MyDKelzcn6qhgavRDB3gbyJJc7tm
         nOtE7wfpRZRJ/irKiusIPPm4SocbT5QmWv8mI=
MIME-Version: 1.0
Received: by 10.90.176.16 with SMTP id y16mr1537355age.52.1256680921449; Tue, 
	27 Oct 2009 15:02:01 -0700 (PDT)
In-Reply-To: <860544ed0910181710r1851f7e2vf3966e22dc3cc8a9@mail.gmail.com>
References: <860544ed0910181710r1851f7e2vf3966e22dc3cc8a9@mail.gmail.com>
Date: Tue, 27 Oct 2009 15:02:01 -0700
Message-ID: <860544ed0910271502l16a1eae0t61028529560ab401@mail.gmail.com>
Subject: Re: Seattle / NW Hadoop, Lucene, Apache "Cloud Stack" Meetup, Wed Oct 
	28 6:45pm
From: Bradford Stephens <bradfordstephens@gmail.com>
To: core-user@hadoop.apache.org, java-user@lucene.apache.org, 
	solr-user@lucene.apache.org, hbase-user@hadoop.apache.org, 
	pig-user@hadoop.apache.org, katta-developer@lists.sourceforge.net
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

Hey guys! Don't forget this is tomorrow (Wednesday). See you there!

Cheers,
Bradford

On Sun, Oct 18, 2009 at 5:10 PM, Bradford Stephens
<bradfordstephens@gmail.com> wrote:
> Greetings,
>
> (You're receiving this e-mail because you're on a DL or I think you'd
> be interested)
>
> It's time for another Hadoop/Lucene/Apache "Cloud" stack meetup! This
> month it'll be on Wednesday, the 28th, at 6:45 pm.
>
> A *huge* thanks for everyone who showed up last month, and to Facebook
> for sending someone awesome to speak about Hive. We learned quite a
> bit!
>
> For October, we will have someone speaking about Cascading, and how it
> helps workflow abstraction with MapReduce. Very useful stuff to know.
>
> We've had great attendance in the past few months, let's keep it up!
> I'm always amazed by the things I learn from everyone.
>
> We're at the University of Washington, Allen Computer Science Center
> (not Electrical Engineering)
>
> Map: http://www.washington.edu/home/maps/?CSE
>
> Room: 303 -or- the Entry level. If there are changes, signs will be posted.
>
> More Info:
>
> The meetup is about 2 hours (and there's usually food): we'll have two
> in-depth talks, and then several "lightning talks" of 5 minutes. We'll
> then have discussion and 'social time'. Let me know if you're
> interested in speaking or attending. We'd like to focus on education,
> so feel free to ask questions.
>
> Contact: Bradford Stephens, 904-415-3009, bradfordstephens@gmail.com
>
> --
> http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
> and Distributed Lucene Consulting
>
> http://www.roadtofailure.com -- The Fringes of Scalability, Social
> Media, and Computer Science
>



-- 
http://www.drawntoscaleconsulting.com - Scalability, Hadoop, HBase,
and Distributed Lucene Consulting

http://www.roadtofailure.com -- The Fringes of Scalability, Social
Media, and Computer Science

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43064-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 23:18:00 2009
Return-Path: <java-user-return-43064-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54011 invoked from network); 27 Oct 2009 23:17:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 23:17:59 -0000
Received: (qmail 27497 invoked by uid 500); 27 Oct 2009 23:17:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 27425 invoked by uid 500); 27 Oct 2009 23:17:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 27415 invoked by uid 99); 27 Oct 2009 23:17:57 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 23:17:57 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 23:17:55 +0000
Received: by iwn6 with SMTP id 6so190858iwn.20
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 16:17:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=OvkIL+Ib1S/5yImH1FA2rmD8YYiUZyXFFLcpmvywJng=;
        b=pvU8Iu7nfv4CT9s4Xaye7NCCSvxF8x0ZdMadEenZxIwhvwq+RjBo3l58FRMpXQyWzV
         Re1z0BgyIOab8h8ogXyu2lq5Iz7V8nKa0r8Erx8NVK+YItJk0UaM8AuzGLnVV6KuOKn/
         Ms8isCFVSD6pfdIOveM+gODwWejkstLUz0reQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Xb3Xpjac0vDAHjoJQ5IGGYjcT0UPlw1b/r5+BbJ3DL/nPsKy0KSd0aSbLvKclL7YI4
         RoMcfY4ZxFT7Zo3Hb+czpGy2TWGCIUWJerKXdrAkKXalwA3jidQ/k/+/sPnySK/pWOuN
         87hvMn2k2ntVjH1h7KRT1mi8Rarzee6f6muso=
MIME-Version: 1.0
Received: by 10.231.4.149 with SMTP id 21mr1031628ibr.26.1256685454355; Tue, 
	27 Oct 2009 16:17:34 -0700 (PDT)
In-Reply-To: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
Date: Tue, 27 Oct 2009 19:17:34 -0400
Message-ID: <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com>
Subject: Re: Split single string into several fields?
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517740dda19ecf60476f2e290

--001517740dda19ecf60476f2e290
Content-Type: text/plain; charset=ISO-8859-1

Unless I don't understand at all what you're going for, wouldn't
it work to just put the HTML through some kind of parser (strict or
loose depending on how well-formed your HTML is), then just
extract the text from your document and push them into your
Lucene document? Various parsers make this more or less
simple...

Something like, for each document
domObj = parse(htmldocument);
Document lucDoc = new Document();

lucDoc.add("insideh1", domObj.getText(<dom path to H1>));

lucDoc.add("insideh1", domObj.getText(<dom path to title>));

lucDoc.add("alltext", <like above>);
lucDoc.add("alltext, <like above>);
.
.
.
<add document to lucene index>

HTH
Erick


On Tue, Oct 27, 2009 at 6:50 PM, Will Murnane <will.murnane@gmail.com>wrote:

> Hello list,
>  I have some semi-structured text that has some markup elements, and
> I want to put those elements into a separate field so I can search by
> them.  For example (using HTML syntax):
> ---- 8< ---- document
> <h1>Section title</h1>
> Body content
> ---- >8 ----
> I can find that the things inside <h1>s are "Section" and "title", and
> "Body" and "content" are outside.  I want to create two fields for
> this document:
> insideh1 -> "Section", "title"
> alltext -> "Section", "title", "Body", "content"
>
> What's the best way to approach this?  My initial thought is to make
> some kind of MultiAnalyzer that consumes the text and produces several
> token streams, which are added to the document one at a time.  Is that
> a reasonable strategy?
>
> Thanks!
> Will
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001517740dda19ecf60476f2e290--

From java-user-return-43058-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 23:34:02 2009
Return-Path: <java-user-return-43058-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 86450 invoked from network); 27 Oct 2009 23:34:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 23:34:01 -0000
Received: (qmail 74094 invoked by uid 500); 27 Oct 2009 20:44:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74025 invoked by uid 500); 27 Oct 2009 20:43:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74015 invoked by uid 99); 27 Oct 2009 20:43:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 20:43:59 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lafadev@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 20:43:48 +0000
Received: by ewy26 with SMTP id 26so133305ewy.5
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 13:43:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=o8SnVZ5yUhZ+Lyu+RDAqsX8ctRhZGYXb8FGFya5tL8Y=;
        b=RiPGzMnhutwX4Xkv9QC8UiSWK48gt03tSL0tDSQsNFaN3uYmkZoVckKAvX5gGbutao
         1W/bcYEB9ENZdw0688bzAzTjq0TzhLwt1twF19NVRiarDg7ZAgVRRWfBDzigg0Z3i7aQ
         dA6LW20hTHzmZ+1f2nzOH/k8IGYwUZi+ZaS/Y=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=XQ489aZKRImEi63bJUfVjB+gM6fJxCH5lB1JNewLacQ/ksJEAOOAErVdkSLvYfFei2
         eMVknQ4nirrm5gtTtXRHUTcv3/Ch67u6kX+aNnfBr2MEErfXH4i2YjCVyZ4nl+4Vgy6g
         EjApOAPvDHKpBfgswLTjS25+x3/qM3m6JsrxE=
Received: by 10.216.93.78 with SMTP id k56mr2822209wef.102.1256676207943;
        Tue, 27 Oct 2009 13:43:27 -0700 (PDT)
Received: from ?9.30.38.122? ([32.97.110.56])
        by mx.google.com with ESMTPS id t2sm1156446gve.27.2009.10.27.13.43.24
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 27 Oct 2009 13:43:26 -0700 (PDT)
Message-ID: <4AE75B69.70000@gmail.com>
Date: Tue, 27 Oct 2009 13:43:21 -0700
From: Luis Alves <lafadev@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Question about the extends the query parser to support NumericField
 on Lucene 2.9.0
References: <BLU140-W22F12E1C9AC650580E9852D0BE0@phx.gbl> <0942717AA3F14C8AA0B2D8DC996B8DD5@VEGA>
In-Reply-To: <0942717AA3F14C8AA0B2D8DC996B8DD5@VEGA>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,

The new queryparser, as the same restriction.
Since +/- are operators for the lucene syntax, you need to escape them
age:\-32 or use double quotes as suggested by Uwe.

We have the idea to add queryparser extensions to the new queryparser in 
contrib in the near future,
this would allow for users to extend parts of the syntax without having 
to rewrite to queryparser.

Another option using the new queryparser is to create a 
QueryNodeProcessor class
that will undo the parsing for nodes with where the field name is "age".
This is super easy in case you are interest I can post the code here,
but you have to use the new queryparser that is in contrib, and include 
that jar in your class path.



Uwe Schindler wrote:
> If you look into the testcase I provided with my QueryParser example, you
> will see, that the negative numbers have a problem in newTermQuery.
>
> "-" is a control character in QueryParser, which means to do a "NOT" on this
> term. Because of this the syntax of the query is wrong. To hit the negative
> number there is no way around putting the number in quotes: age:"-32":
>
> http://www.lucidimagination.com/search/document/ef7a9dc1444c9d28/how_do_you_
> properly_use_numericfield#de054d728e252174
>
> Sorry, I see no other solution without changing the query parser JavaCC
> syntax. Maybe the new Contrib QueryParser will handle this better in future
> (there is an open issue about that).
>
> Uwe
>
> -----
> Uwe Schindler
> H.-H.-Meier-Allee 63, D-28213 Bremen
> http://www.thetaphi.de
> eMail: uwe@thetaphi.de
>
>   
>> -----Original Message-----
>> From: java8964 java8964 [mailto:java8964@hotmail.com]
>> Sent: Thursday, October 22, 2009 11:56 PM
>> To: java-user@lucene.apache.org
>> Subject: Question about the extends the query parser to support
>> NumericField on Lucene 2.9.0
>>
>>
>> Hi,  I have a problem to work support the NumericField in query parser.
>>
>> My environment is like this:
>>
>> Windows XP with
>> C:\work\> java -version
>> java version "1.6.0_10"
>> Java(TM) SE Runtime Environment (build 1.6.0_10-b33)
>> Java HotSpot(TM) Client VM (build 11.0-b15, mixed mode, sharing)
>>
>> I am using the lucene 2.9.0 releases.
>>
>> I write my query parser class to support this numeric field, here is copy
>> of the override methods:
>>
>>     /**
>>      * Create a new range query of query parser.
>>      *
>>      * If the filed is a numeric field, return NumericRangeQuery;
>>      * otherwise, let super class handle it
>>      *
>>      * @param fieldName The file name
>>      * @param part1 The lower bound
>>      * @param part2 The high bound
>>      * @throws IllegalArgumentExceptoin if the field type is not supported
>>      * @throws NumberFormatException if the query data does not match with
>> the field type
>>      */
>>     @Override
>>     protected Query newRangeQuery(String fieldName, String part1, String
>> part2, boolean inclusive)
>>     {
>>         fieldName = fieldName.toLowerCase();
>>         if (LogUtil.getInstance().isDebugEnabled(DcQueryParser.class))
>>         {
>>             LogUtil.getInstance().debug(DcQueryParser.class,
>>                     "Create a new range query for: " + fieldName);
>>         }
>>
>>         mFieldNames.add(fieldName);
>>         IFieldDefinition fieldDef =
>> mIndexDef.getFieldDefinition(fieldName);
>>         if (part1.trim().startsWith("+"))
>>         {
>>             part1 = part1.substring(1);
>>         }
>>         if (part2.trim().startsWith("+"))
>>         {
>>             part2 = part2.substring(1);
>>         }
>>         if (fieldDef != null && fieldDef.isNumericField())
>>         {
>>             if (fieldDef.getFieldType() == IFieldDefinition.FieldType.INT)
>>             {
>>                 return NumericRangeQuery.newIntRange(fieldDef.getName(),
>> Integer.parseInt(part1), Integer.parseInt(part2), inclusive, inclusive);
>>             }
>>             else if (fieldDef.getFieldType() ==
>> IFieldDefinition.FieldType.LONG)
>>             {
>>                   return
>> NumericRangeQuery.newLongRange(fieldDef.getName(), Long.parseLong(part1),
>> Long.parseLong(part2), inclusive, inclusive);
>>             }
>>             else if (fieldDef.getFieldType() ==
>> IFieldDefinition.FieldType.FLOAT)
>>             {
>>                    return
>> NumericRangeQuery.newFloatRange(fieldDef.getName(),
>> Float.parseFloat(part1), Float.parseFloat(part2), inclusive, inclusive);
>>             }
>>             else if (fieldDef.getFieldType() ==
>> IFieldDefinition.FieldType.DOUBLE)
>>             {
>>                    return
>> NumericRangeQuery.newDoubleRange(fieldDef.getName(),
>> Double.parseDouble(part1), Double.parseDouble(part2), inclusive,
>> inclusive);
>>             }
>>             else
>>             {
>>                 throw new IllegalArgumentException("Unsupported new
>> Numeric field type, as the type is: " + fieldDef.getFieldType().name());
>>             }
>>         }
>>         else
>>         {
>>             return super.newRangeQuery(fieldName, part1, part2,
>> inclusive);
>>         }
>>     }
>>
>>     /**
>>      * Create a new term query of query parser.
>>      * If the filed is a numeric field, use xxxPrefixCoded
>>      * otherwise, let super class handle it
>>      *
>>      * @param term The term object
>>      * @return The query object
>>      * @throws IllegalArgumentExceptoin if the field type is not supported
>>      * @throws NumberFormatException if the query data does not match with
>> the field type
>>      */
>>     @Override
>>     protected Query newTermQuery(Term term)
>>     {
>>         System.out.println("......................1");
>>         String fieldName = term.field();
>>         if (LogUtil.getInstance().isDebugEnabled(DcQueryParser.class))
>>         {
>>             LogUtil.getInstance().debug(DcQueryParser.class,
>>                     "Create a new term query for: " + fieldName);
>>         }
>>
>>         mFieldNames.add(fieldName);
>>         IFieldDefinition fieldDef =
>> mIndexDef.getFieldDefinition(fieldName);
>>         if (fieldDef != null && fieldDef.isNumericField())
>>         {
>>             System.out.println("......................2");
>>             String queryString = term.text().trim();
>>             if (queryString.startsWith("+"))
>>             {
>>                 queryString.substring(1);
>>             }
>>             if (fieldDef.getFieldType() == IFieldDefinition.FieldType.INT)
>>             {
>>                 return new TermQuery(new Term(term.field(),
>> NumericUtils.intToPrefixCoded(Integer.parseInt(queryString))));
>>             }
>>             else if (fieldDef.getFieldType() ==
>> IFieldDefinition.FieldType.LONG)
>>             {
>>                 return new TermQuery(new Term(term.field(),
>> NumericUtils.longToPrefixCoded(Long.parseLong(queryString))));
>>             }
>>             else if (fieldDef.getFieldType() ==
>> IFieldDefinition.FieldType.FLOAT)
>>             {
>>                    return new TermQuery(new Term(term.field(),
>> NumericUtils.floatToPrefixCoded(Float.parseFloat(queryString))));
>>             }
>>             else if (fieldDef.getFieldType() ==
>> IFieldDefinition.FieldType.DOUBLE)
>>             {
>>                    return new TermQuery(new Term(term.field(),
>> NumericUtils.doubleToPrefixCoded(Double.parseDouble(queryString))));
>>             }
>>             else
>>             {
>>                 throw new IllegalArgumentException("Unsupported new
>> Numeric field type, as the type is: " + fieldDef.getFieldType().name());
>>             }
>>         }
>>         else
>>         {
>>             return super.newTermQuery(term);
>>         }
>>     }
>>
>> For my case, range query works as expected. The problem I met now is for
>> the Field query.
>>
>> Here is my unit test:
>>
>> I indexed one line data as following:
>> operation,user_id,city,province,country,age,isbn,title,author,pub_year,pub
>> _name,rating
>> A,56,cheyenne,wyoming,usa,-32,671623249,LONESOME DOVE,Larry
>> McMurtry,1986,Pocket,7.0
>>
>> To make my case simple, I only set the age as type int.
>> Right before I add the field into the document, I have to following
>> statement to check as the output:
>>
>>             if (fieldDef.isNumericField())
>>             {
>>                 System.out.println("Add the numeric field for name: " +
>> fieldDef.getName() + " and value is " + docFieldValue);
>>                 NumericField numField = new
>> NumericField(fieldDef.getName(), Field.Store.YES, true);
>>                 numField.setLongValue(Long.parseLong(docFieldValue));
>>                 doc.add(numField);
>>             }
>>
>> which output the following message in my console:
>> ------------------->  Add the numeric field for name: age and value is -32
>>
>> which proves that I add one numeric field object into the document, the
>> name is 'age', and the value is '-32'.
>>
>> here is my junit test case:
>>         IndexSearcher searcher = new IndexSearcher(new
>> SimpleFSDirectory(indexDir), true);
>>         MyQueryParser queryParser = new MyQueryParser("age",
>> defaultAnalyzer); --The default analyzer is the stand analyzer in this
>> case.
>>         TopDocs docs = searcher.search(queryParser.parse("age:-32"), 10);
>>         Assert.assertTrue(docs.totalHits == 1);
>>
>> I expect it will pass, but it gives me back the following error message:
>>
>>     [junit] Testcase: testBuildIndex took 9.516 sec
>>     [junit]     Caused an ERROR
>>     [junit] Cannot parse 'age:-32': Encountered " "-" "- "" at line 1,
>> column 4.
>>     [junit] Was expecting one of:
>>     [junit]     "(" ...
>>     [junit]     "*" ...
>>     [junit]     <QUOTED> ...
>>     [junit]     <TERM> ...
>>     [junit]     <PREFIXTERM> ...
>>     [junit]     <WILDTERM> ...
>>     [junit]     "[" ...
>>     [junit]     "{" ...
>>     [junit]     <NUMBER> ...
>>     [junit]
>>     [junit] org.apache.lucene.queryParser.ParseException: Cannot parse
>> 'age:-32': Encountered " "-" "- "" at line 1, column 4.
>>     [junit] Was expecting one of:
>>     [junit]     "(" ...
>>     [junit]     "*" ...
>>     [junit]     <QUOTED> ...
>>     [junit]     <TERM> ...
>>     [junit]     <PREFIXTERM> ...
>>     [junit]     <WILDTERM> ...
>>     [junit]     "[" ...
>>     [junit]     "{" ...
>>     [junit]     <NUMBER> ...
>>     [junit]
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:181)
>>     [junit]     at
>> nokia.dc.server.build.index.IndexBuilderTest.testBuildIndex(IndexBuilderTe
>> st.java:236)
>>     [junit] Caused by: org.apache.lucene.queryParser.ParseException:
>> Encountered " "-" "- "" at line 1, column 4.
>>     [junit] Was expecting one of:
>>     [junit]     "(" ...
>>     [junit]     "*" ...
>>     [junit]     <QUOTED> ...
>>     [junit]     <TERM> ...
>>     [junit]     <PREFIXTERM> ...
>>     [junit]     <WILDTERM> ...
>>     [junit]     "[" ...
>>     [junit]     "{" ...
>>     [junit]     <NUMBER> ...
>>     [junit]
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.generateParseException(QueryPars
>> er.java:1822)
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.jj_consume_token(QueryParser.jav
>> a:1704)
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.Clause(QueryParser.java:1331)
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.Query(QueryParser.java:1241)
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.TopLevelQuery(QueryParser.java:1
>> 230)
>>     [junit]     at
>> org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:176)
>>
>> My question is about to support the FieldQuery in this case. As I said,
>> the RangeQuery works as I expect.
>>
>> The question is:
>>
>> 1) The above prove that I set the field name to 'age', which matched the
>> query field name I put in the query parser. Why I got the above error?
>> 2) I override the newTermQuery method. I am thinking that it sould be
>> invoked in this case. As you can see, I system.out a line in the first
>> statement. But before the above error show up, I didn't see that line
>> output, which menas the execution is not reach to newTermQuery method when
>> the error happened.
>> 3) I did as above is I saw a few days ago, there is a discussion about the
>> same topic. So I just basically copy the idea from "Uwe Schindler" code.
>> My more general question is that when should we override the newXXX
>> method(), or when should we override getXXXX method? What is the
>> difference between them?
>> 4) As you can see my above example, we want to support the query string
>> for numerice field with '+' in it. Even java won't support it and throw
>> NumberFormat Exception, but my case need to support it. So I will remove
>> it from the query string and then send to the super class. I would like to
>> know it won't cause ParseException before it reaches my override methods.
>> 5) As these numeric field features, The query parser class methods did NOT
>> throw ParserException in the method signature. But if I want to catch
>> NumberFormatException, then rethrow ParserException, so my client only
>> need to worry the ParseException. But the ParseException is a regular
>> exception, and I can NOT add it into the override method signture. Any
>> work around?
>>
>> Thanks for your kind help.
>>
>>
>>
>>
>> _________________________________________________________________
>> Windows 7: It helps you do more. Explore Windows 7.
>> http://www.microsoft.com/Windows/windows-
>> 7/default.aspx?ocid=PID24727::T:WLMTAGL:ON:WL:en-
>> US:WWL_WIN_evergreen3:102009
>>     
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>
>   


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43059-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Tue Oct 27 23:45:00 2009
Return-Path: <java-user-return-43059-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 93639 invoked from network); 27 Oct 2009 23:45:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 27 Oct 2009 23:45:00 -0000
Received: (qmail 91248 invoked by uid 500); 27 Oct 2009 20:54:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91200 invoked by uid 500); 27 Oct 2009 20:54:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91190 invoked by uid 99); 27 Oct 2009 20:54:59 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 20:54:59 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lafadev@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 27 Oct 2009 20:54:56 +0000
Received: by ywh13 with SMTP id 13so119956ywh.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 13:54:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=FE0IvNS6qFMhcgebAtlfR+35wZmH+QmKS6p8mCxGa9Q=;
        b=wwJpr/cvY0qFdz08SZBQAOJf53ziDNYdPSAy4CkvJdwY+ydJ3A4lWcp1E6vD3yzyaj
         Ca7/CKIcUVQZHGtv6u1ntM56hN2zdGA9q5a5KuJERBT+tE1cVmnjjasldB0WIWxFjvBq
         l8WEn+By2e7+4mtjCAd9cFMvamjtwssho8pPo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=Jd8G1LAweOnUuxDMmjoVRDHWtAl/5kkse31EOjpb9EU14GVBk5lJciwwq0qbfOzZyA
         dMykshqGY+SWHp/gO2xY4z67FtSXHyc0mIV/LlQqJo3TDKqIy4jOxlpztEYujirVzzsM
         1wTJWYR5S52n3CEyrLsYfFOdFOdMJ0tI4h8l0=
Received: by 10.151.33.1 with SMTP id l1mr1653670ybj.10.1256676876142;
        Tue, 27 Oct 2009 13:54:36 -0700 (PDT)
Received: from ?9.30.38.122? ([32.97.110.56])
        by mx.google.com with ESMTPS id 16sm137088gxk.3.2009.10.27.13.54.34
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 27 Oct 2009 13:54:35 -0700 (PDT)
Message-ID: <4AE75E09.20604@gmail.com>
Date: Tue, 27 Oct 2009 13:54:33 -0700
From: Luis Alves <lafadev@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <200910160939.40260.paul.elschot@xs4all.nl> <828083e70910160123i4226acecx2b397529cc77640d@mail.gmail.com>
In-Reply-To: <828083e70910160123i4226acecx2b397529cc77640d@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

gabriele renzi wrote:
> On Fri, Oct 16, 2009 at 9:39 AM, Paul Elschot <paul.elschot@xs4all.nl> wrote:
>
>   
>> I'd prefer B), with a minimum period of about two months to the
>> next release in case it removes deprecations.
>>     
+1 for B)

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43065-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 00:35:07 2009
Return-Path: <java-user-return-43065-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 11643 invoked from network); 28 Oct 2009 00:35:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 00:35:07 -0000
Received: (qmail 10723 invoked by uid 500); 28 Oct 2009 00:35:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10645 invoked by uid 500); 28 Oct 2009 00:35:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10635 invoked by uid 99); 28 Oct 2009 00:35:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 00:35:05 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of s.rajan09@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 00:34:57 +0000
Received: by pzk3 with SMTP id 3so195324pzk.20
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 17:34:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=fp+u9F+L+8sKhnXuglxpQtaUP+iUgytCLE/x94Z8Ew8=;
        b=r0CwYghi+HlpnvOyfJDh5WsUjR+2uR5nJh63b2E9FvroGwbc4OBrPyim6Atr19Ec7c
         LrMURCQyFXbqKAaOZOcoa3R39y/FNN1LBWzit5ph+JJChFF3llhG9pO8wgpFaquJT/My
         VYXTJCePYRPqNASr/C7sItwdPUqQCVCKBF1ro=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=X8O0B4+QMlFHo57/cnVch5uy1rK5kpvBtSj7QHlRJRZfzGYQFQyOh7ZBILEHNLy2/S
         h/KzXOd1UqvlzNIxUXPdrxUw1qar1NAMz1SNhpg7przxen5cqV9l7OWEc2qq5YT8XJME
         Z4sHYnRsMAuBNR/F46GsiJ6K/YhEVh6289pAU=
MIME-Version: 1.0
Received: by 10.142.8.8 with SMTP id 8mr1385557wfh.64.1256690075990; Tue, 27 
	Oct 2009 17:34:35 -0700 (PDT)
Date: Wed, 28 Oct 2009 06:04:35 +0530
Message-ID: <b14c25870910271734w112b5ea2k166ed5d9d84d5c11@mail.gmail.com>
Subject: SearchFiles demo fails with exception while IndexFiles works
From: s rajan <s.rajan09@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368e223a927b640476f3f5e5
X-Virus-Checked: Checked by ClamAV on apache.org

--0016368e223a927b640476f3f5e5
Content-Type: text/plain; charset=ISO-8859-1

hi, I am playing with lucene 2.9.0 source build, ant 1.7.1, jdk1.6.0, win XP
home edition.
I dont have clover or jFlex installed.
I built the srcs and ran IndexFiles demo and that worked. However when I run
SearchFiles
I have an exception that says:
Exception in thread "main" java.lang.Error: Unresolved compilation problems:
        The field directory is defined in an inherited type and an enclosing
sco
pe
        The field directory is defined in an inherited type and an enclosing
sco
pe
        The field directory is defined in an inherited type and an enclosing
sco
pe
        at
org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:71)
----------------------------------------
I run the build again and its the same thing.
Is there anything else I need to do?

tks,
-rajan

--0016368e223a927b640476f3f5e5--

From java-user-return-43066-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 00:45:18 2009
Return-Path: <java-user-return-43066-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14215 invoked from network); 28 Oct 2009 00:45:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 00:45:18 -0000
Received: (qmail 18761 invoked by uid 500); 28 Oct 2009 00:45:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 18694 invoked by uid 500); 28 Oct 2009 00:45:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 18684 invoked by uid 99); 28 Oct 2009 00:45:15 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 00:45:15 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of will.murnane@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 00:45:07 +0000
Received: by qyk41 with SMTP id 41so201092qyk.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 17:44:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=HCEsQXRkevaVkxshP499LX6bLLm6AORFPTCzU2Ilj+4=;
        b=iVS2AHsTtUPp4Y9Vcdpjrxip291vxuGhy5zzHngIT4SQkMNfkEjqOZtUsrRhfhr96y
         e7iETM/u2x5ZPvbXrdQ/k62BtihdwxpnRuOyvus1iIss9HDo1ROQ6M23ocBeUQCZ7Cxa
         Tk6PDPh7Dqe6tOauoZpsVOk/Y0wGCF2+OYBl8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=Y3kbyx67/SqDUtlNwQdmT48cvARAtyhRhhfTx6Oq36V3WMwrXYu1OYVfa38jbDGdsR
         bIMwCO0qJFb+z24kyihI4NtYX1N4XsoUjWnYA8I9udPvxkB8XJ8jynZ+bAluSWL3guNq
         324sYAwbM7O+0eBio/zA4b23uUm/iebRkGMfc=
MIME-Version: 1.0
Received: by 10.224.42.134 with SMTP id s6mr8857434qae.352.1256690686560; Tue, 
	27 Oct 2009 17:44:46 -0700 (PDT)
In-Reply-To: <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
	 <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com>
Date: Tue, 27 Oct 2009 20:44:46 -0400
Message-ID: <27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com>
Subject: Re: Split single string into several fields?
From: Will Murnane <will.murnane@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

On Tue, Oct 27, 2009 at 19:17, Erick Erickson <erickerickson@gmail.com> wro=
te:
> Unless I don't understand at all what you're going for, wouldn't
> it work to just put the HTML through some kind of parser (strict or
> loose depending on how well-formed your HTML is), then just
> extract the text from your document and push them into your
> Lucene document? Various parsers make this more or less
> simple...
That's more or less what I was suggesting.  The problem as I see it is
that Lucene wants to do its own tokenizing step.  I declared my
IndexWriter like this:
writer =3D new IndexWriter(IndexDirectory, new MySpecialAnalyzer(),
true, MaxFieldLength.UNLIMITED);
and the code in the MySpecialAnalyzer class is indeed called later on.

So, I think this approach:
> domObj =3D parse(htmldocument);
> Document lucDoc =3D new Document();
> lucDoc.add("insideh1", domObj.getText(<dom path to H1>));
(etc) won't work, because when I put that text in it'll be analyzed again.

Perhaps I'll write a ZeroSplittingAnalyzer or something, do all the
work before I give anything to Lucene, then '\0'-join my tokens and
feed them to the simple analyzer.  So something like this:
Document doc =3D new Document();
doc.add(new Field("h1", "hello\0world"));
doc.add(new Field("alltext", "hello\0world\0goodnight\0moon"));

I think that makes sense.  Comments?

Will

>
> HTH
> Erick
>
>
> On Tue, Oct 27, 2009 at 6:50 PM, Will Murnane <will.murnane@gmail.com>wro=
te:
>
>> Hello list,
>> =A0I have some semi-structured text that has some markup elements, and
>> I want to put those elements into a separate field so I can search by
>> them. =A0For example (using HTML syntax):
>> ---- 8< ---- document
>> <h1>Section title</h1>
>> Body content
>> ---- >8 ----
>> I can find that the things inside <h1>s are "Section" and "title", and
>> "Body" and "content" are outside. =A0I want to create two fields for
>> this document:
>> insideh1 -> "Section", "title"
>> alltext -> "Section", "title", "Body", "content"
>>
>> What's the best way to approach this? =A0My initial thought is to make
>> some kind of MultiAnalyzer that consumes the text and produces several
>> token streams, which are added to the document one at a time. =A0Is that
>> a reasonable strategy?
>>
>> Thanks!
>> Will
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43067-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 01:08:05 2009
Return-Path: <java-user-return-43067-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 27199 invoked from network); 28 Oct 2009 01:08:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 01:08:05 -0000
Received: (qmail 40600 invoked by uid 500); 28 Oct 2009 01:08:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 40552 invoked by uid 500); 28 Oct 2009 01:08:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 40542 invoked by uid 99); 28 Oct 2009 01:08:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:08:03 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lafadev@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:07:53 +0000
Received: by qyk41 with SMTP id 41so210585qyk.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 18:07:32 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :content-type:content-transfer-encoding;
        bh=GsLiUbHEf98TNEzJpwhlHb2kklNdevv/gUwejS0o6OY=;
        b=WFV3U+fWXlQgQDzAEXvMkOTEh/SGAh+FKGFyCBL1OQ6vtDHQcIn2xX+QNQB7uc65Dw
         SGSCEzNT1OQUL8e1q01++cw2Vv33PPsO2/HXZFbee6wcRMORqEY82tWAUDVrDC5bmSHk
         HS8YvmHxyOfFNqhA1xgRtQtxaDBj0KBuE1sf0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:content-type:content-transfer-encoding;
        b=Rkkq5NIhDuyWg3X+ywIU8yTfm7qXgObd1szqklhGNf+2onU1uijCG/pCW9ryxbprUH
         XukHXD6FXel6H9X/d/bnEgNffH/oM5rtHblqt1q+U6h26hBhqiqXBaP6dpRvMc1FZ9DW
         KBvZG00VqjGbf7/hQWh7ab6wPbH+6XWLWm5Zw=
Received: by 10.224.53.31 with SMTP id k31mr8861801qag.379.1256692052427;
        Tue, 27 Oct 2009 18:07:32 -0700 (PDT)
Received: from ?9.30.38.122? ([32.97.110.56])
        by mx.google.com with ESMTPS id 23sm254726qyk.15.2009.10.27.18.07.28
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Tue, 27 Oct 2009 18:07:29 -0700 (PDT)
Message-ID: <4AE7994E.3080305@gmail.com>
Date: Tue, 27 Oct 2009 18:07:26 -0700
From: Luis Alves <lafadev@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
References: <4AD81961.7090108@gmail.com> <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu> <4AD8BEC4.50905@gmail.com> <4AD8C04E.2020101@gmail.com> <4AD8C131.1080901@gmail.com> <4AE777AD.7000000@gmail.com> <4AE77C06.3080600@gmail.com>
In-Reply-To: <4AE77C06.3080600@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Mark Miller wrote:
> Luis Alves wrote:
>   
>> Mark Miller wrote:
>>     
>>> Mark Miller wrote:
>>>  
>>>       
>>>> Michael Busch wrote:
>>>>      
>>>>         
>>>>>  Why will just saying once again "Hey, let's just release more often"
>>>>> work now if it hasn't in the last two years?
>>>>>
>>>>>  Mich
>>>>>           
>>>>>           
>>>> I don't know that we need to release more often to take advantage of
>>>> major numbers. 2.2 was released in 07 - we could have just released 2.9
>>>> right after 2.2 rather than also releasing 2.3 and 2.4. The number of
>>>> releases between major releases is self imposed.
>>>>
>>>>       
>>>>         
>>> And actually - even 2.9, which took so long, didn't have to. A .9
>>> release could be very fast and only done as a stepping stone to the next
>>> major release. The pain of how long everything took was just self
>>> imposed. We could have moved to 3.0 years ago easily if someone has
>>> suggested so. The truth is, all the deprecation complain stuff only
>>> recently reached a boil - so noone suggested moving to the next major
>>> version faster long enough ago. When they did, we jumped from 2.4 to
>>> 2.9. And the 2.9 was a huge release - but again, it didn't have to be.
>>> It could have been a formality - Grant was arguing at one point that it
>>> should have been.
>>>
>>>   
>>>       
>> I don't see much difference in have frequent major releases or
>> frequent minor releases,
>> if they share same backwards-compatibility policy.
>>
>> If you have 4 major releases per year 4.0 , 5.0, 6.0 and 7.0, or four
>> minor release
>> 3.2, 3.3, 3.4, 3.5.
>> From the user perspective is not going to help that much since, since
>> moving from 4.0 to 6.0
>> will have the same cost of moving from 3.2 to 3.4, if the
>> backwards-compatibility is similar in
>> major releases and minor-releases and the time between release is the
>> same.
>>
>> What I like in Michael proposal is that it gives the user a chance to
>> move between sequential minor releases
>> without breaking the code, if you follow the process of cleaning your
>> code from deprecated calls.
>> I would hope this rule would also apply to 3.9 to 4.0 if these are
>> sequential releases.
>>     
> This is already the case. Except it easier to follow because you know it
> happens on the .9 to .0 release.
>   
>> If you see what lucene community is doing with 2.4->2.9->3.0 this is
>> actually Michael proposal
>> but now will be the rule instead of the exception that was done just
>> for 3.0 major release.
>>     
> No - its a rule now. Its happens every time we go from .9 -> .0
>   
>> Lucene could have gone from 2.4 to 3.0, without having any releases in
>> between, since it was a major
>> release and there was no need to be backward-compatible, but that
>> would have created major code migration
>> headaches.
>>     
> No it couldn't have. Thats would have been against the current back
> compat policy. There isn't much difference between the two options -
> except that one is clearer about the when and where - it happens on the
> .9 -> .0 move - with the this proposed way, it happens on some minor
> release -
> to know which, you have to follow along. And possibly different
> deprecations would be removed on different minor releases - making the
> whole thing a
> mess of a lot harder than using major number points.
>   
>> Option B) allows developers to remove old code more quickly and does
>> not force the lucene community to create
>> major releases for code clean up. It gives flexibility and guarantees
>> the users with a clean upgrade path.
>>     
> Thats the only reason we create major releases now. It has nothing to do
> with features. So doing it more often doesn't hurt anything.
>   
>> I also propose that we should also apply this rule between the last
>> minor release of previous major release
>> and next major release, just as it was done for 2.4->2.9->3.0.
>>     
> That rule already exists.
>   
>>
>>     
Thanks for the reply,

If that is the case, and major releases become more frequent maybe
every 6-12 months. I don't see many differences.

But there needs to be some forced push for these shorter major release 
cycles,
to allow for code clean cycles to also be sorter.

Is there any ideas how to push the community,
to make major release cycles shorter?



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43068-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 01:13:19 2009
Return-Path: <java-user-return-43068-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 28404 invoked from network); 28 Oct 2009 01:13:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 01:13:18 -0000
Received: (qmail 48447 invoked by uid 500); 28 Oct 2009 01:13:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 48399 invoked by uid 500); 28 Oct 2009 01:13:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 48389 invoked by uid 99); 28 Oct 2009 01:13:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:13:16 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:13:10 +0000
Received: by iwn6 with SMTP id 6so250512iwn.20
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 18:12:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ZGK14fIkhn38YwfmCSPY+DL8mGCvXQjMDhni3Phchx4=;
        b=HXcckotO4jjpMENPS6NoFRHy5lOKba4lmKwi/3+B1dU71TVPcKzdqtQGkUEuQvj2Zy
         rsST2hXi1qKQ0uEPKuGDzj114s55/xqHJvJgkuXz27Ijr8GPaYFBW5HT1HzEmmvU5cWy
         cvrQ5c9zYkUxTlnhukYeN4SIHeOAT321ymgm4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=VSaLd/wZr4Az9BW6y/ypAqSJpfBSSmxZpDLrnt2kPMSGAW/aWIMtOL6bg5eBfjUn0e
         w4mnEYUgAd4Qk+j9kq1IBN8du4DMhw7JRqxT5/mbWE5i76SkVOs8nAvB5xgjm2Dkm8HE
         C9CmnsrG2cxyRXzrCbxGYhhlbTdqAlMn1EddU=
MIME-Version: 1.0
Received: by 10.231.170.201 with SMTP id e9mr3334856ibz.15.1256692370368; Tue, 
	27 Oct 2009 18:12:50 -0700 (PDT)
In-Reply-To: <27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
	 <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com>
	 <27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com>
Date: Tue, 27 Oct 2009 21:12:50 -0400
Message-ID: <359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com>
Subject: Re: Split single string into several fields?
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504501810253ef450476f47e44

--00504501810253ef450476f47e44
Content-Type: text/plain; charset=ISO-8859-1

Could you go into your use case a bit more? Because I'm confused.
Why don't you want your text tokenized? You say you want to search it,
which means you have to analyze it. All I'm suggesting is passing the text
from whatever HTML element into the analyzer, without the surrounding
markup. I'm suggesting that you might be able to use the analyzers
Lucene provides and just pass in text strings, without any need to create
your own analyzer.

If you need different analyzers for each field, see PerFieldAnalyzerWrapper.

Best
Erick

On Tue, Oct 27, 2009 at 8:44 PM, Will Murnane <will.murnane@gmail.com>wrote:

> On Tue, Oct 27, 2009 at 19:17, Erick Erickson <erickerickson@gmail.com>
> wrote:
> > Unless I don't understand at all what you're going for, wouldn't
> > it work to just put the HTML through some kind of parser (strict or
> > loose depending on how well-formed your HTML is), then just
> > extract the text from your document and push them into your
> > Lucene document? Various parsers make this more or less
> > simple...
> That's more or less what I was suggesting.  The problem as I see it is
> that Lucene wants to do its own tokenizing step.  I declared my
> IndexWriter like this:
> writer = new IndexWriter(IndexDirectory, new MySpecialAnalyzer(),
> true, MaxFieldLength.UNLIMITED);
> and the code in the MySpecialAnalyzer class is indeed called later on.
>
> So, I think this approach:
> > domObj = parse(htmldocument);
> > Document lucDoc = new Document();
> > lucDoc.add("insideh1", domObj.getText(<dom path to H1>));
> (etc) won't work, because when I put that text in it'll be analyzed again.
>
> Perhaps I'll write a ZeroSplittingAnalyzer or something, do all the
> work before I give anything to Lucene, then '\0'-join my tokens and
> feed them to the simple analyzer.  So something like this:
> Document doc = new Document();
> doc.add(new Field("h1", "hello\0world"));
> doc.add(new Field("alltext", "hello\0world\0goodnight\0moon"));
>
> I think that makes sense.  Comments?
>
> Will
>
> >
> > HTH
> > Erick
> >
> >
> > On Tue, Oct 27, 2009 at 6:50 PM, Will Murnane <will.murnane@gmail.com
> >wrote:
> >
> >> Hello list,
> >>  I have some semi-structured text that has some markup elements, and
> >> I want to put those elements into a separate field so I can search by
> >> them.  For example (using HTML syntax):
> >> ---- 8< ---- document
> >> <h1>Section title</h1>
> >> Body content
> >> ---- >8 ----
> >> I can find that the things inside <h1>s are "Section" and "title", and
> >> "Body" and "content" are outside.  I want to create two fields for
> >> this document:
> >> insideh1 -> "Section", "title"
> >> alltext -> "Section", "title", "Body", "content"
> >>
> >> What's the best way to approach this?  My initial thought is to make
> >> some kind of MultiAnalyzer that consumes the text and produces several
> >> token streams, which are added to the document one at a time.  Is that
> >> a reasonable strategy?
> >>
> >> Thanks!
> >> Will
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504501810253ef450476f47e44--

From java-user-return-43069-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 01:14:47 2009
Return-Path: <java-user-return-43069-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 29805 invoked from network); 28 Oct 2009 01:14:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 01:14:46 -0000
Received: (qmail 51830 invoked by uid 500); 28 Oct 2009 01:14:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 51753 invoked by uid 500); 28 Oct 2009 01:14:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 51743 invoked by uid 99); 28 Oct 2009 01:14:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:14:44 +0000
X-ASF-Spam-Status: No, hits=-2.5 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of yseeley@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:14:41 +0000
Received: by ewy26 with SMTP id 26so349552ewy.5
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 18:14:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:sender:reply-to:received
         :in-reply-to:references:date:x-google-sender-auth:message-id:subject
         :from:to:content-type;
        bh=CDkyVwBTHRbN2A6+j71xFhUAhKHJcHLdAlWJD8El3NI=;
        b=dUGNicii0yKzrQJGEJXg9VPscRdEHKgWCuHpK/TMsNLKz7C4gyoAu54/jnu+NoaGU5
         bgG4++bYsZatZIzfq7stYrgVWCQtrzYS1mVzy4UhVadQA9sV3vM4rtRB76qbVA9p93UJ
         zBi8PzHl80p2QdU4pRkjaEB3TKHruJ4e6OEYs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:sender:reply-to:in-reply-to:references:date
         :x-google-sender-auth:message-id:subject:from:to:content-type;
        b=OV/VWeGMT1OxZgsrUsGcwWyQJ8j/fLNEbxDdtURcvxjFUDpQp0Cov0EAP6UE3OL7wK
         xalN8xgzqpRRfKrJNM5AdESAtMRlzep/h05JMWwPKqJLEB6JL2uvHFTiwNPeF5RQ6kct
         NkUGgwX0VqTZBwxMQEW8ICc3Z+KbPxu80bODM=
MIME-Version: 1.0
Sender: yseeley@gmail.com
Reply-To: yonik@lucidimagination.com
Received: by 10.216.89.205 with SMTP id c55mr1085307wef.186.1256692460332; 
	Tue, 27 Oct 2009 18:14:20 -0700 (PDT)
In-Reply-To: <4AE7994E.3080305@gmail.com>
References: <4AD81961.7090108@gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
	 <4AD8BEC4.50905@gmail.com> <4AD8C04E.2020101@gmail.com>
	 <4AD8C131.1080901@gmail.com> <4AE777AD.7000000@gmail.com>
	 <4AE77C06.3080600@gmail.com> <4AE7994E.3080305@gmail.com>
Date: Tue, 27 Oct 2009 21:14:20 -0400
X-Google-Sender-Auth: ad0745e091217b05
Message-ID: <c68e39170910271814o36d0c0e3ve184dc2c525777c2@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
From: Yonik Seeley <yonik@lucidimagination.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Oct 27, 2009 at 9:07 PM, Luis Alves <lafadev@gmail.com> wrote:
> But there needs to be some forced push for these shorter major release
> cycles,
> to allow for code clean cycles to also be sorter.

Maybe... or maybe not.
There's also value in a more stable API over a longer period of time.
Different people will pick a different balance, and it's not as simple
as declaring that we need to be able to remove older APIs faster.

-Yonik
http://www.lucidimagination.com

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43070-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 01:22:27 2009
Return-Path: <java-user-return-43070-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35474 invoked from network); 28 Oct 2009 01:22:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 01:22:27 -0000
Received: (qmail 58649 invoked by uid 500); 28 Oct 2009 01:22:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 58588 invoked by uid 500); 28 Oct 2009 01:22:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 58578 invoked by uid 99); 28 Oct 2009 01:22:25 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:22:25 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:22:16 +0000
Received: by yxe30 with SMTP id 30so308751yxe.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 18:21:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=a9IShhoMzLD/PfrbtYSos62WkU+9MxDnnHZQfbx8jAA=;
        b=clhtVDzfYnjhh6WpHOsKlQZeXhSN2t1AcQlaS6ZLiA3ppkEmf2vIXtXuAhJxQVipV3
         oGh9OVC4W81m24qrpIA4sYQApzLzWNhrXxk/1/jPvg8kxqRenl92op7h0wNGIWahhnqv
         +65bgcndyS84SgGyCiAgLVt8vfSKa8x3p00Eo=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Ub1eUDdFgAH8N9PEcBRHwyhM9n7Hebv5HFr9Y1WZFUG3rmZ9DKeOSZtw8j963I3Es5
         PzSTFK06OG85RTztGKmdZgeSwx+qA3Ba3TdNzVaPoKE/j7wv0Ob5FSUOEjWpG3aYDByo
         Sw71e5gRldZZb9SvEPt31pmUYlJ7liuMwm5Gc=
MIME-Version: 1.0
Received: by 10.90.222.1 with SMTP id u1mr3129593agg.103.1256692916008; Tue, 
	27 Oct 2009 18:21:56 -0700 (PDT)
In-Reply-To: <359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
	 <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com>
	 <27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com>
	 <359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com>
Date: Tue, 27 Oct 2009 18:21:55 -0700
Message-ID: <4b124c310910271821i4b41c10dn76fb429081b990a4@mail.gmail.com>
Subject: Re: Split single string into several fields?
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636283e94d9b7320476f49ee6
X-Virus-Checked: Checked by ClamAV on apache.org

--001636283e94d9b7320476f49ee6
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Oct 27, 2009 at 6:12 PM, Erick Erickson <erickerickson@gmail.com>wrote:

> Could you go into your use case a bit more? Because I'm confused.
> Why don't you want your text tokenized? You say you want to search it,
> which means you have to analyze it.


I think Will is suggesting that he doesn't want to have to analyze it
*again* -
if he really has different fields for every tag type, it would get
prohibitively
expensive in terms of Indexing CPU usage to retokenize over and over
again.

Is that what your concern is, Will?

  -jake

--001636283e94d9b7320476f49ee6--

From java-user-return-43071-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 01:57:06 2009
Return-Path: <java-user-return-43071-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41123 invoked from network); 28 Oct 2009 01:57:05 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 01:57:05 -0000
Received: (qmail 80555 invoked by uid 500); 28 Oct 2009 01:57:03 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 80476 invoked by uid 500); 28 Oct 2009 01:57:03 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 80466 invoked by uid 99); 28 Oct 2009 01:57:03 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:57:03 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of will.murnane@gmail.com designates 74.125.92.24 as permitted sender)
Received: from [74.125.92.24] (HELO qw-out-2122.google.com) (74.125.92.24)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 01:57:00 +0000
Received: by qw-out-2122.google.com with SMTP id 5so83208qwd.53
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 18:56:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=Y1zIyYdiBgx1u8JyfJruKG6y/aoWYkH92cVqk9D9Kl8=;
        b=BrQ3oDCWK7SnKlU71aLZn8e2UAMf6sNVh1fiGhFr2lB2dpUc/EqpmzICKJRRtWgjYB
         5dzZxjD8eyfvBlxBxFYsCs4yOh3lFm4NyJupgxh8kBMjIoyjGd7JyDwOxeVVk/c+gnzb
         igFTFG6iksp2HSQDW3NVP1qGTXgNaXXcRx3pc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=sivhksthtfH9zcAedoEAQ9BjXepHYwHYkDi40hpywm5nZvZVfzazNy1O9Af42805q1
         eecdTXEJ5EayvyhE7vAGXoiioZr7YjiAyu6IjQYlmYtdXpGGvggdHVTn80jNUgFOvV77
         9b4+z3/AT5DFX6AYYBzh83Yu+ug7oEU/HHxAA=
MIME-Version: 1.0
Received: by 10.224.42.134 with SMTP id s6mr8895641qae.352.1256694999910; Tue, 
	27 Oct 2009 18:56:39 -0700 (PDT)
In-Reply-To: <4b124c310910271821i4b41c10dn76fb429081b990a4@mail.gmail.com>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com>
	 <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com>
	 <27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com>
	 <359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com>
	 <4b124c310910271821i4b41c10dn76fb429081b990a4@mail.gmail.com>
Date: Tue, 27 Oct 2009 21:56:39 -0400
Message-ID: <27b05b490910271856i717cd3b2ka255102623dffd95@mail.gmail.com>
Subject: Re: Split single string into several fields?
From: Will Murnane <will.murnane@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Oct 27, 2009 at 21:21, Jake Mannix <jake.mannix@gmail.com> wrote:
> On Tue, Oct 27, 2009 at 6:12 PM, Erick Erickson <erickerickson@gmail.com>wrote:
>
>> Could you go into your use case a bit more? Because I'm confused.
>> Why don't you want your text tokenized? You say you want to search it,
>> which means you have to analyze it.
>
>
> I think Will is suggesting that he doesn't want to have to analyze it
> *again* -
> if he really has different fields for every tag type, it would get
> prohibitively
> expensive in terms of Indexing CPU usage to retokenize over and over
> again.
>
> Is that what your concern is, Will?
More or less.  Different types of tags need different tokenization:
just as an example, I want to parse an img tag which contains a src
attribute as a URL, and tokenize the URL as such (i.e., even if there
are spaces they're treated as a unit), but the contents of a paragraph
must be tokenized as English text.

So I think the solution (because there's only one Analyzer per
IndexWriter, and thus per document) is to do all the
field-type-specific stuff outside of Lucene, and then use a very
generic Analyzer, like the "\0"-splitter mentioned above.

On Tue, Oct 27, 2009 at 21:12, Erick Erickson <erickerickson@gmail.com> wrote:
> If you need different analyzers for each field, see PerFieldAnalyzerWrapper.

That's very close to what I need, but I don't think it lines up quite
right.  When I find some tokens inside an h1 tag (assume for
simplicity that I only need to consider the innermost tag around a
particular element) they won't be in the category for
things-inside-h2-tags.  So I think trying to find all the things that
are in h1 tags in one pass through the DOM tree, then things in h2
tags in another, and so forth, will be slower than traversing the tree
once and filing everything in its place myself, then feeding each list
into Lucene as a field.

So, in other words, I think using an individual Analyzer for each type
of tag will be inefficient, so I'll run one big Analyzer, then put its
results into Lucene.

Will

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43072-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 02:11:56 2009
Return-Path: <java-user-return-43072-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44768 invoked from network); 28 Oct 2009 02:11:56 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 02:11:56 -0000
Received: (qmail 90695 invoked by uid 500); 28 Oct 2009 02:11:54 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 90606 invoked by uid 500); 28 Oct 2009 02:11:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 90595 invoked by uid 99); 28 Oct 2009 02:11:54 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 02:11:54 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [208.97.132.81] (HELO homiemail-a22.g.dreamhost.com) (208.97.132.81)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 02:11:51 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a22.g.dreamhost.com (Postfix) with ESMTPA id C44451A805F
	for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 19:11:30 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: Split single string into several fields?
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <27b05b490910271856i717cd3b2ka255102623dffd95@mail.gmail.com>
Date: Tue, 27 Oct 2009 22:11:30 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <AE85DDEB-2B7A-4392-9A09-97C759B4D68D@apache.org>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com> <359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com> <27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com> <359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com> <4b124c310910271821i4b41c10dn76fb429081b990a4@mail.gmail.com> <27b05b490910271856i717cd3b2ka255102623dffd95@mail.gmail.com>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)

Not sure if it completely applies here, but you might also have a look  
at the TeeSinkTokenFilter in the contrib/analysis package.  It is  
designed to tee/sink tokens off from one main field to other fields.


On Oct 27, 2009, at 9:56 PM, Will Murnane wrote:

> On Tue, Oct 27, 2009 at 21:21, Jake Mannix <jake.mannix@gmail.com>  
> wrote:
>> On Tue, Oct 27, 2009 at 6:12 PM, Erick Erickson <erickerickson@gmail.com 
>> >wrote:
>>
>>> Could you go into your use case a bit more? Because I'm confused.
>>> Why don't you want your text tokenized? You say you want to search  
>>> it,
>>> which means you have to analyze it.
>>
>>
>> I think Will is suggesting that he doesn't want to have to analyze it
>> *again* -
>> if he really has different fields for every tag type, it would get
>> prohibitively
>> expensive in terms of Indexing CPU usage to retokenize over and over
>> again.
>>
>> Is that what your concern is, Will?
> More or less.  Different types of tags need different tokenization:
> just as an example, I want to parse an img tag which contains a src
> attribute as a URL, and tokenize the URL as such (i.e., even if there
> are spaces they're treated as a unit), but the contents of a paragraph
> must be tokenized as English text.
>
> So I think the solution (because there's only one Analyzer per
> IndexWriter, and thus per document) is to do all the
> field-type-specific stuff outside of Lucene, and then use a very
> generic Analyzer, like the "\0"-splitter mentioned above.
>
> On Tue, Oct 27, 2009 at 21:12, Erick Erickson  
> <erickerickson@gmail.com> wrote:
>> If you need different analyzers for each field, see  
>> PerFieldAnalyzerWrapper.
>
> That's very close to what I need, but I don't think it lines up quite
> right.  When I find some tokens inside an h1 tag (assume for
> simplicity that I only need to consider the innermost tag around a
> particular element) they won't be in the category for
> things-inside-h2-tags.  So I think trying to find all the things that
> are in h1 tags in one pass through the DOM tree, then things in h2
> tags in another, and so forth, will be slower than traversing the tree
> once and filing everything in its place myself, then feeding each list
> into Lucene as a field.
>
> So, in other words, I think using an individual Analyzer for each type
> of tag will be inefficient, so I'll run one big Analyzer, then put its
> results into Lucene.
>
> Will
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43073-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 02:45:43 2009
Return-Path: <java-user-return-43073-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50659 invoked from network); 28 Oct 2009 02:45:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 02:45:43 -0000
Received: (qmail 11019 invoked by uid 500); 28 Oct 2009 02:45:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 10951 invoked by uid 500); 28 Oct 2009 02:45:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 10941 invoked by uid 99); 28 Oct 2009 02:45:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 02:45:40 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 02:45:38 +0000
Received: by pxi3 with SMTP id 3so270843pxi.29
        for <java-user@lucene.apache.org>; Tue, 27 Oct 2009 19:45:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=gA2G4pQc/cvjulkRSmAhcthlEiJ71Cril6BYr0eEpxw=;
        b=tmR4ZJ2Pg4RRF6H9getqsj4Dv9U9ixHhBn5XnxMXWfaHke4bRy3SMjA4/NeThW9bdc
         arcSpBbjUeJqpXDf1QMHyOq/CK8JLJbuVoAipyQSfJ2h14Jk7Vkg/VgFzW6ojMQFXJTg
         4XVkh+NBfYmG2qXWdye1L87381ycD4Q35NF0I=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=WkMbtiZQevASGb0bP9UTJwxhwfG/viimbOZ3fFnHPZzFsndUIbUoFJ/JatuH8bOjuV
         KWiLlFwA8kfrTjPcjGmKDSoMH+Ab1IzH4b1uCXOYm/Pw9PWlUQL3PMPKJVO/aybDtCSJ
         N9O+d1OTQ7CjTLYnED4ntbnxS+v1geayloHvs=
MIME-Version: 1.0
Received: by 10.114.7.10 with SMTP id 10mr28110659wag.90.1256697917737; Tue, 
	27 Oct 2009 19:45:17 -0700 (PDT)
In-Reply-To: <27b05b490910271856i717cd3b2ka255102623dffd95@mail.gmail.com>
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com> 
	<359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com> 
	<27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com> 
	<359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com> 
	<4b124c310910271821i4b41c10dn76fb429081b990a4@mail.gmail.com> 
	<27b05b490910271856i717cd3b2ka255102623dffd95@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Tue, 27 Oct 2009 22:44:52 -0400
Message-ID: <8f0ad1f30910271944l5c0b6e8na76e003ff58924f2@mail.gmail.com>
Subject: Re: Split single string into several fields?
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e648afbafa8b000476f5c88b

--0016e648afbafa8b000476f5c88b
Content-Type: text/plain; charset=UTF-8

Will, I think this parsing of documents into different fields, is separate
and unrelated from lucene's analysis (tokenization)...
the analysis comes to play once you have a field, and you want to break the
text into indexable units (words, or entire field as token like your urls).

i wouldn't suggest make a big complicated analyzer that tries to parse html
in addition to breaking text into words, I would keep parsing and analysis
separate.
then i would handle different fields with different analyzers, i think Erick
already mentioned PerFieldAnalyzerWrapper, its useful for this.

if there is some performance consideration... it seems you are worried about
this wrt parsing, not actual analysis.... then maybe use the sax api?

On Tue, Oct 27, 2009 at 9:56 PM, Will Murnane <will.murnane@gmail.com>wrote:

> On Tue, Oct 27, 2009 at 21:21, Jake Mannix <jake.mannix@gmail.com> wrote:
> > On Tue, Oct 27, 2009 at 6:12 PM, Erick Erickson <erickerickson@gmail.com
> >wrote:
> >
> >> Could you go into your use case a bit more? Because I'm confused.
> >> Why don't you want your text tokenized? You say you want to search it,
> >> which means you have to analyze it.
> >
> >
> > I think Will is suggesting that he doesn't want to have to analyze it
> > *again* -
> > if he really has different fields for every tag type, it would get
> > prohibitively
> > expensive in terms of Indexing CPU usage to retokenize over and over
> > again.
> >
> > Is that what your concern is, Will?
> More or less.  Different types of tags need different tokenization:
> just as an example, I want to parse an img tag which contains a src
> attribute as a URL, and tokenize the URL as such (i.e., even if there
> are spaces they're treated as a unit), but the contents of a paragraph
> must be tokenized as English text.
>
> So I think the solution (because there's only one Analyzer per
> IndexWriter, and thus per document) is to do all the
> field-type-specific stuff outside of Lucene, and then use a very
> generic Analyzer, like the "\0"-splitter mentioned above.
>
> On Tue, Oct 27, 2009 at 21:12, Erick Erickson <erickerickson@gmail.com>
> wrote:
> > If you need different analyzers for each field, see
> PerFieldAnalyzerWrapper.
>
> That's very close to what I need, but I don't think it lines up quite
> right.  When I find some tokens inside an h1 tag (assume for
> simplicity that I only need to consider the innermost tag around a
> particular element) they won't be in the category for
> things-inside-h2-tags.  So I think trying to find all the things that
> are in h1 tags in one pass through the DOM tree, then things in h2
> tags in another, and so forth, will be slower than traversing the tree
> once and filing everything in its place myself, then feeding each list
> into Lucene as a field.
>
> So, in other words, I think using an individual Analyzer for each type
> of tag will be inefficient, so I'll run one big Analyzer, then put its
> results into Lucene.
>
> Will
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Robert Muir
rcmuir@gmail.com

--0016e648afbafa8b000476f5c88b--

From java-user-return-43074-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 02:57:53 2009
Return-Path: <java-user-return-43074-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52870 invoked from network); 28 Oct 2009 02:57:53 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 02:57:53 -0000
Received: (qmail 18106 invoked by uid 500); 28 Oct 2009 02:57:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17997 invoked by uid 500); 28 Oct 2009 02:57:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17940 invoked by uid 99); 28 Oct 2009 02:57:48 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 02:57:48 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 02:57:45 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id E189071C876; Tue, 27 Oct 2009 19:57:24 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id DF27271C85B;
	Tue, 27 Oct 2009 19:57:24 -0700 (PDT)
Date: Tue, 27 Oct 2009 19:57:24 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: general@lucene.apache.org
cc: Lucene Users <java-user@lucene.apache.org>, solr-user@lucene.apache.org, 
    mahout-user@lucene.apache.org, nutch-user@lucene.apache.org, 
    lucene-net-user@incubator.apache.org, openrelevance-user@lucene.apache.org, 
    tika-user@lucene.apache.org
Subject: [ANNOUNCE] Lucene MeetUp in Oakland, CA - Tue Nov 3rd @ 8PM
Message-ID: <Pine.LNX.4.64.0910271946360.12071@radix.cryptio.net>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII; format=flowed


(cross posted to many user lists, please confine reply to general@lucene)

There will be a Lucene meetup next week at ApacheCon in Oakland, CA on 
Tuesday, November 3rd. Meetups are free (the rest of the conference is 
not). See: http://wiki.apache.org/lucene-java/LuceneAtApacheConUs2009

For other meetups at ApacheCon, see
http://www.us.apachecon.com/c/acus2009/schedule/meetups.

Also, one last reminder, we have a lot of Lucene/Solr related content 
scheduled for ApacheCon including Lucene and Solr training (Monday and 
Tuesday), two full days of Lucene related talks on Thursday and Friday, 
plus the Meetup. I also know there will be a lot of Lucene ecosystem 
committers at AC this year, so it's a great way to interact with people 
working on your favorite Lucene projects. See http://www.us.apachecon.com 
for more info on the conference.


-Hoss (channeling Grant)

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43075-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 05:55:29 2009
Return-Path: <java-user-return-43075-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 89955 invoked from network); 28 Oct 2009 05:55:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 05:55:29 -0000
Received: (qmail 57501 invoked by uid 500); 28 Oct 2009 05:55:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 57425 invoked by uid 500); 28 Oct 2009 05:55:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 57415 invoked by uid 99); 28 Oct 2009 05:55:27 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 05:55:27 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=5.0
	tests=AWL,BAYES_05,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [76.13.12.184] (HELO web59609.mail.ac4.yahoo.com) (76.13.12.184)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 05:55:22 +0000
Received: (qmail 2779 invoked by uid 60001); 28 Oct 2009 05:55:01 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256709301; bh=yMeZFug137lwzAmrCcnf9YJWE4r2nDfGB1TGkA/9PpQ=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=QJeVDvGcYX67/tburFp8WIdaiOCOBsUPSzPOE/roEMv1sUYGBRBlOcfRlmU1ov5ewBFVSoDmuMXE7x68rDZJXNkeB6CiDs4Hb/A7k2mlb7XgZ5HICfz3CiFpAoVhz0Kec7A5Xfdfs5fSx/ZjTt0xrB+Y3fLuvhQR6xkSAh6lkBU=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=l5cDnlzQv12934anLGaSwK/pJiNLJub8ExXe9mYIZrd2xys+NmUeQwYP4k7lnXg8nWKmQDpne5zXzs+Fx5qOWwu7eeaQYkvmd1dhTpd6M+hnGtmX9N/Z3uxk5v4z7xJIXMNLY5oqZrilnyKURU5uP6hMLVNBWXJqcaZv9m1nICM=;
Message-ID: <103453.2279.qm@web59609.mail.ac4.yahoo.com>
X-YMail-OSG: S8pRuOQVM1mvNp4arqTnyd.RgJQFjp8kntPw1wBaJFkHXwRQ3ZV0.dcgB.eipnHtCzAGj2qbg2z2LfsbaUUasFxKgJEFwb.4GU5KbTO3NOVib9yM_9oIYIwqCBCZLaL1bXkLqpCWOhyIGeulP0P_Zkv06uQEzkl9v0A38h0TbM_T6D0_JuXgcswliK5YGCG_0hviYtrGmB9ewomSdgOQp5HZ7_ImhYPv2JFoEVyFDPdU1S_t1Gysz7rFRIM8aQkdqGj7Sz7v0eiSkHbM5ZNylqKu3uij_lwF9KjvJeXoQw--
Received: from [59.90.244.83] by web59609.mail.ac4.yahoo.com via HTTP; Tue, 27 Oct 2009 22:55:00 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Tue, 27 Oct 2009 22:55:00 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: What is multiple indexing and how does it work in Lucene [Java]
To: java user <java-user@lucene.apache.org>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1674973531-1256709300=:2279"

--0-1674973531-1256709300=:2279
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Can anyone tell me what is multiple indexing and how does it work in lucene=
 [Java].
=A0
Kindly provide the informations either the explanation or any source for su=
ch details.
=A0
Thanx in advance=0A=0A=0A      
--0-1674973531-1256709300=:2279--

From java-user-return-43076-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 09:23:33 2009
Return-Path: <java-user-return-43076-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40170 invoked from network); 28 Oct 2009 09:23:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 09:23:33 -0000
Received: (qmail 13692 invoked by uid 500); 28 Oct 2009 09:23:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 13620 invoked by uid 500); 28 Oct 2009 09:23:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 13610 invoked by uid 99); 28 Oct 2009 09:23:30 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 09:23:30 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 09:23:27 +0000
Received: by ywh13 with SMTP id 13so532690ywh.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 02:23:05 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.19.5 with SMTP id 5mr9152383ybs.103.1256721785682; Wed, 28 
	Oct 2009 02:23:05 -0700 (PDT)
In-Reply-To: <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910261200p1e12078du4b76daec4907f6@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
Date: Wed, 28 Oct 2009 05:23:05 -0400
Message-ID: <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

The unit tests do test multi-segment indexes (though we could always
use deeper testing, here), but, don't test big-ish indexes, like this,
very well.

Are you also using JDK 1.6.0_16 when running CheckIndex?  If you run
CheckIndex on the same index several times in a row, does it report
precisely the same problems?

This exception in CheckIndex is very odd: it checks whether the
docFreq reported for each term in the TermEnum actually matches the
number of docs that it was able to iterate through using the
TermPositions.  The reason why it's very odd is that under the hood
TermPositions is supposed to be using the very same source of docFreq,
to figure out how many docs it's supposed to read.  It may not be
index corruption but rather a bug somewhere in CheckIndex, or, in the
APIs its using.

What settings are you using in your IndexWriter (that differ from its
defaults)?  If you eg increase the frequency of flushing, can you get
this error to happen with a smaller number of docs added?  Just trying
to box the issue in...

Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52" mean?

Mike

On Tue, Oct 27, 2009 at 4:10 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
> Without the optimize, it looks like there are errors on all segments exce=
pt
> the first:
>
> Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
>
> Segments file=3Dsegments_2 numSegments=3D3 version=3DFORMAT_DIAGNOSTICS [=
Lucene
> 2.9]
> =A01 of 3: name=3D_0 docCount=3D413557
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D1,148.795
> =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.versi=
on=3D2.9
> exported - 2009-10-27 15:31:52, source=3Dflush, os.arch=3Damd64,
> java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D0
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...OK [7704599 terms; 180318249 terms/docs =
pairs;
> 340258711 tokens]
> =A0 =A0test: stored fields.......OK [1240671 total field count; avg 3 fie=
lds
> per doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
>
> =A02 of 3: name=3D_1 docCount=3D359203
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D1,125.103
> =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.versi=
on=3D2.9
> exported - 2009-10-27 15:31:52, source=3Dflush, os.arch=3Damd64,
> java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D413557
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=3D=
43 !=3D
> num docs seen 4 + num docs deleted 0]
> java.lang.RuntimeException: term literals:cfid196$ docFreq=3D43 !=3D num =
docs
> seen 4 + num docs deleted 0
> =A0 =A0at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.jav=
a:675)
> =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:5=
30)
> =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> =A0 =A0test: stored fields.......OK [1077609 total field count; avg 3 fie=
lds
> per doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
> FAILED
> =A0 =A0WARNING: fixIndex() would remove reference to this segment; full
> exception:
> java.lang.RuntimeException: Term Index test failed
> =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:5=
43)
> =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>
> =A03 of 3: name=3D_2 docCount=3D304659
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D961.764
> =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.versi=
on=3D2.9
> exported - 2009-10-27 15:31:52, source=3Dflush, os.arch=3Damd64,
> java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D772760
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...ERROR [term contents:? docFreq=3D1 !=3D =
num docs
> seen 245 + num docs deleted 0]
> java.lang.RuntimeException: term contents:? docFreq=3D1 !=3D num docs see=
n 245 +
> num docs deleted 0
> =A0 =A0at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.jav=
a:675)
> =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:5=
30)
> =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> =A0 =A0test: stored fields.......OK [913977 total field count; avg 3 fiel=
ds per
> doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
> FAILED
> =A0 =A0WARNING: fixIndex() would remove reference to this segment; full
> exception:
> java.lang.RuntimeException: Term Index test failed
> =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:5=
43)
> =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
>
> WARNING: 2 broken segments (containing 663862 documents) detected
> WARNING: would write new segments file, and 663862 documents would be los=
t,
> if -fix were specified
>
>
> Do the unit tests create multi-segment indexes?
>
> Peter
>
> On Tue, Oct 27, 2009 at 3:08 PM, Peter Keegan <peterlkeegan@gmail.com>wro=
te:
>
>> It's reproducible with a large no. of docs (>1 million), but not with 10=
0K
>> docs.
>> I got same error with jvm 1.6.0_16.
>> The index was optimized after all docs are added. I'll try removing the
>> optimize.
>>
>> Peter
>>
>>
>> On Tue, Oct 27, 2009 at 2:57 PM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> This is odd -- is it reproducible?
>>>
>>> Can you narrow it down to a small set of docs that when indexed
>>> produce a corrupted index?
>>>
>>> If you attempt to optimize the index, does it fail?
>>>
>>> Mike
>>>
>>> On Tue, Oct 27, 2009 at 1:40 PM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>> > It seems the index is corrupted immediately after the initial build
>>> (ample
>>> > disk space was provided):
>>> >
>>> > Output from CheckIndex:
>>> >
>>> > Opening index @
>>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
>>> >
>>> > Segments file=3Dsegments_3 numSegments=3D1 version=3DFORMAT_DIAGNOSTI=
CS
>>> [Lucene
>>> > 2.9]
>>> > =A01 of 1: name=3D_7 docCount=3D1077025
>>> > =A0 =A0compound=3Dfalse
>>> > =A0 =A0hasProx=3Dtrue
>>> > =A0 =A0numFiles=3D8
>>> > =A0 =A0size (MB)=3D3,201.196
>>> > =A0 =A0diagnostics =3D {optimize=3Dtrue, mergeFactor=3D7, os.version=
=3D5.2,
>>> os=3DWindows
>>> > 2003, mergeDocStores=3Dfalse, lucene.version=3D2.9 exported - 2009-10=
-26
>>> > 07:58:55, source=3Dmerge, os.arch=3Damd64, java.version=3D1.6.0_03,
>>> > java.vendor=3DSun Microsystems Inc.}
>>> > =A0 =A0docStoreOffset=3D0
>>> > =A0 =A0docStoreSegment=3D_0
>>> > =A0 =A0docStoreIsCompoundFile=3Dfalse
>>> > =A0 =A0no deletions
>>> > =A0 =A0test: open reader.........OK
>>> > =A0 =A0test: fields..............OK [33 fields]
>>> > =A0 =A0test: field norms.........OK [33 fields]
>>> > =A0 =A0test: terms, freq, prox...ERROR [term contents:? docFreq=3D1 !=
=3D num
>>> docs
>>> > seen 482 + num docs deleted 0]
>>> > java.lang.RuntimeException: term contents:? docFreq=3D1 !=3D num docs=
 seen
>>> 482 +
>>> > num docs deleted 0
>>> > =A0 =A0at
>>> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
>>> > =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.ja=
va:530)
>>> > =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903=
)
>>> > =A0 =A0test: stored fields.......OK [3231075 total field count; avg 3=
 fields
>>> > per doc]
>>> > =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term=
/freq
>>> > vector fields per doc]
>>> > FAILED
>>> > =A0 =A0WARNING: fixIndex() would remove reference to this segment; fu=
ll
>>> > exception:
>>> > java.lang.RuntimeException: Term Index test failed
>>> > =A0 =A0at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.ja=
va:543)
>>> > =A0 =A0at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903=
)
>>> >
>>> > WARNING: 1 broken segments (containing 1077025 documents) detected
>>> > WARNING: would write new segments file, and 1077025 documents would b=
e
>>> lost,
>>> > if -fix were specified
>>> >
>>> > Searching on this index seems to be fine, though.
>>> >
>>> > Here is the IndexWriter log from the build:
>>> >
>>> > IFD [Indexer]: setInfoStream
>>> >
>>> deletionPolicy=3Dorg.apache.lucene.index.KeepOnlyLastCommitDeletionPoli=
cy@2a9cfec1
>>> > IW 0 [Indexer]: setInfoStream:
>>> > dir=3Dorg.apache.lucene.store.SimpleFSDirectory@D
>>> :\mnsavs\lresumes1\lresumes1.luc\lresumes1.update.main.2
>>> > autoCommit=3Dfalse
>>> >
>>> mergePolicy=3Dorg.apache.lucene.index.LogByteSizeMergePolicy@291946c2me=
rgeScheduler
>>> =3Dorg.apache.lucene.index.ConcurrentMergeScheduler@3a747fa2ramBufferSi=
zeMB
>>> =3D16.0
>>> > maxBufferedDocs=3D-1 maxBuffereDeleteTerms=3D-1
>>> > maxFieldLength=3D2147483647 index=3D
>>> > IW 0 [Indexer]: setRAMBufferSizeMB 910.25
>>> > IW 0 [Indexer]: setMaxBufferedDocs 1000000
>>> > IW 0 [Indexer]: flush at getReader
>>> > IW 0 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3Dnull
>>> docStoreOffset=3D0
>>> > flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numDocs=
=3D0
>>> > numBufDelTerms=3D0
>>> > IW 0 [Indexer]: =A0 index before flush
>>> > IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D886.463
>>> allocMB=3D886.463
>>> > deletesMB=3D23.803 triggerMB=3D910.25
>>> > IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_0 docStoreSegment=3D_0
>>> > docStoreOffset=3D0 flushDocs=3Dtrue flushDeletes=3Dfalse flushDocStor=
es=3Dfalse
>>> > numDocs=3D171638 numBufDelTerms=3D171638
>>> > IW 0 [UpdWriterBuild]: =A0 index before flush
>>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _0 numDocs=3D171=
638
>>> > IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D929523712
>>> newFlushedSize=3D573198529
>>> > docs/MB=3D313.985 new/old=3D61.666%
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
>>> > IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 1 segment=
s
>>> > IW 0 [UpdWriterBuild]: CMS: now merge
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D857.977
>>> allocMB=3D901.32
>>> > deletesMB=3D52.274 triggerMB=3D910.25
>>> > IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_1 docStoreSegment=3D_0
>>> > docStoreOffset=3D171638 flushDocs=3Dtrue flushDeletes=3Dfalse
>>> flushDocStores=3Dfalse
>>> > numDocs=3D204995 numBufDelTerms=3D204995
>>> > IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0
>>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _1 numDocs=3D204=
995
>>> > IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D899653632
>>> newFlushedSize=3D544283851
>>> > docs/MB=3D394.928 new/old=3D60.499%
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
>>> > IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 2 segment=
s
>>> > IW 0 [UpdWriterBuild]: CMS: now merge
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [UpdWriterBuild]: DW: =A0 RAM: now balance allocations:
>>> usedMB=3D834.645 vs
>>> > trigger=3D910.25 allocMB=3D901.32 deletesMB=3D75.627 vs trigger=3D955=
.762
>>> > byteBlockFree=3D35.938 charBlockFree=3D8.938
>>> > IW 0 [UpdWriterBuild]: DW: =A0 =A0 nothing to free
>>> > IW 0 [UpdWriterBuild]: DW: =A0 =A0 after free: freedMB=3D66.613 usedM=
B=3D910.272
>>> > allocMB=3D834.707
>>> > IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_2 docStoreSegment=3D_0
>>> > docStoreOffset=3D376633 flushDocs=3Dtrue flushDeletes=3Dfalse
>>> flushDocStores=3Dfalse
>>> > numDocs=3D168236 numBufDelTerms=3D168236
>>> > IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0
>>> _1:C204995->_0
>>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _2 numDocs=3D168=
236
>>> > IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D875188224
>>> newFlushedSize=3D530720464
>>> > docs/MB=3D332.394 new/old=3D60.641%
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
>>> > IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 3 segment=
s
>>> > IW 0 [UpdWriterBuild]: CMS: now merge
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D814.282
>>> allocMB=3D835.832
>>> > deletesMB=3D95.997 triggerMB=3D910.25
>>> > IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_3 docStoreSegment=3D_0
>>> > docStoreOffset=3D544869 flushDocs=3Dtrue flushDeletes=3Dfalse
>>> flushDocStores=3Dfalse
>>> > numDocs=3D146894 numBufDelTerms=3D146894
>>> > IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0
>>> _1:C204995->_0
>>> > _2:C168236->_0
>>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _3 numDocs=3D146=
894
>>> > IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D853836800
>>> newFlushedSize=3D522388771
>>> > docs/MB=3D294.856 new/old=3D61.181%
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
>>> > IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 4 segment=
s
>>> > IW 0 [UpdWriterBuild]: CMS: now merge
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [UpdWriterBuild]: DW: =A0 RAM: now flush @ usedMB=3D791.724
>>> allocMB=3D835.832
>>> > deletesMB=3D118.535 triggerMB=3D910.25
>>> > IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_4 docStoreSegment=3D_0
>>> > docStoreOffset=3D691763 flushDocs=3Dtrue flushDeletes=3Dfalse
>>> flushDocStores=3Dfalse
>>> > numDocs=3D162034 numBufDelTerms=3D162034
>>> > IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0
>>> _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0
>>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _4 numDocs=3D162=
034
>>> > IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D830182400
>>> newFlushedSize=3D498741034
>>> > docs/MB=3D340.668 new/old=3D60.076%
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
>>> > IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 5 segment=
s
>>> > IW 0 [UpdWriterBuild]: CMS: now merge
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [UpdWriterBuild]: DW: =A0 RAM: now balance allocations:
>>> usedMB=3D771.396 vs
>>> > trigger=3D910.25 allocMB=3D835.832 deletesMB=3D138.875 vs trigger=3D9=
55.762
>>> > byteBlockFree=3D39.688 charBlockFree=3D7.188
>>> > IW 0 [UpdWriterBuild]: DW: =A0 =A0 nothing to free
>>> > IW 0 [UpdWriterBuild]: DW: =A0 =A0 after free: freedMB=3D64.374 usedM=
B=3D910.271
>>> > allocMB=3D771.458
>>> > IW 0 [UpdWriterBuild]: =A0 flush: segment=3D_5 docStoreSegment=3D_0
>>> > docStoreOffset=3D853797 flushDocs=3Dtrue flushDeletes=3Dfalse
>>> flushDocStores=3Dfalse
>>> > numDocs=3D146250 numBufDelTerms=3D146250
>>> > IW 0 [UpdWriterBuild]: =A0 index before flush _0:C171638->_0
>>> _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
>>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _5 numDocs=3D146=
250
>>> > IW 0 [UpdWriterBuild]: DW: =A0 oldRAMSize=3D808866816
>>> newFlushedSize=3D485212402
>>> > docs/MB=3D316.056 new/old=3D59.987%
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCom=
mit
>>> =3D
>>> > false]
>>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
>>> > IW 0 [UpdWriterBuild]: LMP: =A0 level 8.008305 to 8.758305: 6 segment=
s
>>> > IW 0 [UpdWriterBuild]: CMS: now merge
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> > IW 0 [UpdWriterBuild]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [Indexer]: commit: start
>>> > IW 0 [Indexer]: commit: now prepare
>>> > IW 0 [Indexer]: prepareCommit: flush
>>> > IW 0 [Indexer]: =A0 flush: segment=3D_6 docStoreSegment=3D_0
>>> > docStoreOffset=3D1000047 flushDocs=3Dtrue flushDeletes=3Dtrue
>>> flushDocStores=3Dtrue
>>> > numDocs=3D76978 numBufDelTerms=3D76978
>>> > IW 0 [Indexer]: =A0 index before flush _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> > IW 0 [Indexer]: =A0 flush shared docStore segment _0
>>> > IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
>>> > numDocs=3D1077025
>>> > IW 0 [Indexer]: DW: flush postings as segment _6 numDocs=3D76978
>>> > IW 0 [Indexer]: DW: =A0 oldRAMSize=3D486968320 newFlushedSize=3D27316=
8136
>>> > docs/MB=3D295.486 new/old=3D56.096%
>>> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =3D
>>> false]
>>> > IW 0 [Indexer]: DW: apply 1077025 buffered deleted terms and 0 delete=
d
>>> > docIDs and 0 deleted queries on 7 segments.
>>> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =3D
>>> false]
>>> > IW 0 [Indexer]: LMP: findMerges: 7 segments
>>> > IW 0 [Indexer]: LMP: =A0 level 8.008305 to 8.758305: 7 segments
>>> > IW 0 [Indexer]: CMS: now merge
>>> > IW 0 [Indexer]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> _2:C168236->_0
>>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>>> > IW 0 [Indexer]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [Indexer]: startCommit(): start sizeInBytes=3D0
>>> > IW 0 [Indexer]: startCommit index=3D_0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > changeCount=3D21
>>> > IW 0 [Indexer]: now sync _0.tis
>>> > IW 0 [Indexer]: now sync _5.prx
>>> > IW 0 [Indexer]: now sync _3.frq
>>> > IW 0 [Indexer]: now sync _3.tii
>>> > IW 0 [Indexer]: now sync _1.frq
>>> > IW 0 [Indexer]: now sync _6.frq
>>> > IW 0 [Indexer]: now sync _4.prx
>>> > IW 0 [Indexer]: now sync _4.fnm
>>> > IW 0 [Indexer]: now sync _2.tii
>>> > IW 0 [Indexer]: now sync _3.fnm
>>> > IW 0 [Indexer]: now sync _1.fnm
>>> > IW 0 [Indexer]: now sync _6.tis
>>> > IW 0 [Indexer]: now sync _4.frq
>>> > IW 0 [Indexer]: now sync _5.nrm
>>> > IW 0 [Indexer]: now sync _5.tis
>>> > IW 0 [Indexer]: now sync _1.tii
>>> > IW 0 [Indexer]: now sync _4.tis
>>> > IW 0 [Indexer]: now sync _0.prx
>>> > IW 0 [Indexer]: now sync _3.nrm
>>> > IW 0 [Indexer]: now sync _4.tii
>>> > IW 0 [Indexer]: now sync _0.nrm
>>> > IW 0 [Indexer]: now sync _5.fnm
>>> > IW 0 [Indexer]: now sync _1.tis
>>> > IW 0 [Indexer]: now sync _0.fnm
>>> > IW 0 [Indexer]: now sync _2.prx
>>> > IW 0 [Indexer]: now sync _6.tii
>>> > IW 0 [Indexer]: now sync _4.nrm
>>> > IW 0 [Indexer]: now sync _2.frq
>>> > IW 0 [Indexer]: now sync _5.frq
>>> > IW 0 [Indexer]: now sync _3.prx
>>> > IW 0 [Indexer]: now sync _5.tii
>>> > IW 0 [Indexer]: now sync _2.fnm
>>> > IW 0 [Indexer]: now sync _1.prx
>>> > IW 0 [Indexer]: now sync _2.tis
>>> > IW 0 [Indexer]: now sync _0.tii
>>> > IW 0 [Indexer]: now sync _6.prx
>>> > IW 0 [Indexer]: now sync _0.frq
>>> > IW 0 [Indexer]: now sync _6.fnm
>>> > IW 0 [Indexer]: now sync _0.fdx
>>> > IW 0 [Indexer]: now sync _6.nrm
>>> > IW 0 [Indexer]: now sync _0.fdt
>>> > IW 0 [Indexer]: now sync _1.nrm
>>> > IW 0 [Indexer]: now sync _2.nrm
>>> > IW 0 [Indexer]: now sync _3.tis
>>> > IW 0 [Indexer]: done all syncs
>>> > IW 0 [Indexer]: commit: pendingCommit !=3D null
>>> > IW 0 [Indexer]: commit: wrote segments file "segments_2"
>>> > IFD [Indexer]: now checkpoint "segments_2" [7 segments ; isCommit =3D
>>> true]
>>> > IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
>>> > IFD [Indexer]: delete "segments_1"
>>> > IW 0 [Indexer]: commit: done
>>> > IW 0 [Indexer]: optimize: index now _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > IW 0 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3D_6
>>> docStoreOffset=3D0
>>> > flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numDocs=
=3D0
>>> > numBufDelTerms=3D0
>>> > IW 0 [Indexer]: =A0 index before flush _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > IW 0 [Indexer]: add merge to pendingMerges: _0:C171638->_0
>>> _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > [optimize] [total 1 pending]
>>> > IW 0 [Indexer]: CMS: now merge
>>> > IW 0 [Indexer]: CMS: =A0 index: _0:C171638->_0 _1:C204995->_0
>>> _2:C168236->_0
>>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>>> > IW 0 [Indexer]: CMS: =A0 consider merge _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > into _7 [optimize]
>>> > IW 0 [Indexer]: CMS: =A0 =A0 launch new thread [Lucene Merge Thread #=
0]
>>> > IW 0 [Indexer]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [Lucene Merge Thread #0]: CMS: =A0 merge thread: start
>>> > IW 0 [Lucene Merge Thread #0]: now merge
>>> > =A0merge=3D_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_=
0
>>> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0 into _7 [optimize]
>>> > =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@78688954
>>> > =A0index=3D_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_=
0
>>> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>>> > IW 0 [Lucene Merge Thread #0]: merging _0:C171638->_0 _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > into _7 [optimize]
>>> > IW 0 [Lucene Merge Thread #0]: merge: total 1077025 docs
>>> > IW 0 [Lucene Merge Thread #0]: commitMerge: _0:C171638->_0
>>> _1:C204995->_0
>>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
>>> _6:C76978->_0
>>> > into _7 [optimize] index=3D_0:C171638->_0 _1:C204995->_0 _2:C168236->=
_0
>>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
>>> > IW 0 [Lucene Merge Thread #0]: commitMergeDeletes _0:C171638->_0
>>> > _1:C204995->_0 _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
>>> _5:C146250->_0
>>> > _6:C76978->_0 into _7 [optimize]
>>> > IFD [Lucene Merge Thread #0]: now checkpoint "segments_2" [1 segments=
 ;
>>> > isCommit =3D false]
>>> > IW 0 [Lucene Merge Thread #0]: CMS: =A0 merge thread: done
>>> > IW 0 [Indexer]: now flush at close
>>> > IW 0 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3D_6
>>> docStoreOffset=3D0
>>> > flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dtrue numDocs=
=3D0
>>> > numBufDelTerms=3D0
>>> > IW 0 [Indexer]: =A0 index before flush _7:C1077025->_0
>>> > IW 0 [Indexer]: =A0 flush shared docStore segment _6
>>> > IW 0 [Indexer]: DW: closeDocStore: 0 files to flush to segment _6
>>> numDocs=3D0
>>> > IW 0 [Indexer]: CMS: now merge
>>> > IW 0 [Indexer]: CMS: =A0 index: _7:C1077025->_0
>>> > IW 0 [Indexer]: CMS: =A0 no more merges pending; now return
>>> > IW 0 [Indexer]: now call final commit()
>>> > IW 0 [Indexer]: startCommit(): start sizeInBytes=3D0
>>> > IW 0 [Indexer]: startCommit index=3D_7:C1077025->_0 changeCount=3D23
>>> > IW 0 [Indexer]: now sync _7.prx
>>> > IW 0 [Indexer]: now sync _7.fnm
>>> > IW 0 [Indexer]: now sync _7.tis
>>> > IW 0 [Indexer]: now sync _7.nrm
>>> > IW 0 [Indexer]: now sync _7.tii
>>> > IW 0 [Indexer]: now sync _7.frq
>>> > IW 0 [Indexer]: done all syncs
>>> > IW 0 [Indexer]: commit: pendingCommit !=3D null
>>> > IW 0 [Indexer]: commit: wrote segments file "segments_3"
>>> > IFD [Indexer]: now checkpoint "segments_3" [1 segments ; isCommit =3D
>>> true]
>>> > IFD [Indexer]: deleteCommits: now decRef commit "segments_2"
>>> > IFD [Indexer]: delete "_0.tis"
>>> > IFD [Indexer]: delete "_5.prx"
>>> > IFD [Indexer]: delete "_3.tii"
>>> > IFD [Indexer]: delete "_3.frq"
>>> > IFD [Indexer]: delete "_1.frq"
>>> > IFD [Indexer]: delete "_6.frq"
>>> > IFD [Indexer]: delete "_4.prx"
>>> > IFD [Indexer]: delete "_4.fnm"
>>> > IFD [Indexer]: delete "_2.tii"
>>> > IFD [Indexer]: delete "_3.fnm"
>>> > IFD [Indexer]: delete "_1.fnm"
>>> > IFD [Indexer]: delete "_6.tis"
>>> > IFD [Indexer]: delete "_4.frq"
>>> > IFD [Indexer]: delete "_5.nrm"
>>> > IFD [Indexer]: delete "_5.tis"
>>> > IFD [Indexer]: delete "_1.tii"
>>> > IFD [Indexer]: delete "_4.tis"
>>> > IFD [Indexer]: delete "_0.prx"
>>> > IFD [Indexer]: delete "_3.nrm"
>>> > IFD [Indexer]: delete "_4.tii"
>>> > IFD [Indexer]: delete "_0.nrm"
>>> > IFD [Indexer]: delete "_5.fnm"
>>> > IFD [Indexer]: delete "_1.tis"
>>> > IFD [Indexer]: delete "_0.fnm"
>>> > IFD [Indexer]: delete "_2.prx"
>>> > IFD [Indexer]: delete "_6.tii"
>>> > IFD [Indexer]: delete "_4.nrm"
>>> > IFD [Indexer]: delete "_2.frq"
>>> > IFD [Indexer]: delete "_5.frq"
>>> > IFD [Indexer]: delete "_3.prx"
>>> > IFD [Indexer]: delete "_5.tii"
>>> > IFD [Indexer]: delete "_2.fnm"
>>> > IFD [Indexer]: delete "_1.prx"
>>> > IFD [Indexer]: delete "_2.tis"
>>> > IFD [Indexer]: delete "_0.tii"
>>> > IFD [Indexer]: delete "_6.prx"
>>> > IFD [Indexer]: delete "_0.frq"
>>> > IFD [Indexer]: delete "segments_2"
>>> > IFD [Indexer]: delete "_6.fnm"
>>> > IFD [Indexer]: delete "_6.nrm"
>>> > IFD [Indexer]: delete "_1.nrm"
>>> > IFD [Indexer]: delete "_2.nrm"
>>> > IFD [Indexer]: delete "_3.tis"
>>> > IW 0 [Indexer]: commit: done
>>> > IW 0 [Indexer]: at close: _7:C1077025->_0
>>> >
>>> > I see no errors.
>>> > Peter
>>> >
>>> >
>>> > On Tue, Oct 27, 2009 at 10:44 AM, Peter Keegan <peterlkeegan@gmail.co=
m
>>> >wrote:
>>> >
>>> >>
>>> >>
>>> >> On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
>>> >> lucene@mikemccandless.com> wrote:
>>> >>
>>> >>> OK that exception looks more reasonable, for a disk full event.
>>> >>>
>>> >>> But, I can't tell from your followon emails: did this lead to index
>>> >>> corruption?
>>> >>>
>>> >>
>>> >> Yes, but this may be caused by the application ignoring a Lucene
>>> exception
>>> >> somewhere else. I will chase this down.
>>> >>
>>> >>>
>>> >>> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) -- y=
ou
>>> >>> really should upgrade that to the latest 1.6.0 -- there's at least =
one
>>> >>> known problem with Lucene and early 1.6.0 JREs.
>>> >>>
>>> >>
>>> >> Yes, I remember this problem - that's why we stayed at _03
>>> >> Thanks.
>>> >>
>>> >>>
>>> >>> Mike
>>> >>>
>>> >>> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <
>>> peterlkeegan@gmail.com>
>>> >>> wrote:
>>> >>> > After rebuilding the corrupted indexes, the low disk space except=
ion
>>> is
>>> >>> now
>>> >>> > occurring as expected. Sorry for the distraction.
>>> >>> >
>>> >>> > fyi, here are the details:
>>> >>> >
>>> >>> > =A0java.io.IOException: There is not enough space on the disk
>>> >>> > =A0 =A0at java.io.RandomAccessFile.writeBytes(Native Method)
>>> >>> > =A0 =A0at java.io.RandomAccessFile.write(Unknown Source)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuff=
er(SimpleFSDirectory.java:192)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOu=
tput.java:96)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.j=
ava:85)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.j=
ava:109)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(Sim=
pleFSDirectory.java:199)
>>> >>> > =A0 =A0at
>>> org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:35=
7)
>>> >>> > =A0 =A0at
>>> >>> org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
>>> >>> > =A0 =A0at
>>> >>> >
>>> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
>>> >>> > =A0 =A0at
>>> org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter=
.java:3786)
>>> >>> > =A0 =A0at
>>> >>> >
>>> >>>
>>> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.ja=
va:3695)
>>> >>> >
>>> >>> >
>>> >>> > And the corresponding index info log:
>>> >>> >
>>> >>> > IFD [Indexer]: setInfoStream
>>> >>> >
>>> >>>
>>> deletionPolicy=3Dorg.apache.lucene.index.KeepOnlyLastCommitDeletionPoli=
cy@256ef705
>>> >>> > IW 1 [Indexer]: setInfoStream:
>>> >>> > dir=3Dorg.apache.lucene.store.SimpleFSDirectory@D
>>> >>> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
>>> >>> > autoCommit=3Dfalse
>>> >>> >
>>> >>>
>>> mergePolicy=3Dorg.apache.lucene.index.LogByteSizeMergePolicy@181b7c76me=
rgeScheduler
>>> >>>
>>> =3Dorg.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSi=
zeMB
>>> >>> =3D16.0
>>> >>> > maxBufferedDocs=3D-1 maxBuffereDeleteTerms=3D-1
>>> >>> > maxFieldLength=3D2147483647 index=3D
>>> >>> > IW 1 [Indexer]: flush at addIndexesNoOptimize
>>> >>> > IW 1 [Indexer]: =A0 flush: segment=3Dnull docStoreSegment=3Dnull
>>> >>> docStoreOffset=3D0
>>> >>> > flushDocs=3Dfalse flushDeletes=3Dtrue flushDocStores=3Dfalse numD=
ocs=3D0
>>> >>> > numBufDelTerms=3D0
>>> >>> > IW 1 [Indexer]: =A0 index before flush
>>> >>> > IW 1 [Indexer]: now start transaction
>>> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>>> >>> > IW 1 [Indexer]: LMP: =A0 level 8.774518 to 9.524518: 1 segments
>>> >>> > IW 1 [Indexer]: LMP: =A0 level 6.2973914 to 7.0473914: 1 segments
>>> >>> > IW 1 [Indexer]: CMS: now merge
>>> >>> > IW 1 [Indexer]: CMS: =A0 index: _7:Cx1075533->_0** _8:Cx2795**
>>> >>> > IW 1 [Indexer]: CMS: =A0 no more merges pending; now return
>>> >>> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0 [tot=
al
>>> 1
>>> >>> > pending]
>>> >>> > IW 1 [Indexer]: now merge
>>> >>> > =A0merge=3D_7:Cx1075533->_0 into _0 [mergeDocStores]
>>> >>> > =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@4d480ea
>>> >>> > =A0index=3D_7:Cx1075533->_0** _8:Cx2795**
>>> >>> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
>>> >>> > IW 1 [Indexer]: merge: total 1074388 docs
>>> >>> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0
>>> [mergeDocStores]
>>> >>> > index=3D_7:Cx1075533->_0** _8:Cx2795**
>>> >>> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
>>> >>> [mergeDocStores]
>>> >>> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit=
 =3D
>>> >>> false]
>>> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
>>> >>> > IW 1 [Indexer]: LMP: =A0 level 8.864886 to 9.614886: 1 segments
>>> >>> > IW 1 [Indexer]: LMP: =A0 level 6.2973914 to 7.0473914: 1 segments
>>> >>> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1
>>> pending]
>>> >>> > IW 1 [Indexer]: now merge
>>> >>> > =A0merge=3D_8:Cx2795 into _1 [mergeDocStores]
>>> >>> > =A0merge=3Dorg.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
>>> >>> > =A0index=3D_0:C1074388 _8:Cx2795**
>>> >>> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
>>> >>> > IW 1 [Indexer]: merge: total 2795 docs
>>> >>> > IW 1 [Indexer]: handleMergeException: merge=3D_8:Cx2795 into _1
>>> >>> > [mergeDocStores] exc=3Djava.io.IOException: There is not enough s=
pace
>>> on
>>> >>> the
>>> >>> > disk
>>> >>> > IW 1 [Indexer]: hit exception during merge
>>> >>> > IFD [Indexer]: refresh [prefix=3D_1]: removing newly created
>>> unreferenced
>>> >>> file
>>> >>> > "_1.fdt"
>>> >>> > IFD [Indexer]: delete "_1.fdt"
>>> >>> > IFD [Indexer]: refresh [prefix=3D_1]: removing newly created
>>> unreferenced
>>> >>> file
>>> >>> > "_1.fdx"
>>> >>> > IFD [Indexer]: delete "_1.fdx"
>>> >>> > IFD [Indexer]: refresh [prefix=3D_1]: removing newly created
>>> unreferenced
>>> >>> file
>>> >>> > "_1.fnm"
>>> >>> > IFD [Indexer]: delete "_1.fnm"
>>> >>> > IW 1 [Indexer]: now rollback transaction
>>> >>> > IW 1 [Indexer]: all running merges have aborted
>>> >>> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit=
 =3D
>>> >>> false]
>>> >>> > IFD [Indexer]: delete "_0.nrm"
>>> >>> > IFD [Indexer]: delete "_0.tis"
>>> >>> > IFD [Indexer]: delete "_0.fnm"
>>> >>> > IFD [Indexer]: delete "_0.tii"
>>> >>> > IFD [Indexer]: delete "_0.frq"
>>> >>> > IFD [Indexer]: delete "_0.fdx"
>>> >>> > IFD [Indexer]: delete "_0.prx"
>>> >>> > IFD [Indexer]: delete "_0.fdt"
>>> >>> >
>>> >>> >
>>> >>> > Peter
>>> >>> >
>>> >>> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <
>>> peterlkeegan@gmail.com
>>> >>> >wrote:
>>> >>> >
>>> >>> >>
>>> >>> >>
>>> >>> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
>>> >>> >> lucene@mikemccandless.com> wrote:
>>> >>> >>
>>> >>> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <
>>> peterlkeegan@gmail.com
>>> >>> >
>>> >>> >>> wrote:
>>> >>> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
>>> >>> >>> > lucene@mikemccandless.com> wrote:
>>> >>> >>> >
>>> >>> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
>>> >>> peterlkeegan@gmail.com
>>> >>> >>> >
>>> >>> >>> >> wrote:
>>> >>> >>> >> > Even running in console mode, the exception is difficult t=
o
>>> >>> >>> interpret.
>>> >>> >>> >> > Here's an exception that I think occurred during an add
>>> document,
>>> >>> >>> commit
>>> >>> >>> >> or
>>> >>> >>> >> > close:
>>> >>> >>> >> > doc counts differ for segment _g: field Reader shows 137 b=
ut
>>> >>> >>> segmentInfo
>>> >>> >>> >> > shows 5777
>>> >>> >>> >>
>>> >>> >>> >> That's spooky. =A0Do you have the full exception for this on=
e?
>>> =A0What
>>> >>> IO
>>> >>> >>> >> system are you running on? =A0(Is it just a local drive on y=
our
>>> >>> windows
>>> >>> >>> >> computer?) It's almost as if the IO system is not generating=
 an
>>> >>> >>> >> IOException to Java when disk fills up.
>>> >>> >>> >>
>>> >>> >>> >
>>> >>> >>> > Index and code are all on a local drive. There is no other
>>> exception
>>> >>> >>> coming
>>> >>> >>> > back - just what I reported.
>>> >>> >>>
>>> >>> >>> But, you didn't report a traceback for this first one?
>>> >>> >>>
>>> >>> >>
>>> >>> >> Yes, I need to add some more printStackTrace calls.
>>> >>> >>
>>> >>> >>
>>> >>> >>>
>>> >>> >>> >> > I ensured that the disk space was low before updating the
>>> index.
>>> >>> >>> >>
>>> >>> >>> >> You mean, to intentionally test the disk-full case?
>>> >>> >>> >>
>>> >>> >>> >
>>> >>> >>> > Yes, that's right.
>>> >>> >>>
>>> >>> >>> OK. =A0Can you turn on IndexWriter's infoStream, get this disk =
full
>>> /
>>> >>> >>> corruption to happen again, and post back the resulting output?
>>> =A0Make
>>> >>> >>> sure your index first passes CheckIndex before starting (so we
>>> don't
>>> >>> >>> begin the test w/ any pre-existing index corruption).
>>> >>> >>>
>>> >>> >>
>>> >>> >> Good point about CheckIndex. =A0I've already found 2 bad ones. I=
 will
>>> >>> build
>>> >>> >> new indexes from scratch. This will take a while.
>>> >>> >>
>>> >>> >>
>>> >>> >>> >> > On another occasion, the exception was:
>>> >>> >>> >> > background merge hit exception: _0:C1080260 _1:C139 _2:C12=
3
>>> >>> _3:C107
>>> >>> >>> >> _4:C126
>>> >>> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
>>> >>> [mergeDocStores]
>>> >>> >>> >>
>>> >>> >>> >> In this case, the SegmentMerger was trying to open this
>>> segment,
>>> >>> but
>>> >>> >>> >> on attempting to read the first int from the fdx (fields ind=
ex)
>>> >>> file
>>> >>> >>> >> for one of the segments, it hit EOF.
>>> >>> >>> >>
>>> >>> >>> >> This is also spooky -- this looks like index corruption, whi=
ch
>>> >>> should
>>> >>> >>> >> never happen on hitting disk full.
>>> >>> >>> >>
>>> >>> >>> >
>>> >>> >>> > That's what I thought, too. Could Lucene be catching the
>>> IOException
>>> >>> and
>>> >>> >>> > turning it into a different exception?
>>> >>> >>>
>>> >>> >>> I think that's unlikely, but I guess possible. =A0We have "disk
>>> full"
>>> >>> >>> tests in the unit tests, that throw an IOException at different
>>> times.
>>> >>> >>>
>>> >>> >>> What exact windows version are you using? =A0The local drive is
>>> NTFS?
>>> >>> >>>
>>> >>> >>
>>> >>> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
>>> >>> >>
>>> >>> >>
>>> >>> >>>
>>> >>> >>> Mike
>>> >>> >>>
>>> >>> >>>
>>> ---------------------------------------------------------------------
>>> >>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >>> >>> For additional commands, e-mail: java-user-help@lucene.apache.o=
rg
>>> >>> >>>
>>> >>> >>>
>>> >>> >>
>>> >>> >
>>> >>>
>>> >>> -------------------------------------------------------------------=
--
>>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >>>
>>> >>>
>>> >>
>>> >
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>
>>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43077-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 09:29:40 2009
Return-Path: <java-user-return-43077-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 41384 invoked from network); 28 Oct 2009 09:29:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 09:29:40 -0000
Received: (qmail 22495 invoked by uid 500); 28 Oct 2009 09:29:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22423 invoked by uid 500); 28 Oct 2009 09:29:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22413 invoked by uid 99); 28 Oct 2009 09:29:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 09:29:38 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [64.202.165.37] (HELO smtpauth13.prod.mesa1.secureserver.net) (64.202.165.37)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 09:29:28 +0000
Received: (qmail 10331 invoked from network); 28 Oct 2009 09:29:05 -0000
Received: from unknown (81.219.54.251)
  by smtpauth13.prod.mesa1.secureserver.net (64.202.165.37) with ESMTP; 28 Oct 2009 09:29:04 -0000
Message-ID: <4AE80EDB.3020801@getopt.org>
Date: Wed, 28 Oct 2009 10:28:59 +0100
From: Andrzej Bialecki <ab@getopt.org>
User-Agent: Thunderbird 2.0.0.23 (Windows/20090812)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: Split single string into several fields?
References: <27b05b490910271550t741a3bbfp7dafd0715a4c5694@mail.gmail.com> 	<359a92830910271617j40fd9ad6w3084e521e15d1652@mail.gmail.com> 	<27b05b490910271744k4abb95b8gbeddfccd04ada9f6@mail.gmail.com> 	<359a92830910271812x6204ab67t58b0b3aa6ffa010b@mail.gmail.com> 	<4b124c310910271821i4b41c10dn76fb429081b990a4@mail.gmail.com> 	<27b05b490910271856i717cd3b2ka255102623dffd95@mail.gmail.com> <8f0ad1f30910271944l5c0b6e8na76e003ff58924f2@mail.gmail.com>
In-Reply-To: <8f0ad1f30910271944l5c0b6e8na76e003ff58924f2@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Robert Muir wrote:
> Will, I think this parsing of documents into different fields, is separate
> and unrelated from lucene's analysis (tokenization)...
> the analysis comes to play once you have a field, and you want to break the
> text into indexable units (words, or entire field as token like your urls).
> 
> i wouldn't suggest make a big complicated analyzer that tries to parse html
> in addition to breaking text into words, I would keep parsing and analysis
> separate.
> then i would handle different fields with different analyzers, i think Erick
> already mentioned PerFieldAnalyzerWrapper, its useful for this.

It's also possible to do the tokenization ahead of time, i.e. before you 
pass the document to IndexWriter. You can construct the TokenStream 
using your own analysis chain, and use Field.setTokenStreamValue() - 
this way you will index exactly the token stream you want, and you can 
even create other fields in the document (or split this token stream 
into several fields).


-- 
Best regards,
Andrzej Bialecki     <><
  ___. ___ ___ ___ _ _   __________________________________
[__ || __|__/|__||\/|  Information Retrieval, Semantic Web
___|||__||  \|  ||  |  Embedded Unix, System Integration
http://www.sigram.com  Contact: info at sigram dot com


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43078-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 09:36:00 2009
Return-Path: <java-user-return-43078-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 43947 invoked from network); 28 Oct 2009 09:36:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 09:36:00 -0000
Received: (qmail 31694 invoked by uid 500); 28 Oct 2009 09:35:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31613 invoked by uid 500); 28 Oct 2009 09:35:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31603 invoked by uid 99); 28 Oct 2009 09:35:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 09:35:57 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 09:35:47 +0000
Received: by yxe30 with SMTP id 30so547804yxe.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 02:35:24 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.239.15 with SMTP id m15mr7407804ybh.109.1256722524192; 
	Wed, 28 Oct 2009 02:35:24 -0700 (PDT)
In-Reply-To: <b14c25870910271734w112b5ea2k166ed5d9d84d5c11@mail.gmail.com>
References: <b14c25870910271734w112b5ea2k166ed5d9d84d5c11@mail.gmail.com>
Date: Wed, 28 Oct 2009 05:35:24 -0400
Message-ID: <9ac0c6aa0910280235o2b4231f3n6195490e037e4672@mail.gmail.com>
Subject: Re: SearchFiles demo fails with exception while IndexFiles works
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Are you using an IDE (Eclipse)?  This may help?:

  http://forums.java.net/jive/thread.jspa?messageID=3D363989

Or maybe try building from the command line instead ("ant compile-demo")?

Mike

On Tue, Oct 27, 2009 at 8:34 PM, s rajan <s.rajan09@gmail.com> wrote:
> hi, I am playing with lucene 2.9.0 source build, ant 1.7.1, jdk1.6.0, win=
 XP
> home edition.
> I dont have clover or jFlex installed.
> I built the srcs and ran IndexFiles demo and that worked. However when I =
run
> SearchFiles
> I have an exception that says:
> Exception in thread "main" java.lang.Error: Unresolved compilation proble=
ms:
> =A0 =A0 =A0 =A0The field directory is defined in an inherited type and an=
 enclosing
> sco
> pe
> =A0 =A0 =A0 =A0The field directory is defined in an inherited type and an=
 enclosing
> sco
> pe
> =A0 =A0 =A0 =A0The field directory is defined in an inherited type and an=
 enclosing
> sco
> pe
> =A0 =A0 =A0 =A0at
> org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:71)
> ----------------------------------------
> I run the build again and its the same thing.
> Is there anything else I need to do?
>
> tks,
> -rajan
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43079-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:12:06 2009
Return-Path: <java-user-return-43079-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52514 invoked from network); 28 Oct 2009 10:12:06 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:12:06 -0000
Received: (qmail 74476 invoked by uid 500); 28 Oct 2009 10:12:04 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 74425 invoked by uid 500); 28 Oct 2009 10:12:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 74415 invoked by uid 99); 28 Oct 2009 10:12:04 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:12:04 +0000
X-ASF-Spam-Status: No, hits=-1.9 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [76.13.12.178] (HELO web59608.mail.ac4.yahoo.com) (76.13.12.178)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 10:12:01 +0000
Received: (qmail 72077 invoked by uid 60001); 28 Oct 2009 10:11:40 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256724700; bh=nj8Uz1QzKltz0hoisMJffmmepNTlAZw95Y48GYwrWF8=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=k4+cJ5GgEBF2GNnIQdDZA6V22w42kzWkOAzngPlm6XAIztNxBOJv+R2BHDQLKoLcSNIB36kyn+hr5x63R4EYrztRqEDG1bu9mr9gJJVUW0GhBZJGrzMCU5D+1bCGGBfB6YpF3O2WxH6Eg14jdzhZfGwsoLMcrURfCjhHLgVTjYM=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=QFyFxVSvTUwW6hdW9GdFj2zlidOux22w2Q2+lEcNSYPXOICUAUjac+OC/NtziG8a9HCZDDzBkhm65FcU/4KccNOKMuvKcibBLm5oP9BXyIyxGHOSLjS1czkUAbYSIWZ3qQc11Cxt2aWEJxs3DYTNO2VmsUijHjQQK8lOheqU4GM=;
Message-ID: <431369.69950.qm@web59608.mail.ac4.yahoo.com>
X-YMail-OSG: 2Ux99MsVM1mhoedh2RTKrmqNefQVwT2MIh3XuWIqAGatZMSUGpHF5Us7i.1dctcDiaAReMFTZxuoWb4JTS_RJ60T29RM7hdeJ_hUvajm.eHbUAEBJ92MWsIAtGuvm5Pp3YWLLxZHAQJVv57QxUKaMx_CkDS4Jv.j2CDWcUIwWRnkigGyNk8aUSBZJGLiqTjg3mCzLRXwbJpNIOgtKIWpxD7maOZBCViIlMS4D7PFeeetXcwvaRMIPuieW5xNpG5PYx39WjfTbFs9ETYGo_vf54IIPyhpmAGkMo0ujw--
Received: from [59.90.244.83] by web59608.mail.ac4.yahoo.com via HTTP; Wed, 28 Oct 2009 03:11:40 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Wed, 28 Oct 2009 03:11:40 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: how to extract text from the result document in lucene search
To: java user <java-user@lucene.apache.org>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-949455669-1256724700=:69950"

--0-949455669-1256724700=:69950
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi
=A0
Am a beginner in using lucene. I succeeded in running the demo files of luc=
ene and found the concept.=20
=A0
When we execute the SearchFiles.java file in the demo folder, am getting th=
e names of the documents containing the given query string. Is it possible =
to display some portions of the text containing that query string from the =
corresponding documents????? [as a google response].
=A0
can anyone help me in this context
=A0
Thanks in advance.
Dhivya=0A=0A=0A      
--0-949455669-1256724700=:69950--

From java-user-return-43080-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:23:51 2009
Return-Path: <java-user-return-43080-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 56730 invoked from network); 28 Oct 2009 10:23:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:23:51 -0000
Received: (qmail 87395 invoked by uid 500); 28 Oct 2009 10:23:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 87314 invoked by uid 500); 28 Oct 2009 10:23:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 87304 invoked by uid 99); 28 Oct 2009 10:23:49 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:23:49 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of benhei@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:23:41 +0000
Received: by bwz22 with SMTP id 22so848390bwz.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 03:23:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=lIv/zTNdkaBN55tJTiomPdynQ2irONJ/hKRSrWk/YOg=;
        b=KIQONgRgMWnpPIyBj7KLoYho4ody7wNwro6bS+l5gBP/MJPyffH1m1jO3mkk2O0e3A
         DEj8pHF0S9i6lOG86OAJe+csfCWIpPkXod/J4ElzIs9wsa5LSxwD8BAkiBbrNCX9O8AF
         Opf79aRzFQ+n4t7Dv3MbHVgv/cmewI455dAjk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=KYYog/BSzsb2yLqWelE2gXZil+tkmh1JWa4nV20Br8jv2lpSJu5QkcV/fbqEGlLbya
         J3rSkCnoluCZ3ZfMP7ztAp+OUVvZW3O6Cj3UditjqjvkBDjnWdt9Xo6TYNAVx7sY2G+Z
         AOdrVlYs+qwEnaS8Yna8RyyHnnVebVfrG3snE=
MIME-Version: 1.0
Received: by 10.204.2.73 with SMTP id 9mr3996389bki.159.1256725401132; Wed, 28 
	Oct 2009 03:23:21 -0700 (PDT)
In-Reply-To: <431369.69950.qm@web59608.mail.ac4.yahoo.com>
References: <431369.69950.qm@web59608.mail.ac4.yahoo.com>
Date: Wed, 28 Oct 2009 11:23:21 +0100
Message-ID: <94095f520910280323l7a82d402v99405dea8deea092@mail.gmail.com>
Subject: Re: how to extract text from the result document in lucene search
From: Benjamin Heilbrunn <benhei@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0015174c45801d71900476fc2f89
X-Virus-Checked: Checked by ClamAV on apache.org

--0015174c45801d71900476fc2f89
Content-Type: text/plain; charset=ISO-8859-1

Hello Dhivya,

i'm not familiar with the Lucene Demos.
But for Highlighting take a look at
http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html

Best regards
Benjamin

--0015174c45801d71900476fc2f89--

From java-user-return-43081-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:34:29 2009
Return-Path: <java-user-return-43081-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 59576 invoked from network); 28 Oct 2009 10:34:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:34:29 -0000
Received: (qmail 99585 invoked by uid 500); 28 Oct 2009 10:34:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 99506 invoked by uid 500); 28 Oct 2009 10:34:27 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 99496 invoked by uid 99); 28 Oct 2009 10:34:27 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:34:27 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [76.13.12.208] (HELO web59613.mail.ac4.yahoo.com) (76.13.12.208)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 10:34:17 +0000
Received: (qmail 71452 invoked by uid 60001); 28 Oct 2009 10:33:56 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256726036; bh=2UoW+JLqi2RxxbvKGNBmgKQsfgGguLu2YdDF/0e4ylw=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=juEHFAHJ6Wxnl1z3ZoZWJbm7DQkodXj1koXnoBbNvDH/nmklnKYgq06c0Pr57Qt5b7rEI/Ob0fs7RFlUwgpII34XOFyFVI23KTktIMA+JNVnsm6gdbNwsdTSHbYxUwwV3jwtrW5RhtyuwI1T5AGQBw3VJHyd4NoPrb17w6z9PaQ=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=KVnvYc6QZa848xGIt2NGFPV/zRlZ6ZjSY7SmhZXIBpsoodxPjlOt1vU4nrzTNzibOfCrSdgTAUo+EvNuFgPepMzyahAzcONJiQDb0z7r2YNZvsztrgrvmJ84RqSlIX6tAoz2B4EyjYLPz4mPq9YHWtjvKmZJogluZy4DqrcB/SQ=;
Message-ID: <176153.70107.qm@web59613.mail.ac4.yahoo.com>
X-YMail-OSG: JyAMU0QVM1lgcKjJsbdcwA3OLrPkKJjm0A5ICmjdFmrnasETP8Q51WeNpYrltNnOWYrR0zu5k.NC_Dx8OzAK7jMTMyuEvslZML95PJEqZX4_1mC14_i1PWMVlJWdTr2mpC.GlcURdOTPLlkKMdZFLw6RK8fRFd1_kYUMG1Qm2pL1Rk8cU9gqxbcFC1jPvMdwqAPYsorRk2dp7mi0XArwP1xCDeM3Fgqa6TUW5iV8mg9KIUwiBoa7Zwgh_Zpe2x3GJqBwRHW55RLfG4Eac86Y.GGWKx_h3p_Kp_FnLcYr68PTQw6cj8T6Jeg2tGiC_ImIsy.dmt9X
Received: from [59.90.244.83] by web59613.mail.ac4.yahoo.com via HTTP; Wed, 28 Oct 2009 03:33:56 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Wed, 28 Oct 2009 03:33:56 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
In-Reply-To: <94095f520910280323l7a82d402v99405dea8deea092@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1261730700-1256726036=:70107"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-1261730700-1256726036=:70107
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Thats exactly matching my need sir.
Thanx a lot=20
But is=A0this highlighter in lucene 2.4.0?

--- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:


From: Benjamin Heilbrunn <benhei@gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Date: Wednesday, October 28, 2009, 10:23 AM


Hello Dhivya,

i'm not familiar with the Lucene Demos.
But for Highlighting take a look at
http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html

Best regards
Benjamin
=0A=0A=0A      
--0-1261730700-1256726036=:70107--

From java-user-return-43082-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:45:35 2009
Return-Path: <java-user-return-43082-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 62274 invoked from network); 28 Oct 2009 10:45:35 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:45:35 -0000
Received: (qmail 11141 invoked by uid 500); 28 Oct 2009 10:45:33 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11065 invoked by uid 500); 28 Oct 2009 10:45:33 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11055 invoked by uid 99); 28 Oct 2009 10:45:33 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:45:33 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of pcdinh@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:45:25 +0000
Received: by ywh13 with SMTP id 13so578553ywh.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 03:45:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=UHGKZH39eqEAdgvL/VoRBnLpF347lSp7sj1MTXSdmRk=;
        b=gkezP+5mOfCsVfO2DCymMqsU7rycT85T3AlmP5tFic08J55Go9HmyraIkGPUfTJqBU
         iPT8/KFXQWSRdGfyROeD65dGrbYyHIhYUeTEzGx0QUH7lgXxDMvsOUXa9ttRGG3wW9qK
         6E0wVLuPpbKMEoU+79PeXmeFBeE2qOr9FnK+g=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=J2DZQGv7DGJh3fFLj0yPeJVh+QAj2Ib2iMENxXjB5sDvVfD7j3xjSd39uW00dRCc8h
         5qhrrR5Mr3oLh+4iPx0G4HPUJk5JQOIDQuhkoXqKxfXn3BdGvTOI441WZROrd9nn7t0r
         reKufjiXg9kCg4El2nYC1omEFCtgW19Nn+7PA=
MIME-Version: 1.0
Received: by 10.150.45.37 with SMTP id s37mr28679247ybs.281.1256726704789; 
	Wed, 28 Oct 2009 03:45:04 -0700 (PDT)
Date: Wed, 28 Oct 2009 17:45:04 +0700
Message-ID: <27ff0e30910280345y815d2d9k91f986fe9e0eb5de@mail.gmail.com>
Subject: deleteDocuments() does not work
From: Dinh <pcdinh@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd374f8d1980b0476fc7c15
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd374f8d1980b0476fc7c15
Content-Type: text/plain; charset=ISO-8859-1

Hi all,

I have a very simple method to delete a document that is indexed before

    /**
     * @param id
     */
    public void deleteById(String id) throws IOException {
        IndexWriter writer = IndexWriterFactory.factory();

        try {
            writer.deleteDocuments(new Term(Configuration.Field.ID,
String.valueOf(id)));
            writer.commit();
        } catch (ArrayIndexOutOfBoundsException e) {
            // CHECK ignore this. Can happen if index has not been built yet
        } catch (IOException e) {
            System.out.println(e);
        }
    }

The problem is after executing this method without any exception, I come
back and try to do a search the supposed-to-be-deleted record is still
there. I need to restart my servlet engine to have that record been really
deleted. How can it happen?

Thanks

Dinh

--000e0cd374f8d1980b0476fc7c15--

From java-user-return-43083-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:50:29 2009
Return-Path: <java-user-return-43083-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63575 invoked from network); 28 Oct 2009 10:50:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:50:29 -0000
Received: (qmail 16263 invoked by uid 500); 28 Oct 2009 10:50:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16185 invoked by uid 500); 28 Oct 2009 10:50:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16175 invoked by uid 99); 28 Oct 2009 10:50:26 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:50:26 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:50:24 +0000
Received: by pxi3 with SMTP id 3so491305pxi.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 03:50:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=ZbSThzU43fctAbvE0k64a9xNBYvY2cyG0IG7YeBxlfQ=;
        b=KN7CHCUgCQP8y57Lig61PsrK1FnPAcVDoGyazhAVQQoWmuaaeX6VJsN1Jh4r99JtLA
         R3bmLLEPUbqRHUox/R/14rs89s44Q4uxoT5CFiefZV69fCjr9oihNVD7IAhwLPQSBjsz
         eONcJJ6ziwhyt1O0VQ+9aTV5I61wMnaxN5eO0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=VoVh4Tl8SWZRU+zKaoh5/9LkZnvPt8vazCHRgghjKikVKzLv4cIQxOgCr2IPgldFgG
         K/3Oi6bmc6DfTcBypi/z+sF4IPpSca1Wye3f030OXULDwo4D8SW722WuCcze05TsXMtK
         sIx3A0QFjGUeuY76zR8cRoY+hl/1hgvVAP0qQ=
MIME-Version: 1.0
Received: by 10.115.67.24 with SMTP id u24mr14308107wak.59.1256727003108; Wed, 
	28 Oct 2009 03:50:03 -0700 (PDT)
In-Reply-To: <27ff0e30910280345y815d2d9k91f986fe9e0eb5de@mail.gmail.com>
References: <27ff0e30910280345y815d2d9k91f986fe9e0eb5de@mail.gmail.com>
From: Anshum <anshumg@gmail.com>
Date: Wed, 28 Oct 2009 16:19:43 +0530
Message-ID: <867513fe0910280349j5585b568s72467419d8d8ead3@mail.gmail.com>
Subject: Re: deleteDocuments() does not work
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64946d899968f0476fc8e03

--0016e64946d899968f0476fc8e03
Content-Type: text/plain; charset=ISO-8859-1

Hi Dinh,
Is it that your engine keeps an IndexSearcher[Reader] open all through this
while? For the deleted document to actually reflect in the search (service),
you'd need to reload the index searcher with the latest version.
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:15 PM, Dinh <pcdinh@gmail.com> wrote:

> Hi all,
>
> I have a very simple method to delete a document that is indexed before
>
>    /**
>     * @param id
>     */
>    public void deleteById(String id) throws IOException {
>        IndexWriter writer = IndexWriterFactory.factory();
>
>        try {
>            writer.deleteDocuments(new Term(Configuration.Field.ID,
> String.valueOf(id)));
>            writer.commit();
>        } catch (ArrayIndexOutOfBoundsException e) {
>            // CHECK ignore this. Can happen if index has not been built yet
>        } catch (IOException e) {
>            System.out.println(e);
>        }
>    }
>
> The problem is after executing this method without any exception, I come
> back and try to do a search the supposed-to-be-deleted record is still
> there. I need to restart my servlet engine to have that record been really
> deleted. How can it happen?
>
> Thanks
>
> Dinh
>

--0016e64946d899968f0476fc8e03--

From java-user-return-43084-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:51:52 2009
Return-Path: <java-user-return-43084-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63737 invoked from network); 28 Oct 2009 10:51:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:51:52 -0000
Received: (qmail 19496 invoked by uid 500); 28 Oct 2009 10:51:49 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19416 invoked by uid 500); 28 Oct 2009 10:51:49 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19406 invoked by uid 99); 28 Oct 2009 10:51:49 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:51:49 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:51:47 +0000
Received: by pxi3 with SMTP id 3so491991pxi.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 03:51:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=Of2va+HmZzpDIJOVNvYQtl09YbCad2atSQJNBksx95M=;
        b=aEsuStVkc4836o/dFw3guH2vas9K5eHq0wpWU5HLGC0nJ/o/VE87q1K7K0/FIU/Sbg
         +nw7KQqpxrXEuMKBDPbIBDpca1ieoK9BkNStL1YwnqY9oUdQOzW2gaiPPoQWiI06K1vj
         M9o4lnsKlMFC55xGLQKHtS5B/cYT9OhbluwX0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=wtFH/UcFGGNb6Sq3xnYTHGzr1a4yqXH6UWUwKOPURvHKxYsFy21EaQIAraDz3dXS/s
         tNkpUc3ey34XLZYMIhqiMxFGpOSwJLvVDpVTmp2ZpvKL/yJCgBuYnCdd7nAvVhv8ceYo
         9k0zv3SQelvOHYiydf2536c5+7detvSG781mQ=
MIME-Version: 1.0
Received: by 10.115.61.16 with SMTP id o16mr6310202wak.15.1256727087091; Wed, 
	28 Oct 2009 03:51:27 -0700 (PDT)
In-Reply-To: <176153.70107.qm@web59613.mail.ac4.yahoo.com>
References: <94095f520910280323l7a82d402v99405dea8deea092@mail.gmail.com> 
	<176153.70107.qm@web59613.mail.ac4.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Wed, 28 Oct 2009 16:21:07 +0530
Message-ID: <867513fe0910280351u15ab8c3dne0a5d619c46894cc@mail.gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64beb029b127a0476fc93c3

--0016e64beb029b127a0476fc93c3
Content-Type: text/plain; charset=ISO-8859-1

Yes Dhivya, there's a highlighter in the contrib for 2.4 as well.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:03 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Thats exactly matching my need sir.
> Thanx a lot
> But is this highlighter in lucene 2.4.0?
>
> --- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:
>
>
> From: Benjamin Heilbrunn <benhei@gmail.com>
> Subject: Re: how to extract text from the result document in lucene search
> To: java-user@lucene.apache.org
> Date: Wednesday, October 28, 2009, 10:23 AM
>
>
> Hello Dhivya,
>
> i'm not familiar with the Lucene Demos.
> But for Highlighting take a look at
> http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html
>
> Best regards
> Benjamin
>
>
>
>
>

--0016e64beb029b127a0476fc93c3--

From java-user-return-43085-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 10:54:29 2009
Return-Path: <java-user-return-43085-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64581 invoked from network); 28 Oct 2009 10:54:29 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 10:54:29 -0000
Received: (qmail 27056 invoked by uid 500); 28 Oct 2009 10:54:27 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26989 invoked by uid 500); 28 Oct 2009 10:54:26 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26979 invoked by uid 99); 28 Oct 2009 10:54:26 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 10:54:26 +0000
X-ASF-Spam-Status: No, hits=-2.0 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [76.13.12.148] (HELO web59603.mail.ac4.yahoo.com) (76.13.12.148)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 10:54:24 +0000
Received: (qmail 72869 invoked by uid 60001); 28 Oct 2009 10:54:02 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256727242; bh=hNTmMKcyJdfqbGeSX8/fPiOIXVOSCZ2p/uTa0sfJdA4=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=XzFFWDluVIBe06esc9hTglqdLH50ElXXoYYTAcbFLiCyOs8XH7vXNsfceDc3OdojoyGgX5TRvukxWV93tOkHk+sWqYNRMoLuYS2Eo1WX4P9gkxE/UdFLiyaH5g+NIdc3nf64TC0qeC3ulqcN98EUTBrAnSzgT4aYXHLDJg3VAhQ=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=kD9SpbV+I2m1A3Qxwbq1VhuesvwovWlYgGyZoqCD4mPXqr7MEWCXSAi/HdHb2pkmATBXBoV39mT8a/iCat/m7sbF5xH8cZ2N/EQciA/uQslE2xbWMYGsGCirb/vxWiFiUv3DyeTBlmOqdg4fLDQrILJwjjvqtwXtX/JrsS8O2Ms=;
Message-ID: <633143.72817.qm@web59603.mail.ac4.yahoo.com>
X-YMail-OSG: LTuqTLQVM1nSUgy6iBpib_QFBFY3azXs9M.fuXkw6rv2OTa.FMPS7vakKKrb4owGuR_tEskUCH7i5iVhHrDHi_ccYJvH0jCZnDpRsRwEsqte4RGsLuqi79oVS0N8B7mSwPX.BOSMhNMoY9jflfgR3DnwajrvqQd_sx3VixkoVHp_YrT33Q5UiHyaIOJoHvYEecAqKDpXYU82R9oP7sA8mIOWV5X1FBFuQgKOuufs5yd348kEZYl15BYAa_bfAQtGAQ6U7FOSxEe60n82tQH3e09ZnvKQa.hTcJaCojoDaCZR4n80LJgxvUYjA005diD6DIpugAY2aFs-
Received: from [59.90.244.83] by web59603.mail.ac4.yahoo.com via HTTP; Wed, 28 Oct 2009 03:54:02 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Wed, 28 Oct 2009 03:54:02 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
In-Reply-To: <867513fe0910280351u15ab8c3dne0a5d619c46894cc@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1763155478-1256727242=:72817"

--0-1763155478-1256727242=:72817
Content-Type: text/plain; charset=us-ascii

ya i found sir.
May i know from which version is it available?


--- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:


From: Anshum <anshumg@gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Date: Wednesday, October 28, 2009, 10:51 AM


Yes Dhivya, there's a highlighter in the contrib for 2.4 as well.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:03 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Thats exactly matching my need sir.
> Thanx a lot
> But is this highlighter in lucene 2.4.0?
>
> --- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:
>
>
> From: Benjamin Heilbrunn <benhei@gmail.com>
> Subject: Re: how to extract text from the result document in lucene search
> To: java-user@lucene.apache.org
> Date: Wednesday, October 28, 2009, 10:23 AM
>
>
> Hello Dhivya,
>
> i'm not familiar with the Lucene Demos.
> But for Highlighting take a look at
> http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html
>
> Best regards
> Benjamin
>
>
>
>
>



      
--0-1763155478-1256727242=:72817--

From java-user-return-43086-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:00:21 2009
Return-Path: <java-user-return-43086-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 65626 invoked from network); 28 Oct 2009 11:00:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:00:21 -0000
Received: (qmail 31290 invoked by uid 500); 28 Oct 2009 11:00:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31219 invoked by uid 500); 28 Oct 2009 11:00:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31205 invoked by uid 99); 28 Oct 2009 11:00:19 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:00:19 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:00:16 +0000
Received: by pwi12 with SMTP id 12so778384pwi.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 03:59:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=cG5LLaheeyDlqmRS66HB8w4y7GwrxrSZ1Kpq32TpYcs=;
        b=Q9ldRpypdJqJ0dJ8onzwnQM41NeZGSTq/TN6U/cN38fMEWITv65nXVcPliPXtDRCLM
         uorl+RhTkkUXGSRjsoeJMCH25dsKIBHIAqx9l6a/qlHcp27d1qUplLExuz28ZwfhlpC+
         1S6LM/zKU1ltZE8HkQdt+Woic2HiGrnI3CYBc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=IkL0gUqhJ50TcDYFY7rUMGtzphXSSk8V3PQBS5BUShnOUE4dzNmZ8zslVDzU2X55Jr
         eAlzGZwKqw6sQ3lZ7DkJ2BzKgUIY5VWdQdmR+dj9UqdACaZWr6xLyRX9E56PaaTNGeS7
         9IlkEcosfrghaSG/W41Ek8buh4gapNhifpHgA=
MIME-Version: 1.0
Received: by 10.114.9.6 with SMTP id 6mr8070437wai.35.1256727596092; Wed, 28 
	Oct 2009 03:59:56 -0700 (PDT)
In-Reply-To: <633143.72817.qm@web59603.mail.ac4.yahoo.com>
References: <867513fe0910280351u15ab8c3dne0a5d619c46894cc@mail.gmail.com> 
	<633143.72817.qm@web59603.mail.ac4.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Wed, 28 Oct 2009 16:29:36 +0530
Message-ID: <867513fe0910280359pb0f8a77mc6d12618249377e4@mail.gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502e165f1d4bd0476fcb190

--00504502e165f1d4bd0476fcb190
Content-Type: text/plain; charset=ISO-8859-1

I guess it should be available starting 1.9 onwards and patch-able with a
few changes for even 1.4.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:24 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> ya i found sir.
> May i know from which version is it available?
>
>
> --- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:
>
>
> From: Anshum <anshumg@gmail.com>
> Subject: Re: how to extract text from the result document in lucene search
> To: java-user@lucene.apache.org
> Date: Wednesday, October 28, 2009, 10:51 AM
>
>
> Yes Dhivya, there's a highlighter in the contrib for 2.4 as well.
>
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Wed, Oct 28, 2009 at 4:03 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> >wrote:
>
> > Thats exactly matching my need sir.
> > Thanx a lot
> > But is this highlighter in lucene 2.4.0?
> >
> > --- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:
> >
> >
> > From: Benjamin Heilbrunn <benhei@gmail.com>
> > Subject: Re: how to extract text from the result document in lucene
> search
> > To: java-user@lucene.apache.org
> > Date: Wednesday, October 28, 2009, 10:23 AM
> >
> >
> > Hello Dhivya,
> >
> > i'm not familiar with the Lucene Demos.
> > But for Highlighting take a look at
> > http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html
> >
> > Best regards
> > Benjamin
> >
> >
> >
> >
> >
>
>
>
>
>

--00504502e165f1d4bd0476fcb190--

From java-user-return-43087-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:12:40 2009
Return-Path: <java-user-return-43087-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 70480 invoked from network); 28 Oct 2009 11:12:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:12:40 -0000
Received: (qmail 45079 invoked by uid 500); 28 Oct 2009 11:12:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 44988 invoked by uid 500); 28 Oct 2009 11:12:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 44978 invoked by uid 99); 28 Oct 2009 11:12:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:12:37 +0000
X-ASF-Spam-Status: No, hits=-2.1 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [76.13.12.208] (HELO web59613.mail.ac4.yahoo.com) (76.13.12.208)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 11:12:35 +0000
Received: (qmail 87191 invoked by uid 60001); 28 Oct 2009 11:12:13 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256728333; bh=N91gbTV6s2a70JyxJQyx22hQpQ2fVlB/DC2l4xpqdUU=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=05te9utKibdzYleBQDaHyRUvDE8fYxWljdMKeM6ZFmICKMcixMl2sWsSceFmhswcah9V4dHeYhJy9sQqtv91qncLH1Tn2+nuLxbORfAILgPbD73oqIJGu5yAF3HxD+hZJIwL3twuJLagAQD4f+RBIe5dLWEBLdo6ueddfH4NMK4=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=4+tX0SeyvXBjrHTQ72xtgwTpCwUt4oH3asViEH6sY1NYkELi0bne0+oSm9ip2KAKPA2e3VGWmywUHE6CtZE9kdg7S1qYXK2QvLQwLjRBYEWCBdcnFPOhLIF5u/MAVpALQ9D812Wp6cWFHHlqji5dwJrxKfzCsVKLAV84sgtxSac=;
Message-ID: <642737.86669.qm@web59613.mail.ac4.yahoo.com>
X-YMail-OSG: 9p3tmMAVM1n9u6Zf.XbDbZvSp9nHexoYWE5X4gzy0yiMcEb1_62mA2tIq.3ALAUrvFkbcLunq0FVLCY5RXPd_tW2s6ZRyVKf3zeSAYEmeuWVFXs2RmLFV3I3ZOShHFRSx03axcEDg8fciZJkzfnQD_0fIAhifiJdhKaquHbHo_EieLov8DC_Hqza.jz5s8Ek7oFKzFlrzuUxcPL8a1z0zN2muw9Kh7m4sENBPbnApZHSLsKzzJA_WcrkaB7Zxm3BUtUCE_8lq3Josedj0JzavsajPfznc0BQzUmjVjmUmNP0HVZrqA0_erI4Y.fiU4saHC9PrpV.4PQUAXtQ4dRTLnXI6Y8DPnZ4wkA_GyE-
Received: from [59.90.244.83] by web59613.mail.ac4.yahoo.com via HTTP; Wed, 28 Oct 2009 04:12:13 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Wed, 28 Oct 2009 04:12:13 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
In-Reply-To: <867513fe0910280359pb0f8a77mc6d12618249377e4@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1888097879-1256728333=:86669"

--0-1888097879-1256728333=:86669
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Ya thats great sir.
Thanks a lot.
Currently am working with lucene 1.4.3 how to include that highlight class?=
 Can you please let me know the procedure of using it?
=A0
Thanks in advance
Dhivya


--- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:


From: Anshum <anshumg@gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Date: Wednesday, October 28, 2009, 10:59 AM


I guess it should be available starting 1.9 onwards and patch-able with a
few changes for even 1.4.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:24 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote=
:

> ya i found sir.
> May i know from which version is it available?
>
>
> --- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:
>
>
> From: Anshum <anshumg@gmail.com>
> Subject: Re: how to extract text from the result document in lucene searc=
h
> To: java-user@lucene.apache.org
> Date: Wednesday, October 28, 2009, 10:51 AM
>
>
> Yes Dhivya, there's a highlighter in the contrib for 2.4 as well.
>
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Wed, Oct 28, 2009 at 4:03 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> >wrote:
>
> > Thats exactly matching my need sir.
> > Thanx a lot
> > But is this highlighter in lucene 2.4.0?
> >
> > --- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:
> >
> >
> > From: Benjamin Heilbrunn <benhei@gmail.com>
> > Subject: Re: how to extract text from the result document in lucene
> search
> > To: java-user@lucene.apache.org
> > Date: Wednesday, October 28, 2009, 10:23 AM
> >
> >
> > Hello Dhivya,
> >
> > i'm not familiar with the Lucene Demos.
> > But for Highlighting take a look at
> > http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html
> >
> > Best regards
> > Benjamin
> >
> >
> >
> >
> >
>
>
>
>
>
=0A=0A=0A      
--0-1888097879-1256728333=:86669--

From java-user-return-43088-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:18:18 2009
Return-Path: <java-user-return-43088-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71555 invoked from network); 28 Oct 2009 11:18:17 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:18:17 -0000
Received: (qmail 52713 invoked by uid 500); 28 Oct 2009 11:18:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52628 invoked by uid 500); 28 Oct 2009 11:18:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52617 invoked by uid 99); 28 Oct 2009 11:18:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:18:15 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of pcdinh@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:18:09 +0000
Received: by yxe30 with SMTP id 30so609981yxe.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 04:17:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ghwf4mrV56cFLUJreE6t6N4NpfpviX0ZLlkLgByEiuY=;
        b=uBRKOj4FsTw71CZkSRwJhjzmqoaaM6JYXZ7TB80+1UBuP2dH8EM9LyYWzineAev28v
         ulXhTKT+WMhBop0aJaaFUn4kz8bOA5IU+7cnbmzaKG9VG1dU4TOn2orgwKdCDncnrQiA
         n+IQf9j30W0e36oH55fwIU0qcOIe4dkgTVMI8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Js/OzoFPk9I+pAEBdDLNeThEdXudzyTCDdJ4TNVEcZYWWA5g7XxbHJ2F7wl7f8KqrJ
         Na9hA0EDlhKd4DG8YjpfVX/ReVpEps93sxOIspuZYwjKmAU2yxo3+5C4pdSQsNuC7pUW
         f8QLRN0ajweY3h5tIaqPpV03LxUubAwVsG7NA=
MIME-Version: 1.0
Received: by 10.151.88.30 with SMTP id q30mr12449611ybl.315.1256728668509; 
	Wed, 28 Oct 2009 04:17:48 -0700 (PDT)
In-Reply-To: <867513fe0910280349j5585b568s72467419d8d8ead3@mail.gmail.com>
References: <27ff0e30910280345y815d2d9k91f986fe9e0eb5de@mail.gmail.com>
	 <867513fe0910280349j5585b568s72467419d8d8ead3@mail.gmail.com>
Date: Wed, 28 Oct 2009 18:17:48 +0700
Message-ID: <27ff0e30910280417i5dcf8faeid74bee940df86aa8@mail.gmail.com>
Subject: Re: deleteDocuments() does not work
From: Dinh <pcdinh@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd70c80dd98690476fcf1fa

--000e0cd70c80dd98690476fcf1fa
Content-Type: text/plain; charset=ISO-8859-1

Hi Anshum,

> Is it that your engine keeps an IndexSearcher[Reader] open all through
this
while?

The answer is yes. I have tried to keep a singleton instance of
IndexSearcher open across web requests.

Regarding to your advice, I have tried to re-open the IndexReader that is
associated with that IndexSearcher

    public void deleteById(String id) throws IOException {
        IndexWriter writer = IndexWriterFactory.factory();

        try {
            writer.deleteDocuments(new Term(Configuration.Field.ID,
String.valueOf(id)));
            writer.commit();
            IndexSearcherFactory.reload();
        } catch (ArrayIndexOutOfBoundsException e) {
            // CHECK ignore this. Can happen if index has not been built yet
        } catch (IOException e) {
            System.out.println(e);
        }
    }

Here is how IndexSearcherFactory#reload is defined

    public static void reload() throws CorruptIndexException, IOException {

        Set<Map.Entry<String, IndexReader>> set = readers.entrySet();
        for (Map.Entry<String, IndexReader> entry : set) {
            readers.put(entry.getKey(), entry.getValue().reopen(true));
        }
    }

However, it does not work either.

Is there any way to debug this situation?

Thanks,

Dinh

On Wed, Oct 28, 2009 at 5:49 PM, Anshum <anshumg@gmail.com> wrote:

> Hi Dinh,
> Is it that your engine keeps an IndexSearcher[Reader] open all through this
> while? For the deleted document to actually reflect in the search
> (service),
> you'd need to reload the index searcher with the latest version.
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Wed, Oct 28, 2009 at 4:15 PM, Dinh <pcdinh@gmail.com> wrote:
>
> > Hi all,
> >
> > I have a very simple method to delete a document that is indexed before
> >
> >    /**
> >     * @param id
> >     */
> >    public void deleteById(String id) throws IOException {
> >        IndexWriter writer = IndexWriterFactory.factory();
> >
> >        try {
> >            writer.deleteDocuments(new Term(Configuration.Field.ID,
> > String.valueOf(id)));
> >            writer.commit();
> >        } catch (ArrayIndexOutOfBoundsException e) {
> >            // CHECK ignore this. Can happen if index has not been built
> yet
> >        } catch (IOException e) {
> >            System.out.println(e);
> >        }
> >    }
> >
> > The problem is after executing this method without any exception, I come
> > back and try to do a search the supposed-to-be-deleted record is still
> > there. I need to restart my servlet engine to have that record been
> really
> > deleted. How can it happen?
> >
> > Thanks
> >
> > Dinh
> >
>



-- 
Spica Framework: http://code.google.com/p/spica
http://www.twitter.com/pcdinh
http://groups.google.com/group/phpvietnam

--000e0cd70c80dd98690476fcf1fa--

From java-user-return-43089-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:21:01 2009
Return-Path: <java-user-return-43089-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71967 invoked from network); 28 Oct 2009 11:21:01 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:21:01 -0000
Received: (qmail 56265 invoked by uid 500); 28 Oct 2009 11:20:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56194 invoked by uid 500); 28 Oct 2009 11:20:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56184 invoked by uid 99); 28 Oct 2009 11:20:59 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:20:59 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:20:56 +0000
Received: by pxi3 with SMTP id 3so505031pxi.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 04:20:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=gLfErIqq0no25Sn0M19XXu6ZcYSy3Tlw0Xy/mmParso=;
        b=nVeNBHOPo8o0VbCuPZDit8TO7Wki5YNfZULcnclXZVaaWQvOqcL20bvZteixe8oUdK
         4baaLZuQ3mmn4RIpZYoiyT66pPAzIPxG96vIHlLwJQrW7tpySkDpF2VoOwwmvMn9W68g
         0MwJ7+4PfMi3UzpuNOg1sYVWq83p8iTYJKmvg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=nLu5iRVvgMq24+k2jZpzUIw2Coax8Fq/HNOhXtGTzDJSVlSvYVL90XhXP8hItPA7dA
         MCVRp2+uP5jGCrFIRh1qwjLNNE7EigZqGRJQIvdlcBrBgLCBIx/+Ubevjj94atiO/Men
         Tp0dfAaP8yCYPgXwXD34Q/I9snV0P/1mbk5p0=
MIME-Version: 1.0
Received: by 10.114.33.30 with SMTP id g30mr6325051wag.214.1256728836169; Wed, 
	28 Oct 2009 04:20:36 -0700 (PDT)
In-Reply-To: <642737.86669.qm@web59613.mail.ac4.yahoo.com>
References: <867513fe0910280359pb0f8a77mc6d12618249377e4@mail.gmail.com> 
	<642737.86669.qm@web59613.mail.ac4.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Wed, 28 Oct 2009 16:50:16 +0530
Message-ID: <867513fe0910280420h42800141xb2f0e7d228ff4cb9@mail.gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636920709dbe3da0476fcfbe2

--001636920709dbe3da0476fcfbe2
Content-Type: text/plain; charset=ISO-8859-1

I wouldn't have a reference to a version that old. You could request over
the community, and incase some one would have an archived version he/she
could share it with you,
It would require some time and modifications to the oldest available version
for the highlighter.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:42 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Ya thats great sir.
> Thanks a lot.
> Currently am working with lucene 1.4.3 how to include that highlight class?
> Can you please let me know the procedure of using it?
>
> Thanks in advance
> Dhivya
>
>
> --- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:
>
>
> From: Anshum <anshumg@gmail.com>
> Subject: Re: how to extract text from the result document in lucene search
> To: java-user@lucene.apache.org
> Date: Wednesday, October 28, 2009, 10:59 AM
>
>
> I guess it should be available starting 1.9 onwards and patch-able with a
> few changes for even 1.4.
>
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Wed, Oct 28, 2009 at 4:24 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> >wrote:
>
> > ya i found sir.
> > May i know from which version is it available?
> >
> >
> > --- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:
> >
> >
> > From: Anshum <anshumg@gmail.com>
> > Subject: Re: how to extract text from the result document in lucene
> search
> > To: java-user@lucene.apache.org
> > Date: Wednesday, October 28, 2009, 10:51 AM
> >
> >
> > Yes Dhivya, there's a highlighter in the contrib for 2.4 as well.
> >
> > --
> > Anshum Gupta
> > Naukri Labs!
> > http://ai-cafe.blogspot.com
> >
> > The facts expressed here belong to everybody, the opinions to me. The
> > distinction is yours to draw............
> >
> >
> > On Wed, Oct 28, 2009 at 4:03 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> > >wrote:
> >
> > > Thats exactly matching my need sir.
> > > Thanx a lot
> > > But is this highlighter in lucene 2.4.0?
> > >
> > > --- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:
> > >
> > >
> > > From: Benjamin Heilbrunn <benhei@gmail.com>
> > > Subject: Re: how to extract text from the result document in lucene
> > search
> > > To: java-user@lucene.apache.org
> > > Date: Wednesday, October 28, 2009, 10:23 AM
> > >
> > >
> > > Hello Dhivya,
> > >
> > > i'm not familiar with the Lucene Demos.
> > > But for Highlighting take a look at
> > > http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html
> > >
> > > Best regards
> > > Benjamin
> > >
> > >
> > >
> > >
> > >
> >
> >
> >
> >
> >
>
>
>
>
>

--001636920709dbe3da0476fcfbe2--

From java-user-return-43090-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:23:59 2009
Return-Path: <java-user-return-43090-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 72941 invoked from network); 28 Oct 2009 11:23:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:23:59 -0000
Received: (qmail 60382 invoked by uid 500); 28 Oct 2009 11:23:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 60297 invoked by uid 500); 28 Oct 2009 11:23:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 60287 invoked by uid 99); 28 Oct 2009 11:23:56 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:23:56 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [76.13.12.220] (HELO web59615.mail.ac4.yahoo.com) (76.13.12.220)
    by apache.org (qpsmtpd/0.29) with SMTP; Wed, 28 Oct 2009 11:23:47 +0000
Received: (qmail 54105 invoked by uid 60001); 28 Oct 2009 11:23:23 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256729003; bh=tEOAs2Yzb1XZTuiTro/uqUYXb4vQ/2I9KQzk0Q1vG84=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=Xg8PyZvEOUQalXTjpOyoGYtOyBTLB5R9b4Bp0capt+MLF9HTck8sTbbPqZ71ql5M3V2czTuZBHLRPe7Q2mh++MkuJdmR2wb/ypexjx9pwI7q9CHqb8xRIfGrwXJfDOXlfNDYCHy24GI9QDYbAAD+kGMEG3Bjh/jv2ZQK8sOtmkk=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=BFTR3HMDnmJ6FchopHcCON/+QM3bseWrbBJxpEVzBBtLqZp+IhS+6VWlieY5ieGwO4TJFFf0TcLK2wIKBfRylY1QF2qbGONnyxhXIN3DOL2T9Lzyb7dsdLO0+LlSVfIPfmIeoM/PugZ1nFZpLhyD+fesqbyzHgnHMJHLx3iaA0c=;
Message-ID: <305062.53744.qm@web59615.mail.ac4.yahoo.com>
X-YMail-OSG: nf4.XiYVM1nqVd9zuv6ikM2YEAxZnlqbjgBP7TF_hI8wz4Gz6dRbiNTCOmq9e8da_jCQry20VnoxzuVi9b0HS6IBiVrE_IgreSOObsxil8rWVcrv95_aBcNvxGXqZxornh5TN1pLm1L2fYC9YnX796xnal8ncdv.JmNpt9pij2wjikntwfX5CPaXG3sSiMw6Uu62J159mgVRjdG5Bt6K._iO.VsrF6vEm2rybos6uuMfyoV3Wva7F2EKqWoOmGHG70PjYT2VpnaZ2uc3fTpuQJxo26y1EgGd.dcSzoRq2Av6bIfnN3xns6N3S8iRsOt8LHioWLnkAps-
Received: from [59.90.244.83] by web59615.mail.ac4.yahoo.com via HTTP; Wed, 28 Oct 2009 04:23:21 PDT
X-Mailer: YahooMailClassic/7.0.14 YahooMailWebService/0.7.347.3
Date: Wed, 28 Oct 2009 04:23:21 -0700 (PDT)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
In-Reply-To: <867513fe0910280420h42800141xb2f0e7d228ff4cb9@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1882329225-1256729001=:53744"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-1882329225-1256729001=:53744
Content-Type: text/plain; charset=us-ascii

Okay sir. Let me then try out with lucene 2.4.0 demos.

--- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:


From: Anshum <anshumg@gmail.com>
Subject: Re: how to extract text from the result document in lucene search
To: java-user@lucene.apache.org
Date: Wednesday, October 28, 2009, 11:20 AM


I wouldn't have a reference to a version that old. You could request over
the community, and incase some one would have an archived version he/she
could share it with you,
It would require some time and modifications to the oldest available version
for the highlighter.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Wed, Oct 28, 2009 at 4:42 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Ya thats great sir.
> Thanks a lot.
> Currently am working with lucene 1.4.3 how to include that highlight class?
> Can you please let me know the procedure of using it?
>
> Thanks in advance
> Dhivya
>
>
> --- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:
>
>
> From: Anshum <anshumg@gmail.com>
> Subject: Re: how to extract text from the result document in lucene search
> To: java-user@lucene.apache.org
> Date: Wednesday, October 28, 2009, 10:59 AM
>
>
> I guess it should be available starting 1.9 onwards and patch-able with a
> few changes for even 1.4.
>
> --
> Anshum Gupta
> Naukri Labs!
> http://ai-cafe.blogspot.com
>
> The facts expressed here belong to everybody, the opinions to me. The
> distinction is yours to draw............
>
>
> On Wed, Oct 28, 2009 at 4:24 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> >wrote:
>
> > ya i found sir.
> > May i know from which version is it available?
> >
> >
> > --- On Wed, 10/28/09, Anshum <anshumg@gmail.com> wrote:
> >
> >
> > From: Anshum <anshumg@gmail.com>
> > Subject: Re: how to extract text from the result document in lucene
> search
> > To: java-user@lucene.apache.org
> > Date: Wednesday, October 28, 2009, 10:51 AM
> >
> >
> > Yes Dhivya, there's a highlighter in the contrib for 2.4 as well.
> >
> > --
> > Anshum Gupta
> > Naukri Labs!
> > http://ai-cafe.blogspot.com
> >
> > The facts expressed here belong to everybody, the opinions to me. The
> > distinction is yours to draw............
> >
> >
> > On Wed, Oct 28, 2009 at 4:03 PM, DHIVYA M <dhivyakrishnan87@yahoo.com
> > >wrote:
> >
> > > Thats exactly matching my need sir.
> > > Thanx a lot
> > > But is this highlighter in lucene 2.4.0?
> > >
> > > --- On Wed, 10/28/09, Benjamin Heilbrunn <benhei@gmail.com> wrote:
> > >
> > >
> > > From: Benjamin Heilbrunn <benhei@gmail.com>
> > > Subject: Re: how to extract text from the result document in lucene
> > search
> > > To: java-user@lucene.apache.org
> > > Date: Wednesday, October 28, 2009, 10:23 AM
> > >
> > >
> > > Hello Dhivya,
> > >
> > > i'm not familiar with the Lucene Demos.
> > > But for Highlighting take a look at
> > > http://lucene.apache.org/java/2_9_0/api/contrib-highlighter/index.html
> > >
> > > Best regards
> > > Benjamin
> > >
> > >
> > >
> > >
> > >
> >
> >
> >
> >
> >
>
>
>
>
>



      
--0-1882329225-1256729001=:53744--

From java-user-return-43091-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:36:43 2009
Return-Path: <java-user-return-43091-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75888 invoked from network); 28 Oct 2009 11:36:43 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:36:43 -0000
Received: (qmail 75795 invoked by uid 500); 28 Oct 2009 11:36:41 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75733 invoked by uid 500); 28 Oct 2009 11:36:41 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75723 invoked by uid 99); 28 Oct 2009 11:36:41 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:36:41 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:36:31 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N36p0-0001ik-Ux
	for java-user@lucene.apache.org; Wed, 28 Oct 2009 04:36:10 -0700
Message-ID: <26093125.post@talk.nabble.com>
Date: Wed, 28 Oct 2009 04:36:10 -0700 (PDT)
From: Marc Sturlese <marc.sturlese@gmail.com>
To: java-user@lucene.apache.org
Subject: Adding segments to an optimized index
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: marc.sturlese@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


I am doing some test with optimize and adding segments and I am wondering if
someone knows if what I am doing can give document inconsistency. 
I have 2 folders with one index each. One have a non optimized index1 with 1
milion docs and a mergeFactor=10. The other one, index2 has the same index
optimized with compound file. I add and delete some docuements in the no
optimized index1. And a few segements desapear and somew are created. I now
I copy the new created files in the optimized index2 and optimized it again.
I get no errors doing that but... docuemenst will be the same in index1 and
index2? I am asking because when I added some docs and delete others in
index1 some segments desapear and index2 is suposed to still have that
segements optimized with the others... or it doesn't work this way?

What I try to explain is:

index1:
seg1,seg2,seg3,seg4,seg5
index2: (index1 optimized with compound)
seg8

adding and deleteting docs to index1 will get:
seg1,seg2,seg3,seg6 (seg4 and seg5 have desapeared and seg6 has been
created)
now I do in index2:
seg8+seg6+optimize=seg9 (but seg8 is suposed to still contain seg4 and seg5)

The question is: index1 (seg1,seg2,seg3,seg6) and index2(seg9) will contain
the same docs??

Thanks in advance and let me know if I wasn't clear in my explanation
please.
-- 
View this message in context: http://www.nabble.com/Adding-segments-to-an-optimized-index-tp26093125p26093125.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43092-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 11:47:46 2009
Return-Path: <java-user-return-43092-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 79297 invoked from network); 28 Oct 2009 11:47:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 11:47:46 -0000
Received: (qmail 84892 invoked by uid 500); 28 Oct 2009 11:47:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 84823 invoked by uid 500); 28 Oct 2009 11:47:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 84812 invoked by uid 99); 28 Oct 2009 11:47:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:47:44 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 11:47:41 +0000
Received: by yxe30 with SMTP id 30so631088yxe.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 04:47:19 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.254.7 with SMTP id b7mr11794952ybi.137.1256730439738; Wed, 
	28 Oct 2009 04:47:19 -0700 (PDT)
In-Reply-To: <27ff0e30910280417i5dcf8faeid74bee940df86aa8@mail.gmail.com>
References: <27ff0e30910280345y815d2d9k91f986fe9e0eb5de@mail.gmail.com>
	 <867513fe0910280349j5585b568s72467419d8d8ead3@mail.gmail.com>
	 <27ff0e30910280417i5dcf8faeid74bee940df86aa8@mail.gmail.com>
Date: Wed, 28 Oct 2009 07:47:19 -0400
Message-ID: <9ac0c6aa0910280447s5fc7fb21q154259209c379fb1@mail.gmail.com>
Subject: Re: deleteDocuments() does not work
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Can you not suppress the AIOOBE (just in case you're hitting that)?

Also, you are failing to close the old reader after opening a new one.
 This shouldn't cause the issue you're seeing, but, will lead
eventually to OOME or file descriptor exhaustion.

Can you verify you are in fact reopening the reader that's reading the
same Directory the writer is writing to?

Finally, are you sure the iteration over the Map entries, that
overwrites each entry, is safe?

Maybe, after writer.commit, try to simply [temporarily] open a new
reader on that Dir and see if the doc is deleted.

Are you sure String.valueOf(id) is giving you the expected result?  Eg
does id ever have leading zeros?

Mike

On Wed, Oct 28, 2009 at 7:17 AM, Dinh <pcdinh@gmail.com> wrote:
> Hi Anshum,
>
>> Is it that your engine keeps an IndexSearcher[Reader] open all through
> this
> while?
>
> The answer is yes. I have tried to keep a singleton instance of
> IndexSearcher open across web requests.
>
> Regarding to your advice, I have tried to re-open the IndexReader that is
> associated with that IndexSearcher
>
> =A0 =A0public void deleteById(String id) throws IOException {
> =A0 =A0 =A0 =A0IndexWriter writer =3D IndexWriterFactory.factory();
>
> =A0 =A0 =A0 =A0try {
> =A0 =A0 =A0 =A0 =A0 =A0writer.deleteDocuments(new Term(Configuration.Fiel=
d.ID,
> String.valueOf(id)));
> =A0 =A0 =A0 =A0 =A0 =A0writer.commit();
> =A0 =A0 =A0 =A0 =A0 =A0IndexSearcherFactory.reload();
> =A0 =A0 =A0 =A0} catch (ArrayIndexOutOfBoundsException e) {
> =A0 =A0 =A0 =A0 =A0 =A0// CHECK ignore this. Can happen if index has not =
been built yet
> =A0 =A0 =A0 =A0} catch (IOException e) {
> =A0 =A0 =A0 =A0 =A0 =A0System.out.println(e);
> =A0 =A0 =A0 =A0}
> =A0 =A0}
>
> Here is how IndexSearcherFactory#reload is defined
>
> =A0 =A0public static void reload() throws CorruptIndexException, IOExcept=
ion {
>
> =A0 =A0 =A0 =A0Set<Map.Entry<String, IndexReader>> set =3D readers.entryS=
et();
> =A0 =A0 =A0 =A0for (Map.Entry<String, IndexReader> entry : set) {
> =A0 =A0 =A0 =A0 =A0 =A0readers.put(entry.getKey(), entry.getValue().reope=
n(true));
> =A0 =A0 =A0 =A0}
> =A0 =A0}
>
> However, it does not work either.
>
> Is there any way to debug this situation?
>
> Thanks,
>
> Dinh
>
> On Wed, Oct 28, 2009 at 5:49 PM, Anshum <anshumg@gmail.com> wrote:
>
>> Hi Dinh,
>> Is it that your engine keeps an IndexSearcher[Reader] open all through t=
his
>> while? For the deleted document to actually reflect in the search
>> (service),
>> you'd need to reload the index searcher with the latest version.
>> --
>> Anshum Gupta
>> Naukri Labs!
>> http://ai-cafe.blogspot.com
>>
>> The facts expressed here belong to everybody, the opinions to me. The
>> distinction is yours to draw............
>>
>>
>> On Wed, Oct 28, 2009 at 4:15 PM, Dinh <pcdinh@gmail.com> wrote:
>>
>> > Hi all,
>> >
>> > I have a very simple method to delete a document that is indexed befor=
e
>> >
>> > =A0 =A0/**
>> > =A0 =A0 * @param id
>> > =A0 =A0 */
>> > =A0 =A0public void deleteById(String id) throws IOException {
>> > =A0 =A0 =A0 =A0IndexWriter writer =3D IndexWriterFactory.factory();
>> >
>> > =A0 =A0 =A0 =A0try {
>> > =A0 =A0 =A0 =A0 =A0 =A0writer.deleteDocuments(new Term(Configuration.F=
ield.ID,
>> > String.valueOf(id)));
>> > =A0 =A0 =A0 =A0 =A0 =A0writer.commit();
>> > =A0 =A0 =A0 =A0} catch (ArrayIndexOutOfBoundsException e) {
>> > =A0 =A0 =A0 =A0 =A0 =A0// CHECK ignore this. Can happen if index has n=
ot been built
>> yet
>> > =A0 =A0 =A0 =A0} catch (IOException e) {
>> > =A0 =A0 =A0 =A0 =A0 =A0System.out.println(e);
>> > =A0 =A0 =A0 =A0}
>> > =A0 =A0}
>> >
>> > The problem is after executing this method without any exception, I co=
me
>> > back and try to do a search the supposed-to-be-deleted record is still
>> > there. I need to restart my servlet engine to have that record been
>> really
>> > deleted. How can it happen?
>> >
>> > Thanks
>> >
>> > Dinh
>> >
>>
>
>
>
> --
> Spica Framework: http://code.google.com/p/spica
> http://www.twitter.com/pcdinh
> http://groups.google.com/group/phpvietnam
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43093-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 12:51:31 2009
Return-Path: <java-user-return-43093-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97462 invoked from network); 28 Oct 2009 12:51:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 12:51:31 -0000
Received: (qmail 65025 invoked by uid 500); 28 Oct 2009 12:51:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 64944 invoked by uid 500); 28 Oct 2009 12:51:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 64934 invoked by uid 99); 28 Oct 2009 12:51:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 12:51:28 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of torindan@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 12:51:19 +0000
Received: by qyk41 with SMTP id 41so450722qyk.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 05:50:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=FUmTOP9eh7VH6l3P5hZQKsS4L8PpcmH86VMXMuEz0gQ=;
        b=sDU6GxvRKp8wzLV/aa680HGqJ9o3TCHCJOMitk/HwihACbwOZm4Pnr4rezafYwMI0q
         x0nVCQfqQvKy658ER2Dc6GrUgmzSVSlb9xFRx7FQiicDq1OYuXCc16MI9GCr4BpvY0kN
         TX9ySZDKE465sFIyhgiOV4gThNHKSevyc6R9w=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ZaQvsJg3iDfXXitYhWyJNYGwErQn/CkzkxjhWw8jZSlu47RifOXFfQ7pRifziAzicB
         ypZHnRaYQkBedH8qK0oor8Hu0ki7jUEn6EAb1deQblIUU7PyW5M0ZlSdPn1UppMyylRf
         j0K1zxGQLqP89NMZ/CviquwfRHaB6kh+eAE+w=
MIME-Version: 1.0
Received: by 10.229.9.130 with SMTP id l2mr836598qcl.41.1256734258776; Wed, 28 
	Oct 2009 05:50:58 -0700 (PDT)
In-Reply-To: <26093125.post@talk.nabble.com>
References: <26093125.post@talk.nabble.com>
Date: Wed, 28 Oct 2009 14:50:58 +0200
Message-ID: <2ffb6d060910280550v2469e2b3v89355d39c0196613@mail.gmail.com>
Subject: Re: Adding segments to an optimized index
From: =?UTF-8?B?RGFuaWwgxaJPUklO?= <torindan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

There is no such thing in lucene as "unique" doc.

They might be unique from your application point of view (have some ID
that is unique)
>From lucene's point of view it's perfectly fine to have duplicate documents.

So the "deleted" documents in combined index are coming from your second index.

Even more: if you search your combined index you'll see that there are
duplicate documents
that came from 1st index and were not deleted.

That's because lucene simply adds to combined index all documents that
aren't marked as deleted.
Remember that document is (kind of) opaque to lucene and it doesn't
have (and doesn't need)
any logic to handle such situations, these should be handled by your
application.

On Wed, Oct 28, 2009 at 13:36, Marc Sturlese <marc.sturlese@gmail.com> wrote:
>
> I am doing some test with optimize and adding segments and I am wondering if
> someone knows if what I am doing can give document inconsistency.
> I have 2 folders with one index each. One have a non optimized index1 with 1
> milion docs and a mergeFactor=10. The other one, index2 has the same index
> optimized with compound file. I add and delete some docuements in the no
> optimized index1. And a few segements desapear and somew are created. I now
> I copy the new created files in the optimized index2 and optimized it again.
> I get no errors doing that but... docuemenst will be the same in index1 and
> index2? I am asking because when I added some docs and delete others in
> index1 some segments desapear and index2 is suposed to still have that
> segements optimized with the others... or it doesn't work this way?
>
> What I try to explain is:
>
> index1:
> seg1,seg2,seg3,seg4,seg5
> index2: (index1 optimized with compound)
> seg8
>
> adding and deleteting docs to index1 will get:
> seg1,seg2,seg3,seg6 (seg4 and seg5 have desapeared and seg6 has been
> created)
> now I do in index2:
> seg8+seg6+optimize=seg9 (but seg8 is suposed to still contain seg4 and seg5)
>
> The question is: index1 (seg1,seg2,seg3,seg6) and index2(seg9) will contain
> the same docs??
>
> Thanks in advance and let me know if I wasn't clear in my explanation
> please.
> --
> View this message in context: http://www.nabble.com/Adding-segments-to-an-optimized-index-tp26093125p26093125.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43094-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 13:24:53 2009
Return-Path: <java-user-return-43094-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 17453 invoked from network); 28 Oct 2009 13:24:52 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 13:24:52 -0000
Received: (qmail 16255 invoked by uid 500); 28 Oct 2009 13:24:50 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 16170 invoked by uid 500); 28 Oct 2009 13:24:50 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 16157 invoked by uid 99); 28 Oct 2009 13:24:50 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 13:24:50 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 13:24:48 +0000
Received: by iwn6 with SMTP id 6so534231iwn.20
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 06:24:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=3qa0GLVljCjNkmlepJ/5fQNbYmslNk36oaS2M7NaUe4=;
        b=gjYQuxf75D7ghyOxIPwFoQCE1aADZEzYc9w2f0T2g0atvhHpSJMUAam7x/Ie1dU97G
         vOlH5lrj/j7y1gPrZVHbMEYllb3b09RinMywiMGyIWW4r3XF9StnzhKp1nbLwz06c5qk
         90ujS8O15AJTYSUQY2cY2bePJvffwAmbDPyi4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=M9cMmFqkPiW9DicEp6kDWHesUv+NGQ5WE+xwBI0xtPQ599HBVt9rFym67m28odQXMC
         0FWoPR/mTualRybOJs0Uc2ymWtYGkiu9lbkvCZbs03wOYKULsBueCSyoD0qtz5iGJf8/
         BFyH5lBRY7ujrHVow/kfTfAZgNKJ2Y1/ubsEA=
MIME-Version: 1.0
Received: by 10.231.4.149 with SMTP id 21mr3481245ibr.26.1256736267519; Wed, 
	28 Oct 2009 06:24:27 -0700 (PDT)
In-Reply-To: <103453.2279.qm@web59609.mail.ac4.yahoo.com>
References: <103453.2279.qm@web59609.mail.ac4.yahoo.com>
Date: Wed, 28 Oct 2009 09:24:27 -0400
Message-ID: <359a92830910280624k61b900a7nb23a37fa014bace1@mail.gmail.com>
Subject: Re: What is multiple indexing and how does it work in Lucene [Java]
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517740ddacd49540476feb6de

--001517740ddacd49540476feb6de
Content-Type: text/plain; charset=ISO-8859-1

Hmmm, what do you mean by "multiple indexing"? Using more than one thread?
more than one processor? Searching across more than one index? Each of these
has a different answer...

Best
Erick

On Wed, Oct 28, 2009 at 1:55 AM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Can anyone tell me what is multiple indexing and how does it work in lucene
> [Java].
>
> Kindly provide the informations either the explanation or any source for
> such details.
>
> Thanx in advance
>
>
>

--001517740ddacd49540476feb6de--

From java-user-return-43095-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 13:28:42 2009
Return-Path: <java-user-return-43095-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 18425 invoked from network); 28 Oct 2009 13:28:42 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 13:28:42 -0000
Received: (qmail 20376 invoked by uid 500); 28 Oct 2009 13:28:40 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20303 invoked by uid 500); 28 Oct 2009 13:28:40 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20293 invoked by uid 99); 28 Oct 2009 13:28:40 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 13:28:40 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [82.132.130.152] (HELO mail.o2.co.uk) (82.132.130.152)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 13:28:37 +0000
Received: from [192.168.60.56] (188.220.58.136) by mail.o2.co.uk (8.0.013.3) (authenticated as joelhalbert)
        id 4A4B4C7128E92A4F for java-user@lucene.apache.org; Wed, 28 Oct 2009 13:28:02 +0000
Subject: similarity function
From: Joel Halbert <joel@su3analytics.com>
To: Lucene Users <java-user@lucene.apache.org>
Content-Type: text/plain
Organization: SU3 Analytics
Date: Wed, 28 Oct 2009 13:29:29 +0000
Message-Id: <1256736569.11754.15.camel@bohr>
Mime-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit

Hi,

Given a query with multiple terms, e.g. fish oil, and searching across
multiple fields e.g. 

query= fieldA:fish fieldA:oil fieldB:fish fieldB:oil  etc...

I don't want to give any more weight to documents that match the same
word multiple times (either in the same, or different fields). I am only
interested in lending additional weight to a match of both words (fish
and oil) in the SAME field.

So for example if I have documents:

Doc1
fieldA=fish is good for you
fieldB=vegetable oil and sunflower oil is good for you 

and Doc2
fieldA=fish oil is good for you
fieldB=bla bla bla

with the default similarity I would have 3 term matches in document 1
(fish, oil, oil) and 2 in document 2 (fish, oil), but I only want to
count 2 term matches in document 1 (fish, oil) and I want to give
increased weight to the two matches in document 2 because they occur in
the same field (fieldA).

Any ideas? Is there a simple way to achieve this? (it goes without
saying I want to match both documents, i.e. don't want to use quotes
"fish oil")

Thanks,
Joel



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43096-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 13:40:34 2009
Return-Path: <java-user-return-43096-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 21975 invoked from network); 28 Oct 2009 13:40:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 13:40:34 -0000
Received: (qmail 35756 invoked by uid 500); 28 Oct 2009 13:40:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35677 invoked by uid 500); 28 Oct 2009 13:40:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35614 invoked by uid 99); 28 Oct 2009 13:40:32 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 13:40:32 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [82.132.130.151] (HELO mail.o2.co.uk) (82.132.130.151)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 13:40:22 +0000
Received: from [192.168.60.56] (188.220.58.136) by mail.o2.co.uk (8.0.013.3) (authenticated as joelhalbert)
        id 4AE6CD0F0063D089 for java-user@lucene.apache.org; Wed, 28 Oct 2009 13:39:51 +0000
Subject: Re: similarity function
From: Joel Halbert <joel@su3analytics.com>
To: java-user@lucene.apache.org
In-Reply-To: <1256736569.11754.15.camel@bohr>
References: <1256736569.11754.15.camel@bohr>
Content-Type: text/plain
Organization: SU3 Analytics
Date: Wed, 28 Oct 2009 13:41:06 +0000
Message-Id: <1256737266.11754.18.camel@bohr>
Mime-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

I suppose this could be summarised as:

"how do i set the score of each document result to be the score of that
of the field that best matches the search terms"?

 
-----Original Message-----
From: Joel Halbert <joel@su3analytics.com>
Reply-To: java-user@lucene.apache.org
To: Lucene Users <java-user@lucene.apache.org>
Subject: similarity function
Date: Wed, 28 Oct 2009 13:29:29 +0000

Hi,

Given a query with multiple terms, e.g. fish oil, and searching across
multiple fields e.g. 

query= fieldA:fish fieldA:oil fieldB:fish fieldB:oil  etc...

I don't want to give any more weight to documents that match the same
word multiple times (either in the same, or different fields). I am only
interested in lending additional weight to a match of both words (fish
and oil) in the SAME field.

So for example if I have documents:

Doc1
fieldA=fish is good for you
fieldB=vegetable oil and sunflower oil is good for you 

and Doc2
fieldA=fish oil is good for you
fieldB=bla bla bla

with the default similarity I would have 3 term matches in document 1
(fish, oil, oil) and 2 in document 2 (fish, oil), but I only want to
count 2 term matches in document 1 (fish, oil) and I want to give
increased weight to the two matches in document 2 because they occur in
the same field (fieldA).

Any ideas? Is there a simple way to achieve this? (it goes without
saying I want to match both documents, i.e. don't want to use quotes
"fish oil")

Thanks,
Joel



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43097-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 14:23:47 2009
Return-Path: <java-user-return-43097-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 34589 invoked from network); 28 Oct 2009 14:23:47 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 14:23:47 -0000
Received: (qmail 4675 invoked by uid 500); 28 Oct 2009 14:22:39 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 4591 invoked by uid 500); 28 Oct 2009 14:22:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 4581 invoked by uid 99); 28 Oct 2009 14:22:38 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:22:38 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:22:22 +0000
Received: by pxi3 with SMTP id 3so598204pxi.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 07:21:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=tEqwPaos2WwrZkOVBSyroRmRjyACUVLaZFUT/FghOvw=;
        b=CiROPyr+q91t8rty3GVkzFTjUO2bpx6akBWeIDiWidviEz5zzo/W1Wv6UZmBj6BgUl
         k5glvzTyBeyqEPp8wIfnPDCGOjLR2STBSKOeUTa2ThxCuon236cxCrbgyqnLBUgTpWd4
         /N+6/ujK0LWELyigyGwHODDw1vjLjzjTJovD4=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=FWC6W4YiVzI5hTNllNnNzs7J19rv5G3w0r+J8WQVibusrrScZUAyek1yskAs3mhs9/
         H3DJtwkKCQ0tDhVRFlZuGSwO9QcNq8QHegWHketju5rMQTLi8h5JD67zo5Zq+LGFmQ2z
         MePDpA8u13P+2kZPtuPRtUvNKMayxJ5HDQa5c=
MIME-Version: 1.0
Received: by 10.142.9.29 with SMTP id 29mr1434504wfi.131.1256739719255; Wed, 
	28 Oct 2009 07:21:59 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
Date: Wed, 28 Oct 2009 10:21:58 -0400
Message-ID: <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502b8518a9b8c0476ff8483
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502b8518a9b8c0476ff8483
Content-Type: text/plain; charset=ISO-8859-1

Yes, I used JDK 1.6.0_16 when running CheckIndex and it reported the same
problems when run multiple times.

>Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52" mean?
This appears to be something added by the ant build, since I built Lucene
from the source code.

I rebuilt the index using mergeFactor=50, ramBufferSize=200MB,
maxBufferedDocs=1000000
This produced 49 segments, 9 of which are broken. The broken segments are in
the latter half, similar to my previous post with 3 segments. Do you think
this could be caused by 'bad' data, for example bad unicode characters?

Here is the output from CheckIndex:

Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.3

Segments file=segments_2 numSegments=49 version=FORMAT_DIAGNOSTICS [Lucene
2.9]
  1 of 49: name=_0 docCount=32607
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=104.853
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=0
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1044042 terms; 15675239 terms/docs pairs;
30451901 tokens]
    test: stored fields.......OK [97821 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  2 of 49: name=_1 docCount=29043
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=99.056
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=32607
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1039244 terms; 14310099 terms/docs pairs;
29363393 tokens]
    test: stored fields.......OK [87129 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  3 of 49: name=_2 docCount=28376
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=92.893
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=61650
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1070860 terms; 13575421 terms/docs pairs;
26651224 tokens]
    test: stored fields.......OK [85128 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  4 of 49: name=_3 docCount=26936
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=85.337
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=90026
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1100843 terms; 12224580 terms/docs pairs;
24327234 tokens]
    test: stored fields.......OK [80808 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  5 of 49: name=_4 docCount=24129
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=92.877
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=116962
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [953360 terms; 12679962 terms/docs pairs;
28713617 tokens]
    test: stored fields.......OK [72387 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  6 of 49: name=_5 docCount=28737
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=84.085
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=141091
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1046406 terms; 12476181 terms/docs pairs;
23798602 tokens]
    test: stored fields.......OK [86211 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  7 of 49: name=_6 docCount=31930
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=81.221
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=169828
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1040633 terms; 12527851 terms/docs pairs;
22544575 tokens]
    test: stored fields.......OK [95790 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  8 of 49: name=_7 docCount=30328
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=79.407
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=201758
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1011468 terms; 12179814 terms/docs pairs;
22052790 tokens]
    test: stored fields.......OK [90984 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  9 of 49: name=_8 docCount=29899
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=77.691
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=232086
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [984327 terms; 11954498 terms/docs pairs;
21591867 tokens]
    test: stored fields.......OK [89697 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  10 of 49: name=_9 docCount=29256
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=75.306
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=261985
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [964109 terms; 11588018 terms/docs pairs;
21067600 tokens]
    test: stored fields.......OK [87768 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  11 of 49: name=_a docCount=28152
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=73.1
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=291241
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [947892 terms; 11309631 terms/docs pairs;
20057187 tokens]
    test: stored fields.......OK [84456 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  12 of 49: name=_b docCount=28085
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=79.339
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=319393
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [874964 terms; 12908370 terms/docs pairs;
21303545 tokens]
    test: stored fields.......OK [84255 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  13 of 49: name=_c docCount=25826
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=68.772
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=347478
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [909574 terms; 10594343 terms/docs pairs;
18824830 tokens]
    test: stored fields.......OK [77478 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  14 of 49: name=_d docCount=24897
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=65.666
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=373304
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [900276 terms; 10033030 terms/docs pairs;
18078077 tokens]
    test: stored fields.......OK [74691 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  15 of 49: name=_e docCount=23703
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=64.102
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=398201
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [879633 terms; 9727229 terms/docs pairs;
17663716 tokens]
    test: stored fields.......OK [71109 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  16 of 49: name=_f docCount=22817
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=62.733
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=421904
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [858745 terms; 9502077 terms/docs pairs;
17280189 tokens]
    test: stored fields.......OK [68451 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  17 of 49: name=_g docCount=22048
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=61.599
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=444721
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [832264 terms; 9250137 terms/docs pairs;
17231073 tokens]
    test: stored fields.......OK [66144 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  18 of 49: name=_h docCount=20403
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=60.463
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=466769
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [806620 terms; 9140615 terms/docs pairs;
17229721 tokens]
    test: stored fields.......OK [61209 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  19 of 49: name=_i docCount=15832
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=61.809
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=487172
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [743992 terms; 9521640 terms/docs pairs;
18856338 tokens]
    test: stored fields.......OK [47496 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  20 of 49: name=_j docCount=15530
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=60.477
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=503004
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [736987 terms; 9326695 terms/docs pairs;
18446953 tokens]
    test: stored fields.......OK [46590 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  21 of 49: name=_k docCount=15154
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=59.197
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=518534
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [725501 terms; 9080575 terms/docs pairs;
18086724 tokens]
    test: stored fields.......OK [45462 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  22 of 49: name=_l docCount=15143
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=58.065
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=533688
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [718454 terms; 9001690 terms/docs pairs;
17486800 tokens]
    test: stored fields.......OK [45429 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  23 of 49: name=_m docCount=14772
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=57.173
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=548831
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [703510 terms; 8820732 terms/docs pairs;
17436315 tokens]
    test: stored fields.......OK [44316 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  24 of 49: name=_n docCount=14553
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=55.757
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=563603
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [699431 terms; 8655384 terms/docs pairs;
16754881 tokens]
    test: stored fields.......OK [43659 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  25 of 49: name=_o docCount=13915
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=54.793
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=578156
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [685499 terms; 8400803 terms/docs pairs;
16618782 tokens]
    test: stored fields.......OK [41745 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  26 of 49: name=_p docCount=13700
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=53.546
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=592071
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [678014 terms; 8217915 terms/docs pairs;
16282687 tokens]
    test: stored fields.......OK [41100 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  27 of 49: name=_q docCount=13629
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=52.761
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=605771
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [667953 terms; 8140291 terms/docs pairs;
15990296 tokens]
    test: stored fields.......OK [40887 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  28 of 49: name=_r docCount=15237
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=48.489
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=619400
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [705543 terms; 7039002 terms/docs pairs;
13716437 tokens]
    test: stored fields.......OK [45711 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  29 of 49: name=_s docCount=15104
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=47.815
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=634637
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [690968 terms; 6931518 terms/docs pairs;
13491286 tokens]
    test: stored fields.......OK [45312 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  30 of 49: name=_t docCount=14397
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=46.781
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=649741
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [676367 terms; 6715361 terms/docs pairs;
13217449 tokens]
    test: stored fields.......OK [43191 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  31 of 49: name=_u docCount=14221
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=45.819
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=664138
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=2 != num
docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=2 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [42663 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  32 of 49: name=_v docCount=13609
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=44.718
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=678359
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [656642 terms; 6391224 terms/docs pairs;
12712494 tokens]
    test: stored fields.......OK [40827 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  33 of 49: name=_w docCount=13667
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=43.979
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=691968
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [644235 terms; 6335940 terms/docs pairs;
12493135 tokens]
    test: stored fields.......OK [41001 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  34 of 49: name=_x docCount=13127
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=43.355
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=705635
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$on docFreq=143 !=
num docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$on docFreq=143 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [39381 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  35 of 49: name=_y docCount=18883
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=44.149
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=718762
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [623172 terms; 7078171 terms/docs pairs;
11703710 tokens]
    test: stored fields.......OK [56649 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  36 of 49: name=_z docCount=32665
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=96.094
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=737645
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=5 != num
docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=5 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [97995 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  37 of 49: name=_10 docCount=30048
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=93.591
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=770310
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1104452 terms; 13801203 terms/docs pairs;
26908610 tokens]
    test: stored fields.......OK [90144 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  38 of 49: name=_11 docCount=28918
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=92.029
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=800358
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1071103 terms; 13482603 terms/docs pairs;
26689595 tokens]
    test: stored fields.......OK [86754 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  39 of 49: name=_12 docCount=28061
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=90.18
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=829276
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [1046474 terms; 13165220 terms/docs pairs;
26172166 tokens]
    test: stored fields.......OK [84183 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  40 of 49: name=_13 docCount=27951
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=88.815
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=857337
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num docs
seen 23 + num docs deleted 0]
java.lang.RuntimeException: term contents:? docFreq=1 != num docs seen 23 +
num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [83853 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  41 of 49: name=_14 docCount=25719
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=84.413
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=885288
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$microsoft
docFreq=261 != num docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$microsoft docFreq=261 !=
num docs seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [77157 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  42 of 49: name=_15 docCount=24619
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=82.36
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=911007
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=4 != num
docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=4 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [73857 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  43 of 49: name=_16 docCount=24737
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=81.418
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=935626
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [980037 terms; 11775562 terms/docs pairs;
23725750 tokens]
    test: stored fields.......OK [74211 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  44 of 49: name=_17 docCount=24024
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=78.846
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=960363
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [972926 terms; 11434745 terms/docs pairs;
22790354 tokens]
    test: stored fields.......OK [72072 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  45 of 49: name=_18 docCount=23092
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=77.403
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=984387
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [949210 terms; 11127490 terms/docs pairs;
22554444 tokens]
    test: stored fields.......OK [69276 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  46 of 49: name=_19 docCount=21704
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=75.87
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=1007479
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=4 != num
docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=4 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [65112 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  47 of 49: name=_1a docCount=21226
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=73.991
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=1029183
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [917383 terms; 10553486 terms/docs pairs;
21664562 tokens]
    test: stored fields.......OK [63678 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  48 of 49: name=_1b docCount=20658
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=72.712
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=1050409
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=4 != num
docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=4 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [61974 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

  49 of 49: name=_1c docCount=6343
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=21.919
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
exported - 2009-10-28 09:13:38, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=1071067
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=3 != num
docs seen 1 + num docs deleted 0]
java.lang.RuntimeException: term literals:cfid196$ docFreq=3 != num docs
seen 1 + num docs deleted 0
    at org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
    test: stored fields.......OK [19029 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]
FAILED
    WARNING: fixIndex() would remove reference to this segment; full
exception:
java.lang.RuntimeException: Term Index test failed
    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)

WARNING: 9 broken segments (containing 187007 documents) detected
WARNING: would write new segments file, and 187007 documents would be lost,
if -fix were specified

Here is the output from the IndexWriter:

IFD [Indexer]: setInfoStream
deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@2f74219d
IW 0 [Indexer]: setInfoStream:
dir=org.apache.lucene.store.SimpleFSDirectory@D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.update.main.3
autoCommit=false
mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@714ae2c1mergeScheduler=org.apache.lucene.index.ConcurrentMergeScheduler@6b6d2702ramBufferSizeMB=16.0
maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
maxFieldLength=2147483647 index=
IW 0 [Indexer]: setRAMBufferSizeMB 200.0
IW 0 [Indexer]: setMaxBufferedDocs 1000000
IW 0 [Indexer]: flush at getReader
IW 0 [Indexer]:   flush: segment=null docStoreSegment=null docStoreOffset=0
flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
numBufDelTerms=0
IW 0 [Indexer]:   index before flush
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=195.53 allocMB=195.53
deletesMB=4.492 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_0 docStoreSegment=_0
docStoreOffset=0 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=32607 numBufDelTerms=32607
IW 0 [UpdWriterBuild]:   index before flush
IW 0 [UpdWriterBuild]: DW: flush postings as segment _0 numDocs=32607
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=205028352 newFlushedSize=109946095
docs/MB=310.979 new/old=53.625%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 1 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=191.496 allocMB=195.53
deletesMB=8.523 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_1 docStoreSegment=_0
docStoreOffset=32607 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=29043 numBufDelTerms=29043
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _1 numDocs=29043
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=200798208 newFlushedSize=103867694
docs/MB=293.198 new/old=51.727%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 2 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=187.555 vs
trigger=200 allocMB=197.555 deletesMB=12.461 vs trigger=210
byteBlockFree=9.938 charBlockFree=0
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=9.938 usedMB=200.015
allocMB=187.617
IW 0 [UpdWriterBuild]:   flush: segment=_2 docStoreSegment=_0
docStoreOffset=61650 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=28376 numBufDelTerms=28376
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _2 numDocs=28376
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=196665344 newFlushedSize=97404685
docs/MB=305.472 new/old=49.528%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 3 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=183.81 allocMB=190.247
deletesMB=16.203 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_3 docStoreSegment=_0
docStoreOffset=90026 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=26936 numBufDelTerms=26936
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _3 numDocs=26936
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=192738304 newFlushedSize=89482320
docs/MB=315.643 new/old=46.427%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 4 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=180.466 vs
trigger=200 allocMB=194.278 deletesMB=19.556 vs trigger=210 byteBlockFree=0
charBlockFree=3.062
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=13.75 usedMB=200.022
allocMB=180.528
IW 0 [UpdWriterBuild]:   flush: segment=_4 docStoreSegment=_0
docStoreOffset=116962 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=24129 numBufDelTerms=24129
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _4 numDocs=24129
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=189232128 newFlushedSize=97388095
docs/MB=259.797 new/old=51.465%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 5 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=176.461 vs
trigger=200 allocMB=189.398 deletesMB=23.551 vs trigger=210
byteBlockFree=12.875 charBlockFree=0
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=12.875 usedMB=200.012
allocMB=176.523
IW 0 [UpdWriterBuild]:   flush: segment=_5 docStoreSegment=_0
docStoreOffset=141091 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=28737 numBufDelTerms=28737
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _5 numDocs=28737
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=185032704 newFlushedSize=88168939
docs/MB=341.764 new/old=47.65%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 6 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=172.017 allocMB=176.523
deletesMB=27.994 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_6 docStoreSegment=_0
docStoreOffset=169828 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=31930 numBufDelTerms=31930
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _6 numDocs=31930
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=180372480 newFlushedSize=85166081
docs/MB=393.126 new/old=47.217%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [7 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [7 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 7 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 7 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=167.828 allocMB=176.523
deletesMB=32.214 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_7 docStoreSegment=_0
docStoreOffset=201758 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=30328 numBufDelTerms=30328
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _7 numDocs=30328
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=175980544 newFlushedSize=83263539
docs/MB=381.934 new/old=47.314%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [8 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [8 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 8 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 8 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=163.662 vs
trigger=200 allocMB=176.523 deletesMB=36.375 vs trigger=210 byteBlockFree=7
charBlockFree=1.312
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=12.799 usedMB=200.037
allocMB=163.725
IW 0 [UpdWriterBuild]:   flush: segment=_8 docStoreSegment=_0
docStoreOffset=232086 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=29899 numBufDelTerms=29899
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _8 numDocs=29899
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=171612160 newFlushedSize=81464942
docs/MB=384.845 new/old=47.47%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [9 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [9 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 9 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 9 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=159.569 allocMB=163.725
deletesMB=40.446 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_9 docStoreSegment=_0
docStoreOffset=261985 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=29256 numBufDelTerms=29256
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _9 numDocs=29256
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=167320576 newFlushedSize=78964162
docs/MB=388.494 new/old=47.193%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [10 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [10 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 10 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 10 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=155.663 allocMB=163.725
deletesMB=44.359 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_a docStoreSegment=_0
docStoreOffset=291241 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=28152 numBufDelTerms=28152
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _a numDocs=28152
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=163224576 newFlushedSize=76650343
docs/MB=385.119 new/old=46.96%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [11 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [11 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 11 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 11 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=151.807 vs
trigger=200 allocMB=163.725 deletesMB=48.221 vs trigger=210
byteBlockFree=1.094 charBlockFree=2.812
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=11.855 usedMB=200.028
allocMB=151.869
IW 0 [UpdWriterBuild]:   flush: segment=_b docStoreSegment=_0
docStoreOffset=319393 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=28085 numBufDelTerms=28085
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _b numDocs=28085
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=159180800 newFlushedSize=83192732
docs/MB=353.988 new/old=52.263%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [12 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [12 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 12 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 12 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=148.189 allocMB=155.283
deletesMB=51.811 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_c docStoreSegment=_0
docStoreOffset=347478 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=25826 numBufDelTerms=25826
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _c numDocs=25826
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=155387904 newFlushedSize=72112070
docs/MB=375.534 new/old=46.408%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [13 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [13 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 13 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 13 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=144.731 vs
trigger=200 allocMB=155.283 deletesMB=55.274 vs trigger=210
byteBlockFree=9.594 charBlockFree=0.188
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=10.489 usedMB=200.006
allocMB=144.794
IW 0 [UpdWriterBuild]:   flush: segment=_d docStoreSegment=_0
docStoreOffset=373304 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=24897 numBufDelTerms=24897
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _d numDocs=24897
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=151761920 newFlushedSize=68855841
docs/MB=379.146 new/old=45.371%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [14 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [14 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 14 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 14 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=141.435 allocMB=144.794
deletesMB=58.572 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_e docStoreSegment=_0
docStoreOffset=398201 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=23703 numBufDelTerms=23703
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _e numDocs=23703
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=148304896 newFlushedSize=67215266
docs/MB=369.773 new/old=45.322%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [15 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [15 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 15 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 15 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=138.261 allocMB=144.794
deletesMB=61.746 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_f docStoreSegment=_0
docStoreOffset=421904 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=22817 numBufDelTerms=22817
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _f numDocs=22817
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=144976896 newFlushedSize=65780307
docs/MB=363.716 new/old=45.373%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [16 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [16 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 16 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 16 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=135.207 allocMB=144.794
deletesMB=64.812 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_g docStoreSegment=_0
docStoreOffset=444721 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=22048 numBufDelTerms=22048
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _g numDocs=22048
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=141774848 newFlushedSize=64591081
docs/MB=357.929 new/old=45.559%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [17 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [17 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 17 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 17 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=132.374 vs
trigger=200 allocMB=144.794 deletesMB=67.648 vs trigger=210
byteBlockFree=3.312 charBlockFree=2.25
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=12.357 usedMB=200.022
allocMB=132.437
IW 0 [UpdWriterBuild]:   flush: segment=_h docStoreSegment=_0
docStoreOffset=466769 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=20403 numBufDelTerms=20403
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _h numDocs=20403
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=138804224 newFlushedSize=63399427
docs/MB=337.449 new/old=45.675%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [18 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [18 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 18 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 18 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=130.167 allocMB=136.312
deletesMB=69.837 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_i docStoreSegment=_0
docStoreOffset=487172 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=15832 numBufDelTerms=15832
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _i numDocs=15832
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=136489984 newFlushedSize=64811536
docs/MB=256.144 new/old=47.484%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [19 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [19 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 19 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 19 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=128.046 allocMB=136.312
deletesMB=71.985 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_j docStoreSegment=_0
docStoreOffset=503004 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=15530 numBufDelTerms=15530
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _j numDocs=15530
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=134265856 newFlushedSize=63414576
docs/MB=256.792 new/old=47.231%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [20 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [20 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 20 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 20 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=125.924 vs
trigger=200 allocMB=136.312 deletesMB=74.08 vs trigger=210 byteBlockFree=2.5
charBlockFree=1.969
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=10.325 usedMB=200.004
allocMB=125.986
IW 0 [UpdWriterBuild]:   flush: segment=_k docStoreSegment=_0
docStoreOffset=518534 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=15154 numBufDelTerms=15154
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _k numDocs=15154
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=132040704 newFlushedSize=62072781
docs/MB=255.992 new/old=47.01%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [21 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [21 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 21 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 21 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=123.851 allocMB=125.986
deletesMB=76.174 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_l docStoreSegment=_0
docStoreOffset=533688 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=15143 numBufDelTerms=15143
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _l numDocs=15143
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=129866752 newFlushedSize=60885538
docs/MB=260.794 new/old=46.883%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [22 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [22 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 22 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 22 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=121.794 allocMB=125.986
deletesMB=78.217 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_m docStoreSegment=_0
docStoreOffset=548831 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=14772 numBufDelTerms=14772
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _m numDocs=14772
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=127710208 newFlushedSize=59950371
docs/MB=258.373 new/old=46.943%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [23 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [23 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 23 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 23 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=119.778 allocMB=125.986
deletesMB=80.229 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_n docStoreSegment=_0
docStoreOffset=563603 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=14553 numBufDelTerms=14553
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _n numDocs=14553
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=125596672 newFlushedSize=58464817
docs/MB=261.01 new/old=46.55%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [24 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [24 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 24 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 24 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=117.865 allocMB=125.986
deletesMB=82.154 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_o docStoreSegment=_0
docStoreOffset=578156 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=13915 numBufDelTerms=13915
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _o numDocs=13915
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=123590656 newFlushedSize=57453924
docs/MB=253.959 new/old=46.487%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [25 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [25 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 25 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 25 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=115.978 vs
trigger=200 allocMB=125.986 deletesMB=84.048 vs trigger=210
byteBlockFree=5.438 charBlockFree=1.062
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=9.946 usedMB=200.026
allocMB=116.04
IW 0 [UpdWriterBuild]:   flush: segment=_p docStoreSegment=_0
docStoreOffset=592071 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=13700 numBufDelTerms=13700
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _p numDocs=13700
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=121611264 newFlushedSize=56147055
docs/MB=255.855 new/old=46.169%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [26 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [26 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 26 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 26 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=114.08 allocMB=116.04
deletesMB=85.933 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_q docStoreSegment=_0
docStoreOffset=605771 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=13629 numBufDelTerms=13629
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _q numDocs=13629
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=119621632 newFlushedSize=55323613
docs/MB=258.317 new/old=46.249%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [27 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [27 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 27 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 27 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=111.958 allocMB=118.677
deletesMB=88.051 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_r docStoreSegment=_0
docStoreOffset=619400 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=15237 numBufDelTerms=15237
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _r numDocs=15237
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=117396480 newFlushedSize=50844181
docs/MB=314.238 new/old=43.31%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [28 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [28 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 28 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 28 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=109.855 allocMB=118.677
deletesMB=90.152 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_s docStoreSegment=_0
docStoreOffset=634637 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=15104 numBufDelTerms=15104
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _s numDocs=15104
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=115191808 newFlushedSize=50137876
docs/MB=315.883 new/old=43.526%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [29 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [29 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 29 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 29 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=107.847 vs
trigger=200 allocMB=118.677 deletesMB=92.154 vs trigger=210 byteBlockFree=8
charBlockFree=0.656
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=10.768 usedMB=200.001
allocMB=107.909
IW 0 [UpdWriterBuild]:   flush: segment=_t docStoreSegment=_0
docStoreOffset=649741 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=14397 numBufDelTerms=14397
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _t numDocs=14397
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=113085440 newFlushedSize=49053320
docs/MB=307.754 new/old=43.377%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [30 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [30 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 30 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 30 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=105.897 allocMB=107.909
deletesMB=94.132 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_u docStoreSegment=_0
docStoreOffset=664138 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=14221 numBufDelTerms=14221
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _u numDocs=14221
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=111041536 newFlushedSize=48043942
docs/MB=310.378 new/old=43.267%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [31 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [31 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 31 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 31 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=104.006 allocMB=107.909
deletesMB=96.025 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_v docStoreSegment=_0
docStoreOffset=678359 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=13609 numBufDelTerms=13609
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _v numDocs=13609
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=109058048 newFlushedSize=46890005
docs/MB=304.331 new/old=42.995%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [32 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [32 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 32 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 32 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=102.099 allocMB=107.909
deletesMB=97.926 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_w docStoreSegment=_0
docStoreOffset=691968 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=13667 numBufDelTerms=13667
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _w numDocs=13667
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=107058176 newFlushedSize=46115445
docs/MB=310.761 new/old=43.075%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [33 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [33 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 33 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 33 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=100.259 allocMB=107.909
deletesMB=99.752 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_x docStoreSegment=_0
docStoreOffset=705635 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=13127 numBufDelTerms=13127
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _x numDocs=13127
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=105128960 newFlushedSize=45460919
docs/MB=302.78 new/old=43.243%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [34 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [34 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 34 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 34 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=97.644 vs
trigger=200 allocMB=107.909 deletesMB=102.378 vs trigger=210
byteBlockFree=5.375 charBlockFree=0.969
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=10.203 usedMB=200.022
allocMB=97.706
IW 0 [UpdWriterBuild]:   flush: segment=_y docStoreSegment=_0
docStoreOffset=718762 flushDocs=true flushDeletes=true flushDocStores=false
numDocs=18883 numBufDelTerms=18883
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _y numDocs=18883
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=102386688 newFlushedSize=46293479
docs/MB=427.712 new/old=45.214%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [35 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: DW: apply 737645 buffered deleted terms and 0 deleted
docIDs and 0 deleted queries on 35 segments.
IFD [UpdWriterBuild]: now checkpoint "segments_1" [35 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 35 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 35 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=195.476 allocMB=195.538
deletesMB=4.545 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_z docStoreSegment=_0
docStoreOffset=737645 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=32665 numBufDelTerms=32665
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _z numDocs=32665
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=204971008 newFlushedSize=100761432
docs/MB=339.929 new/old=49.159%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [36 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [36 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 36 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 36 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=191.292 allocMB=195.538
deletesMB=8.724 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_10 docStoreSegment=_0
docStoreOffset=770310 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=30048 numBufDelTerms=30048
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _10 numDocs=30048
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=200584192 newFlushedSize=98136465
docs/MB=321.059 new/old=48.925%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [37 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [37 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 37 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 37 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=187.273 allocMB=195.538
deletesMB=12.746 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_11 docStoreSegment=_0
docStoreOffset=800358 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=28918 numBufDelTerms=28918
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _11 numDocs=28918
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=196370432 newFlushedSize=96499609
docs/MB=314.226 new/old=49.142%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [38 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [38 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 38 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 38 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=183.367 vs
trigger=200 allocMB=195.538 deletesMB=16.649 vs trigger=210
byteBlockFree=4.906 charBlockFree=1.875
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=12.108 usedMB=200.016
allocMB=183.43
IW 0 [UpdWriterBuild]:   flush: segment=_12 docStoreSegment=_0
docStoreOffset=829276 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=28061 numBufDelTerms=28061
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _12 numDocs=28061
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=192274432 newFlushedSize=94559844
docs/MB=311.169 new/old=49.18%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [39 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [39 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 39 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 39 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=179.492 allocMB=183.43
deletesMB=20.537 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_13 docStoreSegment=_0
docStoreOffset=857337 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=27951 numBufDelTerms=27951
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _13 numDocs=27951
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=188211200 newFlushedSize=93129403
docs/MB=314.71 new/old=49.481%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [40 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [40 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 40 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 40 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=175.89 allocMB=183.43
deletesMB=24.113 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_14 docStoreSegment=_0
docStoreOffset=885288 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=25719 numBufDelTerms=25719
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _14 numDocs=25719
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=184433664 newFlushedSize=88513536
docs/MB=304.68 new/old=47.992%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [41 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [41 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 41 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 41 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=172.465 vs
trigger=200 allocMB=183.43 deletesMB=27.537 vs trigger=210
byteBlockFree=6.844 charBlockFree=1.156
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=10.902 usedMB=200.002
allocMB=172.527
IW 0 [UpdWriterBuild]:   flush: segment=_15 docStoreSegment=_0
docStoreOffset=911007 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=24619 numBufDelTerms=24619
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _15 numDocs=24619
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=180842496 newFlushedSize=86360225
docs/MB=298.921 new/old=47.754%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [42 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [42 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 42 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 42 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=169.036 allocMB=172.527
deletesMB=30.977 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_16 docStoreSegment=_0
docStoreOffset=935626 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=24737 numBufDelTerms=24737
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _16 numDocs=24737
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=177247232 newFlushedSize=85372240
docs/MB=303.83 new/old=48.166%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [43 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [43 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 43 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 43 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=165.696 allocMB=172.527
deletesMB=34.319 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_17 docStoreSegment=_0
docStoreOffset=960363 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=24024 numBufDelTerms=24024
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _17 numDocs=24024
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=173745152 newFlushedSize=82676131
docs/MB=304.695 new/old=47.585%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [44 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [44 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 44 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 44 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations: usedMB=162.496 vs
trigger=200 allocMB=172.527 deletesMB=37.53 vs trigger=210
byteBlockFree=4.562 charBlockFree=1.25
IW 0 [UpdWriterBuild]: DW:     nothing to free
IW 0 [UpdWriterBuild]: DW:     after free: freedMB=9.969 usedMB=200.026
allocMB=162.559
IW 0 [UpdWriterBuild]:   flush: segment=_18 docStoreSegment=_0
docStoreOffset=984387 flushDocs=true flushDeletes=false flushDocStores=false
numDocs=23092 numBufDelTerms=23092
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _18 numDocs=23092
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=170389504 newFlushedSize=81162275
docs/MB=298.337 new/old=47.633%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [45 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [45 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 45 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 45 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=159.453 allocMB=162.559
deletesMB=40.549 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_19 docStoreSegment=_0
docStoreOffset=1007479 flushDocs=true flushDeletes=false
flushDocStores=false numDocs=21704 numBufDelTerms=21704
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _19 numDocs=21704
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=167198720 newFlushedSize=79555567
docs/MB=286.068 new/old=47.581%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [46 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [46 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 46 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 46 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0 _19:C21704->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=156.562 allocMB=162.559
deletesMB=43.501 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_1a docStoreSegment=_0
docStoreOffset=1029183 flushDocs=true flushDeletes=false
flushDocStores=false numDocs=21226 numBufDelTerms=21226
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0 _19:C21704->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _1a numDocs=21226
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=164167680 newFlushedSize=77585028
docs/MB=286.873 new/old=47.26%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [47 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [47 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 47 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 47 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=153.64 allocMB=162.559
deletesMB=46.374 triggerMB=200
IW 0 [UpdWriterBuild]:   flush: segment=_1b docStoreSegment=_0
docStoreOffset=1050409 flushDocs=true flushDeletes=false
flushDocStores=false numDocs=20658 numBufDelTerms=20658
IW 0 [UpdWriterBuild]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0
IW 0 [UpdWriterBuild]: DW: flush postings as segment _1b numDocs=20658
IW 0 [UpdWriterBuild]: DW:   oldRAMSize=161102848 newFlushedSize=76244155
docs/MB=284.107 new/old=47.326%
IFD [UpdWriterBuild]: now checkpoint "segments_1" [48 segments ; isCommit =
false]
IFD [UpdWriterBuild]: now checkpoint "segments_1" [48 segments ; isCommit =
false]
IW 0 [UpdWriterBuild]: LMP: findMerges: 48 segments
IW 0 [UpdWriterBuild]: LMP:   level 3.982974 to 4.732974: 48 segments
IW 0 [UpdWriterBuild]: CMS: now merge
IW 0 [UpdWriterBuild]: CMS:   index: _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0
_1b:C20658->_0
IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
IW 0 [Indexer]: now flush at close
IW 0 [Indexer]:   flush: segment=_1c docStoreSegment=_0
docStoreOffset=1071067 flushDocs=true flushDeletes=true flushDocStores=true
numDocs=6343 numBufDelTerms=6343
IW 0 [Indexer]:   index before flush _0:C32607->_0 _1:C29043->_0
_2:C28376->_0 _3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0
_7:C30328->_0 _8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0
_c:C25826->_0 _d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0
_h:C20403->_0 _i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0
_m:C14772->_0 _n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0
_r:C15237->_0 _s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0
_w:C13667->_0 _x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0
_11:C28918->_0 _12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0
_16:C24737->_0 _17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0
_1b:C20658->_0
IW 0 [Indexer]:   flush shared docStore segment _0
IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
numDocs=1077410
IW 0 [Indexer]: DW: flush postings as segment _1c numDocs=6343
IW 0 [Indexer]: DW:   oldRAMSize=62278656 newFlushedSize=22983684
docs/MB=289.384 new/old=36.905%
IFD [Indexer]: now checkpoint "segments_1" [49 segments ; isCommit = false]
IW 0 [Indexer]: DW: apply 339765 buffered deleted terms and 0 deleted docIDs
and 0 deleted queries on 49 segments.
IFD [Indexer]: now checkpoint "segments_1" [49 segments ; isCommit = false]
IW 0 [Indexer]: LMP: findMerges: 49 segments
IW 0 [Indexer]: LMP:   level 3.982974 to 4.732974: 49 segments
IW 0 [Indexer]: CMS: now merge
IW 0 [Indexer]: CMS:   index: _0:C32607->_0 _1:C29043->_0 _2:C28376->_0
_3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0 _7:C30328->_0
_8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0 _c:C25826->_0
_d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0 _h:C20403->_0
_i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0 _m:C14772->_0
_n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0 _r:C15237->_0
_s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0 _w:C13667->_0
_x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0 _11:C28918->_0
_12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0 _16:C24737->_0
_17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0 _1b:C20658->_0
_1c:C6343->_0
IW 0 [Indexer]: CMS:   no more merges pending; now return
IW 0 [Indexer]: CMS: now merge
IW 0 [Indexer]: CMS:   index: _0:C32607->_0 _1:C29043->_0 _2:C28376->_0
_3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0 _7:C30328->_0
_8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0 _c:C25826->_0
_d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0 _h:C20403->_0
_i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0 _m:C14772->_0
_n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0 _r:C15237->_0
_s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0 _w:C13667->_0
_x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0 _11:C28918->_0
_12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0 _16:C24737->_0
_17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0 _1b:C20658->_0
_1c:C6343->_0
IW 0 [Indexer]: CMS:   no more merges pending; now return
IW 0 [Indexer]: now call final commit()
IW 0 [Indexer]: startCommit(): start sizeInBytes=0
IW 0 [Indexer]: startCommit index=_0:C32607->_0 _1:C29043->_0 _2:C28376->_0
_3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0 _7:C30328->_0
_8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0 _c:C25826->_0
_d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0 _h:C20403->_0
_i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0 _m:C14772->_0
_n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0 _r:C15237->_0
_s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0 _w:C13667->_0
_x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0 _11:C28918->_0
_12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0 _16:C24737->_0
_17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0 _1b:C20658->_0
_1c:C6343->_0 changeCount=147
IW 0 [Indexer]: now sync _9.tis
IW 0 [Indexer]: now sync _8.tis
IW 0 [Indexer]: now sync _d.tii
IW 0 [Indexer]: now sync _q.prx
IW 0 [Indexer]: now sync _15.frq
IW 0 [Indexer]: now sync _9.tii
IW 0 [Indexer]: now sync _c.tii
IW 0 [Indexer]: now sync _k.fnm
IW 0 [Indexer]: now sync _7.fnm
IW 0 [Indexer]: now sync _17.frq
IW 0 [Indexer]: now sync _4.frq
IW 0 [Indexer]: now sync _7.tis
IW 0 [Indexer]: now sync _c.tis
IW 0 [Indexer]: now sync _10.tii
IW 0 [Indexer]: now sync _y.nrm
IW 0 [Indexer]: now sync _13.fnm
IW 0 [Indexer]: now sync _d.tis
IW 0 [Indexer]: now sync _w.fnm
IW 0 [Indexer]: now sync _u.tii
IW 0 [Indexer]: now sync _10.tis
IW 0 [Indexer]: now sync _a.prx
IW 0 [Indexer]: now sync _2.prx
IW 0 [Indexer]: now sync _u.tis
IW 0 [Indexer]: now sync _7.tii
IW 0 [Indexer]: now sync _8.frq
IW 0 [Indexer]: now sync _2.frq
IW 0 [Indexer]: now sync _h.frq
IW 0 [Indexer]: now sync _18.tis
IW 0 [Indexer]: now sync _15.tis
IW 0 [Indexer]: now sync _10.prx
IW 0 [Indexer]: now sync _14.frq
IW 0 [Indexer]: now sync _8.tii
IW 0 [Indexer]: now sync _g.nrm
IW 0 [Indexer]: now sync _15.tii
IW 0 [Indexer]: now sync _18.tii
IW 0 [Indexer]: now sync _0.frq
IW 0 [Indexer]: now sync _a.fnm
IW 0 [Indexer]: now sync _2.nrm
IW 0 [Indexer]: now sync _r.nrm
IW 0 [Indexer]: now sync _y.tis
IW 0 [Indexer]: now sync _1b.prx
IW 0 [Indexer]: now sync _1a.fnm
IW 0 [Indexer]: now sync _t.frq
IW 0 [Indexer]: now sync _y.tii
IW 0 [Indexer]: now sync _6.tis
IW 0 [Indexer]: now sync _m.tis
IW 0 [Indexer]: now sync _p.tii
IW 0 [Indexer]: now sync _v.prx
IW 0 [Indexer]: now sync _m.tii
IW 0 [Indexer]: now sync _y.fnm
IW 0 [Indexer]: now sync _g.prx
IW 0 [Indexer]: now sync _x.fnm
IW 0 [Indexer]: now sync _p.tis
IW 0 [Indexer]: now sync _z.prx
IW 0 [Indexer]: now sync _15.nrm
IW 0 [Indexer]: now sync _i.frq
IW 0 [Indexer]: now sync _10.frq
IW 0 [Indexer]: now sync _4.nrm
IW 0 [Indexer]: now sync _6.tii
IW 0 [Indexer]: now sync _5.frq
IW 0 [Indexer]: now sync _g.frq
IW 0 [Indexer]: now sync _2.fnm
IW 0 [Indexer]: now sync _b.frq
IW 0 [Indexer]: now sync _1a.prx
IW 0 [Indexer]: now sync _x.prx
IW 0 [Indexer]: now sync _18.fnm
IW 0 [Indexer]: now sync _a.nrm
IW 0 [Indexer]: now sync _1b.frq
IW 0 [Indexer]: now sync _f.tis
IW 0 [Indexer]: now sync _0.tis
IW 0 [Indexer]: now sync _g.tis
IW 0 [Indexer]: now sync _1a.tis
IW 0 [Indexer]: now sync _5.prx
IW 0 [Indexer]: now sync _1c.nrm
IW 0 [Indexer]: now sync _15.prx
IW 0 [Indexer]: now sync _m.prx
IW 0 [Indexer]: now sync _1a.tii
IW 0 [Indexer]: now sync _4.prx
IW 0 [Indexer]: now sync _12.tii
IW 0 [Indexer]: now sync _i.tis
IW 0 [Indexer]: now sync _o.prx
IW 0 [Indexer]: now sync _5.nrm
IW 0 [Indexer]: now sync _p.nrm
IW 0 [Indexer]: now sync _g.tii
IW 0 [Indexer]: now sync _7.frq
IW 0 [Indexer]: now sync _i.tii
IW 0 [Indexer]: now sync _12.tis
IW 0 [Indexer]: now sync _f.tii
IW 0 [Indexer]: now sync _s.nrm
IW 0 [Indexer]: now sync _e.fnm
IW 0 [Indexer]: now sync _m.fnm
IW 0 [Indexer]: now sync _o.fnm
IW 0 [Indexer]: now sync _h.fnm
IW 0 [Indexer]: now sync _19.fnm
IW 0 [Indexer]: now sync _h.tis
IW 0 [Indexer]: now sync _j.tis
IW 0 [Indexer]: now sync _u.nrm
IW 0 [Indexer]: now sync _0.tii
IW 0 [Indexer]: now sync _h.tii
IW 0 [Indexer]: now sync _j.tii
IW 0 [Indexer]: now sync _q.fnm
IW 0 [Indexer]: now sync _14.fnm
IW 0 [Indexer]: now sync _6.nrm
IW 0 [Indexer]: now sync _16.tii
IW 0 [Indexer]: now sync _x.nrm
IW 0 [Indexer]: now sync _3.tii
IW 0 [Indexer]: now sync _1c.tii
IW 0 [Indexer]: now sync _t.fnm
IW 0 [Indexer]: now sync _1a.frq
IW 0 [Indexer]: now sync _6.frq
IW 0 [Indexer]: now sync _u.frq
IW 0 [Indexer]: now sync _e.tis
IW 0 [Indexer]: now sync _b.nrm
IW 0 [Indexer]: now sync _s.fnm
IW 0 [Indexer]: now sync _w.prx
IW 0 [Indexer]: now sync _t.prx
IW 0 [Indexer]: now sync _s.tii
IW 0 [Indexer]: now sync _e.tii
IW 0 [Indexer]: now sync _14.nrm
IW 0 [Indexer]: now sync _l.tis
IW 0 [Indexer]: now sync _l.tii
IW 0 [Indexer]: now sync _16.tis
IW 0 [Indexer]: now sync _n.nrm
IW 0 [Indexer]: now sync _10.fnm
IW 0 [Indexer]: now sync _5.fnm
IW 0 [Indexer]: now sync _b.prx
IW 0 [Indexer]: now sync _n.prx
IW 0 [Indexer]: now sync _x.frq
IW 0 [Indexer]: now sync _14.tis
IW 0 [Indexer]: now sync _b.tis
IW 0 [Indexer]: now sync _11.frq
IW 0 [Indexer]: now sync _12.nrm
IW 0 [Indexer]: now sync _b.tii
IW 0 [Indexer]: now sync _1c.tis
IW 0 [Indexer]: now sync _14.tii
IW 0 [Indexer]: now sync _8.prx
IW 0 [Indexer]: now sync _s.tis
IW 0 [Indexer]: now sync _18.frq
IW 0 [Indexer]: now sync _6.prx
IW 0 [Indexer]: now sync _b.fnm
IW 0 [Indexer]: now sync _3.tis
IW 0 [Indexer]: now sync _z.frq
IW 0 [Indexer]: now sync _1.frq
IW 0 [Indexer]: now sync _a.tii
IW 0 [Indexer]: now sync _e.frq
IW 0 [Indexer]: now sync _m.frq
IW 0 [Indexer]: now sync _2.tii
IW 0 [Indexer]: now sync _17.prx
IW 0 [Indexer]: now sync _14.prx
IW 0 [Indexer]: now sync _7.nrm
IW 0 [Indexer]: now sync _n.frq
IW 0 [Indexer]: now sync _18.prx
IW 0 [Indexer]: now sync _c.nrm
IW 0 [Indexer]: now sync _q.nrm
IW 0 [Indexer]: now sync _17.nrm
IW 0 [Indexer]: now sync _v.fnm
IW 0 [Indexer]: now sync _16.frq
IW 0 [Indexer]: now sync _x.tis
IW 0 [Indexer]: now sync _a.tis
IW 0 [Indexer]: now sync _o.frq
IW 0 [Indexer]: now sync _d.frq
IW 0 [Indexer]: now sync _l.nrm
IW 0 [Indexer]: now sync _13.prx
IW 0 [Indexer]: now sync _9.prx
IW 0 [Indexer]: now sync _l.prx
IW 0 [Indexer]: now sync _c.prx
IW 0 [Indexer]: now sync _q.frq
IW 0 [Indexer]: now sync _x.tii
IW 0 [Indexer]: now sync _z.nrm
IW 0 [Indexer]: now sync _2.tis
IW 0 [Indexer]: now sync _11.prx
IW 0 [Indexer]: now sync _19.frq
IW 0 [Indexer]: now sync _c.frq
IW 0 [Indexer]: now sync _12.frq
IW 0 [Indexer]: now sync _k.prx
IW 0 [Indexer]: now sync _l.frq
IW 0 [Indexer]: now sync _3.fnm
IW 0 [Indexer]: now sync _p.frq
IW 0 [Indexer]: now sync _v.tis
IW 0 [Indexer]: now sync _n.tis
IW 0 [Indexer]: now sync _18.nrm
IW 0 [Indexer]: now sync _r.fnm
IW 0 [Indexer]: now sync _1b.nrm
IW 0 [Indexer]: now sync _u.fnm
IW 0 [Indexer]: now sync _k.nrm
IW 0 [Indexer]: now sync _1a.nrm
IW 0 [Indexer]: now sync _j.nrm
IW 0 [Indexer]: now sync _1b.tis
IW 0 [Indexer]: now sync _1c.frq
IW 0 [Indexer]: now sync _1.tii
IW 0 [Indexer]: now sync _n.tii
IW 0 [Indexer]: now sync _q.tis
IW 0 [Indexer]: now sync _j.prx
IW 0 [Indexer]: now sync _e.nrm
IW 0 [Indexer]: now sync _1b.tii
IW 0 [Indexer]: now sync _1.tis
IW 0 [Indexer]: now sync _q.tii
IW 0 [Indexer]: now sync _19.nrm
IW 0 [Indexer]: now sync _16.prx
IW 0 [Indexer]: now sync _9.fnm
IW 0 [Indexer]: now sync _12.prx
IW 0 [Indexer]: now sync _m.nrm
IW 0 [Indexer]: now sync _y.prx
IW 0 [Indexer]: now sync _v.nrm
IW 0 [Indexer]: now sync _d.prx
IW 0 [Indexer]: now sync _13.tis
IW 0 [Indexer]: now sync _r.prx
IW 0 [Indexer]: now sync _8.nrm
IW 0 [Indexer]: now sync _19.prx
IW 0 [Indexer]: now sync _o.nrm
IW 0 [Indexer]: now sync _11.fnm
IW 0 [Indexer]: now sync _v.tii
IW 0 [Indexer]: now sync _13.tii
IW 0 [Indexer]: now sync _d.nrm
IW 0 [Indexer]: now sync _6.fnm
IW 0 [Indexer]: now sync _c.fnm
IW 0 [Indexer]: now sync _13.frq
IW 0 [Indexer]: now sync _j.frq
IW 0 [Indexer]: now sync _f.frq
IW 0 [Indexer]: now sync _p.prx
IW 0 [Indexer]: now sync _16.nrm
IW 0 [Indexer]: now sync _h.prx
IW 0 [Indexer]: now sync _r.tii
IW 0 [Indexer]: now sync _4.fnm
IW 0 [Indexer]: now sync _19.tii
IW 0 [Indexer]: now sync _z.fnm
IW 0 [Indexer]: now sync _1.fnm
IW 0 [Indexer]: now sync _h.nrm
IW 0 [Indexer]: now sync _o.tis
IW 0 [Indexer]: now sync _19.tis
IW 0 [Indexer]: now sync _k.tii
IW 0 [Indexer]: now sync _v.frq
IW 0 [Indexer]: now sync _16.fnm
IW 0 [Indexer]: now sync _5.tis
IW 0 [Indexer]: now sync _w.tii
IW 0 [Indexer]: now sync _t.tis
IW 0 [Indexer]: now sync _15.fnm
IW 0 [Indexer]: now sync _0.prx
IW 0 [Indexer]: now sync _n.fnm
IW 0 [Indexer]: now sync _k.tis
IW 0 [Indexer]: now sync _w.tis
IW 0 [Indexer]: now sync _3.nrm
IW 0 [Indexer]: now sync _f.nrm
IW 0 [Indexer]: now sync _w.frq
IW 0 [Indexer]: now sync _0.fnm
IW 0 [Indexer]: now sync _t.tii
IW 0 [Indexer]: now sync _a.frq
IW 0 [Indexer]: now sync _s.prx
IW 0 [Indexer]: now sync _d.fnm
IW 0 [Indexer]: now sync _3.prx
IW 0 [Indexer]: now sync _17.fnm
IW 0 [Indexer]: now sync _5.tii
IW 0 [Indexer]: now sync _s.frq
IW 0 [Indexer]: now sync _1.prx
IW 0 [Indexer]: now sync _8.fnm
IW 0 [Indexer]: now sync _f.prx
IW 0 [Indexer]: now sync _12.fnm
IW 0 [Indexer]: now sync _u.prx
IW 0 [Indexer]: now sync _o.tii
IW 0 [Indexer]: now sync _t.nrm
IW 0 [Indexer]: now sync _e.prx
IW 0 [Indexer]: now sync _r.tis
IW 0 [Indexer]: now sync _1.nrm
IW 0 [Indexer]: now sync _i.prx
IW 0 [Indexer]: now sync _17.tis
IW 0 [Indexer]: now sync _i.nrm
IW 0 [Indexer]: now sync _3.frq
IW 0 [Indexer]: now sync _11.tii
IW 0 [Indexer]: now sync _z.tii
IW 0 [Indexer]: now sync _l.fnm
IW 0 [Indexer]: now sync _9.nrm
IW 0 [Indexer]: now sync _p.fnm
IW 0 [Indexer]: now sync _13.nrm
IW 0 [Indexer]: now sync _y.frq
IW 0 [Indexer]: now sync _11.tis
IW 0 [Indexer]: now sync _z.tis
IW 0 [Indexer]: now sync _g.fnm
IW 0 [Indexer]: now sync _1c.fnm
IW 0 [Indexer]: now sync _11.nrm
IW 0 [Indexer]: now sync _w.nrm
IW 0 [Indexer]: now sync _r.frq
IW 0 [Indexer]: now sync _4.tis
IW 0 [Indexer]: now sync _17.tii
IW 0 [Indexer]: now sync _0.nrm
IW 0 [Indexer]: now sync _4.tii
IW 0 [Indexer]: now sync _1b.fnm
IW 0 [Indexer]: now sync _1c.prx
IW 0 [Indexer]: now sync _9.frq
IW 0 [Indexer]: now sync _7.prx
IW 0 [Indexer]: now sync _f.fnm
IW 0 [Indexer]: now sync _j.fnm
IW 0 [Indexer]: now sync _0.fdx
IW 0 [Indexer]: now sync _10.nrm
IW 0 [Indexer]: now sync _k.frq
IW 0 [Indexer]: now sync _i.fnm
IW 0 [Indexer]: now sync _0.fdt
IW 0 [Indexer]: done all syncs
IW 0 [Indexer]: commit: pendingCommit != null
IW 0 [Indexer]: commit: wrote segments file "segments_2"
IFD [Indexer]: now checkpoint "segments_2" [49 segments ; isCommit = true]
IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
IFD [Indexer]: delete "segments_1"
IW 0 [Indexer]: commit: done
IW 0 [Indexer]: at close: _0:C32607->_0 _1:C29043->_0 _2:C28376->_0
_3:C26936->_0 _4:C24129->_0 _5:C28737->_0 _6:C31930->_0 _7:C30328->_0
_8:C29899->_0 _9:C29256->_0 _a:C28152->_0 _b:C28085->_0 _c:C25826->_0
_d:C24897->_0 _e:C23703->_0 _f:C22817->_0 _g:C22048->_0 _h:C20403->_0
_i:C15832->_0 _j:C15530->_0 _k:C15154->_0 _l:C15143->_0 _m:C14772->_0
_n:C14553->_0 _o:C13915->_0 _p:C13700->_0 _q:C13629->_0 _r:C15237->_0
_s:C15104->_0 _t:C14397->_0 _u:C14221->_0 _v:C13609->_0 _w:C13667->_0
_x:C13127->_0 _y:C18883->_0 _z:C32665->_0 _10:C30048->_0 _11:C28918->_0
_12:C28061->_0 _13:C27951->_0 _14:C25719->_0 _15:C24619->_0 _16:C24737->_0
_17:C24024->_0 _18:C23092->_0 _19:C21704->_0 _1a:C21226->_0 _1b:C20658->_0
_1c:C6343->_0


Peter

On Wed, Oct 28, 2009 at 5:23 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> The unit tests do test multi-segment indexes (though we could always
> use deeper testing, here), but, don't test big-ish indexes, like this,
> very well.
>
> Are you also using JDK 1.6.0_16 when running CheckIndex?  If you run
> CheckIndex on the same index several times in a row, does it report
> precisely the same problems?
>
> This exception in CheckIndex is very odd: it checks whether the
> docFreq reported for each term in the TermEnum actually matches the
> number of docs that it was able to iterate through using the
> TermPositions.  The reason why it's very odd is that under the hood
> TermPositions is supposed to be using the very same source of docFreq,
> to figure out how many docs it's supposed to read.  It may not be
> index corruption but rather a bug somewhere in CheckIndex, or, in the
> APIs its using.
>
> What settings are you using in your IndexWriter (that differ from its
> defaults)?  If you eg increase the frequency of flushing, can you get
> this error to happen with a smaller number of docs added?  Just trying
> to box the issue in...
>
> Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52" mean?
>
> Mike
>
> On Tue, Oct 27, 2009 at 4:10 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > Without the optimize, it looks like there are errors on all segments
> except
> > the first:
> >
> > Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
> >
> > Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS [Lucene
> > 2.9]
> >  1 of 3: name=_0 docCount=413557
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=1,148.795
> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
> > exported - 2009-10-27 15:31:52, source=flush, os.arch=amd64,
> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=0
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...OK [7704599 terms; 180318249 terms/docs
> pairs;
> > 340258711 tokens]
> >    test: stored fields.......OK [1240671 total field count; avg 3 fields
> > per doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> >
> >  2 of 3: name=_1 docCount=359203
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=1,125.103
> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
> > exported - 2009-10-27 15:31:52, source=flush, os.arch=amd64,
> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=413557
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...ERROR [term literals:cfid196$ docFreq=43 !=
> > num docs seen 4 + num docs deleted 0]
> > java.lang.RuntimeException: term literals:cfid196$ docFreq=43 != num docs
> > seen 4 + num docs deleted 0
> >    at
> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >    test: stored fields.......OK [1077609 total field count; avg 3 fields
> > per doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> > FAILED
> >    WARNING: fixIndex() would remove reference to this segment; full
> > exception:
> > java.lang.RuntimeException: Term Index test failed
> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >
> >  3 of 3: name=_2 docCount=304659
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=961.764
> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9
> > exported - 2009-10-27 15:31:52, source=flush, os.arch=amd64,
> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=772760
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num docs
> > seen 245 + num docs deleted 0]
> > java.lang.RuntimeException: term contents:? docFreq=1 != num docs seen
> 245 +
> > num docs deleted 0
> >    at
> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >    test: stored fields.......OK [913977 total field count; avg 3 fields
> per
> > doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> > FAILED
> >    WARNING: fixIndex() would remove reference to this segment; full
> > exception:
> > java.lang.RuntimeException: Term Index test failed
> >    at org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >
> > WARNING: 2 broken segments (containing 663862 documents) detected
> > WARNING: would write new segments file, and 663862 documents would be
> lost,
> > if -fix were specified
> >
> >
> > Do the unit tests create multi-segment indexes?
> >
> > Peter
> >
> > On Tue, Oct 27, 2009 at 3:08 PM, Peter Keegan <peterlkeegan@gmail.com
> >wrote:
> >
> >> It's reproducible with a large no. of docs (>1 million), but not with
> 100K
> >> docs.
> >> I got same error with jvm 1.6.0_16.
> >> The index was optimized after all docs are added. I'll try removing the
> >> optimize.
> >>
> >> Peter
> >>
> >>
> >> On Tue, Oct 27, 2009 at 2:57 PM, Michael McCandless <
> >> lucene@mikemccandless.com> wrote:
> >>
> >>> This is odd -- is it reproducible?
> >>>
> >>> Can you narrow it down to a small set of docs that when indexed
> >>> produce a corrupted index?
> >>>
> >>> If you attempt to optimize the index, does it fail?
> >>>
> >>> Mike
> >>>
> >>> On Tue, Oct 27, 2009 at 1:40 PM, Peter Keegan <peterlkeegan@gmail.com>
> >>> wrote:
> >>> > It seems the index is corrupted immediately after the initial build
> >>> (ample
> >>> > disk space was provided):
> >>> >
> >>> > Output from CheckIndex:
> >>> >
> >>> > Opening index @
> >>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.2
> >>> >
> >>> > Segments file=segments_3 numSegments=1 version=FORMAT_DIAGNOSTICS
> >>> [Lucene
> >>> > 2.9]
> >>> >  1 of 1: name=_7 docCount=1077025
> >>> >    compound=false
> >>> >    hasProx=true
> >>> >    numFiles=8
> >>> >    size (MB)=3,201.196
> >>> >    diagnostics = {optimize=true, mergeFactor=7, os.version=5.2,
> >>> os=Windows
> >>> > 2003, mergeDocStores=false, lucene.version=2.9 exported - 2009-10-26
> >>> > 07:58:55, source=merge, os.arch=amd64, java.version=1.6.0_03,
> >>> > java.vendor=Sun Microsystems Inc.}
> >>> >    docStoreOffset=0
> >>> >    docStoreSegment=_0
> >>> >    docStoreIsCompoundFile=false
> >>> >    no deletions
> >>> >    test: open reader.........OK
> >>> >    test: fields..............OK [33 fields]
> >>> >    test: field norms.........OK [33 fields]
> >>> >    test: terms, freq, prox...ERROR [term contents:? docFreq=1 != num
> >>> docs
> >>> > seen 482 + num docs deleted 0]
> >>> > java.lang.RuntimeException: term contents:? docFreq=1 != num docs
> seen
> >>> 482 +
> >>> > num docs deleted 0
> >>> >    at
> >>> org.apache.lucene.index.CheckIndex.testTermIndex(CheckIndex.java:675)
> >>> >    at
> org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:530)
> >>> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >>> >    test: stored fields.......OK [3231075 total field count; avg 3
> fields
> >>> > per doc]
> >>> >    test: term vectors........OK [0 total vector count; avg 0
> term/freq
> >>> > vector fields per doc]
> >>> > FAILED
> >>> >    WARNING: fixIndex() would remove reference to this segment; full
> >>> > exception:
> >>> > java.lang.RuntimeException: Term Index test failed
> >>> >    at
> org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:543)
> >>> >    at org.apache.lucene.index.CheckIndex.main(CheckIndex.java:903)
> >>> >
> >>> > WARNING: 1 broken segments (containing 1077025 documents) detected
> >>> > WARNING: would write new segments file, and 1077025 documents would
> be
> >>> lost,
> >>> > if -fix were specified
> >>> >
> >>> > Searching on this index seems to be fine, though.
> >>> >
> >>> > Here is the IndexWriter log from the build:
> >>> >
> >>> > IFD [Indexer]: setInfoStream
> >>> >
> >>>
> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@2a9cfec1
> >>> > IW 0 [Indexer]: setInfoStream:
> >>> > dir=org.apache.lucene.store.SimpleFSDirectory@D
> >>> :\mnsavs\lresumes1\lresumes1.luc\lresumes1.update.main.2
> >>> > autoCommit=false
> >>> >
> >>>
> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@291946c2mergeScheduler
> >>>
> =org.apache.lucene.index.ConcurrentMergeScheduler@3a747fa2ramBufferSizeMB
> >>> =16.0
> >>> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
> >>> > maxFieldLength=2147483647 index=
> >>> > IW 0 [Indexer]: setRAMBufferSizeMB 910.25
> >>> > IW 0 [Indexer]: setMaxBufferedDocs 1000000
> >>> > IW 0 [Indexer]: flush at getReader
> >>> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=null
> >>> docStoreOffset=0
> >>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> >>> > numBufDelTerms=0
> >>> > IW 0 [Indexer]:   index before flush
> >>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=886.463
> >>> allocMB=886.463
> >>> > deletesMB=23.803 triggerMB=910.25
> >>> > IW 0 [UpdWriterBuild]:   flush: segment=_0 docStoreSegment=_0
> >>> > docStoreOffset=0 flushDocs=true flushDeletes=false
> flushDocStores=false
> >>> > numDocs=171638 numBufDelTerms=171638
> >>> > IW 0 [UpdWriterBuild]:   index before flush
> >>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _0
> numDocs=171638
> >>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=929523712
> >>> newFlushedSize=573198529
> >>> > docs/MB=313.985 new/old=61.666%
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [1 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 1 segments
> >>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 1 segments
> >>> > IW 0 [UpdWriterBuild]: CMS: now merge
> >>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0
> >>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> >>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=857.977
> >>> allocMB=901.32
> >>> > deletesMB=52.274 triggerMB=910.25
> >>> > IW 0 [UpdWriterBuild]:   flush: segment=_1 docStoreSegment=_0
> >>> > docStoreOffset=171638 flushDocs=true flushDeletes=false
> >>> flushDocStores=false
> >>> > numDocs=204995 numBufDelTerms=204995
> >>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
> >>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _1
> numDocs=204995
> >>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=899653632
> >>> newFlushedSize=544283851
> >>> > docs/MB=394.928 new/old=60.499%
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [2 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 2 segments
> >>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 2 segments
> >>> > IW 0 [UpdWriterBuild]: CMS: now merge
> >>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> >>> > IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations:
> >>> usedMB=834.645 vs
> >>> > trigger=910.25 allocMB=901.32 deletesMB=75.627 vs trigger=955.762
> >>> > byteBlockFree=35.938 charBlockFree=8.938
> >>> > IW 0 [UpdWriterBuild]: DW:     nothing to free
> >>> > IW 0 [UpdWriterBuild]: DW:     after free: freedMB=66.613
> usedMB=910.272
> >>> > allocMB=834.707
> >>> > IW 0 [UpdWriterBuild]:   flush: segment=_2 docStoreSegment=_0
> >>> > docStoreOffset=376633 flushDocs=true flushDeletes=false
> >>> flushDocStores=false
> >>> > numDocs=168236 numBufDelTerms=168236
> >>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
> >>> _1:C204995->_0
> >>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _2
> numDocs=168236
> >>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=875188224
> >>> newFlushedSize=530720464
> >>> > docs/MB=332.394 new/old=60.641%
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [3 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 3 segments
> >>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 3 segments
> >>> > IW 0 [UpdWriterBuild]: CMS: now merge
> >>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0
> >>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> >>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=814.282
> >>> allocMB=835.832
> >>> > deletesMB=95.997 triggerMB=910.25
> >>> > IW 0 [UpdWriterBuild]:   flush: segment=_3 docStoreSegment=_0
> >>> > docStoreOffset=544869 flushDocs=true flushDeletes=false
> >>> flushDocStores=false
> >>> > numDocs=146894 numBufDelTerms=146894
> >>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
> >>> _1:C204995->_0
> >>> > _2:C168236->_0
> >>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _3
> numDocs=146894
> >>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=853836800
> >>> newFlushedSize=522388771
> >>> > docs/MB=294.856 new/old=61.181%
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [4 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 4 segments
> >>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 4 segments
> >>> > IW 0 [UpdWriterBuild]: CMS: now merge
> >>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0
> >>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> >>> > IW 0 [UpdWriterBuild]: DW:   RAM: now flush @ usedMB=791.724
> >>> allocMB=835.832
> >>> > deletesMB=118.535 triggerMB=910.25
> >>> > IW 0 [UpdWriterBuild]:   flush: segment=_4 docStoreSegment=_0
> >>> > docStoreOffset=691763 flushDocs=true flushDeletes=false
> >>> flushDocStores=false
> >>> > numDocs=162034 numBufDelTerms=162034
> >>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
> >>> _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0
> >>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _4
> numDocs=162034
> >>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=830182400
> >>> newFlushedSize=498741034
> >>> > docs/MB=340.668 new/old=60.076%
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [5 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 5 segments
> >>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 5 segments
> >>> > IW 0 [UpdWriterBuild]: CMS: now merge
> >>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> >>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> >>> > IW 0 [UpdWriterBuild]: DW:   RAM: now balance allocations:
> >>> usedMB=771.396 vs
> >>> > trigger=910.25 allocMB=835.832 deletesMB=138.875 vs trigger=955.762
> >>> > byteBlockFree=39.688 charBlockFree=7.188
> >>> > IW 0 [UpdWriterBuild]: DW:     nothing to free
> >>> > IW 0 [UpdWriterBuild]: DW:     after free: freedMB=64.374
> usedMB=910.271
> >>> > allocMB=771.458
> >>> > IW 0 [UpdWriterBuild]:   flush: segment=_5 docStoreSegment=_0
> >>> > docStoreOffset=853797 flushDocs=true flushDeletes=false
> >>> flushDocStores=false
> >>> > numDocs=146250 numBufDelTerms=146250
> >>> > IW 0 [UpdWriterBuild]:   index before flush _0:C171638->_0
> >>> _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> >>> > IW 0 [UpdWriterBuild]: DW: flush postings as segment _5
> numDocs=146250
> >>> > IW 0 [UpdWriterBuild]: DW:   oldRAMSize=808866816
> >>> newFlushedSize=485212402
> >>> > docs/MB=316.056 new/old=59.987%
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IFD [UpdWriterBuild]: now checkpoint "segments_1" [6 segments ;
> isCommit
> >>> =
> >>> > false]
> >>> > IW 0 [UpdWriterBuild]: LMP: findMerges: 6 segments
> >>> > IW 0 [UpdWriterBuild]: LMP:   level 8.008305 to 8.758305: 6 segments
> >>> > IW 0 [UpdWriterBuild]: CMS: now merge
> >>> > IW 0 [UpdWriterBuild]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> > IW 0 [UpdWriterBuild]: CMS:   no more merges pending; now return
> >>> > IW 0 [Indexer]: commit: start
> >>> > IW 0 [Indexer]: commit: now prepare
> >>> > IW 0 [Indexer]: prepareCommit: flush
> >>> > IW 0 [Indexer]:   flush: segment=_6 docStoreSegment=_0
> >>> > docStoreOffset=1000047 flushDocs=true flushDeletes=true
> >>> flushDocStores=true
> >>> > numDocs=76978 numBufDelTerms=76978
> >>> > IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> > IW 0 [Indexer]:   flush shared docStore segment _0
> >>> > IW 0 [Indexer]: DW: closeDocStore: 2 files to flush to segment _0
> >>> > numDocs=1077025
> >>> > IW 0 [Indexer]: DW: flush postings as segment _6 numDocs=76978
> >>> > IW 0 [Indexer]: DW:   oldRAMSize=486968320 newFlushedSize=273168136
> >>> > docs/MB=295.486 new/old=56.096%
> >>> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =
> >>> false]
> >>> > IW 0 [Indexer]: DW: apply 1077025 buffered deleted terms and 0
> deleted
> >>> > docIDs and 0 deleted queries on 7 segments.
> >>> > IFD [Indexer]: now checkpoint "segments_1" [7 segments ; isCommit =
> >>> false]
> >>> > IW 0 [Indexer]: LMP: findMerges: 7 segments
> >>> > IW 0 [Indexer]: LMP:   level 8.008305 to 8.758305: 7 segments
> >>> > IW 0 [Indexer]: CMS: now merge
> >>> > IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> _2:C168236->_0
> >>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> >>> > IW 0 [Indexer]: CMS:   no more merges pending; now return
> >>> > IW 0 [Indexer]: startCommit(): start sizeInBytes=0
> >>> > IW 0 [Indexer]: startCommit index=_0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > changeCount=21
> >>> > IW 0 [Indexer]: now sync _0.tis
> >>> > IW 0 [Indexer]: now sync _5.prx
> >>> > IW 0 [Indexer]: now sync _3.frq
> >>> > IW 0 [Indexer]: now sync _3.tii
> >>> > IW 0 [Indexer]: now sync _1.frq
> >>> > IW 0 [Indexer]: now sync _6.frq
> >>> > IW 0 [Indexer]: now sync _4.prx
> >>> > IW 0 [Indexer]: now sync _4.fnm
> >>> > IW 0 [Indexer]: now sync _2.tii
> >>> > IW 0 [Indexer]: now sync _3.fnm
> >>> > IW 0 [Indexer]: now sync _1.fnm
> >>> > IW 0 [Indexer]: now sync _6.tis
> >>> > IW 0 [Indexer]: now sync _4.frq
> >>> > IW 0 [Indexer]: now sync _5.nrm
> >>> > IW 0 [Indexer]: now sync _5.tis
> >>> > IW 0 [Indexer]: now sync _1.tii
> >>> > IW 0 [Indexer]: now sync _4.tis
> >>> > IW 0 [Indexer]: now sync _0.prx
> >>> > IW 0 [Indexer]: now sync _3.nrm
> >>> > IW 0 [Indexer]: now sync _4.tii
> >>> > IW 0 [Indexer]: now sync _0.nrm
> >>> > IW 0 [Indexer]: now sync _5.fnm
> >>> > IW 0 [Indexer]: now sync _1.tis
> >>> > IW 0 [Indexer]: now sync _0.fnm
> >>> > IW 0 [Indexer]: now sync _2.prx
> >>> > IW 0 [Indexer]: now sync _6.tii
> >>> > IW 0 [Indexer]: now sync _4.nrm
> >>> > IW 0 [Indexer]: now sync _2.frq
> >>> > IW 0 [Indexer]: now sync _5.frq
> >>> > IW 0 [Indexer]: now sync _3.prx
> >>> > IW 0 [Indexer]: now sync _5.tii
> >>> > IW 0 [Indexer]: now sync _2.fnm
> >>> > IW 0 [Indexer]: now sync _1.prx
> >>> > IW 0 [Indexer]: now sync _2.tis
> >>> > IW 0 [Indexer]: now sync _0.tii
> >>> > IW 0 [Indexer]: now sync _6.prx
> >>> > IW 0 [Indexer]: now sync _0.frq
> >>> > IW 0 [Indexer]: now sync _6.fnm
> >>> > IW 0 [Indexer]: now sync _0.fdx
> >>> > IW 0 [Indexer]: now sync _6.nrm
> >>> > IW 0 [Indexer]: now sync _0.fdt
> >>> > IW 0 [Indexer]: now sync _1.nrm
> >>> > IW 0 [Indexer]: now sync _2.nrm
> >>> > IW 0 [Indexer]: now sync _3.tis
> >>> > IW 0 [Indexer]: done all syncs
> >>> > IW 0 [Indexer]: commit: pendingCommit != null
> >>> > IW 0 [Indexer]: commit: wrote segments file "segments_2"
> >>> > IFD [Indexer]: now checkpoint "segments_2" [7 segments ; isCommit =
> >>> true]
> >>> > IFD [Indexer]: deleteCommits: now decRef commit "segments_1"
> >>> > IFD [Indexer]: delete "segments_1"
> >>> > IW 0 [Indexer]: commit: done
> >>> > IW 0 [Indexer]: optimize: index now _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6
> >>> docStoreOffset=0
> >>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> >>> > numBufDelTerms=0
> >>> > IW 0 [Indexer]:   index before flush _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > IW 0 [Indexer]: add merge to pendingMerges: _0:C171638->_0
> >>> _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > [optimize] [total 1 pending]
> >>> > IW 0 [Indexer]: CMS: now merge
> >>> > IW 0 [Indexer]: CMS:   index: _0:C171638->_0 _1:C204995->_0
> >>> _2:C168236->_0
> >>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> >>> > IW 0 [Indexer]: CMS:   consider merge _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > into _7 [optimize]
> >>> > IW 0 [Indexer]: CMS:     launch new thread [Lucene Merge Thread #0]
> >>> > IW 0 [Indexer]: CMS:   no more merges pending; now return
> >>> > IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: start
> >>> > IW 0 [Lucene Merge Thread #0]: now merge
> >>> >  merge=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
> >>> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0 into _7 [optimize]
> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@78688954
> >>> >  index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0 _3:C146894->_0
> >>> > _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> >>> > IW 0 [Lucene Merge Thread #0]: merging _0:C171638->_0 _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > into _7 [optimize]
> >>> > IW 0 [Lucene Merge Thread #0]: merge: total 1077025 docs
> >>> > IW 0 [Lucene Merge Thread #0]: commitMerge: _0:C171638->_0
> >>> _1:C204995->_0
> >>> > _2:C168236->_0 _3:C146894->_0 _4:C162034->_0 _5:C146250->_0
> >>> _6:C76978->_0
> >>> > into _7 [optimize] index=_0:C171638->_0 _1:C204995->_0 _2:C168236->_0
> >>> > _3:C146894->_0 _4:C162034->_0 _5:C146250->_0 _6:C76978->_0
> >>> > IW 0 [Lucene Merge Thread #0]: commitMergeDeletes _0:C171638->_0
> >>> > _1:C204995->_0 _2:C168236->_0 _3:C146894->_0 _4:C162034->_0
> >>> _5:C146250->_0
> >>> > _6:C76978->_0 into _7 [optimize]
> >>> > IFD [Lucene Merge Thread #0]: now checkpoint "segments_2" [1 segments
> ;
> >>> > isCommit = false]
> >>> > IW 0 [Lucene Merge Thread #0]: CMS:   merge thread: done
> >>> > IW 0 [Indexer]: now flush at close
> >>> > IW 0 [Indexer]:   flush: segment=null docStoreSegment=_6
> >>> docStoreOffset=0
> >>> > flushDocs=false flushDeletes=true flushDocStores=true numDocs=0
> >>> > numBufDelTerms=0
> >>> > IW 0 [Indexer]:   index before flush _7:C1077025->_0
> >>> > IW 0 [Indexer]:   flush shared docStore segment _6
> >>> > IW 0 [Indexer]: DW: closeDocStore: 0 files to flush to segment _6
> >>> numDocs=0
> >>> > IW 0 [Indexer]: CMS: now merge
> >>> > IW 0 [Indexer]: CMS:   index: _7:C1077025->_0
> >>> > IW 0 [Indexer]: CMS:   no more merges pending; now return
> >>> > IW 0 [Indexer]: now call final commit()
> >>> > IW 0 [Indexer]: startCommit(): start sizeInBytes=0
> >>> > IW 0 [Indexer]: startCommit index=_7:C1077025->_0 changeCount=23
> >>> > IW 0 [Indexer]: now sync _7.prx
> >>> > IW 0 [Indexer]: now sync _7.fnm
> >>> > IW 0 [Indexer]: now sync _7.tis
> >>> > IW 0 [Indexer]: now sync _7.nrm
> >>> > IW 0 [Indexer]: now sync _7.tii
> >>> > IW 0 [Indexer]: now sync _7.frq
> >>> > IW 0 [Indexer]: done all syncs
> >>> > IW 0 [Indexer]: commit: pendingCommit != null
> >>> > IW 0 [Indexer]: commit: wrote segments file "segments_3"
> >>> > IFD [Indexer]: now checkpoint "segments_3" [1 segments ; isCommit =
> >>> true]
> >>> > IFD [Indexer]: deleteCommits: now decRef commit "segments_2"
> >>> > IFD [Indexer]: delete "_0.tis"
> >>> > IFD [Indexer]: delete "_5.prx"
> >>> > IFD [Indexer]: delete "_3.tii"
> >>> > IFD [Indexer]: delete "_3.frq"
> >>> > IFD [Indexer]: delete "_1.frq"
> >>> > IFD [Indexer]: delete "_6.frq"
> >>> > IFD [Indexer]: delete "_4.prx"
> >>> > IFD [Indexer]: delete "_4.fnm"
> >>> > IFD [Indexer]: delete "_2.tii"
> >>> > IFD [Indexer]: delete "_3.fnm"
> >>> > IFD [Indexer]: delete "_1.fnm"
> >>> > IFD [Indexer]: delete "_6.tis"
> >>> > IFD [Indexer]: delete "_4.frq"
> >>> > IFD [Indexer]: delete "_5.nrm"
> >>> > IFD [Indexer]: delete "_5.tis"
> >>> > IFD [Indexer]: delete "_1.tii"
> >>> > IFD [Indexer]: delete "_4.tis"
> >>> > IFD [Indexer]: delete "_0.prx"
> >>> > IFD [Indexer]: delete "_3.nrm"
> >>> > IFD [Indexer]: delete "_4.tii"
> >>> > IFD [Indexer]: delete "_0.nrm"
> >>> > IFD [Indexer]: delete "_5.fnm"
> >>> > IFD [Indexer]: delete "_1.tis"
> >>> > IFD [Indexer]: delete "_0.fnm"
> >>> > IFD [Indexer]: delete "_2.prx"
> >>> > IFD [Indexer]: delete "_6.tii"
> >>> > IFD [Indexer]: delete "_4.nrm"
> >>> > IFD [Indexer]: delete "_2.frq"
> >>> > IFD [Indexer]: delete "_5.frq"
> >>> > IFD [Indexer]: delete "_3.prx"
> >>> > IFD [Indexer]: delete "_5.tii"
> >>> > IFD [Indexer]: delete "_2.fnm"
> >>> > IFD [Indexer]: delete "_1.prx"
> >>> > IFD [Indexer]: delete "_2.tis"
> >>> > IFD [Indexer]: delete "_0.tii"
> >>> > IFD [Indexer]: delete "_6.prx"
> >>> > IFD [Indexer]: delete "_0.frq"
> >>> > IFD [Indexer]: delete "segments_2"
> >>> > IFD [Indexer]: delete "_6.fnm"
> >>> > IFD [Indexer]: delete "_6.nrm"
> >>> > IFD [Indexer]: delete "_1.nrm"
> >>> > IFD [Indexer]: delete "_2.nrm"
> >>> > IFD [Indexer]: delete "_3.tis"
> >>> > IW 0 [Indexer]: commit: done
> >>> > IW 0 [Indexer]: at close: _7:C1077025->_0
> >>> >
> >>> > I see no errors.
> >>> > Peter
> >>> >
> >>> >
> >>> > On Tue, Oct 27, 2009 at 10:44 AM, Peter Keegan <
> peterlkeegan@gmail.com
> >>> >wrote:
> >>> >
> >>> >>
> >>> >>
> >>> >> On Tue, Oct 27, 2009 at 10:37 AM, Michael McCandless <
> >>> >> lucene@mikemccandless.com> wrote:
> >>> >>
> >>> >>> OK that exception looks more reasonable, for a disk full event.
> >>> >>>
> >>> >>> But, I can't tell from your followon emails: did this lead to index
> >>> >>> corruption?
> >>> >>>
> >>> >>
> >>> >> Yes, but this may be caused by the application ignoring a Lucene
> >>> exception
> >>> >> somewhere else. I will chase this down.
> >>> >>
> >>> >>>
> >>> >>> Also, I noticed you're using a rather old 1.6.0 JRE (1.6.0_03) --
> you
> >>> >>> really should upgrade that to the latest 1.6.0 -- there's at least
> one
> >>> >>> known problem with Lucene and early 1.6.0 JREs.
> >>> >>>
> >>> >>
> >>> >> Yes, I remember this problem - that's why we stayed at _03
> >>> >> Thanks.
> >>> >>
> >>> >>>
> >>> >>> Mike
> >>> >>>
> >>> >>> On Tue, Oct 27, 2009 at 10:00 AM, Peter Keegan <
> >>> peterlkeegan@gmail.com>
> >>> >>> wrote:
> >>> >>> > After rebuilding the corrupted indexes, the low disk space
> exception
> >>> is
> >>> >>> now
> >>> >>> > occurring as expected. Sorry for the distraction.
> >>> >>> >
> >>> >>> > fyi, here are the details:
> >>> >>> >
> >>> >>> >  java.io.IOException: There is not enough space on the disk
> >>> >>> >    at java.io.RandomAccessFile.writeBytes(Native Method)
> >>> >>> >    at java.io.RandomAccessFile.write(Unknown Source)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.flushBuffer(SimpleFSDirectory.java:192)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.store.BufferedIndexOutput.flushBuffer(BufferedIndexOutput.java:96)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.store.BufferedIndexOutput.flush(BufferedIndexOutput.java:85)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.store.BufferedIndexOutput.close(BufferedIndexOutput.java:109)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexOutput.close(SimpleFSDirectory.java:199)
> >>> >>> >    at
> >>> org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:144)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:357)
> >>> >>> >    at
> >>> >>> org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:153)
> >>> >>> >    at
> >>> >>> >
> >>> org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:5011)
> >>> >>> >    at
> >>> org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:4596)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.index.IndexWriter.resolveExternalSegments(IndexWriter.java:3786)
> >>> >>> >    at
> >>> >>> >
> >>> >>>
> >>>
> org.apache.lucene.index.IndexWriter.addIndexesNoOptimize(IndexWriter.java:3695)
> >>> >>> >
> >>> >>> >
> >>> >>> > And the corresponding index info log:
> >>> >>> >
> >>> >>> > IFD [Indexer]: setInfoStream
> >>> >>> >
> >>> >>>
> >>>
> deletionPolicy=org.apache.lucene.index.KeepOnlyLastCommitDeletionPolicy@256ef705
> >>> >>> > IW 1 [Indexer]: setInfoStream:
> >>> >>> > dir=org.apache.lucene.store.SimpleFSDirectory@D
> >>> >>> :\mnsavs\lresumes3\lresumes3.luc\lresumes3.update.main.4
> >>> >>> > autoCommit=false
> >>> >>> >
> >>> >>>
> >>>
> mergePolicy=org.apache.lucene.index.LogByteSizeMergePolicy@181b7c76mergeScheduler
> >>> >>>
> >>>
> =org.apache.lucene.index.ConcurrentMergeScheduler@34883357ramBufferSizeMB
> >>> >>> =16.0
> >>> >>> > maxBufferedDocs=-1 maxBuffereDeleteTerms=-1
> >>> >>> > maxFieldLength=2147483647 index=
> >>> >>> > IW 1 [Indexer]: flush at addIndexesNoOptimize
> >>> >>> > IW 1 [Indexer]:   flush: segment=null docStoreSegment=null
> >>> >>> docStoreOffset=0
> >>> >>> > flushDocs=false flushDeletes=true flushDocStores=false numDocs=0
> >>> >>> > numBufDelTerms=0
> >>> >>> > IW 1 [Indexer]:   index before flush
> >>> >>> > IW 1 [Indexer]: now start transaction
> >>> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
> >>> >>> > IW 1 [Indexer]: LMP:   level 8.774518 to 9.524518: 1 segments
> >>> >>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> >>> >>> > IW 1 [Indexer]: CMS: now merge
> >>> >>> > IW 1 [Indexer]: CMS:   index: _7:Cx1075533->_0** _8:Cx2795**
> >>> >>> > IW 1 [Indexer]: CMS:   no more merges pending; now return
> >>> >>> > IW 1 [Indexer]: add merge to pendingMerges: _7:Cx1075533->_0
> [total
> >>> 1
> >>> >>> > pending]
> >>> >>> > IW 1 [Indexer]: now merge
> >>> >>> >  merge=_7:Cx1075533->_0 into _0 [mergeDocStores]
> >>> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@4d480ea
> >>> >>> >  index=_7:Cx1075533->_0** _8:Cx2795**
> >>> >>> > IW 1 [Indexer]: merging _7:Cx1075533->_0 into _0 [mergeDocStores]
> >>> >>> > IW 1 [Indexer]: merge: total 1074388 docs
> >>> >>> > IW 1 [Indexer]: commitMerge: _7:Cx1075533->_0 into _0
> >>> [mergeDocStores]
> >>> >>> > index=_7:Cx1075533->_0** _8:Cx2795**
> >>> >>> > IW 1 [Indexer]: commitMergeDeletes _7:Cx1075533->_0 into _0
> >>> >>> [mergeDocStores]
> >>> >>> > IFD [Indexer]: now checkpoint "segments_1" [2 segments ; isCommit
> =
> >>> >>> false]
> >>> >>> > IW 1 [Indexer]: LMP: findMerges: 2 segments
> >>> >>> > IW 1 [Indexer]: LMP:   level 8.864886 to 9.614886: 1 segments
> >>> >>> > IW 1 [Indexer]: LMP:   level 6.2973914 to 7.0473914: 1 segments
> >>> >>> > IW 1 [Indexer]: add merge to pendingMerges: _8:Cx2795 [total 1
> >>> pending]
> >>> >>> > IW 1 [Indexer]: now merge
> >>> >>> >  merge=_8:Cx2795 into _1 [mergeDocStores]
> >>> >>> >  merge=org.apache.lucene.index.MergePolicy$OneMerge@606f8b2b
> >>> >>> >  index=_0:C1074388 _8:Cx2795**
> >>> >>> > IW 1 [Indexer]: merging _8:Cx2795 into _1 [mergeDocStores]
> >>> >>> > IW 1 [Indexer]: merge: total 2795 docs
> >>> >>> > IW 1 [Indexer]: handleMergeException: merge=_8:Cx2795 into _1
> >>> >>> > [mergeDocStores] exc=java.io.IOException: There is not enough
> space
> >>> on
> >>> >>> the
> >>> >>> > disk
> >>> >>> > IW 1 [Indexer]: hit exception during merge
> >>> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
> >>> unreferenced
> >>> >>> file
> >>> >>> > "_1.fdt"
> >>> >>> > IFD [Indexer]: delete "_1.fdt"
> >>> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
> >>> unreferenced
> >>> >>> file
> >>> >>> > "_1.fdx"
> >>> >>> > IFD [Indexer]: delete "_1.fdx"
> >>> >>> > IFD [Indexer]: refresh [prefix=_1]: removing newly created
> >>> unreferenced
> >>> >>> file
> >>> >>> > "_1.fnm"
> >>> >>> > IFD [Indexer]: delete "_1.fnm"
> >>> >>> > IW 1 [Indexer]: now rollback transaction
> >>> >>> > IW 1 [Indexer]: all running merges have aborted
> >>> >>> > IFD [Indexer]: now checkpoint "segments_1" [0 segments ; isCommit
> =
> >>> >>> false]
> >>> >>> > IFD [Indexer]: delete "_0.nrm"
> >>> >>> > IFD [Indexer]: delete "_0.tis"
> >>> >>> > IFD [Indexer]: delete "_0.fnm"
> >>> >>> > IFD [Indexer]: delete "_0.tii"
> >>> >>> > IFD [Indexer]: delete "_0.frq"
> >>> >>> > IFD [Indexer]: delete "_0.fdx"
> >>> >>> > IFD [Indexer]: delete "_0.prx"
> >>> >>> > IFD [Indexer]: delete "_0.fdt"
> >>> >>> >
> >>> >>> >
> >>> >>> > Peter
> >>> >>> >
> >>> >>> > On Mon, Oct 26, 2009 at 3:59 PM, Peter Keegan <
> >>> peterlkeegan@gmail.com
> >>> >>> >wrote:
> >>> >>> >
> >>> >>> >>
> >>> >>> >>
> >>> >>> >> On Mon, Oct 26, 2009 at 3:00 PM, Michael McCandless <
> >>> >>> >> lucene@mikemccandless.com> wrote:
> >>> >>> >>
> >>> >>> >>> On Mon, Oct 26, 2009 at 2:55 PM, Peter Keegan <
> >>> peterlkeegan@gmail.com
> >>> >>> >
> >>> >>> >>> wrote:
> >>> >>> >>> > On Mon, Oct 26, 2009 at 2:50 PM, Michael McCandless <
> >>> >>> >>> > lucene@mikemccandless.com> wrote:
> >>> >>> >>> >
> >>> >>> >>> >> On Mon, Oct 26, 2009 at 10:44 AM, Peter Keegan <
> >>> >>> peterlkeegan@gmail.com
> >>> >>> >>> >
> >>> >>> >>> >> wrote:
> >>> >>> >>> >> > Even running in console mode, the exception is difficult
> to
> >>> >>> >>> interpret.
> >>> >>> >>> >> > Here's an exception that I think occurred during an add
> >>> document,
> >>> >>> >>> commit
> >>> >>> >>> >> or
> >>> >>> >>> >> > close:
> >>> >>> >>> >> > doc counts differ for segment _g: field Reader shows 137
> but
> >>> >>> >>> segmentInfo
> >>> >>> >>> >> > shows 5777
> >>> >>> >>> >>
> >>> >>> >>> >> That's spooky.  Do you have the full exception for this one?
> >>>  What
> >>> >>> IO
> >>> >>> >>> >> system are you running on?  (Is it just a local drive on
> your
> >>> >>> windows
> >>> >>> >>> >> computer?) It's almost as if the IO system is not generating
> an
> >>> >>> >>> >> IOException to Java when disk fills up.
> >>> >>> >>> >>
> >>> >>> >>> >
> >>> >>> >>> > Index and code are all on a local drive. There is no other
> >>> exception
> >>> >>> >>> coming
> >>> >>> >>> > back - just what I reported.
> >>> >>> >>>
> >>> >>> >>> But, you didn't report a traceback for this first one?
> >>> >>> >>>
> >>> >>> >>
> >>> >>> >> Yes, I need to add some more printStackTrace calls.
> >>> >>> >>
> >>> >>> >>
> >>> >>> >>>
> >>> >>> >>> >> > I ensured that the disk space was low before updating the
> >>> index.
> >>> >>> >>> >>
> >>> >>> >>> >> You mean, to intentionally test the disk-full case?
> >>> >>> >>> >>
> >>> >>> >>> >
> >>> >>> >>> > Yes, that's right.
> >>> >>> >>>
> >>> >>> >>> OK.  Can you turn on IndexWriter's infoStream, get this disk
> full
> >>> /
> >>> >>> >>> corruption to happen again, and post back the resulting output?
> >>>  Make
> >>> >>> >>> sure your index first passes CheckIndex before starting (so we
> >>> don't
> >>> >>> >>> begin the test w/ any pre-existing index corruption).
> >>> >>> >>>
> >>> >>> >>
> >>> >>> >> Good point about CheckIndex.  I've already found 2 bad ones. I
> will
> >>> >>> build
> >>> >>> >> new indexes from scratch. This will take a while.
> >>> >>> >>
> >>> >>> >>
> >>> >>> >>> >> > On another occasion, the exception was:
> >>> >>> >>> >> > background merge hit exception: _0:C1080260 _1:C139
> _2:C123
> >>> >>> _3:C107
> >>> >>> >>> >> _4:C126
> >>> >>> >>> >> > _5:C121 _6:C126 _7:C711 _8:C116 into _9 [optimize]
> >>> >>> [mergeDocStores]
> >>> >>> >>> >>
> >>> >>> >>> >> In this case, the SegmentMerger was trying to open this
> >>> segment,
> >>> >>> but
> >>> >>> >>> >> on attempting to read the first int from the fdx (fields
> index)
> >>> >>> file
> >>> >>> >>> >> for one of the segments, it hit EOF.
> >>> >>> >>> >>
> >>> >>> >>> >> This is also spooky -- this looks like index corruption,
> which
> >>> >>> should
> >>> >>> >>> >> never happen on hitting disk full.
> >>> >>> >>> >>
> >>> >>> >>> >
> >>> >>> >>> > That's what I thought, too. Could Lucene be catching the
> >>> IOException
> >>> >>> and
> >>> >>> >>> > turning it into a different exception?
> >>> >>> >>>
> >>> >>> >>> I think that's unlikely, but I guess possible.  We have "disk
> >>> full"
> >>> >>> >>> tests in the unit tests, that throw an IOException at different
> >>> times.
> >>> >>> >>>
> >>> >>> >>> What exact windows version are you using?  The local drive is
> >>> NTFS?
> >>> >>> >>>
> >>> >>> >>
> >>> >>> >> Windows Server 2003 Enterprise x64 SP2. Local drive is NTFS
> >>> >>> >>
> >>> >>> >>
> >>> >>> >>>
> >>> >>> >>> Mike
> >>> >>> >>>
> >>> >>> >>>
> >>> ---------------------------------------------------------------------
> >>> >>> >>> To unsubscribe, e-mail:
> java-user-unsubscribe@lucene.apache.org
> >>> >>> >>> For additional commands, e-mail:
> java-user-help@lucene.apache.org
> >>> >>> >>>
> >>> >>> >>>
> >>> >>> >>
> >>> >>> >
> >>> >>>
> >>> >>>
> ---------------------------------------------------------------------
> >>> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>> >>>
> >>> >>>
> >>> >>
> >>> >
> >>>
> >>> ---------------------------------------------------------------------
> >>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>
> >>>
> >>
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502b8518a9b8c0476ff8483--

From java-user-return-43098-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 14:26:19 2009
Return-Path: <java-user-return-43098-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 35367 invoked from network); 28 Oct 2009 14:26:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 14:26:19 -0000
Received: (qmail 11456 invoked by uid 500); 28 Oct 2009 14:26:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11380 invoked by uid 500); 28 Oct 2009 14:26:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11370 invoked by uid 99); 28 Oct 2009 14:26:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:26:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:26:09 +0000
Received: by pwi12 with SMTP id 12so875132pwi.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 07:25:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=sV3zqr8reGZ8DoBicWK72ccgXSZ4lm02Sz2VIONwZ9c=;
        b=egJcdbf3WbIVln7AQ/imtLWCbI5ni7gZ4SUkcKkGpaAAsGjN9J2U176nfvYGlXMVal
         LQdXoCX/GCkhU2okgoPpQFbsMeFWqdmR6iUyPbxTI3Y5fgh5Z2h3xxYfyeUn3TXHhcWx
         4176vhiCd98dB8CRh+0PC8Duhx0/idvaz6lsU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=aQTdxNBFD/6fbJ8Nt9dpbgJhZMtxVe38vpqCn/bjmDkiLMEyym2uLdod7L52KtzQwQ
         8xQN1DTFnvch+9MCovTWrdEjTGjL2Rm8xNMzXnn3eRopSK7jlCLRn4dIuGN+VEaRPW+n
         Ch77X43Mek/HeSb5I/7jbo3MRbRlpO4PxZlbY=
MIME-Version: 1.0
Received: by 10.142.248.42 with SMTP id v42mr1414814wfh.187.1256739948165; 
	Wed, 28 Oct 2009 07:25:48 -0700 (PDT)
In-Reply-To: <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
Date: Wed, 28 Oct 2009 10:25:47 -0400
Message-ID: <e994873a0910280725j54e0ebe7ya0556a2dd6a9aad4@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502caf82f7d370476ff92b5
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502caf82f7d370476ff92b5
Content-Type: text/plain; charset=ISO-8859-1

My last post got truncated - probably exceeded max msg size. Let me know if
you want to see more of the IndexWriter log.

Peter

--00504502caf82f7d370476ff92b5--

From java-user-return-43099-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 14:28:18 2009
Return-Path: <java-user-return-43099-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 36394 invoked from network); 28 Oct 2009 14:28:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 14:28:18 -0000
Received: (qmail 20402 invoked by uid 500); 28 Oct 2009 14:28:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 20335 invoked by uid 500); 28 Oct 2009 14:28:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 20325 invoked by uid 99); 28 Oct 2009 14:28:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:28:16 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:28:06 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id C8889D36004
	for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 15:27:46 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id BKVHYZ3M5T5C for <java-user@lucene.apache.org>;
	Wed, 28 Oct 2009 15:27:44 +0100 (CET)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 09C31D36001
	for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 15:27:43 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com> <e994873a0910261259x5eb38db1y21bcb83f6cfd88e2@mail.gmail.com> <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com> <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com> <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com> <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com> <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com> <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com> <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com> <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com> <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
Subject: RE: IO exception during merge/optimize
Date: Wed, 28 Oct 2009 15:27:42 +0100
Message-ID: <90F9AC719EA64317ACBF6D6E68DC1C63@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
Thread-Index: AcpX2kg+g+KeIh/AT7q5ds1OxPGKZgAAEzSQ
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579
X-Virus-Checked: Checked by ClamAV on apache.org

> >Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52" mean?
> This appears to be something added by the ant build, since I built Lucene
> from the source code.

This is because it was build from a source artifact with no SVN revision
information. At this place, normally the svn revision number stands,
determined by a svnversion call.




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43100-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 14:44:03 2009
Return-Path: <java-user-return-43100-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 40030 invoked from network); 28 Oct 2009 14:44:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 14:44:03 -0000
Received: (qmail 42899 invoked by uid 500); 28 Oct 2009 14:44:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42833 invoked by uid 500); 28 Oct 2009 14:44:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42823 invoked by uid 99); 28 Oct 2009 14:44:00 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:44:00 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:43:52 +0000
Received: by ywh13 with SMTP id 13so797160ywh.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 07:43:31 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.233.2 with SMTP id f2mr15583590ybh.259.1256741011218; Wed, 
	28 Oct 2009 07:43:31 -0700 (PDT)
In-Reply-To: <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910270700p497dbfb0t65051f79c326a7f9@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
Date: Wed, 28 Oct 2009 10:43:31 -0400
Message-ID: <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

OK... when you exported the sources & built yourself, you didn't make
any changes, right?

It's really odd how many of the errors are due to the term
"literals:cfid196$", or some variation (one time with "on" appended,
another time with "microsoft").  Do you know what documents typically
contain that term, and what the context is around it?  Maybe try to
index only those documents and see if this happens?  (It could
conceivably be caused by bad data, if this is some weird bug).  One
question: does your content ever use the [invalid] unicode character
U+FFFF?  (Lucene uses this internally to mark the end of the term).

Would it be possible to zip up all files starting with _1c (should be
~22 MB) and post somewhere that I could download?  That's the smallest
of the broken segments I think.

I don't need the full IW output just yet, thanks.

Mike

On Wed, Oct 28, 2009 at 10:21 AM, Peter Keegan <peterlkeegan@gmail.com> wrote:
> Yes, I used JDK 1.6.0_16 when running CheckIndex and it reported the same
> problems when run multiple times.
>
>>Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52" mean?
> This appears to be something added by the ant build, since I built Lucene
> from the source code.
>
> I rebuilt the index using mergeFactor=50, ramBufferSize=200MB,
> maxBufferedDocs=1000000
> This produced 49 segments, 9 of which are broken. The broken segments are in
> the latter half, similar to my previous post with 3 segments. Do you think
> this could be caused by 'bad' data, for example bad unicode characters?
>
> Here is the output from CheckIndex:

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43101-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 14:59:03 2009
Return-Path: <java-user-return-43101-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 44229 invoked from network); 28 Oct 2009 14:59:03 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 14:59:03 -0000
Received: (qmail 70979 invoked by uid 500); 28 Oct 2009 14:59:01 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 70924 invoked by uid 500); 28 Oct 2009 14:59:01 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 70914 invoked by uid 99); 28 Oct 2009 14:59:01 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:59:01 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.222.198 as permitted sender)
Received: from [209.85.222.198] (HELO mail-pz0-f198.google.com) (209.85.222.198)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 14:58:56 +0000
Received: by pzk36 with SMTP id 36so580324pzk.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 07:58:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=NBSDfbd2HOeoShLjeyr60IE7lr85clxAEjRd6BIdyCo=;
        b=A2RYjZxIqV+CNMVbAgeXiA293RYpXLeRKPUM949NP4qfq9XUBLYuZ0TlgbpELbhTuA
         l4sQem/JyH1DbFTYVLG7ETCRZswBBEfw4Boi97wqlcde25QBTdORreoEcWpPgetujiCV
         RiyX6bpMqOt8JhN5PJntrfXjIrldoAwqQXd8c=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=cFgj54IoggKsme6xFU9fKszSPmzsbQ0Bgscv9znhIsBZG+PZK4DgTrYB8UxZR3FZaB
         JMrL7LRQ2dU4IRpz4HRl+h0V2ZWGu3wzTEhXLdX16lF+W5HdqWBzMg2ctxGq/PqTpLEg
         UScUImtBkmHLpT1xfRbMrhjk9FPCfOt6e20m4=
MIME-Version: 1.0
Received: by 10.143.138.4 with SMTP id q4mr1464890wfn.311.1256741916015; Wed, 
	28 Oct 2009 07:58:36 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910270737q1abbf3bejd10b53ee5b9a78c0@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
Date: Wed, 28 Oct 2009 10:58:35 -0400
Message-ID: <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd5f6dc7a8cb104770007f2

--000e0cd5f6dc7a8cb104770007f2
Content-Type: text/plain; charset=ISO-8859-1

The only change I made to the source code was the patch for PayloadNearQuery
(LUCENE-1986).
It's possible that our content contains U+FFFF. I will run in debugger and
see.
The data is 'sensitive', so I may not be able to provide a bad segment,
unfortunately.

Peter

On Wed, Oct 28, 2009 at 10:43 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> OK... when you exported the sources & built yourself, you didn't make
> any changes, right?
>
> It's really odd how many of the errors are due to the term
> "literals:cfid196$", or some variation (one time with "on" appended,
> another time with "microsoft").  Do you know what documents typically
> contain that term, and what the context is around it?  Maybe try to
> index only those documents and see if this happens?  (It could
> conceivably be caused by bad data, if this is some weird bug).  One
> question: does your content ever use the [invalid] unicode character
> U+FFFF?  (Lucene uses this internally to mark the end of the term).
>
> Would it be possible to zip up all files starting with _1c (should be
> ~22 MB) and post somewhere that I could download?  That's the smallest
> of the broken segments I think.
>
> I don't need the full IW output just yet, thanks.
>
> Mike
>
> On Wed, Oct 28, 2009 at 10:21 AM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > Yes, I used JDK 1.6.0_16 when running CheckIndex and it reported the same
> > problems when run multiple times.
> >
> >>Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52" mean?
> > This appears to be something added by the ant build, since I built Lucene
> > from the source code.
> >
> > I rebuilt the index using mergeFactor=50, ramBufferSize=200MB,
> > maxBufferedDocs=1000000
> > This produced 49 segments, 9 of which are broken. The broken segments are
> in
> > the latter half, similar to my previous post with 3 segments. Do you
> think
> > this could be caused by 'bad' data, for example bad unicode characters?
> >
> > Here is the output from CheckIndex:
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd5f6dc7a8cb104770007f2--

From java-user-return-43102-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 15:24:19 2009
Return-Path: <java-user-return-43102-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52724 invoked from network); 28 Oct 2009 15:24:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 15:24:19 -0000
Received: (qmail 11754 invoked by uid 500); 28 Oct 2009 15:24:16 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 11684 invoked by uid 500); 28 Oct 2009 15:24:16 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 11674 invoked by uid 99); 28 Oct 2009 15:24:16 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:24:16 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.216.173 as permitted sender)
Received: from [209.85.216.173] (HELO mail-px0-f173.google.com) (209.85.216.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:24:08 +0000
Received: by pxi3 with SMTP id 3so637081pxi.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 08:23:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=4u+xYUyjfvTrx5E29bQZHYh0P12rgyMgsfujWjf6INA=;
        b=TjkfZjTuBDc8ugahrxc1Zx6nuAfSGlGdkTg9AJm6Nd8nPNfL7m3dStrJtJO+9I+P+2
         jLzOJmTjFBWcxfoAMT+KOKzL6qXgyiywDAx4Edi0fyNQYjb0QcTXMwAzwol2TzQbjCAQ
         HhJojo8JZeNa/8v2vSvoCzGT2QS6ao4oXvdZ0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=QGbyLiRV9vpL1fXw+LhK83NYXAtiiak1La2wWSbgb9NBkNvbzt8twnrpgQ2Xg7BaOH
         +GEH9hQIANeWTWDf5UJAvAaAokoHf2aKQ4TiKzkKgVAKVUaCUpnE3/9IA2y+yrqphMUZ
         sU795czP3gVfy8zIonIu+ZtMtqTvs3b7v/fj4=
MIME-Version: 1.0
Received: by 10.114.69.18 with SMTP id r18mr306297waa.209.1256743426905; Wed, 
	28 Oct 2009 08:23:46 -0700 (PDT)
In-Reply-To: <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com> 
	<e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com> 
	<e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com> 
	<9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com> 
	<e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com> 
	<e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com> 
	<9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com> 
	<e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com> 
	<9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com> 
	<e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 28 Oct 2009 11:23:26 -0400
Message-ID: <8f0ad1f30910280823j7e5204b0w4eacd070b9a2e971@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502e8bd88d8f20477006110
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502e8bd88d8f20477006110
Content-Type: text/plain; charset=UTF-8

i might be wrong about this, but recently I intentionally tried to create
index with terms with U+FFFF to see if it would cause a problem :)

the U+FFFF seemed to be discarded completely (maybe at UTF-8 encode time)...
then again I was using RAMDirectory.

On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> The only change I made to the source code was the patch for
> PayloadNearQuery
> (LUCENE-1986).
> It's possible that our content contains U+FFFF. I will run in debugger and
> see.
> The data is 'sensitive', so I may not be able to provide a bad segment,
> unfortunately.
>
> Peter
>
> On Wed, Oct 28, 2009 at 10:43 AM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
> > OK... when you exported the sources & built yourself, you didn't make
> > any changes, right?
> >
> > It's really odd how many of the errors are due to the term
> > "literals:cfid196$", or some variation (one time with "on" appended,
> > another time with "microsoft").  Do you know what documents typically
> > contain that term, and what the context is around it?  Maybe try to
> > index only those documents and see if this happens?  (It could
> > conceivably be caused by bad data, if this is some weird bug).  One
> > question: does your content ever use the [invalid] unicode character
> > U+FFFF?  (Lucene uses this internally to mark the end of the term).
> >
> > Would it be possible to zip up all files starting with _1c (should be
> > ~22 MB) and post somewhere that I could download?  That's the smallest
> > of the broken segments I think.
> >
> > I don't need the full IW output just yet, thanks.
> >
> > Mike
> >
> > On Wed, Oct 28, 2009 at 10:21 AM, Peter Keegan <peterlkeegan@gmail.com>
> > wrote:
> > > Yes, I used JDK 1.6.0_16 when running CheckIndex and it reported the
> same
> > > problems when run multiple times.
> > >
> > >>Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52"
> mean?
> > > This appears to be something added by the ant build, since I built
> Lucene
> > > from the source code.
> > >
> > > I rebuilt the index using mergeFactor=50, ramBufferSize=200MB,
> > > maxBufferedDocs=1000000
> > > This produced 49 segments, 9 of which are broken. The broken segments
> are
> > in
> > > the latter half, similar to my previous post with 3 segments. Do you
> > think
> > > this could be caused by 'bad' data, for example bad unicode characters?
> > >
> > > Here is the output from CheckIndex:
> >
> > ---------------------------------------------------------------------
> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >
> >
>



-- 
Robert Muir
rcmuir@gmail.com

--00504502e8bd88d8f20477006110--

From java-user-return-43103-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 15:25:55 2009
Return-Path: <java-user-return-43103-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53549 invoked from network); 28 Oct 2009 15:25:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 15:25:55 -0000
Received: (qmail 17582 invoked by uid 500); 28 Oct 2009 15:25:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 17526 invoked by uid 500); 28 Oct 2009 15:25:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 17516 invoked by uid 99); 28 Oct 2009 15:25:53 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:25:53 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:25:45 +0000
Received: by yxe30 with SMTP id 30so852750yxe.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 08:25:24 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.239.15 with SMTP id m15mr8074222ybh.109.1256743523990; 
	Wed, 28 Oct 2009 08:25:23 -0700 (PDT)
In-Reply-To: <8f0ad1f30910280823j7e5204b0w4eacd070b9a2e971@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <8f0ad1f30910280823j7e5204b0w4eacd070b9a2e971@mail.gmail.com>
Date: Wed, 28 Oct 2009 11:25:23 -0400
Message-ID: <9ac0c6aa0910280825n32fdb702nc838c494052299b5@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Right, I would expect Lucene would silently truncate the term at the
U+FFFF, and not lead to this odd exception.

Mike

On Wed, Oct 28, 2009 at 11:23 AM, Robert Muir <rcmuir@gmail.com> wrote:
> i might be wrong about this, but recently I intentionally tried to create
> index with terms with U+FFFF to see if it would cause a problem :)
>
> the U+FFFF seemed to be discarded completely (maybe at UTF-8 encode time)=
...
> then again I was using RAMDirectory.
>
> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com>wr=
ote:
>
>> The only change I made to the source code was the patch for
>> PayloadNearQuery
>> (LUCENE-1986).
>> It's possible that our content contains U+FFFF. I will run in debugger a=
nd
>> see.
>> The data is 'sensitive', so I may not be able to provide a bad segment,
>> unfortunately.
>>
>> Peter
>>
>> On Wed, Oct 28, 2009 at 10:43 AM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>> > OK... when you exported the sources & built yourself, you didn't make
>> > any changes, right?
>> >
>> > It's really odd how many of the errors are due to the term
>> > "literals:cfid196$", or some variation (one time with "on" appended,
>> > another time with "microsoft"). =A0Do you know what documents typicall=
y
>> > contain that term, and what the context is around it? =A0Maybe try to
>> > index only those documents and see if this happens? =A0(It could
>> > conceivably be caused by bad data, if this is some weird bug). =A0One
>> > question: does your content ever use the [invalid] unicode character
>> > U+FFFF? =A0(Lucene uses this internally to mark the end of the term).
>> >
>> > Would it be possible to zip up all files starting with _1c (should be
>> > ~22 MB) and post somewhere that I could download? =A0That's the smalle=
st
>> > of the broken segments I think.
>> >
>> > I don't need the full IW output just yet, thanks.
>> >
>> > Mike
>> >
>> > On Wed, Oct 28, 2009 at 10:21 AM, Peter Keegan <peterlkeegan@gmail.com=
>
>> > wrote:
>> > > Yes, I used JDK 1.6.0_16 when running CheckIndex and it reported the
>> same
>> > > problems when run multiple times.
>> > >
>> > >>Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52"
>> mean?
>> > > This appears to be something added by the ant build, since I built
>> Lucene
>> > > from the source code.
>> > >
>> > > I rebuilt the index using mergeFactor=3D50, ramBufferSize=3D200MB,
>> > > maxBufferedDocs=3D1000000
>> > > This produced 49 segments, 9 of which are broken. The broken segment=
s
>> are
>> > in
>> > > the latter half, similar to my previous post with 3 segments. Do you
>> > think
>> > > this could be caused by 'bad' data, for example bad unicode characte=
rs?
>> > >
>> > > Here is the output from CheckIndex:
>> >
>> > ---------------------------------------------------------------------
>> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> > For additional commands, e-mail: java-user-help@lucene.apache.org
>> >
>> >
>>
>
>
>
> --
> Robert Muir
> rcmuir@gmail.com
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43104-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 15:27:46 2009
Return-Path: <java-user-return-43104-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54254 invoked from network); 28 Oct 2009 15:27:46 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 15:27:46 -0000
Received: (qmail 22677 invoked by uid 500); 28 Oct 2009 15:27:44 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 22598 invoked by uid 500); 28 Oct 2009 15:27:44 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 22586 invoked by uid 99); 28 Oct 2009 15:27:44 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:27:44 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:27:41 +0000
Received: by pwi12 with SMTP id 12so912022pwi.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 08:27:21 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=RU9Q6ShL1TdaZAso6LTS6i/6TKJ91+3OzFuWgVKi2to=;
        b=QBWgO59XQoFNPn/ZF3K8RzTnleacvx96JnaCVR6Ak1ngtnPb7yJSDLOKYYS8sgPwAu
         QPqsjPzu2HeVFcRaR2gDivswzH+OT3qaNxvxL7l8Uz6ZRfPBz3R6UiiSYbM/Dj6S1xiz
         +ArnIawOEPw3mPGA4RsB3iG6HchgcIGSheovE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=JN6teZsw5JLOJKVMc4gXHZM/cT0Ht9gQeavV8Txu9sQZE0MvNQ3AkQgvF7xQWkb3D0
         2sjExBXnnlJD4Yi+V/FTF4AKlVPiAQuXIToEArZgtvD8To9nas4NP5UlVklZ777DButa
         Jtn+PoxWrYIG6YnnkIz5MZTOe1EKxth4J1ij4=
MIME-Version: 1.0
Received: by 10.114.69.18 with SMTP id r18mr311827waa.209.1256743641319; Wed, 
	28 Oct 2009 08:27:21 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910280825n32fdb702nc838c494052299b5@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com> 
	<9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com> 
	<e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com> 
	<e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com> 
	<9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com> 
	<e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com> 
	<9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com> 
	<e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com> 
	<8f0ad1f30910280823j7e5204b0w4eacd070b9a2e971@mail.gmail.com> 
	<9ac0c6aa0910280825n32fdb702nc838c494052299b5@mail.gmail.com>
From: Robert Muir <rcmuir@gmail.com>
Date: Wed, 28 Oct 2009 11:27:01 -0400
Message-ID: <8f0ad1f30910280827u2fa20b81uecef1f244a432896@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502e8bd5089090477006eaa

--00504502e8bd5089090477006eaa
Content-Type: text/plain; charset=UTF-8

thats exactly the result I saw FWIW

On Wed, Oct 28, 2009 at 11:25 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Right, I would expect Lucene would silently truncate the term at the
> U+FFFF, and not lead to this odd exception.
>
> Mike
>
> On Wed, Oct 28, 2009 at 11:23 AM, Robert Muir <rcmuir@gmail.com> wrote:
> > i might be wrong about this, but recently I intentionally tried to create
> > index with terms with U+FFFF to see if it would cause a problem :)
> >
> > the U+FFFF seemed to be discarded completely (maybe at UTF-8 encode
> time)...
> > then again I was using RAMDirectory.
> >
> > On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com
> >wrote:
> >
> >> The only change I made to the source code was the patch for
> >> PayloadNearQuery
> >> (LUCENE-1986).
> >> It's possible that our content contains U+FFFF. I will run in debugger
> and
> >> see.
> >> The data is 'sensitive', so I may not be able to provide a bad segment,
> >> unfortunately.
> >>
> >> Peter
> >>
> >> On Wed, Oct 28, 2009 at 10:43 AM, Michael McCandless <
> >> lucene@mikemccandless.com> wrote:
> >>
> >> > OK... when you exported the sources & built yourself, you didn't make
> >> > any changes, right?
> >> >
> >> > It's really odd how many of the errors are due to the term
> >> > "literals:cfid196$", or some variation (one time with "on" appended,
> >> > another time with "microsoft").  Do you know what documents typically
> >> > contain that term, and what the context is around it?  Maybe try to
> >> > index only those documents and see if this happens?  (It could
> >> > conceivably be caused by bad data, if this is some weird bug).  One
> >> > question: does your content ever use the [invalid] unicode character
> >> > U+FFFF?  (Lucene uses this internally to mark the end of the term).
> >> >
> >> > Would it be possible to zip up all files starting with _1c (should be
> >> > ~22 MB) and post somewhere that I could download?  That's the smallest
> >> > of the broken segments I think.
> >> >
> >> > I don't need the full IW output just yet, thanks.
> >> >
> >> > Mike
> >> >
> >> > On Wed, Oct 28, 2009 at 10:21 AM, Peter Keegan <
> peterlkeegan@gmail.com>
> >> > wrote:
> >> > > Yes, I used JDK 1.6.0_16 when running CheckIndex and it reported the
> >> same
> >> > > problems when run multiple times.
> >> > >
> >> > >>Also, what does Lucene version "2.9 exported - 2009-10-27 15:31:52"
> >> mean?
> >> > > This appears to be something added by the ant build, since I built
> >> Lucene
> >> > > from the source code.
> >> > >
> >> > > I rebuilt the index using mergeFactor=50, ramBufferSize=200MB,
> >> > > maxBufferedDocs=1000000
> >> > > This produced 49 segments, 9 of which are broken. The broken
> segments
> >> are
> >> > in
> >> > > the latter half, similar to my previous post with 3 segments. Do you
> >> > think
> >> > > this could be caused by 'bad' data, for example bad unicode
> characters?
> >> > >
> >> > > Here is the output from CheckIndex:
> >> >
> >> > ---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >
> >> >
> >>
> >
> >
> >
> > --
> > Robert Muir
> > rcmuir@gmail.com
> >
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Robert Muir
rcmuir@gmail.com

--00504502e8bd5089090477006eaa--

From java-user-return-43105-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 15:30:00 2009
Return-Path: <java-user-return-43105-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55113 invoked from network); 28 Oct 2009 15:30:00 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 15:30:00 -0000
Received: (qmail 26601 invoked by uid 500); 28 Oct 2009 15:29:58 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 26544 invoked by uid 500); 28 Oct 2009 15:29:58 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 26534 invoked by uid 99); 28 Oct 2009 15:29:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:29:58 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 15:29:49 +0000
Received: by ywh13 with SMTP id 13so846563ywh.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 08:29:28 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.233.2 with SMTP id f2mr15675132ybh.259.1256743768605; Wed, 
	28 Oct 2009 08:29:28 -0700 (PDT)
In-Reply-To: <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910270744y4355cc6dg90fd2f003969fca5@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
Date: Wed, 28 Oct 2009 11:29:28 -0400
Message-ID: <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Checked: Checked by ClamAV on apache.org

On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com> wrote:
> The only change I made to the source code was the patch for PayloadNearQuery
> (LUCENE-1986).

That patch certainly shouldn't lead to this.

> It's possible that our content contains U+FFFF. I will run in debugger and
> see.

OK may as well check just so we cover all possibilities.

> The data is 'sensitive', so I may not be able to provide a bad segment,
> unfortunately.

OK, maybe we can modify your CheckIndex instead.  Let's start with
this, which prints a warning whenever the docFreq differs but
otherwise continues (vs throwing RuntimeException).  I'm curious how
many terms show this, and whether the TermEnum keeps working after
this term that has different docFreq:

Index: src/java/org/apache/lucene/index/CheckIndex.java
===================================================================
--- src/java/org/apache/lucene/index/CheckIndex.java	(revision 829889)
+++ src/java/org/apache/lucene/index/CheckIndex.java	(working copy)
@@ -672,8 +672,8 @@
         }

         if (freq0 + delCount != docFreq) {
-          throw new RuntimeException("term " + term + " docFreq=" +
-                                     docFreq + " != num docs seen " +
freq0 + " + num docs deleted " + delCount);
+          System.out.println("WARNING: term  " + term + " docFreq=" +
+                             docFreq + " != num docs seen " + freq0 +
" + num docs deleted " + delCount);
         }
       }

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43106-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 16:08:14 2009
Return-Path: <java-user-return-43106-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 75029 invoked from network); 28 Oct 2009 16:08:14 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 16:08:14 -0000
Received: (qmail 94316 invoked by uid 500); 28 Oct 2009 16:08:12 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 94253 invoked by uid 500); 28 Oct 2009 16:08:12 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 94243 invoked by uid 99); 28 Oct 2009 16:08:12 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 16:08:12 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 16:08:09 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id B7B8745EEA9
	for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 17:07:47 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id N7lKjXVD-FR9 for <java-user@lucene.apache.org>;
	Wed, 28 Oct 2009 17:07:33 +0100 (CET)
Received: from VEGA (unknown [134.102.249.78])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 945C245EDDB
	for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 17:07:33 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com> <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com> <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com> <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com> <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com> <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com> <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com> <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com> <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com> <8f0ad1f30910280823j7e5204b0w4eacd070b9a2e971@mail.gmail.com> <9ac0c6aa0910280825n32fdb702nc838c494052299b5@mail.gmail.com>
Subject: RE: IO exception during merge/optimize
Date: Wed, 28 Oct 2009 17:07:32 +0100
Message-ID: <AD7534A8E696470E998A4D3DB92C7DF9@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <9ac0c6aa0910280825n32fdb702nc838c494052299b5@mail.gmail.com>
Thread-Index: AcpX4vd+SAKqckI6RO+9EvVGO1gmRgABbFDg
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

That's exactly what oal.util.UnicodeUtils does when convertig UTF-8 to
UTF-16 (which is Java's internal encoding).

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Michael McCandless [mailto:lucene@mikemccandless.com]
> Sent: Wednesday, October 28, 2009 4:25 PM
> To: java-user@lucene.apache.org
> Subject: Re: IO exception during merge/optimize
>=20
> Right, I would expect Lucene would silently truncate the term at the
> U+FFFF, and not lead to this odd exception.
>=20
> Mike
>=20
> On Wed, Oct 28, 2009 at 11:23 AM, Robert Muir <rcmuir@gmail.com> =
wrote:
> > i might be wrong about this, but recently I intentionally tried to
> create
> > index with terms with U+FFFF to see if it would cause a problem :)
> >
> > the U+FFFF seemed to be discarded completely (maybe at UTF-8 encode
> time)...
> > then again I was using RAMDirectory.
> >
> > On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan
> <peterlkeegan@gmail.com>wrote:
> >
> >> The only change I made to the source code was the patch for
> >> PayloadNearQuery
> >> (LUCENE-1986).
> >> It's possible that our content contains U+FFFF. I will run in =
debugger
> and
> >> see.
> >> The data is 'sensitive', so I may not be able to provide a bad =
segment,
> >> unfortunately.
> >>
> >> Peter
> >>
> >> On Wed, Oct 28, 2009 at 10:43 AM, Michael McCandless <
> >> lucene@mikemccandless.com> wrote:
> >>
> >> > OK... when you exported the sources & built yourself, you didn't =
make
> >> > any changes, right?
> >> >
> >> > It's really odd how many of the errors are due to the term
> >> > "literals:cfid196$", or some variation (one time with "on" =
appended,
> >> > another time with "microsoft"). =A0Do you know what documents =
typically
> >> > contain that term, and what the context is around it? =A0Maybe =
try to
> >> > index only those documents and see if this happens? =A0(It could
> >> > conceivably be caused by bad data, if this is some weird bug). =
=A0One
> >> > question: does your content ever use the [invalid] unicode =
character
> >> > U+FFFF? =A0(Lucene uses this internally to mark the end of the =
term).
> >> >
> >> > Would it be possible to zip up all files starting with _1c =
(should be
> >> > ~22 MB) and post somewhere that I could download? =A0That's the
> smallest
> >> > of the broken segments I think.
> >> >
> >> > I don't need the full IW output just yet, thanks.
> >> >
> >> > Mike
> >> >
> >> > On Wed, Oct 28, 2009 at 10:21 AM, Peter Keegan
> <peterlkeegan@gmail.com>
> >> > wrote:
> >> > > Yes, I used JDK 1.6.0_16 when running CheckIndex and it =
reported
> the
> >> same
> >> > > problems when run multiple times.
> >> > >
> >> > >>Also, what does Lucene version "2.9 exported - 2009-10-27 =
15:31:52"
> >> mean?
> >> > > This appears to be something added by the ant build, since I =
built
> >> Lucene
> >> > > from the source code.
> >> > >
> >> > > I rebuilt the index using mergeFactor=3D50, =
ramBufferSize=3D200MB,
> >> > > maxBufferedDocs=3D1000000
> >> > > This produced 49 segments, 9 of which are broken. The broken
> segments
> >> are
> >> > in
> >> > > the latter half, similar to my previous post with 3 segments. =
Do
> you
> >> > think
> >> > > this could be caused by 'bad' data, for example bad unicode
> characters?
> >> > >
> >> > > Here is the output from CheckIndex:
> >> >
> >> > =
---------------------------------------------------------------------
> >> > To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> > For additional commands, e-mail: java-user-help@lucene.apache.org
> >> >
> >> >
> >>
> >
> >
> >
> > --
> > Robert Muir
> > rcmuir@gmail.com
> >
>=20
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43107-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 16:23:59 2009
Return-Path: <java-user-return-43107-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 81608 invoked from network); 28 Oct 2009 16:23:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 16:23:59 -0000
Received: (qmail 14399 invoked by uid 500); 28 Oct 2009 16:23:57 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14331 invoked by uid 500); 28 Oct 2009 16:23:57 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14321 invoked by uid 99); 28 Oct 2009 16:23:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 16:23:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 16:23:48 +0000
Received: by pwi12 with SMTP id 12so946695pwi.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 09:23:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=HlaQxKrlFe5l1Tii6ga0Znz9ZpnTN0eLh7G9Yt+5wUA=;
        b=blnUAF2mOntBJPeYdvOkPs/JadkBO5nuW+/+d5BQCybsYih6tTcvPlRO+Zrgehdm1C
         /ZrNQIao+VPFNIV0u5nuEpnsqQjHnBFnmlyqyrWxJO8YRTw9XAqF4HfEcnSrkft6Eto8
         Dii9SM+TI7hSOVV+jkCHgYn2Q/tV2cnBOr6hE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=MXI27uVpFEXXtSj1TbHWaT6D/1NyzLgu7mIUFNslfn6xEgbcq3hstgZefhrn02JM0E
         wGGN151M+0uzDYx6pusPd4kCi6W61IUF7+EKIqgIuA9TjD7j+1l2ZECO/koCbRzriAgC
         4DDIN94ylwdYhHpY32WaJZrD87p4czGJ9k/vE=
MIME-Version: 1.0
Received: by 10.142.5.31 with SMTP id 31mr1417387wfe.78.1256747006596; Wed, 28 
	Oct 2009 09:23:26 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910271040h6c9d8e7ds50105e26296c102f@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
Date: Wed, 28 Oct 2009 12:23:26 -0400
Message-ID: <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502b199e698b704770136fd
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502b199e698b704770136fd
Content-Type: text/plain; charset=ISO-8859-1

Just to be safe, I ran with the official jar file from one of the mirrors
and reproduced the problem.
The debug session is not showing any characters = '\uffff' (checking this in
Tokenizer).
The output from the modified CheckIndex follows. There are only a few terms
with the inconsistency. They are all legitimate terms from the app's
context. With this info, I might be able to isolate the source documents.
What should I be looking for when they are indexed?

CheckInput output:

Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4

Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS [Lucene
2.9]
  1 of 3: name=_0 docCount=413585
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=1,148.817
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=0
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs pairs;
340244234 tokens]
    test: stored fields.......OK [1240755 total field count; avg 3 fields
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  2 of 3: name=_1 docCount=359068
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=1,125.161
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=413585
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...WARNING: term  literals:cfid196$ docFreq=43 !=
num docs seen 4 + num docs deleted 0
WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
deleted 0
WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
deleted 0
WARNING: term  literals:cfid196$commandant docFreq=1 != num docs seen 9 +
num docs deleted 0
WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 + num
docs deleted 0
OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
    test: stored fields.......OK [1077204 total field count; avg 3 fields
per doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

  3 of 3: name=_2 docCount=304849
    compound=false
    hasProx=true
    numFiles=8
    size (MB)=962.004
    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
    docStoreOffset=772653
    docStoreSegment=_0
    docStoreIsCompoundFile=false
    no deletions
    test: open reader.........OK
    test: fields..............OK [33 fields]
    test: field norms.........OK [33 fields]
    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 != num
docs seen 246 + num docs deleted 0
WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num docs
deleted 0
WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
deleted 0
WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen 37 + num
docs deleted 0
WARNING: term  literals:cfid196$interrogation docFreq=181 != num docs seen 1
+ num docs deleted 0
WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen 353 + num
docs deleted 0
WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs seen 1 +
num docs deleted 0
WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 + num docs
deleted 0
OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
    test: stored fields.......OK [914547 total field count; avg 3 fields per
doc]
    test: term vectors........OK [0 total vector count; avg 0 term/freq
vector fields per doc]

No problems were detected with this index.

Peter


On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > The only change I made to the source code was the patch for
> PayloadNearQuery
> > (LUCENE-1986).
>
> That patch certainly shouldn't lead to this.
>
> > It's possible that our content contains U+FFFF. I will run in debugger
> and
> > see.
>
> OK may as well check just so we cover all possibilities.
>
> > The data is 'sensitive', so I may not be able to provide a bad segment,
> > unfortunately.
>
> OK, maybe we can modify your CheckIndex instead.  Let's start with
> this, which prints a warning whenever the docFreq differs but
> otherwise continues (vs throwing RuntimeException).  I'm curious how
> many terms show this, and whether the TermEnum keeps working after
> this term that has different docFreq:
>
> Index: src/java/org/apache/lucene/index/CheckIndex.java
> ===================================================================
> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision 829889)
> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working copy)
> @@ -672,8 +672,8 @@
>         }
>
>         if (freq0 + delCount != docFreq) {
> -          throw new RuntimeException("term " + term + " docFreq=" +
> -                                     docFreq + " != num docs seen " +
> freq0 + " + num docs deleted " + delCount);
> +          System.out.println("WARNING: term  " + term + " docFreq=" +
> +                             docFreq + " != num docs seen " + freq0 +
> " + num docs deleted " + delCount);
>         }
>       }
>
> Mike
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502b199e698b704770136fd--

From java-user-return-43108-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Wed Oct 28 17:29:39 2009
Return-Path: <java-user-return-43108-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4485 invoked from network); 28 Oct 2009 17:29:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 28 Oct 2009 17:29:39 -0000
Received: (qmail 39033 invoked by uid 500); 28 Oct 2009 17:29:37 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38955 invoked by uid 500); 28 Oct 2009 17:29:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38945 invoked by uid 99); 28 Oct 2009 17:29:36 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 17:29:36 +0000
X-ASF-Spam-Status: No, hits=1.2 required=10.0
	tests=SPF_NEUTRAL
X-Spam-Check-By: apache.org
Received-SPF: neutral (nike.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 28 Oct 2009 17:29:28 +0000
Received: by ywh13 with SMTP id 13so977782ywh.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 10:29:07 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.150.254.7 with SMTP id b7mr12465440ybi.137.1256750946871; Wed, 
	28 Oct 2009 10:29:06 -0700 (PDT)
In-Reply-To: <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910271157x555b0e3ar375d3e56f7466232@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
Date: Wed, 28 Oct 2009 13:29:06 -0400
Message-ID: <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org, peterlkeegan@gmail.com
Content-Type: multipart/mixed; boundary=000e0cd34dfac26ca0047702219c
X-Virus-Checked: Checked by ClamAV on apache.org

--000e0cd34dfac26ca0047702219c
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hmm, only a few affected terms, and all this particular
"literals:cfid196$" term, with optional suffixes.  Really strange.

One things that's odd is the exact term "literals:cfid196$" is printed
twice, which should never happen (every unique term should be stored
only once, in the terms dict).

And, otherwise, CheckIndex got through the index just fine.

Try searching a TermQuery with these affected terms and see if it
succeeds?  If so, maybe trying making an index with one or two of
them, alone, and see if that index shows the problem?

OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
produce an enormous amount of output, but if you can excise the few
lines around when that warning comes out & post back that'd be great.

Mike

On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com> wro=
te:
> Just to be safe, I ran with the official jar file from one of the mirrors
> and reproduced the problem.
> The debug session is not showing any characters =3D '\uffff' (checking th=
is in
> Tokenizer).
> The output from the modified CheckIndex follows. There are only a few ter=
ms
> with the inconsistency. They are all legitimate terms from the app's
> context. With this info, I might be able to isolate the source documents.
> What should I be looking for when they are indexed?
>
> CheckInput output:
>
> Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
>
> Segments file=3Dsegments_2 numSegments=3D3 version=3DFORMAT_DIAGNOSTICS [=
Lucene
> 2.9]
> =A01 of 3: name=3D_0 docCount=3D413585
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D1,148.817
> =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.versi=
on=3D2.9.0
> 817268P - 2009-09-21 10:25:09, source=3Dflush, os.arch=3Damd64,
> java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D0
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs =
pairs;
> 340244234 tokens]
> =A0 =A0test: stored fields.......OK [1240755 total field count; avg 3 fie=
lds
> per doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
>
> =A02 of 3: name=3D_1 docCount=3D359068
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D1,125.161
> =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.versi=
on=3D2.9.0
> 817268P - 2009-09-21 10:25:09, source=3Dflush, os.arch=3Damd64,
> java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D413585
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...WARNING: term =A0literals:cfid196$ docFr=
eq=3D43 !=3D
> num docs seen 4 + num docs deleted 0
> WARNING: term =A0literals:cfid196$ docFreq=3D1 !=3D num docs seen 4 + num=
 docs
> deleted 0
> WARNING: term =A0literals:cfid196$ docFreq=3D1 !=3D num docs seen 4 + num=
 docs
> deleted 0
> WARNING: term =A0literals:cfid196$commandant docFreq=3D1 !=3D num docs se=
en 9 +
> num docs deleted 0
> WARNING: term =A0literals:cfid196$on docFreq=3D3178 !=3D num docs seen 1 =
+ num
> docs deleted 0
> OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
> =A0 =A0test: stored fields.......OK [1077204 total field count; avg 3 fie=
lds
> per doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
>
> =A03 of 3: name=3D_2 docCount=3D304849
> =A0 =A0compound=3Dfalse
> =A0 =A0hasProx=3Dtrue
> =A0 =A0numFiles=3D8
> =A0 =A0size (MB)=3D962.004
> =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.versi=
on=3D2.9.0
> 817268P - 2009-09-21 10:25:09, source=3Dflush, os.arch=3Damd64,
> java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
> =A0 =A0docStoreOffset=3D772653
> =A0 =A0docStoreSegment=3D_0
> =A0 =A0docStoreIsCompoundFile=3Dfalse
> =A0 =A0no deletions
> =A0 =A0test: open reader.........OK
> =A0 =A0test: fields..............OK [33 fields]
> =A0 =A0test: field norms.........OK [33 fields]
> =A0 =A0test: terms, freq, prox...WARNING: term =A0contents:? docFreq=3D1 =
!=3D num
> docs seen 246 + num docs deleted 0
> WARNING: term =A0literals:cfid196$ docFreq=3D45 !=3D num docs seen 4 + nu=
m docs
> deleted 0
> WARNING: term =A0literals:cfid196$ docFreq=3D1 !=3D num docs seen 4 + num=
 docs
> deleted 0
> WARNING: term =A0literals:cfid196$cashier docFreq=3D1 !=3D num docs seen =
37 + num
> docs deleted 0
> WARNING: term =A0literals:cfid196$interrogation docFreq=3D181 !=3D num do=
cs seen 1
> + num docs deleted 0
> WARNING: term =A0literals:cfid196$leader docFreq=3D1 !=3D num docs seen 3=
53 + num
> docs deleted 0
> WARNING: term =A0literals:cfid196$microsoft docFreq=3D3114 !=3D num docs =
seen 1 +
> num docs deleted 0
> WARNING: term =A0literals:cfid196$nt docFreq=3D200 !=3D num docs seen 1 +=
 num docs
> deleted 0
> OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
> =A0 =A0test: stored fields.......OK [914547 total field count; avg 3 fiel=
ds per
> doc]
> =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term/fre=
q
> vector fields per doc]
>
> No problems were detected with this index.
>
> Peter
>
>
> On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > The only change I made to the source code was the patch for
>> PayloadNearQuery
>> > (LUCENE-1986).
>>
>> That patch certainly shouldn't lead to this.
>>
>> > It's possible that our content contains U+FFFF. I will run in debugger
>> and
>> > see.
>>
>> OK may as well check just so we cover all possibilities.
>>
>> > The data is 'sensitive', so I may not be able to provide a bad segment=
,
>> > unfortunately.
>>
>> OK, maybe we can modify your CheckIndex instead. =A0Let's start with
>> this, which prints a warning whenever the docFreq differs but
>> otherwise continues (vs throwing RuntimeException). =A0I'm curious how
>> many terms show this, and whether the TermEnum keeps working after
>> this term that has different docFreq:
>>
>> Index: src/java/org/apache/lucene/index/CheckIndex.java
>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>> --- src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(revision 82=
9889)
>> +++ src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(working cop=
y)
>> @@ -672,8 +672,8 @@
>> =A0 =A0 =A0 =A0 }
>>
>> =A0 =A0 =A0 =A0 if (freq0 + delCount !=3D docFreq) {
>> - =A0 =A0 =A0 =A0 =A0throw new RuntimeException("term " + term + " docFr=
eq=3D" +
>> - =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 docFreq + " !=3D num docs seen " +
>> freq0 + " + num docs deleted " + delCount);
>> + =A0 =A0 =A0 =A0 =A0System.out.println("WARNING: term =A0" + term + " d=
ocFreq=3D" +
>> + =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 docFreq + " !=
=3D num docs seen " + freq0 +
>> " + num docs deleted " + delCount);
>> =A0 =A0 =A0 =A0 }
>> =A0 =A0 =A0 }
>>
>> Mike
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>


--000e0cd34dfac26ca0047702219c
Content-Type: text/plain; charset=us-ascii


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org
--000e0cd34dfac26ca0047702219c--

From java-user-return-43109-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 00:01:37 2009
Return-Path: <java-user-return-43109-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 57330 invoked from network); 29 Oct 2009 00:01:36 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 00:01:36 -0000
Received: (qmail 91082 invoked by uid 500); 29 Oct 2009 00:01:34 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91023 invoked by uid 500); 29 Oct 2009 00:01:34 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91013 invoked by uid 99); 29 Oct 2009 00:01:34 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 00:01:34 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of markrmiller@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 00:01:31 +0000
Received: by yxe30 with SMTP id 30so1358970yxe.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 17:01:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:x-enigmail-version:content-type
         :content-transfer-encoding;
        bh=dNcT+LHxFgTSYLVrH1h49LdPrOuF0DsGIp365mBGP+Y=;
        b=fCaUN6DGUF5klsZJykFlbmvHZZYRnOcGjHmGZx/oFR+l8duCs2MW/rTzlMYB759V62
         bXUVJn5oGmWEW9nVceSz5EeDbtSc8nNrPwquX/+xR7cfHpSnJ9rxWNHjdkQ+IcYlrcxh
         WAwLXVR24fUzj65yk6Gx7yU7sBb7d1BaqPBCc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject
         :x-enigmail-version:content-type:content-transfer-encoding;
        b=Wh0A1oqdW6BAK6kbdcJmzVWNoyMIUxbMnSGyLwKm6pe9Shqf4oJVmHCQMtue4HcvaS
         lRyAEQ9sjbwO2J3c761F3gFrj6gLDuqcFiTSWXgot58knoGH2ouFQ+tOKouP0ZA+WFax
         3BzLxG7dvfYv+kWrEmE4Iqlof3OsUiojI4YFM=
Received: by 10.150.81.5 with SMTP id e5mr9598722ybb.146.1256774470244;
        Wed, 28 Oct 2009 17:01:10 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 15sm666450gxk.12.2009.10.28.17.01.07
        (version=SSLv3 cipher=RC4-MD5);
        Wed, 28 Oct 2009 17:01:08 -0700 (PDT)
Message-ID: <4AE8DB43.1050305@gmail.com>
Date: Wed, 28 Oct 2009 20:01:07 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: [ANN] New Technical White Paper on Apache Lucene 2.9 from Lucid Imagination
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

With the recent release of Apache Lucene 2.9, Lucid Imagination has put
together an in-depth technical white paper on the range of performance
improvements and new features (per segment indexing, trierange numeric
analysis, and more), along with recommendations for upgrading your
Lucene application to the 2.9 release.  You can download the white paper
at
http://www.lucidimagination.com/whitepaper/whats-new-in-lucene-2-9?sc=AP.

-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43110-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 02:13:31 2009
Return-Path: <java-user-return-43110-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94222 invoked from network); 29 Oct 2009 02:13:31 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 02:13:31 -0000
Received: (qmail 75974 invoked by uid 500); 29 Oct 2009 02:13:28 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 75910 invoked by uid 500); 29 Oct 2009 02:13:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 75900 invoked by uid 99); 29 Oct 2009 02:13:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 02:13:28 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of akaris@gmail.com designates 209.85.210.192 as permitted sender)
Received: from [209.85.210.192] (HELO mail-yx0-f192.google.com) (209.85.210.192)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 02:13:19 +0000
Received: by yxe30 with SMTP id 30so1457265yxe.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 19:12:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:from:date:message-id
         :subject:to:content-type;
        bh=xfpAmG5rO6t9G6OEDc6cSb2UtPeHGADNjsKwfdWFojw=;
        b=xbX3tMGJPccVeOxzplOEthDQI7KgRj464aFsA1cpjkMRtdQX2Irp5ZTDWXnOhTCK/W
         JM2SQ2QgiBG+R2ltKgig4nfJ9No4TCQOucESx/WIkWLKEegZ/1zg+7tG54LOIg1A+Mma
         Ij90E1Tl/gb41kzrceOnMoBQnKgXR2mibwIPQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:from:date:message-id:subject:to:content-type;
        b=ZU71vgzhYdirI4qkxgTmbAt8/5QaqNY+PXpoXw2qazx6mttUOxIvxXXkS9J14CcF/U
         AR57jUGnSlD5fs0ENyPlu2A9mKVffBbhsgcceneywELoHx1qkh35FrvCOGK4I+Lcp0Cs
         De3BZv4XTV8cs3gLbIxgMkCilQ/2MmEWtrRdk=
MIME-Version: 1.0
Received: by 10.101.165.4 with SMTP id s4mr746011ano.119.1256782378295; Wed, 
	28 Oct 2009 19:12:58 -0700 (PDT)
From: Michel Nadeau <akaris@gmail.com>
Date: Wed, 28 Oct 2009 22:12:38 -0400
Message-ID: <962c93f60910281912m1a548377w906745bb1189ad63@mail.gmail.com>
Subject: Lucene 2.9.0 / BooleanQuery problem
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636c5bd3d37e23a0477097343
X-Virus-Checked: Checked by ClamAV on apache.org

--001636c5bd3d37e23a0477097343
Content-Type: text/plain; charset=ISO-8859-1

Hi !

I spent all night trying to get a simple BooleanQuery working and I really
can't figure out what is my problem. See this very simple program :

public class test {

    @SuppressWarnings("deprecation")
    public static void main(String[] args) throws ParseException,
CorruptIndexException, LockObtainFailedException, IOException
    {
        // Open index directory
        File idx = new File("d:/Java/index/");

        // Create IndexWriter
        IndexWriter writer = new IndexWriter(idx, new
StandardAnalyzer(Version.LUCENE_CURRENT), true,
IndexWriter.MaxFieldLength.LIMITED);

        //
        // Add some documents to the index
        //

        Document doc = new Document();
        doc.add(new Field("firstname", "Mike", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("phone", "111-222-3333", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("sector", "IT", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("group", "group", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("content", "blue this is some content",
Field.Store.YES, Field.Index.ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("firstname", "Pascale", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("lastname", "Lavoie", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("phone", "333-222-1111", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("sector", "Accounting", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("group", "othergroup", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("content", "red this is some content",
Field.Store.YES, Field.Index.ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("firstname", "Kaven", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("lastname", "Rouseau", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("phone", "222-333-1111", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("sector", "IT", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("group", "group", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("content", "red this is some content",
Field.Store.YES, Field.Index.ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("firstname", "Mike", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("lastname", "Peters", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("phone", "444-444-4444", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("sector", "IT", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("group", "othergroup", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("content", "this is some content",
Field.Store.YES, Field.Index.ANALYZED));
        writer.addDocument(doc);

        doc = new Document();
        doc.add(new Field("firstname", "Marie-Pier", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("phone", "123-123-1234", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("sector", "Accounting", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("group", "group", Field.Store.YES,
Field.Index.ANALYZED));
        doc.add(new Field("content", "this is some content",
Field.Store.YES, Field.Index.ANALYZED));
        writer.addDocument(doc);

        // Optimize + close index
        writer.optimize();
        writer.close();

        // Open IndexReader/Searcher
        IndexReader reader = IndexReader.open(idx, true);
        Searcher searcher = new IndexSearcher(reader);

        //
        // Test normal query
        //
        String m_field = "content";
        String m_query = "sector:IT AND group:group";
        Analyzer analyzer = new StandardAnalyzer(Version.LUCENE_CURRENT);
        QueryParser parser = new QueryParser(m_field, analyzer);
        Query query = parser.parse(m_query);

        // Search!
        System.out.println("Normal query: " + m_query + "\n");
        doStreamingSearch(searcher, query);

        System.out.println("===========================================\n");

        //
        // Test BooleanQuery
        //
        BooleanQuery query2 = new BooleanQuery();
        query2.add(new TermQuery(new Term("sector", "IT")), Occur.MUST);
        query2.add(new TermQuery(new Term("group", "group")), Occur.MUST);

        // Search!
        System.out.println("BooleanQuery:\n");
        doStreamingSearch(searcher, query2);
        System.out.println("Done!");
    }

    public static void doStreamingSearch(final Searcher searcher, Query
query) throws IOException
    {
        Collector streamingHitCollector = new Collector()
        {
            private Scorer scorer;
            private int docBase;

            public void collect(int doc) throws IOException
            {
                Document theDoc = searcher.doc(doc);

                System.out.println("+ First Name   =
"+theDoc.get("firstname"));
                System.out.println("+ Last Name    =
"+theDoc.get("lastname"));
                System.out.println("+ Phone Number = "+theDoc.get("phone"));
                System.out.println("+ Sector       =
"+theDoc.get("sector"));
                System.out.println("+ Group        = "+theDoc.get("group"));
                System.out.println("+ Content      =
"+theDoc.get("content"));
                System.out.println("");
            }

            public boolean acceptsDocsOutOfOrder()
            {
                return true;
            }

            public void setNextReader(IndexReader reader, int docBase)
throws IOException
            {
                this.docBase = docBase;
            }

            public void setScorer(Scorer scorer) throws IOException
            {
                this.scorer = scorer;
            }
        };
        searcher.search(query, streamingHitCollector);
    }

}

And here's the output of the program :

Normal query: *sector:IT AND group:group*

+ First Name   = Mike
+ Last Name    = Nadeau
+ Phone Number = 111-222-3333
+ Sector       = IT
+ Group        = group
+ Content      = blue this is some content

+ First Name   = Kaven
+ Last Name    = Rouseau
+ Phone Number = 222-333-1111
+ Sector       = IT
+ Group        = group
+ Content      = red this is some content

+ First Name   = Marie-Pier
+ Last Name    = Nadeau
+ Phone Number = 123-123-1234
*+ Sector       = Accounting*
+ Group        = group
+ Content      = this is some content

===========================================

BooleanQuery:

Done!

So I have 2 important problems:

(1) the normal query (sector:IT AND group:group) - how can it return
"Marie-Pier Nadeau", which has "Accounting" as group?

(2) the BooleanQuery - why isn't it returning anything?

Thanks for your help!

- Mike
akaris@gmail.com

--001636c5bd3d37e23a0477097343--

From java-user-return-43111-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 03:57:56 2009
Return-Path: <java-user-return-43111-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 14071 invoked from network); 29 Oct 2009 03:57:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 03:57:55 -0000
Received: (qmail 43109 invoked by uid 500); 29 Oct 2009 03:57:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 42823 invoked by uid 500); 29 Oct 2009 03:57:53 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 42812 invoked by uid 99); 29 Oct 2009 03:57:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 03:57:52 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of jake.mannix@gmail.com designates 209.85.217.220 as permitted sender)
Received: from [209.85.217.220] (HELO mail-gx0-f220.google.com) (209.85.217.220)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 03:57:44 +0000
Received: by gxk20 with SMTP id 20so2054151gxk.12
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 20:57:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=M9jKXBlvtYnbkdRuPMMcL3uKg+nx/0Gjq89TdxLkDSc=;
        b=NCDaFqb1JCt0EDwA3HOOkYc7JAw5WrMXG1fvNMXhqz4OsOPXkdCzk/BR+Z9KDb+SnU
         Mn5uAHXAi4b103Lifn9+wYmkUZgnmYIY1ONs7foGvw12ecHd1/YruwFgWLT722SaQ06q
         njNNsN8kTEXMUgWFM2AS1RHS79aqZNNeWBS4s=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Dgd9qT4LujMebWZTUk9Vp9Zbb/wsqLWqKjAvVc4kGWmTifZLrmXNANkPKLQRZSQJo0
         rzwM9XUbigHOcfxfh+yfLnmd4JC+hI/ZxovHoWitv/mftWdxW/gplHr6uD0qZXax44y8
         hBEC3O8SMR6RK2YZfcga8Uv5uih7lq5kMbvws=
MIME-Version: 1.0
Received: by 10.90.217.11 with SMTP id p11mr1465320agg.82.1256788642822; Wed, 
	28 Oct 2009 20:57:22 -0700 (PDT)
In-Reply-To: <962c93f60910281912m1a548377w906745bb1189ad63@mail.gmail.com>
References: <962c93f60910281912m1a548377w906745bb1189ad63@mail.gmail.com>
Date: Wed, 28 Oct 2009 20:57:22 -0700
Message-ID: <4b124c310910282057v7fa1ea85of83065176c0e4794@mail.gmail.com>
Subject: Re: Lucene 2.9.0 / BooleanQuery problem
From: Jake Mannix <jake.mannix@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368324b29d071a04770ae823
X-Virus-Checked: Checked by ClamAV on apache.org

--0016368324b29d071a04770ae823
Content-Type: text/plain; charset=ISO-8859-1

Hi Michel,

  I don't have time to look in too much detail right now, but I'll bet ya $5
it's because
your query is for "sector:IT" - 'IT' lowercases to 'it' which is in the
default stopword
list, and if you're not careful about how you query with this, you'll end up
with TermQuery
instances which hit nothing, because this term may be stop-listed out of
your index!

  Can you run the test again with no stop words in your query, and see what
it
gives?

  -jake

On Wed, Oct 28, 2009 at 7:12 PM, Michel Nadeau <akaris@gmail.com> wrote:

> Hi !
>
> I spent all night trying to get a simple BooleanQuery working and I really
> can't figure out what is my problem. See this very simple program :
>
> public class test {
>
>    @SuppressWarnings("deprecation")
>    public static void main(String[] args) throws ParseException,
> CorruptIndexException, LockObtainFailedException, IOException
>    {
>        // Open index directory
>        File idx = new File("d:/Java/index/");
>
>        // Create IndexWriter
>        IndexWriter writer = new IndexWriter(idx, new
> StandardAnalyzer(Version.LUCENE_CURRENT), true,
> IndexWriter.MaxFieldLength.LIMITED);
>
>        //
>        // Add some documents to the index
>        //
>
>        Document doc = new Document();
>        doc.add(new Field("firstname", "Mike", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("phone", "111-222-3333", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("sector", "IT", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("group", "group", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("content", "blue this is some content",
> Field.Store.YES, Field.Index.ANALYZED));
>        writer.addDocument(doc);
>
>        doc = new Document();
>        doc.add(new Field("firstname", "Pascale", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("lastname", "Lavoie", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("phone", "333-222-1111", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("sector", "Accounting", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("group", "othergroup", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("content", "red this is some content",
> Field.Store.YES, Field.Index.ANALYZED));
>        writer.addDocument(doc);
>
>        doc = new Document();
>        doc.add(new Field("firstname", "Kaven", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("lastname", "Rouseau", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("phone", "222-333-1111", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("sector", "IT", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("group", "group", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("content", "red this is some content",
> Field.Store.YES, Field.Index.ANALYZED));
>        writer.addDocument(doc);
>
>        doc = new Document();
>        doc.add(new Field("firstname", "Mike", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("lastname", "Peters", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("phone", "444-444-4444", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("sector", "IT", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("group", "othergroup", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("content", "this is some content",
> Field.Store.YES, Field.Index.ANALYZED));
>        writer.addDocument(doc);
>
>        doc = new Document();
>        doc.add(new Field("firstname", "Marie-Pier", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("phone", "123-123-1234", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("sector", "Accounting", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("group", "group", Field.Store.YES,
> Field.Index.ANALYZED));
>        doc.add(new Field("content", "this is some content",
> Field.Store.YES, Field.Index.ANALYZED));
>        writer.addDocument(doc);
>
>        // Optimize + close index
>        writer.optimize();
>        writer.close();
>
>        // Open IndexReader/Searcher
>        IndexReader reader = IndexReader.open(idx, true);
>        Searcher searcher = new IndexSearcher(reader);
>
>        //
>        // Test normal query
>        //
>        String m_field = "content";
>        String m_query = "sector:IT AND group:group";
>        Analyzer analyzer = new StandardAnalyzer(Version.LUCENE_CURRENT);
>        QueryParser parser = new QueryParser(m_field, analyzer);
>        Query query = parser.parse(m_query);
>
>        // Search!
>        System.out.println("Normal query: " + m_query + "\n");
>        doStreamingSearch(searcher, query);
>
>        System.out.println("===========================================\n");
>
>        //
>        // Test BooleanQuery
>        //
>        BooleanQuery query2 = new BooleanQuery();
>        query2.add(new TermQuery(new Term("sector", "IT")), Occur.MUST);
>        query2.add(new TermQuery(new Term("group", "group")), Occur.MUST);
>
>        // Search!
>        System.out.println("BooleanQuery:\n");
>        doStreamingSearch(searcher, query2);
>        System.out.println("Done!");
>    }
>
>    public static void doStreamingSearch(final Searcher searcher, Query
> query) throws IOException
>    {
>        Collector streamingHitCollector = new Collector()
>        {
>            private Scorer scorer;
>            private int docBase;
>
>            public void collect(int doc) throws IOException
>            {
>                Document theDoc = searcher.doc(doc);
>
>                System.out.println("+ First Name   =
> "+theDoc.get("firstname"));
>                System.out.println("+ Last Name    =
> "+theDoc.get("lastname"));
>                System.out.println("+ Phone Number = "+theDoc.get("phone"));
>                System.out.println("+ Sector       =
> "+theDoc.get("sector"));
>                System.out.println("+ Group        = "+theDoc.get("group"));
>                System.out.println("+ Content      =
> "+theDoc.get("content"));
>                System.out.println("");
>            }
>
>            public boolean acceptsDocsOutOfOrder()
>            {
>                return true;
>            }
>
>            public void setNextReader(IndexReader reader, int docBase)
> throws IOException
>            {
>                this.docBase = docBase;
>            }
>
>            public void setScorer(Scorer scorer) throws IOException
>            {
>                this.scorer = scorer;
>            }
>        };
>        searcher.search(query, streamingHitCollector);
>    }
>
> }
>
> And here's the output of the program :
>
> Normal query: *sector:IT AND group:group*
>
> + First Name   = Mike
> + Last Name    = Nadeau
> + Phone Number = 111-222-3333
> + Sector       = IT
> + Group        = group
> + Content      = blue this is some content
>
> + First Name   = Kaven
> + Last Name    = Rouseau
> + Phone Number = 222-333-1111
> + Sector       = IT
> + Group        = group
> + Content      = red this is some content
>
> + First Name   = Marie-Pier
> + Last Name    = Nadeau
> + Phone Number = 123-123-1234
> *+ Sector       = Accounting*
> + Group        = group
> + Content      = this is some content
>
> ===========================================
>
> BooleanQuery:
>
> Done!
>
> So I have 2 important problems:
>
> (1) the normal query (sector:IT AND group:group) - how can it return
> "Marie-Pier Nadeau", which has "Accounting" as group?
>
> (2) the BooleanQuery - why isn't it returning anything?
>
> Thanks for your help!
>
> - Mike
> akaris@gmail.com
>

--0016368324b29d071a04770ae823--

From java-user-return-43112-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 04:08:39 2009
Return-Path: <java-user-return-43112-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 15722 invoked from network); 29 Oct 2009 04:08:39 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 04:08:38 -0000
Received: (qmail 54005 invoked by uid 500); 29 Oct 2009 04:08:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53814 invoked by uid 500); 29 Oct 2009 04:08:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53804 invoked by uid 99); 29 Oct 2009 04:08:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 04:08:36 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of akaris@gmail.com designates 209.85.211.183 as permitted sender)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 04:08:33 +0000
Received: by ywh13 with SMTP id 13so1522713ywh.29
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 21:08:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=MCAqbhJ4KvNtCPkYRxfiV6JlwrKukm+pgPq+0uJVGBE=;
        b=DVtLnan+u2P9JZQNfrj3z/8URcPkecAVwWAqsx3K1xsVJ7KZl6gQM1YrnLkOBauTxE
         5GbAS0WVYo+/HuSsh9mbJGjrVCTHC1HtOulMd8aGnGo0ZA4BYNacsKdInAmbCwscsMCs
         +tX37beujCDwl5NG6VssJEMjdRYOZL37ANPKQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=t59rfVriPnwJZZ+u3uhUk9UmWVuTSmdYa6v9tPToD+ILQ36+kqS7P/QtrgrlqLgWKG
         w9bv/EnP26Qhuz/Ywg8iQbyGTicOVysNYPKmZkLVQPeWA14e/BhHQFswcUuPEg+jLkZV
         oFibzrZJHPv7wdaHh1lehyMrTWKPxud/tpYt0=
MIME-Version: 1.0
Received: by 10.101.13.7 with SMTP id q7mr145036ani.112.1256789292130; Wed, 28 
	Oct 2009 21:08:12 -0700 (PDT)
In-Reply-To: <4b124c310910282057v7fa1ea85of83065176c0e4794@mail.gmail.com>
References: <962c93f60910281912m1a548377w906745bb1189ad63@mail.gmail.com> 
	<4b124c310910282057v7fa1ea85of83065176c0e4794@mail.gmail.com>
From: Michel Nadeau <akaris@gmail.com>
Date: Thu, 29 Oct 2009 00:07:52 -0400
Message-ID: <962c93f60910282107x247d4f2l39475edae12fee87@mail.gmail.com>
Subject: Re: Lucene 2.9.0 / BooleanQuery problem
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=005045016f9050a09e04770b0fdf

--005045016f9050a09e04770b0fdf
Content-Type: text/plain; charset=ISO-8859-1

OMG, it's SO OBVIOUS!!!!! For the normal search (sector:IT AND group:group)
the problem was indeed that IT is "it", stopword. Thanks, I was so not
seeing it!

But what about the BooleanQuery? It should work fine too now...

        //
        // Test BooleanQuery
        //
        BooleanQuery query2 = new BooleanQuery();
        query2.add(new TermQuery(new Term("sector", "Computing")),
Occur.MUST);
        query2.add(new TermQuery(new Term("group", "group")), Occur.MUST);

        // Search!
        System.out.println("BooleanQuery:\n");
        doStreamingSearch(searcher, query2);
        System.out.println("Done!");

Thanks,

- Mike
akaris@gmail.com


On Wed, Oct 28, 2009 at 11:57 PM, Jake Mannix <jake.mannix@gmail.com> wrote:

> Hi Michel,
>
>  I don't have time to look in too much detail right now, but I'll bet ya $5
> it's because
> your query is for "sector:IT" - 'IT' lowercases to 'it' which is in the
> default stopword
> list, and if you're not careful about how you query with this, you'll end
> up
> with TermQuery
> instances which hit nothing, because this term may be stop-listed out of
> your index!
>
>  Can you run the test again with no stop words in your query, and see what
> it
> gives?
>
>  -jake
>
> On Wed, Oct 28, 2009 at 7:12 PM, Michel Nadeau <akaris@gmail.com> wrote:
>
> > Hi !
> >
> > I spent all night trying to get a simple BooleanQuery working and I
> really
> > can't figure out what is my problem. See this very simple program :
> >
> > public class test {
> >
> >    @SuppressWarnings("deprecation")
> >    public static void main(String[] args) throws ParseException,
> > CorruptIndexException, LockObtainFailedException, IOException
> >    {
> >        // Open index directory
> >        File idx = new File("d:/Java/index/");
> >
> >        // Create IndexWriter
> >        IndexWriter writer = new IndexWriter(idx, new
> > StandardAnalyzer(Version.LUCENE_CURRENT), true,
> > IndexWriter.MaxFieldLength.LIMITED);
> >
> >        //
> >        // Add some documents to the index
> >        //
> >
> >        Document doc = new Document();
> >        doc.add(new Field("firstname", "Mike", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("phone", "111-222-3333", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("sector", "IT", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("group", "group", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("content", "blue this is some content",
> > Field.Store.YES, Field.Index.ANALYZED));
> >        writer.addDocument(doc);
> >
> >        doc = new Document();
> >        doc.add(new Field("firstname", "Pascale", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("lastname", "Lavoie", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("phone", "333-222-1111", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("sector", "Accounting", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("group", "othergroup", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("content", "red this is some content",
> > Field.Store.YES, Field.Index.ANALYZED));
> >        writer.addDocument(doc);
> >
> >        doc = new Document();
> >        doc.add(new Field("firstname", "Kaven", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("lastname", "Rouseau", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("phone", "222-333-1111", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("sector", "IT", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("group", "group", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("content", "red this is some content",
> > Field.Store.YES, Field.Index.ANALYZED));
> >        writer.addDocument(doc);
> >
> >        doc = new Document();
> >        doc.add(new Field("firstname", "Mike", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("lastname", "Peters", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("phone", "444-444-4444", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("sector", "IT", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("group", "othergroup", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("content", "this is some content",
> > Field.Store.YES, Field.Index.ANALYZED));
> >        writer.addDocument(doc);
> >
> >        doc = new Document();
> >        doc.add(new Field("firstname", "Marie-Pier", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("phone", "123-123-1234", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("sector", "Accounting", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("group", "group", Field.Store.YES,
> > Field.Index.ANALYZED));
> >        doc.add(new Field("content", "this is some content",
> > Field.Store.YES, Field.Index.ANALYZED));
> >        writer.addDocument(doc);
> >
> >        // Optimize + close index
> >        writer.optimize();
> >        writer.close();
> >
> >        // Open IndexReader/Searcher
> >        IndexReader reader = IndexReader.open(idx, true);
> >        Searcher searcher = new IndexSearcher(reader);
> >
> >        //
> >        // Test normal query
> >        //
> >        String m_field = "content";
> >        String m_query = "sector:IT AND group:group";
> >        Analyzer analyzer = new StandardAnalyzer(Version.LUCENE_CURRENT);
> >        QueryParser parser = new QueryParser(m_field, analyzer);
> >        Query query = parser.parse(m_query);
> >
> >        // Search!
> >        System.out.println("Normal query: " + m_query + "\n");
> >        doStreamingSearch(searcher, query);
> >
> >
>  System.out.println("===========================================\n");
> >
> >        //
> >        // Test BooleanQuery
> >        //
> >        BooleanQuery query2 = new BooleanQuery();
> >        query2.add(new TermQuery(new Term("sector", "IT")), Occur.MUST);
> >        query2.add(new TermQuery(new Term("group", "group")), Occur.MUST);
> >
> >        // Search!
> >        System.out.println("BooleanQuery:\n");
> >        doStreamingSearch(searcher, query2);
> >        System.out.println("Done!");
> >    }
> >
> >    public static void doStreamingSearch(final Searcher searcher, Query
> > query) throws IOException
> >    {
> >        Collector streamingHitCollector = new Collector()
> >        {
> >            private Scorer scorer;
> >            private int docBase;
> >
> >            public void collect(int doc) throws IOException
> >            {
> >                Document theDoc = searcher.doc(doc);
> >
> >                System.out.println("+ First Name   =
> > "+theDoc.get("firstname"));
> >                System.out.println("+ Last Name    =
> > "+theDoc.get("lastname"));
> >                System.out.println("+ Phone Number =
> "+theDoc.get("phone"));
> >                System.out.println("+ Sector       =
> > "+theDoc.get("sector"));
> >                System.out.println("+ Group        =
> "+theDoc.get("group"));
> >                System.out.println("+ Content      =
> > "+theDoc.get("content"));
> >                System.out.println("");
> >            }
> >
> >            public boolean acceptsDocsOutOfOrder()
> >            {
> >                return true;
> >            }
> >
> >            public void setNextReader(IndexReader reader, int docBase)
> > throws IOException
> >            {
> >                this.docBase = docBase;
> >            }
> >
> >            public void setScorer(Scorer scorer) throws IOException
> >            {
> >                this.scorer = scorer;
> >            }
> >        };
> >        searcher.search(query, streamingHitCollector);
> >    }
> >
> > }
> >
> > And here's the output of the program :
> >
> > Normal query: *sector:IT AND group:group*
> >
> > + First Name   = Mike
> > + Last Name    = Nadeau
> > + Phone Number = 111-222-3333
> > + Sector       = IT
> > + Group        = group
> > + Content      = blue this is some content
> >
> > + First Name   = Kaven
> > + Last Name    = Rouseau
> > + Phone Number = 222-333-1111
> > + Sector       = IT
> > + Group        = group
> > + Content      = red this is some content
> >
> > + First Name   = Marie-Pier
> > + Last Name    = Nadeau
> > + Phone Number = 123-123-1234
> > *+ Sector       = Accounting*
> > + Group        = group
> > + Content      = this is some content
> >
> > ===========================================
> >
> > BooleanQuery:
> >
> > Done!
> >
> > So I have 2 important problems:
> >
> > (1) the normal query (sector:IT AND group:group) - how can it return
> > "Marie-Pier Nadeau", which has "Accounting" as group?
> >
> > (2) the BooleanQuery - why isn't it returning anything?
> >
> > Thanks for your help!
> >
> > - Mike
> > akaris@gmail.com
> >
>

--005045016f9050a09e04770b0fdf--

From java-user-return-43113-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 05:05:11 2009
Return-Path: <java-user-return-43113-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 24544 invoked from network); 29 Oct 2009 05:05:11 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 05:05:11 -0000
Received: (qmail 1173 invoked by uid 500); 29 Oct 2009 05:05:09 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 1009 invoked by uid 500); 29 Oct 2009 05:05:08 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 999 invoked by uid 99); 29 Oct 2009 05:05:08 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 05:05:08 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of s.rajan09@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 05:04:58 +0000
Received: by pwi12 with SMTP id 12so1319357pwi.5
        for <java-user@lucene.apache.org>; Wed, 28 Oct 2009 22:04:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=lL/y0W0QmrX6i4pU2y1NhjKtuKMElVVZVPz+Ht5STpc=;
        b=rc0YKh5GpIXsTY8aWPbtXzAyS3hNUq6Kog4LW4bam/Qml9BAQRt03eSFChpem0bjdJ
         +Q85nmAtC8IYUDL2JpmdolruTollvwDp/R7rfgK3OsPc+COcbiWFm/jIHW/AkyxU7zzb
         ppEy72aBo9BPgVIpJmISV2o+0PiIG7f2qkeBU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=sCIEbCLur/GfbPIysNBUR5tOlEMSzjsuFp1j6T1/TERRZKu/1h4JncsKggubll9/En
         NvRyHptuXvdmA32tvydLWiYx4RQRPl/3w4asGisCS2BkphfvGbshmmlXXoIhCCbv+Wix
         Y16Xp1+ctYdjD8IV4O5N3NseDb/3jVcbPJnHM=
MIME-Version: 1.0
Received: by 10.143.20.13 with SMTP id x13mr1542731wfi.55.1256792676474; Wed, 
	28 Oct 2009 22:04:36 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910280235o2b4231f3n6195490e037e4672@mail.gmail.com>
References: <b14c25870910271734w112b5ea2k166ed5d9d84d5c11@mail.gmail.com>
	 <9ac0c6aa0910280235o2b4231f3n6195490e037e4672@mail.gmail.com>
Date: Thu, 29 Oct 2009 10:34:36 +0530
Message-ID: <b14c25870910282204v443a733g533a5dafc086a58f@mail.gmail.com>
Subject: Re: SearchFiles demo fails with exception while IndexFiles works
From: s rajan <s.rajan09@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502cc2b099fb104770bd9f6
X-Virus-Checked: Checked by ClamAV on apache.org

--00504502cc2b099fb104770bd9f6
Content-Type: text/plain; charset=ISO-8859-1

Mike, thanks for that URL, I saw a similar issue being discussed on
stackoverflow.

I am doing an external ant build and trying to debug through eclipse. For
some reason eclipse is failing to import the ant build file as a project so
i use a debug configuration and build externally.

I now have the problem solved by a clean build but my hunch is that the jar
had 1.4 and 1.6 object files -for a brief period I had a few sources build
via eclipse and it had a jdk1.4 as its setting.
I still have the 'bad' jar but have not investigated further - the only
thing I can think of is object file mismatch.
It beats me why the loader flags compilation error or perhaps does it means
JIT compilation?  I think there is an issue here in that the jar creation
should have failed or the loader should have reported a version mismatch.

On Wed, Oct 28, 2009 at 3:05 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Are you using an IDE (Eclipse)?  This may help?:
>
>  http://forums.java.net/jive/thread.jspa?messageID=363989
>
> Or maybe try building from the command line instead ("ant compile-demo")?
>
> Mike
>
> On Tue, Oct 27, 2009 at 8:34 PM, s rajan <s.rajan09@gmail.com> wrote:
> > hi, I am playing with lucene 2.9.0 source build, ant 1.7.1, jdk1.6.0, win
> XP
> > home edition.
> > I dont have clover or jFlex installed.
> > I built the srcs and ran IndexFiles demo and that worked. However when I
> run
> > SearchFiles
> > I have an exception that says:
> > Exception in thread "main" java.lang.Error: Unresolved compilation
> problems:
> >        The field directory is defined in an inherited type and an
> enclosing
> > sco
> > pe
> >        The field directory is defined in an inherited type and an
> enclosing
> > sco
> > pe
> >        The field directory is defined in an inherited type and an
> enclosing
> > sco
> > pe
> >        at
> > org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:71)
> > ----------------------------------------
> > I run the build again and its the same thing.
> > Is there anything else I need to do?
> >
> > tks,
> > -rajan
> >
>
>  ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502cc2b099fb104770bd9f6--

From java-user-return-43114-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 07:29:26 2009
Return-Path: <java-user-return-43114-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 61696 invoked from network); 29 Oct 2009 07:29:26 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 07:29:26 -0000
Received: (qmail 92774 invoked by uid 500); 29 Oct 2009 07:29:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 92678 invoked by uid 500); 29 Oct 2009 07:29:24 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 92667 invoked by uid 99); 29 Oct 2009 07:29:24 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 07:29:24 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [85.25.71.29] (HELO mail.troja.net) (85.25.71.29)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 07:29:20 +0000
Received: from localhost (localhost.localdomain [127.0.0.1])
	by mail.troja.net (Postfix) with ESMTP id A3B6945F103
	for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 08:28:59 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at mail.troja.net
Received: from mail.troja.net ([127.0.0.1])
	by localhost (megaira.troja.net [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id IKK9KEOmwts8 for <java-user@lucene.apache.org>;
	Thu, 29 Oct 2009 08:28:49 +0100 (CET)
Received: from VEGA (port-83-236-62-3.dynamic.qsc.de [83.236.62.3])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mail.troja.net (Postfix) with ESMTPSA id 2254845F083
	for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 08:28:48 +0100 (CET)
From: "Uwe Schindler" <uwe@thetaphi.de>
To: <java-user@lucene.apache.org>
References: <962c93f60910281912m1a548377w906745bb1189ad63@mail.gmail.com> <4b124c310910282057v7fa1ea85of83065176c0e4794@mail.gmail.com> <962c93f60910282107x247d4f2l39475edae12fee87@mail.gmail.com>
Subject: RE: Lucene 2.9.0 / BooleanQuery problem
Date: Thu, 29 Oct 2009 08:28:46 +0100
Message-ID: <C5CFF00DE9C842F8BEE67BE40CACDFB5@VEGA>
MIME-Version: 1.0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Mailer: Microsoft Office Outlook 11
In-Reply-To: <962c93f60910282107x247d4f2l39475edae12fee87@mail.gmail.com>
Thread-Index: AcpYTYWPOOkYHaGcTDiFeVhrIenHKAAG3baQ
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.5579

The BooleanQuery Does not work, because the Sector field is analyzed and you
are searching with a simple TermQuery which is not anylzed. So "Computing"
is not lowercased and will not hit any terms (try luke and look into your
terms you have indexed). Such field like the "sector" one should be made
NOT_ANYLZED during indexing when intended to be hit with TermQueries that
are case-sensitive.

Uwe

-----
Uwe Schindler
H.-H.-Meier-Allee 63, D-28213 Bremen
http://www.thetaphi.de
eMail: uwe@thetaphi.de

> -----Original Message-----
> From: Michel Nadeau [mailto:akaris@gmail.com]
> Sent: Thursday, October 29, 2009 5:08 AM
> To: java-user@lucene.apache.org
> Subject: Re: Lucene 2.9.0 / BooleanQuery problem
> 
> OMG, it's SO OBVIOUS!!!!! For the normal search (sector:IT AND
> group:group)
> the problem was indeed that IT is "it", stopword. Thanks, I was so not
> seeing it!
> 
> But what about the BooleanQuery? It should work fine too now...
> 
>         //
>         // Test BooleanQuery
>         //
>         BooleanQuery query2 = new BooleanQuery();
>         query2.add(new TermQuery(new Term("sector", "Computing")),
> Occur.MUST);
>         query2.add(new TermQuery(new Term("group", "group")), Occur.MUST);
> 
>         // Search!
>         System.out.println("BooleanQuery:\n");
>         doStreamingSearch(searcher, query2);
>         System.out.println("Done!");
> 
> Thanks,
> 
> - Mike
> akaris@gmail.com
> 
> 
> On Wed, Oct 28, 2009 at 11:57 PM, Jake Mannix <jake.mannix@gmail.com>
> wrote:
> 
> > Hi Michel,
> >
> >  I don't have time to look in too much detail right now, but I'll bet ya
> $5
> > it's because
> > your query is for "sector:IT" - 'IT' lowercases to 'it' which is in the
> > default stopword
> > list, and if you're not careful about how you query with this, you'll
> end
> > up
> > with TermQuery
> > instances which hit nothing, because this term may be stop-listed out of
> > your index!
> >
> >  Can you run the test again with no stop words in your query, and see
> what
> > it
> > gives?
> >
> >  -jake
> >
> > On Wed, Oct 28, 2009 at 7:12 PM, Michel Nadeau <akaris@gmail.com> wrote:
> >
> > > Hi !
> > >
> > > I spent all night trying to get a simple BooleanQuery working and I
> > really
> > > can't figure out what is my problem. See this very simple program :
> > >
> > > public class test {
> > >
> > >    @SuppressWarnings("deprecation")
> > >    public static void main(String[] args) throws ParseException,
> > > CorruptIndexException, LockObtainFailedException, IOException
> > >    {
> > >        // Open index directory
> > >        File idx = new File("d:/Java/index/");
> > >
> > >        // Create IndexWriter
> > >        IndexWriter writer = new IndexWriter(idx, new
> > > StandardAnalyzer(Version.LUCENE_CURRENT), true,
> > > IndexWriter.MaxFieldLength.LIMITED);
> > >
> > >        //
> > >        // Add some documents to the index
> > >        //
> > >
> > >        Document doc = new Document();
> > >        doc.add(new Field("firstname", "Mike", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("phone", "111-222-3333", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("sector", "IT", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("group", "group", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("content", "blue this is some content",
> > > Field.Store.YES, Field.Index.ANALYZED));
> > >        writer.addDocument(doc);
> > >
> > >        doc = new Document();
> > >        doc.add(new Field("firstname", "Pascale", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("lastname", "Lavoie", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("phone", "333-222-1111", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("sector", "Accounting", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("group", "othergroup", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("content", "red this is some content",
> > > Field.Store.YES, Field.Index.ANALYZED));
> > >        writer.addDocument(doc);
> > >
> > >        doc = new Document();
> > >        doc.add(new Field("firstname", "Kaven", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("lastname", "Rouseau", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("phone", "222-333-1111", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("sector", "IT", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("group", "group", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("content", "red this is some content",
> > > Field.Store.YES, Field.Index.ANALYZED));
> > >        writer.addDocument(doc);
> > >
> > >        doc = new Document();
> > >        doc.add(new Field("firstname", "Mike", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("lastname", "Peters", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("phone", "444-444-4444", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("sector", "IT", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("group", "othergroup", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("content", "this is some content",
> > > Field.Store.YES, Field.Index.ANALYZED));
> > >        writer.addDocument(doc);
> > >
> > >        doc = new Document();
> > >        doc.add(new Field("firstname", "Marie-Pier", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("lastname", "Nadeau", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("phone", "123-123-1234", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("sector", "Accounting", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("group", "group", Field.Store.YES,
> > > Field.Index.ANALYZED));
> > >        doc.add(new Field("content", "this is some content",
> > > Field.Store.YES, Field.Index.ANALYZED));
> > >        writer.addDocument(doc);
> > >
> > >        // Optimize + close index
> > >        writer.optimize();
> > >        writer.close();
> > >
> > >        // Open IndexReader/Searcher
> > >        IndexReader reader = IndexReader.open(idx, true);
> > >        Searcher searcher = new IndexSearcher(reader);
> > >
> > >        //
> > >        // Test normal query
> > >        //
> > >        String m_field = "content";
> > >        String m_query = "sector:IT AND group:group";
> > >        Analyzer analyzer = new
> StandardAnalyzer(Version.LUCENE_CURRENT);
> > >        QueryParser parser = new QueryParser(m_field, analyzer);
> > >        Query query = parser.parse(m_query);
> > >
> > >        // Search!
> > >        System.out.println("Normal query: " + m_query + "\n");
> > >        doStreamingSearch(searcher, query);
> > >
> > >
> >  System.out.println("===========================================\n");
> > >
> > >        //
> > >        // Test BooleanQuery
> > >        //
> > >        BooleanQuery query2 = new BooleanQuery();
> > >        query2.add(new TermQuery(new Term("sector", "IT")),
> Occur.MUST);
> > >        query2.add(new TermQuery(new Term("group", "group")),
> Occur.MUST);
> > >
> > >        // Search!
> > >        System.out.println("BooleanQuery:\n");
> > >        doStreamingSearch(searcher, query2);
> > >        System.out.println("Done!");
> > >    }
> > >
> > >    public static void doStreamingSearch(final Searcher searcher, Query
> > > query) throws IOException
> > >    {
> > >        Collector streamingHitCollector = new Collector()
> > >        {
> > >            private Scorer scorer;
> > >            private int docBase;
> > >
> > >            public void collect(int doc) throws IOException
> > >            {
> > >                Document theDoc = searcher.doc(doc);
> > >
> > >                System.out.println("+ First Name   =
> > > "+theDoc.get("firstname"));
> > >                System.out.println("+ Last Name    =
> > > "+theDoc.get("lastname"));
> > >                System.out.println("+ Phone Number =
> > "+theDoc.get("phone"));
> > >                System.out.println("+ Sector       =
> > > "+theDoc.get("sector"));
> > >                System.out.println("+ Group        =
> > "+theDoc.get("group"));
> > >                System.out.println("+ Content      =
> > > "+theDoc.get("content"));
> > >                System.out.println("");
> > >            }
> > >
> > >            public boolean acceptsDocsOutOfOrder()
> > >            {
> > >                return true;
> > >            }
> > >
> > >            public void setNextReader(IndexReader reader, int docBase)
> > > throws IOException
> > >            {
> > >                this.docBase = docBase;
> > >            }
> > >
> > >            public void setScorer(Scorer scorer) throws IOException
> > >            {
> > >                this.scorer = scorer;
> > >            }
> > >        };
> > >        searcher.search(query, streamingHitCollector);
> > >    }
> > >
> > > }
> > >
> > > And here's the output of the program :
> > >
> > > Normal query: *sector:IT AND group:group*
> > >
> > > + First Name   = Mike
> > > + Last Name    = Nadeau
> > > + Phone Number = 111-222-3333
> > > + Sector       = IT
> > > + Group        = group
> > > + Content      = blue this is some content
> > >
> > > + First Name   = Kaven
> > > + Last Name    = Rouseau
> > > + Phone Number = 222-333-1111
> > > + Sector       = IT
> > > + Group        = group
> > > + Content      = red this is some content
> > >
> > > + First Name   = Marie-Pier
> > > + Last Name    = Nadeau
> > > + Phone Number = 123-123-1234
> > > *+ Sector       = Accounting*
> > > + Group        = group
> > > + Content      = this is some content
> > >
> > > ===========================================
> > >
> > > BooleanQuery:
> > >
> > > Done!
> > >
> > > So I have 2 important problems:
> > >
> > > (1) the normal query (sector:IT AND group:group) - how can it return
> > > "Marie-Pier Nadeau", which has "Accounting" as group?
> > >
> > > (2) the BooleanQuery - why isn't it returning anything?
> > >
> > > Thanks for your help!
> > >
> > > - Mike
> > > akaris@gmail.com
> > >
> >


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43115-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 11:13:24 2009
Return-Path: <java-user-return-43115-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 10861 invoked from network); 29 Oct 2009 11:13:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 11:13:24 -0000
Received: (qmail 73616 invoked by uid 500); 29 Oct 2009 11:13:21 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73581 invoked by uid 500); 29 Oct 2009 11:13:21 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73571 invoked by uid 99); 29 Oct 2009 11:13:21 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 11:13:21 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_HELO_PASS,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 11:13:12 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N3Svz-0005ze-Fc
	for java-user@lucene.apache.org; Thu, 29 Oct 2009 04:12:51 -0700
Message-ID: <26111084.post@talk.nabble.com>
Date: Thu, 29 Oct 2009 04:12:51 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: search problem
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
X-Virus-Checked: Checked by ClamAV on apache.org


hello all

     i've a doubt in search , i've a word in my index welcomelucene (without
spaces) , when i search for welcome lucene(with a space) , am not able to
get the hits. It should pick the document welcomelucene.. is there anyway to
do it ? i've used wildcard option too. but no results , please anyone help
me..
-- 
View this message in context: http://www.nabble.com/search-problem-tp26111084p26111084.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43116-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 14:29:38 2009
Return-Path: <java-user-return-43116-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90317 invoked from network); 29 Oct 2009 14:29:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 14:29:38 -0000
Received: (qmail 31334 invoked by uid 500); 29 Oct 2009 14:29:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 31281 invoked by uid 500); 29 Oct 2009 14:29:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 31271 invoked by uid 99); 29 Oct 2009 14:29:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 14:29:36 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 14:29:33 +0000
Received: by iwn6 with SMTP id 6so1317443iwn.20
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 07:29:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=+gB1Q/VIOY1U4TSR6mUDYG8+/LWIWEhWk+T7ewd3wwQ=;
        b=aOMBm3OwXMqOebtgYewcxa4cBTlJgY8Rjfkx1AT2Is1RCqmft7qwpsqfKqpK3a/s5T
         Gu+cQlmCbh5UbP95wG/aSYZenq1xoS20cewSL8NNwpexTU+lGl45vKx2EKtqlTOuksWy
         VA661Gw+10j/yHIuuVry9M+pOglTtDb3erCDk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=EOQ9AP/qtKqICI9pUs4fGj8exSv6XaiqHX9G0gXDVhevOgNzigyKrp8JuekpZ6EjsN
         V9g1R4WCe5FnLaHByI476VvF8BRRs1NSSrojtql8hDqP9dRx/7qCRZaxIZd2wBMmJiRB
         /Urt1Ni+2FkmNMWYZmLtvvvfwKyqsF5K3kV1s=
MIME-Version: 1.0
Received: by 10.231.42.150 with SMTP id s22mr319073ibe.22.1256826553100; Thu, 
	29 Oct 2009 07:29:13 -0700 (PDT)
In-Reply-To: <26111084.post@talk.nabble.com>
References: <26111084.post@talk.nabble.com>
Date: Thu, 29 Oct 2009 10:28:43 -0400
Message-ID: <359a92830910290728g17c25ad1oe8afc128e7836de@mail.gmail.com>
Subject: Re: search problem
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001517741a143dea79047713bc86

--001517741a143dea79047713bc86
Content-Type: text/plain; charset=ISO-8859-1

Why would you expect to get a hit on your document? There are
three distinct tokens here:
welcomlucene
welcome
lucene

Lucene searches for *matching* tokens, so searching
for the tokens 'welcome' and 'lucene' essentially asks
"are there two tokens in the document that exactly match
these?" and the answer is "no", so no hits (assuming
AND here, the OR argument is similar).


As for the wlidcard question, we'd need to see the code
to be able to help there....

You might go up on the Wiki and review tokenization to
understand this issue better.

Best
Erick



On Thu, Oct 29, 2009 at 7:12 AM, m.harig <m.harig@gmail.com> wrote:

>
> hello all
>
>     i've a doubt in search , i've a word in my index welcomelucene (without
> spaces) , when i search for welcome lucene(with a space) , am not able to
> get the hits. It should pick the document welcomelucene.. is there anyway
> to
> do it ? i've used wildcard option too. but no results , please anyone help
> me..
> --
> View this message in context:
> http://www.nabble.com/search-problem-tp26111084p26111084.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--001517741a143dea79047713bc86--

From java-user-return-43117-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 14:30:02 2009
Return-Path: <java-user-return-43117-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 90439 invoked from network); 29 Oct 2009 14:30:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 14:30:02 -0000
Received: (qmail 33765 invoked by uid 500); 29 Oct 2009 14:30:00 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 33735 invoked by uid 500); 29 Oct 2009 14:30:00 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 33717 invoked by uid 99); 29 Oct 2009 14:29:57 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 14:29:57 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of erickerickson@gmail.com designates 209.85.223.176 as permitted sender)
Received: from [209.85.223.176] (HELO mail-iw0-f176.google.com) (209.85.223.176)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 14:29:47 +0000
Received: by iwn6 with SMTP id 6so1317577iwn.20
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 07:29:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=n+ToU9Q1cP+V9sRfTbBdncmXPp7WFDl1EBGVhUvUEAA=;
        b=cunoJfKRQz99aeBVEZ30+pA9rwHtfeyrXOr0+k02Shw14AgmOH8Njagrm8osVkrLC/
         SyMq66tbQtuqGgxi6aF3fI5hncbm1yPGbXlXIGRG9CQqYwfFB1C4OFJK78yADaCI1uTL
         Euo31NHyZJLv9uu9U0+864Fkjkx5jFN0vbV58=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=Agvq6/8KBAXPKtJDiO/NtaA/1T6tE9ffOb4bk3rzZLlfzoHuWEKA5hAZyAF4+2FM+p
         WblGjljjInzZp0prDt6/4fXi0UOEnSESfEIOazAfbngKAVJ7NSXN2VE8ay8bksIaeYuv
         nO93bcWHAxC+8JP1Fm/MFuuwDDFBseBw3ycQI=
MIME-Version: 1.0
Received: by 10.231.123.216 with SMTP id q24mr234836ibr.43.1256826523306; Thu, 
	29 Oct 2009 07:28:43 -0700 (PDT)
In-Reply-To: <26111084.post@talk.nabble.com>
References: <26111084.post@talk.nabble.com>
Date: Thu, 29 Oct 2009 10:28:43 -0400
Message-ID: <359a92830910290728g17c25ad1oe8afc128e7836de@mail.gmail.com>
Subject: Re: search problem
From: Erick Erickson <erickerickson@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64698e47a6ef8047713ba3a
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64698e47a6ef8047713ba3a
Content-Type: text/plain; charset=ISO-8859-1

Why would you expect to get a hit on your document? There are
three distinct tokens here:
welcomlucene
welcome
lucene

Lucene searches for *matching* tokens, so searching
for the tokens 'welcome' and 'lucene' essentially asks
"are there two tokens in the document that exactly match
these?" and the answer is "no", so no hits (assuming
AND here, the OR argument is similar).


As for the wlidcard question, we'd need to see the code
to be able to help there....

You might go up on the Wiki and review tokenization to
understand this issue better.

Best
Erick



On Thu, Oct 29, 2009 at 7:12 AM, m.harig <m.harig@gmail.com> wrote:

>
> hello all
>
>     i've a doubt in search , i've a word in my index welcomelucene (without
> spaces) , when i search for welcome lucene(with a space) , am not able to
> get the hits. It should pick the document welcomelucene.. is there anyway
> to
> do it ? i've used wildcard option too. but no results , please anyone help
> me..
> --
> View this message in context:
> http://www.nabble.com/search-problem-tp26111084p26111084.html
> Sent from the Lucene - Java Users mailing list archive at Nabble.com.
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--0016e64698e47a6ef8047713ba3a--

From java-user-return-43118-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 19:47:13 2009
Return-Path: <java-user-return-43118-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91905 invoked from network); 29 Oct 2009 19:47:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 19:47:13 -0000
Received: (qmail 82368 invoked by uid 500); 29 Oct 2009 19:47:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 82279 invoked by uid 500); 29 Oct 2009 19:47:10 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 82269 invoked by uid 99); 29 Oct 2009 19:47:10 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 19:47:10 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 19:47:07 +0000
Received: by pwi12 with SMTP id 12so267329pwi.5
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 12:46:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type;
        bh=IUXBZW8rHB6VcyF03OqhF2jFcaKz92QZ159FfhOULZI=;
        b=Dk9eLJ9QjclwycwjzBWNl7J0Gze9O6Ob+4zFW42U9olP2Wp9HGrt3JHED5N+BwMe4I
         FsRqEzZS8ZS1cHzPFDvQyj3xHMUbtvGU1husfC2kOARRkcWmFhJmv7MEai+XonKtJCDi
         dvdubR0a6hZFVIk/QmZabq79Pxnr8RY/SjDM8=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=oBgi0lXlKTXF3z9HTCz/zdaX9KGXz+BtqNsT3R61S7AJMiySYeM91CYvdDkWE05FxT
         r42V1+qenhjbOwXrm0WIV7Ibijia6JzUcf/SQCNDVdHKiWSpAe0gW37WMZ9FM41LL5BW
         BwgOWLzeekOfbZyld4WK6FOJ98Bj90paVo4FQ=
MIME-Version: 1.0
Received: by 10.142.1.24 with SMTP id 24mr52371wfa.8.1256845606858; Thu, 29 
	Oct 2009 12:46:46 -0700 (PDT)
In-Reply-To: <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910271208v5ae76583rc2cf177ba18ccd09@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
Date: Thu, 29 Oct 2009 15:46:46 -0400
Message-ID: <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: Michael McCandless <lucene@mikemccandless.com>
Cc: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636b2be57ef31740477182b89

--001636b2be57ef31740477182b89
Content-Type: text/plain; charset=ISO-8859-1

A handful of the source documents did contain the U+FFFF character. The
patch from *LUCENE-2016 <https://issues.apache.org/jira/browse/LUCENE-2016>
*fixed the problem.
Thanks Mike!

Peter

On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
lucene@mikemccandless.com> wrote:

> Hmm, only a few affected terms, and all this particular
> "literals:cfid196$" term, with optional suffixes.  Really strange.
>
> One things that's odd is the exact term "literals:cfid196$" is printed
> twice, which should never happen (every unique term should be stored
> only once, in the terms dict).
>
> And, otherwise, CheckIndex got through the index just fine.
>
> Try searching a TermQuery with these affected terms and see if it
> succeeds?  If so, maybe trying making an index with one or two of
> them, alone, and see if that index shows the problem?
>
> OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
> produce an enormous amount of output, but if you can excise the few
> lines around when that warning comes out & post back that'd be great.
>
> Mike
>
> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com>
> wrote:
> > Just to be safe, I ran with the official jar file from one of the mirrors
> > and reproduced the problem.
> > The debug session is not showing any characters = '\uffff' (checking this
> in
> > Tokenizer).
> > The output from the modified CheckIndex follows. There are only a few
> terms
> > with the inconsistency. They are all legitimate terms from the app's
> > context. With this info, I might be able to isolate the source documents.
> > What should I be looking for when they are indexed?
> >
> > CheckInput output:
> >
> > Opening index @ D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
> >
> > Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS [Lucene
> > 2.9]
> >  1 of 3: name=_0 docCount=413585
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=1,148.817
> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
> > 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=0
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs
> pairs;
> > 340244234 tokens]
> >    test: stored fields.......OK [1240755 total field count; avg 3 fields
> > per doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> >
> >  2 of 3: name=_1 docCount=359068
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=1,125.161
> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
> > 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=413585
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...WARNING: term  literals:cfid196$ docFreq=43
> !=
> > num docs seen 4 + num docs deleted 0
> > WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
> > deleted 0
> > WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
> > deleted 0
> > WARNING: term  literals:cfid196$commandant docFreq=1 != num docs seen 9 +
> > num docs deleted 0
> > WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 + num
> > docs deleted 0
> > OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
> >    test: stored fields.......OK [1077204 total field count; avg 3 fields
> > per doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> >
> >  3 of 3: name=_2 docCount=304849
> >    compound=false
> >    hasProx=true
> >    numFiles=8
> >    size (MB)=962.004
> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
> > 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >    docStoreOffset=772653
> >    docStoreSegment=_0
> >    docStoreIsCompoundFile=false
> >    no deletions
> >    test: open reader.........OK
> >    test: fields..............OK [33 fields]
> >    test: field norms.........OK [33 fields]
> >    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 != num
> > docs seen 246 + num docs deleted 0
> > WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num docs
> > deleted 0
> > WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
> > deleted 0
> > WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen 37 +
> num
> > docs deleted 0
> > WARNING: term  literals:cfid196$interrogation docFreq=181 != num docs
> seen 1
> > + num docs deleted 0
> > WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen 353 +
> num
> > docs deleted 0
> > WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs seen 1
> +
> > num docs deleted 0
> > WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 + num
> docs
> > deleted 0
> > OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
> >    test: stored fields.......OK [914547 total field count; avg 3 fields
> per
> > doc]
> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
> > vector fields per doc]
> >
> > No problems were detected with this index.
> >
> > Peter
> >
> >
> > On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
> > lucene@mikemccandless.com> wrote:
> >
> >> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com>
> >> wrote:
> >> > The only change I made to the source code was the patch for
> >> PayloadNearQuery
> >> > (LUCENE-1986).
> >>
> >> That patch certainly shouldn't lead to this.
> >>
> >> > It's possible that our content contains U+FFFF. I will run in debugger
> >> and
> >> > see.
> >>
> >> OK may as well check just so we cover all possibilities.
> >>
> >> > The data is 'sensitive', so I may not be able to provide a bad
> segment,
> >> > unfortunately.
> >>
> >> OK, maybe we can modify your CheckIndex instead.  Let's start with
> >> this, which prints a warning whenever the docFreq differs but
> >> otherwise continues (vs throwing RuntimeException).  I'm curious how
> >> many terms show this, and whether the TermEnum keeps working after
> >> this term that has different docFreq:
> >>
> >> Index: src/java/org/apache/lucene/index/CheckIndex.java
> >> ===================================================================
> >> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
> 829889)
> >> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working copy)
> >> @@ -672,8 +672,8 @@
> >>         }
> >>
> >>         if (freq0 + delCount != docFreq) {
> >> -          throw new RuntimeException("term " + term + " docFreq=" +
> >> -                                     docFreq + " != num docs seen " +
> >> freq0 + " + num docs deleted " + delCount);
> >> +          System.out.println("WARNING: term  " + term + " docFreq=" +
> >> +                             docFreq + " != num docs seen " + freq0 +
> >> " + num docs deleted " + delCount);
> >>         }
> >>       }
> >>
> >> Mike
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >
>

--001636b2be57ef31740477182b89--

From java-user-return-43119-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 19:55:51 2009
Return-Path: <java-user-return-43119-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 94061 invoked from network); 29 Oct 2009 19:55:51 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 19:55:51 -0000
Received: (qmail 93551 invoked by uid 500); 29 Oct 2009 19:55:48 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 93481 invoked by uid 500); 29 Oct 2009 19:55:48 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 93471 invoked by uid 99); 29 Oct 2009 19:55:48 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 19:55:48 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 19:55:45 +0000
Received: by pwi12 with SMTP id 12so271858pwi.5
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 12:55:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=6YSwYxh34eJ3GX5Cck91njPjLkwAkv2/6lAM4qpFrDs=;
        b=cbk7Bj4t041WW1buIRfF2mASVRCPIE+f4SFTg7eMTCsO3f4rSWi1iyz/xZrxhdHZn0
         Gw3nY9saBwZ/eCfqLj8WGhsq8IAaBz4BmdnaYxhnUWeCnayKRNM1FUnuPhrbyVEkjFtL
         49M43YgtloXIXKtrDU3u3WaUXLdikTi1WoDUw=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=EQ8jCubc1aO/zh8lk4vUM7l7A9+cVBvoPtfN31ZWQz0i6wXvpc71gvymGg8QrTnBno
         foMxemNAw6diEM2wkrBZGmX1iIfPOJ0yQ/RKVZmwfGmw5dH7L8MCee7SxnZ7H2HbmYnW
         MVM3yAR2i0HWq/fCW/GAK0OEpwwR6mSYjE9oQ=
MIME-Version: 1.0
Received: by 10.142.5.21 with SMTP id 21mr48154wfe.63.1256846125047; Thu, 29 
	Oct 2009 12:55:25 -0700 (PDT)
In-Reply-To: <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
	 <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>
Date: Thu, 29 Oct 2009 15:55:24 -0400
Message-ID: <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016368e21c0d222270477184a85

--0016368e21c0d222270477184a85
Content-Type: text/plain; charset=ISO-8859-1

Btw, this 2.9 indexer is fast! I indexed 4Gb (1.07 million docs) with
optimization in just under 30 min.
I used setRAMBufferSizeMB=1.9G

Peter

On Thu, Oct 29, 2009 at 3:46 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:

> A handful of the source documents did contain the U+FFFF character. The
> patch from *LUCENE-2016<https://issues.apache.org/jira/browse/LUCENE-2016>
> *fixed the problem.
> Thanks Mike!
>
> Peter
>
>
> On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
> lucene@mikemccandless.com> wrote:
>
>> Hmm, only a few affected terms, and all this particular
>> "literals:cfid196$" term, with optional suffixes.  Really strange.
>>
>> One things that's odd is the exact term "literals:cfid196$" is printed
>> twice, which should never happen (every unique term should be stored
>> only once, in the terms dict).
>>
>> And, otherwise, CheckIndex got through the index just fine.
>>
>> Try searching a TermQuery with these affected terms and see if it
>> succeeds?  If so, maybe trying making an index with one or two of
>> them, alone, and see if that index shows the problem?
>>
>> OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
>> produce an enormous amount of output, but if you can excise the few
>> lines around when that warning comes out & post back that'd be great.
>>
>> Mike
>>
>> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com>
>> wrote:
>> > Just to be safe, I ran with the official jar file from one of the
>> mirrors
>> > and reproduced the problem.
>> > The debug session is not showing any characters = '\uffff' (checking
>> this in
>> > Tokenizer).
>> > The output from the modified CheckIndex follows. There are only a few
>> terms
>> > with the inconsistency. They are all legitimate terms from the app's
>> > context. With this info, I might be able to isolate the source
>> documents.
>> > What should I be looking for when they are indexed?
>> >
>> > CheckInput output:
>> >
>> > Opening index @
>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
>> >
>> > Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS
>> [Lucene
>> > 2.9]
>> >  1 of 3: name=_0 docCount=413585
>> >    compound=false
>> >    hasProx=true
>> >    numFiles=8
>> >    size (MB)=1,148.817
>> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
>> > 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>> >    docStoreOffset=0
>> >    docStoreSegment=_0
>> >    docStoreIsCompoundFile=false
>> >    no deletions
>> >    test: open reader.........OK
>> >    test: fields..............OK [33 fields]
>> >    test: field norms.........OK [33 fields]
>> >    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs
>> pairs;
>> > 340244234 tokens]
>> >    test: stored fields.......OK [1240755 total field count; avg 3 fields
>> > per doc]
>> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
>> > vector fields per doc]
>> >
>> >  2 of 3: name=_1 docCount=359068
>> >    compound=false
>> >    hasProx=true
>> >    numFiles=8
>> >    size (MB)=1,125.161
>> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
>> > 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>> >    docStoreOffset=413585
>> >    docStoreSegment=_0
>> >    docStoreIsCompoundFile=false
>> >    no deletions
>> >    test: open reader.........OK
>> >    test: fields..............OK [33 fields]
>> >    test: field norms.........OK [33 fields]
>> >    test: terms, freq, prox...WARNING: term  literals:cfid196$ docFreq=43
>> !=
>> > num docs seen 4 + num docs deleted 0
>> > WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
>> > deleted 0
>> > WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
>> > deleted 0
>> > WARNING: term  literals:cfid196$commandant docFreq=1 != num docs seen 9
>> +
>> > num docs deleted 0
>> > WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 + num
>> > docs deleted 0
>> > OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
>> >    test: stored fields.......OK [1077204 total field count; avg 3 fields
>> > per doc]
>> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
>> > vector fields per doc]
>> >
>> >  3 of 3: name=_2 docCount=304849
>> >    compound=false
>> >    hasProx=true
>> >    numFiles=8
>> >    size (MB)=962.004
>> >    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
>> > 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>> > java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>> >    docStoreOffset=772653
>> >    docStoreSegment=_0
>> >    docStoreIsCompoundFile=false
>> >    no deletions
>> >    test: open reader.........OK
>> >    test: fields..............OK [33 fields]
>> >    test: field norms.........OK [33 fields]
>> >    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 != num
>> > docs seen 246 + num docs deleted 0
>> > WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num
>> docs
>> > deleted 0
>> > WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
>> > deleted 0
>> > WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen 37 +
>> num
>> > docs deleted 0
>> > WARNING: term  literals:cfid196$interrogation docFreq=181 != num docs
>> seen 1
>> > + num docs deleted 0
>> > WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen 353 +
>> num
>> > docs deleted 0
>> > WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs seen
>> 1 +
>> > num docs deleted 0
>> > WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 + num
>> docs
>> > deleted 0
>> > OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
>> >    test: stored fields.......OK [914547 total field count; avg 3 fields
>> per
>> > doc]
>> >    test: term vectors........OK [0 total vector count; avg 0 term/freq
>> > vector fields per doc]
>> >
>> > No problems were detected with this index.
>> >
>> > Peter
>> >
>> >
>> > On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
>> > lucene@mikemccandless.com> wrote:
>> >
>> >> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com
>> >
>> >> wrote:
>> >> > The only change I made to the source code was the patch for
>> >> PayloadNearQuery
>> >> > (LUCENE-1986).
>> >>
>> >> That patch certainly shouldn't lead to this.
>> >>
>> >> > It's possible that our content contains U+FFFF. I will run in
>> debugger
>> >> and
>> >> > see.
>> >>
>> >> OK may as well check just so we cover all possibilities.
>> >>
>> >> > The data is 'sensitive', so I may not be able to provide a bad
>> segment,
>> >> > unfortunately.
>> >>
>> >> OK, maybe we can modify your CheckIndex instead.  Let's start with
>> >> this, which prints a warning whenever the docFreq differs but
>> >> otherwise continues (vs throwing RuntimeException).  I'm curious how
>> >> many terms show this, and whether the TermEnum keeps working after
>> >> this term that has different docFreq:
>> >>
>> >> Index: src/java/org/apache/lucene/index/CheckIndex.java
>> >> ===================================================================
>> >> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
>> 829889)
>> >> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working copy)
>> >> @@ -672,8 +672,8 @@
>> >>         }
>> >>
>> >>         if (freq0 + delCount != docFreq) {
>> >> -          throw new RuntimeException("term " + term + " docFreq=" +
>> >> -                                     docFreq + " != num docs seen " +
>> >> freq0 + " + num docs deleted " + delCount);
>> >> +          System.out.println("WARNING: term  " + term + " docFreq=" +
>> >> +                             docFreq + " != num docs seen " + freq0 +
>> >> " + num docs deleted " + delCount);
>> >>         }
>> >>       }
>> >>
>> >> Mike
>> >>
>> >> ---------------------------------------------------------------------
>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>> >>
>> >>
>> >
>>
>
>

--0016368e21c0d222270477184a85--

From java-user-return-43120-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 20:24:24 2009
Return-Path: <java-user-return-43120-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3857 invoked from network); 29 Oct 2009 20:24:24 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 20:24:24 -0000
Received: (qmail 28671 invoked by uid 500); 29 Oct 2009 20:24:22 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 28610 invoked by uid 500); 29 Oct 2009 20:24:22 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 28600 invoked by uid 99); 29 Oct 2009 20:24:21 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 20:24:21 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [209.85.211.183] (HELO mail-yw0-f183.google.com) (209.85.211.183)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 20:24:19 +0000
Received: by ywh13 with SMTP id 13so2328855ywh.29
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 13:23:58 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.151.94.1 with SMTP id w1mr1159003ybl.214.1256847836074; Thu, 
	29 Oct 2009 13:23:56 -0700 (PDT)
In-Reply-To: <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
	 <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>
	 <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
Date: Thu, 29 Oct 2009 16:23:55 -0400
Message-ID: <9ac0c6aa0910291323m6c1026d2nc214944da150882e@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Michael McCandless <lucene@mikemccandless.com>
To: java-user@lucene.apache.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I'm glad we finally got to the bottom of this :)  This fix will be in 2.9.1=
.

This is a nice fast indexing result, too...

Mike

On Thu, Oct 29, 2009 at 3:55 PM, Peter Keegan <peterlkeegan@gmail.com> wrot=
e:
> Btw, this 2.9 indexer is fast! I indexed 4Gb (1.07 million docs) with
> optimization in just under 30 min.
> I used setRAMBufferSizeMB=3D1.9G
>
> Peter
>
> On Thu, Oct 29, 2009 at 3:46 PM, Peter Keegan <peterlkeegan@gmail.com>wro=
te:
>
>> A handful of the source documents did contain the U+FFFF character. The
>> patch from *LUCENE-2016<https://issues.apache.org/jira/browse/LUCENE-201=
6>
>> *fixed the problem.
>> Thanks Mike!
>>
>> Peter
>>
>>
>> On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>> Hmm, only a few affected terms, and all this particular
>>> "literals:cfid196$" term, with optional suffixes. =A0Really strange.
>>>
>>> One things that's odd is the exact term "literals:cfid196$" is printed
>>> twice, which should never happen (every unique term should be stored
>>> only once, in the terms dict).
>>>
>>> And, otherwise, CheckIndex got through the index just fine.
>>>
>>> Try searching a TermQuery with these affected terms and see if it
>>> succeeds? =A0If so, maybe trying making an index with one or two of
>>> them, alone, and see if that index shows the problem?
>>>
>>> OK I'm attaching more mods. =A0Can you re-run your CheckIndex? =A0It wi=
ll
>>> produce an enormous amount of output, but if you can excise the few
>>> lines around when that warning comes out & post back that'd be great.
>>>
>>> Mike
>>>
>>> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>> > Just to be safe, I ran with the official jar file from one of the
>>> mirrors
>>> > and reproduced the problem.
>>> > The debug session is not showing any characters =3D '\uffff' (checkin=
g
>>> this in
>>> > Tokenizer).
>>> > The output from the modified CheckIndex follows. There are only a few
>>> terms
>>> > with the inconsistency. They are all legitimate terms from the app's
>>> > context. With this info, I might be able to isolate the source
>>> documents.
>>> > What should I be looking for when they are indexed?
>>> >
>>> > CheckInput output:
>>> >
>>> > Opening index @
>>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
>>> >
>>> > Segments file=3Dsegments_2 numSegments=3D3 version=3DFORMAT_DIAGNOSTI=
CS
>>> [Lucene
>>> > 2.9]
>>> > =A01 of 3: name=3D_0 docCount=3D413585
>>> > =A0 =A0compound=3Dfalse
>>> > =A0 =A0hasProx=3Dtrue
>>> > =A0 =A0numFiles=3D8
>>> > =A0 =A0size (MB)=3D1,148.817
>>> > =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.v=
ersion=3D2.9.0
>>> > 817268P - 2009-09-21 10:25:09, source=3Dflush, os.arch=3Damd64,
>>> > java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
>>> > =A0 =A0docStoreOffset=3D0
>>> > =A0 =A0docStoreSegment=3D_0
>>> > =A0 =A0docStoreIsCompoundFile=3Dfalse
>>> > =A0 =A0no deletions
>>> > =A0 =A0test: open reader.........OK
>>> > =A0 =A0test: fields..............OK [33 fields]
>>> > =A0 =A0test: field norms.........OK [33 fields]
>>> > =A0 =A0test: terms, freq, prox...OK [7704753 terms; 180326717 terms/d=
ocs
>>> pairs;
>>> > 340244234 tokens]
>>> > =A0 =A0test: stored fields.......OK [1240755 total field count; avg 3=
 fields
>>> > per doc]
>>> > =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term=
/freq
>>> > vector fields per doc]
>>> >
>>> > =A02 of 3: name=3D_1 docCount=3D359068
>>> > =A0 =A0compound=3Dfalse
>>> > =A0 =A0hasProx=3Dtrue
>>> > =A0 =A0numFiles=3D8
>>> > =A0 =A0size (MB)=3D1,125.161
>>> > =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.v=
ersion=3D2.9.0
>>> > 817268P - 2009-09-21 10:25:09, source=3Dflush, os.arch=3Damd64,
>>> > java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
>>> > =A0 =A0docStoreOffset=3D413585
>>> > =A0 =A0docStoreSegment=3D_0
>>> > =A0 =A0docStoreIsCompoundFile=3Dfalse
>>> > =A0 =A0no deletions
>>> > =A0 =A0test: open reader.........OK
>>> > =A0 =A0test: fields..............OK [33 fields]
>>> > =A0 =A0test: field norms.........OK [33 fields]
>>> > =A0 =A0test: terms, freq, prox...WARNING: term =A0literals:cfid196$ d=
ocFreq=3D43
>>> !=3D
>>> > num docs seen 4 + num docs deleted 0
>>> > WARNING: term =A0literals:cfid196$ docFreq=3D1 !=3D num docs seen 4 +=
 num docs
>>> > deleted 0
>>> > WARNING: term =A0literals:cfid196$ docFreq=3D1 !=3D num docs seen 4 +=
 num docs
>>> > deleted 0
>>> > WARNING: term =A0literals:cfid196$commandant docFreq=3D1 !=3D num doc=
s seen 9
>>> +
>>> > num docs deleted 0
>>> > WARNING: term =A0literals:cfid196$on docFreq=3D3178 !=3D num docs see=
n 1 + num
>>> > docs deleted 0
>>> > OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
>>> > =A0 =A0test: stored fields.......OK [1077204 total field count; avg 3=
 fields
>>> > per doc]
>>> > =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term=
/freq
>>> > vector fields per doc]
>>> >
>>> > =A03 of 3: name=3D_2 docCount=3D304849
>>> > =A0 =A0compound=3Dfalse
>>> > =A0 =A0hasProx=3Dtrue
>>> > =A0 =A0numFiles=3D8
>>> > =A0 =A0size (MB)=3D962.004
>>> > =A0 =A0diagnostics =3D {os.version=3D5.2, os=3DWindows 2003, lucene.v=
ersion=3D2.9.0
>>> > 817268P - 2009-09-21 10:25:09, source=3Dflush, os.arch=3Damd64,
>>> > java.version=3D1.6.0_16, java.vendor=3DSun Microsystems Inc.}
>>> > =A0 =A0docStoreOffset=3D772653
>>> > =A0 =A0docStoreSegment=3D_0
>>> > =A0 =A0docStoreIsCompoundFile=3Dfalse
>>> > =A0 =A0no deletions
>>> > =A0 =A0test: open reader.........OK
>>> > =A0 =A0test: fields..............OK [33 fields]
>>> > =A0 =A0test: field norms.........OK [33 fields]
>>> > =A0 =A0test: terms, freq, prox...WARNING: term =A0contents:? docFreq=
=3D1 !=3D num
>>> > docs seen 246 + num docs deleted 0
>>> > WARNING: term =A0literals:cfid196$ docFreq=3D45 !=3D num docs seen 4 =
+ num
>>> docs
>>> > deleted 0
>>> > WARNING: term =A0literals:cfid196$ docFreq=3D1 !=3D num docs seen 4 +=
 num docs
>>> > deleted 0
>>> > WARNING: term =A0literals:cfid196$cashier docFreq=3D1 !=3D num docs s=
een 37 +
>>> num
>>> > docs deleted 0
>>> > WARNING: term =A0literals:cfid196$interrogation docFreq=3D181 !=3D nu=
m docs
>>> seen 1
>>> > + num docs deleted 0
>>> > WARNING: term =A0literals:cfid196$leader docFreq=3D1 !=3D num docs se=
en 353 +
>>> num
>>> > docs deleted 0
>>> > WARNING: term =A0literals:cfid196$microsoft docFreq=3D3114 !=3D num d=
ocs seen
>>> 1 +
>>> > num docs deleted 0
>>> > WARNING: term =A0literals:cfid196$nt docFreq=3D200 !=3D num docs seen=
 1 + num
>>> docs
>>> > deleted 0
>>> > OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
>>> > =A0 =A0test: stored fields.......OK [914547 total field count; avg 3 =
fields
>>> per
>>> > doc]
>>> > =A0 =A0test: term vectors........OK [0 total vector count; avg 0 term=
/freq
>>> > vector fields per doc]
>>> >
>>> > No problems were detected with this index.
>>> >
>>> > Peter
>>> >
>>> >
>>> > On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
>>> > lucene@mikemccandless.com> wrote:
>>> >
>>> >> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.c=
om
>>> >
>>> >> wrote:
>>> >> > The only change I made to the source code was the patch for
>>> >> PayloadNearQuery
>>> >> > (LUCENE-1986).
>>> >>
>>> >> That patch certainly shouldn't lead to this.
>>> >>
>>> >> > It's possible that our content contains U+FFFF. I will run in
>>> debugger
>>> >> and
>>> >> > see.
>>> >>
>>> >> OK may as well check just so we cover all possibilities.
>>> >>
>>> >> > The data is 'sensitive', so I may not be able to provide a bad
>>> segment,
>>> >> > unfortunately.
>>> >>
>>> >> OK, maybe we can modify your CheckIndex instead. =A0Let's start with
>>> >> this, which prints a warning whenever the docFreq differs but
>>> >> otherwise continues (vs throwing RuntimeException). =A0I'm curious h=
ow
>>> >> many terms show this, and whether the TermEnum keeps working after
>>> >> this term that has different docFreq:
>>> >>
>>> >> Index: src/java/org/apache/lucene/index/CheckIndex.java
>>> >> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>> >> --- src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(revisio=
n
>>> 829889)
>>> >> +++ src/java/org/apache/lucene/index/CheckIndex.java =A0 =A0(working=
 copy)
>>> >> @@ -672,8 +672,8 @@
>>> >> =A0 =A0 =A0 =A0 }
>>> >>
>>> >> =A0 =A0 =A0 =A0 if (freq0 + delCount !=3D docFreq) {
>>> >> - =A0 =A0 =A0 =A0 =A0throw new RuntimeException("term " + term + " d=
ocFreq=3D" +
>>> >> - =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 docFreq + " !=3D num docs seen " +
>>> >> freq0 + " + num docs deleted " + delCount);
>>> >> + =A0 =A0 =A0 =A0 =A0System.out.println("WARNING: term =A0" + term +=
 " docFreq=3D" +
>>> >> + =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 docFreq + =
" !=3D num docs seen " + freq0 +
>>> >> " + num docs deleted " + delCount);
>>> >> =A0 =A0 =A0 =A0 }
>>> >> =A0 =A0 =A0 }
>>> >>
>>> >> Mike
>>> >>
>>> >> --------------------------------------------------------------------=
-
>>> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>> >> For additional commands, e-mail: java-user-help@lucene.apache.org
>>> >>
>>> >>
>>> >
>>>
>>
>>
>

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43121-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 20:31:02 2009
Return-Path: <java-user-return-43121-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 7128 invoked from network); 29 Oct 2009 20:31:02 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 20:31:02 -0000
Received: (qmail 38872 invoked by uid 500); 29 Oct 2009 20:30:59 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 38800 invoked by uid 500); 29 Oct 2009 20:30:59 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 38790 invoked by uid 99); 29 Oct 2009 20:30:59 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 20:30:59 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of markrmiller@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 20:30:48 +0000
Received: by bwz22 with SMTP id 22so2912788bwz.5
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 13:30:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=priiiKK4nXJLAIkn0ybw5y7nWSjK6C5mwgAUhJRvGus=;
        b=O4HKQO278p/9WzSeo1UAcTzSgq25hZ1y4LbIrNPihwCM1azNJ31rAmGlKc9VpdIpvV
         bPXxVzqKKKItRaDxZNTJtRHQnZVfzmHF81DXMBv79GVxkxvzf05pZJwRmCOt2rlkTrkP
         oa3jj7Iy3VFEUlezWGA65jyARHRfH0kgK2umQ=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=kB2YdBSxpB14T4J1XgdRScY0jiW/ZvfgI0tCw+MX1zHTo15zPU1kroAsHjzIvjLPII
         vppxGK7VCFg+6tB/m9E0qFmTcL0Q3JttHPFnA62ea9V5BAK9/NhXPZ2/mExYMsu/MSzC
         5XUlKII7axTnF/qUN2+tBGCB3S/ozgJ6hPDb4=
Received: by 10.204.34.83 with SMTP id k19mr395465bkd.96.1256848227909;
        Thu, 29 Oct 2009 13:30:27 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 14sm55741bwz.13.2009.10.29.13.30.25
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 29 Oct 2009 13:30:26 -0700 (PDT)
Message-ID: <4AE9FB61.6030009@gmail.com>
Date: Thu, 29 Oct 2009 16:30:25 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: IO exception during merge/optimize
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>	 <e994873a0910271310w33c215c7r1dad43c7b638a844@mail.gmail.com>	 <9ac0c6aa0910280223k6b9f371eqd439abad612eaaac@mail.gmail.com>	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>	 <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com> <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
In-Reply-To: <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Any chance I could get you to try that again with a buffer of like 800MB
to a gig and do a comparison?

I've been investigating the returns you get with a larger buffer size.
It appears to be pretty diminishing returns over 100MB or so - at higher
than that, I've gotten both slower speeds for some sizes, and larger
gains for others. But only better by 5-10 docs a second up to a gig. But
I can't reliably test at over a gig - I have only 4 GB of RAM, and even
with that, at over a gig it starts to page and the performance gets hit.
I'd love to see what kind of benefit you see going from around a gig to
just under 2.

Peter Keegan wrote:
> Btw, this 2.9 indexer is fast! I indexed 4Gb (1.07 million docs) with
> optimization in just under 30 min.
> I used setRAMBufferSizeMB=1.9G
>
> Peter
>
> On Thu, Oct 29, 2009 at 3:46 PM, Peter Keegan <peterlkeegan@gmail.com>wrote:
>
>   
>> A handful of the source documents did contain the U+FFFF character. The
>> patch from *LUCENE-2016<https://issues.apache.org/jira/browse/LUCENE-2016>
>> *fixed the problem.
>> Thanks Mike!
>>
>> Peter
>>
>>
>> On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
>> lucene@mikemccandless.com> wrote:
>>
>>     
>>> Hmm, only a few affected terms, and all this particular
>>> "literals:cfid196$" term, with optional suffixes.  Really strange.
>>>
>>> One things that's odd is the exact term "literals:cfid196$" is printed
>>> twice, which should never happen (every unique term should be stored
>>> only once, in the terms dict).
>>>
>>> And, otherwise, CheckIndex got through the index just fine.
>>>
>>> Try searching a TermQuery with these affected terms and see if it
>>> succeeds?  If so, maybe trying making an index with one or two of
>>> them, alone, and see if that index shows the problem?
>>>
>>> OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
>>> produce an enormous amount of output, but if you can excise the few
>>> lines around when that warning comes out & post back that'd be great.
>>>
>>> Mike
>>>
>>> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com>
>>> wrote:
>>>       
>>>> Just to be safe, I ran with the official jar file from one of the
>>>>         
>>> mirrors
>>>       
>>>> and reproduced the problem.
>>>> The debug session is not showing any characters = '\uffff' (checking
>>>>         
>>> this in
>>>       
>>>> Tokenizer).
>>>> The output from the modified CheckIndex follows. There are only a few
>>>>         
>>> terms
>>>       
>>>> with the inconsistency. They are all legitimate terms from the app's
>>>> context. With this info, I might be able to isolate the source
>>>>         
>>> documents.
>>>       
>>>> What should I be looking for when they are indexed?
>>>>
>>>> CheckInput output:
>>>>
>>>> Opening index @
>>>>         
>>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
>>>       
>>>> Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS
>>>>         
>>> [Lucene
>>>       
>>>> 2.9]
>>>>  1 of 3: name=_0 docCount=413585
>>>>    compound=false
>>>>    hasProx=true
>>>>    numFiles=8
>>>>    size (MB)=1,148.817
>>>>    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>>>>    docStoreOffset=0
>>>>    docStoreSegment=_0
>>>>    docStoreIsCompoundFile=false
>>>>    no deletions
>>>>    test: open reader.........OK
>>>>    test: fields..............OK [33 fields]
>>>>    test: field norms.........OK [33 fields]
>>>>    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs
>>>>         
>>> pairs;
>>>       
>>>> 340244234 tokens]
>>>>    test: stored fields.......OK [1240755 total field count; avg 3 fields
>>>> per doc]
>>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
>>>> vector fields per doc]
>>>>
>>>>  2 of 3: name=_1 docCount=359068
>>>>    compound=false
>>>>    hasProx=true
>>>>    numFiles=8
>>>>    size (MB)=1,125.161
>>>>    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>>>>    docStoreOffset=413585
>>>>    docStoreSegment=_0
>>>>    docStoreIsCompoundFile=false
>>>>    no deletions
>>>>    test: open reader.........OK
>>>>    test: fields..............OK [33 fields]
>>>>    test: field norms.........OK [33 fields]
>>>>    test: terms, freq, prox...WARNING: term  literals:cfid196$ docFreq=43
>>>>         
>>> !=
>>>       
>>>> num docs seen 4 + num docs deleted 0
>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
>>>> deleted 0
>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
>>>> deleted 0
>>>> WARNING: term  literals:cfid196$commandant docFreq=1 != num docs seen 9
>>>>         
>>> +
>>>       
>>>> num docs deleted 0
>>>> WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 + num
>>>> docs deleted 0
>>>> OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
>>>>    test: stored fields.......OK [1077204 total field count; avg 3 fields
>>>> per doc]
>>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
>>>> vector fields per doc]
>>>>
>>>>  3 of 3: name=_2 docCount=304849
>>>>    compound=false
>>>>    hasProx=true
>>>>    numFiles=8
>>>>    size (MB)=962.004
>>>>    diagnostics = {os.version=5.2, os=Windows 2003, lucene.version=2.9.0
>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>>>>    docStoreOffset=772653
>>>>    docStoreSegment=_0
>>>>    docStoreIsCompoundFile=false
>>>>    no deletions
>>>>    test: open reader.........OK
>>>>    test: fields..............OK [33 fields]
>>>>    test: field norms.........OK [33 fields]
>>>>    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 != num
>>>> docs seen 246 + num docs deleted 0
>>>> WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num
>>>>         
>>> docs
>>>       
>>>> deleted 0
>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num docs
>>>> deleted 0
>>>> WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen 37 +
>>>>         
>>> num
>>>       
>>>> docs deleted 0
>>>> WARNING: term  literals:cfid196$interrogation docFreq=181 != num docs
>>>>         
>>> seen 1
>>>       
>>>> + num docs deleted 0
>>>> WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen 353 +
>>>>         
>>> num
>>>       
>>>> docs deleted 0
>>>> WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs seen
>>>>         
>>> 1 +
>>>       
>>>> num docs deleted 0
>>>> WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 + num
>>>>         
>>> docs
>>>       
>>>> deleted 0
>>>> OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
>>>>    test: stored fields.......OK [914547 total field count; avg 3 fields
>>>>         
>>> per
>>>       
>>>> doc]
>>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
>>>> vector fields per doc]
>>>>
>>>> No problems were detected with this index.
>>>>
>>>> Peter
>>>>
>>>>
>>>> On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
>>>> lucene@mikemccandless.com> wrote:
>>>>
>>>>         
>>>>> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <peterlkeegan@gmail.com
>>>>>           
>>>>> wrote:
>>>>>           
>>>>>> The only change I made to the source code was the patch for
>>>>>>             
>>>>> PayloadNearQuery
>>>>>           
>>>>>> (LUCENE-1986).
>>>>>>             
>>>>> That patch certainly shouldn't lead to this.
>>>>>
>>>>>           
>>>>>> It's possible that our content contains U+FFFF. I will run in
>>>>>>             
>>> debugger
>>>       
>>>>> and
>>>>>           
>>>>>> see.
>>>>>>             
>>>>> OK may as well check just so we cover all possibilities.
>>>>>
>>>>>           
>>>>>> The data is 'sensitive', so I may not be able to provide a bad
>>>>>>             
>>> segment,
>>>       
>>>>>> unfortunately.
>>>>>>             
>>>>> OK, maybe we can modify your CheckIndex instead.  Let's start with
>>>>> this, which prints a warning whenever the docFreq differs but
>>>>> otherwise continues (vs throwing RuntimeException).  I'm curious how
>>>>> many terms show this, and whether the TermEnum keeps working after
>>>>> this term that has different docFreq:
>>>>>
>>>>> Index: src/java/org/apache/lucene/index/CheckIndex.java
>>>>> ===================================================================
>>>>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
>>>>>           
>>> 829889)
>>>       
>>>>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working copy)
>>>>> @@ -672,8 +672,8 @@
>>>>>         }
>>>>>
>>>>>         if (freq0 + delCount != docFreq) {
>>>>> -          throw new RuntimeException("term " + term + " docFreq=" +
>>>>> -                                     docFreq + " != num docs seen " +
>>>>> freq0 + " + num docs deleted " + delCount);
>>>>> +          System.out.println("WARNING: term  " + term + " docFreq=" +
>>>>> +                             docFreq + " != num docs seen " + freq0 +
>>>>> " + num docs deleted " + delCount);
>>>>>         }
>>>>>       }
>>>>>
>>>>> Mike
>>>>>
>>>>> ---------------------------------------------------------------------
>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>
>>>>>
>>>>>           
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43122-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 22:39:22 2009
Return-Path: <java-user-return-43122-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 55395 invoked from network); 29 Oct 2009 22:39:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 22:39:22 -0000
Received: (qmail 23699 invoked by uid 500); 29 Oct 2009 22:39:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 23627 invoked by uid 500); 29 Oct 2009 22:39:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 23617 invoked by uid 99); 29 Oct 2009 22:39:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 22:39:19 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of karl.wettin@gmail.com designates 209.85.219.226 as permitted sender)
Received: from [209.85.219.226] (HELO mail-ew0-f226.google.com) (209.85.219.226)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 22:39:10 +0000
Received: by ewy26 with SMTP id 26so2491161ewy.5
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 15:38:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:from:to
         :in-reply-to:content-type:content-transfer-encoding:mime-version
         :subject:date:references:x-mailer;
        bh=6wibYlj5rQjIDHRzGSAbzu2KdvgcUZF8O+I6y1p3qe8=;
        b=KmhklD4nnAzIHCsXehF1YFdXFfuqGFUFiZr3GsQY7gO2/C73Sx7gD4q8AqlsQGsB8+
         Od0DDrgbmRGMqHzKPjrmY1tTWb7HKPpfq7T95REj/H0NF24pDq3ny7sLMRF8er09vfZT
         iqCPQowVkL3wnsLksRN6/PwS2xIn0YUWsxwjE=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:from:to:in-reply-to:content-type
         :content-transfer-encoding:mime-version:subject:date:references
         :x-mailer;
        b=QKWkHjFrVhx8UPiZQeSCVZl+6t6AweYmrFES6mQ+yDZ6i1DQ5H+flej+TJjkd0Vgto
         AUpd6zCigzmd74QqmhEKHSZk+qsHy+dIHOZ7FfbBjSzSK2R2AoIsqwWVWEHPajx2vugQ
         0CdFQzhoaDhYLRizyZONQrKfFIfNstlN2r7t4=
Received: by 10.210.9.12 with SMTP id 12mr881336ebi.3.1256855930416;
        Thu, 29 Oct 2009 15:38:50 -0700 (PDT)
Received: from ?192.168.1.201? (c-8f8170d5.029-18-6d6c6d2.cust.bredbandsbolaget.se [213.112.129.143])
        by mx.google.com with ESMTPS id 23sm7126350eya.20.2009.10.29.15.38.49
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Thu, 29 Oct 2009 15:38:49 -0700 (PDT)
Message-Id: <7AB455FE-AA72-4BFA-949F-028B7A6BB622@gmail.com>
From: Karl Wettin <karl.wettin@gmail.com>
To: java-user@lucene.apache.org
In-Reply-To: <26111084.post@talk.nabble.com>
Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (Apple Message framework v936)
Subject: Re: search problem
Date: Thu, 29 Oct 2009 23:38:48 +0100
References: <26111084.post@talk.nabble.com>
X-Mailer: Apple Mail (2.936)
X-Virus-Checked: Checked by ClamAV on apache.org


29 okt 2009 kl. 12.12 skrev m.harig:
>
>     i've a doubt in search , i've a word in my index welcomelucene  
> (without
> spaces) , when i search for welcome lucene(with a space) , am not  
> able to
> get the hits. It should pick the document welcomelucene.. is there  
> anyway to
> do it ? i've used wildcard option too. but no results , please  
> anyone help
> me..

Using a bigram shingle filter with no spacer characters at query time  
should match the document, but as Erick says you might want consider  
and tell us why you want to do this.


           karl

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43123-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Thu Oct 29 23:06:41 2009
Return-Path: <java-user-return-43123-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 63122 invoked from network); 29 Oct 2009 23:06:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 29 Oct 2009 23:06:40 -0000
Received: (qmail 53362 invoked by uid 500); 29 Oct 2009 23:06:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 53290 invoked by uid 500); 29 Oct 2009 23:06:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 53273 invoked by uid 99); 29 Oct 2009 23:06:37 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 23:06:37 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.221.203 as permitted sender)
Received: from [209.85.221.203] (HELO mail-qy0-f203.google.com) (209.85.221.203)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 29 Oct 2009 23:06:32 +0000
Received: by qyk41 with SMTP id 41so1465361qyk.29
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 16:06:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=ZCzFKVR2TLIJkj+CctzVaDoaBS8kqlBfebYI5j/wdJg=;
        b=vXG11zZj9aaphFK0wpKaFZEoj3oJklkifKItZCWlNljF+MMQCcyXi9+pdcbztg3E4Y
         uwUUe09FRZ0ZlKYSeyW84Nvg+CyAIML4XlINb8BV9P96+/b2lovNqMgF5pbjIikYthPV
         Bz78ynpcL8CG/PtyRDXkMAUS+OWWbiIqzyPoM=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=tB7alNt/KgvEB9O9kcHB5U4VLbwd528eJiF+kdOSMmBhMHhZLBXsfXndCzB4lylKF6
         bS5khW3OMHb880aOrDgwICmuGKUEUfP9VRjE7Gc3TSLW6lTAjYVXyPpEZTRED6lFQgqU
         lN5hm7kS/qy4iCoxI8N/cx/7OO6gGk6Ntc1vI=
MIME-Version: 1.0
Received: by 10.229.119.7 with SMTP id x7mr107572qcq.22.1256857571562; Thu, 29 
	Oct 2009 16:06:11 -0700 (PDT)
In-Reply-To: <4AE9FB61.6030009@gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>
	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
	 <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>
	 <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
	 <4AE9FB61.6030009@gmail.com>
Date: Thu, 29 Oct 2009 19:06:11 -0400
Message-ID: <e994873a0910291606i3118dab2ge9d85027134b1f8a@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd5f25016157004771af53a

--000e0cd5f25016157004771af53a
Content-Type: text/plain; charset=ISO-8859-1

Mark,

With 1.9G, I had to increase the JVM heap significantly (to 8G)  to avoid
paging and GC hits. Here is a table comparing indexing times, optimizing
times and peak memory usage as a function of the  RAMBufferSize. This was
run on a 64-bit server with 32GB RAM:

RamSize        Index(min)    Optimize(min)     Max VM
1.9G         24            5                   5G
800M        24            5                  4G

Not much difference. I'll make a couple more runs with lower values.
Btw, the indexing times are really about 5 min. shorter because of some
non-Lucene related delays after the last document.

Peter



On Thu, Oct 29, 2009 at 4:30 PM, Mark Miller <markrmiller@gmail.com> wrote:

> Any chance I could get you to try that again with a buffer of like 800MB
> to a gig and do a comparison?
>
> I've been investigating the returns you get with a larger buffer size.
> It appears to be pretty diminishing returns over 100MB or so - at higher
> than that, I've gotten both slower speeds for some sizes, and larger
> gains for others. But only better by 5-10 docs a second up to a gig. But
> I can't reliably test at over a gig - I have only 4 GB of RAM, and even
> with that, at over a gig it starts to page and the performance gets hit.
> I'd love to see what kind of benefit you see going from around a gig to
> just under 2.
>
> Peter Keegan wrote:
> > Btw, this 2.9 indexer is fast! I indexed 4Gb (1.07 million docs) with
> > optimization in just under 30 min.
> > I used setRAMBufferSizeMB=1.9G
> >
> > Peter
> >
> > On Thu, Oct 29, 2009 at 3:46 PM, Peter Keegan <peterlkeegan@gmail.com
> >wrote:
> >
> >
> >> A handful of the source documents did contain the U+FFFF character. The
> >> patch from *LUCENE-2016<
> https://issues.apache.org/jira/browse/LUCENE-2016>
> >> *fixed the problem.
> >> Thanks Mike!
> >>
> >> Peter
> >>
> >>
> >> On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
> >> lucene@mikemccandless.com> wrote:
> >>
> >>
> >>> Hmm, only a few affected terms, and all this particular
> >>> "literals:cfid196$" term, with optional suffixes.  Really strange.
> >>>
> >>> One things that's odd is the exact term "literals:cfid196$" is printed
> >>> twice, which should never happen (every unique term should be stored
> >>> only once, in the terms dict).
> >>>
> >>> And, otherwise, CheckIndex got through the index just fine.
> >>>
> >>> Try searching a TermQuery with these affected terms and see if it
> >>> succeeds?  If so, maybe trying making an index with one or two of
> >>> them, alone, and see if that index shows the problem?
> >>>
> >>> OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
> >>> produce an enormous amount of output, but if you can excise the few
> >>> lines around when that warning comes out & post back that'd be great.
> >>>
> >>> Mike
> >>>
> >>> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com
> >
> >>> wrote:
> >>>
> >>>> Just to be safe, I ran with the official jar file from one of the
> >>>>
> >>> mirrors
> >>>
> >>>> and reproduced the problem.
> >>>> The debug session is not showing any characters = '\uffff' (checking
> >>>>
> >>> this in
> >>>
> >>>> Tokenizer).
> >>>> The output from the modified CheckIndex follows. There are only a few
> >>>>
> >>> terms
> >>>
> >>>> with the inconsistency. They are all legitimate terms from the app's
> >>>> context. With this info, I might be able to isolate the source
> >>>>
> >>> documents.
> >>>
> >>>> What should I be looking for when they are indexed?
> >>>>
> >>>> CheckInput output:
> >>>>
> >>>> Opening index @
> >>>>
> >>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
> >>>
> >>>> Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS
> >>>>
> >>> [Lucene
> >>>
> >>>> 2.9]
> >>>>  1 of 3: name=_0 docCount=413585
> >>>>    compound=false
> >>>>    hasProx=true
> >>>>    numFiles=8
> >>>>    size (MB)=1,148.817
> >>>>    diagnostics = {os.version=5.2, os=Windows 2003,
> lucene.version=2.9.0
> >>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> >>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >>>>    docStoreOffset=0
> >>>>    docStoreSegment=_0
> >>>>    docStoreIsCompoundFile=false
> >>>>    no deletions
> >>>>    test: open reader.........OK
> >>>>    test: fields..............OK [33 fields]
> >>>>    test: field norms.........OK [33 fields]
> >>>>    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs
> >>>>
> >>> pairs;
> >>>
> >>>> 340244234 tokens]
> >>>>    test: stored fields.......OK [1240755 total field count; avg 3
> fields
> >>>> per doc]
> >>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
> >>>> vector fields per doc]
> >>>>
> >>>>  2 of 3: name=_1 docCount=359068
> >>>>    compound=false
> >>>>    hasProx=true
> >>>>    numFiles=8
> >>>>    size (MB)=1,125.161
> >>>>    diagnostics = {os.version=5.2, os=Windows 2003,
> lucene.version=2.9.0
> >>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> >>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >>>>    docStoreOffset=413585
> >>>>    docStoreSegment=_0
> >>>>    docStoreIsCompoundFile=false
> >>>>    no deletions
> >>>>    test: open reader.........OK
> >>>>    test: fields..............OK [33 fields]
> >>>>    test: field norms.........OK [33 fields]
> >>>>    test: terms, freq, prox...WARNING: term  literals:cfid196$
> docFreq=43
> >>>>
> >>> !=
> >>>
> >>>> num docs seen 4 + num docs deleted 0
> >>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
> docs
> >>>> deleted 0
> >>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
> docs
> >>>> deleted 0
> >>>> WARNING: term  literals:cfid196$commandant docFreq=1 != num docs seen
> 9
> >>>>
> >>> +
> >>>
> >>>> num docs deleted 0
> >>>> WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 +
> num
> >>>> docs deleted 0
> >>>> OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
> >>>>    test: stored fields.......OK [1077204 total field count; avg 3
> fields
> >>>> per doc]
> >>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
> >>>> vector fields per doc]
> >>>>
> >>>>  3 of 3: name=_2 docCount=304849
> >>>>    compound=false
> >>>>    hasProx=true
> >>>>    numFiles=8
> >>>>    size (MB)=962.004
> >>>>    diagnostics = {os.version=5.2, os=Windows 2003,
> lucene.version=2.9.0
> >>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> >>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >>>>    docStoreOffset=772653
> >>>>    docStoreSegment=_0
> >>>>    docStoreIsCompoundFile=false
> >>>>    no deletions
> >>>>    test: open reader.........OK
> >>>>    test: fields..............OK [33 fields]
> >>>>    test: field norms.........OK [33 fields]
> >>>>    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 !=
> num
> >>>> docs seen 246 + num docs deleted 0
> >>>> WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num
> >>>>
> >>> docs
> >>>
> >>>> deleted 0
> >>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
> docs
> >>>> deleted 0
> >>>> WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen 37
> +
> >>>>
> >>> num
> >>>
> >>>> docs deleted 0
> >>>> WARNING: term  literals:cfid196$interrogation docFreq=181 != num docs
> >>>>
> >>> seen 1
> >>>
> >>>> + num docs deleted 0
> >>>> WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen 353
> +
> >>>>
> >>> num
> >>>
> >>>> docs deleted 0
> >>>> WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs
> seen
> >>>>
> >>> 1 +
> >>>
> >>>> num docs deleted 0
> >>>> WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 +
> num
> >>>>
> >>> docs
> >>>
> >>>> deleted 0
> >>>> OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
> >>>>    test: stored fields.......OK [914547 total field count; avg 3
> fields
> >>>>
> >>> per
> >>>
> >>>> doc]
> >>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
> >>>> vector fields per doc]
> >>>>
> >>>> No problems were detected with this index.
> >>>>
> >>>> Peter
> >>>>
> >>>>
> >>>> On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
> >>>> lucene@mikemccandless.com> wrote:
> >>>>
> >>>>
> >>>>> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <
> peterlkeegan@gmail.com
> >>>>>
> >>>>> wrote:
> >>>>>
> >>>>>> The only change I made to the source code was the patch for
> >>>>>>
> >>>>> PayloadNearQuery
> >>>>>
> >>>>>> (LUCENE-1986).
> >>>>>>
> >>>>> That patch certainly shouldn't lead to this.
> >>>>>
> >>>>>
> >>>>>> It's possible that our content contains U+FFFF. I will run in
> >>>>>>
> >>> debugger
> >>>
> >>>>> and
> >>>>>
> >>>>>> see.
> >>>>>>
> >>>>> OK may as well check just so we cover all possibilities.
> >>>>>
> >>>>>
> >>>>>> The data is 'sensitive', so I may not be able to provide a bad
> >>>>>>
> >>> segment,
> >>>
> >>>>>> unfortunately.
> >>>>>>
> >>>>> OK, maybe we can modify your CheckIndex instead.  Let's start with
> >>>>> this, which prints a warning whenever the docFreq differs but
> >>>>> otherwise continues (vs throwing RuntimeException).  I'm curious how
> >>>>> many terms show this, and whether the TermEnum keeps working after
> >>>>> this term that has different docFreq:
> >>>>>
> >>>>> Index: src/java/org/apache/lucene/index/CheckIndex.java
> >>>>> ===================================================================
> >>>>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
> >>>>>
> >>> 829889)
> >>>
> >>>>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working
> copy)
> >>>>> @@ -672,8 +672,8 @@
> >>>>>         }
> >>>>>
> >>>>>         if (freq0 + delCount != docFreq) {
> >>>>> -          throw new RuntimeException("term " + term + " docFreq=" +
> >>>>> -                                     docFreq + " != num docs seen "
> +
> >>>>> freq0 + " + num docs deleted " + delCount);
> >>>>> +          System.out.println("WARNING: term  " + term + " docFreq="
> +
> >>>>> +                             docFreq + " != num docs seen " + freq0
> +
> >>>>> " + num docs deleted " + delCount);
> >>>>>         }
> >>>>>       }
> >>>>>
> >>>>> Mike
> >>>>>
> >>>>> ---------------------------------------------------------------------
> >>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>>
> >>>>>
> >>>>>
> >>
> >
> >
>
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd5f25016157004771af53a--

From java-user-return-43124-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 00:50:13 2009
Return-Path: <java-user-return-43124-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96140 invoked from network); 30 Oct 2009 00:50:13 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 00:50:13 -0000
Received: (qmail 45257 invoked by uid 500); 30 Oct 2009 00:50:11 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45163 invoked by uid 500); 30 Oct 2009 00:50:11 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45153 invoked by uid 99); 30 Oct 2009 00:50:11 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 00:50:11 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of markrmiller@gmail.com designates 209.85.217.219 as permitted sender)
Received: from [209.85.217.219] (HELO mail-gx0-f219.google.com) (209.85.217.219)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 00:50:08 +0000
Received: by gxk19 with SMTP id 19so2483815gxk.5
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 17:49:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from
         :user-agent:mime-version:to:subject:references:in-reply-to
         :x-enigmail-version:content-type:content-transfer-encoding;
        bh=C0T0gSSHWa/fOiX2WjZcOhu1PSGMOi0F6sETmUVRHBs=;
        b=aKP/iQJgZcVkSOp67qw5eGnrIRfIwC9xO10in/MnCtoqqedAccLqJV3Wmqv81mo5mA
         O3W9FGC4WHnuP13RZA2IQDJsvqm+w0luJVl9hfMx6/Lq+wbbC4aeLETR+C/ktNehUEZw
         X7BvmpqTMTX9hRl8sugq0r5Y7McoTt+7lk7Hk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:user-agent:mime-version:to:subject:references
         :in-reply-to:x-enigmail-version:content-type
         :content-transfer-encoding;
        b=Dm1CBQldu1gV+rz3DZZhgv1nLJ8WkjCdO2h/7EOyU5i1hqi0EdlAnAs2y28/8ry70l
         KhX4ZkRe5Mn9l2+e3WljbCukMDr6J5t0zLvblpHdE5bDi0bgqd+ToIl5JB4aFeiO0p5p
         DqnqDiTYpeMMn2Rh3efmJhIU9L5wLWuebNMOI=
Received: by 10.150.38.5 with SMTP id l5mr1601444ybl.284.1256863787348;
        Thu, 29 Oct 2009 17:49:47 -0700 (PDT)
Received: from ?192.168.1.108? (ool-44c639d9.dyn.optonline.net [68.198.57.217])
        by mx.google.com with ESMTPS id 15sm331479gxk.0.2009.10.29.17.49.45
        (version=SSLv3 cipher=RC4-MD5);
        Thu, 29 Oct 2009 17:49:46 -0700 (PDT)
Message-ID: <4AEA3828.6060309@gmail.com>
Date: Thu, 29 Oct 2009 20:49:44 -0400
From: Mark Miller <markrmiller@gmail.com>
User-Agent: Thunderbird 2.0.0.23 (X11/20090817)
MIME-Version: 1.0
To: java-user@lucene.apache.org
Subject: Re: IO exception during merge/optimize
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>	 <e994873a0910280721r3641821fl4cf9fb90716d4a6a@mail.gmail.com>	 <9ac0c6aa0910280743vc1cf36dkdb6a9558a022d6d5@mail.gmail.com>	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>	 <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>	 <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>	 <4AE9FB61.6030009@gmail.com> <e994873a0910291606i3118dab2ge9d85027134b1f8a@mail.gmail.com>
In-Reply-To: <e994873a0910291606i3118dab2ge9d85027134b1f8a@mail.gmail.com>
X-Enigmail-Version: 0.96.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

Thanks a lot Peter! Really appreciate it.

Peter Keegan wrote:
> Mark,
>
> With 1.9G, I had to increase the JVM heap significantly (to 8G)  to avoid
> paging and GC hits. Here is a table comparing indexing times, optimizing
> times and peak memory usage as a function of the  RAMBufferSize. This was
> run on a 64-bit server with 32GB RAM:
>
> RamSize        Index(min)    Optimize(min)     Max VM
> 1.9G         24            5                   5G
> 800M        24            5                  4G
>
> Not much difference. I'll make a couple more runs with lower values.
> Btw, the indexing times are really about 5 min. shorter because of some
> non-Lucene related delays after the last document.
>
> Peter
>
>
>
> On Thu, Oct 29, 2009 at 4:30 PM, Mark Miller <markrmiller@gmail.com> wrote:
>
>   
>> Any chance I could get you to try that again with a buffer of like 800MB
>> to a gig and do a comparison?
>>
>> I've been investigating the returns you get with a larger buffer size.
>> It appears to be pretty diminishing returns over 100MB or so - at higher
>> than that, I've gotten both slower speeds for some sizes, and larger
>> gains for others. But only better by 5-10 docs a second up to a gig. But
>> I can't reliably test at over a gig - I have only 4 GB of RAM, and even
>> with that, at over a gig it starts to page and the performance gets hit.
>> I'd love to see what kind of benefit you see going from around a gig to
>> just under 2.
>>
>> Peter Keegan wrote:
>>     
>>> Btw, this 2.9 indexer is fast! I indexed 4Gb (1.07 million docs) with
>>> optimization in just under 30 min.
>>> I used setRAMBufferSizeMB=1.9G
>>>
>>> Peter
>>>
>>> On Thu, Oct 29, 2009 at 3:46 PM, Peter Keegan <peterlkeegan@gmail.com
>>> wrote:
>>>
>>>
>>>       
>>>> A handful of the source documents did contain the U+FFFF character. The
>>>> patch from *LUCENE-2016<
>>>>         
>> https://issues.apache.org/jira/browse/LUCENE-2016>
>>     
>>>> *fixed the problem.
>>>> Thanks Mike!
>>>>
>>>> Peter
>>>>
>>>>
>>>> On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
>>>> lucene@mikemccandless.com> wrote:
>>>>
>>>>
>>>>         
>>>>> Hmm, only a few affected terms, and all this particular
>>>>> "literals:cfid196$" term, with optional suffixes.  Really strange.
>>>>>
>>>>> One things that's odd is the exact term "literals:cfid196$" is printed
>>>>> twice, which should never happen (every unique term should be stored
>>>>> only once, in the terms dict).
>>>>>
>>>>> And, otherwise, CheckIndex got through the index just fine.
>>>>>
>>>>> Try searching a TermQuery with these affected terms and see if it
>>>>> succeeds?  If so, maybe trying making an index with one or two of
>>>>> them, alone, and see if that index shows the problem?
>>>>>
>>>>> OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
>>>>> produce an enormous amount of output, but if you can excise the few
>>>>> lines around when that warning comes out & post back that'd be great.
>>>>>
>>>>> Mike
>>>>>
>>>>> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <peterlkeegan@gmail.com
>>>>>           
>>>>> wrote:
>>>>>
>>>>>           
>>>>>> Just to be safe, I ran with the official jar file from one of the
>>>>>>
>>>>>>             
>>>>> mirrors
>>>>>
>>>>>           
>>>>>> and reproduced the problem.
>>>>>> The debug session is not showing any characters = '\uffff' (checking
>>>>>>
>>>>>>             
>>>>> this in
>>>>>
>>>>>           
>>>>>> Tokenizer).
>>>>>> The output from the modified CheckIndex follows. There are only a few
>>>>>>
>>>>>>             
>>>>> terms
>>>>>
>>>>>           
>>>>>> with the inconsistency. They are all legitimate terms from the app's
>>>>>> context. With this info, I might be able to isolate the source
>>>>>>
>>>>>>             
>>>>> documents.
>>>>>
>>>>>           
>>>>>> What should I be looking for when they are indexed?
>>>>>>
>>>>>> CheckInput output:
>>>>>>
>>>>>> Opening index @
>>>>>>
>>>>>>             
>>>>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
>>>>>
>>>>>           
>>>>>> Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS
>>>>>>
>>>>>>             
>>>>> [Lucene
>>>>>
>>>>>           
>>>>>> 2.9]
>>>>>>  1 of 3: name=_0 docCount=413585
>>>>>>    compound=false
>>>>>>    hasProx=true
>>>>>>    numFiles=8
>>>>>>    size (MB)=1,148.817
>>>>>>    diagnostics = {os.version=5.2, os=Windows 2003,
>>>>>>             
>> lucene.version=2.9.0
>>     
>>>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>>>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>>>>>>    docStoreOffset=0
>>>>>>    docStoreSegment=_0
>>>>>>    docStoreIsCompoundFile=false
>>>>>>    no deletions
>>>>>>    test: open reader.........OK
>>>>>>    test: fields..............OK [33 fields]
>>>>>>    test: field norms.........OK [33 fields]
>>>>>>    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs
>>>>>>
>>>>>>             
>>>>> pairs;
>>>>>
>>>>>           
>>>>>> 340244234 tokens]
>>>>>>    test: stored fields.......OK [1240755 total field count; avg 3
>>>>>>             
>> fields
>>     
>>>>>> per doc]
>>>>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
>>>>>> vector fields per doc]
>>>>>>
>>>>>>  2 of 3: name=_1 docCount=359068
>>>>>>    compound=false
>>>>>>    hasProx=true
>>>>>>    numFiles=8
>>>>>>    size (MB)=1,125.161
>>>>>>    diagnostics = {os.version=5.2, os=Windows 2003,
>>>>>>             
>> lucene.version=2.9.0
>>     
>>>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>>>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>>>>>>    docStoreOffset=413585
>>>>>>    docStoreSegment=_0
>>>>>>    docStoreIsCompoundFile=false
>>>>>>    no deletions
>>>>>>    test: open reader.........OK
>>>>>>    test: fields..............OK [33 fields]
>>>>>>    test: field norms.........OK [33 fields]
>>>>>>    test: terms, freq, prox...WARNING: term  literals:cfid196$
>>>>>>             
>> docFreq=43
>>     
>>>>> !=
>>>>>
>>>>>           
>>>>>> num docs seen 4 + num docs deleted 0
>>>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
>>>>>>             
>> docs
>>     
>>>>>> deleted 0
>>>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
>>>>>>             
>> docs
>>     
>>>>>> deleted 0
>>>>>> WARNING: term  literals:cfid196$commandant docFreq=1 != num docs seen
>>>>>>             
>> 9
>>     
>>>>> +
>>>>>
>>>>>           
>>>>>> num docs deleted 0
>>>>>> WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 +
>>>>>>             
>> num
>>     
>>>>>> docs deleted 0
>>>>>> OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
>>>>>>    test: stored fields.......OK [1077204 total field count; avg 3
>>>>>>             
>> fields
>>     
>>>>>> per doc]
>>>>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
>>>>>> vector fields per doc]
>>>>>>
>>>>>>  3 of 3: name=_2 docCount=304849
>>>>>>    compound=false
>>>>>>    hasProx=true
>>>>>>    numFiles=8
>>>>>>    size (MB)=962.004
>>>>>>    diagnostics = {os.version=5.2, os=Windows 2003,
>>>>>>             
>> lucene.version=2.9.0
>>     
>>>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
>>>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
>>>>>>    docStoreOffset=772653
>>>>>>    docStoreSegment=_0
>>>>>>    docStoreIsCompoundFile=false
>>>>>>    no deletions
>>>>>>    test: open reader.........OK
>>>>>>    test: fields..............OK [33 fields]
>>>>>>    test: field norms.........OK [33 fields]
>>>>>>    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 !=
>>>>>>             
>> num
>>     
>>>>>> docs seen 246 + num docs deleted 0
>>>>>> WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num
>>>>>>
>>>>>>             
>>>>> docs
>>>>>
>>>>>           
>>>>>> deleted 0
>>>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
>>>>>>             
>> docs
>>     
>>>>>> deleted 0
>>>>>> WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen 37
>>>>>>             
>> +
>>     
>>>>> num
>>>>>
>>>>>           
>>>>>> docs deleted 0
>>>>>> WARNING: term  literals:cfid196$interrogation docFreq=181 != num docs
>>>>>>
>>>>>>             
>>>>> seen 1
>>>>>
>>>>>           
>>>>>> + num docs deleted 0
>>>>>> WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen 353
>>>>>>             
>> +
>>     
>>>>> num
>>>>>
>>>>>           
>>>>>> docs deleted 0
>>>>>> WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs
>>>>>>             
>> seen
>>     
>>>>> 1 +
>>>>>
>>>>>           
>>>>>> num docs deleted 0
>>>>>> WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 +
>>>>>>             
>> num
>>     
>>>>> docs
>>>>>
>>>>>           
>>>>>> deleted 0
>>>>>> OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
>>>>>>    test: stored fields.......OK [914547 total field count; avg 3
>>>>>>             
>> fields
>>     
>>>>> per
>>>>>
>>>>>           
>>>>>> doc]
>>>>>>    test: term vectors........OK [0 total vector count; avg 0 term/freq
>>>>>> vector fields per doc]
>>>>>>
>>>>>> No problems were detected with this index.
>>>>>>
>>>>>> Peter
>>>>>>
>>>>>>
>>>>>> On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
>>>>>> lucene@mikemccandless.com> wrote:
>>>>>>
>>>>>>
>>>>>>             
>>>>>>> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <
>>>>>>>               
>> peterlkeegan@gmail.com
>>     
>>>>>>> wrote:
>>>>>>>
>>>>>>>               
>>>>>>>> The only change I made to the source code was the patch for
>>>>>>>>
>>>>>>>>                 
>>>>>>> PayloadNearQuery
>>>>>>>
>>>>>>>               
>>>>>>>> (LUCENE-1986).
>>>>>>>>
>>>>>>>>                 
>>>>>>> That patch certainly shouldn't lead to this.
>>>>>>>
>>>>>>>
>>>>>>>               
>>>>>>>> It's possible that our content contains U+FFFF. I will run in
>>>>>>>>
>>>>>>>>                 
>>>>> debugger
>>>>>
>>>>>           
>>>>>>> and
>>>>>>>
>>>>>>>               
>>>>>>>> see.
>>>>>>>>
>>>>>>>>                 
>>>>>>> OK may as well check just so we cover all possibilities.
>>>>>>>
>>>>>>>
>>>>>>>               
>>>>>>>> The data is 'sensitive', so I may not be able to provide a bad
>>>>>>>>
>>>>>>>>                 
>>>>> segment,
>>>>>
>>>>>           
>>>>>>>> unfortunately.
>>>>>>>>
>>>>>>>>                 
>>>>>>> OK, maybe we can modify your CheckIndex instead.  Let's start with
>>>>>>> this, which prints a warning whenever the docFreq differs but
>>>>>>> otherwise continues (vs throwing RuntimeException).  I'm curious how
>>>>>>> many terms show this, and whether the TermEnum keeps working after
>>>>>>> this term that has different docFreq:
>>>>>>>
>>>>>>> Index: src/java/org/apache/lucene/index/CheckIndex.java
>>>>>>> ===================================================================
>>>>>>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
>>>>>>>
>>>>>>>               
>>>>> 829889)
>>>>>
>>>>>           
>>>>>>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working
>>>>>>>               
>> copy)
>>     
>>>>>>> @@ -672,8 +672,8 @@
>>>>>>>         }
>>>>>>>
>>>>>>>         if (freq0 + delCount != docFreq) {
>>>>>>> -          throw new RuntimeException("term " + term + " docFreq=" +
>>>>>>> -                                     docFreq + " != num docs seen "
>>>>>>>               
>> +
>>     
>>>>>>> freq0 + " + num docs deleted " + delCount);
>>>>>>> +          System.out.println("WARNING: term  " + term + " docFreq="
>>>>>>>               
>> +
>>     
>>>>>>> +                             docFreq + " != num docs seen " + freq0
>>>>>>>               
>> +
>>     
>>>>>>> " + num docs deleted " + delCount);
>>>>>>>         }
>>>>>>>       }
>>>>>>>
>>>>>>> Mike
>>>>>>>
>>>>>>> ---------------------------------------------------------------------
>>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>>>>>>
>>>>>>>
>>>>>>>
>>>>>>>               
>>>       
>> --
>> - Mark
>>
>> http://www.lucidimagination.com
>>
>>
>>
>>
>> ---------------------------------------------------------------------
>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
>> For additional commands, e-mail: java-user-help@lucene.apache.org
>>
>>
>>     
>
>   


-- 
- Mark

http://www.lucidimagination.com




---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43125-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 01:15:40 2009
Return-Path: <java-user-return-43125-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 583 invoked from network); 30 Oct 2009 01:15:40 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 01:15:40 -0000
Received: (qmail 68197 invoked by uid 500); 30 Oct 2009 01:15:38 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 68136 invoked by uid 500); 30 Oct 2009 01:15:38 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 68125 invoked by uid 99); 30 Oct 2009 01:15:38 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 01:15:38 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of peterlkeegan@gmail.com designates 209.85.216.187 as permitted sender)
Received: from [209.85.216.187] (HELO mail-px0-f187.google.com) (209.85.216.187)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 01:15:34 +0000
Received: by pxi17 with SMTP id 17so1603202pxi.21
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 18:15:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=hEGTfU6OsF3P+fsgTTGpG9Xaiv1afQIhswv2MtvUgsU=;
        b=KxQgI8z4SdDpLX0Bsf3aHtYlGNAESGiQtpe8+0DtpX6V1popMdgenPz6UFfUQSJpIM
         neMWgppVN2y+o/H4nN0nfRiu+dS5UQ8eXQhU/t5ZNd/0uWE20HMbbyKgXl7dEjSSqaD+
         C3v1YX0LM/A32lfuPm4FHRLMj1eEqk2EiPY7E=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=aJxpWkN7/B5UaBGucIkPDZUNhxbZlD5qNPEO59/QlRAcCz45tLc2FoHxHJvSROHZU+
         /fFqT8fqUYKQK4itj+vk8bYNh7IOI8M2ucMVwoWbj74SyngzlBQ/aY49wYl6WiCkrXAa
         jvaOV6JvA+URyoMEEsARfGa26R+oomC78mTK4=
MIME-Version: 1.0
Received: by 10.142.247.5 with SMTP id u5mr85333wfh.333.1256865314042; Thu, 29 
	Oct 2009 18:15:14 -0700 (PDT)
In-Reply-To: <4AEA3828.6060309@gmail.com>
References: <e994873a0910241420o39422fc7p4318d821ddef8a90@mail.gmail.com>
	 <e994873a0910280758h67f734a7k397d7c418fc807fb@mail.gmail.com>
	 <9ac0c6aa0910280829r3f4f167ava6a41c983353c392@mail.gmail.com>
	 <e994873a0910280923l6b73ec26nd01f112f9d7c5b2c@mail.gmail.com>
	 <9ac0c6aa0910281029p6ac2729csa85ca832057e07e0@mail.gmail.com>
	 <e994873a0910291246v2b03a000s9248aad2123f40ce@mail.gmail.com>
	 <e994873a0910291255r5d3421f8g56d8a380ffb3841f@mail.gmail.com>
	 <4AE9FB61.6030009@gmail.com>
	 <e994873a0910291606i3118dab2ge9d85027134b1f8a@mail.gmail.com>
	 <4AEA3828.6060309@gmail.com>
Date: Thu, 29 Oct 2009 21:15:13 -0400
Message-ID: <e994873a0910291815q2e9c12enbc1d98cbac3399ed@mail.gmail.com>
Subject: Re: IO exception during merge/optimize
From: Peter Keegan <peterlkeegan@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502cc2592f4d604771cc2d9

--00504502cc2592f4d604771cc2d9
Content-Type: text/plain; charset=ISO-8859-1

A couple more data points:

RamSize        Index(min)    Optimize(min)        Peak mem
1.9G        24        5        5G
800M        24        5        4G
400M        25          5        3.5G
100M        25        5        3G
50M         26          4        3G

Peter


On Thu, Oct 29, 2009 at 8:49 PM, Mark Miller <markrmiller@gmail.com> wrote:

> Thanks a lot Peter! Really appreciate it.
>
> Peter Keegan wrote:
> > Mark,
> >
> > With 1.9G, I had to increase the JVM heap significantly (to 8G)  to avoid
> > paging and GC hits. Here is a table comparing indexing times, optimizing
> > times and peak memory usage as a function of the  RAMBufferSize. This was
> > run on a 64-bit server with 32GB RAM:
> >
> > RamSize        Index(min)    Optimize(min)     Max VM
> > 1.9G         24            5                   5G
> > 800M        24            5                  4G
> >
> > Not much difference. I'll make a couple more runs with lower values.
> > Btw, the indexing times are really about 5 min. shorter because of some
> > non-Lucene related delays after the last document.
> >
> > Peter
> >
> >
> >
> > On Thu, Oct 29, 2009 at 4:30 PM, Mark Miller <markrmiller@gmail.com>
> wrote:
> >
> >
> >> Any chance I could get you to try that again with a buffer of like 800MB
> >> to a gig and do a comparison?
> >>
> >> I've been investigating the returns you get with a larger buffer size.
> >> It appears to be pretty diminishing returns over 100MB or so - at higher
> >> than that, I've gotten both slower speeds for some sizes, and larger
> >> gains for others. But only better by 5-10 docs a second up to a gig. But
> >> I can't reliably test at over a gig - I have only 4 GB of RAM, and even
> >> with that, at over a gig it starts to page and the performance gets hit.
> >> I'd love to see what kind of benefit you see going from around a gig to
> >> just under 2.
> >>
> >> Peter Keegan wrote:
> >>
> >>> Btw, this 2.9 indexer is fast! I indexed 4Gb (1.07 million docs) with
> >>> optimization in just under 30 min.
> >>> I used setRAMBufferSizeMB=1.9G
> >>>
> >>> Peter
> >>>
> >>> On Thu, Oct 29, 2009 at 3:46 PM, Peter Keegan <peterlkeegan@gmail.com
> >>> wrote:
> >>>
> >>>
> >>>
> >>>> A handful of the source documents did contain the U+FFFF character.
> The
> >>>> patch from *LUCENE-2016<
> >>>>
> >> https://issues.apache.org/jira/browse/LUCENE-2016>
> >>
> >>>> *fixed the problem.
> >>>> Thanks Mike!
> >>>>
> >>>> Peter
> >>>>
> >>>>
> >>>> On Wed, Oct 28, 2009 at 1:29 PM, Michael McCandless <
> >>>> lucene@mikemccandless.com> wrote:
> >>>>
> >>>>
> >>>>
> >>>>> Hmm, only a few affected terms, and all this particular
> >>>>> "literals:cfid196$" term, with optional suffixes.  Really strange.
> >>>>>
> >>>>> One things that's odd is the exact term "literals:cfid196$" is
> printed
> >>>>> twice, which should never happen (every unique term should be stored
> >>>>> only once, in the terms dict).
> >>>>>
> >>>>> And, otherwise, CheckIndex got through the index just fine.
> >>>>>
> >>>>> Try searching a TermQuery with these affected terms and see if it
> >>>>> succeeds?  If so, maybe trying making an index with one or two of
> >>>>> them, alone, and see if that index shows the problem?
> >>>>>
> >>>>> OK I'm attaching more mods.  Can you re-run your CheckIndex?  It will
> >>>>> produce an enormous amount of output, but if you can excise the few
> >>>>> lines around when that warning comes out & post back that'd be great.
> >>>>>
> >>>>> Mike
> >>>>>
> >>>>> On Wed, Oct 28, 2009 at 12:23 PM, Peter Keegan <
> peterlkeegan@gmail.com
> >>>>>
> >>>>> wrote:
> >>>>>
> >>>>>
> >>>>>> Just to be safe, I ran with the official jar file from one of the
> >>>>>>
> >>>>>>
> >>>>> mirrors
> >>>>>
> >>>>>
> >>>>>> and reproduced the problem.
> >>>>>> The debug session is not showing any characters = '\uffff' (checking
> >>>>>>
> >>>>>>
> >>>>> this in
> >>>>>
> >>>>>
> >>>>>> Tokenizer).
> >>>>>> The output from the modified CheckIndex follows. There are only a
> few
> >>>>>>
> >>>>>>
> >>>>> terms
> >>>>>
> >>>>>
> >>>>>> with the inconsistency. They are all legitimate terms from the app's
> >>>>>> context. With this info, I might be able to isolate the source
> >>>>>>
> >>>>>>
> >>>>> documents.
> >>>>>
> >>>>>
> >>>>>> What should I be looking for when they are indexed?
> >>>>>>
> >>>>>> CheckInput output:
> >>>>>>
> >>>>>> Opening index @
> >>>>>>
> >>>>>>
> >>>>> D:\mnsavs\lresumes1\lresumes1.luc\lresumes1.search.main.4
> >>>>>
> >>>>>
> >>>>>> Segments file=segments_2 numSegments=3 version=FORMAT_DIAGNOSTICS
> >>>>>>
> >>>>>>
> >>>>> [Lucene
> >>>>>
> >>>>>
> >>>>>> 2.9]
> >>>>>>  1 of 3: name=_0 docCount=413585
> >>>>>>    compound=false
> >>>>>>    hasProx=true
> >>>>>>    numFiles=8
> >>>>>>    size (MB)=1,148.817
> >>>>>>    diagnostics = {os.version=5.2, os=Windows 2003,
> >>>>>>
> >> lucene.version=2.9.0
> >>
> >>>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> >>>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >>>>>>    docStoreOffset=0
> >>>>>>    docStoreSegment=_0
> >>>>>>    docStoreIsCompoundFile=false
> >>>>>>    no deletions
> >>>>>>    test: open reader.........OK
> >>>>>>    test: fields..............OK [33 fields]
> >>>>>>    test: field norms.........OK [33 fields]
> >>>>>>    test: terms, freq, prox...OK [7704753 terms; 180326717 terms/docs
> >>>>>>
> >>>>>>
> >>>>> pairs;
> >>>>>
> >>>>>
> >>>>>> 340244234 tokens]
> >>>>>>    test: stored fields.......OK [1240755 total field count; avg 3
> >>>>>>
> >> fields
> >>
> >>>>>> per doc]
> >>>>>>    test: term vectors........OK [0 total vector count; avg 0
> term/freq
> >>>>>> vector fields per doc]
> >>>>>>
> >>>>>>  2 of 3: name=_1 docCount=359068
> >>>>>>    compound=false
> >>>>>>    hasProx=true
> >>>>>>    numFiles=8
> >>>>>>    size (MB)=1,125.161
> >>>>>>    diagnostics = {os.version=5.2, os=Windows 2003,
> >>>>>>
> >> lucene.version=2.9.0
> >>
> >>>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> >>>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >>>>>>    docStoreOffset=413585
> >>>>>>    docStoreSegment=_0
> >>>>>>    docStoreIsCompoundFile=false
> >>>>>>    no deletions
> >>>>>>    test: open reader.........OK
> >>>>>>    test: fields..............OK [33 fields]
> >>>>>>    test: field norms.........OK [33 fields]
> >>>>>>    test: terms, freq, prox...WARNING: term  literals:cfid196$
> >>>>>>
> >> docFreq=43
> >>
> >>>>> !=
> >>>>>
> >>>>>
> >>>>>> num docs seen 4 + num docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
> >>>>>>
> >> docs
> >>
> >>>>>> deleted 0
> >>>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
> >>>>>>
> >> docs
> >>
> >>>>>> deleted 0
> >>>>>> WARNING: term  literals:cfid196$commandant docFreq=1 != num docs
> seen
> >>>>>>
> >> 9
> >>
> >>>>> +
> >>>>>
> >>>>>
> >>>>>> num docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$on docFreq=3178 != num docs seen 1 +
> >>>>>>
> >> num
> >>
> >>>>>> docs deleted 0
> >>>>>> OK [7137621 terms; 179101847 terms/docs pairs; 346076058 tokens]
> >>>>>>    test: stored fields.......OK [1077204 total field count; avg 3
> >>>>>>
> >> fields
> >>
> >>>>>> per doc]
> >>>>>>    test: term vectors........OK [0 total vector count; avg 0
> term/freq
> >>>>>> vector fields per doc]
> >>>>>>
> >>>>>>  3 of 3: name=_2 docCount=304849
> >>>>>>    compound=false
> >>>>>>    hasProx=true
> >>>>>>    numFiles=8
> >>>>>>    size (MB)=962.004
> >>>>>>    diagnostics = {os.version=5.2, os=Windows 2003,
> >>>>>>
> >> lucene.version=2.9.0
> >>
> >>>>>> 817268P - 2009-09-21 10:25:09, source=flush, os.arch=amd64,
> >>>>>> java.version=1.6.0_16, java.vendor=Sun Microsystems Inc.}
> >>>>>>    docStoreOffset=772653
> >>>>>>    docStoreSegment=_0
> >>>>>>    docStoreIsCompoundFile=false
> >>>>>>    no deletions
> >>>>>>    test: open reader.........OK
> >>>>>>    test: fields..............OK [33 fields]
> >>>>>>    test: field norms.........OK [33 fields]
> >>>>>>    test: terms, freq, prox...WARNING: term  contents:? docFreq=1 !=
> >>>>>>
> >> num
> >>
> >>>>>> docs seen 246 + num docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$ docFreq=45 != num docs seen 4 + num
> >>>>>>
> >>>>>>
> >>>>> docs
> >>>>>
> >>>>>
> >>>>>> deleted 0
> >>>>>> WARNING: term  literals:cfid196$ docFreq=1 != num docs seen 4 + num
> >>>>>>
> >> docs
> >>
> >>>>>> deleted 0
> >>>>>> WARNING: term  literals:cfid196$cashier docFreq=1 != num docs seen
> 37
> >>>>>>
> >> +
> >>
> >>>>> num
> >>>>>
> >>>>>
> >>>>>> docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$interrogation docFreq=181 != num
> docs
> >>>>>>
> >>>>>>
> >>>>> seen 1
> >>>>>
> >>>>>
> >>>>>> + num docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$leader docFreq=1 != num docs seen
> 353
> >>>>>>
> >> +
> >>
> >>>>> num
> >>>>>
> >>>>>
> >>>>>> docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$microsoft docFreq=3114 != num docs
> >>>>>>
> >> seen
> >>
> >>>>> 1 +
> >>>>>
> >>>>>
> >>>>>> num docs deleted 0
> >>>>>> WARNING: term  literals:cfid196$nt docFreq=200 != num docs seen 1 +
> >>>>>>
> >> num
> >>
> >>>>> docs
> >>>>>
> >>>>>
> >>>>>> deleted 0
> >>>>>> OK [6497769 terms; 145296880 terms/docs pairs; 293458734 tokens]
> >>>>>>    test: stored fields.......OK [914547 total field count; avg 3
> >>>>>>
> >> fields
> >>
> >>>>> per
> >>>>>
> >>>>>
> >>>>>> doc]
> >>>>>>    test: term vectors........OK [0 total vector count; avg 0
> term/freq
> >>>>>> vector fields per doc]
> >>>>>>
> >>>>>> No problems were detected with this index.
> >>>>>>
> >>>>>> Peter
> >>>>>>
> >>>>>>
> >>>>>> On Wed, Oct 28, 2009 at 11:29 AM, Michael McCandless <
> >>>>>> lucene@mikemccandless.com> wrote:
> >>>>>>
> >>>>>>
> >>>>>>
> >>>>>>> On Wed, Oct 28, 2009 at 10:58 AM, Peter Keegan <
> >>>>>>>
> >> peterlkeegan@gmail.com
> >>
> >>>>>>> wrote:
> >>>>>>>
> >>>>>>>
> >>>>>>>> The only change I made to the source code was the patch for
> >>>>>>>>
> >>>>>>>>
> >>>>>>> PayloadNearQuery
> >>>>>>>
> >>>>>>>
> >>>>>>>> (LUCENE-1986).
> >>>>>>>>
> >>>>>>>>
> >>>>>>> That patch certainly shouldn't lead to this.
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>> It's possible that our content contains U+FFFF. I will run in
> >>>>>>>>
> >>>>>>>>
> >>>>> debugger
> >>>>>
> >>>>>
> >>>>>>> and
> >>>>>>>
> >>>>>>>
> >>>>>>>> see.
> >>>>>>>>
> >>>>>>>>
> >>>>>>> OK may as well check just so we cover all possibilities.
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>> The data is 'sensitive', so I may not be able to provide a bad
> >>>>>>>>
> >>>>>>>>
> >>>>> segment,
> >>>>>
> >>>>>
> >>>>>>>> unfortunately.
> >>>>>>>>
> >>>>>>>>
> >>>>>>> OK, maybe we can modify your CheckIndex instead.  Let's start with
> >>>>>>> this, which prints a warning whenever the docFreq differs but
> >>>>>>> otherwise continues (vs throwing RuntimeException).  I'm curious
> how
> >>>>>>> many terms show this, and whether the TermEnum keeps working after
> >>>>>>> this term that has different docFreq:
> >>>>>>>
> >>>>>>> Index: src/java/org/apache/lucene/index/CheckIndex.java
> >>>>>>> ===================================================================
> >>>>>>> --- src/java/org/apache/lucene/index/CheckIndex.java    (revision
> >>>>>>>
> >>>>>>>
> >>>>> 829889)
> >>>>>
> >>>>>
> >>>>>>> +++ src/java/org/apache/lucene/index/CheckIndex.java    (working
> >>>>>>>
> >> copy)
> >>
> >>>>>>> @@ -672,8 +672,8 @@
> >>>>>>>         }
> >>>>>>>
> >>>>>>>         if (freq0 + delCount != docFreq) {
> >>>>>>> -          throw new RuntimeException("term " + term + " docFreq="
> +
> >>>>>>> -                                     docFreq + " != num docs seen
> "
> >>>>>>>
> >> +
> >>
> >>>>>>> freq0 + " + num docs deleted " + delCount);
> >>>>>>> +          System.out.println("WARNING: term  " + term + "
> docFreq="
> >>>>>>>
> >> +
> >>
> >>>>>>> +                             docFreq + " != num docs seen " +
> freq0
> >>>>>>>
> >> +
> >>
> >>>>>>> " + num docs deleted " + delCount);
> >>>>>>>         }
> >>>>>>>       }
> >>>>>>>
> >>>>>>> Mike
> >>>>>>>
> >>>>>>>
> ---------------------------------------------------------------------
> >>>>>>> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >>>>>>> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>>>>>
> >>>
> >> --
> >> - Mark
> >>
> >> http://www.lucidimagination.com
> >>
> >>
> >>
> >>
> >> ---------------------------------------------------------------------
> >> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> >> For additional commands, e-mail: java-user-help@lucene.apache.org
> >>
> >>
> >>
> >
> >
>
>
> --
> - Mark
>
> http://www.lucidimagination.com
>
>
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--00504502cc2592f4d604771cc2d9--

From java-user-return-43126-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 04:17:48 2009
Return-Path: <java-user-return-43126-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 30284 invoked from network); 30 Oct 2009 04:17:48 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 04:17:48 -0000
Received: (qmail 66946 invoked by uid 500); 30 Oct 2009 04:17:46 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 66820 invoked by uid 500); 30 Oct 2009 04:17:46 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 66810 invoked by uid 99); 30 Oct 2009 04:17:46 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 04:17:46 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of lists@nabble.com designates 216.139.236.158 as permitted sender)
Received: from [216.139.236.158] (HELO kuber.nabble.com) (216.139.236.158)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 04:17:43 +0000
Received: from isper.nabble.com ([192.168.236.156])
	by kuber.nabble.com with esmtp (Exim 4.63)
	(envelope-from <lists@nabble.com>)
	id 1N3ivS-0005RL-OL
	for java-user@lucene.apache.org; Thu, 29 Oct 2009 21:17:22 -0700
Message-ID: <26124737.post@talk.nabble.com>
Date: Thu, 29 Oct 2009 21:17:22 -0700 (PDT)
From: "m.harig" <m.harig@gmail.com>
To: java-user@lucene.apache.org
Subject: Re: search problem
In-Reply-To: <359a92830910290728g17c25ad1oe8afc128e7836de@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Nabble-From: m.harig@gmail.com
References: <26111084.post@talk.nabble.com> <359a92830910290728g17c25ad1oe8afc128e7836de@mail.gmail.com>


Thanks Erick ,

   i understand the issue , but my doubt is when you search for a keyword
which is originally a single word, for example , metacity is really single
keyword . when i search for meta city am not able to get the results , this
is what my doubt , 

 if you goto google and search for meta city , it'll give you the results
for metacity , how do i solve this issue ? is there any concepts behind
indexing ?? please anyone let me know
-- 
View this message in context: http://old.nabble.com/search-problem-tp26111084p26124737.html
Sent from the Lucene - Java Users mailing list archive at Nabble.com.


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43127-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 06:13:57 2009
Return-Path: <java-user-return-43127-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51441 invoked from network); 30 Oct 2009 06:13:57 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 06:13:57 -0000
Received: (qmail 41875 invoked by uid 500); 30 Oct 2009 06:13:55 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 41807 invoked by uid 500); 30 Oct 2009 06:13:55 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 41793 invoked by uid 99); 30 Oct 2009 06:13:54 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:13:54 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [203.104.17.187] (HELO web94814.mail.in2.yahoo.com) (203.104.17.187)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Oct 2009 06:13:45 +0000
Received: (qmail 73848 invoked by uid 60001); 30 Oct 2009 06:13:23 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256883203; bh=plswpSeK777kDiLp3Bj52UCsLi8GS7Ns4o2hWneMKxE=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=PNUj0uVU0A0nLRSETL5UraH3aY139tCyV8enCKd+UnwkgX7s9/jp2+E21BDewFyimTZcVc2K9jB9b+6NZbU7QF85FOQpdEx+5jr9BjJSioqsBvUER/FrZbGiyggMX6Jc5HAq3lRp4lzBgei0N9M1EVEBR8HweQnkFo5IipquGgs=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=VRpdRBpYV3J1pLD5zOZFVELASpG0bHK2NSwQVfvt4XUEJcQI3GUjeWqQGr4U0UH9q/IsskKH+zaG8Q6N9cs2jjBhKfVzkckiamfXbHqyGdIa99HldZTdWNCJ7dMyOCSD/nNuDxZCTY8+MiQlGEyun2/OGRWM6oOeSmOIkKVustg=;
Message-ID: <365345.67092.qm@web94814.mail.in2.yahoo.com>
X-YMail-OSG: lOwq_MoVM1n8U4367vmXZ5NzGUENZh5VgjmZOxiDbloOwAL3Q5gju7zzzA92pd5LTGkdjZ74WbbAbTcPVfDeszllytKGb5q9OzvklEq6bnirHi1fe2XNFpx2TmgIyibNEWw915Uxg4qBDl7nuKzSX9ZLoHgkEL336iDkJ3W8SY68X8OHjSA0Cpp1T1CQk0pGz8Otrmv9tnFZ2e4PwIOywkCKc52OkN2JePWLW003rrYKLGDdkaV4zgY2rzK4GwKo
Received: from [59.90.244.83] by web94814.mail.in2.yahoo.com via HTTP; Fri, 30 Oct 2009 11:43:23 IST
X-Mailer: YahooMailClassic/8.1.6 YahooMailWebService/0.7.361.4
Date: Fri, 30 Oct 2009 11:43:23 +0530 (IST)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: What is multiple indexing and how does it work in Lucene [Java]
To: java-user@lucene.apache.org
In-Reply-To: <359a92830910280624k61b900a7nb23a37fa014bace1@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1287372945-1256883203=:67092"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-1287372945-1256883203=:67092
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

The question is indeed wrong. Sry for the inconvenience. Actually i should =
have asked this way!
=A0
Am trying out executing the demo of lucene 1.4.3.
When i=A0run a file for the first time, the index is properly getting creat=
ed.
When i=A0run the indexing for the second time with=A0a different=A0file, th=
e file "_1" , a CFS file in the index folder is getting overwritten, i.e. i=
 couldnt find the index created for the previous file i used.
=A0
So kindly let me know about the cause of this problem and=A0a solution too.
=A0
I would also be happy if anyone let me know from which version the index wi=
ll be appended.
=A0
Thanks in advance.
M.Dhivya=0A=0A=0A      From cricket scores to your friends. Try the Yahoo! =
India Homepage! http://in.yahoo.com/trynew
--0-1287372945-1256883203=:67092--

From java-user-return-43128-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 06:17:22 2009
Return-Path: <java-user-return-43128-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 52584 invoked from network); 30 Oct 2009 06:17:22 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 06:17:22 -0000
Received: (qmail 45636 invoked by uid 500); 30 Oct 2009 06:17:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 45556 invoked by uid 500); 30 Oct 2009 06:17:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 45546 invoked by uid 99); 30 Oct 2009 06:17:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:17:20 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of vithya388@gmail.com designates 74.125.78.26 as permitted sender)
Received: from [74.125.78.26] (HELO ey-out-2122.google.com) (74.125.78.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:17:17 +0000
Received: by ey-out-2122.google.com with SMTP id 22so620339eye.3
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 23:16:56 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:date:message-id:subject
         :from:to:content-type;
        bh=fPFs7XuzbNWJFTKdKLPbxPwcIG3+i3SpVTD7GdXZ/sI=;
        b=ctkCmOzF/dPRD+60QKS/tl1oyl6u4VJImzcH5pGsFr3O1cy4oj2BQQiTesgXwGsxVx
         qW/ophf6gjnxddUvKJTbZ86Zn11JNiHSFgOFznFU1wUsS66Roj4UJJh2/1h2+UMIKxVh
         cRdSeIt7o5zi80I8vpX9NfoecwD7WVb0ciaGg=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:date:message-id:subject:from:to:content-type;
        b=bHaHprXzNXlAhvmNhEghVWBNxCpVijd7DkW45RMXHdYHbuJQanW+NoH5TvM/S1lHUW
         TIMCOi2ppt6Y8//TINStQq4D5hXI+vY6ZWcoFteVzVLndTFgDpOE7lmGkHkJZQobJNxS
         le5/tjHURy9i4nEB49zRaa4O0AT0HHii4rJh4=
MIME-Version: 1.0
Received: by 10.216.88.65 with SMTP id z43mr432151wee.5.1256883415265; Thu, 29 
	Oct 2009 23:16:55 -0700 (PDT)
Date: Thu, 29 Oct 2009 23:16:55 -0700
Message-ID: <288c67550910292316i7443c0c5qeb2d59fad85bcf60@mail.gmail.com>
Subject: clucene user
From: Vithya Arumugasami <vithya388@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6d9a3177db1b0047720f924

--0016e6d9a3177db1b0047720f924
Content-Type: text/plain; charset=ISO-8859-1

Hi,

Am working with clucene.Kindly tell the forum to find my solution

Thanks
Vithya

--0016e6d9a3177db1b0047720f924--

From java-user-return-43129-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 06:24:18 2009
Return-Path: <java-user-return-43129-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 53694 invoked from network); 30 Oct 2009 06:24:18 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 06:24:18 -0000
Received: (qmail 49659 invoked by uid 500); 30 Oct 2009 06:24:15 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 49586 invoked by uid 500); 30 Oct 2009 06:24:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 49576 invoked by uid 99); 30 Oct 2009 06:24:15 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:24:15 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:24:13 +0000
Received: by pzk3 with SMTP id 3so1645693pzk.20
        for <java-user@lucene.apache.org>; Thu, 29 Oct 2009 23:23:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=8Nh2SUgBc91wEpsNk1Rzx/T7j5/2ISkdj7nmS4Na60w=;
        b=MiUqcqdKEDUBjpt9Cg+GquoIHcuN6RazofBrxiJLFAFVKFfdwGcfZVbBorPeI/aPke
         dzBExQkjZSJ6DG1QxKGud1/eIVY2/HDu2u2Y45O/JKbAuwDJR7K4XHDU7N0J8xGOrDvb
         vSGFyuSynWjgsTeBTm2aJRhqIeDcUtOOof8XI=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=nmIJ7doFzJ2MT75eYk0eaY9MsmtBkxsR2CBX5u1duMG5DebzaEI6lGRPDC4whvoXlz
         YyFkZU9dQeogVABQe0MDiY/k2AIzr/F4WZV+TP3YPG3rlEdfIfvWQ0cobGIyeE2bzA0i
         58A+sv67wrTe2+iCYNTgvjMOuMPErTrzlIqu4=
MIME-Version: 1.0
Received: by 10.114.44.10 with SMTP id r10mr950193war.77.1256883833098; Thu, 
	29 Oct 2009 23:23:53 -0700 (PDT)
In-Reply-To: <365345.67092.qm@web94814.mail.in2.yahoo.com>
References: <359a92830910280624k61b900a7nb23a37fa014bace1@mail.gmail.com> 
	<365345.67092.qm@web94814.mail.in2.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Fri, 30 Oct 2009 11:53:33 +0530
Message-ID: <867513fe0910292323h1d9e1381qc22e8161083be15d@mail.gmail.com>
Subject: Re: What is multiple indexing and how does it work in Lucene [Java]
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=00504502e18b6553a9047721121f

--00504502e18b6553a9047721121f
Content-Type: text/plain; charset=ISO-8859-1

In case you are trying to say that in subsequent runs, the previous state of
the index just goes off, its because the indexwriter gets opened with
'create new' flag as true. In other words, the index would be newly created
overwriting any existing index at the directory location.
The solution to this would be to open the indexwriter with the createnew
flag as false.
*public IndexWriter(String path,*
*                   Analyzer a,*
*                   boolean create)*
*            throws IOException*
This should solve your problem.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Oct 30, 2009 at 11:43 AM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> The question is indeed wrong. Sry for the inconvenience. Actually i should
> have asked this way!
>
> Am trying out executing the demo of lucene 1.4.3.
> When i run a file for the first time, the index is properly getting
> created.
> When i run the indexing for the second time with a different file, the file
> "_1" , a CFS file in the index folder is getting overwritten, i.e. i couldnt
> find the index created for the previous file i used.
>
> So kindly let me know about the cause of this problem and a solution too.
>
> I would also be happy if anyone let me know from which version the index
> will be appended.
>
> Thanks in advance.
> M.Dhivya
>
>
>      From cricket scores to your friends. Try the Yahoo! India Homepage!
> http://in.yahoo.com/trynew

--00504502e18b6553a9047721121f--

From java-user-return-43130-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 06:28:33 2009
Return-Path: <java-user-return-43130-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 54290 invoked from network); 30 Oct 2009 06:28:33 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 06:28:33 -0000
Received: (qmail 52985 invoked by uid 500); 30 Oct 2009 06:28:31 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 52897 invoked by uid 500); 30 Oct 2009 06:28:30 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 52887 invoked by uid 99); 30 Oct 2009 06:28:30 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:28:30 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [203.104.17.159] (HELO web94807.mail.in2.yahoo.com) (203.104.17.159)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Oct 2009 06:28:21 +0000
Received: (qmail 51608 invoked by uid 60001); 30 Oct 2009 06:27:58 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256884078; bh=RROeHICOl3H188wCRRoLSQon7NAve6C2tEXOhYIBn3M=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=HcWuleztJynET5qi6tAUHDGdBsEp7Q7lZppqti7/L6lqHraZb2g5HcIe09uAHim9rk519/1xLgwxL4u47g4vs0dAgd2aRx0AcG+C4sGGSxSz+N/xZY64QGc8jlkN6EFdHuWUnP8NQdKxrFr/QSMEjx9MSrwgcEEUW/e0NLaDNdE=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=18ZC4vNFg+cq3YehHGX5GeuNcqJG1iR7Fj9znY+qutxE6mGn8OuuizG+jB8/mBvBg/WkQTQJeE5bBWRMRxLOrk/T35PdYb1DSNv0ldlUeTN9iyVd83tS4T0s19jwF5KByIqatT8ZqFCuEvrvPf1lkWOE175sJhQXkODfVQhnyk4=;
Message-ID: <902479.51158.qm@web94807.mail.in2.yahoo.com>
X-YMail-OSG: U.RaeTUVM1mcxTlq2VK4dyd4KsS76UCaWcADfO7T2Dqj47wCbwWtqjPk18SdDCL1G280t1yNC..cYKXrtJSxGwf4UyK21_H0OT1HtKZgM4KzQPFZceKtBrez1fn0iZFVOgolYyCKBUjptky1bFb9RQi15JhPwZJMnkH8M5.E70i5P8MNmDvXRpWQif2JrMukRFtVQg_lGrjVlUInzLxFBy7dK_2naP8MTXJejqWKORDs3Ko6_g--
Received: from [59.90.244.83] by web94807.mail.in2.yahoo.com via HTTP; Fri, 30 Oct 2009 11:57:58 IST
X-Mailer: YahooMailClassic/8.1.6 YahooMailWebService/0.7.361.4
Date: Fri, 30 Oct 2009 11:57:58 +0530 (IST)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: soln found for overwritten problem
To: java-user@lucene.apache.org
In-Reply-To: <867513fe0910292323h1d9e1381qc22e8161083be15d@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-303210507-1256884078=:51158"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-303210507-1256884078=:51158
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Let me try out and get back to you sir
=A0
Thanks
M.Dhivya

--- On Fri, 30/10/09, Anshum <anshumg@gmail.com> wrote:


From: Anshum <anshumg@gmail.com>
Subject: Re: What is multiple indexing and how does it work in Lucene [Java=
]
To: java-user@lucene.apache.org
Date: Friday, 30 October, 2009, 6:23 AM


In case you are trying to say that in subsequent runs, the previous state o=
f
the index just goes off, its because the indexwriter gets opened with
'create new' flag as true. In other words, the index would be newly created
overwriting any existing index at the directory location.
The solution to this would be to open the indexwriter with the createnew
flag as false.
*public IndexWriter(String path,*
*=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0=A0=A0Analyzer a,*
*=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0=A0=A0boolean create)*
*=A0 =A0 =A0 =A0 =A0 =A0 throws IOException*
This should solve your problem.

--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Oct 30, 2009 at 11:43 AM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrot=
e:

> The question is indeed wrong. Sry for the inconvenience. Actually i shoul=
d
> have asked this way!
>
> Am trying out executing the demo of lucene 1.4.3.
> When i run a file for the first time, the index is properly getting
> created.
> When i run the indexing for the second time with a different file, the fi=
le
> "_1" , a CFS file in the index folder is getting overwritten, i.e. i coul=
dnt
> find the index created for the previous file i used.
>
> So kindly let me know about the cause of this problem and a solution too.
>
> I would also be happy if anyone let me know from which version the index
> will be appended.
>
> Thanks in advance.
> M.Dhivya
>
>
>=A0 =A0 =A0 From cricket scores to your friends. Try the Yahoo! India Home=
page!
> http://in.yahoo.com/trynew
=0A=0A=0A      From cricket scores to your friends. Try the Yahoo! India Ho=
mepage! http://in.yahoo.com/trynew
--0-303210507-1256884078=:51158--

From java-user-return-43131-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 06:50:34 2009
Return-Path: <java-user-return-43131-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 64650 invoked from network); 30 Oct 2009 06:50:34 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 06:50:34 -0000
Received: (qmail 69789 invoked by uid 500); 30 Oct 2009 06:50:32 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 69733 invoked by uid 500); 30 Oct 2009 06:50:32 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 69723 invoked by uid 99); 30 Oct 2009 06:50:32 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 06:50:32 +0000
X-ASF-Spam-Status: No, hits=-2.2 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [203.104.17.167] (HELO web94809.mail.in2.yahoo.com) (203.104.17.167)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Oct 2009 06:50:29 +0000
Received: (qmail 7855 invoked by uid 60001); 30 Oct 2009 06:50:06 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256885405; bh=ZzpPg4o6FcAur3plCk3lK0siq5dcR7O4Lufgk8DgoQM=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=TK3PkGVY1eAPFbwIbFTrdXhPV60ITvaaPf53/Gb+nucBM3dTujXX6enAevB/EOJ5B6htjsl0Mb2X5PlV0GiOK5bU0pmNGqXQNuFmEfsCekp1Z7DscY0evGq+XEf2+I524IXkGpqahQYBVlMCwURqb2BXNKtqQmIhLi+SonMApjg=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=N9tX9APAXbLWZmlpNzKY7xWbSZ9jiyXzZpY/L9MF+uan+ifsWWQ0cRyAj3ug6Alv8faStwNRszWO9pZvhZJ4VxPwgyUJTy5ikFOD7oW7BEUxBXf2SxW0NcReiUj7nOBMiWoi1DYHOaRDdG/HdpShTn7b+QJXL7UZ5/DsT2WYUsw=;
Message-ID: <944134.7401.qm@web94809.mail.in2.yahoo.com>
X-YMail-OSG: F3fhBPQVM1kKOmk30Gs8fe6qPZ7Rz1gk1iMV8Tv598gWZuiEksZvPEQD990JtYiKbmvKVyEhGhhfi15SGrJEu8q3woyRGVEkiM8wEBsJhTKN_QpgGOKwt1Ijf2G2Sr4azVqhmnWWNGOlrBXtzEiqeDfw9RSUAnXqN3dCdkN0JUj9Xqao5tjpmIs5glfwL46ub_o0GL_pL2szVEEtYBQo2kL8Q267Zz6M1C7JB6ut38N.LeifUn6qFmEyMZGVz4ko
Received: from [59.90.244.83] by web94809.mail.in2.yahoo.com via HTTP; Fri, 30 Oct 2009 12:20:05 IST
X-Mailer: YahooMailClassic/8.1.6 YahooMailWebService/0.7.361.4
Date: Fri, 30 Oct 2009 12:20:05 +0530 (IST)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Re: soln found for index overwritting problem
To: java-user@lucene.apache.org
In-Reply-To: <902479.51158.qm@web94807.mail.in2.yahoo.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1356276039-1256885405=:7401"

--0-1356276039-1256885405=:7401
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Thanks a lot sir. Its working out well.
=A0
But i have one more doubt.
Is it=A0possible to check whether the same documents are indexed again and =
again?
bcos due to appending of indexes,
when i search a query,
the result is displayed=A0as much number of times as=A0the index is created=
 for that document.

how to solve this sir
=A0
Is it possible to remove duplicates with a flag in indexwriter?
=A0
Kindly let me know about this.
=A0
Thanks in advance
M.Dhivya=0A=0A=0A      Keep up with people you care about with Yahoo! India=
 Mail. Learn how. http://in.overview.mail.yahoo.com/connectmore
--0-1356276039-1256885405=:7401--

From java-user-return-43132-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 07:22:12 2009
Return-Path: <java-user-return-43132-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 69324 invoked from network); 30 Oct 2009 07:22:12 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 07:22:12 -0000
Received: (qmail 91777 invoked by uid 500); 30 Oct 2009 07:22:10 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 91698 invoked by uid 500); 30 Oct 2009 07:22:09 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 91650 invoked by uid 99); 30 Oct 2009 07:22:09 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 07:22:09 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of anshumg@gmail.com designates 209.85.160.46 as permitted sender)
Received: from [209.85.160.46] (HELO mail-pw0-f46.google.com) (209.85.160.46)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 07:22:07 +0000
Received: by pwi12 with SMTP id 12so561495pwi.5
        for <java-user@lucene.apache.org>; Fri, 30 Oct 2009 00:21:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=+K3tNh4Q7aIY/FICFWXONgf+otpejJpnNNGacdfJpn0=;
        b=cpm/tagDqBR44OE2MY3fV3l0A5SMFb6cPrIr6WSZ2p+JphEioFlzHVVBKgqi0Fc2Oy
         9lpoksogl5/ABbBQXm/r4is/V8Jvia30Ag/2BexaVkLCDZDQajOgd438zXQj4xUN4tgy
         b+xS1/sG+kKdFZ1Y9uKsz0V5HpQxUFEcksarc=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=DwcwyCz66Pd1itD7kOz7n64AHLbwIk/c1/SR9lzYRzUJlDX9MxzIbL4xz9XCrjw8yV
         EIG7LAzJqT26NEZS8+UFbM1XpvMsUJsy2QOLOMGNiHW/Jx1im0qD6UfFGIH8zGT09Ap/
         wj+Oi5iIEPalLtLfYHvzwDsAgf/oD+0P8fCC4=
MIME-Version: 1.0
Received: by 10.114.55.40 with SMTP id d40mr965520waa.169.1256887307259; Fri, 
	30 Oct 2009 00:21:47 -0700 (PDT)
In-Reply-To: <944134.7401.qm@web94809.mail.in2.yahoo.com>
References: <902479.51158.qm@web94807.mail.in2.yahoo.com> <944134.7401.qm@web94809.mail.in2.yahoo.com>
From: Anshum <anshumg@gmail.com>
Date: Fri, 30 Oct 2009 12:51:27 +0530
Message-ID: <867513fe0910300021k5f9766e1nf97f7e2bae5e1489@mail.gmail.com>
Subject: Re: soln found for index overwritting problem
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=001636b2ad2678cec2047721e188

--001636b2ad2678cec2047721e188
Content-Type: text/plain; charset=ISO-8859-1

The only way to do it is to index a field (self maintained primary key) with
each document and do a deleteDocument (or updateDocument) for each document
before adding it.
Something like
*writer.deleteDocument(new Term("term-key","unique-id"));*
*writer.addDocument(d);*
This should help.
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Oct 30, 2009 at 12:20 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrote:

> Thanks a lot sir. Its working out well.
>
> But i have one more doubt.
> Is it possible to check whether the same documents are indexed again and
> again?
> bcos due to appending of indexes,
> when i search a query,
> the result is displayed as much number of times as the index is created for
> that document.
>
> how to solve this sir
>
> Is it possible to remove duplicates with a flag in indexwriter?
>
> Kindly let me know about this.
>
> Thanks in advance
> M.Dhivya
>
>
>      Keep up with people you care about with Yahoo! India Mail. Learn how.
> http://in.overview.mail.yahoo.com/connectmore

--001636b2ad2678cec2047721e188--

From java-user-return-43133-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 09:48:07 2009
Return-Path: <java-user-return-43133-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95536 invoked from network); 30 Oct 2009 09:48:07 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 09:48:07 -0000
Received: (qmail 7927 invoked by uid 500); 30 Oct 2009 09:48:05 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 7832 invoked by uid 500); 30 Oct 2009 09:48:04 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 7822 invoked by uid 99); 30 Oct 2009 09:48:04 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 09:48:04 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [82.132.130.151] (HELO mail.o2.co.uk) (82.132.130.151)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 09:48:02 +0000
Received: from [192.168.60.56] (188.220.58.136) by mail.o2.co.uk (8.0.013.3) (authenticated as joelhalbert)
        id 4AE6CD0F00F560D4 for java-user@lucene.apache.org; Fri, 30 Oct 2009 09:47:33 +0000
Subject: scoring adjacent terms without proximity search
From: Joel Halbert <joel@su3analytics.com>
To: Lucene Users <java-user@lucene.apache.org>
Content-Type: text/plain
Organization: SU3 Analytics
Date: Fri, 30 Oct 2009 09:49:01 +0000
Message-Id: <1256896141.9081.4.camel@bohr>
Mime-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit

Hi,

Without using a proximity search i.e. "cheese sandwich"~5

What's the best way of up-scoring results in which the search terms are
closer to each other? 

E.g. so if I search for:
content:cheese  content:sandwich

How do you ensure that a document with content:
"Toasted Cheese Sandwich"
scores higher then:
"Cheese and Potato, Tuna sandwich"

Joel


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43134-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 10:31:59 2009
Return-Path: <java-user-return-43134-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 4716 invoked from network); 30 Oct 2009 10:31:59 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 10:31:59 -0000
Received: (qmail 59314 invoked by uid 500); 30 Oct 2009 10:31:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 59246 invoked by uid 500); 30 Oct 2009 10:31:56 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 59236 invoked by uid 99); 30 Oct 2009 10:31:56 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 10:31:56 +0000
X-ASF-Spam-Status: No, hits=0.0 required=5.0
	tests=BAYES_50
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [202.86.5.94] (HELO smtp107.mail.in.yahoo.com) (202.86.5.94)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Oct 2009 10:31:53 +0000
Received: (qmail 15035 invoked from network); 30 Oct 2009 10:31:31 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.in;
  h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE;
  b=TdLrIyWkzW0SskW1PksPFc3Hn4JXyiV1QENfpVbz5IY9XOFOSGAI/3Au5NYtAxP56Z7FKje6FBV05cGSb55k8Oeqv7UbSrM8aXfJfudgWrefI7CFY2crzBavypzACRL9RnB2mDLfSU7rcowaJ6F0IoOqNEyvA92t04SmgUO7t+U=  ;
Received: from  (emailgane@203.98.194.130 with login)
        by smtp107.mail.in.yahoo.com with SMTP; 30 Oct 2009 16:01:30 +0530 IST
X-Yahoo-SMTP: JObyHkuswBBrNSLZp.Ycd7Boqpr_GQ--
X-YMail-OSG: 9h2eE0cVM1moC7SGnf1Mkxvteojpq_BmKq.FcGj30TXR9zzerPik6wIKIBHyPx_VsPwPdxWXwx9tqX8BHSD5fhlrGwr2QvZvqw.zeORJBAXdZY8Ou9WAm1sn6ZTGQ0ve3Pb7A74_4_KBrrFCqrU3MNwgQOY4hlHwrdZMLObd2KoVdS7M5Q7.SVbOOS7OQecZC.2ioJIC7CIJyp9ux58hNp5pCwSnT9rnHG4DUJ6Sc_Xc
X-Yahoo-Newman-Property: ymail-3
Message-ID: <000b01ca594c$246b0360$710bc30a@sv.us.sonicwall.com>
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
Subject: UpdateDocument failed
Date: Fri, 30 Oct 2009 16:01:26 +0530
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.3138
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.3138

Hello all,

I am using Lucene 2.4.1. I am adding and updating the documents =
frequently. At constant interval, I am reopening the index and warming =
it. I am having multiple thread, all are sharing a single writer and =
reader. Commit and reopening the reader is done in separate thread at =
regular interval.

In one of production server, I could see the updates are getting failed =
for some records. When i copy the same data and run it in my end, =
updates are doing fine. In production system, Even If i do a reindex, =
sometimes all the updates are successful and sometimes not. Its highly =
unpredictable. All my documents have a unique id and using that updates =
are done.=20

I require some information what are the criteria to be taken care while =
doing UpdateDocument? Is there any limitation of not to update while =
doing commit?=20

Please update me as it is very urgent.=20

Regards
Ganesh


Send instant messages to your online friends http://in.messenger.yahoo.com 

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43135-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 10:52:19 2009
Return-Path: <java-user-return-43135-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 8643 invoked from network); 30 Oct 2009 10:52:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 10:52:19 -0000
Received: (qmail 73675 invoked by uid 500); 30 Oct 2009 10:52:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 73595 invoked by uid 500); 30 Oct 2009 10:52:17 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 73585 invoked by uid 99); 30 Oct 2009 10:52:17 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 10:52:17 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [203.104.17.175] (HELO web94811.mail.in2.yahoo.com) (203.104.17.175)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Oct 2009 10:52:07 +0000
Received: (qmail 93852 invoked by uid 60001); 30 Oct 2009 10:02:17 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256896937; bh=6B7kPA4CeV9YfXbk43LPCiRRWephCmTcKys9LIIEmrI=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type; b=CnIFZoTW+ANh7euEhFBAjaLn4pMCqKTQwXBj+1J3RjHhTPR1uHclAXK93rCToVK54uxozfaijOtw7qkzVi6YXl8M/0TtH36vthfvWoUTqdYiYQ0MTdSspGzpmz+ADCGlCc11FoCzI1j1IQBN7vY6L54On8hIUirFRo0MGRGnY8k=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:In-Reply-To:MIME-Version:Content-Type;
  b=tLF9tjfB7euIivVN7vFfQx9UPjQkUtrGSyEbcfBeGOhDeGt8GqksVjWAZT+REeW4umEHXoD5o3l71MWmtuURnhhVeBMVEhDTHgLSvcONpRqu26h2MReyRifqyGSnYjvV3M1R26yIK5ON1Y5qzHXzuUe3B85BvhXMCH04ak1l8u4=;
Message-ID: <449382.93445.qm@web94811.mail.in2.yahoo.com>
X-YMail-OSG: Snib114VM1kxVR8mmQdirCY78AmUvz6dsXV6oaoe4yExl8v3bz_tkloGQaV7Od8O4f1hA.y817i21p2NjxRR04gbGjEFlW1Bmo9C9TasVHJg_2Wi26aJYUriuSOlOj.0pJfN7QURJ6_dtEsLMHlCnUKpGD7t.Vhhr6VxOzJlFYJbegKOEZ8JMZv13GFlmAAFY9eaDHfIl3vtFBWNqMnG7USgFHgkmGsmH5Gw9gOk9tDCFlbwBQ--
Received: from [59.90.244.83] by web94811.mail.in2.yahoo.com via HTTP; Fri, 30 Oct 2009 15:32:17 IST
X-Mailer: YahooMailClassic/8.1.6 YahooMailWebService/0.7.361.4
Date: Fri, 30 Oct 2009 15:32:17 +0530 (IST)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Can anyone help me to implement highlighter in lucene 2.3.2
To: java-user@lucene.apache.org
In-Reply-To: <867513fe0910300021k5f9766e1nf97f7e2bae5e1489@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-354934340-1256896937=:93445"
X-Virus-Checked: Checked by ClamAV on apache.org

--0-354934340-1256896937=:93445
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi all,
=A0
Am using lucene 2.3.2
I would like to have the search result similar to that of the google respon=
se.
On my study i found that highlighter could do this. I found the highlighter=
 class available in the contrib folder of lucene 2.3.2 .zip.
=A0
But am blind about using it to get the desired response as that of google.
=A0
Kindly help me in this regard
=A0
Thanks in advance,
M.Dhivya


--- On Fri, 30/10/09, Anshum <anshumg@gmail.com> wrote:


From: Anshum <anshumg@gmail.com>
Subject: Re: soln found for index overwritting problem
To: java-user@lucene.apache.org
Date: Friday, 30 October, 2009, 7:21 AM


The only way to do it is to index a field (self maintained primary key) wit=
h
each document and do a deleteDocument (or updateDocument) for each document
before adding it.
Something like
*writer.deleteDocument(new Term("term-key","unique-id"));*
*writer.addDocument(d);*
This should help.
--
Anshum Gupta
Naukri Labs!
http://ai-cafe.blogspot.com

The facts expressed here belong to everybody, the opinions to me. The
distinction is yours to draw............


On Fri, Oct 30, 2009 at 12:20 PM, DHIVYA M <dhivyakrishnan87@yahoo.com>wrot=
e:

> Thanks a lot sir. Its working out well.
>
> But i have one more doubt.
> Is it possible to check whether the same documents are indexed again and
> again?
> bcos due to appending of indexes,
> when i search a query,
> the result is displayed as much number of times as the index is created f=
or
> that document.
>
> how to solve this sir
>
> Is it possible to remove duplicates with a flag in indexwriter?
>
> Kindly let me know about this.
>
> Thanks in advance
> M.Dhivya
>
>
>=A0 =A0 =A0 Keep up with people you care about with Yahoo! India Mail. Lea=
rn how.
> http://in.overview.mail.yahoo.com/connectmore
=0A=0A=0A      From cricket scores to your friends. Try the Yahoo! India Ho=
mepage! http://in.yahoo.com/trynew
--0-354934340-1256896937=:93445--

From java-user-return-43136-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 10:54:28 2009
Return-Path: <java-user-return-43136-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 9124 invoked from network); 30 Oct 2009 10:54:28 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 10:54:28 -0000
Received: (qmail 78630 invoked by uid 500); 30 Oct 2009 10:54:25 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 78557 invoked by uid 500); 30 Oct 2009 10:54:25 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 78547 invoked by uid 99); 30 Oct 2009 10:54:25 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 10:54:25 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of gopi.subramani@gmail.com designates 209.85.222.173 as permitted sender)
Received: from [209.85.222.173] (HELO mail-pz0-f173.google.com) (209.85.222.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 10:54:22 +0000
Received: by pzk3 with SMTP id 3so1741805pzk.20
        for <java-user@lucene.apache.org>; Fri, 30 Oct 2009 03:54:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=WLN+Sq+Z7V6ofDO3taZyc6eXnrta+6EP4J5kulkib0c=;
        b=hFkM6XzOMHLpn+Df62B46ZhnkkS9dpW0ZRBjxJ51vtmRS1WucaGGpzkzariTx4OYqu
         pLXV1ShQXWc8gw56jPN+zyLG4VBQDaNnUP/y5IYQzCvRukp5+ljUCdus1Bchsn7NpA3t
         n7A3eLwHshM/4S9hgg5YNewV9wUYtMAvIyQ7A=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=ctlvV+ZLlK/uhsJNyKLNJYY3D1zyYyZP1q4PcGrXs+RFF8aK74d9D9zs+c7730Xo/0
         OGykuaThKG0A3wxXSFLKcSNqw7UUe9FU9uwEeEIwwQ/1fmLjWuCX61A7YYMJ16GP1RIS
         wiHZweQlo6eS2sc6BNZbdPBBfB3kt9l43LNqQ=
MIME-Version: 1.0
Received: by 10.141.40.2 with SMTP id s2mr59457rvj.193.1256900042744; Fri, 30 
	Oct 2009 03:54:02 -0700 (PDT)
In-Reply-To: <c68e39170910271814o36d0c0e3ve184dc2c525777c2@mail.gmail.com>
References: <4AD81961.7090108@gmail.com>
	 <2D127F11DC79714E9B6A43AC9458147F2F8EFAE2@suex07-mbx-03.ad.syr.edu>
	 <4AD8BEC4.50905@gmail.com> <4AD8C04E.2020101@gmail.com>
	 <4AD8C131.1080901@gmail.com> <4AE777AD.7000000@gmail.com>
	 <4AE77C06.3080600@gmail.com> <4AE7994E.3080305@gmail.com>
	 <c68e39170910271814o36d0c0e3ve184dc2c525777c2@mail.gmail.com>
Date: Fri, 30 Oct 2009 16:24:02 +0530
Message-ID: <733777220910300354v6c245be9pbb5a70806f21dc7e@mail.gmail.com>
Subject: Re: Proposal for changing Lucene's backwards-compatibility policy
From: Gopikrishnan Subramani <gopi.subramani@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=000e0cd2c0a490e4ef047724d87b

--000e0cd2c0a490e4ef047724d87b
Content-Type: text/plain; charset=ISO-8859-1

My vote is for option A. It's generally implied that a major version brings
in major changes (api as well as others), while the minor is, well, minor.
Why should that be broken for lucene? It would become increasingly difficult
for the lucene user community to catch up if they skipped one or two minors,
if that rule is broken.

-Gopi
On Wed, Oct 28, 2009 at 6:44 AM, Yonik Seeley <yonik@lucidimagination.com>wrote:

> On Tue, Oct 27, 2009 at 9:07 PM, Luis Alves <lafadev@gmail.com> wrote:
> > But there needs to be some forced push for these shorter major release
> > cycles,
> > to allow for code clean cycles to also be sorter.
>
> Maybe... or maybe not.
> There's also value in a more stable API over a longer period of time.
> Different people will pick a different balance, and it's not as simple
> as declaring that we need to be able to remove older APIs faster.
>
> -Yonik
> http://www.lucidimagination.com
>
> ---------------------------------------------------------------------
>  To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>

--000e0cd2c0a490e4ef047724d87b--

From java-user-return-43137-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 15:29:23 2009
Return-Path: <java-user-return-43137-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 96007 invoked from network); 30 Oct 2009 15:29:23 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 15:29:23 -0000
Received: (qmail 56912 invoked by uid 500); 30 Oct 2009 15:29:20 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56837 invoked by uid 500); 30 Oct 2009 15:29:20 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56827 invoked by uid 99); 30 Oct 2009 15:29:20 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 15:29:20 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=AWL,BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [208.97.132.74] (HELO homiemail-a22.g.dreamhost.com) (208.97.132.74)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 15:29:17 +0000
Received: from [10.0.0.77] (adsl-065-013-152-164.sip.rdu.bellsouth.net [65.13.152.164])
	by homiemail-a22.g.dreamhost.com (Postfix) with ESMTPA id 303E81A8076
	for <java-user@lucene.apache.org>; Fri, 30 Oct 2009 08:28:57 -0700 (PDT)
Content-Type: text/plain; charset=us-ascii; format=flowed; delsp=yes
Mime-Version: 1.0 (Apple Message framework v1076)
Subject: Re: scoring adjacent terms without proximity search
From: Grant Ingersoll <gsingers@apache.org>
In-Reply-To: <1256896141.9081.4.camel@bohr>
Date: Fri, 30 Oct 2009 11:28:56 -0400
Content-Transfer-Encoding: 7bit
Message-Id: <C31FA1AF-5D36-4752-94ED-D51A3E3BF3DC@apache.org>
References: <1256896141.9081.4.camel@bohr>
To: java-user@lucene.apache.org
X-Mailer: Apple Mail (2.1076)


On Oct 30, 2009, at 5:49 AM, Joel Halbert wrote:

> Hi,
>
> Without using a proximity search i.e. "cheese sandwich"~5
>
> What's the best way of up-scoring results in which the search terms  
> are
> closer to each other?

I'm not aware of any query technique to score based on proximity that  
doesn't, itself, use proximity information.

I suppose you could precompute the proximity associations by indexing  
n-grams (in this case, called Lucene calls them shingles), such that  
there is a single token in your index containing cheese_sandwich  
(effectively)

BTW, what's your concern about using a Phrase Query?  What requirement  
do you have that would prevent that particular query?  Or is there  
something in the way it is implemented that doesn't work for your  
needs (assuming your example here is for discussion purposes)

>
> E.g. so if I search for:
> content:cheese  content:sandwich
>
> How do you ensure that a document with content:
> "Toasted Cheese Sandwich"
> scores higher then:
> "Cheese and Potato, Tuna sandwich"
>
> Joel
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>

--------------------------
Grant Ingersoll
http://www.lucidimagination.com/

Search the Lucene ecosystem (Lucene/Solr/Nutch/Mahout/Tika/Droids)  
using Solr/Lucene:
http://www.lucidimagination.com/search


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43138-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 17:43:50 2009
Return-Path: <java-user-return-43138-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 51422 invoked from network); 30 Oct 2009 17:43:50 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 17:43:50 -0000
Received: (qmail 85773 invoked by uid 500); 30 Oct 2009 17:43:47 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 85701 invoked by uid 500); 30 Oct 2009 17:43:47 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 85691 invoked by uid 99); 30 Oct 2009 17:43:47 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 17:43:47 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [202.86.5.90] (HELO smtp103.mail.in.yahoo.com) (202.86.5.90)
    by apache.org (qpsmtpd/0.29) with SMTP; Fri, 30 Oct 2009 17:43:36 +0000
Received: (qmail 1405 invoked from network); 30 Oct 2009 17:43:14 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.co.in;
  h=Received:X-Yahoo-SMTP:X-YMail-OSG:X-Yahoo-Newman-Property:Message-ID:From:To:References:Subject:Date:MIME-Version:Content-Type:Content-Transfer-Encoding:X-Priority:X-MSMail-Priority:X-Mailer:X-MimeOLE;
  b=SBJXuNv4e9Cq3wZ10IouRDBmkB6RE/JTQoeQGKwGHdJVWgbzrjIRKbm0KKz2r97xXIUUVbdJ/4DTCId2ufkulRVcHfGoS4c2Xv3nLHXa59RmEI6oU5kNorOZu+OtadwGUMnjZQeEYnlKn1N0NmHyDKjlAwnMoAUSLDE2PyoKlGc=  ;
Received: from  (emailgane@203.98.194.130 with login)
        by smtp103.mail.in.yahoo.com with SMTP; 30 Oct 2009 23:13:13 +0530 IST
X-Yahoo-SMTP: JObyHkuswBBrNSLZp.Ycd7Boqpr_GQ--
X-YMail-OSG: WA_Riw8VM1lD47.QvtT0JI5ps7d2vzkmpdvqzpaPj9KC6nSjguDpOd0ssL6xD4QPRsMEnudYAeA9S3tirlmkjiO3Q1otXOVvGPYrBJr0ugnMyAXzAthzce2S7fw1RzzNvEzlSpaLIrofglabacp_juY6Ubhs_p0jkswPIQasLWHHgNgElOHC4h.U.OFrubun0ZmupsrPpj6FzZ9xXF0XuOeGUZc3KP9gEAIkP8a509AGVg0dccWZL0RswrYQ2b1ISpE1tgOH6KJZUAc-
X-Yahoo-Newman-Property: ymail-3
Message-ID: <005301ca5988$74a16900$710bc30a@sv.us.sonicwall.com>
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
References: <000b01ca594c$246b0360$710bc30a@sv.us.sonicwall.com>
Subject: Re: UpdateDocument failed
Date: Fri, 30 Oct 2009 23:13:10 +0530
MIME-Version: 1.0
Content-Type: text/plain;
	charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Outlook Express 6.00.2900.3138
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.3138
X-Virus-Checked: Checked by ClamAV on apache.org

Any hint or lead on this issue. What else to be taken care?

----- Original Message -----=20
From: "Ganesh" <emailgane@yahoo.co.in>
To: <java-user@lucene.apache.org>
Sent: Friday, October 30, 2009 4:01 PM
Subject: UpdateDocument failed


Hello all,

I am using Lucene 2.4.1. I am adding and updating the documents =
frequently. At constant interval, I am reopening the index and warming =
it. I am having multiple thread, all are sharing a single writer and =
reader. Commit and reopening the reader is done in separate thread at =
regular interval.

In one of production server, I could see the updates are getting failed =
for some records. When i copy the same data and run it in my end, =
updates are doing fine. In production system, Even If i do a reindex, =
sometimes all the updates are successful and sometimes not. Its highly =
unpredictable. All my documents have a unique id and using that updates =
are done.=20

I require some information what are the criteria to be taken care while =
doing UpdateDocument? Is there any limitation of not to update while =
doing commit?=20

Please update me as it is very urgent.=20

Regards
Ganesh


Send instant messages to your online friends =
http://in.messenger.yahoo.com=20

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org

Send instant messages to your online friends http://in.messenger.yahoo.com 

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43139-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 19:32:55 2009
Return-Path: <java-user-return-43139-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 91050 invoked from network); 30 Oct 2009 19:32:55 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 19:32:55 -0000
Received: (qmail 54970 invoked by uid 500); 30 Oct 2009 19:32:53 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 54902 invoked by uid 500); 30 Oct 2009 19:32:52 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 54892 invoked by uid 99); 30 Oct 2009 19:32:52 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 19:32:52 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [128.230.18.92] (HELO smtp2.syr.edu) (128.230.18.92)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 19:32:42 +0000
Received: from suex07-hub-01.ad.syr.edu (suex07-hub-01.ad.syr.edu [128.230.108.195])
	by smtp2.syr.edu (8.14.3/8.14.3) with ESMTP id n9UJWLrJ019973
	(version=TLSv1/SSLv3 cipher=AES128-SHA bits=128 verify=FAIL)
	for <java-user@lucene.apache.org>; Fri, 30 Oct 2009 15:32:21 -0400
Received: from suex07-mbx-03.ad.syr.edu ([128.230.108.133]) by
 suex07-hub-01.ad.syr.edu ([2002:80e6:6cc3::80e6:6cc3]) with mapi; Fri, 30 Oct
 2009 15:32:21 -0400
From: Steven A Rowe <sarowe@syr.edu>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Fri, 30 Oct 2009 15:32:16 -0400
Subject: RE: scoring adjacent terms without proximity search
Thread-Topic: scoring adjacent terms without proximity search
Thread-Index: AcpZRhmabKt7QzImRQekY4qlot1GXQANg11w
Message-ID: <2D127F11DC79714E9B6A43AC9458147F2F8EFBEC@suex07-mbx-03.ad.syr.edu>
References: <1256896141.9081.4.camel@bohr>
In-Reply-To: <1256896141.9081.4.camel@bohr>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
x-cr-puzzleid: {BFA5206E-86B9-431F-9612-C36F90E841C5}
x-cr-hashedpuzzle: AV0p AYUs A1yj BPQO C5de DCUK DQis EciH FDXG F59M GUuT
 H8s9 IoK7 I1OX I6be
 KTwZ;1;agBhAHYAYQAtAHUAcwBlAHIAQABsAHUAYwBlAG4AZQAuAGEAcABhAGMAaABlAC4AbwByAGcA;Sosha1_v1;7;{BFA5206E-86B9-431F-9612-C36F90E841C5};cwBhAHIAbwB3AGUAQABzAHkAcgAuAGUAZAB1AA==;Fri,
 30 Oct 2009 19:32:17
 GMT;UgBFADoAIABzAGMAbwByAGkAbgBnACAAYQBkAGoAYQBjAGUAbgB0ACAAdABlAHIAbQBzACAAdwBpAHQAaABvAHUAdAAgAHAAcgBvAHgAaQBtAGkAdAB5ACAAcwBlAGEAcgBjAGgA
acceptlanguage: en-US
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
X-Proofpoint-Virus-Version: vendor=fsecure engine=1.12.8161:2.4.5,1.2.40,4.0.166 definitions=2009-10-30_12:2009-10-29,2009-10-30,2009-10-30 signatures=0
X-Proofpoint-Spam-Reason: safe
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Joel,

You could index every possible word combination in your document text, with=
 one field for each possible distance.  (You would have to write an index-t=
ime analyzer to do this, since AFAIK nothing like this exists currently.  S=
hingles wouldn't work, since you want to ignore intervening terms when you =
query.)

E.g. doc#1: For "Toasted Cheese Sandwich", you would index "Toasted Cheese"=
 and "Cheese Sandwich" in the "d0" field, and "Toasted Sandwich" in the "d1=
" field.

E.g. doc#2: For "Cheese and Potato, Tuna sandwich", you would index d0:"Che=
ese and", d1:"Cheese Potato", d2:"Cheese Tuna", d3:"Cheese sandwich", d0:"a=
nd Potato", d1:"and Tuna", d2:"and sandwich", d0:"Potato Tuna", d1:"Potato =
sandwich", and d0:"Tuna sandwich".

To query, search against all possible distance fields, up-boosting those fi=
elds that are closer to zero distance.  E.g. to search for "cheese sandwich=
", knowing that the maximum distance is 3, you would search for:
=20
   d0:"cheese sandwich"^4 d1:"cheese sandwich"^3
   d2:"cheese sandwich"^2 d3:"cheese sandwich"^1

(To disregard order, you would want to either index the reverse of everythi=
ng or query for the reverse term.)

Doc #1 would get a hit in the "d0" field, while doc #2 would get a hit in t=
he "d3" field, and since you boosted the "d0" field higher in your query th=
an the "d3" field, doc #1's score would be higher.  (If you don't want docu=
ment length to be a factor in the score, you should to turn off normalizati=
on on these fields.)

If you want to extend this scheme to more than two words, you could use the=
 sum of the distances between terms to name the fields.  But: holy explodin=
g index size, Batman.  Especially if you index all possible term permutatio=
ns.

If you only care about terms within X distance, your analyzer could limit t=
he terms in that way.  This would also reduce index size.

To avoid using a whole bunch of fields, one per distance, you could add the=
 distance to the text of each indexed and queried term, e.g. instead of ind=
exing d0:"Toasted Cheese", you could index "Toasted Cheese d0", etc.  Then =
your queries would look like:

   "cheese sandwich d0"^4 "cheese sandwich d1"^3
   "cheese sandwich d2"^2 "cheese sandwich d3"^1

Steve

> -----Original Message-----
> From: Joel Halbert [mailto:joel@su3analytics.com]
> Sent: Friday, October 30, 2009 5:49 AM
> To: Lucene Users
> Subject: scoring adjacent terms without proximity search
>=20
> Hi,
>=20
> Without using a proximity search i.e. "cheese sandwich"~5
>=20
> What's the best way of up-scoring results in which the search terms are
> closer to each other?
>=20
> E.g. so if I search for:
> content:cheese  content:sandwich
>=20
> How do you ensure that a document with content:
> "Toasted Cheese Sandwich"
> scores higher then:
> "Cheese and Potato, Tuna sandwich"
>=20
> Joel


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43140-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 19:57:38 2009
Return-Path: <java-user-return-43140-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 97762 invoked from network); 30 Oct 2009 19:57:38 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 19:57:38 -0000
Received: (qmail 98983 invoked by uid 500); 30 Oct 2009 19:57:36 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 98935 invoked by uid 500); 30 Oct 2009 19:57:36 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 98925 invoked by uid 99); 30 Oct 2009 19:57:36 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 19:57:36 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of rcmuir@gmail.com designates 209.85.216.187 as permitted sender)
Received: from [209.85.216.187] (HELO mail-px0-f187.google.com) (209.85.216.187)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 19:57:33 +0000
Received: by pxi17 with SMTP id 17so80715pxi.20
        for <java-user@lucene.apache.org>; Fri, 30 Oct 2009 12:57:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=SNgAm+u4vL8QGIowySf+x1jIlSndEHraJbIeJ6FEn0A=;
        b=LEThGGINFfQkPOvuIA3+VEl+SLLov34dXrEBU2n96NfZZ1O3RDi5pGbuySX+bRB6hG
         xKighB+YS0c+gszwZgm0phY4aqie/YwC+1MFmZoG9y5A9ct65HfUKzyhhekN26yS+6dh
         r0+cs3+ym3kBMgiub+yhfMZ/Y/YO+xxYcVFj0=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=rxRpgHY37dXs96h4Ucc3DWAhoaY2y6B0/XP5YGh8AIGlDL2Hr0CXPZXGeP+nWBacMW
         RcrDndUAWkSrS7w5iXqCFZQWLmRTGAhrdNTxLfF5NcsyV0ZayplWJPjWic0ugqwFHzOD
         l+r2Z54Mr2ejarBNBh3ynU9XDfty/8uY86jD8=
MIME-Version: 1.0
Received: by 10.114.242.2 with SMTP id p2mr1491159wah.153.1256932633599; Fri, 
	30 Oct 2009 12:57:13 -0700 (PDT)
In-Reply-To: <1256896141.9081.4.camel@bohr>
References: <1256896141.9081.4.camel@bohr>
From: Robert Muir <rcmuir@gmail.com>
Date: Fri, 30 Oct 2009 15:56:53 -0400
Message-ID: <8f0ad1f30910301256t201200ffna8e86cfb4bafcb5f@mail.gmail.com>
Subject: Re: scoring adjacent terms without proximity search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e6493f9821dfda04772c6f1a

--0016e6493f9821dfda04772c6f1a
Content-Type: text/plain; charset=UTF-8

yet another thing to look into that might improve things a bit is using
ShingleFilter in contrib.

this way cheese sandwich would form a shingle of "cheese sandwich" and would
get a higher score for the "Toasted Cheese Sandwich" document.

it wouldn't solve the proximity problem in general, but maybe it would help,
depending on your requirements.

On Fri, Oct 30, 2009 at 5:49 AM, Joel Halbert <joel@su3analytics.com> wrote:

> Hi,
>
> Without using a proximity search i.e. "cheese sandwich"~5
>
> What's the best way of up-scoring results in which the search terms are
> closer to each other?
>
> E.g. so if I search for:
> content:cheese  content:sandwich
>
> How do you ensure that a document with content:
> "Toasted Cheese Sandwich"
> scores higher then:
> "Cheese and Potato, Tuna sandwich"
>
> Joel
>
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org
>
>


-- 
Robert Muir
rcmuir@gmail.com

--0016e6493f9821dfda04772c6f1a--

From java-user-return-43141-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Fri Oct 30 20:16:21 2009
Return-Path: <java-user-return-43141-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 3270 invoked from network); 30 Oct 2009 20:16:21 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 30 Oct 2009 20:16:21 -0000
Received: (qmail 35192 invoked by uid 500); 30 Oct 2009 20:16:19 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 35127 invoked by uid 500); 30 Oct 2009 20:16:19 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 35117 invoked by uid 99); 30 Oct 2009 20:16:19 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 20:16:19 +0000
X-ASF-Spam-Status: No, hits=2.2 required=10.0
	tests=HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of rcmuir@gmail.com designates 209.85.216.187 as permitted sender)
Received: from [209.85.216.187] (HELO mail-px0-f187.google.com) (209.85.216.187)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 30 Oct 2009 20:16:11 +0000
Received: by pxi17 with SMTP id 17so88690pxi.20
        for <java-user@lucene.apache.org>; Fri, 30 Oct 2009 13:15:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :from:date:message-id:subject:to:content-type;
        bh=PjG+bbowMN++TSnarp1yX+C556Qm/SEoBuCKi0jkzpQ=;
        b=Xzt1rrjlAKTt8bT0eL5UtCsTwmB+9amYvCitYREP5E+hAYK4iSbEo2PeA9f2bhFiGM
         wzJfUXxFEoI49cb+mMrbVlBy+hhEwfqYfVkpOac4l+UnpYf6kza64/YY/EScAQ2WY7tC
         lCE2OylyOOB6wYfKRGg3rGCkk1iXWsGm55628=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        b=IeNKxvljidaZFZyMRO9GDMNZOCflOjvcuQdblIarU2yrHcV39QVGHYAWFS4jMbGsLn
         EePpF4ur2qXnxmM0Vaie++sAd7Xb8KNCrC5uXdB/KI2h18AdNvs+9Z/ry0jRxN/lrK7c
         13WTOWSPfuphgCtg8We3uNTvdYJhrt63KJND8=
MIME-Version: 1.0
Received: by 10.114.248.20 with SMTP id v20mr1508622wah.132.1256933749947; 
	Fri, 30 Oct 2009 13:15:49 -0700 (PDT)
In-Reply-To: <C31FA1AF-5D36-4752-94ED-D51A3E3BF3DC@apache.org>
References: <1256896141.9081.4.camel@bohr> <C31FA1AF-5D36-4752-94ED-D51A3E3BF3DC@apache.org>
From: Robert Muir <rcmuir@gmail.com>
Date: Fri, 30 Oct 2009 16:04:03 -0400
Message-ID: <8f0ad1f30910301304p526827fbqe34bbec3017292ac@mail.gmail.com>
Subject: Re: scoring adjacent terms without proximity search
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016e64dd78aabfcf104772cb107
X-Virus-Checked: Checked by ClamAV on apache.org

--0016e64dd78aabfcf104772cb107
Content-Type: text/plain; charset=UTF-8

> I suppose you could precompute the proximity associations by indexing
> n-grams (in this case, called Lucene calls them shingles), such that there
> is a single token in your index containing cheese_sandwich (effectively)
>
>
doh, I see Grant already lead you in this direction. (sorry for the
duplicate mail)
on average its worked for me for some things like this.

although, I'll try to contribute something actually useful, and mention that
if you use things like shingles, its good to consider modifying
DefaultSimilarity, look at setDiscountOverlaps param.
otherwise, i've measured cases where injecting additional tokens will cause
more harm than good, because it has an adverse affect on lengthnorm.

-- 
Robert Muir
rcmuir@gmail.com

--0016e64dd78aabfcf104772cb107--

From java-user-return-43142-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 31 04:59:19 2009
Return-Path: <java-user-return-43142-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 13445 invoked from network); 31 Oct 2009 04:59:19 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 31 Oct 2009 04:59:19 -0000
Received: (qmail 38184 invoked by uid 500); 31 Oct 2009 04:59:17 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 37974 invoked by uid 500); 31 Oct 2009 04:59:15 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 37964 invoked by uid 99); 31 Oct 2009 04:59:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 04:59:14 +0000
X-ASF-Spam-Status: No, hits=-1.2 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE,MIME_QP_LONG_LINE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of hrishikesh_agashe@persistent.co.in designates 202.54.11.87 as permitted sender)
Received: from [202.54.11.87] (HELO bmapps.persistent.co.in) (202.54.11.87)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 04:59:12 +0000
X-AuditID: 0a4e0006-b7c7eae000004705-6a-4aebc4068726
Received: from puneexchange.persistent.co.in ( [10.78.0.1])
	(using TLS with cipher AES128-SHA (AES128-SHA/128 bits))
	(Client did not present a certificate)
	by  (Symantec Mail Security) with SMTP id C8.E2.18181.604CBEA4; Sat, 31 Oct 2009 10:28:47 +0530 (IST)
Received: from Exchange.persistent.co.in ([fe80::ad8a:d553:ef93:bfdd]) by CAS2
 ([10.77.224.47]) with mapi; Sat, 31 Oct 2009 10:28:46 +0530
From: Hrishikesh Agashe <hrishikesh_agashe@persistent.co.in>
To: "java-user@lucene.apache.org" <java-user@lucene.apache.org>
Date: Sat, 31 Oct 2009 10:28:45 +0530
Subject: Basic searching doubt
Thread-Topic: Basic searching doubt
Thread-Index: AcpZ5tNXyaLIksEERMGKDp8IkppDBQ==
Message-ID: <E3137F97B0A0804194F369F4E7C3B71929AEF75F5D@EXCHANGE.persistent.co.in>
Accept-Language: en-US, en-IN
Content-Language: en-US
X-MS-Has-Attach:
X-MS-TNEF-Correlator:
acceptlanguage: en-US, en-IN
Content-Type: multipart/alternative;
	boundary="_000_E3137F97B0A0804194F369F4E7C3B71929AEF75F5DEXCHANGEpersi_"
MIME-Version: 1.0
X-Brightmail-Tracker: AAAAAQAAAZE=

--_000_E3137F97B0A0804194F369F4E7C3B71929AEF75F5DEXCHANGEpersi_
Content-Type: text/plain; charset="us-ascii"
content-transfer-encoding: quoted-printable

Hi,

If I search for string "A B" (i.e. A followed by a space followed by B) and=
 I get 20 hits, then is it correct to expect that if I search for "A" (i.e.=
 only A), I will get at least 20 hit or more? Similarly for if I search for=
 B, I will get 20 hits or more?

--Hrishi

DISCLAIMER=0A=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=0A=
This e-mail may contain privileged and confidential information which is the=
 property of Persistent Systems Ltd. It is intended only for the use of the=
 individual or entity to which it is addressed. If you are not the intended=
 recipient, you are not authorized to read, retain, copy, print, distribute=
 or use this message. If you have received this communication in error, plea=
se notify the sender and delete all copies of this message. Persistent Syste=
ms Ltd. does not accept any liability for virus infected mails.

--_000_E3137F97B0A0804194F369F4E7C3B71929AEF75F5DEXCHANGEpersi_--

From java-user-return-43143-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 31 06:01:58 2009
Return-Path: <java-user-return-43143-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 23727 invoked from network); 31 Oct 2009 06:01:58 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 31 Oct 2009 06:01:58 -0000
Received: (qmail 56456 invoked by uid 500); 31 Oct 2009 06:01:56 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 56228 invoked by uid 500); 31 Oct 2009 06:01:54 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 56212 invoked by uid 99); 31 Oct 2009 06:01:53 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 06:01:53 +0000
X-ASF-Spam-Status: No, hits=-2.2 required=5.0
	tests=AWL,BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [203.104.17.147] (HELO web94804.mail.in2.yahoo.com) (203.104.17.147)
    by apache.org (qpsmtpd/0.29) with SMTP; Sat, 31 Oct 2009 06:01:51 +0000
Received: (qmail 37400 invoked by uid 60001); 31 Oct 2009 06:01:27 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024; t=1256968887; bh=gnwwdFsApEv71D84vXuTQR7CVCDNJDe1dMDJ6sVxA1M=; h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type; b=ef0JtCCRIcznPFbYBZqsAFhCrBc7i7M9GUdGUQQMzUKhHq48wzSfC6sVmhdS4heQWERmwoI7fLrfq6vdrsRL7GXXPqd2gbyItMYDe92SoW3w/nGT/eyqCGKA9HfpmzPwe9AuGWSLdCZ9Uu1+CNAtgjqOi/eRXZPzdccYkxzNMnQ=
DomainKey-Signature:a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:X-YMail-OSG:Received:X-Mailer:Date:From:Subject:To:MIME-Version:Content-Type;
  b=IrPX8lfTAxwOFN9Wpfnza2/W+PKHo5gQpJ7cTfWf+DN7zFPI96oK2OuuBIORdIoXuVztv/9a9spD5x8eNiHsnJzc10XTCbk2wSV7FL6sxUtl+8bTC/A6yj25imXJP+cm5Nj9sc1s5RBJHaWDh0l8I4rW09s3QG/OE9O0W7LHZps=;
Message-ID: <319932.28708.qm@web94804.mail.in2.yahoo.com>
X-YMail-OSG: 5fX9AS0VM1kbzlmC9bLLJ15Vdf0v2v2HaCpLWcXZuzFXNEff5Xk.Zo.vKv9TkDv0fkp62TB6gjKlLzp97DD6WKwxcDVS0LtX5zUIZ7ZNfRDuGDx7QJBAnrNcq7XJvNulOqZ1tdlwBTb39mJEDxGrtnotC81i6OsOAK..gU513klRxFO9mAdaxR.kwbZCox.btCc27lu8S7ILvlBaFKZ5e_R.vJrny.syPncWB3iigIcaUoME6SMjAlT0EDIEbb2i
Received: from [59.90.244.83] by web94804.mail.in2.yahoo.com via HTTP; Sat, 31 Oct 2009 11:31:27 IST
X-Mailer: YahooMailClassic/8.1.6 YahooMailWebService/0.7.361.4
Date: Sat, 31 Oct 2009 11:31:27 +0530 (IST)
From: DHIVYA M <dhivyakrishnan87@yahoo.com>
Subject: Error while implementing HIGHLIGHTER
To: java user <java-user@lucene.apache.org>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1127412037-1256968887=:28708"

--0-1127412037-1256968887=:28708
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

Hi all,
=A0
While attempting to use highlighter with=A0lucene 2.3.2 to get the result s=
imilar to that of google response am getting the following error.=20
=A0
Kindly give me a solution for this problem or provide me an alternate codin=
g methodology if this=A0s ultimately=A0wrong. I couldnt find out where am m=
issing.
=A0
=A0
=A0
Error: [as viewed through Netbeans 6.5.1]
--------
=A0
run:
Enter query:=20
automatically
Searching for: automatically
1 total matching documents
1. d:\test\new.txt
Exception in thread "main" java.lang.StringIndexOutOfBoundsException: Strin=
g index out of range: 23
=A0=A0=A0=A0=A0=A0=A0 at java.lang.String.substring(String.java:1935)
=A0=A0=A0=A0=A0=A0=A0 at org.apache.lucene.search.highlight.Highlighter.get=
BestTextFragments(Highlighter.java:235)
=A0=A0=A0=A0=A0=A0=A0 at org.apache.lucene.search.highlight.Highlighter.get=
BestFragments(Highlighter.java:175)
=A0=A0=A0=A0=A0=A0=A0 at org.apache.lucene.search.highlight.Highlighter.get=
BestFragments(Highlighter.java:460)
=A0=A0=A0=A0=A0=A0=A0 at lucenehighlighter.SearchFiles.main(SearchFiles.jav=
a:145)
Java Result: 1
BUILD SUCCESSFUL (total time: 6 seconds)

=A0
Code:
--------
=A0
SimpleHTMLFormatter formatter =3D new SimpleHTMLFormatter(=20
"<span class=3D\"highlight\">", "</span>");=20
Highlighter high=3D new Highlighter(formatter,new QueryScorer(query));
high.setTextFragmenter(new SimpleFragmenter(20));
for (int j =3D 0; j < hits.length(); j++) {
=A0String text =3D hits.doc(j).get("path");
=A0 TokenStream tokenStream =3D analyzer.tokenStream("contents", new FileRe=
ader(text));
=A0 String result =3D high.getBestFragments(tokenStream,text,5,"...");
=A0 System.out.println("\t" + result);
}=0A=0A=0A      From cricket scores to your friends. Try the Yahoo! India H=
omepage! http://in.yahoo.com/trynew
--0-1127412037-1256968887=:28708--

From java-user-return-43144-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 31 08:37:32 2009
Return-Path: <java-user-return-43144-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 50535 invoked from network); 31 Oct 2009 08:37:32 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 31 Oct 2009 08:37:32 -0000
Received: (qmail 97808 invoked by uid 500); 31 Oct 2009 08:37:29 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 97677 invoked by uid 500); 31 Oct 2009 08:37:28 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 97667 invoked by uid 99); 31 Oct 2009 08:37:28 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 08:37:28 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00
X-Spam-Check-By: apache.org
Received-SPF: neutral (athena.apache.org: local policy)
Received: from [82.132.130.151] (HELO mail.o2.co.uk) (82.132.130.151)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 08:37:25 +0000
Received: from [192.168.0.3] (94.195.77.205) by mail.o2.co.uk (8.0.013.3) (authenticated as joelhalbert)
        id 4AE6CD0F01365FC8 for java-user@lucene.apache.org; Sat, 31 Oct 2009 08:36:58 +0000
Subject: Re: scoring adjacent terms without proximity search
From: Joel Halbert <joel@su3analytics.com>
To: java-user@lucene.apache.org
In-Reply-To: <8f0ad1f30910301304p526827fbqe34bbec3017292ac@mail.gmail.com>
References: <1256896141.9081.4.camel@bohr>
	 <C31FA1AF-5D36-4752-94ED-D51A3E3BF3DC@apache.org>
	 <8f0ad1f30910301304p526827fbqe34bbec3017292ac@mail.gmail.com>
Content-Type: text/plain
Organization: SU3 Analytics
Date: Sat, 31 Oct 2009 08:38:29 +0000
Message-Id: <1256978309.6534.4.camel@bohr>
Mime-Version: 1.0
X-Mailer: Evolution 2.22.3.1 
Content-Transfer-Encoding: 7bit

Thank you all for your suggestions, I shall have a little think about
the best way forward, and report back if I do anything interesting that
works well.

In answer to Grant's question, why not use PhraseQuery,  we do not want
to have an artificial upper limit on the slop, i.e. we do want to
include documents that might only have a subset of words from the
phrase. (e.g. just cheese, or just sandwich, but not both).


-----Original Message-----
From: Robert Muir <rcmuir@gmail.com>
Reply-To: java-user@lucene.apache.org
To: java-user@lucene.apache.org
Subject: Re: scoring adjacent terms without proximity search
Date: Fri, 30 Oct 2009 16:04:03 -0400

> I suppose you could precompute the proximity associations by indexing
> n-grams (in this case, called Lucene calls them shingles), such that there
> is a single token in your index containing cheese_sandwich (effectively)
>
>
doh, I see Grant already lead you in this direction. (sorry for the
duplicate mail)
on average its worked for me for some things like this.

although, I'll try to contribute something actually useful, and mention that
if you use things like shingles, its good to consider modifying
DefaultSimilarity, look at setDiscountOverlaps param.
otherwise, i've measured cases where injecting additional tokens will cause
more harm than good, because it has an adverse affect on lengthnorm.



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


From java-user-return-43145-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 31 09:41:27 2009
Return-Path: <java-user-return-43145-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 71253 invoked from network); 31 Oct 2009 09:41:27 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 31 Oct 2009 09:41:27 -0000
Received: (qmail 19168 invoked by uid 500); 31 Oct 2009 09:41:24 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 19030 invoked by uid 500); 31 Oct 2009 09:41:23 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 19020 invoked by uid 99); 31 Oct 2009 09:41:22 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 09:41:22 +0000
X-ASF-Spam-Status: No, hits=-2.6 required=5.0
	tests=BAYES_00,HTML_MESSAGE
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of r.ventaglio@gmail.com designates 209.85.218.222 as permitted sender)
Received: from [209.85.218.222] (HELO mail-bw0-f222.google.com) (209.85.218.222)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 09:41:20 +0000
Received: by bwz22 with SMTP id 22so4685529bwz.5
        for <java-user@lucene.apache.org>; Sat, 31 Oct 2009 02:40:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:content-type;
        bh=8OwwBjukgDX1GjlN5ixy6tHlMZH3n4H94L5hPUFS6H8=;
        b=xMl15ZtTb0BsNQB0x/xydgHSaT3Q2LwSJ/t3myHqz0dsIgi0bZXYtHpzusPPuQ7n0v
         /7TaKXLcpIWojxXndkpQ9BrsIv+Id50sLkMeUgGxwQM1azK8UGgFo6T3shLS2GCzu7LW
         976S74tF0WvkWkNAWt7yVYY+Wt85iCqJcGiDk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=EoGCXvXSPweFHjQESkEirs30EEs+QkSv4oXiUiUtLrDFOw8op2SbVqA9aPsOEJ74Hh
         +thwK9h/4n8M1nPFTe+8BpD+dR+zBvpAkmYVE/6zwtRAl0aFVcNMzWfm1gOGSZde0tWr
         Jb2v5PMsbcc4/6UEqlYW/OHdU+FWoLUGLYKzQ=
MIME-Version: 1.0
Received: by 10.102.177.33 with SMTP id z33mr1082788mue.87.1256982057336; Sat, 
	31 Oct 2009 02:40:57 -0700 (PDT)
In-Reply-To: <E3137F97B0A0804194F369F4E7C3B71929AEF75F5D@EXCHANGE.persistent.co.in>
References: <E3137F97B0A0804194F369F4E7C3B71929AEF75F5D@EXCHANGE.persistent.co.in>
Date: Sat, 31 Oct 2009 10:40:57 +0100
Message-ID: <70422ecc0910310240w7bc7744lb65bf2e7e6f2d285@mail.gmail.com>
Subject: Re: Basic searching doubt
From: Raf <r.ventaglio@gmail.com>
To: java-user@lucene.apache.org
Content-Type: multipart/alternative; boundary=0016364163db04406a047737f19d

--0016364163db04406a047737f19d
Content-Type: text/plain; charset=ISO-8859-1

If you search "A B" (with quotes) it is correct, but if you search only A B
(without quotes) it is not correct, because, by default the query parser
creates "OR" queries.
So searching   A B  you will find all documents that contains A or B, while
searching only A or only B you will normally find less documents!
If you want to search all documents that contains A and B, you should write
the query as +A +B (or change the default operator for query parser from OR
to AND).

Bye
Raf

On Sat, Oct 31, 2009 at 5:58 AM, Hrishikesh Agashe <
hrishikesh_agashe@persistent.co.in> wrote:

> Hi,
>
> If I search for string "A B" (i.e. A followed by a space followed by B) and
> I get 20 hits, then is it correct to expect that if I search for "A" (i.e.
> only A), I will get at least 20 hit or more? Similarly for if I search for
> B, I will get 20 hits or more?
>
> --Hrishi
>
> DISCLAIMER
> ==========
> This e-mail may contain privileged and confidential information which is
> the property of Persistent Systems Ltd. It is intended only for the use of
> the individual or entity to which it is addressed. If you are not the
> intended recipient, you are not authorized to read, retain, copy, print,
> distribute or use this message. If you have received this communication in
> error, please notify the sender and delete all copies of this message.
> Persistent Systems Ltd. does not accept any liability for virus infected
> mails.
>

--0016364163db04406a047737f19d--

From java-user-return-43146-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org Sat Oct 31 22:55:09 2009
Return-Path: <java-user-return-43146-apmail-lucene-java-user-archive=lucene.apache.org@lucene.apache.org>
Delivered-To: apmail-lucene-java-user-archive@www.apache.org
Received: (qmail 95870 invoked from network); 31 Oct 2009 22:55:09 -0000
Received: from hermes.apache.org (HELO mail.apache.org) (140.211.11.3)
  by minotaur.apache.org with SMTP; 31 Oct 2009 22:55:09 -0000
Received: (qmail 14860 invoked by uid 500); 31 Oct 2009 22:55:06 -0000
Delivered-To: apmail-lucene-java-user-archive@lucene.apache.org
Received: (qmail 14779 invoked by uid 500); 31 Oct 2009 22:55:05 -0000
Mailing-List: contact java-user-help@lucene.apache.org; run by ezmlm
Precedence: bulk
List-Help: <mailto:java-user-help@lucene.apache.org>
List-Unsubscribe: <mailto:java-user-unsubscribe@lucene.apache.org>
List-Post: <mailto:java-user@lucene.apache.org>
List-Id: <java-user.lucene.apache.org>
Reply-To: java-user@lucene.apache.org
Delivered-To: mailing list java-user@lucene.apache.org
Received: (qmail 14769 invoked by uid 99); 31 Oct 2009 22:55:05 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 22:55:05 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=10.0
	tests=SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [208.69.42.181] (HELO radix.cryptio.net) (208.69.42.181)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 31 Oct 2009 22:54:55 +0000
Received: by radix.cryptio.net (Postfix, from userid 1007)
	id 7BB3571C986; Sat, 31 Oct 2009 15:54:34 -0700 (PDT)
Received: from localhost (localhost [127.0.0.1])
	by radix.cryptio.net (Postfix) with ESMTP id 791C171C985
	for <java-user@lucene.apache.org>; Sat, 31 Oct 2009 15:54:34 -0700 (PDT)
Date: Sat, 31 Oct 2009 15:54:34 -0700 (PDT)
From: Chris Hostetter <hossman_lucene@fucit.org>
To: java-user@lucene.apache.org
Subject: Re: Can anyone help me to implement highlighter in lucene 2.3.2
In-Reply-To: <449382.93445.qm@web94811.mail.in2.yahoo.com>
Message-ID: <Pine.LNX.4.64.0910311553290.24288@radix.cryptio.net>
References: <449382.93445.qm@web94811.mail.in2.yahoo.com>
MIME-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
X-Virus-Checked: Checked by ClamAV on apache.org


: Subject: Can anyone help me to implement highlighter in lucene 2.3.2 
: In-Reply-To:  <867513fe0910300021k5f9766e1nf97f7e2bae5e1489@mail.gmail.com> 

http://people.apache.org/~hossman/#threadhijack
Thread Hijacking on Mailing Lists

When starting a new discussion on a mailing list, please do not reply to 
an existing message, instead start a fresh email.  Even if you change the 
subject line of your email, other mail headers still track which thread 
you replied to and your question is "hidden" in that thread and gets less 
attention.   It makes following discussions in the mailing list archives 
particularly difficult.
See Also:  http://en.wikipedia.org/wiki/Thread_hijacking





-Hoss


---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


